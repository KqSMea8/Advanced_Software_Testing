<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:26:44 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5323/HBASE-5323.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5323] Need to handle assertion error while splitting log through ServerShutDownHandler by shutting down the master</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5323</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We know that while parsing the HLog we expect the proper length from HDFS.&lt;br/&gt;
In WALReaderFSDataInputStream&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
              &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(realLength &amp;gt;= &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.length);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We are trying to come out if the above condition is not satisfied.  But if SSH.splitLog() gets this problem then it lands in the run method of EventHandler.  This kills the SSH thread and so further assignment does not happen.  If ROOT and META are to be assigned they cannot be.&lt;br/&gt;
I think in this condition we abort the master by catching such exceptions.&lt;br/&gt;
Please do suggest.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12540957">HBASE-5323</key>
            <summary>Need to handle assertion error while splitting log through ServerShutDownHandler by shutting down the master</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="ram_krish">ramkrishna.s.vasudevan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Feb 2012 17:46:18 +0000</created>
                <updated>Tue, 30 Dec 2014 04:35:31 +0000</updated>
                            <resolved>Tue, 30 Dec 2014 04:35:31 +0000</resolved>
                                    <version>0.90.5</version>
                                    <fixVersion>0.90.8</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13199029" author="zhihyu@ebaysf.com" created="Thu, 2 Feb 2012 17:55:19 +0000"  >&lt;p&gt;Suggested approach makes sense.&lt;/p&gt;</comment>
                            <comment id="13199913" author="ram_krish" created="Fri, 3 Feb 2012 18:13:42 +0000"  >&lt;p&gt;Patch for 0.90.&lt;/p&gt;</comment>
                            <comment id="13199917" author="tlipcon" created="Fri, 3 Feb 2012 18:16:06 +0000"  >&lt;p&gt;If this is an actual error condition that can be seen in practice (rather than indication of a failed programmer assumption) it should be changed to an if/throw, not an assert. Most users don&apos;t have asserts enabled in production.&lt;/p&gt;</comment>
                            <comment id="13200329" author="ram_krish" created="Sat, 4 Feb 2012 04:37:50 +0000"  >&lt;p&gt;@Todd&lt;/p&gt;

&lt;p&gt;Ok.. I can update the patch accordingly. I agree with your suggestion.&lt;/p&gt;</comment>
                            <comment id="13200331" author="lhofhansl" created="Sat, 4 Feb 2012 04:47:48 +0000"  >&lt;p&gt;+1 on aborting the Master when this happens&lt;br/&gt;
+1 on changing the assert to try/catch.&lt;/p&gt;

&lt;p&gt;Generally assert should only be used with conditions that we can live with in a production environment (as Todd points out).&lt;/p&gt;</comment>
                            <comment id="13202076" author="ram_krish" created="Tue, 7 Feb 2012 04:55:38 +0000"  >&lt;p&gt;Patch for 0.90&lt;/p&gt;</comment>
                            <comment id="13205610" author="zhihyu@ebaysf.com" created="Fri, 10 Feb 2012 18:31:21 +0000"  >&lt;p&gt;Some comments for patch v2.&lt;br/&gt;
In MasterFileSystem.java, the following check should be put as first in if statement because it is fast:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
e &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; HLogLengthMisMatchException
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In HLog.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; HLogLengthMisMatchException) {
+        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HLogLengthMisMatchException(
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I don&apos;t think we need the above. Instead, we should check for e.cause in MasterFileSystem.java&lt;/p&gt;

&lt;p&gt;For HLogLengthMisMatchException.java, the M in Match should be lower case.&lt;br/&gt;
I think it should be a generic exception. So maybe rename it to FileLengthMismatchException ?&lt;/p&gt;

&lt;p&gt;For InstrumentedSequenceLogReader, please add javadoc for the class.&lt;br/&gt;
This class should be generic as well. How about passing the exception that getPos() is supposed to throw to ctor of InstrumentedSequenceLogReader ?&lt;/p&gt;</comment>
                            <comment id="13205612" author="zhihyu@ebaysf.com" created="Fri, 10 Feb 2012 18:32:14 +0000"  >&lt;p&gt;I would suggest starting with a patch for TRUNK which can be verified by Hadoop QA.&lt;br/&gt;
Once code review passes, you can backport to 0.90 branch.&lt;/p&gt;</comment>
                            <comment id="13234566" author="lhofhansl" created="Wed, 21 Mar 2012 17:37:30 +0000"  >&lt;p&gt;Are you still working on this Ram? Do you think this needs to go into 0.94?&lt;/p&gt;</comment>
                            <comment id="13234582" author="ram_krish" created="Wed, 21 Mar 2012 17:46:32 +0000"  >&lt;p&gt;Currently am not working on this Lars. You need not include in RC.  Thanks&lt;/p&gt;</comment>
                            <comment id="13408790" author="lhofhansl" created="Sat, 7 Jul 2012 22:13:50 +0000"  >&lt;p&gt;Thanks Ram... Let&apos;s try for the next release.&lt;br/&gt;
I&apos;ll leave it to Jon whether he wants this in 0.90.7.&lt;/p&gt;</comment>
                            <comment id="13412366" author="jmhsieh" created="Wed, 11 Jul 2012 23:44:16 +0000"  >&lt;p&gt;If it isn&apos;t making 0.94.1 then I&apos;m going to bump it from 0.90.7.&lt;/p&gt;</comment>
                            <comment id="13442016" author="lhofhansl" created="Sun, 26 Aug 2012 03:33:24 +0000"  >&lt;p&gt;Moving out to 0.94.3.&lt;br/&gt;
@Ram: So you&apos;re seeing this in production or in a test? Are you running with assertions enabled in production?&lt;/p&gt;</comment>
                            <comment id="13484716" author="lhofhansl" created="Fri, 26 Oct 2012 05:06:05 +0000"  >&lt;p&gt;On to the greener pastures of 0.94.4&lt;/p&gt;</comment>
                            <comment id="13563765" author="lhofhansl" created="Sun, 27 Jan 2013 08:12:14 +0000"  >&lt;p&gt;Removing from 0.94 since there is no movement.&lt;/p&gt;</comment>
                            <comment id="14260778" author="ram_krish" created="Tue, 30 Dec 2014 04:35:31 +0000"  >&lt;p&gt;0.90.x version is no more active. Resolving as &apos;Won&apos;t fix&apos;.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12513571" name="HBASE-5323.patch" size="9567" author="ram_krish" created="Tue, 7 Feb 2012 04:55:38 +0000"/>
                            <attachment id="12513156" name="HBASE-5323.patch" size="951" author="ram_krish" created="Fri, 3 Feb 2012 18:13:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 2 Feb 2012 17:55:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>226310</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 50 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02dxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11859</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>