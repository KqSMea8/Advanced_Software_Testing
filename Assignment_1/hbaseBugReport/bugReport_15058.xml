<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:59:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-15058/HBASE-15058.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-15058] AssignmentManager should account for unsuccessful split correctly which initially passes quota check</title>
                <link>https://issues.apache.org/jira/browse/HBASE-15058</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When region split doesn&apos;t pass quota check, we would see exception similar to the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-12-29 16:07:33,653 INFO  [RS:0;10.21.128.189:57449-splits-1451434041585] regionserver.SplitRequest(97): Running rollback/cleanup of failed split of np2:                     testRegionNormalizationSplitOnCluster,zzzzz,1451434045065.27cccb3fae03002b8058beef61cb7c20.; Failed to get ok from master to split np2:testRegionNormalizationSplitOnCluster,     zzzzz,1451434045065.27cccb3fae03002b8058beef61cb7c20.
java.io.IOException: Failed to get ok from master to split np2:testRegionNormalizationSplitOnCluster,zzzzz,1451434045065.27cccb3fae03002b8058beef61cb7c20.
  at org.apache.hadoop.hbase.regionserver.SplitTransactionImpl.stepsBeforePONR(SplitTransactionImpl.java:345)
  at org.apache.hadoop.hbase.regionserver.SplitTransactionImpl.createDaughters(SplitTransactionImpl.java:262)
  at org.apache.hadoop.hbase.regionserver.SplitTransactionImpl.execute(SplitTransactionImpl.java:502)
  at org.apache.hadoop.hbase.regionserver.SplitRequest.doSplitting(SplitRequest.java:82)
  at org.apache.hadoop.hbase.regionserver.SplitRequest.run(SplitRequest.java:155)
  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;However, region split may fail for subsequent SplitTransactionPhase&apos;s in stepsBeforePONR().&lt;br/&gt;
Currently in branch-1, the distinction among the following TransitionCode&apos;s is not clear in AssignmentManager#onRegionTransition():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; SPLIT_PONR:
    &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; SPLIT:
    &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; SPLIT_REVERTED:
      errorMsg =
          onRegionSplit(serverName, code, hri, HRegionInfo.convert(transition.getRegionInfo(1)),
            HRegionInfo.convert(transition.getRegionInfo(2)));
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (org.apache.commons.lang.StringUtils.isEmpty(errorMsg)) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          regionStateListener.onRegionSplitReverted(hri);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;onRegionSplit() handles the above 3 TransitionCode&apos;s. However, errorMsg is normally null (onRegionSplit returns null at the end).&lt;br/&gt;
This would result in onRegionSplitReverted() being called for cases of SPLIT_PONR and SPLIT.&lt;/p&gt;

&lt;p&gt;When region split fails, AssignmentManager#onRegionTransition() should account for the failure properly so that quota bookkeeping is consistent.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12924935">HBASE-15058</key>
            <summary>AssignmentManager should account for unsuccessful split correctly which initially passes quota check</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 30 Dec 2015 19:22:50 +0000</created>
                <updated>Mon, 8 Feb 2016 04:57:43 +0000</updated>
                            <resolved>Tue, 5 Jan 2016 14:27:19 +0000</resolved>
                                    <version>1.2.0</version>
                                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="15075683" author="chenheng" created="Thu, 31 Dec 2015 03:29:19 +0000"  >&lt;p&gt;Currently,  the quota information is stored in HMaster,   So when split happens, we have to ask HMaster whether the quota check pass or not,  and once split failed, we have to tell hmaster the information, so master could do rollback the update of namespace quota.&lt;/p&gt;

&lt;p&gt;I have a proposal,  could we store quota information in some place (I notice this information is stored in meta now,  could we use it directly in RS ?),  so regionServer and HMaster could get/update this information more simple, and the consistency could be guaranteed.&lt;/p&gt;

</comment>
                            <comment id="15075695" author="yuzhihong@gmail.com" created="Thu, 31 Dec 2015 04:01:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;could we use it directly in RS&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If RS updates quota info, master needs to be notified of the change, right ?&lt;/p&gt;

&lt;p&gt;Currently NamespaceStateManager is on Master only.&lt;br/&gt;
The above proposal is a big change.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=avandana&quot; class=&quot;user-hover&quot; rel=&quot;avandana&quot;&gt;Vandana Ayyalasomayajula&lt;/a&gt;:&lt;br/&gt;
What do you think ?&lt;/p&gt;</comment>
                            <comment id="15075700" author="chenheng" created="Thu, 31 Dec 2015 04:14:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt; &lt;br/&gt;
I notice your comment in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15056&quot; title=&quot;Split fails with KeeperException$NoNodeException when namespace quota is enabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15056&quot;&gt;HBASE-15056&lt;/a&gt;&lt;br/&gt;
So your suggestion is we implement a new RegionStateListener to communicate with HMaster to ensure the consistency quota state?&lt;br/&gt;
I think it is fine,  but i am not sure how to keep consistency between HMaster and backup Master if we still keep the state in memory.&lt;/p&gt;

&lt;p&gt;My suggestion is keep the state in some place (e.g. ZK),  wdyt?&lt;/p&gt;</comment>
                            <comment id="15075806" author="ashish singhi" created="Thu, 31 Dec 2015 07:37:36 +0000"  >&lt;p&gt;We are roll backing the quota in SPLIT_REVERTED case.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; SPLIT_REVERTED:
        errorMsg = onRegionSplitReverted(current, hri, serverName, transition);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (org.apache.commons.lang.StringUtils.isEmpty(errorMsg)) {
          &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            regionStateListener.onRegionSplitReverted(hri);
          } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException exp) {
            LOG.warn(StringUtils.stringifyException(exp));
          }
        }
        &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;&lt;p&gt;region split may fail for subsequent SplitTransactionPhase&apos;s in stepsBeforePONR()&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In this case we will rollback the split, right ?&lt;/p&gt;</comment>
                            <comment id="15075952" author="yuzhihong@gmail.com" created="Thu, 31 Dec 2015 13:59:29 +0000"  >&lt;p&gt;Turns out that I was looking at branch-1 code.&lt;/p&gt;

&lt;p&gt;Modified description to be specific.&lt;/p&gt;</comment>
                            <comment id="15076072" author="yuzhihong@gmail.com" created="Thu, 31 Dec 2015 17:23:07 +0000"  >&lt;p&gt;Patch v1 separates the logic for SPLIT_REVERTED into onRegionSplitReverted()&lt;/p&gt;

&lt;p&gt;Handling of the case of SPLIT_REVERTED is now not sharing the code path with that for SPLIT_PONR and SPLIT cases.&lt;/p&gt;</comment>
                            <comment id="15076134" author="hadoopqa" created="Thu, 31 Dec 2015 21:00:56 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12780135/15058-branch-1-v1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12780135/15058-branch-1-v1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit 92abf8ac5743849d4c32d6abf8fd33f161bab249.&lt;br/&gt;
  ATTACHMENT ID: 12780135&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;. The applied patch does not generate new checkstyle errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/17095//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/17095//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/17095//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/17095//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/17095//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/17095//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/17095//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/17095//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15076137" author="hadoopqa" created="Thu, 31 Dec 2015 21:17:26 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12780162/15058-branch-1-v1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12780162/15058-branch-1-v1.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit 92abf8ac5743849d4c32d6abf8fd33f161bab249.&lt;br/&gt;
  ATTACHMENT ID: 12780162&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;. The applied patch does not generate new checkstyle errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestShell&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/17096//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/17096//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/17096//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/17096//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/17096//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/17096//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/17096//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/17096//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15080741" author="ashish singhi" created="Mon, 4 Jan 2016 06:20:02 +0000"  >&lt;p&gt;Overall lgtm.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; onRegionSplitReverted(ServerName sn, TransitionCode code,
	      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HRegionInfo p, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HRegionInfo a, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HRegionInfo b) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&lt;tt&gt;code&lt;/tt&gt; parameter is not used in the method. Can be removed.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RegionState rs_p = regionStates.getRegionState(p);
	    RegionState rs_a = regionStates.getRegionState(a);
	    RegionState rs_b = regionStates.getRegionState(b);
	    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(rs_p.isOpenOrSplittingOnServer(sn)
	        &amp;amp;&amp;amp; (rs_a == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || rs_a.isOpenOrSplittingNewOnServer(sn))
	        &amp;amp;&amp;amp; (rs_b == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || rs_b.isOpenOrSplittingNewOnServer(sn)))) {
	      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;Not in state good &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; split&quot;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Minor suggestion, can we extract it to a method, same lines of code is used in the &lt;tt&gt;onRegionSplit&lt;/tt&gt; method.&lt;/p&gt;

&lt;p&gt;It will be good if we can add a unit test case for this.&lt;/p&gt;</comment>
                            <comment id="15081291" author="yuzhihong@gmail.com" created="Mon, 4 Jan 2016 15:53:27 +0000"  >&lt;p&gt;Patch v2 addresses refactoring suggestion from Ashish&lt;/p&gt;</comment>
                            <comment id="15081539" author="hadoopqa" created="Mon, 4 Jan 2016 18:31:52 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12780330/15058-branch-1-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12780330/15058-branch-1-v2.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit 00656688f73c85ea9e6f5241ac852f72e774eeea.&lt;br/&gt;
  ATTACHMENT ID: 12780330&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;. The applied patch does not generate new checkstyle errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/17110//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/17110//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/17110//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/17110//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/17110//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/17110//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/17110//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/17110//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15082498" author="chenheng" created="Tue, 5 Jan 2016 06:34:13 +0000"  >&lt;p&gt;LGTM.&lt;br/&gt;
One question:&lt;br/&gt;
Should we need to do the same thing to merge process?&lt;br/&gt;
I notice the quota info updated when state is MERGE_REVERTED,  i think it should be done when state is READY_TO_MERGE like split process, and it also need revert when failed. wdyt?&lt;/p&gt;</comment>
                            <comment id="15082503" author="ashish singhi" created="Tue, 5 Jan 2016 06:38:01 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Should we need to do the same thing to merge process?&lt;br/&gt;
 I notice the quota info updated when state is MERGE_REVERTED, i think it should be done when state is READY_TO_MERGE like split process, and it also need revert when failed. wdyt?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No, it is not required.&lt;br/&gt;
Quota information is updated only on successful merge.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (code == TransitionCode.MERGED &amp;amp;&amp;amp; org.apache.commons.lang.StringUtils.isEmpty(errorMsg)) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          regionStateListener.onRegionMerged(hri);
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException exp) {
          errorMsg = StringUtils.stringifyException(exp);
        }
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15082511" author="chenheng" created="Tue, 5 Jan 2016 06:44:19 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;,  you are right.&lt;/p&gt;</comment>
                            <comment id="15083123" author="yuzhihong@gmail.com" created="Tue, 5 Jan 2016 14:27:19 +0000"  >&lt;p&gt;Thanks for the reviews, Ashish and Heng.&lt;/p&gt;</comment>
                            <comment id="15083177" author="hudson" created="Tue, 5 Jan 2016 15:00:17 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3-IT #420 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/420/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/420/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15058&quot; title=&quot;AssignmentManager should account for unsuccessful split correctly which initially passes quota check&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15058&quot;&gt;&lt;del&gt;HBASE-15058&lt;/del&gt;&lt;/a&gt; AssignmentManager should account for unsuccessful split (tedyu: rev 407cda4a0c4bc1338af175299372a4b1976bb44a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15083245" author="hudson" created="Tue, 5 Jan 2016 15:41:17 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2-IT #378 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/378/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/378/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15058&quot; title=&quot;AssignmentManager should account for unsuccessful split correctly which initially passes quota check&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15058&quot;&gt;&lt;del&gt;HBASE-15058&lt;/del&gt;&lt;/a&gt; AssignmentManager should account for unsuccessful split (tedyu: rev 1fab320d52ac6d0ffcf92fe30a804e8f67c710db)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15083450" author="hudson" created="Tue, 5 Jan 2016 17:45:41 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2 #489 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/489/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/489/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15058&quot; title=&quot;AssignmentManager should account for unsuccessful split correctly which initially passes quota check&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15058&quot;&gt;&lt;del&gt;HBASE-15058&lt;/del&gt;&lt;/a&gt; AssignmentManager should account for unsuccessful split (tedyu: rev 1fab320d52ac6d0ffcf92fe30a804e8f67c710db)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15083526" author="hudson" created="Tue, 5 Jan 2016 18:31:08 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3 #480 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/480/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/480/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15058&quot; title=&quot;AssignmentManager should account for unsuccessful split correctly which initially passes quota check&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15058&quot;&gt;&lt;del&gt;HBASE-15058&lt;/del&gt;&lt;/a&gt; AssignmentManager should account for unsuccessful split (tedyu: rev 407cda4a0c4bc1338af175299372a4b1976bb44a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12780162" name="15058-branch-1-v1.txt" size="2926" author="yuzhihong@gmail.com" created="Thu, 31 Dec 2015 18:40:29 +0000"/>
                            <attachment id="12780330" name="15058-branch-1-v2.txt" size="3399" author="yuzhihong@gmail.com" created="Mon, 4 Jan 2016 15:53:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 31 Dec 2015 03:29:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            49 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qeyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>