<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:58:43 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2070/HBASE-2070.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2070] Collect HLogs and delete them after a period of time</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2070</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;For replication we need to be able to service clusters that are a few hours behind in edits. For example, after distcp&apos;ing a snapshot of the DB to another cluster, we need to make sure we get the edits that came in after the snapshot was taken.&lt;/p&gt;

&lt;p&gt;I plan the following changes:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Instead of deleting HLogs during a log roll or after a log split, move them to another folder where all logs should be aggregated.&lt;/li&gt;
	&lt;li&gt;Add a new configuration for how old a log can be. For a normal cluster I think of a default of 2 hours. For replication you may want to set it much higher.&lt;/li&gt;
	&lt;li&gt;Create a new thread in the master that checks for logs older than configured time and that deletes them.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I also fancy having the deletion time to be configurable while the cluster is running. I&apos;m also thinking of adding a way to tell the cluster to replay edits on itself.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12444139">HBASE-2070</key>
            <summary>Collect HLogs and delete them after a period of time</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12421518">HBASE-1295</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Dec 2009 21:40:55 +0000</created>
                <updated>Fri, 20 Nov 2015 13:01:27 +0000</updated>
                            <resolved>Thu, 18 Feb 2010 00:09:22 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12794294" author="apurtell" created="Thu, 24 Dec 2009 01:31:18 +0000"  >&lt;p&gt;Subtask of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1295&quot; title=&quot;Multi data center replication&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1295&quot;&gt;&lt;del&gt;HBASE-1295&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="12794296" author="jdcryans" created="Thu, 24 Dec 2009 01:35:03 +0000"  >&lt;p&gt;Yes sorry, it&apos;s under 1295.&lt;/p&gt;</comment>
                            <comment id="12795492" author="jdcryans" created="Wed, 30 Dec 2009 23:33:50 +0000"  >&lt;p&gt;First cut. Implements the three bullet points of the case description and works on a pseudo-distributed setup. Probably fails some tests.&lt;/p&gt;</comment>
                            <comment id="12796415" author="jdcryans" created="Mon, 4 Jan 2010 22:57:31 +0000"  >&lt;p&gt;New patch with a new test and it passes all the other tests. Good for a review.&lt;/p&gt;</comment>
                            <comment id="12830245" author="jdcryans" created="Fri, 5 Feb 2010 19:23:37 +0000"  >&lt;p&gt;New patch retargeted on latest trunk. Adds fixes for replication&apos;s HLog.&lt;/p&gt;</comment>
                            <comment id="12831799" author="jdcryans" created="Wed, 10 Feb 2010 01:17:24 +0000"  >&lt;p&gt;Cleaned up patch, just minor nits. I need a review for the core side of the patch.&lt;/p&gt;</comment>
                            <comment id="12833211" author="ryanobjc" created="Fri, 12 Feb 2010 22:41:00 +0000"  >&lt;p&gt;if a replication stream is delayed, we should never delete logfiles unless the disk space situation is critical.  Replication sending clusters should have plenty of disk space to buffer past all foreseeable disconnection operations.  This might mean buffering 5-10TB of edits...&lt;/p&gt;

&lt;p&gt;the alternative is to reset the slave cluster and rebuild from scratch once you lose the sync.  Otherwise you end up with duplicate edits that are not removable.&lt;/p&gt;</comment>
                            <comment id="12833216" author="jdcryans" created="Fri, 12 Feb 2010 22:46:36 +0000"  >&lt;p&gt;@Ryan&lt;/p&gt;

&lt;p&gt;I agree, once this case is solved what you described will be in the scope of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12833986" author="ryanobjc" created="Mon, 15 Feb 2010 21:24:02 +0000"  >&lt;p&gt;this seems like a good first cut, but we should probably be tracking logfiles in ZK.  They are precious materials and really dont want to lose them.&lt;/p&gt;

&lt;p&gt;I think the BT paper in fact says something about keeping logfile status in chubby.&lt;/p&gt;</comment>
                            <comment id="12834419" author="stack" created="Tue, 16 Feb 2010 19:59:28 +0000"  >&lt;p&gt;.bq this seems like a good first cut, but we should probably be tracking logfiles in ZK&lt;/p&gt;

&lt;p&gt;HT does this.  Makes some kinda sense in that who owns them is clear in case of HRS failure.  Master could take ownership before starts splitting them.  We should make a new issue for this (Hopefully we won&apos;t have as many wals going forward with working flush).&lt;/p&gt;

&lt;p&gt;Yeah too to the logs shouldn&apos;t be cleared if replication is down.  Can we put up a gate in zk?&lt;/p&gt;

&lt;p&gt;On the patch:&lt;/p&gt;

&lt;p&gt;Can we change this?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; HREGION_OLDLOGFILE_NAME = &lt;span class=&quot;code-quote&quot;&gt;&quot;oldlogfile.log&quot;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It must be dumbest name ever given a file since the epoch began?  (We should do that in another patch.....another issue).&lt;/p&gt;

&lt;p&gt;Want to make a regex to verify expected file name rather than: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] parts = filePath.getName().split(&lt;span class=&quot;code-quote&quot;&gt;&quot;\\.&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do you have to put a timestamp on it?  Doesn&apos;t HDFS tell you its last-modified time? (There may be caveats to this but IIRC, for something this basic should be fine).&lt;/p&gt;

&lt;p&gt;Otherwise patch looks good to me.&lt;/p&gt;


</comment>
                            <comment id="12834506" author="jdcryans" created="Tue, 16 Feb 2010 22:11:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;We should make a new issue for this&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;Yeah too to the logs shouldn&apos;t be cleared if replication is down. Can we put up a gate in zk?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was planning on doing that in the scope of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2223&quot; title=&quot;Handle 10min+ network partitions between clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2223&quot;&gt;&lt;del&gt;HBASE-2223&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It must be dumbest name ever given a file since the epoch began? (We should do that in another patch.....another issue)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, another issue.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Want to make a regex to verify expected file name rather than:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Will do&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do you have to put a timestamp on it? Doesn&apos;t HDFS tell you its last-modified time? (There may be caveats to this but IIRC, for something this basic should be fine).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I wanted to avoid 2 logs created at the same time having the same name. It can still happen, but the chance is very very low.&lt;/p&gt;

&lt;p&gt;Thanks for the review!&lt;/p&gt;</comment>
                            <comment id="12835062" author="jdcryans" created="Thu, 18 Feb 2010 00:09:22 +0000"  >&lt;p&gt;Committed to trunk with Stack&apos;s comments integrated.&lt;/p&gt;</comment>
                            <comment id="12883363" author="nspiegelberg" created="Tue, 29 Jun 2010 00:13:20 +0000"  >&lt;p&gt;Anyone have a problem with changing the name from oldLogDir/.oldlogs to archiveDir/.logarchive?  This was causing me much confusion when surveying the code for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2312&quot; title=&quot;Possible data loss when RS goes into GC pause while rolling HLog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2312&quot;&gt;&lt;del&gt;HBASE-2312&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12883365" author="jdcryans" created="Tue, 29 Jun 2010 00:23:03 +0000"  >&lt;p&gt;Sure, but we&apos;d need to refactor class names (OldLogCleaner to ArchivedLogCleaner is the first one that comes in mind).&lt;/p&gt;</comment>
                            <comment id="12883605" author="stack" created="Tue, 29 Jun 2010 16:41:36 +0000"  >&lt;p&gt;+1 on changing names &amp;#8211; and names of classes (these are new classes so ok changing their names)&lt;/p&gt;</comment>
                            <comment id="15017805" author="lars_francke" created="Fri, 20 Nov 2015 13:01:27 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12429400" name="HBASE-2070-v2.patch" size="37900" author="jdcryans" created="Mon, 4 Jan 2010 22:57:31 +0000"/>
                            <attachment id="12434993" name="HBASE-2070-v3.patch" size="40139" author="jdcryans" created="Fri, 5 Feb 2010 19:23:37 +0000"/>
                            <attachment id="12435390" name="HBASE-2070-v4.patch" size="40365" author="jdcryans" created="Wed, 10 Feb 2010 01:21:39 +0000"/>
                            <attachment id="12429183" name="HBASE-2070.patch" size="30621" author="jdcryans" created="Wed, 30 Dec 2009 23:33:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Dec 2009 01:31:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32395</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hgbz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99908</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>