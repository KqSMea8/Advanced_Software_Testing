<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:03:53 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9377/HBASE-9377.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9377] Backport HBASE- 9208 &quot;ReplicationLogCleaner slow at large scale&quot;</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9377</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;For &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; to make a  call on.  See end where Dave Latham talks about issues w/ patch in 0.94.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12666066">HBASE-9377</key>
            <summary>Backport HBASE- 9208 &quot;ReplicationLogCleaner slow at large scale&quot;</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Aug 2013 04:30:55 +0000</created>
                <updated>Tue, 24 Sep 2013 20:32:58 +0000</updated>
                            <resolved>Tue, 10 Sep 2013 21:48:54 +0000</resolved>
                                                    <fixVersion>0.94.12</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13760483" author="lhofhansl" created="Fri, 6 Sep 2013 18:25:56 +0000"  >&lt;p&gt;Comment from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davelatham&quot; class=&quot;user-hover&quot; rel=&quot;davelatham&quot;&gt;Dave Latham&lt;/a&gt;:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Perhaps rather than changing FileCleanerDelegate we could introduce a new interface BatchFileCleanerDelegate or some such. Then configured cleaners that implement that interface can use it but others could still work by wrapping them. Anyone agree with that approach or have other suggestions?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It seems that is what we should do.&lt;/p&gt;</comment>
                            <comment id="13760505" author="davelatham" created="Fri, 6 Sep 2013 18:42:49 +0000"  >&lt;p&gt;Sorry, been pulled on to some more urgent work at the moment, so I will try to get back to this within a week or so.  Feel free to punt from 0.94.12.&lt;/p&gt;</comment>
                            <comment id="13762383" author="lhofhansl" created="Mon, 9 Sep 2013 22:21:48 +0000"  >&lt;p&gt;NP. Thanks Dave. If I&apos;ll get time I&apos;ll do it in time for 0.94.12, otherwise I&apos;ll push.&lt;/p&gt;</comment>
                            <comment id="13762489" author="lhofhansl" created="Tue, 10 Sep 2013 00:01:42 +0000"  >&lt;p&gt;on 2nd thought, I would hate to have the APIs different here between 0.94 and 0.96+. So we can&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;introduce BatchFileCleanerDelegate in 0.96+ as well.&lt;/li&gt;
	&lt;li&gt;make this change here (and break clients that wrote their own chores by directly implementing FileCleanerDelegate.&lt;/li&gt;
	&lt;li&gt;do nothing in 0.94&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Presumably this can also happen when the slave cluster is down for a while and many WALs are queued up for replay (that&apos;s a scenario that we would face during upgrades).&lt;br/&gt;
For #2 how likely is it that anybody would have done that? I do not know of anybody.&lt;br/&gt;
Thoughts about #1?&lt;/p&gt;</comment>
                            <comment id="13762531" author="lhofhansl" created="Tue, 10 Sep 2013 00:43:18 +0000"  >&lt;p&gt;And note that this would only be an issue if a client implemented the interface FileCleanerDelegate directly, rather than extending Base{HFile|Log}CleanerDelegate.&lt;br/&gt;
I would propose a slightly different patch where ReplicationLogCleaner extends BaseConfigurable and implements FileCleanerDelegate. That way BaseLogCleanerDelegate is unchanged except for extending a different class.&lt;/p&gt;</comment>
                            <comment id="13762538" author="lhofhansl" created="Tue, 10 Sep 2013 00:53:45 +0000"  >&lt;p&gt;Like this. I&apos;d be OK committing this is according release notes.&lt;/p&gt;</comment>
                            <comment id="13762539" author="lhofhansl" created="Tue, 10 Sep 2013 00:54:20 +0000"  >&lt;p&gt;Sample release notes.&lt;/p&gt;</comment>
                            <comment id="13762740" author="lhofhansl" created="Tue, 10 Sep 2013 05:17:27 +0000"  >&lt;p&gt;Actually. All the involved classes and interface and marked with InterfaceAudience.private. So we can just change them anyway.&lt;/p&gt;

&lt;p&gt;Please let me know if anybody has any objections to my slightly modified patch.&lt;/p&gt;</comment>
                            <comment id="13763169" author="davelatham" created="Tue, 10 Sep 2013 16:20:47 +0000"  >&lt;p&gt;Didn&apos;t notice the InterfaceAudience.private.  With that, I agree with #2.&lt;/p&gt;

&lt;p&gt;For your modified patch, it means that not all included log cleaners extend the BaseLogCleanerDelegate.  If you like that better than supplying a default implementation for BaseLogCleanerDelegate.isLogDeletable, it doesn&apos;t make much difference to me.&lt;br/&gt;
+0&lt;/p&gt;

&lt;p&gt;It does look like the patch is missing BaseFileCleanerDelegate.java though.&lt;/p&gt;

&lt;p&gt;Thanks, Lars, for pushing on it.&lt;/p&gt;</comment>
                            <comment id="13763321" author="lhofhansl" created="Tue, 10 Sep 2013 18:19:22 +0000"  >&lt;p&gt;I do not feel strongly. Also happy to commit your initial 0.94 patch.&lt;/p&gt;</comment>
                            <comment id="13763327" author="lhofhansl" created="Tue, 10 Sep 2013 18:25:14 +0000"  >&lt;p&gt;Ok... If there are no objections, I&apos;ll commit this (Dave&apos;s initial patch actually).&lt;/p&gt;</comment>
                            <comment id="13763333" author="davelatham" created="Tue, 10 Sep 2013 18:30:30 +0000"  >&lt;p&gt;If you want me to choose, I&apos;d say stick with the my patch just because it already went in like that for 0.96, but if you like it the other way, I&apos;m happy too.&lt;/p&gt;</comment>
                            <comment id="13763336" author="davelatham" created="Tue, 10 Sep 2013 18:31:42 +0000"  >&lt;p&gt;(By initial patch, you mean &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9208&quot; title=&quot;ReplicationLogCleaner slow at large scale&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9208&quot;&gt;&lt;del&gt;HBASE-9208&lt;/del&gt;&lt;/a&gt;-0.94-v2.patch - correct?)&lt;/p&gt;</comment>
                            <comment id="13763496" author="lhofhansl" created="Tue, 10 Sep 2013 20:49:29 +0000"  >&lt;p&gt;Yep. That one &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13763564" author="lhofhansl" created="Tue, 10 Sep 2013 21:48:54 +0000"  >&lt;p&gt;Committed to 0.94. Thanks again for the patch, Dave.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12663509">HBASE-9208</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12602244" name="9377.txt" size="24445" author="lhofhansl" created="Tue, 10 Sep 2013 00:53:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 Sep 2013 18:25:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346005</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 14 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1nnzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>346306</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>The FileCleanerDelegate interface is changed. External classes that directly used to implement that interface have to be changed. Classes that extend BaseHFileCleanerDelegate or BaseLogCleanerDelegate only have to be recompiled.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>