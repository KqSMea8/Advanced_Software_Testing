<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:57:49 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8711/HBASE-8711.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8711] Requests count is completely off</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8711</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I tried 0.95.1 RC1 in standalone, and the requests count in both the master and RS web UIs are wrong. I haven&apos;t dug too much in but it seems too low when I&apos;m sending load, and it takes &amp;gt;10 seconds to clear up when the cluster becomes completely idle.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12651815">HBASE-8711</key>
            <summary>Requests count is completely off</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jrkinley">James Kinley</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Jun 2013 22:18:24 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:29 +0000</updated>
                            <resolved>Fri, 27 Sep 2013 00:04:31 +0000</resolved>
                                    <version>0.95.1</version>
                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.96.0</fixVersion>
                                    <component>UI</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13736812" author="jrkinley" created="Mon, 12 Aug 2013 12:37:42 +0000"  >&lt;p&gt;Hey Elliott. Are you working on this at the moment? If not, I was going to take a look if thats ok with you?&lt;/p&gt;</comment>
                            <comment id="13736987" author="eclark" created="Mon, 12 Aug 2013 16:09:08 +0000"  >&lt;p&gt;That would be great.  Unfortunately this has fallen off my plate lately.&lt;/p&gt;</comment>
                            <comment id="13777370" author="jrkinley" created="Wed, 25 Sep 2013 11:36:14 +0000"  >
&lt;p&gt;There are a couple of things going on here. The first issue is that the point in time metrics for a region server are only computed every 15 seconds and therefore requestsPerSecond is actually an average for the previous interval:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
requestsPerSecond = (numberRequestsSinceLastRun / secondsSinceLastRun)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The client write buffer also confuses things because the writes are delayed reaching the server, then the server can take up to 15 seconds to include them in the metrics, and another 15 seconds to clear them down.&lt;/p&gt;

&lt;p&gt;The second issue is that the requestCount counter used to compute requestsPerSecond is incremented for every region server operation (i.e. including requests for region info and not just for mutations) and is therefore higher than expected.&lt;/p&gt;

&lt;p&gt;I&apos;ve attached the results of two tests to show whats happening. The same client was used in both tests to generate 100 req/sec for 60 seconds (6000 writes):&lt;/p&gt;

&lt;p&gt;In the first test (RPS-TEST-1.log) the client write buffer was enabled and you can see that it took 52 seconds before the writes appeared in the metrics, and because they were all sent at once requestsPerSecond was skewed at 09:07:28 (requestsPerSecond: 602.7862951606452). It took a further 30 seconds before requestsPerSecond returned to 0. Also, writeRequestsCount was only incremented once for each flush, and the individual writes were not counted (tempWriteRequestsCount = 4).&lt;/p&gt;

&lt;p&gt;In the second test (RPS-TEST-2.log) the client write buffer was disabled and you can see that the writes started to appear in the metrics after the next metric computation was run (15 seconds), and requestsPerSecond hovered at ~170 for the duration of the test. The writes were also counted individually (tempWriteRequestsCount = 6004).&lt;/p&gt;

&lt;p&gt;Both tests show an increase of over 12000 requests for 6000 writes.&lt;/p&gt;

&lt;p&gt;Computing requestsPerSecond from the requestCount counter makes sense, but the interval should at least be configurable and be lower by default (maybe 5 seconds).&lt;/p&gt;</comment>
                            <comment id="13777665" author="jrkinley" created="Wed, 25 Sep 2013 15:56:42 +0000"  >&lt;p&gt;Attached patch to make regionserver metric period configurable, and to lower the default period to 5 seconds.&lt;/p&gt;</comment>
                            <comment id="13779468" author="eclark" created="Thu, 26 Sep 2013 23:58:47 +0000"  >&lt;p&gt;+1 lgtm&lt;/p&gt;</comment>
                            <comment id="13779469" author="jdcryans" created="Fri, 27 Sep 2013 00:04:31 +0000"  >&lt;p&gt;Thanks James, committed to branch and trunk.&lt;/p&gt;</comment>
                            <comment id="13779640" author="hudson" created="Fri, 27 Sep 2013 04:12:56 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.96 #100 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/100/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/100/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8711&quot; title=&quot;Requests count is completely off&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8711&quot;&gt;&lt;del&gt;HBASE-8711&lt;/del&gt;&lt;/a&gt; Requests count is completely off (jdcryans: rev 1526753)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-common/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionServerWrapperImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13779651" author="hudson" created="Fri, 27 Sep 2013 04:31:34 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #4567 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4567/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4567/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8711&quot; title=&quot;Requests count is completely off&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8711&quot;&gt;&lt;del&gt;HBASE-8711&lt;/del&gt;&lt;/a&gt; Requests count is completely off (James Kinley via JD) (jdcryans: rev 1526754)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-common/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionServerWrapperImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13779874" author="hudson" created="Fri, 27 Sep 2013 12:20:33 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.96-hadoop2 #61 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96-hadoop2/61/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96-hadoop2/61/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8711&quot; title=&quot;Requests count is completely off&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8711&quot;&gt;&lt;del&gt;HBASE-8711&lt;/del&gt;&lt;/a&gt; Requests count is completely off (jdcryans: rev 1526753)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-common/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionServerWrapperImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13779918" author="hudson" created="Fri, 27 Sep 2013 13:23:52 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #765 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/765/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/765/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8711&quot; title=&quot;Requests count is completely off&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8711&quot;&gt;&lt;del&gt;HBASE-8711&lt;/del&gt;&lt;/a&gt; Requests count is completely off (James Kinley via JD) (jdcryans: rev 1526754)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-common/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionServerWrapperImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15016238" author="lars_francke" created="Fri, 20 Nov 2015 11:54:29 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12670510">HBASE-9656</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12605026" name="HBASE-8711-1.patch" size="4349" author="jrkinley" created="Wed, 25 Sep 2013 15:56:42 +0000"/>
                            <attachment id="12604998" name="RPS-TEST-1.log" size="5334" author="jrkinley" created="Wed, 25 Sep 2013 11:39:19 +0000"/>
                            <attachment id="12604997" name="RPS-TEST-2.log" size="5308" author="jrkinley" created="Wed, 25 Sep 2013 11:39:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 12 Aug 2013 12:37:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332140</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1laqv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332469</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>hbase.regionserver.metrics.period can now be used to configure how often the RS metrics are computed. Defaults to 5, was 15 before this patch.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>