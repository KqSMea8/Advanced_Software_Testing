<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:47:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7632/HBASE-7632.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7632] fail to create ReplicationSource if ReplicationPeer.startStateTracker checkExists(peerStateNode) and find not exist but fails in createAndWatch due to client/shell is done creating it then, now throws exception and results in addPeer fail</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7632</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;fail to create ReplicationSource if ReplicationPeer.startStateTracker checkExists(peerStateNode) and find not exist but fails in createAndWatch due to client/shell is done creating it then, now throws exception and results in addPeer fail&lt;/p&gt;</description>
                <environment></environment>
        <key id="12628508">HBASE-7632</key>
            <summary>fail to create ReplicationSource if ReplicationPeer.startStateTracker checkExists(peerStateNode) and find not exist but fails in createAndWatch due to client/shell is done creating it then, now throws exception and results in addPeer fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fenghh">Honghua Feng</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Jan 2013 03:56:27 +0000</created>
                <updated>Wed, 10 Jul 2013 23:10:27 +0000</updated>
                            <resolved>Wed, 10 Jul 2013 23:10:27 +0000</resolved>
                                    <version>0.94.2</version>
                    <version>0.94.3</version>
                    <version>0.94.4</version>
                                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <timeoriginalestimate seconds="172800">48h</timeoriginalestimate>
                            <timeestimate seconds="172800">48h</timeestimate>
                                        <comments>
                            <comment id="13558511" author="fenghh" created="Mon, 21 Jan 2013 03:56:56 +0000"  >&lt;p&gt;attach the call stack:&lt;/p&gt;

&lt;p&gt;2013-01-10 09:22:03,084 ERROR org.apache.hadoop.hbase.zookeeper.RecoverableZooKeeper: Node /hbase/sdtst-miliao/replication/peers/34/peer-state already exists and this is not a retry&lt;br/&gt;
2013-01-10 09:22:03,084 ERROR org.apache.hadoop.hbase.replication.regionserver.ReplicationSourceManager: Error while adding a new peer&lt;br/&gt;
org.apache.zookeeper.KeeperException$NodeExistsException: KeeperErrorCode = NodeExists for /hbase/sdtst-miliao/replication/peers/34/peer-state&lt;br/&gt;
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:119)&lt;br/&gt;
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:51)&lt;br/&gt;
        at org.apache.zookeeper.ZooKeeper.create(ZooKeeper.java:778)&lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.RecoverableZooKeeper.createNonSequential(RecoverableZooKeeper.java:420)&lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.RecoverableZooKeeper.create(RecoverableZooKeeper.java:402)&lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZKUtil.createAndWatch(ZKUtil.java:852)&lt;br/&gt;
        at org.apache.hadoop.hbase.replication.ReplicationPeer.startStateTracker(ReplicationPeer.java:82)&lt;br/&gt;
        at org.apache.hadoop.hbase.replication.ReplicationZookeeper.getPeer(ReplicationZookeeper.java:344)&lt;br/&gt;
        at org.apache.hadoop.hbase.replication.ReplicationZookeeper.connectToPeer(ReplicationZookeeper.java:307)&lt;br/&gt;
        at org.apache.hadoop.hbase.replication.regionserver.ReplicationSourceManager$PeersWatcher.nodeChildrenChanged(ReplicationSourceManager.java:511)&lt;br/&gt;
        at org.apache.hadoop.hbase.zookeeper.ZooKeeperWatcher.process(ZooKeeperWatcher.java:316)&lt;br/&gt;
        at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:519)&lt;/p&gt;</comment>
                            <comment id="13558517" author="fenghh" created="Mon, 21 Jan 2013 04:06:36 +0000"  >&lt;p&gt;The root cause is when client/shell add_peer, it first creates the peerNode, and then creates the peerStateNode; but RS receives the peerNode change event and begins to addPeer accordingly, this occurs after client/shell creates peerNode but before creating peerStateNode; RS&apos;s connectToPeer will listen on peerStateNode, which will create the peerStateNode if find the peerStateNode not exists. since client/shell and RS are two different process, RS&apos;s &quot;check and create&quot; can succeed in check phase, but may fail in create phase due to client/shell is done creating peerStateNode. no exclusive mechanism can be used to make RS&apos; &quot;check and create&quot; atomic.&lt;br/&gt;
Such bug can be avoided if we merge peerState info into the peerNode, when RS addPeer for a newly added peerNode, the peerState info can be read from the peerNode, no above &quot;check and create&quot; problem.&lt;/p&gt;</comment>
                            <comment id="13651504" author="jdcryans" created="Wed, 8 May 2013 00:48:00 +0000"  >&lt;p&gt;I think we need this for 0.95.1&lt;/p&gt;</comment>
                            <comment id="13705217" author="jdcryans" created="Wed, 10 Jul 2013 23:10:27 +0000"  >&lt;p&gt;This was actually fixed before this jira was opened by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=v.himanshu&quot; class=&quot;user-hover&quot; rel=&quot;v.himanshu&quot;&gt;Himanshu Vashishtha&lt;/a&gt; in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7440&quot; title=&quot;ReplicationZookeeper#addPeer is racy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7440&quot;&gt;&lt;del&gt;HBASE-7440&lt;/del&gt;&lt;/a&gt;, closing as dup.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 May 2013 00:48:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>306406</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i19mgf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>264272</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Replication</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>