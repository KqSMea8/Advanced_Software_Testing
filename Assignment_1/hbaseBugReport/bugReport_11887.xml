<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:27:36 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11887/HBASE-11887.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11887] Memory retention in branch-1; millions of instances of LiteralByteString for column qualifier and value</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11887</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Trying to test branch-1, I run out of mem pretty fast.  Looking at dumps, I see too many instances of LiteralByteString.  Seem to be &apos;qualifiers&apos; and &apos;values&apos; out of pb QualifierValue... and on up to the multi call into the server. Am having trouble finding how the retention is being done... Filing issue in meantime while work on it.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12738734">HBASE-11887</key>
            <summary>Memory retention in branch-1; millions of instances of LiteralByteString for column qualifier and value</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Sep 2014 07:48:46 +0000</created>
                <updated>Sat, 21 Feb 2015 23:32:27 +0000</updated>
                            <resolved>Wed, 3 Sep 2014 21:22:50 +0000</resolved>
                                    <version>0.99.0</version>
                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.98.6</fixVersion>
                                    <component>Protobufs</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="14120117" author="stack" created="Wed, 3 Sep 2014 17:27:03 +0000"  >&lt;p&gt;Here is what it looks like.  This is small heap.  Has 20M references to qualifer/value after running a relatively short time.&lt;/p&gt;</comment>
                            <comment id="14120135" author="stack" created="Wed, 3 Sep 2014 17:37:23 +0000"  >&lt;p&gt;This seems to help.  BoundedPriorityBlockingQueue has all handlers which user CallRunners.  The CallRunners hold on to Calls after they are done.  All handlers can be holding on to big ycsb puts.  With this in place, I run much longer.  Heap character is completely different now.  Let me dig more.  This is a branch-1/master only issue (redo of rpc priority).&lt;/p&gt;</comment>
                            <comment id="14120191" author="enis" created="Wed, 3 Sep 2014 18:18:54 +0000"  >&lt;p&gt;nice one. Raising this to critical. &lt;/p&gt;</comment>
                            <comment id="14120406" author="enis" created="Wed, 3 Sep 2014 20:40:57 +0000"  >&lt;p&gt;+1 on patch if no other findings. &lt;/p&gt;</comment>
                            <comment id="14120466" author="stack" created="Wed, 3 Sep 2014 21:13:04 +0000"  >&lt;p&gt;OK. Let me commit. Its been running this last few hours w/o a full GC. I have it set so a full GC kills the RS using below configs:&lt;/p&gt;

&lt;p&gt;export SERVER_GC_OPTS=&quot;-verbose:gc -XX:PrintFLSStatistics=1 -XX:+PrintGCDetails -XX:+PrintGCDateStamps -XX:+HeapDumpBeforeFullGC -XX:HeapDumpPath=/data/1/ -XX:+CMSDumpAtPromotionFailure -XX:+HeapDumpAfterFullGC -XX:+PrintTenuringDistribution -XX:+PrintGCApplicationConcurrentTime -XX:+PrintGCApplicationStoppedTime&quot;&lt;/p&gt;

&lt;p&gt;It used to run out of road &amp;#8211; full GC &amp;#8211; after 5 minutes or so.&lt;/p&gt;</comment>
                            <comment id="14120473" author="stack" created="Wed, 3 Sep 2014 21:17:53 +0000"  >&lt;p&gt;jmap -histo:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 num     #instances         #bytes  class name
----------------------------------------------
   1:       3069883      780472352  [B
   2:       3501587      112050784  org.apache.hadoop.hbase.KeyValue
   3:       3441167       82588008  java.util.concurrent.ConcurrentSkipListMap$Node
   4:       1077906       68985984  org.apache.hadoop.hbase.protobuf.generated.ClientProtos$MutationProto$ColumnValue$QualifierValue
   5:       2372963       56951112  com.google.protobuf.LiteralByteString
   6:       1720444       41290656  java.util.concurrent.ConcurrentSkipListMap$Index
   7:          7024       18547960  [I
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;.... shows QualifierValue at 1/10th of that the numbers used be with no mention of the LiteralByteString which used to have near equal pegging with [B instances.  Let me commit then since it makes branch-1 YCSB-able (Previous it was not).  Will be back to try and make more improvements but this is enough for one issue.&lt;/p&gt;</comment>
                            <comment id="14120483" author="stack" created="Wed, 3 Sep 2014 21:22:50 +0000"  >&lt;p&gt;Applied to 0.98+. 0.98 doesn&apos;t seem to need it but going by what it does in branch-1, probably no harm letting go of these references so they get cleaned up early and maybe less-likely promoted (hope that ok &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="14120512" author="apurtell" created="Wed, 3 Sep 2014 21:39:46 +0000"  >&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                            <comment id="14120612" author="hudson" created="Wed, 3 Sep 2014 22:42:16 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5463 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5463/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5463/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11887&quot; title=&quot;Memory retention in branch-1; millions of instances of LiteralByteString for column qualifier and value&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11887&quot;&gt;&lt;del&gt;HBASE-11887&lt;/del&gt;&lt;/a&gt; Memory retention in branch-1; millions of instances of LiteralByteString for column qualifier and value (stack: rev 11ba6ac7c9bc795958e3c614b6f012b37f1917f2)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/CallRunner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14120653" author="hudson" created="Wed, 3 Sep 2014 23:14:37 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #495 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/495/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/495/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11887&quot; title=&quot;Memory retention in branch-1; millions of instances of LiteralByteString for column qualifier and value&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11887&quot;&gt;&lt;del&gt;HBASE-11887&lt;/del&gt;&lt;/a&gt; Memory retention in branch-1; millions of instances of LiteralByteString for column qualifier and value (stack: rev da3ce2c5e8f0b612da922a9003f6ce8527f6f131)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/CallRunner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14120710" author="hudson" created="Wed, 3 Sep 2014 23:52:19 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #149 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/149/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/149/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11887&quot; title=&quot;Memory retention in branch-1; millions of instances of LiteralByteString for column qualifier and value&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11887&quot;&gt;&lt;del&gt;HBASE-11887&lt;/del&gt;&lt;/a&gt; Memory retention in branch-1; millions of instances of LiteralByteString for column qualifier and value (stack: rev 9d9d206d2151c193d6156cb7b7dc4fa6b0fdfbb8)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/CallRunner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14120772" author="hudson" created="Thu, 4 Sep 2014 00:46:22 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98-on-Hadoop-1.1 #468 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/468/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/468/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11887&quot; title=&quot;Memory retention in branch-1; millions of instances of LiteralByteString for column qualifier and value&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11887&quot;&gt;&lt;del&gt;HBASE-11887&lt;/del&gt;&lt;/a&gt; Memory retention in branch-1; millions of instances of LiteralByteString for column qualifier and value (stack: rev da3ce2c5e8f0b612da922a9003f6ce8527f6f131)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/CallRunner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14330962" author="enis" created="Sat, 21 Feb 2015 23:32:27 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12666269" name="11887.txt" size="1315" author="stack" created="Wed, 3 Sep 2014 17:37:23 +0000"/>
                            <attachment id="12666264" name="Screen Shot 2014-09-03 at 10.18.58 AM.png" size="38588" author="stack" created="Wed, 3 Sep 2014 17:27:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 3 Sep 2014 18:18:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zm87:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>