<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:14:49 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-16504/HBASE-16504.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-16504] Replication is not preserving the timestamp of the cell</title>
                <link>https://issues.apache.org/jira/browse/HBASE-16504</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The Replication procedure in ReplicationSink.replicateEntries() method is not preserving the timestamp of the cell. &lt;/p&gt;

&lt;p&gt;Pointer to the code:&lt;br/&gt;
m = CellUtil.isDelete(cell) ? new Delete(cell.getRowArray(), cell.getRowOffset(),cell.getRowLength()) : new Put(cell.getRowArray(), cell.getRowOffset(),cell.getRowLength());&lt;/p&gt;

&lt;p&gt;The Put and Delete constructors called here assign the timestamp with HConstants.LATEST_TIMESTAMP. Instead we need to keep the timestamp of the cell here.&lt;/p&gt;

&lt;p&gt;Also there doesn&apos;t seem to be a test which checks if replication is preserving the timestamp. &lt;/p&gt;

</description>
                <environment></environment>
        <key id="13000190">HBASE-16504</key>
            <summary>Replication is not preserving the timestamp of the cell</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="saitejar">Sai Teja Ranuva</assignee>
                                    <reporter username="saitejar">Sai Teja Ranuva</reporter>
                        <labels>
                            <label>question</label>
                            <label>replication</label>
                    </labels>
                <created>Thu, 25 Aug 2016 21:55:03 +0000</created>
                <updated>Fri, 26 Aug 2016 18:05:04 +0000</updated>
                            <resolved>Fri, 26 Aug 2016 06:13:00 +0000</resolved>
                                                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="15438363" author="yangzhe1991" created="Fri, 26 Aug 2016 02:49:40 +0000"  >&lt;p&gt;Hi&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (CellUtil.isDelete(cell)) {
  ((Delete) m).addDeleteMarker(cell);
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
  ((Put) m).add(cell);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think we keep the ts here?&lt;/p&gt;</comment>
                            <comment id="15438458" author="saitejar" created="Fri, 26 Aug 2016 04:40:22 +0000"  >&lt;p&gt;Hi Phil&lt;/p&gt;

&lt;p&gt;I ran debugger to check if the timestamp changes after running through the code you mentioned.&lt;br/&gt;
The timestamp remains the same(i.e HConstants.LATEST_TIMESTAMP). Most probably even the above code is not copying the timestamp from the cell.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Sai&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15438469" author="yangzhe1991" created="Fri, 26 Aug 2016 05:18:01 +0000"  >&lt;p&gt;We can set different ts in different Cells in one Put, so the ts of Put doesn&apos;t matter. The correct ts is in the cell list of familyMap&lt;/p&gt;</comment>
                            <comment id="15438511" author="saitejar" created="Fri, 26 Aug 2016 05:52:58 +0000"  >&lt;p&gt;Okay.. I think I got your point.&lt;br/&gt;
So, what is the purpose of the Put timestamp ?&lt;/p&gt;</comment>
                            <comment id="15438514" author="yangzhe1991" created="Fri, 26 Aug 2016 05:57:06 +0000"  >&lt;p&gt;See the code of Put#addColumn(byte [] family, byte [] qualifier, byte [] value). If we do not set ts in cell level, we will use the ts of Put. And if it is LATEST_TIMESTAMP, we will use the server&apos;s currentTime&lt;/p&gt;</comment>
                            <comment id="15438520" author="saitejar" created="Fri, 26 Aug 2016 06:05:32 +0000"  >&lt;p&gt;Thanks Phil, I think everything makes more sense to me now.&lt;br/&gt;
For the case of replication, the cells will already have a timestamp set, so the put timestamp is of no use. &lt;/p&gt;</comment>
                            <comment id="15438524" author="saitejar" created="Fri, 26 Aug 2016 06:13:00 +0000"  >&lt;p&gt;The timestamp of the mutation is not useful as the cells already have their timestamp set at the time of replication. &lt;/p&gt;

&lt;p&gt;In detail:&lt;br/&gt;
Normally, if the cells do not have their timestamp set, put/delete timestamp is used instead, when it is LATEST_TIMESTAMP, server time is used. &lt;br/&gt;
This flow doesn&apos;t happen in case of replication, as we need not look outside of the cell to get timestamp. &lt;/p&gt;
</comment>
                            <comment id="15438739" author="enis" created="Fri, 26 Aug 2016 09:57:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also there doesn&apos;t seem to be a test which checks if replication is preserving the timestamp.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Worth adding a test case for this? &lt;/p&gt;</comment>
                            <comment id="15438852" author="stack" created="Fri, 26 Aug 2016 12:09:11 +0000"  >&lt;p&gt;Yeah. File a new issue?&lt;/p&gt;</comment>
                            <comment id="15439481" author="saitejar" created="Fri, 26 Aug 2016 18:04:53 +0000"  >&lt;p&gt;By preserving the timestamp, I meant the put timestamp during replication.&lt;br/&gt;
But it looks like it is not used/useful anywhere. &lt;/p&gt;

&lt;p&gt;There is already a check for the cell timestamps(i.e complete replicated cell is matched, so all dimensions are taken care).&lt;/p&gt;

&lt;p&gt;If we plan to carry forward the put timestamp during replication too, then we need to add a test case to check it.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 26 Aug 2016 02:49:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32tdb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>