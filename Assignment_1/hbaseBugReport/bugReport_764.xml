<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:47:18 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-764/HBASE-764.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-764] The name of column request has padding zero using REST interface</title>
                <link>https://issues.apache.org/jira/browse/HBASE-764</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Today when i play with the REST interface and found the column POST/PUT/GET has a problem.&lt;br/&gt;
When i use the hbase shell to check the data, i found the row name has the padding zero.&lt;/p&gt;

&lt;p&gt;The cause is that TableHandler use Text class to encode the string to the UTF-8. But CharSetEncoder&lt;br/&gt;
will pre-allocate more spaces then the length of String for performance. So we get the padding zero&lt;br/&gt;
when inserting the value to the table.  The fix is to get the String instead of the byte[] for the BatchUpdate.&lt;/p&gt;

&lt;p&gt;Below is the patch.  Also, the patch includes fixing the wrong use of (bytes[]).toString() using Bytes.toString(byte[])&lt;/p&gt;


&lt;p&gt;Index: src/java/org/apache/hadoop/hbase/rest/TableHandler.java&lt;br/&gt;
===================================================================&lt;br/&gt;
&amp;#8212; src/java/org/apache/hadoop/hbase/rest/TableHandler.java    (revision 678664)&lt;br/&gt;
+++ src/java/org/apache/hadoop/hbase/rest/TableHandler.java    (working copy)&lt;br/&gt;
@@ -174,7 +174,7 @@&lt;/p&gt;

&lt;p&gt;         // copy over those cells with requested column names&lt;br/&gt;
         for(byte [] current_column: columns_retrieved) {&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if(requested_columns_set.contains(current_column.toString()))
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+          if(requested_columns_set.contains(Bytes.toString(current_column))){
             m.put(current_column, prefiltered_result.get(current_column));           
           }         }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;@@ -295,7 +295,7 @@&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     try{&lt;br/&gt;
       // start an update&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Text key = new Text(row);&lt;br/&gt;
+      String key = new Text(row).toString();&lt;br/&gt;
       batchUpdate = timestamp == null ?&lt;br/&gt;
         new BatchUpdate(key) : new BatchUpdate(key, Long.parseLong(timestamp));&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;@@ -308,7 +308,7 @@&lt;/p&gt;

&lt;p&gt;         // extract the name and value children&lt;br/&gt;
         Node name_node = column.getElementsByTagName(&quot;name&quot;).item(0);&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Text name = new Text(name_node.getFirstChild().getNodeValue());&lt;br/&gt;
+        String name = new Text(name_node.getFirstChild().getNodeValue()).toString();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;         Node value_node = column.getElementsByTagName(&quot;value&quot;).item(0);&lt;/p&gt;

&lt;p&gt;@@ -356,7 +356,7 @@&lt;br/&gt;
           XMLOutputter outputter = getXMLOutputter(response.getWriter());&lt;br/&gt;
           outputter.startTag(&quot;regions&quot;);&lt;br/&gt;
           for (int i = 0; i &amp;lt; startKeys.length; i++) &lt;/p&gt;
{
-            doElement(outputter, &quot;region&quot;, startKeys[i].toString());
+            doElement(outputter, &quot;region&quot;, Bytes.toString(startKeys[i]));
           }
&lt;p&gt;           outputter.endTag();&lt;br/&gt;
           outputter.endDocument();&lt;br/&gt;
@@ -368,7 +368,7 @@&lt;br/&gt;
           PrintWriter out = response.getWriter();&lt;br/&gt;
           for (int i = 0; i &amp;lt; startKeys.length; i++) &lt;/p&gt;
{
             // TODO: Add in the server location.  Is it needed?
-            out.print(startKeys[i].toString());
+            out.print(Bytes.toString(startKeys[i]));
           }
&lt;p&gt;           out.close();&lt;br/&gt;
         break;&lt;br/&gt;
@@ -454,7 +454,7 @@&lt;br/&gt;
     // pull the row key out of the path&lt;br/&gt;
     String row = URLDecoder.decode(pathSegments&lt;span class=&quot;error&quot;&gt;&amp;#91;2&amp;#93;&lt;/span&gt;, HConstants.UTF8_ENCODING);&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Text key = new Text(row);&lt;br/&gt;
+    String key = new Text(row).toString();&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;     String[] columns = request.getParameterValues(COLUMN);&lt;/p&gt;

&lt;p&gt;@@ -472,7 +472,7 @@&lt;br/&gt;
       } else{&lt;br/&gt;
         // delete each column in turn     &lt;br/&gt;
         for(int i = 0; i &amp;lt; columns.length; i++)&lt;/p&gt;
{
-          table.deleteAll(key, new Text(columns[i]));
+          table.deleteAll(key, new Text(columns[i]).toString());
         }
&lt;p&gt;       }&lt;br/&gt;
       response.setStatus(202);&lt;/p&gt;</description>
                <environment>&lt;p&gt;Debian GNU/Linux,  Java5&lt;/p&gt;</environment>
        <key id="12400794">HBASE-764</key>
            <summary>The name of column request has padding zero using REST interface</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sishen">sishen.freecity</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Jul 2008 06:13:59 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:20 +0000</updated>
                            <resolved>Wed, 23 Jul 2008 17:52:29 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                    <component>REST</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                    <timeoriginalestimate seconds="1800">0.5h</timeoriginalestimate>
                            <timeestimate seconds="1800">0.5h</timeestimate>
                                        <comments>
                            <comment id="12616169" author="stack" created="Wed, 23 Jul 2008 17:22:26 +0000"  >&lt;p&gt;Sishen:&lt;/p&gt;

&lt;p&gt;I edited your patch to remove going String -&amp;gt; Text -&amp;gt; toString.  Please review/try it.  If its OK with you, +1 it and I&apos;ll commit it.&lt;/p&gt;

&lt;p&gt;I&apos;d like to get these REST fixes into the 0.2.0 second release candidate if possible.   Thanks.&lt;/p&gt;</comment>
                            <comment id="12616176" author="sishen" created="Wed, 23 Jul 2008 17:40:25 +0000"  >&lt;p&gt;Hi, stack.&lt;/p&gt;

&lt;p&gt;It works for me. Actually it&apos;s was my first version of patch. &lt;br/&gt;
I just don&apos;t want why the author using the Text instead of String directly. Maybe his reason is to use UTF8 string in the hbase. So i use String -&amp;gt; Text -&amp;gt; toString.  Is UTF8 the default charset?  &lt;/p&gt;

&lt;p&gt;I&apos;d like to see the REST interface work with HBase. It&apos;s better for the integration with other languages. Thanks for all your hard work.&lt;/p&gt;</comment>
                            <comment id="12616183" author="stack" created="Wed, 23 Jul 2008 17:52:29 +0000"  >&lt;p&gt;Committed.  Thanks for the patch Sishen.&lt;/p&gt;

&lt;p&gt;I think the Text stuff is just left-over from the days when hbase was all Text (now its all byte arrays).  Regards encoding, when you pass a String into BatchUpdate, it&apos;ll do getBytes(&quot;UTF-8&quot;) on the passed String so yes, default is UTF-8 everything.  If you want to do another encoding, you could manage the String.getBytes yourself passing an alternate encoding.&lt;/p&gt;

&lt;p&gt;Keep banging on the REST.  There may be more lurkers in there yet, stuff that hasn&apos;t been updated to match the new all-byte-arrays-all-the-time regime.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12386736" name="rest_column-v2.patch" size="2755" author="stack" created="Wed, 23 Jul 2008 17:22:26 +0000"/>
                            <attachment id="12386687" name="rest_column.patch" size="2697" author="sishen" created="Wed, 23 Jul 2008 06:16:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Jul 2008 17:22:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25386</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 22 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h9b3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98770</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>