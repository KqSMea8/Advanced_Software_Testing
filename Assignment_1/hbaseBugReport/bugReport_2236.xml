<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:00:10 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2236/HBASE-2236.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2236] Upper bound of outstanding WALs can be overrun; take 2 (take 1 was hbase-2053)</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2236</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;So hbase-2053 is not aggressive enough.  WALs can still overwhelm the upper limit on log count.  While the code added by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2053&quot; title=&quot;Upper bound of outstanding WALs can be overrun&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2053&quot;&gt;&lt;del&gt;HBASE-2053&lt;/del&gt;&lt;/a&gt;, when done, will ensure we let go of the oldest WAL, to do it, we might have to flush many regions.  E.g:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-02-15 14:20:29,351 INFO org.apache.hadoop.hbase.regionserver.HLog: Too many hlogs: logs=45, maxlogs=32; forcing flush of 5 regions(s): test1,193717,1266095474624, test1,194375,1266108228663, test1,195690,1266095539377, test1,196348,1266095539377, test1,197939,1266069173999
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This takes time.  If we are taking on edits a furious rate, we might have rolled the log again, meantime, maybe more than once.&lt;/p&gt;

&lt;p&gt;Also log rolls happen inline with a put/delete as soon as it hits the 64MB (default) boundary whereas the necessary flushing is done in background by a single thread and the memstore can overrun the (default) 64MB size.  Flushes needed to release logs will be mixed in with &quot;natural&quot; flushes as memstores fill.  Flushes may take longer than the writing of an HLog because they can be larger.&lt;/p&gt;

&lt;p&gt;So, on an RS that is struggling the tendency would seem to be for a slight rise in WALs.  Only if the RS gets a breather will the flusher catch up.&lt;/p&gt;

&lt;p&gt;If &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2087&quot; title=&quot;The wait on compaction because &amp;quot;Too many store files&amp;quot; holds up all flushing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2087&quot;&gt;&lt;del&gt;HBASE-2087&lt;/del&gt;&lt;/a&gt; happens, then the count of WALs get a boost.&lt;/p&gt;

&lt;p&gt;Ideas to fix this for good would be :&lt;/p&gt;

&lt;p&gt;+ Priority queue for queuing up flushes with those that are queued to free up WALs having priority&lt;br/&gt;
+ Improve the &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2053&quot; title=&quot;Upper bound of outstanding WALs can be overrun&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2053&quot;&gt;&lt;del&gt;HBASE-2053&lt;/del&gt;&lt;/a&gt; code so that it will free more than just the last WAL, maybe even queuing flushes so we clear all WALs such that we are back under the maximum WALS threshold again.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12456614">HBASE-2236</key>
            <summary>Upper bound of outstanding WALs can be overrun; take 2 (take 1 was hbase-2053)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                            <label>moved_from_0_20_5</label>
                    </labels>
                <created>Thu, 18 Feb 2010 06:17:17 +0000</created>
                <updated>Tue, 7 Jul 2015 10:44:19 +0000</updated>
                                                                            <component>regionserver</component>
                    <component>wal</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="12859946" author="ryanobjc" created="Thu, 22 Apr 2010 18:35:52 +0000"  >&lt;p&gt;seems like we should flush until we are under the max log count by&lt;br/&gt;
some percent amount, like 20% perhaps.  after all flushing logs while&lt;br/&gt;
under load means we are just potentially playing perpetual catchup&lt;br/&gt;
while more edits come in.&lt;/p&gt;


</comment>
                            <comment id="12860018" author="streamy" created="Thu, 22 Apr 2010 21:15:21 +0000"  >&lt;p&gt;I like the idea of prioritizing flushes (similar to what we discussed @ hackathon w/ prioritized compactions).&lt;/p&gt;

&lt;p&gt;A flush being done because we are under global heap pressure or to clear out hlogs are high priority.&lt;/p&gt;

&lt;p&gt;Flushes being done because a region memstore reached max size are low priority.&lt;/p&gt;</comment>
                            <comment id="12866815" author="stack" created="Wed, 12 May 2010 23:48:29 +0000"  >&lt;p&gt;Bulk move of 0.20.5 issues into 0.21.0 after vote that we merge branch into TRUNK up on list.&lt;/p&gt;</comment>
                            <comment id="12878211" author="stack" created="Sat, 12 Jun 2010 04:46:29 +0000"  >&lt;p&gt;This bug is already marked critical.  I think it is.  Was at a user site today where hdfs was yanked from under hbase.  Each server had 15-20 logs to proces... some even more.  We need to be more aggressive about cleaning up old logs.  &lt;/p&gt;</comment>
                            <comment id="12918246" author="stack" created="Tue, 5 Oct 2010 22:03:17 +0000"  >&lt;p&gt;Moving out of 0.90.&lt;/p&gt;

&lt;p&gt;Chatting with Ryan and J-D, this is a difficult issue and count of logs is not the right metrics; rather we should be looking at size of all edits out in WALs as it relates to size of content up in memstores.&lt;/p&gt;

&lt;p&gt;Also, splitting needs to be made run faster so we can afford to carry fatter WALs.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 Apr 2010 18:35:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02cxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11696</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>