<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:32:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5959/HBASE-5959.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5959] Add other load balancers</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5959</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Now that balancers are pluggable we should give some options.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12554353">HBASE-5959</key>
            <summary>Add other load balancers</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eclark">Elliott Clark</assignee>
                                    <reporter username="eclark">Elliott Clark</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 May 2012 18:02:12 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:52 +0000</updated>
                            <resolved>Wed, 30 May 2012 20:53:39 +0000</resolved>
                                    <version>0.95.2</version>
                                    <fixVersion>0.95.2</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="13271806" author="eclark" created="Wed, 9 May 2012 20:58:26 +0000"  >&lt;p&gt;First stab at it.  So far there&apos;s no tests and I haven&apos;t done a whole lot of testing or re-factoring.&lt;/p&gt;

&lt;p&gt;Needs a whole lot more cost functions.&lt;/p&gt;</comment>
                            <comment id="13271825" author="zhihyu@ebaysf.com" created="Wed, 9 May 2012 21:27:12 +0000"  >&lt;p&gt;For this feature, design document showing the origin of Stochastic approach would help reviewers understand better.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+class BalanceInfo {
+
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; nextRegionForUnload;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please what the integer represents.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; class BaseLoadBalancer &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; LoadBalancer {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please add javadoc for the above class.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; HTableDescriptor getTableDescriptor(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] tableName) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Why would the above method reside in BaseLoadBalancer ?&lt;br/&gt;
StochasticLoadBalancer, it starts to get interesting.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// Perform a stocastic walk to see &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we can get a&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please finish the above comment.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lRegion != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+          rightRegionList.add(lRegion);
+        }
+
+        &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; newCost = computerCost(initialRegionMapping, clusterState);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;computerCost() should be named computeCost(). How would the above call utilize rightRegionList ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (newCost &amp;lt; currentCost || RANDOM.nextFloat() &amp;lt; 0.01) {
+          currentCost = newCost;
+        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;What if newCost is much worse than currentCost but we choose it due to RANDOM.nextFloat() &amp;lt; 0.01 ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; skewCost = computeSkewLoadCost(clusterState);
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; moveCost + (100 * skewCost);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Why would skewCost carry such a big weight ?&lt;/p&gt;

&lt;p&gt;Please add test for StochasticLoadBalancer.&lt;/p&gt;</comment>
                            <comment id="13273024" author="eclark" created="Fri, 11 May 2012 04:09:50 +0000"  >&lt;p&gt;Better version with factored tests.&lt;/p&gt;

&lt;p&gt;It still needs some more documentation and I&apos;m hoping to add more cost functions.  Though I might leave that for another issue.&lt;/p&gt;</comment>
                            <comment id="13273653" author="eclark" created="Fri, 11 May 2012 21:57:42 +0000"  >&lt;ul&gt;
	&lt;li&gt;More JavaDoc&apos;s to explain things better&lt;/li&gt;
	&lt;li&gt;Scale all cost functions between 0 and 1.  This should allow weighting to be more transparent and cleans up some of the math.&lt;/li&gt;
	&lt;li&gt;Added a cost function that takes data locality into consideration.&lt;/li&gt;
	&lt;li&gt;Added a Class to look up data locality.  Removing that from the base class.  I had to add a cache or the load balance is painfully slow.&lt;/li&gt;
	&lt;li&gt;Cleaned up a lot of code.&lt;/li&gt;
	&lt;li&gt;Added lots more tests for StochasticLoadBalancer.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13273702" author="hadoopqa" created="Fri, 11 May 2012 23:02:29 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12526578/HBASE-5959-2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12526578/HBASE-5959-2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 13 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 28 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.io.hfile.TestForceCacheImportantBlocks&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.TestDrainingServer&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestAssignmentManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1852//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1852//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1852//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1852//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1852//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1852//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13273735" author="eclark" created="Fri, 11 May 2012 23:58:34 +0000"  >&lt;p&gt;Patch to fix the find bugs that were exposed when refactoring.&lt;/p&gt;

&lt;p&gt;The tests all seems to pass locally for me.  We&apos;ll see if they are just being flakey.&lt;/p&gt;</comment>
                            <comment id="13273744" author="stack" created="Sat, 12 May 2012 00:07:50 +0000"  >&lt;p&gt;The move of LoadBalancer down into a package is a no-no given its a Public Interface (see the annotation just above class declaration).  Would need to go through a deprecation cycle.   Factory can go down into the new balancer package.  Thats fine.&lt;/p&gt;

&lt;p&gt;You don&apos;t need these lines:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ * Copyright 2012 The Apache Software Foundation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is BalanceInfo generically useful or is it useful only to your new balance algo?&lt;/p&gt;

&lt;p&gt;Fix &apos;It provides the the functions used to by&apos;&lt;/p&gt;

&lt;p&gt;You don&apos;t want to pass in master services on construction?  You don&apos;t want to pass cluster status on invocation of the balance function?  Rather than use setters (when setters, no insurance when they will be called)&lt;/p&gt;

&lt;p&gt;Need class comment on new class ClusterLoadState.  Does it need to be public?  Do methods in this class need to be public?  Can they be package protected?&lt;/p&gt;

&lt;p&gt;Did you just move the old classes or do you do some changes to them (I did not review for changes).&lt;/p&gt;


&lt;p&gt;RegionInfoComparator seems like a misleading name given what it does?  Indent is not the two spaces used in rest of code base.&lt;/p&gt;

&lt;p&gt;How often will we run this block location calcuation?  Its expensive.  We need to be careful.&lt;/p&gt;

&lt;p&gt;RegionPlanCompartor should be inner class of RegionPlan?&lt;/p&gt;

&lt;p&gt;Will do a deeper review later but so far, looks great (need to look at your new doohickey balancer more)&lt;/p&gt;
</comment>
                            <comment id="13273765" author="hadoopqa" created="Sat, 12 May 2012 00:52:48 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12526592/HBASE-5959-3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12526592/HBASE-5959-3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 13 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 27 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestDrainingServer&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1855//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1855//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1855//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1855//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1855//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1855//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13273912" author="zhihyu@ebaysf.com" created="Sat, 12 May 2012 10:18:25 +0000"  >&lt;p&gt;For a patch of this size, review board should be used.&lt;br/&gt;
Below is part 1 of my review.&lt;/p&gt;

&lt;p&gt;It is necessary to see the benefit of stochastic balancer in a real cluster compared with existing balancer.&lt;/p&gt;

&lt;p&gt;TestRegionRebalancing is an important test which currently exercises default balancer. It would be nice to apply new balancer there - or create a similar test class.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ * {@link AssignmentManager} to assign regions in the edge cases. It doesn&apos;t
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Are edge cases the only ones covered by BaseLoadBalancer ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class ClusterLoadState {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please add javadoc for the above class.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; NavigableMap&amp;lt;ServerAndLoad, List&amp;lt;HRegionInfo&amp;gt;&amp;gt; serversByLoad;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above map doesn&apos;t contain region load information. Can region load be added ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; List&amp;lt;ServerName&amp;gt; getInternalTopBlockLocations( HRegionInfo region) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;A better name for the above method would be internalGetTopBlockLocations(). Remove the space after &apos;(&apos;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @param fs
+   *          the filesystem
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There is no need to put parameter explanation on separate line.&lt;/p&gt;

&lt;p&gt;There&apos;re two almost identical getTableDescriptor() methods in master package:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; HTableDescriptor getTableDescriptor(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] tableName)
src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; HTableDescriptor getTableDescriptor(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] tableName)
src/main/java/org/apache/hadoop/hbase/master/DefaultLoadBalancer.java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It would be nice to put it in a utility class.&lt;/p&gt;

&lt;p&gt;For StochasticLoadBalancer:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ * randomly &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; and mutate up to the cluster to Cprime. If F(Cprime) &amp;lt; F(C) then
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Remove &apos;up to&apos; above.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setMasterServices(MasterServices masterServices) {
+    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services = masterServices;
+  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;RegionLocationFinder has MasterServices member which should be set in the above method.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * should always approach
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please finish the above sentence for balanceCluster().&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// No need to balance one cluster.
&lt;/span&gt;+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (clusterState.size() &amp;lt;= 1) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above check should be placed at the beginning of the method. &apos;one cluster&apos; -&amp;gt; &apos;cluster with one server&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// Perform a stocastic walk to see &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we can get a good fit.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;stocastic&apos; -&amp;gt; &apos;stochastic&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        HRegionInfo lRegion = pickRandmoRegion(leftRegionList, 0);
+        HRegionInfo rRegion = pickRandmoRegion(rightRegionList, 0.5);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please explain why selection of move is not symmetrical.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; keep = RANDOM.nextFloat() &amp;lt; (0.01 * (1 - scale(0, maxSteps, stepNum)));
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; keep;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;A single line should be enough - return directly.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
+   */
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; Map&amp;lt;HRegionInfo, ServerName&amp;gt; createRegionMapping(
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please add javadoc for return value.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; regionCountSkewCost = 100 * computeSkewLoadCost(clusterState);
+    &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; tableSkewCost = 50 * computeTableSkewLoadCost(clusterState);
+    &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; localityCost = 40 * computeDataLocalityCost(clusterState);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;May I ask how the above coefficients were determined ? Should user be able to change them through config parameters ?&lt;/p&gt;

&lt;p&gt;For computeSkewLoadCost():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; max = (mean * (clusterState.size() - 1)) + (&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.abs(mean - numRegions));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;numRegions is total number of regions, meaning it is greater than mean. The Math.abs() isn&apos;t necessary above.&lt;br/&gt;
May I ask how the above max is derived ?&lt;/p&gt;</comment>
                            <comment id="13274041" author="zhihyu@ebaysf.com" created="Sat, 12 May 2012 16:23:45 +0000"  >&lt;p&gt;For computeTableSkewLoadCost(), normally we use region count (per table) for region servers to judge skew.&lt;br/&gt;
I feel the skew in table count is not a good indicator.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Cost of imbalance in table.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;table&apos; -&amp;gt; &apos;tables&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Entry&amp;lt;ServerName, List&amp;lt;HRegionInfo&amp;gt;&amp;gt; entry : clusterState.entrySet()) {
+      Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; tablesOnRegionServer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We can clear the HashSet after the following line in the loop (instead of creating HashSet every iteration):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      tablesPerServer.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Double&lt;/span&gt;(tablesOnRegionServer.size()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Math.abs() is not needed in the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      skewCost += &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.abs(numTables - count.doubleValue());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For computeDataLocalityCost():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-comment&quot;&gt;// If we can&apos;t find where the data is getTopBlock returns &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// so count that as being the best possible.
&lt;/span&gt;+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dataOnServers == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think worst should be assumed if block locations cannot be retrieved.&lt;/p&gt;

&lt;p&gt;I asked the coefficients of various costs to be configurable. This is because users tend to give high priority to locality cost component.&lt;/p&gt;

&lt;p&gt;BalancerTestBase.java is missing license.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ * &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; used to be the base of unit tests on load balancers. It gives helper
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;Class used to be the base&apos; -&amp;gt; &apos;Base class&apos;.&lt;br/&gt;
assertClusterAsBalanced() should be package-private.&lt;/p&gt;

&lt;p&gt;For reconcile(),&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * This assumes the RegionPlan HSI instances are the same ones in the map, so
+   * actually no need to even pass in the map, but I think it&apos;s clearer.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please expand HSI to full class name. The two parameters are both Lists. Where is the map ? I think it is Map&amp;lt;ServerName, ServerAndLoad&amp;gt; map.&lt;br/&gt;
Please describe what this method does.&lt;/p&gt;</comment>
                            <comment id="13274057" author="eclark" created="Sat, 12 May 2012 19:23:33 +0000"  >&lt;p&gt;I&apos;ll put the next version up on a review board.&lt;/p&gt;</comment>
                            <comment id="13274432" author="zhihyu@ebaysf.com" created="Mon, 14 May 2012 04:01:41 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; moveCost = computeMoveCost(initialRegionMapping, clusterState);
+    &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; regionCountSkewCost = 100 * computeSkewLoadCost(clusterState);
+    &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; tableSkewCost = 50 * computeTableSkewLoadCost(clusterState);
+    &lt;span class=&quot;code-object&quot;&gt;double&lt;/span&gt; localityCost = 40 * computeDataLocalityCost(clusterState);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Since the value of move cost varies greatly, the coefficients should be designed such that the three latter costs are brought to the same magnitude of move cost. Meaning, constant coefficients may not be the best choice.&lt;/p&gt;</comment>
                            <comment id="13274435" author="eclark" created="Mon, 14 May 2012 04:23:22 +0000"  >&lt;p&gt;Move cost is just there to stop thrashing.  We want all the other to be way above what move cost is.  If moving were at the same magnitude that regionSkewCost was then the balancer would not work at all.  It would only keep the random mutations.&lt;/p&gt;

&lt;p&gt;Since everything is normalized to between 0 and 1 any multiplier(2 or above) could work, but 100 just makes things a little bit easier to reason about.  Basically we&apos;ll keep a move if it makes the region skew cost better.  And then the balancer will search for how to make that move have the best table skew or the best data locality .&lt;/p&gt;</comment>
                            <comment id="13274442" author="zhihyu@ebaysf.com" created="Mon, 14 May 2012 04:44:48 +0000"  >&lt;p&gt;I didn&apos;t take into account the scale() call at the end of computeMoveCost().&lt;/p&gt;

&lt;p&gt;I would think data locality cost should be given higher weight.&lt;/p&gt;

&lt;p&gt;Can computeSkewLoadCost() and computeTableSkewLoadCost() be combined ? In default load balancer, regions are balanced per table.&lt;br/&gt;
The way computeTableSkewLoadCost() currently is implemented, one region from a table on region server can satisfy its goal.&lt;/p&gt;</comment>
                            <comment id="13274999" author="phabricator@reviews.facebook.net" created="Mon, 14 May 2012 22:02:28 +0000"  >&lt;p&gt;eclark requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add other load balancers&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; Add new load balancer&lt;/p&gt;

&lt;p&gt;  Now that balancers are pluggable we should give some options.b&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D3189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D3189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  pom.xml&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionPlan.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ClusterLoadState.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionInfoComparator.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionLocationFinder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManager.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/BalancerTestBase.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestBaseLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestStochasticLoadBalancer.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/7245/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/7245/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, eclark&lt;/p&gt;</comment>
                            <comment id="13275007" author="hadoopqa" created="Mon, 14 May 2012 22:12:18 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12526860/HBASE-5959.D3189.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12526860/HBASE-5959.D3189.1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 13 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1867//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1867//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13275008" author="phabricator@reviews.facebook.net" created="Mon, 14 May 2012 22:20:27 +0000"  >&lt;p&gt;eclark updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add other load balancers&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  Changed the copyright headers and updated the spelling of stochastic in the property names&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D3189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D3189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  pom.xml&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionPlan.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ClusterLoadState.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionInfoComparator.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionLocationFinder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManager.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/BalancerTestBase.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestBaseLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestStochasticLoadBalancer.java&lt;/p&gt;

&lt;p&gt;To: JIRA, eclark&lt;/p&gt;</comment>
                            <comment id="13275010" author="hadoopqa" created="Mon, 14 May 2012 22:22:25 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12526862/HBASE-5959.D3189.2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12526862/HBASE-5959.D3189.2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 13 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1868//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1868//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13275089" author="phabricator@reviews.facebook.net" created="Tue, 15 May 2012 00:30:29 +0000"  >&lt;p&gt;eclark updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add other load balancers&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  Seems like the linear nature of our problem means that the random probability of keeping a solution is not needed.&lt;/p&gt;

&lt;p&gt;  I also addeded scaling of the number of iterations needed before accepting a solution.  This should help smaller cluster balance faster.&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D3189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D3189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  pom.xml&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionPlan.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ClusterLoadState.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionInfoComparator.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionLocationFinder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManager.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/BalancerTestBase.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestBaseLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestStochasticLoadBalancer.java&lt;/p&gt;

&lt;p&gt;To: JIRA, eclark&lt;/p&gt;</comment>
                            <comment id="13275090" author="hadoopqa" created="Tue, 15 May 2012 00:32:14 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12526865/HBASE-5959.D3189.3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12526865/HBASE-5959.D3189.3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 13 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1869//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1869//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13276008" author="eclark" created="Tue, 15 May 2012 17:22:01 +0000"  >&lt;p&gt;Not sure why Phabricator is not attaching a good patch.  Here is a patch version of what is up on reviews.facebook.net.&lt;/p&gt;

&lt;p&gt;Attaching so that hadoopQA can take a crack at it.&lt;/p&gt;</comment>
                            <comment id="13276078" author="phabricator@reviews.facebook.net" created="Tue, 15 May 2012 18:15:06 +0000"  >&lt;p&gt;eclark updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add other load balancers&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  Make TestRegionRebalancing test both DefaultLoadBalancer and the newer stochastic one.&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D3189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D3189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  pom.xml&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionPlan.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ClusterLoadState.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionInfoComparator.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionLocationFinder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManager.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/BalancerTestBase.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestBaseLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestStochasticLoadBalancer.java&lt;/p&gt;

&lt;p&gt;To: JIRA, eclark&lt;/p&gt;</comment>
                            <comment id="13276092" author="hadoopqa" created="Tue, 15 May 2012 18:22:33 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12527489/HBASE-5959.D3189.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12527489/HBASE-5959.D3189.4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1873//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1873//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13276093" author="hadoopqa" created="Tue, 15 May 2012 18:23:50 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12527489/HBASE-5959.D3189.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12527489/HBASE-5959.D3189.4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1874//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1874//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13276132" author="eclark" created="Tue, 15 May 2012 19:25:18 +0000"  >&lt;p&gt;Patch version again.&lt;/p&gt;</comment>
                            <comment id="13276191" author="hadoopqa" created="Tue, 15 May 2012 20:36:52 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12527497/HBASE-5959-7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12527497/HBASE-5959-7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 33 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1876//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1876//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1876//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1876//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1876//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1876//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13276215" author="zhihyu@ebaysf.com" created="Tue, 15 May 2012 21:09:14 +0000"  >&lt;p&gt;@Elliot:&lt;br/&gt;
Were all review comments addressed ?&lt;/p&gt;

&lt;p&gt;Feel free to enumerate the ones you have different opinion with.&lt;/p&gt;</comment>
                            <comment id="13276254" author="eclark" created="Tue, 15 May 2012 21:42:41 +0000"  >&lt;p&gt;And I didn&apos;t move the getTopBlockLocations into a helper as this is already a big enough patch and I wanted to keep the impact to a minimum.  If this gets accepted i&apos;ll be filing tickets to add region load cost function (region load seems broken right now i&apos;m looking into it), and to refactor getTopBlockLocations.&lt;/p&gt;

&lt;p&gt;Assuming the highest cost or the lowest cost for things has no functional difference.  However when/if region load cost functions are added assuming the worst would not work, so I think it&apos;s better to start now with always assuming the best cost unless it can be proven otherwise.&lt;/p&gt;

&lt;p&gt;Other than that yes I believe all of the issues were addressed by what is up on phabricator.&lt;/p&gt;</comment>
                            <comment id="13276257" author="zhihyu@ebaysf.com" created="Tue, 15 May 2012 21:48:26 +0000"  >&lt;p&gt;Allow me some time to comment on phabricator.&lt;/p&gt;

&lt;p&gt;Meanwhile, do you have performance numbers for stochastic balancer on a real cluster ? e.g. how long it takes to balance N regions, etc.&lt;/p&gt;</comment>
                            <comment id="13276271" author="eclark" created="Tue, 15 May 2012 22:06:36 +0000"  >&lt;p&gt;hbase(main):004:0&amp;gt; status&lt;br/&gt;
13 servers, 0 dead, 3.6154 average load&lt;/p&gt;

&lt;p&gt;hbase(main):005:0&amp;gt; balancer&lt;br/&gt;
true                                                                                                                                                                                                                                                                                                                        &lt;br/&gt;
0 row(s) in 3.3460 seconds&lt;/p&gt;

&lt;p&gt;hbase(main):006:0&amp;gt; balancer&lt;br/&gt;
true                                                                                                                                                                                                                                                                                                                        &lt;br/&gt;
0 row(s) in 3.3530 seconds&lt;/p&gt;

&lt;p&gt;hbase(main):007:0&amp;gt; balancer&lt;br/&gt;
true                                                                                                                                                                                                                                                                                                                        &lt;br/&gt;
0 row(s) in 3.3160 seconds&lt;/p&gt;

&lt;p&gt;hbase(main):008:0&amp;gt; balancer&lt;br/&gt;
true                                                                                                                                                                                                                                                                                                                        &lt;br/&gt;
0 row(s) in 3.3850 seconds&lt;/p&gt;

&lt;p&gt;hbase(main):009:0&amp;gt; balancer&lt;br/&gt;
true                                                                                                                                                                                                                                                                                                                        &lt;br/&gt;
0 row(s) in 3.3580 seconds&lt;/p&gt;

&lt;p&gt;hbase(main):010:0&amp;gt; balancer&lt;br/&gt;
true                                                                                                                                                                                                                                                                                                                        &lt;br/&gt;
0 row(s) in 3.3190 seconds&lt;/p&gt;


&lt;p&gt;The maxSteps config is nice as it places an upper bounds on the time a large cluster will run the rebalance function.  It also allows people to slowly balance their cluster meaning that fewer regions will be moved at a time as the cluster approaches the final solution.&lt;/p&gt;</comment>
                            <comment id="13276280" author="zhihyu@ebaysf.com" created="Tue, 15 May 2012 22:19:30 +0000"  >&lt;p&gt;I was looking for output in master log similar to the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Done. Calculated a load balance in &quot;&lt;/span&gt; + (endTime-startTime) + &lt;span class=&quot;code-quote&quot;&gt;&quot;ms. &quot;&lt;/span&gt; +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;Moving &quot;&lt;/span&gt; + totalNumMoved + &lt;span class=&quot;code-quote&quot;&gt;&quot; regions off of &quot;&lt;/span&gt; +
        serversOverloaded + &lt;span class=&quot;code-quote&quot;&gt;&quot; overloaded servers onto &quot;&lt;/span&gt; +
        serversUnderloaded + &lt;span class=&quot;code-quote&quot;&gt;&quot; less loaded servers. regions to &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;:&quot;&lt;/span&gt; +
        regionsToReturn.size());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;w.r.t. maxSteps, is it possible to deduce the maximum time allowable in one round of stochastic balancing ?&lt;br/&gt;
Currently we have (in HMaster.balance()):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; maximumBalanceTime = getBalancerCutoffTime();
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; cutoffTime = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis() + maximumBalanceTime;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I am thinking of the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; maxPlanGenerationTime = maximumBalanceTime *
    &lt;span class=&quot;code-comment&quot;&gt;// the maximum percentage &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; planning region rebalance
&lt;/span&gt;    getConfiguration().getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.balancer.max.planning.percent&quot;&lt;/span&gt;, 30) / 100;
...
        List&amp;lt;RegionPlan&amp;gt; partialPlans = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.balancer.balanceCluster(assignments,
            maxPlanGenerationTime);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13276291" author="eclark" created="Tue, 15 May 2012 22:28:09 +0000"  >&lt;p&gt;The new balancer doesn&apos;t have that logging. So there&apos;s no timing in the logs.  I can add that if there are people that need that info in that format.&lt;/p&gt;

&lt;p&gt;No since we iterate through all servers there is no given amount of time.  It could be that an iteration could:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;hit a cold hfile location cache&lt;/li&gt;
	&lt;li&gt;choose not to move regions.&lt;/li&gt;
	&lt;li&gt;or do a move.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All of those things will take a different amount of time; so we can&apos;t really estimate the amount of time an iteration will take.  Hence we would have to go back to the timer every iteration through.  That would be very costly.&lt;/p&gt;</comment>
                            <comment id="13276298" author="zhihyu@ebaysf.com" created="Tue, 15 May 2012 22:39:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;need that info in that format.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Please add such information. Of particular interest is the timing information of the first several balancing rounds when block location cache is cold.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;we can&apos;t really estimate the amount of time an iteration will take.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agreed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Hence we would have to go back to the timer every iteration through. That would be very costly.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Since the maximum time allowable in one iteration is passed to balancer, why would using local timer to gauge elapsed time be expensive ?&lt;/p&gt;</comment>
                            <comment id="13276317" author="eclark" created="Tue, 15 May 2012 23:06:16 +0000"  >&lt;p&gt;We would have to check sys time every loop through and that would require nanotime to have any real accuracy; nannotime is very expensive.&lt;/p&gt;

&lt;p&gt;There is currently no soft realtime requirement.  It doesn&apos;t seem like adding that would really be worth the extra complexity until there is a big need or lots of people asking for it.  Also Stack didn&apos;t want me to change any of the public interfaces in this issue.  If it becomes a big thing we can file an issue and add soft realtime.&lt;/p&gt;</comment>
                            <comment id="13276923" author="phabricator@reviews.facebook.net" created="Wed, 16 May 2012 17:45:06 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add other load balancers&quot;.&lt;/p&gt;

&lt;p&gt;  More comments to follow.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:251 Do we need to re-fetch these config parameters in each iteration ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:44 There&apos;re extraneous empty lines such as this one.&lt;/p&gt;

&lt;p&gt;  Please remove them.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:78 &apos;one cluster&apos; -&amp;gt; &apos;cluster with one server&apos;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:80 &quot;it&apos;s&quot; -&amp;gt; &quot;cluster has&quot;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:197 &apos;use&apos; -&amp;gt; &apos;uses&apos;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:202 Please add javadoc&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:204 Typo: &apos;pickRandmoRegion&apos; -&amp;gt; &apos;pickRandomRegion&apos;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:144 Remove empty line.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:154 &apos;plan&apos; -&amp;gt; &apos;plans&apos;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:224 Please finish the sentence.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:226 Specify what is returned.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:241 &apos;balancer.stochastic&apos; -&amp;gt; &apos;stochastic.balancer&apos;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:256 I think locality cost should be given higher weight.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D3189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D3189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, eclark&lt;br/&gt;
Cc: tedyu&lt;/p&gt;</comment>
                            <comment id="13276942" author="phabricator@reviews.facebook.net" created="Wed, 16 May 2012 18:01:07 +0000"  >&lt;p&gt;eclark has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add other load balancers&quot;.&lt;/p&gt;

&lt;p&gt;  I&apos;ll get the config storing in the next version&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:241 There are already config paramaters with balancer.&amp;lt;configName&amp;gt;  we should keep the hierarchy.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:256 And I actually think it should be given a lower weight as the table cost is something that represents an on going cost to the cluster and the locality cost is a one time transfer.  The impetus for doing this work was that we saw production clusters that were no balancing because the old balancer did not want to move regions around to balance the number of regions per table (Something I&apos;ve seen on several different production clusters now; a real issue on anything that has big batch jobs).  Placing locality&apos;s weight above table cost would just mean that the same thing could happen.&lt;/p&gt;

&lt;p&gt;  However I think the middle ground combined with the ability to change  per install is enough without testing on production clusters.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java:251 Nope I&apos;ll add that in my next version.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D3189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D3189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, eclark&lt;br/&gt;
Cc: tedyu&lt;/p&gt;</comment>
                            <comment id="13276955" author="zhihyu@ebaysf.com" created="Wed, 16 May 2012 18:14:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;we saw production clusters that were no balancing because the old balancer did not want to move regions around to balance the number of regions per table &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think the above was due to lack of per table load balancing in 0.92&lt;/p&gt;</comment>
                            <comment id="13277013" author="eclark" created="Wed, 16 May 2012 18:49:48 +0000"  >&lt;p&gt;Yeah; Though I&apos;ve been testing this with per table turned off as that&apos;s where this loadbalancer does it&apos;s best, when it has the whole knowledge of everything.&lt;/p&gt;</comment>
                            <comment id="13277193" author="phabricator@reviews.facebook.net" created="Wed, 16 May 2012 22:05:05 +0000"  >&lt;p&gt;eclark updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add other load balancers&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  More debug output and some small wording/spelling&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D3189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D3189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  pom.xml&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionPlan.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ClusterLoadState.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionInfoComparator.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionLocationFinder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManager.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/BalancerTestBase.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestBaseLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestStochasticLoadBalancer.java&lt;/p&gt;

&lt;p&gt;To: JIRA, eclark&lt;br/&gt;
Cc: tedyu&lt;/p&gt;</comment>
                            <comment id="13277217" author="hadoopqa" created="Wed, 16 May 2012 22:39:19 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12527726/HBASE-5959.D3189.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12527726/HBASE-5959.D3189.5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1901//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1901//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13278322" author="phabricator@reviews.facebook.net" created="Thu, 17 May 2012 22:05:04 +0000"  >&lt;p&gt;eclark updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add other load balancers&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  Changed some log levels and added a return where it was missing.&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D3189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D3189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  pom.xml&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionPlan.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ClusterLoadState.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionInfoComparator.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionLocationFinder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManager.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/BalancerTestBase.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestBaseLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestStochasticLoadBalancer.java&lt;/p&gt;

&lt;p&gt;To: JIRA, eclark&lt;br/&gt;
Cc: tedyu&lt;/p&gt;</comment>
                            <comment id="13278326" author="phabricator@reviews.facebook.net" created="Thu, 17 May 2012 22:09:04 +0000"  >&lt;p&gt;eclark updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add other load balancers&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  Rebase to current trunk&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D3189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D3189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  pom.xml&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/RegionPlan.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ClusterLoadState.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/DefaultLoadBalancer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/LoadBalancerFactory.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionInfoComparator.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/RegionLocationFinder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/ServerAndLoad.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManager.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/BalancerTestBase.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestBaseLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestDefaultLoadBalancer.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/balancer/TestStochasticLoadBalancer.java&lt;/p&gt;

&lt;p&gt;To: JIRA, eclark&lt;br/&gt;
Cc: tedyu&lt;/p&gt;</comment>
                            <comment id="13278329" author="hadoopqa" created="Thu, 17 May 2012 22:12:21 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12527938/HBASE-5959.D3189.7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12527938/HBASE-5959.D3189.7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1920//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1920//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13281913" author="eclark" created="Wed, 23 May 2012 21:02:09 +0000"  >&lt;p&gt;Added configurable cache timeouts for region location.&lt;/p&gt;</comment>
                            <comment id="13281918" author="hadoopqa" created="Wed, 23 May 2012 21:06:17 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12528782/HBASE-5959-8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12528782/HBASE-5959-8.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1968//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1968//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13281935" author="eclark" created="Wed, 23 May 2012 21:35:37 +0000"  >&lt;p&gt;git rebase.&lt;/p&gt;</comment>
                            <comment id="13282002" author="hadoopqa" created="Wed, 23 May 2012 22:41:22 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12528790/HBASE-5959-9.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12528790/HBASE-5959-9.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 35 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.coprocessor.TestMasterObserver&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestMultiSlaveReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestMasterReplication&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1971//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1971//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1971//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1971//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1971//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1971//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13282107" author="zhihyu@ebaysf.com" created="Thu, 24 May 2012 01:35:39 +0000"  >&lt;p&gt;I will go over the latest patch one more time.&lt;/p&gt;

&lt;p&gt;Please allow one or two days.&lt;/p&gt;</comment>
                            <comment id="13284022" author="zhihyu@ebaysf.com" created="Sat, 26 May 2012 17:19:14 +0000"  >&lt;p&gt;The latest addition of region load costs is limited by the fact that region load currently doesn&apos;t reflect moving average.&lt;/p&gt;

&lt;p&gt;I feel that the 4 new multipliers (readRequestMultiplier, etc) make tuning load balancing harder because there&apos;re so many moving parts.&lt;/p&gt;</comment>
                            <comment id="13284348" author="eclark" created="Mon, 28 May 2012 09:38:36 +0000"  >&lt;p&gt;Right now the two most variable(read and write) are not used they have a 0 co-efficient.  I&apos;ll need to add in a lot more plumbing to get a moving average going and this patch is getting a little too long in the tooth as it is.&lt;/p&gt;

&lt;p&gt;They are the whole point (write requests were the original impetus for this patch).  Every time someone talks about load balancing they have a different need.  That need is not encompassed by one metric or one single best fit.  If it was then the default loadbalnacer would be enough.&lt;/p&gt;

&lt;p&gt;Tuning this is a pretty difficult challenge (if the defaults are deviated from), however with the complexity comes a more powerful ability to move read/write/memory load.&lt;/p&gt;</comment>
                            <comment id="13285144" author="eclark" created="Tue, 29 May 2012 21:23:30 +0000"  >&lt;p&gt;copy of the latest version on the review.&lt;/p&gt;</comment>
                            <comment id="13285170" author="stack" created="Tue, 29 May 2012 22:00:31 +0000"  >&lt;p&gt;Why does RegionPlanComparator implemenent Serializable?&lt;/p&gt;

&lt;p&gt;Maybe doc why you are doing this compare on regionid... are you dependent on it being timestamp?&lt;/p&gt;

&lt;p&gt;Why not do &apos;return r.getRegionInfo().getRegionId() - l.getRegionInfo().getRegionId();&apos; rather than check &amp;lt; 0 and return -1, etc?&lt;/p&gt;

&lt;p&gt;Remove a &apos;the&apos; from &quot;...It provides the the functions used to by...&quot;&lt;/p&gt;

&lt;p&gt;Should RegionPlanComparator be public?  Could it be package private?  It needs to be public so the balancer package has access?&lt;/p&gt;

&lt;p&gt;Shouldn&apos;t setMasterServices instead be passed to the constructor?   Otherwise, could have an instance of a balancer that was not viable, not until after setMasterServices was called (ditto w/ setClusterStatus)?&lt;/p&gt;

&lt;p&gt;So the method roundRobinAssignment is in the base load balancer.  Its expected by all load balancer implementations?  Its behavior will be same for all?&lt;/p&gt;

&lt;p&gt;Fix &apos;randmo server.&apos;&lt;/p&gt;

&lt;p&gt;Does ClusterLoadState need to be public?  Does it need audience annotation?&lt;/p&gt;

&lt;p&gt;Why a RegionInfoComparator class and then also a comparator in RegionInfo class?  Is the latter a mistaken inclusion?&lt;/p&gt;

&lt;p&gt;Comment seems wrong &apos;+  // The cache for where load balancers are located.&apos;&lt;/p&gt;

&lt;p&gt;This is an expensive call?  computeHDFSBlocksDistribution?  Goes to NN?  We do it for every region in cluster every time we balance?  We doing to DOS the NN?&lt;/p&gt;

&lt;p&gt;The call to getTableDescriptor should be getting a descriptor from cache of table descriptors maintained by the master, right?&lt;/p&gt;

&lt;p&gt;Why ServerAndLoad implement Serializable?  You planning on java serializing it?&lt;/p&gt;

&lt;p&gt;Does StochasticLoadBalancer have to be a public class?&lt;/p&gt;

&lt;p&gt;This stuff looks great.  Nice tests.&lt;/p&gt;






</comment>
                            <comment id="13285189" author="eclark" created="Tue, 29 May 2012 22:19:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;Why does RegionPlanComparator implemenent Serializable?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Findbugs wants it so that any collection using this can also be serializable.  Probably not needed but trying to correct findbugs where I can.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Maybe doc why you are doing this compare on regionid... are you dependent on it being timestamp?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Why not do &apos;return r.getRegionInfo().getRegionId() - l.getRegionInfo().getRegionId();&apos; rather than check &amp;lt; 0 and return -1, etc?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;These are both just moved code from the old balancer.   My bet would be the comparator was written that way so the return works without a type cast and if the diff is greater than an int can hold.  But not sure.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Should RegionPlanComparator be public? Could it be package private? It needs to be public so the balancer package has access?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep it needs to be used by the balancer package.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Comment seems wrong &apos;+ // The cache for where load balancers are located.&apos;&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;This is an expensive call? computeHDFSBlocksDistribution? Goes to NN? We do it for every region in cluster every time we balance? We doing to DOS the NN?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We do this for every region.  However we cache this for a given amount of time.  Should we up that beyond 30 mins ?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why ServerAndLoad implement Serializable? You planning on java serializing it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Another findbugs special&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Does StochasticLoadBalancer have to be a public class?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It makes the factory much easier.  Not 100% required but makes it use less reflection to create an instance.&lt;/p&gt;</comment>
                            <comment id="13285193" author="hadoopqa" created="Tue, 29 May 2012 22:23:37 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12530097/HBASE-5959-11.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12530097/HBASE-5959-11.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to cause Findbugs (version 1.3.9) to fail.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2035//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2035//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2035//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2035//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13285204" author="eclark" created="Tue, 29 May 2012 22:35:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;Shouldn&apos;t setMasterServices instead be passed to the constructor? Otherwise, could have an instance of a balancer that was not viable, not until after setMasterServices was called (ditto w/ setClusterStatus)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It would be nice but using the hadoop ReflectionUtils a conf is the only thing that can be passed in. The balancer should work without either of those, though they are always set on finish master initialization.&lt;/p&gt;</comment>
                            <comment id="13285214" author="eclark" created="Tue, 29 May 2012 22:38:09 +0000"  >&lt;p&gt;Changed around the comments that Stack asked about.&lt;/p&gt;</comment>
                            <comment id="13285219" author="stack" created="Tue, 29 May 2012 22:40:08 +0000"  >&lt;p&gt;I&apos;m +1 on this patch.  Ted?&lt;/p&gt;</comment>
                            <comment id="13285302" author="zhihyu@ebaysf.com" created="Wed, 30 May 2012 00:38:20 +0000"  >&lt;p&gt;I was trying to see the difference between Diff 10 and Diff 11.&lt;br/&gt;
Due to rebasing, the diff is not easy to read.&lt;/p&gt;</comment>
                            <comment id="13285937" author="eclark" created="Wed, 30 May 2012 19:25:02 +0000"  >&lt;p&gt;Added more top of class comments to explain all of the config options.&lt;/p&gt;

&lt;p&gt;Addressed a few code comments.&lt;/p&gt;

&lt;p&gt;Phabrictor seems to have been broken on the move to modules.  I&apos;ll file a bug, but in the mean time i&apos;ll attach patches here.&lt;/p&gt;

&lt;p&gt;This should be the final patch.&lt;/p&gt;</comment>
                            <comment id="13285941" author="stack" created="Wed, 30 May 2012 19:27:24 +0000"  >&lt;p&gt;I&apos;ll commit this this afternoon unless objection (old behavior is the default).&lt;/p&gt;</comment>
                            <comment id="13285961" author="zhihyu@ebaysf.com" created="Wed, 30 May 2012 19:53:55 +0000"  >&lt;p&gt;From &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2060/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2060/console&lt;/a&gt; :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/home/jenkins/tools/maven/latest/bin/mvn clean test -DskipTests -DHBasePatchProcess &amp;gt; /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/patchprocess/trunkJavacWarnings.txt 2&amp;gt;&amp;amp;1
Trunk compilation is broken?
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13285980" author="eclark" created="Wed, 30 May 2012 20:15:55 +0000"  >&lt;p&gt;More test asserts.&lt;/p&gt;

&lt;p&gt;Looks like jenkins is having issues.  Running tests locally right now.&lt;/p&gt;</comment>
                            <comment id="13286012" author="zhihyu@ebaysf.com" created="Wed, 30 May 2012 20:32:54 +0000"  >&lt;p&gt;I got the following when running against patch v14:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testContendedLogRolling(org.apache.hadoop.hbase.regionserver.wal.TestLogRollingNoCluster)  Time elapsed: 0.201 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError
  at org.junit.Assert.fail(Assert.java:92)
  at org.junit.Assert.assertTrue(Assert.java:43)
  at org.junit.Assert.assertFalse(Assert.java:68)
  at org.junit.Assert.assertFalse(Assert.java:79)
  at org.apache.hadoop.hbase.regionserver.wal.TestLogRollingNoCluster.testContendedLogRolling(TestLogRollingNoCluster.java:78)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13286015" author="stack" created="Wed, 30 May 2012 20:36:28 +0000"  >&lt;p&gt;@Ted If you run w/o this patch, that test passes and then if you run w/ this patch it always fails?  That test seems totally unrelated to whats going on in this patch.&lt;/p&gt;</comment>
                            <comment id="13286016" author="eclark" created="Wed, 30 May 2012 20:39:55 +0000"  >&lt;p&gt;Just tried it and got a passing test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mvn clean compile test -PrunAllTests -DfailIfNoTests=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; -Dtest=TestLogRollingNoCluster                                   ruby-1.9.3-p194  [33s] 
[INFO] Scanning &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; projects...
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Build Order:
[INFO] 
[INFO] HBase
[INFO] HBase - Server
[INFO] HBase - Assembly
[INFO] HBase - Site
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building HBase 0.95-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-clean-plugin:2.4.1:clean (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-clean) @ hbase ---
[INFO] Deleting /Users/eclark/Code/hbase/target
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.1:process (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase ---
[INFO] Setting property: classpath.resource.loader.class =&amp;gt; &apos;org.codehaus.plexus.velocity.ContextClassLoaderResourceLoader&apos;.
[INFO] Setting property: velocimacro.messages.on =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;.
[INFO] Setting property: resource.loader =&amp;gt; &apos;classpath&apos;.
[INFO] Setting property: resource.manager.logwhenfound =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;.
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.1:process (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase ---
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building HBase - Server 0.95-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-clean-plugin:2.4.1:clean (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-clean) @ hbase-server ---
[INFO] Deleting /Users/eclark/Code/hbase/hbase-server/target
[INFO] 
[INFO] --- avro-maven-plugin:1.5.3:schema (generate-avro-sources) @ hbase-server ---
[INFO] 
[INFO] --- avro-maven-plugin:1.5.3:protocol (generate-avro-sources) @ hbase-server ---
[INFO] 
[INFO] --- maven-antrun-plugin:1.6:run (generate) @ hbase-server ---
[INFO] Executing tasks

main:
    [mkdir] Created dir: /Users/eclark/Code/hbase/hbase-server/target/hbase-webapps
     [copy] Copying 4 files to /Users/eclark/Code/hbase/hbase-server/target/hbase-webapps
12/05/30 13:36:56 INFO mortbay.log: Logging to org.slf4j.impl.Log4jLoggerAdapter(org.mortbay.log) via org.mortbay.log.Slf4jLog
    [mkdir] Created dir: /Users/eclark/Code/hbase/hbase-server/target/hbase-webapps/master/WEB-INF
    [mkdir] Created dir: /Users/eclark/Code/hbase/hbase-server/target/hbase-webapps/regionserver/WEB-INF
[INFO] Executed tasks
[INFO] 
[INFO] --- build-helper-maven-plugin:1.5:add-source (jspcSource-packageInfo-Avro-source) @ hbase-server ---
[INFO] Source directory: /Users/eclark/Code/hbase/hbase-server/target/generated-jamon added.
[INFO] Source directory: /Users/eclark/Code/hbase/hbase-server/target/generated-sources/java added.
[INFO] 
[INFO] --- jamon-maven-plugin:2.3.4:translate (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase-server ---
[INFO] Translating 4 templates from /Users/eclark/Code/hbase/hbase-server/src/main/jamon to /Users/eclark/Code/hbase/hbase-server/target/generated-jamon
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.1:process (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase-server ---
[INFO] 
[INFO] --- maven-resources-plugin:2.5:resources (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-resources) @ hbase-server ---
[debug] execute contextualize
[INFO] Using &apos;UTF-8&apos; encoding to copy filtered resources.
[INFO] Copying 6 resources
[INFO] Copying 1 resource
[INFO] Copying 3 resources
[INFO] 
[INFO] --- maven-compiler-plugin:2.0.2:compile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-compile) @ hbase-server ---
[INFO] Compiling 766 source files to /Users/eclark/Code/hbase/hbase-server/target/classes
[INFO] 
[INFO] --- avro-maven-plugin:1.5.3:schema (generate-avro-sources) @ hbase-server ---
[INFO] 
[INFO] --- avro-maven-plugin:1.5.3:protocol (generate-avro-sources) @ hbase-server ---
[INFO] 
[INFO] --- maven-antrun-plugin:1.6:run (generate) @ hbase-server ---
[INFO] Executing tasks

main:
12/05/30 13:37:19 INFO mortbay.log: Logging to org.slf4j.impl.Log4jLoggerAdapter(org.mortbay.log) via org.mortbay.log.Slf4jLog
[INFO] Executed tasks
[INFO] 
[INFO] --- build-helper-maven-plugin:1.5:add-source (jspcSource-packageInfo-Avro-source) @ hbase-server ---
[INFO] Source directory: /Users/eclark/Code/hbase/hbase-server/target/generated-jamon added.
[INFO] Source directory: /Users/eclark/Code/hbase/hbase-server/target/generated-sources/java added.
[INFO] 
[INFO] --- jamon-maven-plugin:2.3.4:translate (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase-server ---
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.1:process (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase-server ---
[INFO] 
[INFO] --- maven-resources-plugin:2.5:resources (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-resources) @ hbase-server ---
[debug] execute contextualize
[INFO] Using &apos;UTF-8&apos; encoding to copy filtered resources.
[INFO] Copying 6 resources
[INFO] Copying 1 resource
[INFO] Copying 3 resources
[INFO] Copying 3 resources
[INFO] 
[INFO] --- maven-compiler-plugin:2.0.2:compile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-compile) @ hbase-server ---
[INFO] Compiling 8 source files to /Users/eclark/Code/hbase/hbase-server/target/classes
[INFO] 
[INFO] --- maven-resources-plugin:2.5:testResources (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-testResources) @ hbase-server ---
[debug] execute contextualize
[INFO] Using &apos;UTF-8&apos; encoding to copy filtered resources.
[INFO] Copying 5 resources
[INFO] Copying 3 resources
[INFO] Copying 3 resources
[INFO] 
[INFO] --- maven-compiler-plugin:2.0.2:testCompile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-testCompile) @ hbase-server ---
[INFO] Compiling 375 source files to /Users/eclark/Code/hbase/hbase-server/target/test-classes
[INFO] 
[INFO] --- maven-surefire-plugin:2.12-TRUNK-HBASE-2:test (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-test) @ hbase-server ---
[INFO] Surefire report directory: /Users/eclark/Code/hbase/hbase-server/target/surefire-reports
[INFO] Using configured provider org.apache.maven.surefire.junitcore.JUnitCoreProvider

-------------------------------------------------------
 T E S T S
-------------------------------------------------------
2012-05-30 13:37:23.778 java[10644:d703] Unable to load realm info from SCDynamicStore
Running org.apache.hadoop.hbase.regionserver.wal.TestLogRollingNoCluster
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 3.384 sec

Results :

Tests run: 1, Failures: 0, Errors: 0, Skipped: 0

[INFO] 
[INFO] --- maven-surefire-plugin:2.12-TRUNK-HBASE-2:test (secondPartTestsExecution) @ hbase-server ---
[INFO] Surefire report directory: /Users/eclark/Code/hbase/hbase-server/target/surefire-reports
[INFO] Using configured provider org.apache.maven.surefire.junitcore.JUnitCoreProvider

-------------------------------------------------------
 T E S T S
-------------------------------------------------------

-------------------------------------------------------
 T E S T S
-------------------------------------------------------

Results :

Tests run: 0, Failures: 0, Errors: 0, Skipped: 0

[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building HBase - Assembly 0.95-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-clean-plugin:2.4.1:clean (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-clean) @ hbase-assembly ---
[INFO] Deleting /Users/eclark/Code/hbase/hbase-assembly/target
[INFO] 
[INFO] --- maven-antrun-plugin:1.6:run (arc-setup) @ hbase-assembly ---
[WARNING] Parameter tasks is deprecated, use target instead
[INFO] Executing tasks

main:
[INFO] Executed tasks
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.1:process (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase-assembly ---
[INFO] 
[INFO] --- maven-antrun-plugin:1.6:run (arc-setup) @ hbase-assembly ---
[WARNING] Parameter tasks is deprecated, use target instead
[INFO] Executing tasks

main:
[INFO] Executed tasks
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.1:process (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase-assembly ---
[INFO]                                                                         
[INFO] ------------------------------------------------------------------------
[INFO] Building HBase - Site 0.95-SNAPSHOT
[INFO] ------------------------------------------------------------------------
[INFO] 
[INFO] --- maven-clean-plugin:2.4.1:clean (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-clean) @ hbase-site ---
[INFO] Deleting /Users/eclark/Code/hbase/hbase-site/target
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.1:process (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase-site ---
[INFO] 
[INFO] --- maven-remote-resources-plugin:1.1:process (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;) @ hbase-site ---
[INFO] ------------------------------------------------------------------------
[INFO] Reactor Summary:
[INFO] 
[INFO] HBase ............................................. SUCCESS [0.703s]
[INFO] HBase - Server .................................... SUCCESS [33.019s]
[INFO] HBase - Assembly .................................. SUCCESS [0.621s]
[INFO] HBase - Site ...................................... SUCCESS [0.860s]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 35.527s
[INFO] Finished at: Wed May 30 13:37:28 PDT 2012
[INFO] Final Memory: 29M/123M
[INFO] ------------------------------------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13286023" author="zhihyu@ebaysf.com" created="Wed, 30 May 2012 20:44:27 +0000"  >&lt;p&gt;The test failure was due to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5936&quot; title=&quot;Add Column-level PB-based calls to HMasterInterface&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5936&quot;&gt;&lt;del&gt;HBASE-5936&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
I updated workspace and it passed.&lt;/p&gt;

&lt;p&gt;Let&apos;s see what Hadoop QA tells us:&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2062/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2062/console&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13286034" author="stack" created="Wed, 30 May 2012 20:49:56 +0000"  >&lt;p&gt;@Ted np  Sorry about that.  I&apos;ll go ahead and commit this.&lt;/p&gt;</comment>
                            <comment id="13286038" author="stack" created="Wed, 30 May 2012 20:53:39 +0000"  >&lt;p&gt;Committed to trunk.  Nice feature.  Thanks Elliott.  Add a release note please.&lt;/p&gt;</comment>
                            <comment id="13286053" author="eclark" created="Wed, 30 May 2012 21:02:55 +0000"  >&lt;p&gt;done&lt;/p&gt;</comment>
                            <comment id="13286066" author="hadoopqa" created="Wed, 30 May 2012 21:14:02 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12530263/HBASE-5959-14.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12530263/HBASE-5959-14.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to cause Findbugs (version 1.3.9) to fail.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestSplitTransactionOnCluster&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2062//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2062//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2062//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2062//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13286083" author="hudson" created="Wed, 30 May 2012 21:32:07 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2957 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2957/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2957/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; Add other load balancers (Revision 1344457)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/pom.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/DefaultLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/LoadBalancerFactory.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/RegionPlan.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerAndLoad.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/ClusterLoadState.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/DefaultLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/LoadBalancerFactory.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/RegionInfoComparator.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/RegionLocationFinder.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/ServerAndLoad.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestDefaultLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/BalancerTestBase.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/TestBaseLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/TestDefaultLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/TestStochasticLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/pom.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13286212" author="hudson" created="Thu, 31 May 2012 00:03:11 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #33 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/33/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/33/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; Add other load balancers (Revision 1344457)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/pom.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/DefaultLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/LoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/LoadBalancerFactory.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/RegionPlan.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerAndLoad.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/ClusterLoadState.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/DefaultLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/LoadBalancerFactory.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/RegionInfoComparator.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/RegionLocationFinder.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/ServerAndLoad.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestDefaultLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/BalancerTestBase.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/TestBaseLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/TestDefaultLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/TestStochasticLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/pom.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13943711" author="phabricator@reviews.facebook.net" created="Fri, 21 Mar 2014 23:11:44 +0000"  >&lt;p&gt;eclark has abandoned the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5959&quot; title=&quot;Add other load balancers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5959&quot;&gt;&lt;del&gt;HBASE-5959&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add other load balancers&quot;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D3189&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D3189&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: JIRA, eclark&lt;br/&gt;
Cc: tedyu, lhofhansl&lt;/p&gt;</comment>
                            <comment id="15016341" author="lars_francke" created="Fri, 20 Nov 2015 11:54:52 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12526860" name="ASF.LICENSE.NOT.GRANTED--HBASE-5959.D3189.1.patch" size="113176" author="phabricator@reviews.facebook.net" created="Mon, 14 May 2012 22:02:28 +0000"/>
                            <attachment id="12526862" name="ASF.LICENSE.NOT.GRANTED--HBASE-5959.D3189.2.patch" size="113884" author="phabricator@reviews.facebook.net" created="Mon, 14 May 2012 22:20:28 +0000"/>
                            <attachment id="12526865" name="ASF.LICENSE.NOT.GRANTED--HBASE-5959.D3189.3.patch" size="113766" author="phabricator@reviews.facebook.net" created="Tue, 15 May 2012 00:30:31 +0000"/>
                            <attachment id="12527489" name="ASF.LICENSE.NOT.GRANTED--HBASE-5959.D3189.4.patch" size="116523" author="phabricator@reviews.facebook.net" created="Tue, 15 May 2012 18:15:07 +0000"/>
                            <attachment id="12527726" name="ASF.LICENSE.NOT.GRANTED--HBASE-5959.D3189.5.patch" size="117672" author="phabricator@reviews.facebook.net" created="Wed, 16 May 2012 22:05:06 +0000"/>
                            <attachment id="12527937" name="ASF.LICENSE.NOT.GRANTED--HBASE-5959.D3189.6.patch" size="117694" author="phabricator@reviews.facebook.net" created="Thu, 17 May 2012 22:05:06 +0000"/>
                            <attachment id="12527938" name="ASF.LICENSE.NOT.GRANTED--HBASE-5959.D3189.7.patch" size="117694" author="phabricator@reviews.facebook.net" created="Thu, 17 May 2012 22:09:05 +0000"/>
                            <attachment id="12526209" name="HBASE-5959-0.patch" size="131362" author="eclark" created="Wed, 9 May 2012 20:58:26 +0000"/>
                            <attachment id="12526476" name="HBASE-5959-1.patch" size="145744" author="eclark" created="Fri, 11 May 2012 04:09:49 +0000"/>
                            <attachment id="12530097" name="HBASE-5959-11.patch" size="165595" author="eclark" created="Tue, 29 May 2012 21:23:30 +0000"/>
                            <attachment id="12530107" name="HBASE-5959-12.patch" size="165608" author="eclark" created="Tue, 29 May 2012 22:38:09 +0000"/>
                            <attachment id="12530259" name="HBASE-5959-13.patch" size="168056" author="eclark" created="Wed, 30 May 2012 19:25:02 +0000"/>
                            <attachment id="12530263" name="HBASE-5959-14.patch" size="168272" author="eclark" created="Wed, 30 May 2012 20:15:55 +0000"/>
                            <attachment id="12526578" name="HBASE-5959-2.patch" size="156034" author="eclark" created="Fri, 11 May 2012 21:57:42 +0000"/>
                            <attachment id="12526592" name="HBASE-5959-3.patch" size="156493" author="eclark" created="Fri, 11 May 2012 23:58:34 +0000"/>
                            <attachment id="12527468" name="HBASE-5959-6.patch" size="149780" author="eclark" created="Tue, 15 May 2012 17:22:01 +0000"/>
                            <attachment id="12527497" name="HBASE-5959-7.patch" size="152541" author="eclark" created="Tue, 15 May 2012 19:25:18 +0000"/>
                            <attachment id="12528782" name="HBASE-5959-8.patch" size="154092" author="eclark" created="Wed, 23 May 2012 21:02:09 +0000"/>
                            <attachment id="12528790" name="HBASE-5959-9.patch" size="155472" author="eclark" created="Wed, 23 May 2012 21:35:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>19.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 May 2012 21:27:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>238583</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hucv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>102180</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Added a new StochasticLoadBalancer that when enabled will perform a randomized search for the optimal cluster balance.  The new balancer takes into account data locality, storefile size, memstore size, and the evenness of tables over region servers when trying potential new cluster states.&lt;br/&gt;
&lt;br/&gt;
To enable the new balancer set hbase.master.loadbalancer.class to org.apache.hadoop.hbase.master.balancer.StochasticLoadBalancer . It is also recommended to set hbase.master.loadbalance.bytable to false .  Lots of different configuration options can be tuned to prioritize costs differently.  Explanations of all of the configuration options are available  on the JavaDoc for StochasticLoadBalancer.&lt;br/&gt;
&lt;br/&gt;
StochasticLoadBalancer is the default in 0.96.0</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>