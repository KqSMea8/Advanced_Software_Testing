<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:39:32 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6751/HBASE-6751.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6751] Too many retries, leading a a delay to read the HLog after a datanode failure</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6751</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When reading an HLog, we need to got to the last block to get the file size.&lt;br/&gt;
In HDFS 1.0.3, it leads to &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-3701&quot; title=&quot;HDFS may miss the final block when reading a file opened for writing if one of the datanode is dead&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-3701&quot;&gt;&lt;del&gt;HDFS-3701&lt;/del&gt;&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6401&quot; title=&quot;HBase may lose edits after a crash if used with HDFS 1.0.3 or older&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6401&quot;&gt;&lt;del&gt;HBASE-6401&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;In HDFS branch-2, this bug is fixed; but we have two other issues.&lt;/p&gt;

&lt;p&gt;1) For simple cases as a single node died, we don&apos;t have the effect of &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-3703&quot; title=&quot;Decrease the datanode failure detection time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-3703&quot;&gt;&lt;del&gt;HDFS-3703&lt;/del&gt;&lt;/a&gt;, and the default location order leads us to try to connect to a dead datanode while we should not. This is not analysed yet. A specific JIRA will be created later.&lt;br/&gt;
2) If we are redirected to a wrong node, we experience a huge delay:&lt;/p&gt;

&lt;p&gt;The pseudo code in DFSInputStream#readBlockLength is:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;   
    for(DatanodeInfo datanode : locatedblock.getLocations()) {     
      try {
        ClientDatanodeProtocol cdp = DFSUtil.createClientDatanodeProtocolProxy(
            datanode, dfsClient.conf, dfsClient.getConf().socketTimeout,
            dfsClient.getConf().connectToDnViaHostname, locatedblock);
       
       return cdp.getReplicaVisibleLength(locatedblock.getBlock());

        } catch {
             // retry
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;However, with this code, the connection is created with a null RetryPolicy. It&apos;s then defaulted to 10 retries, with:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 
  public static final String  IPC_CLIENT_CONNECT_MAX_RETRIES_KEY = &quot;ipc.client.connect.max.retries&quot;;
  public static final int     IPC_CLIENT_CONNECT_MAX_RETRIES_DEFAULT = 10;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;So if the first datanode is bad, we will try 10 times before trying the second. In the context of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6738&quot; title=&quot;Too aggressive task resubmission from the distributed log manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6738&quot;&gt;&lt;del&gt;HBASE-6738&lt;/del&gt;&lt;/a&gt;, the split task is cancelled before we&apos;re have opened the file to split.&lt;/p&gt;

&lt;p&gt;By nature, it&apos;s likely to be a pure HDFS issue. But may be it can be solved in HBase with the right configuration on &quot;ipc.client.connect.max.retries&quot;.&lt;/p&gt;

&lt;p&gt;The ideal fix (in HDFS) would be to try the datanodes once each, and then loop 10 times.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12606879">HBASE-6751</key>
            <summary>Too many retries, leading a a delay to read the HLog after a datanode failure</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Sep 2012 14:14:53 +0000</created>
                <updated>Wed, 16 Nov 2016 22:18:02 +0000</updated>
                                            <version>2.0.0</version>
                                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                    <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12599834">HDFS-3701</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12599836">HDFS-3703</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12551766">HBASE-5843</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241872</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02fiv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12116</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>