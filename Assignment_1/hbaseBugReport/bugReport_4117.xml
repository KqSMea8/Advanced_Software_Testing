<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:16:03 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4117/HBASE-4117.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4117] Slow Query Log</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4117</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Produce log messages for slow queries. The RPC server will decide what is slow based on a configurable &quot;warn response time&quot; parameter. Queries designated as slow will then output a &quot;response too slow&quot; message followed by a fingerprint of the query, and a summary limited in size by another configurable parameter (to limit log spamming).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12514711">HBASE-4117</key>
            <summary>Slow Query Log</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="riley">Riley Patterson</assignee>
                                    <reporter username="riley">Riley Patterson</reporter>
                        <labels>
                            <label>client</label>
                            <label>ipc</label>
                    </labels>
                <created>Tue, 19 Jul 2011 21:58:18 +0000</created>
                <updated>Fri, 20 Nov 2015 11:55:46 +0000</updated>
                            <resolved>Sat, 27 Aug 2011 04:02:02 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                                    <component>IPC/RPC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13085539" author="riley" created="Tue, 16 Aug 2011 05:31:46 +0000"  >&lt;p&gt;Exposes JSON-parseable fingerprint and details for queries that take longer than a configurable threshold time. The exposure is currently to the main regionserver log, along with a (queryTooSlow) tag which allows it to be grepped out and easily aggregated and/or monitored in adminstrator scripts.&lt;/p&gt;

&lt;p&gt;The patch also provides a standard way to extract fingerprint and detail information of interest by requiring each &quot;DatabaseCommand&quot; to provide a fingerprint map and a details map, which will be a superset of the fingerprint. &lt;/p&gt;</comment>
                            <comment id="13085710" author="yuzhihong@gmail.com" created="Tue, 16 Aug 2011 14:00:48 +0000"  >&lt;p&gt;Please combine javadoc in one line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    /** Default value &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; above param */
+    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; DEFAULT_WARN_RESPONSE_TIME = 1000; &lt;span class=&quot;code-comment&quot;&gt;// milliseconds&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;abstract&lt;/span&gt; class DatabaseCommand {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Maybe we can find a better name for the above class whose purpose is for logging and debugging ?&lt;/p&gt;</comment>
                            <comment id="13085855" author="stack" created="Tue, 16 Aug 2011 17:16:43 +0000"  >&lt;p&gt;How is jettison related to jackson, the json lib we use elsewhere in hbase?  It throws events as it trips over the json.  Can jackson do this?&lt;/p&gt;

&lt;p&gt;The clause under  &apos;if (processingTime &amp;gt; warnResponseTime) {&apos; could be broken out into a method?&lt;/p&gt;

&lt;p&gt;Should the above test include if logging is DEBUG or more or is thought that this slow logging will be always on?&lt;/p&gt;

&lt;p&gt;You don&apos;t want to log something here:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (JSONException e) {
+              &lt;span class=&quot;code-comment&quot;&gt;// ignore
&lt;/span&gt;+            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Could be confusing if I&apos;m expecting logging and its not coming out &amp;#8211; would appreciate the failure being logged.  There is another instance later in this code block.&lt;/p&gt;

&lt;p&gt;Would &apos;Operation&apos; be better than &apos;DatabaseCommand&apos;?  Currently this superclass factors into a superclass various kinds of representations of hbase operations &amp;#8211; tostring, fingerprint as map, json &amp;#8211; etc.  Thats fine for now.  It could do more with time.&lt;/p&gt;

&lt;p&gt;I like this getFingerprint.&lt;/p&gt;

&lt;p&gt;getDetails seems too generic a name for the method.  If you are going to go generic, toMap to go with toString might be better?  (Oh, nvm, I see you went one better and made the toString member of the superclass &amp;#8211; good).&lt;/p&gt;

&lt;p&gt;Are you removing toString from Delete?  Thats probably not good.  The toString could use your fingerprinting.&lt;/p&gt;

&lt;p&gt;Shouldn&apos;t the methods in Row be added to your new base class?  Row Interface should only have &apos;row&apos; things in it, not getDetails and getFamilyMap.&lt;/p&gt;

&lt;p&gt;A couple of tests would be good where you do some toStringing and toJSON&apos;ing and verify its doing right thing.&lt;/p&gt;

&lt;p&gt;Nice patch Riley.  Nice functionality.&lt;/p&gt;



</comment>
                            <comment id="13085990" author="riley" created="Tue, 16 Aug 2011 21:30:10 +0000"  >&lt;p&gt;Jackson does look like it could be a better choice for JSON encoding; I used jettison for consistency with my HLog Pretty Printer (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3968&quot; title=&quot;HLog Pretty Printer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3968&quot;&gt;&lt;del&gt;HBASE-3968&lt;/del&gt;&lt;/a&gt;). It seems like jackson is more actively maintained, and we should probably be consistent throughout the project, so I&apos;ll go ahead and change this patch to use jackson as well as patching the HLog Pretty Printer to also use jackson.&lt;/p&gt;

&lt;p&gt;Separating the logging into its own method sounds like a good idea as well. On it.&lt;/p&gt;

&lt;p&gt;The slow logging can be turned off by setting hbase.ipc.warn.response.time very large. I could add an additional check for nonnegativity which would make disabling slow logging a bit more intuitive (set to -1). I do think that this feature should be enabled even when DEBUG logging is not, as it could be useful for DBA&apos;s as well as core developers.&lt;/p&gt;

&lt;p&gt;I&apos;m open for suggestions for the name of the super class. Operation sounds fine.&lt;/p&gt;</comment>
                            <comment id="13085998" author="stack" created="Tue, 16 Aug 2011 21:43:54 +0000"  >&lt;p&gt;Thanks Riley.&lt;/p&gt;

&lt;p&gt;Over in hbase-880 when we were talking refactoring, base class there was Operation &amp;#8211; e.g. &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12391309/NewCilentAPIProposoal4.gif&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12391309/NewCilentAPIProposoal4.gif&lt;/a&gt; &amp;#8211; in a few proposals and RowOperation in others.  You already have a Row interface, so maybe Operation is ok... (I don&apos;t see row specifics going on in your Operation instance currently).  Good stuff.&lt;/p&gt;</comment>
                            <comment id="13086028" author="apurtell" created="Tue, 16 Aug 2011 22:44:59 +0000"  >&lt;p&gt;I&apos;m not suggesting turning down good work.&lt;/p&gt;

&lt;p&gt;However I renew my objection to the result of adding this feature as is. We end up with a hodgepodge of methods for gathering status information or taking administrative action. Do I use the shell? Do I grab some JSON at some path on the server? (And at more than one path?) Do I grep the logs? This is not good design. Why can&apos;t this information be made retrievable via the Java admin API via RPC (and therefore the shell can manipulate it)? Why can&apos;t we have a common interface that lets us expose this type of information by RPC or by servlet or by logging?&lt;/p&gt;</comment>
                            <comment id="13086045" author="riley" created="Tue, 16 Aug 2011 23:45:19 +0000"  >&lt;p&gt;This isn&apos;t really meant to enable gathering of status information. It is a bunch of historical information which is highly related to other information in the main log. Without the context of log events regarding compactions, region reassignments, etc. that we gain by placing it in the main log, we lose most of the utility. It can also provide context to other log events that may have been caused by RPC handlers getting locked up on slow queries.&lt;/p&gt;

&lt;p&gt;We could additionally log this information somewhere in a monitor in memory or in its own separate log and open this up to RPC access, but it would duplicate a lot of historical information which would likely see infrequent use. I don&apos;t think there&apos;s any more reason to do this for this particular feature than for most other events logged in our main log file.&lt;/p&gt;

&lt;p&gt;Note that I&apos;m also finishing up work on an initial implementation of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4057&quot; title=&quot;Implement HBase version of &amp;quot;show processlist&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4057&quot;&gt;&lt;del&gt;HBASE-4057&lt;/del&gt;&lt;/a&gt;, which deals directly with status information for the calls currently being serviced by RPC handlers and enables exposure of the contents of getFingerprint and getDetails in a more general way. This information resides in the TaskMonitor singleton, which can then be exposed any way you like. I think this design makes a lot of sense; historical information goes in the main log, while current status information can be queried from a clean interface and exposed any way you like.&lt;/p&gt;</comment>
                            <comment id="13086071" author="apurtell" created="Wed, 17 Aug 2011 00:57:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;This information resides in the TaskMonitor singleton, which can then be exposed any way you like. I think this design makes a lot of sense; historical information goes in the main log, while current status information can be queried from a clean interface and exposed any way you like.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Fair enough. I stand corrected / mollified.&lt;/p&gt;</comment>
                            <comment id="13086082" author="ghelmling" created="Wed, 17 Aug 2011 02:00:48 +0000"  >&lt;p&gt;Riley, would you mind putting this up on reviews.apache.org?  This is a pretty big change to read through as a patch.  Thanks!&lt;/p&gt;</comment>
                            <comment id="13086126" author="stack" created="Wed, 17 Aug 2011 04:30:12 +0000"  >&lt;p&gt;@Andrew I appreciate your showing up in your architect hat flashing the red card.  Please stay on the prowl and flag the violations.&lt;/p&gt;

&lt;p&gt;In this case, on review, I think we are talking honest logging (logging already has a system that facilitates redirection and feeding events to other than files that live under HBASE_LOG_DIR &amp;#8211; which reminds me, I need to go back to Riley and make sure that these events CAN be directed to other than the .log file cleanly).  As Riley says, these logs at an extreme will likely make most sense if shown in context amidst the logging of what else was going on on the server.&lt;/p&gt;

&lt;p&gt;The patch also includes nice refactoring of base classes &amp;#8211; Scan, Get, etc. &amp;#8211; to make it so they can dump out a self-description (either a fingerprint/synopsis, or a full catalog of the payload being carried) in text or json that looks like it can be passed to whatever asks for the info (log or metrics or...)&lt;/p&gt;

&lt;p&gt;We are still missing the general theory on how to pass hbase emissions but I think this patch helps move us closer to a general system much more than it adds distraction.&lt;/p&gt;</comment>
                            <comment id="13089146" author="jiraposter@reviews.apache.org" created="Mon, 22 Aug 2011 23:26:31 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1621/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1621/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-08-22 23:25:12.626245)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Addressed stack&apos;s comments from last week, cleaned up code, standardized many fields in the JSON output.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Exposes JSON-parseable fingerprint and details for queries that take longer than a configurable threshold time. The exposure is currently to the main regionserver log, along with a (operationTooSlow) tag which allows it to be grepped out and easily aggregated and/or monitored in administrator scripts.&lt;/p&gt;

&lt;p&gt;The patch also provides a standard way to extract fingerprint and detail information of interest by requiring each &quot;Operation&quot; to provide a fingerprint map and a details map, which will be a superset of the fingerprint. &lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4117&quot; title=&quot;Slow Query Log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4117&quot;&gt;&lt;del&gt;HBASE-4117&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4117&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4117&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/KeyValue.java 1160468 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/Delete.java 1160468 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/Get.java 1160468 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/MultiAction.java 1160468 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/MultiPut.java 1160468 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/Operation.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/Put.java 1160468 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/Scan.java 1160468 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 1160468 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 1160468 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestOperation.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1621/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1621/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Monitored get and put latency with and without the patch using reasonable hbase.ipc.warn.response.time settings (1000ms, 2000ms). Performance was not noticeably impacted.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Riley&lt;/p&gt;
</comment>
                            <comment id="13089861" author="riley" created="Tue, 23 Aug 2011 23:12:27 +0000"  >&lt;p&gt;Addressed many of the comments and suggestions from this thread.&lt;/p&gt;

&lt;p&gt;Also posted on: &lt;a href=&quot;https://reviews.apache.org/r/1621/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1621/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13091556" author="jiraposter@reviews.apache.org" created="Fri, 26 Aug 2011 04:01:29 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1621/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1621/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-08-26 04:00:49.869021)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Several code-cleanup related changes.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Exposes JSON-parseable fingerprint and details for queries that take longer than a configurable threshold time. The exposure is currently to the main regionserver log, along with a (operationTooSlow) tag which allows it to be grepped out and easily aggregated and/or monitored in administrator scripts.&lt;/p&gt;

&lt;p&gt;The patch also provides a standard way to extract fingerprint and detail information of interest by requiring each &quot;Operation&quot; to provide a fingerprint map and a details map, which will be a superset of the fingerprint. &lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4117&quot; title=&quot;Slow Query Log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4117&quot;&gt;&lt;del&gt;HBASE-4117&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4117&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4117&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/KeyValue.java 1161979 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/Delete.java 1161979 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/Get.java 1161979 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/MultiAction.java 1161979 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/MultiPut.java 1161979 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/Operation.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/Put.java 1161979 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/Scan.java 1161979 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 1161979 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 1161979 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestOperation.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1621/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1621/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Monitored get and put latency with and without the patch using reasonable hbase.ipc.warn.response.time settings (1000ms, 2000ms). Performance was not noticeably impacted.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Riley&lt;/p&gt;
</comment>
                            <comment id="13091559" author="riley" created="Fri, 26 Aug 2011 04:03:45 +0000"  >&lt;p&gt;Small code-cleanup changes.&lt;/p&gt;</comment>
                            <comment id="13092185" author="jiraposter@reviews.apache.org" created="Sat, 27 Aug 2011 03:47:28 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1621/#review1669&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1621/#review1669&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1621/#comment3771&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1621/#comment3771&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why remove this stuff Riley?  Seems useful?  Or, looks like you moved it.  What you thinking?  Move it out of the generic into the specific implementation engine?&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1621/#comment3772&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1621/#comment3772&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    nice&lt;/p&gt;

&lt;p&gt;    Doing check for both too large and too slow&lt;/p&gt;

&lt;p&gt;    I suppose this answers my previous question.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-08-26 04:00:49, Riley Patterson wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1621/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1621/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-08-26 04:00:49)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Exposes JSON-parseable fingerprint and details for queries that take longer than a configurable threshold time. The exposure is currently to the main regionserver log, along with a (operationTooSlow) tag which allows it to be grepped out and easily aggregated and/or monitored in administrator scripts.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The patch also provides a standard way to extract fingerprint and detail information of interest by requiring each &quot;Operation&quot; to provide a fingerprint map and a details map, which will be a superset of the fingerprint. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4117&quot; title=&quot;Slow Query Log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4117&quot;&gt;&lt;del&gt;HBASE-4117&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4117&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4117&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/KeyValue.java 1161979 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/Delete.java 1161979 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/Get.java 1161979 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/MultiAction.java 1161979 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/MultiPut.java 1161979 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/Operation.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/Put.java 1161979 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/Scan.java 1161979 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java 1161979 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java 1161979 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestOperation.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1621/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1621/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Monitored get and put latency with and without the patch using reasonable hbase.ipc.warn.response.time settings (1000ms, 2000ms). Performance was not noticeably impacted.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Riley&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13092188" author="stack" created="Sat, 27 Aug 2011 04:02:02 +0000"  >&lt;p&gt;Nice one Riley.  Committed to TRUNK (For future, be careful on the white space.. I cleaned it up before commit).&lt;/p&gt;</comment>
                            <comment id="13092219" author="hudson" created="Sat, 27 Aug 2011 07:58:22 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2151 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2151/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2151/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4117&quot; title=&quot;Slow Query Log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4117&quot;&gt;&lt;del&gt;HBASE-4117&lt;/del&gt;&lt;/a&gt;  Slow Query Log and Client Operation Fingerprints&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/KeyValue.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/Delete.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/Get.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/MultiAction.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/MultiPut.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/Operation.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/Put.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/Scan.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/WritableRpcEngine.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestOperation.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13100462" author="riley" created="Thu, 8 Sep 2011 17:11:19 +0000"  >&lt;p&gt;A basic, user-manual type of document describing the feature, its use, its configuration, and grokking its output.&lt;/p&gt;</comment>
                            <comment id="13191882" author="hudson" created="Tue, 24 Jan 2012 04:49:39 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2645 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2645/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2645/&lt;/a&gt;)&lt;br/&gt;
    Add Riley&apos;s slow query doc from hbase-4117&lt;/p&gt;</comment>
                            <comment id="13191939" author="hudson" created="Tue, 24 Jan 2012 06:34:38 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #86 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/86/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/86/&lt;/a&gt;)&lt;br/&gt;
    Add Riley&apos;s slow query doc from hbase-4117&lt;/p&gt;</comment>
                            <comment id="15016571" author="lars_francke" created="Fri, 20 Nov 2015 11:55:46 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12493623" name="HBASE-4117-doc.txt" size="3440" author="riley" created="Thu, 8 Sep 2011 17:11:19 +0000"/>
                            <attachment id="12491405" name="HBASE-4117-v2.patch" size="44850" author="riley" created="Tue, 23 Aug 2011 23:12:27 +0000"/>
                            <attachment id="12491730" name="HBASE-4117-v3.patch" size="45209" author="riley" created="Fri, 26 Aug 2011 04:03:45 +0000"/>
                            <attachment id="12490505" name="HBASE-4117.patch" size="41252" author="riley" created="Tue, 16 Aug 2011 05:31:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 Aug 2011 14:00:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33378</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05i0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30015</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Exposes JSON-parseable fingerprint and details for queries that take longer than a configurable threshold time. The exposure is currently to the main regionserver log, along with a (queryTooSlow) tag which allows it to be grepped out and easily aggregated and/or monitored in adminstrator scripts.&lt;br/&gt;
&lt;br/&gt;
The patch also provides a standard way to extract fingerprint and detail information of interest by requiring each &amp;quot;DatabaseCommand&amp;quot; to provide a fingerprint map and a details map, which will be a superset of the fingerprint.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>