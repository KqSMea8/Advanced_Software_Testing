<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:00:41 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2295/HBASE-2295.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2295] Row locks may deadlock with themselves</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2295</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Row locks in HRegion are keyed by a int-sized hash of the row key. It&apos;s perfectly possible for two rows to hash to the same key. So, if any client tries to lock both rows, it will deadlock with itself. Switching to a 64-bit hash is an improvement but still sketchy.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12458313">HBASE-2295</key>
            <summary>Row locks may deadlock with themselves</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dhruba">dhruba borthakur</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Fri, 5 Mar 2010 23:31:34 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:37 +0000</updated>
                            <resolved>Tue, 9 Mar 2010 17:11:23 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="12842465" author="dhruba" created="Sun, 7 Mar 2010 19:09:59 +0000"  >&lt;p&gt;are you talking about the multiPut where multiple rows could be updated atomically by an app? &lt;/p&gt;</comment>
                            <comment id="12842490" author="ryanobjc" created="Sun, 7 Mar 2010 22:02:28 +0000"  >&lt;p&gt;The multiput does not promise nor do multi row atomic puts. It actually just&lt;br/&gt;
calls the array put API.&lt;/p&gt;

&lt;p&gt;On Mar 7, 2010 11:11 AM, &quot;dhruba borthakur (JIRA)&quot; &amp;lt;jira@apache.org&amp;gt; wrote:&lt;/p&gt;


&lt;p&gt;   [&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2295?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=12842465#action_12842465&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2295?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=12842465#action_12842465&lt;/a&gt;]&lt;/p&gt;

&lt;p&gt;dhruba borthakur commented on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2295&quot; title=&quot;Row locks may deadlock with themselves&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2295&quot;&gt;&lt;del&gt;HBASE-2295&lt;/del&gt;&lt;/a&gt;:&lt;br/&gt;
-----------------------------------------&lt;/p&gt;

&lt;p&gt;are you talking about the multiPut where multiple rows could be updated&lt;br/&gt;
atomically by an app?&lt;/p&gt;

&lt;p&gt;perfectly possible for two rows to hash to the same key. So, if any client&lt;br/&gt;
tries to lock both rows, it will deadlock with itself. Switching to a 64-bit&lt;br/&gt;
hash is an improvement but still sketchy.&lt;/p&gt;

&lt;p&gt;&amp;#8211;&lt;br/&gt;
This message is automatically generated by JIRA.&lt;br/&gt;
-&lt;br/&gt;
You can reply to this email to add a comment to the issue online.&lt;/p&gt;</comment>
                            <comment id="12842565" author="dhruba" created="Mon, 8 Mar 2010 08:00:44 +0000"  >&lt;p&gt;1. Changed locksToRows to be a Set (instead of a Map)&lt;br/&gt;
2. Generate sequential lockids, and in the case of collision use a Random number to start from a new origin&lt;/p&gt;</comment>
                            <comment id="12842572" author="dhruba" created="Mon, 8 Mar 2010 08:17:47 +0000"  >&lt;p&gt;The patch I uploaded is for hbase 0.20.&lt;/p&gt;

&lt;p&gt;BTW, when I downloaded the hbase trunk, I do not see any build.xml files in the source repo at all. Do I need to use something other than &quot;ant test&quot;?&lt;/p&gt;</comment>
                            <comment id="12842774" author="tlipcon" created="Mon, 8 Mar 2010 19:16:23 +0000"  >&lt;p&gt;Hey Dhruba,&lt;/p&gt;

&lt;p&gt;I don&apos;t think this patch works right. You can&apos;t have a HashSet&amp;lt;byte[]&amp;gt; since byte[]&apos;s hashcode is identity based, not content, right?&lt;/p&gt;</comment>
                            <comment id="12842797" author="dhruba" created="Mon, 8 Mar 2010 20:01:43 +0000"  >&lt;p&gt;I agree, that is the case for all native items like byte[]. I will change it.&lt;/p&gt;</comment>
                            <comment id="12842839" author="stack" created="Mon, 8 Mar 2010 23:03:39 +0000"  >&lt;p&gt;@Dhruba &lt;/p&gt;

&lt;p&gt;If you want to use a SortedSet and pass a comparator instead, so you can retain byte [] elements, there is a bytes comparator here: &lt;a href=&quot;http://hadoop.apache.org/hbase/docs/r0.20.3/api/org/apache/hadoop/hbase/util/Bytes.html#BYTES_COMPARATOR&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hadoop.apache.org/hbase/docs/r0.20.3/api/org/apache/hadoop/hbase/util/Bytes.html#BYTES_COMPARATOR&lt;/a&gt;  Otherwise, patch looks good.&lt;/p&gt;

&lt;p&gt;Regards TRUNK, its been mavenized so to build it, you need maven &amp;#8211; see &lt;a href=&quot;http://wiki.apache.org/hadoop/Hbase/MavenPrimer&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/hadoop/Hbase/MavenPrimer&lt;/a&gt; &amp;#8211; and then to build and run tests do something like mvn install&lt;/p&gt;</comment>
                            <comment id="12842964" author="dhruba" created="Tue, 9 Mar 2010 08:21:15 +0000"  >&lt;p&gt;This patch incorporates Todd&apos;s and Stack&apos;s comments. And is for hbase trunk.&lt;/p&gt;</comment>
                            <comment id="12843201" author="stack" created="Tue, 9 Mar 2010 17:11:23 +0000"  >&lt;p&gt;Committed to trunk and branch.  Thanks for patch Dhruba.&lt;/p&gt;</comment>
                            <comment id="12843219" author="tlipcon" created="Tue, 9 Mar 2010 18:25:32 +0000"  >&lt;p&gt;This already went in, but one quick note on the final patch: rather than checking locksToRows.size() &amp;gt; 0, it&apos;s probably faster to check !locksToRows.isEmpty()&lt;/p&gt;

&lt;p&gt;Does this need to be a followup JIRA?&lt;/p&gt;</comment>
                            <comment id="12843273" author="stack" created="Tue, 9 Mar 2010 20:23:26 +0000"  >&lt;p&gt;I agree isEmpty is better than size... I&apos;ll just put fix in under this issue.  Thanks Todd. &lt;/p&gt;

&lt;p&gt;I changed it to do this instead on trunk and branch:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.lockedRows.isEmpty()) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled()) {
          LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Waiting on &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.lockedRows.size() + &lt;span class=&quot;code-quote&quot;&gt;&quot; row locks&quot;&lt;/span&gt;);
        }
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12866874" author="stack" created="Wed, 12 May 2010 23:52:53 +0000"  >&lt;p&gt;Marking these as fixed against 0.21.0 rather than against 0.20.5.&lt;/p&gt;</comment>
                            <comment id="15017572" author="lars_francke" created="Fri, 20 Nov 2015 12:43:37 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12507520">HBASE-3894</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12438164" name="rowLockDeadlock.txt" size="3611" author="dhruba" created="Mon, 8 Mar 2010 08:00:44 +0000"/>
                            <attachment id="12438269" name="rowLockDeadlock2.txt" size="4542" author="dhruba" created="Tue, 9 Mar 2010 08:21:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 7 Mar 2010 19:09:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26247</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hh3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100034</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>