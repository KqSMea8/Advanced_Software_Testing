<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:45:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-533/HBASE-533.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-533] Region Historian</title>
                <link>https://issues.apache.org/jira/browse/HBASE-533</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Whenever we try to debug region splitting, assignment, compaction, etc. issues, we always end up having to look in 1-20 different log files for cryptic names of regions and try to piece together the chain of events ourselves. This is a challenging at best effort most of the time.&lt;/p&gt;

&lt;p&gt;What would be very useful would be a new utility I&apos;ve nicknamed the Region Historian. You give it the text name of a region, and it will track down the log messages relevant to it in the master and regionserver logs. Then, it will interleave the messages in such a way that the timestamps correctly list the order of events. The result is a log summary that accurately describes what happened to a region during it&apos;s lifetime, making it much easier to try and figure out where something went wrong.&lt;/p&gt;

&lt;p&gt;Other things it could do would be replace cryptic log messages with simple events like &quot;the region was split into a and b&quot;, &quot;the region was assigned to server x&quot;, and trace the lineage of a region backwards to its parent before it came into existence.&lt;/p&gt;

&lt;p&gt;I&apos;m sure there are other things we would think up that would be useful as well.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12391927">HBASE-533</key>
            <summary>Region Historian</summary>
                <type id="5" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Wish</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="bryanduxbury">Bryan Duxbury</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Mar 2008 23:37:48 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:12 +0000</updated>
                            <resolved>Wed, 4 Jun 2008 17:20:22 +0000</resolved>
                                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12598365" author="jdcryans" created="Tue, 20 May 2008 17:22:55 +0000"  >&lt;p&gt;I was re-reading the bigtable paper and at page five, just before section 5.2, they are describing how their meta table holds a log of all events pertaining to each tablet. I think this is exactly the same as this jira.&lt;/p&gt;</comment>
                            <comment id="12600527" author="jdcryans" created="Wed, 28 May 2008 16:54:00 +0000"  >&lt;p&gt;Question : should a region carry all the information of a parent region? Example : regions &apos;a&apos; and &apos;b&apos; are the production of a split from &apos;c&apos; so both would have, in their meta row, all &apos;c&apos; events. &lt;/p&gt;

&lt;p&gt;If no, this means that this information will be missing.&lt;/p&gt;</comment>
                            <comment id="12600536" author="stack" created="Wed, 28 May 2008 17:16:49 +0000"  >&lt;p&gt;For completeness, yeah, sounds like daughters should include events that happen their parent.&lt;/p&gt;

&lt;p&gt;I think the only parent &apos;event&apos; that would appear in the daughter log would be delete?  This would happen after both daughters have let go of their references?&lt;/p&gt;
</comment>
                            <comment id="12600560" author="jdcryans" created="Wed, 28 May 2008 18:29:04 +0000"  >&lt;p&gt;The parent event that would appear would be something like &quot;region split from c&quot;.&lt;/p&gt;

&lt;p&gt;So I will put the parent information. To be sure that there is no confusion, I will put parent&apos;s name in [  ] before the description of the event.&lt;/p&gt;</comment>
                            <comment id="12600575" author="jdcryans" created="Wed, 28 May 2008 18:52:39 +0000"  >&lt;p&gt;Example ouput of a region that is the product of 2 splits :&lt;/p&gt;


&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Timestamp&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Event&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Description&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:30:59&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	creation	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999459183&amp;#93;&lt;/span&gt; Region creation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:31:00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	creation	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999459183&amp;#93;&lt;/span&gt; Region creation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:31:00&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	compaction	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999459183&amp;#93;&lt;/span&gt; Region compaction&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:31:03&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	open	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999459183&amp;#93;&lt;/span&gt; Region opened on server : lasi-jd&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:31:48&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	compaction	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999459183&amp;#93;&lt;/span&gt; Region compaction&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:32:21&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	compaction	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999459183&amp;#93;&lt;/span&gt; Region compaction&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:33:47&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	compaction	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999459183&amp;#93;&lt;/span&gt; Region compaction&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:34:23&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	compaction	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999459183&amp;#93;&lt;/span&gt; Region compaction&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:34:37&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	creation	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; Region creation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:34:37&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	split	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; Region split from : loading,,1211999459183&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:34:38&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	creation	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; Region creation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:34:41&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	open	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; Region opened on server : lasi-jd&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:35:56&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	compaction	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; Region compaction&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:39:07&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	compaction	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; Region compaction&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:45:48&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	compaction	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;loading,,1211999664938&amp;#93;&lt;/span&gt; Region compaction&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:45:56&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	creation	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Region creation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:45:56&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	split	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Region split from : loading,,1211999664938&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:45:59&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	creation	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Region creation&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Wed, 28 May 2008 14:46:03&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;	open	&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Region opened on server : lasi-jd&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
</comment>
                            <comment id="12600591" author="jdcryans" created="Wed, 28 May 2008 20:13:19 +0000"  >&lt;p&gt;Not for review, I just want you guys to try it. Check if enough information is gathered and if the Singleton is OK.&lt;/p&gt;</comment>
                            <comment id="12600636" author="stack" created="Wed, 28 May 2008 22:49:17 +0000"  >&lt;p&gt;Patch is missing regionserver.jsp so couldn&apos;t try it.&lt;/p&gt;

&lt;p&gt;In your sample above, why two creations of same region?  Then later, same region is created again (I&apos;m guessing you copy/pasted this table together just as an illustration?).  I might not be reading the table correctly.&lt;/p&gt;

&lt;p&gt;If compactions, I wonder if we shouldn&apos;t have flushes also?  Maybe compactions/flushes should include how many files compacted and time taken?  Then again, thinking on it, we have an instance with thousands of regions.  Maybe that&apos;d be too much?    Thousands of regions reporting their compactions, etc., will put up a heavy load on .META. table.  Maybe we shouldn&apos;t report compactions, just the significant region events by default.    Later we can make the amount of detail recorded by the historian adjustable.  Next level of detail would include compactions.  Above that again, it would include flushes.  At finest detail, would record hits per minute, etc.&lt;/p&gt;

&lt;p&gt;Here&apos;s a few comments on the patch:&lt;/p&gt;

&lt;p&gt;+ Move this comment &quot;+  /** The Region Historian task is to keep track of every modification a region...&quot; to be the class comment for RegionHistorian.&lt;br/&gt;
+ Maybe hide the singleton aspect of RegionHistorian inside the class.  Rather than have clients call &apos;RegionHistorian.getInstance().addRegionOpen...&apos;, instead have them call RegionHistorian.addRegionOpen... and then inside the method, you&apos;d do your singleton thing.&lt;br/&gt;
+ What you need here:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      /* TODO
+       * REGION_HISTORIAN_KEYS is used because there is no other &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the moment 
+       * to retrieve all version and to have the column key information. To be changed
+       * when HTable.getRow handles versions.
+       */
+      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] columnKey : REGION_HISTORIAN_KEYS) {
+        Cell[] cells = metaTable.get(Bytes.toBytes(regionName), columnKey,
+            ALL_VERSIONS);
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A getRows that would return all members of a column family, all versions?&lt;/p&gt;

&lt;p&gt;+ Could event types be done as enums?  E.g. REGION_CREATION, etc.&lt;br/&gt;
+ Change these to LOG.info/debug:  System.out.println&lt;/p&gt;

&lt;p&gt;Otherwise, this patch looks really great &amp;#8211; very sweet feature.&lt;/p&gt;</comment>
                            <comment id="12600645" author="jdcryans" created="Wed, 28 May 2008 23:43:33 +0000"  >&lt;p&gt;Added missing file (regionhistorian.jsp)&lt;/p&gt;

&lt;p&gt;The sample is taken from the regionhistorian page. It does have two creations like if two HRegion were created for a single one (the constructor is called two times so I guess two different objects with same name). I thought someone would explain this to me instead of searching why &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I buy the level of detail idea, should I make it static or dynamic?&lt;/p&gt;

&lt;p&gt;Regards the getRow comment, it is to me related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-33&quot; title=&quot;Add a HTable get/obtainScanner method that retrieves all versions of a particular column and row between two timestamps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-33&quot;&gt;&lt;del&gt;HBASE-33&lt;/del&gt;&lt;/a&gt;. Having a getRow method that returns everything it contains is, IMO, logic.&lt;/p&gt;

&lt;p&gt;Sorry for the sysouts, it is my personnal debug info, won&apos;t be there in a review version of this patch.&lt;/p&gt;</comment>
                            <comment id="12600682" author="stack" created="Thu, 29 May 2008 05:29:19 +0000"  >&lt;p&gt;Here&apos;s a sample from a run internal here...&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Timestamp	Event	Description
Thu, 29 May 2008 05:07:48	compaction	Region compaction
Thu, 29 May 2008 05:07:34	open	Region opened on server : aa0-000-13.u.powerset.com
Thu, 29 May 2008 05:07:31	creation	Region creation
Thu, 29 May 2008 05:07:29	split	Region split from : TestTable,0000097920,1212037574001
Thu, 29 May 2008 05:07:29	creation	Region creation
Thu, 29 May 2008 05:07:28	compaction	[TestTable,0000097920,1212037574001] Region compaction
Thu, 29 May 2008 05:06:48	compaction	[TestTable,0000097920,1212037574001] Region compaction
Thu, 29 May 2008 05:06:21	compaction	[TestTable,0000097920,1212037574001] Region compaction
Thu, 29 May 2008 05:06:18	open	[TestTable,0000097920,1212037574001] Region opened on server : aa0-000-13.u.powerset.com
Thu, 29 May 2008 05:06:15	creation	[TestTable,0000097920,1212037574001] Region creation
Thu, 29 May 2008 05:06:14	split	[TestTable,0000097920,1212037574001] Region split from : TestTable,,1212037455955
Thu, 29 May 2008 05:06:14	creation	[TestTable,0000097920,1212037574001] Region creation
Thu, 29 May 2008 05:06:13	compaction	[TestTable,0000097920,1212037574001] [TestTable,,1212037455955] Region compaction
Thu, 29 May 2008 05:05:54	compaction	[TestTable,0000097920,1212037574001] [TestTable,,1212037455955] Region compaction
Thu, 29 May 2008 05:05:18	compaction	[TestTable,0000097920,1212037574001] [TestTable,,1212037455955] Region compaction
Thu, 29 May 2008 05:04:55	compaction	[TestTable,0000097920,1212037574001] [TestTable,,1212037455955] Region compaction
Thu, 29 May 2008 05:04:21	open	[TestTable,0000097920,1212037574001] [TestTable,,1212037455955] Region opened on server : aa0-000-13.u.powerset.com
Thu, 29 May 2008 05:04:18	compaction	[TestTable,0000097920,1212037574001] [TestTable,,1212037455955] Region compaction
Thu, 29 May 2008 05:04:18	creation	[TestTable,0000097920,1212037574001] [TestTable,,1212037455955] Region creation
Thu, 29 May 2008 05:04:16	creation	[TestTable,0000097920,1212037574001] [TestTable,,1212037455955] Region creation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks great.&lt;/p&gt;

&lt;p&gt;Yeah, I&apos;d say drop the compactions.&lt;/p&gt;

&lt;p&gt;I also wonder about listing parent events in the daughters.   A daughter from a good family who can trace her roots all the ways back to the pilgrims will have a long line in the table above.  I think listing just the immediate parent is sufficient, at least for the first version.&lt;/p&gt;

&lt;p&gt;What about listing the event source?  Most edits will be by the master but the splits will be done by the splitting regionserver.&lt;/p&gt;

&lt;p&gt;Regards double creations, I&apos;d guess its not two creations &amp;#8211; just two invocations of the HRegion constructor.   Opening and creating both call new HRegion.   You might move our call to addRegionCreation out of the HRegion constructor and instead put it into HRegion.createHRegion (if this is appropriately called in all places a region is initially created).&lt;/p&gt;

&lt;p&gt;Dynamic would be nice &amp;#8211; like log level?   Tying it to loglevel would make your flag easy to implement: e.g. send compaction/flush notice when at DEBUG.   Bad thing about tying it to loglevel doesn&apos;t have sufficient granularity.  There&apos;s effectively INFO and DEBUG.  What you think?&lt;/p&gt;

&lt;p&gt;Good on you J-D&lt;/p&gt;
</comment>
                            <comment id="12600767" author="jdcryans" created="Thu, 29 May 2008 13:27:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;I also wonder about listing parent events in the daughters. A daughter from a good family who can trace her roots all the ways back to the pilgrims will have a long line in the table above. I think listing just the immediate parent is sufficient, at least for the first version.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Or we can put the depth of history to keep as a parameter? Static or dynamic? For the moment, I think it could just be a new conf in hbase-defaults.xml with value at 1.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What about listing the event source? Most edits will be by the master but the splits will be done by the splitting regionserver.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If it&apos;s constant eg splits always on regionserver and creation always by master, I don&apos;t think we need it. I see a case where this would be a problem. For example, a user that never saw the code and for some reason uses this information, he would need to know that. But since this feature is for devs purpose and we know how it works, it shouldn&apos;t be a problem. Your opinion?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Regards double creations, I&apos;d guess its not two creations - just two invocations of the HRegion constructor. Opening and creating both call new HRegion. You might move our call to addRegionCreation out of the HRegion constructor and instead put it into HRegion.createHRegion (if this is appropriately called in all places a region is initially created).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll debug that.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Dynamic would be nice - like log level? Tying it to loglevel would make your flag easy to implement: e.g. send compaction/flush notice when at DEBUG. Bad thing about tying it to loglevel doesn&apos;t have sufficient granularity. There&apos;s effectively INFO and DEBUG. What you think?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good idea, for the first version I&apos;ll do it like that. We&apos;ll see if we need more in the future.&lt;/p&gt;


&lt;p&gt;Good stuff.&lt;/p&gt;</comment>
                            <comment id="12600787" author="stack" created="Thu, 29 May 2008 14:46:55 +0000"  >&lt;p&gt;On depth, are parent logs ending up in the daughter table entries or is it, IIRC, that you create the page by doing selects first for daughter, then for parent, etc.?  If so, how about putting parent logs in their own table below the current regions?  Set a static as you suggest in the conf. for how many regions to list in the history page.&lt;/p&gt;

&lt;p&gt;Regards event source, OK.   Add a bit of text to the end of the page that says this perhaps?&lt;/p&gt;

&lt;p&gt;On split event, should include the address of parent region as well as name of parent region, I&apos;d suggest.&lt;/p&gt;

&lt;p&gt;Sometimes compactions do nothing.  Perhaps we shouldn&apos;t log such events.  Might be hard to do since compactions happen down in stores.&lt;/p&gt;

&lt;p&gt;This morning I&apos;m thinking that tying region history to log level setting might not be the best idea but for the first version, its probably ok.  We can always change it after we get this feature in.&lt;/p&gt;
</comment>
                            <comment id="12600790" author="jdcryans" created="Thu, 29 May 2008 14:56:08 +0000"  >&lt;p&gt;Parents logs end up in the daughter entries because they are deleted from .META. so if depth is set to 1, we will lose information all that time. Setting to two 2 after a reboot won&apos;t recover information.&lt;/p&gt;

&lt;p&gt;Ok for the text.&lt;/p&gt;

&lt;p&gt;Ok for the split with the address, I&apos;lls see what I can do. It will be the same for merge.&lt;/p&gt;

&lt;p&gt;Regards compaction, I just included the time it took and just as Google with Bigtable, this can be useful to asses performance. So I suggest we keep it in the DEBUG level.&lt;/p&gt;

&lt;p&gt;Regards log level, it&apos;s already in my code and it took 2 lines. Won&apos;t be hard to modify.&lt;/p&gt;</comment>
                            <comment id="12600840" author="jdcryans" created="Thu, 29 May 2008 17:13:08 +0000"  >&lt;p&gt;Corrected all issues except the one were the split should have it&apos;s parent address. This information is unavailable.&lt;/p&gt;

&lt;p&gt;I will need to write a migration script for the .META. table.&lt;/p&gt;</comment>
                            <comment id="12600872" author="stack" created="Thu, 29 May 2008 18:37:25 +0000"  >&lt;p&gt;Should we just let this exception out rather than catch it:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
+      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to create RegionHistorian&quot;&lt;/span&gt;, ioe);
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maybe these are not all needed &amp;#8211; +    getInstance(); &amp;#8211; especially when method calls cascade... just call it in the method that terminates the cascade: i.e. the &apos;add&apos; method (Minor issue).&lt;/p&gt;

&lt;p&gt;Remove the commented out code in RegionHistorian&lt;/p&gt;

&lt;p&gt;Perhaps make this class private and static (unless it has dependency on hosting class):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class RegionHistoryInformation &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt;
+  Comparable&amp;lt;RegionHistoryInformation&amp;gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Otherwise, patch looks good.&lt;/p&gt;

&lt;p&gt;Lets get the migration added before we apply?  Unless you want to do that as separate task.  If so, open new issue and I&apos;ll commit this.&lt;/p&gt;

&lt;p&gt;Migrating, hopefully you can use MetaUtils.  If facility is missing, let me know and I&apos;ll add it for you.&lt;/p&gt;</comment>
                            <comment id="12600880" author="stack" created="Thu, 29 May 2008 18:51:51 +0000"  >&lt;p&gt;Looking at UI, I see this: &apos;Region split from : TestTable,,1212086527721 from server&apos; (the &apos;from server&apos; looks like it should be removed)&lt;/p&gt;

&lt;p&gt;Put these two lines on a single line:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Master is the source of following events : creation,open,assignment

Regions are the source of following events : split,merge,compaction
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Does the region run merges?  You should add flush.  Do you mean RegionServer in the above rather than Regions?&lt;/p&gt;

&lt;p&gt;There are no creations any more.  Is that because happens elsewhere &amp;#8211; in parent? &amp;#8211; so doesn&apos;t show in a particular region.&lt;/p&gt;

&lt;p&gt;A few times I clicked on a region that had been meantime been offlined (split).  Rather than an empty table, perhaps a message that says region no longer exists (And don&apos;t print the legend about master and regionserver if no events)&lt;/p&gt;</comment>
                            <comment id="12600883" author="jdcryans" created="Thu, 29 May 2008 19:02:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;Lets get the migration added before we apply? Unless you want to do that as separate task. If so, open new issue and I&apos;ll commit this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, before.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Does the region run merges? You should add flush. Do you mean RegionServer in the above rather than Regions?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;package region&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;There are no creations any more. Is that because happens elsewhere - in parent? - so doesn&apos;t show in a particular region.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There is, look at a region that was created with a table. Regions that are created from a split don&apos;t pass by HRegion.createHRegion. Rebooting your cluster will also put creations in all regions.&lt;/p&gt;


&lt;p&gt;I&apos;m OK with the rest.&lt;/p&gt;
</comment>
                            <comment id="12601145" author="jdcryans" created="Fri, 30 May 2008 14:25:48 +0000"  >&lt;p&gt;Regards RegionHistoryInformation, it is just a &quot;nice&quot; class carrying information that we get out of .META. so has to be public or it would be useless. regionhistorian.jsp is currently using it.&lt;/p&gt;

&lt;p&gt;Regards region creations, it only happens when a table is created. Should it be removed?&lt;/p&gt;

&lt;p&gt;Also I see that I forgot to process regions assignment, this will be included in the next patch.&lt;/p&gt;

&lt;p&gt;Regards the exception catch in RegionHistorian contructor, I think that if this fails, it will fail elsewhere since the line throwing it is :&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;      metaTable = new HTable(conf, META_TABLE_NAME);&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Regards merge, where is it thrown?&lt;/p&gt;</comment>
                            <comment id="12601193" author="stack" created="Fri, 30 May 2008 16:38:38 +0000"  >&lt;p&gt;On the above, I&apos;d say leave region creation in even if happens only on table creation.  Regards merge, I was saying that the help text on the historian page says that region runs merges.   Thats not strictly true.&lt;/p&gt;</comment>
                            <comment id="12601626" author="jdcryans" created="Mon, 2 Jun 2008 14:01:04 +0000"  >&lt;p&gt;Needed for the migration script.&lt;/p&gt;</comment>
                            <comment id="12601732" author="jdcryans" created="Mon, 2 Jun 2008 19:24:39 +0000"  >&lt;p&gt;Added the migration script&lt;/p&gt;</comment>
                            <comment id="12601799" author="stack" created="Tue, 3 Jun 2008 00:52:12 +0000"  >&lt;p&gt;v4 includes changes to migration&lt;/p&gt;

&lt;p&gt;There were at least three issues w/ migration as it was:&lt;/p&gt;

&lt;p&gt;+ regionhistorian wanted to add to the .META. table.  hbase-660 didn&apos;t support .META. edits.&lt;br/&gt;
+ The way the regionhistorian migration was written, it was running even when the migration was in &apos;check&apos; mode: i.e. readOnly.  It was using metautils to add the new column only the filesystem hadn&apos;t been migrated yet so we weren&apos;t finding original region; instead we were making a new one, one without a meta.  We were blind to the old data.&lt;br/&gt;
+ Migrate had a bunch of shared state across migration steps with possibility that migration done in one step could be overwritten by migration done later&lt;/p&gt;

&lt;p&gt;Here are changes I made to v3 to make v4:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HConstants
  I made the FILE_SYSTEM_VERSION &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt;.

M src/java/org/apache/hadoop/hbase/util/MetaUtils.java
  Made it so pattern is now a MetaUtils instance per migration step rather than one &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; whole migration
  Made initialiize &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; and called by constructor.
  Made all methods call getLog; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; doesn&apos;t exist, its created.  Makes it so we&apos;ll have a log when needed.
  (getMETARows): Renamed from getMETARowsInROOT.  Now takes a tablename.  Returns root
  region or list of .META. regions.
M src/java/org/apache/hadoop/hbase/util/Migrate.java
  Added documentation to &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; and give better sense of how &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; thing is supposed to work -- the
   different modes, etc., and dangers.
   Removed data members.  Make info local to migration steps so less shared state.
   Moved code out of run into small coherent methods so its easier to see whats going on.
   Added &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; migration step from v2 to v3.
   Removed the MetaUtils that spanned total migration. Instead let migration steps go get it as needed.
   Changed the historian migration adding a check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we need to migrate.
M src/java/org/apache/hadoop/hbase/util/FSUtils.java
  (getRootDir): Added.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12601903" author="jdcryans" created="Tue, 3 Jun 2008 12:10:50 +0000"  >&lt;p&gt;Now it explains everything. Thank you stack for your help!&lt;/p&gt;</comment>
                            <comment id="12602044" author="jdcryans" created="Tue, 3 Jun 2008 19:50:20 +0000"  >&lt;p&gt;loader.jsp is in the patch, want me to clean it and explain what it does in a paragraph?&lt;/p&gt;

&lt;p&gt;util.Merge is missing and it is affected by initialize privatization.&lt;/p&gt;</comment>
                            <comment id="12602047" author="jdcryans" created="Tue, 3 Jun 2008 19:55:32 +0000"  >&lt;p&gt;Ok will fix both.&lt;/p&gt;</comment>
                            <comment id="12602058" author="jdcryans" created="Tue, 3 Jun 2008 20:22:35 +0000"  >&lt;p&gt;Works for me. Corrected loader and util.merge.&lt;/p&gt;</comment>
                            <comment id="12602350" author="jdcryans" created="Wed, 4 Jun 2008 17:07:17 +0000"  >&lt;p&gt;Forgot historian class and jsp&lt;/p&gt;</comment>
                            <comment id="12602365" author="stack" created="Wed, 4 Jun 2008 17:20:22 +0000"  >&lt;p&gt;Committed.  Thanks for the sweet patch J-D&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12397214">HBASE-660</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12382987" name="hbase-533-v1-fix.patch" size="22617" author="jdcryans" created="Wed, 28 May 2008 23:43:33 +0000"/>
                            <attachment id="12382959" name="hbase-533-v1.patch" size="19046" author="jdcryans" created="Wed, 28 May 2008 20:13:19 +0000"/>
                            <attachment id="12383034" name="hbase-533-v2.patch" size="23793" author="jdcryans" created="Thu, 29 May 2008 17:13:08 +0000"/>
                            <attachment id="12383242" name="hbase-533-v3.patch" size="25434" author="jdcryans" created="Mon, 2 Jun 2008 19:24:39 +0000"/>
                            <attachment id="12383269" name="hbase-533-v4.patch" size="56352" author="stack" created="Tue, 3 Jun 2008 00:52:12 +0000"/>
                            <attachment id="12383318" name="hbase-533-v5.patch" size="41798" author="jdcryans" created="Tue, 3 Jun 2008 20:22:35 +0000"/>
                            <attachment id="12383398" name="hbase-533-v6.patch" size="53070" author="jdcryans" created="Wed, 4 Jun 2008 17:07:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 20 May 2008 17:22:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31746</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 29 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h7vr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98539</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>