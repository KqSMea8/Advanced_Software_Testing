<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:16:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4175/HBASE-4175.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4175] Fix FSUtils.createTableDescriptor()</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4175</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently createTableDescriptor() doesn&apos;t return anything.&lt;br/&gt;
The caller wouldn&apos;t know whether the descriptor is created or not. See exception handling:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt;(IOException ioe) {
     LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;IOException &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; trying to create tableInfo in HDFS&quot;&lt;/span&gt;, ioe);
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We should return a boolean.&lt;/p&gt;

&lt;p&gt;If the table descriptor exists already, maybe we should deserialize from hdfs and compare with htableDescriptor argument. If they differ, I am not sure what the proper action would be.&lt;/p&gt;

&lt;p&gt;Maybe we can add a boolean argument, force, to createTableDescriptor(). When force is true, existing table descriptor would be overwritten.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12518135">HBASE-4175</key>
            <summary>Fix FSUtils.createTableDescriptor()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Sun, 7 Aug 2011 14:04:01 +0000</created>
                <updated>Fri, 19 Aug 2011 05:18:44 +0000</updated>
                            <resolved>Fri, 19 Aug 2011 05:18:44 +0000</resolved>
                                    <version>0.92.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13083132" author="ram_krish" created="Thu, 11 Aug 2011 14:28:51 +0000"  >&lt;p&gt;@Ted,&lt;br/&gt;
I was anlysing the createTableDescriptor() api.  We will be needing a return type to know whether table creating was successful or not.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;If the table descriptor exists already, maybe we should deserialize from hdfs and compare with htableDescriptor argument. If they differ, I am not sure what the proper action would be.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Once we return a boolean to say whether table creation is successful or not&lt;br/&gt;
is there any way to get the same table with same descriptor details. Because we say TableAlreadyExists if we try getting the same table creation command.&lt;/p&gt;

&lt;p&gt;Pls correct me on my understanding if am wrong.  And if you could give me more clarity to proceed on the defect.&lt;/p&gt;</comment>
                            <comment id="13083141" author="yuzhihong@gmail.com" created="Thu, 11 Aug 2011 14:49:02 +0000"  >&lt;p&gt;From FSTableDescriptors.get():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (htd == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-comment&quot;&gt;// More likely is above will &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; a FileNotFoundException
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TableExistsException(&lt;span class=&quot;code-quote&quot;&gt;&quot;No descriptor &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; + tablename);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So we can retrieve the same descriptor if it does exist.&lt;/p&gt;

&lt;p&gt;I think createTableDescriptor() should return an enum which contains the following:&lt;br/&gt;
FAIL_DUE_TO_IOE, FAIL_ALREADY_EXISTS, SUCCESS&lt;/p&gt;
</comment>
                            <comment id="13083149" author="yuzhihong@gmail.com" created="Thu, 11 Aug 2011 15:01:03 +0000"  >&lt;p&gt;For FAIL_DUE_TO_IOE, it would be useful to expose the IOE.&lt;br/&gt;
Tracing usage of createTableDescriptor(), I see that MasterFileSystem.createTableDescriptor() doesn&apos;t declare to throw IOE. But the only reference is MetaEditor.updateMetaWithNewRegionInfo() which throws IOException:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        masterServices.getMasterFileSystem().createTableDescriptor(hrfm.getTableDesc());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So we can still return boolean from FSUtils.createTableDescriptor() and let it throw IOE.&lt;/p&gt;</comment>
                            <comment id="13084062" author="ram_krish" created="Fri, 12 Aug 2011 12:18:08 +0000"  >&lt;p&gt;@Ted,&lt;br/&gt;
Currently as you mentioned FSUtils.createTableDescriptor() doesnot throw IOE.  So I will make it throw IOE.  &lt;br/&gt;
Reg if the table already exists there is a check &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (fs.exists(tableInfoPath)
          &amp;amp;&amp;amp; fs.getFileStatus(tableInfoPath).getLen() &amp;gt; 0) {
        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;TableInfo already exists.. Skipping creation&quot;&lt;/span&gt;);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So we need not add any FSTableDescriptor.get() I think. Pls suggest.&lt;/p&gt;

&lt;p&gt;Also what should be the behaviour if the table already exists.  As you had already told do we need to forcefully create? So for that we need to introduce a new api for forceful creation. &lt;br/&gt;
In my current patch I am planning to return true or false and if IOE happens will throw the IOE to the caller.&lt;/p&gt;
</comment>
                            <comment id="13084124" author="yuzhihong@gmail.com" created="Fri, 12 Aug 2011 13:48:54 +0000"  >&lt;p&gt;We should add boolean parameter, force, to FSUtils.createTableDescriptor().&lt;br/&gt;
If the table already exists and force parameter is false, FSUtils.createTableDescriptor() can simply return false.&lt;/p&gt;</comment>
                            <comment id="13085765" author="yuzhihong@gmail.com" created="Tue, 16 Aug 2011 15:02:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4175&quot; title=&quot;Fix FSUtils.createTableDescriptor()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4175&quot;&gt;&lt;del&gt;HBASE-4175&lt;/del&gt;&lt;/a&gt;_1.patch looks good overall.&lt;br/&gt;
In createTableDescriptor(FileSystem fs, ...) the catch block seems unnecessary:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
       LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;IOException &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; trying to create tableInfo in HDFS&quot;&lt;/span&gt;, ioe);
+      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; ioe;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13085846" author="ram_krish" created="Tue, 16 Aug 2011 17:00:59 +0000"  >&lt;p&gt;@Ted,&lt;br/&gt;
Actually there were 2 catch blocks with the same content.&lt;br/&gt;
I removed the first one that comes in &lt;br/&gt;
createTableDescriptor(HTableDescriptor htableDescriptor, Configuration conf,&lt;br/&gt;
      boolean forceCreation)&lt;br/&gt;
but did not remove it from &lt;br/&gt;
createTableDescriptor(FileSystem fs, Path rootdir,    HTableDescriptor htableDescriptor, boolean forceCreation)&lt;br/&gt;
-&amp;gt; This is because there are scenarios where we can directly use the second api for createTableDescriptor(In testcases it is getting used directly).  So we need some mechanism to know what exception has come.&lt;/p&gt;

&lt;p&gt;If we use the first createTableDescriptor() it is any way calling the second one so the catch block is not needed.&lt;br/&gt;
Is it ok Ted?&lt;/p&gt;</comment>
                            <comment id="13085892" author="stack" created="Tue, 16 Aug 2011 18:34:39 +0000"  >&lt;p&gt;Patch looks generally good to me.  You might fix some javadoc if you make another patch version and add doc&apos;ing of the new boolean return.  In future, you might add override that doesn&apos;t take the boolean which defaults to &apos;false&apos; then you would have had less code to change.  Good stuff Ram.&lt;/p&gt;</comment>
                            <comment id="13086151" author="ram_krish" created="Wed, 17 Aug 2011 05:40:15 +0000"  >&lt;p&gt;Thanks for your review Stack and Ted.&lt;br/&gt;
@Stack&lt;br/&gt;
Yes i could have done that.  Next time will not repeat this. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Will resubmit with the changes as you have suggested.&lt;/p&gt;</comment>
                            <comment id="13086256" author="ram_krish" created="Wed, 17 Aug 2011 12:02:29 +0000"  >&lt;p&gt;I have submitted two versions.  One with catch block and without catch block. Catch block i have mainly used for logging at one place and also limited the number of changes through default apis.&lt;/p&gt;</comment>
                            <comment id="13086325" author="yuzhihong@gmail.com" created="Wed, 17 Aug 2011 14:08:30 +0000"  >&lt;p&gt;+1 on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4175&quot; title=&quot;Fix FSUtils.createTableDescriptor()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4175&quot;&gt;&lt;del&gt;HBASE-4175&lt;/del&gt;&lt;/a&gt;_2_without catch block.patch&lt;/p&gt;

&lt;p&gt;Minor comment, the second F in ForceFul should be lower cased:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testShouldAllowForceFulCreationOfAlreadyExistingTableDescriptor()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13086424" author="ram_krish" created="Wed, 17 Aug 2011 16:13:57 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
Thanks for your review.&lt;/p&gt;

&lt;p&gt;Resubmitted the patch with the mentioned change.&lt;/p&gt;</comment>
                            <comment id="13086425" author="yuzhihong@gmail.com" created="Wed, 17 Aug 2011 16:19:22 +0000"  >&lt;p&gt;+1 on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4175&quot; title=&quot;Fix FSUtils.createTableDescriptor()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4175&quot;&gt;&lt;del&gt;HBASE-4175&lt;/del&gt;&lt;/a&gt;_3.patch&lt;/p&gt;</comment>
                            <comment id="13087165" author="stack" created="Thu, 18 Aug 2011 18:14:31 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13087219" author="yuzhihong@gmail.com" created="Thu, 18 Aug 2011 19:42:14 +0000"  >&lt;p&gt;Integrated to TRUNK.&lt;/p&gt;

&lt;p&gt;Thanks for the patch Ramkrishna.&lt;/p&gt;

&lt;p&gt;Thanks for the review Stack.&lt;/p&gt;</comment>
                            <comment id="13087325" author="hudson" created="Thu, 18 Aug 2011 21:55:18 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2124 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2124/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2124/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4175&quot; title=&quot;Fix FSUtils.createTableDescriptor()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4175&quot;&gt;&lt;del&gt;HBASE-4175&lt;/del&gt;&lt;/a&gt; Fix FSUtils.createTableDescriptor()&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/TestFSTableDescriptorForceCreation.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12490243" name="HBASE-4175.patch" size="5206" author="ram_krish" created="Fri, 12 Aug 2011 13:44:13 +0000"/>
                            <attachment id="12490536" name="HBASE-4175_1.patch" size="17049" author="ram_krish" created="Tue, 16 Aug 2011 14:43:30 +0000"/>
                            <attachment id="12490637" name="HBASE-4175_2_with catch block.patch" size="10207" author="ram_krish" created="Wed, 17 Aug 2011 12:00:23 +0000"/>
                            <attachment id="12490638" name="HBASE-4175_2_without catch block.patch" size="10247" author="ram_krish" created="Wed, 17 Aug 2011 12:00:48 +0000"/>
                            <attachment id="12490667" name="HBASE-4175_3.patch" size="10247" author="ram_krish" created="Wed, 17 Aug 2011 16:12:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 11 Aug 2011 14:28:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27204</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 18 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hpqf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101431</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>