<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:11:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3553/HBASE-3553.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3553] number of active threads in HTable&apos;s ThreadPoolExecutor</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3553</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Using a ThreadPoolExecutor with corePoolSize = 0 and using LinkedBlockingQueue as the collection to hold incoming runnable tasks seems to be having the effect of running only 1 thread, irrespective of the maxpoolsize set by reading the property hbase.htable.threads.max (or number of RS). (This is what I infer from reading source code of ThreadPoolExecutor class in 1.6)&lt;/p&gt;

&lt;p&gt;On a 3 node ec2 cluster, a full table scan with approx 9m rows results in almost similar timing with a sequential scanner (240 secs) and scanning with a Coprocessor (230 secs), that uses HTable&apos;s pool to  submit callable objects for each region. &lt;br/&gt;
I try to come up with a test class that creates a similar threadpool, and test that whether the pool size ever grows beyond 1. It also confirms that it remains 1 though it executed 100 requests.&lt;/p&gt;

&lt;p&gt;It seems the desired behavior was to release all resources when the client is done reading, but this can be achieved by setting allowCoreThreadTimeOut to true (after setting a +ve corePoolSize).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12499307">HBASE-3553</key>
            <summary>number of active threads in HTable&apos;s ThreadPoolExecutor</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="v.himanshu">Himanshu Vashishtha</assignee>
                                    <reporter username="v.himanshu">Himanshu Vashishtha</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Feb 2011 07:31:22 +0000</created>
                <updated>Fri, 20 Nov 2015 12:42:14 +0000</updated>
                            <resolved>Thu, 24 Feb 2011 22:37:54 +0000</resolved>
                                    <version>0.90.1</version>
                                    <fixVersion>0.90.2</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12997676" author="v.himanshu" created="Tue, 22 Feb 2011 07:34:06 +0000"  >&lt;p&gt;test class for ThreadPoolExecutor&apos;s usage&lt;/p&gt;</comment>
                            <comment id="12999062" author="ghelmling" created="Thu, 24 Feb 2011 21:27:14 +0000"  >&lt;p&gt;I tested this with an 8 slave cluster on EC2 to confirm the performance improvements.  After added multi-get support to YCSB, I see a throughput increase of 30-50% and avg. latency reduction of 22-34%, when correctly setting the thread pool size.  Some more detailed results are attached for anyone interested.&lt;/p&gt;

&lt;p&gt;One thing to note is that increasing the client YCSB threads from 16 to 32 actually decreased the differential from the single threaded pool, so 8 worker threads x 32 HTable instances was likely losing some performance due to client thread contention.  For clusters with highly concurrent clients (like webapps), it may be advantageous to tune down the &quot;hbase.htable.threads.max&quot; value from the default of &quot;# of region servers&quot;.  A future improvement could be to allow use of a shared, configurable thread pool as well.&lt;/p&gt;</comment>
                            <comment id="12999094" author="ghelmling" created="Thu, 24 Feb 2011 22:36:18 +0000"  >&lt;p&gt;Final patch committed to 0.90 branch and trunk (minor javadoc tweaks from review board version).&lt;/p&gt;</comment>
                            <comment id="12999095" author="ghelmling" created="Thu, 24 Feb 2011 22:37:54 +0000"  >&lt;p&gt;Committed to 0.90 branch and trunk.  Thanks for the patch, Himanshu!&lt;/p&gt;</comment>
                            <comment id="12999097" author="ryanobjc" created="Thu, 24 Feb 2011 22:42:26 +0000"  >&lt;p&gt;great results guys, I&apos;ll check out the patch later and commit it.&lt;/p&gt;

&lt;p&gt;We need to move away from thread pool executors for this kind of stuff, and avoid the problems.&lt;/p&gt;</comment>
                            <comment id="12999098" author="ryanobjc" created="Thu, 24 Feb 2011 22:43:00 +0000"  >&lt;p&gt;oh sorry pre coffee obviously. Thanks again.&lt;/p&gt;</comment>
                            <comment id="12999106" author="ghelmling" created="Thu, 24 Feb 2011 22:56:52 +0000"  >&lt;p&gt;Assigning over to Himanshu for the fix.&lt;/p&gt;</comment>
                            <comment id="12999198" author="hudson" created="Fri, 25 Feb 2011 02:52:28 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1751 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1751/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1751/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3553&quot; title=&quot;number of active threads in HTable&amp;#39;s ThreadPoolExecutor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3553&quot;&gt;&lt;del&gt;HBASE-3553&lt;/del&gt;&lt;/a&gt;  Make HTable ThreadPoolExecutor actually launch up to max threads&lt;/p&gt;</comment>
                            <comment id="15017198" author="lars_francke" created="Fri, 20 Nov 2015 12:42:14 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12532547">HBASE-4859</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12471878" name="HBASE-3553_final.patch" size="3987" author="ghelmling" created="Thu, 24 Feb 2011 22:36:18 +0000"/>
                            <attachment id="12471601" name="ThreadPoolTester.java" size="1822" author="v.himanshu" created="Tue, 22 Feb 2011 07:34:06 +0000"/>
                            <attachment id="12471875" name="benchmark_results.txt" size="3973" author="ghelmling" created="Thu, 24 Feb 2011 21:27:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Feb 2011 21:27:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33084</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hmrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100951</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>