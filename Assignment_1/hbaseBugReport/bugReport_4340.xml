<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:18:03 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4340/HBASE-4340.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4340] Hbase can&apos;t balance if ServerShutdownHandler encountered exception</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4340</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Version: 0.90.4&lt;br/&gt;
Cluster : 40 boxes&lt;br/&gt;
As I saw below logs. It said that balance couldn&apos;t work because of a dead RS.&lt;br/&gt;
I dug deeply and found two issues:&lt;/p&gt;

&lt;p&gt;1.       shutdownhandler didn&apos;t clear numProcessing deal with some exceptions. It seems whatever exceptions we should clear the flag or close master.&lt;/p&gt;

&lt;p&gt;2.       &quot;dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&quot; is inaccurate. The dead sever should be &quot; 158-1-130-10,20020,1315068597979&quot;&lt;/p&gt;

&lt;p&gt;//master logs:&lt;br/&gt;
2011-09-05 00:28:00,487 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 00:33:00,489 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 00:38:00,493 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 00:43:00,495 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 00:48:00,499 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 00:53:00,501 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 00:58:00,501 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 01:03:00,502 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 01:08:00,506 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 01:13:00,508 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 01:18:00,512 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 01:23:00,514 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 01:28:00,518 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 01:33:00,520 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 01:38:00,524 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 01:43:00,526 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 01:48:00,530 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 01:53:00,532 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 01:58:00,536 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 02:03:00,537 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 02:08:00,538 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 02:13:00,539 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;br/&gt;
2011-09-05 02:18:00,543 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): &lt;span class=&quot;error&quot;&gt;&amp;#91;158-1-130-12,20020,1314971097929&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;// the exception logs :.&lt;br/&gt;
2011-09-03 18:13:27,550 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENING, server=158-1-133-11,20020,1315069437236, region=0db4088d75c58dd22f93f389d90ba6cc&lt;br/&gt;
2011-09-03 18:13:27,550 ERROR org.apache.hadoop.hbase.executor.EventHandler: Caught throwable while processing event M_SERVER_SHUTDOWN java.lang.NullPointerException&lt;br/&gt;
         at org.apache.hadoop.hbase.util.Bytes.toLong(Bytes.java:480)&lt;br/&gt;
         at org.apache.hadoop.hbase.util.Bytes.toLong(Bytes.java:454)&lt;br/&gt;
         at org.apache.hadoop.hbase.catalog.MetaReader.metaRowToRegionPairWithInfo(MetaReader.java:400)&lt;br/&gt;
         at org.apache.hadoop.hbase.catalog.MetaReader.getServerUserRegions(MetaReader.java:591)&lt;br/&gt;
         at org.apache.hadoop.hbase.master.handler.ServerShutdownHandler.process(ServerShutdownHandler.java:176)&lt;br/&gt;
         at org.apache.hadoop.hbase.executor.EventHandler.run(EventHandler.java:156)&lt;br/&gt;
         at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
         at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
         at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
2011-09-03 18:13:27,550 INFO org.apache.hadoop.hbase.master.handler.ServerShutdownHandler: Splitting logs for 158-1-134-15,20020,1315065238916&lt;br/&gt;
2011-09-03 18:13:27,566 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: No previous transition plan was found (or we are ignoring an existing plan) for ufdr,001146,1314955304624.22f6d43e78c903196f206881fc149488. so generated a random one; hri=ufdr,001146,1314955304624.22f6d43e78c903196f206881fc149488., src=, dest=158-1-132-17,20020,1315069441916; 31 (online=31, exclude=null) available servers&lt;br/&gt;
201&lt;/p&gt;</description>
                <environment></environment>
        <key id="12521529">HBASE-4340</key>
            <summary>Hbase can&apos;t balance if ServerShutdownHandler encountered exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sunnygao">gaojinchao</assignee>
                                    <reporter username="sunnygao">gaojinchao</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Sep 2011 02:26:15 +0000</created>
                <updated>Fri, 20 Nov 2015 11:53:06 +0000</updated>
                            <resolved>Sat, 10 Sep 2011 04:39:13 +0000</resolved>
                                    <version>0.90.4</version>
                                    <fixVersion>0.90.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13100207" author="sunnygao" created="Thu, 8 Sep 2011 10:43:40 +0000"  >&lt;p&gt;I have made a patch, Please review.&lt;/p&gt;</comment>
                            <comment id="13100341" author="yuzhihong@gmail.com" created="Thu, 8 Sep 2011 14:11:58 +0000"  >&lt;p&gt;The NPE happened on this line in MetaReader.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; startCode = Bytes.toLong(data.getValue(HConstants.CATALOG_FAMILY,
          HConstants.STARTCODE_QUALIFIER));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The patch looks reasonable since there is no action taken if hris is null.&lt;/p&gt;

&lt;p&gt;Have you tested the patch on a cluster, Jinchao ?&lt;/p&gt;</comment>
                            <comment id="13101180" author="sunnygao" created="Fri, 9 Sep 2011 12:48:44 +0000"  >&lt;p&gt;Yes, All test cases have passed.&lt;/p&gt;</comment>
                            <comment id="13101971" author="yuzhihong@gmail.com" created="Sat, 10 Sep 2011 04:38:37 +0000"  >&lt;p&gt;Patch for TRUNK has been integrated.&lt;br/&gt;
Original patch integrated to 0.90 branch.&lt;/p&gt;

&lt;p&gt;Thanks for the patch Jinchao.&lt;/p&gt;</comment>
                            <comment id="13102017" author="hudson" created="Sat, 10 Sep 2011 08:45:09 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2196 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2196/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2196/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4340&quot; title=&quot;Hbase can&amp;#39;t balance if ServerShutdownHandler encountered exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4340&quot;&gt;&lt;del&gt;HBASE-4340&lt;/del&gt;&lt;/a&gt;  Hbase can&apos;t balance if ServerShutdownHandler encountered&lt;br/&gt;
               exception (Jinchao Gao)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13102203" author="sunnygao" created="Sun, 11 Sep 2011 02:25:03 +0000"  >&lt;p&gt;Thanks for your work. Ted.&lt;br/&gt;
I want to patch through to review, and then make a trunk patch. All test case passed need two hours. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15015908" author="lars_francke" created="Fri, 20 Nov 2015 11:53:06 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12493572" name="HBASE-4340_branch90.patch" size="6087" author="sunnygao" created="Thu, 8 Sep 2011 10:42:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 8 Sep 2011 14:11:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27267</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hqi7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101556</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>