<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:02:17 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2482/HBASE-2482.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2482] regions in transition do not get reassigned by master when RS crashes</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2482</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Very similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1928&quot; title=&quot;ROOT and META tables stay in transition state (making the system not usable) if the designated regionServer dies before the assignment is complete&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1928&quot;&gt;&lt;del&gt;HBASE-1928&lt;/del&gt;&lt;/a&gt;, but for the general case (not just ROOT/META):&lt;/p&gt;

&lt;p&gt;If a region is in transition on a RS when the RS crashes, the master does not remove it from regionsInTransition when processing the RS shutdown. This is fairly easy to trigger by bringing up a RS and kill -9ing it just as it starts to get regions assigned. Those regions will get permanently lost since they&apos;re stuck in regionsInTransition and thus don&apos;t get assigned by the metascanner.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12462835">HBASE-2482</key>
            <summary>regions in transition do not get reassigned by master when RS crashes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="tlipcon">Todd Lipcon</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Apr 2010 00:38:44 +0000</created>
                <updated>Fri, 12 Oct 2012 06:15:37 +0000</updated>
                            <resolved>Mon, 3 May 2010 19:54:29 +0000</resolved>
                                    <version>0.20.5</version>
                                    <fixVersion>0.20.5</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12860085" author="tlipcon" created="Fri, 23 Apr 2010 00:43:17 +0000"  >&lt;p&gt;You also can&apos;t disable the table, since it won&apos;t offline the regions it thinks are still pending open.&lt;/p&gt;</comment>
                            <comment id="12860154" author="tlipcon" created="Fri, 23 Apr 2010 07:20:52 +0000"  >&lt;p&gt;Assigning this to myself... will probably be a large patch and will require much testing, so should not block 0.20.4.&lt;/p&gt;</comment>
                            <comment id="12860267" author="stack" created="Fri, 23 Apr 2010 15:18:01 +0000"  >&lt;p&gt;Making a blocker.  Drops a region.&lt;/p&gt;</comment>
                            <comment id="12860269" author="stack" created="Fri, 23 Apr 2010 15:19:01 +0000"  >&lt;p&gt;Bringing into 0.20.5 and 0.21 so we don&apos;t lose track of it (can move it out later if needed).&lt;/p&gt;</comment>
                            <comment id="12860351" author="tlipcon" created="Fri, 23 Apr 2010 18:58:18 +0000"  >&lt;p&gt;I think my plan is this: first do a &quot;bandaid&quot; fix where we just scan regionsInTransition when processing shutdown messages, trying to do the right thing for each. After that bandaids the problem RegionManager needs a pretty widespread cleanup to collapse the code that does controlled shutdown vs lost zknode shutdown, etc.&lt;/p&gt;</comment>
                            <comment id="12860823" author="tlipcon" created="Mon, 26 Apr 2010 06:00:03 +0000"  >&lt;p&gt;Here&apos;s a preliminary patch that has gone through cluster testing, but could probably still be improved a bit (needs unit tests, and I think a lot of the meta/root special casing could be removed now)&lt;/p&gt;

&lt;p&gt;Also please note the &quot;I DONT BELIEVE YOU WILL EVER SEE THIS&quot; message. If someone can produce this message I will give them a cookie! Otherwise we should remove this code.&lt;/p&gt;

&lt;p&gt;I&apos;ve been testing this for the last 9 hours or so with a RS failure once every minute and no regions have &quot;fallen out&quot; of the cluster. Before this fix, it used to &quot;lose&quot; a region after an hour or two.&lt;/p&gt;</comment>
                            <comment id="12861110" author="stack" created="Mon, 26 Apr 2010 21:10:03 +0000"  >&lt;p&gt;Interesting bringing the split lock local to master.  Makes sense (especially since not used in RegionManager at all!)&lt;/p&gt;

&lt;p&gt;For this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// TODO Why &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; we &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; now instead of at processing time?
&lt;/span&gt;     closeMetaRegions();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... looking at it, I can only think that removing &lt;del&gt;ROOT&lt;/del&gt; and .META. from online status holds up other status transitions.  This change was added by hbase-1457.&lt;/p&gt;

&lt;p&gt;Let me see if I can make a test for this.&lt;/p&gt;


</comment>
                            <comment id="12863225" author="stack" created="Mon, 3 May 2010 02:17:59 +0000"  >&lt;p&gt;First cut at unit test.  Needs an edit but looks to be working.  Adds a protected &apos;killl&apos; to regionserver which simulates RS kill (does no cleanup but shutdown of socket).  Also added new HMsg called TEST_MSG_BLOCK_RS.  When RS receives this from master, it just waits until closed, aborted or killed.  It blocks the worker queue.&lt;/p&gt;

&lt;p&gt;The way the test works is that it adds a new RS to small cluster, waits on load balancer to move some regions to new server.  As soon as some are open, we send a close of them all followed by a TEST_MSG_BLOCK_RS.  The closes go through, balancer assigns the new server some of the closed regions only the TEST_MSG_BLOCK_RS is in place.&lt;/p&gt;

&lt;p&gt;Let me make a patch that includes Todds patch and cleaned up test next.&lt;/p&gt;</comment>
                            <comment id="12863480" author="stack" created="Mon, 3 May 2010 19:24:50 +0000"  >&lt;p&gt;A patch that combines Todds fix and a unit test.  Todds fix changes RegionState significantly but its for the better and it looks like it works.  Best to get this change in now rather than later.&lt;/p&gt;

&lt;p&gt;This version does not include the kill method added to the regionserver by previous version. Its not needed.&lt;/p&gt;</comment>
                            <comment id="12863492" author="stack" created="Mon, 3 May 2010 19:54:29 +0000"  >&lt;p&gt;Applied branch and trunk.  Thanks for the patch Todd.&lt;/p&gt;</comment>
                            <comment id="12866908" author="stack" created="Wed, 12 May 2010 23:54:00 +0000"  >&lt;p&gt;Marking these as fixed against 0.21.0 rather than against 0.20.5.&lt;/p&gt;</comment>
                            <comment id="12868274" author="stack" created="Mon, 17 May 2010 16:50:22 +0000"  >&lt;p&gt;I applied this to 0.20 branch so it will be included by 0.20.5.  Patches going into branch need review.   In this case, I reviewed Todd&apos;s patch.   Hopefully thats ok.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12443434" name="2482-unittest.txt" size="22210" author="stack" created="Mon, 3 May 2010 02:17:59 +0000"/>
                            <attachment id="12443488" name="2482-v3-combined-patch.txt" size="44175" author="stack" created="Mon, 3 May 2010 19:24:50 +0000"/>
                            <attachment id="12442820" name="hbase-2482.txt" size="18075" author="tlipcon" created="Mon, 26 Apr 2010 06:00:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 23 Apr 2010 15:18:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26326</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 31 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08sk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49227</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>