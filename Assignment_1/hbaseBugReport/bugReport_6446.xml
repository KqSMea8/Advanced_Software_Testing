<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:36:50 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6446/HBASE-6446.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6446] Replication source will throw EOF exception when hlog size is 0</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6446</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;when master cluster startup new hlog which size is 0 will be created. if we start replication, replication source will print many EOF exception when openreader. I think we need to ignore this case and do not print so many exception warning log .&lt;/p&gt;</description>
                <environment></environment>
        <key id="12599973">HBASE-6446</key>
            <summary>Replication source will throw EOF exception when hlog size is 0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="terry_zhang">terry zhang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 Jul 2012 10:21:22 +0000</created>
                <updated>Tue, 19 Mar 2013 22:48:50 +0000</updated>
                            <resolved>Tue, 19 Mar 2013 22:48:50 +0000</resolved>
                                    <version>0.94.0</version>
                                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13421310" author="terry_zhang" created="Tue, 24 Jul 2012 10:24:00 +0000"  >&lt;p&gt;[]$ hadoop dfs -ls /hbase-73/.logs/dw73.kgb.sqa.cm4,60020,1343114427581&lt;br/&gt;
Found 3 items&lt;br/&gt;
rw-rr- 3 wuting supergroup 578 2012-07-24 15:20 /hbase-73/.logs/dw73.kgb.sqa.cm4,60020,1343114427581/dw73.kgb.sqa.cm4%2C60020%2C1343114427581.1343114427921&lt;br/&gt;
rw-rr- 3 wuting supergroup 399 2012-07-24 15:20 /hbase-73/.logs/dw73.kgb.sqa.cm4,60020,1343114427581/dw73.kgb.sqa.cm4%2C60020%2C1343114427581.1343114433385&lt;br/&gt;
&lt;font color=&quot;red&quot;&gt; &lt;br/&gt;
rw-rr- 3 wuting supergroup 0 2012-07-24 15:20 /hbase-73/.logs/dw73.kgb.sqa.cm4,60020,1343114427581/dw73.kgb.sqa.cm4%2C60020%2C1343114427581.1343114434732&lt;/font&gt; &lt;br/&gt;
2012-07-24 15:24:55,516 DEBUG org.apache.hadoop.hbase.replication.regionserver.ReplicationSource: Opening log for replication dw73.kgb.sqa.cm4%2C60020%2C1343114427581.1343114434732 at 0&lt;br/&gt;
2012-07-24 15:24:55,521 WARN org.apache.hadoop.hbase.replication.regionserver.ReplicationSource: 1 Got: &lt;br/&gt;
java.io.EOFException&lt;br/&gt;
at java.io.DataInputStream.readFully(DataInputStream.java:180)&lt;br/&gt;
at java.io.DataInputStream.readFully(DataInputStream.java:152)&lt;br/&gt;
at org.apache.hadoop.io.SequenceFile$Reader.init(SequenceFile.java:1465)&lt;br/&gt;
at org.apache.hadoop.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1437)&lt;br/&gt;
at org.apache.hadoop.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1424)&lt;br/&gt;
at org.apache.hadoop.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1419)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader$WALReader.&amp;lt;init&amp;gt;(SequenceFileLogReader.java:55)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader.init(SequenceFileLogReader.java:175)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.HLog.getReader(HLog.java:721)&lt;br/&gt;
at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.openReader(ReplicationSource.java:475)&lt;br/&gt;
at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.run(ReplicationSource.java:286)&lt;/p&gt;</comment>
                            <comment id="13421448" author="zhihyu@ebaysf.com" created="Tue, 24 Jul 2012 14:40:00 +0000"  >&lt;p&gt;Would &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6327&quot; title=&quot;HLog can be null when create table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6327&quot;&gt;&lt;del&gt;HBASE-6327&lt;/del&gt;&lt;/a&gt; solve this problem ?&lt;/p&gt;</comment>
                            <comment id="13421656" author="jdcryans" created="Tue, 24 Jul 2012 19:03:48 +0000"  >&lt;p&gt;@Ted&lt;/p&gt;

&lt;p&gt;It wouldn&apos;t, the EOF comes out of the RS&apos;s HLog.&lt;/p&gt;

&lt;p&gt;@terry&lt;/p&gt;

&lt;p&gt;You are right that we shouldn&apos;t be so verbose in the replication code, but I don&apos;t think your patch is the right way to do it. Checking the length adds another NN hit (we already do many of them) and it doesn&apos;t really tell us anything useful. Best case the log is still empty so we don&apos;t print a message, worst case something was added so now we print that we got an EOF after learning that it&apos;s not empty anymore.&lt;/p&gt;

&lt;p&gt;In fact, there are other reasons to get EOF. For example, if you open the reader at the last position you read from and nothing new was added then you get the EOF right away. Meaning that, even with your patch, since the length isn&apos;t 0, the exception would always be thrown plus you&apos;ll hit the NN more than without it.&lt;/p&gt;

&lt;p&gt;IMO we could skip printing the stack trace and have a more meaningful message.&lt;/p&gt;</comment>
                            <comment id="13421963" author="terry_zhang" created="Wed, 25 Jul 2012 03:02:23 +0000"  >&lt;p&gt;hi Daniel ,what about check the hlog queue length?  &lt;/p&gt;

 &lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ReplicationSource.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
      
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.queue.size() != 0){
        LOG.warn(peerClusterZnode + &lt;span class=&quot;code-quote&quot;&gt;&quot; Got: &quot;&lt;/span&gt;, ioe);
      }
     
      &lt;span class=&quot;code-comment&quot;&gt;// TODO Need a better way to determinate &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a file is really gone but
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// TODO without scanning all logs dir
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sleepMultiplier == &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.maxRetriesMultiplier) {
        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Waited too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file, considering dumping&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; !processEndOfFile();
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;this can prevent warning exception print again and again when master rs startup and no data was put in.&lt;/p&gt;</comment>
                            <comment id="13421967" author="jxiang" created="Wed, 25 Jul 2012 03:13:08 +0000"  >&lt;p&gt;About 0 length HLog file, I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6443&quot; title=&quot;HLogSplitter should ignore 0 length files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6443&quot;&gt;&lt;del&gt;HBASE-6443&lt;/del&gt;&lt;/a&gt; last week. When a new HLog file is created, its size is 0.  My understanding is that it is not replicated since it is still in use. Only those closed HLog file will be replicated.  Correct me if I am wrong.  So in this case, you may have a corrupted HLog file.  Just like in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6443&quot; title=&quot;HLogSplitter should ignore 0 length files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6443&quot;&gt;&lt;del&gt;HBASE-6443&lt;/del&gt;&lt;/a&gt;, you need to handle it yourself.  Replication should NOT swallow the EOF exception.&lt;/p&gt;</comment>
                            <comment id="13421976" author="jdcryans" created="Wed, 25 Jul 2012 03:32:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;this can prevent warning exception print again and again when master rs startup and no data was put in.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Like I wrote I&apos;m all for not printing the exception, but I&apos;d still like to keep a message. More precisely, a message at DEBUG level.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;you need to handle it yourself. Replication should NOT swallow the EOF exception.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The current logic is in processEndOfFile(), what it looks like is if there&apos;s no other log in the queue, it will keep retrying to read... unless it&apos;s a recovered queue in which case since it&apos;s the end of the last file so it will close that replication stream (since it&apos;s considered all replicated). Finally, if you have an EOF and there&apos;s another file in the queue, it means that the current file cannot be read further and so we move on to the next one.&lt;/p&gt;

&lt;p&gt;What is your suggestion?&lt;/p&gt;</comment>
                            <comment id="13421981" author="jxiang" created="Wed, 25 Jul 2012 03:48:21 +0000"  >&lt;p&gt;I think we should not keep retrying.  We can retry for some configurable times, then log an error and skip this file. A bad file should not break the system.&lt;/p&gt;</comment>
                            <comment id="13421984" author="terry_zhang" created="Wed, 25 Jul 2012 03:56:54 +0000"  >&lt;p&gt;OK&#65292;Daniel. Let&apos;s change it from warning level to debug level to prevent warning in online cluster.&lt;/p&gt;</comment>
                            <comment id="13422446" author="jdcryans" created="Wed, 25 Jul 2012 17:39:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think we should not keep retrying. We can retry for some configurable times, then log an error and skip this file. A bad file should not break the system&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In which case? Let&apos;s say the RS got a 0 length file, then creates a new HLog. Here the replication code will do the right thing and move on.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;OK&#65292;Daniel. Let&apos;s change it from warning level to debug level to prevent warning in online cluster.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was also thinking that we should not print the stack trace.&lt;/p&gt;</comment>
                            <comment id="13606973" author="ctrezzo" created="Tue, 19 Mar 2013 22:46:21 +0000"  >&lt;p&gt;Check out &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7122&quot; title=&quot;Proper warning message when opening a log file with no entries (idle cluster)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7122&quot;&gt;&lt;del&gt;HBASE-7122&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12615260">HBASE-7122</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12537804" name="hbase-6446-v2.patch" size="736" author="terry_zhang" created="Wed, 25 Jul 2012 03:56:54 +0000"/>
                            <attachment id="12537676" name="hbase-6446.patch" size="968" author="terry_zhang" created="Tue, 24 Jul 2012 10:25:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 24 Jul 2012 14:40:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241760</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 39 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02cf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11613</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>