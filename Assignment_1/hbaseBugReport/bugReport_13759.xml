<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:46:22 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13759/HBASE-13759.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13759] Improve procedure yielding</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13759</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Adds the ability to yield the procedure every execution step.&lt;br/&gt;
by default, a procedure will try to go begin to end without stopping.&lt;br/&gt;
This allows procedures to be nice to other procedures.&lt;br/&gt;
one usage example is ServerShutdownHandler where we want everyone to make some progress.&lt;/p&gt;

&lt;p&gt;Allows procedure to throw InterruptedException, the default handling will be:&lt;br/&gt;
&quot;ask the master if there is an abort of stop. If there is, stop executions and exit. Else, clear the IE and carryon executing. the interruted procedure will retry&quot;.&lt;br/&gt;
If the procedure implementor wants a different behavior, the IE can be catched and custom handling can be performed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12832423">HBASE-13759</key>
            <summary>Improve procedure yielding</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12860479">HBASE-14336</parent>
                                    <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mbertozzi">Matteo Bertozzi</assignee>
                                    <reporter username="mbertozzi">Matteo Bertozzi</reporter>
                        <labels>
                    </labels>
                <created>Sun, 24 May 2015 17:08:05 +0000</created>
                <updated>Sat, 29 Aug 2015 04:22:16 +0000</updated>
                            <resolved>Fri, 29 May 2015 18:31:46 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.2.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                                    <component>proc-v2</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14557799" author="hadoopqa" created="Sun, 24 May 2015 17:20:17 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12735078/HBASE-13759-v0.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12735078/HBASE-13759-v0.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit f28e3952905592c6cc3c6c07b2509795e1210e70.&lt;br/&gt;
  ATTACHMENT ID: 12735078&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javac&lt;/font&gt;.  The patch appears to cause mvn compile goal to fail with Hadoop version 2.4.1.&lt;/p&gt;

&lt;p&gt;    Compilation errors resume:&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; COMPILATION ERROR : &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-procedure/src/test/java/org/apache/hadoop/hbase/procedure2/TestYieldProcedures.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;76,17&amp;#93;&lt;/span&gt; method start in class org.apache.hadoop.hbase.procedure2.ProcedureExecutor&amp;lt;TEnvironment&amp;gt; cannot be applied to given types;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:3.2:testCompile (default-testCompile) on project hbase-procedure: Compilation failure&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/hbase-procedure/src/test/java/org/apache/hadoop/hbase/procedure2/TestYieldProcedures.java:&lt;span class=&quot;error&quot;&gt;&amp;#91;76,17&amp;#93;&lt;/span&gt; method start in class org.apache.hadoop.hbase.procedure2.ProcedureExecutor&amp;lt;TEnvironment&amp;gt; cannot be applied to given types;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; required: int&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; found: int,boolean&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; reason: actual and formal argument lists differ in length&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; -&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Help 1&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; To see the full stack trace of the errors, re-run Maven with the -e switch.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; Re-run Maven using the -X switch to enable full debug logging.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; For more information about the errors and possible solutions, please read the following articles:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Help 1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://cwiki.apache.org/confluence/display/MAVEN/MojoFailureException&lt;/a&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; &lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt; After correcting the problems, you can resume the build with the command&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;ERROR&amp;#93;&lt;/span&gt;   mvn &amp;lt;goals&amp;gt; -rf :hbase-procedure&lt;/p&gt;


&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14168//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14168//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14557862" author="stack" created="Sun, 24 May 2015 22:05:57 +0000"  >&lt;p&gt;Do you want to ask the host if it is aborting or stopping in here handleInterruptedException?&lt;/p&gt;

&lt;p&gt;The implementation of isYieldAfterExecutionStep is done by doing a isYieldBeforeExecuteFromState in StateMachineProcedure? Interesting...&lt;/p&gt;

&lt;p&gt;141	  protected boolean isYieldAfterExecutionStep(final TEnvironment env) &lt;/p&gt;
{
142	    return isYieldBeforeExecuteFromState(env, getCurrentState());
143	  }

&lt;p&gt;Patch LGTM. +1 after hadoopqa passes.&lt;/p&gt;</comment>
                            <comment id="14557866" author="mbertozzi" created="Sun, 24 May 2015 22:14:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;Do you want to ask the host if it is aborting or stopping in here handleInterruptedException?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;that is more or less implicit. if master.abort()/stop() was called procedureExecutor.isRunning() will be false. we are basically pushing the procedure back in the queue and restart from while (isRunning()).&lt;br/&gt;
do you have a better way to check if the master is going down but it didn&apos;t call abort/stop yet?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The implementation of isYieldAfterExecutionStep is done by doing a isYieldBeforeExecuteFromState in StateMachineProcedure? Interesting...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;the StateMachineProc has more alrady information on what is doing, so you can control which step should yield and which should not without having to keep extra state around&lt;/p&gt;</comment>
                            <comment id="14557899" author="stack" created="Mon, 25 May 2015 00:37:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;do you have a better way to check if the master is going down but it didn&apos;t call abort/stop yet?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;we are basically pushing the procedure back in the queue and restart from while (isRunning()).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok.&lt;/p&gt;

&lt;p&gt;+1 on patch.&lt;/p&gt;</comment>
                            <comment id="14564968" author="mbertozzi" created="Fri, 29 May 2015 15:23:40 +0000"  >&lt;p&gt;v1 only changes the method implemented by ServerCrashProcedure to force the yield&lt;/p&gt;</comment>
                            <comment id="14564989" author="stack" created="Fri, 29 May 2015 15:50:47 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;nit: Is state superfluous in below? Doesn&apos;t the executor know the &apos;state&apos; already?&lt;/p&gt;

&lt;p&gt;   protected boolean isYieldBeforeExecuteFromState(TEnvironment env, TState state) {&lt;/p&gt;</comment>
                            <comment id="14564993" author="mbertozzi" created="Fri, 29 May 2015 15:56:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;nit: Is state superfluous in below? Doesn&apos;t the executor know the &apos;state&apos; already&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;you mean Procedure instead of Executor?&lt;br/&gt;
the idea is this: the executor executes one step, and then asks. &quot;do you want me to execute you again or do you want someone else to run?&quot;&lt;/p&gt;

&lt;p&gt;for the StateMachineProcedure instead of the isYieldAfterExecutionStep(fTEnvironment) from the base procedure you can have more information. so the executor calls isYieldBeforeExecuteFromState(TEnvironment, TState) asking you if you want to yield before executing &quot;state&quot;. the StateMachineProcedure in theory should not store the state, you can grab it from getCurrentState(), but as mirror of executeFromState(TEnvironment, TState) you don&apos;t have to know anything about the class below, and you just have to implement execute/rollback/yield for that particular state that the framework is telling you to execute.&lt;/p&gt;</comment>
                            <comment id="14564999" author="stack" created="Fri, 29 May 2015 16:00:11 +0000"  >&lt;p&gt;Ok. Thanks for explanation. +1 on commit.&lt;/p&gt;</comment>
                            <comment id="14565543" author="hudson" created="Fri, 29 May 2015 22:11:21 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6530 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6530/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6530/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13759&quot; title=&quot;Improve procedure yielding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13759&quot;&gt;&lt;del&gt;HBASE-13759&lt;/del&gt;&lt;/a&gt; Procedure v2 - Improve procedure yielding (matteo.bertozzi: rev d86f2fa3b21bf177756f2d923cce817e86f10adc)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-procedure/src/main/java/org/apache/hadoop/hbase/procedure2/Procedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/DeleteColumnFamilyProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-procedure/src/test/java/org/apache/hadoop/hbase/procedure2/TestYieldProcedures.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/AddColumnFamilyProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/EnableTableProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/DisableTableProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/ServerCrashProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/TruncateTableProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-procedure/src/main/java/org/apache/hadoop/hbase/procedure2/SequentialProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-procedure/src/main/java/org/apache/hadoop/hbase/procedure2/StateMachineProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/ModifyTableProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/ModifyColumnFamilyProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-procedure/src/main/java/org/apache/hadoop/hbase/procedure2/ProcedureExecutor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/DeleteTableProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/CreateTableProcedure.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14565580" author="hudson" created="Fri, 29 May 2015 22:34:41 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #117 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/117/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/117/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13759&quot; title=&quot;Improve procedure yielding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13759&quot;&gt;&lt;del&gt;HBASE-13759&lt;/del&gt;&lt;/a&gt; Procedure v2 - Improve procedure yielding (matteo.bertozzi: rev c4ac2ebbdbd2869df00cc4a6bb611257ec020298)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-procedure/src/main/java/org/apache/hadoop/hbase/procedure2/ProcedureExecutor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/TruncateTableProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-procedure/src/main/java/org/apache/hadoop/hbase/procedure2/StateMachineProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/AddColumnFamilyProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/DeleteColumnFamilyProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-procedure/src/test/java/org/apache/hadoop/hbase/procedure2/TestYieldProcedures.java&lt;/li&gt;
	&lt;li&gt;hbase-procedure/src/main/java/org/apache/hadoop/hbase/procedure2/SequentialProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/DeleteTableProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-procedure/src/main/java/org/apache/hadoop/hbase/procedure2/Procedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/EnableTableProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/ServerCrashProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/DisableTableProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/CreateTableProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/ModifyColumnFamilyProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/ModifyTableProcedure.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12821112">HBASE-13476</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12735078" name="HBASE-13759-v0.patch" size="34160" author="mbertozzi" created="Sun, 24 May 2015 17:08:42 +0000"/>
                            <attachment id="12736162" name="HBASE-13759-v1.patch" size="35195" author="mbertozzi" created="Fri, 29 May 2015 15:23:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 24 May 2015 17:20:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 28 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f5f3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>