<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:28:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5547/HBASE-5547.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5547] Don&apos;t delete HFiles when in &quot;backup mode&quot;</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5547</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This came up in a discussion I had with Stack.&lt;br/&gt;
It would be nice if HBase could be notified that a backup is in progress (via a znode for example) and in that case either:&lt;br/&gt;
1. rename HFiles to be delete to &amp;lt;file&amp;gt;.bck&lt;br/&gt;
2. rename the HFiles into a special directory&lt;br/&gt;
3. rename them to a general trash directory (which would not need to be tied to backup mode).&lt;/p&gt;

&lt;p&gt;That way it should be able to get a consistent backup based on HFiles (HDFS snapshots or hard links would be better options here, but we do not have those).&lt;/p&gt;

&lt;p&gt;#1 makes cleanup a bit harder.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12545774">HBASE-5547</key>
            <summary>Don&apos;t delete HFiles when in &quot;backup mode&quot;</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jesse_yates">Jesse Yates</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Mar 2012 05:15:44 +0000</created>
                <updated>Mon, 23 Sep 2013 18:31:06 +0000</updated>
                            <resolved>Sat, 15 Sep 2012 04:21:14 +0000</resolved>
                                                    <fixVersion>0.95.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>18</watches>
                                                                                                            <comments>
                            <comment id="13237920" author="jesse_yates" created="Sun, 25 Mar 2012 16:43:47 +0000"  >&lt;p&gt;Linking to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-50&quot; title=&quot;Snapshot of table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-50&quot;&gt;&lt;del&gt;HBASE-50&lt;/del&gt;&lt;/a&gt; as we are also going to have to keep around hfiles indefinitely for that functionality.&lt;/p&gt;</comment>
                            <comment id="13238965" author="jesse_yates" created="Mon, 26 Mar 2012 23:12:27 +0000"  >&lt;p&gt;Thoughts on how long we should keep around files? Indefinitely? The latter seems a bit excessive, especially if a &apos;backup mode&apos; ensures you run every X minutes (and exports to another cluster, moves the files to another backup directory). &apos;Cleanup&apos; in implies you want to remove the file when no one care about the hfiles anymore - thinking maybe a periodic chore on the rs?&lt;/p&gt;

&lt;p&gt;With snapshots, I was expecting to add an file reference feature - essentially doing impl hardlinks for files we care about keeping around. Was thinking we could add a CP hook and impl that would let you add a checks (config based?) for if you want to keep a reference around for the file being cleaned up. In the backup situation, you would have a timer or (maybe check for a backup completed file/meta row) and see if you had elapsed that time or not; if not, you would add a reference, if so, do nothing and let the file get cleaned up.&lt;/p&gt;</comment>
                            <comment id="13238968" author="lhofhansl" created="Mon, 26 Mar 2012 23:18:45 +0000"  >&lt;p&gt;Was thinking that these files are up grabs unless HBase is in &quot;backup mode&quot;, maybe by the existence of a specific zNode, although other models are possible as well.&lt;br/&gt;
The details are a bit tricky, of course. Do we need a full cleanup between backup runs so that we do not confuse the backup files? If not, do we tag with a backup number or a with timestamp (like the HLogs)?&lt;/p&gt;

&lt;p&gt;If we do &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-50&quot; title=&quot;Snapshot of table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-50&quot;&gt;&lt;del&gt;HBASE-50&lt;/del&gt;&lt;/a&gt; we won&apos;t need this one methinks. This might get us to workable solution more quickly.&lt;/p&gt;</comment>
                            <comment id="13238977" author="stack" created="Mon, 26 Mar 2012 23:26:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;Thoughts on how long we should keep around files? Indefinitely? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. I&apos;d think some other process other than hbase would be responsible for their cleanup.&lt;/p&gt;</comment>
                            <comment id="13239009" author="jesse_yates" created="Mon, 26 Mar 2012 23:40:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-50&quot; title=&quot;Snapshot of table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-50&quot;&gt;&lt;del&gt;HBASE-50&lt;/del&gt;&lt;/a&gt; would build on this functionality (just getting to where I need it anyways), so thought I could knock this out the &apos;right&apos; way and then later wrap it into hbase-50. The reference stuff is a bit involved and I would be fine if we just moved the files out to another directory. Backup then can just check file times and remove the files that were backed up since the time or copy the ones that are currently being used.&lt;/p&gt;

&lt;p&gt;Timestamp can just looked up per backed-up file or possibly grouped by directory (though the latter seems likely to fragmentation.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;HBase is in &quot;backup mode&quot;, maybe by the existence of a specific zNode, although other models are possible as well.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Like this idea - only backing up while the switch is on, but otherwise should help keep cruft down (not be part of normal operation).&lt;/p&gt;</comment>
                            <comment id="13241018" author="jesse_yates" created="Thu, 29 Mar 2012 06:38:35 +0000"  >&lt;p&gt;Implementation consideration: should we be backing up &lt;em&gt;all&lt;/em&gt; deletes or just those that are system enabled. For instance, we could delete a table via the api/shell. However, that is a pointed act and probably doesn&apos;t mean we want to back that data up. Proposing we keep it simple FTM and just backup system removed HFiles. Otherwise, we keep around tons of copies of files.&lt;/p&gt;

&lt;p&gt;Alternative I wouldn&apos;t mind (but increases the size of the patch and feels like scope creep) would be to backup even for table level deletes and on things like deleting a table, you need a bool to specify &quot;but not the backup&quot;.&lt;/p&gt;

&lt;p&gt;thoughts?&lt;/p&gt;</comment>
                            <comment id="13241346" author="lhofhansl" created="Thu, 29 Mar 2012 16:10:31 +0000"  >&lt;p&gt;I&apos;d just backup system removed HFiles if you can always tell the difference.&lt;/p&gt;</comment>
                            <comment id="13241563" author="stack" created="Thu, 29 Mar 2012 19:42:10 +0000"  >&lt;p&gt;What Lars said.&lt;/p&gt;</comment>
                            <comment id="13245952" author="jiraposter@reviews.apache.org" created="Wed, 4 Apr 2012 01:24:21 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;

&lt;p&gt;Implementation wise: &lt;br/&gt;
    Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;br/&gt;
    Added a zk listener to handle updates from the master to the RS to backup.&lt;br/&gt;
    Added a utility for removing files and finding archive directories&lt;br/&gt;
    Added tests for the regionserver and catalogjanitor approaches.&lt;br/&gt;
    Added creation of manager in regionserver.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HConstants.java 21ac4ba &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 16e4017 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java ea7ae45 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 9bd4ace &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveManager.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 1d11f8f &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 4f80999 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 0c7b396 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 0f83655 &lt;br/&gt;
  src/main/resources/hbase-default.xml 341431a &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java d2b3060 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 227c5f2 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java bb3ddd7 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jesse&lt;/p&gt;
</comment>
                            <comment id="13245987" author="jiraposter@reviews.apache.org" created="Wed, 4 Apr 2012 03:06:49 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review6672&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review6672&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14456&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14456&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    There is no mentioning of HFile in the name of znode.&lt;br/&gt;
    What if another archive scheme comes up in the future ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14433&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14433&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    What is the counterpart for disableHFileBackup() where backup for all tables is enabled ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14435&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14435&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    License.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14436&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14436&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    &apos;or not&apos; is not needed.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14437&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14437&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Remove empty line.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14438&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14438&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    white space.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14441&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14441&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should we log if rss == null ?&lt;br/&gt;
    Since in that case we cannot perform desired archiving.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14439&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14439&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should they be named hFileArchive&lt;/p&gt;
{Manager,Tracker}
&lt;p&gt; ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14440&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14440&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The leading &apos;get &apos; is not necessary.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14442&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14442&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    License.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14443&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14443&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please check the return value from mkdirs().&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14444&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14444&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please check the return value.&lt;br/&gt;
    Should resolveAndCopyFile() be enclosed in a try block ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14445&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14445&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The code at line 92 doesn&apos;t &apos;keep&apos; HFiles.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14446&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14446&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This doesn&apos;t match the fs.rename() call.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14447&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14447&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    What about non-directory files ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14448&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14448&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should include file in log message.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14449&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14449&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Move this to line 197.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14450&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14450&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should this be contingent on success being true ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14451&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14451&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Move else if to line 219 and enclose LOG.debug in curly braces.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14434&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14434&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Add license, please.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14452&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14452&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should this method return a boolean which indicates whether the tracker is enabled ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14453&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14453&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    variable table should be included in the log.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14454&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14454&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Remove first &apos;the&apos;.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14455&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14455&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why do we return when archiveHFileZNode exists ?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-04-04 01:23:29, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-04-04 01:23:29)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java 21ac4ba &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 16e4017 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java ea7ae45 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 9bd4ace &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 1d11f8f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 4f80999 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 0c7b396 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 0f83655 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 341431a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java d2b3060 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 227c5f2 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java bb3ddd7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13245997" author="zhihyu@ebaysf.com" created="Wed, 4 Apr 2012 03:48:43 +0000"  >&lt;p&gt;Should we consider the duration for HFile retention ?&lt;br/&gt;
Unlimited backup of HFiles for big table(s) would some day fill up hdfs.&lt;/p&gt;</comment>
                            <comment id="13247503" author="jiraposter@reviews.apache.org" created="Thu, 5 Apr 2012 18:42:20 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review6714&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review6714&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Thanks for the review Ted. Any thoughts on combining the Tracker and Manager (see inline comment below on HFileArchiveManager).&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14522&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14522&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    fair enough. done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14517&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14517&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Disable right now just wipes out all the tables currently in backup mode (not saving any info), but I guess it could be reasonable to want to start backing up all the tables - though in real usage you probably only want to do one table at a time to minimize impact on a cluster. &lt;/p&gt;

&lt;p&gt;    I&apos;d rather not give people that power directly, but make them jump through a couple hoops (listing out all the tables and then iteratively starting backups on those tables) due: 1) how much data that can be, and 2) in a real &apos;backup&apos; context this means they are cloning all the tables (doing a full table scan on all tables) which would be highly disruptive.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14518&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14518&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14519&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14519&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14520&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14520&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I&apos;ve been debating whether or not to roll this implementation into the HFileArchiveTracker and just move this into an interface. It doesn&apos;t actually do very much - essentially a prettier front to a map and could easily be moved into the tracker. &lt;/p&gt;

&lt;p&gt;    Thoughts?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14521&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14521&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14526&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14526&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14523&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14523&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    That case should only come up in testing, so logging seems excessive.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14524&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14524&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    used store because in code that&apos;s what we are really dealing with, but everyone just refers to them as hfiles. going with your way for consistency.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14525&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14525&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14527&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14528&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14528&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    yup, nice catch (no pun intended).&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14529&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14529&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    true. earlier iteration comment that got confused with manager.keepFiles&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14530&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14530&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    how so? renames an the src path to the dest path. Seems to work in tests.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14531&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14531&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    then its something we don&apos;t care about - only care about the hfiles, which are stored in one directory level below the region.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14532&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14532&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14534&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14534&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Definitely need to add another unit test covering the &apos;resolve&apos; part of this method - lot of gymnastics/corner cases going on.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14536&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14536&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    reworked a little bit in the new version.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14533&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14533&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    going to bail out earlier if we can&apos;t delete the old file.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14535&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14535&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14537&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14537&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14538&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14538&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    don&apos;t think so - enabled only means that it found the archive znode, in which case it will attempt to update the manager. The enabled construct is really an internal util, as opposed to something that anyone else should really care about (at least that was the intention.)&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14539&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14539&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    oops, shouldn&apos;t have. Adding unit test to catch that.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jesse&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-04-04 01:23:29, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-04-04 01:23:29)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java 21ac4ba &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 16e4017 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java ea7ae45 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 9bd4ace &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 1d11f8f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 4f80999 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 0c7b396 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 0f83655 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 341431a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java d2b3060 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 227c5f2 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java bb3ddd7 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13247522" author="zhihyu@ebaysf.com" created="Thu, 5 Apr 2012 18:55:04 +0000"  >&lt;p&gt;I currently don&apos;t have good idea w.r.t. combining HFileArchiveManager with the tracker.&lt;br/&gt;
One of them would be exposed to HRegion anyway.&lt;/p&gt;</comment>
                            <comment id="13247538" author="jesse_yates" created="Thu, 5 Apr 2012 19:02:08 +0000"  >{qoute}
&lt;p&gt;Should we consider the duration for HFile retention ?&lt;br/&gt;
Unlimited backup of HFiles for big table(s) would some day fill up hdfs.&lt;/p&gt;
&lt;blockquote&gt;&lt;/blockquote&gt;

&lt;p&gt;Discussed above that they should be kept around indefinitely. Thought is that you enable archiving, run your backup process which also cleans out the hfiles when they aren&apos;t needed, and then turns off archiving.&lt;/p&gt;</comment>
                            <comment id="13249319" author="jiraposter@reviews.apache.org" created="Sat, 7 Apr 2012 19:52:15 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2012-04-07 19:51:11.515830)&lt;/p&gt;


&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;A bit rearchitecting in the new patch:&lt;br/&gt;
1) Separated the client and server archiving into distinct classes (and saved changes to HMasterInferface)&lt;br/&gt;
2) A lot of the functions in the ArchiveUtil were moved to their respective classes and move a couple smaller methods in&lt;br/&gt;
3) Added a synchronous enable as the default for the client&lt;br/&gt;
4) Merged the tracker and the manger into the tracker and pulled out the important methods into a monitor interface.&lt;br/&gt;
5) Addressed Ted&apos;s comments from the last patch (and hopefully didn&apos;t add them back in the change).&lt;br/&gt;
6) Added a bunch of testing&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;

&lt;p&gt;Implementation wise: &lt;br/&gt;
    Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;br/&gt;
    Added a zk listener to handle updates from the master to the RS to backup.&lt;br/&gt;
    Added a utility for removing files and finding archive directories&lt;br/&gt;
    Added tests for the regionserver and catalogjanitor approaches.&lt;br/&gt;
    Added creation of manager in regionserver.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HConstants.java a4b989e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 16e4017 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java fb21bdd &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java c3df319 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 8a61f7d &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 509a467 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;br/&gt;
  src/main/resources/hbase-default.xml 44ee689 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java 41616c8 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java b4dcb83 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jesse&lt;/p&gt;
</comment>
                            <comment id="13249332" author="jiraposter@reviews.apache.org" created="Sat, 7 Apr 2012 21:08:13 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review6777&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review6777&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;In the javadoc, &apos;backups&apos; were used. I think backup should be good enough.&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14940&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14940&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    How about naming this method createHFileArchiveManager or buildHFileArchiveManager ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14941&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14941&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The directory is specified by&lt;br/&gt;
    HConstants.HFILE_ARCHIVE_DIRECTORY.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14943&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14943&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should read &apos;all online region servers hosting the&apos;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14944&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14944&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Typo: received.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14942&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14942&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please add javadoc for archive.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14945&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14945&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This would create a manager.&lt;br/&gt;
    Can we cache the archive manager ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14952&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14952&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Parameter for allRegionsDoneBackup() is called confirmedDone&lt;br/&gt;
    This seems to be inconsistent with the return from regionsArchivingTable()&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14947&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14947&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This call would leave the backup for tableName in an inconsistent state, right ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14946&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14946&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    tableName should be included.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14948&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14948&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please mention this call is asynchronous.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14954&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14954&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    License.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14949&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14949&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should read &apos;archiving for the table&apos;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14950&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14950&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    How about naming this method regionsBeingArchived or regionsBeingArchivedForTable ?&lt;br/&gt;
    I think the first should be enough since table is a parameter.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14955&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14955&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    No year, please.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14956&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14956&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This doesn&apos;t sound consistent with the class being a monitor.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14957&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14957&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    No year.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14959&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14959&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Year is not needed.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14960&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14960&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    License.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-04-07 19:51:11, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-04-07 19:51:11)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java a4b989e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 16e4017 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java fb21bdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java c3df319 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 8a61f7d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 509a467 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 44ee689 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java 41616c8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java b4dcb83 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13249333" author="jiraposter@reviews.apache.org" created="Sat, 7 Apr 2012 21:10:15 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review6778&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review6778&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;This is pretty nice!&lt;br/&gt;
Did a first pass. The only part I a bit hard to comprehend is the archiveDir vs. the timestamped archiveDir.&lt;/p&gt;

&lt;p&gt;Somebody with more knowledge about ZK should look through he ZK code. For example do we need to call sync() in some cases to ensure we get the latest ZK view?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14951&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14951&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this a warning?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14953&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14953&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    How can that be the case? Can we get a new file with the same name as a previously deleted one?&lt;br/&gt;
    This might make it hard to piece together the set of files required for backup.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment14958&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment14958&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    License missing&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Lars&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-04-07 19:51:11, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-04-07 19:51:11)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java a4b989e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 16e4017 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java fb21bdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java c3df319 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 8a61f7d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 509a467 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 44ee689 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java 41616c8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java b4dcb83 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13249399" author="zhihyu@ebaysf.com" created="Sat, 7 Apr 2012 22:47:25 +0000"  >&lt;p&gt;In latest patch, regions participating in archiving are listed under table znode.&lt;br/&gt;
How are newly split regions added to the tree ?&lt;/p&gt;

&lt;p&gt;Please add a test case for this scenario.&lt;/p&gt;</comment>
                            <comment id="13251727" author="jiraposter@reviews.apache.org" created="Wed, 11 Apr 2012 16:49:15 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review6820&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review6820&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15202&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15202&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done. Originally modeled after the catalog tracker in naming.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15203&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15203&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15204&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15204&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15205&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15205&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15206&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15206&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15207&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15207&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Would rather not, since in that case we would keep around a persistent connection to ZK, which is against what the community has been doing with cutting the client/zk connection (though admittedly that not directly applicable here).&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15208&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15208&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    changed to confirmedArchiving.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15184&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15184&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Yeah, it would. But then you should not attempt to expect the archive as valid and fail your backup process. Was going to leave it to the user to determine if they wanted to do the cleanup.&lt;/p&gt;

&lt;p&gt;    However, I would be ok if we added a method that cleaned up the filesystem for files created in the backup after the archiving started. &lt;/p&gt;

&lt;p&gt;    Unfortunately, this means add an extra method on the master which I was trying to avoid, but I guess its not the end of the world. We also have a two-phase commit issue here as we also need to then write a &apos;consistent-confirmed&apos; file into the archive when it completes to ensure that failed clients don&apos;t break the archiving.&lt;/p&gt;

&lt;p&gt;    thoughts?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15209&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15209&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15183&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15183&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Method name isn&apos;t enough?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15210&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15210&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15211&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15211&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15212&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15212&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done - regionsBeingArchived it is.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15213&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15185&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15185&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Cruft from the earlier version.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15186&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15186&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    yeah, guess it should be.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15214&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15214&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15187&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15187&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is a super rare case where the name of the regiondir to be backed up is the same as the one in the backup already. Just being extra careful that the random storefile name doesn&apos;t match, though it is &lt;em&gt;very&lt;/em&gt; unlikely to happen, it still could (which could lead to bad circumstances). Currently, the storefile check doesn&apos;t check the archive directory and I think it would be pretty big overhead to expect it to do that as well (lots of added dependencies, calls, etc). We can just do the check and renaming here - its not super complicated and seems to work.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15215&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15215&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15216&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15216&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jesse&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-04-07 19:51:11, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-04-07 19:51:11)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java a4b989e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 16e4017 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java fb21bdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java c3df319 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 8a61f7d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 509a467 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 44ee689 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java 41616c8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java b4dcb83 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13251735" author="zhihyu@ebaysf.com" created="Wed, 11 Apr 2012 16:57:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;However, I would be ok if we added a method that cleaned up the filesystem for files created in the backup after the archiving started.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think we should do the cleanup if archiving cannot complete.&lt;br/&gt;
If a new method in master interface is needed, we can accommodate that.&lt;/p&gt;</comment>
                            <comment id="13251750" author="jesse_yates" created="Wed, 11 Apr 2012 17:11:53 +0000"  >&lt;p&gt;@Ted - fair enough. Tried to avoid modifying interfaces, but I guess its not avoidable. Plan is to on failure fire off a call (probably synchronous) to the master to cleanup the FS for that table backup; first writes an &apos;invalid&apos; marker for that table directory and then recursively deletes the regions and then the table directory in the archive. We should be able to return after writing the invalid marker as it would get cleaned up at some point. Associated unit tests would be: general table archive failure, master died mid-archive failure and recovery cleanup. &lt;/p&gt;

&lt;p&gt;Also thinking about removing the per-table archive in favor of an overall archive directory oriented to tables (and dropping a choice of which directory to archive, in favor of just using the config value). This makes particular sense for snapshots, but is also nice to ensure easier lookups of table values:&lt;br/&gt;
/hbase/.archive/&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; &lt;/p&gt;

&lt;p&gt;rather than the current:&lt;br/&gt;
/hbase/&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt;/.archive&lt;/p&gt;

&lt;p&gt;where .archive could actually be any directory the user specified on creation time, which can easily lead to &apos;loss by forgetfulness&apos;.&lt;/p&gt;</comment>
                            <comment id="13251769" author="zhihyu@ebaysf.com" created="Wed, 11 Apr 2012 17:31:50 +0000"  >&lt;p&gt;For the recovery cleanup, can we remember the start time of archiving and only delete archive files which are written after this start time ?&lt;br/&gt;
I like the /hbase/.archive/&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt; structure.&lt;/p&gt;</comment>
                            <comment id="13251775" author="jesse_yates" created="Wed, 11 Apr 2012 17:42:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;For the recovery cleanup, can we remember the start time of archiving and only delete archive files which are written after this start time &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;totally. I was actually thinking this was the way to go about it last night and completely forgot it this morning. Thanks for looking out &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13252963" author="jiraposter@reviews.apache.org" created="Thu, 12 Apr 2012 23:25:13 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review6902&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review6902&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Patch looks good.  Some concerns in the below.&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15341&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15341&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Do these defines need to be global?  Could they be package scoped?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15342&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15342&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    What is one of these?  Might say so in here.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15343&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15343&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Good doc.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15344&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15344&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Are you missing a version that takes a String?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15345&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15345&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Does it have to be public?  Can it be only of this package?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15346&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15346&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is there a close on this class so we can cleanup the zkw?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15347&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15347&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should this stuff be generally accessible?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15348&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15348&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    We are in master package.  Why reach over into regionserver package?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15349&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15349&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can hfilemanager be an interface so that when standing up a region to test, we don&apos;t have to know much about this type?&apos;&lt;/p&gt;

&lt;p&gt;    hmm... I see it is an Interface.  Good.  Thanks.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15350&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15350&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This thing is watching a per table config?  Other per table configs are whether a table is enabled or not.  Should we coalesce?  This is also a configuration maintained via another system, one that persists to zk rather than to an hbase-site.xml or into an HTableDescriptor.  Why not go into an htabledescriptor?  Nicolas just made it dynamically configurable though the table is rolled&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15351&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15351&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Does it need to be public?  I see master reaches over to get this class so for that its needed but maybe it coudl be packaged elsewhere?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15352&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15352&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Do you have to stop this on way out?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15354&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15354&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why a ref into regionserver package?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15353&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15353&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Whats this class do?&lt;/p&gt;

&lt;p&gt;    Should it be abstract since others subclass it?&lt;/p&gt;

&lt;p&gt;    Does it need to be public?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15355&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15355&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why these references?  Should this tracker be in regionserver package?  (Though seems like we are collecting trackers here)&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15356&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15356&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I think its bad that we do this.&lt;/p&gt;

&lt;p&gt;    Not your fault.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-04-07 19:51:11, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-04-07 19:51:11)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java a4b989e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 16e4017 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java fb21bdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java c3df319 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 8a61f7d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 509a467 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 44ee689 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java 41616c8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java b4dcb83 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13253567" author="jiraposter@reviews.apache.org" created="Fri, 13 Apr 2012 17:36:14 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review6914&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review6914&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15366&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15366&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can the checks in the while loop be reversed, so that we check the counter first and then call the allRegionsDoneBackup(). Will this help in removing the call to disableHFileBackup, or am i missing anything here. &lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15363&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15363&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    yeah, instantiation of this call is done more than once in a single code path (call to HBaseAdmin-&amp;gt;enableHFileBackup()). Good to have some closing behavior.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15364&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15364&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    How costly is this op; the reason I ask is it will be useful only once; once the znode is there, this call has no value.&lt;br/&gt;
    (Still learning zk stuff, kindly ignore if you think so)&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15375&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15375&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    minor nit: &quot;is&quot; enabled?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15376&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15376&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    you made the deleteRegion to rawDeleteRegion? lol, but that sounds a bit secondary &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
    Why not keep delete or sth deleteWithNoArchive? &lt;/p&gt;




&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15369&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15369&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Yes, please add some doc to it. &lt;br/&gt;
    It is instantiated in HMaster, so can&apos;t be abstract?&lt;br/&gt;
    &amp;lt;&amp;gt;Tracker and &amp;lt;&amp;gt;Monitor doesn&apos;t seem to give a clearer picture, somehow, especially, when tracker implements the monitor?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Himanshu&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-04-07 19:51:11, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-04-07 19:51:11)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java a4b989e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 16e4017 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java fb21bdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java c3df319 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 8a61f7d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 509a467 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 44ee689 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java 41616c8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java b4dcb83 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13253606" author="jiraposter@reviews.apache.org" created="Fri, 13 Apr 2012 18:20:16 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review6917&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review6917&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15382&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15382&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You wouldn&apos;t have chance to do that if it fails as there will be an IOException?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15385&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15385&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I see; you trying to archive files, and just delete in case there is any failure for some hfiles.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15387&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15387&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I miss this; who is calling this addTable?&lt;br/&gt;
    It would be great to have the usecase.&lt;br/&gt;
    (sorry for reviewing it piece meal, its a huge patch as per my standards &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15389&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15389&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    And, what are the better alternatives (some subclass holding all these constants, or something more aesthetic).&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Himanshu&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-04-07 19:51:11, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-04-07 19:51:11)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java a4b989e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 16e4017 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java fb21bdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java c3df319 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 8a61f7d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 509a467 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 44ee689 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java 41616c8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java b4dcb83 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13254803" author="jesse_yates" created="Mon, 16 Apr 2012 16:55:46 +0000"  >&lt;p&gt;Adding dependency on transactional, recoverable deleteRecursively in ZKUtil. Makes this patch notably (if not significantly) simpler.&lt;/p&gt;</comment>
                            <comment id="13256823" author="jesse_yates" created="Wed, 18 Apr 2012 18:55:18 +0000"  >&lt;p&gt;Talked offline with Lars about the design of this patch. Currently, it is updating ZK with the table to archive and then essentially waiting on all the RS to respond that they recieved the update (simple barrier) before considering backups enabled (in the syncrhonous case). This means we get high overhead to zk when turning on/off backups, but not a lot when hfiles are deleted. However, this adds a lot of complexity around watching for nodes, making sure you get updates, etc. which has been the source of a bit of pain in the development of this patch.&lt;/p&gt;

&lt;p&gt;The alternative design is one where the client just writes the &apos;enable archiving on this table&apos; node to ZK and then when any of the RS want to delete an hfile they go an read ZK. The thought here is that we always have a consistent view of which tables need to be archived without the complexity of keeping up-to-date with the latest state. This means a much simpler design for checking if we should archive a table and very fast enable/disable for backups.&lt;/p&gt;

&lt;p&gt;Clearly, there is a tradeoff in that we have to make a network roundtrip to read if we should delete or archive a table, but there is little else that needs to happen on the server or wire (zk holds the info in memory and all thats happening is a checkExists). However, compared to the time cost in deleting a multi-MB to GB file, this roundtrip seems negligable.&lt;/p&gt;

&lt;p&gt;The last alternative would be the dynamic configuration that nicholas recently rolled into trunk. From what I gather from stack&apos;s comments, this would take a disable/enable on a table for the change to propagate to the HTD (please correct me if I&apos;m wrong here). This just seems like a lot of flux on a table for a backup situation that I was thinking could occur as often as a nightly basis. Making the database unavailable just for backup is unreasonable and should be done dynamically, with minimal impact to the cluster.&lt;/p&gt;

&lt;p&gt;What does everyone think? I&apos;m happy to do the rewrite on the patch to make either of the alternative designs work, as the current on is not quite ready (just needs to have the barrier stuff reworked slightly to have new/split regions register for  archiving).&lt;/p&gt;</comment>
                            <comment id="13256861" author="stack" created="Wed, 18 Apr 2012 19:19:34 +0000"  >&lt;p&gt;Is the problem in #1 the client waiting on acks from all the regionservers?  Does it need to do this?  Can it not just set the state up in zk and then just move on (You have this in your patch already if I remember rightly).  Do you want the RS&apos;s acknowledging that they have been set into backup mode?  They could set a flag up in zk but this gets torturous when say we add a new feature that wants to do some thing similar.&lt;/p&gt;

&lt;p&gt;If we had a dynamic Configuration system, one that didn&apos;t require roll of table to set the table &apos;read-only&apos; or &apos;in-back-up mode&apos;, would that help here?&lt;/p&gt;

&lt;p&gt;One option #2, yeah, its a pain going to zk for each WAL when there is this callback mechanism that all RS are subscribed to anyways.  For sure could poll zk the first time but should then cache the setting and only drop it later if a callback says it changed.&lt;/p&gt;

&lt;p&gt;Agree roll of table to set the backup flag is much too heavyweight.&lt;/p&gt;</comment>
                            <comment id="13256887" author="zhihyu@ebaysf.com" created="Wed, 18 Apr 2012 19:46:37 +0000"  >&lt;p&gt;Currently we have the following in enable():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// then add the table to the list of znodes to archive
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tableNode = getTableNode(zooKeeper, table);
    ZKUtil.createSetData(zooKeeper, tableNode, archive);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If we encode the backup mode in the data associated with the table node, the region servers would be able to register watcher for the table nodes (under zooKeeper.archiveHFileZNode). This way region servers would get notification from zk about whether backup mode is effective.&lt;/p&gt;</comment>
                            <comment id="13256939" author="jesse_yates" created="Wed, 18 Apr 2012 20:44:33 +0000"  >&lt;p&gt;@Ted, stack: there is a race condition where the client thinks that backups are active, when ZK hasn&apos;t in fact sent watch notifications to all the RS. Granted, this is a small time window (hopefully), but is definitely a concern and something that I&apos;ve seen take up to a few seconds to propagate. It&apos;s probably not a big deal, but that is the concern and if you are doing tables backups based on when archiving is enabled, you want to make sure archiving is in fact enabled on all nodes.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;If we encode the backup mode in the data associated with the table node, the region servers would be able to register watcher for the table nodes &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Are you basically talking about doing per-table configuration storage in the table znode? I think this would be completely viable with the transaction stuff - essentially check the version and update the data if matches expected, if not propose new value and try again (see below for paxos concerns, though this isn&apos;t actually all that rough from the client side). &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;If we had a dynamic Configuration system, one that didn&apos;t require roll of table to set the table &apos;read-only&apos; or &apos;in-back-up mode&apos;, would that help here?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s essentially what I was building here, but just for state changes. Unfortunately, its pretty close to Paxos (propsing new value, getting acceptance, confirming value update to client), and has a lot of complexity to ensure changes propagate - the latter being the biggest concern from a &apos;consistent view of the cluster by the client&apos; standpoint.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;For sure could poll zk the first time but should then cache the setting and only drop it later if a callback says it changed.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If they are disabled, they need to check everytime to see if it has been enabled. Once it has been enabled, it could then wait for the disable to propagate via notifications because the excess backup files aren&apos;t a big deal, but the loss of backup files is an issue.&lt;/p&gt;</comment>
                            <comment id="13256956" author="stack" created="Wed, 18 Apr 2012 20:56:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;...but is definitely a concern and something that I&apos;ve seen take up to a few seconds to propagate.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah.  If you don&apos;t want a window, query the regionservers (you&apos;ll need to add something to query but...)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;... Are you basically talking about doing per-table configuration storage in the table znode?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was stating then that we already are doing a per table attribute up in zk &amp;#8211; whether enabled or disabled &amp;#8211; and that rather than do up new nodes for a new attribute that instead we should add to the table znode the new attribute.  That was then.  Now I&apos;m suggesting we put all config up there.  We could start w/ HTD if we want to keep it table scoped (we&apos;d have another tier in front of the one Nicolas added, a dynamic one).&lt;/p&gt;

&lt;p&gt;If the above too ambitious, we should at least generalize the table znode so can add attributes and we might as well pb serialize the HTD as anything else?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;...If they are disabled, they need to check everytime to see if it has been enabled&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Or just watch the table znode and if it changes, check if backup has been flipped on.&lt;/p&gt;</comment>
                            <comment id="13257087" author="jesse_yates" created="Wed, 18 Apr 2012 23:35:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yeah. If you don&apos;t want a window, query the regionservers (you&apos;ll need to add something to query but...)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was trying to avoid making a change to the RS interface just for the check to see if it has propagated. However, this is a valid case, but requires a scan of META to see the regions and associated RS that need to be pinged. A little rough on IO, but certainly doable.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;...If they are disabled, they need to check everytime to see if it has been enabled&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Did this to minimize the latency for changes to propagate and minimize the zk logic for tracking nodes. If we tied the watching of the table znode state/config with updating the status, then yeah, this would be doable. I can see doing another set of property listeners for table properties - could actually be really nice. Wanna file a ticket?&lt;/p&gt;</comment>
                            <comment id="13257114" author="lhofhansl" created="Thu, 19 Apr 2012 00:35:11 +0000"  >&lt;p&gt;What I had in mind when I filed this was something quite simple: A single znode that all RegionServers would check when deleting any HFile and then based on existence or value of that znode either delete the HFile or rename it. Of things are never quite as simple...&lt;/p&gt;

&lt;p&gt;To get a guaranteed consistent snapshot the RegionServers need to check for the znode&apos;s value synchronously in the delete path (or at least I see no other way). Otherwise there are times when the RegionServers do not agree and some files will be deleted and some will be backed up with no possibility for the client to know exactly as of when the backup would be consistent.&lt;/p&gt;

&lt;p&gt;Since HFiles are deleted as result of a compaction in an asynchronous thread, synchronously checking the znode should not cause performance issues, unless we fear we&apos;ll overload ZK.&lt;/p&gt;

&lt;p&gt;This simple solution would add special code for just this scenario, which is bad. At the same time it would be relatively simple (famous last words), so that&apos;s something to weigh.&lt;/p&gt;</comment>
                            <comment id="13257810" author="stack" created="Thu, 19 Apr 2012 21:00:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;To get a guaranteed consistent snapshot the RegionServers need to check for the znode&apos;s value synchronously in the delete path (or at least I see no other way).  Otherwise there are times when the RegionServers do not agree and some files will be deleted and some will be backed up with no possibility for the client to know exactly as of when the backup would be consistent.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This would make for the narrowest possible window regards whether backup is on or off.&lt;/p&gt;

&lt;p&gt;Does it have to be a custom znode?  If we had a Configuration or Table znode, it could read the content?  Maybe checking existence is cheaper than reading znode content though?&lt;/p&gt;
</comment>
                            <comment id="13257818" author="lhofhansl" created="Thu, 19 Apr 2012 21:12:08 +0000"  >&lt;p&gt;For this I was actually thinking a single cluster-wide setting (&quot;This HBase cluster is now in backup mode&quot;), which would affect all tables would be sufficient.&lt;/p&gt;

&lt;p&gt;But could do per table as well as Jesse has done and it definitely does not need to be a custom znode, checking a value is fine.&lt;/p&gt;</comment>
                            <comment id="13257834" author="jesse_yates" created="Thu, 19 Apr 2012 21:33:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe checking existence is cheaper than reading znode content though?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think it would be appreciable. It still has to to go memory to check existence, so the only loss is the time to write the content over the wire (negligible in our case when we have around a 1KB of configuration info).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If we had a Configuration or Table znode, it could read the content&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Certainly. But then there is the work to finish that code (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3909&quot; title=&quot;Add dynamic config&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3909&quot;&gt;HBASE-3909&lt;/a&gt; if I&apos;m not mistaken), which still seems a long way off. &lt;/p&gt;

&lt;p&gt;This may all (except for the table config stuff, which would be an arguably &apos;better&apos; version) be moot as I do have a version working now that does synchronous checking to make sure that all necessary RS received the update have updated zk that they have received the notification. Avoids the problem of splits/merges per region as its all on the RS level. There is still a bit of cleanup I need to do on the patch before posting the another review, but the core of the functionality is there.&lt;/p&gt;</comment>
                            <comment id="13262207" author="jiraposter@reviews.apache.org" created="Wed, 25 Apr 2012 22:30:14 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review7224&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review7224&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15915&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15915&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Things shared across, IMO, should stay here. Also, the znode style seems to be to put it in constants. Probably a bigger issue around how the zkutil works.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15916&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15916&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15921&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15921&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    @Himanshu - yeah, that should help a bit.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15977&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15977&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    not anymore - new version ignores specifying an archive dir and instead goes with a cluster wide config.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment15980&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment15980&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16003&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16003&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16004&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16004&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    this class is more of just a way to wrap this up from the admin. Otherwise, it would just be there.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16005&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16005&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    has to be added, since createWithParents just creates the znode, not the data in that node. Could modify ZKUtil, but this seemed sufficient and don&apos;t think we have a lot of use cases where the node has data. If we do, think it would be reasonable to add a zk call. &lt;/p&gt;

&lt;p&gt;    In terms of cost, its basically 1 ping to the server to ensure that the node exists, which would have to happen anyways if we create the table node since we can&apos;t bundle calls together until we make ZK 3.4 a requirement.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16006&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16006&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    moved to o.a.h.h.backup package.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16007&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16007&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Moved to o.a.h.h.backup, but then still needs to be public.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16008&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16008&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16009&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16009&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16010&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16010&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    nope as it just uses the passed in zk, rather than creating its own. start here is just a way to bootstrap it to the current state of the system.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16011&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16011&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Yeah, but if you have an IOException creating a directory you are kind of hosed anyways.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16012&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16012&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Turns out this is overly complicated based on the fact that hashes here are incredibly unlikely to conflict, so still doing a timestamp, but this time just appending the ts to the name of the file and moving it, rather than all this business with directories.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16013&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16013&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    gone, in backup (see above).&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16014&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16014&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    yeah, we are collecting them here, but since its used across all, moved them to their own package.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16015&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16015&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    its used lower, so RS can hook in confirming joining archiving.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16016&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16016&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    agreed. Someone should think about it some more and file a jira. Maybe some configuration based loading of short-lived visitor-like classes?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jesse&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-04-07 19:51:11, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-04-07 19:51:11)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java a4b989e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 16e4017 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java fb21bdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HFileArchiveMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java c3df319 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 8a61f7d &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 509a467 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RegionServerHFileTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 44ee689 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java 41616c8 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java b4dcb83 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13262279" author="jiraposter@reviews.apache.org" created="Thu, 26 Apr 2012 00:25:12 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2012-04-26 00:24:36.588824)&lt;/p&gt;


&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updates:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;check-in for received archive request is synchronous (no change there) &lt;em&gt;per regionserver&lt;/em&gt;&lt;/li&gt;
	&lt;li&gt;configuration based rather than request based archive directory&lt;/li&gt;
	&lt;li&gt;extracting out tabletracker from the archivetracker&lt;/li&gt;
	&lt;li&gt;stop() method (and usage) on ArchiveManager&lt;/li&gt;
	&lt;li&gt;simplified timestamped backups&lt;/li&gt;
	&lt;li&gt;cleanup of archive files is now done by external utility, rather than attempting to deal with master failure and recovery&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;

&lt;p&gt;Implementation wise: &lt;br/&gt;
    Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;br/&gt;
    Added a zk listener to handle updates from the master to the RS to backup.&lt;br/&gt;
    Added a utility for removing files and finding archive directories&lt;br/&gt;
    Added tests for the regionserver and catalogjanitor approaches.&lt;br/&gt;
    Added creation of manager in regionserver.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HConstants.java a9d80a0 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveMonitor.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java ee16e72 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java d47b83a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 7858846 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 61a5988 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerHFileTableArchiveTracker.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java ea12da4 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java bf1618e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/HFileArchiveCleanup.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;br/&gt;
  src/main/resources/hbase-default.xml f54b345 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java a59e152 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java cedf31e &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/util/TestHFileArchivingCleanup.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jesse&lt;/p&gt;
</comment>
                            <comment id="13263906" author="jiraposter@reviews.apache.org" created="Fri, 27 Apr 2012 19:30:45 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review7318&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review7318&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16155&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16155&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    &apos;for which&apos; -&amp;gt; &apos;the&apos;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16156&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16156&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Insert &apos;whose&apos; between &apos;tables&apos; and &apos;HFiles&apos;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16157&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16157&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The condition for calling addAndReWatchTable() is when table exists.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16159&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16159&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The method name is confusing.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16158&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16158&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    When would this be true, considering that we have come through line 106 ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16160&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16160&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    &apos;reup&apos; -&amp;gt; &apos;renew&apos; ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16161&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16161&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    getTracker() and direct read of tracker appear on the same line ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16162&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16162&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can you use archivedTables.addAll() ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16163&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16163&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Remove the &apos;s&apos; following &apos;Region&apos;&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-04-26 00:24:36, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-04-26 00:24:36)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java a9d80a0 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java ee16e72 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java d47b83a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 7858846 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 61a5988 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerHFileTableArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java ea12da4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java bf1618e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveCleanup.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml f54b345 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java a59e152 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java cedf31e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/TestHFileArchivingCleanup.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13265609" author="jiraposter@reviews.apache.org" created="Tue, 1 May 2012 02:32:45 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review7410&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review7410&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16338&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16338&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    agreed. I&apos;ll try to find something better.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16339&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16339&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    zk add/remove conditions where you need to keep re-adding watches. figure we do the check for the table at the same time.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16340&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16340&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    removed the creation of the tracker in favor of just passing in one - its really light weight and this should remove some of the issues around it; in short, yes.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16341&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16341&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    switching this mechanism to allow more fine grained listening by table trackers.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jesse&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-04-26 00:24:36, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-04-26 00:24:36)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java a9d80a0 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java ee16e72 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java d47b83a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 7858846 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 61a5988 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerHFileTableArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java ea12da4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java bf1618e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveCleanup.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml f54b345 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java a59e152 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java cedf31e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/TestHFileArchivingCleanup.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13265613" author="jiraposter@reviews.apache.org" created="Tue, 1 May 2012 02:42:45 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2012-05-01 02:42:34.215505)&lt;/p&gt;


&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;TableTracker is now an abstract class that the catalogjanitor and rs are&lt;br/&gt;
    both using to register for tracking a table.&lt;/li&gt;
	&lt;li&gt;Adding monitoring in admin to check for cj to join archiving (before was missed) and including test&lt;/li&gt;
	&lt;li&gt;Slight cleanup from Ted&apos;s comments.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;

&lt;p&gt;Implementation wise: &lt;br/&gt;
    Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;br/&gt;
    Added a zk listener to handle updates from the master to the RS to backup.&lt;br/&gt;
    Added a utility for removing files and finding archive directories&lt;br/&gt;
    Added tests for the regionserver and catalogjanitor approaches.&lt;br/&gt;
    Added creation of manager in regionserver.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HConstants.java a9d80a0 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveMonitor.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableTracker.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/backup/ServerHFileTableArchiveTracker.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java ee16e72 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java d47b83a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 7858846 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 61a5988 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java ea12da4 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java bf1618e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/HFileArchiveCleanup.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;br/&gt;
  src/main/resources/hbase-default.xml f54b345 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java a59e152 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java cedf31e &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/util/TestHFileArchivingCleanup.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jesse&lt;/p&gt;
</comment>
                            <comment id="13265627" author="zhihyu@ebaysf.com" created="Tue, 1 May 2012 04:03:58 +0000"  >&lt;p&gt;@Jesse:&lt;br/&gt;
Do you want to attach patch so that Hadoop QA can run test suite ?&lt;/p&gt;</comment>
                            <comment id="13265709" author="jesse_yates" created="Tue, 1 May 2012 08:47:53 +0000"  >&lt;p&gt;Attaching patch rebased on trunk (but otherwise same as RB) as per request.&lt;/p&gt;</comment>
                            <comment id="13265851" author="hadoopqa" created="Tue, 1 May 2012 15:03:19 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525163/java_HBASE-5547_v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525163/java_HBASE-5547_v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 15 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 3 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestCheckTestClasses&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1705//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1705//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1705//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1705//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1705//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1705//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13265973" author="jesse_yates" created="Tue, 1 May 2012 19:01:12 +0000"  >&lt;p&gt;Attaching version with fixed test and correction to the one real findbugs warning.&lt;/p&gt;</comment>
                            <comment id="13266013" author="hadoopqa" created="Tue, 1 May 2012 19:58:34 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525196/java_HBASE-5547_v5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525196/java_HBASE-5547_v5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 15 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 2 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestRegionHFileArchiving&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestServerCustomProtocol&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1709//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1709//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1709//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1709//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1709//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1709//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13266081" author="jesse_yates" created="Tue, 1 May 2012 20:50:50 +0000"  >&lt;p&gt;arg! Thought I had resolved the concurrency issue in TestRegionHFileArchiving. Looking into it.&lt;/p&gt;</comment>
                            <comment id="13266180" author="jesse_yates" created="Tue, 1 May 2012 22:01:01 +0000"  >&lt;p&gt;Attaching new patch. Just ran the test 10 times locally, no failures.&lt;/p&gt;</comment>
                            <comment id="13266190" author="jiraposter@reviews.apache.org" created="Tue, 1 May 2012 22:14:45 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review7448&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review7448&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Great work.  High-level, do we have to have backup/archiving touch all parts of the code base?  Can we not hide it behind more general Interfaces at least when we get down into Store and Region classes&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveMonitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16389&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16389&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Tables or hfiles?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveMonitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16384&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16384&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should this interface be at top level?  Its used out of the master and regionserver packages&lt;/p&gt;

&lt;p&gt;    The implementations could be stay under backup long as we only use the Interface?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16390&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16390&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    hfiles or tables?&lt;/p&gt;

&lt;p&gt;    Looks like this class would select hfiles by selected tables&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16387&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16387&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Tracker in hbase usually means tracking znodes up in zookeeper.  This tracks something else.  Could confuse.  Use different action?  Manager&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16385&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16385&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Good.  I like that you are taking a &apos;Server&apos; here rather than a Master or Regionserver or even a ServerName.&lt;/p&gt;

&lt;p&gt;    Does this have to be public?  Seems like its utility used by the later HFileArchiveTracker.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16386&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16386&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Do we have to have a set?  Does this Set change during live of this tracker?&lt;/p&gt;

&lt;p&gt;    Should javadoc say that previous members of Set are cleared out?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16388&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16388&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    good&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16392&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16392&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    How does this tracker relate to the containing class?  They are different types of trackers?  Could confuse?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16391&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16391&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why pass it in?  Why not just create one and keep it running internally? &lt;/p&gt;

&lt;p&gt;    The class HFileArchiveTableTracker is a little confusing.... &lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16395&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16395&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Want to mention in class comment that user needs to call start, etc., to start up the tracking?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16399&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16399&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I think it kinda bad that zkw does this... you&apos;d think each tracker would look after its own stuff (this is not you.. you are folllowing the established pattern as you should &amp;#8211; I&apos;m just moaning)&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16400&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16400&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this what ZKUtil.getNodeName does?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16401&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16401&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    nit style.  if you did if (!path.startsWith...) return; ... you could save an indent of the whole method.  Next time.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16403&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16403&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    These znodes have nothing in them... just the tablename of the znode is used?  Nothing to pb then?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/ServerHFileTableArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16405&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16405&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is under each table znode?  Why we inherit from HFileArchiveTableTracker?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16407&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16407&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this doing backup? Or making it so the hfiles are not deleted on this table?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16409&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16409&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    ditto... this just throws a switch on the don&apos;t delete operation?  Something else does the backup?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16410&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16410&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    table hfiles?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16411&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16411&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why this class have to have both these classes?  Can it not just make do w/ Interface?  If not, does Interface need broadening?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16412&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16412&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should this be getHFileManager?&lt;/p&gt;

&lt;p&gt;    Should it be getTableArchivingManager?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16413&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16413&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can this not just be Interface?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16414&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16414&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You think this an hfile archive tracker or is it a table archive tracker?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16415&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16415&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Does the master need to know anythign about this?  Can this be done in the catalogjanitor completely?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16416&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16416&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is the testing code in same package?  IF so, wouldn&apos;t need the public qualifier&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16417&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16417&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    ditto&lt;/p&gt;

&lt;p&gt;    ... this doesn&apos;t exist already?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16418&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Interface?  Odd that we have a reference to this in here.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16419&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16419&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Could this be a different, more abstract Interface?  HFileArchiver with an &apos;archive&apos; method on it which return true if we are to archive otherwise, false if its for delete. &lt;/p&gt;

&lt;p&gt;    Would like to avoid too much of the backup detail coming down deep in here into HRegion.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16420&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16420&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Or, could the whole delete/archive thing be hidden behind an hfile disposer Interface?  Pass it hfiles to dispose of.  It will delete or archive?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16421&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16421&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This archiving code shouldn&apos;t be in here?  Should be in its own class?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16422&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16422&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Yeah, seems odd polluting hregion w/ archiving?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16423&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16423&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can this be Interface?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16424&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16424&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    A factory?  Is that too much?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16425&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16425&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You should leave these.  These are ok by our style convention.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16426&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16426&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Yeah, these are ok... don&apos;t change them.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16427&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16427&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This for tests too?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16428&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16428&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Does this have to come out here?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16429&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16429&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Has to come down in here? Can&apos;t this be done at higher up levels?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16430&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16430&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Ditto on archiving/delete pollution down in here.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveCleanup.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16431&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16431&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    These lines have to be this long?&lt;/p&gt;

&lt;p&gt;    Does this tool belong in backup package?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16432&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16432&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Has to reach over into these packages?&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16433&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16433&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This has to be in here?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-05-01 02:42:34, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-05-01 02:42:34)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java a9d80a0 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/ServerHFileTableArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java ee16e72 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java d47b83a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 7858846 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 61a5988 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java ea12da4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java bf1618e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveCleanup.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml f54b345 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java a59e152 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java cedf31e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/TestHFileArchivingCleanup.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13266307" author="jiraposter@reviews.apache.org" created="Wed, 2 May 2012 03:02:49 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review7458&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review7458&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Thanks for the review. Going to do a bit of investigation as to more commonality/interface hiding, but unfortunately we handle hfiles in both the RS and Master (and need to actuate from the client), so we need to touch a lot. &lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveMonitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16469&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16469&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    hfiles, tables are another patch &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveMonitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16468&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16468&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    top-level as in o.a.h.hbase? Seems like a bit of clutter and this is just a specialization on that packaging and IMO doesn&apos;t preclude either master or rs packages from usage.&lt;/p&gt;

&lt;p&gt;    But I can move it if there are strong feelings.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16470&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16470&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    your right, fubbing my commenting a bit.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16471&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    But its does tracking! And it doesn&apos;t actually actuate any changes on the rest of the cluster so Manager seems bad too. How about Monitor?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16472&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16472&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Started thinking about your later comment about a factory in HRS.java and think I&apos;m going with the static factory method there. This still needs to be public for testing, but in general we will use the the ServerArchiveTableTracker (and I&apos;ll add docs to that effect as well).&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16473&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16473&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    It won&apos;t be used except for at startup, but seemed bad practice to prematurely read ZK before we get the start call on the parent. At the very least we can say that we are removing the previous tables though.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16474&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16474&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should be fixed with the naming change above.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16475&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16475&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Yeah, its definitely a bit odd. Going with a factory here and only having the pass in option for testing exposure. See above (tabletracker) and below (hrs) for more info on the factory stuff.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16476&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16476&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    done.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16477&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16477&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Yeah, its pretty gross. I&apos;ve been thinking about the ways we can fix this/overhaul the zookeeper infrastructure.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16478&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16478&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is actually a little nicer in that it doesn&apos;t preclude you from having a table named the same thing as the archive directory.&lt;/p&gt;

&lt;p&gt;    Otherwise, you are checking the node vs. the node name of watcher.archiveHFileZNode, which could be the same. &lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16479&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16479&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Done. Seemed to be the prevailing style, but this goes back to the fact that the watcher stuff if crufty.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16480&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16480&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    correct! Though anything in them would naturally be pb-ed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/ServerHFileTableArchiveTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16481&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16481&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Inherit from tabletracker so we know when we should archive. However, seems like a bit cleaner to just let the subclasses just override registerTable() for testing.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16482&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16482&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    what do you mean by backup? Its moving them to another directory, rather than being deleted. Sounds like backup to me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16483&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16483&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    just throws a switch. should note its async, so you could have some extra backup files, but ZK is fast, so it shouldn&apos; be that many.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16484&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16484&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    yup.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16485&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16485&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Only need one - the other is going to be unused in revised version.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16486&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16486&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Cruft naming - fixed.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16487&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16487&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    cruft - just needs the tracker now. Paradigm seems to be to &lt;em&gt;not&lt;/em&gt; have that be an interface.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16488&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16488&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    per-table hfile archiving tracker. So... both and neither? Name seems to be ok...maybe something like TableHFileArchiveTracker?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16490&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16490&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    master didn&apos;t, but didn&apos;t want to add all the zk dependencies into the CJ. And if the archive stuff gets more complex, it might need to be in the master (weak excuse, but still...)&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16489&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16489&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    truth.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16491&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16491&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    nope, and its a private field.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16492&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16492&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Not really - it only cares about if the HFiles should be archived or not, which is what the monitor is doing.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16493&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16493&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    The monitor is what is keeping track of the archive/not logic, but yeah, this could be encapsulated in another class. Wanted to avoid all the redirection, since the code doesn&apos;t seem all that complex but moving it out could be reasonable.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16494&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16494&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    see above.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16495&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16495&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    much cleaned up.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16466&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16466&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I was actually initially considering using a factory here, but its definitely not. Rather, just creating the ServerHFileArchiveTracker with a &quot;Server&quot; instance that will give it the correct server name to register, so its kinda factory-ish, but there is only ever one instance (rather than a tabletracker creating class) and is super light weight, as opposed to all the double-checked locking, special creating etc that goes around using a factory in this situation. &lt;/p&gt;

&lt;p&gt;    The current impl seems to be the simplest, though I guess we could use an ArchiveTracker factory that takes a zk and Server; seems a bit overkill, though it does hide some of the impl details...&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16467&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16467&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    fat-fingered the save on HRS.java. Sorry for the cruft. I&apos;ll fix it in the next review.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16496&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16496&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    No, this is for how the delete method is currently setup - takes a regionServerServices, which hides impl details, meaning we need to have this method. But its nice for testing too.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16497&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16497&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This ends up being cleaner - otherwise each region actually needs to keep around a reference to the ArchiveMonitor and then pass it into deleteRegion (in HRegion.merge). But if the predominant opinion is to keep that around instead, I can make the change. &lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16498&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16498&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is situation 2 where hfiles need to be archived. Tried to keep as much in common between the two situations, but there is limited commonality between the &quot;Archive everything here&quot; and &quot;just archive these couple files&quot; functionality.&lt;/p&gt;

&lt;p&gt;    And either case, you need to know if you keep around the hfiles.&lt;/p&gt;

&lt;p&gt;    I&apos;ll try to do some more combining, but we&apos;ll see how much more I can pull out.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveCleanup.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16499&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16499&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Nope, eclipse just didn&apos;t want to format this to wrap. Fixed. And moved into backup package.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16500&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16500&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Just for static methods. Makes it easier for the method interfaces, but I&apos;ll look into if simplifying makes more sense.&lt;/p&gt;



&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment16501&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment16501&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    regionserverservices - yup. see above comment and see if you think differently.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jesse&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-05-01 02:42:34, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-05-01 02:42:34)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java a9d80a0 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/ServerHFileTableArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java ee16e72 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java 79d5fdd &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java d47b83a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 7858846 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 61a5988 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java ea12da4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java bf1618e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveCleanup.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 4fc105f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml f54b345 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java a59e152 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java cedf31e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 7d02759 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/TestHFileArchivingCleanup.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13272727" author="jiraposter@reviews.apache.org" created="Thu, 10 May 2012 20:30:46 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2012-05-10 20:28:50.691971)&lt;/p&gt;


&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Refactoring as per stack&apos;s comments. Also, updated the testing to avoid flapping. &lt;/p&gt;

&lt;p&gt;I think this is pretty close to ready for commit.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;

&lt;p&gt;Implementation wise: &lt;br/&gt;
    Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;br/&gt;
    Added a zk listener to handle updates from the master to the RS to backup.&lt;br/&gt;
    Added a utility for removing files and finding archive directories&lt;br/&gt;
    Added tests for the regionserver and catalogjanitor approaches.&lt;br/&gt;
    Added creation of manager in regionserver.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HConstants.java 2f432c4 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveCleanup.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveMonitor.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableMonitor.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/backup/HFileDisposer.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/backup/TableHFileArchiveTracker.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 5d4be3f &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java e751f65 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 0ad9b18 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 1f09be1 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java f7ac81a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java bf1618e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 33bc1d0 &lt;br/&gt;
  src/main/resources/hbase-default.xml 42d1c4e &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 9fba339 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/backup/SimpleHFileArchiveTableMonitor.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/backup/TestHFileArchivingCleanup.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/backup/TestRegionDisposer.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java 69ccc65 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1020374 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 3f61cfb &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jesse&lt;/p&gt;
</comment>
                            <comment id="13272756" author="zhihyu@ebaysf.com" created="Thu, 10 May 2012 20:58:51 +0000"  >&lt;p&gt;@Jesse:&lt;br/&gt;
Do you want to post latest patch here for Hadoop QA ?&lt;/p&gt;</comment>
                            <comment id="13272764" author="jesse_yates" created="Thu, 10 May 2012 21:11:31 +0000"  >&lt;p&gt;Attaching latest version for a QA run.&lt;/p&gt;</comment>
                            <comment id="13272848" author="jiraposter@reviews.apache.org" created="Thu, 10 May 2012 22:30:46 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4633/#review7794&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#review7794&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Heading to a meeting.&lt;br/&gt;
Below is first part of review.&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveCleanup.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment17105&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment17105&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    We know all is true when table is null, right ?&lt;/p&gt;

&lt;p&gt;    Seems we don&apos;t need this boolean.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveCleanup.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment17100&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment17100&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    &quot;aren&apos;t&quot; -&amp;gt; &quot;are&quot;&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveCleanup.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment17101&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment17101&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Either remove &apos;down&apos; or move it to the end of the sentence&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveCleanup.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment17102&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment17102&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please check return value.&lt;/p&gt;

&lt;p&gt;    I think we should remember the files which we are unable to delete and display them at the end.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveCleanup.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment17104&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment17104&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Would anyone specify start == end ?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableMonitor.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment17106&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment17106&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    License, please.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileDisposer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment17107&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment17107&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    License.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileDisposer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment17108&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment17108&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This condition deserves an exception, I think.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileDisposer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/4633/#comment17109&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/#comment17109&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is it possible to provide more information in this exception ?&lt;br/&gt;
    e.g. by using toArchive collection ?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2012-05-10 20:28:50, Jesse Yates wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2012-05-10 20:28:50)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Michael Stack and Lars Hofhansl.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Essentially, whenever an hfile would be deleted, it is instead moved to the archive directory. In this impl, the archive directory is on a per table basis, but defaults to &apos;.archive&apos;. Removing hfiles occurs in three places - compaction, merge and catalog janitor. The former and two latter are distinctly different code paths, but but did pull out some similarities. The latter two end up calling the same method, so there should be a reasonable amount of overlap.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Implementation wise: &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Updated the HMasterInterface to pass the calls onto the zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a zk listener to handle updates from the master to the RS to backup.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added a utility for removing files and finding archive directories&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added tests for the regionserver and catalogjanitor approaches.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added creation of manager in regionserver.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5547&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java 2f432c4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveCleanup.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileArchiveTableMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/HFileDisposer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/backup/TableHFileArchiveTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 5d4be3f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HFileArchiveManager.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java e751f65 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 0ad9b18 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 1f09be1 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java f7ac81a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java 6884d53 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java bf1618e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 33bc1d0 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-default.xml 42d1c4e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 9fba339 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/backup/SimpleHFileArchiveTableMonitor.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/backup/TestHFileArchivingCleanup.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/backup/TestRegionDisposer.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java 69ccc65 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1020374 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionHFileArchiving.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 3f61cfb &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4633/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Added two tests for the separate cases - archiving via the regionserver and for the catalog tracker. Former runs in a mini cluster and also touches the changes to HMasterInterface and zookeeper.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Jesse&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13272882" author="hadoopqa" created="Thu, 10 May 2012 23:16:14 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12526422/java_HBASE-5547_v7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12526422/java_HBASE-5547_v7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 22 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestDrainingServer&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1840//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1840//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1840//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1840//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1840//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1840//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13273057" author="jesse_yates" created="Fri, 11 May 2012 05:39:13 +0000"  >&lt;p&gt;test flapped locally for me, but got it to pass. Is this a known flapper?&lt;/p&gt;</comment>
                            <comment id="13274455" author="lhofhansl" created="Mon, 14 May 2012 05:26:40 +0000"  >&lt;p&gt;Sorry for bringing this up again (Jesse you can slap me in the office tomorrow &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )... But how is this different from a read/write lock scenario?&lt;/p&gt;

&lt;p&gt;I.e. A region server trying to delete an HFile could try obtain the equivalent of a read lock on the table, if that fails it would just rename the file instead of deleting it. A client setting the cluster/table into backup would request the equivalent of a write lock.&lt;/p&gt;

&lt;p&gt;I might be missing something fundamentally, but if we cannot solve this problem with a simple ZK construct (a.k.a. a read/write lock recipe), what is ZK good for?&lt;/p&gt;</comment>
                            <comment id="13274984" author="jesse_yates" created="Mon, 14 May 2012 21:31:44 +0000"  >&lt;p&gt;Initially I was against chaining the impl on the basis of latency and RPC overhead. However, after thinking through the situation I think Lars has a point (&lt;b&gt;tip of my hat&lt;/b&gt;). &lt;/p&gt;

&lt;p&gt;From the client&apos;s perspective, they only need to put a write-lock into /hbase/backup/&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt;/. In the async case, the client it done - at some point in the future the write lock will take effect and files for that table will be backed up, rather than deleted. &lt;/p&gt;

&lt;p&gt;In the synchronous case, you can either have not files being deleted (in which case it returns immediately) or you have a bunch of read lock from the servers (more detail on this later), and you have to wait for those read-locks to complete before returning as obtaining a write lock. Note that you do immediately write to zk, but conceptually you just read zk status a bunch of times until the write lock comes into effect - in reality we will use a watch on the oldest child).&lt;/p&gt;

&lt;p&gt;From the server perspective, when attempting to delete an hfile, they first check to see if they have a read lock. If they do, then they go ahead and delete the file. There can be multiple read-locks on a table, but they are ephemeral so if a server dies their read-lock releases. If a write-lock is taken, the server is going to be notified and will remove it&apos;s read-lock when its done deleting (a little work needs to be done here, but minimal). &lt;/p&gt;

&lt;p&gt;In terms of the general, read/write lock idea it would have to be almost a full implementation of reentrant-read-write lock (only features we wouldn&apos;t need are the write acquiring the read lock and iteratively acquiring locks). This does raise the question of if we want to pull in Netflix&apos;s Curator library (&lt;a href=&quot;https://github.com/Netflix/curator&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/Netflix/curator&lt;/a&gt;) since it already has an implementation of this functionality, as well as a bunch of other stuff we could use in the future. I had heard that it was a bit buggy, but haven&apos;t actually used it  (or looked extensively at the code, though the wiki looks great) so I can&apos;t weigh in either way in that regard - it does seem a little messy, but not terrible at first blush.&lt;/p&gt;

&lt;p&gt;Initially, this is going to be different than &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5494&quot; title=&quot;Introduce a zk hosted table-wide read/write lock so only one table operation at a time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5494&quot;&gt;&lt;del&gt;HBASE-5494&lt;/del&gt;&lt;/a&gt;, though similar, and we could possibly combine the implementations given some more advanced implementation around that ticket (adding per-table functionality (so it becomes /hbase/tablelocks/&lt;span class=&quot;error&quot;&gt;&amp;#91;table&amp;#93;&lt;/span&gt;/function), completion of the goals in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5991&quot; title=&quot;Introduce sequential ZNode based read/write locks &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5991&quot;&gt;&lt;del&gt;HBASE-5991&lt;/del&gt;&lt;/a&gt;, and fairness in lock-acquirement). Most of this implementation goes away if we want to pull in Curator, with a light layer for HBase. &lt;/p&gt;

&lt;p&gt;Sorry, for the long comment, just wanted to fully flush it out so it can be talked out.&lt;/p&gt;</comment>
                            <comment id="13279347" author="zhihyu@ebaysf.com" created="Fri, 18 May 2012 23:58:49 +0000"  >&lt;p&gt;Looks like this JIRA would depend on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5991&quot; title=&quot;Introduce sequential ZNode based read/write locks &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5991&quot;&gt;&lt;del&gt;HBASE-5991&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13279425" author="jesse_yates" created="Sat, 19 May 2012 02:50:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5991&quot; title=&quot;Introduce sequential ZNode based read/write locks &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5991&quot;&gt;&lt;del&gt;HBASE-5991&lt;/del&gt;&lt;/a&gt; would be nice, but not necessary. Excited for it to go in though.&lt;/p&gt;</comment>
                            <comment id="13397813" author="zhihyu@ebaysf.com" created="Wed, 20 Jun 2012 19:48:20 +0000"  >&lt;p&gt;Patch from Jesse.&lt;/p&gt;</comment>
                            <comment id="13397815" author="hadoopqa" created="Wed, 20 Jun 2012 19:52:57 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12532749/hbase-5447-v8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12532749/hbase-5447-v8.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 22 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2201//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2201//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13397848" author="zhihyu@ebaysf.com" created="Wed, 20 Jun 2012 20:41:11 +0000"  >&lt;p&gt;@Jesse:&lt;br/&gt;
HConstants.java has moved to hbase-common&lt;/p&gt;

&lt;p&gt;Can you rebase your patch ?&lt;/p&gt;</comment>
                            <comment id="13397855" author="jesse_yates" created="Wed, 20 Jun 2012 20:53:38 +0000"  >&lt;p&gt;Attaching rebased version.&lt;/p&gt;</comment>
                            <comment id="13398776" author="lhofhansl" created="Thu, 21 Jun 2012 19:28:09 +0000"  >&lt;p&gt;Rethinking the whole previous discussion... There is another thought:&lt;br/&gt;
Simply never delete HFile, but instead always move them to an archive location instead. Then have an aynchronous thread using a pluggable policy to delete (or not) the HFiles from the archive location.&lt;/p&gt;

&lt;p&gt;That would completely sidestep any ZK synchronization issues. The removal of the archived files is not time critical and does not need to be synchronous on any path.&lt;br/&gt;
Disadvantage is that a single thread in the master would have to do the cleanup (right?)&lt;/p&gt;</comment>
                            <comment id="13398782" author="jesse_yates" created="Thu, 21 Jun 2012 19:33:50 +0000"  >&lt;p&gt;@Lars: I was thinking that we should have this cleanup thread anyways (similar to the old logs). I could see moving the ZK stuff to just be monitored from that thread for what files it should delete or not (less a timeout on file movement). This would follow the same chaining that we are doing for the .oldlogs directory. &lt;/p&gt;

&lt;p&gt;I don&apos;t see it as all that bad to have an async thread from the master that does the cleanup (and we could remove the synchronous requirement in zk). &lt;/p&gt;

&lt;p&gt;I&apos;m +1 on this - its not significantly more overhead than we have already and notably less overhead than the current implementation. Only downside is that the current implementation is pretty solid (been using it in my testing for snapshots and have yet to have a problem).&lt;/p&gt;</comment>
                            <comment id="13402412" author="jesse_yates" created="Wed, 27 Jun 2012 17:59:39 +0000"  >&lt;p&gt;Anyone else have any objections to Lar&apos;s proposal? Otherwise I&apos;d like to get hacking on it this afternoon.&lt;/p&gt;</comment>
                            <comment id="13404026" author="jesse_yates" created="Fri, 29 Jun 2012 17:04:46 +0000"  >&lt;p&gt;Attaching revised version based on Lars&apos; design. Ended up being way less code and complexity (+1). &lt;/p&gt;

&lt;p&gt;All the modified tests pass locally.&lt;/p&gt;

&lt;p&gt;Glad to throw this up on RB (esp given the size) if people want.&lt;/p&gt;</comment>
                            <comment id="13404032" author="jmhsieh" created="Fri, 29 Jun 2012 17:10:37 +0000"  >&lt;p&gt;RB please.&lt;/p&gt;</comment>
                            <comment id="13404048" author="hadoopqa" created="Fri, 29 Jun 2012 17:24:03 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12534010/hbase-5547-v9.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12534010/hbase-5547-v9.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 20 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 8 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestColumnSeeking&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestScanner&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestCoprocessorInterface&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestKeepDeletes&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestMinVersions&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2295//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2295//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2295//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2295//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2295//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2295//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2295//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2295//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13404055" author="jesse_yates" created="Fri, 29 Jun 2012 17:39:39 +0000"  >&lt;p&gt;Surprised that those tests are failing, looking into it (though they are failing locally too, so something is definitely up - looking into it.).&lt;/p&gt;</comment>
                            <comment id="13404068" author="jesse_yates" created="Fri, 29 Jun 2012 17:54:12 +0000"  >&lt;p&gt;Attaching slightly updated v9 with fix for those broken tests - 3 line change did seem to warrant a new version.&lt;/p&gt;</comment>
                            <comment id="13404092" author="zhihyu@ebaysf.com" created="Fri, 29 Jun 2012 18:23:50 +0000"  >&lt;p&gt;For BaseConfigurable:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ * HBase version of Hadoop&apos;s Configured class that doesn&apos;t initialize the
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Why can&apos;t we use Hadoop&apos;s Configured class directly ?&lt;/p&gt;

&lt;p&gt;Looking forward to the patch on review board.&lt;/p&gt;</comment>
                            <comment id="13404096" author="jesse_yates" created="Fri, 29 Jun 2012 18:30:18 +0000"  >&lt;p&gt;@Ted: Because in the constructor it does &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
setConfiguration(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which will screw up the delegate&apos;s configuration. This just seems simpler.&lt;/p&gt;</comment>
                            <comment id="13404114" author="hadoopqa" created="Fri, 29 Jun 2012 18:51:57 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12534016/hbase-5547-v9.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12534016/hbase-5547-v9.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 20 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 8 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2297//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2297//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2297//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2297//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2297//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2297//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2297//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2297//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13404136" author="zhihyu@ebaysf.com" created="Fri, 29 Jun 2012 19:12:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/4633/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4633/&lt;/a&gt; has been updated by Jesse.&lt;/p&gt;</comment>
                            <comment id="13404304" author="zhihyu@ebaysf.com" created="Fri, 29 Jun 2012 23:13:44 +0000"  >&lt;p&gt;Currently hbase.master.cleaner.interval determines how often cleaning is done. Default is 60 seconds.&lt;br/&gt;
In some situations, this may be short.&lt;/p&gt;

&lt;p&gt;Can we introduce capacity-based cleaning ?&lt;br/&gt;
Operator can specify total hdfs space dedicated to the backup HFiles. If the threshold is exceeded, oldest backup HFiles would be cleaned up.&lt;/p&gt;

&lt;p&gt;For this JIRA, we can put cleanup policy in place, leaving implementation to a follow-up JIRA.&lt;/p&gt;</comment>
                            <comment id="13404309" author="jesse_yates" created="Fri, 29 Jun 2012 23:20:56 +0000"  >&lt;p&gt;@Ted: you would still need to check the directory quite frequently or everytime you archive, you do some extra work adding the size of the files, both of which are unpalatable. You can get around this though by just cranking down the time between checks and then use a HFileArchiveSizeCleaner (or something like that). I can see that being useful - file an issue?&lt;/p&gt;</comment>
                            <comment id="13408391" author="jesse_yates" created="Fri, 6 Jul 2012 22:07:47 +0000"  >&lt;p&gt;Updated the diff on RB to the latest trunk. Any reviews/thoughts would be great!&lt;/p&gt;</comment>
                            <comment id="13408547" author="lhofhansl" created="Sat, 7 Jul 2012 02:40:59 +0000"  >&lt;p&gt;Will look at it this weekend!&lt;/p&gt;</comment>
                            <comment id="13408778" author="stack" created="Sat, 7 Jul 2012 21:08:55 +0000"  >&lt;p&gt;Added some review up on rb.&lt;/p&gt;</comment>
                            <comment id="13411072" author="lhofhansl" created="Tue, 10 Jul 2012 23:46:58 +0000"  >&lt;p&gt;I think we should break this up into two parts:&lt;br/&gt;
1. Don&apos;t delete the files, and the TTL HFile cleaner&lt;br/&gt;
2. The special policy that has a user facing interface to retains HFiles for certain tables and relates that via ZK.&lt;/p&gt;

&lt;p&gt;#2 might even be in an example section, since I&apos;d guess that most folks have special needs here anyway.&lt;/p&gt;

&lt;p&gt;As a suggestion, we might want to tack a timestamp into the rename HFile.&lt;/p&gt;

&lt;p&gt;I found it hard to wrap my head around this change, because of the refactoring of the log cleaner; but unifying the two is good.&lt;br/&gt;
Great work!&lt;/p&gt;</comment>
                            <comment id="13412887" author="jesse_yates" created="Thu, 12 Jul 2012 15:46:08 +0000"  >&lt;blockquote&gt;
&lt;p&gt;1. Don&apos;t delete the files, and the TTL HFile cleaner&lt;br/&gt;
2. The special policy that has a user facing interface to retains HFiles for certain tables and relates that via ZK.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Clearly, we need to have #1 (and its in the current patch). I&apos;d be fine to refactor the table-level retention via ZK into an example class/client (rather than as part of HBaseAdmin). However, splitting this into two tickets seems to be more work than its worth. &lt;/p&gt;

&lt;p&gt;@stack, @ted - what do you think?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I found it hard to wrap my head around this change, because of the refactoring of the log cleaner; but unifying the two is good.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, the hierarchy can make the reading a little odd, but it ends up being sweet that the HFileCleanerChore is just a constructor. Might argue for using factory, but that seemed a bit excessive for just two classes (maybe if we need to add another file cleaner chore later). &lt;/p&gt;</comment>
                            <comment id="13412970" author="lhofhansl" created="Thu, 12 Jul 2012 17:22:17 +0000"  >&lt;p&gt;Should be in a 0.94 release.&lt;/p&gt;</comment>
                            <comment id="13413010" author="jesse_yates" created="Thu, 12 Jul 2012 18:00:11 +0000"  >&lt;blockquote&gt;
&lt;p&gt;My reservation to the 2nd part is that folks will have their own retention policy, which is going to be special to their organization and that HBase should not (try to) dictate that.&lt;br/&gt;
Not feeling very strongly about this, though. As long as the TTL log cleaner is the default and the log term archiver is just a plugin (both of which are the case, right?).&lt;/p&gt;&lt;/blockquote&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Lars on RB&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;My response:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;&quot;both of which are the case, right?&quot;&lt;br/&gt;
yup.&lt;/p&gt;

&lt;p&gt;&quot;On that note, I wonder if the Hlog cleaner and HFile cleaner should have a joint policy&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&quot;&lt;br/&gt;
That sounds subticket worthy. But interesting idea. It wouldn&apos;t be too hard to do with the existing setup, but out of scope &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If everyone is good with this, I&apos;ll push up a new version to RB that has the clean up from the reviews, abstracts out the client-zk stuff to an example.&lt;/p&gt;</comment>
                            <comment id="13413267" author="hadoopqa" created="Thu, 12 Jul 2012 21:50:51 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12536280/5547-v12.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12536280/5547-v12.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 20 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 10 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2373//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2373//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2373//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2373//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2373//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2373//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2373//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2373//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13416682" author="jesse_yates" created="Tue, 17 Jul 2012 22:46:15 +0000"  >&lt;p&gt;Attaching updated version based on trunk and addressing comments on RB. Also, had some replies to outstanding issues on RB.&lt;/p&gt;</comment>
                            <comment id="13416737" author="hadoopqa" created="Tue, 17 Jul 2012 23:58:11 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12536901/java_HBASE-5547_v13.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12536901/java_HBASE-5547_v13.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 22 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 13 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2395//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13417366" author="zhihyu@ebaysf.com" created="Wed, 18 Jul 2012 18:51:50 +0000"  >&lt;p&gt;Here is the link about InterruptedException handling:&lt;br/&gt;
&lt;a href=&quot;http://www.ibm.com/developerworks/java/library/j-jtp05236/index.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.ibm.com/developerworks/java/library/j-jtp05236/index.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Take a look at Listing 3 under &apos;Don&apos;t swallow interrupts&apos;&lt;/p&gt;</comment>
                            <comment id="13417664" author="jesse_yates" created="Wed, 18 Jul 2012 20:48:36 +0000"  >&lt;p&gt;Something Matteo mentioned in the latest review: &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;MasterFileSystem contains deleteRegion() and deleteTable() that calls fs.delete() with the recursive flag on.&lt;br/&gt;
This two methods get called by DeleteTableHandler (drop table).&lt;br/&gt;
In a backup/snapshot situation we want to keep the regions/hfiles.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Question is if we want to scope this in this patch or if we should do it in another patch, e.g. &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6205&quot; title=&quot;Support an option to keep data of dropped table for some time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6205&quot;&gt;&lt;del&gt;HBASE-6205&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13417954" author="jesse_yates" created="Thu, 19 Jul 2012 01:38:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;Question is if we want to scope this in this patch or if we should do it in another patch, e.g. &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6205&quot; title=&quot;Support an option to keep data of dropped table for some time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6205&quot;&gt;&lt;del&gt;HBASE-6205&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Moving it in scope. It was a single line change and a ~100 lines of test. Posting new patch that also addresses Ted&apos;s recent comments.&lt;/p&gt;</comment>
                            <comment id="13417966" author="jesse_yates" created="Thu, 19 Jul 2012 01:49:42 +0000"  >&lt;p&gt;Attaching latest from RB - addresses all Ted&apos;s comments and adding region archiving on table delete (+ testing!).&lt;/p&gt;</comment>
                            <comment id="13418090" author="hadoopqa" created="Thu, 19 Jul 2012 05:54:11 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12537114/java_HBASE-5547_v14.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12537114/java_HBASE-5547_v14.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 22 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 15 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.avro.TestAvroServer&lt;br/&gt;
                  org.apache.hadoop.hbase.thrift.TestThriftServerCmdLine&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2407//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13418585" author="zhihyu@ebaysf.com" created="Thu, 19 Jul 2012 19:09:47 +0000"  >&lt;p&gt;From Jesse.&lt;/p&gt;</comment>
                            <comment id="13418622" author="hadoopqa" created="Thu, 19 Jul 2012 20:01:21 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12537230/java_HBASE-5547_v15.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12537230/java_HBASE-5547_v15.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 22 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 13 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2411//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13418638" author="zhihyu@ebaysf.com" created="Thu, 19 Jul 2012 20:18:40 +0000"  >&lt;p&gt;Patch v16 corrects name of test class.&lt;/p&gt;

&lt;p&gt;Should be ready for integration.&lt;/p&gt;</comment>
                            <comment id="13418690" author="hadoopqa" created="Thu, 19 Jul 2012 21:36:43 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12537240/5547-v16.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12537240/5547-v16.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 22 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 13 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.coprocessor.TestRegionServerCoprocessorExceptionWithAbort&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2412//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13418707" author="jesse_yates" created="Thu, 19 Jul 2012 21:50:41 +0000"  >&lt;p&gt;Assuming changes between v15 and v16 are just what Ted mentioned on his last post on RB, then I&apos;m good. Lets give it a day or so, before we integrate, so people have time to look at RB, if they haven&apos;t yet. Failed test doesn&apos;t apply to this code.&lt;/p&gt;</comment>
                            <comment id="13418730" author="zhihyu@ebaysf.com" created="Thu, 19 Jul 2012 22:29:05 +0000"  >&lt;p&gt;I ran TestRegionServerCoprocessorExceptionWithAbort based on patch v16 and it passed.&lt;/p&gt;</comment>
                            <comment id="13419207" author="zhihyu@ebaysf.com" created="Fri, 20 Jul 2012 15:16:16 +0000"  >&lt;p&gt;Will integrate in 3 hours if there is no objection.&lt;/p&gt;</comment>
                            <comment id="13419696" author="lhofhansl" created="Fri, 20 Jul 2012 23:52:18 +0000"  >&lt;p&gt;+1 on patch. Ted pinged me, that he is out already.&lt;br/&gt;
Since this is a Salesforce patch, I should commit it anyway.&lt;/p&gt;

&lt;p&gt;Will do so as soon as I get to it.&lt;/p&gt;

&lt;p&gt;Jesse, do you have a feeling about how different a 0.94 patch would be?&lt;/p&gt;</comment>
                            <comment id="13419697" author="jesse_yates" created="Fri, 20 Jul 2012 23:56:51 +0000"  >&lt;p&gt;@Lars I don&apos;t think it would be all that different. I&apos;ll take a crack next week (after dealing with the next round of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6055&quot; title=&quot;Offline Snapshots in HBase 0.96&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6055&quot;&gt;&lt;del&gt;HBASE-6055&lt;/del&gt;&lt;/a&gt; stuff).&lt;/p&gt;</comment>
                            <comment id="13419723" author="lhofhansl" created="Sat, 21 Jul 2012 02:30:54 +0000"  >&lt;p&gt;I also verified in a real setup, that an HFile is indeed archived and (by default) removed after 5 mins. Was thrown off first, because the table/region/cf directory is not removed when empty.&lt;br/&gt;
Also made sure I can create/drop tables and then .META. is backed up correctly.&lt;/p&gt;

&lt;p&gt;So still +1 &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13419724" author="lhofhansl" created="Sat, 21 Jul 2012 02:42:18 +0000"  >&lt;p&gt;Ok. On more question I asked just now on RB:&lt;/p&gt;

&lt;p&gt;From Matteo:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;MasterFileSystem contains deleteRegion() and deleteTable() that calls fs.delete() with the recursive flag on.&lt;br/&gt;
This two methods get called by DeleteTableHandler (drop table).&lt;br/&gt;
In a backup/snapshot situation we want to keep the regions/hfiles.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;My follow up question:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;        I find that deleteRegion() was addressed, but not deleteTable().&lt;/p&gt;

&lt;p&gt;        That means if a table is dropped the HFiles would be deleted and not archived.&lt;br/&gt;
        So it seems we should either:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;also delete the table&apos;s archive directory (since it would be incomplete anyway).&lt;/li&gt;
	&lt;li&gt;archive all the HFile before deleting them.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;        What do you think Jesse?&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13419725" author="lhofhansl" created="Sat, 21 Jul 2012 02:48:42 +0000"  >&lt;p&gt;Or is it that all regions are first deleted anyway, and only then the deleteTable is called (in DeleteTableHandler.handleTableOperation)?&lt;/p&gt;

&lt;p&gt;Edit: Spelling&lt;/p&gt;</comment>
                            <comment id="13419746" author="zhihyu@ebaysf.com" created="Sat, 21 Jul 2012 04:56:21 +0000"  >&lt;p&gt;I think the latest patch has addressed HFile archival when deleteRegion() is called.&lt;/p&gt;

&lt;p&gt;Backing up / restoring table can be addressed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6055&quot; title=&quot;Offline Snapshots in HBase 0.96&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6055&quot;&gt;&lt;del&gt;HBASE-6055&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13419748" author="lhofhansl" created="Sat, 21 Jul 2012 05:30:19 +0000"  >&lt;p&gt;True, but if dropping a table just drops the latest HFiles to the floor and leaves a partial backup around this entire exercise is pointless.&lt;/p&gt;

&lt;p&gt;Anyway, from the code in DeleteTableHandler.handleTableOperation it looks like all regions are deleted first (using deleteRegion) and then the table directory is deleted, so it should be correct. Just making sure here.&lt;/p&gt;</comment>
                            <comment id="13419756" author="jesse_yates" created="Sat, 21 Jul 2012 07:33:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;I find that deleteRegion() was addressed, but not deleteTable().&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In the deletetablehandler, it first goes and deletes each region (which gets replaced with archiveRegion) and then once all the regions have been archived, we call deleteTable, which basically just &quot;rm -rf&quot;&apos;s the entire directory.&lt;/p&gt;

&lt;p&gt;TL;DR - hfiles on table delete are archived, but not any more information about the state of the table. Wrote a unit test to check that too, so should be good.&lt;/p&gt;</comment>
                            <comment id="13420030" author="lhofhansl" created="Sun, 22 Jul 2012 01:12:45 +0000"  >&lt;p&gt;Committed to 0.96. Phfewww. Thanks for the patch and the persistence Jesse!&lt;br/&gt;
Leaving open for the 0.94 part.&lt;/p&gt;</comment>
                            <comment id="13420095" author="hudson" created="Sun, 22 Jul 2012 03:02:34 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3158 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3158/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3158/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt; Don&apos;t delete HFiles when in &quot;backup mode&quot; (Jesse Yates) (Revision 1364203)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-common/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/BaseConfigurable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/Chore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/HFileArchiver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/HFileArchiveManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/HFileArchiveTableMonitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/TableHFileArchiveTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/ZKTableArchiveClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/LogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/LogCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/TimeToLiveLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/BaseHFileCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/BaseLogCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/FileCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/HFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/LogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/TimeToLiveHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/TimeToLiveLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/resources/hbase-default.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/TestHFileArchiving.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestLogsCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/cleaner&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/cleaner/TestHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/cleaner/TestLogsCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/CheckedArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/util/TestHFileArchiveUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13420097" author="lhofhansl" created="Sun, 22 Jul 2012 03:09:31 +0000"  >&lt;p&gt;Hmm... From the failed run:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Failed tests:  testMultipleTables(org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient): Archived HFiles should have gotten deleted, but didn&apos;t&lt;br/&gt;
  testRowMutationMultiThreads(org.apache.hadoop.hbase.regionserver.TestAtomicOperation): expected:&amp;lt;0&amp;gt; but was:&amp;lt;5&amp;gt;&lt;/p&gt;

&lt;p&gt;Tests in error:&lt;br/&gt;
  testMultiRowMutationMultiThreads(org.apache.hadoop.hbase.regionserver.TestAtomicOperation): java.io.FileNotFoundException: &amp;lt;&lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/ws/trunk/hbase-server/target/classes/hbase-default.xml&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/ws/trunk/hbase-server/target/classes/hbase-default.xml&lt;/a&gt;&amp;gt; (Too many open files)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The first one is suspicious. Could you have a look at it Jesse when you get a chance.&lt;/p&gt;</comment>
                            <comment id="13420103" author="jesse_yates" created="Sun, 22 Jul 2012 04:11:34 +0000"  >&lt;p&gt;Hmmm, looks like there was a NPE generated during a compaction - probably what broke the test, but its pretty early on, so maybe not. Looking into it to see what is going on... &lt;/p&gt;</comment>
                            <comment id="13420113" author="jesse_yates" created="Sun, 22 Jul 2012 06:39:50 +0000"  >&lt;p&gt;Attaching addendum that updates the test (removes the TTL cleaner to avoid timing issues) and fixes a couple of comments. Looks like a flapper given that build #3159 worked.&lt;/p&gt;

&lt;p&gt;Couldn&apos;t get the NPE to reproduce (didn&apos;t seem fatal though and was from a log statement). &lt;/p&gt;

&lt;p&gt;Ran the updated test 20x without failure.&lt;/p&gt;</comment>
                            <comment id="13420118" author="hadoopqa" created="Sun, 22 Jul 2012 07:32:52 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12537478/java_HBASE-5547.addendum&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12537478/java_HBASE-5547.addendum&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 14 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestSplitTransactionOnCluster&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2424//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13420159" author="hudson" created="Sun, 22 Jul 2012 13:08:01 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #103 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/103/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/103/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt; Don&apos;t delete HFiles when in &quot;backup mode&quot; (Jesse Yates) (Revision 1364203)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-common/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/BaseConfigurable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/Chore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/HFileArchiver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/HFileArchiveManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/HFileArchiveTableMonitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/LongTermArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/TableHFileArchiveTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/ZKTableArchiveClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/LogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/LogCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/TimeToLiveLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/BaseHFileCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/BaseLogCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/FileCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/HFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/LogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/TimeToLiveHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/TimeToLiveLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/resources/hbase-default.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/TestHFileArchiving.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestLogsCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/cleaner&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/cleaner/TestHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/cleaner/TestLogsCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/CheckedArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/util/TestHFileArchiveUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13420187" author="zhihyu@ebaysf.com" created="Sun, 22 Jul 2012 15:12:59 +0000"  >&lt;p&gt;For the NPE, I think the null reference should have come from below code snippet:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        (sf == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;code-quote&quot;&gt;&quot;none&quot;&lt;/span&gt; : sf.getPath().getName()) +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;, size=&quot;&lt;/span&gt; + (sf == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? &lt;span class=&quot;code-quote&quot;&gt;&quot;none&quot;&lt;/span&gt; :
          StringUtils.humanReadableInt(sf.getReader().length()))
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Meaning either sf.getPath() or sf.getReader() was null.&lt;/p&gt;

&lt;p&gt;For the addendum, if TimeToLiveHFileCleaner is removed from TestZooKeeperTableArchiveClient, we should add test for it since it is a new class introduced by this feature.&lt;/p&gt;</comment>
                            <comment id="13420226" author="jesse_yates" created="Sun, 22 Jul 2012 16:10:54 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Meaning either sf.getPath() or sf.getReader() was null.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Looked through the code and can&apos;t say I see that was possible (though it seems the most likely given the setting/checking done on the store file). Looking through the test of the code, it doesn&apos;t look like an issue if the reader is null since it either gets closed immediately or is re-created when needed.&lt;/p&gt;

&lt;p&gt;The getPath() call could be bad, but its not doing anything funky and we would have seen a warning/error earlier in the run if that had actually been a problem.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;For the addendum, if TimeToLiveHFileCleaner is removed from TestZooKeeperTableArchiveClient, we should add test for it since it is a new class introduced by this feature.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It is tested in o.a.h.h.master.cleaner.TestHFileCleaner. This change just cleans up the test so we don&apos;t have to worry about interaction with the TTLCleaner.&lt;/p&gt;</comment>
                            <comment id="13420227" author="jesse_yates" created="Sun, 22 Jul 2012 16:22:26 +0000"  >&lt;p&gt;Hmm, looks like I broke the 2.0 build too. Here is the output from the logs there that seems pertinent:&lt;/p&gt;
&lt;blockquote&gt;

&lt;p&gt;Regression&lt;/p&gt;

&lt;p&gt;org.apache.hadoop.hbase.avro.TestAvroServer.testTableAdminAndMetadata&lt;br/&gt;
Failing for the past 1 build (Since Failed#103 )&lt;br/&gt;
Took 32 ms.&lt;br/&gt;
Error Message&lt;/p&gt;

&lt;p&gt;test timed out after 300000 milliseconds&lt;/p&gt;

&lt;p&gt;Stacktrace&lt;/p&gt;

&lt;p&gt;java.lang.Exception: test timed out after 300000 milliseconds&lt;br/&gt;
	at $Proxy26.scan(Unknown Source)&lt;br/&gt;
	at org.apache.hadoop.hbase.client.HBaseAdmin.deleteTable(HBaseAdmin.java:548)&lt;br/&gt;
	at org.apache.hadoop.hbase.avro.AvroServer$HBaseImpl.deleteTable(AvroServer.java:276)&lt;br/&gt;
	at org.apache.hadoop.hbase.avro.TestAvroServer.testTableAdminAndMetadata(TestAvroServer.java:122)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:45)&lt;br/&gt;
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)&lt;br/&gt;
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:42)&lt;br/&gt;
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)&lt;br/&gt;
	at org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:62)&lt;/p&gt;

&lt;p&gt;Standard Output&lt;/p&gt;

&lt;p&gt;Formatting using clusterid: testClusterID&lt;/p&gt;

&lt;p&gt;Standard Error&lt;/p&gt;

&lt;p&gt;2012-07-22 13:02:19,346 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; conf.Configuration(737): hadoop.native.lib is deprecated. Instead, use io.native.lib.available&lt;br/&gt;
2012-07-22 13:02:19,491 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.HBaseTestingUtility(614): Starting up minicluster with 1 master(s) and 1 regionserver(s) and 1 datanode(s)&lt;br/&gt;
2012-07-22 13:02:19,607 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.HBaseTestingUtility(288): Created new mini-cluster data directory: /home/hudson/hudson-slave/workspace/HBase-TRUNK-on-Hadoop-2.0.0/trunk/hbase-server/target/test-data/03dca982-ed63-4680-a4c4-4a7034cab836/dfscluster_654272cb-8aec-4e5d-8796-0f03ff31fcce&lt;br/&gt;
2012-07-22 13:02:19,608 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.HBaseTestingUtility(466): Setting test.cache.data to /home/hudson/hudson-slave/workspace/HBase-TRUNK-on-Hadoop-2.0.0/trunk/hbase-server/target/test-data/03dca982-ed63-4680-a4c4-4a7034cab836/dfscluster_654272cb-8aec-4e5d-8796-0f03ff31fcce/cache_data in system properties and HBase conf&lt;br/&gt;
2012-07-22 13:02:19,608 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.HBaseTestingUtility(466): Setting hadoop.tmp.dir to /home/hudson/hudson-slave/workspace/HBase-TRUNK-on-Hadoop-2.0.0/trunk/hbase-server/target/test-data/03dca982-ed63-4680-a4c4-4a7034cab836/dfscluster_654272cb-8aec-4e5d-8796-0f03ff31fcce/hadoop_tmp in system properties and HBase conf&lt;br/&gt;
2012-07-22 13:02:19,608 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.HBaseTestingUtility(466): Setting hadoop.log.dir to /home/hudson/hudson-slave/workspace/HBase-TRUNK-on-Hadoop-2.0.0/trunk/hbase-server/target/test-data/03dca982-ed63-4680-a4c4-4a7034cab836/dfscluster_654272cb-8aec-4e5d-8796-0f03ff31fcce/hadoop_logs in system properties and HBase conf&lt;br/&gt;
2012-07-22 13:02:19,616 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.HBaseTestingUtility(466): Setting mapreduce.output.fileoutputformat.outputdir to /home/hudson/hudson-slave/workspace/HBase-TRUNK-on-Hadoop-2.0.0/trunk/hbase-server/target/test-data/03dca982-ed63-4680-a4c4-4a7034cab836/dfscluster_654272cb-8aec-4e5d-8796-0f03ff31fcce/mapred_output in system properties and HBase conf&lt;br/&gt;
2012-07-22 13:02:19,616 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.HBaseTestingUtility(466): Setting mapred.local.dir to /home/hudson/hudson-slave/workspace/HBase-TRUNK-on-Hadoop-2.0.0/trunk/hbase-server/target/test-data/03dca982-ed63-4680-a4c4-4a7034cab836/dfscluster_654272cb-8aec-4e5d-8796-0f03ff31fcce/mapred_local in system properties and HBase conf&lt;br/&gt;
2012-07-22 13:02:19,616 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.HBaseTestingUtility(466): Setting mapred.system.dir to /home/hudson/hudson-slave/workspace/HBase-TRUNK-on-Hadoop-2.0.0/trunk/hbase-server/target/test-data/03dca982-ed63-4680-a4c4-4a7034cab836/dfscluster_654272cb-8aec-4e5d-8796-0f03ff31fcce/mapred_system in system properties and HBase conf&lt;br/&gt;
2012-07-22 13:02:19,616 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.HBaseTestingUtility(466): Setting mapred.temp.dir to /home/hudson/hudson-slave/workspace/HBase-TRUNK-on-Hadoop-2.0.0/trunk/hbase-server/target/test-data/03dca982-ed63-4680-a4c4-4a7034cab836/dfscluster_654272cb-8aec-4e5d-8796-0f03ff31fcce/mapred_temp in system properties and HBase conf&lt;br/&gt;
2012-07-22 13:02:19,846 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; conf.Configuration(737): hadoop.configured.node.mapping is deprecated. Instead, use net.topology.configured.node.mapping&lt;br/&gt;
2012-07-22 13:02:19,972 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; util.KerberosName(87): Kerberos krb5 configuration not found, setting default realm to empty&lt;br/&gt;
2012-07-22 13:02:20,673 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; impl.MetricsConfig(125): Cannot locate configuration: tried hadoop-metrics2-namenode.properties,hadoop-metrics2.properties&lt;br/&gt;
2012-07-22 13:02:21,523 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; log.Slf4jLog(67): Logging to org.slf4j.impl.Log4jLoggerAdapter(org.mortbay.log) via org.mortbay.log.Slf4jLog&lt;br/&gt;
2012-07-22 13:02:21,578 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; lib.StaticUserWebFilter(141): dfs.web.ugi should not be used. Instead, use hadoop.http.staticuser.user.&lt;br/&gt;
2012-07-22 13:02:21,598 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; log.Slf4jLog(67): jetty-6.1.26&lt;br/&gt;
2012-07-22 13:02:21,625 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; log.Slf4jLog(67): Extract jar:&lt;a href=&quot;file:/home/hudson/.m2/repository/org/apache/hadoop/hadoop-hdfs/2.0.0-alpha/hadoop-hdfs-2.0.0-alpha-tests.jar!/webapps/hdfs&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/home/hudson/.m2/repository/org/apache/hadoop/hadoop-hdfs/2.0.0-alpha/hadoop-hdfs-2.0.0-alpha-tests.jar!/webapps/hdfs&lt;/a&gt; to /tmp/Jetty_localhost_39374_hdfs____.ksh5ik/webapp&lt;br/&gt;
2012-07-22 13:02:21,777 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; log.Slf4jLog(67): Started SelectChannelConnector@localhost:39374&lt;br/&gt;
2012-07-22 13:02:21,830 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; util.NativeCodeLoader(62): Unable to load native-hadoop library for your platform... using builtin-java classes where applicable&lt;br/&gt;
2012-07-22 13:02:21,848 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; lib.StaticUserWebFilter(141): dfs.web.ugi should not be used. Instead, use hadoop.http.staticuser.user.&lt;br/&gt;
2012-07-22 13:02:21,851 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; log.Slf4jLog(67): jetty-6.1.26&lt;br/&gt;
2012-07-22 13:02:21,854 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; log.Slf4jLog(67): Extract jar:&lt;a href=&quot;file:/home/hudson/.m2/repository/org/apache/hadoop/hadoop-hdfs/2.0.0-alpha/hadoop-hdfs-2.0.0-alpha-tests.jar!/webapps/datanode&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/home/hudson/.m2/repository/org/apache/hadoop/hadoop-hdfs/2.0.0-alpha/hadoop-hdfs-2.0.0-alpha-tests.jar!/webapps/datanode&lt;/a&gt; to /tmp/Jetty_localhost_47954_datanode____.oum544/webapp&lt;br/&gt;
2012-07-22 13:02:21,933 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; log.Slf4jLog(67): Started SelectChannelConnector@localhost:47954&lt;br/&gt;
2012-07-22 13:02:22,755 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; conf.Configuration(737): fs.default.name is deprecated. Instead, use fs.defaultFS&lt;br/&gt;
2012-07-22 13:02:22,827 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; zookeeper.MiniZooKeeperCluster(197): Started MiniZK Cluster and connect 1 ZK server on client port: 59288&lt;br/&gt;
2012-07-22 13:02:22,978 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; util.FSUtils(438): Created version file at hdfs://localhost:52085/user/hudson/hbase with version=7&lt;br/&gt;
2012-07-22 13:02:23,026 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; client.HConnectionManager(2483): Set serverside HConnection retries=100&lt;br/&gt;
2012-07-22 13:02:23,050 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; ipc.HBaseRpcMetrics(66): Initializing RPC Metrics with hostName=HMaster, port=55921&lt;br/&gt;
2012-07-22 13:02:23,095 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; conf.Configuration(737): mapred.task.id is deprecated. Instead, use mapreduce.task.attempt.id&lt;br/&gt;
2012-07-22 13:02:23,102 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(103): master:55921 opening connection to ZooKeeper with ensemble (localhost:59288)&lt;br/&gt;
2012-07-22 13:02:23,122 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; zookeeper.RecoverableZooKeeper(102): The identifier of this process is 4689@vesta.apache.org&lt;br/&gt;
2012-07-22 13:02:23,238 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921 Received ZooKeeper Event, type=None, state=SyncConnected, path=null&lt;br/&gt;
2012-07-22 13:02:23,242 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(339): master:55921-0x138aec80e530000 connected&lt;br/&gt;
2012-07-22 13:02:23,322 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(110): MetricsString added: revision&lt;br/&gt;
2012-07-22 13:02:23,322 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(110): MetricsString added: hdfsUser&lt;br/&gt;
2012-07-22 13:02:23,323 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(110): MetricsString added: hdfsDate&lt;br/&gt;
2012-07-22 13:02:23,323 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(110): MetricsString added: hdfsUrl&lt;br/&gt;
2012-07-22 13:02:23,323 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(110): MetricsString added: date&lt;br/&gt;
2012-07-22 13:02:23,323 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(110): MetricsString added: hdfsRevision&lt;br/&gt;
2012-07-22 13:02:23,323 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(110): MetricsString added: user&lt;br/&gt;
2012-07-22 13:02:23,323 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(110): MetricsString added: hdfsVersion&lt;br/&gt;
2012-07-22 13:02:23,324 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(110): MetricsString added: url&lt;br/&gt;
2012-07-22 13:02:23,324 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(110): MetricsString added: version&lt;br/&gt;
2012-07-22 13:02:23,324 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(161): new MBeanInfo&lt;br/&gt;
2012-07-22 13:02:23,324 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; util.MetricsDynamicMBeanBase(115): unknown metrics type: org.apache.hadoop.hbase.metrics.histogram.MetricsHistogram&lt;br/&gt;
2012-07-22 13:02:23,325 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; util.MetricsDynamicMBeanBase(115): unknown metrics type: org.apache.hadoop.hbase.metrics.histogram.MetricsHistogram&lt;br/&gt;
2012-07-22 13:02:23,325 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(161): new MBeanInfo&lt;br/&gt;
2012-07-22 13:02:23,325 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; metrics.MasterMetrics(102): Initialized&lt;br/&gt;
2012-07-22 13:02:23,356 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; client.HConnectionManager(2483): Set serverside HConnection retries=100&lt;br/&gt;
2012-07-22 13:02:23,359 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; ipc.HBaseRpcMetrics(66): Initializing RPC Metrics with hostName=MiniHBaseCluster$MiniHBaseClusterRegionServer, port=56523&lt;br/&gt;
2012-07-22 13:02:23,401 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hfile.CacheConfig(350): Allocating LruBlockCache with maximum size 422.2m&lt;br/&gt;
2012-07-22 13:02:23,411 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(238): master:55921-0x138aec80e530000 /hbase/shutdown does not exist. Watcher is set.&lt;br/&gt;
2012-07-22 13:02:23,421 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.ActiveMasterManager(150): Deleting ZNode for /hbase/backup-masters/vesta.apache.org,55921,1342962143091 from backup master directory&lt;br/&gt;
2012-07-22 13:02:23,431 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.RecoverableZooKeeper(142): Node /hbase/backup-masters/vesta.apache.org,55921,1342962143091 already deleted, and this is not a retry&lt;br/&gt;
2012-07-22 13:02:23,432 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; hbase.ZNodeClearer(58): No filename given to save the znode used, it won&apos;t be saved (Environment variable HBASE_ZNODE_FILE is not set).&lt;br/&gt;
2012-07-22 13:02:23,432 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.ActiveMasterManager(159): Master=vesta.apache.org,55921,1342962143091&lt;br/&gt;
2012-07-22 13:02:23,434 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; conf.Configuration(737): fs.default.name is deprecated. Instead, use fs.defaultFS&lt;br/&gt;
2012-07-22 13:02:23,438 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.SplitLogManager(175): timeout = 25000&lt;br/&gt;
2012-07-22 13:02:23,438 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.SplitLogManager(176): unassigned timeout = 180000&lt;br/&gt;
2012-07-22 13:02:23,441 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.SplitLogManager(806): found 0 orphan tasks and 0 rescan nodes&lt;br/&gt;
2012-07-22 13:02:23,504 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; util.FSUtils(567): Created cluster ID file at hdfs://localhost:52085/user/hudson/hbase/hbase.id with ID: f285209f-4f02-4b1d-817f-d5611467793a&lt;br/&gt;
2012-07-22 13:02:23,508 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; regionserver.ShutdownHook(88): Installed shutdown hook thread: Shutdownhook:RegionServer:0;vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:23,512 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(103): regionserver:56523 opening connection to ZooKeeper with ensemble (localhost:59288)&lt;br/&gt;
2012-07-22 13:02:23,513 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; zookeeper.RecoverableZooKeeper(102): The identifier of this process is 4689@vesta.apache.org&lt;br/&gt;
2012-07-22 13:02:23,521 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): regionserver:56523 Received ZooKeeper Event, type=None, state=SyncConnected, path=null&lt;br/&gt;
2012-07-22 13:02:23,522 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(339): regionserver:56523-0x138aec80e530001 connected&lt;br/&gt;
2012-07-22 13:02:23,522 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(236): regionserver:56523-0x138aec80e530001 Set watcher on existing znode /hbase/master&lt;br/&gt;
2012-07-22 13:02:23,527 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 35 byte(s) of data from znode /hbase/master and set watcher; PBUF\x0A\x1D\x0A\x10vesta.apa...&lt;br/&gt;
2012-07-22 13:02:23,527 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(238): regionserver:56523-0x138aec80e530001 /hbase/shutdown does not exist. Watcher is set.&lt;br/&gt;
2012-07-22 13:02:23,539 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.MasterFileSystem(394): BOOTSTRAP: creating ROOT and first META regions&lt;br/&gt;
2012-07-22 13:02:23,539 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(3781): creating HRegion &lt;del&gt;ROOT&lt;/del&gt; HTD == &apos;&lt;del&gt;ROOT&lt;/del&gt;&apos;, &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {METHOD =&amp;gt; &amp;#39;table_att&amp;#39;, IS_META =&amp;gt; &amp;#39;true&amp;#39;, IS_ROOT =&amp;gt; &amp;#39;true&amp;#39;}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;, &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {NAME =&amp;gt; &amp;#39;info&amp;#39;, DATA_BLOCK_ENCODING =&amp;gt; &amp;#39;NONE&amp;#39;, BLOOMFILTER =&amp;gt; &amp;#39;NONE&amp;#39;, REPLICATION_SCOPE =&amp;gt; &amp;#39;0&amp;#39;, COMPRESSION =&amp;gt; &amp;#39;NONE&amp;#39;, VERSIONS =&amp;gt; &amp;#39;10&amp;#39;, TTL =&amp;gt; &amp;#39;2147483647&amp;#39;, MIN_VERSIONS =&amp;gt; &amp;#39;0&amp;#39;, KEEP_DELETED_CELLS =&amp;gt; &amp;#39;false&amp;#39;, BLOCKSIZE =&amp;gt; &amp;#39;8192&amp;#39;, ENCODE_ON_DISK =&amp;gt; &amp;#39;true&amp;#39;, IN_MEMORY =&amp;gt; &amp;#39;false&amp;#39;, BLOCKCACHE =&amp;gt; &amp;#39;false&amp;#39;}&lt;/span&gt; &lt;p&gt; RootDir = hdfs://localhost:52085/user/hudson/hbase Table name == &lt;del&gt;ROOT&lt;/del&gt;&lt;br/&gt;
2012-07-22 13:02:23,580 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.HLog(428): HLog configuration: blocksize=64 MB, rollsize=60.8 MB, enabled=true, optionallogflushinternal=1000ms&lt;br/&gt;
2012-07-22 13:02:23,622 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.SequenceFileLogWriter(190): using new createWriter &amp;#8211; &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-6840&quot; title=&quot;Support non-recursive create() in FileSystem &amp;amp; SequenceFile.Writer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-6840&quot;&gt;&lt;del&gt;HADOOP-6840&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2012-07-22 13:02:23,622 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.SequenceFileLogWriter(194): Path=hdfs://localhost:52085/user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/.logs/hlog.1342962143580, compression=false&lt;br/&gt;
2012-07-22 13:02:23,622 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.HLog(652):  for /user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/.logs/hlog.1342962143580&lt;br/&gt;
2012-07-22 13:02:23,623 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.HLog(500): Using getNumCurrentReplicas--&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-826&quot; title=&quot;Allow a mechanism for an application to detect that datanode(s)  have died in the write pipeline&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-826&quot;&gt;&lt;del&gt;HDFS-826&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2012-07-22 13:02:23,639 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(464): Instantiated &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052&lt;br/&gt;
2012-07-22 13:02:23,643 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; util.FSUtils(163): Creating file=hdfs://localhost:52085/user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/.tmp/.regioninfo with permission=rwxrwxrwx&lt;br/&gt;
2012-07-22 13:02:23,730 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;StoreOpenerThread--ROOT-,,0.70236052-1&amp;#93;&lt;/span&gt; regionserver.Store(224): hbase.hstore.compaction.min = 3&lt;br/&gt;
2012-07-22 13:02:23,738 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;StoreOpenerThread--ROOT-,,0.70236052-1&amp;#93;&lt;/span&gt; util.ChecksumType$2(68): Checksum using org.apache.hadoop.util.PureJavaCrc32&lt;br/&gt;
2012-07-22 13:02:23,738 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;StoreOpenerThread--ROOT-,,0.70236052-1&amp;#93;&lt;/span&gt; util.ChecksumType$3(111): Checksum can use org.apache.hadoop.util.PureJavaCrc32C&lt;br/&gt;
2012-07-22 13:02:23,748 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(609): Onlined &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052; next sequenceid=1&lt;br/&gt;
2012-07-22 13:02:23,748 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(3781): creating HRegion .META. HTD == &apos;.META.&apos;, &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {METHOD =&amp;gt; &amp;#39;table_att&amp;#39;, IS_META =&amp;gt; &amp;#39;true&amp;#39;}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;, &lt;/p&gt;&lt;/div&gt;
&lt;p&gt; RootDir = hdfs://localhost:52085/user/hudson/hbase Table name == .META.&lt;br/&gt;
2012-07-22 13:02:23,787 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.HLog(428): HLog configuration: blocksize=64 MB, rollsize=60.8 MB, enabled=true, optionallogflushinternal=1000ms&lt;br/&gt;
2012-07-22 13:02:23,803 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.SequenceFileLogWriter(190): using new createWriter &amp;#8211; &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-6840&quot; title=&quot;Support non-recursive create() in FileSystem &amp;amp; SequenceFile.Writer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-6840&quot;&gt;&lt;del&gt;HADOOP-6840&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2012-07-22 13:02:23,803 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.SequenceFileLogWriter(194): Path=hdfs://localhost:52085/user/hudson/hbase/.META./1028785192/.logs/hlog.1342962143787, compression=false&lt;br/&gt;
2012-07-22 13:02:23,803 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.HLog(652):  for /user/hudson/hbase/.META./1028785192/.logs/hlog.1342962143787&lt;br/&gt;
2012-07-22 13:02:23,803 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.HLog(500): Using getNumCurrentReplicas--&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-826&quot; title=&quot;Allow a mechanism for an application to detect that datanode(s)  have died in the write pipeline&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-826&quot;&gt;&lt;del&gt;HDFS-826&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2012-07-22 13:02:23,804 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(464): Instantiated .META.,,1.1028785192&lt;br/&gt;
2012-07-22 13:02:23,806 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; util.FSUtils(163): Creating file=hdfs://localhost:52085/user/hudson/hbase/.META./1028785192/.tmp/.regioninfo with permission=rwxrwxrwx&lt;br/&gt;
2012-07-22 13:02:23,882 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;StoreOpenerThread-.META.,,1.1028785192-1&amp;#93;&lt;/span&gt; regionserver.Store(224): hbase.hstore.compaction.min = 3&lt;br/&gt;
2012-07-22 13:02:23,887 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(609): Onlined .META.,,1.1028785192; next sequenceid=1&lt;br/&gt;
2012-07-22 13:02:23,909 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(941): Closing &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052: disabling compactions &amp;amp; flushes&lt;br/&gt;
2012-07-22 13:02:23,909 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(962): Updates disabled for region &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052&lt;br/&gt;
2012-07-22 13:02:23,910 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(1468): Started memstore flush for &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052, current region memstore size 360&lt;br/&gt;
2012-07-22 13:02:23,910 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(1516): Finished snapshotting &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052, commencing wait for mvcc, flushsize=360&lt;br/&gt;
2012-07-22 13:02:23,911 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(1526): Finished snapshotting, commencing flushing stores&lt;br/&gt;
2012-07-22 13:02:23,932 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; util.FSUtils(163): Creating file=hdfs://localhost:52085/user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/.tmp/12a0be11d2894ba0ab2cc64ec6357aa0 with permission=rwxrwxrwx&lt;br/&gt;
2012-07-22 13:02:23,953 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; hfile.HFileWriterV2(143): Initialized with CacheConfig:enabled &lt;span class=&quot;error&quot;&gt;&amp;#91;cacheDataOnRead=false&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;cacheDataOnWrite=false&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;cacheIndexesOnWrite=false&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;cacheBloomsOnWrite=false&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;cacheEvictOnClose=false&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;cacheCompressed=false&amp;#93;&lt;/span&gt;&lt;br/&gt;
2012-07-22 13:02:23,956 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.StoreFile$Writer(1001): Delete Family Bloom filter type for hdfs://localhost:52085/user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/.tmp/12a0be11d2894ba0ab2cc64ec6357aa0: CompoundBloomFilterWriter&lt;br/&gt;
2012-07-22 13:02:23,995 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.StoreFile$Writer(1221): NO General Bloom and NO DeleteFamily was added to HFile (hdfs://localhost:52085/user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/.tmp/12a0be11d2894ba0ab2cc64ec6357aa0) &lt;br/&gt;
2012-07-22 13:02:23,996 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.Store(785): Flushed , sequenceid=2, memsize=360, into tmp file hdfs://localhost:52085/user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/.tmp/12a0be11d2894ba0ab2cc64ec6357aa0&lt;br/&gt;
2012-07-22 13:02:24,013 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.Store(810): Renaming flushed file at hdfs://localhost:52085/user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/.tmp/12a0be11d2894ba0ab2cc64ec6357aa0 to hdfs://localhost:52085/user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/info/12a0be11d2894ba0ab2cc64ec6357aa0&lt;br/&gt;
2012-07-22 13:02:24,031 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.Store(833): Added hdfs://localhost:52085/user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/info/12a0be11d2894ba0ab2cc64ec6357aa0, entries=2, sequenceid=2, filesize=848&lt;br/&gt;
2012-07-22 13:02:24,032 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(1600): Finished memstore flush of ~360/360, currentsize=0/0 for region &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 in 122ms, sequenceid=2, compaction requested=false&lt;br/&gt;
2012-07-22 13:02:24,035 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;StoreCloserThread--ROOT-,,0.70236052-1&amp;#93;&lt;/span&gt; regionserver.Store(670): Closed info&lt;br/&gt;
2012-07-22 13:02:24,035 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(1010): Closed &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052&lt;br/&gt;
2012-07-22 13:02:24,035 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091.logSyncer&amp;#93;&lt;/span&gt; wal.HLog$LogSyncer(1237): Master:0;vesta.apache.org,55921,1342962143091.logSyncer exiting&lt;br/&gt;
2012-07-22 13:02:24,036 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.HLog(1006): closing hlog writer in hdfs://localhost:52085/user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/.logs&lt;br/&gt;
2012-07-22 13:02:24,061 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.HLog(974): Moved 1 log files to /user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/.oldlogs&lt;br/&gt;
2012-07-22 13:02:24,073 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(941): Closing .META.,,1.1028785192: disabling compactions &amp;amp; flushes&lt;br/&gt;
2012-07-22 13:02:24,074 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(962): Updates disabled for region .META.,,1.1028785192&lt;br/&gt;
2012-07-22 13:02:24,074 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;StoreCloserThread-.META.,,1.1028785192-1&amp;#93;&lt;/span&gt; regionserver.Store(670): Closed info&lt;br/&gt;
2012-07-22 13:02:24,074 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; regionserver.HRegion(1010): Closed .META.,,1.1028785192&lt;br/&gt;
2012-07-22 13:02:24,074 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091.logSyncer&amp;#93;&lt;/span&gt; wal.HLog$LogSyncer(1237): Master:0;vesta.apache.org,55921,1342962143091.logSyncer exiting&lt;br/&gt;
2012-07-22 13:02:24,075 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.HLog(1006): closing hlog writer in hdfs://localhost:52085/user/hudson/hbase/.META./1028785192/.logs&lt;br/&gt;
2012-07-22 13:02:24,109 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; wal.HLog(974): Moved 1 log files to /user/hudson/hbase/.META./1028785192/.oldlogs&lt;br/&gt;
2012-07-22 13:02:24,619 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(103): hconnection 0xcf7fd0 opening connection to ZooKeeper with ensemble (localhost:59288)&lt;br/&gt;
2012-07-22 13:02:24,620 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.RecoverableZooKeeper(102): The identifier of this process is 4689@vesta.apache.org&lt;br/&gt;
2012-07-22 13:02:24,629 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): hconnection 0xcf7fd0 Received ZooKeeper Event, type=None, state=SyncConnected, path=null&lt;br/&gt;
2012-07-22 13:02:24,630 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0 Retrieved 42 byte(s) of data from znode /hbase/hbaseid; data=PBUF\x0A$f285209f-4f02-4b1d-8...&lt;br/&gt;
2012-07-22 13:02:24,630 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(664): ClusterId is f285209f-4f02-4b1d-817f-d5611467793a&lt;br/&gt;
2012-07-22 13:02:24,630 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(339): hconnection 0xcf7fd0-0x138aec80e530002 connected&lt;br/&gt;
2012-07-22 13:02:24,632 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; catalog.CatalogTracker(240): Starting catalog tracker org.apache.hadoop.hbase.catalog.CatalogTracker@cf5006&lt;br/&gt;
2012-07-22 13:02:24,633 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(238): master:55921-0x138aec80e530000 /hbase/root-region-server does not exist. Watcher is set.&lt;br/&gt;
2012-07-22 13:02:24,633 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(238): master:55921-0x138aec80e530000 /hbase/unassigned/1028785192 does not exist. Watcher is set.&lt;br/&gt;
2012-07-22 13:02:24,654 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeCreated, state=SyncConnected, path=/hbase/shutdown&lt;br/&gt;
2012-07-22 13:02:24,654 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): regionserver:56523-0x138aec80e530001 Received ZooKeeper Event, type=NodeCreated, state=SyncConnected, path=/hbase/shutdown&lt;br/&gt;
2012-07-22 13:02:24,655 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.HMaster(524): Server active/primary master; vesta.apache.org,55921,1342962143091, sessionid=0x138aec80e530000, cluster-up flag was=false&lt;br/&gt;
2012-07-22 13:02:24,655 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 34 byte(s) of data from znode /hbase/shutdown and set watcher; PBUF\x0A\x1CSun Jul 22 13:02:...&lt;br/&gt;
2012-07-22 13:02:24,655 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 34 byte(s) of data from znode /hbase/shutdown and set watcher; PBUF\x0A\x1CSun Jul 22 13:02:...&lt;br/&gt;
2012-07-22 13:02:24,659 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(103): hconnection 0xe8f27e opening connection to ZooKeeper with ensemble (localhost:59288)&lt;br/&gt;
2012-07-22 13:02:24,660 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; zookeeper.RecoverableZooKeeper(102): The identifier of this process is 4689@vesta.apache.org&lt;br/&gt;
2012-07-22 13:02:24,662 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; executor.ExecutorService(133): Starting executor service name=MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091, corePoolSize=5, maxPoolSize=5&lt;br/&gt;
2012-07-22 13:02:24,662 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; executor.ExecutorService(133): Starting executor service name=MASTER_CLOSE_REGION-vesta.apache.org,55921,1342962143091, corePoolSize=5, maxPoolSize=5&lt;br/&gt;
2012-07-22 13:02:24,662 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; executor.ExecutorService(133): Starting executor service name=MASTER_SERVER_OPERATIONS-vesta.apache.org,55921,1342962143091, corePoolSize=3, maxPoolSize=3&lt;br/&gt;
2012-07-22 13:02:24,663 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; executor.ExecutorService(133): Starting executor service name=MASTER_META_SERVER_OPERATIONS-vesta.apache.org,55921,1342962143091, corePoolSize=5, maxPoolSize=5&lt;br/&gt;
2012-07-22 13:02:24,663 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; executor.ExecutorService(133): Starting executor service name=MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091, corePoolSize=1, maxPoolSize=1&lt;br/&gt;
2012-07-22 13:02:24,667 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.HMaster(1034): Started service threads&lt;br/&gt;
2012-07-22 13:02:24,667 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.ServerManager(627): Waiting for region servers count to settle; currently checked in 0, slept for 0 ms, expecting minimum of 1, maximum of 1, timeout of 4500 ms, interval of 1500 ms.&lt;br/&gt;
2012-07-22 13:02:24,669 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): hconnection 0xe8f27e Received ZooKeeper Event, type=None, state=SyncConnected, path=null&lt;br/&gt;
2012-07-22 13:02:24,670 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xe8f27e Retrieved 42 byte(s) of data from znode /hbase/hbaseid; data=PBUF\x0A$f285209f-4f02-4b1d-8...&lt;br/&gt;
2012-07-22 13:02:24,670 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(339): hconnection 0xe8f27e-0x138aec80e530003 connected&lt;br/&gt;
2012-07-22 13:02:24,670 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(664): ClusterId is f285209f-4f02-4b1d-817f-d5611467793a&lt;br/&gt;
2012-07-22 13:02:24,670 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; catalog.CatalogTracker(240): Starting catalog tracker org.apache.hadoop.hbase.catalog.CatalogTracker@5b701a&lt;br/&gt;
2012-07-22 13:02:24,671 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(238): regionserver:56523-0x138aec80e530001 /hbase/root-region-server does not exist. Watcher is set.&lt;br/&gt;
2012-07-22 13:02:24,672 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(238): regionserver:56523-0x138aec80e530001 /hbase/unassigned/1028785192 does not exist. Watcher is set.&lt;br/&gt;
2012-07-22 13:02:24,674 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; regionserver.MemStoreFlusher(112): globalMemStoreLimit=675.6m, globalMemStoreLimitLowMark=591.1m, maxHeap=1.6g&lt;br/&gt;
2012-07-22 13:02:24,676 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; regionserver.HRegionServer$CompactionChecker(1216): Runs every 16mins, 40sec&lt;br/&gt;
2012-07-22 13:02:24,709 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1828): Attempting connect to Master server at vesta.apache.org,55921,1342962143091&lt;br/&gt;
2012-07-22 13:02:24,755 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1837): Connected to master at vesta.apache.org/67.195.138.9:55921&lt;br/&gt;
2012-07-22 13:02:24,755 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1883): Telling master at vesta.apache.org,55921,1342962143091 that we are up with port=56523, startcode=1342962143399&lt;br/&gt;
2012-07-22 13:02:24,759 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;IPC Server handler 2 on 55921&amp;#93;&lt;/span&gt; master.ServerManager(270): Registering server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:24,764 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1063): Config from master: hbase.rootdir=hdfs://localhost:52085/user/hudson/hbase&lt;br/&gt;
2012-07-22 13:02:24,764 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1063): Config from master: fs.default.name=hdfs://localhost:52085&lt;br/&gt;
2012-07-22 13:02:24,764 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1056): Master passed us hostname to use. Was=vesta.apache.org, Now=vesta.apache.org&lt;br/&gt;
2012-07-22 13:02:24,767 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.ServerManager(644): Finished waiting for region servers count to settle; checked in 1, slept for 100 ms, expecting minimum of 1, maximum of 1, master is running.&lt;br/&gt;
2012-07-22 13:02:24,768 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeChildrenChanged, state=SyncConnected, path=/hbase/rs&lt;br/&gt;
2012-07-22 13:02:24,768 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; hbase.ZNodeClearer(58): No filename given to save the znode used, it won&apos;t be saved (Environment variable HBASE_ZNODE_FILE is not set).&lt;br/&gt;
2012-07-22 13:02:24,769 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(236): master:55921-0x138aec80e530000 Set watcher on existing znode /hbase/rs/vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:24,772 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1277): logdir=hdfs://localhost:52085/user/hudson/hbase/.logs/vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:24,786 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; wal.HLog(428): HLog configuration: blocksize=64 MB, rollsize=60.8 MB, enabled=true, optionallogflushinternal=1000ms&lt;br/&gt;
2012-07-22 13:02:24,804 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; wal.SequenceFileLogWriter(190): using new createWriter &amp;#8211; &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-6840&quot; title=&quot;Support non-recursive create() in FileSystem &amp;amp; SequenceFile.Writer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-6840&quot;&gt;&lt;del&gt;HADOOP-6840&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2012-07-22 13:02:24,804 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; wal.SequenceFileLogWriter(194): Path=hdfs://localhost:52085/user/hudson/hbase/.logs/vesta.apache.org,56523,1342962143399/vesta.apache.org%2C56523%2C1342962143399.1342962144786, compression=false&lt;br/&gt;
2012-07-22 13:02:24,804 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; wal.HLog(652):  for /user/hudson/hbase/.logs/vesta.apache.org,56523,1342962143399/vesta.apache.org%2C56523%2C1342962143399.1342962144786&lt;br/&gt;
2012-07-22 13:02:24,804 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; wal.HLog(500): Using getNumCurrentReplicas--&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-826&quot; title=&quot;Allow a mechanism for an application to detect that datanode(s)  have died in the write pipeline&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-826&quot;&gt;&lt;del&gt;HDFS-826&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2012-07-22 13:02:24,807 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; util.MetricsDynamicMBeanBase(115): unknown metrics type: org.apache.hadoop.hbase.metrics.histogram.MetricsHistogram&lt;br/&gt;
2012-07-22 13:02:24,807 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; util.MetricsDynamicMBeanBase(115): unknown metrics type: org.apache.hadoop.hbase.metrics.histogram.MetricsHistogram&lt;br/&gt;
2012-07-22 13:02:24,807 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; util.MetricsDynamicMBeanBase(115): unknown metrics type: org.apache.hadoop.hbase.metrics.histogram.MetricsHistogram&lt;br/&gt;
2012-07-22 13:02:24,807 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; util.MetricsDynamicMBeanBase(115): unknown metrics type: org.apache.hadoop.hbase.metrics.histogram.MetricsHistogram&lt;br/&gt;
2012-07-22 13:02:24,807 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; util.MetricsDynamicMBeanBase(115): unknown metrics type: org.apache.hadoop.hbase.metrics.histogram.MetricsHistogram&lt;br/&gt;
2012-07-22 13:02:24,808 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; util.MetricsDynamicMBeanBase(115): unknown metrics type: org.apache.hadoop.hbase.metrics.histogram.MetricsHistogram&lt;br/&gt;
2012-07-22 13:02:24,808 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; util.MetricsDynamicMBeanBase(115): unknown metrics type: org.apache.hadoop.hbase.metrics.histogram.MetricsHistogram&lt;br/&gt;
2012-07-22 13:02:24,808 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(161): new MBeanInfo&lt;br/&gt;
2012-07-22 13:02:24,808 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; metrics.RegionServerMetrics(326): Initialized&lt;br/&gt;
2012-07-22 13:02:24,809 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; metrics.MetricsMBeanBase(161): new MBeanInfo&lt;br/&gt;
2012-07-22 13:02:24,810 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; metrics.RegionServerDynamicMetrics(91): java.lang.NoSuchMethodException: org.apache.hadoop.hbase.metrics.MetricsMBeanBase.updateMbeanInfoIfMetricsListChanged()&lt;br/&gt;
2012-07-22 13:02:24,810 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; executor.ExecutorService(133): Starting executor service name=RS_OPEN_REGION-vesta.apache.org,56523,1342962143399, corePoolSize=3, maxPoolSize=3&lt;br/&gt;
2012-07-22 13:02:24,811 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; executor.ExecutorService(133): Starting executor service name=RS_OPEN_ROOT-vesta.apache.org,56523,1342962143399, corePoolSize=1, maxPoolSize=1&lt;br/&gt;
2012-07-22 13:02:24,811 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; executor.ExecutorService(133): Starting executor service name=RS_OPEN_META-vesta.apache.org,56523,1342962143399, corePoolSize=1, maxPoolSize=1&lt;br/&gt;
2012-07-22 13:02:24,811 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; executor.ExecutorService(133): Starting executor service name=RS_CLOSE_REGION-vesta.apache.org,56523,1342962143399, corePoolSize=3, maxPoolSize=3&lt;br/&gt;
2012-07-22 13:02:24,811 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; executor.ExecutorService(133): Starting executor service name=RS_CLOSE_ROOT-vesta.apache.org,56523,1342962143399, corePoolSize=1, maxPoolSize=1&lt;br/&gt;
2012-07-22 13:02:24,811 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; executor.ExecutorService(133): Starting executor service name=RS_CLOSE_META-vesta.apache.org,56523,1342962143399, corePoolSize=1, maxPoolSize=1&lt;br/&gt;
2012-07-22 13:02:24,819 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1095): Serving as vesta.apache.org,56523,1342962143399, RPC listening on vesta.apache.org/67.195.138.9:56523, sessionid=0x138aec80e530001&lt;br/&gt;
2012-07-22 13:02:24,819 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;SplitLogWorker-vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; regionserver.SplitLogWorker(135): SplitLogWorker vesta.apache.org,56523,1342962143399 starting&lt;br/&gt;
2012-07-22 13:02:24,820 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399&amp;#93;&lt;/span&gt; regionserver.HRegionServer(2353): Registered RegionServer MXBean&lt;br/&gt;
2012-07-22 13:02:25,778 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.RootRegionTracker(157): Unsetting ROOT region location in ZooKeeper&lt;br/&gt;
2012-07-22 13:02:25,783 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.RecoverableZooKeeper(142): Node /hbase/root-region-server already deleted, and this is not a retry&lt;br/&gt;
2012-07-22 13:02:25,785 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(272): master:55921-0x138aec80e530000 Creating (or updating) unassigned node for 70236052 with OFFLINE state&lt;br/&gt;
2012-07-22 13:02:25,799 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.AssignmentManager(1732): Setting table &lt;del&gt;ROOT&lt;/del&gt; to ENABLED state.&lt;br/&gt;
2012-07-22 13:02:25,819 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.AssignmentManager(1976): No previous transition plan was found (or we are ignoring an existing plan) for &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 so generated a random one; hri=&lt;del&gt;ROOT&lt;/del&gt;,,0.70236052, src=, dest=vesta.apache.org,56523,1342962143399; 1 (online=1, available=1) available servers&lt;br/&gt;
2012-07-22 13:02:25,819 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.AssignmentManager(1751): Assigning region &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 to vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,819 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.ServerManager(574): New connection to vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,846 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PRI IPC Server handler 2 on 56523&amp;#93;&lt;/span&gt; regionserver.HRegionServer(3428): Received request to open region: &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 on vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,848 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node 70236052/&lt;del&gt;ROOT&lt;/del&gt; from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:25,849 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 57 byte(s) of data from znode /hbase/unassigned/70236052; data=region=&lt;del&gt;ROOT&lt;/del&gt;,,0, state=M_ZK_REGION_OFFLINE, servername=vesta.apache.org,55921,1342962143091, createTime=1342962145788, payload.length=0&lt;br/&gt;
2012-07-22 13:02:25,854 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/70236052&lt;br/&gt;
2012-07-22 13:02:25,854 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node 70236052 from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:25,855 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; regionserver.HRegion(3851): Opening region: &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {NAME =&amp;gt; &amp;#39;-ROOT-,,0&amp;#39;, STARTKEY =&amp;gt; &amp;#39;&amp;#39;, ENDKEY =&amp;gt; &amp;#39;&amp;#39;, ENCODED =&amp;gt; 70236052,}&lt;/span&gt; 
&lt;p&gt;2012-07-22 13:02:25,855 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 55 byte(s) of data from znode /hbase/unassigned/70236052 and set watcher; region=&lt;del&gt;ROOT&lt;/del&gt;,,0, state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962145849, payload.length=0&lt;br/&gt;
2012-07-22 13:02:25,856 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_OPENING, server=vesta.apache.org,56523,1342962143399, region=70236052/&lt;del&gt;ROOT&lt;/del&gt;, current state from RIT=&lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 state=PENDING_OPEN, ts=1342962145819, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,860 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; regionserver.HRegion(464): Instantiated &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052&lt;br/&gt;
2012-07-22 13:02:25,900 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;StoreOpenerThread--ROOT-,,0.70236052-1&amp;#93;&lt;/span&gt; regionserver.Store(224): hbase.hstore.compaction.min = 3&lt;br/&gt;
2012-07-22 13:02:25,912 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;StoreOpenerThread--ROOT-,,0.70236052-1&amp;#93;&lt;/span&gt; regionserver.Store(428): loaded hdfs://localhost:52085/user/hudson/hbase/&lt;del&gt;ROOT&lt;/del&gt;/70236052/info/12a0be11d2894ba0ab2cc64ec6357aa0, isReference=false, isBulkLoadResult=false, seqid=2, majorCompaction=false&lt;br/&gt;
2012-07-22 13:02:25,915 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; regionserver.HRegion(609): Onlined &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052; next sequenceid=3&lt;br/&gt;
2012-07-22 13:02:25,916 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node 70236052/&lt;del&gt;ROOT&lt;/del&gt; from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:25,916 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 55 byte(s) of data from znode /hbase/unassigned/70236052; data=region=&lt;del&gt;ROOT&lt;/del&gt;,,0, state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962145849, payload.length=0&lt;br/&gt;
2012-07-22 13:02:25,922 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/70236052&lt;br/&gt;
2012-07-22 13:02:25,922 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node 70236052 from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:25,923 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 55 byte(s) of data from znode /hbase/unassigned/70236052 and set watcher; region=&lt;del&gt;ROOT&lt;/del&gt;,,0, state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962145917, payload.length=0&lt;br/&gt;
2012-07-22 13:02:25,923 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_OPENING, server=vesta.apache.org,56523,1342962143399, region=70236052/&lt;del&gt;ROOT&lt;/del&gt;, current state from RIT=&lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 state=OPENING, ts=1342962145849, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,923 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:70236052&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1644): Post open deploy tasks for region=&lt;del&gt;ROOT&lt;/del&gt;,,0.70236052, daughter=false&lt;br/&gt;
2012-07-22 13:02:25,923 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:70236052&amp;#93;&lt;/span&gt; zookeeper.RootRegionTracker(123): Setting ROOT region location in ZooKeeper as vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,932 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): regionserver:56523-0x138aec80e530001 Received ZooKeeper Event, type=NodeCreated, state=SyncConnected, path=/hbase/root-region-server&lt;br/&gt;
2012-07-22 13:02:25,932 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeCreated, state=SyncConnected, path=/hbase/root-region-server&lt;br/&gt;
2012-07-22 13:02:25,933 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 35 byte(s) of data from znode /hbase/root-region-server and set watcher; vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,933 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 35 byte(s) of data from znode /hbase/root-region-server and set watcher; vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,933 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:70236052&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1669): Done with post open deploy task for region=&lt;del&gt;ROOT&lt;/del&gt;,,0.70236052, daughter=false&lt;br/&gt;
2012-07-22 13:02:25,934 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node 70236052/&lt;del&gt;ROOT&lt;/del&gt; from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:25,934 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 55 byte(s) of data from znode /hbase/unassigned/70236052; data=region=&lt;del&gt;ROOT&lt;/del&gt;,,0, state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962145917, payload.length=0&lt;br/&gt;
2012-07-22 13:02:25,944 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/70236052&lt;br/&gt;
2012-07-22 13:02:25,944 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node 70236052 from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:25,944 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; handler.OpenRegionHandler(286): region transitioned to opened in zookeeper: &lt;/p&gt;&lt;/div&gt;
&lt;p&gt;, server: vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,944 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; handler.OpenRegionHandler(142): Opened &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 on server:vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,945 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 55 byte(s) of data from znode /hbase/unassigned/70236052 and set watcher; region=&lt;del&gt;ROOT&lt;/del&gt;,,0, state=RS_ZK_REGION_OPENED, servername=vesta.apache.org,56523,1342962143399, createTime=1342962145935, payload.length=0&lt;br/&gt;
2012-07-22 13:02:25,945 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_OPENED, server=vesta.apache.org,56523,1342962143399, region=70236052/&lt;del&gt;ROOT&lt;/del&gt;, current state from RIT=&lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 state=OPENING, ts=1342962145917, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,946 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; handler.OpenedRegionHandler(147): Handling OPENED event for &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 from vesta.apache.org,56523,1342962143399; deleting unassigned node&lt;br/&gt;
2012-07-22 13:02:25,946 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(492): master:55921-0x138aec80e530000 Deleting existing unassigned node for 70236052 that is in expected state RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:25,947 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 55 byte(s) of data from znode /hbase/unassigned/70236052; data=region=&lt;del&gt;ROOT&lt;/del&gt;,,0, state=RS_ZK_REGION_OPENED, servername=vesta.apache.org,56523,1342962143399, createTime=1342962145935, payload.length=0&lt;br/&gt;
2012-07-22 13:02:25,956 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDeleted, state=SyncConnected, path=/hbase/unassigned/70236052&lt;br/&gt;
2012-07-22 13:02:25,956 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(521): master:55921-0x138aec80e530000 Successfully deleted unassigned node for region 70236052 in expected state RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:25,956 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(1191): The znode of region &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 has been deleted.&lt;br/&gt;
2012-07-22 13:02:25,957 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(1204): The master has opened the region &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 that was online on vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,957 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 35 byte(s) of data from znode /hbase/root-region-server and set watcher; vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,958 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.HMaster(800): &lt;del&gt;ROOT&lt;/del&gt; assigned=1, rit=false, location=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,964 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:25,965 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,965 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,967 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:25,967 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:25,967 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,067 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,068 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,068 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,068 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,069 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,069 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,121 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,122 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,122 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,122 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,123 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,123 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,175 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,175 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,175 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,176 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,176 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,176 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,228 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,229 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,229 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,229 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,230 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,230 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,282 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,282 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,282 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,283 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,283 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,283 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,337 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,337 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,337 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,338 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,338 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,338 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,390 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,391 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,391 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,391 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,392 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,392 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,443 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,444 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,444 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,444 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,445 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,445 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,497 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,498 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,498 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,498 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,498 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,499 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,551 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,552 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,552 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,552 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,553 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,553 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,605 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,605 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,605 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,606 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,606 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,606 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,658 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,659 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,659 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,659 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,660 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,660 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,711 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,712 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,712 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,712 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,713 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,713 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,765 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,765 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,766 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,766 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,766 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,766 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,818 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,819 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,819 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,819 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,820 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,820 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,872 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,873 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,873 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,873 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,874 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,874 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,925 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,926 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,926 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,926 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,927 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,927 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,979 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,979 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,979 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,980 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,980 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,980 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,982 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,982 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,983 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,983 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:26,983 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,984 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:26,985 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(272): master:55921-0x138aec80e530000 Creating (or updating) unassigned node for 1028785192 with OFFLINE state&lt;br/&gt;
2012-07-22 13:02:27,020 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): regionserver:56523-0x138aec80e530001 Received ZooKeeper Event, type=NodeCreated, state=SyncConnected, path=/hbase/unassigned/1028785192&lt;br/&gt;
2012-07-22 13:02:27,020 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeCreated, state=SyncConnected, path=/hbase/unassigned/1028785192&lt;br/&gt;
2012-07-22 13:02:27,021 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 57 byte(s) of data from znode /hbase/unassigned/1028785192 and set watcher; region=.META.,,1, state=M_ZK_REGION_OFFLINE, servername=vesta.apache.org,55921,1342962143091, createTime=1342962146985, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,021 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 57 byte(s) of data from znode /hbase/unassigned/1028785192 and set watcher; region=.META.,,1, state=M_ZK_REGION_OFFLINE, servername=vesta.apache.org,55921,1342962143091, createTime=1342962146985, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,021 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.AssignmentManager(1732): Setting table .META. to ENABLED state.&lt;br/&gt;
2012-07-22 13:02:27,021 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=M_ZK_REGION_OFFLINE, server=vesta.apache.org,55921,1342962143091, region=1028785192/.META., current state from RIT=.META.,,1.1028785192 state=OFFLINE, ts=1342962146985, server=null&lt;br/&gt;
2012-07-22 13:02:27,022 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 57 byte(s) of data from znode /hbase/unassigned/1028785192 and set watcher; region=.META.,,1, state=M_ZK_REGION_OFFLINE, servername=vesta.apache.org,55921,1342962143091, createTime=1342962146985, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,037 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.AssignmentManager(1976): No previous transition plan was found (or we are ignoring an existing plan) for .META.,,1.1028785192 so generated a random one; hri=.META.,,1.1028785192, src=, dest=vesta.apache.org,56523,1342962143399; 1 (online=1, available=1) available servers&lt;br/&gt;
2012-07-22 13:02:27,037 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.AssignmentManager(1751): Assigning region .META.,,1.1028785192 to vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,037 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.ServerManager(574): New connection to vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,037 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PRI IPC Server handler 5 on 56523&amp;#93;&lt;/span&gt; regionserver.HRegionServer(3428): Received request to open region: .META.,,1.1028785192 on vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,038 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node 1028785192/.META. from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:27,039 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:27,039 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 57 byte(s) of data from znode /hbase/unassigned/1028785192; data=region=.META.,,1, state=M_ZK_REGION_OFFLINE, servername=vesta.apache.org,55921,1342962143091, createTime=1342962146985, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,040 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,040 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,040 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:27,056 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): regionserver:56523-0x138aec80e530001 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/1028785192&lt;br/&gt;
2012-07-22 13:02:27,056 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/1028785192&lt;br/&gt;
2012-07-22 13:02:27,056 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node 1028785192 from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:27,057 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; regionserver.HRegion(3851): Opening region: &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {NAME =&amp;gt; &amp;#39;.META.,,1&amp;#39;, STARTKEY =&amp;gt; &amp;#39;&amp;#39;, ENDKEY =&amp;gt; &amp;#39;&amp;#39;, ENCODED =&amp;gt; 1028785192,}&lt;/span&gt; 
&lt;p&gt;2012-07-22 13:02:27,057 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,057 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 55 byte(s) of data from znode /hbase/unassigned/1028785192 and set watcher; region=.META.,,1, state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962147040, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,057 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,057 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 55 byte(s) of data from znode /hbase/unassigned/1028785192 and set watcher; region=.META.,,1, state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962147040, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,057 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_OPENING, server=vesta.apache.org,56523,1342962143399, region=1028785192/.META., current state from RIT=.META.,,1.1028785192 state=PENDING_OPEN, ts=1342962147037, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,057 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; regionserver.HRegion(464): Instantiated .META.,,1.1028785192&lt;br/&gt;
2012-07-22 13:02:27,058 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 55 byte(s) of data from znode /hbase/unassigned/1028785192 and set watcher; region=.META.,,1, state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962147040, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,062 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;StoreOpenerThread-.META.,,1.1028785192-1&amp;#93;&lt;/span&gt; regionserver.Store(224): hbase.hstore.compaction.min = 3&lt;br/&gt;
2012-07-22 13:02:27,066 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; regionserver.HRegion(609): Onlined .META.,,1.1028785192; next sequenceid=1&lt;br/&gt;
2012-07-22 13:02:27,066 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node 1028785192/.META. from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:27,067 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 55 byte(s) of data from znode /hbase/unassigned/1028785192; data=region=.META.,,1, state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962147040, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,076 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): regionserver:56523-0x138aec80e530001 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/1028785192&lt;br/&gt;
2012-07-22 13:02:27,076 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/1028785192&lt;br/&gt;
2012-07-22 13:02:27,076 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node 1028785192 from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:27,077 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:1028785192&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1644): Post open deploy tasks for region=.META.,,1.1028785192, daughter=false&lt;br/&gt;
2012-07-22 13:02:27,077 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 55 byte(s) of data from znode /hbase/unassigned/1028785192 and set watcher; region=.META.,,1, state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962147067, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,077 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 55 byte(s) of data from znode /hbase/unassigned/1028785192 and set watcher; region=.META.,,1, state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962147067, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,077 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_OPENING, server=vesta.apache.org,56523,1342962143399, region=1028785192/.META., current state from RIT=.META.,,1.1028785192 state=OPENING, ts=1342962147040, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,078 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 55 byte(s) of data from znode /hbase/unassigned/1028785192 and set watcher; region=.META.,,1, state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962147067, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,078 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:1028785192&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xe8f27e&lt;br/&gt;
2012-07-22 13:02:27,079 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:1028785192&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xe8f27e-0x138aec80e530003 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,079 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:1028785192&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xe8f27e; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,080 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:1028785192&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xe8f27e&lt;br/&gt;
2012-07-22 13:02:27,080 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:1028785192&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xe8f27e-0x138aec80e530003 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,080 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:1028785192&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xe8f27e; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,279 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:27,281 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,281 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,281 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:27,282 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,282 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,286 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:27,286 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,286 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,287 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:27,287 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,287 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,302 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:1028785192&amp;#93;&lt;/span&gt; catalog.MetaEditor(263): Updated row .META.,,1.1028785192 with server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,302 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:1028785192&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1669): Done with post open deploy task for region=.META.,,1.1028785192, daughter=false&lt;br/&gt;
2012-07-22 13:02:27,303 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node 1028785192/.META. from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:27,303 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 55 byte(s) of data from znode /hbase/unassigned/1028785192; data=region=.META.,,1, state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962147067, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,307 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): regionserver:56523-0x138aec80e530001 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/1028785192&lt;br/&gt;
2012-07-22 13:02:27,307 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/1028785192&lt;br/&gt;
2012-07-22 13:02:27,307 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node 1028785192 from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:27,308 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; handler.OpenRegionHandler(286): region transitioned to opened in zookeeper: &lt;/p&gt;&lt;/div&gt;
&lt;p&gt;, server: vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,308 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_META-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; handler.OpenRegionHandler(142): Opened .META.,,1.1028785192 on server:vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,308 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 55 byte(s) of data from znode /hbase/unassigned/1028785192 and set watcher; region=.META.,,1, state=RS_ZK_REGION_OPENED, servername=vesta.apache.org,56523,1342962143399, createTime=1342962147303, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,308 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 55 byte(s) of data from znode /hbase/unassigned/1028785192 and set watcher; region=.META.,,1, state=RS_ZK_REGION_OPENED, servername=vesta.apache.org,56523,1342962143399, createTime=1342962147303, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,308 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_OPENED, server=vesta.apache.org,56523,1342962143399, region=1028785192/.META., current state from RIT=.META.,,1.1028785192 state=OPENING, ts=1342962147067, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,309 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-1&amp;#93;&lt;/span&gt; handler.OpenedRegionHandler(147): Handling OPENED event for .META.,,1.1028785192 from vesta.apache.org,56523,1342962143399; deleting unassigned node&lt;br/&gt;
2012-07-22 13:02:27,309 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-1&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(492): master:55921-0x138aec80e530000 Deleting existing unassigned node for 1028785192 that is in expected state RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:27,309 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 55 byte(s) of data from znode /hbase/unassigned/1028785192 and set watcher; region=.META.,,1, state=RS_ZK_REGION_OPENED, servername=vesta.apache.org,56523,1342962143399, createTime=1342962147303, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,310 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-1&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 55 byte(s) of data from znode /hbase/unassigned/1028785192; data=region=.META.,,1, state=RS_ZK_REGION_OPENED, servername=vesta.apache.org,56523,1342962143399, createTime=1342962147303, payload.length=0&lt;br/&gt;
2012-07-22 13:02:27,319 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): regionserver:56523-0x138aec80e530001 Received ZooKeeper Event, type=NodeDeleted, state=SyncConnected, path=/hbase/unassigned/1028785192&lt;br/&gt;
2012-07-22 13:02:27,319 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDeleted, state=SyncConnected, path=/hbase/unassigned/1028785192&lt;br/&gt;
2012-07-22 13:02:27,319 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-1&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(521): master:55921-0x138aec80e530000 Successfully deleted unassigned node for region 1028785192 in expected state RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:27,319 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(1191): The znode of region .META.,,1.1028785192 has been deleted.&lt;br/&gt;
2012-07-22 13:02:27,319 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,56523,1342962143399-EventThread&amp;#93;&lt;/span&gt; catalog.CatalogTracker(528): Current cached META location, null, is not valid, resetting&lt;br/&gt;
2012-07-22 13:02:27,320 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(1204): The master has opened the region .META.,,1.1028785192 that was online on vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,320 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; catalog.CatalogTracker(528): Current cached META location, null, is not valid, resetting&lt;br/&gt;
2012-07-22 13:02:27,320 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:27,321 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,321 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,321 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:27,321 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,322 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,328 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; catalog.CatalogTracker(540): Set new cached META location: vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,328 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.HMaster(828): .META. assigned=2, rit=false, location=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,329 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:27,330 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,330 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,331 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.ClientScanner(94): Creating scanner over &lt;del&gt;ROOT&lt;/del&gt; starting at key &apos;&apos;&lt;br/&gt;
2012-07-22 13:02:27,331 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.ClientScanner(205): Advancing internal scanner to startKey at &apos;&apos;&lt;br/&gt;
2012-07-22 13:02:27,332 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:27,333 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,333 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,342 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.ClientScanner(192): Finished with scanning at &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {NAME =&amp;gt; &amp;#39;-ROOT-,,0&amp;#39;, STARTKEY =&amp;gt; &amp;#39;&amp;#39;, ENDKEY =&amp;gt; &amp;#39;&amp;#39;, ENCODED =&amp;gt; 70236052,}&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;2012-07-22 13:02:27,342 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; catalog.MetaMigrationRemovingHTD(225): Meta version=0; migrated=true&lt;br/&gt;
2012-07-22 13:02:27,342 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; catalog.MetaMigrationRemovingHTD(246): ROOT/Meta already up-to date with new HRI.&lt;br/&gt;
2012-07-22 13:02:27,343 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xcf7fd0&lt;br/&gt;
2012-07-22 13:02:27,344 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xcf7fd0-0x138aec80e530002 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,344 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xcf7fd0; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,349 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(1335): Cached location for .META.,,1.1028785192 is vesta.apache.org:56523&lt;br/&gt;
2012-07-22 13:02:27,349 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.ClientScanner(94): Creating scanner over .META. starting at key &apos;&apos;&lt;br/&gt;
2012-07-22 13:02:27,349 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.ClientScanner(205): Advancing internal scanner to startKey at &apos;&apos;&lt;br/&gt;
2012-07-22 13:02:27,352 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.ClientScanner(192): Finished with scanning at &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {NAME =&amp;gt; &amp;#39;.META.,,1&amp;#39;, STARTKEY =&amp;gt; &amp;#39;&amp;#39;, ENDKEY =&amp;gt; &amp;#39;&amp;#39;, ENCODED =&amp;gt; 1028785192,}&lt;/span&gt; 
&lt;p&gt;2012-07-22 13:02:27,353 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.AssignmentManager(467): Clean cluster startup. Assigning userregions&lt;br/&gt;
2012-07-22 13:02:27,353 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(539): master:55921-0x138aec80e530000 Deleting any existing unassigned nodes&lt;br/&gt;
2012-07-22 13:02:27,354 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.ClientScanner(94): Creating scanner over .META. starting at key &apos;&apos;&lt;br/&gt;
2012-07-22 13:02:27,354 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.ClientScanner(205): Advancing internal scanner to startKey at &apos;&apos;&lt;br/&gt;
2012-07-22 13:02:27,357 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.ClientScanner(192): Finished with scanning at &lt;/p&gt;&lt;/div&gt;
&lt;p&gt;2012-07-22 13:02:27,358 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.ClientScanner(94): Creating scanner over .META. starting at key &apos;&apos;&lt;br/&gt;
2012-07-22 13:02:27,358 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.ClientScanner(205): Advancing internal scanner to startKey at &apos;&apos;&lt;br/&gt;
2012-07-22 13:02:27,361 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; client.ClientScanner(192): Finished with scanning at &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {NAME =&amp;gt; &amp;#39;.META.,,1&amp;#39;, STARTKEY =&amp;gt; &amp;#39;&amp;#39;, ENDKEY =&amp;gt; &amp;#39;&amp;#39;, ENCODED =&amp;gt; 1028785192,}&lt;/span&gt; 
&lt;p&gt;2012-07-22 13:02:27,365 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-CatalogJanitor&amp;#93;&lt;/span&gt; client.ClientScanner(94): Creating scanner over .META. starting at key &apos;&apos;&lt;br/&gt;
2012-07-22 13:02:27,366 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-CatalogJanitor&amp;#93;&lt;/span&gt; client.ClientScanner(205): Advancing internal scanner to startKey at &apos;&apos;&lt;br/&gt;
2012-07-22 13:02:27,367 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.HMaster(2262): Registered HMaster MXBean&lt;br/&gt;
2012-07-22 13:02:27,368 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;vesta.apache.org,55921,1342962143091&amp;#93;&lt;/span&gt; master.HMaster(693): Master has completed initialization&lt;br/&gt;
2012-07-22 13:02:27,370 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-CatalogJanitor&amp;#93;&lt;/span&gt; client.ClientScanner(192): Finished with scanning at &lt;/p&gt;&lt;/div&gt;
&lt;p&gt;2012-07-22 13:02:27,370 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-CatalogJanitor&amp;#93;&lt;/span&gt; master.CatalogJanitor(170): Scanned 0 catalog row(s) and gc&apos;d 0 unreferenced parent region(s)&lt;br/&gt;
2012-07-22 13:02:27,381 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(103): hconnection 0xf49ac3 opening connection to ZooKeeper with ensemble (localhost:59288)&lt;br/&gt;
2012-07-22 13:02:27,382 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; zookeeper.RecoverableZooKeeper(102): The identifier of this process is 4689@vesta.apache.org&lt;br/&gt;
2012-07-22 13:02:27,387 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): hconnection 0xf49ac3 Received ZooKeeper Event, type=None, state=SyncConnected, path=null&lt;br/&gt;
2012-07-22 13:02:27,388 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xf49ac3 Retrieved 42 byte(s) of data from znode /hbase/hbaseid; data=PBUF\x0A$f285209f-4f02-4b1d-8...&lt;br/&gt;
2012-07-22 13:02:27,388 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(664): ClusterId is f285209f-4f02-4b1d-817f-d5611467793a&lt;br/&gt;
2012-07-22 13:02:27,389 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xf49ac3&lt;br/&gt;
2012-07-22 13:02:27,389 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(339): hconnection 0xf49ac3-0x138aec80e530004 connected&lt;br/&gt;
2012-07-22 13:02:27,389 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xf49ac3-0x138aec80e530004 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,389 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xf49ac3; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:27,394 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(1335): Cached location for .META.,,1.1028785192 is vesta.apache.org:56523&lt;br/&gt;
2012-07-22 13:02:27,394 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; client.ClientScanner(94): Creating scanner over .META. starting at key &apos;&apos;&lt;br/&gt;
2012-07-22 13:02:27,394 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; client.ClientScanner(205): Advancing internal scanner to startKey at &apos;&apos;&lt;br/&gt;
2012-07-22 13:02:27,397 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; client.ClientScanner(192): Finished with scanning at &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {NAME =&amp;gt; &amp;#39;.META.,,1&amp;#39;, STARTKEY =&amp;gt; &amp;#39;&amp;#39;, ENDKEY =&amp;gt; &amp;#39;&amp;#39;, ENCODED =&amp;gt; 1028785192,}&lt;/span&gt; 
&lt;p&gt;2012-07-22 13:02:27,397 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(1544): Closing zookeeper sessionid=0x138aec80e530004&lt;br/&gt;
2012-07-22 13:02:27,415 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(103): hconnection 0x1fd9b49 opening connection to ZooKeeper with ensemble (localhost:59288)&lt;br/&gt;
2012-07-22 13:02:27,416 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; zookeeper.RecoverableZooKeeper(102): The identifier of this process is 4689@vesta.apache.org&lt;br/&gt;
2012-07-22 13:02:27,426 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): hconnection 0x1fd9b49 Received ZooKeeper Event, type=None, state=SyncConnected, path=null&lt;br/&gt;
2012-07-22 13:02:27,427 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0x1fd9b49 Retrieved 42 byte(s) of data from znode /hbase/hbaseid; data=PBUF\x0A$f285209f-4f02-4b1d-8...&lt;br/&gt;
2012-07-22 13:02:27,427 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(664): ClusterId is f285209f-4f02-4b1d-817f-d5611467793a&lt;br/&gt;
2012-07-22 13:02:27,427 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.HBaseTestingUtility(673): Minicluster is up&lt;br/&gt;
2012-07-22 13:02:27,428 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(339): hconnection 0x1fd9b49-0x138aec80e530005 connected&lt;br/&gt;
2012-07-22 13:02:27,437 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; hbase.ResourceChecker(145): before avro.TestAvroServer#testTableAdminAndMetadata: 138 threads, 319 file descriptors 3 connections, &lt;br/&gt;
2012-07-22 13:02:27,550 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0x1fd9b49-0x138aec80e530005 Retrieved 35 byte(s) of data from znode /hbase/master; data=PBUF\x0A\x1D\x0A\x10vesta.apa...&lt;br/&gt;
2012-07-22 13:02:27,908 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0x1fd9b49-0x138aec80e530005 Retrieved 35 byte(s) of data from znode /hbase/master; data=PBUF\x0A\x1D\x0A\x10vesta.apa...&lt;br/&gt;
2012-07-22 13:02:27,941 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;IPC Server handler 4 on 55921&amp;#93;&lt;/span&gt; client.ClientScanner(94): Creating scanner over .META. starting at key &apos;tableA,,&apos;&lt;br/&gt;
2012-07-22 13:02:27,941 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;IPC Server handler 4 on 55921&amp;#93;&lt;/span&gt; client.ClientScanner(205): Advancing internal scanner to startKey at &apos;tableA,,&apos;&lt;br/&gt;
2012-07-22 13:02:27,944 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;IPC Server handler 4 on 55921&amp;#93;&lt;/span&gt; client.ClientScanner(192): Finished with scanning at &lt;/p&gt;&lt;/div&gt;
&lt;p&gt;2012-07-22 13:02:28,116 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; handler.CreateTableHandler(128): Attempting to create the table tableA&lt;br/&gt;
2012-07-22 13:02:28,117 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; util.FSUtils(1114): hdfs://localhost:52085/user/hudson/hbase/tableA doesn&apos;t exist&lt;br/&gt;
2012-07-22 13:02:28,120 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; client.MetaScanner(202): Scanning .META. starting at row=tableA,,00000000000000 for max=2147483647 rows using hconnection 0x1fd9b49&lt;br/&gt;
2012-07-22 13:02:28,120 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0x1fd9b49&lt;br/&gt;
2012-07-22 13:02:28,120 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0x1fd9b49-0x138aec80e530005 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,121 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0x1fd9b49; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,125 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(1335): Cached location for .META.,,1.1028785192 is vesta.apache.org:56523&lt;br/&gt;
2012-07-22 13:02:28,169 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; regionserver.HRegion(3781): creating HRegion tableA HTD == &apos;tableA&apos; RootDir = hdfs://localhost:52085/user/hudson/hbase Table name == tableA&lt;br/&gt;
2012-07-22 13:02:28,217 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.HLog(428): HLog configuration: blocksize=64 MB, rollsize=60.8 MB, enabled=true, optionallogflushinternal=1000ms&lt;br/&gt;
2012-07-22 13:02:28,242 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.SequenceFileLogWriter(190): using new createWriter &amp;#8211; &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-6840&quot; title=&quot;Support non-recursive create() in FileSystem &amp;amp; SequenceFile.Writer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-6840&quot;&gt;&lt;del&gt;HADOOP-6840&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2012-07-22 13:02:28,242 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.SequenceFileLogWriter(194): Path=hdfs://localhost:52085/user/hudson/hbase/tableA/a697a37d317a95f9881b48cc409eafb1/.logs/hlog.1342962148217, compression=false&lt;br/&gt;
2012-07-22 13:02:28,242 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.HLog(652):  for /user/hudson/hbase/tableA/a697a37d317a95f9881b48cc409eafb1/.logs/hlog.1342962148217&lt;br/&gt;
2012-07-22 13:02:28,242 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.HLog(500): Using getNumCurrentReplicas--&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-826&quot; title=&quot;Allow a mechanism for an application to detect that datanode(s)  have died in the write pipeline&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-826&quot;&gt;&lt;del&gt;HDFS-826&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2012-07-22 13:02:28,242 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; regionserver.HRegion(464): Instantiated tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1.&lt;br/&gt;
2012-07-22 13:02:28,246 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; catalog.MetaEditor(165): Added 1 regions in META&lt;br/&gt;
2012-07-22 13:02:28,246 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; regionserver.HRegion(941): Closing tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1.: disabling compactions &amp;amp; flushes&lt;br/&gt;
2012-07-22 13:02:28,246 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; regionserver.HRegion(962): Updates disabled for region tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1.&lt;br/&gt;
2012-07-22 13:02:28,246 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; regionserver.HRegion(1010): Closed tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1.&lt;br/&gt;
2012-07-22 13:02:28,247 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0.logSyncer&amp;#93;&lt;/span&gt; wal.HLog$LogSyncer(1237): MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0.logSyncer exiting&lt;br/&gt;
2012-07-22 13:02:28,247 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.HLog(1006): closing hlog writer in hdfs://localhost:52085/user/hudson/hbase/tableA/a697a37d317a95f9881b48cc409eafb1/.logs&lt;br/&gt;
2012-07-22 13:02:28,285 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.HLog(974): Moved 1 log files to /user/hudson/hbase/tableA/a697a37d317a95f9881b48cc409eafb1/.oldlogs&lt;br/&gt;
2012-07-22 13:02:28,301 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; master.AssignmentManager(2354): Bulk assigning 1 region(s) round-robin across 1 server(s)&lt;br/&gt;
2012-07-22 13:02:28,302 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; master.AssignmentManager$StartupBulkAssigner(2496): Timeout-on-RIT=1000&lt;br/&gt;
2012-07-22 13:02:28,302 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-StartupBulkAssigner-0&amp;#93;&lt;/span&gt; master.AssignmentManager(1438): Bulk assigning 1 region(s) to vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,303 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; master.AssignmentManager(2359): Bulk assigning done&lt;br/&gt;
2012-07-22 13:02:28,304 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-StartupBulkAssigner-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(177): master:55921-0x138aec80e530000 Async create of unassigned node for a697a37d317a95f9881b48cc409eafb1 with OFFLINE state&lt;br/&gt;
2012-07-22 13:02:28,321 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeChildrenChanged, state=SyncConnected, path=/hbase/unassigned&lt;br/&gt;
2012-07-22 13:02:28,323 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(236): master:55921-0x138aec80e530000 Set watcher on existing znode /hbase/unassigned/a697a37d317a95f9881b48cc409eafb1&lt;br/&gt;
2012-07-22 13:02:28,324 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager$CreateUnassignedAsyncCallback(1603): rs=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1. state=OFFLINE, ts=1342962148304, server=null, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,325 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager$ExistsUnassignedAsyncCallback(1634): rs=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1. state=OFFLINE, ts=1342962148304, server=null&lt;br/&gt;
2012-07-22 13:02:28,326 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-StartupBulkAssigner-0&amp;#93;&lt;/span&gt; master.AssignmentManager(1469): vesta.apache.org,56523,1342962143399 unassigned znodes=1 of total=1&lt;br/&gt;
2012-07-22 13:02:28,326 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-StartupBulkAssigner-0&amp;#93;&lt;/span&gt; master.ServerManager(574): New connection to vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,327 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PRI IPC Server handler 4 on 56523&amp;#93;&lt;/span&gt; regionserver.HRegionServer(3428): Received request to open region: tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1. on vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,333 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node a697a37d317a95f9881b48cc409eafb1 from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:28,334 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-StartupBulkAssigner-0&amp;#93;&lt;/span&gt; master.AssignmentManager(1527): Bulk assigning done for vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,334 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 101 byte(s) of data from znode /hbase/unassigned/a697a37d317a95f9881b48cc409eafb1; data=region=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1., state=M_ZK_REGION_OFFLINE, servername=vesta.apache.org,55921,1342962143091, createTime=1342962148304, payload.length=0&lt;br/&gt;
2012-07-22 13:02:28,343 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/a697a37d317a95f9881b48cc409eafb1&lt;br/&gt;
2012-07-22 13:02:28,343 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node a697a37d317a95f9881b48cc409eafb1 from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:28,343 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; regionserver.HRegion(3851): Opening region: &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {NAME =&amp;gt; &amp;#39;tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1.&amp;#39;, STARTKEY =&amp;gt; &amp;#39;&amp;#39;, ENDKEY =&amp;gt; &amp;#39;&amp;#39;, ENCODED =&amp;gt; a697a37d317a95f9881b48cc409eafb1,}&lt;/span&gt; 
&lt;p&gt;2012-07-22 13:02:28,343 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 101 byte(s) of data from znode /hbase/unassigned/a697a37d317a95f9881b48cc409eafb1 and set watcher; region=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1., state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962148335, payload.length=0&lt;br/&gt;
2012-07-22 13:02:28,343 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_OPENING, server=vesta.apache.org,56523,1342962143399, region=a697a37d317a95f9881b48cc409eafb1, current state from RIT=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1. state=PENDING_OPEN, ts=1342962148325, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,343 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; regionserver.HRegion(464): Instantiated tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1.&lt;br/&gt;
2012-07-22 13:02:28,345 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; util.FSUtils(163): Creating file=hdfs://localhost:52085/user/hudson/hbase/tableA/a697a37d317a95f9881b48cc409eafb1/.tmp/.regioninfo with permission=rwxrwxrwx&lt;br/&gt;
2012-07-22 13:02:28,415 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; regionserver.HRegion(609): Onlined tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1.; next sequenceid=0&lt;br/&gt;
2012-07-22 13:02:28,415 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node a697a37d317a95f9881b48cc409eafb1 from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:28,416 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 101 byte(s) of data from znode /hbase/unassigned/a697a37d317a95f9881b48cc409eafb1; data=region=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1., state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962148335, payload.length=0&lt;br/&gt;
2012-07-22 13:02:28,420 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/a697a37d317a95f9881b48cc409eafb1&lt;br/&gt;
2012-07-22 13:02:28,420 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node a697a37d317a95f9881b48cc409eafb1 from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:28,420 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:a697a37d317a95f9881b48cc409eafb1&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1644): Post open deploy tasks for region=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1., daughter=false&lt;br/&gt;
2012-07-22 13:02:28,421 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 101 byte(s) of data from znode /hbase/unassigned/a697a37d317a95f9881b48cc409eafb1 and set watcher; region=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1., state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962148416, payload.length=0&lt;br/&gt;
2012-07-22 13:02:28,421 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_OPENING, server=vesta.apache.org,56523,1342962143399, region=a697a37d317a95f9881b48cc409eafb1, current state from RIT=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1. state=OPENING, ts=1342962148335, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,421 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:a697a37d317a95f9881b48cc409eafb1&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(938): Looking up root region location in ZK, connection=hconnection 0xe8f27e&lt;br/&gt;
2012-07-22 13:02:28,421 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:a697a37d317a95f9881b48cc409eafb1&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0xe8f27e-0x138aec80e530003 Retrieved 35 byte(s) of data from znode /hbase/root-region-server; data=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,422 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:a697a37d317a95f9881b48cc409eafb1&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(943): Looked up root region location, connection=hconnection 0xe8f27e; serverName=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,423 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:a697a37d317a95f9881b48cc409eafb1&amp;#93;&lt;/span&gt; client.HConnectionManager$HConnectionImplementation(1335): Cached location for .META.,,1.1028785192 is vesta.apache.org:56523&lt;br/&gt;
2012-07-22 13:02:28,427 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:a697a37d317a95f9881b48cc409eafb1&amp;#93;&lt;/span&gt; catalog.MetaEditor(263): Updated row tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1. with server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,428 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:a697a37d317a95f9881b48cc409eafb1&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1669): Done with post open deploy task for region=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1., daughter=false&lt;br/&gt;
2012-07-22 13:02:28,428 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node a697a37d317a95f9881b48cc409eafb1 from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:28,429 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 101 byte(s) of data from znode /hbase/unassigned/a697a37d317a95f9881b48cc409eafb1; data=region=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1., state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962148416, payload.length=0&lt;br/&gt;
2012-07-22 13:02:28,438 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/a697a37d317a95f9881b48cc409eafb1&lt;br/&gt;
2012-07-22 13:02:28,438 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node a697a37d317a95f9881b48cc409eafb1 from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:28,438 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; handler.OpenRegionHandler(286): region transitioned to opened in zookeeper: &lt;/p&gt;&lt;/div&gt;
&lt;p&gt;, server: vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,458 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-1&amp;#93;&lt;/span&gt; handler.OpenRegionHandler(142): Opened tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1. on server:vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,458 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 101 byte(s) of data from znode /hbase/unassigned/a697a37d317a95f9881b48cc409eafb1 and set watcher; region=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1., state=RS_ZK_REGION_OPENED, servername=vesta.apache.org,56523,1342962143399, createTime=1342962148429, payload.length=0&lt;br/&gt;
2012-07-22 13:02:28,459 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_OPENED, server=vesta.apache.org,56523,1342962143399, region=a697a37d317a95f9881b48cc409eafb1, current state from RIT=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1. state=OPENING, ts=1342962148416, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,459 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-2&amp;#93;&lt;/span&gt; handler.OpenedRegionHandler(149): Handling OPENED event for tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1. from vesta.apache.org,56523,1342962143399; deleting unassigned node&lt;br/&gt;
2012-07-22 13:02:28,459 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-2&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(492): master:55921-0x138aec80e530000 Deleting existing unassigned node for a697a37d317a95f9881b48cc409eafb1 that is in expected state RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:28,460 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-2&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 101 byte(s) of data from znode /hbase/unassigned/a697a37d317a95f9881b48cc409eafb1; data=region=tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1., state=RS_ZK_REGION_OPENED, servername=vesta.apache.org,56523,1342962143399, createTime=1342962148429, payload.length=0&lt;br/&gt;
2012-07-22 13:02:28,466 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDeleted, state=SyncConnected, path=/hbase/unassigned/a697a37d317a95f9881b48cc409eafb1&lt;br/&gt;
2012-07-22 13:02:28,466 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(1191): The znode of region tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1. has been deleted.&lt;br/&gt;
2012-07-22 13:02:28,466 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-2&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(521): master:55921-0x138aec80e530000 Successfully deleted unassigned node for region a697a37d317a95f9881b48cc409eafb1 in expected state RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:28,466 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(1204): The master has opened the region tableA,,1342962147936.a697a37d317a95f9881b48cc409eafb1. that was online on vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:28,467 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeChildrenChanged, state=SyncConnected, path=/hbase/unassigned&lt;br/&gt;
2012-07-22 13:02:29,128 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; client.MetaScanner(202): Scanning .META. starting at row=tableA,,00000000000000 for max=2147483647 rows using hconnection 0x1fd9b49&lt;br/&gt;
2012-07-22 13:02:29,153 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0x1fd9b49-0x138aec80e530005 Retrieved 6 byte(s) of data from znode /hbase/table/tableA; data=PBUF\x08\x00&lt;br/&gt;
2012-07-22 13:02:29,154 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(103): catalogtracker-on-hconnection 0x1fd9b49 opening connection to ZooKeeper with ensemble (localhost:59288)&lt;br/&gt;
2012-07-22 13:02:29,155 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; zookeeper.RecoverableZooKeeper(102): The identifier of this process is 4689@vesta.apache.org&lt;br/&gt;
2012-07-22 13:02:29,155 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; catalog.CatalogTracker(240): Starting catalog tracker org.apache.hadoop.hbase.catalog.CatalogTracker@14e5d57&lt;br/&gt;
2012-07-22 13:02:29,164 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): catalogtracker-on-hconnection 0x1fd9b49 Received ZooKeeper Event, type=None, state=SyncConnected, path=null&lt;br/&gt;
2012-07-22 13:02:29,164 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(236): catalogtracker-on-hconnection 0x1fd9b49 Set watcher on existing znode /hbase/root-region-server&lt;br/&gt;
2012-07-22 13:02:29,164 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): catalogtracker-on-hconnection 0x1fd9b49 Retrieved 35 byte(s) of data from znode /hbase/root-region-server and set watcher; vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,165 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(238): catalogtracker-on-hconnection 0x1fd9b49 /hbase/unassigned/1028785192 does not exist. Watcher is set.&lt;br/&gt;
2012-07-22 13:02:29,165 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(339): catalogtracker-on-hconnection 0x1fd9b49-0x138aec80e530006 connected&lt;br/&gt;
2012-07-22 13:02:29,165 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; client.ClientScanner(94): Creating scanner over .META. starting at key &apos;tableA,,&apos;&lt;br/&gt;
2012-07-22 13:02:29,165 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; client.ClientScanner(205): Advancing internal scanner to startKey at &apos;tableA,,&apos;&lt;br/&gt;
2012-07-22 13:02:29,169 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; catalog.CatalogTracker(257): Stopping catalog tracker org.apache.hadoop.hbase.catalog.CatalogTracker@14e5d57&lt;br/&gt;
2012-07-22 13:02:29,179 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;IPC Server handler 4 on 55921&amp;#93;&lt;/span&gt; client.ClientScanner(94): Creating scanner over .META. starting at key &apos;tableB,,&apos;&lt;br/&gt;
2012-07-22 13:02:29,179 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;IPC Server handler 4 on 55921&amp;#93;&lt;/span&gt; client.ClientScanner(205): Advancing internal scanner to startKey at &apos;tableB,,&apos;&lt;br/&gt;
2012-07-22 13:02:29,181 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;IPC Server handler 4 on 55921&amp;#93;&lt;/span&gt; client.ClientScanner(192): Finished with scanning at &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {NAME =&amp;gt; &amp;#39;.META.,,1&amp;#39;, STARTKEY =&amp;gt; &amp;#39;&amp;#39;, ENDKEY =&amp;gt; &amp;#39;&amp;#39;, ENCODED =&amp;gt; 1028785192,}&lt;/span&gt; 
&lt;p&gt;2012-07-22 13:02:29,200 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; handler.CreateTableHandler(128): Attempting to create the table tableB&lt;br/&gt;
2012-07-22 13:02:29,200 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; client.MetaScanner(202): Scanning .META. starting at row=tableB,,00000000000000 for max=2147483647 rows using hconnection 0x1fd9b49&lt;br/&gt;
2012-07-22 13:02:29,201 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; util.FSUtils(1114): hdfs://localhost:52085/user/hudson/hbase/tableB doesn&apos;t exist&lt;br/&gt;
2012-07-22 13:02:29,245 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; regionserver.HRegion(3781): creating HRegion tableB HTD == &apos;tableB&apos; RootDir = hdfs://localhost:52085/user/hudson/hbase Table name == tableB&lt;br/&gt;
2012-07-22 13:02:29,293 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.HLog(428): HLog configuration: blocksize=64 MB, rollsize=60.8 MB, enabled=true, optionallogflushinternal=1000ms&lt;br/&gt;
2012-07-22 13:02:29,309 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.SequenceFileLogWriter(190): using new createWriter &amp;#8211; &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-6840&quot; title=&quot;Support non-recursive create() in FileSystem &amp;amp; SequenceFile.Writer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-6840&quot;&gt;&lt;del&gt;HADOOP-6840&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2012-07-22 13:02:29,309 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.SequenceFileLogWriter(194): Path=hdfs://localhost:52085/user/hudson/hbase/tableB/e9d1ea1a8999939667d847817f3fba26/.logs/hlog.1342962149293, compression=false&lt;br/&gt;
2012-07-22 13:02:29,309 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.HLog(652):  for /user/hudson/hbase/tableB/e9d1ea1a8999939667d847817f3fba26/.logs/hlog.1342962149293&lt;br/&gt;
2012-07-22 13:02:29,309 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.HLog(500): Using getNumCurrentReplicas--&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-826&quot; title=&quot;Allow a mechanism for an application to detect that datanode(s)  have died in the write pipeline&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-826&quot;&gt;&lt;del&gt;HDFS-826&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2012-07-22 13:02:29,310 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; regionserver.HRegion(464): Instantiated tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.&lt;br/&gt;
2012-07-22 13:02:29,312 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; catalog.MetaEditor(165): Added 1 regions in META&lt;br/&gt;
2012-07-22 13:02:29,313 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; regionserver.HRegion(941): Closing tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.: disabling compactions &amp;amp; flushes&lt;br/&gt;
2012-07-22 13:02:29,313 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; regionserver.HRegion(962): Updates disabled for region tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.&lt;br/&gt;
2012-07-22 13:02:29,313 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; regionserver.HRegion(1010): Closed tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.&lt;br/&gt;
2012-07-22 13:02:29,313 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0.logSyncer&amp;#93;&lt;/span&gt; wal.HLog$LogSyncer(1237): MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0.logSyncer exiting&lt;br/&gt;
2012-07-22 13:02:29,313 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.HLog(1006): closing hlog writer in hdfs://localhost:52085/user/hudson/hbase/tableB/e9d1ea1a8999939667d847817f3fba26/.logs&lt;br/&gt;
2012-07-22 13:02:29,344 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; wal.HLog(974): Moved 1 log files to /user/hudson/hbase/tableB/e9d1ea1a8999939667d847817f3fba26/.oldlogs&lt;br/&gt;
2012-07-22 13:02:29,356 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; master.AssignmentManager(2354): Bulk assigning 1 region(s) round-robin across 1 server(s)&lt;br/&gt;
2012-07-22 13:02:29,357 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; master.AssignmentManager$StartupBulkAssigner(2496): Timeout-on-RIT=1000&lt;br/&gt;
2012-07-22 13:02:29,357 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-StartupBulkAssigner-0&amp;#93;&lt;/span&gt; master.AssignmentManager(1438): Bulk assigning 1 region(s) to vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,357 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; master.AssignmentManager(2359): Bulk assigning done&lt;br/&gt;
2012-07-22 13:02:29,357 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-StartupBulkAssigner-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(177): master:55921-0x138aec80e530000 Async create of unassigned node for e9d1ea1a8999939667d847817f3fba26 with OFFLINE state&lt;br/&gt;
2012-07-22 13:02:29,363 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeChildrenChanged, state=SyncConnected, path=/hbase/unassigned&lt;br/&gt;
2012-07-22 13:02:29,371 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(236): master:55921-0x138aec80e530000 Set watcher on existing znode /hbase/unassigned/e9d1ea1a8999939667d847817f3fba26&lt;br/&gt;
2012-07-22 13:02:29,371 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager$CreateUnassignedAsyncCallback(1603): rs=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. state=OFFLINE, ts=1342962149357, server=null, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,372 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager$ExistsUnassignedAsyncCallback(1634): rs=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. state=OFFLINE, ts=1342962149357, server=null&lt;br/&gt;
2012-07-22 13:02:29,372 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-StartupBulkAssigner-0&amp;#93;&lt;/span&gt; master.AssignmentManager(1469): vesta.apache.org,56523,1342962143399 unassigned znodes=1 of total=1&lt;br/&gt;
2012-07-22 13:02:29,372 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-StartupBulkAssigner-0&amp;#93;&lt;/span&gt; master.ServerManager(574): New connection to vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,374 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PRI IPC Server handler 6 on 56523&amp;#93;&lt;/span&gt; regionserver.HRegionServer(3428): Received request to open region: tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. on vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,380 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node e9d1ea1a8999939667d847817f3fba26 from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:29,380 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-StartupBulkAssigner-0&amp;#93;&lt;/span&gt; master.AssignmentManager(1527): Bulk assigning done for vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,381 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 101 byte(s) of data from znode /hbase/unassigned/e9d1ea1a8999939667d847817f3fba26; data=region=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26., state=M_ZK_REGION_OFFLINE, servername=vesta.apache.org,55921,1342962143091, createTime=1342962149357, payload.length=0&lt;br/&gt;
2012-07-22 13:02:29,391 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/e9d1ea1a8999939667d847817f3fba26&lt;br/&gt;
2012-07-22 13:02:29,391 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node e9d1ea1a8999939667d847817f3fba26 from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:29,391 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; regionserver.HRegion(3851): Opening region: &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {NAME =&amp;gt; &amp;#39;tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.&amp;#39;, STARTKEY =&amp;gt; &amp;#39;&amp;#39;, ENDKEY =&amp;gt; &amp;#39;&amp;#39;, ENCODED =&amp;gt; e9d1ea1a8999939667d847817f3fba26,}&lt;/span&gt; 
&lt;p&gt;2012-07-22 13:02:29,391 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 101 byte(s) of data from znode /hbase/unassigned/e9d1ea1a8999939667d847817f3fba26 and set watcher; region=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26., state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962149381, payload.length=0&lt;br/&gt;
2012-07-22 13:02:29,392 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_OPENING, server=vesta.apache.org,56523,1342962143399, region=e9d1ea1a8999939667d847817f3fba26, current state from RIT=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. state=PENDING_OPEN, ts=1342962149372, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,392 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; regionserver.HRegion(464): Instantiated tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.&lt;br/&gt;
2012-07-22 13:02:29,393 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; util.FSUtils(163): Creating file=hdfs://localhost:52085/user/hudson/hbase/tableB/e9d1ea1a8999939667d847817f3fba26/.tmp/.regioninfo with permission=rwxrwxrwx&lt;br/&gt;
2012-07-22 13:02:29,454 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; regionserver.HRegion(609): Onlined tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.; next sequenceid=0&lt;br/&gt;
2012-07-22 13:02:29,454 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node e9d1ea1a8999939667d847817f3fba26 from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:29,455 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 101 byte(s) of data from znode /hbase/unassigned/e9d1ea1a8999939667d847817f3fba26; data=region=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26., state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962149381, payload.length=0&lt;br/&gt;
2012-07-22 13:02:29,458 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/e9d1ea1a8999939667d847817f3fba26&lt;br/&gt;
2012-07-22 13:02:29,458 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node e9d1ea1a8999939667d847817f3fba26 from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENING&lt;br/&gt;
2012-07-22 13:02:29,459 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:e9d1ea1a8999939667d847817f3fba26&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1644): Post open deploy tasks for region=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26., daughter=false&lt;br/&gt;
2012-07-22 13:02:29,459 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 101 byte(s) of data from znode /hbase/unassigned/e9d1ea1a8999939667d847817f3fba26 and set watcher; region=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26., state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962149455, payload.length=0&lt;br/&gt;
2012-07-22 13:02:29,459 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_OPENING, server=vesta.apache.org,56523,1342962143399, region=e9d1ea1a8999939667d847817f3fba26, current state from RIT=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. state=OPENING, ts=1342962149381, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,462 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:e9d1ea1a8999939667d847817f3fba26&amp;#93;&lt;/span&gt; catalog.MetaEditor(263): Updated row tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. with server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,462 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PostOpenDeployTasks:e9d1ea1a8999939667d847817f3fba26&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1669): Done with post open deploy task for region=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26., daughter=false&lt;br/&gt;
2012-07-22 13:02:29,463 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node e9d1ea1a8999939667d847817f3fba26 from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:29,463 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 101 byte(s) of data from znode /hbase/unassigned/e9d1ea1a8999939667d847817f3fba26; data=region=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26., state=RS_ZK_REGION_OPENING, servername=vesta.apache.org,56523,1342962143399, createTime=1342962149455, payload.length=0&lt;br/&gt;
2012-07-22 13:02:29,470 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/e9d1ea1a8999939667d847817f3fba26&lt;br/&gt;
2012-07-22 13:02:29,470 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node e9d1ea1a8999939667d847817f3fba26 from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:29,471 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; handler.OpenRegionHandler(286): region transitioned to opened in zookeeper: &lt;/p&gt;&lt;/div&gt;
&lt;p&gt;, server: vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,471 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-vesta.apache.org,56523,1342962143399-2&amp;#93;&lt;/span&gt; handler.OpenRegionHandler(142): Opened tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. on server:vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,471 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 101 byte(s) of data from znode /hbase/unassigned/e9d1ea1a8999939667d847817f3fba26 and set watcher; region=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26., state=RS_ZK_REGION_OPENED, servername=vesta.apache.org,56523,1342962143399, createTime=1342962149464, payload.length=0&lt;br/&gt;
2012-07-22 13:02:29,471 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_OPENED, server=vesta.apache.org,56523,1342962143399, region=e9d1ea1a8999939667d847817f3fba26, current state from RIT=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. state=OPENING, ts=1342962149455, server=vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,472 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-3&amp;#93;&lt;/span&gt; handler.OpenedRegionHandler(149): Handling OPENED event for tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. from vesta.apache.org,56523,1342962143399; deleting unassigned node&lt;br/&gt;
2012-07-22 13:02:29,472 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-3&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(492): master:55921-0x138aec80e530000 Deleting existing unassigned node for e9d1ea1a8999939667d847817f3fba26 that is in expected state RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:29,473 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-3&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 101 byte(s) of data from znode /hbase/unassigned/e9d1ea1a8999939667d847817f3fba26; data=region=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26., state=RS_ZK_REGION_OPENED, servername=vesta.apache.org,56523,1342962143399, createTime=1342962149464, payload.length=0&lt;br/&gt;
2012-07-22 13:02:29,482 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDeleted, state=SyncConnected, path=/hbase/unassigned/e9d1ea1a8999939667d847817f3fba26&lt;br/&gt;
2012-07-22 13:02:29,482 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(1191): The znode of region tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. has been deleted.&lt;br/&gt;
2012-07-22 13:02:29,482 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_OPEN_REGION-vesta.apache.org,55921,1342962143091-3&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(521): master:55921-0x138aec80e530000 Successfully deleted unassigned node for region e9d1ea1a8999939667d847817f3fba26 in expected state RS_ZK_REGION_OPENED&lt;br/&gt;
2012-07-22 13:02:29,482 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(1204): The master has opened the region tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. that was online on vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:29,483 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeChildrenChanged, state=SyncConnected, path=/hbase/unassigned&lt;br/&gt;
2012-07-22 13:02:30,203 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; client.MetaScanner(202): Scanning .META. starting at row=tableB,,00000000000000 for max=2147483647 rows using hconnection 0x1fd9b49&lt;br/&gt;
2012-07-22 13:02:30,223 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; client.HBaseAdmin$5(788): Started disable of tableB&lt;br/&gt;
2012-07-22 13:02:30,224 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;IPC Server handler 4 on 55921&amp;#93;&lt;/span&gt; client.ClientScanner(94): Creating scanner over .META. starting at key &apos;tableB,,&apos;&lt;br/&gt;
2012-07-22 13:02:30,225 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;IPC Server handler 4 on 55921&amp;#93;&lt;/span&gt; client.ClientScanner(205): Advancing internal scanner to startKey at &apos;tableB,,&apos;&lt;br/&gt;
2012-07-22 13:02:30,234 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; handler.DisableTableHandler(101): Attempting to disable table tableB&lt;br/&gt;
2012-07-22 13:02:30,243 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0x1fd9b49-0x138aec80e530005 Retrieved 6 byte(s) of data from znode /hbase/table/tableB; data=PBUF\x08\x02&lt;br/&gt;
2012-07-22 13:02:30,243 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; handler.DisableTableHandler(133): Offlining 1 regions.&lt;br/&gt;
2012-07-22 13:02:30,243 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; client.HBaseAdmin(824): Sleeping= 1000ms, waiting for all regions to be disabled in tableB&lt;br/&gt;
2012-07-22 13:02:30,244 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-org.apache.hadoop.hbase.master.handler.DisableTableHandler$BulkDisabler-0&amp;#93;&lt;/span&gt; master.AssignmentManager(2065): Starting unassignment of region tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. (offlining)&lt;br/&gt;
2012-07-22 13:02:30,245 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-org.apache.hadoop.hbase.master.handler.DisableTableHandler$BulkDisabler-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(570): master:55921-0x138aec80e530000 Creating unassigned node for e9d1ea1a8999939667d847817f3fba26 in a CLOSING state&lt;br/&gt;
2012-07-22 13:02:30,254 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeChildrenChanged, state=SyncConnected, path=/hbase/unassigned&lt;br/&gt;
2012-07-22 13:02:30,255 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-org.apache.hadoop.hbase.master.handler.DisableTableHandler$BulkDisabler-0&amp;#93;&lt;/span&gt; master.ServerManager(574): New connection to vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:30,255 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(236): master:55921-0x138aec80e530000 Set watcher on existing znode /hbase/unassigned/e9d1ea1a8999939667d847817f3fba26&lt;br/&gt;
2012-07-22 13:02:30,257 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;PRI IPC Server handler 7 on 56523&amp;#93;&lt;/span&gt; regionserver.HRegionServer(3494): Received close region: tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.. Version of ZK closing node:0. Destination server:null&lt;br/&gt;
2012-07-22 13:02:30,258 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_CLOSE_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; handler.CloseRegionHandler(125): Processing close of tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.&lt;br/&gt;
2012-07-22 13:02:30,259 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_CLOSE_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; regionserver.HRegion(941): Closing tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.: disabling compactions &amp;amp; flushes&lt;br/&gt;
2012-07-22 13:02:30,259 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;vesta.apache.org,55921,1342962143091-org.apache.hadoop.hbase.master.handler.DisableTableHandler$BulkDisabler-0&amp;#93;&lt;/span&gt; master.AssignmentManager(2176): Sent CLOSE to vesta.apache.org,56523,1342962143399 for region tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.&lt;br/&gt;
2012-07-22 13:02:30,259 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_CLOSE_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; regionserver.HRegion(962): Updates disabled for region tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.&lt;br/&gt;
2012-07-22 13:02:30,259 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_CLOSE_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; regionserver.HRegion(1010): Closed tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.&lt;br/&gt;
2012-07-22 13:02:30,259 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_CLOSE_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(763): regionserver:56523-0x138aec80e530001 Attempting to transition node e9d1ea1a8999939667d847817f3fba26 from M_ZK_REGION_CLOSING to RS_ZK_REGION_CLOSED&lt;br/&gt;
2012-07-22 13:02:30,260 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_CLOSE_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): regionserver:56523-0x138aec80e530001 Retrieved 103 byte(s) of data from znode /hbase/unassigned/e9d1ea1a8999939667d847817f3fba26; data=region=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26., state=M_ZK_REGION_CLOSING, servername=vesta.apache.org,55921,1342962143091, createTime=1342962150245, payload.length=0&lt;br/&gt;
2012-07-22 13:02:30,267 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDataChanged, state=SyncConnected, path=/hbase/unassigned/e9d1ea1a8999939667d847817f3fba26&lt;br/&gt;
2012-07-22 13:02:30,267 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_CLOSE_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(824): regionserver:56523-0x138aec80e530001 Successfully transitioned node e9d1ea1a8999939667d847817f3fba26 from M_ZK_REGION_CLOSING to RS_ZK_REGION_CLOSED&lt;br/&gt;
2012-07-22 13:02:30,267 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_CLOSE_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; handler.CloseRegionHandler(160): set region closed state in zk successfully for region tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. sn name: vesta.apache.org,56523,1342962143399&lt;br/&gt;
2012-07-22 13:02:30,267 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_CLOSE_REGION-vesta.apache.org,56523,1342962143399-0&amp;#93;&lt;/span&gt; handler.CloseRegionHandler(169): Closed region tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.&lt;br/&gt;
2012-07-22 13:02:30,267 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 101 byte(s) of data from znode /hbase/unassigned/e9d1ea1a8999939667d847817f3fba26 and set watcher; region=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26., state=RS_ZK_REGION_CLOSED, servername=vesta.apache.org,56523,1342962143399, createTime=1342962150260, payload.length=0&lt;br/&gt;
2012-07-22 13:02:30,268 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(773): Handling transition=RS_ZK_REGION_CLOSED, server=vesta.apache.org,56523,1342962143399, region=e9d1ea1a8999939667d847817f3fba26, current state from RIT=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. state=PENDING_CLOSE, ts=1342962150255, server=null&lt;br/&gt;
2012-07-22 13:02:30,269 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_CLOSE_REGION-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; handler.ClosedRegionHandler(94): Handling CLOSED event for e9d1ea1a8999939667d847817f3fba26&lt;br/&gt;
2012-07-22 13:02:30,269 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_CLOSE_REGION-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; master.AssignmentManager(1356): Table being disabled so deleting ZK node and removing from regions in transition, skipping assignment of region tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26.&lt;br/&gt;
2012-07-22 13:02:30,269 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_CLOSE_REGION-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(492): master:55921-0x138aec80e530000 Deleting existing unassigned node for e9d1ea1a8999939667d847817f3fba26 that is in expected state RS_ZK_REGION_CLOSED&lt;br/&gt;
2012-07-22 13:02:30,270 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_CLOSE_REGION-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): master:55921-0x138aec80e530000 Retrieved 101 byte(s) of data from znode /hbase/unassigned/e9d1ea1a8999939667d847817f3fba26; data=region=tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26., state=RS_ZK_REGION_CLOSED, servername=vesta.apache.org,56523,1342962143399, createTime=1342962150260, payload.length=0&lt;br/&gt;
2012-07-22 13:02:30,279 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeDeleted, state=SyncConnected, path=/hbase/unassigned/e9d1ea1a8999939667d847817f3fba26&lt;br/&gt;
2012-07-22 13:02:30,279 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_CLOSE_REGION-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(521): master:55921-0x138aec80e530000 Successfully deleted unassigned node for region e9d1ea1a8999939667d847817f3fba26 in expected state RS_ZK_REGION_CLOSED&lt;br/&gt;
2012-07-22 13:02:30,279 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; master.AssignmentManager(1191): The znode of region tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. has been deleted.&lt;br/&gt;
2012-07-22 13:02:30,279 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(262): master:55921-0x138aec80e530000 Received ZooKeeper Event, type=NodeChildrenChanged, state=SyncConnected, path=/hbase/unassigned&lt;br/&gt;
2012-07-22 13:02:30,299 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; handler.DisableTableHandler(149): Disabled table is done=true&lt;br/&gt;
2012-07-22 13:02:31,244 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0x1fd9b49-0x138aec80e530005 Retrieved 6 byte(s) of data from znode /hbase/table/tableB; data=PBUF\x08\x01&lt;br/&gt;
2012-07-22 13:02:31,244 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; client.HBaseAdmin(840): Disabled tableB&lt;br/&gt;
2012-07-22 13:02:31,245 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-137&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1142): hconnection 0x1fd9b49-0x138aec80e530005 Retrieved 6 byte(s) of data from znode /hbase/table/tableB; data=PBUF\x08\x01&lt;br/&gt;
2012-07-22 13:02:31,248 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;IPC Server handler 2 on 55921&amp;#93;&lt;/span&gt; client.ClientScanner(94): Creating scanner over .META. starting at key &apos;tableB,,&apos;&lt;br/&gt;
2012-07-22 13:02:31,248 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;IPC Server handler 2 on 55921&amp;#93;&lt;/span&gt; client.ClientScanner(205): Advancing internal scanner to startKey at &apos;tableB,,&apos;&lt;br/&gt;
2012-07-22 13:02:31,254 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; handler.TableEventHandler(95): Handling table operation C_M_DELETE_TABLE on table tableB&lt;br/&gt;
2012-07-22 13:02:31,254 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; client.ClientScanner(94): Creating scanner over .META. starting at key &apos;tableB,,&apos;&lt;br/&gt;
2012-07-22 13:02:31,254 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; client.ClientScanner(205): Advancing internal scanner to startKey at &apos;tableB,,&apos;&lt;br/&gt;
2012-07-22 13:02:31,258 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; client.ClientScanner(192): Finished with scanning at &lt;/p&gt;&lt;/div&gt;
&lt;p&gt;2012-07-22 13:02:31,258 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; handler.DeleteTableHandler(75): Deleting region tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. from META and FS&lt;br/&gt;
2012-07-22 13:02:31,264 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; catalog.MetaEditor(278): Deleted region tableB,,1342962149177.e9d1ea1a8999939667d847817f3fba26. from META&lt;br/&gt;
2012-07-22 13:02:31,265 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; backup.HFileArchiver(91): ARCHIVING region &lt;a href=&quot;file:/tmp/hbase-hudson/hbase/tableB/e9d1ea1a8999939667d847817f3fba26&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/tmp/hbase-hudson/hbase/tableB/e9d1ea1a8999939667d847817f3fba26&lt;/a&gt;&lt;br/&gt;
2012-07-22 13:02:31,266 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; backup.HFileArchiver(109): Have an archive directory, preparing to move files&lt;br/&gt;
2012-07-22 13:02:31,267 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_TABLE_OPERATIONS-vesta.apache.org,55921,1342962143091-0&amp;#93;&lt;/span&gt; executor.EventHandler(198): Caught throwable while processing event C_M_DELETE_TABLE&lt;br/&gt;
java.lang.IllegalArgumentException: Wrong FS: &lt;a href=&quot;file:/tmp/hbase-hudson/hbase/tableB/e9d1ea1a8999939667d847817f3fba26&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:/tmp/hbase-hudson/hbase/tableB/e9d1ea1a8999939667d847817f3fba26&lt;/a&gt;, expected: hdfs://localhost:52085&lt;br/&gt;
	at org.apache.hadoop.fs.FileSystem.checkPath(FileSystem.java:551)&lt;br/&gt;
	at org.apache.hadoop.hdfs.DistributedFileSystem.getPathName(DistributedFileSystem.java:166)&lt;br/&gt;
	at org.apache.hadoop.hdfs.DistributedFileSystem.listStatus(DistributedFileSystem.java:358)&lt;br/&gt;
	at org.apache.hadoop.fs.FileSystem.listStatus(FileSystem.java:1279)&lt;br/&gt;
	at org.apache.hadoop.fs.FileSystem.listStatus(FileSystem.java:1319)&lt;br/&gt;
	at org.apache.hadoop.hbase.util.FSUtils.listStatus(FSUtils.java:1111)&lt;br/&gt;
	at org.apache.hadoop.hbase.backup.HFileArchiver.archiveRegion(HFileArchiver.java:122)&lt;br/&gt;
	at org.apache.hadoop.hbase.backup.HFileArchiver.archiveRegion(HFileArchiver.java:72)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Doesn&apos;t seem too bad to fix. I&apos;ll post another patch up that solves both.&lt;/p&gt;</comment>
                            <comment id="13420233" author="zhihyu@ebaysf.com" created="Sun, 22 Jul 2012 16:33:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;we don&apos;t have to worry about interaction with the TTLCleaner.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Users may choose to enable the combination of cleaners shown in the current TestZooKeeperTableArchiveClient.&lt;br/&gt;
We should verify that this combination works.&lt;/p&gt;

&lt;p&gt;From &lt;a href=&quot;https://builds.apache.org/view/G-L/view/HBase/job/HBase-TRUNK-on-Hadoop-2.0.0/lastCompletedBuild/testReport/org.apache.hadoop.hbase.backup.example/TestZooKeeperTableArchiveClient/testMultipleTables/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/G-L/view/HBase/job/HBase-TRUNK-on-Hadoop-2.0.0/lastCompletedBuild/testReport/org.apache.hadoop.hbase.backup.example/TestZooKeeperTableArchiveClient/testMultipleTables/&lt;/a&gt;, there is no NPE.&lt;/p&gt;

&lt;p&gt;I used the following command to run the test:&lt;/p&gt;

&lt;p&gt;mvn clean -Dhadoop.profile=2.0 test -Dtest=TestZooKeeperTableArchiveClient#testMultipleTables&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Failed tests:   testMultipleTables(org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient): Archived HFiles should have gotten deleted, but didn&apos;t
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The failure was due to IllegalArgumentException shown above.&lt;/p&gt;</comment>
                            <comment id="13420235" author="jesse_yates" created="Sun, 22 Jul 2012 16:41:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;The failure was due to IllegalArgumentException shown above.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, it seems to be breaking all the tests. Its really odd that HDFS goes to the DistributedFileSystem to do the listStatus when its a local filesystem - seems wrong.&lt;/p&gt;</comment>
                            <comment id="13420237" author="zhihyu@ebaysf.com" created="Sun, 22 Jul 2012 16:49:53 +0000"  >&lt;p&gt;Could this be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6403&quot; title=&quot;RegionCoprocessorHost provides empty config when loading a coprocessor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6403&quot;&gt;HBASE-6403&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="13420250" author="jesse_yates" created="Sun, 22 Jul 2012 17:41:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;Could this be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6403&quot; title=&quot;RegionCoprocessorHost provides empty config when loading a coprocessor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6403&quot;&gt;HBASE-6403&lt;/a&gt; ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Similar, but not exactly the same. In short, the FS has a configuration, but that configuration isn&apos;t correctly specifying the filesystem (from the MasterFileSystem). Working on a fix now.&lt;/p&gt;</comment>
                            <comment id="13420266" author="jesse_yates" created="Sun, 22 Jul 2012 18:28:51 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Users may choose to enable the combination of cleaners shown in the current TestZooKeeperTableArchiveClient.&lt;br/&gt;
We should verify that this combination works.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d argue that we have verified by inspection. Using the time-based waiting on the cluster tends to lead to flapping tests (e.g. the original error), which is bad. Because the cleaner chain works, the TTL cleaner works (both of which are tested) and the zk archiver cleaner works, we can then say that they work together.&lt;/p&gt;</comment>
                            <comment id="13420267" author="jesse_yates" created="Sun, 22 Jul 2012 18:31:14 +0000"  >&lt;p&gt;Attaching updated version. Tested all the failing tests from the hadoop-2.0 (which is a proper superset of the failures from the hadoop-1.0 run) run on both versions of hadoop and passed locally.&lt;/p&gt;</comment>
                            <comment id="13420269" author="hadoopqa" created="Sun, 22 Jul 2012 18:53:07 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12537517/java_HBASE-5547.addendum-v1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12537517/java_HBASE-5547.addendum-v1&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 14 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestCatalogJanitor&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2425//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13420271" author="lhofhansl" created="Sun, 22 Jul 2012 19:02:56 +0000"  >&lt;p&gt;Addendum v1 looks good to me. I also agree that we should remove the TTL cleaner when the ZK cleaner is tested.&lt;br/&gt;
Might be prudent to add an &quot;integration test&quot; that uses both in some manner.&lt;/p&gt;

&lt;p&gt;One question looking at the addendum: When would the passed configuration to archiveRegion be different from fs.getConfiguration()? It seems that should not happen; if it did other confusion might arise.&lt;/p&gt;</comment>
                            <comment id="13420272" author="jesse_yates" created="Sun, 22 Jul 2012 19:05:02 +0000"  >&lt;blockquote&gt;
&lt;p&gt;When would the passed configuration to archiveRegion be different from fs.getConfiguration()? It seems that should not happen; if it did other confusion might arise.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The reason the error was happening was the conf in fs.getConf() didn&apos;t have the fs set correctly, so it was going to the local filesystem, but the FS we were deleting from was a DistributedFileSystem. The passed in conf is now from an &apos;authorative&apos; source (the HMaster).&lt;/p&gt;

&lt;p&gt;Didn&apos;t run the catalogjanitor test...working on fix.&lt;/p&gt;</comment>
                            <comment id="13420275" author="lhofhansl" created="Sun, 22 Jul 2012 19:09:43 +0000"  >&lt;p&gt;I see... Seems something else is wrong then, I think. Don&apos;t have to fix it here, just something to keep in mind.&lt;/p&gt;</comment>
                            <comment id="13420279" author="jesse_yates" created="Sun, 22 Jul 2012 19:13:43 +0000"  >&lt;p&gt;I&apos;d rather have the fix in, then revert as necessary when we find the root cause (just in case this is &apos;expected&apos; behavior. Particularly given the occasional oddness between hdfs-1.X and 2.x., hack it to fix the build and then fix it &apos;right&apos; later seems ok.&lt;/p&gt;</comment>
                            <comment id="13420280" author="jesse_yates" created="Sun, 22 Jul 2012 19:19:02 +0000"  >&lt;p&gt;oh, wait, spent the two minutes to RTFS and realized that, when calling path#getFileSystem(conf), if there is no scheme for the path (an unqualified path), it tries to make a filesystem object from the configuration using the default URI, which if it isn&apos;t set, uses &lt;a href=&quot;file:///&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///&lt;/a&gt; (see FileSystem.java:131, hadoop-1.0.3).&lt;/p&gt;

&lt;p&gt;Guess we need to make sure that the fileSystem sets the default URI for its configuration. &lt;/p&gt;

&lt;p&gt;Should I file another ticket or just roll the fix in here?&lt;/p&gt;
</comment>
                            <comment id="13420284" author="lhofhansl" created="Sun, 22 Jul 2012 19:27:07 +0000"  >&lt;p&gt;Yeah, separate ticket.&lt;br/&gt;
Should we commit v1 as is now to get most of the tests working again and then one last addendum to fix the catalog janitor test?&lt;/p&gt;</comment>
                            <comment id="13420285" author="jesse_yates" created="Sun, 22 Jul 2012 19:28:54 +0000"  >&lt;p&gt;The catalog janitor is just one more line. I&apos;ll post a new addendum momentarily.&lt;/p&gt;</comment>
                            <comment id="13420293" author="zhihyu@ebaysf.com" created="Sun, 22 Jul 2012 19:42:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;Because the cleaner chain works, the TTL cleaner works (both of which are tested) and the zk archiver cleaner works, we can then say that they work together.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If some user encounters the scenario shown in existing TestZooKeeperTableArchiveClient#testMultipleTables and asked us on mailing list, can we go with the above answer ?&lt;/p&gt;</comment>
                            <comment id="13420296" author="jesse_yates" created="Sun, 22 Jul 2012 19:46:03 +0000"  >&lt;p&gt;@Ted: yeah. In the worst case, the data is kept around for an extra ttl (because that&apos;s how the cleaner works), so at worst they have the reference file for another 5-10 mins (depending on defaults).&lt;/p&gt;</comment>
                            <comment id="13420305" author="zhihyu@ebaysf.com" created="Sun, 22 Jul 2012 19:55:40 +0000"  >&lt;p&gt;If I keep the cleaner in addendum v1, testMultipleTables failed at the following assertion:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    assertFalse(fs.exists(otherStoreArchive));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13420310" author="jesse_yates" created="Sun, 22 Jul 2012 20:08:34 +0000"  >&lt;p&gt;@Ted yes, the sleeps for the ttl cleaner were also removed, which probably caused the error. Give me a little bit and I&apos;ll post an addendum that:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;removes the TLL cleaner from the primary ZKTableArchiver test&lt;/li&gt;
	&lt;li&gt;adds a test that just tests the interaction between the ZKTableArchiver and the TTLCleaner&lt;/li&gt;
	&lt;li&gt;fixes the fs scheme for all tests (general things like avro server and the catalogjanitor)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And I&apos;ll file another ticket to fix the fs configuration/rootdir stuff from the master.&lt;/p&gt;

&lt;p&gt;Did I miss anything?&lt;/p&gt;</comment>
                            <comment id="13420312" author="lhofhansl" created="Sun, 22 Jul 2012 20:09:11 +0000"  >&lt;p&gt;@Ted: The two cleaners should be tested in isolation. That&apos;s what &quot;unit&quot; tests are all about.&lt;/p&gt;

&lt;p&gt;We can have an additional test that verifies that the cleaners work together (which just means that if one cleaner decides the file needs to be kept it will be kept around). Let&apos;s do that in a separate jira.&lt;/p&gt;</comment>
                            <comment id="13420329" author="jesse_yates" created="Sun, 22 Jul 2012 20:59:07 +0000"  >&lt;p&gt;Attached fix for the fs scheme to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6441&quot; title=&quot;MasterFS doesn&amp;#39;t set scheme for internal FileSystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6441&quot;&gt;&lt;del&gt;HBASE-6441&lt;/del&gt;&lt;/a&gt;. Seems to fix the hadoop-2.0 test problem. Working on simpler version of addendum.v1 that just handles the multipleTests issue and formatting.&lt;/p&gt;</comment>
                            <comment id="13420333" author="jesse_yates" created="Sun, 22 Jul 2012 21:18:09 +0000"  >&lt;p&gt;Simpler version of v2 that just removes the TTL cleaner from the ZKARchiveClient test. Requires &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6441&quot; title=&quot;MasterFS doesn&amp;#39;t set scheme for internal FileSystem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6441&quot;&gt;&lt;del&gt;HBASE-6441&lt;/del&gt;&lt;/a&gt; to fix all the broken tests on this ticket (and might not apply cleanly without 6441, though I haven&apos;t tried).&lt;/p&gt;</comment>
                            <comment id="13420349" author="hadoopqa" created="Sun, 22 Jul 2012 22:12:38 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12537526/java_HBASE-5547.addendum-v2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12537526/java_HBASE-5547.addendum-v2&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 14 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13420350" author="zhihyu@ebaysf.com" created="Sun, 22 Jul 2012 22:15:22 +0000"  >&lt;p&gt;From &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//testReport/:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2429//testReport/:&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Running org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 238.611 sec
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think TestZooKeeperTableArchiveClient should be categorized as large test.&lt;/p&gt;</comment>
                            <comment id="13420418" author="zhihyu@ebaysf.com" created="Mon, 23 Jul 2012 04:15:16 +0000"  >&lt;p&gt;Addendum v3 is based on v2 and changes TestZooKeeperTableArchiveClient to LargeTest.&lt;/p&gt;</comment>
                            <comment id="13420419" author="jesse_yates" created="Mon, 23 Jul 2012 04:16:09 +0000"  >&lt;p&gt;Sounds good to me.&lt;/p&gt;</comment>
                            <comment id="13420423" author="lhofhansl" created="Mon, 23 Jul 2012 04:38:13 +0000"  >&lt;p&gt;Addendum v3 looks good to me. I&apos;m happy to commit, unless you would like to, Ted.&lt;/p&gt;</comment>
                            <comment id="13420425" author="zhihyu@ebaysf.com" created="Mon, 23 Jul 2012 04:40:46 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
Go ahead.&lt;/p&gt;</comment>
                            <comment id="13420427" author="lhofhansl" created="Mon, 23 Jul 2012 04:45:04 +0000"  >&lt;p&gt;Done. Should we file an extra jira and a cleaner chain test?&lt;/p&gt;</comment>
                            <comment id="13420429" author="zhihyu@ebaysf.com" created="Mon, 23 Jul 2012 04:50:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6442&quot; title=&quot;Add test for archiving/cleaning across multiple tables where some tables are retained and others aren&amp;#39;t&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6442&quot;&gt;HBASE-6442&lt;/a&gt; has been filed as a sub-task of this JIRA.&lt;br/&gt;
Feel free to either put detail there or add new task(s).&lt;/p&gt;</comment>
                            <comment id="13420434" author="hadoopqa" created="Mon, 23 Jul 2012 05:09:55 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12537542/5547.addendum-v3&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12537542/5547.addendum-v3&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 14 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2431//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13420449" author="hudson" created="Mon, 23 Jul 2012 05:47:21 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3162 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3162/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3162/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt; Addendum (Jesse and Ted) (Revision 1364493)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/TableHFileArchiveTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13420574" author="hudson" created="Mon, 23 Jul 2012 11:39:58 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #106 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/106/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/106/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt; Addendum (Jesse and Ted) (Revision 1364493)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/backup/example/TableHFileArchiveTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/backup/example/TestZooKeeperTableArchiveClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13424007" author="zhihyu@ebaysf.com" created="Fri, 27 Jul 2012 17:50:23 +0000"  >&lt;p&gt;Hopefully this is the last addendum &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13424027" author="jesse_yates" created="Fri, 27 Jul 2012 18:11:29 +0000"  >&lt;p&gt;@Ted how much worse in terms of NN overhead would it be to check if the file still exists when not deleted and comment as such? It seems a little excessive for just logging, but it would be nice.&lt;/p&gt;</comment>
                            <comment id="13424051" author="hadoopqa" created="Fri, 27 Jul 2012 18:41:13 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12538184/5547-addendum-v4.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12538184/5547-addendum-v4.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 5 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2447//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13424083" author="zhihyu@ebaysf.com" created="Fri, 27 Jul 2012 19:17:44 +0000"  >&lt;p&gt;If you want to add an extra check for file existence when fs.delete() returns false, that should be done in a sub-task.&lt;/p&gt;</comment>
                            <comment id="13424088" author="zhihyu@ebaysf.com" created="Fri, 27 Jul 2012 19:20:52 +0000"  >&lt;p&gt;Addendum v4 integrated to trunk.&lt;/p&gt;</comment>
                            <comment id="13424138" author="hudson" created="Fri, 27 Jul 2012 20:48:38 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3178 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3178/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3178/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt; Don&apos;t delete HFiles when in &quot;backup mode&quot;, addendum fixes check for fs.delete() (Revision 1366510)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13424218" author="hudson" created="Fri, 27 Jul 2012 23:39:25 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #113 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/113/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/113/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt; Don&apos;t delete HFiles when in &quot;backup mode&quot;, addendum fixes check for fs.delete() (Revision 1366510)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13441591" author="lhofhansl" created="Fri, 24 Aug 2012 23:18:10 +0000"  >&lt;p&gt;@Jesse: Can you make a combined 0.94 patch?&lt;/p&gt;</comment>
                            <comment id="13444501" author="lhofhansl" created="Wed, 29 Aug 2012 22:42:09 +0000"  >&lt;p&gt;Talked to Jesse. Moving to 0.94.3&lt;/p&gt;</comment>
                            <comment id="13447408" author="mbertozzi" created="Mon, 3 Sep 2012 20:44:32 +0000"  >&lt;p&gt;Can we add preChore() and postChore() to the FileCleanerDelegate, called in the beginning/end of CleanerChore.chore()?&lt;br/&gt;
Will be useful move TimeToLiveHFileCleaner.instantiateFS() and SnapshotCleanerUtil.refreshCache() there.&lt;/p&gt;</comment>
                            <comment id="13447854" author="jesse_yates" created="Tue, 4 Sep 2012 17:53:03 +0000"  >&lt;p&gt;@Matteo - TimeToLiveHFileCleaner.instantiateFS() definitely shouldn&apos;t be in a pre/post hook for chore() - you only want to instantiate the FS once. WRT refreshCache() as a use-case, that seems viable, but probably should be something that a subclass handles with its own hooks (and for refreshCache in particular, you wouldn&apos;t want to run it everytime anyways, making putting it in pre/post a little tricky).&lt;/p&gt;

&lt;p&gt;If you still think its worth doing, want to file a new ticket and we can move discussion there?&lt;/p&gt;</comment>
                            <comment id="13455985" author="jesse_yates" created="Fri, 14 Sep 2012 17:57:31 +0000"  >&lt;p&gt;Attaching patch for the 0.94 backport. I dropped support for the ZooKeeperTableArchive client given that is (1) just an example, (2) has a notoriously flakey test in trunk, (3) as can example can be found in trunk for interested parties.&lt;/p&gt;</comment>
                            <comment id="13455986" author="jesse_yates" created="Fri, 14 Sep 2012 17:58:35 +0000"  >&lt;p&gt;Also, ran the added tests and they passed locally. However, it did take a slight tweak to the pom since jettison couldn&apos;t be found  - had to add it to the pom to get things to compile, though I didn&apos;t change any of those things.&lt;/p&gt;</comment>
                            <comment id="13455990" author="hadoopqa" created="Fri, 14 Sep 2012 18:03:02 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12545182/hbase-5547-0.94-backport-v0.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12545182/hbase-5547-0.94-backport-v0.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 20 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2872//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2872//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13456276" author="yuzhihong@gmail.com" created="Sat, 15 Sep 2012 01:22:22 +0000"  >&lt;p&gt;Trunk patch was integrated in July.&lt;br/&gt;
According to Todd, we shouldn&apos;t have kept this issue open for so long.&lt;br/&gt;
Please open a separate issue for backporting. Actually I don&apos;t think this is a small feature.&lt;/p&gt;

&lt;p&gt;We should also iron out flaky tests in trunk.&lt;br/&gt;
In build #3334, I saw:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Failed tests:   testHFileCleaning(org.apache.hadoop.hbase.master.cleaner.TestHFileCleaner): expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13456287" author="jesse_yates" created="Sat, 15 Sep 2012 02:19:29 +0000"  >&lt;p&gt;@Ted  - yeah, I was thinking the same thing about another ticket when I posted, but figured I&apos;d just follow iron-hand (Lars) on this one; I&apos;ll it move to a new jira. Agree that we should work out the flaky tests too.&lt;/p&gt;</comment>
                            <comment id="13456304" author="lhofhansl" created="Sat, 15 Sep 2012 04:21:05 +0000"  >&lt;p&gt;It&apos;s not a small feature, but it mostly extra code, and it follows a know model we have for the HLogs, and I would consider this an safety feature.&lt;/p&gt;

&lt;p&gt;If there&apos;re concerns about this going into 0.94 we should discuss.&lt;/p&gt;

&lt;p&gt;I removed the 0.94 tag, and hence this can now be resolved.&lt;/p&gt;</comment>
                            <comment id="13456306" author="lhofhansl" created="Sat, 15 Sep 2012 04:23:18 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6796&quot; title=&quot;Backport HBASE-5547, Don&amp;#39;t delete HFiles in backup mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6796&quot;&gt;&lt;del&gt;HBASE-6796&lt;/del&gt;&lt;/a&gt; for backporting.&lt;/p&gt;</comment>
                            <comment id="13489093" author="hudson" created="Thu, 1 Nov 2012 22:42:24 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #565 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/565/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/565/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6796&quot; title=&quot;Backport HBASE-5547, Don&amp;#39;t delete HFiles in backup mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6796&quot;&gt;&lt;del&gt;HBASE-6796&lt;/del&gt;&lt;/a&gt; Backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;, Don&apos;t delete HFiles in backup mode. (Jesse Yates) (Revision 1404762)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/BaseConfigurable.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/Chore.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/backup&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/backup/HFileArchiver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/LogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/LogCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/TimeToLiveLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/BaseHFileCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/BaseLogCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/FileCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/HFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/LogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/TimeToLiveHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/TimeToLiveLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/resources/hbase-default.xml&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/backup&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/backup/TestHFileArchiving.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestLogsCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/cleaner&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/cleaner/TestCleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/cleaner/TestHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/cleaner/TestLogsCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/CheckedArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/util/TestFSTableDescriptors.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/util/TestHFileArchiveUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13490364" author="hudson" created="Mon, 5 Nov 2012 01:35:34 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #9 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/9/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/9/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6796&quot; title=&quot;Backport HBASE-5547, Don&amp;#39;t delete HFiles in backup mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6796&quot;&gt;&lt;del&gt;HBASE-6796&lt;/del&gt;&lt;/a&gt; Backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5547&quot; title=&quot;Don&amp;#39;t delete HFiles when in &amp;quot;backup mode&amp;quot;&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5547&quot;&gt;&lt;del&gt;HBASE-5547&lt;/del&gt;&lt;/a&gt;, Don&apos;t delete HFiles in backup mode. (Jesse Yates) (Revision 1404762)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/BaseConfigurable.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/Chore.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/backup&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/backup/HFileArchiver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/CatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/LogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/LogCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/TimeToLiveLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/BaseHFileCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/BaseLogCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/CleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/FileCleanerDelegate.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/HFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/LogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/TimeToLiveHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/cleaner/TimeToLiveLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/HFileArchiveUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/resources/hbase-default.xml&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/backup&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/backup/TestHFileArchiving.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestLogsCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/cleaner&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/cleaner/TestCleanerChore.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/cleaner/TestHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/cleaner/TestLogsCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/CheckedArchivingHFileCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/util/HFileArchiveTestingUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/util/TestFSTableDescriptors.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/util/TestHFileArchiveUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13490464" author="jesse_yates" created="Mon, 5 Nov 2012 05:30:07 +0000"  >&lt;p&gt;Looks like this was a spurious notification - it just picked up on the jira number in the title of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6796&quot; title=&quot;Backport HBASE-5547, Don&amp;#39;t delete HFiles in backup mode.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6796&quot;&gt;&lt;del&gt;HBASE-6796&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13775258" author="stack" created="Mon, 23 Sep 2013 18:31:06 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12556488">HBASE-6055</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12599779">HBASE-6441</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12560469">HBASE-6205</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12556488">HBASE-6055</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12607749">HBASE-6796</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12385270">HBASE-50</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12538184" name="5547-addendum-v4.txt" size="742" author="zhihyu@ebaysf.com" created="Fri, 27 Jul 2012 17:50:23 +0000"/>
                            <attachment id="12536280" name="5547-v12.txt" size="188378" author="zhihyu@ebaysf.com" created="Thu, 12 Jul 2012 20:46:25 +0000"/>
                            <attachment id="12537240" name="5547-v16.txt" size="200958" author="zhihyu@ebaysf.com" created="Thu, 19 Jul 2012 20:18:40 +0000"/>
                            <attachment id="12537542" name="5547.addendum-v3" size="7035" author="zhihyu@ebaysf.com" created="Mon, 23 Jul 2012 04:15:16 +0000"/>
                            <attachment id="12532763" name="hbase-5447-v8.patch" size="172290" author="jesse_yates" created="Wed, 20 Jun 2012 20:53:38 +0000"/>
                            <attachment id="12532749" name="hbase-5447-v8.patch" size="171589" author="zhihyu@ebaysf.com" created="Wed, 20 Jun 2012 19:48:19 +0000"/>
                            <attachment id="12545182" name="hbase-5547-0.94-backport-v0.patch" size="150428" author="jesse_yates" created="Fri, 14 Sep 2012 17:57:31 +0000"/>
                            <attachment id="12534016" name="hbase-5547-v9.patch" size="189585" author="jesse_yates" created="Fri, 29 Jun 2012 17:54:12 +0000"/>
                            <attachment id="12537478" name="java_HBASE-5547.addendum" size="7013" author="jesse_yates" created="Sun, 22 Jul 2012 06:39:49 +0000"/>
                            <attachment id="12537517" name="java_HBASE-5547.addendum-v1" size="13421" author="jesse_yates" created="Sun, 22 Jul 2012 18:31:14 +0000"/>
                            <attachment id="12537526" name="java_HBASE-5547.addendum-v2" size="7013" author="jesse_yates" created="Sun, 22 Jul 2012 21:18:09 +0000"/>
                            <attachment id="12536901" name="java_HBASE-5547_v13.patch" size="194442" author="jesse_yates" created="Tue, 17 Jul 2012 22:46:15 +0000"/>
                            <attachment id="12537114" name="java_HBASE-5547_v14.patch" size="198966" author="jesse_yates" created="Thu, 19 Jul 2012 01:49:42 +0000"/>
                            <attachment id="12537230" name="java_HBASE-5547_v15.patch" size="200921" author="zhihyu@ebaysf.com" created="Thu, 19 Jul 2012 19:09:47 +0000"/>
                            <attachment id="12525163" name="java_HBASE-5547_v4.patch" size="199581" author="jesse_yates" created="Tue, 1 May 2012 08:47:52 +0000"/>
                            <attachment id="12525196" name="java_HBASE-5547_v5.patch" size="199622" author="jesse_yates" created="Tue, 1 May 2012 19:01:12 +0000"/>
                            <attachment id="12525228" name="java_HBASE-5547_v6.patch" size="199724" author="jesse_yates" created="Tue, 1 May 2012 22:01:01 +0000"/>
                            <attachment id="12526422" name="java_HBASE-5547_v7.patch" size="165746" author="jesse_yates" created="Thu, 10 May 2012 21:11:31 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12599780">HBASE-6442</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>18.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 25 Mar 2012 16:43:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230957</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0e547:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>80591</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>All HFiles are now automatically archived to the configured &amp;quot;hbase.table.archive.directory&amp;quot;. HFiles are cleaned similarly to HLogs - a cleaner delegate chain that is instantiated as per the configured classes. Similar to hlog cleaners, a TimeToLiveHFileCleaner is used by default, and specified under the &amp;quot;hbase.master.hfilecleaner.plugins&amp;quot; configuration key.&lt;br/&gt;
&lt;br/&gt;
In unifying the two cleaner interfaces, the new configuration parameter to use the TimeToLiveHLogCleaner is:&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;lt;property&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;name&amp;gt;hbase.master.logcleaner.plugins&amp;lt;/name&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;lt;value&amp;gt;org.apache.hadoop.hbase.master.cleaner.TimeToLiveLogCleaner&amp;lt;/value&amp;gt;&lt;br/&gt;
&amp;nbsp;&amp;lt;/property&amp;gt;&lt;br/&gt;
&lt;br/&gt;
It is still enabled by default, so nothing needs to be changed if you are not modifying the logcleaners.&lt;br/&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>