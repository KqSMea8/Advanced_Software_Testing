<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:11:36 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3604/HBASE-3604.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3604] Two region servers think that they own the same region: data loss</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3604</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I observed this on a 100 node cluster that is constantly doing about 500K ops/second.&lt;/p&gt;

&lt;p&gt;The region server on machine A was servicing IOs for a particular region. Then the machine went into a bad state where it is ping-able but not ssh-able. The master detected that there is a problem with machine A and reassigned the region to machine B. The regionserver on machine B opened the region and opened all the required HFiles for this region. After two hours, the NameNode received a delete request for one of the HFiles from machine A and happily renamed the file to HDFS-Trash. After another 3 hours or so, the regionserver on machine B tried to read contents from that HFile but failed because the file was renamed earlier. The region server on B in now stuck, and possible data loss. &lt;/p&gt;

&lt;p&gt;The problems stems from the fact that although the master-and-ZK reassigned the region, the old regionserver was not possibly dead.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12500419">HBASE-3604</key>
            <summary>Two region servers think that they own the same region: data loss</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="dhruba">dhruba borthakur</assignee>
                                    <reporter username="dhruba">dhruba borthakur</reporter>
                        <labels>
                    </labels>
                <created>Fri, 4 Mar 2011 11:30:44 +0000</created>
                <updated>Fri, 4 Mar 2011 19:02:58 +0000</updated>
                            <resolved>Fri, 4 Mar 2011 19:02:58 +0000</resolved>
                                    <version>0.90.0</version>
                                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13002551" author="dhruba" created="Fri, 4 Mar 2011 11:32:55 +0000"  >&lt;p&gt;I did see this in the master logs (at the time when it decided to reassign the region from A to B):&lt;/p&gt;

&lt;blockquote&gt;&lt;/blockquote&gt;
&lt;p&gt;java.io.IOException: Discovered orphan hlog after split. Maybe HRegionServer was not dead when we started&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.HLogSplitter.splitLog(HLogSplitter.java:290)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.HLogSplitter.splitLog(HLogSplitter.java:151)&lt;br/&gt;
at org.apache.hadoop.hbase.master.MasterFileSystem.splitLog(MasterFileSystem.java:193)&lt;br/&gt;
at org.apache.hadoop.hbase.master.handler.ServerShutdownHandler.process(ServerShutdownHandler.java:96)&lt;br/&gt;
at org.apache.hadoop.hbase.executor.EventHandler.run(EventHandler.java:151)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:619)&lt;br/&gt;
2011-03-03 05:09:55,551 INFO org.apache.hadoop.hbase.master.handler.ServerShutdownHandler: Reassigning 64 region(s) that pumahbase024.snc5.facebook.com,60020,1299034310798 was carrying (skipping 0 regions(s) that are already in transition)&lt;/p&gt;

&lt;p&gt;2011-03-03 05:09:55,588 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Assigning region XXXXs,aae1476e,1290555944175.c155464b43a3267c4a2778b769026775. to B.com,60020,1299034311241&lt;/p&gt;</comment>
                            <comment id="13002658" author="tlipcon" created="Fri, 4 Mar 2011 15:20:13 +0000"  >&lt;p&gt;Ramification of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2231&quot; title=&quot;Compaction events should be written to HLog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2231&quot;&gt;&lt;del&gt;HBASE-2231&lt;/del&gt;&lt;/a&gt; maybe?&lt;/p&gt;</comment>
                            <comment id="13002772" author="stack" created="Fri, 4 Mar 2011 18:40:04 +0000"  >&lt;p&gt;@Dhruba It&apos;d be interesting to look at server A logs if you ever get on to it.  Do you see logging of its expired zk session?  We should add verification of zk connection before doing any fs file move?  &lt;/p&gt;</comment>
                            <comment id="13002775" author="dhruba" created="Fri, 4 Mar 2011 18:44:58 +0000"  >&lt;p&gt;I have been trying to get into machine A since the last two days, but that machine has not yet been fixed, something real bad has happened to it.&lt;/p&gt;</comment>
                            <comment id="13002782" author="dhruba" created="Fri, 4 Mar 2011 19:02:58 +0000"  >&lt;p&gt;duplicate of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2231&quot; title=&quot;Compaction events should be written to HLog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2231&quot;&gt;&lt;del&gt;HBASE-2231&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12456510">HBASE-2231</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 Mar 2011 15:20:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26939</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 42 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hmzj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100986</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>