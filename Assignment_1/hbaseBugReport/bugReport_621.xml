<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:45:59 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-621/HBASE-621.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-621] Make MAX_VERSIONS work like TTL: In scans and gets, check MAX_VERSIONs setting and return that many only rather than wait on compaction</title>
                <link>https://issues.apache.org/jira/browse/HBASE-621</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-47&quot; title=&quot;option to set TTL for columns in hbase&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-47&quot;&gt;&lt;del&gt;HBASE-47&lt;/del&gt;&lt;/a&gt; added specification of TTL on cells.  The implementation checks cell timestamp against configured TTL before returning results scanning or getting.  You can also set the maximum versions of a cell to keep.  The maximum versions is not checked scanning or getting, only when we compact (We&apos;ll drop cells that are beyond the maximum version at compaction time).  This issue is about adding check for maximum versions to gets and scans so that if you ask for all versions but have configured the store to only keep 3 versions, though 4 may have been inserted, you&apos;ll currently get 4 returned (if compactions have not had a chance to run).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12395730">HBASE-621</key>
            <summary>Make MAX_VERSIONS work like TTL: In scans and gets, check MAX_VERSIONs setting and return that many only rather than wait on compaction</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 May 2008 17:28:46 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:15 +0000</updated>
                            <resolved>Tue, 20 May 2008 20:41:48 +0000</resolved>
                                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12597301" author="stack" created="Thu, 15 May 2008 22:34:18 +0000"  >&lt;p&gt;Adding it in for now.  Can bump it later if we have to.&lt;/p&gt;</comment>
                            <comment id="12598322" author="jdcryans" created="Tue, 20 May 2008 15:11:04 +0000"  >&lt;p&gt;Another problem with versions. Take a look at :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /**
   * Get the value &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the indicated HStoreKey.  Grab the target value and the 
   * previous &apos;numVersions-1&apos; values, as well.
   *
   * If &apos;numVersions&apos; is negative, the method returns all available versions.
   * @param key
   * @param numVersions &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of versions to fetch.  Must be &amp;gt; 0.
   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; values &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the specified versions
   * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
   */
  Cell[] get(HStoreKey key, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numVersions) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (numVersions &amp;lt;= 0) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of versions must be &amp;gt; 0&quot;&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If &apos;numVersions&apos;, it will throw a IllegalArgumentException and we will not get all versions. As recommended by Bryan, I will add a new constant like HConstants.ALL_VERSIONS = Integer.MAX_VALUE and change the comments.&lt;/p&gt;</comment>
                            <comment id="12598346" author="jdcryans" created="Tue, 20 May 2008 16:16:26 +0000"  >&lt;p&gt;I have been digging around in HStore and here is what I found that causes me problem or that I think should get someone&apos;s attention :&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack mentionned that this code around line 1250 will maybe need to change :&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (results.size() == numVersions) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; results.toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Cell[results.size()]);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I thought the same but by looking in Memcache we can see that the TTL problem is already handled :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ttl == HConstants.FOREVER ||
         now &amp;lt; itKey.getTimestamp() + ttl) {
     result.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Cell(tailMap.get(itKey), itKey.getTimestamp()));
 } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      victims.add(itKey);
...
&lt;span class=&quot;code-comment&quot;&gt;// Remove expired victims from the map.
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (HStoreKey v: victims)
  map.remove(v);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So I guess that it&apos;s ok to leave it like that. &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I was wondering where to put tests for this modification and I found that regionserver.TestCompaction tests conflicts with my modification. Have a look at :&lt;/li&gt;
&lt;/ul&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// Add more content.  Now there are about 5 versions of each column.
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// Default is that there only 3 (MAXVERSIONS) versions allowed per column.
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// Assert &amp;gt; 3 and then after compaction, &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; that only 3 versions
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// available.
&lt;/span&gt;    addContent(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HRegionIncommon(r), Bytes.toString(COLUMN_FAMILY));
    Cell[] cellValues = 
      r.get(STARTROW, COLUMN_FAMILY_TEXT, 100 /*Too many*/);
    &lt;span class=&quot;code-comment&quot;&gt;// Assert that I can get &amp;gt; 5 versions (Should be at least 5 in there).
&lt;/span&gt;    assertTrue(cellValues.length &amp;gt;= 5);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This now fails because it returns MAXVERSIONS versions. Any advices on how to handle the max version problem? Is there an easy way of changing it just for this test?&lt;/p&gt;

&lt;p&gt;Also, is TestCompaction a good place to test this jira? (since it seems it is already handled)&lt;/p&gt;</comment>
                            <comment id="12598362" author="stack" created="Tue, 20 May 2008 17:14:05 +0000"  >&lt;p&gt;Good on you for digging in JDC and figuring no need of same mod up in MemCache.&lt;/p&gt;

&lt;p&gt;Remove the assertion.  It depended on a broken supposition which you are fixing here.&lt;/p&gt;

&lt;p&gt;Regards where to slot in your test, if you can slot in your test in a place that makes sense, go for it &amp;#8211; especially if you can put it in in a place where the setup price has already been paid.  Otherwise, make a new test.&lt;/p&gt;</comment>
                            <comment id="12598443" author="jdcryans" created="Tue, 20 May 2008 20:10:34 +0000"  >&lt;p&gt;First working version.&lt;/p&gt;</comment>
                            <comment id="12598455" author="stack" created="Tue, 20 May 2008 20:41:48 +0000"  >&lt;p&gt;Committed after review and run of unit tests locally (TestMigrate is hanging sometimes... probably scanner issue I saw a few times up in eclipse).  Thanks for the patch Jean-Daniel.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12382411" name="hbase-621-v1.patch" size="4256" author="jdcryans" created="Tue, 20 May 2008 20:10:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 20 May 2008 15:11:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31785</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 31 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h8fj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98628</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>