<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:06:37 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9682/HBASE-9682.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9682] Bulk loading fails after ClassLoader is updated on OSGi client</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9682</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In an OSGi environment (felix) client, running with a bundled HBase (used bnd tool), after CL is updated - for instance when updating the client bundle without updating the HBase bundle, Algorithm class in HBase is a static enum and therefore it&apos;s configuration member still holds on to the old CL. This causes NPE when trying to bulk load using LoadIncrementalHFile.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12671250">HBASE-9682</key>
            <summary>Bulk loading fails after ClassLoader is updated on OSGi client</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="amitsela">Amit Sela</reporter>
                        <labels>
                    </labels>
                <created>Sun, 29 Sep 2013 08:05:10 +0000</created>
                <updated>Wed, 4 Dec 2013 10:08:27 +0000</updated>
                                            <version>0.94.2</version>
                    <version>0.94.12</version>
                                                    <component>Client</component>
                    <component>HFile</component>
                    <component>io</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13781300" author="amitsela" created="Sun, 29 Sep 2013 08:07:10 +0000"  >&lt;p&gt;Maybe consider adding a createConfiguration() method to Algorithm, instead of the configuration member. This way, the configuration is not cached with obsolete CL.&lt;/p&gt;</comment>
                            <comment id="13781360" author="amitsela" created="Sun, 29 Sep 2013 13:10:23 +0000"  >&lt;p&gt;This is the stack trace as I posted in the mailing list:&lt;br/&gt;
Caused by: java.lang.NullPointerException: null&lt;br/&gt;
	at org.apache.felix.framework.BundleRevisionImpl.getResourceLocal(BundleRevisionImpl.java:474)&lt;br/&gt;
	at org.apache.felix.framework.BundleWiringImpl.findClassOrResourceByDelegation(BundleWiringImpl.java:1432)&lt;br/&gt;
	at org.apache.felix.framework.BundleWiringImpl.getResourceByDelegation(BundleWiringImpl.java:1360)&lt;br/&gt;
	at org.apache.felix.framework.BundleWiringImpl$BundleClassLoader.getResource(BundleWiringImpl.java:2256)&lt;br/&gt;
	at org.apache.hadoop.conf.Configuration.getResource(Configuration.java:1002)&lt;br/&gt;
	at org.apache.hadoop.conf.Configuration.loadResource(Configuration.java:1156)&lt;br/&gt;
	at org.apache.hadoop.conf.Configuration.loadResources(Configuration.java:1112)&lt;br/&gt;
	at org.apache.hadoop.conf.Configuration.getProps(Configuration.java:1056)&lt;br/&gt;
	at org.apache.hadoop.conf.Configuration.get(Configuration.java:401)&lt;br/&gt;
	at org.apache.hadoop.conf.Configuration.getInt(Configuration.java:471)&lt;br/&gt;
	at org.apache.hadoop.io.compress.GzipCodec.createInputStream(GzipCodec.java:131)&lt;br/&gt;
	at org.apache.hadoop.hbase.io.hfile.Compression$Algorithm.createDecompressionStream(Compression.java:223)&lt;br/&gt;
	at org.apache.hadoop.hbase.io.hfile.HFileBlock$AbstractFSReader.decompress(HFileBlock.java:1392)&lt;br/&gt;
	at org.apache.hadoop.hbase.io.hfile.HFileBlock$FSReaderV2.readBlockDataInternal(HFileBlock.java:1897)&lt;br/&gt;
	at org.apache.hadoop.hbase.io.hfile.HFileBlock$FSReaderV2.readBlockData(HFileBlock.java:1637)&lt;br/&gt;
	at org.apache.hadoop.hbase.io.hfile.HFileBlock$AbstractFSReader$1.nextBlock(HFileBlock.java:1286)&lt;br/&gt;
	at org.apache.hadoop.hbase.io.hfile.HFileBlock$AbstractFSReader$1.nextBlockWithBlockType(HFileBlock.java:1294)&lt;br/&gt;
	at org.apache.hadoop.hbase.io.hfile.HFileReaderV2.&amp;lt;init&amp;gt;(HFileReaderV2.java:126)&lt;br/&gt;
	at org.apache.hadoop.hbase.io.hfile.HFile.pickReaderVersion(HFile.java:552)&lt;br/&gt;
	at org.apache.hadoop.hbase.io.hfile.HFile.createReaderWithEncoding(HFile.java:589)&lt;br/&gt;
	at org.apache.hadoop.hbase.io.hfile.HFile.createReader(HFile.java:603)&lt;br/&gt;
	at org.apache.hadoop.hbase.mapreduce.LoadIncrementalHFiles.groupOrSplit(LoadIncrementalHFiles.java:402)&lt;br/&gt;
	at org.apache.hadoop.hbase.mapreduce.LoadIncrementalHFiles$2.call(LoadIncrementalHFiles.java:323)&lt;br/&gt;
	at org.apache.hadoop.hbase.mapreduce.LoadIncrementalHFiles$2.call(LoadIncrementalHFiles.java:321)&lt;br/&gt;
	at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)&lt;br/&gt;
	at java.util.concurrent.FutureTask.run(FutureTask.java:166)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)&lt;/p&gt;</comment>
                            <comment id="13781378" author="amitsela" created="Sun, 29 Sep 2013 13:49:10 +0000"  >&lt;p&gt;One way to observe this bug is to add the following methods to Algorithm:&lt;br/&gt;
public Configuration createConfiguration() &lt;/p&gt;
{
        Configuration conf = new Configuration();
        conf.setBoolean(&quot;hadoop.native.lib&quot;, true);
        return conf;
    }
&lt;p&gt;public Configuration getConfiguration() &lt;/p&gt;
{
      return this.conf;
    }

&lt;p&gt;Now, running on OSGi client, you can print out the CLs returned by these two methods, they will return the same CL.&lt;br/&gt;
Update the client jar (touch is enough) and after it&apos;s updated, call these methods once more - getConfiguration will return the same CL as before (obsolete) while createConfiguration will return a different CL, new (valid) one.&lt;/p&gt;

&lt;p&gt;Maybe one solution could be using createConfiguration() instead of new Configuration(conf) in getCodec and losing Algorithm&apos;s configuration member ?&lt;/p&gt;</comment>
                            <comment id="13838787" author="amitsela" created="Wed, 4 Dec 2013 10:08:27 +0000"  >&lt;p&gt;Patch fixing the issue for HBase 0.94.12&lt;br/&gt;
I removed the Configuration member and added a createConfiguration method that creates a new Configuration (with the &quot;hadoop.native.lib&quot; boolean true)  per demand.&lt;br/&gt;
This way, there are no cached configuration with stale CL after bundle update (in OSGi client environment)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12616965" name="HBASE-9682.patch" size="2536" author="amitsela" created="Wed, 4 Dec 2013 10:08:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>350956</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1oifb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>351247</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>