<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:00:10 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8963/HBASE-8963.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8963] Add configuration option to skip HFile archiving</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8963</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently HFileArchiver is always called when a table is dropped or compacted.&lt;/p&gt;

&lt;p&gt;A configuration option (either global or per table) should be provided so that archiving can be skipped when table is deleted or compacted.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12658114">HBASE-8963</key>
            <summary>Add configuration option to skip HFile archiving</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="ted_yu">Ted Yu</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Jul 2013 21:08:02 +0000</created>
                <updated>Thu, 22 Oct 2015 00:03:48 +0000</updated>
                                                            <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="13710251" author="jesse_yates" created="Tue, 16 Jul 2013 21:10:37 +0000"  >&lt;p&gt;This seems reasonable... would certainly save a bit of CPU time and disk space. Would need to be careful though to ensure it doesn&apos;t conflict with snapshotting.&lt;/p&gt;</comment>
                            <comment id="13834305" author="apurtell" created="Wed, 27 Nov 2013 23:14:34 +0000"  >&lt;p&gt;No patch, moving out of 0.98. Put back if you feel otherwise.&lt;/p&gt;</comment>
                            <comment id="13933222" author="mbertozzi" created="Thu, 13 Mar 2014 13:17:39 +0000"  >&lt;p&gt;so, you are currently skipping the archive just for Delete Table? what about compactions and others?&lt;br/&gt;
I think that you should move the if (skipArchive) inside the archiver, since everyone is calling the archiver...&lt;br/&gt;
and the inside the archiver you check the &quot;skipArchive&quot; property.&lt;br/&gt;
In this way you don&apos;t have to put if (skipArchive) all around.&lt;/p&gt;</comment>
                            <comment id="13933274" author="hadoopqa" created="Thu, 13 Mar 2014 14:03:47 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12634422/HBASE-8963.trunk.v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12634422/HBASE-8963.trunk.v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12634422&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8968//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8968//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13933282" author="bharathv" created="Thu, 13 Mar 2014 14:09:23 +0000"  >&lt;p&gt; I wrote this patch just keeping the DeleteHandler in mind as I got confused by the jira description. It makes sense to move the skipArchive check to archiver makes more sense so that other components like compactors can use it too. Will upload a new patch with changes shortly. Thanks for your quick review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13933976" author="bharathv" created="Thu, 13 Mar 2014 20:08:39 +0000"  >&lt;p&gt;Attached v2 of the patch. This moves all the checks to the central code archiver. Had to make some changes in the archive() calls by adding the Configuration object and as a result, I changed the caller classes too, especially from compaction/ deletion. Add unitTests for table deletion with snapshots/file links. Tested compaction locally on my machine and confirmed that the code skips archives and deletes the storefiles directly (via debug logs).&lt;/p&gt;</comment>
                            <comment id="13933983" author="bharathv" created="Thu, 13 Mar 2014 20:12:46 +0000"  >&lt;p&gt;Please ignore v2. It includes some unintended changes. Added v3 of patch without them.&lt;/p&gt;</comment>
                            <comment id="13933987" author="yuzhihong@gmail.com" created="Thu, 13 Mar 2014 20:17:41 +0000"  >&lt;p&gt;I started reviewing patch v2 and saw patch v3 coming.&lt;br/&gt;
Here&apos;re my comments based on v2&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; archiveRegion(Configuration conf,FileSystem fs, Path rootdir, Path tableDir, Path regionDir)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;nit: leave a space following the comma between conf and FileSystem.&lt;/p&gt;

&lt;p&gt;For resolveAndArchiveFile(), please add javadoc for parameter conf.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      FileStatus currentStatus = fs.getFileStatus(currentFile.getPath());
+
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(conf.getBoolean(HFILE_SKIP_ARCHIVE_CONF, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)){
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;currentStatus is only used when the condition is true, move its assignment inside the if block.&lt;/p&gt;</comment>
                            <comment id="13934004" author="yuzhihong@gmail.com" created="Thu, 13 Mar 2014 20:29:17 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; HFILE_SKIP_ARCHIVE_CONF = &lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.hfile.skip.archive&quot;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should the constant be named HFILE_SKIP_ARCHIVE_CONF_KEY ? It is key to the new config, right ?&lt;/p&gt;

&lt;p&gt;For initCleaners(), null check on snapshotCleaner alone would be enough because both cleaners would be instantiated, right ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+              &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(fs.delete(currentFile.getPath())){
+                  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
+              }
+              &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;{
+                  LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempt to delete file &quot;&lt;/span&gt;+currentFile.getPath().getName()+&lt;span class=&quot;code-quote&quot;&gt;&quot; failed. Moving it to the archive.&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Suggest changing the log level to error.&lt;/p&gt;

&lt;p&gt;License header is needed for TestSkipArchiveTableDeleteHandler.java&lt;br/&gt;
In that file, indentation is not right - 2 spaces should be used for each indent.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        rs.close();
+        }&lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
+            rs.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;rs is closed twice, right ?&lt;/p&gt;

&lt;p&gt;Thanks for taking this JIRA.&lt;/p&gt;</comment>
                            <comment id="13934084" author="mbertozzi" created="Thu, 13 Mar 2014 21:19:00 +0000"  >&lt;p&gt;Is there a reason to hardcode the SnapshotHFileCleaner and the FileLinkCleaner and discard the others?&lt;br/&gt;
can&apos;t you reuse in some way CleanerChore.initCleanerChain(&quot;hbase.master.hfilecleaner.plugins&quot;)&lt;br/&gt;
just to make sure that people with its own cleaner doesn&apos;t lose their old files with the skip opt on&lt;/p&gt;</comment>
                            <comment id="13934305" author="hadoopqa" created="Thu, 13 Mar 2014 23:36:01 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12634534/HBASE-8963.trunk.v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12634534/HBASE-8963.trunk.v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12634534&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.1&lt;/font&gt;.  The patch compiles against the hadoop 1.1 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 release audit&lt;/font&gt;.  The applied patch generated 1 release audit warnings (more than the trunk&apos;s current 0 warnings).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +  public static boolean archiveRegion(Configuration conf,FileSystem fs, Path rootdir, Path tableDir, Path regionDir)&lt;br/&gt;
+  private static List&amp;lt;File&amp;gt; resolveAndArchive(Configuration conf, FileSystem fs, Path baseArchiveDir,&lt;br/&gt;
+  private static boolean resolveAndArchiveFile(Configuration conf, Path archiveDir, File currentFile,&lt;br/&gt;
+          if(snapshotCleaner.isFileDeletable(currentStatus) &amp;amp;&amp;amp; fileLinkCleaner.isFileDeletable(currentStatus)){&lt;br/&gt;
+              LOG.debug(&quot;Attempting to delete file without archiving :&quot;+currentFile.getPath().getName());&lt;br/&gt;
+                  LOG.debug(&quot;Attempt to delete file &quot;&lt;ins&gt;currentFile.getPath().getName()&lt;/ins&gt;&quot; failed. Moving it to the archive.&quot;);&lt;br/&gt;
+        // Delete the table, since skiparchive is set unnecessary hfiles created due to deletes are deleted&lt;br/&gt;
+        // Delete a few rows from the original table, for this test we delete all the rows starting with &apos;a&apos;.&lt;br/&gt;
+        cloneCount = getTableRowCount(new HTable(TEST_UTIL.getConfiguration(),Bytes.toBytes(TABLENAME3.toString()+&quot;.clone&quot;)));&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//testReport/&lt;/a&gt;&lt;br/&gt;
Release audit warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8976//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13934726" author="bharathv" created="Fri, 14 Mar 2014 07:54:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuzhihong%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yuzhihong@gmail.com&quot;&gt;Ted Yu&lt;/a&gt; Added v4 as per your comments&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt; I did it for 2 reasons&lt;/p&gt;

&lt;p&gt;1) All the archive cleaner plugins (except snapshot and hfilelink cleaner) are written assuming the hfile is already in archive . For example TimToLiveHFileCleaner which check if the ttl of the hfile &quot;inside the archive&quot; directory exceeds the configured timeout. That doesn&apos;t need to be run on the hfiles which are not yet archived and will always return true. Also any further custom implementation of users will expect the store files to be already in archive directory and would probably fail if we run the wholeCleanerChain&lt;/p&gt;

&lt;p&gt;2) Given this runs only when skipArchive is enabled, users are ok with these hfiles getting deleted and won&apos;t expect these hfiles to be checked via their custom cleaners. &lt;/p&gt;

&lt;p&gt;Are these assumptions valid?&lt;/p&gt;</comment>
                            <comment id="13934784" author="mbertozzi" created="Fri, 14 Mar 2014 08:49:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;All the archive cleaner plugins (except snapshot and hfilelink cleaner) are written assuming the hfile is already in archive .&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;What about the custom ones that the user has written, or the ones that we will write in the future?&lt;br/&gt;
I&apos;ll be the first to forget to update the archiver if I add a new cleaner like the snapshot one.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Given this runs only when skipArchive is enabled, users are ok with these hfiles getting deleted and won&apos;t expect these hfiles to be checked via their custom cleaners.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think users are ok to get unreferenced files deleted.&lt;br/&gt;
e.g. If I take a snapshot on the table and the delete the table, I want the snapshot to be sane.&lt;br/&gt;
Also this settings is global and not per table which means.. that you may just turn this on at some point in the future because your new table takes long time archiving... but you don&apos;t want to lose snapshots (or other files that your custom cleaner should keep around) for the other tables.&lt;/p&gt;</comment>
                            <comment id="13934815" author="hadoopqa" created="Fri, 14 Mar 2014 09:37:06 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12634669/HBASE-8963.trunk.v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12634669/HBASE-8963.trunk.v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12634669&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.1&lt;/font&gt;.  The patch compiles against the hadoop 1.1 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestHRegion&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestAdmin&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestHRegionBusyWait&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8989//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13935443" author="bharathv" created="Fri, 14 Mar 2014 18:52:08 +0000"  >&lt;p&gt;Added v5 addressing Matteo&apos;s comments. Now the code loads all the plugins specified by &quot;hbase.master.hfilecleaner.plugins&quot;. Had to make a minor change in the class BaseFileCleanerDelegate. Changed the method isFileDeletable() to public so that it can called easily using the base class. All its subclasses already implement it as public.&lt;/p&gt;</comment>
                            <comment id="13935462" author="hadoopqa" created="Fri, 14 Mar 2014 19:02:35 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12634791/HBASE-8963.trunk.v5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12634791/HBASE-8963.trunk.v5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12634791&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8999//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8999//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13935511" author="bharathv" created="Fri, 14 Mar 2014 19:31:24 +0000"  >&lt;p&gt;Not sure what the problem is. Uploading the patch again. v6 applies cleanly on my local installation.&lt;/p&gt;</comment>
                            <comment id="13935671" author="yuzhihong@gmail.com" created="Fri, 14 Mar 2014 21:25:06 +0000"  >&lt;p&gt;patch v6 looks good.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
+        }
+        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;{
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;nit: if you keep else keyword, it should be on the same line as }.&lt;/p&gt;</comment>
                            <comment id="13935676" author="hadoopqa" created="Fri, 14 Mar 2014 21:27:11 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12634807/HBASE-8963.trunk.v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12634807/HBASE-8963.trunk.v6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12634807&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.1&lt;/font&gt;.  The patch compiles against the hadoop 1.1 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestAdmin&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestReplicationSmallTests&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestRegionObserverInterface&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9001//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13936264" author="bharathv" created="Sat, 15 Mar 2014 18:07:30 +0000"  >&lt;p&gt;Attached v7 fixing the else positioning as per Ted&apos;s review. Regarding the test failures, I think its not related to this patch, they all pass on my local machine. Also the logs suggest timeouts while loading meta regions, should we fix them before proceeding further? I&apos;m not fully sure what the exact reason is.&lt;/p&gt;</comment>
                            <comment id="13936285" author="hadoopqa" created="Sat, 15 Mar 2014 19:58:10 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12634925/HBASE-8963.trunk.v7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12634925/HBASE-8963.trunk.v7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12634925&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.1&lt;/font&gt;.  The patch compiles against the hadoop 1.1 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13936336" author="yuzhihong@gmail.com" created="Sat, 15 Mar 2014 23:16:31 +0000"  >&lt;p&gt;If you compare &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015/artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015/artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt; (for this JIRA) with &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9015/artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9015/artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt; , you should be able to find the new findbugs warning.&lt;/p&gt;</comment>
                            <comment id="13937986" author="mbertozzi" created="Mon, 17 Mar 2014 16:29:15 +0000"  >&lt;p&gt;instead of admin.disableTable() + admin.deleteTable() you can use TEST_UTIL.deleteTable() that does both for you.&lt;/p&gt;

&lt;p&gt;getTableRowCount() exists already in TEST_UTIL.countRows(), there is also SnapshotTestingUtils.verifyRowCount(TEST_UTIL, tableName, expectedRows) that does the count + assert for you.&lt;/p&gt;

&lt;p&gt;nit on formatting: there are a couple of places like &quot;a,b, c&quot; and a couple of places with 4 spaces instead of 2 I think..&lt;/p&gt;

&lt;p&gt;test failures seems not related but there is a new report from findbug, you can find the details in the link above. &lt;/p&gt;

&lt;p&gt;other than that looks good to me, did you do some manual verification?&lt;br/&gt;
can you post the steps and the conf settings.&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="13940175" author="lhofhansl" created="Wed, 19 Mar 2014 05:05:01 +0000"  >&lt;p&gt;Would make more sense to me if this was a parameter to an individual table-drop operation rather than a global or table level configuration.&lt;/p&gt;</comment>
                            <comment id="13940431" author="jmspaggi" created="Wed, 19 Mar 2014 12:26:40 +0000"  >&lt;p&gt;I agree with Lars. Makes more sense to me too to have a parameter to drop table to allow skipping archiving instead of setting that at any required level.&lt;/p&gt;</comment>
                            <comment id="13940449" author="mbertozzi" created="Wed, 19 Mar 2014 13:15:26 +0000"  >&lt;p&gt;I don&apos;t think is a drop table argument, since the compaction will archive stuff anyway.&lt;br/&gt;
I like the global level property to have a general settings, but we should also have a table level option&lt;br/&gt;
something like create &apos;testtb&apos; &lt;/p&gt;
{SKIP_ARCHIVE = true}
&lt;p&gt; that will work on both compaction + delete&lt;/p&gt;</comment>
                            <comment id="13941142" author="enis" created="Wed, 19 Mar 2014 23:12:21 +0000"  >&lt;p&gt;I don&apos;t imagine anyone wanting to run with skip archive as a global config on production. I think we should not do the global config at all, but allow drop table to have an option to skip. Doesn&apos;t snapshots refer to files in the archive? If we do SKIP_ARCHIVE as a table property, the previous snapshots will be broken with compactions I guess. &lt;/p&gt;

&lt;p&gt;I think we should do a &quot;rm -rf&quot; kind of think in drop table. If the files are not referred, they are not moved to archive, but deleted instead. &lt;/p&gt;</comment>
                            <comment id="13941231" author="jmspaggi" created="Thu, 20 Mar 2014 00:18:22 +0000"  >&lt;p&gt;Worse case, can we do the 2 options? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13941232" author="mbertozzi" created="Thu, 20 Mar 2014 00:18:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t imagine anyone wanting to run with skip archive as a global config on production. I think we should not do the global config at all&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;What is the motivation? If you don&apos;t care about snapshots or other form of backup you can turn of the archiver&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Doesn&apos;t snapshots refer to files in the archive? If we do SKIP_ARCHIVE as a table property, the previous snapshots will be broken with compactions I guess.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No, if you have skipArchive on.. we must check anyway if the file is referenced by someone. And is exactly what this patch is doing. so if you have skipArchive true but the file is referenced by a snapshot it will be archived anyway.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think we should do a &quot;rm -rf&quot; kind of think in drop table. If the files are not referred, they are not moved to archive, but deleted instead.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was thinking at the table flag also to avoid stuff like &quot;echo &apos;drop_table&apos;, &apos;skip_archive&apos; | hbase shell&quot; executed by mistake.&lt;br/&gt;
since in that case if you want to switch from a table with skip archive false to true you have to do an alter, which it will have 0 cost since the table is already disabled and it will be only a master side operation.&lt;/p&gt;</comment>
                            <comment id="13941317" author="enis" created="Thu, 20 Mar 2014 02:11:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;What is the motivation? If you don&apos;t care about snapshots or other form of backup you can turn of the archiver&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think the archive for hfiles as similar to the fs thrash. Normally, you do not want to run with that. Adding a global config is unnecessary. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;so if you have skipArchive true but the file is referenced by a snapshot it will be archived anyway.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ok good. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I was thinking at the table flag also to avoid stuff like &quot;echo &apos;drop_table&apos;, &apos;skip_archive&apos; | hbase shell&quot; executed by mistake.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If you explicitly set skip_archive, it is assumed you know what you are doing. Requiring explicit alter is fine, but the feature won&apos;t be as usable i feel. &lt;/p&gt;</comment>
                            <comment id="13941345" author="bharathv" created="Thu, 20 Mar 2014 03:10:13 +0000"  >&lt;p&gt;Thanks for your comments everyone. It makes sense to add a per table config. Will write a patch for that.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; We run these files through all the configured cleaners, which checks all the back links/snapshots associated hfiles and deletes only if its valid. So that case is covered.&lt;/p&gt;

&lt;p&gt;The motivation for a global flag is probably if someone wants to apply it for all the tables and not go through the pain of setting it per table. They can override specific tables with &lt;/p&gt;
{SKIP_ARCHIVE = false}
&lt;p&gt; in which case, the global parameter isn&apos;t taken into consideration.&lt;/p&gt;</comment>
                            <comment id="13941373" author="lhofhansl" created="Thu, 20 Mar 2014 04:05:48 +0000"  >&lt;p&gt;I still do not get the use case. The archiver does not keep the files forever. Is it a problem to keep the data around for 5 minutes (default) and then have it removed? Could always reduce the time from 5 minutes to 1 minute or so. (and maybe we can use 0 as an indicator to delete immediately - that would come naturally).&lt;/p&gt;

&lt;p&gt;But I really first want to hear why keeping the files for a short amount of time and then deleting them is a problem. Maybe it&apos;s obvious and I am missing something. In that case please add some more details to the description.&lt;/p&gt;</comment>
                            <comment id="13941572" author="bharathv" created="Thu, 20 Mar 2014 09:58:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=larsh&quot; class=&quot;user-hover&quot; rel=&quot;larsh&quot;&gt;larsh&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;The main motivation for this option are the following&lt;/p&gt;

&lt;p&gt;1) Sometimes customers want to retain hfiles in the archive directory for a day or so after deletes, as a backup. So they configure the cleaner to run every 24hours to cleanup the files. This obviously takes up space. However not all tables require this feature and some can be deleted from disk as soon as the table is deleted / compactions are done. So this patch helps such situations where they can mark skip_archive for such test tables and not let it pass through archive so that they can reclaim the space immediately after deletion. &lt;/p&gt;

&lt;p&gt;2) Avoid unnecessary NN operations for not-so-useful tables. If we move to the archive, instead of N file delete calls, we make N file moves and then do N file delete calls. Depending on the table size N can be very huge and we can avoid putting pressure on NN. &lt;/p&gt;</comment>
                            <comment id="13942019" author="lhofhansl" created="Thu, 20 Mar 2014 17:38:01 +0000"  >&lt;p&gt;I see. So let&apos;s make the retention period configurable per table, and have 0 indicate immediate deletion. (although not sure how hard that is, as we do not have the information when archive cleaner runs - maybe it&apos;s too much of a refactoring)&lt;/p&gt;</comment>
                            <comment id="13951534" author="bharathv" created="Fri, 28 Mar 2014 22:49:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; Sorry for the delay here. I was traveling this whole week and didn&apos;t get a chance to work on this jira. That sounds nice but seems to require a bit of code refactoring. With the current code base, it can be achieved by configuring TimeToLiveHFileCleaner and setting &quot;hbase.master.hfilecleaner.ttl&quot; accordingly, its a global setting though. &lt;/p&gt;</comment>
                            <comment id="13961320" author="bharathv" created="Sun, 6 Apr 2014 03:27:51 +0000"  >&lt;p&gt;This patch makes it a table level property. So we can enable it as follows&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Example java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HTableDescriptor htd = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTableDescriptor(test);
htd.setSkipArchive(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;or &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;Example shell&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
create &apos;t1&apos;, &apos;f1&apos;, {SKIP_ARCHIVE =&amp;gt; &apos;True&apos;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Added unit tests which test table deletions and compactions with skip_archive enabled. Added a new config key &quot;hbase.hfile.skip.archive&quot; and when set to true, it enables skipArchive for all tables across deletes and compactions etc. If set to False (default), the code considers per table setting. &lt;/p&gt;</comment>
                            <comment id="13961326" author="hadoopqa" created="Sun, 6 Apr 2014 04:04:45 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12638896/HBASE-8963.trunk.v8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12638896/HBASE-8963.trunk.v8.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12638896&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 11 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javac&lt;/font&gt;.  The patch appears to cause mvn compile goal to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to cause Findbugs (version 1.3.9) to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +  public static void archiveRegion(Configuration conf, FileSystem fs, HRegionInfo info, HTableDescriptor htd)&lt;br/&gt;
+      Path tableDir, byte[] family, Collection&amp;lt;StoreFile&amp;gt; compactedFiles, HTableDescriptor htd) throws IOException {&lt;br/&gt;
+  private static List&amp;lt;File&amp;gt; resolveAndArchive(Configuration conf, FileSystem fs, Path baseArchiveDir,&lt;br/&gt;
+    if(conf.getBoolean(HFILE_SKIP_ARCHIVE_CONF_KEY, true) || ((htd != null) &amp;amp;&amp;amp; htd.isSkipArchiveEnabled())){&lt;br/&gt;
+      HFileArchiver.archiveRegion(this.services.getConfiguration(), fs, regionA, getTableDescriptor(regionA.getTable()));&lt;br/&gt;
+      HFileArchiver.archiveRegion(this.services.getConfiguration(), fs, regionB, getTableDescriptor(regionB.getTable()));&lt;br/&gt;
+      HFileArchiver.archiveRegion(this.services.getConfiguration(), fs, parent, getTableDescriptor(parent.getTable()));&lt;br/&gt;
+    HFileArchiver.archiveRegion(conf, fs, region, this.services.getTableDescriptors().get(region.getTable()));&lt;br/&gt;
+  public void removeStoreFile(final HTableDescriptor htd, final String familyName, final Path filePath)&lt;br/&gt;
+  public void removeStoreFiles(final HTableDescriptor htd, final String familyName, final Collection&amp;lt;StoreFile&amp;gt; storeFiles)&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9207//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9207//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9207//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9207//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13961337" author="yuzhihong@gmail.com" created="Sun, 6 Apr 2014 05:29:31 +0000"  >&lt;p&gt;Please keep line length at 100 or shorter.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    setValue(SKIP_ARCHIVE_KEY,skip?TRUE:FALSE);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;nit: insert space following comma, around question mark and colon.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    FileStatus currentStatus = fs.getFileStatus(currentFile.getPath());
+
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(conf.getBoolean(HFILE_SKIP_ARCHIVE_CONF_KEY, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) || ((htd != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; htd.isSkipArchiveEnabled())){
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;currentStatus is only used within the if block - you can move it inside the if block.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(fs.delete(currentFile.getPath())){
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please insert space between if and &apos;(&apos; - applies to other if statements in patch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HTable t = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTable(UTIL.getConfiguration(), TEST_TABLE);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Where is t closed ?&lt;/p&gt;</comment>
                            <comment id="13961772" author="bharathv" created="Mon, 7 Apr 2014 10:44:39 +0000"  >&lt;p&gt;Attached v9 of patch. &lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Rebased it to trunk. Fixed a test to work as per changed method calls. compile target should work properly now&lt;/li&gt;
	&lt;li&gt;Fixed formatting issues as suggested by Ted (Thanks for the review).&lt;/li&gt;
	&lt;li&gt;Ran findbugs locally to make sure they don&apos;t hit the 100 char limit.&lt;/li&gt;
	&lt;li&gt;Closed the HTable instance properly in tests.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13961774" author="enis" created="Mon, 7 Apr 2014 10:55:13 +0000"  >&lt;p&gt;I think Lars is right that making &quot;hbase.master.hfilecleaner.ttl&quot; configurable per table, with the global configuration used if not set is better than adding yet another config parameter.&lt;/p&gt;</comment>
                            <comment id="13961811" author="hadoopqa" created="Mon, 7 Apr 2014 12:36:55 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12638959/HBASE-8963.trunk.v9.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12638959/HBASE-8963.trunk.v9.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12638959&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 14 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 2 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.cleaner.TestSnapshotFromMaster&lt;br/&gt;
                  org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.coprocessor.TestRegionObserverInterface.testHBase3583(TestRegionObserverInterface.java:244)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9212//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13962567" author="lhofhansl" created="Tue, 8 Apr 2014 04:30:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think Lars is right that making &quot;hbase.master.hfilecleaner.ttl&quot; configurable per table&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It&apos;s not actually as simple as I thought. At the time we&apos;re archiving/deleting HFiles we do not necessarily have access to the table&apos;s metadata, it&apos;s expensive to read the table description (in the region or family case). When the table is dropped, we&apos;d need to keep the TTL information somewhere else.&lt;/p&gt;</comment>
                            <comment id="13962667" author="bharathv" created="Tue, 8 Apr 2014 07:32:06 +0000"  >&lt;p&gt;+1 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;. Also we cannot afford to cache it in master&apos;s memory because we won&apos;t have it after master restarts/crashes and archiver doesn&apos;t know when to delete the files. So it needs to be persisted somewhere on to HDFS. Fwiw, i&apos;ll fix my patch to work for the 2 failed tests and post a new version soon. &lt;/p&gt;</comment>
                            <comment id="14229167" author="yuzhihong@gmail.com" created="Sun, 30 Nov 2014 17:20:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;:&lt;br/&gt;
Do you think this JIRA can get some attention ?&lt;/p&gt;</comment>
                            <comment id="14551307" author="jmspaggi" created="Tue, 19 May 2015 21:56:17 +0000"  >&lt;p&gt;Stalled?&lt;/p&gt;</comment>
                            <comment id="14625113" author="apurtell" created="Mon, 13 Jul 2015 18:31:06 +0000"  >&lt;p&gt;This has been stalled for a while waiting for a response from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bharathv&quot; class=&quot;user-hover&quot; rel=&quot;bharathv&quot;&gt;bharath v&lt;/a&gt; addressing this: &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8963?focusedCommentId=13962567&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13962567&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-8963?focusedCommentId=13962567&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13962567&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Is there more work planned on this? Or should we resolve it as Later or Incomplete?&lt;/p&gt;</comment>
                            <comment id="14680347" author="yuzhihong@gmail.com" created="Mon, 10 Aug 2015 16:47:40 +0000"  >&lt;p&gt;If &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bharathv&quot; class=&quot;user-hover&quot; rel=&quot;bharathv&quot;&gt;bharath v&lt;/a&gt; is busy, I have some cycles to carry this forward.&lt;/p&gt;</comment>
                            <comment id="14681009" author="apurtell" created="Tue, 11 Aug 2015 00:26:43 +0000"  >&lt;p&gt;This has been stalled for a while, I think its okay for you to take it. Let us know if otherwise &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bharathv&quot; class=&quot;user-hover&quot; rel=&quot;bharathv&quot;&gt;bharath v&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="14947207" author="yuzhihong@gmail.com" created="Wed, 7 Oct 2015 16:56:55 +0000"  >&lt;p&gt;Tentative patch - needs to retrieve table description based on given path to HFile.&lt;/p&gt;</comment>
                            <comment id="14949006" author="mbertozzi" created="Thu, 8 Oct 2015 17:16:26 +0000"  >&lt;p&gt;v10 looks ok to me&lt;/p&gt;</comment>
                            <comment id="14949015" author="yuzhihong@gmail.com" created="Thu, 8 Oct 2015 17:26:18 +0000"  >&lt;p&gt;I am open to better naming of the new table attribute.&lt;/p&gt;</comment>
                            <comment id="14949461" author="sebastianco" created="Thu, 8 Oct 2015 21:53:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuzhihong%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yuzhihong@gmail.com&quot;&gt;Ted Yu&lt;/a&gt; does v10 solves also the control of archiving/removing compacted files? Excuse my ignorance but I fail to see how this will work (in my defence I&apos;m just a HBase user who would like to turn of archiving of compacted files).&lt;/p&gt;</comment>
                            <comment id="14949464" author="yuzhihong@gmail.com" created="Thu, 8 Oct 2015 21:56:02 +0000"  >&lt;p&gt;I think so.&lt;/p&gt;</comment>
                            <comment id="14949704" author="yuzhihong@gmail.com" created="Fri, 9 Oct 2015 00:58:47 +0000"  >&lt;p&gt;w.r.t. new table attribute, how about SKIP_ARCHIVING_ON_DELETION ?&lt;/p&gt;</comment>
                            <comment id="14950201" author="sebastianco" created="Fri, 9 Oct 2015 10:51:41 +0000"  >&lt;p&gt;I would like to help but I can&apos;t figure out which solution are you implementing. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; initially proposed to &quot;make the retention period configurable per table, and have 0 indicate immediate deletion&quot;. I like the idea because from a user point of view it is intuitive and consistent with &quot;hbase.master.hfilecleaner.ttl&quot;. If we go this route then I would expect both config property and table attribute to be taken into account when deciding if a file needs to be archived and when it needs to be deleted from the archive. I would also expect table attribute to have priority over global configuration. The new attribute HFILECLEANER_TTL follows the above reasoning so I am happy with it (much better than SKIP_ARCHIVING_ON_DELETION), however looking at patch v10 I don&apos;t see it used in two places I would expect it to be: HFileArchiver &amp;amp; TimeToLiveHFileCleaner. &lt;/p&gt;

&lt;p&gt;Later on Lars also added:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;It&apos;s not actually as simple as I thought. At the time we&apos;re archiving/deleting HFiles we do not necessarily have access to the table&apos;s metadata, it&apos;s expensive to read the table description (in the region or family case). When the table is dropped, we&apos;d need to keep the TTL information somewhere else.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;which worries me. The first part, related to access to table&apos;s metadata, was addressed to some extent (ony in HFileArchiver) by v9 patch. The &quot;table dropped&quot; case is probably harder to tackle - I would propose to fall back to the global config when table does not exist anymore and we need to decide what to do with remaining hfiles.&lt;/p&gt;</comment>
                            <comment id="14961395" author="yuzhihong@gmail.com" created="Fri, 16 Oct 2015 21:39:39 +0000"  >&lt;p&gt;Lars, Enis:&lt;br/&gt;
Mind revisiting this issue ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="14968218" author="enis" created="Thu, 22 Oct 2015 00:03:48 +0000"  >&lt;p&gt;Agreed with the comments above that per-table hfile archive TTL is hard to do and the benefits are not immediately clear to me. The current v10 patch does not respect the TTL time unless it is 0 which is very confusing. &lt;br/&gt;
SKIP_ARCHIVE as a table property is debatable. Do we want to skip archiving hfiles for compacted files as well? If so, this is the only way. But if we want to skip archiving files on table deletion, then I prefer that we add a flag to the drop table command. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12759271">HBASE-12626</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12765422" name="8963-v10.txt" size="5109" author="yuzhihong@gmail.com" created="Wed, 7 Oct 2015 17:19:46 +0000"/>
                            <attachment id="12634422" name="HBASE-8963.trunk.v1.patch" size="14450" author="bharathv" created="Thu, 13 Mar 2014 12:31:32 +0000"/>
                            <attachment id="12634531" name="HBASE-8963.trunk.v2.patch" size="22156" author="bharathv" created="Thu, 13 Mar 2014 20:05:31 +0000"/>
                            <attachment id="12634534" name="HBASE-8963.trunk.v3.patch" size="21368" author="bharathv" created="Thu, 13 Mar 2014 20:11:56 +0000"/>
                            <attachment id="12634669" name="HBASE-8963.trunk.v4.patch" size="21325" author="bharathv" created="Fri, 14 Mar 2014 07:47:00 +0000"/>
                            <attachment id="12634791" name="HBASE-8963.trunk.v5.patch" size="23089" author="bharathv" created="Fri, 14 Mar 2014 18:52:08 +0000"/>
                            <attachment id="12634807" name="HBASE-8963.trunk.v6.patch" size="23510" author="bharathv" created="Fri, 14 Mar 2014 19:31:24 +0000"/>
                            <attachment id="12634925" name="HBASE-8963.trunk.v7.patch" size="23496" author="bharathv" created="Sat, 15 Mar 2014 18:07:30 +0000"/>
                            <attachment id="12638896" name="HBASE-8963.trunk.v8.patch" size="48668" author="bharathv" created="Sun, 6 Apr 2014 03:27:51 +0000"/>
                            <attachment id="12638959" name="HBASE-8963.trunk.v9.patch" size="51065" author="bharathv" created="Mon, 7 Apr 2014 10:44:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 Jul 2013 21:10:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338308</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 8 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mcon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338628</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>