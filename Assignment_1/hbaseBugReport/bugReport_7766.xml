<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:48:51 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7766/HBASE-7766.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7766] master cannot go from 94 to 96 due to zookeeper data</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7766</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;After running a 94 cluster and then updating it to 96, master cannot start due to the following:&lt;/p&gt;

&lt;p&gt;2013-02-04 19:59:15,494 FATAL org.apache.hadoop.hbase.master.HMaster: Unhandled exception. Starting shutdown.&lt;br/&gt;
org.apache.zookeeper.KeeperException$DataInconsistencyException: KeeperErrorCode = DataInconsistency&lt;br/&gt;
at org.apache.hadoop.hbase.zookeeper.ZKUtil.convert(ZKUtil.java:1705)&lt;br/&gt;
at org.apache.hadoop.hbase.zookeeper.ZKTableReadOnly.getTableState(ZKTableReadOnly.java:158)&lt;br/&gt;
at org.apache.hadoop.hbase.zookeeper.ZKTable.populateTableStates(ZKTable.java:82)&lt;br/&gt;
at org.apache.hadoop.hbase.zookeeper.ZKTable.&amp;lt;init&amp;gt;(ZKTable.java:69)&lt;br/&gt;
at org.apache.hadoop.hbase.master.AssignmentManager.&amp;lt;init&amp;gt;(AssignmentManager.java:199)&lt;br/&gt;
at org.apache.hadoop.hbase.master.HMaster.initializeZKBasedSystemTrackers(HMaster.java:550)&lt;br/&gt;
at org.apache.hadoop.hbase.master.HMaster.finishInitialization(HMaster.java:671)&lt;br/&gt;
at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:476)&lt;br/&gt;
at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
Caused by: org.apache.hadoop.hbase.DeserializationException: Missing pb magic PBUF prefix&lt;br/&gt;
at org.apache.hadoop.hbase.protobuf.ProtobufUtil.expectPBMagicPrefix(ProtobufUtil.java:196)&lt;br/&gt;
at org.apache.hadoop.hbase.zookeeper.ZKTableReadOnly.getTableState(ZKTableReadOnly.java:148)&lt;br/&gt;
... 7 more&lt;/p&gt;

&lt;p&gt;It should probably nuke the data and start as with blanks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12630791">HBASE-7766</key>
            <summary>master cannot go from 94 to 96 due to zookeeper data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="10">Implemented</resolution>
                                        <assignee username="rajesh23">rajeshbabu</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                    </labels>
                <created>Tue, 5 Feb 2013 01:18:47 +0000</created>
                <updated>Wed, 21 Aug 2013 21:45:00 +0000</updated>
                            <resolved>Wed, 21 Aug 2013 21:45:00 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13570847" author="enis" created="Tue, 5 Feb 2013 01:39:38 +0000"  >&lt;p&gt;That ZKTable is nasty. We should get rid of it completely. Let me create another jira to get rid of this. It should be a sub task of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5487&quot; title=&quot;Generic framework for Master-coordinated tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5487&quot;&gt;HBASE-5487&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="13570927" author="stack" created="Tue, 5 Feb 2013 03:48:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; Yessir.  On update, we need to clear zk (though yeah, in this case it means some tables will be reenabled....) I&apos;m trying to collect whats needed going from one version to the other here &lt;a href=&quot;http://hbase.apache.org/book.html#upgrade0.96&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hbase.apache.org/book.html#upgrade0.96&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13571938" author="sershe" created="Tue, 5 Feb 2013 23:47:18 +0000"  >&lt;p&gt;Hmm. Do we want to make it automatic in master? Otherwise it seems this jira should be closed as workaround is in the docs.&lt;/p&gt;</comment>
                            <comment id="13571951" author="stack" created="Tue, 5 Feb 2013 23:54:04 +0000"  >&lt;p&gt;I&apos;d imagine that there will be a few steps we&apos;ll have for users to follow upgrading.  If more than one or two, we&apos;ll probably want to cast them in a script that is run just before upgrade or that we run automatically on first coming up.  I don&apos;t have an issue for 0.96 migration yet.... probably should open it and note that we should do this too...&lt;/p&gt;</comment>
                            <comment id="13572852" author="enis" created="Wed, 6 Feb 2013 21:29:27 +0000"  >&lt;p&gt;AFAIR, most of the zookeeper data was already being auto-converted to the new PB stuff with magic. If there is only this table state, then we might as well fix it. Otherwise, lets do the migration script or wipe data in zookeeper. &lt;/p&gt;</comment>
                            <comment id="13744244" author="jdcryans" created="Mon, 19 Aug 2013 21:24:50 +0000"  >&lt;p&gt;Should we close this jira as invalid? The master shouldn&apos;t run on old ZK data if the migration is successful (and if it isn&apos;t, maybe starting the master anyway is a bad idea).&lt;/p&gt;</comment>
                            <comment id="13744257" author="sershe" created="Mon, 19 Aug 2013 21:30:52 +0000"  >&lt;p&gt;Is there a migration script that takes this into account?&lt;/p&gt;</comment>
                            <comment id="13744263" author="jdcryans" created="Mon, 19 Aug 2013 21:32:43 +0000"  >&lt;p&gt;IMO &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8348&quot; title=&quot;Polish the migration to 0.96&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8348&quot;&gt;&lt;del&gt;HBASE-8348&lt;/del&gt;&lt;/a&gt; can&apos;t be considered done unless it covers that.&lt;/p&gt;</comment>
                            <comment id="13744733" author="rajesh23" created="Tue, 20 Aug 2013 05:53:59 +0000"  >&lt;p&gt;As part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8348&quot; title=&quot;Polish the migration to 0.96&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8348&quot;&gt;&lt;del&gt;HBASE-8348&lt;/del&gt;&lt;/a&gt;, migrating zookeeper data(of 0.92.x or 0.94.x) like table states, replication znodes to PB and also removing unused znodes. If migration is successful master from 0.96 version can start properly. Any failures user can retry until migration is successful.&lt;/p&gt;</comment>
                            <comment id="13746884" author="stack" created="Wed, 21 Aug 2013 21:45:00 +0000"  >&lt;p&gt;Closing as covered by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8348&quot; title=&quot;Polish the migration to 0.96&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8348&quot;&gt;&lt;del&gt;HBASE-8348&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12642630">HBASE-8348</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 5 Feb 2013 01:39:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311287</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hpyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311633</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>