<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:06:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2966/HBASE-2966.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2966] HBase client stuck on org.apache.zookeeper.ClientCnxn.submitRequest(ClientCnxn.java:1278) holding regionLockObject lock</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2966</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We noticed in one case the HBase client program got stuck on Zookeeper.exists() call.&lt;/p&gt;

&lt;p&gt;One of the threads was stuck here on the ZK call while holding an HBase level lock (regionLockObject in locateRegionInMeta()).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
&lt;span class=&quot;code-quote&quot;&gt;&quot;thrift-0-thread-8&quot;&lt;/span&gt; prio=10 tid=0x00007f189ca4c000 nid=0x550f in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x0000000044241000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
                at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
                at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:485)
                at org.apache.zookeeper.ClientCnxn.submitRequest(ClientCnxn.java:1278)
                - locked &amp;lt;0x00007f1903a0c280&amp;gt; (a org.apache.zookeeper.ClientCnxn$Packet)
                at org.apache.zookeeper.ZooKeeper.exists(ZooKeeper.java:804)
                at org.apache.zookeeper.ZooKeeper.exists(ZooKeeper.java:837)
                at org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper.getRSDirectoryCount(ZooKeeperWrapper.java:765)
                at org.apache.hadoop.hbase.client.HTable.getCurrentNrHRS(HTable.java:173)
                at org.apache.hadoop.hbase.client.HTable.&amp;lt;init&amp;gt;(HTable.java:147)
                at org.apache.hadoop.hbase.client.MetaScanner.metaScan(MetaScanner.java:124)
                at org.apache.hadoop.hbase.client.MetaScanner.metaScan(MetaScanner.java:89)
                at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.prefetchRegionCache(HConnectionManager.java:734)
                at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegionInMeta(HConnectionManager.java:785)
                - locked &amp;lt;0x00007f190d868848&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
                at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegion(HConnectionManager.java:679)
                at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegion(HConnectionManager.java:646)
                at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.getRegionLocation(HConnectionManager.java:472)
                at org.apache.hadoop.hbase.client.ServerCallable.instantiateServer(ServerCallable.java:57)
                at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.getRegionServerWithRetries(HConnectionManager.java:1147)
                at org.apache.hadoop.hbase.client.HTable.get(HTable.java:503)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;The remaining other threads are all waiting on the regionLockObject lock (held by the above thread) with stacks like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
thrift-0-thread-7&quot; prio=10 tid=0x00007f189ca4a800 nid=0x550e waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; monitor entry [0x0000000044141000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: BLOCKED (on object monitor)
                at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegionInMeta(HConnectionManager.java:783)
                - waiting to lock &amp;lt;0x00007f190d868848&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
                at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegion(HConnectionManager.java:679)
                at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegion(HConnectionManager.java:646)
                at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.getRegionLocation(HConnectionManager.java:472)
                at org.apache.hadoop.hbase.client.ServerCallable.instantiateServer(ServerCallable.java:57)
                at org.apache.hadoop.hbase.client.HConnectionManager$TableServers.getRegionServerWithRetries(HConnectionManager.java:1147)
                at org.apache.hadoop.hbase.client.HTable.get(HTable.java:503)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Any ideas?&lt;/p&gt;

&lt;p&gt;Meanwhile, I&apos;ll look into the ZK logs from the relevant time some more and get back if I have more information.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12473529">HBASE-2966</key>
            <summary>HBase client stuck on org.apache.zookeeper.ClientCnxn.submitRequest(ClientCnxn.java:1278) holding regionLockObject lock</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kannanm">Kannan Muthukkaruppan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Sep 2010 05:46:16 +0000</created>
                <updated>Wed, 16 Jul 2014 23:03:04 +0000</updated>
                            <resolved>Wed, 16 Jul 2014 23:03:04 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12907100" author="tlipcon" created="Wed, 8 Sep 2010 06:04:35 +0000"  >&lt;p&gt;I replied on IRC but guess you missed it.. got a stack trace for the other ZK threads? There should be a SendThread and an EventThread&lt;/p&gt;</comment>
                            <comment id="12907106" author="kannanm" created="Wed, 8 Sep 2010 06:16:28 +0000"  >&lt;p&gt;Todd: Find attached client side program&apos;s jstack dump. I see a bunch of &quot;EventThread&quot;s, but don&apos;t see a sendThread.&lt;/p&gt;</comment>
                            <comment id="12907388" author="tlipcon" created="Wed, 8 Sep 2010 19:59:28 +0000"  >&lt;p&gt;I chatted with phunt and he pointed me to &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-846&quot; title=&quot;zookeeper client doesn&amp;#39;t shut down cleanly on the close call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-846&quot;&gt;&lt;del&gt;ZOOKEEPER-846&lt;/del&gt;&lt;/a&gt; - might be related/the same?&lt;/p&gt;</comment>
                            <comment id="12907395" author="phunt" created="Wed, 8 Sep 2010 20:09:11 +0000"  >&lt;p&gt;Do you have the logs from the client side? (zk) would be helpful.&lt;/p&gt;

&lt;p&gt;What version of zk client library is being used?&lt;/p&gt;</comment>
                            <comment id="12907420" author="streamy" created="Wed, 8 Sep 2010 20:40:41 +0000"  >&lt;p&gt;It&apos;s ZK 3.3.1.&lt;/p&gt;

&lt;p&gt;I don&apos;t think we were capturing client-side logs on this run.  We&apos;re trying to recreate now.&lt;/p&gt;</comment>
                            <comment id="12907462" author="phunt" created="Wed, 8 Sep 2010 22:13:14 +0000"  >&lt;p&gt;btw, the large number of event threads in the stack dump is related to this issue, which is fixed in 3.3.2 (not yet released):&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-795&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-795&lt;/a&gt;&lt;br/&gt;
however that&apos;s unrelated to this specific issue.&lt;/p&gt;</comment>
                            <comment id="12907475" author="kannanm" created="Wed, 8 Sep 2010 23:09:54 +0000"  >&lt;p&gt;phunt: I just learned that the client was 3.3.0 but server was 3.3.1. Wondering if that could cause this type of issue? &lt;/p&gt;</comment>
                            <comment id="12907495" author="phunt" created="Thu, 9 Sep 2010 00:40:49 +0000"  >&lt;p&gt;Kannan: no, version X.Y.Z, Z+ is just a bug fix release, that&apos;s fine&lt;/p&gt;</comment>
                            <comment id="12907524" author="phunt" created="Thu, 9 Sep 2010 05:30:40 +0000"  >&lt;p&gt;I believe I&apos;ve found the problem. Documented on &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-846&quot; title=&quot;zookeeper client doesn&amp;#39;t shut down cleanly on the close call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-846&quot;&gt;&lt;del&gt;ZOOKEEPER-846&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-846?focusedCommentId=12907523&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12907523&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-846?focusedCommentId=12907523&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12907523&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is a blocker, we&apos;ll be fixing this as part of 3.3.2&lt;/p&gt;</comment>
                            <comment id="12908254" author="kannanm" created="Sat, 11 Sep 2010 00:30:11 +0000"  >&lt;p&gt;Todd, Patrick: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-846&quot; title=&quot;zookeeper client doesn&amp;#39;t shut down cleanly on the close call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-846&quot;&gt;&lt;del&gt;ZOOKEEPER-846&lt;/del&gt;&lt;/a&gt; seems to mention about the issue happening when ZooKeeper session is closed.&lt;/p&gt;

&lt;p&gt;In our case, this was an active HBaseClient client working against an HBase cluster, and I would not expect it to be doing a ZK session close. Nor is there a ZK close in the stack I uploaded (unlike the &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-846&quot; title=&quot;zookeeper client doesn&amp;#39;t shut down cleanly on the close call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-846&quot;&gt;&lt;del&gt;ZOOKEEPER-846&lt;/del&gt;&lt;/a&gt; case).&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="12908903" author="phunt" created="Mon, 13 Sep 2010 18:30:00 +0000"  >&lt;p&gt;Hi Kannan, one of the reasons I asked about the log was to verify the scenario I found. Since it&apos;s not available we can only speculate, however I feel pretty confident this is the same issue.&lt;/p&gt;

&lt;p&gt;Notice in the stack dump that there is no &quot;SendThread&quot; anywhere, although there are a large number of event threads. This indicates that something was going on perhaps session expirations given that the &quot;event thread not shutting down&quot; is triggered by session expiration, &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-795&quot; title=&quot;eventThread isn&amp;#39;t shutdown after a connection &amp;quot;session expired&amp;quot; event coming&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-795&quot;&gt;&lt;del&gt;ZOOKEEPER-795&lt;/del&gt;&lt;/a&gt; detailed earlier in this jira. Notice that &quot;exists&quot; is the hanging operation in the stack dump of this JIRA (vs close in 846), however the issue in both cases (hang) is the same underlying problem - both close and exists queue packets to be sent to the server, they can hang if the queue is not cleaned up properly. One discrepancy is that that &quot;sendthread&quot; should only shut down on client issued close (or zk state closed, which doesn&apos;t trigger this bug). If there is no way that your code is calling close then this bug should not be triggered, but w/o the logs it&apos;s hard to me to speculate. Is it possible that close was called due to some network issue? (error handling due to the network instability causing the session epirations say).&lt;/p&gt;

</comment>
                            <comment id="12909028" author="kannanm" created="Mon, 13 Sep 2010 22:31:08 +0000"  >&lt;p&gt;Patrick: Makes sense. &lt;/p&gt;

&lt;p&gt;Is 3.3.2 going to be out soon? Or should we look into manually applying these to 3.3.1. &lt;br/&gt;
(I suppose we need both &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-846&quot; title=&quot;zookeeper client doesn&amp;#39;t shut down cleanly on the close call&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-846&quot;&gt;&lt;del&gt;ZOOKEEPER-846&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-795&quot; title=&quot;eventThread isn&amp;#39;t shutdown after a connection &amp;quot;session expired&amp;quot; event coming&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-795&quot;&gt;&lt;del&gt;ZOOKEEPER-795&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Todd/Stack et. al: What are your plans around picking up a fix for these ZK issue?&lt;/p&gt;</comment>
                            <comment id="12909073" author="stack" created="Tue, 14 Sep 2010 00:54:00 +0000"  >&lt;p&gt;@Kannan We are ZK guinea pigs &amp;#8211; we&apos;ll run anything Patrick or Mahadev tell us to.  Patrick, anything you want us to try or should we patch up something w/ the above two issues?&lt;/p&gt;</comment>
                            <comment id="12914096" author="phunt" created="Thu, 23 Sep 2010 16:53:33 +0000"  >&lt;p&gt;A fix release for 3.3.2 is in progress on the zk dev list if you&apos;d like to follow along. Hopefully we&apos;ll get this out soon. You could try the current ZK branch-3.3 which includes fixes for this issue (and others).&lt;/p&gt;</comment>
                            <comment id="14064293" author="apurtell" created="Wed, 16 Jul 2014 23:03:04 +0000"  >&lt;p&gt;Reopen or file new issue is still relevant with modern HBase versions&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12471442">ZOOKEEPER-846</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12454076" name="stack.txt" size="239768" author="kannanm" created="Wed, 8 Sep 2010 06:16:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Sep 2010 06:04:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26560</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02djj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11795</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>