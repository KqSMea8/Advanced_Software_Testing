<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:53:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8253/HBASE-8253.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8253] A corrupted log blocked ReplicationSource</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8253</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;A writting log got corrupted when we forcely power down one node. Only partial of last WALEdit was written into that log. And that log was not the last one in replication queue. &lt;br/&gt;
ReplicationSource was blocked under this scenario. A lot of logs like below were printed:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-03-30 06:53:48,628 WARN  [regionserver26003-EventThread.replicationSource,1] 1 Got:  org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.run(ReplicationSource.java:334)
java.io.EOFException: hdfs://hacluster/hbase/.logs/master11,26003,1364530862620/master11%2C26003%2C1364530862620.1364553936510, entryStart=40434738, pos=40450048, end=40450048, edit=0
	at sun.reflect.GeneratedConstructorAccessor42.newInstance(Unknown Source)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
	at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader.addFileInfoToException(SequenceFileLogReader.java:295)
	at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader.next(SequenceFileLogReader.java:240)
	at org.apache.hadoop.hbase.replication.regionserver.ReplicationHLogReaderManager.readNextAndSetPosition(ReplicationHLogReaderManager.java:84)
	at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.readAllEntriesToReplicateOrNextFile(ReplicationSource.java:412)
	at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.run(ReplicationSource.java:330)
Caused by: java.io.EOFException
	at java.io.DataInputStream.readFully(DataInputStream.java:180)
	at org.apache.hadoop.io.DataOutputBuffer$Buffer.write(DataOutputBuffer.java:68)
	at org.apache.hadoop.io.DataOutputBuffer.write(DataOutputBuffer.java:106)
	at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:2282)
	at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:2181)
	at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:2227)
	at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader.next(SequenceFileLogReader.java:238)
	... 3 more
..........	
2013-03-30 06:54:38,899 WARN  [regionserver26003-EventThread.replicationSource,1] 1 Got:  org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.run(ReplicationSource.java:334)
java.io.EOFException: hdfs://hacluster/hbase/.logs/master11,26003,1364530862620/master11%2C26003%2C1364530862620.1364553936510, entryStart=40434738, pos=40450048, end=40450048, edit=0
	at sun.reflect.GeneratedConstructorAccessor42.newInstance(Unknown Source)
	at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:27)
	at java.lang.reflect.Constructor.newInstance(Constructor.java:513)
	at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader.addFileInfoToException(SequenceFileLogReader.java:295)
	at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader.next(SequenceFileLogReader.java:240)
	at org.apache.hadoop.hbase.replication.regionserver.ReplicationHLogReaderManager.readNextAndSetPosition(ReplicationHLogReaderManager.java:84)
	at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.readAllEntriesToReplicateOrNextFile(ReplicationSource.java:412)
	at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.run(ReplicationSource.java:330)
Caused by: java.io.EOFException
	at java.io.DataInputStream.readFully(DataInputStream.java:180)
	at org.apache.hadoop.io.DataOutputBuffer$Buffer.write(DataOutputBuffer.java:68)
	at org.apache.hadoop.io.DataOutputBuffer.write(DataOutputBuffer.java:106)
	at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:2282)
	at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:2181)
	at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:2227)
	at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader.next(SequenceFileLogReader.java:238)
	... 3 more
...........	
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12640453">HBASE-8253</key>
            <summary>A corrupted log blocked ReplicationSource</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="4">Incomplete</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jeason">Jieshan Bean</reporter>
                        <labels>
                    </labels>
                <created>Wed, 3 Apr 2013 07:07:03 +0000</created>
                <updated>Tue, 8 Sep 2015 04:48:33 +0000</updated>
                            <resolved>Tue, 8 Sep 2015 04:48:33 +0000</resolved>
                                    <version>0.94.6</version>
                                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13620690" author="jeason" created="Wed, 3 Apr 2013 07:13:50 +0000"  >&lt;p&gt;Patch for discussion.&lt;/p&gt;

&lt;p&gt;In ReplicationSource#readAllEntriesToReplicateOrNextFile, only read for the first edit may throw EOF. So when we get EOF, currentNbEntries should be 0. No other case.&lt;br/&gt;
Please correct me if I am wrong.&lt;/p&gt;</comment>
                            <comment id="13645981" author="jdcryans" created="Tue, 30 Apr 2013 21:04:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeason&quot; class=&quot;user-hover&quot; rel=&quot;jeason&quot;&gt;Jieshan Bean&lt;/a&gt;, how come you got this error in a normal source? Shouldn&apos;t it be a recovered one since it&apos;s coming from another region server?&lt;/p&gt;</comment>
                            <comment id="13648093" author="jeason" created="Fri, 3 May 2013 01:22:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;how come you got this error in a normal source?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, it happened in a normal source not a recovered one. Primary data node was forcely powered down, so logRoll was requested. And during that time, only partial of last edit was written. Then we saw this problem.&lt;/p&gt;</comment>
                            <comment id="13651501" author="jdcryans" created="Wed, 8 May 2013 00:45:20 +0000"  >&lt;p&gt;Oh I see what you mean, I thought the problem was somehow caused by replay. So, unless I&apos;m mistaken, the edit was then written into the next log and durability was ensured? So we just need to skip over this one? Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeason&quot; class=&quot;user-hover&quot; rel=&quot;jeason&quot;&gt;Jieshan Bean&lt;/a&gt; and sorry for being a bit slow.&lt;/p&gt;</comment>
                            <comment id="13652954" author="jeason" created="Thu, 9 May 2013 13:29:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;the edit was then written into the next log and durability was ensured?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So we just need to skip over this one?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes. Just skip this one&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="13766054" author="jdcryans" created="Fri, 13 Sep 2013 00:06:10 +0000"  >&lt;p&gt;How about we merge this issue with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6719&quot; title=&quot;[replication] Data will lose if open a Hlog failed more than maxRetriesMultiplier&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6719&quot;&gt;HBASE-6719&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeason&quot; class=&quot;user-hover&quot; rel=&quot;jeason&quot;&gt;Jieshan Bean&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=terry_zhang&quot; class=&quot;user-hover&quot; rel=&quot;terry_zhang&quot;&gt;terry zhang&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;? The general problem is that we can have logs that block replication progress for legit reasons and... less legit reasons. In this jira, we should be moving the log aside but how do we really know it&apos;s not a case of 6719?&lt;/p&gt;

&lt;p&gt;The solution I was referring to at the tail of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6719&quot; title=&quot;[replication] Data will lose if open a Hlog failed more than maxRetriesMultiplier&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6719&quot;&gt;HBASE-6719&lt;/a&gt; is similar to what we do with HLog splitting where hbase.regionserver.hlog.splitlog.corrupt.dir tells which directory contains the corrupted logs. We can do the same here so that we can move on if a log is blocking us while not losing data to replicate permanently.&lt;/p&gt;

&lt;p&gt;If we want to be able to replay logs we&apos;ll also need &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nidmhbase&quot; class=&quot;user-hover&quot; rel=&quot;nidmhbase&quot;&gt;Demai Ni&lt;/a&gt;&apos;s tool in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9047&quot; title=&quot;Tool to handle finishing replication when the cluster is offline&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9047&quot;&gt;&lt;del&gt;HBASE-9047&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14734236" author="apurtell" created="Tue, 8 Sep 2015 04:48:33 +0000"  >&lt;p&gt;Marking as incomplete.&lt;/p&gt;

&lt;p&gt;Let me note I&apos;ve seen this issue in production. The replication queue will stall until retries are exhausted, but then the corrupt hlog will be dropped from the queue and queue processing will resume.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12576733" name="HBASE-8253-94.patch" size="804" author="jeason" created="Wed, 3 Apr 2013 07:13:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 30 Apr 2013 21:04:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>320915</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 14 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jdcn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>321256</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>