<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:32:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5915/HBASE-5915.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5915] Improve performance of KeyValue comparison</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5915</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Got bored tonight and poked around at making KeyValue comparison faster. I was able to get a ~23% speedup on a micro-benchmark I wrote by using Unsafe in a few more places. This should make some difference for real workloads, since this is usually one of the top CPU consumers.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12553593">HBASE-5915</key>
            <summary>Improve performance of KeyValue comparison</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 May 2012 07:51:12 +0000</created>
                <updated>Sat, 11 Apr 2015 00:20:43 +0000</updated>
                            <resolved>Sat, 11 Apr 2015 00:20:43 +0000</resolved>
                                    <version>0.94.1</version>
                                                    <component>Performance</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="13266417" author="tlipcon" created="Wed, 2 May 2012 07:57:43 +0000"  >&lt;p&gt;Here&apos;s the patch and micro-benchmark.&lt;/p&gt;

&lt;p&gt;Would be curious if people can poke holes in it (or show with a more realistic workload if it makes a difference)&lt;/p&gt;</comment>
                            <comment id="13266575" author="zhihyu@ebaysf.com" created="Wed, 2 May 2012 14:01:04 +0000"  >&lt;p&gt;The following variable doesn&apos;t seem to be used:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; triggerBoundsCheck = buf[off + SIZEOF_LONG - 1];
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;What&apos;s its purpose ?&lt;/p&gt;</comment>
                            <comment id="13266662" author="stack" created="Wed, 2 May 2012 16:09:37 +0000"  >&lt;p&gt;It looks great Todd.&lt;/p&gt;

&lt;p&gt;This is funny (when wrong-endian) --&amp;gt; +          return Long.reverseBytes(result);&lt;/p&gt;

&lt;p&gt;Nice --&amp;gt; +        final int minWords = minLength &amp;gt;&amp;gt;&amp;gt; 3; // / SIZEOF_LONG;.... that should be faster.&lt;/p&gt;
</comment>
                            <comment id="13266682" author="hadoopqa" created="Wed, 2 May 2012 16:31:17 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525264/hbase-5915.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525264/hbase-5915.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 4 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestCheckTestClasses&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1726//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1726//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1726//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1726//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1726//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1726//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13266708" author="ram_krish" created="Wed, 2 May 2012 16:59:44 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+              &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; lessThanUnsigned(&lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.reverseBytes(lw),
+                  &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt;.reverseBytes(rw)) ? -1 : 1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Patch v2 is different from V1. Was it intended Ted?&lt;/p&gt;</comment>
                            <comment id="13266711" author="zhihyu@ebaysf.com" created="Wed, 2 May 2012 17:05:13 +0000"  >&lt;p&gt;TestKVComparisonPerformance without the patch:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Run 99 took 99574us

Avg: 98655us
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is the output with the patch:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Run 99 took 79849us

Avg: 79295us
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13266716" author="zhihyu@ebaysf.com" created="Wed, 2 May 2012 17:09:59 +0000"  >&lt;p&gt;@Ram:&lt;br/&gt;
The quoted snippet came from Todd.&lt;br/&gt;
Can you elaborate what problem you saw ?&lt;/p&gt;</comment>
                            <comment id="13266720" author="ram_krish" created="Wed, 2 May 2012 17:13:36 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
Sorry Ted.  I think its fine.  Once i applied the patch it looked fine. Sorry for the confusion.&lt;/p&gt;</comment>
                            <comment id="13266755" author="tlipcon" created="Wed, 2 May 2012 17:46:10 +0000"  >&lt;p&gt;Before we commit this, we should run some actual workloads. There are two funky things I noticed about the patch:&lt;br/&gt;
1) the test case always has the behavior that the first KV to be compared is in cache while the second one is not, which is not quite realistic in a real workload. Maybe it&apos;s better to time insertion of a few million KVs into a KeyValueSkipListSet instead.&lt;br/&gt;
2) when I tried this patch with a YCSB workload, it actually took &lt;em&gt;more&lt;/em&gt; CPU seconds than without the patch, which is odd given the microbenchmark. So something isn&apos;t aligning with reality. I didn&apos;t have time to investigate that.&lt;/p&gt;</comment>
                            <comment id="13266823" author="hadoopqa" created="Wed, 2 May 2012 19:06:05 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525313/5915-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525313/5915-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestHRegionOnCluster&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestSplitTransactionOnCluster&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestSplitLogWorker&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1728//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1728//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1728//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1728//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1728//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1728//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13441962" author="lhofhansl" created="Sat, 25 Aug 2012 21:12:11 +0000"  >&lt;p&gt;Patch looks good. Changing minWords * SIZEOF_LONG to minWords &amp;lt;&amp;lt; 3, makes it less readable, and probably has no discernible difference (the compiler should be doing something like this anyway - if SIZEOF_LONG is final).&lt;/p&gt;

&lt;p&gt;&quot;LexicographicalComparerHolder&quot; is not the right name anymore.&lt;/p&gt;

&lt;p&gt;I&apos;ll try with some test workload next week. Linux is littleEndian, right? So the bytes would &lt;b&gt;always&lt;/b&gt; need to be reversed. Maybe that explains that it is sometimes slower?&lt;/p&gt;</comment>
                            <comment id="13441965" author="lhofhansl" created="Sat, 25 Aug 2012 21:15:05 +0000"  >&lt;p&gt;I meant X86 is little endian (not Linux of course)&lt;/p&gt;</comment>
                            <comment id="14490594" author="apurtell" created="Sat, 11 Apr 2015 00:20:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vrodionov&quot; class=&quot;user-hover&quot; rel=&quot;vrodionov&quot;&gt;Vladimir Rodionov&lt;/a&gt; later made this same optimization, which was committed&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12560247">HBASE-6200</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12525313" name="5915-v2.txt" size="12349" author="zhihyu@ebaysf.com" created="Wed, 2 May 2012 16:49:54 +0000"/>
                            <attachment id="12525264" name="hbase-5915.txt" size="12829" author="tlipcon" created="Wed, 2 May 2012 07:57:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 2 May 2012 14:01:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>237775</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00sc7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2523</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>