<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:46:31 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13772/HBASE-13772.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13772] Replication endpoints should restrict access to a limited set of principals</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13772</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Replication endpoints will accept RPC connections from any Kerberos principal that is trusted by the endpoint&apos;s local KDC. This is far too open and may allow for the establishment of rogue endpoints (in conjunction with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13771&quot; title=&quot;Replication clients should not access zookeeper directly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13771&quot;&gt;HBASE-13771&lt;/a&gt;). &lt;/p&gt;</description>
                <environment></environment>
        <key id="12832546">HBASE-13772</key>
            <summary>Replication endpoints should restrict access to a limited set of principals</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 May 2015 17:21:03 +0000</created>
                <updated>Sat, 18 Jun 2016 00:19:14 +0000</updated>
                                                            <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="14558396" author="apurtell" created="Mon, 25 May 2015 17:21:42 +0000"  >&lt;p&gt;Endpoints should restrict RPC access to only the HBase service principal, or, optionally, a specific principal specified in site configuration.&lt;/p&gt;

&lt;p&gt;I think this should be a blocker for all pending releases.&lt;/p&gt;</comment>
                            <comment id="14560141" author="apurtell" created="Tue, 26 May 2015 23:47:12 +0000"  >&lt;p&gt;When security is enabled and the AccessController is installed, it mediates replication RPC - AdminService#replicateWALEntry - and does not allow a sink to &lt;em&gt;receive&lt;/em&gt; WAL edits from non-superuser principals not granted GLOBAL WRITE permissions. We are protected from rogue sources. I went looking where we could add access control to core even if the AC is not installed. We could have the core replication code set up a list of allowed principals and restrict connections to this list (can be done in Replication), but the AC couldn&apos;t extend the set of allowed principals without an API change somewhere. I think it is fine to not add access checks to core here since the AC does provide coverage. Without the AccessController installed we don&apos;t check  other RPC actions either. &lt;/p&gt;

&lt;p&gt;The other issue is rogue sinks. The RegionCoprocessorHost has a hook for intercepting ReplicationEndpoint setup post creation (RegionServerObserver#postCreateReplicationEndPoint), but we are lacking a preCreateReplicationEndPoint hook to make an authoritative decision on whether to allow the endpoint to be created. We should add this hook (eventually) so random users cannot add replication peers, but until we fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13771&quot; title=&quot;Replication clients should not access zookeeper directly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13771&quot;&gt;HBASE-13771&lt;/a&gt; there&apos;s no opportunity to make an authoritative decision. The regionserver reacts to replication peer coordination state in ZK, it doesn&apos;t control it. We are running as the service principal and have no idea who might have added the ZK state. When replication admin actions go through the master via admin RPC we can mediate this in the AccessController and refuse to install endpoints for callers not granted sufficient privileges.&lt;/p&gt;

&lt;p&gt;Another possible option for defeating rogue sinks would be a check at connection setup that the remote principal is in the allowed set. Our RPC doesn&apos;t support this, though. Our connection security model is one way: The server checks if the client&apos;s principal is authorized to make the current request. The client always assumes the server is trusted. The client does learn the server&apos;s principal when setting up connections (and Kerberos mutual auth means the server has proved it) but we do not expose that information in any API. We only pass this information on to Java&apos;s SASL client. This is a bigger discussion than just replication. We have no support to check if a server&apos;s principal is in an allowed set for a given client request. Another way to state that is we don&apos;t have a client-side AccessController. &lt;/p&gt;

&lt;p&gt;For the purposes of this issue, I propose we fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13771&quot; title=&quot;Replication clients should not access zookeeper directly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13771&quot;&gt;HBASE-13771&lt;/a&gt; and as part of that work add a RegionServerObserver#preCreateReplicationEndPoint hook and support for it in the AccessController. Then only admins could possibly install rogue peers. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12832545">HBASE-13771</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 29 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f66f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>