<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:51:59 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1251/HBASE-1251.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1251] HConnectionManager.getConnection(HBaseConfiguration) returns same HConnection for different HBaseConfigurations </title>
                <link>https://issues.apache.org/jira/browse/HBASE-1251</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This occurs when the following happens:&lt;/p&gt;

&lt;p&gt;1. Consider a client that invokes HBaseAdmin.checkHBaseAvailable(config) before doing anything. Although this method copies the HBaseConfiguration object and sets hbase.client.retries.number to 1 (see HBaseAdmin, line 751), it creates an HBaseAdmin object, which invokes HConnectionManager.getConnection(conf). Please notice that this conf is that with hbase.client.retries.number equals to 1. &lt;br/&gt;
2. HConnectionManager.getConnection then creates a HConnection using this conf and puts it into a static map (see HConnectionManager, line 93) indexed by hbase.rootdir. &lt;br/&gt;
3. Then, if the same client now creates a HTable object (using, for instance, a HBaseConfiguration with  hbase.client.retries.number equals to 10 but the same hbase.rootdir), it will invoke HConnectionManager.getConnection(conf) again (see HTable, line 109). However, when it checks the static map for a HConnection it finds one - the one previously created by the HBaseAdmin object and using hbase.client.retries.number 1 - and returns it without creating a new one with the correct HBaseConfiguration.&lt;/p&gt;

&lt;p&gt;However, the expected behavior is: HConnectionManager must return different HConnections for different HBaseConfigurations.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12416529">HBASE-1251</key>
            <summary>HConnectionManager.getConnection(HBaseConfiguration) returns same HConnection for different HBaseConfigurations </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="guiga">Guilherme Mauro Germoglio Barbosa</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Mar 2009 13:29:32 +0000</created>
                <updated>Tue, 17 Aug 2010 21:27:54 +0000</updated>
                            <resolved>Fri, 13 Mar 2009 16:07:59 +0000</resolved>
                                    <version>0.19.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12680462" author="guiga" created="Tue, 10 Mar 2009 13:41:11 +0000"  >&lt;p&gt;I&apos;ve edited HConnectionManager in order to use all HBaseConfiguration instead of only HBASE_DIR as key on the HBASE_INSTANCES map. To do so, I&apos;ve implemented HBaseConfiguration.hashcode() - just like a HashMap.hashCode() is implemented.&lt;/p&gt;

&lt;p&gt;code review is needed. &lt;/p&gt;</comment>
                            <comment id="12680558" author="stack" created="Tue, 10 Mar 2009 17:54:49 +0000"  >&lt;p&gt;Patch looks great.&lt;/p&gt;

&lt;p&gt;Only downside I see is that if the HBC is changed &amp;#8211; a value added or edited &amp;#8211; then its hash will be different and we&apos;ll go build up a new TableServer but maybe this is your intent?&lt;/p&gt;

&lt;p&gt;On GSOC, figure what interests you Guilherme and lets make it happy.  Write me off-list if you&apos;d like.&lt;/p&gt;</comment>
                            <comment id="12680588" author="jimk" created="Tue, 10 Mar 2009 19:01:41 +0000"  >&lt;p&gt;The biggest downside I see is that since a new TableServers is built up if the configuration changes, the old TableServers will&lt;br/&gt;
be orphaned if the old configuration is never used again. The old TableServers cannot be garbage collected because the&lt;br/&gt;
HBASE_INSTANCES map still holds a reference to it. Could potentially use up a not insignificant amount of memory if this&lt;br/&gt;
is done too often.&lt;/p&gt;

&lt;p&gt;A couple of other comments:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Why add hash codes in HBaseConfiguration.hashCode rather than use xor ? I would think using ^= rather than += would produce a better hash value.&lt;/li&gt;
	&lt;li&gt;Some of the indentation is inconsistent. 4 spaces instead of two. That should be fixed.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12680934" author="guiga" created="Wed, 11 Mar 2009 17:18:46 +0000"  >&lt;p&gt;Stack:&lt;br/&gt;
yes, this is my intent. I think the best scenario would be the hash value be affected only when the values that are used for the creation of connections are modified. However, it would be quite annoying to maintain the list of these values for every release.   &lt;/p&gt;

&lt;p&gt;Jim:&lt;br/&gt;
I think the use of a WeakHashMap in HBASE_INSTANCES can solve the probem of old orphaned TableServers. What do you think? This way the old TableServers could be garbage collected. &lt;br/&gt;
Related to the hash code, I&apos;ve used addition because it is the way java.util.HashMaps compute their hash value (I have no argument against xor). &lt;/p&gt;</comment>
                            <comment id="12681429" author="guiga" created="Thu, 12 Mar 2009 18:21:02 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;indentation fixed&lt;/li&gt;
	&lt;li&gt;hash is now computed using xor&lt;/li&gt;
	&lt;li&gt;HBASE_INSTANCES is now a WeakHashMap in order to make orphan TableServers free to be garbage collected.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12681627" author="stack" created="Fri, 13 Mar 2009 06:31:52 +0000"  >&lt;p&gt;Patch looks great.  Thanks.&lt;/p&gt;

&lt;p&gt;If you want to figure out google summer of code project, write me off list; lets chat.&lt;/p&gt;</comment>
                            <comment id="12681817" author="stack" created="Fri, 13 Mar 2009 16:07:59 +0000"  >&lt;p&gt;Applied.  Thank you for the patch Guilherme.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12442297">HBASE-2027</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12471856">HBASE-2925</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12440510">HBASE-1976</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12402072" name="HBASE-1251.patch" size="9641" author="guiga" created="Thu, 12 Mar 2009 18:21:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 10 Mar 2009 17:54:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25647</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 41 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hc7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99241</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>