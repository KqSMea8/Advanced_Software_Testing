<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:17:13 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4246/HBASE-4246.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4246] Cluster with too many regions cannot withstand some master failover scenarios</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4246</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We ran into the following sequence of events:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master startup failed after only ROOT had been assigned (for another reason)&lt;/li&gt;
	&lt;li&gt;restarted the master without restarting other servers. Since there was at least one region assigned, it went through the failover code path&lt;/li&gt;
	&lt;li&gt;master scanned META and inserted every region into /hbase/unassigned in ZK.&lt;/li&gt;
	&lt;li&gt;then, it called &quot;listChildren&quot; on the /hbase/unassigned znode, and crashed with &quot;Packet len6080218 is out of range!&quot; since the IPC response was larger than the default maximum.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12519890">HBASE-4246</key>
            <summary>Cluster with too many regions cannot withstand some master failover scenarios</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Aug 2011 23:22:13 +0000</created>
                <updated>Wed, 16 Nov 2016 20:42:37 +0000</updated>
                            <resolved>Wed, 16 Nov 2016 20:42:37 +0000</resolved>
                                    <version>0.90.4</version>
                                                    <component>master</component>
                    <component>Zookeeper</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>16</watches>
                                                                <comments>
                            <comment id="13089870" author="tlipcon" created="Tue, 23 Aug 2011 23:28:44 +0000"  >&lt;p&gt;We were able to work around this issue by bumping jute.maxbuffer up to 100MB on the cluster in question.&lt;/p&gt;

&lt;p&gt;Another solution would be to shard the /hbase/unassigned dir by a prefix of the region ID. eg region 1234567890abcdef would go in /hbase/unassigned/1234/1234567890abcdef - so, we have to do a traversal to get the full list, but any particular RPC response is limited in size.&lt;/p&gt;</comment>
                            <comment id="13234514" author="lhofhansl" created="Wed, 21 Mar 2012 17:08:16 +0000"  >&lt;p&gt;Moving out of 0.94. Pull back if you feel otherwise.&lt;/p&gt;</comment>
                            <comment id="13397214" author="sunnygao" created="Wed, 20 Jun 2012 01:54:01 +0000"  >&lt;p&gt;Hi, It also happpened in our cluster when we restarted whole cluster(it has 129723 regions).&lt;/p&gt;

&lt;p&gt;2012-06-19 19:29:00,961 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:20000-0x137ed2eb936fb85 Creating (or updating) unassigned node for 80400ccd4a1f3438cc23774ca8a88d17 with OFFLINE state&lt;br/&gt;
2012-06-19 19:29:00,965 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=M_ZK_REGION_OFFLINE, server=172-16-6-2:20000, region=80400ccd4a1f3438cc23774ca8a88d17&lt;br/&gt;
2012-06-19 19:29:00,966 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:20000-0x137ed2eb936fb85 Creating (or updating) unassigned node for 7f1a56641906ae0a6cc6919bd927df76 with OFFLINE state&lt;br/&gt;
2012-06-19 19:29:00,969 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=M_ZK_REGION_OFFLINE, server=172-16-6-2:20000, region=7f1a56641906ae0a6cc6919bd927df76&lt;br/&gt;
2012-06-19 19:29:01,070 WARN org.apache.zookeeper.ClientCnxn: Session 0x137ed2eb936fb85 for server 172-16-6-1/172.16.6.1:2181, unexpected error, closing socket connection and attempting reconnect&lt;br/&gt;
2012-06-19 19:29:01,070 WARN org.apache.zookeeper.ClientCnxn: Session 0x137ed2eb936fb85 for server 172-16-6-1/172.16.6.1:2181, unexpected error, closing socket connection and attempting reconnect&lt;br/&gt;
java.io.IOException: Packet len4670048 is out of range!&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$SendThread.readLength(ClientCnxn.java:721)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$SendThread.doIO(ClientCnxn.java:880)&lt;br/&gt;
	at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1145)&lt;br/&gt;
2012-06-19 19:29:01,174 WARN org.apache.hadoop.hbase.zookeeper.ZKUtil: master:20000-0x137ed2eb936fb85 Unable to list children of znode /hbase/unassigned &lt;/p&gt;</comment>
                            <comment id="13397269" author="ram_krish" created="Wed, 20 Jun 2012 04:56:44 +0000"  >&lt;p&gt;@Gao&lt;br/&gt;
You got this in 0.90? or someother version?&lt;/p&gt;</comment>
                            <comment id="13397290" author="lakshman" created="Wed, 20 Jun 2012 06:24:12 +0000"  >&lt;p&gt;This may come in latest version also as we didn&apos;t change the znode hierarchy of the unassigned regions. As mentioned in linked issue, there is a cap on packet length. We can&apos;t read/write huge data in a single packet.&lt;/p&gt;

&lt;p&gt;IMO, to resolve this we need to do &lt;b&gt;either of the following&lt;/b&gt;.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;In HBASE: We can use hierarchical structure.&lt;br/&gt;
HDFS datanode follows similar strategy. It keeps block files in different sub directories to avoid FS lookup latency.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;In ZooKeeper: Increase the limit. What is reasonable?&lt;br/&gt;
We have tried this out in some other project but it has the side effects. When we tried read/write huge data from ZooKeeper, clients occassionally gets disconnected. This is sequential request processing. Please check out the related discussions @&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/zookeeper-user/201007.mbox/%3CC85A33EC.3A46A%25mahadev@yahoo-inc.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/zookeeper-user/201007.mbox/%3CC85A33EC.3A46A%25mahadev@yahoo-inc.com%3E&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Following JIRA and discussion also applicable in current scenario.&lt;br/&gt;
&lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/zookeeper-user/201104.mbox/%3CFFA3BDB6-1C83-42B9-B2A0-7675134626C5@me.com%3E&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/zookeeper-user/201104.mbox/%3CFFA3BDB6-1C83-42B9-B2A0-7675134626C5@me.com%3E&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1049&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-1049&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13398201" author="sunnygao" created="Thu, 21 Jun 2012 05:14:14 +0000"  >&lt;p&gt;The version is 0.90.X, I have asked the customer up jute.maxbuffer to 64M. &lt;/p&gt;</comment>
                            <comment id="13554659" author="devaraj" created="Wed, 16 Jan 2013 02:12:14 +0000"  >&lt;p&gt;Am downgrading the priority since there is a work-around (increase the buffer size).&lt;/p&gt;</comment>
                            <comment id="13555296" author="stack" created="Wed, 16 Jan 2013 18:22:27 +0000"  >&lt;p&gt;I added a note to troubleshooting doc in the master startup section.&lt;/p&gt;</comment>
                            <comment id="13555579" author="hudson" created="Wed, 16 Jan 2013 23:06:48 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3759 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3759/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3759/&lt;/a&gt;)&lt;br/&gt;
    Add to troubleshooting a note on zk buffer size issue when lots of regions &amp;#8211; hbase-4246 (Revision 1434087)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;/p&gt;</comment>
                            <comment id="13555786" author="hudson" created="Thu, 17 Jan 2013 03:16:13 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #351 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/351/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/351/&lt;/a&gt;)&lt;br/&gt;
    Add to troubleshooting a note on zk buffer size issue when lots of regions &amp;#8211; hbase-4246 (Revision 1434087)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;/p&gt;</comment>
                            <comment id="13639849" author="stack" created="Tue, 23 Apr 2013 23:48:38 +0000"  >&lt;p&gt;Not being worked on for 0.95.  Moving it out.  Leaving it around in case others run into the issue so they can find the workaround.  We should also consider doing the suggested hierarcherying (word?) in zk).&lt;/p&gt;</comment>
                            <comment id="15671565" author="stack" created="Wed, 16 Nov 2016 20:42:37 +0000"  >&lt;p&gt;Resolving as stale, no-longer-pertinent. Reopen if still issue in more modern hbase.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12604182">HBASE-6625</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12520055">ZOOKEEPER-1162</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 Mar 2012 17:08:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27231</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02bvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11526</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>