<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:52:55 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8196/HBASE-8196.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8196] Port HBASE-7721 Atomic multi-row mutations in META to 0.94</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8196</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There has been some interest in porting region merge (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7403&quot; title=&quot;Online Merge&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7403&quot;&gt;&lt;del&gt;HBASE-7403&lt;/del&gt;&lt;/a&gt;), and making splits more stable in 0.94. For online merge, we depend on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7721&quot; title=&quot;Atomic multi-row mutations in META&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7721&quot;&gt;&lt;del&gt;HBASE-7721&lt;/del&gt;&lt;/a&gt;, thus we might need the backport. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12639036">HBASE-8196</key>
            <summary>Port HBASE-7721 Atomic multi-row mutations in META to 0.94</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="enis">Enis Soztutar</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Mar 2013 03:45:30 +0000</created>
                <updated>Sat, 30 Mar 2013 06:26:44 +0000</updated>
                            <resolved>Fri, 29 Mar 2013 08:00:57 +0000</resolved>
                                    <version>0.94.7</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13613461" author="enis" created="Tue, 26 Mar 2013 03:50:22 +0000"  >&lt;p&gt;Attaching ported patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7721&quot; title=&quot;Atomic multi-row mutations in META&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7721&quot;&gt;&lt;del&gt;HBASE-7721&lt;/del&gt;&lt;/a&gt;. &lt;br/&gt;
This patch does not remove the master and SSH fixupDaughter parts, since we need them for rolling restarts. &lt;/p&gt;

&lt;p&gt;Although largish in size, this is not that intrusive. &lt;/p&gt;

&lt;p&gt;As usual, bringing this in is subject to discussion. We might be able to bring region merges without this, but there will be no guarantees in terms of fault tolerancy. &lt;/p&gt;</comment>
                            <comment id="13614003" author="jmspaggi" created="Tue, 26 Mar 2013 13:56:13 +0000"  >&lt;p&gt;My opinion: If we backport online region merge to 0.94, then we should make sure it&apos;s robust, and therefore we should include this update too.&lt;/p&gt;

&lt;p&gt;Two comments:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Are the modifications to hbase-env.sh and hbase-site.xml related to this patch?&lt;/li&gt;
	&lt;li&gt;Should this be un-commented? //LOG.warn(&quot;exception in loading coprocessor for the META table&quot;);&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13614390" author="enis" created="Tue, 26 Mar 2013 18:17:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Are the modifications to hbase-env.sh and hbase-site.xml related to this patch?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No, residual from some other thing. Will update the patch. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Should this be un-commented? //LOG.warn(&quot;exception in loading coprocessor for the META table&quot;);&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This was from the original patch. It was not caught in the review. I&apos;ll just take it out. &lt;/p&gt;

&lt;p&gt;Got the test results:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Results :

Failed tests:   testMultiCohortWithMemberTimeoutDuringPrepare(org.apache.hadoop.hbase.procedure.TestZKProcedure): (..)

Tests in error: 
  testMasterFailoverWithMockedRITOnDeadRS(org.apache.hadoop.hbase.master.TestMasterFailover): test timed out after 180000 milliseconds

Tests run: 1302, Failures: 1, Errors: 1, Skipped: 13
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Inspecting the MasterFailover test. &lt;/p&gt;</comment>
                            <comment id="13614718" author="jmhsieh" created="Wed, 27 Mar 2013 00:16:44 +0000"  >&lt;p&gt;Ok, a good chunk of this is ws comments changes.  Ideally we&apos;d have less of this in a review.&lt;/p&gt;

&lt;p&gt;Was this intentional? (enable as setting for another &quot;EXPERIMENTAL&quot; feature)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# Uncomment below &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; you intend to use the EXPERIMENTAL off heap cache.
-# export HBASE_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;$HBASE_OPTS -XX:MaxDirectMemorySize=&quot;&lt;/span&gt;
+export HBASE_OPTS=&lt;span class=&quot;code-quote&quot;&gt;&quot;$HBASE_OPTS -XX:MaxDirectMemorySize=2g&quot;&lt;/span&gt;
 # Set hbase.offheapcache.percentage in hbase-site.xml to a nonzero value.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Any compatibility concerns?  Can you spell out the cases?  In an upgrade situation, during splitting what happens when an old RS hosts META and get issued a call from the newer RS with the MultiRowMutationEndpoint coproc?  A bunch of code was removed &amp;#8211; would we have a problem if new RS hosting META being issued a meta mutation from an older splitting RS.&lt;/p&gt;

&lt;p&gt;Hopefully this would explain this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.balancer.setMasterServices(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
 
-    &lt;span class=&quot;code-comment&quot;&gt;// Fixing up missing daughters &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; any
&lt;/span&gt;+    &lt;span class=&quot;code-comment&quot;&gt;// Fixing up missing daughters &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; any.
&lt;/span&gt;+    &lt;span class=&quot;code-comment&quot;&gt;//After HBASE-7721, we &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not need &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, but we keep it since in 0.94 during
&lt;/span&gt;+    &lt;span class=&quot;code-comment&quot;&gt;//rolling restart &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; might be needed
&lt;/span&gt;     status.setStatus(&lt;span class=&quot;code-quote&quot;&gt;&quot;Fixing up missing daughters&quot;&lt;/span&gt;);
     fixupDaughters(status);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13614801" author="enis" created="Wed, 27 Mar 2013 01:54:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;Ok, a good chunk of this is ws comments changes. Ideally we&apos;d have less of this in a review.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agreed, but unless we fix the current formatting, and be more strict about the patches in, we will have to deal with it. &lt;br/&gt;
Thanks for taking a look. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Was this intentional? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No, see my earlier comments. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Any compatibility concerns? Can you spell out the cases?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Cases would be: &lt;br/&gt;
 (1) Old / new master &lt;br/&gt;
 (2) Old new META RS&lt;br/&gt;
 (3) Old new other RS&lt;br/&gt;
 (4) Master updated after META&lt;/p&gt;

&lt;p&gt;(1) is fine, since Master&apos;s and SSH&apos;s fixup checks have ben kept around. SSH processes dead regions by going through META.&lt;br/&gt;
(2) META server deploying new code wont be a problem. The old way will just work. META server having old version of the code, but RS&apos;s having newer versions might be. The META update in SplitTransaction will fail because of not deployed coprocessor, and it will cause RS to abort. We can do a quick check in SplitRequest to not split if META is not updated. &lt;br/&gt;
(3) This won&apos;t be a problem. &lt;br/&gt;
(4) Master updates the META table&apos;s definition. If master is updated after the META server, then the META server won&apos;t see the new META table def unless the region is reopened. &lt;/p&gt;

&lt;p&gt;Let me think about how we can handle 2 and 4 in a meaningful way. If not, we can abort. &lt;/p&gt;</comment>
                            <comment id="13617173" author="enis" created="Fri, 29 Mar 2013 08:00:57 +0000"  >&lt;p&gt;We are not backporting online merges (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8217&quot; title=&quot;Port online region merge (HBASE-7403) to 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8217&quot;&gt;&lt;del&gt;HBASE-8217&lt;/del&gt;&lt;/a&gt;). Without region merge, there is no need for this patch in 0.94. Closing this as won&apos;t fix. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12575464" name="hbase-7721_v4-0.94.patch" size="77429" author="enis" created="Tue, 26 Mar 2013 03:50:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 26 Mar 2013 13:56:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319506</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 38 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1j4nb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319847</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>