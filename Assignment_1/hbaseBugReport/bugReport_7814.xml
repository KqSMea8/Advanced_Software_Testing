<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:49:18 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7814/HBASE-7814.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7814] Port HBASE-6963 &apos;unable to run hbck on a secure cluster&apos; to 0.94</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7814</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description></description>
                <environment></environment>
        <key id="12631755">HBASE-7814</key>
            <summary>Port HBASE-6963 &apos;unable to run hbck on a secure cluster&apos; to 0.94</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Feb 2013 17:35:09 +0000</created>
                <updated>Sat, 23 Mar 2013 04:53:21 +0000</updated>
                            <resolved>Tue, 12 Feb 2013 22:02:11 +0000</resolved>
                                                    <fixVersion>0.94.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13576058" author="sershe" created="Mon, 11 Feb 2013 19:58:14 +0000"  >&lt;p&gt;Automatic port; I am running tests&lt;/p&gt;</comment>
                            <comment id="13576073" author="hadoopqa" created="Mon, 11 Feb 2013 20:11:17 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12568876/HBASE-7814-v0.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12568876/HBASE-7814-v0.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4416//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4416//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13576107" author="jxiang" created="Mon, 11 Feb 2013 20:47:37 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13576160" author="yuzhihong@gmail.com" created="Mon, 11 Feb 2013 21:56:51 +0000"  >&lt;p&gt;Integrated to 0.94&lt;/p&gt;

&lt;p&gt;Thanks for the patch, Sergey.&lt;/p&gt;

&lt;p&gt;Thanks for the review, Jimmy.&lt;/p&gt;</comment>
                            <comment id="13576183" author="hudson" created="Mon, 11 Feb 2013 22:42:30 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #836 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/836/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/836/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7814&quot; title=&quot;Port HBASE-6963 &amp;#39;unable to run hbck on a secure cluster&amp;#39; to 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7814&quot;&gt;&lt;del&gt;HBASE-7814&lt;/del&gt;&lt;/a&gt; Port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6963&quot; title=&quot;unable to run hbck on a secure cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6963&quot;&gt;&lt;del&gt;HBASE-6963&lt;/del&gt;&lt;/a&gt; &apos;unable to run hbck on a secure cluster&apos; to 0.94 (Sergey) (Revision 1444978)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13576232" author="jmhsieh" created="Tue, 12 Feb 2013 00:00:15 +0000"  >&lt;p&gt;There was a concern on the original &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6963&quot; title=&quot;unable to run hbck on a secure cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6963&quot;&gt;&lt;del&gt;HBASE-6963&lt;/del&gt;&lt;/a&gt; that this uses a Hadoop API that isn&apos;t available until hadoop 1.0.  Are we ok with requiring Hadoop 1.0 for 0.94 releases?  I thought that 0.96 was supposed to be the first only hadoop 1.0 requiring HBase.&lt;/p&gt;

&lt;p&gt;If &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; is ok with this being a new constraint, we should at the least  release note this.&lt;/p&gt;</comment>
                            <comment id="13576250" author="jmspaggi" created="Tue, 12 Feb 2013 00:34:14 +0000"  >&lt;p&gt;My opinion: I don&apos;t think such constraints should be introduced in a minor release like this one...&lt;/p&gt;</comment>
                            <comment id="13576253" author="lhofhansl" created="Tue, 12 Feb 2013 00:38:17 +0000"  >&lt;p&gt;I agree... I&apos;ll revert the patch. This is 0.94.6, so we can just do that. Unless there are objections I&apos;ll do that.&lt;/p&gt;</comment>
                            <comment id="13576254" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 00:38:43 +0000"  >&lt;p&gt;I didn&apos;t find the method in hadoop branch-0.20&lt;/p&gt;

&lt;p&gt;Reverted from 0.94 branch.&lt;/p&gt;

&lt;p&gt;Thanks for the reminder, Jon.&lt;/p&gt;</comment>
                            <comment id="13576255" author="jxiang" created="Tue, 12 Feb 2013 00:39:45 +0000"  >&lt;p&gt;Oh, I remember now why it is not checked in 0.94 before.  I remember the Hadoop API is in hadoop 0.22 as well, not sure about 0.20.&lt;/p&gt;</comment>
                            <comment id="13576292" author="lhofhansl" created="Tue, 12 Feb 2013 01:59:14 +0000"  >&lt;p&gt;Being able to run hbck on secure cluster seems pretty important, though.&lt;/p&gt;</comment>
                            <comment id="13576294" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 02:07:24 +0000"  >&lt;p&gt;I agree.&lt;br/&gt;
We can use reflection to detect whether the new API is supported &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13576303" author="lhofhansl" created="Tue, 12 Feb 2013 02:22:39 +0000"  >&lt;p&gt;OK... Reopened for 0.94.6 to think about it.&lt;/p&gt;</comment>
                            <comment id="13576307" author="hudson" created="Tue, 12 Feb 2013 02:33:51 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #837 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/837/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/837/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7814&quot; title=&quot;Port HBASE-6963 &amp;#39;unable to run hbck on a secure cluster&amp;#39; to 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7814&quot;&gt;&lt;del&gt;HBASE-7814&lt;/del&gt;&lt;/a&gt; revert due to hadoop 0.20 compatibility concern (Revision 1445004)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13576312" author="jmhsieh" created="Tue, 12 Feb 2013 02:47:05 +0000"  >&lt;p&gt;I&apos;m fine if this is done in a compatible way (and the gymnastics are commented if this is the case).&lt;/p&gt;</comment>
                            <comment id="13576793" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 17:22:35 +0000"  >&lt;p&gt;Patch v2 uses reflection to see if ugi.getShortUserName() is supported.&lt;/p&gt;

&lt;p&gt;checkAccess() is only called by hbck at the beginning of the execution. So performance impact is negligible.&lt;/p&gt;</comment>
                            <comment id="13576844" author="jmhsieh" created="Tue, 12 Feb 2013 18:14:46 +0000"  >&lt;p&gt;So this requires means this won&apos;t compile unless we compile against hadoop 1.0+/.22+ but the binary should work against the older hadoop right?  I think I&apos;m ok with that but please add comment and release note about this.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// See HBASE-7814. UserGroupInformation from hadoop 0.20.x may not support getShortUserName().
&lt;/span&gt;+    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; username;
+    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+      UserGroupInformation.class.getMethod(&lt;span class=&quot;code-quote&quot;&gt;&quot;getShortUserName&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt;[]{});
+      username = ugi.getShortUserName();
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can we be more specific about the Exception &amp;#8211; maybe figure out what the specific reflection exception is and use it?  &lt;/p&gt;</comment>
                            <comment id="13576850" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 18:18:14 +0000"  >&lt;p&gt;I followed the same style in existing code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isInSafeMode(DistributedFileSystem dfs) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; inSafeMode = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      Method m = DistributedFileSystem.class.getMethod(&lt;span class=&quot;code-quote&quot;&gt;&quot;setSafeMode&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;?&amp;gt; []{
          org.apache.hadoop.hdfs.protocol.FSConstants.SafeModeAction.class, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;.class});
      inSafeMode = (&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;) m.invoke(dfs,
        org.apache.hadoop.hdfs.protocol.FSConstants.SafeModeAction.SAFEMODE_GET, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13576855" author="sershe" created="Tue, 12 Feb 2013 18:19:26 +0000"  >&lt;p&gt;Why not invoke the method via reflection instead to avoid potential compilation issues? Doesn&apos;t appear like perf would matter here.&lt;br/&gt;
Also, what if getShortUserName throws some logical exception, +1 to specific exception, or moving the call out of this try-catch&lt;/p&gt;</comment>
                            <comment id="13576864" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 18:32:55 +0000"  >&lt;p&gt;Patch v3 invokes the method from Method object obtained through reflection.&lt;/p&gt;</comment>
                            <comment id="13576871" author="jmhsieh" created="Tue, 12 Feb 2013 18:38:18 +0000"  >&lt;p&gt;I agree with Sergey.  The v3 invoke is better.  Let&apos;s get the specific exception as well.&lt;/p&gt;</comment>
                            <comment id="13576880" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 18:51:07 +0000"  >&lt;p&gt;Patch v4 deals with individual exceptions.&lt;/p&gt;</comment>
                            <comment id="13576887" author="jmhsieh" created="Tue, 12 Feb 2013 18:55:32 +0000"  >&lt;p&gt;lgtm. ideally this is tested before commit (tweak the pom to use an older hadoop jar?).&lt;/p&gt;</comment>
                            <comment id="13576910" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 19:22:00 +0000"  >&lt;p&gt;I looked through 0.92 pom.xml and found no profile for hadoop 0.20.x&lt;br/&gt;
I ran the following command with patch and it passed:&lt;/p&gt;

&lt;p&gt;mvn clean test -PlocalTests,security -Dtest=TestHBaseFsck&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;:&lt;br/&gt;
Do you want to take a look at patch v4 ?&lt;/p&gt;</comment>
                            <comment id="13577044" author="lhofhansl" created="Tue, 12 Feb 2013 21:42:12 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;(Test with older version would be nice, but the change is obvious enough that I would not make that a requirement.)&lt;/p&gt;</comment>
                            <comment id="13577053" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 21:50:07 +0000"  >&lt;p&gt;Integrated to 0.94&lt;/p&gt;

&lt;p&gt;Thanks for the reviews, Jon, Sergey and Lars.&lt;/p&gt;</comment>
                            <comment id="13577137" author="hudson" created="Tue, 12 Feb 2013 23:10:23 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #840 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/840/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/840/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7814&quot; title=&quot;Port HBASE-6963 &amp;#39;unable to run hbck on a secure cluster&amp;#39; to 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7814&quot;&gt;&lt;del&gt;HBASE-7814&lt;/del&gt;&lt;/a&gt; Port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6963&quot; title=&quot;unable to run hbck on a secure cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6963&quot;&gt;&lt;del&gt;HBASE-6963&lt;/del&gt;&lt;/a&gt; &apos;unable to run hbck on a secure cluster&apos; to 0.94 (Revision 1445405)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13577166" author="hudson" created="Tue, 12 Feb 2013 23:32:27 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #110 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/110/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/110/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7814&quot; title=&quot;Port HBASE-6963 &amp;#39;unable to run hbck on a secure cluster&amp;#39; to 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7814&quot;&gt;&lt;del&gt;HBASE-7814&lt;/del&gt;&lt;/a&gt; Port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6963&quot; title=&quot;unable to run hbck on a secure cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6963&quot;&gt;&lt;del&gt;HBASE-6963&lt;/del&gt;&lt;/a&gt; &apos;unable to run hbck on a secure cluster&apos; to 0.94 (Revision 1445405)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7814&quot; title=&quot;Port HBASE-6963 &amp;#39;unable to run hbck on a secure cluster&amp;#39; to 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7814&quot;&gt;&lt;del&gt;HBASE-7814&lt;/del&gt;&lt;/a&gt; revert due to hadoop 0.20 compatibility concern (Revision 1445004)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7814&quot; title=&quot;Port HBASE-6963 &amp;#39;unable to run hbck on a secure cluster&amp;#39; to 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7814&quot;&gt;&lt;del&gt;HBASE-7814&lt;/del&gt;&lt;/a&gt; Port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6963&quot; title=&quot;unable to run hbck on a secure cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6963&quot;&gt;&lt;del&gt;HBASE-6963&lt;/del&gt;&lt;/a&gt; &apos;unable to run hbck on a secure cluster&apos; to 0.94 (Sergey) (Revision 1444978)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13577202" author="enis" created="Wed, 13 Feb 2013 00:13:03 +0000"  >&lt;p&gt;Sorry to come in late, but doesn&apos;t o.a.h.hbase.User.getShortName() solves your problem, instead of this exception catching. Shall I create a new issue to replace that? &lt;/p&gt;</comment>
                            <comment id="13577206" author="yuzhihong@gmail.com" created="Wed, 13 Feb 2013 00:16:39 +0000"  >&lt;p&gt;I checked src/core/org/apache/hadoop/security/User.java under 0.20 hadoop&lt;/p&gt;

&lt;p&gt;This method is not there.&lt;/p&gt;</comment>
                            <comment id="13577208" author="lhofhansl" created="Wed, 13 Feb 2013 00:19:36 +0000"  >&lt;p&gt;Oh. Good call, &lt;span class=&quot;error&quot;&gt;&amp;#91;~enis-2&amp;#93;&lt;/span&gt;.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuzhihong%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yuzhihong@gmail.com&quot;&gt;Ted Yu&lt;/a&gt; This is the User in the hbase package.&lt;/p&gt;</comment>
                            <comment id="13577209" author="lhofhansl" created="Wed, 13 Feb 2013 00:20:59 +0000"  >&lt;p&gt;Well... Only that that call would fail with an exception if that method does not exist.&lt;/p&gt;</comment>
                            <comment id="13577226" author="enis" created="Wed, 13 Feb 2013 00:41:14 +0000"  >&lt;p&gt;Why do you think it will fail with exception. This is HadoopUser:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getShortName() {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ugi != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? ugi.getUserName() : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and this is SecureHadoopUser: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; getShortName() {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (shortName != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; shortName;
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        shortName = (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)call(ugi, &lt;span class=&quot;code-quote&quot;&gt;&quot;getShortUserName&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
      ...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13577228" author="lhofhansl" created="Wed, 13 Feb 2013 00:44:58 +0000"  >&lt;p&gt;This will fail if getShortUserName does not exist, no?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
shortName = (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;)call(ugi, &lt;span class=&quot;code-quote&quot;&gt;&quot;getShortUserName&quot;&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Maybe I&apos;m misreading the code.&lt;/p&gt;</comment>
                            <comment id="13577231" author="enis" created="Wed, 13 Feb 2013 00:46:14 +0000"  >&lt;p&gt;Ok, created &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7832&quot; title=&quot;Use User.getShortName() in FSUtils&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7832&quot;&gt;&lt;del&gt;HBASE-7832&lt;/del&gt;&lt;/a&gt; to proceed. &lt;/p&gt;</comment>
                            <comment id="13577258" author="enis" created="Wed, 13 Feb 2013 01:30:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;This will fail if getShortUserName does not exist&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;From my understanding, we will only call getShortName() when we are using SecureHadoopUser, instead of HadoopUser. See getCurrent():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /**
   * Returns the {@code User} instance within current execution context.
   */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; User getCurrent() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    User user;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (IS_SECURE_HADOOP) {
      user = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SecureHadoopUser();
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      user = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HadoopUser();
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (user.getUGI() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; user;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SecureHadoopUser is a misnomer. IS_SECURE_HADOOP is set only when we can call the isSecurityEnabled() method (it is not security enabled, but rather whether we are using a Hadoop version which has security API). My understanding is that if underlying hadoop does not support security, we will default to using HadoopUser. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /**
   * Flag to differentiate between API-incompatible changes to
   * {@link org.apache.hadoop.security.UserGroupInformation} between vanilla
   * Hadoop 0.20.x and secure Hadoop 0.20+.
   */
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; IS_SECURE_HADOOP = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      UserGroupInformation.class.getMethod(&lt;span class=&quot;code-quote&quot;&gt;&quot;isSecurityEnabled&quot;&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (NoSuchMethodException nsme) {
      IS_SECURE_HADOOP = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13577794" author="ghelmling" created="Wed, 13 Feb 2013 18:14:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;IS_SECURE_HADOOP is set only when we can call the isSecurityEnabled() method (it is not security enabled, but rather whether we are using a Hadoop version which has security API). My understanding is that if underlying hadoop does not support security, we will default to using HadoopUser.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, the User class was added to abstract out the UserGroupInformation API changes between 0.20.x Hadoop (pre-security) and 0.20.203+ (with security).  It should be used in cases like this.&lt;/p&gt;</comment>
                            <comment id="13593163" author="hudson" created="Tue, 5 Mar 2013 07:52:09 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #12 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/12/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/12/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7814&quot; title=&quot;Port HBASE-6963 &amp;#39;unable to run hbck on a secure cluster&amp;#39; to 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7814&quot;&gt;&lt;del&gt;HBASE-7814&lt;/del&gt;&lt;/a&gt; Port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6963&quot; title=&quot;unable to run hbck on a secure cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6963&quot;&gt;&lt;del&gt;HBASE-6963&lt;/del&gt;&lt;/a&gt; &apos;unable to run hbck on a secure cluster&apos; to 0.94 (Revision 1445405)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7814&quot; title=&quot;Port HBASE-6963 &amp;#39;unable to run hbck on a secure cluster&amp;#39; to 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7814&quot;&gt;&lt;del&gt;HBASE-7814&lt;/del&gt;&lt;/a&gt; revert due to hadoop 0.20 compatibility concern (Revision 1445004)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7814&quot; title=&quot;Port HBASE-6963 &amp;#39;unable to run hbck on a secure cluster&amp;#39; to 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7814&quot;&gt;&lt;del&gt;HBASE-7814&lt;/del&gt;&lt;/a&gt; Port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6963&quot; title=&quot;unable to run hbck on a secure cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6963&quot;&gt;&lt;del&gt;HBASE-6963&lt;/del&gt;&lt;/a&gt; &apos;unable to run hbck on a secure cluster&apos; to 0.94 (Sergey) (Revision 1444978)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12632121">HBASE-7832</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12569016" name="7814-v2.txt" size="1301" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 17:22:35 +0000"/>
                            <attachment id="12569034" name="7814-v3.txt" size="1312" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 18:32:18 +0000"/>
                            <attachment id="12569037" name="7814-v4.txt" size="1761" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 18:51:07 +0000"/>
                            <attachment id="12568876" name="HBASE-7814-v0.patch" size="1049" author="sershe" created="Mon, 11 Feb 2013 19:58:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Feb 2013 19:58:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312251</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 41 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hvwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312597</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>