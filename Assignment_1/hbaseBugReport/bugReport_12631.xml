<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:34:53 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12631/HBASE-12631.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12631] Backport HBASE-12576 (Add metrics for rolling the HLog if there are too few DN&apos;s in the write pipeline) to 0.98</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12631</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description></description>
                <environment></environment>
        <key id="12759320">HBASE-12631</key>
            <summary>Backport HBASE-12576 (Add metrics for rolling the HLog if there are too few DN&apos;s in the write pipeline) to 0.98</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="apurtell">Andrew Purtell</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Dec 2014 00:14:05 +0000</created>
                <updated>Fri, 20 Nov 2015 11:55:58 +0000</updated>
                            <resolved>Thu, 11 Dec 2014 02:56:29 +0000</resolved>
                                                    <fixVersion>0.98.9</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="14241424" author="apurtell" created="Wed, 10 Dec 2014 17:35:42 +0000"  >&lt;p&gt;Here&apos;s a backport patch. Only private annotated interfaces are changed. (And I checked Phoenix as a prominent user of internals and it is not affected.) &lt;/p&gt;</comment>
                            <comment id="14241426" author="apurtell" created="Wed, 10 Dec 2014 17:36:03 +0000"  >&lt;p&gt;Setting patch available but Jenkins will fail to apply 0.98 patch to precommit build.&lt;/p&gt;

&lt;p&gt;The updated unit tests all pass locally. I&apos;ll be back once the full unit test suite completes. &lt;/p&gt;</comment>
                            <comment id="14241437" author="hadoopqa" created="Wed, 10 Dec 2014 17:42:25 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12686305/HBASE-12631-0.98.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12686305/HBASE-12631-0.98.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 84b41f8029fd5822832255daeee73ff2283a622a.&lt;br/&gt;
  ATTACHMENT ID: 12686305&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 28 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12042//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12042//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14241485" author="yuzhihong@gmail.com" created="Wed, 10 Dec 2014 18:20:54 +0000"  >&lt;p&gt;+1 if tests pass.&lt;/p&gt;</comment>
                            <comment id="14241613" author="apurtell" created="Wed, 10 Dec 2014 19:57:16 +0000"  >&lt;p&gt;All 0.98 unit tests passed with no failures&lt;/p&gt;</comment>
                            <comment id="14241696" author="busbey" created="Wed, 10 Dec 2014 20:43:00 +0000"  >&lt;p&gt;In 0.98 MetricsWAL isn&apos;t a WALActionsListener, so it isn&apos;t on the list that is notified about roll requests. &lt;/p&gt;

&lt;p&gt;I think this addition to FSHLog.java will make everything do what you want.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void requestLogRoll(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; tooFewReplicas) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.listeners.isEmpty()) {
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (WALActionsListener i: &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.listeners) {
        i.logRollRequested(tooFewReplicas);
      }
    }
+  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.metrics.logRollRequested(tooFewReplicas);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m not sure how much we should care about the test gap to cover this.&lt;/p&gt;</comment>
                            <comment id="14241726" author="apurtell" created="Wed, 10 Dec 2014 21:06:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;In 0.98 MetricsWAL isn&apos;t a WALActionsListener, so it isn&apos;t on the list that is notified about roll requests.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ugh, well that&apos;s a big problem I didn&apos;t notice. Let me fix it. Thanks for looking this over.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I &apos;m not sure how much we should care about the test gap to cover this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There&apos;s a new test TestMetricsWAL, but unfortunately it&apos;s a small mock. I will look for a place where we can check log rolling metrics with a minicluster.  TestLogRolling didn&apos;t catch this because it registers its own listener.&lt;/p&gt;</comment>
                            <comment id="14241912" author="apurtell" created="Wed, 10 Dec 2014 23:10:02 +0000"  >&lt;p&gt;Here&apos;s an updated patch that updates MetricsWAL to implement WALActionsListener, and updates FSHLog to register its MetricsWAL instance as a listener. I looked at updating TestLogRolling, but abandoned those changes after adding two VisibleForTesting methods and a bunch of Mockito code that didn&apos;t yet work... Could revisit this later. The registration of MetricsWAL as an actions listener will address what &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt; pointed out.&lt;/p&gt;</comment>
                            <comment id="14241919" author="apurtell" created="Wed, 10 Dec 2014 23:13:04 +0000"  >&lt;p&gt;Add missing @Override annotation on MetricsWAL#logRollRequested&lt;/p&gt;</comment>
                            <comment id="14242048" author="apurtell" created="Thu, 11 Dec 2014 02:56:29 +0000"  >&lt;p&gt;Pushed to 0.98&lt;/p&gt;</comment>
                            <comment id="14242085" author="busbey" created="Thu, 11 Dec 2014 03:49:26 +0000"  >&lt;p&gt;Here&apos;s my late +1, delayed by infra issue.&lt;/p&gt;</comment>
                            <comment id="14242164" author="hudson" created="Thu, 11 Dec 2014 05:20:07 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #734 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/734/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/734/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12631&quot; title=&quot;Backport HBASE-12576 (Add metrics for rolling the HLog if there are too few DN&amp;#39;s in the write pipeline) to 0.98&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12631&quot;&gt;&lt;del&gt;HBASE-12631&lt;/del&gt;&lt;/a&gt; Backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12576&quot; title=&quot;Add metrics for rolling the HLog if there are too few DN&amp;#39;s in the write pipeline&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12576&quot;&gt;&lt;del&gt;HBASE-12576&lt;/del&gt;&lt;/a&gt; (Add metrics for rolling the HLog if there are too few DNs in the write pipeline) to 0.98 (apurtell: rev bc594c0793b5cbeedccf7633d96e901626685ec9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestLogRolling.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/Replication.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/MetricsWAL.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestMetricsWAL.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/WALActionsListener.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop-compat/src/main/java/org/apache/hadoop/hbase/regionserver/wal/MetricsWALSource.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/wal/MetricsWALSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestLogRollPeriod.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestWALActionsListener.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestHLog.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/regionserver/wal/MetricsWALSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/LogRoller.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportExport.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14242179" author="hudson" created="Thu, 11 Dec 2014 05:34:37 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #701 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/701/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/701/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12631&quot; title=&quot;Backport HBASE-12576 (Add metrics for rolling the HLog if there are too few DN&amp;#39;s in the write pipeline) to 0.98&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12631&quot;&gt;&lt;del&gt;HBASE-12631&lt;/del&gt;&lt;/a&gt; Backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12576&quot; title=&quot;Add metrics for rolling the HLog if there are too few DN&amp;#39;s in the write pipeline&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12576&quot;&gt;&lt;del&gt;HBASE-12576&lt;/del&gt;&lt;/a&gt; (Add metrics for rolling the HLog if there are too few DNs in the write pipeline) to 0.98 (apurtell: rev bc594c0793b5cbeedccf7633d96e901626685ec9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/LogRoller.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/Replication.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestHLog.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop1-compat/src/main/java/org/apache/hadoop/hbase/regionserver/wal/MetricsWALSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/WALActionsListener.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestLogRollPeriod.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop-compat/src/main/java/org/apache/hadoop/hbase/regionserver/wal/MetricsWALSource.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestMetricsWAL.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/wal/MetricsWALSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportExport.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationHLogReaderManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/MetricsWAL.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestWALActionsListener.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestLogRolling.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15016624" author="lars_francke" created="Fri, 20 Nov 2015 11:55:58 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12757765">HBASE-12576</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12686403" name="HBASE-12631-0.98.patch" size="24663" author="apurtell" created="Wed, 10 Dec 2014 23:13:04 +0000"/>
                            <attachment id="12686401" name="HBASE-12631-0.98.patch" size="24649" author="apurtell" created="Wed, 10 Dec 2014 23:10:02 +0000"/>
                            <attachment id="12686305" name="HBASE-12631-0.98.patch" size="23225" author="apurtell" created="Wed, 10 Dec 2014 17:35:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 10 Dec 2014 17:42:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i231dr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>