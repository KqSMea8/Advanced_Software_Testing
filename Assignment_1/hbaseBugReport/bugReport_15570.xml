<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:04:58 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-15570/HBASE-15570.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-15570] renewable delegation tokens for long-lived spark applications</title>
                <link>https://issues.apache.org/jira/browse/HBASE-15570</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Right now our spark integration works on secure clusters by getting delegation tokens and sending them to the executors. Unfortunately, applications that need to run for longer than the delegation token lifetime (by default 7 days) will fail.&lt;/p&gt;

&lt;p&gt;In particular, this is an issue for Spark Streaming applications. Since they expect to run indefinitely, we should have a means for renewing the delegation tokens.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12954975">HBASE-15570</key>
            <summary>renewable delegation tokens for long-lived spark applications</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="busbey">Sean Busbey</assignee>
                                    <reporter username="busbey">Sean Busbey</reporter>
                        <labels>
                    </labels>
                <created>Thu, 31 Mar 2016 14:21:38 +0000</created>
                <updated>Tue, 13 Sep 2016 15:00:34 +0000</updated>
                                                                            <component>spark</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="15220050" author="ndimiduk" created="Thu, 31 Mar 2016 15:37:29 +0000"  >&lt;p&gt;Is this specific to the Spark integration? Does it apply to OutputFormat implementations as well &amp;#8211; ie, Spark/Flink Streaming writing through OutputFormat.&lt;/p&gt;</comment>
                            <comment id="15220071" author="busbey" created="Thu, 31 Mar 2016 15:50:10 +0000"  >&lt;p&gt;I have been under the assumption that our plan wrt Spark was that we&apos;d support folks using our dedicated module rather than leveraging the MR IO Formats, since those were designed with batch jobs in mind. Unless the solution here gets us the MR IO Formats coincidentally, I guess we should have a dev@ discussion about that? Folks using the MR formats can always use keytab based logins on executors to handle the renewing themselves (&lt;a href=&quot;https://github.com/saintstack/hbase-downstreamer/pull/6&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;ref&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;I was planning to fix this in the hbase-spark module, so I don&apos;t think anything I do here will help Flink folks. Do we need to look into having an hbase-flink module as well? Is there sufficient community interest to support it?&lt;/p&gt;</comment>
                            <comment id="15220236" author="ghelmling" created="Thu, 31 Mar 2016 17:11:27 +0000"  >&lt;p&gt;The way we dealt with this issue in Apache Twill, which also supports &quot;run-forever&quot; applications on YARN, is to have the controller process which submits the application (which also has kerberos credentials) periodically request new delegation tokens for each of the needed services and push these down to the running containers.&lt;/p&gt;

&lt;p&gt;How were you planning to tackle this?  Would the renewer have kerberos credentials?  Would we start tracking token expiration times on the server side or would updated tokens be issued?&lt;/p&gt;</comment>
                            <comment id="15220308" author="busbey" created="Thu, 31 Mar 2016 17:45:49 +0000"  >&lt;p&gt;My hope is to piggy back on the renewal that Spark already has for HDFS (or atleast ape it so that eventual integration can happen).&lt;/p&gt;

&lt;p&gt;My understanding from reading through that code is that the AM has a keytab, it periodically renews its kerberos credentials if needed, and periodically requests new delegation tokens that it pushes out to the executors.&lt;/p&gt;

&lt;p&gt;I&apos;d strongly prefer to avoid changing the way the HBase server side handles tokens, so it&apos;d be new tokens most likely.&lt;/p&gt;</comment>
                            <comment id="15220402" author="ghelmling" created="Thu, 31 Mar 2016 18:29:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;d strongly prefer to avoid changing the way the HBase server side handles tokens, so it&apos;d be new tokens most likely.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1 to that.&lt;/p&gt;

&lt;p&gt;I&apos;m really not familiar with the spark code.  So they push a keytab into HDFS for the AM?  That seems iffy, but should have the same effect as the Twill approach.  Does the Spark AM then push out updated tokens to the running containers?&lt;/p&gt;

&lt;p&gt;FWIW, the Twill token update happens here in updateSecureStores / updateCredentials: &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=incubator-twill.git;a=blob_plain;f=twill-yarn/src/main/java/org/apache/twill/yarn/YarnTwillRunnerService.java;hb=HEAD&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://git-wip-us.apache.org/repos/asf?p=incubator-twill.git;a=blob_plain;f=twill-yarn/src/main/java/org/apache/twill/yarn/YarnTwillRunnerService.java;hb=HEAD&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15487438" author="busbey" created="Tue, 13 Sep 2016 15:00:34 +0000"  >&lt;p&gt;Maybe superceded by &lt;a href=&quot;https://issues.apache.org/jira/browse/SPARK-14743&quot; title=&quot;Improve delegation token handling in secure clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;SPARK-14743&quot;&gt;&lt;del&gt;SPARK-14743&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12960205">SPARK-14743</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 31 Mar 2016 15:37:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vglr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>