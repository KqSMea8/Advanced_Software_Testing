<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:50:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1076/HBASE-1076.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1076] CME in HStore.notifyChangedReadersObservers</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1076</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Running latest trunk plus jimk&apos;s patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-543&quot; title=&quot;A region&amp;#39;s state is kept in several places in the master opening the possibility for race conditions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-543&quot;&gt;&lt;del&gt;HBASE-543&lt;/del&gt;&lt;/a&gt;: &lt;/p&gt;

&lt;p&gt;2008-12-21 12:47:31,741 DEBUG org.apache.hadoop.hbase.regionserver.HStoreScanner&lt;br/&gt;
: Added a StoreFileScanner to outstanding HStoreScanner&lt;br/&gt;
2008-12-21 12:47:31,741 FATAL org.apache.hadoop.hbase.regionserver.MemcacheFlusher: Replay of hlog required. Forcing server shutdown&lt;br/&gt;
org.apache.hadoop.hbase.DroppedSnapshotException: region: urls,http|playvideogame.net|,1229725620550&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:880)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:773)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.flushRegion(MemcacheFlusher.java:228)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.flushSomeRegions(MemcacheFlusher.java:292)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.reclaimMemcacheMemory(MemcacheFlusher.java:262)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.batchUpdates(HRegionServer.java:1594)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor12.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:632)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:894)&lt;br/&gt;
Caused by: java.util.ConcurrentModificationException&lt;br/&gt;
        at java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)&lt;br/&gt;
        at java.util.HashMap$KeyIterator.next(HashMap.java:828)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.notifyChangedReadersObservers(HStore.java:736)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.updateReaders(HStore.java:724)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.internalFlushCache(HStore.java:693)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:629)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:865)&lt;br/&gt;
        ... 10 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12411118">HBASE-1076</key>
            <summary>CME in HStore.notifyChangedReadersObservers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Sun, 21 Dec 2008 16:28:47 +0000</created>
                <updated>Sun, 26 Jan 2014 19:44:19 +0000</updated>
                            <resolved>Sun, 26 Jan 2014 19:44:19 +0000</resolved>
                                    <version>0.19.1</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12658426" author="stack" created="Sun, 21 Dec 2008 23:35:19 +0000"  >&lt;p&gt;You were riding with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1059&quot; title=&quot;ConcurrentModificationException in notifyChangedReadersObservers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1059&quot;&gt;&lt;del&gt;HBASE-1059&lt;/del&gt;&lt;/a&gt; in place Andrew?&lt;/p&gt;</comment>
                            <comment id="12658433" author="apurtell" created="Mon, 22 Dec 2008 02:31:48 +0000"  >&lt;p&gt;Yes. Just checked the source now to confirm. &lt;/p&gt;</comment>
                            <comment id="12658631" author="stack" created="Mon, 22 Dec 2008 19:22:57 +0000"  >&lt;p&gt;Not sure why we&apos;re getting this (Maybe someone else has an opinion).  &lt;/p&gt;

&lt;p&gt;Attached patch tries new tactic &amp;#8211; uses concurrent Set that does not throw a CME (loose view).  Will try it on my own cluster here first before committing so others can try.&lt;/p&gt;</comment>
                            <comment id="12658635" author="stack" created="Mon, 22 Dec 2008 19:26:44 +0000"  >&lt;p&gt;Deleted patch; needs comparables.&lt;/p&gt;</comment>
                            <comment id="12660019" author="apurtell" created="Wed, 31 Dec 2008 04:49:44 +0000"  >&lt;p&gt;Latest trunk.&lt;/p&gt;

&lt;p&gt;2008-12-31 04:38:12,941 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Started memcache flush for region urls,http|languroo.com|,1230685581293. Current region memcache size 64.0m&lt;br/&gt;
2008-12-31 04:38:12,987 DEBUG org.apache.hadoop.hbase.regionserver.HStoreScanner: Added a StoreFileScanner to outstanding HStoreScanner&lt;br/&gt;
2008-12-31 04:38:12,987 FATAL org.apache.hadoop.hbase.regionserver.MemcacheFlusher: Replay of hlog required. Forcing server shutdown&lt;br/&gt;
org.apache.hadoop.hbase.DroppedSnapshotException: region: urls,http|languroo.com|,1230685581293&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:880)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:773)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.flushRegion(MemcacheFlusher.java:227)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.run(MemcacheFlusher.java:137)&lt;br/&gt;
Caused by: java.util.ConcurrentModificationException&lt;br/&gt;
        at java.util.HashMap$HashIterator.nextEntry(HashMap.java:793)&lt;br/&gt;
        at java.util.HashMap$KeyIterator.next(HashMap.java:828)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.notifyChangedReadersObservers(HStore.java:735)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.updateReaders(HStore.java:723)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.internalFlushCache(HStore.java:692)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:628)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:865)&lt;br/&gt;
        ... 3 more&lt;/p&gt;</comment>
                            <comment id="12660027" author="stack" created="Wed, 31 Dec 2008 06:27:26 +0000"  >&lt;p&gt;Removed synchronzation.  Put in place instead &lt;a href=&quot;http://java.sun.com/javase/6/docs/api/java/util/concurrent/CopyOnWriteArraySet.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/javase/6/docs/api/java/util/concurrent/CopyOnWriteArraySet.html&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12660173" author="apurtell" created="Thu, 1 Jan 2009 02:15:45 +0000"  >&lt;p&gt;+1 on the patch. Strategy of it is sound. Haven&apos;t seen the CME on my cluster after heavy testing for 12 hours. Will continue to watch for it. Suggest resolving this issue. We can reopen it if necessary.&lt;/p&gt;</comment>
                            <comment id="12660176" author="stack" created="Thu, 1 Jan 2009 02:23:35 +0000"  >&lt;p&gt;Thanks for testing and review Andrew.  Resolving.&lt;/p&gt;</comment>
                            <comment id="12716678" author="apurtell" created="Fri, 5 Jun 2009 17:20:34 +0000"  >&lt;p&gt;This was not actually fixed in 0.19.0, because it has been seen again on 0.19.1:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-04-28 22:06:47,712 FATAL org.apache.hadoop.hbase.regionserver.MemcacheFlusher: Replay of
hlog required. Forcing server shutdown
org.apache.hadoop.hbase.DroppedSnapshotException: region: urls,067656272028042009-0000000000000046441-10.64.67.48,1240925392960
       at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:896)
       at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:789)
       at 
org.apache.hadoop.hbase.regionserver.MemcacheFlusher.flushRegion(MemcacheFlusher.java:227)
       at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.run(MemcacheFlusher.java:137)
Caused by: java.lang.NullPointerException
       at org.apache.hadoop.hbase.regionserver.HStoreScanner.updateReaders(HStoreScanner.java:330)
       at org.apache.hadoop.hbase.regionserver.HStore.notifyChangedReadersObservers(HStore.java:737)
       at org.apache.hadoop.hbase.regionserver.HStore.updateReaders(HStore.java:725)
       at org.apache.hadoop.hbase.regionserver.HStore.internalFlushCache(HStore.java:694)
       at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:630)
       at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:881)
       ... 3 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12716710" author="stack" created="Fri, 5 Jun 2009 18:30:58 +0000"  >&lt;p&gt;This is not a CME.  Its NPE.&lt;/p&gt;

&lt;p&gt;Here is code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
328       MapFile.Reader [] readers = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.store.getReaders();
329       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.scanners[HSFS_INDEX] == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; readers != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp;
330           readers.length &amp;gt; 0) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Its not the this.store because that is never cleared.&lt;/p&gt;

&lt;p&gt;Its not the readers because stack variable and we just checked it not null.&lt;/p&gt;

&lt;p&gt;This this.scanners is never cleared.&lt;/p&gt;

&lt;p&gt;Can you see what it is?&lt;/p&gt;
</comment>
                            <comment id="12716711" author="stack" created="Fri, 5 Jun 2009 18:31:37 +0000"  >&lt;p&gt;I&apos;m trying to put up new RC2 for 0.19.4.  Should include this if we can figure it.&lt;/p&gt;</comment>
                            <comment id="12716719" author="apurtell" created="Fri, 5 Jun 2009 18:48:07 +0000"  >&lt;p&gt;Stack: This is not a CME. Its NPE. &lt;/p&gt;

&lt;p&gt;Sorry, next time, coffee first. &lt;/p&gt;

&lt;p&gt;It looks to me like &apos;readers&apos; became null between the test&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
readers != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
readers.length &amp;gt; 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;How reliable are line numbers in stack traces? Just below on line 334 is potentially suspicious &lt;tt&gt;this.previousNext.getRow()&lt;/tt&gt;&lt;/p&gt;</comment>
                            <comment id="12716730" author="stack" created="Fri, 5 Jun 2009 19:21:03 +0000"  >&lt;p&gt;np Andrew.  On line numbers, I usually apply the &apos;thereabouts&apos; but IME, they are usually correct (helps to have actual src deployed too &amp;#8211; do you have access?).  the this.previousNext shouldn&apos;t be null either by my reading.&lt;/p&gt;
</comment>
                            <comment id="12716731" author="apurtell" created="Fri, 5 Jun 2009 19:24:12 +0000"  >&lt;p&gt;That team is using jars from the 0.19.1 release tarball.&lt;/p&gt;</comment>
                            <comment id="12716734" author="stack" created="Fri, 5 Jun 2009 19:36:25 +0000"  >&lt;p&gt;Line numbers match up same in 0.19.1 (if I tagged it right).&lt;/p&gt;

&lt;p&gt;On &apos;readers&apos; above changing between test and use, that is not possible?  Its local variable so on the executing&apos;s thread stack.&lt;/p&gt;

&lt;p&gt;But what do I know?  Shall I hold up 0.19.4RC2 till we figure this?&lt;/p&gt;</comment>
                            <comment id="12716738" author="apurtell" created="Fri, 5 Jun 2009 19:59:29 +0000"  >&lt;p&gt;I went over this a few times. I don&apos;t see how to change the code such that the situation might be improved. Thanks for taking a look at it also. I think we are both of the same opinion. &lt;/p&gt;

&lt;p&gt;This strikes me as some kind of JVM bug. I don&apos;t know how I would go about reproducing it. &lt;/p&gt;</comment>
                            <comment id="12716762" author="stack" created="Fri, 5 Jun 2009 21:49:00 +0000"  >&lt;p&gt;Moving out until someone smarter figures whats up here.&lt;/p&gt;</comment>
                            <comment id="13882402" author="stack" created="Sun, 26 Jan 2014 19:44:19 +0000"  >&lt;p&gt;Resolving as no longer pertinent.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12411558">HBASE-1107</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 21 Dec 2008 23:35:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25557</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 46 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02ctb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11677</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>