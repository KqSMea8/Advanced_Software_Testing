<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:25:29 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5181/HBASE-5181.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5181] Improve error message when Master fail-over happens and ZK unassigned node contains stale znode(s)</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5181</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When master fail-over happens, if we have number of RITs under /hbase/unassigned and if we have stale znode(s) (encoded region names) under /hbase/unassigned, we are getting&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2011-12-30 10:27:35,623 INFO org.apache.hadoop.hbase.master.HMaster: Master startup proceeding: master failover 
2011-12-30 10:27:36,002 INFO org.apache.hadoop.hbase.master.AssignmentManager: Failed-over master needs to process 1717 regions in transition 
2011-12-30 10:27:36,004 FATAL org.apache.hadoop.hbase.master.HMaster: Unhandled exception. Starting shutdown. 
java.lang.ArrayIndexOutOfBoundsException: -256 
at org.apache.hadoop.hbase.executor.RegionTransitionData.readFields(RegionTransitionData.java:148) 
at org.apache.hadoop.hbase.util.Writables.getWritable(Writables.java:105) 
at org.apache.hadoop.hbase.util.Writables.getWritable(Writables.java:75) 
at org.apache.hadoop.hbase.executor.RegionTransitionData.fromBytes(RegionTransitionData.java:198) 
at org.apache.hadoop.hbase.zookeeper.ZKAssign.getData(ZKAssign.java:743) 
at org.apache.hadoop.hbase.master.AssignmentManager.processRegionInTransition(AssignmentManager.java:262) 
at org.apache.hadoop.hbase.master.AssignmentManager.processFailover(AssignmentManager.java:223) 
at org.apache.hadoop.hbase.master.HMaster.finishInitialization(HMaster.java:401) 
at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:283)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and there is no clue on how to clean-up the stale znode(s) from unassigned using zkCli.sh (del /hbase/unassigned/&amp;lt;bad region name&amp;gt;). It would be good if we include the bad region name in IOException from RegionTransitionData.readFields().&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

@Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void readFields(DataInput in) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-comment&quot;&gt;// the event type &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;
&lt;/span&gt;    eventType = EventType.values()[in.readShort()];
    &lt;span class=&quot;code-comment&quot;&gt;// the timestamp
&lt;/span&gt;    stamp = in.readLong();
    &lt;span class=&quot;code-comment&quot;&gt;// the encoded name of the region being transitioned
&lt;/span&gt;    regionName = Bytes.readByteArray(in);
    &lt;span class=&quot;code-comment&quot;&gt;// remaining fields are optional so prefixed with &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// the name of the regionserver sending the data
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (in.readBoolean()) {
      &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] versionedBytes = Bytes.readByteArray(in);
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.origin = ServerName.parseVersionedServerName(versionedBytes);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (in.readBoolean()) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.payload = Bytes.readByteArray(in);
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If the code execution has survived until regionName then we can include the regionName in IOException with error message to clean-up the stale znode(s) under /hbase/unassigned.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12538114">HBASE-5181</key>
            <summary>Improve error message when Master fail-over happens and ZK unassigned node contains stale znode(s)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="mubarakseyed">Mubarak Seyed</assignee>
                                    <reporter username="mubarakseyed">Mubarak Seyed</reporter>
                        <labels>
                            <label>beginner</label>
                    </labels>
                <created>Wed, 11 Jan 2012 22:12:03 +0000</created>
                <updated>Tue, 5 Aug 2014 20:05:59 +0000</updated>
                                            <version>0.90.5</version>
                    <version>0.92.0</version>
                                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13184472" author="zhihyu@ebaysf.com" created="Wed, 11 Jan 2012 22:47:02 +0000"  >&lt;p&gt;Thanks for the suggestion, Mubarak.&lt;/p&gt;

&lt;p&gt;Do you want to attach a patch ?&lt;/p&gt;</comment>
                            <comment id="13184478" author="mubarakseyed" created="Wed, 11 Jan 2012 22:50:01 +0000"  >&lt;p&gt;Working on corporate approval to contribute this patch. Thanks.&lt;/p&gt;</comment>
                            <comment id="13184514" author="mubarakseyed" created="Wed, 11 Jan 2012 23:15:04 +0000"  >&lt;p&gt;Is there any suggestion on error message? How about&lt;/p&gt;

&lt;p&gt;throw new IOException(&quot;There could be a stale region-in-transition in ZK.&quot; +&lt;br/&gt;
        		&quot; The bad region is &quot; + Bytes.toString(regionName) +&lt;br/&gt;
        		&quot;. Try deleting the region-in-transition using &apos;del /hbase/unassigned/&quot;&lt;br/&gt;
        		+ Bytes.toString(regionName) + &quot;&apos; command over a ZK connection (in zkCli.sh)&quot;, ioe);&lt;/p&gt;</comment>
                            <comment id="13184551" author="zhihyu@ebaysf.com" created="Wed, 11 Jan 2012 23:46:32 +0000"  >&lt;p&gt;The message is certainly detailed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Please remember to replace &apos;/hbase&apos; with the value of zookeeper.znode.parent&lt;/p&gt;</comment>
                            <comment id="13186063" author="mubarakseyed" created="Sat, 14 Jan 2012 02:05:49 +0000"  >&lt;p&gt;The attached file is a patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12510556" name="HBASE-5181-v1-trunk.patch" size="2137" author="mubarakseyed" created="Sat, 14 Jan 2012 02:05:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 11 Jan 2012 22:47:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223620</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02c4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11567</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>