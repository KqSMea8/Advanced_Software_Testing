<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:56:39 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1821/HBASE-1821.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1821] Filtering by SingleColumnValueFilter bug</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1821</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;See up in hbase-user mailing list under title &apos;Filtering by SingleColumnValueFilter&apos;.  Adrian describes roughly how he fixed the issue (And what he wanted the filter to do).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12435256">HBASE-1821</key>
            <summary>Filtering by SingleColumnValueFilter bug</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="streamy">Jonathan Gray</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Sep 2009 22:05:41 +0000</created>
                <updated>Fri, 20 Nov 2015 13:01:40 +0000</updated>
                            <resolved>Tue, 15 Sep 2009 17:06:24 +0000</resolved>
                                                    <fixVersion>0.20.1</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12753394" author="streamy" created="Thu, 10 Sep 2009 02:43:01 +0000"  >&lt;p&gt;Assigning to myself so I look at this tomorrow.&lt;/p&gt;</comment>
                            <comment id="12753672" author="oadrian" created="Thu, 10 Sep 2009 15:52:38 +0000"  >&lt;p&gt;Problem description:&lt;br/&gt;
        Filter filter1 = new SingleColumnValueFilter(Bytes.toBytes(&quot;F1&quot;), Bytes.toBytes(&quot;c1&quot;), CompareOp.EQUAL, Bytes.toBytes(&quot;1&quot;));&lt;br/&gt;
        Filter filter2 = new SingleColumnValueFilter(Bytes.toBytes(&quot;F1&quot;), Bytes.toBytes(&quot;c2&quot;), CompareOp.EQUAL, Bytes.toBytes(&quot;1&quot;));&lt;br/&gt;
        List&amp;lt;Filter&amp;gt; rowFilters = new ArrayList&amp;lt;Filter&amp;gt;();&lt;br/&gt;
        rowFilters.add(filter1);rowFilters.add(filter2);&lt;br/&gt;
        Filter filter = new FilterList(FilterList.Operator.MUST_PASS_ALL, rowFilters);&lt;/p&gt;

&lt;p&gt;        s.addColumn(Bytes.toBytes(&quot;F1&quot;), Bytes.toBytes(&quot;c1&quot;));&lt;br/&gt;
        s.addColumn(Bytes.toBytes(&quot;F1&quot;), Bytes.toBytes(&quot;c2&quot;));&lt;br/&gt;
        s.setFilter(filter);&lt;/p&gt;

&lt;p&gt;This scan returns all rows the contains F1:c1 whit val &quot;1&quot; or contains F1:c2 whit val &quot;1&quot; or contains both. It should return only the rows that match both: filter1 and filter2.&lt;/p&gt;


&lt;p&gt;Solution:&lt;br/&gt;
if the filter noesn&apos;t find inside a row a Column-Value match than the FilterRow method should return true.&lt;/p&gt;


&lt;p&gt;Patch attached.&lt;/p&gt;</comment>
                            <comment id="12753678" author="oadrian" created="Thu, 10 Sep 2009 16:06:46 +0000"  >&lt;p&gt;I also added this:&lt;br/&gt;
public ReturnCode filterKeyValue(KeyValue keyValue) {&lt;br/&gt;
+    if (matchFound) &lt;/p&gt;
{
+      return ReturnCode.INCLUDE;
+    }
&lt;p&gt;     if (!keyValue.matchingColumn(this.columnFamily, this.columnQualifier)) {&lt;/p&gt;

&lt;p&gt;If a match on the row was already been found don&apos;t check for column match anymore.&lt;br/&gt;
This can be efficient when filtering rows whit very large number of columns and the column searched for it&apos;s on the first ones.&lt;/p&gt;</comment>
                            <comment id="12753854" author="streamy" created="Thu, 10 Sep 2009 22:08:30 +0000"  >&lt;p&gt;Patch is influenced from Olariu&apos;s patch.  Thanks.&lt;/p&gt;

&lt;p&gt;Building on it, we need to track both whether we hit the column at all, as well as whether we matched it successfully or not.&lt;/p&gt;

&lt;p&gt;Adds a test to TestFilter that defines the behavior and shows how to achieve what was originally wanted.&lt;/p&gt;

&lt;p&gt;One thing... If you want to prevent rows from showing up that don&apos;t have the column at all (rather than passed/failed the value check), you need to wrap them in a SkipFilter.  This is explained and defined in the test as well.&lt;/p&gt;

&lt;p&gt;Also had to make two edits to the existing TestSCVF.  Once the filter hits the column and matches, it will always return true for further KVs.  This is from the optimization Olariu explained which is part of my patch as well.&lt;/p&gt;

&lt;p&gt;Tests pass.  Please review.&lt;/p&gt;</comment>
                            <comment id="12753856" author="streamy" created="Thu, 10 Sep 2009 22:15:09 +0000"  >&lt;p&gt;Adds another optimization.  Once we find the column, if we didn&apos;t match it, all keys should return NEXT_ROW.&lt;/p&gt;

&lt;p&gt;Updated testSCVF unit test to reflect and test new behavior.&lt;/p&gt;</comment>
                            <comment id="12753885" author="clint.morgan" created="Thu, 10 Sep 2009 23:09:20 +0000"  >&lt;p&gt;I just found this. &lt;/p&gt;

&lt;p&gt;In the ValueFilter that I ported for 0.20 we had a filterIfColumnMissing property that I used for this. Looks like JG wipped it when fixing 1790 between rc2 and rc3. Wish I would have caught it then because I would have -1 RC3...&lt;/p&gt;

&lt;p&gt;Sometimes I want missing columns to cause the row to be filtered, sometimes not...&lt;/p&gt;

&lt;p&gt;I&apos;ll try out this patch and see if it can work for us. &lt;/p&gt;</comment>
                            <comment id="12753889" author="streamy" created="Thu, 10 Sep 2009 23:13:04 +0000"  >&lt;p&gt;@Clint the behavior you had in the existing ValueFilter is not specific to ValueFilter (or not SingleColumnValueFilter).  I thought it to be generically useful.&lt;/p&gt;

&lt;p&gt;I created SkipFilter instead.  So you can wrap SCVF with a SkipFilter, and you will get the behavior you are looking for.&lt;/p&gt;

&lt;p&gt;Let me know if something still doesn&apos;t work for you.  Don&apos;t worry I wasn&apos;t going to drop your behavior completely! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12754270" author="clint.morgan" created="Fri, 11 Sep 2009 18:28:13 +0000"  >&lt;p&gt;Ok, I see it. But I can&apos;t make that SkipFilter business work as I want it. &lt;/p&gt;

&lt;p&gt;I want to let the whole row through if the column is not there. But this does not seem possible with SkipFilter. I have not dug to deep, but just wrapping with a SF does not work. Instead I added back a filterIfColValMissing to SCVF. That works for me.&lt;/p&gt;

&lt;p&gt;Am I just being dense and missing something?&lt;/p&gt;

&lt;p&gt;Attached is that patch I used for SCVF (on top of yours). Sorry for the lack of unit tests; it fixed several of our tests...&lt;/p&gt;

&lt;p&gt;BTW, I really like all the other changes to filters. Thanks for cleaning it up!&lt;/p&gt;</comment>
                            <comment id="12754273" author="streamy" created="Fri, 11 Sep 2009 18:40:05 +0000"  >&lt;p&gt;I will try to write up a couple more unit tests so we can clearly define expected/actual behavior.&lt;/p&gt;</comment>
                            <comment id="12754446" author="streamy" created="Sat, 12 Sep 2009 00:45:16 +0000"  >&lt;p&gt;Thought on this more.  I think you&apos;re right, Clint.  There&apos;s no way for a wrapping class to specify &quot;do not let row through if column not found&quot;, or vice versa depending on default behavior of SCVF.&lt;/p&gt;

&lt;p&gt;I will merge our patches and try to get some more tests finished.  Early next week.&lt;/p&gt;</comment>
                            <comment id="12754447" author="streamy" created="Sat, 12 Sep 2009 00:47:08 +0000"  >&lt;p&gt;To further explain... SkipFilter can be used to say &quot;if the test for the single column fails, skip the entire row&quot;... what it doesn&apos;t say is, &quot;if nothing fails but the column isn&apos;t found, skip or pass through the entire row&quot;&lt;/p&gt;</comment>
                            <comment id="12754460" author="streamy" created="Sat, 12 Sep 2009 01:58:15 +0000"  >&lt;p&gt;New patch coming.  SkipFilter is really not going to work with this.  I think we should leave it in because it could be applicable to other cases.&lt;/p&gt;

&lt;p&gt;Behavior of SCVF should be that if the column is found, then the row being emitted or not is based on whether or not the comparison passed or failed.  Is that what you expect Clint?&lt;/p&gt;</comment>
                            <comment id="12754462" author="streamy" created="Sat, 12 Sep 2009 02:01:18 +0000"  >&lt;p&gt;Adds a bunch of unit tests that define and verify behavior.&lt;/p&gt;

&lt;p&gt;Adds/modifies class comments in SCVF to explain how it behaves.&lt;/p&gt;

&lt;p&gt;All tests pass.&lt;/p&gt;

&lt;p&gt;Please review and comment, especially Clint so I can make sure to get what you need in here.&lt;/p&gt;</comment>
                            <comment id="12755115" author="clint.morgan" created="Mon, 14 Sep 2009 18:00:59 +0000"  >&lt;p&gt;Yeah, this works for me. Thanks!&lt;/p&gt;</comment>
                            <comment id="12755161" author="stack" created="Mon, 14 Sep 2009 19:56:23 +0000"  >&lt;p&gt;I like all the tests.  Commit I&apos;d say.  Clint says it works for him.&lt;/p&gt;</comment>
                            <comment id="12755579" author="streamy" created="Tue, 15 Sep 2009 17:06:24 +0000"  >&lt;p&gt;Committed to branch and trunk.&lt;/p&gt;</comment>
                            <comment id="15017863" author="lars_francke" created="Fri, 20 Nov 2015 13:01:40 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12419327" name="1821-SCVF.patch" size="2671" author="clint.morgan" created="Fri, 11 Sep 2009 18:28:13 +0000"/>
                            <attachment id="12419224" name="HBASE-1821-v2.patch" size="6042" author="streamy" created="Thu, 10 Sep 2009 22:08:30 +0000"/>
                            <attachment id="12419226" name="HBASE-1821-v3.patch" size="8003" author="streamy" created="Thu, 10 Sep 2009 22:15:09 +0000"/>
                            <attachment id="12419366" name="HBASE-1821-v5.patch" size="13301" author="streamy" created="Sat, 12 Sep 2009 02:01:18 +0000"/>
                            <attachment id="12419187" name="HBASE-1821.patch" size="1398" author="oadrian" created="Thu, 10 Sep 2009 15:52:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Sep 2009 02:43:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26001</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hfg7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99765</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>