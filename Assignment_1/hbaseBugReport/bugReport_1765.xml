<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:56:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1765/HBASE-1765.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1765] Delay Result deserialization until asked for and permit access to the raw binary to prevent forced deserialization</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1765</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We have our own API that we use to access HBase from other languages like erlang, python, c, etc...&lt;/p&gt;

&lt;p&gt;The Java gateway that maps from the actual HBase API to our internal API wants to pass the raw binary received for a Result.  As is, we have to deserialize into an array of KeyValues and then re-serialize into a flat byte[].&lt;/p&gt;

&lt;p&gt;We would like to propose modifying Result to not build the KeyValue[] until it&apos;s asked for via client methods (.raw() or .sorted() or any of the map methods).  This is already how the map methods work (we don&apos;t build the map until it&apos;s asked for the first time).&lt;/p&gt;

&lt;p&gt;The only API change would be adding an additional Result.getBytes() method the get the raw underlying byte[] that was sent from the server.  &lt;/p&gt;

&lt;p&gt;The Result.readFields(DataInput) would then only read in the full byte[].  Would add an additional private method Result.readFields() that generated the KeyValue[].  That would be called whenever a client asks for anything besides .getBytes().&lt;/p&gt;

&lt;p&gt;Since all access to Result is done through those methods (KeyValue[] private and not directly accessible w/o using those methods) this should not impact any existing code.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12433029">HBASE-1765</key>
            <summary>Delay Result deserialization until asked for and permit access to the raw binary to prevent forced deserialization</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="streamy">Jonathan Gray</assignee>
                                    <reporter username="streamy">Jonathan Gray</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Aug 2009 22:28:21 +0000</created>
                <updated>Fri, 20 Nov 2015 13:01:58 +0000</updated>
                            <resolved>Thu, 10 Sep 2009 03:42:11 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.1</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12743005" author="jdcryans" created="Thu, 13 Aug 2009 22:32:04 +0000"  >&lt;p&gt;+1 as I have seen this need elsewhere. But you really want to target that on 0.20.0?&lt;/p&gt;</comment>
                            <comment id="12743007" author="streamy" created="Thu, 13 Aug 2009 22:33:47 +0000"  >&lt;p&gt;Hope to.  Writing a patch now.&lt;/p&gt;</comment>
                            <comment id="12743011" author="streamy" created="Thu, 13 Aug 2009 23:03:38 +0000"  >&lt;p&gt;On second thought, you&apos;re right jd, let&apos;s not introduce this kind of change into 0.20.0 so late.  Tests should confirm it works but just in case...&lt;/p&gt;</comment>
                            <comment id="12743013" author="jdcryans" created="Thu, 13 Aug 2009 23:11:28 +0000"  >&lt;p&gt;Wise decision, also 0.20.1 may only be 2 weeks away who knows.&lt;/p&gt;</comment>
                            <comment id="12743028" author="streamy" created="Thu, 13 Aug 2009 23:59:28 +0000"  >&lt;p&gt;Passes serialization tests but fails on client tests.  Will try to build out serialization test to uncover why it&apos;s still broken.&lt;/p&gt;</comment>
                            <comment id="12743033" author="streamy" created="Fri, 14 Aug 2009 00:18:44 +0000"  >&lt;p&gt;Adds new test TestSerialization.testResultDynamicBuild() which uncovers bug in first patch.&lt;/p&gt;

&lt;p&gt;New patch passes this test and passes all client tests that I&apos;ve run.&lt;/p&gt;</comment>
                            <comment id="12743034" author="streamy" created="Fri, 14 Aug 2009 00:19:17 +0000"  >&lt;p&gt;Please review and test.&lt;/p&gt;</comment>
                            <comment id="12743035" author="streamy" created="Fri, 14 Aug 2009 00:23:58 +0000"  >&lt;p&gt;Of note in this implementation:  &lt;/p&gt;

&lt;p&gt;There was a decision to make about how to do the serialization/deserialization of Result[].  Prior to this patch, we were reading a single massive byte[] for all Result[] together.  The issue is that Result can then not just have a byte[] because we also need an offset.  Rather than introduce byte[] and offset (then we don&apos;t have a simple .getBytes() method) I&apos;m using ImmutableBytesWritable which is just like KeyValue in that we give it (byte[], offset, length).  So now Result.getBytes() returns an ImmutableBytesWritable.&lt;/p&gt;

&lt;p&gt;This allows us to retain the optimization of reading a single large byte[] for the entire Result array rather than one byte[] per Result.  The trade-off is that Result.getBytes() returns IBW instead of byte[], so consumer must be aware that they need to check IBW.getOffset().  There is a note in the javadoc to that regard.&lt;/p&gt;</comment>
                            <comment id="12744683" author="stack" created="Tue, 18 Aug 2009 20:08:54 +0000"  >&lt;p&gt;This looks fine.  +1 on commit for 0.20.1.&lt;/p&gt;</comment>
                            <comment id="12753407" author="streamy" created="Thu, 10 Sep 2009 03:42:11 +0000"  >&lt;p&gt;Committed to branch and trunk.&lt;/p&gt;</comment>
                            <comment id="15017941" author="lars_francke" created="Fri, 20 Nov 2015 13:01:58 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12416513" name="HBASE-1765-v1.patch" size="6048" author="streamy" created="Thu, 13 Aug 2009 23:59:28 +0000"/>
                            <attachment id="12416516" name="HBASE-1765-v2.patch" size="8493" author="streamy" created="Fri, 14 Aug 2009 00:18:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 13 Aug 2009 22:32:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32257</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hf4v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99714</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>