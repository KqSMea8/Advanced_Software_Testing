<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:02:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-15339/HBASE-15339.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-15339] Improve DateTieredCompactionPolicy</title>
                <link>https://issues.apache.org/jira/browse/HBASE-15339</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Add multi-output support.&lt;br/&gt;
Add archive old data support.&lt;br/&gt;
...&lt;/p&gt;</description>
                <environment></environment>
        <key id="12944796">HBASE-15339</key>
            <summary>Improve DateTieredCompactionPolicy</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="Apache9">Duo Zhang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 26 Feb 2016 06:34:42 +0000</created>
                <updated>Tue, 29 Mar 2016 16:28:04 +0000</updated>
                                                                            <component>Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>16</watches>
                                                                                                            <comments>
                            <comment id="15169220" author="davelatham" created="Fri, 26 Feb 2016 15:49:06 +0000"  >&lt;p&gt;Duo, I&apos;d love to understand this a little better.  The tiered compaction in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15181&quot; title=&quot;A simple implementation of date based tiered compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15181&quot;&gt;&lt;del&gt;HBASE-15181&lt;/del&gt;&lt;/a&gt; has a max tier, so once data reaches that tier it never need be compacted again unless you force a major compaction.  The windows in that tier are fixed, based on epoch time, and their boundaries won&apos;t move.  They are not, however, aligned with the calendar, so if that is what you need, then you definitely need an enhancement.  I could imagine a config to use days/weeks/months/quarters/years for example instead of the simple epoch exponential tier schedule of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15181&quot; title=&quot;A simple implementation of date based tiered compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15181&quot;&gt;&lt;del&gt;HBASE-15181&lt;/del&gt;&lt;/a&gt;.  Can you elaborate on your needs and your proposal?&lt;/p&gt;</comment>
                            <comment id="15170083" author="apache9" created="Fri, 26 Feb 2016 23:22:19 +0000"  >&lt;p&gt;Oh, I see the picture in the design doc, it is not the same with Cassandra&apos;s DTCS. Fixed windows is enough although aligned by calendar looks better and has some benefits on statistic. And for our needs, we have replication, so we need to make sure the boundary is same on all the replication connected clusters. This makes it easier to verify the data consistency between these clusters.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davelatham&quot; class=&quot;user-hover&quot; rel=&quot;davelatham&quot;&gt;Dave Latham&lt;/a&gt;, helps a lot. Let me learn the patch carefully and change the description here. And for the config, for our service we only need to have calendar aligned boundaries in the max tier. we do not need to archive data by days, then merge days to week, then month, quarter and year. We still have a hot data tier which is relative to now(typically, one week).&lt;/p&gt;</comment>
                            <comment id="15170916" author="apache9" created="Sun, 28 Feb 2016 06:26:45 +0000"  >&lt;p&gt;OK, I went through the patch. The window generating algorithm is interesting(unix time divided by window size).&lt;br/&gt;
But in fact, MiCloud need a moving window to determine hot data, and a fixed windows to archive old data(better by year).&lt;br/&gt;
Luckily we have a &lt;tt&gt;Window&lt;/tt&gt; class here. I think we can make Window an interface and give it several different implementations.&lt;/p&gt;

&lt;p&gt;Will be back later when I find a way to integrate my logic into the compaction policy. Thanks.&lt;/p&gt;</comment>
                            <comment id="15172173" author="davelatham" created="Mon, 29 Feb 2016 17:15:43 +0000"  >&lt;p&gt;Why does MiCloud need a moving window?  The idea if using different tiers is that recent windows are in the lower tier so that if recent data is &quot;hot&quot; then it is well partitioned and efficiently read.&lt;/p&gt;

&lt;p&gt;Other Windowing strategies do sound interesting though, please share what you come up with.&lt;/p&gt;</comment>
                            <comment id="15173181" author="apache9" created="Tue, 1 Mar 2016 03:35:31 +0000"  >&lt;p&gt;For example, usually we consider hot data to be &apos;data that written in the last 7 days&apos;, not &apos;data that written after last Monday&apos;, that&apos;s why a moving window is more suitable to determine hot data.&lt;/p&gt;

&lt;p&gt;And for the archive logic, there is a max age config which we will skip compaction on files older than this. I think we could do archive on these files?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="15174390" author="davelatham" created="Tue, 1 Mar 2016 20:49:55 +0000"  >&lt;p&gt;Yes, there is a max age config where we no longer compact the files that are older than it, effectively archiving them (unless major compaction is performed).&lt;/p&gt;

&lt;p&gt;The fixed windows still do a decent job of isolating &quot;data in that last n days&quot; if you configure them, but will move discussion of relative windows to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15368&quot; title=&quot;Add pluggable window support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15368&quot;&gt;&lt;del&gt;HBASE-15368&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15179113" author="enis" created="Fri, 4 Mar 2016 01:32:11 +0000"  >&lt;p&gt;Delayed compactions for the incoming window is also relevant: &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14496&quot; title=&quot;Compaction improvements: Delayed compaction in RatioBasedCompactionPolicy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14496&quot;&gt;HBASE-14496&lt;/a&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vrodionov&quot; class=&quot;user-hover&quot; rel=&quot;vrodionov&quot;&gt;Vladimir Rodionov&lt;/a&gt; can comment more on the reasoning, but my understanding is that if query load for very-recent data is high, delaying the compaction of files for some time can help with smoothing the latencies out. &lt;/p&gt;</comment>
                            <comment id="15179137" author="apache9" created="Fri, 4 Mar 2016 01:48:32 +0000"  >&lt;p&gt;Is it possible to write data directly into BlockCache when compacting?&lt;/p&gt;</comment>
                            <comment id="15179176" author="enis" created="Fri, 4 Mar 2016 02:25:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is it possible to write data directly into BlockCache when compacting?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;There is a setting for writing the index or data blocks directly to the block cache from compactions. However, that is an all-or-nothing setting. What I imagine we want is to be able to write to block cache if data is not old kind of thing. &lt;/p&gt;</comment>
                            <comment id="15179205" author="clarax98007" created="Fri, 4 Mar 2016 03:01:36 +0000"  >&lt;p&gt;I intentionally kept the minimal files for compaction for incoming window different from other windows. This can be achieved by setting the number high. The added delay should work with DTCP seamlessly too.&lt;/p&gt;</comment>
                            <comment id="15179324" author="apache9" created="Fri, 4 Mar 2016 05:00:58 +0000"  >&lt;blockquote&gt;
&lt;p&gt;What I imagine we want is to be able to write to block cache if data is not old kind of thing.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;So if we support write multiple files in different windows for DateTieredCompaction, we could just write the data in the newest window into BlockCache?&lt;/p&gt;</comment>
                            <comment id="15185213" author="clarax98007" created="Tue, 8 Mar 2016 16:51:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; Can we update the description of this top-level ticket to reflect what we are actually doing?&lt;/p&gt;</comment>
                            <comment id="15215020" author="enis" created="Mon, 28 Mar 2016 22:37:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=clarax98007&quot; class=&quot;user-hover&quot; rel=&quot;clarax98007&quot;&gt;Clara Xiong&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; do you guys think that we can address all subtasks of this by 1.3 timeframe. &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15454&quot; title=&quot;Archive store files older than max age&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15454&quot;&gt;HBASE-15454&lt;/a&gt; needs a design doc, so maybe that is out, but it would be good if we can get everything in before 1.3. &lt;/p&gt;

&lt;p&gt;BTW, looking at &lt;tt&gt;hbase.hstore.compaction.date.tiered.max.storefile.age.millis&lt;/tt&gt; is the description in the document correct? After this age, we do not compact files, so if you have a TTL larger than &lt;tt&gt;hbase.hstore.compaction.date.tiered.max.storefile.age.millis&lt;/tt&gt;, our TTL-based file deletion does not work anymore? Something to check / fix. &lt;/p&gt;</comment>
                            <comment id="15215260" author="apache9" created="Tue, 29 Mar 2016 02:07:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15454&quot; title=&quot;Archive store files older than max age&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15454&quot;&gt;HBASE-15454&lt;/a&gt; maybe out but I think it is OK to backport it to 1.3 later, it does not change any behavior of existing code.&lt;/p&gt;

&lt;p&gt;And for the max age, IMO, it does not make sense to have some files that out of compaction control. The max age will work with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15454&quot; title=&quot;Archive store files older than max age&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15454&quot;&gt;HBASE-15454&lt;/a&gt; together since the files older than max age will be archived. And if you use TTL, then you&apos;d better not use max age?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="15215275" author="enis" created="Tue, 29 Mar 2016 02:15:56 +0000"  >&lt;blockquote&gt;&lt;p&gt;And for the max age, IMO, it does not make sense to have some files that out of compaction control&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You think that we should not have &lt;tt&gt;hbase.hstore.compaction.date.tiered.max.storefile.age.millis&lt;/tt&gt; as a conf option at all? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=clarax98007&quot; class=&quot;user-hover&quot; rel=&quot;clarax98007&quot;&gt;Clara Xiong&lt;/a&gt; wdyt? &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;And if you use TTL, then you&apos;d better not use max age?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;See FifoCompactionPolicy.selectCompaction(). We select only expired files in the compaction selection so that TTL&apos;ed data can still be deleted even though fifo compaction does not perform any compactions. We can do the same trick here. &lt;/p&gt;</comment>
                            <comment id="15215289" author="apache9" created="Tue, 29 Mar 2016 02:22:39 +0000"  >&lt;p&gt;I mean we can have the conf option, but we should only set it when archive is enabled.&lt;/p&gt;</comment>
                            <comment id="15215300" author="clarax98007" created="Tue, 29 Mar 2016 02:35:34 +0000"  >&lt;p&gt;maxAge, in short words, is the configuration to control how far you go when promoting tiers. Once a window is out of this range, say more than a year old from current time, we don&apos;t combine the windows to promote to the next tiers any more. It doesn&apos;t mean they are out of compaction control. Within DTC, minor compaction won&apos;t touch these files any more but major compaction will still touch them. It actually makes TTL or archiving much simpler and more efficient since any files older than max age but younger than TTL (or no TTL) will not be combined(I used the term &quot;compacted&quot; but this might confusing) into larger sizes.This way, TTL and archiving process can just scan from oldest files to remove/archive files based on their time range instead of scanning a very large file  from major compaction by Ratio-based compaction.&lt;/p&gt;

&lt;p&gt;The design here is similar to FIFOCompactionPolicy you described.&lt;/p&gt;</comment>
                            <comment id="15215368" author="apache9" created="Tue, 29 Mar 2016 03:47:16 +0000"  >&lt;p&gt;So let&apos;s give it a better name? Something like promotion boundary?&lt;/p&gt;</comment>
                            <comment id="15216287" author="clarax98007" created="Tue, 29 Mar 2016 16:28:04 +0000"  >&lt;p&gt;hbase.hstore.compaction.date.tiered.max.storefile.age.millis already has date.tiered prefix.I updated the ticket and design spec to make it more clear. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12934566">HBASE-15181</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12945820">HBASE-15368</subtask>
                            <subtask id="12946852">HBASE-15389</subtask>
                            <subtask id="12947415">HBASE-15400</subtask>
                            <subtask id="12949812">HBASE-15454</subtask>
                            <subtask id="12953532">HBASE-15527</subtask>
                            <subtask id="12944735">HBASE-15337</subtask>
                            <subtask id="12959459">HBASE-15665</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 26 Feb 2016 15:49:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            37 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2tsrj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>