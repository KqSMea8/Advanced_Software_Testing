<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:12:32 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10309/HBASE-10309.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10309] Add support to delete empty regions in 0.94.x series</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10309</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;My use case: I have several tables where keys start with a timestamp. Because of this and combined with the fact that I have set a 15 days retention period, after a period of time results empty regions.&lt;br/&gt;
I am sure that no write will occur in these region.&lt;br/&gt;
It would be nice to have a tool to delete regions without being necessary to stop the cluster.&lt;br/&gt;
The easiest way for me is to have a tool that is able to delete all empty regions, but there wouldn&apos;t be any problem to specify which region to delete.&lt;br/&gt;
Something like:&lt;br/&gt;
deleteRegion &amp;lt;tableName&amp;gt; &amp;lt;region&amp;gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12688235">HBASE-10309</key>
            <summary>Add support to delete empty regions in 0.94.x series</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="AcCud">AcCud</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Jan 2014 13:02:20 +0000</created>
                <updated>Wed, 12 Feb 2014 21:11:03 +0000</updated>
                            <resolved>Sun, 9 Feb 2014 06:08:32 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13868085" author="apurtell" created="Fri, 10 Jan 2014 18:25:57 +0000"  >&lt;p&gt;Or you could create your keys based on a modulus of the timestamp? Could work if you can put an upper bound on the number of records stored within the retention period, call it N, then key = (timestamp mod N) ... &lt;/p&gt;</comment>
                            <comment id="13868136" author="stack" created="Fri, 10 Jan 2014 19:00:30 +0000"  >&lt;p&gt;Removing a single empty region is not possible without region merge facility.  If multiple adjacent empty regions, you could replace them all with a single empty region that spans the deleted regions easy enough.&lt;/p&gt;</comment>
                            <comment id="13868224" author="lhofhansl" created="Fri, 10 Jan 2014 19:59:39 +0000"  >&lt;p&gt;Is not simpler to remove an empty region? The equivalent of removing the directory from HDFS and fix META the way HBCK does?&lt;/p&gt;

&lt;p&gt;This part of the code is not my area of expertise so I might way off, but it seems it should easier than actually merging regions with data.&lt;/p&gt;</comment>
                            <comment id="13893087" author="lhofhansl" created="Thu, 6 Feb 2014 06:09:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmhsieh&quot; class=&quot;user-hover&quot; rel=&quot;jmhsieh&quot;&gt;Jonathan Hsieh&lt;/a&gt;, does HBCK support this already (fixing holes). If so, we could just remove an empty region and have HBCK close the hole.&lt;/p&gt;</comment>
                            <comment id="13893641" author="jmhsieh" created="Thu, 6 Feb 2014 18:43:37 +0000"  >&lt;p&gt;That could work, but I&quot;m a wary of using hbck for this purpose regularly. &lt;/p&gt;

&lt;p&gt;The command would be&lt;br/&gt;
hbck -repairHoles&lt;/p&gt;

&lt;p&gt;I prefer stack&apos;s use merge approach but this isn&apos;t available in 0.94.&lt;/p&gt;</comment>
                            <comment id="13893670" author="lhofhansl" created="Thu, 6 Feb 2014 19:09:06 +0000"  >&lt;p&gt;Can&apos;t we reuse the hbck code in a more targeted way for a specific known region that is known ahead of time to be empty (and it won&apos;t be written to or split, etc)?&lt;/p&gt;

&lt;p&gt;I fear that this will come up over and over again with folks that store event data that is access in a most-recent-only way and eventually will be purged; and this is otherwise a compelling usecase for HBase.&lt;/p&gt;

&lt;p&gt;There are other ways around this (salting, prefix hashing, bounded time windows, etc) but all of those have other drawbacks.&lt;/p&gt;</comment>
                            <comment id="13893717" author="jmhsieh" created="Thu, 6 Feb 2014 19:50:41 +0000"  >&lt;p&gt;My main concern is doing this safely and in a simple way &amp;#8211; hbck repairs stuff is mostly for after problems occur when we are already messed up.  Purposely &quot;breaking&quot; things and then using hbck is just risky.  We could outline steps on how to do this but it requires some expertise in case something bad happens.&lt;/p&gt;</comment>
                            <comment id="13895838" author="lhofhansl" created="Sun, 9 Feb 2014 06:08:32 +0000"  >&lt;p&gt;Alright. Lemme close this then.&lt;/p&gt;</comment>
                            <comment id="13899481" author="ionignat" created="Wed, 12 Feb 2014 19:36:52 +0000"  >&lt;p&gt;I am also interested to hear more details on this topic. This feature would be extremely useful and for me. i have the same use case.&lt;/p&gt;

&lt;p&gt;For the moment, I have a quick question: if I delete an empty region and I run hbck  -repairHoles, what will be the effect?A new empty region just as that was deleted or one of the neighboring regions will be extended to cover the gap?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
Ionut I.&lt;/p&gt;</comment>
                            <comment id="13899533" author="jmhsieh" created="Wed, 12 Feb 2014 20:16:33 +0000"  >&lt;p&gt;it will work most of the time but if you have an active cluster, actions like splitting, balancing and or failures during the hbck run may cause the table to get into an inconsistent state.  Generally if we are doing repairs with hbck, we try to make the cluster as idle as possible.  &lt;/p&gt;

&lt;p&gt;Because it is a separate process from the active master, there is racing possibilities which can cause new inconsistencies.&lt;/p&gt;
</comment>
                            <comment id="13899582" author="ionignat" created="Wed, 12 Feb 2014 21:11:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmhsieh&quot; class=&quot;user-hover&quot; rel=&quot;jmhsieh&quot;&gt;Jonathan Hsieh&lt;/a&gt;: Thank you for the respose, but it wasn&apos;t clear for me: if I delete an empty region and I run hbck -repairHoles, what will be the effect?A new empty region just as that was deleted or one of the neighboring regions will be extended to cover the gap?&lt;/p&gt;

&lt;p&gt;Thanks!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 10 Jan 2014 18:25:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367254</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ray7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>367563</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>