<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:28:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5521/HBASE-5521.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5521] Move compression/decompression to an encoder specific encoding context</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5521</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;As part of working on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5313&quot; title=&quot;Restructure hfiles layout for better compression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5313&quot;&gt;HBASE-5313&lt;/a&gt;, we want to add a new columnar encoder/decoder. It makes sense to move compression to be part of encoder/decoder:&lt;br/&gt;
1) a scanner for a columnar encoded block can do lazy decompression to a specific part of a key value object&lt;br/&gt;
2) avoid an extra bytes copy from encoder to hblock-writer. &lt;/p&gt;

&lt;p&gt;If there is no encoder specified for a writer, the HBlock.Writer will use a default compression-context to do something very similar to today&apos;s code.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12545220">HBASE-5521</key>
            <summary>Move compression/decompression to an encoder specific encoding context</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="he yongqiang">He Yongqiang</assignee>
                                    <reporter username="he yongqiang">He Yongqiang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Mar 2012 19:01:39 +0000</created>
                <updated>Mon, 23 Sep 2013 18:31:20 +0000</updated>
                            <resolved>Mon, 19 Mar 2012 20:12:56 +0000</resolved>
                                                    <fixVersion>0.95.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13222555" author="jiraposter@reviews.apache.org" created="Mon, 5 Mar 2012 19:51:58 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/4182/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4182/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase, Dhruba Borthakur and Scott Chen.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Move compression/decompression to an encoder specific encoding context&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5521&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java 1297201 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java 1297201 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java 1297201 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java 1296006 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java 1297201 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java 1297201 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java 1297201 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java 1297201 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java 1297201 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java 1297201 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java 1297201 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java 1297201 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java 1297201 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/regionserver/DataBlockEncodingTool.java 1297201 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/4182/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4182/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Yongqiang&lt;/p&gt;
</comment>
                            <comment id="13222576" author="he yongqiang" created="Mon, 5 Mar 2012 20:12:14 +0000"  >&lt;p&gt;moved the review to &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13222579" author="phabricator@reviews.facebook.net" created="Mon, 5 Mar 2012 20:13:54 +0000"  >&lt;p&gt;heyongqiang requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5521&lt;/a&gt;&lt;/p&gt;



&lt;p&gt;  As part of working on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5313&quot; title=&quot;Restructure hfiles layout for better compression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5313&quot;&gt;HBASE-5313&lt;/a&gt;, we want to add a new columnar encoder/decoder. It makes sense to move compression to be part of encoder/decoder:&lt;br/&gt;
  1) a scanner for a columnar encoded block can do lazy decompression to a specific part of a key value object&lt;br/&gt;
  2) avoid an extra bytes copy from encoder to hblock-writer.&lt;/p&gt;

&lt;p&gt;  If there is no encoder specified for a writer, the HBlock.Writer will use a default compression-context to do something very similar to today&apos;s code.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/DataBlockEncodingTool.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/4539/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/4539/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tip: use the X-Herald-Rules header to filter Herald messages in your client.&lt;/p&gt;</comment>
                            <comment id="13222608" author="phabricator@reviews.facebook.net" created="Mon, 5 Mar 2012 20:59:55 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;  Still going over the new Context interfaces.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java:51 I don&apos;t find where this method is used.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:690 There is nothing to be done between preparation and post processing ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:693 nonDataBlockEncodingCtx should be used here, I assume.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13222616" author="phabricator@reviews.facebook.net" created="Mon, 5 Mar 2012 21:19:55 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:811 Should we perform similar handling for nonDataBlockEncodingCtx ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:810 dataBlockEncodingCtx should be set to null so that release() is re-entrant.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13222621" author="phabricator@reviews.facebook.net" created="Mon, 5 Mar 2012 21:31:56 +0000"  >&lt;p&gt;mbautin has requested changes to the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;  Yongqiang: thanks for taking on this refactoring project. I have added some comments inline.&lt;/p&gt;

&lt;p&gt;  What is &quot;columnar encoded block format&quot;, by the way? Also, it is not totally clear to me why we would need to unite compression and encoding steps in order to support &quot;columnar encoded&quot; block format.&lt;/p&gt;

&lt;p&gt;  This requires a test plan and new unit tests. Please add test cases for &quot;encoding context&quot; implementations.&lt;/p&gt;


&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:58 Why do we need two separate compressKeyValues functions? What is the difference in use cases? Overloaded methods make the interface confusing.&lt;/p&gt;

&lt;p&gt;  Add postEncoding javadoc.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:179-183 Javadoc please.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java:53 Why do we need to take encoding as an explicit parameter? Can we figure it out from dataBlockEncoder?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java:323-327 Is this actually what you wanted to check? This code as written will accept any subclass of HFileBlockDefaultEncodingContext. If you want to only accept an instance of the HFileBlockDefaultEncodingContext class specifically, you need&lt;/p&gt;

&lt;p&gt;    encodingCxt.getClass() == HFileBlockDefaultEncodingContext.class&lt;/p&gt;

&lt;p&gt;  However, why do we need to enforce such a constraint? Would not an arbitrary implementation of HFileBlockEncodingContext be acceptable here?&lt;/p&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1396 Code style: add spaces after //. Capitalize the first word in a sentence. In short: be consistent with the existing style of the surrounding code.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1327-1328 Why did you remove the comment about the peek-into-next-block-header optimization?&lt;/p&gt;

&lt;p&gt;  here we already read -&amp;gt; here we have already read&lt;/p&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:194-195 Why do we need to instantiate the &quot;encoding context&quot; for every encoding operation?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1253 Why do we need to have a separate &quot;default encoding context&quot; instance here?&lt;/p&gt;

&lt;p&gt;  Can you make the default context a singleton (or a per-compression-type singleton) and use the relevant unique instance instead of this field?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1357 Code style: space after &quot;if&quot;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  svn&lt;/p&gt;</comment>
                            <comment id="13223578" author="phabricator@reviews.facebook.net" created="Tue, 6 Mar 2012 19:27:55 +0000"  >&lt;p&gt;heyongqiang has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java:323-327 good suggestion. i will change to use class for checking.&lt;/p&gt;

&lt;p&gt;  Yes, we need to enforce that contains right now. Basically we want each encoder to use its own context object which is returned by newDataBlockEncodingContext()&lt;/p&gt;


&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:58 will remove the original method, and change all testcases to use the new api.&lt;/p&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java:53 are you suggesting adding a new field Encoding to each encoder?&lt;br/&gt;
  i also think it is a good thing to do, but not sure the reason of why the current code not doing that.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:693 Good catch! this is a bug.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:811 good catch here. will assign to null.&lt;br/&gt;
  Initially i am doing that is because they are all defined as &apos;final&apos;. will remove the final.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1253 default is used for nondata block. I can not make them singleton as they need to maintain some reusable objects internally. By reusable objects, it is basically some buffers allocated once and can be reused across multiple operations.&lt;/p&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1327-1328 added back&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:194-195 good catch. will add a class field to reuse it&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  svn&lt;/p&gt;</comment>
                            <comment id="13223597" author="phabricator@reviews.facebook.net" created="Tue, 6 Mar 2012 19:47:56 +0000"  >&lt;p&gt;heyongqiang updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;br/&gt;
Reviewers: JIRA, dhruba, tedyu, sc, mbautin&lt;/p&gt;

&lt;p&gt;  address Ted and mbautin&apos;s comments.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/DataBlockEncodingTool.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java&lt;/p&gt;</comment>
                            <comment id="13223616" author="phabricator@reviews.facebook.net" created="Tue, 6 Mar 2012 20:17:56 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;  Yongqiang: thanks for addressing the comments. I will take another pass through the new version diff.&lt;/p&gt;

&lt;p&gt;  Could you please use a consistent abbreviation for &quot;context&quot;? Either Ctx or Cxt, but not both.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java:53 HFileDataBlockEncoder is actually aware of on-disk and in-cache encoding. The on-disk encoding may be disabled when in-cache encoding is enabled, but not the other way. The current code apparently did not need to explicitly store encoding type in EncodedDataBlock (which is mostly used for testing and benchmarking), and I am wondering why you need to store it now.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13223723" author="phabricator@reviews.facebook.net" created="Tue, 6 Mar 2012 22:09:55 +0000"  >&lt;p&gt;heyongqiang has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java:53 I think here it is DataBlockEncoder (prefix, diff etc), and not HFileDataBlockEncoder&lt;/p&gt;

&lt;p&gt;  From encoding, you can get encoder. but from encoder, can not get encoding.&lt;/p&gt;

&lt;p&gt;  The class field encoding is not needed, will remove it.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13223734" author="phabricator@reviews.facebook.net" created="Tue, 6 Mar 2012 22:17:55 +0000"  >&lt;p&gt;heyongqiang updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;br/&gt;
Reviewers: JIRA, dhruba, tedyu, sc, mbautin&lt;/p&gt;

&lt;p&gt;  add mbautin&apos;s comments, and changed all Cxt to Ctx&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/DataBlockEncodingTool.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/FastDiffDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/PrefixKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DiffKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java&lt;/p&gt;</comment>
                            <comment id="13224054" author="phabricator@reviews.facebook.net" created="Wed, 7 Mar 2012 07:01:59 +0000"  >&lt;p&gt;heyongqiang updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;br/&gt;
Reviewers: JIRA, dhruba, tedyu, sc, mbautin&lt;/p&gt;

&lt;p&gt;  fix the test failure.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/DataBlockEncodingTool.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/FastDiffDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/PrefixKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DiffKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java&lt;/p&gt;</comment>
                            <comment id="13224079" author="hadoopqa" created="Wed, 7 Mar 2012 07:48:04 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12517375/HBASE-5521.D2097.4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12517375/HBASE-5521.D2097.4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -125 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 158 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1128//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1128//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1128//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1128//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1128//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1128//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13224810" author="phabricator@reviews.facebook.net" created="Wed, 7 Mar 2012 22:52:55 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:67 Should inCache be used here instead of NONE ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:235 Add a space between if and (&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:237 Add a space between if and (&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13224820" author="phabricator@reviews.facebook.net" created="Wed, 7 Mar 2012 23:08:54 +0000"  >&lt;p&gt;mbautin has requested changes to the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;  Yongqiang: thanks for the revised version. I have some more comments (inline). Also, could you please add some more unit tests specifically for the encoding/decoding context stuff?&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java:328 Rename this to internalEncodeKeyValues (&quot;Encoding&quot; -&amp;gt; &quot;Encode&quot;).&lt;/p&gt;

&lt;p&gt;  Also, this should probably be at least protected, because a public method called &quot;internalFoo&quot; is confusing.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java:336 Please replace this with just&lt;/p&gt;

&lt;p&gt;    if (encodingCtx.getClass() != HFileBlockDefaultEncodingContext.class)&lt;/p&gt;

&lt;p&gt;  This works because class objects are unique in Java within the same class loader.&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;http://stackoverflow.com/questions/3738919/does-java-guarantee-that-object-getclass-object-getclass&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://stackoverflow.com/questions/3738919/does-java-guarantee-that-object-getclass-object-getclass&lt;/a&gt;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java:348 What if encoding type is NONE? Would ENCODED_DATA still be valid here?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java:36 -&amp;gt; internalEncodeKeyValues&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:28-37 Update the Javadoc to reflect the fact that encoder also deals with block compression and describe the relation between these two steps.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java:109 wrong parameter name&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java:50 Fill out the description for the encoding parameter&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java:56 Get rid of this variable and use the constant directly&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/FastDiffDeltaEncoder.java:346 -&amp;gt; internalEncodeKeyValues&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java:25 Readability:&lt;/p&gt;

&lt;p&gt;  one reader&apos;s -&amp;gt; a reader&apos;s&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java:38 need to done -&amp;gt; need to be done&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java:42-44 It is not clear what parameter is input and what is output. Please fill in the descriptions.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java:39 Make this final&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:34 Not sure what is meant by &quot;as a whole bytes buffer&quot;. Could you please re-word this?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:59-60 Do these need to be package-private? Can they be made private?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java:26 the write&apos;s whole lifetime -&amp;gt; the writer&apos;s whole lifetime (I assume that is what you meant)&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java:25 one writer&apos;s encoder -&amp;gt; a writer&apos;s encoder&lt;/p&gt;

&lt;p&gt;  The &quot;one writer&apos;s encoder&quot; wording hints that an encoding context may potentially be shared with other writers. I am assuming that is not the case. If it is, could you please clarify the scope of sharing of an encoding context?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java:54 It is not clear what &quot;prepare an encoding&quot; actually means. Could you please provide more detail here?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java:67 any action that need -&amp;gt; any action that needs&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java:68-69 NONE could also be considered a &quot;valid compression algorithm&quot; by some. Please remove the ambiguity.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/PrefixKeyDeltaEncoder.java:78 -&amp;gt; internalEncodeKeyValues&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java:332-333 Add descriptions. It looks like there is an assumption that the dest byte array has enough space allocated to store the decompressed block.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:538 Add javadoc clarifying in what cases we use this context.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:687 Moving compression into the encoding framework introduces the need for separate logic for compressing data blocks and all other blocks. Is it possible to reduce code duplication between compression for data and non-data blocks?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:795 Code style: add a space after &quot;if&quot;.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1397 to it -&amp;gt; in it.&lt;/p&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1421 Make this line less than 80 characters.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java:94 create a encoder -&amp;gt; Create an encoder&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:44 Can this be made private and final?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:171 The function used to return its result but now it does not. Please specify what is the function&apos;s output in the javadoc.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:193 Add javadoc describing the input and the output.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:235 Add space between if and (&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:237 Add space between if and (&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:249 Add space between if and (&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:251 Add space between if and (&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java:53 Where is the output now? Add javadoc.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java:65 This seems to assume that the payload starts at the beginning of the buffer&apos;s backing array, and discards the buffer&apos;s arrayOffset() and limit(). Is that intended? Why pass a ByteBuffer then?&lt;/p&gt;

&lt;p&gt;  Alternatively, should compressAfterEncoding take a starting offset and a length along with the byte array?&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java:100-102 Fix long line&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java:119-123 Remove commented-out code&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java:100 Does &quot;Baos&quot; stand for &quot;Byte array output stream&quot;? This function returns a ByteArrayInputStream.&lt;/p&gt;

&lt;p&gt;  Please rename this function to remove the confusion. Also, please avoid using &quot;Baos&quot; in function names.&lt;/p&gt;

&lt;p&gt;  Also please add javadoc.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java:385 Please make this an assertion with a readable error message. No one will notice &quot;mismatch..&quot; in test output or understand what it means.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java:447 Add space between if and (&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  svn&lt;/p&gt;</comment>
                            <comment id="13224833" author="phabricator@reviews.facebook.net" created="Wed, 7 Mar 2012 23:32:55 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java:56 This parameter is not in method signature any more.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  svn&lt;/p&gt;</comment>
                            <comment id="13224886" author="phabricator@reviews.facebook.net" created="Thu, 8 Mar 2012 00:54:56 +0000"  >&lt;p&gt;heyongqiang updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;br/&gt;
Reviewers: JIRA, dhruba, tedyu, sc, mbautin&lt;/p&gt;

&lt;p&gt;  address mbautin and Ted&apos;s coents.&lt;/p&gt;

&lt;p&gt;  @mbautin, i do not think we need to add a testcase for the new default contclasses as th are recovered by exising codebase pretty well.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/DataBlockEncodingTool.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/FastDiffDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/PrefixKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DiffKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java&lt;/p&gt;</comment>
                            <comment id="13224888" author="phabricator@reviews.facebook.net" created="Thu, 8 Mar 2012 00:56:55 +0000"  >&lt;p&gt;heyongqiang has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;  @mbautin, i do not think we need to add a testcase for the new default context classes, as they are covered by existing testcase/codes pretty well. i will add more test cases after adding the new encoder type.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java:385 good catch. i added that just for my debugging&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13224935" author="hadoopqa" created="Thu, 8 Mar 2012 02:03:03 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12517499/HBASE-5521.D2097.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12517499/HBASE-5521.D2097.5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -127 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 158 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestAtomicOperation&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1129//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1129//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1129//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1129//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1129//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1129//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13225379" author="he yongqiang" created="Thu, 8 Mar 2012 18:44:51 +0000"  >&lt;p&gt;Tests passed in my local test, not sure why failed on Jenkins.&lt;/p&gt;</comment>
                            <comment id="13230541" author="phabricator@reviews.facebook.net" created="Thu, 15 Mar 2012 21:02:35 +0000"  >&lt;p&gt;heyongqiang updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;br/&gt;
Reviewers: JIRA, dhruba, tedyu, sc, mbautin&lt;/p&gt;

&lt;p&gt;  rebase with trunk&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/DataBlockEncodingTool.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlockCompatibility.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/FastDiffDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/PrefixKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DiffKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java&lt;/p&gt;</comment>
                            <comment id="13230637" author="hadoopqa" created="Thu, 15 Mar 2012 22:19:59 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518539/HBASE-5521.D2097.6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518539/HBASE-5521.D2097.6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 15 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 166 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.io.hfile.TestHFileWriterV2&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestProcessRowEndpoint&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestHFile&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestReseekTo&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1194//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1194//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1194//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1194//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1194//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1194//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13231644" author="phabricator@reviews.facebook.net" created="Fri, 16 Mar 2012 21:23:38 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;  Yongqiang: we now have a linter available in HBase trunk. Could you please run &quot;arc lint&quot;, resolve lint warnings, and resubmit the diff with &quot;arc diff --preview&quot;?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13231666" author="phabricator@reviews.facebook.net" created="Fri, 16 Mar 2012 22:06:37 +0000"  >&lt;p&gt;heyongqiang updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;br/&gt;
Reviewers: JIRA, dhruba, tedyu, sc, mbautin&lt;/p&gt;

&lt;p&gt;  fix tests failures&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/DataBlockEncodingTool.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlockCompatibility.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/FastDiffDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/PrefixKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DiffKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java&lt;/p&gt;</comment>
                            <comment id="13231692" author="mikhail" created="Fri, 16 Mar 2012 22:30:40 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I have sucessfully re-run tests that failed on Jenkins locally:&lt;/p&gt;

&lt;p&gt;Running org.apache.hadoop.hbase.io.hfile.TestHFileWriterV2&lt;br/&gt;
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.904 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.io.hfile.TestReseekTo&lt;br/&gt;
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.846 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.io.hfile.TestHFile&lt;br/&gt;
Tests run: 6, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 1.11 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.coprocessor.TestProcessRowEndpoint&lt;br/&gt;
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 20.273 sec&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests run: 10, Failures: 0, Errors: 0, Skipped: 0&lt;/p&gt;

&lt;p&gt;@Committers: this patch has been out for a while, and Yongqiang is addressing final minor comments. Would anyone else +1 this?&lt;/p&gt;</comment>
                            <comment id="13231705" author="zhihyu@ebaysf.com" created="Fri, 16 Mar 2012 22:43:04 +0000"  >&lt;p&gt;I have verified that failed tests pass now.&lt;/p&gt;

&lt;p&gt;There&apos;re a lot of whitespace warnings from lint:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;gt;&amp;gt;&amp;gt; Lint &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java:

   Error  (TXT6) Trailing Whitespace
    This line contains trailing whitespace.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please give me a few moment in going over the patch one more time.&lt;/p&gt;</comment>
                            <comment id="13231715" author="phabricator@reviews.facebook.net" created="Fri, 16 Mar 2012 22:54:39 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;  Yongqiang: here are some more comments, mostly very minor, but a couple of real ones, too.&lt;/p&gt;


&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:38 It -&amp;gt; it&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:79 Remove unnecessary concatenation&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:644 Add an empty line here&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:829 Code style: add space after (int)&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:952-955 Could the close operation fail? If so, would it make sense to attempt the second close operation in a finally block?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1160 Nice! +1 on making more fields final.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1445-1446 Can these be made private?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1729 Code style: space between if and (&lt;br/&gt;
  I will add a lint rule to catch this, too.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1742-1745 nit: in multi-line comments like this, please capitalize the first word and end sentences with a full stop.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java:94 &lt;span class=&quot;error&quot;&gt;&amp;#91;nit&amp;#93;&lt;/span&gt; create -&amp;gt; Create&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java:111 nit: specify what this returns, or remove @return&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:42-45 Do we have any subclasses of HFileDataBlockEncoderImpl, or are these fields accessed from other classes in the package? If latter, please change access to package-private. This is a more restrictive access level than protected, because classes from the same package can actually access protected members (I was surprised when I learned about this).&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:86 nit: use a // comment&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java:263-276 Here is probably one of the few important comments in my current batch. There is code duplication between these two methods. Can we merge these two methods in the HFile encoder interface into one, and get rid of this code duplication in the implementation?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java:41 Why does this have to be protected? This class is a singleton and we should not create it anywhere else. Instead, use NoOpDataBlockEncoder.INSTANCE.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java:358 Is DataBlockEncoding.getAllEncoders() used anywhere after you have removed this line? If not, I think we should get rid of it since it is confusing to have a function called getAllEncoders() that does not actually return all encoders.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlockCompatibility.java:20 This file contains a lot of code duplicated from TestHFileBlock. Dhruba&apos;s intent, as I understood it, to have a &quot;frozen&quot; implementation without HBase-level checksums that tests would use to ensure compatibility before and after the checksum patch. Therefore, we should probably minimize changes to this file and emphasize that in comments explicitly and conspicuously.&lt;/p&gt;

&lt;p&gt;  Please work with Dhruba to address the TestHFileBlockCompatibility issues.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13231717" author="hadoopqa" created="Fri, 16 Mar 2012 22:56:59 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518742/HBASE-5521.D2097.7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518742/HBASE-5521.D2097.7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 15 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 165 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.util.TestHBaseFsck&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1211//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1211//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1211//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1211//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1211//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1211//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13231732" author="phabricator@reviews.facebook.net" created="Fri, 16 Mar 2012 23:32:41 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;  Good progress.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java:330 Extra empty line.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:55 Can &apos;contain returning results&apos; be explained a little more ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java:1624 &apos;to seek back&apos; can be replaced with &apos;backward&apos;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:38 &apos;compress&apos; -&amp;gt; &apos;compresses&apos;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:60 Since compression is optional, should this method be named encodeKeyValuesFollowedByOptionalCompression &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:122 Would createDataBlockEncodingContext be a better name ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:127 &apos;an encoder&apos;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java:200 Are this javadoc and method name consistent with what line 212 returns ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:64 Please add javadoc for the parameters&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:133 Add headerBytes to @param&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java:208 &apos;decoding&apos; -&amp;gt; &apos;compression&apos;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:156 Please add @Override for methods in the interface.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13231760" author="phabricator@reviews.facebook.net" created="Sat, 17 Mar 2012 00:40:36 +0000"  >&lt;p&gt;heyongqiang updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;br/&gt;
Reviewers: JIRA, dhruba, tedyu, sc, mbautin&lt;/p&gt;

&lt;p&gt;  address mbautin &amp;amp; tedyu&apos;s comments.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/DataBlockEncodingTool.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlockCompatibility.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/FastDiffDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/PrefixKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DiffKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java&lt;/p&gt;</comment>
                            <comment id="13231788" author="phabricator@reviews.facebook.net" created="Sat, 17 Mar 2012 01:28:35 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java:202 How about naming this method encodeData() ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:106 Typo: &apos;to start&apos;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:109 I think this method should be in the interface.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java:34 When getOnDiskBytesWithHeader() is called, encoding is done already, right ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:131 I think this method should be in the interface.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:177 Is this method called anywhere ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:56 Does &apos;as well as&apos; mean &apos;or&apos; here ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:61 I still think this method should be renamed because compression is optional.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13231795" author="hadoopqa" created="Sat, 17 Mar 2012 01:44:59 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518757/HBASE-5521.D2097.8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518757/HBASE-5521.D2097.8.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 15 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 165 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1214//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1214//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1214//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1214//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1214//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1214//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13231890" author="phabricator@reviews.facebook.net" created="Sat, 17 Mar 2012 08:07:53 +0000"  >&lt;p&gt;heyongqiang has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:61 The interface is there before this change.&lt;br/&gt;
  I agree it need a better name. But i think that should be done in a different context.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:109 this interface is removed from the interface as to address your previous comments. Methods defined in an interface need to be clear and need to be as fewer as possible. Once it is added, it is not easy to take back.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java:34 Yes. It returns encoded uncompressed bytes.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java:202 ok. i will rename it to encodeData()&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:106 will fix&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:56 nope. it&apos;s &apos;as well as&apos;...will put a few more words here&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13231891" author="phabricator@reviews.facebook.net" created="Sat, 17 Mar 2012 08:13:36 +0000"  >&lt;p&gt;heyongqiang updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;br/&gt;
Reviewers: JIRA, dhruba, tedyu, sc, mbautin&lt;/p&gt;

&lt;p&gt;  address ted&apos;s comments:&lt;br/&gt;
  fixed a typo, rename a function name etc&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/DataBlockEncodingTool.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlockCompatibility.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/FastDiffDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/PrefixKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DiffKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java&lt;/p&gt;</comment>
                            <comment id="13231904" author="hadoopqa" created="Sat, 17 Mar 2012 09:05:41 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518781/HBASE-5521.D2097.9.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518781/HBASE-5521.D2097.9.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 15 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 164 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestSplitLogManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1217//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1217//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1217//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1217//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1217//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1217//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13231984" author="phabricator@reviews.facebook.net" created="Sat, 17 Mar 2012 14:41:35 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;  Looks good.&lt;br/&gt;
  I have only one comment outstanding w.r.t. compressKeyValues()&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:61 I looked at PrefixKeyDeltaEncoder.compressKeyValues(DataOutputStream ...)&lt;/p&gt;

&lt;p&gt;  It only does encoding (and appending memstoreTs).&lt;/p&gt;

&lt;p&gt;  I think we should take this opportunity to make interface method name(s) clearer.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java:109 Pardon me if my comments have been inconsistent.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13231987" author="phabricator@reviews.facebook.net" created="Sat, 17 Mar 2012 14:53:35 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java:34 Can we make this javadoc clearer ?&lt;br/&gt;
  Something like:&lt;br/&gt;
  @return encoded bytes which are ready ...&lt;/p&gt;

&lt;p&gt;  This would leave no confusion as to when encoding is done.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java:39 Similar to comment above.&lt;br/&gt;
  When &apos;after encoding&apos; is placed at the end of the sentence, I am not sure interpretation of where encoding is done would be uniform.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13232101" author="phabricator@reviews.facebook.net" created="Sat, 17 Mar 2012 23:52:36 +0000"  >&lt;p&gt;heyongqiang has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;  will address the java doc etc comments.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java:61 It will also do the compression.&lt;br/&gt;
  The internalEncodeKeyValues() only does the encoding. but compressKeyValues will do encoding (by calling internalEncode...) and compress in postEncoding().&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13232102" author="phabricator@reviews.facebook.net" created="Sat, 17 Mar 2012 23:54:37 +0000"  >&lt;p&gt;heyongqiang updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;br/&gt;
Reviewers: JIRA, dhruba, tedyu, sc, mbautin&lt;/p&gt;

&lt;p&gt;  address javadoc comments...&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/DataBlockEncodingTool.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlockCompatibility.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/FastDiffDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/PrefixKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DiffKeyDeltaEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java&lt;/p&gt;</comment>
                            <comment id="13232110" author="hadoopqa" created="Sun, 18 Mar 2012 00:47:16 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518814/HBASE-5521.D2097.10.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518814/HBASE-5521.D2097.10.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 15 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 164 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1218//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1218//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1218//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1218//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1218//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1218//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13232149" author="phabricator@reviews.facebook.net" created="Sun, 18 Mar 2012 04:19:42 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;  Looks good.&lt;/p&gt;

&lt;p&gt;  I will defer the acceptance decision to Mikhail.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java:40 Should we say &apos;uncompressed&apos; instead of &apos;not heavily compressed&apos; here so that the javadoc is consistent with the name of the method ?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13232334" author="phabricator@reviews.facebook.net" created="Sun, 18 Mar 2012 19:10:37 +0000"  >&lt;p&gt;heyongqiang has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;  i think Mikhail already did +1 on this. The last few updates are just to address tedyu&apos;s comments&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13232824" author="phabricator@reviews.facebook.net" created="Mon, 19 Mar 2012 19:11:36 +0000"  >&lt;p&gt;mbautin has accepted the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  svn&lt;/p&gt;</comment>
                            <comment id="13232826" author="mikhail" created="Mon, 19 Mar 2012 19:14:14 +0000"  >&lt;p&gt;Attaching what has been committed.&lt;/p&gt;</comment>
                            <comment id="13232831" author="hadoopqa" created="Mon, 19 Mar 2012 19:22:08 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518927/HBASE-5521-jira-Move-compression-decompression-to-an-2012-03-19_12_12_32.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518927/HBASE-5521-jira-Move-compression-decompression-to-an-2012-03-19_12_12_32.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 19 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1225//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1225//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13232832" author="phabricator@reviews.facebook.net" created="Mon, 19 Mar 2012 19:23:37 +0000"  >&lt;p&gt;mbautin has committed the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding context&quot;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;COMMIT&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/rHBASE1302602&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/rHBASE1302602&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13232856" author="mikhail" created="Mon, 19 Mar 2012 20:12:56 +0000"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                            <comment id="13233245" author="hudson" created="Tue, 20 Mar 2012 06:11:02 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #143 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/143/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/143/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; title=&quot;Move compression/decompression to an encoder specific encoding context&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5521&quot;&gt;&lt;del&gt;HBASE-5521&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Move compression/decompression to an encoder specific encoding&lt;br/&gt;
context&lt;/p&gt;

&lt;p&gt;Author: Yongqiang He&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5521&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5521&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;As part of working on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5313&quot; title=&quot;Restructure hfiles layout for better compression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5313&quot;&gt;HBASE-5313&lt;/a&gt;, we want to add a new columnar encoder/decoder.&lt;br/&gt;
It makes sense to move compression to be part of encoder/decoder:&lt;br/&gt;
1) a scanner for a columnar encoded block can do lazy decompression to a&lt;br/&gt;
specific part of a key value object&lt;br/&gt;
2) avoid an extra bytes copy from encoder to hblock-writer.&lt;/p&gt;

&lt;p&gt;If there is no encoder specified for a writer, the HBlock.Writer will use a&lt;br/&gt;
default compression-context to do something very similar to today&apos;s code.&lt;/p&gt;

&lt;p&gt;Test Plan: existing unit tests verified by mbautin and tedyu. And no new test&lt;br/&gt;
added here since this code is just a preparation for columnar encoder. Will add&lt;br/&gt;
testcase later in that diff.&lt;/p&gt;

&lt;p&gt;Reviewers: dhruba, tedyu, sc, mbautin&lt;/p&gt;

&lt;p&gt;Reviewed By: mbautin&lt;/p&gt;

&lt;p&gt;Differential Revision: &lt;a href=&quot;https://reviews.facebook.net/D2097&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D2097&lt;/a&gt; (Revision 1302602)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
mbautin : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/encoding/BufferedDataBlockEncoder.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/encoding/CopyKeyDataBlockEncoder.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoder.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/encoding/DataBlockEncoding.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/encoding/DiffKeyDeltaEncoder.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/encoding/EncodedDataBlock.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/encoding/FastDiffDeltaEncoder.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDecodingContext.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultDecodingContext.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockDefaultEncodingContext.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/encoding/HFileBlockEncodingContext.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/encoding/PrefixKeyDeltaEncoder.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/Compression.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileBlock.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoder.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileDataBlockEncoderImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/NoOpDataBlockEncoder.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/io/encoding/TestDataBlockEncoders.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlock.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileBlockCompatibility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/io/hfile/TestHFileDataBlockEncoder.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/DataBlockEncodingTool.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13775365" author="stack" created="Mon, 23 Sep 2013 18:31:20 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12517118" name="ASF.LICENSE.NOT.GRANTED--HBASE-5521.D2097.1.patch" size="62597" author="phabricator@reviews.facebook.net" created="Mon, 5 Mar 2012 20:13:55 +0000"/>
                            <attachment id="12518814" name="ASF.LICENSE.NOT.GRANTED--HBASE-5521.D2097.10.patch" size="110850" author="phabricator@reviews.facebook.net" created="Sat, 17 Mar 2012 23:54:38 +0000"/>
                            <attachment id="12517294" name="ASF.LICENSE.NOT.GRANTED--HBASE-5521.D2097.2.patch" size="68853" author="phabricator@reviews.facebook.net" created="Tue, 6 Mar 2012 19:47:57 +0000"/>
                            <attachment id="12517319" name="ASF.LICENSE.NOT.GRANTED--HBASE-5521.D2097.3.patch" size="81139" author="phabricator@reviews.facebook.net" created="Tue, 6 Mar 2012 22:17:56 +0000"/>
                            <attachment id="12517375" name="ASF.LICENSE.NOT.GRANTED--HBASE-5521.D2097.4.patch" size="83126" author="phabricator@reviews.facebook.net" created="Wed, 7 Mar 2012 07:01:59 +0000"/>
                            <attachment id="12517499" name="ASF.LICENSE.NOT.GRANTED--HBASE-5521.D2097.5.patch" size="84110" author="phabricator@reviews.facebook.net" created="Thu, 8 Mar 2012 00:54:57 +0000"/>
                            <attachment id="12518539" name="ASF.LICENSE.NOT.GRANTED--HBASE-5521.D2097.6.patch" size="105390" author="phabricator@reviews.facebook.net" created="Thu, 15 Mar 2012 21:02:36 +0000"/>
                            <attachment id="12518742" name="ASF.LICENSE.NOT.GRANTED--HBASE-5521.D2097.7.patch" size="109234" author="phabricator@reviews.facebook.net" created="Fri, 16 Mar 2012 22:06:39 +0000"/>
                            <attachment id="12518757" name="ASF.LICENSE.NOT.GRANTED--HBASE-5521.D2097.8.patch" size="110875" author="phabricator@reviews.facebook.net" created="Sat, 17 Mar 2012 00:40:36 +0000"/>
                            <attachment id="12518781" name="ASF.LICENSE.NOT.GRANTED--HBASE-5521.D2097.9.patch" size="110797" author="phabricator@reviews.facebook.net" created="Sat, 17 Mar 2012 08:13:38 +0000"/>
                            <attachment id="12518927" name="HBASE-5521-jira-Move-compression-decompression-to-an-2012-03-19_12_12_32.patch" size="119202" author="mikhail" created="Mon, 19 Mar 2012 19:14:14 +0000"/>
                            <attachment id="12517115" name="HBASE-5521.1.patch" size="63315" author="he yongqiang" created="Mon, 5 Mar 2012 19:48:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 5 Mar 2012 19:51:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230406</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0htlb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>102056</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>