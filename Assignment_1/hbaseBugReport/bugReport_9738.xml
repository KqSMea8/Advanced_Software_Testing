<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:07:07 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9738/HBASE-9738.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9738] Delete table and loadbalancer interference</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9738</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I have noticed that when the balancer is computing a plan for region moves, and a delete table is issued, there is some interference.&lt;/p&gt;

&lt;p&gt;1. At time t1, user deleted the table.&lt;/p&gt;

&lt;p&gt;2. This led to the master updating the meta table to remove the line for the regioninfo for a region f2a9e2e9d70894c03f54ee5902bebee6.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-10-04 08:42:52,495 INFO  [MASTER_TABLE_OPERATIONS-hor15n05:60000-0] catalog.MetaEditor: Deleted [{ENCODED =&amp;gt; f2a9e2e9d70894c03f54ee5902bebee6, NAME =&amp;gt; &apos;usertable,,1380876170581.f2a9e2e9d70894c03f54ee5902bebee6.&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;}]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;3. However around the same time, the balancer kicked in, and reassigned the region and made it online somewhere. It didn&apos;t check the fact (nor anyone else did) that the table was indeed deleted.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-10-04 08:42:53,215 INFO  [hor15n05.gq1.ygridcore.net,60000,1380869262259-BalancerChore] master.HMaster: balance hri=usertable,,1380876170581.f2a9e2e9d70894c03f54ee5902bebee6., src=hor15n09.gq1.ygridcore.net,60020,1380869263722, dest=hor15n11.gq1.ygridcore.net,60020,1380869263682
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;.....&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-10-04 08:42:53,592 INFO  [AM.ZK.Worker-pool2-t829] master.RegionStates: Onlined f2a9e2e9d70894c03f54ee5902bebee6 on hor15n11.gq1.ygridcore.net,60020,1380869263682
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4. Henceforth, all the drop tables started giving warnings like&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-10-04 08:45:17,587 INFO  [RpcServer.handler=8,port=60000] master.HMaster: Client=hrt_qa//68.142.246.151 delete usertable
2013-10-04 08:45:17,631 DEBUG [RpcServer.handler=8,port=60000] lock.ZKInterProcessLockBase: Acquired a lock for /hbase/table-lock/usertable/write-master:600000000000000
2013-10-04 08:45:17,637 WARN  [RpcServer.handler=8,port=60000] catalog.MetaReader: No serialized HRegionInfo in keyvalues={usertable,,1380876170581.f2a9e2e9d70894c03f54ee5902bebee6./info:seqnumDuringOpen/1380876173509/Put/vlen=8/mvcc=0, usertable,,1380876170581.f2a9e2e9d70894c03f54ee5902bebee6./info:server/1380876173509/Put/vlen=32/mvcc=0, usertable,,1380876170581.f2a9e2e9d70894c03f54ee5902bebee6./info:serverstartcode/1380876173509/Put/vlen=8/mvcc=0}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;5. The create of the same table also fails since there is still state (reincarnated, maybe) about the table in the master.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12673134">HBASE-9738</key>
            <summary>Delete table and loadbalancer interference</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="devaraj">Devaraj Das</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Oct 2013 22:43:57 +0000</created>
                <updated>Wed, 3 Jun 2015 15:29:15 +0000</updated>
                            <resolved>Mon, 30 Mar 2015 21:48:48 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13791193" author="eclark" created="Thu, 10 Oct 2013 04:38:20 +0000"  >&lt;p&gt;I think we&apos;re seeing this in testing.  Just saw this during a run of Big Linked List.&lt;/p&gt;</comment>
                            <comment id="14382993" author="mantonov" created="Thu, 26 Mar 2015 23:57:41 +0000"  >&lt;p&gt;Interesting, as I look at HMaster#balance(), we don&apos;t check for table being in &lt;/p&gt;
{disabled, disabling}
&lt;p&gt; state when computing plans at all,  and in AssignmentManager#balance we first check table state (without grabbing any lock) and don&apos;t actually execute plans for known disabled tables, then we only grab region lock (locker.acquireLock(encodedName)&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, but doesn&apos;t seem we&apos;re getting TableLock here.&lt;/p&gt;

&lt;p&gt;So I guess the desired behavior is that we don&apos;t allow users to disable table if some of its regions are being balanced?&lt;/p&gt;

&lt;p&gt;Disabling table requires writeLock, so getting readLock under balancer would be right (not too coarse-grained?).&lt;/p&gt;

&lt;p&gt;Alternatively, we could probably add new table state (&quot;BALANCING&quot;), but that seems overkill.&lt;/p&gt;

</comment>
                            <comment id="14382999" author="mantonov" created="Thu, 26 Mar 2015 23:58:44 +0000"  >&lt;p&gt;Oh, just noticed the dates.. wondering if it has it been observed recently.&lt;/p&gt;</comment>
                            <comment id="14383013" author="mantonov" created="Fri, 27 Mar 2015 00:11:33 +0000"  >&lt;p&gt;Seems to be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10349&quot; title=&quot;Table became unusable when master balanced its region after table was dropped&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10349&quot;&gt;&lt;del&gt;HBASE-10349&lt;/del&gt;&lt;/a&gt;, yet that one deals with balancing of deleted table.&lt;/p&gt;</comment>
                            <comment id="14384828" author="mantonov" created="Fri, 27 Mar 2015 22:43:47 +0000"  >&lt;p&gt;pinging &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; as fix version is marked as 1.1&lt;/p&gt;</comment>
                            <comment id="14387484" author="devaraj" created="Mon, 30 Mar 2015 21:48:48 +0000"  >&lt;p&gt;Thanks for checking &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mantonov&quot; class=&quot;user-hover&quot; rel=&quot;mantonov&quot;&gt;Mikhail Antonov&lt;/a&gt;. I think this got fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10349&quot; title=&quot;Table became unusable when master balanced its region after table was dropped&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10349&quot;&gt;&lt;del&gt;HBASE-10349&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14387489" author="mantonov" created="Mon, 30 Mar 2015 21:51:40 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=devaraj&quot; class=&quot;user-hover&quot; rel=&quot;devaraj&quot;&gt;Devaraj Das&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14571142" author="ndimiduk" created="Wed, 3 Jun 2015 15:29:15 +0000"  >&lt;p&gt;Closing issues released in 1.1.0.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12689110">HBASE-10349</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Oct 2013 04:38:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352757</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 28 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1othj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353044</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>