<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:45:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13659/HBASE-13659.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13659] Improve test run time for TestMetaWithReplicas class</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13659</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In TestMetaWithReplicas, start and shutdown of mini cluster is done at start and end of every test in that class respectively, which makes the test class to take more time to complete. Instead we can start and stop the mini cluster only once per the class.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12828835">HBASE-13659</key>
            <summary>Improve test run time for TestMetaWithReplicas class</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12828758">HBASE-13657</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ashish singhi">Ashish Singhi</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 May 2015 14:51:24 +0000</created>
                <updated>Fri, 3 Jul 2015 05:23:46 +0000</updated>
                            <resolved>Fri, 3 Jul 2015 05:23:46 +0000</resolved>
                                    <version>1.1.0</version>
                                                    <component>test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14538256" author="hadoopqa" created="Mon, 11 May 2015 17:45:23 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12731937/HBASE-13659.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12731937/HBASE-13659.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 9aeafe30b7d932e562f803fd071812cd27aebaf8.&lt;br/&gt;
  ATTACHMENT ID: 12731937&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14008//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14008//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14008//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14008//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14008//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14008//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14008//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14008//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14538278" author="ashish singhi" created="Mon, 11 May 2015 17:54:06 +0000"  >&lt;p&gt;In build #14007 it took 1min 50secs to complete the test where as the patch build i.e., #14008 took 1min 3secs.&lt;/p&gt;</comment>
                            <comment id="14587363" author="ndimiduk" created="Tue, 16 Jun 2015 02:39:15 +0000"  >&lt;p&gt;LGTM. What say you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=devaraj&quot; class=&quot;user-hover&quot; rel=&quot;devaraj&quot;&gt;Devaraj Das&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14590185" author="ndimiduk" created="Wed, 17 Jun 2015 17:59:26 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashish+singhi&quot; class=&quot;user-hover&quot; rel=&quot;ashish singhi&quot;&gt;Ashish Singhi&lt;/a&gt; I applied your patch here to master, works fine. Brought it back to branch-1 and I&apos;m seeing it consistently hang.&lt;/p&gt;

&lt;p&gt;From jstack&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;main&quot; prio=5 tid=0x00007fe8e980b800 nid=0x1903 waiting on condition [0x000000010cd5e000]
   java.lang.Thread.State: TIMED_WAITING (sleeping)
        at java.lang.Thread.sleep(Native Method)
        at org.apache.hadoop.hbase.util.Threads.sleep(Threads.java:146)
        at org.apache.hadoop.hbase.MiniHBaseCluster.waitForActiveAndReadyMaster(MiniHBaseCluster.java:485)
        at org.apache.hadoop.hbase.HBaseCluster.waitForActiveAndReadyMaster(HBaseCluster.java:205)
        at org.apache.hadoop.hbase.client.TestMetaWithReplicas.shutdownMetaAndDoValidations(TestMetaWithReplicas.java:221)
        at org.apache.hadoop.hbase.client.TestMetaWithReplicas.testShutdownHandling(TestMetaWithReplicas.java:145)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the test logs, I see&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2015-06-17 10:53:09,602 WARN  [main] regionserver.HRegionServer(2063): Unable to report fatal error to master
com.google.protobuf.ServiceException: org.apache.hadoop.hbase.exceptions.ConnectionClosingException: Call to /10.0.0.110:50399 failed on local exception: org.apache.hadoop.hbase.exceptions.ConnectionClosingException: Connection to /10.0.0.110:50399 is closing. Call id=47, waitTime=1
	at org.apache.hadoop.hbase.ipc.AbstractRpcClient.callBlockingMethod(AbstractRpcClient.java:224)
	at org.apache.hadoop.hbase.ipc.AbstractRpcClient$BlockingRpcChannelImplementation.callBlockingMethod(AbstractRpcClient.java:288)
	at org.apache.hadoop.hbase.protobuf.generated.RegionServerStatusProtos$RegionServerStatusService$BlockingStub.reportRSFatalError(RegionServerStatusProtos.java:9006)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.abort(HRegionServer.java:2060)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.abortRegionServer(MiniHBaseCluster.java:174)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.access$200(MiniHBaseCluster.java:108)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer$2.run(MiniHBaseCluster.java:167)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:356)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1594)
	at org.apache.hadoop.hbase.security.User$SecureHadoopUser.runAs(User.java:306)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.abort(MiniHBaseCluster.java:165)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.abort(HRegionServer.java:2072)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.kill(HRegionServer.java:2087)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.kill(MiniHBaseCluster.java:161)
	at org.apache.hadoop.hbase.MiniHBaseCluster.killRegionServer(MiniHBaseCluster.java:246)
	at org.apache.hadoop.hbase.client.TestMetaWithReplicas.shutdownMetaAndDoValidations(TestMetaWithReplicas.java:201)
	at org.apache.hadoop.hbase.client.TestMetaWithReplicas.testShutdownHandling(TestMetaWithReplicas.java:145)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14590196" author="ndimiduk" created="Wed, 17 Jun 2015 18:02:54 +0000"  >&lt;p&gt;Looks like it&apos;s getting stuck replaying logs to recover a killed RS, meanwhile master just hangs waiting for minimum number of RS&apos;s to rejoin cluster.&lt;/p&gt;

&lt;p&gt;Attaching test run log.&lt;/p&gt;</comment>
                            <comment id="14590200" author="ndimiduk" created="Wed, 17 Jun 2015 18:03:57 +0000"  >&lt;p&gt;Pushing out of 1.1.1 for now.&lt;/p&gt;</comment>
                            <comment id="14590789" author="hadoopqa" created="Wed, 17 Jun 2015 22:55:22 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12740165/org.apache.hadoop.hbase.client.TestMetaWithReplicas-output.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12740165/org.apache.hadoop.hbase.client.TestMetaWithReplicas-output.txt&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 623fd63827b2953c150597f24c7205737119bebe.&lt;br/&gt;
  ATTACHMENT ID: 12740165&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 179 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14451//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14451//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14591338" author="ashish singhi" created="Thu, 18 Jun 2015 06:36:31 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; for looking into this.&lt;br/&gt;
&lt;tt&gt;testShutdownHandling&lt;/tt&gt; was failing because as you said &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13659?focusedCommentId=14590196&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14590196&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;here&lt;/a&gt;. But then checked why we have only 2 online RS in the cluster ? I found that in &lt;tt&gt;testShutdownOfReplicaHolder&lt;/tt&gt; we are killing a RS but not starting it back. So now we are left with only 2 RS online in the cluster but master will keep on wait for 3(minimum) RS to become online.&lt;br/&gt;
Attached patch for branch-1.1.&lt;br/&gt;
But looks like it is not failing in master branch but better we can commit the same branch-1.1 patch in master branch also.&lt;/p&gt;

&lt;p&gt;Please review.&lt;/p&gt;</comment>
                            <comment id="14591553" author="hadoopqa" created="Thu, 18 Jun 2015 09:32:19 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12740315/HBASE-13659-branch-1.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12740315/HBASE-13659-branch-1.1.patch&lt;/a&gt;&lt;br/&gt;
  against branch-1.1 branch at commit 41d9e8d9b4895d0711f006d926a39e5ae3bd7c9d.&lt;br/&gt;
  ATTACHMENT ID: 12740315&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14452//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14452//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14452//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14452//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14452//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14452//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14452//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14452//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14591642" author="ashish singhi" created="Thu, 18 Jun 2015 11:00:42 +0000"  >&lt;p&gt;I have attached another patch v1 for branch-1.1. In this instead of starting RS again at the end of &lt;tt&gt;testShutdownOfReplicaHolder&lt;/tt&gt; I have set the conf &lt;tt&gt;hbase.master.wait.on.regionservers.mintostart&lt;/tt&gt; to 2. With this all the tests in this class are passing 5/5 times. With the earlier patch for branch-1.1 there were some tests which were flakey&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;java.lang.AssertionError: null
	at org.apache.hadoop.hbase.client.TestMetaWithReplicas.testMetaAddressChange(TestMetaWithReplicas.java:368)

testHBaseFsckWithMetaReplicas(org.apache.hadoop.hbase.client.TestMetaWithReplicas)  Time elapsed: 0.234 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: expected:&amp;lt;[]&amp;gt; but was:&amp;lt;[MULTI_META_REGION, UNKNOWN]&amp;gt;
	at org.junit.Assert.fail(Assert.java:88)
	at org.junit.Assert.failNotEquals(Assert.java:743)
	at org.junit.Assert.assertEquals(Assert.java:118)
	at org.junit.Assert.assertEquals(Assert.java:144)
	at org.apache.hadoop.hbase.util.hbck.HbckTestingUtil.assertNoErrors(HbckTestingUtil.java:91)
	at org.apache.hadoop.hbase.client.TestMetaWithReplicas.testHBaseFsckWithMetaReplicas(TestMetaWithReplicas.java:279)

testHBaseFsckWithExcessMetaReplicas(org.apache.hadoop.hbase.client.TestMetaWithReplicas)  Time elapsed: 1.29 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: expected:&amp;lt;[UNKNOWN, SHOULD_NOT_BE_DEPLOYED]&amp;gt; but was:&amp;lt;[UNKNOWN, SHOULD_NOT_BE_DEPLOYED, MULTI_META_REGION]&amp;gt;
	at org.junit.Assert.fail(Assert.java:88)
	at org.junit.Assert.failNotEquals(Assert.java:743)
	at org.junit.Assert.assertEquals(Assert.java:118)
	at org.junit.Assert.assertEquals(Assert.java:144)
	at org.apache.hadoop.hbase.util.hbck.HbckTestingUtil.assertErrors(HbckTestingUtil.java:99)
	at org.apache.hadoop.hbase.client.TestMetaWithReplicas.testHBaseFsckWithExcessMetaReplicas(TestMetaWithReplicas.java:412)

testHBaseFsckWithFewerMetaReplicas(org.apache.hadoop.hbase.client.TestMetaWithReplicas)  Time elapsed: 1.265 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: expected:&amp;lt;[UNKNOWN, NO_META_REGION]&amp;gt; but was:&amp;lt;[UNKNOWN, NO_META_REGION, SHOULD_NOT_BE_DEPLOYED, MULTI_META_REGION]&amp;gt;
	at org.junit.Assert.fail(Assert.java:88)
	at org.junit.Assert.failNotEquals(Assert.java:743)
	at org.junit.Assert.assertEquals(Assert.java:118)
	at org.junit.Assert.assertEquals(Assert.java:144)
	at org.apache.hadoop.hbase.util.hbck.HbckTestingUtil.assertErrors(HbckTestingUtil.java:99)
	at org.apache.hadoop.hbase.client.TestMetaWithReplicas.testHBaseFsckWithFewerMetaReplicas(TestMetaWithReplicas.java:292)

testMetaLookupThreadPoolCreated(org.apache.hadoop.hbase.client.TestMetaWithReplicas)  Time elapsed: 1.301 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
org.apache.hadoop.hbase.TableNotFoundException: Table &apos;testMetaLookupThreadPoolCreated&apos; was not found, got: hbase:namespace.
	at org.apache.hadoop.hbase.client.ConnectionManager$HConnectionImplementation.locateRegionInMeta(ConnectionManager.java:1274)
	at org.apache.hadoop.hbase.client.ConnectionManager$HConnectionImplementation.locateRegion(ConnectionManager.java:1155)
	at org.apache.hadoop.hbase.client.ConnectionManager$HConnectionImplementation.relocateRegion(ConnectionManager.java:1126)
	at org.apache.hadoop.hbase.client.ConnectionManager$HConnectionImplementation.relocateRegion(ConnectionManager.java:1110)
	at org.apache.hadoop.hbase.client.ConnectionManager$HConnectionImplementation.relocateRegion(ConnectionManager.java:1132)
	at org.apache.hadoop.hbase.client.TestMetaWithReplicas.testMetaLookupThreadPoolCreated(TestMetaWithReplicas.java:234)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I could not find out the fix for this as I am not much aware of read replica feature &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=devaraj&quot; class=&quot;user-hover&quot; rel=&quot;devaraj&quot;&gt;Devaraj Das&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt;... can you help on this ?&lt;/p&gt;</comment>
                            <comment id="14591919" author="hadoopqa" created="Thu, 18 Jun 2015 14:48:24 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12740364/HBASE-13659-branch-1.1-v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12740364/HBASE-13659-branch-1.1-v1.patch&lt;/a&gt;&lt;br/&gt;
  against branch-1.1 branch at commit 51b606cd185437802f0a7a4620f1434e8e2d9c74.&lt;br/&gt;
  ATTACHMENT ID: 12740364&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn post-site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportExport&lt;br/&gt;
                  org.apache.hadoop.hbase.util.TestProcessBasedCluster&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14460//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14460//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14460//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14460//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14460//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14460//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14460//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14460//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14593037" author="ashish singhi" created="Fri, 19 Jun 2015 05:44:22 +0000"  >&lt;p&gt;Still there is a flakey test&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Flaked tests: 
org.apache.hadoop.hbase.client.TestMetaWithReplicas.testMetaAddressChange(org.apache.hadoop.hbase.client.TestMetaWithReplicas)
  Run 1: TestMetaWithReplicas.testMetaAddressChange:370 null
  Run 2: PASS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14611266" author="ndimiduk" created="Thu, 2 Jul 2015 00:58:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashish+singhi&quot; class=&quot;user-hover&quot; rel=&quot;ashish singhi&quot;&gt;Ashish Singhi&lt;/a&gt; I think your patch makes things better than they were, certainly the &lt;tt&gt;conf.setInt(ServerManager.WAIT_ON_REGIONSERVERS_MINTOSTART, 2);&lt;/tt&gt; bit.&lt;/p&gt;

&lt;p&gt;I&apos;m seeing consistent failure at like 370 as well. Adding some extra logging,&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2015-07-01 17:36:34,023 INFO  [main] client.TestMetaWithReplicas(350): testMetaAddressChange -- i think meta is on 10.0.0.110,59059,1435797366643
...
2015-07-01 17:36:35,686 INFO  [main] client.TestMetaWithReplicas(367): testMetaAddressChange -- sending move request of 1588230740 to 10.0.0.110,58926,1435797319567
2015-07-01 17:36:35,687 DEBUG [B.defaultRpcServer.handler=0,queue=0,port=59142] master.HMaster(1402): Skipping move of region hbase:meta,,1.1588230740 because region already assigned to the same server 10.0.0.110,58926,1435797319567.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In between here and there there&apos;s no mention of &lt;tt&gt;1588230740&lt;/tt&gt;. This is failing consistently for me locally.&lt;/p&gt;

&lt;p&gt;No comment here &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=devaraj&quot; class=&quot;user-hover&quot; rel=&quot;devaraj&quot;&gt;Devaraj Das&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14611279" author="devaraj" created="Thu, 2 Jul 2015 01:06:24 +0000"  >&lt;p&gt;Let me take a look at it later tonight. I think when I wrote the tests I deliberately did it this way - start/shutdown cluster for each test, maybe because I was mucking around with ZK. Not sure why..&lt;/p&gt;</comment>
                            <comment id="14611282" author="ndimiduk" created="Thu, 2 Jul 2015 01:06:35 +0000"  >&lt;p&gt;adding&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    RegionLocator metaLoc = TEST_UTIL.getConnection().getRegionLocator(TableName.META_TABLE_NAME);
    LOG.info(&quot;testMetaAddressChange -- metaLocator says &quot;
            + metaLoc.getRegionLocation(null).getServerName().getServerName());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It now seems the way the test parses meta location and the location returned by &lt;tt&gt;RegionLocator&lt;/tt&gt; instance disagree. Maybe &lt;tt&gt;RegionLocator&lt;/tt&gt; is not looking specifically for the first replica?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2015-07-01 17:57:53,135 INFO  [main] client.TestMetaWithReplicas(340): testMetaAddressChange -- starting test.
2015-07-01 17:57:53,136 INFO  [main] client.TestMetaWithReplicas(350): testMetaAddressChange -- parsed meta location is 10.0.0.110,59702,1435798645712
2015-07-01 17:57:53,136 INFO  [main] client.TestMetaWithReplicas(352): testMetaAddressChange -- metaLocator says 10.0.0.110,59570,1435798598482
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Test looks for meta with&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    ZooKeeperWatcher zkw = TEST_UTIL.getZooKeeperWatcher();
    String baseZNode = conf.get(HConstants.ZOOKEEPER_ZNODE_PARENT,
        HConstants.DEFAULT_ZOOKEEPER_ZNODE_PARENT);
    String primaryMetaZnode = ZKUtil.joinZNode(baseZNode,
        conf.get(&quot;zookeeper.znode.metaserver&quot;, &quot;meta-region-server&quot;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;while &lt;tt&gt;ZooKeeperWatcher&lt;/tt&gt; appears to use&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;      str = ZKUtil.joinZNode(baseZNode,
          conf.get(&quot;zookeeper.znode.metaserver&quot;, &quot;meta-region-server&quot;) + &quot;-&quot; + replicaId);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Looking at logic in &lt;tt&gt;MetaTableLocator&lt;/tt&gt;, it seems to specify a default replicaId of 1, which means it&apos;ll always be going to a &lt;tt&gt;&quot;-&quot; + replicaId&lt;/tt&gt; location instead of the bare location used in the test.&lt;/p&gt;</comment>
                            <comment id="14612382" author="ndimiduk" created="Thu, 2 Jul 2015 18:59:07 +0000"  >&lt;p&gt;I&apos;ve run this test without the patch a bunch of times locally and it&apos;s passing consistently. I guess the test depends on resetting the cluster each round.&lt;/p&gt;</comment>
                            <comment id="14612554" author="devaraj" created="Thu, 2 Jul 2015 21:26:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;I guess the test depends on resetting the cluster each round&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think so too but it has been a while since I wrote those tests.. &lt;/p&gt;</comment>
                            <comment id="14612851" author="ashish singhi" created="Fri, 3 Jul 2015 05:23:46 +0000"  >&lt;p&gt;I have closed this as Won&apos;t Fix, if it should be something else just let me know.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12740364" name="HBASE-13659-branch-1.1-v1.patch" size="3975" author="ashish singhi" created="Thu, 18 Jun 2015 10:53:26 +0000"/>
                            <attachment id="12740315" name="HBASE-13659-branch-1.1.patch" size="4925" author="ashish singhi" created="Thu, 18 Jun 2015 06:28:05 +0000"/>
                            <attachment id="12731937" name="HBASE-13659.patch" size="3112" author="ashish singhi" created="Mon, 11 May 2015 14:53:44 +0000"/>
                            <attachment id="12740165" name="org.apache.hadoop.hbase.client.TestMetaWithReplicas-output.txt" size="670446" author="ndimiduk" created="Wed, 17 Jun 2015 18:02:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 May 2015 17:45:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 24 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ek7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>