<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:02:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2461/HBASE-2461.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2461] Split doesn&apos;t handle IOExceptions when creating new region reference files</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2461</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I was testing an HDFS patch which had a bug in it, so it happened to throw an NPE during a split with the following trace:&lt;/p&gt;

&lt;p&gt;2010-04-16 19:18:20,727 ERROR org.apache.hadoop.hbase.regionserver.CompactSplitThread: Compaction failed for region TestTable,-1945465867&amp;lt;1271449232310&amp;gt;,1271453785648&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.enqueueCurrentPacket(DFSClient.java:3124)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.flushInternal(DFSClient.java:3220)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.closeInternal(DFSClient.java:3306)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.close(DFSClient.java:3255)&lt;br/&gt;
        at org.apache.hadoop.fs.FSDataOutputStream$PositionCache.close(FSDataOutputStream.java:61)&lt;br/&gt;
        at org.apache.hadoop.fs.FSDataOutputStream.close(FSDataOutputStream.java:86)&lt;br/&gt;
        at org.apache.hadoop.fs.FileSystem.createNewFile(FileSystem.java:560)&lt;br/&gt;
        at org.apache.hadoop.hbase.util.FSUtils.create(FSUtils.java:95)&lt;br/&gt;
        at org.apache.hadoop.hbase.io.Reference.write(Reference.java:129)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.StoreFile.split(StoreFile.java:498)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.splitRegion(HRegion.java:682)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.CompactSplitThread.split(CompactSplitThread.java:162)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.CompactSplitThread.run(CompactSplitThread.java:95)&lt;/p&gt;

&lt;p&gt;After that, my region was gone, any further writes to it would fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12462302">HBASE-2461</key>
            <summary>Split doesn&apos;t handle IOExceptions when creating new region reference files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                            <label>moved_from_0_20_5</label>
                    </labels>
                <created>Sat, 17 Apr 2010 02:39:49 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:40 +0000</updated>
                            <resolved>Wed, 4 Aug 2010 00:02:47 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12858079" author="stack" created="Sat, 17 Apr 2010 02:44:59 +0000"  >&lt;p&gt;Marking as a blocker and moving into 0.20.5 and 0.21.&lt;/p&gt;</comment>
                            <comment id="12858171" author="apurtell" created="Sat, 17 Apr 2010 17:11:31 +0000"  >&lt;p&gt;I think this, and all related tightening up what we do when IOE from FS, should be a subtask of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1964&quot; title=&quot;Enter temporary &amp;quot;safe mode&amp;quot; to ride over transient FS layer problems&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1964&quot;&gt;&lt;del&gt;HBASE-1964&lt;/del&gt;&lt;/a&gt;. At the Hackathon we&apos;d like to start chasing these down with a modified DFSClient that we can inject faults, either random with adjustable probabilities or always on particular code paths. &lt;/p&gt;</comment>
                            <comment id="12866816" author="stack" created="Wed, 12 May 2010 23:48:30 +0000"  >&lt;p&gt;Bulk move of 0.20.5 issues into 0.21.0 after vote that we merge branch into TRUNK up on list.&lt;/p&gt;</comment>
                            <comment id="12879585" author="stack" created="Wed, 16 Jun 2010 23:51:39 +0000"  >&lt;p&gt;Inside in split, at a particular point, we close the parent region.  Thereafter, we start in splitting the parents files.  If an exception, we&apos;ll come up out of the split method but the parent is not reopened.  Parent should be set read-only or something and only closed after daughters are created and registered in META.  Assigning myself.&lt;/p&gt;</comment>
                            <comment id="12879679" author="stack" created="Thu, 17 Jun 2010 06:04:40 +0000"  >&lt;p&gt;This issue highlights how exceptions post close of the region-to-be-split &amp;#8211; a necessary action if the split is to come out clean &amp;#8211; can poke a hole in an online table.&lt;/p&gt;

&lt;p&gt;This patch starts down a road of treating the split operation inside in the regionserver as a &apos;transaction&apos;.  There is a prepare step and an execute step.  Should the execute fail &amp;#8211; execute step has stuff like close of region, update of meta table with new split codes &amp;#8211; then we&apos;ll call rollback.  The rollback will try and fixup the failed split by doing things like reopening region if appropriate and fixing up meta if necessary.&lt;/p&gt;

&lt;p&gt;If the rollback fails, we&apos;ll kill the regionserver so that the processing of the server shutdown gets the effected regions back on line again.&lt;/p&gt;

&lt;p&gt;Patch is not ready yet.&lt;/p&gt;</comment>
                            <comment id="12893414" author="stack" created="Wed, 28 Jul 2010 23:04:12 +0000"  >&lt;p&gt;v2 &amp;#8211; still not done.. going to be fun testing this.&lt;/p&gt;</comment>
                            <comment id="12894053" author="stack" created="Fri, 30 Jul 2010 14:20:15 +0000"  >&lt;p&gt;Taking a different approach.... not done yet.&lt;/p&gt;</comment>
                            <comment id="12894254" author="stack" created="Sat, 31 Jul 2010 06:46:01 +0000"  >&lt;p&gt;Implementation done.  Tests next.&lt;/p&gt;</comment>
                            <comment id="12894434" author="stack" created="Mon, 2 Aug 2010 00:00:28 +0000"  >&lt;p&gt;This seems to work.  Needs more tests first though before I post it to review board.&lt;/p&gt;</comment>
                            <comment id="12894774" author="stack" created="Tue, 3 Aug 2010 01:24:53 +0000"  >&lt;p&gt;Posting this to review board.&lt;/p&gt;

&lt;p&gt;Patch that keeps a journal during split transaction.  If split fails, call to rollback will restore the parent to original open condition by backing up whatever transaction steps completed.&lt;/p&gt;

&lt;p&gt;The transaction spans split checks, closing of parent region and creation of daughters up to the addition of parent offlining to .META.  Once the .META. edit has been made, we cannot rollback &amp;#8211; we have to go forward.  This means that the basescanner fixup that will add missing daughter regions should the regionserver crash after parent region edit but before its added daughters is still required, in some form at least.&lt;/p&gt;

&lt;p&gt;This patch includes a test of the new split code but only run against an HRegion, not in server context.  The split code is buried in heart of the regionserver and created on startup.  I stared at it for a while and injecting fault was just forbidding.  Its like bramble; there are so many spikes in the way of getting your finger down into the running split I ended up passing on it.&lt;/p&gt;

&lt;p&gt;+ M src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java&lt;br/&gt;
(split): Most of the split code has been moved out to the new SplitTransaction class.&lt;br/&gt;
Now this method prepares the split transaction, executes, and if failure does rollback.&lt;/p&gt;

&lt;p&gt;+ M src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
(splitLock) Removed. Doesn&apos;t seem necessary.  Just  made close method synchronized.&lt;br/&gt;
(SPLITDIR) Moved to new SplitTransaction&lt;br/&gt;
Moved cleanup of half-done splits into SplitTransaction.  It&apos;ll know better how to do this.&lt;br/&gt;
Moved split code into SplitTransaction class.&lt;/p&gt;

&lt;p&gt;+ M src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
Made this class implement new OnlineRegions interface&lt;/p&gt;

&lt;p&gt;+ A src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java&lt;br/&gt;
New Interface that allows you add/remove regions from oline regions.  This Interface&lt;br/&gt;
adds little.  Was just trying to make it so I didn&apos;t have to have server context doing&lt;br/&gt;
tests but in the end I just passed null for the case of no server context.  Could remove&lt;br/&gt;
this.&lt;/p&gt;

&lt;p&gt;+ A src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;br/&gt;
New class that encapsulates all to do w/ splitting &quot;transaction&quot;.&lt;/p&gt;

&lt;p&gt;+ A src/main/java/org/apache/hadoop/hbase/util/PairOfSameType.java&lt;br/&gt;
Minor utility class&lt;/p&gt;

&lt;p&gt;+M src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;br/&gt;
(loadRegion) Added loading a region&lt;/p&gt;

&lt;p&gt;+ M src/test/java/org/apache/hadoop/hbase/io/TestImmutableBytesWritable.java&lt;br/&gt;
(testSpecificCompare) Unrelated change&lt;/p&gt;

&lt;p&gt;+ M src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;br/&gt;
Change because of new manner in which splits are run.  Added a splitRegions method.&lt;/p&gt;

&lt;p&gt;+ A src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransaction.java&lt;br/&gt;
Test of region splitting code in region context.  Testing in server context would take&lt;br/&gt;
a bunch of work making it so could insert mock instance of SplitTransaction.&lt;/p&gt;





</comment>
                            <comment id="12894775" author="hbasereviewboard" created="Tue, 3 Aug 2010 01:35:46 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/474/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/474/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Posting this to review board.&lt;/p&gt;

&lt;p&gt;Patch that keeps a journal during split transaction.  If split fails, call to rollback will restore the parent to original open condition by backing up whatever transaction steps completed.&lt;/p&gt;

&lt;p&gt;The transaction spans split checks, closing of parent region and creation of daughters up to the addition of parent offlining to .META.  Once the .META. edit has been made, we cannot rollback &amp;#8211; we have to go forward.  This means that the basescanner fixup that will add missing daughter regions should the regionserver crash after parent region edit but before its added daughters is still required, in some form at least.&lt;/p&gt;

&lt;p&gt;This patch includes a test of the new split code but only run against an HRegion, not in server context.  The split code is buried in heart of the regionserver and created on startup.  I stared at it for a while and injecting fault was just forbidding.  Its like bramble; there are so many spikes in the way of getting your finger down into the running split I ended up passing on it.&lt;/p&gt;

&lt;p&gt;+ M src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java&lt;br/&gt;
(split): Most of the split code has been moved out to the new SplitTransaction class.&lt;br/&gt;
Now this method prepares the split transaction, executes, and if failure does rollback.&lt;/p&gt;

&lt;p&gt;+ M src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
(splitLock) Removed. Doesn&apos;t seem necessary.  Just  made close method synchronized.&lt;br/&gt;
(SPLITDIR) Moved to new SplitTransaction&lt;br/&gt;
Moved cleanup of half-done splits into SplitTransaction.  It&apos;ll know better how to do this.&lt;br/&gt;
Moved split code into SplitTransaction class.&lt;/p&gt;

&lt;p&gt;+ M src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
Made this class implement new OnlineRegions interface&lt;/p&gt;

&lt;p&gt;+ A src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java&lt;br/&gt;
New Interface that allows you add/remove regions from oline regions.  This Interface&lt;br/&gt;
adds little.  Was just trying to make it so I didn&apos;t have to have server context doing&lt;br/&gt;
tests but in the end I just passed null for the case of no server context.  Could remove&lt;br/&gt;
this.&lt;/p&gt;

&lt;p&gt;+ A src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;br/&gt;
New class that encapsulates all to do w/ splitting &quot;transaction&quot;.&lt;/p&gt;

&lt;p&gt;+ A src/main/java/org/apache/hadoop/hbase/util/PairOfSameType.java&lt;br/&gt;
Minor utility class&lt;/p&gt;

&lt;p&gt;+M src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;br/&gt;
(loadRegion) Added loading a region&lt;/p&gt;

&lt;p&gt;+ M src/test/java/org/apache/hadoop/hbase/io/TestImmutableBytesWritable.java&lt;br/&gt;
(testSpecificCompare) Unrelated change&lt;/p&gt;

&lt;p&gt;+ M src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;br/&gt;
Change because of new manner in which splits are run.  Added a splitRegions method.&lt;/p&gt;

&lt;p&gt;+ A src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransaction.java&lt;br/&gt;
Test of region splitting code in region context.  Testing in server context would take&lt;br/&gt;
a bunch of work making it so could insert mock instance of SplitTransaction.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2461&quot; title=&quot;Split doesn&amp;#39;t handle IOExceptions when creating new region reference files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2461&quot;&gt;&lt;del&gt;HBASE-2461&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2461&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 7589db3 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 6dc41a4 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 6a54736 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/PairOfSameType.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 4d09fe9 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/TestImmutableBytesWritable.java 43fa6dd &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java 98bd3e5 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransaction.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/474/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/474/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Basic unit tests are passing.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;stack&lt;/p&gt;

</comment>
                            <comment id="12894811" author="stack" created="Tue, 3 Aug 2010 04:09:50 +0000"  >&lt;p&gt;This might work for injecting a mocked SplitTransaction so I can test failed split in running cluster.  Would need to provide alternate HRS implementation but unit test utility is already setup to allow this.&lt;/p&gt;</comment>
                            <comment id="12895025" author="hbasereviewboard" created="Tue, 3 Aug 2010 20:24:41 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/474/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/474/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-08-03 13:10:44.610359)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Found minor issue where wasnt&apos; returning if failed rollback.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Posting this to review board.&lt;/p&gt;

&lt;p&gt;Patch that keeps a journal during split transaction.  If split fails, call to rollback will restore the parent to original open condition by backing up whatever transaction steps completed.&lt;/p&gt;

&lt;p&gt;The transaction spans split checks, closing of parent region and creation of daughters up to the addition of parent offlining to .META.  Once the .META. edit has been made, we cannot rollback &amp;#8211; we have to go forward.  This means that the basescanner fixup that will add missing daughter regions should the regionserver crash after parent region edit but before its added daughters is still required, in some form at least.&lt;/p&gt;

&lt;p&gt;This patch includes a test of the new split code but only run against an HRegion, not in server context.  The split code is buried in heart of the regionserver and created on startup.  I stared at it for a while and injecting fault was just forbidding.  Its like bramble; there are so many spikes in the way of getting your finger down into the running split I ended up passing on it.&lt;/p&gt;

&lt;p&gt;+ M src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java&lt;br/&gt;
(split): Most of the split code has been moved out to the new SplitTransaction class.&lt;br/&gt;
Now this method prepares the split transaction, executes, and if failure does rollback.&lt;/p&gt;

&lt;p&gt;+ M src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
(splitLock) Removed. Doesn&apos;t seem necessary.  Just  made close method synchronized.&lt;br/&gt;
(SPLITDIR) Moved to new SplitTransaction&lt;br/&gt;
Moved cleanup of half-done splits into SplitTransaction.  It&apos;ll know better how to do this.&lt;br/&gt;
Moved split code into SplitTransaction class.&lt;/p&gt;

&lt;p&gt;+ M src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
Made this class implement new OnlineRegions interface&lt;/p&gt;

&lt;p&gt;+ A src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java&lt;br/&gt;
New Interface that allows you add/remove regions from oline regions.  This Interface&lt;br/&gt;
adds little.  Was just trying to make it so I didn&apos;t have to have server context doing&lt;br/&gt;
tests but in the end I just passed null for the case of no server context.  Could remove&lt;br/&gt;
this.&lt;/p&gt;

&lt;p&gt;+ A src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;br/&gt;
New class that encapsulates all to do w/ splitting &quot;transaction&quot;.&lt;/p&gt;

&lt;p&gt;+ A src/main/java/org/apache/hadoop/hbase/util/PairOfSameType.java&lt;br/&gt;
Minor utility class&lt;/p&gt;

&lt;p&gt;+M src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;br/&gt;
(loadRegion) Added loading a region&lt;/p&gt;

&lt;p&gt;+ M src/test/java/org/apache/hadoop/hbase/io/TestImmutableBytesWritable.java&lt;br/&gt;
(testSpecificCompare) Unrelated change&lt;/p&gt;

&lt;p&gt;+ M src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;br/&gt;
Change because of new manner in which splits are run.  Added a splitRegions method.&lt;/p&gt;

&lt;p&gt;+ A src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransaction.java&lt;br/&gt;
Test of region splitting code in region context.  Testing in server context would take&lt;br/&gt;
a bunch of work making it so could insert mock instance of SplitTransaction.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2461&quot; title=&quot;Split doesn&amp;#39;t handle IOExceptions when creating new region reference files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2461&quot;&gt;&lt;del&gt;HBASE-2461&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2461&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 7589db3 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 6dc41a4 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 6a54736 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/PairOfSameType.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 4d09fe9 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/TestImmutableBytesWritable.java 43fa6dd &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java 98bd3e5 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransaction.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/474/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/474/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Basic unit tests are passing.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;stack&lt;/p&gt;

</comment>
                            <comment id="12895026" author="stack" created="Tue, 3 Aug 2010 20:25:50 +0000"  >&lt;p&gt;Includes minor fix where we weren&apos;t returning if failure doing rollback.&lt;/p&gt;

&lt;p&gt;I looked at adding test failing a split on a running cluster but the contortions are too extreme &amp;#8211; CompactSplitThread is created in HRS#reinitialize() &amp;#8211; and then our split is run inside in CST#split so we&apos;d need to put in place first our own CST and then, CST has to be subclassable or amenable to injection.  Currently it is not.  So, I could mess w/ making what we load for CST configurable but then what about the other threads, LogRoller, the Worker thread, etc., why not make them configurable while I&apos;m at it.&lt;/p&gt;

&lt;p&gt;...but then I shouldn&apos;t even be doing this.  There are containers that will stitch it all together for us and that can be easily changed at test time to run an alternative.  See &lt;a href=&quot;http://www.picocontainer.org/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.picocontainer.org/&lt;/a&gt; or spring&lt;/p&gt;

&lt;p&gt;And the RS and Master are about to change w/ master rewrite.&lt;/p&gt;

&lt;p&gt;I&apos;m going to pass on trying to test split failure on running cluster till at least after master rewrite goes in.&lt;/p&gt;</comment>
                            <comment id="12895070" author="hbasereviewboard" created="Tue, 3 Aug 2010 22:53:44 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/474/#review643&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/474/#review643&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;Few minor comments, else it looks very good&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/474/#comment2414&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/474/#comment2414&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I wonder how that will play with new master code&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/474/#comment2415&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/474/#comment2415&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    garbage&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/474/#comment2416&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/474/#comment2416&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    red&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/474/#comment2417&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/474/#comment2417&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Here we could retry for a long time if the region server that holds meta/root died not long ago, blocking accesses to that region.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/474/#comment2418&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/474/#comment2418&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    incomplete doc?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/474/#comment2419&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/474/#comment2419&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    cleanup&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/474/#comment2420&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/474/#comment2420&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    good idea&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jean-Daniel&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12895091" author="stack" created="Wed, 4 Aug 2010 00:02:30 +0000"  >&lt;p&gt;Here&apos;s what I committed... includes j-d comments.&lt;/p&gt;</comment>
                            <comment id="12895092" author="stack" created="Wed, 4 Aug 2010 00:02:47 +0000"  >&lt;p&gt;Committed.&lt;/p&gt;</comment>
                            <comment id="15017588" author="lars_francke" created="Fri, 20 Nov 2015 12:43:40 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12441378">HBASE-2001</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12451178" name="2461-v10.txt" size="73047" author="stack" created="Wed, 4 Aug 2010 00:02:29 +0000"/>
                            <attachment id="12450767" name="2461-v2.txt" size="22222" author="stack" created="Wed, 28 Jul 2010 23:04:12 +0000"/>
                            <attachment id="12450906" name="2461-v3.txt" size="36639" author="stack" created="Fri, 30 Jul 2010 14:20:15 +0000"/>
                            <attachment id="12450957" name="2461-v4.txt" size="43567" author="stack" created="Sat, 31 Jul 2010 06:46:01 +0000"/>
                            <attachment id="12451000" name="2461-v6.txt" size="54322" author="stack" created="Mon, 2 Aug 2010 00:00:28 +0000"/>
                            <attachment id="12451097" name="2461-v7.txt" size="71723" author="stack" created="Tue, 3 Aug 2010 01:24:53 +0000"/>
                            <attachment id="12451153" name="2461-v8.txt" size="72041" author="stack" created="Tue, 3 Aug 2010 20:25:50 +0000"/>
                            <attachment id="12447313" name="2461.txt" size="8349" author="stack" created="Thu, 17 Jun 2010 06:04:40 +0000"/>
                            <attachment id="12451102" name="ugly_but_might_work.txt" size="2375" author="stack" created="Tue, 3 Aug 2010 04:09:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 17 Apr 2010 02:44:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26316</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hht3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100147</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>