<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:59:57 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8940/HBASE-8940.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8940] TestRegionMergeTransactionOnCluster#testWholesomeMerge may fail due to race in opening region</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8940</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From &lt;a href=&quot;http://54.241.6.143/job/HBase-TRUNK-Hadoop-2/org.apache.hbase$hbase-server/395/testReport/org.apache.hadoop.hbase.regionserver/TestRegionMergeTransactionOnCluster/testWholesomeMerge/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://54.241.6.143/job/HBase-TRUNK-Hadoop-2/org.apache.hbase$hbase-server/395/testReport/org.apache.hadoop.hbase.regionserver/TestRegionMergeTransactionOnCluster/testWholesomeMerge/&lt;/a&gt; :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
013-07-11 09:33:44,154 INFO  [AM.ZK.Worker-pool-2-thread-2] master.RegionStates(309): Offlined 3ffefd878a234031675de6b2c70b2ead from ip-10-174-118-204.us-west-1.compute.internal,60498,1373535184820
2013-07-11 09:33:44,154 INFO  [AM.ZK.Worker-pool-2-thread-2] master.AssignmentManager$4(1223): The master has opened testWholesomeMerge,testRow0020,1373535210125.3ffefd878a234031675de6b2c70b2ead. that was online on ip-10-174-118-204.us-west-1.compute.internal,59210,1373535184884
2013-07-11 09:33:44,182 DEBUG [RS_OPEN_REGION-ip-10-174-118-204:59210-1] zookeeper.ZKAssign(862): regionserver:59210-0x13fcd13a20c0002 Successfully transitioned node 3ffefd878a234031675de6b2c70b2ead from RS_ZK_REGION_OPENING to RS_ZK_REGION_OPENED
2013-07-11 09:33:44,182 INFO  [MASTER_TABLE_OPERATIONS-ip-10-174-118-204:39405-0] handler.DispatchMergingRegionHandler(154): Failed send MERGE REGIONS RPC to server ip-10-174-118-204.us-west-1.compute.internal,59210,1373535184884 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region testWholesomeMerge,,1373535210124.efcb10dcfa250e31bfd50dc6c7049f32.,testWholesomeMerge,testRow0020,1373535210125.3ffefd878a234031675de6b2c70b2ead., focible=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, org.apache.hadoop.hbase.exceptions.RegionOpeningException: Region is being opened: 3ffefd878a234031675de6b2c70b2ead
	at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegionByEncodedName(HRegionServer.java:2566)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:3862)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.mergeRegions(HRegionServer.java:3649)
	at org.apache.hadoop.hbase.protobuf.generated.AdminProtos$AdminService$2.callBlockingMethod(AdminProtos.java:14400)
	at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2124)
	at org.apache.hadoop.hbase.ipc.RpcServer$Handler.run(RpcServer.java:1831)

2013-07-11 09:33:44,182 DEBUG [RS_OPEN_REGION-ip-10-174-118-204:59210-1] handler.OpenRegionHandler(373): region transitioned to opened in zookeeper: {ENCODED =&amp;gt; 3ffefd878a234031675de6b2c70b2ead, NAME =&amp;gt; &apos;testWholesomeMerge,testRow0020,1373535210125.3ffefd878a234031675de6b2c70b2ead.&apos;, STARTKEY =&amp;gt; &apos;testRow0020&apos;, ENDKEY =&amp;gt; &apos;testRow0040&apos;}, server: ip-10-174-118-204.us-west-1.compute.internal,59210,1373535184884
2013-07-11 09:33:44,183 DEBUG [RS_OPEN_REGION-ip-10-174-118-204:59210-1] handler.OpenRegionHandler(186): Opened testWholesomeMerge,testRow0020,1373535210125.3ffefd878a234031675de6b2c70b2ead. on server:ip-10-174-118-204.us-west-1.compute.internal,59210,1373535184884
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We can see that MASTER_TABLE_OPERATIONS thread couldn&apos;t get region 3ffefd878a234031675de6b2c70b2ead because RS_OPEN_REGION thread finished region opening 1 millisecond later.&lt;/p&gt;

&lt;p&gt;One solution is to retry operation when receiving RegionOpeningException&lt;/p&gt;</description>
                <environment></environment>
        <key id="12657496">HBASE-8940</key>
            <summary>TestRegionMergeTransactionOnCluster#testWholesomeMerge may fail due to race in opening region</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zjushch">chunhui shen</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 12 Jul 2013 17:32:22 +0000</created>
                <updated>Wed, 24 Feb 2016 06:39:27 +0000</updated>
                            <resolved>Mon, 15 Jul 2013 21:00:54 +0000</resolved>
                                                    <fixVersion>0.95.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13707255" author="stack" created="Fri, 12 Jul 2013 19:05:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ted_yu&quot; class=&quot;user-hover&quot; rel=&quot;ted_yu&quot;&gt;Ted Yu&lt;/a&gt; You going to fix this?&lt;/p&gt;</comment>
                            <comment id="13707286" author="yuzhihong@gmail.com" created="Fri, 12 Jul 2013 19:27:21 +0000"  >&lt;p&gt;Yes.&lt;/p&gt;</comment>
                            <comment id="13707379" author="jxiang" created="Fri, 12 Jul 2013 21:09:49 +0000"  >&lt;p&gt;Looks like the root cause of this is the same as that of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8941&quot; title=&quot;TestAccessController.testGlobalPermissionList failed with IndexOutOfBoundsException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8941&quot;&gt;&lt;del&gt;HBASE-8941&lt;/del&gt;&lt;/a&gt;.  I think it is better to fix the root cause.&lt;/p&gt;</comment>
                            <comment id="13707386" author="jxiang" created="Fri, 12 Jul 2013 21:12:42 +0000"  >&lt;p&gt;Closed &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8940&quot; title=&quot;TestRegionMergeTransactionOnCluster#testWholesomeMerge may fail due to race in opening region&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8940&quot;&gt;&lt;del&gt;HBASE-8940&lt;/del&gt;&lt;/a&gt; as a duplicate of this one.&lt;/p&gt;</comment>
                            <comment id="13707424" author="hadoopqa" created="Fri, 12 Jul 2013 21:50:40 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592068/8940-v1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592068/8940-v1.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6315//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13707447" author="yuzhihong@gmail.com" created="Fri, 12 Jul 2013 22:07:46 +0000"  >&lt;p&gt;Another possible solution is to give some headroom in getRegionByEncodedName():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt; isOpening = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regionsInTransitionInRS.get(Bytes.toBytes(encodedRegionName));
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isOpening != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; isOpening.booleanValue()) {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RegionOpeningException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Region is being opened: &quot;&lt;/span&gt; + encodedRegionName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Instead of throwing RegionOpeningException immediately, we can wait for a short while.&lt;/p&gt;</comment>
                            <comment id="13707453" author="stack" created="Fri, 12 Jul 2013 22:11:53 +0000"  >&lt;p&gt;I think this a test issue.  What you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;?  We are asking to merge a region that the regionserver is NotServering.   Merge should fail.&lt;/p&gt;

&lt;p&gt;I think this issue will be fixed by the Enis&apos;s &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8934&quot; title=&quot;Fix bunch of flaky tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8934&quot;&gt;&lt;del&gt;HBASE-8934&lt;/del&gt;&lt;/a&gt; Fix bunch of flaky tests&quot; &amp;#8211; the region will be fully opened before the test starts.&lt;/p&gt;</comment>
                            <comment id="13707861" author="stack" created="Sat, 13 Jul 2013 22:54:11 +0000"  >&lt;p&gt;Chatting w/ Jimmy friday afternoon, there is a little hole where we have published the region as available on regionserver X &amp;#8211; because it has been set in .META. and master has been informed the region has been opened via a transitioning of znode &amp;#8211; but the region may not be added to the regionserver online regions set just yet (it is done after we move region from OPENING to OPENED up in zk).  If a client comes in in the meantime, which is possible when all threads are running in the one jvm as we have in unit tests, client will get NotServingRegionException (or RegionOpeningException which is a subclass in this case)... which is the &apos;truth&apos; in that we have not yet put up the region online.  The client will retry usually but in this case, in merge, there is no retry since it is the regionserver itself making a call on itself; there is no client.  Adding retries inside the regionserver seems wrong.  Regionserver knows its own state.&lt;/p&gt;

&lt;p&gt;Talking w/ Jimmy, changing the order in which we online the region in the regionserver so we do it before we &apos;publish&apos; via znode could open us up to races where region could be open in more than one place so it is safer to leave things as they are regards region onlining and instead just fix tests, or better, HBaseTestingUtility; i.e. not start the merge until for sure the regions are online.&lt;/p&gt;

&lt;p&gt;Let me put up a patch.&lt;/p&gt;</comment>
                            <comment id="13708090" author="stack" created="Sun, 14 Jul 2013 18:14:49 +0000"  >&lt;p&gt;I took a closer look at the logs.  Something else is going on here.  We load the table, scan the table to ensure row count is as expected (which can only succeed after all regions are online), we then print out the regions we think make up the table, and then immediately after, we choose to unassign a region.  The merge fails because this unexpected unassign followed by an open elsewhere has not completed by the time the merge goes to run.  I cannot see why we do the unassign.  I see that the balancer is set to off for these tests.  Any clues &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;?  Otherwise, I&apos;m going to add in a &apos;why&apos; string for unassigns, etc.&lt;/p&gt;

&lt;p&gt;Here is us listing all regions after successful verification of row count followed by the immediate unassign:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
2013-07-11 09:33:43,744 INFO  [pool-1-thread-1] regionserver.TestRegionMergeTransactionOnCluster(262): Regions after load: {{ENCODED =&amp;gt; efcb10dcfa250e31bfd50dc6c7049f32, NAME =&amp;gt; &apos;testWholesomeMerge,,1373535210124.efcb10dcfa250e31bfd50dc6c7049f32.&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;testRow0020&apos;},ip-10-174-118-204.us-west-1.compute.internal,59210,1373535184884},{{ENCODED =&amp;gt; 3ffefd878a234031675de6b2c70b2ead, NAME =&amp;gt; &apos;testWholesomeMerge,testRow0020,1373535210125.3ffefd878a234031675de6b2c70b2ead.&apos;, STARTKEY =&amp;gt; &apos;testRow0020&apos;, ENDKEY =&amp;gt; &apos;testRow0040&apos;},ip-10-174-118-204.us-west-1.compute.internal,60498,1373535184820},{{ENCODED =&amp;gt; 96a2b66754838d21e88d31cbeb21ed41, NAME =&amp;gt; &apos;testWholesomeMerge,testRow0040,1373535210125.96a2b66754838d21e88d31cbeb21ed41.&apos;, STARTKEY =&amp;gt; &apos;testRow0040&apos;, ENDKEY =&amp;gt; &apos;testRow0060&apos;},ip-10-174-118-204.us-west-1.compute.internal,59210,1373535184884},{{ENCODED =&amp;gt; 71eb1ffffd93a0d6a9f5529a45922519, NAME =&amp;gt; &apos;testWholesomeMerge,testRow0060,1373535210125.71eb1ffffd93a0d6a9f5529a45922519.&apos;, STARTKEY =&amp;gt; &apos;testRow0060&apos;, ENDKEY =&amp;gt; &apos;testRow0080&apos;},ip-10-174-118-204.us-west-1.compute.internal,60498,1373535184820},{{ENCODED =&amp;gt; f0cc6807bbeb1b4731f81397710ead3d, NAME =&amp;gt; &apos;testWholesomeMerge,testRow0080,1373535210125.f0cc6807bbeb1b4731f81397710ead3d.&apos;, STARTKEY =&amp;gt; &apos;testRow0080&apos;, ENDKEY =&amp;gt; &apos;testRow0100&apos;},ip-10-174-118-204.us-west-1.compute.internal,58569,1373535184726},{{ENCODED =&amp;gt; bc7ff4e217795751fd2a9fc671ad33a4, NAME =&amp;gt; &apos;testWholesomeMerge,testRow0100,1373535210125.bc7ff4e217795751fd2a9fc671ad33a4.&apos;, STARTKEY =&amp;gt; &apos;testRow0100&apos;, ENDKEY =&amp;gt; &apos;testRow0120&apos;},ip-10-174-118-204.us-west-1.compute.internal,58569,1373535184726},{{ENCODED =&amp;gt; 7bd39de7c7cc8e46007e50d2e60e4e3d, NAME =&amp;gt; &apos;testWholesomeMerge,testRow0120,1373535210125.7bd39de7c7cc8e46007e50d2e60e4e3d.&apos;, STARTKEY =&amp;gt; &apos;testRow0120&apos;, ENDKEY =&amp;gt; &apos;testRow0140&apos;},ip-10-174-118-204.us-west-1.compute.internal,59210,1373535184884},{{ENCODED =&amp;gt; f6ca1923a2636032360186166784a35c, NAME =&amp;gt; &apos;testWholesomeMerge,testRow0140,1373535210125.f6ca1923a2636032360186166784a35c.&apos;, STARTKEY =&amp;gt; &apos;testRow0140&apos;, ENDKEY =&amp;gt; &apos;testRow0160&apos;},ip-10-174-118-204.us-west-1.compute.internal,60498,1373535184820},{{ENCODED =&amp;gt; cc4e5e073976cf056ea7b629f3eaeee6, NAME =&amp;gt; &apos;testWholesomeMerge,testRow0160,1373535210125.cc4e5e073976cf056ea7b629f3eaeee6.&apos;, STARTKEY =&amp;gt; &apos;testRow0160&apos;, ENDKEY =&amp;gt; &apos;testRow0180&apos;},ip-10-174-118-204.us-west-1.compute.internal,58569,1373535184726},{{ENCODED =&amp;gt; 95559e718b7b1dc87635f3bd474b9d36, NAME =&amp;gt; &apos;testWholesomeMerge,testRow0180,1373535210125.95559e718b7b1dc87635f3bd474b9d36.&apos;, STARTKEY =&amp;gt; &apos;testRow0180&apos;, ENDKEY =&amp;gt; &apos;&apos;},ip-10-174-118-204.us-west-1.compute.internal,59210,1373535184884}
2013-07-11 09:33:43,751 DEBUG [pool-1-thread-1] client.ClientScanner(195): Finished region={ENCODED =&amp;gt; 1028785192, NAME =&amp;gt; &apos;.META.,,1&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;}
2013-07-11 09:33:43,767 DEBUG [MASTER_TABLE_OPERATIONS-ip-10-174-118-204:39405-0] master.AssignmentManager(2205): Starting unassign of testWholesomeMerge,testRow0020,1373535210125.3ffefd878a234031675de6b2c70b2ead. (offlining)

...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13708197" author="zjushch" created="Mon, 15 Jul 2013 02:02:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;I cannot see why we do the unassign. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Before executing region merge, we will move merging regions to the same regionserver. Thus do a unassign there.&lt;/p&gt;</comment>
                            <comment id="13708200" author="zjushch" created="Mon, 15 Jul 2013 02:07:03 +0000"  >&lt;p&gt;Here taking a retry should be accepted since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8941&quot; title=&quot;TestAccessController.testGlobalPermissionList failed with IndexOutOfBoundsException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8941&quot;&gt;&lt;del&gt;HBASE-8941&lt;/del&gt;&lt;/a&gt; has been fixed through improving the test case.&lt;/p&gt;</comment>
                            <comment id="13708207" author="zjushch" created="Mon, 15 Jul 2013 02:34:38 +0000"  >&lt;p&gt;Making a patch with retry solution&lt;/p&gt;</comment>
                            <comment id="13708224" author="hadoopqa" created="Mon, 15 Jul 2013 03:50:03 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592271/8940-trunk-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592271/8940-trunk-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6334//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13708923" author="jxiang" created="Mon, 15 Jul 2013 20:24:45 +0000"  >&lt;p&gt;+1 on v2. Although the issue may be fixed by Stack&apos;s other patches, this patch is nice to have too.&lt;/p&gt;</comment>
                            <comment id="13708978" author="stack" created="Mon, 15 Jul 2013 21:00:20 +0000"  >&lt;p&gt;Here is what I committed.  Only real difference is my adding logging of move of regions so they are adjacent; not having anything in the log confounded me.&lt;/p&gt;

&lt;p&gt;Thanks for showing up w/ the why &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjushch&quot; class=&quot;user-hover&quot; rel=&quot;zjushch&quot;&gt;chunhui shen&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13708979" author="stack" created="Mon, 15 Jul 2013 21:00:54 +0000"  >&lt;p&gt;Just going to resolve this as committed to 0.95 and trunk.&lt;/p&gt;</comment>
                            <comment id="13721753" author="stack" created="Sat, 27 Jul 2013 21:02:13 +0000"  >&lt;p&gt;It failed here: &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/369/testReport/org.apache.hadoop.hbase.regionserver/TestRegionMergeTransactionOnCluster/testWholesomeMerge/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/369/testReport/org.apache.hadoop.hbase.regionserver/TestRegionMergeTransactionOnCluster/testWholesomeMerge/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Want to take a look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjushch&quot; class=&quot;user-hover&quot; rel=&quot;zjushch&quot;&gt;chunhui shen&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13721935" author="zjushch" created="Sun, 28 Jul 2013 11:09:14 +0000"  >&lt;p&gt;The above failed test is caused by&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-07-27 20:08:48,345 INFO  [MASTER_TABLE_OPERATIONS-quirinus:59057-0] handler.DispatchMergingRegionHandler(170): Cancel merging regions testWholesomeMerge,,1374955684854.8b452e80a9e15d54bd265c344f4ad953., testWholesomeMerge,testRow002
0,1374955684854.4a31455f2b0256853c41c52ba65bdc10., because can&apos;t move them together after 30003ms
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Timeout of moving regions together on same RS is caused by closing region &quot;4a31455f2b0256853c41c52ba65bdc10&quot; take more time than 30s,&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-07-27 20:08:18,753 DEBUG [RS_CLOSE_REGION-quirinus:57626-1] handler.CloseRegionHandler(125): Processing close of 
testWholesomeMerge,testRow0020,1374955684854.4a31455f2b0256853c41c52ba65bdc10.

2013-07-27 20:08:18,755 DEBUG [RS_CLOSE_REGION-quirinus:57626-1] regionserver.HRegion(1493): Started memstore flush for testWholesomeMerge,testRow0020,1374955684854.4a31455f2b0256853c41c52ba65bdc10., current region memstore size 3.4k

2013-07-27 20:09:03,914 INFO  [RS_CLOSE_REGION-quirinus:57626-1] regionserver.HRegion(1637): Finished memstore flush of ~3.4k/3520, currentsize=0.0/0 for region testWholesomeMerge,testRow0020,1374955684854.4a31455f2b0256853c41c52ba65bdc1
0. in 45159ms, sequenceid=186, compaction requested=false

2013-07-27 20:09:03,956 DEBUG [RS_CLOSE_REGION-quirinus:57626-1] handler.CloseRegionHandler(177): Closed region testWholesomeMerge,testRow0020,1374955684854.4a31455f2b0256853c41c52ba65bdc10.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From the above logs, closing region took 45s, it seems flushing is too slow, but can&apos;t get the reason from the current logs, maybe GC or high IO load at that time&lt;/p&gt;</comment>
                            <comment id="13722070" author="stack" created="Sun, 28 Jul 2013 22:18:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjushch&quot; class=&quot;user-hover&quot; rel=&quot;zjushch&quot;&gt;chunhui shen&lt;/a&gt; That the build box is loaded should be a given.  Would you suggest upping the timeouts on these tests?  I can do it no problem.  Just say (thanks for digging in).&lt;/p&gt;</comment>
                            <comment id="13722108" author="zjushch" created="Mon, 29 Jul 2013 01:53:44 +0000"  >&lt;p&gt;Upping the timeouts from 30s to 120s in addendum patch.&lt;/p&gt;

&lt;p&gt;I will commit it if no object&lt;/p&gt;</comment>
                            <comment id="13722792" author="stack" created="Mon, 29 Jul 2013 18:34:32 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13723259" author="zjushch" created="Tue, 30 Jul 2013 01:43:37 +0000"  >&lt;p&gt;Committed addendum to trunk and 0.95&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12939615">HBASE-15277</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12657518">HBASE-8941</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12594620" name="8940-addendum.patch" size="686" author="zjushch" created="Mon, 29 Jul 2013 01:53:44 +0000"/>
                            <attachment id="12592271" name="8940-trunk-v2.patch" size="2889" author="zjushch" created="Mon, 15 Jul 2013 02:34:38 +0000"/>
                            <attachment id="12592068" name="8940-v1.txt" size="1751" author="yuzhihong@gmail.com" created="Fri, 12 Jul 2013 20:36:40 +0000"/>
                            <attachment id="12592406" name="8940v3.txt" size="3527" author="stack" created="Mon, 15 Jul 2013 21:00:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 12 Jul 2013 19:05:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337717</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1m91z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338040</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>