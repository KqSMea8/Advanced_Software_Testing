<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:35:24 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6284/HBASE-6284.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6284] Introduce HRegion#doMiniBatchMutation()</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6284</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From Anoop under thread &apos;Can there be a doMiniBatchDelete in HRegion&apos;:&lt;/p&gt;

&lt;p&gt;The HTable#delete(List&amp;lt;Delete&amp;gt;) groups the Deletes for the same RS and make one n/w call only. But within the RS, there will be N number of delete calls on the region one by one. This will include N number of HLog write and sync. If this also can be grouped can we get better performance for the multi row delete.&lt;/p&gt;

&lt;p&gt;I have made the new miniBatchDelete () and made the HTable#delete(List&amp;lt;Delete&amp;gt;) to call this new batch delete.&lt;br/&gt;
Just tested initially with the one node cluster.  In that itself I am getting a performance boost which is very much promising.&lt;br/&gt;
Only one CF and qualifier.&lt;br/&gt;
10K total rows delete with a batch of 100 deletes. Only deletes happening on the table from one thread.&lt;br/&gt;
With the new way the net time taken is reduced by more than 1/10&lt;br/&gt;
Will test in a 4 node cluster also. I think it will worth doing this change.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12596165">HBASE-6284</key>
            <summary>Introduce HRegion#doMiniBatchMutation()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anoopsamjohn">Anoop Sam John</assignee>
                                    <reporter username="zhihyu@ebaysf.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Jun 2012 21:12:21 +0000</created>
                <updated>Tue, 26 Feb 2013 16:56:33 +0000</updated>
                            <resolved>Wed, 11 Jul 2012 19:16:46 +0000</resolved>
                                                    <fixVersion>0.94.1</fixVersion>
                    <fixVersion>0.95.0</fixVersion>
                                    <component>Performance</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="13402656" author="whitingj" created="Wed, 27 Jun 2012 23:21:46 +0000"  >&lt;p&gt;While adding this it is probably worth looking at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5941&quot; title=&quot;improve multiDelete performance by grabbing locks ahead of time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5941&quot;&gt;&lt;del&gt;HBASE-5941&lt;/del&gt;&lt;/a&gt; and incorporating its performance improvements as well.&lt;/p&gt;</comment>
                            <comment id="13402808" author="anoopsamjohn" created="Thu, 28 Jun 2012 03:29:24 +0000"  >&lt;p&gt;I will come up with a patch based on 0.94 version soon...&lt;/p&gt;</comment>
                            <comment id="13402809" author="zhihyu@ebaysf.com" created="Thu, 28 Jun 2012 03:31:19 +0000"  >&lt;p&gt;Please work out a trunk patch first.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="13402810" author="anoopsamjohn" created="Thu, 28 Jun 2012 03:32:38 +0000"  >&lt;p&gt;Ok Ted.. I will do that... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13402846" author="jeason" created="Thu, 28 Jun 2012 04:56:00 +0000"  >&lt;p&gt;Sounds like a good improvement&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13402873" author="anoopsamjohn" created="Thu, 28 Jun 2012 05:53:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5941&quot; title=&quot;improve multiDelete performance by grabbing locks ahead of time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5941&quot;&gt;&lt;del&gt;HBASE-5941&lt;/del&gt;&lt;/a&gt; is doing almost the same thing which I had done in my testing. Batching the deletes in region level and grabbing as many locks as possible and do that operations in one shot.&lt;br/&gt;
The write and sync to WAL will be just one time for this one shot.&lt;/p&gt;

&lt;p&gt;Already in 94 and Trunk there is mutateRowsWithLocks() which is also doing almost the same. The only difference is that this method needs the locks on all the rows in one time and will do those many ops in one time.&lt;span class=&quot;error&quot;&gt;&amp;#91;Yes it need to&amp;#93;&lt;/span&gt;&lt;br/&gt;
Instead our new method will do in mini batches. At least one row lock (batch of one Put /Delete) is needed.&lt;/p&gt;</comment>
                            <comment id="13403222" author="anoopsamjohn" created="Thu, 28 Jun 2012 17:02:07 +0000"  >&lt;p&gt;Patch on Trunk for review.&lt;br/&gt;
Will give exact performance test result soon.&lt;/p&gt;</comment>
                            <comment id="13403279" author="zhihyu@ebaysf.com" created="Thu, 28 Jun 2012 17:41:18 +0000"  >&lt;p&gt;Please put patch on review board - it is of decent size.&lt;/p&gt;</comment>
                            <comment id="13403384" author="hadoopqa" created="Thu, 28 Jun 2012 19:13:36 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12533845/HBASE-6284_Trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12533845/HBASE-6284_Trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 6 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2283//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2283//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2283//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2283//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2283//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2283//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2283//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2283//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13403535" author="zhihyu@ebaysf.com" created="Thu, 28 Jun 2012 22:42:02 +0000"  >&lt;p&gt;I went over the patch once.&lt;br/&gt;
It looks good.&lt;/p&gt;</comment>
                            <comment id="13403678" author="anoopsamjohn" created="Fri, 29 Jun 2012 03:25:10 +0000"  >&lt;p&gt;Ted&lt;br/&gt;
Put the patch on review board -  I need to select Repository as hbase or hbase-git?&lt;/p&gt;</comment>
                            <comment id="13403683" author="zhihyu@ebaysf.com" created="Fri, 29 Jun 2012 03:49:47 +0000"  >&lt;p&gt;The patch was generated by svn, so choose hbase and specify / as Base Directory.&lt;/p&gt;</comment>
                            <comment id="13403687" author="anoopsamjohn" created="Fri, 29 Jun 2012 04:24:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/5654/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/5654/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13403691" author="yuzhihong@gmail.com" created="Fri, 29 Jun 2012 04:40:56 +0000"  >&lt;p&gt;Do you have performance numbers ?&lt;/p&gt;</comment>
                            <comment id="13404080" author="anoopsamjohn" created="Fri, 29 Jun 2012 18:07:10 +0000"  >&lt;p&gt;Run a performance comparison on a single node cluster.&lt;br/&gt;
Table with single region and 1000 rows in that&lt;br/&gt;
Deleting all 1000 rows in batch of 100 rows at a time&lt;br/&gt;
Test result is as follows&lt;br/&gt;
With out patch : 240104 ms&lt;br/&gt;
With patch     : 2230 ms&lt;/p&gt;

&lt;p&gt;Sorry I could not run on a bigger cluster with more data as some other NFT testing underway. Will try to give by Monday.&lt;/p&gt;
</comment>
                            <comment id="13404232" author="zhihyu@ebaysf.com" created="Fri, 29 Jun 2012 21:29:48 +0000"  >&lt;p&gt;I put a few comments on review board.&lt;/p&gt;</comment>
                            <comment id="13404552" author="lhofhansl" created="Sat, 30 Jun 2012 16:37:57 +0000"  >&lt;p&gt;Moving to 0.94.2.&lt;br/&gt;
Would also consider removing from 0.94 altogether. Thoughts?&lt;/p&gt;</comment>
                            <comment id="13404694" author="anoopsamjohn" created="Sun, 1 Jul 2012 07:20:09 +0000"  >&lt;p&gt;Okey to move to 94.2&lt;br/&gt;
But 94 being a performance version I think better have this change in 0.94.2 atleast.&lt;/p&gt;</comment>
                            <comment id="13404698" author="hadoopqa" created="Sun, 1 Jul 2012 08:31:11 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12534145/HBASE-6284_Trunk-V2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12534145/HBASE-6284_Trunk-V2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 7 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestZooKeeper&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2306//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2306//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2306//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2306//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2306//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2306//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2306//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2306//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13404740" author="zhihyu@ebaysf.com" created="Sun, 1 Jul 2012 15:13:54 +0000"  >&lt;p&gt;w.r.t. computation of timeTakenForPuts:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Consider maintaining two variables: one for puts, one for deletions.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Please address the above in v3.&lt;/p&gt;</comment>
                            <comment id="13404750" author="zhihyu@ebaysf.com" created="Sun, 1 Jul 2012 15:46:57 +0000"  >&lt;p&gt;The patch produces the new API:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; OperationStatus[] batchMutate(
      Pair&amp;lt;Mutation, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;[] mutationsAndLocks) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;whose predecessor wasn&apos;t designed to handle Append and Increment.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; doMiniBatchMutation(
    BatchOperationInProgress&amp;lt;Pair&amp;lt;Mutation, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;&amp;gt; batchOp) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please add javadoc above, explaining that only Put and Delete are currently handled.&lt;br/&gt;
Assertion for Mutation not being Append should be added.&lt;/p&gt;</comment>
                            <comment id="13404760" author="zhihyu@ebaysf.com" created="Sun, 1 Jul 2012 16:24:10 +0000"  >&lt;p&gt;The handling of:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; MultiResponse multi(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RpcController controller,
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; MultiRequest request) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ServiceException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is correct. However, MultiAction might be interleaved such that the Puts and Deletes are separated by Appends and Increments.&lt;br/&gt;
The folloing code may result in frequent calls to doBatchOp():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
              &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type != MutateType.PUT &amp;amp;&amp;amp; type != MutateType.DELETE) {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!mutates.isEmpty()) {
                  doBatchOp(builder, region, mutates);
                  mutates.clear();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can we buffer Appends and Increments so that mutates List contains certain amount of Mutate&apos;s ?&lt;/p&gt;</comment>
                            <comment id="13404881" author="anoopsamjohn" created="Mon, 2 Jul 2012 03:01:06 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
Do u know the reason why the above code was added in Trunk? In 94 this is not there. - When any other type comes in the seq do a batch op for the older Puts ( now Deletes) also&lt;/p&gt;</comment>
                            <comment id="13404886" author="zhihyu@ebaysf.com" created="Mon, 2 Jul 2012 04:03:35 +0000"  >&lt;p&gt;I haven&apos;t tracked the source of the above code.&lt;br/&gt;
We should pay attention to the effect it may have on batching Puts/Deletes.&lt;/p&gt;</comment>
                            <comment id="13404892" author="anoopsamjohn" created="Mon, 2 Jul 2012 05:11:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;Consider maintaining two variables: one for puts, one for deletions.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You mean there should be 2 time variables and within the loop in different places as per the type of Mutation we need to update the variables accordingly?&lt;br/&gt;
Like below&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isPutMutation) {
            &lt;span class=&quot;code-comment&quot;&gt;// Check the families in the put. If bad, skip &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; one.
&lt;/span&gt;            checkFamilies(familyMap.keySet());
            checkTimestamps(mutation.getFamilyMap(), now);
            &lt;span class=&quot;code-comment&quot;&gt;// update the put net time
&lt;/span&gt;          } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
            prepareDelete((Delete) mutation);
            &lt;span class=&quot;code-comment&quot;&gt;// update delete net time
&lt;/span&gt;          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Similarly&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mutation &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Put) {
          updateKVTimestamps(familyMaps[i].values(), byteNow);
          noOfPuts++;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          prepareDeleteTimestamps(familyMaps[i], byteNow);
          noOfDeletes++;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Down the line in this method we need to differentiate the type of mutation where we apply KVs to memstore and write to WAL. Also the WAL sync is one operation. This sync may be for some Puts and some Deletes.  How to get the exact numbers here? The code will become more complex I felt. U have any suggestions?&lt;br/&gt;
I think I got you comment correctly. Correct me if I am wrong pls&lt;/p&gt;</comment>
                            <comment id="13404908" author="zhihyu@ebaysf.com" created="Mon, 2 Jul 2012 06:52:56 +0000"  >&lt;p&gt;I am fine with the approximation of metric computation in the current patch.&lt;br/&gt;
Other people&apos;s comments are welcome.&lt;/p&gt;</comment>
                            <comment id="13405187" author="anoopsamjohn" created="Mon, 2 Jul 2012 18:11:30 +0000"  >&lt;p&gt;Addressed Ted&apos;s comment&lt;/p&gt;</comment>
                            <comment id="13405191" author="anoopsamjohn" created="Mon, 2 Jul 2012 18:13:39 +0000"  >&lt;p&gt;@Ted&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (type != MutateType.PUT) {
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!mutates.isEmpty()) {
                  doBatchOp(builder, region, mutates);
                  mutates.clear();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This was existing code which might result in many calls to doMiniBatchPut(). Can we handle the discussion regarding this point and fix in another JIRA?&lt;/p&gt;</comment>
                            <comment id="13405225" author="zhihyu@ebaysf.com" created="Mon, 2 Jul 2012 18:36:10 +0000"  >&lt;p&gt;@Anoop:&lt;br/&gt;
What do you think my suggested change to multi() ?&lt;/p&gt;

&lt;p&gt;I looked at the code in 0.94 and came to the suggested form.&lt;/p&gt;</comment>
                            <comment id="13405487" author="anoopsamjohn" created="Tue, 3 Jul 2012 01:32:09 +0000"  >&lt;p&gt;@Ted&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Can we buffer Appends and Increments so that mutates List contains certain amount of Mutate&apos;s ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This will actually delay the calls for Appends and Increments right?  Suppose the List comes is as Put(r1),Put(r2),Increment(r1),Put(r1)  &lt;span class=&quot;error&quot;&gt;&amp;#91;I dont know some one use this way&amp;#93;&lt;/span&gt;&lt;br/&gt;
In he current way of Trunk code as we try to maintain the seq the value corresponding to ( suppose only one CF and qualifier) r1 will be that from the last Put. But if we buffer the Increment and allow the Puts to happen first, the final value may come as different!&lt;br/&gt;
Basically we might loose the seq..  I am not sure because of this reason we changed the code in trunk and which issue changed this code.. I am just thinking this may be the reason.  What do u say?  Correct me if my understanding is wrong pls..&lt;/p&gt;</comment>
                            <comment id="13405491" author="zhihyu@ebaysf.com" created="Tue, 3 Jul 2012 01:57:00 +0000"  >&lt;p&gt;Looks like patch v3 keeps the existing semantics in a simple way.&lt;br/&gt;
Optimization should group operations by row and column family. Let&apos;s leave it to future JIRA.&lt;/p&gt;</comment>
                            <comment id="13405594" author="zhihyu@ebaysf.com" created="Tue, 3 Jul 2012 03:55:29 +0000"  >&lt;p&gt;TestZooKeeper passed locally.&lt;/p&gt;

&lt;p&gt;Patch v3 integrated to trunk.&lt;/p&gt;

&lt;p&gt;Thanks for the patch, Anoop.&lt;/p&gt;

&lt;p&gt;Please prepare patch for 0.94.&lt;/p&gt;</comment>
                            <comment id="13405601" author="anoopsamjohn" created="Tue, 3 Jul 2012 04:04:46 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Lars Hofhansl added a comment - 30/Jun/12 16:37&lt;br/&gt;
Moving to 0.94.2.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We need to wait Ted for 94 commit? Any way I will prepare the patch and attach to JIRA&lt;/p&gt;</comment>
                            <comment id="13405640" author="hudson" created="Tue, 3 Jul 2012 05:52:19 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3092 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3092/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3092/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6284&quot; title=&quot;Introduce HRegion#doMiniBatchMutation()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6284&quot;&gt;&lt;del&gt;HBASE-6284&lt;/del&gt;&lt;/a&gt; HRegion#doMiniBatchMutation() (Anoop) (Revision 1356566)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/MultiRowMutationProcessor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/OperationMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13405788" author="hudson" created="Tue, 3 Jul 2012 10:33:24 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #78 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/78/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/78/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6284&quot; title=&quot;Introduce HRegion#doMiniBatchMutation()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6284&quot;&gt;&lt;del&gt;HBASE-6284&lt;/del&gt;&lt;/a&gt; HRegion#doMiniBatchMutation() (Anoop) (Revision 1356566)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/MultiRowMutationProcessor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/OperationMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13406252" author="anoopsamjohn" created="Wed, 4 Jul 2012 03:21:32 +0000"  >&lt;p&gt;Attached patch fo 94 version. Pls review.&lt;/p&gt;

&lt;p&gt;@Ted - There is a minor correction needed in the Javadoc for trunk patch. Attached addendum for that. Can you take a look and integrate the same pls.&lt;/p&gt;</comment>
                            <comment id="13406256" author="zhihyu@ebaysf.com" created="Wed, 4 Jul 2012 03:31:48 +0000"  >&lt;p&gt;Addendum integrated to trunk.&lt;/p&gt;

&lt;p&gt;Thanks Anoop.&lt;/p&gt;</comment>
                            <comment id="13411251" author="lhofhansl" created="Wed, 11 Jul 2012 05:38:25 +0000"  >&lt;p&gt;Looks good to me.&lt;br/&gt;
In &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5203&quot; title=&quot;Group atomic put/delete operation into a single WALEdit to handle region server failures.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5203&quot;&gt;&lt;del&gt;HBASE-5203&lt;/del&gt;&lt;/a&gt; I made sure that other parts of HBase (Replication, Import/Export, etc) can deal with multiple Puts/Deletes grouped in a single WAL entry, so should be good from that side.&lt;br/&gt;
Feel free to integrate into 0.94 now if you like (change fix version to 0.94.1 then)&lt;/p&gt;</comment>
                            <comment id="13411269" author="zhihyu@ebaysf.com" created="Wed, 11 Jul 2012 06:20:07 +0000"  >&lt;p&gt;Integrated to 0.94 branch as well.&lt;/p&gt;

&lt;p&gt;Thanks for the review, Lars.&lt;/p&gt;</comment>
                            <comment id="13411318" author="anoopsamjohn" created="Wed, 11 Jul 2012 08:25:41 +0000"  >&lt;p&gt;HRegion#put(Pair&amp;lt;Put, Integer&amp;gt;[] putsAndLocks)&lt;br/&gt;
This method was removed in trunk.&lt;br/&gt;
In 94 patch I kept that method but deprecated. HRegion is exposed to CPs now.&lt;/p&gt;</comment>
                            <comment id="13411879" author="lhofhansl" created="Wed, 11 Jul 2012 19:16:39 +0000"  >&lt;p&gt;That&apos;s fine. What you mean with &quot;HRegion is exposed to CPs now.&quot;?&lt;/p&gt;</comment>
                            <comment id="13412476" author="anoopsamjohn" created="Thu, 12 Jul 2012 03:17:34 +0000"  >&lt;p&gt;I mean public methods in HRegion can be called from co processors at RS side.&lt;/p&gt;</comment>
                            <comment id="13413415" author="hudson" created="Fri, 13 Jul 2012 01:47:15 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #40 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/40/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/40/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6284&quot; title=&quot;Introduce HRegion#doMiniBatchMutation()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6284&quot;&gt;&lt;del&gt;HBASE-6284&lt;/del&gt;&lt;/a&gt; Introduce HRegion#doMiniBatchMutation() (Anoop) (Revision 1360020)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/OperationMetrics.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13428710" author="hudson" created="Sun, 5 Aug 2012 00:51:11 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #6 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/6/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/6/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6284&quot; title=&quot;Introduce HRegion#doMiniBatchMutation()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6284&quot;&gt;&lt;del&gt;HBASE-6284&lt;/del&gt;&lt;/a&gt; Introduce HRegion#doMiniBatchMutation() (Anoop) (Revision 1360020)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/OperationMetrics.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12535035" name="6284_Trunk-Addendum.patch" size="773" author="anoopsamjohn" created="Wed, 4 Jul 2012 03:20:06 +0000"/>
                            <attachment id="12534497" name="6284_Trunk-V3.patch" size="25229" author="zhihyu@ebaysf.com" created="Tue, 3 Jul 2012 02:55:04 +0000"/>
                            <attachment id="12535034" name="HBASE-6284_94.patch" size="23179" author="anoopsamjohn" created="Wed, 4 Jul 2012 03:17:08 +0000"/>
                            <attachment id="12534145" name="HBASE-6284_Trunk-V2.patch" size="24691" author="anoopsamjohn" created="Sun, 1 Jul 2012 07:37:21 +0000"/>
                            <attachment id="12534300" name="HBASE-6284_Trunk-V3.patch" size="25229" author="anoopsamjohn" created="Mon, 2 Jul 2012 18:11:30 +0000"/>
                            <attachment id="12533845" name="HBASE-6284_Trunk.patch" size="24458" author="anoopsamjohn" created="Thu, 28 Jun 2012 17:02:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Jun 2012 23:21:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245355</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 19 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0680f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34229</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>