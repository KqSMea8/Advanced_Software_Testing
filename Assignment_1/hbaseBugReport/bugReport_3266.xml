<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:08:47 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3266/HBASE-3266.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3266] Master does not seem to properly scan ZK for running RS during startup</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3266</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I was in the situation described by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3265&quot; title=&quot;Regionservers waiting for ROOT while Master waiting for RegionServers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3265&quot;&gt;&lt;del&gt;HBASE-3265&lt;/del&gt;&lt;/a&gt;, where I had a number of RS waiting on ROOT, but the master hadn&apos;t seen any RS checkins, so was waiting on checkins. To get past this, I restarted one of the region servers. The restarted server checked in, and the master began its startup.&lt;br/&gt;
At this point the master started scanning /hbase/.logs for things to split. It correctly identified that the RS on haus01 was running (this is the one I restarted):&lt;/p&gt;

&lt;p&gt;2010-11-23 00:21:25,595 INFO org.apache.hadoop.hbase.master.MasterFileSystem: Log folder hdfs://haus01.sf.cloudera.com:11020/hbase-normal/.logs/haus01.sf.cloudera.com,60020,1290500443143 belongs to an existing region server&lt;/p&gt;

&lt;p&gt;but then incorrectly decided that the RS on haus02 was down:&lt;/p&gt;

&lt;p&gt;2010-11-23 00:21:25,595 INFO org.apache.hadoop.hbase.master.MasterFileSystem: Log folder hdfs://haus01.sf.cloudera.com:11020/hbase-normal/.logs/haus02.sf.cloudera.com,60020,1290498411450 doesn&apos;t belong to a known region server, splitting&lt;/p&gt;

&lt;p&gt;However ZK shows that this RS is up:&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;zk: haus01.sf.cloudera.com:2222(CONNECTED) 3&amp;#93;&lt;/span&gt; ls /hbase/rs&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;haus04.sf.cloudera.com,60020,1290498411533, haus05.sf.cloudera.com,60020,1290498411520, haus03.sf.cloudera.com,60020,1290498411518, haus01.sf.cloudera.com,60020,1290500443143, haus02.sf.cloudera.com,60020,1290498411450&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;splitLogsAfterStartup seems to check ServerManager.onlineServers, which best I can tell is derived from heartbeats and not from ZK (sorry if I got some of this wrong, still new to this new codebase)&lt;/p&gt;

&lt;p&gt;Of course, the master went into an infinite splitting loop at this point since haus02 is up and renewing its DFS lease on its logs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12480651">HBASE-3266</key>
            <summary>Master does not seem to properly scan ZK for running RS during startup</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Nov 2010 08:33:21 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:50 +0000</updated>
                            <resolved>Tue, 26 Jul 2011 20:34:22 +0000</resolved>
                                    <version>0.90.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12934924" author="streamy" created="Tue, 23 Nov 2010 17:44:10 +0000"  >&lt;p&gt;Yeah, I think as it is currently the HMaster is using the startup/heartbeat messages to determine which RS are online.  As I commented in the other jira, we should see why they were not doing so.&lt;/p&gt;

&lt;p&gt;We should do some reconciliation between what we find in ZK and what we think is online based on RPCs, but not sure exactly what course we would take in a state like this.&lt;/p&gt;</comment>
                            <comment id="12935019" author="stack" created="Tue, 23 Nov 2010 20:10:43 +0000"  >&lt;p&gt;Bringing into 0.90.0 while we triage.&lt;/p&gt;</comment>
                            <comment id="12965003" author="stack" created="Mon, 29 Nov 2010 23:36:45 +0000"  >&lt;p&gt;Chatting with Jon, there is a problem here if zk does not agree with online servers.  This would happen if HRS is stuck.  We could add a reconcile to the master on startup such that if a discrepancy, then master could expire the HRS in effect killing it.  This would be good (especially if could be done in a non-racey way).&lt;/p&gt;

&lt;p&gt;But thought is that this condition should be extremely rare especially since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3265&quot; title=&quot;Regionservers waiting for ROOT while Master waiting for RegionServers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3265&quot;&gt;&lt;del&gt;HBASE-3265&lt;/del&gt;&lt;/a&gt; went in  AND given that we&apos;d like to do away with heartbeating altogether, lets just punt this out to 0.92 rather than hack up some messy reconcile.&lt;/p&gt;

&lt;p&gt;Moving out.  Please move back in if disagree.&lt;/p&gt;</comment>
                            <comment id="13071342" author="yuzhihong@gmail.com" created="Tue, 26 Jul 2011 20:34:22 +0000"  >&lt;p&gt;From Todd:&lt;br/&gt;
3266 is probably no longer valid given heartbeats don&apos;t exist in trunk.&lt;/p&gt;</comment>
                            <comment id="15017633" author="lars_francke" created="Fri, 20 Nov 2015 12:43:50 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 23 Nov 2010 17:44:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26748</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hlhz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100745</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>