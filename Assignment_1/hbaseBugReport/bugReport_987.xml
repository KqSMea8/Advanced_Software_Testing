<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:49:31 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-987/HBASE-987.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-987] We need a Hbase Partitioner for TableMapReduceUtil.initTableReduceJob MR Jobs</title>
                <link>https://issues.apache.org/jira/browse/HBASE-987</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When we run say 20 reducers they all get ~1/20th of the data to output to the table.&lt;/p&gt;

&lt;p&gt;The problem for us on large import jobs is the data gets sorted by key and the all Reducers &lt;br/&gt;
pound one region at a time.&lt;/p&gt;

&lt;p&gt;we need to add onto the TableMapReduceUtil.initTableReduceJob method so it can set the partitioner &lt;br/&gt;
and set the number of reducers = number of regions as the table map does for maps.&lt;/p&gt;

&lt;p&gt;Then the Partitioner will send all the BatchUpdates for one region to one reducer.&lt;br/&gt;
So we get a more even spread of writers to the regions this would assure that only one reducer will send &lt;br/&gt;
updates to one region keeping any one region from getting more overloaded the others.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12408123">HBASE-987</key>
            <summary>We need a Hbase Partitioner for TableMapReduceUtil.initTableReduceJob MR Jobs</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viper799">Billy Pearson</assignee>
                                    <reporter username="viper799">Billy Pearson</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Nov 2008 01:56:19 +0000</created>
                <updated>Thu, 20 Sep 2012 22:10:38 +0000</updated>
                            <resolved>Tue, 11 Nov 2008 06:23:42 +0000</resolved>
                                                    <fixVersion>0.19.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12646193" author="viper799" created="Mon, 10 Nov 2008 07:57:22 +0000"  >&lt;p&gt;The only thing I have not addressed in this patch is if someone sets &lt;br/&gt;
the number of reducer higher then then regions a table has then the &amp;gt; then region count &lt;br/&gt;
task will not have any work.. Somewhere in the process reduce the reducers count to &lt;br/&gt;
number of regions like we do in TableMap &lt;/p&gt;

&lt;p&gt;But do not know where you guys would like me to do that maybe can do it in &lt;br/&gt;
the TableMapReduceUtil.initTableReduceJob any other ideas?&lt;/p&gt;

&lt;p&gt;Need someone to review with a larger number of server then I have.&lt;/p&gt;</comment>
                            <comment id="12646198" author="viper799" created="Mon, 10 Nov 2008 08:20:48 +0000"  >&lt;p&gt;Ran a import job importing 9,972,859 rows in to 8 regions on 4 servers&lt;/p&gt;

&lt;p&gt;With out HRegionPartitioner:&lt;br/&gt;
Average time taken by Reduce tasks: 5mins, 18sec&lt;/p&gt;

&lt;p&gt;With HRegionPartitioner:&lt;br/&gt;
Average time taken by Reduce tasks: 3mins, 11sec = +166.5% improvement&lt;/p&gt;

&lt;p&gt;Saves quite a bit time on imports with just  a small set of server and spreads &lt;br/&gt;
out the average load on the regions so no one server is getting hit hard while others&lt;br/&gt;
are set idle.&lt;/p&gt;

&lt;p&gt;Would still like to see some stats form someone that has a larger server group then me.&lt;/p&gt;</comment>
                            <comment id="12646211" author="viper799" created="Mon, 10 Nov 2008 09:35:15 +0000"  >&lt;p&gt;updated patch to set the reduced to match the number of regions if set higher then the number of regions&lt;br/&gt;
 the setting is adjusted in TableMapReduceUtil.initTableReduceJob but the user can still&lt;br/&gt;
set the reduced after they call the above and override it.&lt;/p&gt;</comment>
                            <comment id="12646377" author="stack" created="Mon, 10 Nov 2008 21:55:11 +0000"  >&lt;p&gt;Nice patch Billy.&lt;/p&gt;

&lt;p&gt;Is it true to say that your partitioner makes sense when tables are &apos;mature&apos;; i.e. have many regions, when upload will not generally disturb the total number of regions involved?  Or to put it another way, if table starts out with a low number of regions and if we load a big dataset that makes the regions grow considerably in number, would the old default partitioner be a better fit?  The key-space would be divided by the count of regions assigned?&lt;/p&gt;

&lt;p&gt;If so, should this new partitioner not be the default but a nice option users can select after call to initReduceJob?  Perhaps add a method that will configure this new partitioner into place along with your trick of keeping number of reduces == number of regions.&lt;/p&gt;

&lt;p&gt;Otherwise, HRegionPartitioner needs an Apache license.&lt;/p&gt;

&lt;p&gt;Line lengths are generally &amp;lt; 80 characters in hadoop projects.&lt;/p&gt;

&lt;p&gt;Otherwise, patch is great.&lt;/p&gt;</comment>
                            <comment id="12646413" author="viper799" created="Mon, 10 Nov 2008 23:47:25 +0000"  >&lt;p&gt;I was thanking about that also if what if we do this&lt;/p&gt;

&lt;p&gt;enum the partitioner to (Hash,HRegion)&lt;/p&gt;

&lt;p&gt;then to call &lt;br/&gt;
TableMapReduceUtil.initTableReduceJob(Table, ReduceClass, Conf, Partitioner);&lt;/p&gt;

&lt;p&gt;then add java docs about the different partitioners so the end user can select as needed.&lt;br/&gt;
that way we can add more partitioners as needed.&lt;/p&gt;</comment>
                            <comment id="12646415" author="stack" created="Mon, 10 Nov 2008 23:58:58 +0000"  >&lt;p&gt;Rather than enum, just have an override for TMRU.initTableReduceJob that takes a Partitioner.  Default is use the old Partitioner?&lt;/p&gt;

&lt;p&gt;If you do the above, I&apos;ll do the bit that adds documentation on this new facility?&lt;/p&gt;</comment>
                            <comment id="12646419" author="viper799" created="Tue, 11 Nov 2008 00:11:30 +0000"  >&lt;p&gt;ok I thank this is what you are talking about&lt;/p&gt;

&lt;p&gt;updated max 80 chr per line&lt;br/&gt;
and added Apache license to both files&lt;/p&gt;</comment>
                            <comment id="12646489" author="stack" created="Tue, 11 Nov 2008 06:23:42 +0000"  >&lt;p&gt;Committed.  Thanks for the patch Billy.  I added a note to the mapred package documentation that makes mention of the new partitioner.&lt;/p&gt;</comment>
                            <comment id="12646495" author="viper799" created="Tue, 11 Nov 2008 06:34:49 +0000"  >&lt;p&gt;your method needs a &lt;/p&gt;

&lt;p&gt;throws IOException&lt;br/&gt;
or a try catch&lt;/p&gt;

&lt;p&gt;currently breaks build&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12397860">HBASE-675</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12393624" name="987-2.patch.txt" size="4109" author="viper799" created="Mon, 10 Nov 2008 09:35:15 +0000"/>
                            <attachment id="12393666" name="987-3.patch.txt" size="6337" author="viper799" created="Tue, 11 Nov 2008 00:11:30 +0000"/>
                            <attachment id="12393618" name="987.patch.txt" size="3240" author="viper799" created="Mon, 10 Nov 2008 07:57:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 10 Nov 2008 21:55:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31936</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 6 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hanz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98990</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>