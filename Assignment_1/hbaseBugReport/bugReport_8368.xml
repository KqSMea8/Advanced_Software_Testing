<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:54:34 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8368/HBASE-8368.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8368] Improve ZK notification handling in Master</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8368</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In ZooKeeperWatcher, we handle ZK notifications in a single queue(except AM) and each listener is handling notifications synchronously. &lt;/p&gt;

&lt;p&gt;This cause potential performance issue if Master is handling an event which may jam the queue so that ZooKeeperWatcher won&apos;t get new notifications in time. For example, we have several region un-assigned notifications in pipeline and logsplitting or SSH handling etc handling will be delayed.&lt;/p&gt;

&lt;p&gt;I&apos;m proposing:&lt;/p&gt;

&lt;p&gt;During registerListeners, we can let a user to choose which queue current listener want to register. For example, &lt;br/&gt;
registerListener(QueueName, ZNodePathPrefix, listener);&lt;/p&gt;

&lt;p&gt;Such as:&lt;br/&gt;
registerListener(&quot;unsigned_regions&quot;, &quot;/hbase/unassigned&quot;, AMlistener);&lt;br/&gt;
registerListener(&quot;logSplitting&quot;, &quot;/hbase/splitlog&quot;, LogSplittingManagerlistener);&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;For each queue, we use a single thread(consumer) to process events in order.&lt;/p&gt;

&lt;p&gt;The ZNodePathPrefix is to pre-filter out notifications that current listener is only interested in. &lt;/p&gt;

&lt;p&gt;For listeners without specifying a queue name, the listener will be put on a new &quot;default&quot; queue.&lt;/p&gt;

&lt;p&gt;Please let me know if you have better ideas!&lt;br/&gt;
Thanks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12643043">HBASE-8368</key>
            <summary>Improve ZK notification handling in Master</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="jeffreyz">Jeffrey Zhong</assignee>
                                    <reporter username="jeffreyz">Jeffrey Zhong</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Apr 2013 21:42:11 +0000</created>
                <updated>Wed, 27 Nov 2013 23:28:46 +0000</updated>
                                            <version>0.95.0</version>
                                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13634567" author="jxiang" created="Wed, 17 Apr 2013 23:00:45 +0000"  >&lt;p&gt;This is an interesting idea.  It should help in some cases. However, it may not, for assignment events, since they get their own thread pool.  We should consider the thread context switch overhead as well.&lt;/p&gt;

&lt;p&gt;We can have a thread pool to process events concurrently, and make sure the events generated on the same znode are always processed in order. However, some application may not work with this.&lt;/p&gt;</comment>
                            <comment id="13634653" author="jeffreyz" created="Thu, 18 Apr 2013 00:05:07 +0000"  >&lt;blockquote&gt;
&lt;p&gt; have a thread pool to process events concurrently, and make sure the events generated on the same znode are always processed in order.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I like the idea. Basically, We can have a thread pool with max threads = number of listeners. Each thread can take all events from a queue at a time. Since the number of listeners is in 10s(we currently have 9 listeners), In worst cases, even we have notifications from all queues, it won&apos;t cause many context switch. &lt;/p&gt;

&lt;p&gt;In the first release, we just provide parallelism for different listeners. Later we could potentially process region un-assigned notifications concurrently if those notifications are for different regions(while this needs more attention) to really scale notification handling up.  &lt;/p&gt;</comment>
                            <comment id="13634762" author="enis" created="Thu, 18 Apr 2013 02:08:19 +0000"  >&lt;p&gt;+1 for the idea. Some source of bugs in 0.94 AM was that the zk event was being processed in a handler thread, but we basically lost the event ordering guarantee with this approach. &lt;/p&gt;</comment>
                            <comment id="13834338" author="apurtell" created="Wed, 27 Nov 2013 23:28:46 +0000"  >&lt;p&gt;No patch, unscheduling.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 17 Apr 2013 23:00:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323453</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jt0v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>323798</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>