<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:56:44 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1831/HBASE-1831.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1831] Scanning API must be reworked to allow for fully functional Filters client-side</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1831</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Right now, a client replays part of the Filter locally by calling filterRowKey() and filterAllRemaining() to determine whether it should continue to the next region.&lt;/p&gt;

&lt;p&gt;A number of new filters rely on filterKeyValue() and other calls to alter state.  It&apos;s also a false assumption that all rows/keys affecting a filter returning true for FAR will be seen client-side (what about those that failed the filter).&lt;/p&gt;

&lt;p&gt;This issue is about dealing with Filters properly from the client-side.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12435494">HBASE-1831</key>
            <summary>Scanning API must be reworked to allow for fully functional Filters client-side</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="streamy">Jonathan Gray</reporter>
                        <labels>
                    </labels>
                <created>Sat, 12 Sep 2009 01:06:29 +0000</created>
                <updated>Fri, 20 Nov 2015 13:01:47 +0000</updated>
                            <resolved>Tue, 6 Oct 2009 03:26:26 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.1</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12758581" author="streamy" created="Wed, 23 Sep 2009 04:35:45 +0000"  >&lt;p&gt;Filters should not be run on the client-side at all.&lt;/p&gt;

&lt;p&gt;Server needs to be able to tell whether Scan should continue to the next region or not.&lt;/p&gt;</comment>
                            <comment id="12758584" author="stack" created="Wed, 23 Sep 2009 05:04:45 +0000"  >&lt;p&gt;Chatted with Jon.&lt;/p&gt;

&lt;p&gt;1. Need to flag client to STOP.  HTable#next internally uses the batch version of next (so can do prefetching of rows).  An empty list of Results is always sent &amp;#8211; never null.   We&apos;ll add passing null as the flag that filter is done; do not move to next region (Client has code to handle null list so if an old hbase version connects, it won&apos;t break; it&apos;ll just not do the STOP properly).&lt;br/&gt;
2. There is a non-batch next in the ipc interface.  I was thinking of deprecating it and moving internals to use the batch interface only, but these internal uses of scanners do not carry filters so will just leave them for 0.20.1.&lt;br/&gt;
3. Filters carry state.   How do we get the state across region transitions?  Again chatting with Jon, will do the following.  If a Scanner has a filter, and we got back a non-empty list, its time to move to the next region.  Just before we move to the next region, we&apos;ll make another call to the old server &amp;#8211; Scanner.getFilter &amp;#8211; whose result is the deserialized filter.  The deserialized filter will be passed then to the next region.  In this manner filters will be able to carry their state forward.  Downside is extra RPC call IF scanning with a filter.&lt;/p&gt;</comment>
                            <comment id="12758847" author="stack" created="Wed, 23 Sep 2009 19:32:52 +0000"  >&lt;p&gt;On 3., above, carrying stateful filters across regions, it can&apos;t be done easily in 0.20.x because we can get a NotServingRegionException at any time.  Also, if nothing goes wrong and we just exhaust a scanner on a particular region, the last thing done over in RegionServer is cleanup of scanner so a subsequent getFilter call would have nothing to pick up on once it&apos;d arrived at the RegionServer.  Statefulness has to be done client-side; filters need to allow specifying a client-component.&lt;/p&gt;</comment>
                            <comment id="12758849" author="stack" created="Wed, 23 Sep 2009 19:42:45 +0000"  >&lt;p&gt;@jgray You say, &quot;Filters should not be run on the client-side at all.&quot;&lt;/p&gt;

&lt;p&gt;I don&apos;t know how else we can do stateful scanners that ride over regions.&lt;/p&gt;</comment>
                            <comment id="12758854" author="stack" created="Wed, 23 Sep 2009 19:57:24 +0000"  >&lt;p&gt;So, chatting w/ Ryan on this topic, he suggests that support for stateful filters is going to be a bear &amp;#8211; there&apos;s splitting and then what if regionserver crashes, etc.  At the moment we figure a filter wants to stop the scan by testing the last regions endrow against the filter run client-side.   Would it be enough my removing this and just adding the flag above which allows filters server-side to stop the scan (by passing back null result out of batch next)?  There&apos;d be no getFilter to pick up a filters state and pass it from one region to the next.&lt;/p&gt;

&lt;p&gt;There is going to be a problem though when fellas want to do filters that return 20 row results only or that want to have a filter skip 1000 rows; to do this, we&apos;d something to run client-side.&lt;/p&gt;</comment>
                            <comment id="12758872" author="stack" created="Wed, 23 Sep 2009 20:44:15 +0000"  >&lt;p&gt;Here is a bit of a start.  It adds javadoc to the ipc interfaces about new meaning of null.  It then adds a new flag to the client-side nextScanner method.  It renames the method that checks for the end row in Scan....  Now to work on server-side.&lt;/p&gt;</comment>
                            <comment id="12758939" author="streamy" created="Thu, 24 Sep 2009 00:06:00 +0000"  >&lt;p&gt;I agree that this is not going to be easy.  Still think that filters should not be run client-side (even if they are, it will require additional/new information to be sent from client to server).&lt;/p&gt;

&lt;p&gt;Running an offset of 1000 rows client-side completely negates the value in using filters in the first place... to not have to send back all that data.  That&apos;s the reason client-side filters don&apos;t really work, they require you to send back otherwise filtered-out data.&lt;/p&gt;

&lt;p&gt;What I would like to see as a long-term solution to this:&lt;/p&gt;

&lt;p&gt;1st: Add ability for server to say STOP and not go to next region&lt;br/&gt;
2nd: Correctness for stateful scanners under non-split, non-failure scenarios (less correctness / fail-fast if encountering issues)&lt;br/&gt;
3rd: Correctness/robustness for stateful scanners under splits and failures&lt;/p&gt;</comment>
                            <comment id="12759341" author="stack" created="Fri, 25 Sep 2009 00:32:04 +0000"  >&lt;p&gt;v2... complete but for test.  Working on that now.&lt;/p&gt;</comment>
                            <comment id="12760123" author="stack" created="Sun, 27 Sep 2009 22:54:02 +0000"  >&lt;p&gt;Still not done&lt;/p&gt;</comment>
                            <comment id="12761468" author="stack" created="Fri, 2 Oct 2009 04:22:09 +0000"  >&lt;p&gt;Adds two ugly tests.  One under filter that puts up three regions and then checks at the Region level that filters are doing right thing (Why can&apos;t i instantiate an HRegionServer and test from its interface &amp;#8211; its currently way too hard to put one of these up... requires there be a master.. .it shouldn&apos;t).  Other test if ugly from client side.  Splits table then makes sure RowFilter is returning right results around the row boundary.  I can assert counts but I can&apos;t assert that only a subset of regions are being accessed with asserts.  To do the latter, I added logging and it required eyeballing but you can see in the logs that yes we do not go to next region if filter says we&apos;re done.&lt;/p&gt;

&lt;p&gt;A few tests seem to be failing.... Looking into it.&lt;/p&gt;</comment>
                            <comment id="12761474" author="stack" created="Fri, 2 Oct 2009 05:07:25 +0000"  >&lt;p&gt;This version passes all tests.&lt;/p&gt;</comment>
                            <comment id="12761812" author="stack" created="Sat, 3 Oct 2009 05:18:15 +0000"  >&lt;p&gt;Needs review.&lt;/p&gt;</comment>
                            <comment id="12762449" author="apurtell" created="Mon, 5 Oct 2009 23:36:06 +0000"  >&lt;p&gt;Testing this now. There were two rejects against latest SVN 0.20, one in HTable, one in HConnectionManager. I fixed them up and attached the result as -v6&lt;/p&gt;</comment>
                            <comment id="12762465" author="apurtell" created="Tue, 6 Oct 2009 00:30:23 +0000"  >&lt;p&gt;+1 all tests pass here&lt;/p&gt;</comment>
                            <comment id="12762493" author="stack" created="Tue, 6 Oct 2009 03:26:26 +0000"  >&lt;p&gt;Thanks for review Andrew.  Committed branch and trunk.&lt;/p&gt;</comment>
                            <comment id="15017896" author="lars_francke" created="Fri, 20 Nov 2015 13:01:47 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12420516" name="1831-v2.patch" size="16064" author="stack" created="Fri, 25 Sep 2009 00:32:04 +0000"/>
                            <attachment id="12420667" name="1831-v3.patch" size="17075" author="stack" created="Sun, 27 Sep 2009 22:54:01 +0000"/>
                            <attachment id="12421097" name="1831-v4.patch" size="31803" author="stack" created="Fri, 2 Oct 2009 04:22:09 +0000"/>
                            <attachment id="12421098" name="1831-v5.patch" size="32535" author="stack" created="Fri, 2 Oct 2009 05:07:24 +0000"/>
                            <attachment id="12421353" name="1831-v6.patch" size="32449" author="apurtell" created="Mon, 5 Oct 2009 23:36:06 +0000"/>
                            <attachment id="12420403" name="1831.patch" size="5407" author="stack" created="Wed, 23 Sep 2009 20:44:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Sep 2009 05:04:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26006</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hfi7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99774</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>