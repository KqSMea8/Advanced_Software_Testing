<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:06:00 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2937/HBASE-2937.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2937] Facilitate Timeouts In HBase Client</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2937</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently, there is no way to force an operation on the HBase client (viz. HTable) to time out if a certain amount of time has elapsed.  In other words, all invocations on the HTable class are veritable blocking calls, which will not return until a response (successful or otherwise) is received. &lt;/p&gt;

&lt;p&gt;In general, there are two ways to handle timeouts:  (a) call the operation in a separate thread, until it returns a response or the wait on the thread times out and (b) have the underlying socket unblock the operation if the read times out.  The downside of the former approach is that it consumes more resources in terms of threads and callables. &lt;/p&gt;

&lt;p&gt;Here, we describe a way to specify and handle timeouts on the HTable client, which relies on the latter approach (i.e., socket timeouts). Right now, the HBaseClient sets the socket timeout to the value of the &quot;ipc.ping.interval&quot; parameter, which is also how long it waits before pinging the server in case of a failure. The goal is to allow clients to set that timeout on the fly through HTable. Rather than adding an optional timeout argument to every HTable operation, we chose to make it a property of HTable which effectively applies to every method that involves a remote operation.&lt;/p&gt;

&lt;p&gt;In order to propagate the timeout  from HTable to HBaseClient, we replaced all occurrences of ServerCallable in HTable with an extension called ClientCallable, which sets the timeout on the region server interface, once it has been instantiated, through the HConnection object. The latter, in turn, asks HBaseRPC to pass that timeout to the corresponding Invoker, so that it may inject the timeout at the time the invocation is made on the region server proxy. Right before the request is sent to the server, we set the timeout specified by the client on the underlying socket.&lt;/p&gt;

&lt;p&gt;In conclusion, this patch will afford clients the option of performing an HBase operation until it completes or a specified timeout elapses. Note that a timeout of zero is interpreted as an infinite timeout.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12472662">HBASE-2937</key>
            <summary>Facilitate Timeouts In HBase Client</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="karthick">Karthick Sankarachary</assignee>
                                    <reporter username="karthick">Karthick Sankarachary</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Aug 2010 00:53:09 +0000</created>
                <updated>Fri, 20 Nov 2015 12:41:32 +0000</updated>
                            <resolved>Wed, 25 May 2011 20:51:37 +0000</resolved>
                                    <version>0.89.20100621</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="12904306" author="jdcryans" created="Mon, 30 Aug 2010 19:50:23 +0000"  >&lt;p&gt;Changing the target to 0.90.0 since 0.89 releases are only snapshots of trunk.&lt;/p&gt;

&lt;p&gt;@Karthick, could you post the patches on review board? It&apos;ll instantly get more chances of being reviewed and ideally committed. Don&apos;t forget to set the group to &quot;hbase&quot; and the bug to the jira handle so it will be linked back here. &lt;a href=&quot;http://review.hbase.org&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12904348" author="karthick" created="Mon, 30 Aug 2010 21:31:50 +0000"  >&lt;p&gt;Done - the patch has been &lt;a href=&quot;https://review.cloudera.org/r/747/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;posted on the review board&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12904353" author="hbasereviewboard" created="Mon, 30 Aug 2010 21:34:42 +0000"  >&lt;p&gt;Message from: &quot;Karthick Sankarachary&quot; &amp;lt;karthick.sankarachary@gmail.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/747/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/747/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Currently, there is no way to force an operation on the HBase client (viz. HTable) to time out if a certain amount of time has elapsed. In other words, all invocations on the HTable class are veritable blocking calls, which will not return until a response (successful or otherwise) is received.&lt;/p&gt;

&lt;p&gt;In general, there are two ways to handle timeouts: (a) call the operation in a separate thread, until it returns a response or the wait on the thread times out and (b) have the underlying socket unblock the operation if the read times out. The downside of the former approach is that it consumes more resources in terms of threads and callables.&lt;/p&gt;

&lt;p&gt;Here, we describe a way to specify and handle timeouts on the HTable client, which relies on the latter approach (i.e., socket timeouts). Right now, the HBaseClient sets the socket timeout to the value of the &quot;ipc.ping.interval&quot; parameter, which is also how long it waits before pinging the server in case of a failure. The goal is to allow clients to set that timeout on the fly through HTable. Rather than adding an optional timeout argument to every HTable operation, we chose to make it a property of HTable which effectively applies to every method that involves a remote operation.&lt;/p&gt;

&lt;p&gt;In order to propagate the timeout from HTable to HBaseClient, we replaced all occurrences of ServerCallable in HTable with an extension called ClientCallable, which sets the timeout on the region server interface, once it has been instantiated, through the HConnection object. The latter, in turn, asks HBaseRPC to pass that timeout to the corresponding Invoker, so that it may inject the timeout at the time the invocation is made on the region server proxy. Right before the request is sent to the server, we set the timeout specified by the client on the underlying socket.&lt;/p&gt;

&lt;p&gt;In conclusion, this patch will afford clients the option of performing an HBase operation until it completes or a specified timeout elapses. Note that a timeout of zero is interpreted as an infinite timeout.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2937&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2937&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/Timeout.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/ClientCallable.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnection.java 8b3b6a4 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java ac2b99c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HTable.java cd60eeb &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 2b5eeb6 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 9873172 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/747/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/747/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Karthick&lt;/p&gt;

</comment>
                            <comment id="12904355" author="hbasereviewboard" created="Mon, 30 Aug 2010 21:37:44 +0000"  >&lt;p&gt;Message from: &quot;Karthick Sankarachary&quot; &amp;lt;karthick.sankarachary@gmail.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/747/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/747/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-08-30 14:29:12.219496)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary (updated)&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Currently, there is no way to force an operation on the HBase client (viz. HTable) to time out if a certain amount of time has elapsed. In other words, all invocations on the HTable class are veritable blocking calls, which will not return until a response (successful or otherwise) is received.&lt;/p&gt;

&lt;p&gt;In general, there are two ways to handle timeouts: (a) call the operation in a separate thread, until it returns a response or the wait on the thread times out and (b) have the underlying socket unblock the operation if the read times out. The downside of the former approach is that it consumes more resources in terms of threads and callables.&lt;/p&gt;

&lt;p&gt;Here, we describe a way to specify and handle timeouts on the HTable client, which relies on the latter approach (i.e., socket timeouts). Right now, the HBaseClient sets the socket timeout to the value of the &quot;ipc.ping.interval&quot; parameter, which is also how long it waits before pinging the server in case of a failure. The goal is to allow clients to set that timeout on the fly through HTable. Rather than adding an optional timeout argument to every HTable operation, we chose to make it a property of HTable which effectively applies to every method that involves a remote operation.&lt;/p&gt;

&lt;p&gt;In order to propagate the timeout from HTable to HBaseClient, we replaced all occurrences of ServerCallable in HTable with an extension called ClientCallable, which sets the timeout on the region server interface, once it has been instantiated, through the HConnection object. The latter, in turn, asks HBaseRPC to pass that timeout to the corresponding Invoker, so that it may inject the timeout at the time the invocation is made on the region server proxy. Right before the request is sent to the server, we set the timeout specified by the client on the underlying socket.&lt;/p&gt;

&lt;p&gt;In conclusion, this patch will afford clients the option of performing an HBase operation until it completes or a specified timeout elapses. Note that a timeout of zero is interpreted as an infinite timeout.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2937&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2937&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/Timeout.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/ClientCallable.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnection.java 8b3b6a4 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java ac2b99c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HTable.java cd60eeb &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 2b5eeb6 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java 9873172 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/747/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/747/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Karthick&lt;/p&gt;

</comment>
                            <comment id="12919387" author="hbasereviewboard" created="Fri, 8 Oct 2010 21:36:16 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/747/#review1497&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/747/#review1497&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;This looks great Karthik.  How does it interact with our current retry mechanism?  You replace our old retrying Callable?  There&apos;s a few comments below.&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/Timeout.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/747/#comment5135&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/747/#comment5135&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    There is white space at the end of lines in this javadoc.  Also, its apache or hadoop policy not to have an author tag on classes (no other classes in hbase codebase have author).&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/Timeout.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/747/#comment5137&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/747/#comment5137&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why not make this class immutable?  Force users to create a new one if they want to have different settings?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ClientCallable.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/747/#comment5139&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/747/#comment5139&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    White space and author tag.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnection.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/747/#comment5141&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/747/#comment5141&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Maybe setRegionServerTimeout is a better name fort this method?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HTable.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/747/#comment5142&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/747/#comment5142&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Timeout could be null here?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/747/#comment5143&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/747/#comment5143&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Are there tabs in here? And we use two spaces for tabs in our code base.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/747/#comment5145&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/747/#comment5145&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    two spaces for tab spaces in hbase codebase&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12923223" author="stack" created="Wed, 20 Oct 2010 23:18:57 +0000"  >&lt;p&gt;Sorry Karthik.  Moving out of 0.90.  We owe you a review.  Will do and commit to TRUNK as soon as we branch 0.90 (0.92 should be soon after 0.90 release).&lt;/p&gt;</comment>
                            <comment id="12968882" author="stack" created="Tue, 7 Dec 2010 18:56:26 +0000"  >&lt;p&gt;Marking critical.  We owe Karthik a review and besides, we need interruptible client whether we go with Karthik&apos;s patch or not.&lt;/p&gt;</comment>
                            <comment id="12968883" author="stack" created="Tue, 7 Dec 2010 18:56:34 +0000"  >&lt;p&gt;Marking critical.  We owe Karthik a review and besides, we need interruptible client whether we go with Karthik&apos;s patch or not.&lt;/p&gt;</comment>
                            <comment id="12968893" author="karthick" created="Tue, 7 Dec 2010 19:09:13 +0000"  >&lt;p&gt;Hi Stack, Just FYI, we&apos;re probably better off interrupting the client in the thread waiting for the response as opposed to the connection thread receiving the response, as the latter is shared by multiple clients. Please stay tuned for a revised patch, which should be forthcoming shortly. Thanks for your patience.&lt;/p&gt;</comment>
                            <comment id="12968926" author="stack" created="Tue, 7 Dec 2010 19:53:32 +0000"  >&lt;p&gt;Thanks.  Assigning the issue to you.&lt;/p&gt;</comment>
                            <comment id="12976563" author="karthick" created="Sun, 2 Jan 2011 21:41:58 +0000"  >&lt;p&gt;Hi Stack,&lt;/p&gt;

&lt;p&gt;The interruptible client logic has been rewritten in such a way as to allow:&lt;/p&gt;

&lt;p&gt;a) A timeout to be specified at the operation-level, which surrounds the block of code that instantiates the server (proxy) as well as the invocation on that proxy. Specifically, this was implemented by submitting the operation as a task to a different thread and then waiting on its future object.&lt;br/&gt;
b) A timeout to be specified at the call-level, which only includes the invocation on the server proxy object. Specifically, this was implemented by setting a timeout on the wait method that the HBaseClient invokes on the call object.&lt;br/&gt;
c) A retry logic to be specified at the call-level, which dictates how many times, if at all, the call should be retried, in the event of a call-level timeout.&lt;/p&gt;

&lt;p&gt;For each of the above behaviors, corresponding configuration settings have been made available (see TimeoutPolicy for details). &lt;/p&gt;

&lt;p&gt;Last but not the least, a test case (viz. TestFromClientSide#testTimeouts) was added which illustrates the various ways in which timeouts may be used.&lt;/p&gt;

&lt;p&gt;I look forward to your comments.&lt;/p&gt;

&lt;p&gt;Regards,&lt;br/&gt;
Karthick&lt;/p&gt;</comment>
                            <comment id="13035872" author="jiraposter@reviews.apache.org" created="Wed, 18 May 2011 23:56:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/755/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3154&quot; title=&quot;HBase RPC should support timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3154&quot;&gt;&lt;del&gt;HBASE-3154&lt;/del&gt;&lt;/a&gt;, users now have the ability to specify a timeout for client-side RPC calls. However, it doesn&apos;t go far enough in terms of how low that timeout can go. Set the RPC timeout to too low a value and you run the risk of timing out on calls to the meta tables, which are preconditions to calling the &lt;tt&gt;HRegionInterface&lt;/tt&gt; proxy.&lt;/p&gt;

&lt;p&gt;Given that, I believe the motivation at work in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt; still hold true. In this patch, I add a operation-level timeout, configurable through &quot;hbase.client.operation.timeout&quot;, which will override the value specified by &quot;hbase.rpc.timeout&quot;, if any, within the scope of the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. In other words, the operation-level timeout does not apply to calls to the meta tables. &lt;/p&gt;

&lt;p&gt;Furthermore, the patch treats an RPC timeout as a non-fatal event, in that it will not cause the &lt;tt&gt;HBaseClient#Connection&lt;/tt&gt; instance to be closed. Last but not the least, users will also have the ability to set the operation timeout on the &lt;tt&gt;HTable&lt;/tt&gt; on the fly.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2937&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HConstants.java e9e3694 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java b26f41e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HTable.java 61e151a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java 6f22123 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 470e741 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java dbb57d9 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/PoolMap.java 354d49a &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/755/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;mvn test&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Karthick&lt;/p&gt;
</comment>
                            <comment id="13036008" author="jiraposter@reviews.apache.org" created="Thu, 19 May 2011 06:11:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/755/#review683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#review683&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;This seems like a bunch of functionality for a relatively small change.  Nice one Karthick.  A few questions in the below.&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/#comment1366&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#comment1366&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Be careful about adding white space (no biggie)&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HTable.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/#comment1367&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#comment1367&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    What if table is &lt;del&gt;ROOT&lt;/del&gt;?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/#comment1368&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#comment1368&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should this use the constant you added above? The deafault timeout?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/#comment1369&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#comment1369&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    White space&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/#comment1370&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#comment1370&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    White space&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/#comment1371&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#comment1371&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    white space&lt;/p&gt;




&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/#comment1372&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#comment1372&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Will this work?  What happens if lots of concurrent threads going against lots of different tables each with a different timeout?  Will a meta table call pick up a short timeout that was put in place by a near-concurrent edit?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/#comment1373&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#comment1373&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Are there other exceptions you think we should rethrow?  Connection Exception?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-05-18 23:56:26, Karthick Sankarachary wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/755/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-18 23:56:26)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3154&quot; title=&quot;HBase RPC should support timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3154&quot;&gt;&lt;del&gt;HBASE-3154&lt;/del&gt;&lt;/a&gt;, users now have the ability to specify a timeout for client-side RPC calls. However, it doesn&apos;t go far enough in terms of how low that timeout can go. Set the RPC timeout to too low a value and you run the risk of timing out on calls to the meta tables, which are preconditions to calling the &lt;tt&gt;HRegionInterface&lt;/tt&gt; proxy.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Given that, I believe the motivation at work in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt; still hold true. In this patch, I add a operation-level timeout, configurable through &quot;hbase.client.operation.timeout&quot;, which will override the value specified by &quot;hbase.rpc.timeout&quot;, if any, within the scope of the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. In other words, the operation-level timeout does not apply to calls to the meta tables. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Furthermore, the patch treats an RPC timeout as a non-fatal event, in that it will not cause the &lt;tt&gt;HBaseClient#Connection&lt;/tt&gt; instance to be closed. Last but not the least, users will also have the ability to set the operation timeout on the &lt;tt&gt;HTable&lt;/tt&gt; on the fly.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2937&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java e9e3694 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java b26f41e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HTable.java 61e151a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java 6f22123 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 470e741 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java dbb57d9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/PoolMap.java 354d49a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/755/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;mvn test&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13036564" author="jiraposter@reviews.apache.org" created="Thu, 19 May 2011 23:15:47 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/755/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-05-19 23:14:57.474820)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3154&quot; title=&quot;HBase RPC should support timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3154&quot;&gt;&lt;del&gt;HBASE-3154&lt;/del&gt;&lt;/a&gt;, users now have the ability to specify a timeout for client-side RPC calls. However, it doesn&apos;t go far enough in terms of how low that timeout can go. Set the RPC timeout to too low a value and you run the risk of timing out on calls to the meta tables, which are preconditions to calling the &lt;tt&gt;HRegionInterface&lt;/tt&gt; proxy.&lt;/p&gt;

&lt;p&gt;Given that, I believe the motivation at work in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt; still hold true. In this patch, I add a operation-level timeout, configurable through &quot;hbase.client.operation.timeout&quot;, which will override the value specified by &quot;hbase.rpc.timeout&quot;, if any, within the scope of the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. In other words, the operation-level timeout does not apply to calls to the meta tables. &lt;/p&gt;

&lt;p&gt;Furthermore, the patch treats an RPC timeout as a non-fatal event, in that it will not cause the &lt;tt&gt;HBaseClient#Connection&lt;/tt&gt; instance to be closed. Last but not the least, users will also have the ability to set the operation timeout on the &lt;tt&gt;HTable&lt;/tt&gt; on the fly.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2937&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HConstants.java e9e3694 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java b26f41e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HTable.java 61e151a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java 6f22123 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 470e741 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java dbb57d9 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/PoolMap.java 354d49a &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/755/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;mvn test&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Karthick&lt;/p&gt;
</comment>
                            <comment id="13036565" author="jiraposter@reviews.apache.org" created="Thu, 19 May 2011 23:15:48 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; This seems like a bunch of functionality for a relatively small change.  Nice one Karthick.  A few questions in the below.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, it does seem like a big change for a relatively small feature, but an important one nevertheless. The complexity stems from the fact the scope of the operation timeout has to be limited to the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. &lt;/p&gt;

&lt;p&gt;By way of motivation, if you run the TestFromClientSide test with the following patch (which sets the &quot;hbase.rpc.timeout&quot; to 10ms), you&apos;ll see that 39 out of the 44 test cases will fail.&lt;/p&gt;

&lt;p&gt;     24 &amp;#8212; a/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;br/&gt;
     25 +++ b/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;br/&gt;
     26 @@ -94,6 +94,8 @@ public class TestFromClientSide {&lt;br/&gt;
     27    @BeforeClass&lt;br/&gt;
     28    public static void setUpBeforeClass() throws Exception &lt;/p&gt;
{
     29      TEST_UTIL.startMiniCluster(3);
     30 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 10);
     32    }

&lt;p&gt;On the other hand, if you run it with the default &quot;hbase.rpc.timeout&quot; but a &quot;hbase.client.operation.timeout&quot; set to 10ms, then you should see the test pass.&lt;/p&gt;

&lt;p&gt;     24 &amp;#8212; a/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;br/&gt;
     25 +++ b/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;br/&gt;
     26 @@ -94,6 +94,8 @@ public class TestFromClientSide {&lt;br/&gt;
     27    @BeforeClass&lt;br/&gt;
     28    public static void setUpBeforeClass() throws Exception &lt;/p&gt;
{
     29      TEST_UTIL.startMiniCluster(3);
     30 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 60000);
     31 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_OPERATION_TIMEOUT, 10);
     32    }


&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/client/HTable.java, line 184&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/diff/1/?file=19382#file19382line184&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff/1/?file=19382#file19382line184&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     What if table is &lt;del&gt;ROOT&lt;/del&gt;?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good point. I will use the HTableDescriptor.isMetaTable(tableName) instead. When I was debugging it, I noticed that the HTable constructor ends up creating a MetaScanner, which in turns creates a HTable on .META., but we do need to check &lt;del&gt;ROOT&lt;/del&gt; as well.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java, line 53&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line53&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line53&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Should this use the constant you added above? The deafault timeout?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Okay.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java, line 96&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line96&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line96&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Will this work?  What happens if lots of concurrent threads going against lots of different tables each with a different timeout?  Will a meta table call pick up a short timeout that was put in place by a near-concurrent edit?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good question. Because the &lt;tt&gt;HBaseRPC#rpcTimeout&lt;/tt&gt; is defined to be &lt;tt&gt;ThreadLocal&lt;/tt&gt;, it should only apply to the user thread that is performing the &lt;tt&gt;HTable&lt;/tt&gt; operation. Also, we take care to reset that thread-specific timeout (make it the default) after the &lt;tt&gt;ServerCallable#call} is done. To be strictly correct, I now do the reset in a finally block in {{HConnectionImplementation#getRegionServerWith*Retries&lt;/tt&gt;.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java, line 106&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line106&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line106&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Are there other exceptions you think we should rethrow?  Connection Exception?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How about we do what HBaseClient does, which is wrap the SocketTimeoutException inside another one, along with a context-specific error message?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Karthick&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/755/#review683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#review683&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-05-18 23:56:26, Karthick Sankarachary wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/755/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-18 23:56:26)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3154&quot; title=&quot;HBase RPC should support timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3154&quot;&gt;&lt;del&gt;HBASE-3154&lt;/del&gt;&lt;/a&gt;, users now have the ability to specify a timeout for client-side RPC calls. However, it doesn&apos;t go far enough in terms of how low that timeout can go. Set the RPC timeout to too low a value and you run the risk of timing out on calls to the meta tables, which are preconditions to calling the &lt;tt&gt;HRegionInterface&lt;/tt&gt; proxy.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Given that, I believe the motivation at work in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt; still hold true. In this patch, I add a operation-level timeout, configurable through &quot;hbase.client.operation.timeout&quot;, which will override the value specified by &quot;hbase.rpc.timeout&quot;, if any, within the scope of the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. In other words, the operation-level timeout does not apply to calls to the meta tables. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Furthermore, the patch treats an RPC timeout as a non-fatal event, in that it will not cause the &lt;tt&gt;HBaseClient#Connection&lt;/tt&gt; instance to be closed. Last but not the least, users will also have the ability to set the operation timeout on the &lt;tt&gt;HTable&lt;/tt&gt; on the fly.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2937&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java e9e3694 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java b26f41e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HTable.java 61e151a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java 6f22123 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 470e741 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java dbb57d9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/PoolMap.java 354d49a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/755/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;mvn test&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13036677" author="jiraposter@reviews.apache.org" created="Fri, 20 May 2011 05:14:47 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; This seems like a bunch of functionality for a relatively small change.  Nice one Karthick.  A few questions in the below.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yes, it does seem like a big change for a relatively small feature, but an important one nevertheless. The complexity stems from the fact the scope of the operation timeout has to be limited to the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;By way of motivation, if you run the TestFromClientSide test with the following patch (which sets the &quot;hbase.rpc.timeout&quot; to 10ms), you&apos;ll see that 39 out of the 44 test cases will fail.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;24 &amp;#8212; a/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;25 +++ b/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;26 @@ -94,6 +94,8 @@ public class TestFromClientSide {&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;27    @BeforeClass&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;28    public static void setUpBeforeClass() throws Exception {
bq.           29      TEST_UTIL.startMiniCluster(3);
bq.           30 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 10);
bq.           32    }&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;On the other hand, if you run it with the default &quot;hbase.rpc.timeout&quot; but a &quot;hbase.client.operation.timeout&quot; set to 10ms, then you should see the test pass.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;24 &amp;#8212; a/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;25 +++ b/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;26 @@ -94,6 +94,8 @@ public class TestFromClientSide {&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;27    @BeforeClass&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;28    public static void setUpBeforeClass() throws Exception {
bq.           29      TEST_UTIL.startMiniCluster(3);
bq.           30 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 60000);
bq.           31 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_OPERATION_TIMEOUT, 10);
bq.           32    }&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually I was saying the opposite.  I&apos;m surprised at how little code had to change to make this fix.&lt;/p&gt;

&lt;p&gt;So, I don&apos;t recall if there is good documentation in this patch on the difference between &quot;hbase.rpc.timeout&quot; and &quot;hbase.client.operation.timeout&quot;?  If not, we need it.&lt;/p&gt;

&lt;p&gt;Does the TestFromClientSide complete in shorter time if I set a &quot;hbase.client.operation.timeout&quot; of 10ms?&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java, line 96&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line96&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line96&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Will this work?  What happens if lots of concurrent threads going against lots of different tables each with a different timeout?  Will a meta table call pick up a short timeout that was put in place by a near-concurrent edit?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Good question. Because the &lt;tt&gt;HBaseRPC#rpcTimeout&lt;/tt&gt; is defined to be &lt;tt&gt;ThreadLocal&lt;/tt&gt;, it should only apply to the user thread that is performing the &lt;tt&gt;HTable&lt;/tt&gt; operation. Also, we take care to reset that thread-specific timeout (make it the default) after the &lt;tt&gt;ServerCallable#call} is done. To be strictly correct, I now do the reset in a finally block in {{HConnectionImplementation#getRegionServerWith*Retries&lt;/tt&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok.  If ThreadLocal we should be fine.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java, line 106&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line106&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line106&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Are there other exceptions you think we should rethrow?  Connection Exception?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;How about we do what HBaseClient does, which is wrap the SocketTimeoutException inside another one, along with a context-specific error message?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was more wondering if there were exceptions we should treat like SocketTimeoutException?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/755/#review683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#review683&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-05-19 23:14:57, Karthick Sankarachary wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/755/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-19 23:14:57)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3154&quot; title=&quot;HBase RPC should support timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3154&quot;&gt;&lt;del&gt;HBASE-3154&lt;/del&gt;&lt;/a&gt;, users now have the ability to specify a timeout for client-side RPC calls. However, it doesn&apos;t go far enough in terms of how low that timeout can go. Set the RPC timeout to too low a value and you run the risk of timing out on calls to the meta tables, which are preconditions to calling the &lt;tt&gt;HRegionInterface&lt;/tt&gt; proxy.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Given that, I believe the motivation at work in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt; still hold true. In this patch, I add a operation-level timeout, configurable through &quot;hbase.client.operation.timeout&quot;, which will override the value specified by &quot;hbase.rpc.timeout&quot;, if any, within the scope of the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. In other words, the operation-level timeout does not apply to calls to the meta tables. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Furthermore, the patch treats an RPC timeout as a non-fatal event, in that it will not cause the &lt;tt&gt;HBaseClient#Connection&lt;/tt&gt; instance to be closed. Last but not the least, users will also have the ability to set the operation timeout on the &lt;tt&gt;HTable&lt;/tt&gt; on the fly.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2937&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java e9e3694 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java b26f41e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HTable.java 61e151a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java 6f22123 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 470e741 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java dbb57d9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/PoolMap.java 354d49a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/755/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;mvn test&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13037078" author="jiraposter@reviews.apache.org" created="Fri, 20 May 2011 20:50:47 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; This seems like a bunch of functionality for a relatively small change.  Nice one Karthick.  A few questions in the below.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yes, it does seem like a big change for a relatively small feature, but an important one nevertheless. The complexity stems from the fact the scope of the operation timeout has to be limited to the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;By way of motivation, if you run the TestFromClientSide test with the following patch (which sets the &quot;hbase.rpc.timeout&quot; to 10ms), you&apos;ll see that 39 out of the 44 test cases will fail.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;24 &amp;#8212; a/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;25 +++ b/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;26 @@ -94,6 +94,8 @@ public class TestFromClientSide {&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;27    @BeforeClass&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;28    public static void setUpBeforeClass() throws Exception {
bq.           29      TEST_UTIL.startMiniCluster(3);
bq.           30 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 10);
bq.           32    }&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;On the other hand, if you run it with the default &quot;hbase.rpc.timeout&quot; but a &quot;hbase.client.operation.timeout&quot; set to 10ms, then you should see the test pass.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;24 &amp;#8212; a/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;25 +++ b/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;26 @@ -94,6 +94,8 @@ public class TestFromClientSide {&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;27    @BeforeClass&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;28    public static void setUpBeforeClass() throws Exception {
bq.           29      TEST_UTIL.startMiniCluster(3);
bq.           30 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 60000);
bq.           31 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_OPERATION_TIMEOUT, 10);
bq.           32    }&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Actually I was saying the opposite.  I&apos;m surprised at how little code had to change to make this fix.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;So, I don&apos;t recall if there is good documentation in this patch on the difference between &quot;hbase.rpc.timeout&quot; and &quot;hbase.client.operation.timeout&quot;?  If not, we need it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Does the TestFromClientSide complete in shorter time if I set a &quot;hbase.client.operation.timeout&quot; of 10ms?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There&apos;s comments in &lt;tt&gt;HConstants&lt;/tt&gt; for both of those configuration properties. Is there another place where we should document them?&lt;/p&gt;

&lt;p&gt;The test completes in more or less the same time, regardless of whether or not the &quot;hbase.client.operation.timeout&quot; is set to 10ms. I guess that&apos;s because the test server is running locally, which is probably why the test cases don&apos;t timeout.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java, line 106&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line106&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line106&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Are there other exceptions you think we should rethrow?  Connection Exception?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;How about we do what HBaseClient does, which is wrap the SocketTimeoutException inside another one, along with a context-specific error message?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I was more wondering if there were exceptions we should treat like SocketTimeoutException?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The other kinds of exceptions we might expect &lt;tt&gt;HBaseClient&lt;/tt&gt; to throw include &lt;tt&gt;ConnectException&lt;/tt&gt; and &lt;tt&gt;IOException&lt;/tt&gt;. We could treat them similarly, but only if we have already spent more time than the operation timeout. If not, then we could retry the call, this time using a lower operation timeout. To take an example, if the operation timeout is 50ms, and a &lt;tt&gt;ConnectException&lt;/tt&gt; occurs 10ms after the call, then we could retry the call with a 40ms operation timeout. What do you think?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Karthick&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/755/#review683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#review683&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-05-20 20:49:57, Karthick Sankarachary wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/755/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-20 20:49:57)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3154&quot; title=&quot;HBase RPC should support timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3154&quot;&gt;&lt;del&gt;HBASE-3154&lt;/del&gt;&lt;/a&gt;, users now have the ability to specify a timeout for client-side RPC calls. However, it doesn&apos;t go far enough in terms of how low that timeout can go. Set the RPC timeout to too low a value and you run the risk of timing out on calls to the meta tables, which are preconditions to calling the &lt;tt&gt;HRegionInterface&lt;/tt&gt; proxy.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Given that, I believe the motivation at work in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt; still hold true. In this patch, I add a operation-level timeout, configurable through &quot;hbase.client.operation.timeout&quot;, which will override the value specified by &quot;hbase.rpc.timeout&quot;, if any, within the scope of the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. In other words, the operation-level timeout does not apply to calls to the meta tables. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Furthermore, the patch treats an RPC timeout as a non-fatal event, in that it will not cause the &lt;tt&gt;HBaseClient#Connection&lt;/tt&gt; instance to be closed. Last but not the least, users will also have the ability to set the operation timeout on the &lt;tt&gt;HTable&lt;/tt&gt; on the fly.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2937&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java e9e3694 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java b26f41e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HTable.java 61e151a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java 6f22123 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 470e741 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java dbb57d9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/PoolMap.java 354d49a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/755/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;mvn test&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13037079" author="jiraposter@reviews.apache.org" created="Fri, 20 May 2011 20:50:48 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/755/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-05-20 20:49:57.345063)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Retry &lt;tt&gt;ServerCallable#call&lt;/tt&gt; in the case of non-{{SocketTimeoutException}}s, but only if we spent less time than the operation timeout.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3154&quot; title=&quot;HBase RPC should support timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3154&quot;&gt;&lt;del&gt;HBASE-3154&lt;/del&gt;&lt;/a&gt;, users now have the ability to specify a timeout for client-side RPC calls. However, it doesn&apos;t go far enough in terms of how low that timeout can go. Set the RPC timeout to too low a value and you run the risk of timing out on calls to the meta tables, which are preconditions to calling the &lt;tt&gt;HRegionInterface&lt;/tt&gt; proxy.&lt;/p&gt;

&lt;p&gt;Given that, I believe the motivation at work in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt; still hold true. In this patch, I add a operation-level timeout, configurable through &quot;hbase.client.operation.timeout&quot;, which will override the value specified by &quot;hbase.rpc.timeout&quot;, if any, within the scope of the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. In other words, the operation-level timeout does not apply to calls to the meta tables. &lt;/p&gt;

&lt;p&gt;Furthermore, the patch treats an RPC timeout as a non-fatal event, in that it will not cause the &lt;tt&gt;HBaseClient#Connection&lt;/tt&gt; instance to be closed. Last but not the least, users will also have the ability to set the operation timeout on the &lt;tt&gt;HTable&lt;/tt&gt; on the fly.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2937&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HConstants.java e9e3694 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java b26f41e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HTable.java 61e151a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java 6f22123 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 470e741 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java dbb57d9 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/PoolMap.java 354d49a &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/755/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;mvn test&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Karthick&lt;/p&gt;
</comment>
                            <comment id="13037097" author="jiraposter@reviews.apache.org" created="Fri, 20 May 2011 21:30:47 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; This seems like a bunch of functionality for a relatively small change.  Nice one Karthick.  A few questions in the below.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yes, it does seem like a big change for a relatively small feature, but an important one nevertheless. The complexity stems from the fact the scope of the operation timeout has to be limited to the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;By way of motivation, if you run the TestFromClientSide test with the following patch (which sets the &quot;hbase.rpc.timeout&quot; to 10ms), you&apos;ll see that 39 out of the 44 test cases will fail.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;24 &amp;#8212; a/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;25 +++ b/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;26 @@ -94,6 +94,8 @@ public class TestFromClientSide {&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;27    @BeforeClass&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;28    public static void setUpBeforeClass() throws Exception {
bq.           29      TEST_UTIL.startMiniCluster(3);
bq.           30 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 10);
bq.           32    }&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;On the other hand, if you run it with the default &quot;hbase.rpc.timeout&quot; but a &quot;hbase.client.operation.timeout&quot; set to 10ms, then you should see the test pass.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;24 &amp;#8212; a/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;25 +++ b/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;26 @@ -94,6 +94,8 @@ public class TestFromClientSide {&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;27    @BeforeClass&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;28    public static void setUpBeforeClass() throws Exception {
bq.           29      TEST_UTIL.startMiniCluster(3);
bq.           30 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 60000);
bq.           31 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_OPERATION_TIMEOUT, 10);
bq.           32    }&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Actually I was saying the opposite.  I&apos;m surprised at how little code had to change to make this fix.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;So, I don&apos;t recall if there is good documentation in this patch on the difference between &quot;hbase.rpc.timeout&quot; and &quot;hbase.client.operation.timeout&quot;?  If not, we need it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Does the TestFromClientSide complete in shorter time if I set a &quot;hbase.client.operation.timeout&quot; of 10ms?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There&apos;s comments in &lt;tt&gt;HConstants&lt;/tt&gt; for both of those configuration properties. Is there another place where we should document them?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The test completes in more or less the same time, regardless of whether or not the &quot;hbase.client.operation.timeout&quot; is set to 10ms. I guess that&apos;s because the test server is running locally, which is probably why the test cases don&apos;t timeout.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So, high-level, IIUC, this patch will allow setting shorter operation timeouts.  You&apos;ll have to do it by setting hbase.client.operation.timeout in the Configuration the HTable uses.  Is that right? I see the default is MAX_INT for hbase.client.operation.timeout.  Does that mean the &quot;hbase.rpc.timeout&quot; prevails?  If &quot;hbase.client.operation.timeout&quot; timeouts we retry?  Is that right, the configured amount of times?&lt;/p&gt;

&lt;p&gt;Sort-of-related, shorter timeouts make it more critical that we do a better job server-side keeping account of when an operation arrives and making sure it does not go through if by the time it comes out of the RPC queue, so much time has elapsed, the client has gone away (We don&apos;t want operations completing on the server if no client to reply to).&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java, line 106&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line106&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line106&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Are there other exceptions you think we should rethrow?  Connection Exception?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;How about we do what HBaseClient does, which is wrap the SocketTimeoutException inside another one, along with a context-specific error message?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I was more wondering if there were exceptions we should treat like SocketTimeoutException?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The other kinds of exceptions we might expect &lt;tt&gt;HBaseClient&lt;/tt&gt; to throw include &lt;tt&gt;ConnectException&lt;/tt&gt; and &lt;tt&gt;IOException&lt;/tt&gt;. We could treat them similarly, but only if we have already spent more time than the operation timeout. If not, then we could retry the call, this time using a lower operation timeout. To take an example, if the operation timeout is 50ms, and a &lt;tt&gt;ConnectException&lt;/tt&gt; occurs 10ms after the call, then we could retry the call with a 40ms operation timeout. What do you think?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not important I&apos;d say.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/755/#review683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#review683&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-05-20 20:49:57, Karthick Sankarachary wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/755/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-20 20:49:57)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3154&quot; title=&quot;HBase RPC should support timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3154&quot;&gt;&lt;del&gt;HBASE-3154&lt;/del&gt;&lt;/a&gt;, users now have the ability to specify a timeout for client-side RPC calls. However, it doesn&apos;t go far enough in terms of how low that timeout can go. Set the RPC timeout to too low a value and you run the risk of timing out on calls to the meta tables, which are preconditions to calling the &lt;tt&gt;HRegionInterface&lt;/tt&gt; proxy.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Given that, I believe the motivation at work in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt; still hold true. In this patch, I add a operation-level timeout, configurable through &quot;hbase.client.operation.timeout&quot;, which will override the value specified by &quot;hbase.rpc.timeout&quot;, if any, within the scope of the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. In other words, the operation-level timeout does not apply to calls to the meta tables. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Furthermore, the patch treats an RPC timeout as a non-fatal event, in that it will not cause the &lt;tt&gt;HBaseClient#Connection&lt;/tt&gt; instance to be closed. Last but not the least, users will also have the ability to set the operation timeout on the &lt;tt&gt;HTable&lt;/tt&gt; on the fly.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2937&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java e9e3694 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java b26f41e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HTable.java 61e151a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java 6f22123 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 470e741 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java dbb57d9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/PoolMap.java 354d49a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/755/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;mvn test&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13037108" author="jiraposter@reviews.apache.org" created="Fri, 20 May 2011 21:56:52 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; This seems like a bunch of functionality for a relatively small change.  Nice one Karthick.  A few questions in the below.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Yes, it does seem like a big change for a relatively small feature, but an important one nevertheless. The complexity stems from the fact the scope of the operation timeout has to be limited to the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;By way of motivation, if you run the TestFromClientSide test with the following patch (which sets the &quot;hbase.rpc.timeout&quot; to 10ms), you&apos;ll see that 39 out of the 44 test cases will fail.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;24 &amp;#8212; a/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;25 +++ b/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;26 @@ -94,6 +94,8 @@ public class TestFromClientSide {&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;27    @BeforeClass&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;28    public static void setUpBeforeClass() throws Exception {
bq.           29      TEST_UTIL.startMiniCluster(3);
bq.           30 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 10);
bq.           32    }&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;On the other hand, if you run it with the default &quot;hbase.rpc.timeout&quot; but a &quot;hbase.client.operation.timeout&quot; set to 10ms, then you should see the test pass.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;24 &amp;#8212; a/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;25 +++ b/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;26 @@ -94,6 +94,8 @@ public class TestFromClientSide {&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;27    @BeforeClass&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;28    public static void setUpBeforeClass() throws Exception {
bq.           29      TEST_UTIL.startMiniCluster(3);
bq.           30 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 60000);
bq.           31 +    TEST_UTIL.getConfiguration().setInt(HConstants.HBASE_CLIENT_OPERATION_TIMEOUT, 10);
bq.           32    }&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Actually I was saying the opposite.  I&apos;m surprised at how little code had to change to make this fix.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;So, I don&apos;t recall if there is good documentation in this patch on the difference between &quot;hbase.rpc.timeout&quot; and &quot;hbase.client.operation.timeout&quot;?  If not, we need it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Does the TestFromClientSide complete in shorter time if I set a &quot;hbase.client.operation.timeout&quot; of 10ms?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;There&apos;s comments in &lt;tt&gt;HConstants&lt;/tt&gt; for both of those configuration properties. Is there another place where we should document them?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The test completes in more or less the same time, regardless of whether or not the &quot;hbase.client.operation.timeout&quot; is set to 10ms. I guess that&apos;s because the test server is running locally, which is probably why the test cases don&apos;t timeout.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;So, high-level, IIUC, this patch will allow setting shorter operation timeouts.  You&apos;ll have to do it by setting hbase.client.operation.timeout in the Configuration the HTable uses.  Is that right? I see the default is MAX_INT for hbase.client.operation.timeout.  Does that mean the &quot;hbase.rpc.timeout&quot; prevails?  If &quot;hbase.client.operation.timeout&quot; timeouts we retry?  Is that right, the configured amount of times?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Sort-of-related, shorter timeouts make it more critical that we do a better job server-side keeping account of when an operation arrives and making sure it does not go through if by the time it comes out of the RPC queue, so much time has elapsed, the client has gone away (We don&apos;t want operations completing on the server if no client to reply to).&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;So, high-level, IIUC, this patch will allow setting shorter operation timeouts.  You&apos;ll have to do it by setting hbase.client.operation.timeout in the Configuration the HTable uses.  Is that right? I see the default is MAX_INT for hbase.client.operation.timeout.  Does that mean the &quot;hbase.rpc.timeout&quot; prevails?  &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, to both of the above questions.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If &quot;hbase.client.operation.timeout&quot; timeouts we retry?  Is that right, the configured amount of times?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Actually, no we don&apos;t retry, as that would kind of defeat the purpose of the operation timeout, in my opinion. Note that if we were to retry we would have to pause (for at least 1000 ms by default). If the client does not have the luxury of spending say 10ms on a &lt;tt&gt;HTable&lt;/tt&gt; operation, then it will probably not want to pause either, which rules out retries.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Sort-of-related, shorter timeouts make it more critical that we do a better job server-side keeping account of when an operation arrives and making sure it does not go through if by the time it comes out of the RPC queue, so much time has elapsed, the client has gone away (We don&apos;t want operations completing on the server if no client to reply to).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That would be kind of hard to do, since we don&apos;t propagate the RPC timeout to the server-side. Currently, we read the response for a given call in &lt;tt&gt;HBaseClient#Connection#receiveResponse&lt;/tt&gt; regardless of whether that call is currently active or not. If the call does not exist in the connection, then we end up dropping the response (after we&apos;ve finished reading it though). Given that, do we still need to do the above?&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-05-19 06:11:23, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java, line 106&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line106&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff/1/?file=19383#file19383line106&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Are there other exceptions you think we should rethrow?  Connection Exception?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;How about we do what HBaseClient does, which is wrap the SocketTimeoutException inside another one, along with a context-specific error message?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I was more wondering if there were exceptions we should treat like SocketTimeoutException?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick Sankarachary wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The other kinds of exceptions we might expect &lt;tt&gt;HBaseClient&lt;/tt&gt; to throw include &lt;tt&gt;ConnectException&lt;/tt&gt; and &lt;tt&gt;IOException&lt;/tt&gt;. We could treat them similarly, but only if we have already spent more time than the operation timeout. If not, then we could retry the call, this time using a lower operation timeout. To take an example, if the operation timeout is 50ms, and a &lt;tt&gt;ConnectException&lt;/tt&gt; occurs 10ms after the call, then we could retry the call with a 40ms operation timeout. What do you think?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Not important I&apos;d say.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I kind of jumped the gun and did what I described above in version V3. Let me know if we should leave it there - I don&apos;t think it&apos;ll hurt.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Karthick&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/755/#review683&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/#review683&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-05-20 20:49:57, Karthick Sankarachary wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/755/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-05-20 20:49:57)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3154&quot; title=&quot;HBase RPC should support timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3154&quot;&gt;&lt;del&gt;HBASE-3154&lt;/del&gt;&lt;/a&gt;, users now have the ability to specify a timeout for client-side RPC calls. However, it doesn&apos;t go far enough in terms of how low that timeout can go. Set the RPC timeout to too low a value and you run the risk of timing out on calls to the meta tables, which are preconditions to calling the &lt;tt&gt;HRegionInterface&lt;/tt&gt; proxy.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Given that, I believe the motivation at work in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt; still hold true. In this patch, I add a operation-level timeout, configurable through &quot;hbase.client.operation.timeout&quot;, which will override the value specified by &quot;hbase.rpc.timeout&quot;, if any, within the scope of the &lt;tt&gt;ServerCallable#call&lt;/tt&gt; method. In other words, the operation-level timeout does not apply to calls to the meta tables. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Furthermore, the patch treats an RPC timeout as a non-fatal event, in that it will not cause the &lt;tt&gt;HBaseClient#Connection&lt;/tt&gt; instance to be closed. Last but not the least, users will also have the ability to set the operation timeout on the &lt;tt&gt;HTable&lt;/tt&gt; on the fly.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2937&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/HConstants.java e9e3694 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java b26f41e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HTable.java 61e151a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java 6f22123 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java 470e741 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java dbb57d9 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/PoolMap.java 354d49a &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/755/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;mvn test&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Karthick&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13038210" author="stack" created="Mon, 23 May 2011 20:40:07 +0000"  >&lt;p&gt;Are you going to upload a new patch Karthick or this is ready to go?&lt;/p&gt;</comment>
                            <comment id="13038241" author="karthick" created="Mon, 23 May 2011 21:23:35 +0000"  >&lt;p&gt;I believe the current patch in &lt;a href=&quot;https://reviews.apache.org/r/755&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/755&lt;/a&gt; is ready to go. &lt;/p&gt;

&lt;p&gt;Note that the &lt;tt&gt;ServerCallable&lt;/tt&gt; will retry the call in the case of &lt;tt&gt;ConnectException&lt;/tt&gt; and &lt;tt&gt;IOException&lt;/tt&gt; if there appears to be time for for one more retry. However, in the case of a &lt;tt&gt;SocketTimeoutException&lt;/tt&gt;, it will not retry the call, because that would entail pausing for an inordinately long period of time. &lt;/p&gt;

&lt;p&gt;A final caveat - under heavy load, the &lt;tt&gt;HTable&lt;/tt&gt; operation may take slightly longer than &quot;hbase.client.operation.timeout&quot; to complete, since it could take a while for the response thread in &lt;tt&gt;HBaseClient&lt;/tt&gt; to hand over control to the request thread.&lt;/p&gt;</comment>
                            <comment id="13039325" author="stack" created="Wed, 25 May 2011 20:51:37 +0000"  >&lt;p&gt;Committed to TRUNK.  Thanks for the improvement Karthick (You might check PoolMap &amp;#8211; your patch wants to change poolMap to HashMap but it was made into a concurrenthashmap recently.  I left it as latter).&lt;/p&gt;</comment>
                            <comment id="13039326" author="stack" created="Wed, 25 May 2011 20:52:21 +0000"  >&lt;p&gt;Oh, Karthick, you might want to fill in the release note section above in this issue on what exactly was added by way of advertising this new functionality.  Thanks.&lt;/p&gt;</comment>
                            <comment id="13039334" author="karthick" created="Wed, 25 May 2011 21:06:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;You might check PoolMap &#8211; your patch wants to change poolMap to HashMap but it was made into a concurrenthashmap recently. I left it as latter.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, it is better off being a &lt;tt&gt;ConcurrentHashMap&lt;/tt&gt;, since &lt;tt&gt;HTablePool&lt;/tt&gt; assumes it is thread-safe.&lt;/p&gt;</comment>
                            <comment id="13039404" author="hudson" created="Wed, 25 May 2011 23:00:42 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1939 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/HBase-TRUNK/1939/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/HBase-TRUNK/1939/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2937&quot; title=&quot;Facilitate Timeouts In HBase Client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2937&quot;&gt;&lt;del&gt;HBASE-2937&lt;/del&gt;&lt;/a&gt; Facilitate Timeouts In HBase Client&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/PoolMap.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HTable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HBaseRPC.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HBaseClient.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13466645" author="ikeda" created="Mon, 1 Oct 2012 05:20:49 +0000"  >&lt;p&gt;Is it really ok if you try to read data halfway, catch SocketTimeoutException, and keep the HBaseClient.Connection instance to continue reading next data from the stream starting at the halfway point?&lt;/p&gt;</comment>
                            <comment id="15017005" author="lars_francke" created="Fri, 20 Nov 2015 12:41:32 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12462015">HBASE-2445</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12498300">HBASE-3523</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12467290" name="HBASE-2937.patch" size="40439" author="karthick" created="Sun, 2 Jan 2011 21:29:58 +0000"/>
                            <attachment id="12453195" name="HBASE-2937.patch" size="22452" author="karthick" created="Fri, 27 Aug 2010 01:09:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 30 Aug 2010 19:50:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32840</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hjxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100490</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Add a &amp;quot;hbase.client.operation.timeout&amp;quot; parameter to specify shorter timeouts around HTable operations, which kicks in after the client has been initialized.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>HBase Timeout</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>