<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:19:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11073/HBASE-11073.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11073] Hide ZooKeeperWatcher and dependent ZK Listeners inside of a consensus impl</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11073</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;(copied from the design doc):&lt;/p&gt;

&lt;p&gt;Redesign ZooKeeperListeners to abstract them from ZooKeeper API. &lt;/p&gt;

&lt;p&gt;            Current design:&lt;br/&gt;
The ZooKeeperListener interface is implemented by a number of classes and has 4 low-level API methods&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;nodeCreated()&lt;/li&gt;
	&lt;li&gt;nodeDeleted()&lt;/li&gt;
	&lt;li&gt;nodeDataChanged()&lt;/li&gt;
	&lt;li&gt;nodeChildrenChanged()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ZooKeeperWatcher maintains list of listeners and upon receiving ZK event calls all registered listeners and passes them affected znode&#8217;s path.&lt;/p&gt;

&lt;p&gt;            Proposed design:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Create new interface ConsensusHandler that contains a single method, handle(Agreement agreement).&lt;/li&gt;
	&lt;li&gt;Modify the classes currently implementing the ZooKeeperListener interface so they implement the new ConsensusHandler interface. In their handle(...) method they will typecast the agreement instance to specific type (like AssignmentAgreement), extract the information encoded in it, and do their work&lt;/li&gt;
	&lt;li&gt;Create an interface called AgreementLearner which will maintain a list of all ConsensusHandlers as a map of znode prefixes to handler instance. The ZK implementation, ZkAgreementLearner, will be used to dispatch events to the appropriate namespaces in the ZooKeeperWatcher by parsing the znodes-level event, constructing Agreement objects of proper type and dispatching them to appropriate ConsensusHandlers.&lt;/li&gt;
	&lt;li&gt;Modify ZooKeeperWatcher:
	&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
		&lt;li&gt;remove the internal collection of ZooKeeperListeners&lt;/li&gt;
		&lt;li&gt;move znode prefixes to ZkAgreementLearner class&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
	&lt;li&gt;in the handle(...) method pass the event to ZkAgreementLearner for further dispatching and execution.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The following is a list of listeners to take care of (some are described in the items above already):&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;ZKLeaderManager&lt;/li&gt;
	&lt;li&gt;ZooKeeperNodeTracker&lt;/li&gt;
	&lt;li&gt;TableHFileArchiveTracker&lt;/li&gt;
	&lt;li&gt;ActiveMasterManager&lt;/li&gt;
	&lt;li&gt;AssignmentManager&lt;/li&gt;
	&lt;li&gt;SplitLogManager&lt;/li&gt;
	&lt;li&gt;ZKProcedureUtil&lt;/li&gt;
	&lt;li&gt;SplitLogWorker&lt;/li&gt;
	&lt;li&gt;ZKPermissionWatcher&lt;/li&gt;
	&lt;li&gt;ZKSecretWatcher&lt;/li&gt;
	&lt;li&gt;ZKNamespaceManager&lt;/li&gt;
	&lt;li&gt;DeletionListener&lt;/li&gt;
	&lt;li&gt;DrainingServerTracker&lt;/li&gt;
	&lt;li&gt;RecoveringRegionWatcher&lt;/li&gt;
	&lt;li&gt;RegionServerTracker&lt;/li&gt;
	&lt;li&gt;ReplicationPeer&lt;/li&gt;
	&lt;li&gt;MasterAddressTracker&lt;/li&gt;
	&lt;li&gt;MetaRegionTracker&lt;/li&gt;
	&lt;li&gt;ClusterStatusTracker&lt;/li&gt;
	&lt;li&gt;LoadBalancerTracker&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12710469">HBASE-11073</key>
            <summary>Hide ZooKeeperWatcher and dependent ZK Listeners inside of a consensus impl</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="3" iconUrl="https://issues.apache.org/jira/images/icons/statuses/inprogress.png" description="This issue is being actively worked on at the moment by the assignee.">In Progress</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="mantonov">Mikhail Antonov</assignee>
                                    <reporter username="mantonov">Mikhail Antonov</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Apr 2014 00:51:20 +0000</created>
                <updated>Thu, 3 Jul 2014 21:52:32 +0000</updated>
                                            <version>0.99.0</version>
                                                    <component>Consensus</component>
                    <component>Zookeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13983993" author="mantonov" created="Tue, 29 Apr 2014 04:43:22 +0000"  >&lt;p&gt;Since that&apos;s relatively big patch, as I anticipate &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I&apos;d appreciate some design feedback upfront.. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; ...?&lt;/p&gt;</comment>
                            <comment id="14018993" author="stack" created="Thu, 5 Jun 2014 17:29:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mantonov&quot; class=&quot;user-hover&quot; rel=&quot;mantonov&quot;&gt;Mikhail Antonov&lt;/a&gt; What you need?  Design looks good.  I like how you are trying to up the granularity &amp;#8211; i.e. adding a handle and then in the handle do the low level zk calls.  Any chance of a sketch patch doing one change?  Can be messy.&lt;/p&gt;

&lt;p&gt;s/ConsensusHandler/CoordinatorHandler/ ?&lt;/p&gt;

&lt;p&gt;s/AgreementLearner/AgreementRegistry/ ?&lt;/p&gt;
</comment>
                            <comment id="14019036" author="mantonov" created="Thu, 5 Jun 2014 17:59:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; I&apos;m not blocked on anything here, just WIP for me. I&apos;ll roll out sketch patch as soon as I have it (it&apos;s somewhat intersecting with effort to abstract client from ZK).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Jun 2014 17:29:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388790</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 28 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1uyz3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>389038</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>