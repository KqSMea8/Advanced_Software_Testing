<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:25:44 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11696/HBASE-11696.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11696] Make CombinedBlockCache resizable.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11696</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5349&quot; title=&quot;Automagically tweak global memstore and block cache sizes based on workload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5349&quot;&gt;&lt;del&gt;HBASE-5349&lt;/del&gt;&lt;/a&gt; adds auto tuning of memstore heap and block cache heap. Block cache needs to be resizable in order for this. CombinedBlockCache is not marked resizable now. We can make this. On resize the L1 cache (ie. LRU cache) can get resized.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12732593">HBASE-11696</key>
            <summary>Make CombinedBlockCache resizable.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anoop.hbase">Anoop Sam John</assignee>
                                    <reporter username="anoop.hbase">Anoop Sam John</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Aug 2014 17:01:00 +0000</created>
                <updated>Sat, 21 Feb 2015 23:34:30 +0000</updated>
                            <resolved>Tue, 19 Aug 2014 12:09:01 +0000</resolved>
                                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14089494" author="stack" created="Thu, 7 Aug 2014 17:32:13 +0000"  >&lt;p&gt;On CBC, L1 is META blocks only.  I could imagine it running a while and then ergonomics asking its usage is and then shrinking down the L1 so it was the size of the META block cache only.  It could check back on occasion to see if evictions.  If so, size up the L1 until evictions go to zero again.&lt;/p&gt;

&lt;p&gt;This would be sweet.&lt;/p&gt;</comment>
                            <comment id="14089529" author="anoop.hbase" created="Thu, 7 Aug 2014 17:59:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;On CBC, L1 is META blocks only.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;META alone? We have HCD#setCacheDataInL1(boolean value) right?  Not gone through the entire code flow of that. Correct me if I wrong.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I could imagine it running a while and then ergonomics asking its usage is and then shrinking down the L1 so it was the size of the META block cache only. It could check back on occasion to see if evictions. If so, size up the L1 until evictions go to zero again.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ya  the tuner framework will do this work.&lt;/p&gt;</comment>
                            <comment id="14089641" author="stack" created="Thu, 7 Aug 2014 19:15:15 +0000"  >&lt;p&gt;META is not meta table, its INDEX+BLOOM blocks.&lt;/p&gt;</comment>
                            <comment id="14090212" author="anoop.hbase" created="Fri, 8 Aug 2014 02:27:09 +0000"  >&lt;p&gt;Yes &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; I got it like META blocks u r referring.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
   * @param value &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we should cache data blocks in the L1 cache (&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; block cache deploy
   * has more than one tier; e.g. we are using CombinedBlockCache).
   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; chained invocation)
   */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; HColumnDescriptor setCacheDataInL1(&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; value) {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; setValue(CACHE_DATA_IN_L1, &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;.toString(value));
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above javadoc confused me.  I thought the data blocks for that HCD will be stored in L1.&lt;/p&gt;</comment>
                            <comment id="14090257" author="stack" created="Fri, 8 Aug 2014 03:31:20 +0000"  >&lt;p&gt;Yes.  You are right. If the flag is set on a CF to store DATA blocks in L1, it will be done.  What you thinking? We&apos;ll resize L1 until no evictions up to a max size (whether hosting DATA and/or META)?&lt;/p&gt;</comment>
                            <comment id="14090363" author="anoop.hbase" created="Fri, 8 Aug 2014 06:18:44 +0000"  >&lt;p&gt;It depends on the auto tuner impl. The default simple one will increase size (till max size) when there are evictions- until to reach a non evicting state. Also this it can do only when there is very less/no write load and there are no blocking flushes due to global heap pressure.&lt;/p&gt;

&lt;p&gt;And regarding DATA/META blocks hosting, will it be better we have separate cache parts for META and DATA blocks? Not gone into more details in this area. &lt;/p&gt;</comment>
                            <comment id="14090791" author="stack" created="Fri, 8 Aug 2014 14:15:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;The default simple one will increase size (till max size) when there are evictions- until to reach a non evicting state. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Nice.  Where is this doc&apos;d.  This feature is not on by default, right (because afraid messing w/ mem settings will mess up GC?).  Shouldn&apos;t we turn it on in master branch?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;And regarding DATA/META blocks hosting, will it be better we have separate cache parts for META and DATA blocks? Not gone into more details in this area.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well, at moment options are all types in cache or if CombinedBlockCache, the bucketcache policy class, then DATA in L2 and META in L1 (caveat the flag you cite above on CF) so special areas for DATA and META seems like a complication.  You want this delineation for ergonomic feature?  Thanks.&lt;/p&gt;
</comment>
                            <comment id="14090801" author="anoop.hbase" created="Fri, 8 Aug 2014 14:32:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;Nice. Where is this doc&apos;d. This feature is not on by default, right (because afraid messing w/ mem settings will mess up GC?). Shouldn&apos;t we turn it on in master branch?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Will add to our book. Will work on doc patch.   Yes I will raise an issue to turn it ON by default.  Will do some more long run testing around this before we tunr it ON.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;You want this delineation for ergonomic feature?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Was just thinking whether it will help.  Will have to read through that code more and test.   I believe you work in this area. So can help you boss.&lt;/p&gt;</comment>
                            <comment id="14092582" author="anoop.hbase" created="Mon, 11 Aug 2014 09:00:21 +0000"  >&lt;p&gt;Simple patch. On size change it will be applied to the L1 LRUCache only.&lt;/p&gt;</comment>
                            <comment id="14095662" author="stack" created="Wed, 13 Aug 2014 16:19:54 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Add release note. +1 on enabling by default. We need to write a policy that keeps growing block cache while there are evictions going on (until we stop doing evictions or hit max size?)&lt;/p&gt;</comment>
                            <comment id="14095849" author="anoop.hbase" created="Wed, 13 Aug 2014 18:17:25 +0000"  >&lt;blockquote&gt;&lt;p&gt;+1 on enabling by default&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes will do in following issue after some long runs.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;We need to write a policy that keeps growing block cache while there are evictions going on (until we stop doing evictions or hit max size?)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;So this will not care what is the write load. This can be done especially when we have Combined BC and L1 contains only META blocks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; so making the META cache to a non evicting state.  In such a case we would better have to do some sort of TTL strategy also. The least recently used blocks should leave BC &lt;b&gt;themselves&lt;/b&gt; after a TTL period. (They are not at all getting used for a longer time and mostly won&apos;t get used. Might include blocks from compacted files)&lt;/p&gt;</comment>
                            <comment id="14100267" author="anoop.hbase" created="Mon, 18 Aug 2014 04:23:41 +0000"  >&lt;p&gt;Thanks Stack.  Will commit today.&lt;br/&gt;
This should go into 0.99 also. Ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14101534" author="enis" created="Mon, 18 Aug 2014 23:40:53 +0000"  >&lt;p&gt;+1. &lt;/p&gt;</comment>
                            <comment id="14102379" author="hudson" created="Tue, 19 Aug 2014 16:13:00 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #5410 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5410/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5410/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11696&quot; title=&quot;Make CombinedBlockCache resizable.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11696&quot;&gt;&lt;del&gt;HBASE-11696&lt;/del&gt;&lt;/a&gt; Make CombinedBlockCache resizable. (anoopsamjohn: rev 3c13e8f3ced049431cff1f9f2c0baa92a1ca5c24)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CombinedBlockCache.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14102439" author="hudson" created="Tue, 19 Aug 2014 16:42:33 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.0 #111 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/111/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/111/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11696&quot; title=&quot;Make CombinedBlockCache resizable.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11696&quot;&gt;&lt;del&gt;HBASE-11696&lt;/del&gt;&lt;/a&gt; Make CombinedBlockCache resizable. (anoopsamjohn: rev d502bafad2592e83672f3bbe3bae2e2fb48a19cc)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CombinedBlockCache.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14331219" author="enis" created="Sat, 21 Feb 2015 23:34:30 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12660954" name="HBASE-11696.patch" size="1116" author="anoop.hbase" created="Mon, 11 Aug 2014 09:00:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 7 Aug 2014 17:32:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410621</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yna7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>410615</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>CombinedBlockCache is made resizable. See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5349&quot; title=&quot;Automagically tweak global memstore and block cache sizes based on workload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5349&quot;&gt;&lt;strike&gt;HBASE-5349&lt;/strike&gt;&lt;/a&gt; for auto resizing feature. On resize of this block cache, the L1 cache (ie. LRU cache) will get resized</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>