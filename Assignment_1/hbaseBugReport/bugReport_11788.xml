<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:26:36 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11788/HBASE-11788.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11788] hbase is not deleting the cell when a Put with a KeyValue, KeyValue.Type.Delete is submitted</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11788</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Code executed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Test
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testHbasePutDeleteCell() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        TableName tableName = TableName.valueOf(&lt;span class=&quot;code-quote&quot;&gt;&quot;my_test&quot;&lt;/span&gt;);
        Configuration configuration = HBaseConfiguration.create();
        HTableInterface table = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTable(configuration, tableName);
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; rowKey = &lt;span class=&quot;code-quote&quot;&gt;&quot;12345&quot;&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] familly = Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-comment&quot;&gt;// put one row
&lt;/span&gt;        Put put = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Put(Bytes.toBytes(rowKey));
        put.add(familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;));
        put.add(familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;));
        put.add(familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;C&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;));
        table.put(put);
        &lt;span class=&quot;code-comment&quot;&gt;// get row back and &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; the values
&lt;/span&gt;        Get get = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Get(Bytes.toBytes(rowKey));
        Result result = table.get(get);
        Assert.isTrue(Bytes.toString(result.getValue(familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;))).equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;Column A value should be a&quot;&lt;/span&gt;);
        Assert.isTrue(Bytes.toString(result.getValue(familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;))).equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;Column B value should be b&quot;&lt;/span&gt;);
        Assert.isTrue(Bytes.toString(result.getValue(familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;C&quot;&lt;/span&gt;))).equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;c&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;Column C value should be c&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-comment&quot;&gt;// put the same row again with C column deleted
&lt;/span&gt;        put = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Put(Bytes.toBytes(rowKey));
        put.add(familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;));
        put.add(familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;));
        put.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KeyValue(Bytes.toBytes(rowKey), familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;C&quot;&lt;/span&gt;), HConstants.LATEST_TIMESTAMP, KeyValue.Type.DeleteColumn));
        table.put(put);
        &lt;span class=&quot;code-comment&quot;&gt;// get row back and &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; the values
&lt;/span&gt;        get = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Get(Bytes.toBytes(rowKey));
        result = table.get(get);
        Assert.isTrue(Bytes.toString(result.getValue(familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;A&quot;&lt;/span&gt;))).equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;Column A value should be a&quot;&lt;/span&gt;);
        Assert.isTrue(Bytes.toString(result.getValue(familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;B&quot;&lt;/span&gt;))).equals(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;), &lt;span class=&quot;code-quote&quot;&gt;&quot;Column A value should be b&quot;&lt;/span&gt;);
        Assert.isTrue(result.getValue(familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;C&quot;&lt;/span&gt;)) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;Column C should not exists&quot;&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This assertion fails, the cell is not deleted but rather the value is empty:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):029:0&amp;gt; scan &apos;my_test&apos;
ROW                                                   COLUMN+CELL                                                                                                                                                 
 12345                                                column=&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;:A, timestamp=1408473082290, value=a                                                                                                          
 12345                                                column=&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;:B, timestamp=1408473082290, value=b                                                                                                          
 12345                                                column=&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;:C, timestamp=1408473082290, value=      
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This behavior is different than previous 4.8.x Cloudera version and is currently corrupting all hive queries involving is null or is not null operators on the columns mapped to hbase&lt;/p&gt;</description>
                <environment>&lt;p&gt;Cloudera CDH 5.1.x&lt;/p&gt;</environment>
        <key id="12735419">HBASE-11788</key>
            <summary>hbase is not deleting the cell when a Put with a KeyValue, KeyValue.Type.Delete is submitted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="srikanth235">Srikanth Srungarapu</assignee>
                                    <reporter username="cristian_armaselu">Cristian Armaselu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Aug 2014 14:42:59 +0000</created>
                <updated>Sat, 21 Feb 2015 23:31:35 +0000</updated>
                            <resolved>Thu, 6 Nov 2014 23:19:42 +0000</resolved>
                                    <version>0.99.0</version>
                    <version>0.96.1.1</version>
                    <version>0.98.5</version>
                    <version>2.0.0</version>
                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.98.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>17</watches>
                                                                <comments>
                            <comment id="14104382" author="apurtell" created="Wed, 20 Aug 2014 19:16:27 +0000"  >&lt;p&gt;Here&apos;s a working unit test that reproduces the reported observation.&lt;/p&gt;</comment>
                            <comment id="14105093" author="lhofhansl" created="Thu, 21 Aug 2014 06:20:53 +0000"  >&lt;p&gt;The problem would seem to be in ProtobufUtil.toMutation(...). We set the KeyValue type according to type of Mutation passed.&lt;/p&gt;

&lt;p&gt;This is not incorrect per se as this is not really the expected use of the HBase client API. It&apos;s easy to break stuff in subtle ways doing this, from that angle the new behavior is better.&lt;/p&gt;

&lt;p&gt;That said, if it breaks Hive, let&apos;s fix it.&lt;/p&gt;</comment>
                            <comment id="14105101" author="lhofhansl" created="Thu, 21 Aug 2014 06:42:50 +0000"  >&lt;p&gt;toPut would also need to be changed to allow building a Put with delete-type KeyValue in it. Possible, but really messy.&lt;/p&gt;</comment>
                            <comment id="14105625" author="apurtell" created="Thu, 21 Aug 2014 17:19:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cristian_armaselu&quot; class=&quot;user-hover&quot; rel=&quot;cristian_armaselu&quot;&gt;Cristian Armaselu&lt;/a&gt;, please have a look at the attached unit test. The supported way to create &apos;custom&apos; delete markers is the commented out section just before the final query:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-comment&quot;&gt;// Uncomment &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; line to get the test to pass
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// table.delete(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Delete(rowKey).addDeleteMarker(marker));&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you point us to where Hive or other code is doing it differently? I think we&apos;d like to talk with the downstream project(s). &lt;/p&gt;

&lt;p&gt;What is the impact to you if we don&apos;t support deletes-in-puts in the HBase API? I.e. would you be able to patch the downstream client or successfully request your vendor do so? &lt;/p&gt;</comment>
                            <comment id="14105839" author="cristian_armaselu" created="Thu, 21 Aug 2014 19:35:54 +0000"  >&lt;p&gt;Consider 2 JVM executing the following on the same row key&lt;br/&gt;
JVM1&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;(1) Put to update new &quot;columns&quot;,&lt;/li&gt;
	&lt;li&gt;(2) Delete to remove &quot;column&quot; X value (since incoming data is null for column X)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;JVM2&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;(1) Put to update new &quot;columns&quot;,&lt;/li&gt;
	&lt;li&gt;(2) Delete to remove &quot;column&quot; Y value (since incoming data is null for column X)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;What happens if the hbase API requests are applied in this order (since 2 JVM, 2 threads of execution)&lt;br/&gt;
JVM1 (1) Put&lt;br/&gt;
JVM2 (2) Delete&lt;br/&gt;
JVM1 dies&lt;br/&gt;
JVM2 (2) Delete&lt;br/&gt;
Or you can think of any other combination with 4 operations instead of 2&lt;/p&gt;

&lt;p&gt;The data is corrupted, none of the 2 new records were applied, we don&apos;t have the previous record stored in hbase.&lt;br/&gt;
I cannot point in Hive where the issue is. I see the behavior in the queries executed against it.&lt;br/&gt;
We were using Put with DeleteColumn for null incoming cells and the &quot;is null&quot;/&quot;is not null&quot; operators in hive were running fine.&lt;br/&gt;
With the new Hbase 0.96.1.1 data is coming back from the query when it should not come back since the incoming column is null, but hbase decided to put an empty cell&lt;/p&gt;

</comment>
                            <comment id="14105878" author="apurtell" created="Thu, 21 Aug 2014 20:15:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;I cannot point in Hive where the issue is. I see the behavior in the queries executed against it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, that was my misunderstanding. I just saw in the related conversation on dev@ an indication it&apos;s your code using the HBase API directly that is bundling deletes with puts. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;(since 2 JVM, 2 threads of execution)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Assemble a Put and a Delete into a &lt;a href=&quot;https://hbase.apache.org/apidocs/org/apache/hadoop/hbase/client/RowMutations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;RowMutations&lt;/a&gt; and each Put+Delete bundle (the RowMutations) from each JVM will operate atomically with respect to the other. &lt;/p&gt;</comment>
                            <comment id="14105891" author="cristian_armaselu" created="Thu, 21 Aug 2014 20:22:48 +0000"  >&lt;p&gt;Yes but that will not work with Htable.checkAndPut&lt;/p&gt;</comment>
                            <comment id="14105902" author="srikanth235" created="Thu, 21 Aug 2014 20:25:46 +0000"  >&lt;p&gt;Can you please let me know if someone is interested in picking this up? If not, I can work on this.&lt;/p&gt;</comment>
                            <comment id="14106032" author="apurtell" created="Thu, 21 Aug 2014 22:06:14 +0000"  >&lt;p&gt;Go for it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srikanth235&quot; class=&quot;user-hover&quot; rel=&quot;srikanth235&quot;&gt;Srikanth Srungarapu&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14106066" author="apurtell" created="Thu, 21 Aug 2014 22:27:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yes but that will not work with Htable.checkAndPut&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=srikanth235&quot; class=&quot;user-hover&quot; rel=&quot;srikanth235&quot;&gt;Srikanth Srungarapu&lt;/a&gt; would you like to take &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11796&quot; title=&quot;Add client support for atomic checkAndMutate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11796&quot;&gt;&lt;del&gt;HBASE-11796&lt;/del&gt;&lt;/a&gt; in lieu of this issue? Can we close this as Fixed by that issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cristian_armaselu&quot; class=&quot;user-hover&quot; rel=&quot;cristian_armaselu&quot;&gt;Cristian Armaselu&lt;/a&gt;? &lt;/p&gt;</comment>
                            <comment id="14106107" author="srikanth235" created="Thu, 21 Aug 2014 23:04:08 +0000"  >&lt;p&gt;I&apos;m okay going with either. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cristian_armaselu&quot; class=&quot;user-hover&quot; rel=&quot;cristian_armaselu&quot;&gt;Cristian Armaselu&lt;/a&gt; Please let us know your preference.&lt;/p&gt;</comment>
                            <comment id="14106182" author="apurtell" created="Thu, 21 Aug 2014 23:50:21 +0000"  >&lt;p&gt;If it&apos;s all the same, adding the new API proposed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11796&quot; title=&quot;Add client support for atomic checkAndMutate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11796&quot;&gt;&lt;del&gt;HBASE-11796&lt;/del&gt;&lt;/a&gt; would be a lot cleaner than hacking existing put APIs to accept deletes. Otherwise why did we create RowMutations instead of giving puts the ability to carry deletes? &lt;/p&gt;</comment>
                            <comment id="14106220" author="srikanth235" created="Fri, 22 Aug 2014 00:13:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andrew.purtell%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;andrew.purtell@gmail.com&quot;&gt;Andrew Purtell&lt;/a&gt; Totally agree with you about &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11796&quot; title=&quot;Add client support for atomic checkAndMutate&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11796&quot;&gt;&lt;del&gt;HBASE-11796&lt;/del&gt;&lt;/a&gt;. I would be more than happy to work on it.&lt;/p&gt;</comment>
                            <comment id="14107135" author="cristian_armaselu" created="Fri, 22 Aug 2014 17:30:45 +0000"  >&lt;p&gt;checkAndMutate would be nice, but we also use hive to insert data. For that we apply a coprocessor (prePut) to turn the empty values inserted from hive into cell deletes (DeleteColumn). Since hive generates Puts and not Mutations, we will have still have the same issue. The old behavior was working really well. Was it changed on purpose?&lt;/p&gt;</comment>
                            <comment id="14108061" author="apurtell" created="Sat, 23 Aug 2014 17:23:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;For that we apply a coprocessor (prePut) to turn the empty values inserted from hive into cell deletes (DeleteColumn). Since hive generates Puts and not Mutations, we will have still have the same issue. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not really, your coprocessor code can be changed. &lt;/p&gt;</comment>
                            <comment id="14109163" author="cristian_armaselu" created="Mon, 25 Aug 2014 14:55:35 +0000"  >&lt;p&gt;Could you please elaborate?&lt;br/&gt;
Currently we use BaseRegionObserver which comes with the following call back:&lt;br/&gt;
public void prePut(ObserverContext&amp;lt;RegionCoprocessorEnvironment&amp;gt; e, Put put, WALEdit edit, boolean writeToWAL) throws IOException&lt;/p&gt;

&lt;p&gt;Is there other way to accomplish the complete/atomic row mutation with the coprocessor?&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="14110121" author="apurtell" created="Tue, 26 Aug 2014 01:27:20 +0000"  >&lt;p&gt;In your prePut, build a RowMutations and submit it to the region instead of synthesizing a put. Then call e.bypass() to skip further processing of the put (since you substituted a RowMutations). Hope this is workable advice, it&apos;s a bit off the cuff&lt;/p&gt;</comment>
                            <comment id="14111204" author="cristian_armaselu" created="Tue, 26 Aug 2014 19:47:19 +0000"  >&lt;p&gt;This doesn&apos;t seem to work. I got a nice stack overflow when region server started&lt;/p&gt;

&lt;p&gt;Snipped of code executed:&lt;br/&gt;
public class EmptyValueCheckObserver extends BaseRegionObserver {&lt;br/&gt;
...&lt;br/&gt;
    @Override&lt;br/&gt;
    public void prePut(ObserverContext&amp;lt;RegionCoprocessorEnvironment&amp;gt; e,&lt;br/&gt;
            Put put, WALEdit edit, Durability durability) throws IOException {&lt;br/&gt;
...&lt;br/&gt;
byte[] rowKey = put.getRow();&lt;br/&gt;
        Delete delete = new Delete(rowKey);&lt;br/&gt;
        Put overWrittenPut = new Put(rowKey);&lt;br/&gt;
        RowMutations rowMutations = new RowMutations(rowKey);&lt;br/&gt;
        rowMutations.add(delete);&lt;br/&gt;
        rowMutations.add(overWrittenPut);&lt;br/&gt;
...&lt;br/&gt;
//iterate over method parameter Put/KVs and do one of the below based on the presence or not of a value:&lt;br/&gt;
rowMutations.add(delete.addDeleteMarker(keyValue));&lt;br/&gt;
overWrittenPut.add(family, keyValue.getQualifier(), keyValue.getValue());&lt;br/&gt;
...&lt;br/&gt;
        HRegion region = e.getEnvironment().getRegion();&lt;br/&gt;
        e.bypass();&lt;br/&gt;
        region.mutateRow(rowMutations);&lt;/p&gt;

&lt;p&gt;Error:&lt;br/&gt;
...&lt;br/&gt;
        at com.epsilon.cds.hbase.observer.EmptyValueCheckObserver.prePut(EmptyValueCheckObserver.java:108)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.RegionCoprocessorHost.prePut(RegionCoprocessorHost.java:900)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MultiRowMutationProcessor.preProcess(MultiRowMutationProcessor.java:108)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.processRowsWithLocks(HRegion.java:4663)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.mutateRowsWithLocks(HRegion.java:4628)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.mutateRow(HRegion.java:4610)&lt;br/&gt;
        at com.epsilon.cds.hbase.observer.EmptyValueCheckObserver.prePut(EmptyValueCheckObserver.java:108)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.RegionCoprocessorHost.prePut(RegionCoprocessorHost.java:900)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MultiRowMutationProcessor.preProcess(MultiRowMutationProcessor.java:108)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.processRowsWithLocks(HRegion.java:4663)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.mutateRowsWithLocks(HRegion.java:4628)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.mutateRow(HRegion.java:4610)&lt;br/&gt;
        at com.epsilon.cds.hbase.observer.EmptyValueCheckObserver.prePut(EmptyValueCheckObserver.java:108)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.RegionCoprocessorHost.prePut(RegionCoprocessorHost.java:900)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MultiRowMutationProcessor.preProcess(MultiRowMutationProcessor.java:108)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.processRowsWithLocks(HRegion.java:4663)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.mutateRowsWithLocks(HRegion.java:4628)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.mutateRow(HRegion.java:4610)&lt;br/&gt;
        at com.epsilon.cds.hbase.observer.EmptyValueCheckObserver.prePut(EmptyValueCheckObserver.java:108)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.RegionCoprocessorHost.prePut(RegionCoprocessorHost.java:900)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MultiRowMutationProcessor.preProcess(MultiRowMutationProcessor.java:108)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.processRowsWithLocks(HRegion.java:4663)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.mutateRowsWithLocks(HRegion.java:4628)&lt;br/&gt;
: 1 time,&lt;br/&gt;
        at org.apache.hadoop.hbase.client.AsyncProcess$BatchErrors.makeException(AsyncProcess.java:187)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.AsyncProcess$BatchErrors.access$500(AsyncProcess.java:171)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.AsyncProcess.getErrors(AsyncProcess.java:882)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HTable.backgroundFlushCommits(HTable.java:940)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HTable.flushCommits(HTable.java:1197)&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HTable.put(HTable.java:866)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.MetaEditor.put(MetaEditor.java:126)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.MetaEditor.putToCatalogTable(MetaEditor.java:116)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.MetaEditor.updateLocation(MetaEditor.java:463)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.MetaEditor.updateRegionLocation(MetaEditor.java:442)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.postOpenDeployTasks(HRegionServer.java:1710)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler$PostOpenDeployTasksThread.run(OpenRegionHandler.java:335)&lt;/p&gt;

</comment>
                            <comment id="14111212" author="srikanth235" created="Tue, 26 Aug 2014 19:51:10 +0000"  >&lt;p&gt;Created and attaching the patch for this jira just in case. &lt;/p&gt;</comment>
                            <comment id="14111293" author="jxiang" created="Tue, 26 Aug 2014 20:40:39 +0000"  >&lt;p&gt;The patch looks good. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cristian_armaselu&quot; class=&quot;user-hover&quot; rel=&quot;cristian_armaselu&quot;&gt;Cristian Armaselu&lt;/a&gt;, is it work for you? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;, what do you think?&lt;/p&gt;</comment>
                            <comment id="14111317" author="yuzhihong@gmail.com" created="Tue, 26 Aug 2014 20:53:49 +0000"  >&lt;p&gt;TestPutWithDelete passes with patch.&lt;br/&gt;
Minor:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
              put.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KeyValue(proto.getRow().toByteArray(), family, qual, ts, fromDeleteType(qv.getDeleteType()), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, tags));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Wrap long lines (two occurrences)&lt;/p&gt;</comment>
                            <comment id="14111374" author="lhofhansl" created="Tue, 26 Aug 2014 21:32:32 +0000"  >&lt;p&gt;Quite nasty... But I guess that is what it has to be.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14111734" author="hadoopqa" created="Wed, 27 Aug 2014 01:50:07 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12664460/HBASE-11788-master.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12664460/HBASE-11788-master.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12664460&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +              put.add(new KeyValue(proto.getRow().toByteArray(), family, qual, ts, fromDeleteType(qv.getDeleteType()), null, tags));&lt;br/&gt;
+              put.add(new KeyValue(proto.getRow().toByteArray(), family, qual, ts, fromDeleteType(qv.getDeleteType())));&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelsWithDeletes&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestEndToEndSplitTransaction&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 5 zombie test(s): 	at org.apache.hadoop.hbase.util.TestHBaseFsck.testSplitDaughtersNotInMeta(TestHBaseFsck.java:1621)&lt;br/&gt;
	at org.apache.hadoop.hbase.mapreduce.TestMultithreadedTableMapper.testMultithreadedTableMapper(TestMultithreadedTableMapper.java:125)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10600//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14111744" author="srikanth235" created="Wed, 27 Aug 2014 02:08:12 +0000"  >&lt;p&gt;The two tests TestVisibilityLabelsWithDeletes and TestEndToEndSplitTransaction are passing on my machine. Attaching the patch to address the ling length issue.&lt;/p&gt;</comment>
                            <comment id="14111800" author="hadoopqa" created="Wed, 27 Aug 2014 03:47:42 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12664547/HBASE-11788-master_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12664547/HBASE-11788-master_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12664547&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10602//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14112404" author="jxiang" created="Wed, 27 Aug 2014 16:30:26 +0000"  >&lt;p&gt;Integrated the patch into 0.98, branch 1, and master. Thanks everyone.&lt;/p&gt;</comment>
                            <comment id="14112488" author="hudson" created="Wed, 27 Aug 2014 17:23:27 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #451 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/451/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/451/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11788&quot; title=&quot;hbase is not deleting the cell when a Put with a KeyValue, KeyValue.Type.Delete is submitted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11788&quot;&gt;&lt;del&gt;HBASE-11788&lt;/del&gt;&lt;/a&gt; HBase is not deleting the cell when a Put with a KeyValue, KeyValue.Type.Delete is submitted (jxiang: rev 17b21652d48e291a2313c4a112f8699dc1ddd94c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestPutWithDelete.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/protobuf/ProtobufUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14112545" author="hudson" created="Wed, 27 Aug 2014 17:55:40 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5438 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5438/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5438/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11788&quot; title=&quot;hbase is not deleting the cell when a Put with a KeyValue, KeyValue.Type.Delete is submitted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11788&quot;&gt;&lt;del&gt;HBASE-11788&lt;/del&gt;&lt;/a&gt; HBase is not deleting the cell when a Put with a KeyValue, KeyValue.Type.Delete is submitted (jxiang: rev 57328e112144bd657c01c33d5e3cb2d69bb7e464)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/protobuf/ProtobufUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestPutWithDelete.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14112588" author="hudson" created="Wed, 27 Aug 2014 18:15:34 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #477 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/477/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/477/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11788&quot; title=&quot;hbase is not deleting the cell when a Put with a KeyValue, KeyValue.Type.Delete is submitted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11788&quot;&gt;&lt;del&gt;HBASE-11788&lt;/del&gt;&lt;/a&gt; HBase is not deleting the cell when a Put with a KeyValue, KeyValue.Type.Delete is submitted (jxiang: rev 17b21652d48e291a2313c4a112f8699dc1ddd94c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestPutWithDelete.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/protobuf/ProtobufUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14112635" author="hudson" created="Wed, 27 Aug 2014 18:53:03 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.0 #130 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/130/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/130/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11788&quot; title=&quot;hbase is not deleting the cell when a Put with a KeyValue, KeyValue.Type.Delete is submitted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11788&quot;&gt;&lt;del&gt;HBASE-11788&lt;/del&gt;&lt;/a&gt; HBase is not deleting the cell when a Put with a KeyValue, KeyValue.Type.Delete is submitted (jxiang: rev 095a0e9aa2e8d007749de92bdfa8a2932ef81c2b)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestPutWithDelete.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/protobuf/ProtobufUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14112723" author="apurtell" created="Wed, 27 Aug 2014 19:51:41 +0000"  >&lt;p&gt;Belated +1, looks necessary. Thanks for the indulgence &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cristian_armaselu&quot; class=&quot;user-hover&quot; rel=&quot;cristian_armaselu&quot;&gt;Cristian Armaselu&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14113656" author="anoop.hbase" created="Thu, 28 Aug 2014 10:56:19 +0000"  >&lt;p&gt;So if I create and execute below&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Put put = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Put(Bytes.toBytes(rowKey));
put.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KeyValue(Bytes.toBytes(rowKey), familly, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;C&quot;&lt;/span&gt;), HConstants.LATEST_TIMESTAMP, KeyValue.Type.DeleteColumn));
table.put(put);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It will do actually a delete opertion. But it will be calling the CP hooks for put (pre/postPut) and will update the put related metric &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Also when it is a delete type and TS is LATEST_TIMESTAMP, we update the TS at RS to avoid the delete marker hiding the future puts, that part also wont happen now?&lt;/p&gt;</comment>
                            <comment id="14114303" author="lhofhansl" created="Thu, 28 Aug 2014 20:37:30 +0000"  >&lt;p&gt;Right. It is very nasty. If somebody does this and doesn&apos;t know what they&apos;re doing they&apos;re on their own, I&apos;d say.&lt;/p&gt;</comment>
                            <comment id="14114342" author="apurtell" created="Thu, 28 Aug 2014 21:03:37 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Anoop&amp;#93;&lt;/span&gt; Also when it is a delete type and TS is LATEST_TIMESTAMP, we update the TS at RS to avoid the delete marker hiding the future puts, that part also wont happen now?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Lars&amp;#93;&lt;/span&gt; Right. It is very nasty. If somebody does this and doesn&apos;t know what they&apos;re doing they&apos;re on their own, I&apos;d say.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree, but we could do an additional minor improvement to adjust the timestamp on any Delete found in a Put with TS as LATEST_TIMESTAMP. That&apos;s not unreasonable. &lt;/p&gt;</comment>
                            <comment id="14114862" author="anoop.hbase" created="Fri, 29 Aug 2014 04:54:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;but we could do an additional minor improvement to adjust the timestamp on any Delete found in a Put with TS as LATEST_TIMESTAMP&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;True. We can see it can be done in a not so hacky way. If we can that will be better. The attached test in the issue description itself is using LATEST_TIMESTAMP ts. Once you do such a delete, you will not be able to Put a same rk:cf:q cell.&lt;/p&gt;</comment>
                            <comment id="14115457" author="jxiang" created="Fri, 29 Aug 2014 16:51:44 +0000"  >&lt;p&gt;It&apos;s hacky. Probably it is not expected the API to be used this way. Should we ignore the ts if it is set to LATEST_TIMESTAMP?&lt;/p&gt;</comment>
                            <comment id="14115497" author="jxiang" created="Fri, 29 Aug 2014 17:11:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;Once you do such a delete, you will not be able to Put a same rk:cf:q cell.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;With Delete, you can specify the ts to be LATEST_TIMESTAMP, right? After such a delete, will you be able to do Put to the same cell?&lt;/p&gt;</comment>
                            <comment id="14115548" author="anoop.hbase" created="Fri, 29 Aug 2014 17:43:59 +0000"  >&lt;p&gt;I mean the delete version case.  But seems not much of issue like mark &lt;b&gt;all&lt;/b&gt; future Puts. Becuase we treat the cell as Put type and update the latest TS with current RS time. So only issue is it might not delete the version intended. But might delete a future version (If an immediate put or put with same TS)&lt;/p&gt;</comment>
                            <comment id="14201073" author="vbora" created="Thu, 6 Nov 2014 22:27:36 +0000"  >&lt;p&gt;Deleteing the columns after delete marker&lt;/p&gt;</comment>
                            <comment id="14201108" author="srikanth235" created="Thu, 6 Nov 2014 22:46:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vbora&quot; class=&quot;user-hover&quot; rel=&quot;vbora&quot;&gt;sri venu bora&lt;/a&gt; Which version did you use for verifying the fix? &lt;/p&gt;</comment>
                            <comment id="14201153" author="vbora" created="Thu, 6 Nov 2014 23:05:35 +0000"  >&lt;p&gt;I tested it with the new patch which we got for this fix. we have few columns after the DeleteColumn Marker in the put. All the columns after the DeleteColumn Marker are getting deleted. &lt;/p&gt;

&lt;p&gt;I looked at the code and i  see in the ProtoBufUtil.toMutation(final MutationType type, final Mutation mutation, MutationProto.Builder builder, long nonce) &lt;/p&gt;

&lt;p&gt;QualifierValue.Builder valueBuilder = QualifierValue.newBuilder(); at line number 1110 should be inside the inner for loop at 1115. Otherwise valueBuilder is carrying over the previous values that where set. In this case the DeleteType is getting carried over to the next columns and deleting all the columns. Attached the testcase to the defect.Could you please reopen the defect.&lt;/p&gt;</comment>
                            <comment id="14201158" author="vbora" created="Thu, 6 Nov 2014 23:06:48 +0000"  >&lt;p&gt;Updated the test case.Added a column after the DeleteColumn Marker and asserted that column added should exists&lt;/p&gt;</comment>
                            <comment id="14201178" author="vbora" created="Thu, 6 Nov 2014 23:18:44 +0000"  >&lt;p&gt;we tested on a patch given by cloudera on top of 0.98.1&lt;/p&gt;</comment>
                            <comment id="14201181" author="apurtell" created="Thu, 6 Nov 2014 23:19:42 +0000"  >&lt;p&gt;Actually I&apos;m going to re-resolve. This went out in a release. We will need a new issue to address the issue raised above with fix version set to next unreleased version.&lt;/p&gt;</comment>
                            <comment id="14202823" author="vbora" created="Fri, 7 Nov 2014 22:22:38 +0000"  >&lt;p&gt;Andrew,&lt;br/&gt;
Created a new issue for this and linked to this bug.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12445&quot; title=&quot;hbase is removing all remaining cells immediately after the cell marked with marker = KeyValue.Type.DeleteColumn via PUT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12445&quot;&gt;&lt;del&gt;HBASE-12445&lt;/del&gt;&lt;/a&gt; hbase is removing all remaining cells immediately after the cell marked with marker = KeyValue.Type.DeleteColumn via PUT.&lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
Sri Bora&lt;/p&gt;</comment>
                            <comment id="14330844" author="enis" created="Sat, 21 Feb 2015 23:31:35 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12753834">HBASE-12445</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12735856">HBASE-11796</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12664460" name="HBASE-11788-master.patch" size="10085" author="srikanth235" created="Tue, 26 Aug 2014 19:51:10 +0000"/>
                            <attachment id="12664547" name="HBASE-11788-master_v2.patch" size="10122" author="srikanth235" created="Wed, 27 Aug 2014 02:08:12 +0000"/>
                            <attachment id="12679988" name="TestPutAfterDeleteColumn.java" size="4311" author="vbora" created="Thu, 6 Nov 2014 23:09:41 +0000"/>
                            <attachment id="12663193" name="TestPutWithDelete.java" size="3921" author="apurtell" created="Wed, 20 Aug 2014 19:16:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 20 Aug 2014 19:16:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1z4sf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>