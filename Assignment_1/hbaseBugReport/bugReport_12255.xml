<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:31:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12255/HBASE-12255.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12255] NPE in OpenRegionHandler after restart hdfs without stop hbase</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12255</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I have a phoenix table &apos;EVENT&apos;, and the table have a index &apos;IDX_DATE_HOUR_X&apos;.&lt;br/&gt;
I restarted hdfs without stop hbase, after then, the hbase table cann&apos;t be scaned.&lt;br/&gt;
I try to restart hbase, the all hbase table still cann&apos;t be scaned.&lt;br/&gt;
the regionserver log have many exception like this:&lt;/p&gt;

&lt;p&gt;2014-10-13 19:33:05,287 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;A01101303447-V1,60020,1413199890407-recovery-writer--pool4-t3&amp;#93;&lt;/span&gt; client.AsyncProcess: #4, waiting for some tasks to finish. Expected max=0, tasksSent=9, tasksDone=8, currentTasksDone=8, retries=8 hasError=fal&lt;br/&gt;
se, tableName=IDX_DATE_HOUR_X&lt;br/&gt;
2014-10-13 19:33:05,298 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;A01101303447-V1,60020,1413199890407-recovery-writer--pool4-t2&amp;#93;&lt;/span&gt; client.AsyncProcess: #5, waiting for some tasks to finish. Expected max=0, tasksSent=9, tasksDone=8, currentTasksDone=8, retries=8 hasError=fal&lt;br/&gt;
se, tableName=IDX_DATE_HOUR_X&lt;br/&gt;
2014-10-13 19:33:05,311 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;A01101303447-V1,60020,1413199890407-recovery-writer--pool4-t1&amp;#93;&lt;/span&gt; client.AsyncProcess: #6, waiting for some tasks to finish. Expected max=0, tasksSent=9, tasksDone=8, currentTasksDone=8, retries=8 hasError=fal&lt;br/&gt;
se, tableName=IDX_DATE_HOUR_X&lt;br/&gt;
2014-10-13 19:33:06,452 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;ReplicationExecutor-0&amp;#93;&lt;/span&gt; replication.ReplicationQueuesZKImpl: Moving A01101303447-V1,60020,1413199414409&apos;s hlogs to my queue&lt;br/&gt;
2014-10-13 19:33:15,325 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;A01101303447-V1,60020,1413199890407-recovery-writer--pool4-t1&amp;#93;&lt;/span&gt; client.AsyncProcess: #6, waiting for some tasks to finish. Expected max=0, tasksSent=10, tasksDone=9, currentTasksDone=9, retries=9 hasError=fa&lt;br/&gt;
lse, tableName=IDX_DATE_HOUR_X&lt;br/&gt;
2014-10-13 19:33:15,333 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;htable-pool6-t2&amp;#93;&lt;/span&gt; client.AsyncProcess: #6, table=IDX_DATE_HOUR_X, attempt=10/350 failed 12 ops, last exception: org.apache.hadoop.hbase.exceptions.RegionOpeningException: org.apache.hadoop.hbase.exceptions.R&lt;br/&gt;
egionOpeningException: Region IDX_DATE_HOUR_X,t\x00\x00\x00\x00\x00,1413186874829.9a92abb84768b129df3faedb877f7bea. is opening on A01101303447-V1,60020,1413199890407&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegionByEncodedName(HRegionServer.java:2759)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:4213)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.multi(HRegionServer.java:3437)&lt;br/&gt;
        at org.apache.hadoop.hbase.protobuf.generated.ClientProtos$ClientService$2.callBlockingMethod(ClientProtos.java:29593)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2027)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:108)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.RpcExecutor.consumerLoop(RpcExecutor.java:114)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.RpcExecutor$1.run(RpcExecutor.java:94)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:744)&lt;/p&gt;



&lt;p&gt;-------------------------------&lt;br/&gt;
After two days&apos;s try, i found that:&lt;br/&gt;
If idisable &apos;EVENT&apos;, other tables can be scanned, then i enable &apos;EVENT&apos; manually, the region log show that NullPointExceptin has occur then replaying WAL, the following is log:&lt;/p&gt;

&lt;p&gt;2014-10-13 19:25:21,043 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-A01101303447-V1:60020-1&amp;#93;&lt;/span&gt; regionserver.HRegion: Replaying edits from hdfs://localhost/hbase-0.98/data/default/EVENT/def4a581d4ad963cbb8cad32cbfbab2e/recovered.edits/0000000000000000002&lt;br/&gt;
2014-10-13 19:25:21,048 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;A01101303447-V1,60020,1413199414409-recovery-writer--pool17-t2-SendThread(localhost:2182)&amp;#93;&lt;/span&gt; zookeeper.ClientCnxn: Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2182. Will not attempt to authe&lt;br/&gt;
nticate using SASL (unknown error)&lt;br/&gt;
2014-10-13 19:25:21,049 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;A01101303447-V1,60020,1413199414409-recovery-writer--pool17-t2-SendThread(localhost:2182)&amp;#93;&lt;/span&gt; zookeeper.ClientCnxn: Socket connection established to localhost/0:0:0:0:0:0:0:1:2182, initiating session&lt;br/&gt;
2014-10-13 19:25:21,051 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;A01101303447-V1,60020,1413199414409-recovery-writer--pool17-t3&amp;#93;&lt;/span&gt; zookeeper.RecoverableZooKeeper: Process identifier=hconnection-0x199c8484 connecting to ZooKeeper ensemble=localhost:2182&lt;br/&gt;
2014-10-13 19:25:21,051 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;A01101303447-V1,60020,1413199414409-recovery-writer--pool17-t3&amp;#93;&lt;/span&gt; zookeeper.ZooKeeper: Initiating client connection, connectString=localhost:2182 sessionTimeout=90000 watcher=hconnection-0x199c8484, quorum=lo&lt;br/&gt;
calhost:2182, baseZNode=/hbase&lt;br/&gt;
2014-10-13 19:25:21,052 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;A01101303447-V1,60020,1413199414409-recovery-writer--pool17-t3-SendThread(localhost:2182)&amp;#93;&lt;/span&gt; zookeeper.ClientCnxn: Opening socket connection to server localhost/0:0:0:0:0:0:0:1:2182. Will not attempt to authe&lt;br/&gt;
nticate using SASL (unknown error)&lt;br/&gt;
2014-10-13 19:25:21,052 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;A01101303447-V1,60020,1413199414409-recovery-writer--pool17-t3-SendThread(localhost:2182)&amp;#93;&lt;/span&gt; zookeeper.ClientCnxn: Socket connection established to localhost/0:0:0:0:0:0:0:1:2182, initiating session&lt;br/&gt;
2014-10-13 19:25:21,053 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;A01101303447-V1,60020,1413199414409-recovery-writer--pool17-t2-SendThread(localhost:2182)&amp;#93;&lt;/span&gt; zookeeper.ClientCnxn: Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2182, sessionid = 0x149093&lt;br/&gt;
fc1c80203, negotiated timeout = 90000&lt;br/&gt;
2014-10-13 19:25:21,055 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;A01101303447-V1,60020,1413199414409-recovery-writer--pool17-t3-SendThread(localhost:2182)&amp;#93;&lt;/span&gt; zookeeper.ClientCnxn: Session establishment complete on server localhost/0:0:0:0:0:0:0:1:2182, sessionid = 0x149093&lt;br/&gt;
fc1c80204, negotiated timeout = 90000&lt;br/&gt;
2014-10-13 19:25:21,103 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-A01101303447-V1:60020-1&amp;#93;&lt;/span&gt; handler.OpenRegionHandler: Failed open of region=EVENT,\x18,1413186838852.def4a581d4ad963cbb8cad32cbfbab2e., starting to roll back the global memstore size.&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
2014-10-13 19:25:21,104 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-A01101303447-V1:60020-1&amp;#93;&lt;/span&gt; handler.OpenRegionHandler: Opening of region &lt;/p&gt;
{ENCODED =&amp;gt; def4a581d4ad963cbb8cad32cbfbab2e, NAME =&amp;gt; &apos;EVENT,\x18,1413186838852.def4a581d4ad963cbb8cad32cbfbab2e.&apos;, START
KEY =&amp;gt; &apos;\x18&apos;, ENDKEY =&amp;gt; &apos;\x19&apos;}
&lt;p&gt; failed, transitioning from OPENING to FAILED_OPEN in ZK, expecting version 28&lt;br/&gt;
2014-10-13 19:25:21,104 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-A01101303447-V1:60020-1&amp;#93;&lt;/span&gt; zookeeper.ZKAssign: regionserver:60020-0x149093fc1c80001, quorum=localhost:2182, baseZNode=/hbase Transitioning def4a581d4ad963cbb8cad32cbfbab2e from RS_ZK_REGION_OPE&lt;br/&gt;
NING to RS_ZK_REGION_FAILED_OPEN&lt;br/&gt;
2014-10-13 19:25:21,107 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-A01101303447-V1:60020-1&amp;#93;&lt;/span&gt; zookeeper.ZKAssign: regionserver:60020-0x149093fc1c80001, quorum=localhost:2182, baseZNode=/hbase Transitioned node def4a581d4ad963cbb8cad32cbfbab2e from RS_ZK_REGION&lt;br/&gt;
_OPENING to RS_ZK_REGION_FAILED_OPEN&lt;br/&gt;
2014-10-13 19:25:21,108 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-A01101303447-V1:60020-2&amp;#93;&lt;/span&gt; handler.OpenRegionHandler: Failed open of region=EVENT,\x15,1413186838852.4592fbc9db5e6eb05c812dcd81f5fa4d., starting to roll back the global memstore size.&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
2014-10-13 19:25:21,108 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-A01101303447-V1:60020-2&amp;#93;&lt;/span&gt; handler.OpenRegionHandler: Opening of region &lt;/p&gt;
{ENCODED =&amp;gt; 4592fbc9db5e6eb05c812dcd81f5fa4d, NAME =&amp;gt; &apos;EVENT,\x15,1413186838852.4592fbc9db5e6eb05c812dcd81f5fa4d.&apos;, START
KEY =&amp;gt; &apos;\x15&apos;, ENDKEY =&amp;gt; &apos;\x16&apos;}
&lt;p&gt; failed, transitioning from OPENING to FAILED_OPEN in ZK, expecting version 28&lt;br/&gt;
2014-10-13 19:25:21,108 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-A01101303447-V1:60020-2&amp;#93;&lt;/span&gt; zookeeper.ZKAssign: regionserver:60020-0x149093fc1c80001, quorum=localhost:2182, baseZNode=/hbase Transitioning 4592fbc9db5e6eb05c812dcd81f5fa4d from RS_ZK_REGION_OPE&lt;br/&gt;
NING to RS_ZK_REGION_FAILED_OPEN&lt;br/&gt;
2014-10-13 19:25:21,111 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-A01101303447-V1:60020-2&amp;#93;&lt;/span&gt; zookeeper.ZKAssign: regionserver:60020-0x149093fc1c80001, quorum=localhost:2182, baseZNode=/hbase Transitioned node 4592fbc9db5e6eb05c812dcd81f5fa4d from RS_ZK_REGION&lt;br/&gt;
_OPENING to RS_ZK_REGION_FAILED_OPEN&lt;br/&gt;
2014-10-13 19:25:21,113 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-A01101303447-V1:60020-0&amp;#93;&lt;/span&gt; handler.OpenRegionHandler: Failed open of region=EVENT,\x1B,1413186838852.b45c35d23b23fda5643ec5d79083488e., starting to roll back the global memstore size.&lt;br/&gt;
java.lang.NullPointerException&lt;/p&gt;



&lt;p&gt; After deleteing the &apos;recovered.edits&apos; in the &apos;EVENT&apos; table&apos;s region, the hbase table can be scanned. so i think the reason maybe that:&lt;br/&gt;
after restart hbase, the regionserver begin opening the region and replaying WAL, when replaying the EVENT&apos;s WAL, because EVENT has a index table IDX_DATE_HOUR_X, so the replay process should operate IDX_DATE_HOUR_X, but at this moment, the IDX_DATE_HOUR_X table&apos;s region is in OPENING stats, it is&apos;t unavaiabled, so the EVENT replaying process Time and time again to retry and throw Exception aging and again.&lt;/p&gt;

&lt;p&gt;if I disable EVENT first, others hbase table recory successfully, but when i enable EVENT, the region log occur java.lang.NullPointerException, this make the region transition to OPEN_FAILED.&lt;/p&gt;</description>
                <environment>&lt;p&gt;hadoop-2.5.1&lt;br/&gt;
hbase-0.98&lt;br/&gt;
phonenix-4.1.0&lt;/p&gt;</environment>
        <key id="12747917">HBASE-12255</key>
            <summary>NPE in OpenRegionHandler after restart hdfs without stop hbase</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lijy83">Junyong Li</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Oct 2014 03:04:54 +0000</created>
                <updated>Wed, 15 Oct 2014 09:01:43 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14171047" author="apurtell" created="Tue, 14 Oct 2014 15:09:32 +0000"  >&lt;p&gt;This looks like an HBase bug, so I moved it to the HBase project. &lt;/p&gt;

&lt;p&gt;By any chance is a complete stacktrace for those NullPointerExceptions logged? Can you provide it here?&lt;/p&gt;</comment>
                            <comment id="14172161" author="lijy83" created="Wed, 15 Oct 2014 09:01:43 +0000"  >&lt;p&gt;The log only has a single line java.lang.NullPointerException, no more than stacktrace&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 14 Oct 2014 15:09:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 9 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i214v3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>