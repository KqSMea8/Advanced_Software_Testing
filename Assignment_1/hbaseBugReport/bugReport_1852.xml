<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:56:55 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1852/HBASE-1852.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1852] HConnectionManager.testTableOnlineState will get into infinite loop if more than one .META. region</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1852</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Create 3 tables (preferably on a clean cluster to avoid other potential issues)&lt;br/&gt;
Split .META.&lt;br/&gt;
From the master web inteface try to click on the first table - the page will not load and refreshing the main page will show lots of requests. &lt;/p&gt;

&lt;p&gt;HBaseAdmin.testTableOnlineState will get into an infinite loop if .META. has more than one region. This method should probably use a regular scanner and an iterator. &lt;/p&gt;

&lt;p&gt;I guess this issue would also happen with a single .META. region if rrs = getRegionServerWithRetries(s) would get an UnknownScannerException (from a scanner lease expiration on the region server), but I haven&apos;t double checked this.&lt;/p&gt;

&lt;p&gt;I attached a java method that you can use as a reference to reproduce the behavior. However, since it calls split() on .META. and that is async, you might have to run it twice and check that .META. actually splitted before getting into the infinite loop. &lt;/p&gt;</description>
                <environment>&lt;p&gt;OSX/Linux&lt;/p&gt;</environment>
        <key id="12436080">HBASE-1852</key>
            <summary>HConnectionManager.testTableOnlineState will get into infinite loop if more than one .META. region</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="7">Later</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="clehene">Cosmin Lehene</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Sep 2009 17:34:57 +0000</created>
                <updated>Wed, 24 Dec 2014 19:43:08 +0000</updated>
                            <resolved>Wed, 24 Dec 2014 19:43:08 +0000</resolved>
                                    <version>0.20.0</version>
                                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                    <timeoriginalestimate seconds="86400">24h</timeoriginalestimate>
                            <timeestimate seconds="86400">24h</timeestimate>
                                        <comments>
                            <comment id="12757280" author="clehene" created="Fri, 18 Sep 2009 17:37:27 +0000"  >&lt;p&gt;This can be used as a reference to reproduce the behavior. &lt;/p&gt;</comment>
                            <comment id="12757282" author="clehene" created="Fri, 18 Sep 2009 17:39:32 +0000"  >&lt;p&gt;replace the testTableOnlineState implementation in HConnectionManager with a regular scanner + iterator. &lt;/p&gt;</comment>
                            <comment id="12757316" author="streamy" created="Fri, 18 Sep 2009 18:23:18 +0000"  >&lt;p&gt;Unit test that reproduces something, not sure what.  I&apos;m actually able to perform Gets on all the tables, but checking if they are enabled doesn&apos;t work.&lt;/p&gt;

&lt;p&gt;Also, it seems that META always puts everything in the bottom half, so the top region is actually empty.  Unit test creates 5 tables, then splits META, all 5 entries go to second META region.&lt;/p&gt;</comment>
                            <comment id="12757482" author="stack" created="Fri, 18 Sep 2009 22:12:18 +0000"  >&lt;p&gt;@cosmine&lt;/p&gt;

&lt;p&gt;Oh, weird.  HCM has an HTable (if only for a .META. table).&lt;/p&gt;

&lt;p&gt;Should use the define for .META. table name from HConstants.&lt;/p&gt;

&lt;p&gt;The Scan should be be set up to only get HConstants.CATALOG_FAMILY,  HConstants.REGIONINFO_QUALIFIER, rather than ask for all on the row and then extract the wanted column from the Result client-side.&lt;/p&gt;

&lt;p&gt;Why not close of the scanner in a finally clause?&lt;/p&gt;

&lt;p&gt;Do all tests pass?  If so, then this maybe the way to go (I&apos;m in favor of moving to HTable everywhere we have an HCM inside in servers currently though this is a different spin on it... an HTable has an HCM and in the HCM is an HTable ...).&lt;/p&gt;

&lt;p&gt;(@jgray, you are fast at writing code).&lt;/p&gt;

</comment>
                            <comment id="12758283" author="clehene" created="Tue, 22 Sep 2009 16:18:32 +0000"  >&lt;p&gt;Attaching new patch.&lt;/p&gt;

&lt;p&gt;Use the define for .META. table name from HConstants.&lt;br/&gt;
Close scanner in final clause&lt;/p&gt;

&lt;p&gt;The previous scanner was already set up to only get HConstants.CATALOG_FAMILY, HConstants.REGIONINFO_QUALIFIER&lt;/p&gt;</comment>
                            <comment id="12758294" author="stack" created="Tue, 22 Sep 2009 16:44:52 +0000"  >&lt;p&gt;I&apos;m trying the patch now.  It looks good.  Cosmin, what you think of Jon&apos;s test?&lt;/p&gt;</comment>
                            <comment id="12758318" author="stack" created="Tue, 22 Sep 2009 17:48:28 +0000"  >&lt;p&gt;So, all unit tests pass and test looks good.&lt;/p&gt;

&lt;p&gt;@Jon, I was going to apply Cosmin&apos;s patch but not your test?&lt;/p&gt;</comment>
                            <comment id="12758384" author="streamy" created="Tue, 22 Sep 2009 19:27:05 +0000"  >&lt;p&gt;Does that test pass w/ the patch in?  Should figure a way to get a test in there if possible?&lt;/p&gt;</comment>
                            <comment id="12758391" author="stack" created="Tue, 22 Sep 2009 19:43:28 +0000"  >&lt;p&gt;Maybe we should just punt this out of 0.20.1.  Sounds like Cosmin still has issues when splitting a .META.  Lets allow that 0.20.1 doesn&apos;t have to have a fix for more than on region in .META. table (you ok w/ that cosmin?) and fix it properly in 0.21?  In fact, let me move this out.  Cosmin, if you think it belongs in 0.20.1... move it back in again.&lt;/p&gt;</comment>
                            <comment id="12758392" author="streamy" created="Tue, 22 Sep 2009 19:47:50 +0000"  >&lt;p&gt;I&apos;m +1 for fixing split META in 0.21... It needs to include a solid set of tests and these kinds of tests are a good candidate for our new, fast unit tests yet to be implemented &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12758412" author="clehene" created="Tue, 22 Sep 2009 20:18:58 +0000"  >&lt;p&gt;+1&lt;br/&gt;
I&apos;m fine with it on 0.21. I believe there are other issues with .META. split as well. Either way you need a few petabytes of data to require a .META. split so we should be fine for now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="12854298" author="tlipcon" created="Wed, 7 Apr 2010 02:25:48 +0000"  >&lt;p&gt;I saw this behavior in a stress test just now as well on tip of 20.&lt;/p&gt;

&lt;p&gt;Since we know meta splitting doesn&apos;t work, can we put in some code that allows META&apos;s one region to grow without bound regardless of its size?&lt;/p&gt;</comment>
                            <comment id="12854394" author="clehene" created="Wed, 7 Apr 2010 09:08:35 +0000"  >&lt;p&gt;I think the meta split is patched and working on our branch - so I believe this patch was fine. We can retest this. &lt;/p&gt;</comment>
                            <comment id="12854550" author="tlipcon" created="Wed, 7 Apr 2010 15:16:26 +0000"  >&lt;p&gt;I am happy to try it too, but here&apos;s a question: do you really need splittable meta in 20? I think unless someone has a pressing need for it we should leave it out and make it happen for 21.&lt;/p&gt;</comment>
                            <comment id="12854558" author="clehene" created="Wed, 7 Apr 2010 15:43:40 +0000"  >&lt;p&gt;I was also talking about 0.21. I don&apos;t think we&apos;d need it too soon - you need a lot of data to pass over a single region in .META.&lt;br/&gt;
It&apos;s just that someone might press the split button once... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="12854563" author="tlipcon" created="Wed, 7 Apr 2010 15:49:49 +0000"  >&lt;p&gt;Sounds good &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I also have been doing stability testing with a config that encourages lots of splits, so I ran into this there. &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2415&quot; title=&quot;Disable META splitting in 0.20&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2415&quot;&gt;&lt;del&gt;HBASE-2415&lt;/del&gt;&lt;/a&gt; has a patch to disable meta splitting entirely for 20&lt;/p&gt;</comment>
                            <comment id="12866975" author="stack" created="Thu, 13 May 2010 04:40:53 +0000"  >&lt;p&gt;Moved from 0.21 to 0.22 just after merge of old 0.20 branch into TRUNK.&lt;/p&gt;</comment>
                            <comment id="13047608" author="stack" created="Fri, 10 Jun 2011 22:46:03 +0000"  >&lt;p&gt;Moving out of 0.92.0. Pull it back in if you think different.&lt;/p&gt;</comment>
                            <comment id="14258484" author="apurtell" created="Wed, 24 Dec 2014 19:43:08 +0000"  >&lt;p&gt;I&apos;m not sure if the current code will behave the same way as code vintage of this issue, but suspect several issues with multi-region META. In any case, should we decide to support multi-region META that work and related issues should be captured by a fresh issue. Resolving this as Later&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12420279" name="0001-Fixed-.META.-split-bug-v2.patch" size="3230" author="clehene" created="Tue, 22 Sep 2009 16:18:32 +0000"/>
                            <attachment id="12420054" name="0001-Fixed-.META.-split-bug.patch" size="3296" author="clehene" created="Fri, 18 Sep 2009 17:39:32 +0000"/>
                            <attachment id="12420058" name="HBASE-1852-unittest1.patch" size="4460" author="streamy" created="Fri, 18 Sep 2009 18:23:18 +0000"/>
                            <attachment id="12420053" name="HBaseMetaSplitIssues.java" size="1249" author="clehene" created="Fri, 18 Sep 2009 17:37:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Sep 2009 18:23:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26017</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02bhr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11463</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>