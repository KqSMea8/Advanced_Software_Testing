<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:13:41 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-16395/HBASE-16395.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-16395] ShortCircuitLocalReads Failed when enabled replication</title>
                <link>https://issues.apache.org/jira/browse/HBASE-16395</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I had sended an email to user@hbase.apache.org,but received no help.&lt;/p&gt;

&lt;p&gt;The cluster enabled shortCircuitLocalReads.&lt;br/&gt;
&amp;lt;property&amp;gt;&lt;br/&gt;
    &amp;lt;name&amp;gt;dfs.client.read.shortcircuit&amp;lt;/name&amp;gt;&lt;br/&gt;
    &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
&amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;When enabled replication,we found a large number of error logs.&lt;br/&gt;
1.shortCircuitLocalReads(fail everytime).&lt;br/&gt;
2.Try reading via the datanode on targetAddr(success).&lt;br/&gt;
How to make shortCircuitLocalReads successfully when enabled replication?&lt;/p&gt;

&lt;p&gt;2016-08-03 10:46:21,721 DEBUG org.apache.hadoop.hbase.replication.regionserver.ReplicationSource: Opening log for replication dn7%2C60020%2C1470136216957.1470192327030 at 16999670&lt;br/&gt;
2016-08-03 10:46:21,723 WARN org.apache.hadoop.hdfs.DFSClient: BlockReaderLocal requested with incorrect offset: Offset 0 and length 17073479 don&apos;t match block blk_4137524355009640437_53760530 ( blockLen 16999670 )&lt;br/&gt;
2016-08-03 10:46:21,723 WARN org.apache.hadoop.hdfs.DFSClient: BlockReaderLocal: Removing blk_4137524355009640437_53760530 from cache because local file /sdd/hdfs/dfs/data/blocksBeingWritten/blk_4137524355009640437 could not be opened.&lt;br/&gt;
2016-08-03 10:46:21,724 INFO org.apache.hadoop.hdfs.DFSClient: Failed to read block blk_4137524355009640437_53760530 on local machinejava.io.IOException: Offset 0 and length 17073479 don&apos;t match block blk_4137524355009640437_53760530 ( blockLen 16999670 )&lt;br/&gt;
at org.apache.hadoop.hdfs.BlockReaderLocal.&amp;lt;init&amp;gt;(BlockReaderLocal.java:287)&lt;br/&gt;
at org.apache.hadoop.hdfs.BlockReaderLocal.newBlockReader(BlockReaderLocal.java:171)&lt;br/&gt;
at org.apache.hadoop.hdfs.DFSClient.getLocalBlockReader(DFSClient.java:358)&lt;br/&gt;
at org.apache.hadoop.hdfs.DFSClient.access$800(DFSClient.java:74)&lt;br/&gt;
at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.blockSeekTo(DFSClient.java:2073)&lt;br/&gt;
at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.read(DFSClient.java:2224)&lt;br/&gt;
at java.io.DataInputStream.read(DataInputStream.java:149)&lt;br/&gt;
at java.io.DataInputStream.readFully(DataInputStream.java:195)&lt;br/&gt;
at java.io.DataInputStream.readFully(DataInputStream.java:169)&lt;br/&gt;
at org.apache.hadoop.io.SequenceFile$Reader.init(SequenceFile.java:1508)&lt;br/&gt;
at org.apache.hadoop.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1486)&lt;br/&gt;
at org.apache.hadoop.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1475)&lt;br/&gt;
at org.apache.hadoop.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1470)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader$WALReader.&amp;lt;init&amp;gt;(SequenceFileLogReader.java:55)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader.init(SequenceFileLogReader.java:178)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.wal.HLog.getReader(HLog.java:734)&lt;br/&gt;
at org.apache.hadoop.hbase.replication.regionserver.ReplicationHLogReaderManager.openReader(ReplicationHLogReaderManager.java:69)&lt;br/&gt;
at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.openReader(ReplicationSource.java:574)&lt;br/&gt;
at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.run(ReplicationSource.java:364)&lt;br/&gt;
2016-08-03 10:46:21,724 INFO org.apache.hadoop.hdfs.DFSClient: Try reading via the datanode on /192.168.7.139:50010&lt;/p&gt;</description>
                <environment></environment>
        <key id="12996553">HBASE-16395</key>
            <summary>ShortCircuitLocalReads Failed when enabled replication</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yangming860101">yang ming</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Aug 2016 07:51:27 +0000</created>
                <updated>Tue, 16 Aug 2016 01:35:57 +0000</updated>
                            <resolved>Fri, 12 Aug 2016 06:19:19 +0000</resolved>
                                    <version>0.94.20</version>
                                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15417018" author="anoop.hbase" created="Thu, 11 Aug 2016 10:54:36 +0000"  >&lt;p&gt;Any similar short circuit read fail u r seeing for HFiles also? (When reads happen). This is only for log files?&lt;/p&gt;</comment>
                            <comment id="15417158" author="dimaspivak" created="Thu, 11 Aug 2016 12:51:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangming860101&quot; class=&quot;user-hover&quot; rel=&quot;yangming860101&quot;&gt;yang ming&lt;/a&gt; I replied to your message on user@ but you never responded. Let&apos;s keep the discussion on that thread, this doesn&apos;t look like an HBase bug. &lt;/p&gt;</comment>
                            <comment id="15418328" author="yangming860101" created="Fri, 12 Aug 2016 04:04:17 +0000"  >&lt;p&gt;There is no similar fail,just only for log files.&lt;br/&gt;
Configuration is as follows:&lt;br/&gt;
&amp;lt;property&amp;gt;&lt;br/&gt;
    &amp;lt;name&amp;gt;dfs.client.read.shortcircuit&amp;lt;/name&amp;gt;&lt;br/&gt;
    &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
&amp;lt;/property&amp;gt;&lt;br/&gt;
&amp;lt;property&amp;gt;&lt;br/&gt;
    &amp;lt;name&amp;gt;hbase.replication&amp;lt;/name&amp;gt;&lt;br/&gt;
    &amp;lt;value&amp;gt;true&amp;lt;/value&amp;gt;&lt;br/&gt;
&amp;lt;/property&amp;gt;&lt;br/&gt;
&amp;lt;property&amp;gt;&lt;br/&gt;
    &amp;lt;name&amp;gt;replication.source.ratio&amp;lt;/name&amp;gt;&lt;br/&gt;
    &amp;lt;value&amp;gt;1&amp;lt;/value&amp;gt;&lt;br/&gt;
&amp;lt;/property&amp;gt;&lt;br/&gt;
&amp;lt;property&amp;gt;&lt;br/&gt;
    &amp;lt;name&amp;gt;replication.executor.workers&amp;lt;/name&amp;gt;&lt;br/&gt;
    &amp;lt;value&amp;gt;5&amp;lt;/value&amp;gt;&lt;br/&gt;
&amp;lt;/property&amp;gt; &lt;br/&gt;
&amp;lt;property&amp;gt;&lt;br/&gt;
    &amp;lt;name&amp;gt;replication.source.sleepforretries&amp;lt;/name&amp;gt;&lt;br/&gt;
    &amp;lt;value&amp;gt;5000&amp;lt;/value&amp;gt;&lt;br/&gt;
&amp;lt;/property&amp;gt;&lt;/p&gt;</comment>
                            <comment id="15418345" author="yangming860101" created="Fri, 12 Aug 2016 04:21:43 +0000"  >&lt;p&gt;Thanks! &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dimaspivak&quot; class=&quot;user-hover&quot; rel=&quot;dimaspivak&quot;&gt;Dima Spivak&lt;/a&gt;&lt;br/&gt;
But why short circuit read fail only for log files everytime?&lt;/p&gt;</comment>
                            <comment id="15418396" author="anoop.hbase" created="Fri, 12 Aug 2016 05:52:21 +0000"  >&lt;p&gt;Check HDFS for the block distribution of the mentioned log file.&lt;/p&gt;</comment>
                            <comment id="15418412" author="dimaspivak" created="Fri, 12 Aug 2016 06:19:19 +0000"  >&lt;p&gt;Let&apos;s keep discussion of this on user@ so that others can benefit from it. &lt;/p&gt;</comment>
                            <comment id="15418417" author="yangming860101" created="Fri, 12 Aug 2016 06:28:50 +0000"  >&lt;h3&gt;&lt;a name=&quot;HBaselog%3A&quot;&gt;&lt;/a&gt;HBase log:&lt;/h3&gt;
&lt;p&gt;2016-08-12 14:25:56,738 DEBUG org.apache.hadoop.hbase.replication.regionserver.ReplicationSource: Opening log for replication dn7%2C60020%2C1470216726863.1470983077165 at 28175754&lt;br/&gt;
2016-08-12 14:25:56,740 WARN org.apache.hadoop.hdfs.DFSClient: BlockReaderLocal requested with incorrect offset:  Offset 0 and length 28186400 don&apos;t match block blk_-4614053595081055029_54130616 ( blockLen 28175754 )&lt;br/&gt;
2016-08-12 14:25:56,740 WARN org.apache.hadoop.hdfs.DFSClient: BlockReaderLocal: Removing blk_-4614053595081055029_54130616 from cache because local file /sdf/hdfs/dfs/data/blocksBeingWritten/blk_-4614053595081055029 could not be opened.&lt;br/&gt;
2016-08-12 14:25:56,740 INFO org.apache.hadoop.hdfs.DFSClient: Failed to read block &lt;font color=&quot;red&quot;&gt;blk_-4614053595081055029_54130616&lt;/font&gt; on local machinejava.io.IOException:  Offset 0 and length 28186400 don&apos;t match block &lt;font color=&quot;red&quot;&gt;blk_-4614053595081055029_54130616&lt;/font&gt; ( blockLen 28175754 )&lt;br/&gt;
        at org.apache.hadoop.hdfs.BlockReaderLocal.&amp;lt;init&amp;gt;(BlockReaderLocal.java:287)&lt;br/&gt;
        at org.apache.hadoop.hdfs.BlockReaderLocal.newBlockReader(BlockReaderLocal.java:171)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient.getLocalBlockReader(DFSClient.java:358)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient.access$800(DFSClient.java:74)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.blockSeekTo(DFSClient.java:2073)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.read(DFSClient.java:2224)&lt;br/&gt;
        at java.io.DataInputStream.read(DataInputStream.java:149)&lt;br/&gt;
        at java.io.DataInputStream.readFully(DataInputStream.java:195)&lt;br/&gt;
        at java.io.DataInputStream.readFully(DataInputStream.java:169)&lt;br/&gt;
        at org.apache.hadoop.io.SequenceFile$Reader.init(SequenceFile.java:1508)&lt;br/&gt;
        at org.apache.hadoop.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1486)&lt;br/&gt;
        at org.apache.hadoop.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1475)&lt;br/&gt;
        at org.apache.hadoop.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1470)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader$WALReader.&amp;lt;init&amp;gt;(SequenceFileLogReader.java:55)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogReader.init(SequenceFileLogReader.java:178)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.wal.HLog.getReader(HLog.java:734)&lt;br/&gt;
        at org.apache.hadoop.hbase.replication.regionserver.ReplicationHLogReaderManager.openReader(ReplicationHLogReaderManager.java:69)&lt;br/&gt;
        at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.openReader(ReplicationSource.java:574)&lt;br/&gt;
        at org.apache.hadoop.hbase.replication.regionserver.ReplicationSource.run(ReplicationSource.java:364)&lt;br/&gt;
2016-08-12 14:25:56,740 INFO org.apache.hadoop.hdfs.DFSClient: Try reading via the datanode on /192.168.7.139:50010&lt;/p&gt;

&lt;h3&gt;&lt;a name=&quot;HDFSlog%28noerrorlog%29%3A&quot;&gt;&lt;/a&gt;HDFS log(no error log):&lt;/h3&gt;
&lt;p&gt;2016-08-12 14:25:49,902 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /192.168.7.139:50010, dest: /192.168.7.139:55856, bytes: 66048, op: HDFS_READ, cliID: DFSClient_hb_rs_dn7,60020,1470216726863, offset: 0, srvID: DS-1014379950-192.168.7.139-50010-1416802300444, blockid: &lt;font color=&quot;red&quot;&gt;blk_-4614053595081055029_54130616&lt;/font&gt;, duration: 252426&lt;br/&gt;
2016-08-12 14:25:49,964 INFO org.apache.hadoop.hdfs.server.datanode.DataNode.clienttrace: src: /192.168.7.139:50010, dest: /192.168.7.139:55858, bytes: 198144, op: HDFS_READ, cliID: DFSClient_hb_rs_dn7,60020,1470216726863, offset: 0, srvID: DS-1014379950-192.168.7.139-50010-1416802300444, blockid: blk_-4614053595081055029_54130616, duration: 329364&lt;/p&gt;</comment>
                            <comment id="15418464" author="anoop.hbase" created="Fri, 12 Aug 2016 07:28:37 +0000"  >&lt;p&gt;Are you seeing it for all the log files?  The local ReplicationSource will handle the WALs for replication from this RS. But it may so happen that this RS went down and so another took charge of doing replication of the WAL files originated at the current down RS.  Those WALs might not be local for the current replicating RS.  So you may see  SCR  not happening.  As added logs here I just commented.   Ya pls move discussion to user@&lt;/p&gt;</comment>
                            <comment id="15421996" author="yangming860101" created="Tue, 16 Aug 2016 01:23:29 +0000"  >&lt;p&gt;&lt;b&gt;I have posted 3 mails to user@hbase.apache.org,but has NOT been accepted by the mailing list yet.&lt;/b&gt;&lt;br/&gt;
&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12823800/image.png&quot; align=&quot;absmiddle&quot; border=&quot;0&quot; /&gt;&lt;/p&gt;</comment>
                            <comment id="15422004" author="dimaspivak" created="Tue, 16 Aug 2016 01:26:46 +0000"  >&lt;p&gt;Did you subscribe to the mailing list? As you can see, I saw and replied to your original message...&lt;/p&gt;</comment>
                            <comment id="15422008" author="yangming860101" created="Tue, 16 Aug 2016 01:33:16 +0000"  >&lt;p&gt;&lt;b&gt;I have not received a confirmation request by email&lt;/b&gt;&lt;br/&gt;
&lt;img src=&quot;https://issues.apache.org/jira/secure/attachment/12823808/63D4.tm.png&quot; align=&quot;absmiddle&quot; border=&quot;0&quot; /&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12823808" name="63D4.tm.png" size="23511" author="yangming860101" created="Tue, 16 Aug 2016 01:32:45 +0000"/>
                            <attachment id="12823800" name="image.png" size="26283" author="yangming860101" created="Tue, 16 Aug 2016 01:21:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 11 Aug 2016 10:54:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            17 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i326xj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>