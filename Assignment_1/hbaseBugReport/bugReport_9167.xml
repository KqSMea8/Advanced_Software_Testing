<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:02:00 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9167/HBASE-9167.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9167] ServerCallable retries just once if timeout is not integer.max</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9167</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;If callTimeout is not integer.max and throwable is not SocketTimeoutException, we set the callTimeout to a negative value since endTime is not set yet.  Therefore, the next call will always throw SocketTimeoutException.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;    if (this.callTimeout != HConstants.DEFAULT_HBASE_CLIENT_OPERATION_TIMEOUT)
      if (throwable instanceof SocketTimeoutException
          || (this.endTime - this.startTime &amp;gt; this.callTimeout)) {
        throw (SocketTimeoutException) (SocketTimeoutException) new SocketTimeoutException(
            &quot;Call to access row &apos;&quot; + Bytes.toString(row) + &quot;&apos; on table &apos;&quot;
                + Bytes.toString(tableName)
                + &quot;&apos; failed on socket timeout exception: &quot; + throwable)
            .initCause(throwable);
      } else {
   ===&amp;gt;     this.callTimeout = ((int) (this.endTime - this.startTime));
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12662745">HBASE-9167</key>
            <summary>ServerCallable retries just once if timeout is not integer.max</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jxiang">Jimmy Xiang</assignee>
                                    <reporter username="jxiang">Jimmy Xiang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Aug 2013 23:58:16 +0000</created>
                <updated>Tue, 24 Sep 2013 20:32:55 +0000</updated>
                            <resolved>Tue, 20 Aug 2013 16:57:12 +0000</resolved>
                                    <version>0.94.10</version>
                                    <fixVersion>0.94.12</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13734213" author="jxiang" created="Thu, 8 Aug 2013 23:59:45 +0000"  >&lt;p&gt;We can backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7756&quot; title=&quot;Strange code in ServerCallable#shouldRetry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7756&quot;&gt;&lt;del&gt;HBASE-7756&lt;/del&gt;&lt;/a&gt; and other changes from trunk.&lt;/p&gt;</comment>
                            <comment id="13734215" author="jxiang" created="Fri, 9 Aug 2013 00:01:57 +0000"  >&lt;p&gt;callTimeout is set to a negative value at the first call.  Is my understanding right?  Why has this been here for so long?  Nobody changed the timeout?&lt;/p&gt;</comment>
                            <comment id="13734425" author="hadoopqa" created="Fri, 9 Aug 2013 05:55:13 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12596997/0.94-9167.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12596997/0.94-9167.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6675//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6675//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13734433" author="ram_krish" created="Fri, 9 Aug 2013 06:07:36 +0000"  >&lt;p&gt;&amp;gt;&amp;gt;bq.callTimeout is set to a negative value at the first call&lt;br/&gt;
I think you are right it will be negative.  Better we backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7756&quot; title=&quot;Strange code in ServerCallable#shouldRetry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7756&quot;&gt;&lt;del&gt;HBASE-7756&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13734563" author="nkeywal" created="Fri, 9 Aug 2013 08:57:13 +0000"  >&lt;p&gt;Then you will want &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9156&quot; title=&quot;2000ms timeout for some client calls&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9156&quot;&gt;&lt;del&gt;HBASE-9156&lt;/del&gt;&lt;/a&gt; as well &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="13734585" author="ram_krish" created="Fri, 9 Aug 2013 09:25:03 +0000"  >&lt;p&gt;Yes.  Good catch.&lt;/p&gt;</comment>
                            <comment id="13734939" author="jxiang" created="Fri, 9 Aug 2013 16:05:10 +0000"  >&lt;p&gt;The duration is calculated wrong even in trunk, because the endTime is not set since afterCall is not called yet at that moment, which is not a big deal.  But this one in 0.94 gives us only one retry, which is bad.  Let me backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7756&quot; title=&quot;Strange code in ServerCallable#shouldRetry&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7756&quot;&gt;&lt;del&gt;HBASE-7756&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9156&quot; title=&quot;2000ms timeout for some client calls&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9156&quot;&gt;&lt;del&gt;HBASE-9156&lt;/del&gt;&lt;/a&gt;.  Thanks.&lt;/p&gt;</comment>
                            <comment id="13741478" author="jxiang" created="Thu, 15 Aug 2013 21:07:19 +0000"  >&lt;p&gt;Attached patvh v2.  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9156&quot; title=&quot;2000ms timeout for some client calls&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9156&quot;&gt;&lt;del&gt;HBASE-9156&lt;/del&gt;&lt;/a&gt; doesn&apos;t apply to 0.94 so it is not backported.  We also fixed the call duration calculation.&lt;/p&gt;</comment>
                            <comment id="13741598" author="hadoopqa" created="Thu, 15 Aug 2013 22:32:37 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12598293/0.94-9167_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12598293/0.94-9167_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6769//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6769//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13744262" author="jxiang" created="Mon, 19 Aug 2013 21:31:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkeywal&quot; class=&quot;user-hover&quot; rel=&quot;nkeywal&quot;&gt;Nicolas Liochon&lt;/a&gt;, any chance to take a look the patch v2?&lt;/p&gt;</comment>
                            <comment id="13745038" author="nkeywal" created="Tue, 20 Aug 2013 15:06:55 +0000"  >&lt;p&gt;I think I&apos;m +1 with this patch. I&apos;m looking at the code in trunk and I fear there are race conditions: if multiple operations have different timeouts they may end up with the socket timeout of another operations. I guess it&apos;s the same problem in 0.94 and it&apos;s not new. So the patch is fine, just that we may have other issues if we set the timeout to something different than integer.max. The code in trunk around this is really complex.&lt;/p&gt;</comment>
                            <comment id="13745123" author="jxiang" created="Tue, 20 Aug 2013 16:51:10 +0000"  >&lt;p&gt;I have the same feeling about the timeout thing, which is a member of ConnectionId, the cache key, and timeout keeps changing depending on the retry. However, the proxy itself is cached too, which ties to one RPC timeout, which makes it hard to have a crystal clear picture. +1 to simplify/fix this.&lt;/p&gt;</comment>
                            <comment id="13745127" author="jxiang" created="Tue, 20 Aug 2013 16:57:12 +0000"  >&lt;p&gt;Integrated into 0.94.  Thanks Nicolas for the review.&lt;/p&gt;</comment>
                            <comment id="13745211" author="hudson" created="Tue, 20 Aug 2013 18:07:12 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94 #1119 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1119/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1119/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9167&quot; title=&quot;ServerCallable retries just once if timeout is not integer.max&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9167&quot;&gt;&lt;del&gt;HBASE-9167&lt;/del&gt;&lt;/a&gt; ServerCallable retries just once if timeout is not integer.max (jxiang: rev 1515874)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13745218" author="hudson" created="Tue, 20 Aug 2013 18:10:29 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94-security #265 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/265/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/265/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9167&quot; title=&quot;ServerCallable retries just once if timeout is not integer.max&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9167&quot;&gt;&lt;del&gt;HBASE-9167&lt;/del&gt;&lt;/a&gt; ServerCallable retries just once if timeout is not integer.max (jxiang: rev 1515874)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/client/ServerCallable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12596997" name="0.94-9167.patch" size="5795" author="jxiang" created="Fri, 9 Aug 2013 00:29:48 +0000"/>
                            <attachment id="12598293" name="0.94-9167_v2.patch" size="5802" author="jxiang" created="Thu, 15 Aug 2013 21:07:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 9 Aug 2013 05:55:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>342747</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 17 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1n3xr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>343051</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>