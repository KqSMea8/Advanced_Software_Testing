<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:13:19 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3808/HBASE-3808.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3808] Implement Executor.toString for master handlers at least</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3808</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;On shutdown, if still outstanding Executors queued then when ExecutorService lists what is outstanding, the list will be other than a list of default toString implementations of ServerShutdownHandler objects.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12504850">HBASE-3808</key>
            <summary>Implement Executor.toString for master handlers at least</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="brocknoland">Brock Noland</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Apr 2011 06:30:55 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:54 +0000</updated>
                            <resolved>Sun, 5 Jun 2011 18:04:29 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13037271" author="brocknoland" created="Sat, 21 May 2011 05:19:48 +0000"  >&lt;p&gt;If I understand this correctly, you would like toString() methods for each of the handlers in org.apache.hadoop.hbase.master.handler?&lt;/p&gt;</comment>
                            <comment id="13037422" author="stack" created="Sat, 21 May 2011 17:06:13 +0000"  >&lt;p&gt;@Brock Yes.  There is a little bit of a convention naming threads that you might want to pick up on.  Here are some illustartions of the pattern:&lt;/p&gt;

&lt;p&gt;Here is how we name the master where MASTER==&apos;master&apos;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// set the thread name now we have an address
&lt;/span&gt;    setName(MASTER + &lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.serverName.toString());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Note how we get the &apos;servername&apos; in there.  Helps in for example a testing context where there might be N masters all running in the same JVM distingushed by port number only; having the hosting server name as prefix on the thread can help debugging.&lt;/p&gt;

&lt;p&gt;Here is how the catalogjanitor that runs in each master is named:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
server.getServerName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;-CatalogJanitor&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The bulkassigner that runs in each master:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.getServerName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;-&quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getClass().getName(); 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That kinda thing.&lt;/p&gt;

&lt;p&gt;Not sure how you will distingush between the instances of Executors?  Perhaps there is a increment of some time you can add to the name?&lt;/p&gt;

&lt;p&gt;While you are at it, you might want to add toString to the handlers in regionserver.&lt;/p&gt;

&lt;p&gt;Thank you for taking a look.&lt;/p&gt;

&lt;p&gt;Beware: this might be a silly enterprise, perhaps not doable.  It was just a notion I had.&lt;/p&gt;</comment>
                            <comment id="13037487" author="brocknoland" created="Sun, 22 May 2011 00:54:01 +0000"  >&lt;p&gt;@stack&lt;/p&gt;

&lt;p&gt;Here is what I think you are looking for implemented for ServerShutdownHandler and ExecutorService$Executor. How far am I off track?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Index: src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java
===================================================================
--- src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java	(revision 1125781)
+++ src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java	(working copy)
@@ -88,6 +88,11 @@
   }
 
   @Override
+  public String toString() {
+	  return getClass().getSimpleName() + &quot;-&quot; + server.getServerName();
+  }
+  
+  @Override
   public void process() throws IOException {
     final ServerName serverName = this.serverName;
 
Index: src/main/java/org/apache/hadoop/hbase/executor/ExecutorService.java
===================================================================
--- src/main/java/org/apache/hadoop/hbase/executor/ExecutorService.java	(revision 1125781)
+++ src/main/java/org/apache/hadoop/hbase/executor/ExecutorService.java	(working copy)
@@ -27,6 +27,7 @@
 import java.util.concurrent.LinkedBlockingQueue;
 import java.util.concurrent.ThreadPoolExecutor;
 import java.util.concurrent.TimeUnit;
+import java.util.concurrent.atomic.AtomicLong;
 
 import org.apache.commons.logging.Log;
 import org.apache.commons.logging.LogFactory;
@@ -188,7 +189,7 @@
       List&amp;lt;Runnable&amp;gt; wasRunning =
         entry.getValue().threadPoolExecutor.shutdownNow();
       if (!wasRunning.isEmpty()) {
-        LOG.info(entry.getKey() + &quot; had &quot; + wasRunning + &quot; on shutdown&quot;);
+        LOG.info(entry.getValue() + &quot; had &quot; + wasRunning + &quot; on shutdown&quot;);
       }
     }
     this.executorMap.clear();
@@ -255,9 +256,12 @@
     final BlockingQueue&amp;lt;Runnable&amp;gt; q = new LinkedBlockingQueue&amp;lt;Runnable&amp;gt;();
     private final String name;
     private final Map&amp;lt;EventHandler.EventType, EventHandlerListener&amp;gt; eventHandlerListeners;
-
+    private static final AtomicLong seqids = new AtomicLong(0);
+    private final long id;
+    
     protected Executor(String name, int maxThreads,
         final Map&amp;lt;EventHandler.EventType, EventHandlerListener&amp;gt; eventHandlerListeners) {
+      this.id = seqids.incrementAndGet();
       this.name = name;
       this.eventHandlerListeners = eventHandlerListeners;
       // create the thread pool executor
@@ -283,5 +287,9 @@
       }
       this.threadPoolExecutor.execute(event);
     }
+    
+    public String toString() {
+    	return getClass().getSimpleName() + &quot;-&quot; + id + &quot;-&quot; + name;
+    }
   }
 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13037489" author="brocknoland" created="Sun, 22 May 2011 00:57:45 +0000"  >&lt;p&gt;Output from ExecutorService.shutdown() now looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2011-05-21 19:57:15,790 INFO  [main] executor.ExecutorService(192): Executor-3-MASTER_SERVER_OPERATIONS-unit_test had [TestEventHandler-localhost,8080,0, TestEventHandler-localhost,8080,0, TestEventHandler-localhost,8080,0, TestEventHandler-localhost,8080,0, TestEventHandler-localhost,8080,0] on shutdown
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13038378" author="stack" created="Tue, 24 May 2011 04:23:25 +0000"  >&lt;p&gt;@Brock That looks great.  One thing.  I wonder if there is a way to distingush the Executor instances, a means that you could add to the toString?  We have a pool of them usually and it would be good to distingush between the pool members if only its a numeral or even just the class instance name?... so toString would look like &apos;TestEventHandler-localhost,8080,0-1&apos;, &apos;TestEventHandler-localhost,8080,0-2&apos;, etc.  Would that be possible?  I wonder what Thread.currentThread.getName() says?  It probably varies with how the Executor is run but maybe this would help if it were part of the toString?  Thanks for looking at this Brock.&lt;/p&gt;</comment>
                            <comment id="13044385" author="brocknoland" created="Sat, 4 Jun 2011 20:23:08 +0000"  >&lt;p&gt;@stack&lt;/p&gt;

&lt;p&gt;I am unclear as to why Thread.CurrentThread().getName() would be useful? If we are calling toString() on an executor I assume it is going to be logged as as such the thread name will be included in the log record?&lt;/p&gt;

&lt;p&gt;I have attached a patch for the master handlers.  If that looks OK I will do the region servers and send in one whole patch.&lt;/p&gt;

&lt;p&gt;One note, there was a field in ServerShutdownHandler &quot;server&quot; which was shadowing a field in EventHandler. I removed the field from ServerShutdownHandler as it made the field private and as such unable to access in MetaServerShutdownHandler.&lt;/p&gt;</comment>
                            <comment id="13044429" author="stack" created="Sun, 5 Jun 2011 04:07:31 +0000"  >&lt;p&gt;@Brock I was just thinking that an ordinal to distingush between the members of the executor pool would be of use.  No biggie if its a pain adding it (Not sure if the thread name will be included in the log record).&lt;/p&gt;

&lt;p&gt;Thanks for fixing ServerShutdownHandler &apos;server&apos; field.  What you did sounds right.&lt;/p&gt;

&lt;p&gt;Regards regionservers, less important I&apos;d say and out of scope for this JIRA (going by the subject).&lt;/p&gt;

&lt;p&gt;I was going to commit this as is if thats ok w/ you? (For future, tabs in hbase/hadoop are two spaces rather than the four you have... but np, I can fix on commit).&lt;/p&gt;</comment>
                            <comment id="13044575" author="brocknoland" created="Sun, 5 Jun 2011 16:51:20 +0000"  >&lt;p&gt;@stack - I can certainly add the thread name, I just wasn&apos;t sure how it would be used.  I did add a unique id to both the Executor (added id field) and all the Handlers (used existing seqid). Let me know if you want the thread name.&lt;/p&gt;

&lt;p&gt;Cool, I will setup my editor with two spaces.&lt;/p&gt;</comment>
                            <comment id="13044594" author="stack" created="Sun, 5 Jun 2011 18:04:29 +0000"  >&lt;p&gt;Committed to TRUNK.  Thanks for the patch Brock (I added you as contributor and assigned you this issue).&lt;/p&gt;</comment>
                            <comment id="13044618" author="hudson" created="Sun, 5 Jun 2011 20:55:32 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1953 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/HBase-TRUNK/1953/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/HBase-TRUNK/1953/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3808&quot; title=&quot;Implement Executor.toString for master handlers at least&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3808&quot;&gt;&lt;del&gt;HBASE-3808&lt;/del&gt;&lt;/a&gt; Implement Executor.toString for master handlers at least&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/DisableTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/OpenedRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/MetaServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/EnableTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/executor/ExecutorService.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/SplitRegionHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15017650" author="lars_francke" created="Fri, 20 Nov 2015 12:43:54 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12481468" name="hbase-to-string-on-executors-0.patch" size="12202" author="brocknoland" created="Sat, 4 Jun 2011 20:23:08 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 21 May 2011 05:19:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27034</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hnzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101149</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>noob</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>