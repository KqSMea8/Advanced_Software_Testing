<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:23:39 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11484/HBASE-11484.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11484] Provide a way in TableSnapshotInputFormat, not to restore the regions to a path for running MR every time, rather reuse a already restored path</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11484</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We are trying to back a Hive Table by the Map Reduce over snapshots  and we don&apos;t want to restore the snapshot to a restoreDir every time we want to execute a query. It would be nice if there is boolean in the function &lt;br/&gt;
&lt;b&gt;TableSnapshotInputFormat.setInput&lt;/b&gt; and exposed outside in the&lt;br/&gt;
&lt;b&gt;TableMapReduceUtil.initTableSnapshotMapperJob&lt;/b&gt;, with this boolean&lt;br/&gt;
it will check whether the snapshot and the restore dir are in sync, rather than restoring again. &lt;/p&gt;

&lt;p&gt;Is this Idea looks Ok to you guys or you have any other suggestions, I will put up a patch for this if this idea is ok for guys&lt;/p&gt;</description>
                <environment></environment>
        <key id="12726397">HBASE-11484</key>
            <summary>Provide a way in TableSnapshotInputFormat, not to restore the regions to a path for running MR every time, rather reuse a already restored path</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dvdreddy">deepankar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Jul 2014 18:48:41 +0000</created>
                <updated>Thu, 10 Jul 2014 18:49:10 +0000</updated>
                                                                            <component>mapreduce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14056598" author="dvdreddy" created="Wed, 9 Jul 2014 18:49:11 +0000"  >&lt;p&gt;ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14056612" author="mbertozzi" created="Wed, 9 Jul 2014 19:03:57 +0000"  >&lt;p&gt;-1 on this approach.&lt;/p&gt;

&lt;p&gt;you can just change the ClientSideRegionScanner to take the region manifest and add the files to the HRegion object instead of using HRegion.openHRegion(). It requires a couple of changes in HRegion&lt;/p&gt;

&lt;p&gt;anyway, what is the real motivation? restore doesn&apos;t copy the data, so it is not a space problem. and unless you restore a snapshot every 5 sec the number of calls to the NN shouldn&apos;t be the problem.&lt;/p&gt;</comment>
                            <comment id="14056613" author="enis" created="Wed, 9 Jul 2014 19:04:56 +0000"  >&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; is working on hive support for table snapshot input format. Restore is a relatively cheap operation, but the IF has to ensure that the snapshot is restored before being able to read from it. Maybe we can break down the restore and MR steps and make it useable on their own. &lt;/p&gt;</comment>
                            <comment id="14056646" author="dvdreddy" created="Wed, 9 Jul 2014 19:39:57 +0000"  >&lt;p&gt;Thanks for the suggestions.Yes, I know Restore is relatively cheap, but since Hive does not support (as far as I my knowledge goes) any cleanup hook , we have to cleanup all the restored Dirs, Rather we were thinking if we can restore once, after exporting the snapshot (ExportSnapshot job)  and then use that for all the further queries on this snapshot. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt; Thanks for the idea of the ClientSideRegionScanner, It a very good idea, but that class is not there in 0.94 and unfortunately we still use 0.94, and also I have to manage creating the splits (which TableSnapshotIF takes care of).&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; For the sake of ensuring only I will write a function for verifying that for each reference in the snapshot, there is a HFileLink or HFile&lt;br/&gt;
present in the restoreDir&lt;/p&gt;</comment>
                            <comment id="14056655" author="mbertozzi" created="Wed, 9 Jul 2014 19:44:51 +0000"  >&lt;p&gt;the manifest is just a list of file names. The restore step is required only because the openRegion() is doing a fs.listStatus() to get the file list. if instead of that you pass the manifest or in case of 94 the list of files you can avoid to restore step. &lt;/p&gt;</comment>
                            <comment id="14056753" author="ndimiduk" created="Wed, 9 Jul 2014 21:00:28 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dvdreddy&quot; class=&quot;user-hover&quot; rel=&quot;dvdreddy&quot;&gt;deepankar&lt;/a&gt;. The work on adding support for Hive is happening on &lt;a href=&quot;https://issues.apache.org/jira/browse/HIVE-6584&quot; title=&quot;Add HiveHBaseTableSnapshotInputFormat&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HIVE-6584&quot;&gt;&lt;del&gt;HIVE-6584&lt;/del&gt;&lt;/a&gt;. If you have design and use-case comments, please add them over there. It looks like the patches may need a refresh though. We can also accommodate HBase improvements as necessary.&lt;/p&gt;

&lt;p&gt;From the perspective of my contribution, I was planning to abstract away the restore directory from the Hive user once I have a working implementation. Patches welcome &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14056812" author="dvdreddy" created="Wed, 9 Jul 2014 21:55:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt; Are you suggesting to remove this step of RestoreSnapshot entirey, by having a constructor or openRegion method which takes a manifest? Seems a very good idea, I can take this up if you are okay with it?&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; Sure will take a look at the jira and will contribute if i can.&lt;/p&gt;</comment>
                            <comment id="14057177" author="mbertozzi" created="Thu, 10 Jul 2014 06:11:03 +0000"  >&lt;p&gt;yes I think that removing the restore step is the way to go.&lt;br/&gt;
but I don&apos;t think that HRegion should know about the manifest.&lt;br/&gt;
with some changes in the region the InputFormat should be able to do something like this&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;HRegion region = new HRegion(...);
for (... Manifest...) {
   region.getStore(...).addStoreFile(...)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14057782" author="enis" created="Thu, 10 Jul 2014 18:25:12 +0000"  >&lt;p&gt;We do not have WAL-based flush-less snapshots but once (if) we have them, restore WILL be required no matter what. That was the reason why I did not go with something like the above. I think we should to restore, but make it transparent to the user. The job cleans after the restore dir if I remember it right. &lt;/p&gt;</comment>
                            <comment id="14057805" author="dvdreddy" created="Thu, 10 Jul 2014 18:44:36 +0000"  >&lt;p&gt;There are no cleanup hooks, I don&apos;t think the job cleans up the restoreDir. I was thinking of this another approach, where if you have a restored snapshot into a dir , restoring it again should not be creating any new files, This approach is ok in some sense what we wanted and we can use one standard restoreDir per snapshot exported. But I went through the code, unfortunately restoring will try to create new HFileLinks by deleting the old HFileLinks (exactly the same links). Is this supposed to happen  or Is  this something that might&lt;br/&gt;
have been missed ?  &lt;/p&gt;</comment>
                            <comment id="14057809" author="dvdreddy" created="Thu, 10 Jul 2014 18:49:10 +0000"  >&lt;p&gt;Also in the case of WAL-based flush-less snapshots case also, will it be any good? if we can provide this as an option whether to restore or not restore, If it is be restored WAL be replayed and restored and HRegion objects are created from the restoredDir. Other wise we can use the &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;&apos;s suggested approach to create the HRegion objects by adding all the relevant HFiles without replaying any WAL edits (essentially if they are ok with loosing the edits in memstore)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Jul 2014 19:03:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>404504</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xm6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>404543</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>