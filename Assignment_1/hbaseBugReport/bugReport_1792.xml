<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:56:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1792/HBASE-1792.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1792] [Regression] Cannot save timestamp in the future</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1792</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;0.20, compared to previous versions, doesn&apos;t let you save with a timestamp in the future and will set it to current time without telling you. This is really bad for users upgrading to 0.20 that were using those timestamps.&lt;/p&gt;

&lt;p&gt;Example:&lt;/p&gt;

&lt;p&gt; hbase(main):004:0&amp;gt; put &apos;testtable&apos;, &apos;r1&apos;, &apos;f1:c1&apos;, &apos;val&apos;, 5373965335336911168&lt;br/&gt;
 0 row(s) in 0.0070 seconds&lt;br/&gt;
 hbase(main):005:0&amp;gt; scan &apos;testtable&apos;&lt;br/&gt;
 ROW                          COLUMN+CELL                                                                      &lt;br/&gt;
  r1                          column=f1:c1, timestamp=1251223892010, value=val                                 &lt;br/&gt;
 1 row(s) in 0.0380 seconds&lt;/p&gt;</description>
                <environment></environment>
        <key id="12433967">HBASE-1792</key>
            <summary>[Regression] Cannot save timestamp in the future</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Aug 2009 18:32:19 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:55 +0000</updated>
                            <resolved>Wed, 26 Aug 2009 00:05:57 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.0</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12747575" author="stack" created="Tue, 25 Aug 2009 19:02:51 +0000"  >&lt;p&gt;Yeah, I suppose old days we&apos;d leave the ts alone and only change it to current time if it was HConstants.LATEST_TIMESTAMP (IIRC).&lt;/p&gt;</comment>
                            <comment id="12747581" author="streamy" created="Tue, 25 Aug 2009 19:07:16 +0000"  >&lt;p&gt;There was a number of long discussions related to this.  Unfortunately, I forgot where we ended up.&lt;/p&gt;

&lt;p&gt;We tried to keep certain axioms, like &quot;deletes only apply to older storefiles&quot;, but manually setting of stamps (future or past)  breaks that.  That means, if you modify stamps manually, your Gets can have indeterminate behavior.&lt;/p&gt;

&lt;p&gt;I&apos;d be more than happy to remove the strictness here, and allow anything &amp;lt; Long.MAX_VALUE (if equal, rewrite as now()), with a warning in Put that manually setting of stamp can cause indeterminate behavior, especially in Gets.&lt;/p&gt;

&lt;p&gt;In any case, I&apos;d like to see a unit test that verifies the behavior that we do have.  There is already a bit of it in o.a.h.h.c.TestClient, but there should be more, perhaps another method or part of testVersions().  It should do insertions with past, present, future stamps, in all different orders, with lots of flushing in between (all issues with stamps / indeterminate behavior are related to multiple storefiles + memstore interaction).&lt;/p&gt;

&lt;p&gt;If we can create a new test, with comments explaining what the behavior is, and all prior tests still pass, then I&apos;ll be +1 on allowing future stamps.&lt;/p&gt;

&lt;p&gt;Stack, Erik, any recollection on why it was left this way?&lt;/p&gt;

&lt;p&gt;This should also not have an impact on META where determinate behavior of Gets is quite important.&lt;/p&gt;</comment>
                            <comment id="12747618" author="jdcryans" created="Tue, 25 Aug 2009 20:13:11 +0000"  >&lt;p&gt;Just so I don&apos;t forget it, the timestamp is replaced silently here in HRegion.updateKeys:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /**
   * Checks &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; any stamps are &amp;gt; now.  If so, sets them to now.
   * &amp;lt;p&amp;gt;
   * This acts to be prevent users from inserting &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; stamps as well as
   * to replace LATEST_TIMESTAMP with now.
   * @param keys
   * @param now
   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &amp;lt;code&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/code&amp;gt; when updating the time stamp completed.
   */
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; updateKeys(List&amp;lt;KeyValue&amp;gt; keys, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] now) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(keys == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || keys.isEmpty()) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(KeyValue key : keys) {
      key.updateLatestStamp(now);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12747625" author="ryanobjc" created="Tue, 25 Aug 2009 20:28:03 +0000"  >&lt;p&gt;we should move back to Long.MAX_VALUE as the thing to replace to &apos;now&apos; i think... &lt;/p&gt;

&lt;p&gt;The problem with deletes would be if the delete is set too far in the past or future, depending on the time range of the files that end up bracketing them. Solved with minor compaction, and works via scans.&lt;/p&gt;
</comment>
                            <comment id="12747628" author="jdcryans" created="Tue, 25 Aug 2009 20:40:47 +0000"  >&lt;p&gt;Currently testing this patch.&lt;/p&gt;</comment>
                            <comment id="12747710" author="streamy" created="Tue, 25 Aug 2009 23:43:47 +0000"  >&lt;p&gt;+1 for commit on branch and trunk after your testing, jd.&lt;/p&gt;</comment>
                            <comment id="12747716" author="jdcryans" created="Wed, 26 Aug 2009 00:05:57 +0000"  >&lt;p&gt;Committed to branch and trunk, test passes and it fixes the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12417652" name="HBASE-1792.patch" size="1018" author="jdcryans" created="Tue, 25 Aug 2009 20:40:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 25 Aug 2009 19:02:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25983</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 17 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hf9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99737</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>