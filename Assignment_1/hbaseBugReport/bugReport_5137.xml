<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:25:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5137/HBASE-5137.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5137] MasterFileSystem.splitLog() should abort even if waitOnSafeMode() throws IOException</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5137</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I am not sure if this bug was already raised in JIRA.&lt;br/&gt;
In our test cluster we had a scenario where the RS had gone down and ServerShutDownHandler started with splitLog.&lt;br/&gt;
But as the HDFS was down the check waitOnSafeMode throws IOException.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-comment&quot;&gt;// If FS is in safe mode, just wait till out of it.
&lt;/span&gt;        FSUtils.waitOnSafeMode(conf,
          conf.getInt(HConstants.THREAD_WAKE_FREQUENCY, 1000));  
        splitter.splitLog();
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (OrphanHLogAfterSplitException e) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We catch the exception&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
      checkFileSystem();
      LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed splitting &quot;&lt;/span&gt; + logDir.toString(), e);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So the HLog split itself did not happen. We encontered like 4 regions that was recently splitted in the crashed RS was lost.&lt;/p&gt;

&lt;p&gt;Can we abort the Master in such scenarios? Pls suggest.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12537543">HBASE-5137</key>
            <summary>MasterFileSystem.splitLog() should abort even if waitOnSafeMode() throws IOException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="ram_krish">ramkrishna.s.vasudevan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jan 2012 16:53:20 +0000</created>
                <updated>Fri, 20 Nov 2015 11:52:37 +0000</updated>
                            <resolved>Tue, 10 Jan 2012 17:53:16 +0000</resolved>
                                    <version>0.90.4</version>
                                    <fixVersion>0.90.6</fixVersion>
                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13181442" author="zhihyu@ebaysf.com" created="Fri, 6 Jan 2012 17:10:20 +0000"  >&lt;p&gt;Thanks for reporting this, Ram.&lt;br/&gt;
This has been fixed in TRUNK:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed splitting of &quot;&lt;/span&gt; + serverNames, ioe);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!checkFileSystem()) {
          LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Bad Filesystem, exiting&quot;&lt;/span&gt;);
          &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.getRuntime().halt(1);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So answer to your question is: yes.&lt;/p&gt;</comment>
                            <comment id="13181500" author="ram_krish" created="Fri, 6 Jan 2012 18:33:50 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
One more thing, we should abort even without checking the file system. Because when we check the file system and if it says the File system is fine then we dont abort. But the log split has any way not happened.&lt;/p&gt;
</comment>
                            <comment id="13181624" author="zhihyu@ebaysf.com" created="Fri, 6 Jan 2012 21:42:00 +0000"  >&lt;p&gt;@Ram:&lt;br/&gt;
Good point. The current logic assumes that if file system check passes, retrying splitting log may succeed.&lt;/p&gt;

&lt;p&gt;I think the correct logic should add abortion in the catch block below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
          LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Interrupted, aborting since cannot &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; w/o splitting at startup&quot;&lt;/span&gt;);
          &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
          retrySplitting = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
          &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.getRuntime().halt(1);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13181963" author="ram_krish" created="Sat, 7 Jan 2012 13:47:03 +0000"  >&lt;p&gt;Patch for 0.90.&lt;/p&gt;</comment>
                            <comment id="13182014" author="zhihyu@ebaysf.com" created="Sat, 7 Jan 2012 16:12:27 +0000"  >&lt;p&gt;Minor comment:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (checkFileSystem() &amp;amp;&amp;amp; retrySplitting)
+          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Retrying failed log splitting &quot;&lt;/span&gt; + logDir.toString());
+        &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please add braces around the log statement.&lt;br/&gt;
I think the above check should go into TRUNK as well (aborting in the case of not retrying).&lt;/p&gt;

&lt;p&gt;Should we also handle InterruptedException, as TRUNK does ?&lt;/p&gt;</comment>
                            <comment id="13182060" author="ram_krish" created="Sat, 7 Jan 2012 18:43:05 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
In trunk we sleep for a configured time and hence we handle InterruptedException.  But i think that is also not needed as in trunk once we know file system is not available we do Runtime.halt(). If the file system is available why do we need to sleep for some time and then retry.&lt;/p&gt;</comment>
                            <comment id="13182111" author="zhihyu@ebaysf.com" created="Sat, 7 Jan 2012 21:58:15 +0000"  >&lt;p&gt;Nicolas might know the reason for introducing hbase.hlog.split.failure.retry.interval parameter&lt;/p&gt;</comment>
                            <comment id="13182115" author="zhihyu@ebaysf.com" created="Sat, 7 Jan 2012 22:05:04 +0000"  >&lt;p&gt;Suggested patch for TRUNK.&lt;/p&gt;</comment>
                            <comment id="13182198" author="ram_krish" created="Sun, 8 Jan 2012 06:06:51 +0000"  >&lt;p&gt;Patch for 0.90 addressing Ted&apos;s comment of adding braces.  But did not handle interrupted exception.&lt;br/&gt;
@Ted&lt;br/&gt;
Pls check if it is ok.&lt;/p&gt;</comment>
                            <comment id="13182209" author="zhihyu@ebaysf.com" created="Sun, 8 Jan 2012 06:49:43 +0000"  >&lt;p&gt;Second patch is fine. &lt;/p&gt;

&lt;p&gt;What do you think of the patch for trunk ?&lt;/p&gt;</comment>
                            <comment id="13182365" author="ram_krish" created="Mon, 9 Jan 2012 04:18:41 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
Patch for trunk is fine.  I still have a doubt on that sleep part. If sleep is really needed then the fix for trunk is needed. &lt;/p&gt;</comment>
                            <comment id="13182646" author="ram_krish" created="Mon, 9 Jan 2012 17:22:50 +0000"  >&lt;p&gt;Can we commit this issue ?&lt;/p&gt;</comment>
                            <comment id="13182695" author="zhihyu@ebaysf.com" created="Mon, 9 Jan 2012 18:34:41 +0000"  >&lt;p&gt;Yes.&lt;br/&gt;
Please don&apos;t forget the patch for TRUNK &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13182716" author="stack" created="Mon, 9 Jan 2012 19:07:11 +0000"  >&lt;p&gt;+1 on both patches.&lt;/p&gt;</comment>
                            <comment id="13183409" author="ram_krish" created="Tue, 10 Jan 2012 17:39:19 +0000"  >&lt;p&gt;Committed to 0.90 and trunk.  Do we need to commit in 0.92 also?&lt;/p&gt;</comment>
                            <comment id="13183413" author="stack" created="Tue, 10 Jan 2012 17:44:51 +0000"  >&lt;p&gt;@Ram Please commit to 0.92 branch also.&lt;/p&gt;</comment>
                            <comment id="13183424" author="ram_krish" created="Tue, 10 Jan 2012 17:52:39 +0000"  >&lt;p&gt;Committed to 0.92 also.&lt;br/&gt;
Thanks for the review Stack.&lt;br/&gt;
Thanks to Ted for the patch and review.&lt;/p&gt;</comment>
                            <comment id="13183531" author="hudson" created="Tue, 10 Jan 2012 20:13:59 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #238 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/238/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/238/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5137&quot; title=&quot;MasterFileSystem.splitLog() should abort even if waitOnSafeMode() throws IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5137&quot;&gt;&lt;del&gt;HBASE-5137&lt;/del&gt;&lt;/a&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5137&quot; title=&quot;MasterFileSystem.splitLog() should abort even if waitOnSafeMode() throws IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5137&quot;&gt;&lt;del&gt;HBASE-5137&lt;/del&gt;&lt;/a&gt;  MasterFileSystem.splitLog() should abort even if waitOnSafeMode() throws IOException (Ram &amp;amp; Ted)&lt;/p&gt;

&lt;p&gt;ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13183918" author="hudson" created="Wed, 11 Jan 2012 06:56:26 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #71 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/71/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/71/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5137&quot; title=&quot;MasterFileSystem.splitLog() should abort even if waitOnSafeMode() throws IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5137&quot;&gt;&lt;del&gt;HBASE-5137&lt;/del&gt;&lt;/a&gt;    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5137&quot; title=&quot;MasterFileSystem.splitLog() should abort even if waitOnSafeMode() throws IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5137&quot;&gt;&lt;del&gt;HBASE-5137&lt;/del&gt;&lt;/a&gt;  MasterFileSystem.splitLog() should abort even if waitOnSafeMode() throws IOException (Ram &amp;amp; Ted)&lt;/p&gt;

&lt;p&gt;ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13183934" author="hudson" created="Wed, 11 Jan 2012 07:34:21 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #72 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/72/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/72/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5137&quot; title=&quot;MasterFileSystem.splitLog() should abort even if waitOnSafeMode() throws IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5137&quot;&gt;&lt;del&gt;HBASE-5137&lt;/del&gt;&lt;/a&gt; MasterFileSystem.splitLog() should abort even if waitOnSafeMode() throws IOException(Ram &amp;amp; Ted)&lt;/p&gt;

&lt;p&gt;ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13183978" author="hudson" created="Wed, 11 Jan 2012 10:31:02 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2617 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2617/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2617/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5137&quot; title=&quot;MasterFileSystem.splitLog() should abort even if waitOnSafeMode() throws IOException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5137&quot;&gt;&lt;del&gt;HBASE-5137&lt;/del&gt;&lt;/a&gt; MasterFileSystem.splitLog() should abort even if waitOnSafeMode() throws IOException(Ram &amp;amp; Ted)&lt;/p&gt;

&lt;p&gt;ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15015791" author="lars_francke" created="Fri, 20 Nov 2015 11:52:37 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12509804" name="5137-trunk.txt" size="793" author="zhihyu@ebaysf.com" created="Sat, 7 Jan 2012 22:05:04 +0000"/>
                            <attachment id="12509835" name="HBASE-5137.patch" size="2885" author="ram_krish" created="Sun, 8 Jan 2012 06:06:51 +0000"/>
                            <attachment id="12509780" name="HBASE-5137.patch" size="2872" author="ram_krish" created="Sat, 7 Jan 2012 13:46:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 Jan 2012 17:10:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223049</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i069rj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34513</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>