<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:57:31 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14895/HBASE-14895.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14895] Seek only to the newly flushed file on scanner reset on flush</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14895</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description></description>
                <environment></environment>
        <key id="12916902">HBASE-14895</key>
            <summary>Seek only to the newly flushed file on scanner reset on flush</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12776620">HBASE-13082</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="ram_krish">ramkrishna.s.vasudevan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Nov 2015 09:08:15 +0000</created>
                <updated>Tue, 15 Dec 2015 12:55:03 +0000</updated>
                            <resolved>Tue, 15 Dec 2015 05:05:45 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="15035956" author="chenheng" created="Wed, 2 Dec 2015 15:24:33 +0000"  >&lt;p&gt;It seems we could add some code in StoreScanner.updateReaders,  right?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;StoreScanner.updateReaders&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.heap = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;; 
+    StoreFile recentFlush = getRecentFlushStoreFile();
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (recentFlush != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+      seek(recentFlush.getFirstKey());
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15036091" author="ram_krish" created="Wed, 2 Dec 2015 16:40:19 +0000"  >&lt;p&gt;Yes something like that only. We need to clearly identify the latest files and just seek to that. With &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13082&quot; title=&quot;Coarsen StoreScanner locks to RegionScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13082&quot;&gt;&lt;del&gt;HBASE-13082&lt;/del&gt;&lt;/a&gt; in place we just need to do for flushes only.&lt;/p&gt;</comment>
                            <comment id="15037292" author="chenheng" created="Thu, 3 Dec 2015 05:38:20 +0000"  >&lt;p&gt;I see..  It seems StoreScanner has a great change in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13082&quot; title=&quot;Coarsen StoreScanner locks to RegionScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13082&quot;&gt;&lt;del&gt;HBASE-13082&lt;/del&gt;&lt;/a&gt; .... &lt;/p&gt;</comment>
                            <comment id="15037735" author="ram_krish" created="Thu, 3 Dec 2015 12:42:57 +0000"  >&lt;p&gt;I have patch ready for this. Once &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13082&quot; title=&quot;Coarsen StoreScanner locks to RegionScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13082&quot;&gt;&lt;del&gt;HBASE-13082&lt;/del&gt;&lt;/a&gt; is checked in will rebase the patch on top of that. Found some interesting things while doing this wrt to the new shipped() call that we make.&lt;/p&gt;</comment>
                            <comment id="15041494" author="ram_krish" created="Fri, 4 Dec 2015 12:04:27 +0000"  >&lt;p&gt;Patch for QA. &lt;/p&gt;</comment>
                            <comment id="15041527" author="anoop.hbase" created="Fri, 4 Dec 2015 12:45:51 +0000"  >&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13082&quot; title=&quot;Coarsen StoreScanner locks to RegionScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13082&quot;&gt;&lt;del&gt;HBASE-13082&lt;/del&gt;&lt;/a&gt;, we will notify ChangedReadersObserver only after a flush operation. After bulk load and compaction we dont need inform the readers. After a flush, which results in exactly one file, the notify mechanism can pass that file&apos;s detail also? So on that we can do the reset.  We will remove the scanner on the snapshot also &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;..  So this can be achieved with lesser code change?  Rather than maintain new Lists and all?&lt;/p&gt;</comment>
                            <comment id="15041680" author="hadoopqa" created="Fri, 4 Dec 2015 16:06:15 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12775763/HBASE-14895.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12775763/HBASE-14895.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 8b3d1f144408e4a7a014c5ac46418c9e91b9b0db.&lt;br/&gt;
  ATTACHMENT ID: 12775763&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 16 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated new checkstyle errors. Check build console for list of new errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16766//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16766//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16766//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16766//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16766//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16766//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16766//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16766//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15044397" author="ram_krish" created="Mon, 7 Dec 2015 05:33:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;After bulk load and compaction we dont need inform the readers. After a flush, which results in exactly one file, the notify mechanism can pass that file&apos;s detail also?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;True. Doing that way one thing that we can avoid is that though we notify the readers on flush only still when a new scanner is created and that time if a file was already comapcted the new heap will have the flushed file and the older  file that was compacted will be removed and we will have the new comapcted file in the heap. Hence we need the above logic to determine the exact new files so that we can seek on all of them.&lt;br/&gt;
Passing the file name on flush is a good suggestion where we will not end up in a situation where there is a new file in the resetted heap that has come out of compaction or bulk load.&lt;/p&gt;</comment>
                            <comment id="15044451" author="chenheng" created="Mon, 7 Dec 2015 06:48:38 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-    List&amp;lt;KeyValueScanner&amp;gt; scanners = getScannersNoCompaction();
+    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isCompaction = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; usePread = get || scanUsePread;
+    List&amp;lt;KeyValueScanner&amp;gt; scanners = store.getScanners(cacheBlocks, get, usePread, isCompaction,
+      matcher, scan.getStartRow(), scan.getStopRow(), &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.readPt);
 
+    scanners = updatedStoreFiles(scanners, store.getComparator());
+    scanners = selectScannersFrom(scanners);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should we move selectScannersFrom out from getScannersNoCompaction, and we could use getScannersNoCompaction directly here?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; Set&amp;lt;StoreFileInfo&amp;gt; existingStoreFileInfos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;StoreFileInfo&amp;gt;();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;What it is used for?   It seems there is no use on it?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    * @param seekKey
    * @param isLazy &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; using lazy seek
    * @param isParallelSeek &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; using parallel seek
+   * @param updatedStoreFile 
    * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
    */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I did not see param updatedStoreFile in seekScanners..... &lt;/p&gt;


</comment>
                            <comment id="15044452" author="anoop.hbase" created="Mon, 7 Dec 2015 06:52:39 +0000"  >&lt;p&gt;Ya adding the new compacted file into heap and seek to that is a real unwanted op.&lt;br/&gt;
Bulk load case it would have been an issue.  We don&apos;t want to include in between bulk loaded files into our scanners.   But a flush in middle might have caused an inconsistency wrt behavior.  So we need change.  You will do a new patch Ram?  I believe that patch will be much smaller in size also. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15044462" author="ram_krish" created="Mon, 7 Dec 2015 07:04:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;We don&apos;t want to include in between bulk loaded files into our scanners. But a flush in middle might have caused an inconsistency wrt behavior. So we need change&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ya sometimes it will create issues because bulk loaded files will get included after a flush and some times not.&lt;br/&gt;
I was working on the patch before &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13082&quot; title=&quot;Coarsen StoreScanner locks to RegionScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13082&quot;&gt;&lt;del&gt;HBASE-13082&lt;/del&gt;&lt;/a&gt; and so all those were needed. Ya will update the patch and thanks for the good point.&lt;/p&gt;</comment>
                            <comment id="15044713" author="ram_krish" created="Mon, 7 Dec 2015 10:23:41 +0000"  >&lt;p&gt;Updated patch based on the suggestion. Now the seek happens only to the newly flushed file and the same is updated into the original list of scanners. Some of the changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14935&quot; title=&quot;ReverseStoreScanner can check for scanner reset before seekToPreviousRow and backwardSeek.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14935&quot;&gt;HBASE-14935&lt;/a&gt; is also here. If the patch is fine I will rebase this after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14935&quot; title=&quot;ReverseStoreScanner can check for scanner reset before seekToPreviousRow and backwardSeek.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14935&quot;&gt;HBASE-14935&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15044734" author="ram_krish" created="Mon, 7 Dec 2015 10:42:29 +0000"  >&lt;p&gt;Reattaching as there were some glitches while trying to submit patch.&lt;/p&gt;</comment>
                            <comment id="15044922" author="hadoopqa" created="Mon, 7 Dec 2015 13:28:44 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12776069/HBASE-14895_1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12776069/HBASE-14895_1.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 8bf70144e40650ef972f005e2465bd0e2a087c40.&lt;br/&gt;
  ATTACHMENT ID: 12776069&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated new checkstyle errors. Check build console for list of new errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16781//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16781//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16781//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16781//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16781//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16781//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16781//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16781//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15046742" author="ram_krish" created="Tue, 8 Dec 2015 11:03:05 +0000"  >&lt;p&gt;Ping for reviews. Know the reason for the checkstyle complaint - one unused import. Will remove it in next patch after reviews. &lt;/p&gt;</comment>
                            <comment id="15047098" author="yuzhihong@gmail.com" created="Tue, 8 Dec 2015 17:25:16 +0000"  >&lt;p&gt;Tests were not actually run:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Printing hanging tests
Hanging test : org.apache.hadoop.hbase.procedure2.TestProcedureRecovery
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Publishing on reviewboard would facilitate review.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="15047168" author="ram_krish" created="Tue, 8 Dec 2015 18:07:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/41093/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/41093/&lt;/a&gt; - RB link.&lt;/p&gt;</comment>
                            <comment id="15048503" author="ram_krish" created="Wed, 9 Dec 2015 11:14:43 +0000"  >&lt;p&gt;Updated patch addressing comments in RB and also did some more changes by removing the nullifyHeap method because we no longer do that and some method and variable renamings.&lt;/p&gt;</comment>
                            <comment id="15048888" author="hadoopqa" created="Wed, 9 Dec 2015 16:05:40 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12776530/HBASE-14895_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12776530/HBASE-14895_2.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 7bfbb6a3c9af4b0e2853b5ea2580a05bb471211b.&lt;br/&gt;
  ATTACHMENT ID: 12776530&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated new checkstyle errors. Check build console for list of new errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16809//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16809//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16809//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16809//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16809//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16809//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16809//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16809//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15052479" author="anoop.hbase" created="Fri, 11 Dec 2015 09:04:11 +0000"  >&lt;p&gt;one issue found wrt maintain the scanners in a new List in StoreScanner (These are memstore scanner and store file scanners at the begin of the scan)&lt;br/&gt;
Over the scan time, some of the scanners would have reached its end and we would have eventually closed them off. And the PriorityQ in KVHeap would have removed them as well.  But we are still holding those refs in this new List in Store Scanner.&lt;br/&gt;
Now after a flush we will use this new List to recreate new Heap. We will remove old MemstoreScaner and add new MemstoreScanner as well as scanner to the new flushed file. And use all of them to create new KVHeap. (This might include already closed StoreFileScanners as well).&lt;br/&gt;
In KVHeap constructor &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
KeyValueHeap(List&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; KeyValueScanner&amp;gt; scanners,
      KVScannerComparator comparator) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.comparator = comparator;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!scanners.isEmpty()) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.heap = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PriorityQueue&amp;lt;KeyValueScanner&amp;gt;(scanners.size(),
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.comparator);
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (KeyValueScanner scanner : scanners) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (scanner.peek() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.heap.add(scanner);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.scannersForDelayedClose.add(scanner);
        }
      }
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.current = pollRealKV();
    }
  }
  &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So the closed scanners wil have peek Cell as null we wont add them to heap. Good. But we will add them to delayed close and after one shipped call we will try close them again&lt;br/&gt;
StoreFileScanner#close()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void close() {
    cur = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.hfs.close();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.reader != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.reader.decrementRefCount();
    }
  }
  &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;No impact because of hfs close. But the decr read ref count will be a problem and can cause issue.&lt;/p&gt;

&lt;p&gt;In a simple way we can we can have closed flag in StoreFileScanner which can be used to check when close call on second time or close call nullifying the reader and hfs on StoreFileScanner.&lt;/p&gt;

&lt;p&gt;Or else if we dont need to maintain a new List of scanners in StoreScanner and make use of the current scanners in the KVHeap for recreating the new heap, that would have looked better. No need to maintain same scanners in 2 data structures.&lt;/p&gt;</comment>
                            <comment id="15052489" author="ram_krish" created="Fri, 11 Dec 2015 09:14:46 +0000"  >&lt;p&gt;Without maintaining two sepreate lists it would not be possible to reset theheap with a StorefileScanner that just got removed from the heap and that is the &apos;current&apos; scanner and then when a reset happens we cannot add it back to the heap since it is already removed from the current heap so iterating that would not give you the &apos;current&apos; scanner.&lt;br/&gt;
So maintaining two DS will help to avoid this problem and hence went with 2 DS.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void close() {
    cur = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.hfs.close();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.reader != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.reader.decrementRefCount();
    }
  }
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This problem of close() can happen in cases when the same completed scanner is doing a close() once again. I can update the patch with that change. Good point and nice catch. &lt;/p&gt;</comment>
                            <comment id="15052492" author="ram_krish" created="Fri, 11 Dec 2015 09:15:19 +0000"  >&lt;p&gt;Same patch just introduced closed boolean in StoreFileScanner. &lt;/p&gt;</comment>
                            <comment id="15052562" author="anoop.hbase" created="Fri, 11 Dec 2015 10:05:38 +0000"  >&lt;p&gt;+1 once QA passes.&lt;/p&gt;</comment>
                            <comment id="15053057" author="ram_krish" created="Fri, 11 Dec 2015 17:30:10 +0000"  >&lt;p&gt;Last time QA did not run. Waiting for one run before commit.&lt;/p&gt;</comment>
                            <comment id="15053464" author="hadoopqa" created="Fri, 11 Dec 2015 19:56:32 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12777006/HBASE-14895_3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12777006/HBASE-14895_3.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 22b95aebcd7fc742412ab514520008fda5e327de.&lt;br/&gt;
  ATTACHMENT ID: 12777006&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated new checkstyle errors. Check build console for list of new errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16832//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16832//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16832//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16832//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16832//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16832//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16832//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16832//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15053776" author="hadoopqa" created="Fri, 11 Dec 2015 23:25:34 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12777077/HBASE-14895_3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12777077/HBASE-14895_3.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 22b95aebcd7fc742412ab514520008fda5e327de.&lt;br/&gt;
  ATTACHMENT ID: 12777077&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated new checkstyle errors. Check build console for list of new errors.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 zombies&lt;/font&gt;. No zombie tests found running at the end of the build.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16837//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16837//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16837//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16837//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16837//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16837//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16837//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16837//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="15055407" author="ram_krish" created="Mon, 14 Dec 2015 04:46:34 +0000"  >&lt;p&gt;Pushed to master. Thanks for the reviews &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoopsamjohn&quot; class=&quot;user-hover&quot; rel=&quot;anoopsamjohn&quot;&gt;Anoop Sam John&lt;/a&gt;. Will raise a backport JIRA for porting &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13082&quot; title=&quot;Coarsen StoreScanner locks to RegionScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13082&quot;&gt;&lt;del&gt;HBASE-13082&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14895&quot; title=&quot;Seek only to the newly flushed file on scanner reset on flush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14895&quot;&gt;&lt;del&gt;HBASE-14895&lt;/del&gt;&lt;/a&gt; to 1.3&lt;/p&gt;</comment>
                            <comment id="15055896" author="hudson" created="Mon, 14 Dec 2015 12:03:12 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-Trunk_matrix #549 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-Trunk_matrix/549/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-Trunk_matrix/549/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14895&quot; title=&quot;Seek only to the newly flushed file on scanner reset on flush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14895&quot;&gt;&lt;del&gt;HBASE-14895&lt;/del&gt;&lt;/a&gt; Seek only to the newly flushed file on scanner reset on (ramkrishna: rev 555d9b70bd650a0df0ed9e382de449c337274493)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFileScanner.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/ChangedReadersObserver.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestStoreScanner.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/ReversedStoreScanner.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestWideScanner.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestBlockEvictionFromClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15055904" author="ram_krish" created="Mon, 14 Dec 2015 12:16:06 +0000"  >&lt;p&gt;This addendum needs to be commited. Pls review. I saw in this in the code today and interestingly the same thing failed in the build today after the commit.&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/HBase-Trunk_matrix/549/jdk=latest1.8,label=Hadoop/testReport/junit/org.apache.hadoop.hbase.regionserver/TestHRegion/testFlushCacheWhileScanning/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-Trunk_matrix/549/jdk=latest1.8,label=Hadoop/testReport/junit/org.apache.hadoop.hbase.regionserver/TestHRegion/testFlushCacheWhileScanning/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15055905" author="ram_krish" created="Mon, 14 Dec 2015 12:17:02 +0000"  >&lt;p&gt;Just reopening for commiting the addendum. &lt;/p&gt;</comment>
                            <comment id="15056270" author="stack" created="Mon, 14 Dec 2015 16:55:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;saw in this in the code today and interestingly the same thing failed in the build today after the commit.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/job/HBase-Trunk_matrix/549/jdk=latest1.8,label=Hadoop/testReport/junit/org.apache.hadoop.hbase.regionserver/TestHRegion/testFlushCacheWhileScanning/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-Trunk_matrix/549/jdk=latest1.8,label=Hadoop/testReport/junit/org.apache.hadoop.hbase.regionserver/TestHRegion/testFlushCacheWhileScanning/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Hurray for a CI that catches issues!!!&lt;/p&gt;
</comment>
                            <comment id="15056273" author="stack" created="Mon, 14 Dec 2015 16:56:17 +0000"  >&lt;p&gt;You need review on the addendum &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; ? Why you need to remove the flush check?&lt;/p&gt;</comment>
                            <comment id="15056401" author="ram_krish" created="Mon, 14 Dec 2015 18:08:15 +0000"  >&lt;p&gt;After this new patch we don&apos;t reset the heap to null when a flush happens. The only time we do is when there is close that happens when the heap.peek() does not return any element. That is what has happened here. The next() call did not yield any cell so the heap was closed and so the heap is null and when we try to do a peek on that heap we got the NPE.&lt;/p&gt;</comment>
                            <comment id="15056402" author="ram_krish" created="Mon, 14 Dec 2015 18:08:48 +0000"  >&lt;p&gt;Same addendum, just calling this.peek instead of this.heap.peek() so that the null check on heap happens.&lt;/p&gt;</comment>
                            <comment id="15057313" author="ram_krish" created="Tue, 15 Dec 2015 04:12:30 +0000"  >&lt;p&gt;Ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoopsamjohn&quot; class=&quot;user-hover&quot; rel=&quot;anoopsamjohn&quot;&gt;Anoop Sam John&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; for reviews before commit. &lt;/p&gt;</comment>
                            <comment id="15057329" author="anoop.hbase" created="Tue, 15 Dec 2015 04:38:00 +0000"  >&lt;p&gt;+1&lt;br/&gt;
Any other similar mistakes we have still?  Will do one more read on the code in StoreScanner.  Good to see tests reveal this. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15057350" author="ram_krish" created="Tue, 15 Dec 2015 05:05:45 +0000"  >&lt;p&gt;Pushed the addendum. Thanks for the quick reviews.&lt;/p&gt;</comment>
                            <comment id="15058015" author="hudson" created="Tue, 15 Dec 2015 12:55:03 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-Trunk_matrix #554 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-Trunk_matrix/554/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-Trunk_matrix/554/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14895&quot; title=&quot;Seek only to the newly flushed file on scanner reset on flush&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14895&quot;&gt;&lt;del&gt;HBASE-14895&lt;/del&gt;&lt;/a&gt; Seek only to the newly flushed file on scanner reset on (ramkrishna: rev 1822bb5d9578e3e650115a220132ab85e7db732a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12775763" name="HBASE-14895.patch" size="28110" author="ram_krish" created="Fri, 4 Dec 2015 12:04:27 +0000"/>
                            <attachment id="12776069" name="HBASE-14895_1.patch" size="22939" author="ram_krish" created="Mon, 7 Dec 2015 10:42:29 +0000"/>
                            <attachment id="12776064" name="HBASE-14895_1.patch" size="22939" author="ram_krish" created="Mon, 7 Dec 2015 10:23:41 +0000"/>
                            <attachment id="12776530" name="HBASE-14895_2.patch" size="24312" author="ram_krish" created="Wed, 9 Dec 2015 11:14:43 +0000"/>
                            <attachment id="12777077" name="HBASE-14895_3.patch" size="25341" author="ram_krish" created="Fri, 11 Dec 2015 17:30:10 +0000"/>
                            <attachment id="12777006" name="HBASE-14895_3.patch" size="25341" author="ram_krish" created="Fri, 11 Dec 2015 09:15:19 +0000"/>
                            <attachment id="12777459" name="HBASE-14895_addendum.patch" size="710" author="ram_krish" created="Mon, 14 Dec 2015 12:16:06 +0000"/>
                            <attachment id="12777517" name="HBASE-14895_addendum_1.patch" size="1139" author="ram_krish" created="Mon, 14 Dec 2015 18:08:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 2 Dec 2015 15:24:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2p21j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>