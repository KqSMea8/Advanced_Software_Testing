<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:33:03 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12440/HBASE-12440.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12440] Region may remain offline on clean startup under certain race condition</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12440</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Saw this in prod some time back with zk assignment&lt;br/&gt;
On clean startup, while master was doing bulk assign while one of the region servers dies. The bulk assigner then tried to assign it individually using AssignCallable. The AssignCallable does a forceStateToOffline() and skips assigning as it wants the SSH to do the assignment&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-10-16 16:05:23,593 DEBUG master.AssignmentManager [AM.-pool1-t1] : Offline sieve_main:inlinks,com.cbslocal.seattle/photo-galleries/category/consumer&lt;span class=&quot;code-comment&quot;&gt;///:http\x09com.cbslocal.seattle/photo-galleries/category/tailgate-fan///:http,1413464068567.1f1620174d2542fe7d5b034f3311c3a8., no need to unassign since it&apos;s on a dead server: gsbl872n06.blue.ygrid.yahoo.com,50511,1413475494016
&lt;/span&gt;2014-10-16 16:05:23,593  INFO master.RegionStates [AM.-pool1-t1] : Transition {1f1620174d2542fe7d5b034f3311c3a8 state=PENDING_OPEN, ts=1413475519482, server=gsbl872n06.blue.ygrid.yahoo.com,50511,1413475494016} to {1f1620174d2542fe7d5b034f3311c3a8 state=OFFLINE, ts=1413475523593, server=gsbl872n06.blue.ygrid.yahoo.com,50511,1413475494016}
2014-10-16 16:05:23,598  INFO master.AssignmentManager [AM.-pool1-t1] : Skip assigning sieve_main:inlinks,com.cbslocal.seattle/photo-galleries/category/consumer&lt;span class=&quot;code-comment&quot;&gt;///:http\x09com.cbslocal.seattle/photo-galleries/category/tailgate-fan///:http,1413464068567.1f1620174d2542fe7d5b034f3311c3a8., it is on a dead but not processed yet server: gsbl872n06.blue.ygrid.yahoo.com,50511,1413475494016&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But the SSH wont assign as the region is offline but not in transition&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-10-16 16:05:24,606  INFO handler.ServerShutdownHandler [MASTER_SERVER_OPERATIONS-hbbl874n38:50510-0] : Reassigning 0 region(s) that gsbl872n06.blue.ygrid.yahoo.com,50511,1413475494016 was carrying (and 0 regions(s) that were opening on &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; server)
2014-10-16 16:05:24,606 DEBUG master.DeadServer [MASTER_SERVER_OPERATIONS-hbbl874n38:50510-0] : Finished processing gsbl872n06.blue.ygrid.yahoo.com,50511,1413475494016
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In zk-less assignment, the bulk assigner invoking AssignCallable and the SSH may try to assign the region. But as they go through lock, only one will succeed and doesn&apos;t seem to be an issue. &lt;/p&gt;


</description>
                <environment></environment>
        <key id="12753556">HBASE-12440</key>
            <summary>Region may remain offline on clean startup under certain race condition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="virag">Virag Kothari</assignee>
                                    <reporter username="virag">Virag Kothari</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Nov 2014 23:22:39 +0000</created>
                <updated>Sat, 21 Feb 2015 23:46:13 +0000</updated>
                            <resolved>Fri, 7 Nov 2014 23:40:43 +0000</resolved>
                                                    <fixVersion>0.98.8</fixVersion>
                    <fixVersion>0.99.2</fixVersion>
                                    <component>Region Assignment</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14201197" author="virag" created="Thu, 6 Nov 2014 23:28:49 +0000"  >&lt;p&gt;Attached is patch for 0.98 which puts the region back in transition for SSH to assign.&lt;br/&gt;
Two minor unrelated changes, 1) Changed assign() so that RPC calls to region server with empty region info list are not sent 2) Changed  timeout on few test cases (TEST_UTIL.assertRegionOnServer(hri, serverName, 6000))&lt;/p&gt;</comment>
                            <comment id="14201304" author="apurtell" created="Fri, 7 Nov 2014 00:46:30 +0000"  >&lt;p&gt;Patch lgtm except:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java b/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java
index 9ae374b..9bf3ce2 100644
--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java
+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java
@@ -176,6 +176,9 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class ServerManager {
 
   /** Listeners that are called on server events. */
   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; List&amp;lt;ServerListener&amp;gt; listeners = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CopyOnWriteArrayList&amp;lt;ServerListener&amp;gt;();
+  
+  /* This is only &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; testing */
+  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; TEST_REMOVE_FROM_ONLINE_SERVERS = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
 
   /**
    * Constructor.
@@ -505,6 +508,9 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class ServerManager {
       LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Master doesn&apos;t enable ServerShutdownHandler during initialization, &quot;&lt;/span&gt;
           + &lt;span class=&quot;code-quote&quot;&gt;&quot;delay expiring server &quot;&lt;/span&gt; + serverName);
       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.queuedDeadServers.add(serverName);
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (TEST_REMOVE_FROM_ONLINE_SERVERS) {
+        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.onlineServers.remove(serverName);
+      }
       &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Yikes, is there another route to a testable change? Reach into ServerManager from the test.&lt;/p&gt;</comment>
                            <comment id="14201814" author="virag" created="Fri, 7 Nov 2014 09:04:27 +0000"  >&lt;p&gt;Thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;&lt;br/&gt;
v2 removes the changes in ServerManager. I overthought the test before.&lt;br/&gt;
Also on branch-1, one of the tests started failing with v1 as the case where the table is disabled before SSH tries to do the assign was not handled. v2 adds a check for that.&lt;/p&gt;</comment>
                            <comment id="14202520" author="apurtell" created="Fri, 7 Nov 2014 19:29:16 +0000"  >&lt;p&gt;The v2 patch lgtm, let me check for a bit that it doesn&apos;t cause any tests to flap or anything like that and will then commit the latest 0.98 and branch-1 patches on this issue. Thanks Virag.&lt;/p&gt;</comment>
                            <comment id="14202916" author="apurtell" created="Fri, 7 Nov 2014 23:20:00 +0000"  >&lt;p&gt;All o.a.h.h.master.** and o.a.h.h.regionserver.** tests pass on 0.98 and branch-1. TestAssignmentManagerOnCluster passes 10 out of 10 times on 0.98 and branch-1.&lt;/p&gt;

&lt;p&gt;Going to push this to both branches shortly&lt;/p&gt;
</comment>
                            <comment id="14202994" author="hudson" created="Sat, 8 Nov 2014 00:20:40 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #632 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/632/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/632/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12440&quot; title=&quot;Region may remain offline on clean startup under certain race condition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12440&quot;&gt;&lt;del&gt;HBASE-12440&lt;/del&gt;&lt;/a&gt; Region may remain offline on clean startup under certain race condition (Virag Kothari) (apurtell: rev d2eb3cf3fa4897333f08dc87e6b830cca5d375ad)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14203084" author="hudson" created="Sat, 8 Nov 2014 01:14:22 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.0 #446 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/446/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/446/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12440&quot; title=&quot;Region may remain offline on clean startup under certain race condition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12440&quot;&gt;&lt;del&gt;HBASE-12440&lt;/del&gt;&lt;/a&gt; Region may remain offline on clean startup under certain race condition (Virag Kothari) (apurtell: rev 87fb974765f4241026ef23f2abf4622ba372ffa9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14203141" author="hudson" created="Sat, 8 Nov 2014 02:12:16 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #663 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/663/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/663/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12440&quot; title=&quot;Region may remain offline on clean startup under certain race condition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12440&quot;&gt;&lt;del&gt;HBASE-12440&lt;/del&gt;&lt;/a&gt; Region may remain offline on clean startup under certain race condition (Virag Kothari) (apurtell: rev d2eb3cf3fa4897333f08dc87e6b830cca5d375ad)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14331734" author="enis" created="Sat, 21 Feb 2015 23:46:13 +0000"  >&lt;p&gt;Closing this issue after 0.99.2 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12679993" name="HBASE-12440-0.98.patch" size="11559" author="virag" created="Thu, 6 Nov 2014 23:28:49 +0000"/>
                            <attachment id="12680118" name="HBASE-12440-0.98_v2.patch" size="10394" author="virag" created="Fri, 7 Nov 2014 09:04:27 +0000"/>
                            <attachment id="12680117" name="HBASE-12440-branch-1.patch" size="11020" author="virag" created="Fri, 7 Nov 2014 09:04:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 7 Nov 2014 00:46:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i222zz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>