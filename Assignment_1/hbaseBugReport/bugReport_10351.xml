<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:12:57 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10351/HBASE-10351.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10351] LoadBalancer changes for supporting region replicas</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10351</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;LoadBalancer has to be aware of and enforce placement of region replicas so that the replicas are not co-hosted in the same server, host or rack. This will ensure that the region is highly available during process / host / rack failover. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12689113">HBASE-10351</key>
            <summary>LoadBalancer changes for supporting region replicas</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12682280">HBASE-10070</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enis">Enis Soztutar</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Jan 2014 22:53:05 +0000</created>
                <updated>Sat, 21 Feb 2015 23:31:44 +0000</updated>
                            <resolved>Wed, 26 Feb 2014 22:17:20 +0000</resolved>
                                    <version>0.99.0</version>
                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>hbase-10070</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13897417" author="enis" created="Tue, 11 Feb 2014 01:32:29 +0000"  >&lt;p&gt;Review board is down again. Attaching v0 patch here instead. &lt;/p&gt;

&lt;p&gt;This patch builds on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10350&quot; title=&quot;Master/AM/RegionStates changes to create and assign region replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10350&quot;&gt;&lt;del&gt;HBASE-10350&lt;/del&gt;&lt;/a&gt;, and includes changes from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=devaraj&quot; class=&quot;user-hover&quot; rel=&quot;devaraj&quot;&gt;Devaraj Das&lt;/a&gt; and myself for load balancer to enforce region replica placement. &lt;/p&gt;

&lt;p&gt;In short, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10350&quot; title=&quot;Master/AM/RegionStates changes to create and assign region replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10350&quot;&gt;&lt;del&gt;HBASE-10350&lt;/del&gt;&lt;/a&gt; enables table creation with region replicas, but won&apos;t have any region placement enforcement. This patch, adds co-location constraints to the LB, so that it does a best effort job to not place replicas of the same region in same hosts / racks. &lt;/p&gt;

&lt;p&gt;The overview of changes are: &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;BaseLoadBalancer.Cluster is aware of hosts and racks for servers&lt;/li&gt;
	&lt;li&gt;BaseLoadBalancer.Cluster is aware of regions per host / rack&lt;/li&gt;
	&lt;li&gt;BaseLoadBalancer.Cluster keeps track of region replicas for co-location enforcement&lt;/li&gt;
	&lt;li&gt;BaseLoadBalancer.Cluster can be constructed with unassigned regions as well. Some refactoring (Action, etc) for better abstractions etc.&lt;/li&gt;
	&lt;li&gt;BaseLoadBalancer.retainAssignments(), etc now construct a Cluster object and use the methods there to ensure co-location constraint. This is a first step in unifying the way we do balance() and table creation, retainAssignment() etc. We can continue with this in other jiras (not part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10070&quot; title=&quot;HBase read high-availability using timeline-consistent region replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10070&quot;&gt;&lt;del&gt;HBASE-10070&lt;/del&gt;&lt;/a&gt;).&lt;/li&gt;
	&lt;li&gt;StochasticLoadBalancer has (high) costs for host/rack replica co-locations and candidate generator for ensuring optimum plan generation. By the way of these cost functions, the LB can satisfy that replicas are not co-located as long as there are enough servers / rack left. If not, it will still do assignment (soft constraint)&lt;/li&gt;
	&lt;li&gt;Bunch of tests to ensure region placement (and speed of balance() run)&lt;/li&gt;
&lt;/ul&gt;

</comment>
                            <comment id="13899705" author="enis" created="Wed, 12 Feb 2014 22:39:19 +0000"  >&lt;p&gt;updated patch for changes in upstream patches (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10350&quot; title=&quot;Master/AM/RegionStates changes to create and assign region replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10350&quot;&gt;&lt;del&gt;HBASE-10350&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10361&quot; title=&quot;Enable/AlterTable support for region replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10361&quot;&gt;&lt;del&gt;HBASE-10361&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="13902161" author="enis" created="Sat, 15 Feb 2014 00:01:56 +0000"  >&lt;p&gt;updated patch for working on top of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10350&quot; title=&quot;Master/AM/RegionStates changes to create and assign region replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10350&quot;&gt;&lt;del&gt;HBASE-10350&lt;/del&gt;&lt;/a&gt;. I&apos;ve fixed a couple of  issues with retainAssignment() and roundRobinAssignment() &lt;/p&gt;</comment>
                            <comment id="13902168" author="enis" created="Sat, 15 Feb 2014 00:06:16 +0000"  >&lt;p&gt;I could not get RB to apply my patch (with a parent patch). &lt;/p&gt;

&lt;p&gt;You can review from github:&lt;br/&gt;
&lt;a href=&quot;https://github.com/enis/hbase/commit/276f8256a7241247d2fc9f7c02adf28f3fbd9ba5&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/enis/hbase/commit/276f8256a7241247d2fc9f7c02adf28f3fbd9ba5&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13907334" author="sershe" created="Thu, 20 Feb 2014 19:07:56 +0000"  >&lt;p&gt;I am reviewing, btw &lt;/p&gt;</comment>
                            <comment id="13907343" author="sershe" created="Thu, 20 Feb 2014 19:13:30 +0000"  >&lt;p&gt;Left some comments yesterday and today... I didn&apos;t review tests very carefully. The rest seems ok (except where noted) although the array manipulations are rather complex and meaning is not always clear, so I might have missed something. In general more comments would help &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13908907" author="devaraj" created="Fri, 21 Feb 2014 22:26:22 +0000"  >&lt;p&gt;Other than the point Sergey raised about putting some comments in the code around the array manipulations, and maybe breaking the manipulations into smaller methods, it looks good to me.&lt;br/&gt;
The one issue that is there I think is that the test (TestMasterOperationsForReplicas) may be flaky (the part where retain assignments is set to true). The reason being, that in the retainAssignment there is max iterations for choosing the server to place the region in but that may not be correct location given the replicas. I think it&apos;s fine to leave the balancer&apos;s assign methods as you currently have it (eventually the balancer.balance will fix it), but modify the test to be able to handle that.&lt;br/&gt;
Another minor nit is that in roundRobinAssignment, we could land up in the catch-all anytime we have numReplicas &amp;gt; numRegionServers. The comment in the catch-all code should be updated.&lt;br/&gt;
The refactor to do with introducing the Action class is good!&lt;/p&gt;</comment>
                            <comment id="13909029" author="sershe" created="Sat, 22 Feb 2014 00:18:11 +0000"  >&lt;p&gt;Is this the same patch I reviewed on github? What is the refactor of Action class, I may have missed that&lt;/p&gt;</comment>
                            <comment id="13909030" author="sershe" created="Sat, 22 Feb 2014 00:18:33 +0000"  >&lt;p&gt;oh, nm, I thought it&apos;s about MultiAction-Action part, the cluster actions I have seen&lt;/p&gt;</comment>
                            <comment id="13912015" author="enis" created="Tue, 25 Feb 2014 20:28:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;Left some comments yesterday and today&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks! v4 patch addressed all the reviews there. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;although the array manipulations are rather complex and meaning is not always clear &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;When we unwound hashmap + hashset operations into array and index based ones for performance, we ended up un-javaifying that code. Not much to do about it (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8119&quot; title=&quot;Optimize StochasticLoadBalancer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8119&quot;&gt;&lt;del&gt;HBASE-8119&lt;/del&gt;&lt;/a&gt; for ref) &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The one issue that is there I think is that the test (TestMasterOperationsForReplicas) may be flaky&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It seems fine in my runs. retain assignment now also looks for availability and finds the best server while retaining the host locality. We can fix it if we see flakiness. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The comment in the catch-all code should be updated.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fixed. &lt;/p&gt;</comment>
                            <comment id="13912092" author="enis" created="Tue, 25 Feb 2014 21:34:20 +0000"  >&lt;p&gt;Thanks for reviews! &lt;br/&gt;
v4 changes: &lt;a href=&quot;https://github.com/enis/hbase/commit/f32d581d8b832905d9aa5753f2fd09bd83a1fe5e&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/enis/hbase/commit/f32d581d8b832905d9aa5753f2fd09bd83a1fe5e&lt;/a&gt;&lt;br/&gt;
v5 changes: &lt;a href=&quot;https://github.com/enis/hbase/commit/89dd40875af96e74405a727f32a2192afc8bfb8e&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/enis/hbase/commit/89dd40875af96e74405a727f32a2192afc8bfb8e&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Complete v5 patch: &lt;a href=&quot;https://github.com/enis/hbase/compare/55355004fe21e926f7d0053b9aae154c742fbd45...hbase-10351#diff-ee791396bd76597ef9f2ecddc4c6d112L63&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/enis/hbase/compare/55355004fe21e926f7d0053b9aae154c742fbd45...hbase-10351#diff-ee791396bd76597ef9f2ecddc4c6d112L63&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I am also attaching the v5 patch. &lt;/p&gt;</comment>
                            <comment id="13913229" author="sershe" created="Wed, 26 Feb 2014 17:51:44 +0000"  >&lt;p&gt;some minor comments (in response to old comments and on v4). Mostly looks good&lt;/p&gt;</comment>
                            <comment id="13913415" author="enis" created="Wed, 26 Feb 2014 20:01:09 +0000"  >&lt;p&gt;Thanks Sergey. I&apos;ve addressed the comments in v6: &lt;a href=&quot;https://github.com/enis/hbase/commit/0743a551dba2e6d3428ea3064929b7ff46734c9f&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/enis/hbase/commit/0743a551dba2e6d3428ea3064929b7ff46734c9f&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13913493" author="sershe" created="Wed, 26 Feb 2014 20:57:12 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13913556" author="enis" created="Wed, 26 Feb 2014 21:47:37 +0000"  >&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10620&quot; title=&quot;LoadBalancer.needsBalance() should check for co-located region replicas as well&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10620&quot;&gt;&lt;del&gt;HBASE-10620&lt;/del&gt;&lt;/a&gt; for fixing LB.needsBalance() for region replicas. &lt;/p&gt;</comment>
                            <comment id="13913608" author="enis" created="Wed, 26 Feb 2014 22:17:20 +0000"  >&lt;p&gt;I&apos;ve committed this to branch. Thanks Devaraj and Sergey for reviews. &lt;/p&gt;</comment>
                            <comment id="13913611" author="enis" created="Wed, 26 Feb 2014 22:19:10 +0000"  >&lt;p&gt;v7 is the committed version with minor conflict resolution. &lt;/p&gt;</comment>
                            <comment id="14046611" author="enis" created="Sat, 28 Jun 2014 01:47:02 +0000"  >&lt;p&gt;Attaching rebased patch for master that is committed&lt;/p&gt;</comment>
                            <comment id="14046660" author="enis" created="Sat, 28 Jun 2014 02:07:45 +0000"  >&lt;p&gt;Committed to master as part of hbase-10070 branch merge&lt;/p&gt;</comment>
                            <comment id="14046765" author="hudson" created="Sat, 28 Jun 2014 06:14:34 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5245 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5245/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5245/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10351&quot; title=&quot;LoadBalancer changes for supporting region replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10351&quot;&gt;&lt;del&gt;HBASE-10351&lt;/del&gt;&lt;/a&gt; LoadBalancer changes for supporting region replicas (enis: rev a98f52953a0d8fdde2eb37110436967c7121d52c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/BaseLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestMasterOperationsForRegionReplicas.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/BalancerTestBase.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/RegionStates.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/StochasticLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/TestStochasticLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/RegionLocationFinder.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/balancer/FavoredNodeLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/balancer/TestBaseLoadBalancer.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionReplicas.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/RackManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14330864" author="enis" created="Sat, 21 Feb 2015 23:31:44 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12697464">HBASE-10620</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12689126">HBASE-10355</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12652950" name="0012-HBASE-10351-LoadBalancer-changes-for-supporting-regi.patch" size="136398" author="enis" created="Sat, 28 Jun 2014 01:47:01 +0000"/>
                            <attachment id="12628133" name="hbase-10351_v0.patch" size="103822" author="enis" created="Tue, 11 Feb 2014 01:32:29 +0000"/>
                            <attachment id="12628591" name="hbase-10351_v1.patch" size="112165" author="enis" created="Wed, 12 Feb 2014 22:39:19 +0000"/>
                            <attachment id="12629165" name="hbase-10351_v3.patch" size="117357" author="enis" created="Sat, 15 Feb 2014 00:01:56 +0000"/>
                            <attachment id="12631045" name="hbase-10351_v5.patch" size="123594" author="enis" created="Tue, 25 Feb 2014 21:34:20 +0000"/>
                            <attachment id="12631337" name="hbase-10351_v6.patch" size="123744" author="enis" created="Wed, 26 Feb 2014 20:01:09 +0000"/>
                            <attachment id="12631368" name="hbase-10351_v7.patch" size="118736" author="enis" created="Wed, 26 Feb 2014 22:19:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 20 Feb 2014 19:07:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368080</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rfyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368385</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>