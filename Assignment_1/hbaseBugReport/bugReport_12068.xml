<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:29:22 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12068/HBASE-12068.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12068] [Branch-1] Avoid need to always do KeyValueUtil#ensureKeyValue for Filter transformCell</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12068</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;During read with Filters added to Scan/Get, the core code calls transformCell(Cell) on the Filter. Most of the filters do not implement transform API so the method from FilterBase will get executed&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Cell transformCell(Cell v) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-comment&quot;&gt;// Old filters based off of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; class will override KeyValue transform(KeyValue).
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// Thus to maintain compatibility we need to call the old version.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; transform(KeyValueUtil.ensureKeyValue(v));
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here always it do KeyValueUtil.ensureKeyValue.  When a non KV cell comes in, we need recreate KV and do deep copy of key and value!&lt;br/&gt;
We have to stick with this model in branch-1 for BC.&lt;br/&gt;
So as a workaround to avoid possible KV convert, we can implement transformCell(Cell) method in all of our individual Filter classes which just return the incoming cell (So that method from FilterBase wont get executed)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12743564">HBASE-12068</key>
            <summary>[Branch-1] Avoid need to always do KeyValueUtil#ensureKeyValue for Filter transformCell</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12738194">HBASE-11871</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anoop.hbase">Anoop Sam John</assignee>
                                    <reporter username="anoop.hbase">Anoop Sam John</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Sep 2014 18:01:09 +0000</created>
                <updated>Sat, 21 Feb 2015 23:41:29 +0000</updated>
                            <resolved>Wed, 24 Sep 2014 07:54:10 +0000</resolved>
                                    <version>0.99.0</version>
                                    <fixVersion>0.99.1</fixVersion>
                                    <component>Filters</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14145149" author="anoop.hbase" created="Tue, 23 Sep 2014 18:06:06 +0000"  >&lt;p&gt;The patch also avoids KeyValueUtil#ensureKeyValue calls from DependentColumnFilter, SingleColumnValueExcludeFilter and SingleColumnValueFilter. All where simple cases for removal. (These calls not present trunk code)&lt;/p&gt;</comment>
                            <comment id="14145229" author="enis" created="Tue, 23 Sep 2014 18:50:55 +0000"  >&lt;p&gt;+1. Thanks Anoop. Should we also ensure Phoenix Filters also override transformCell() as a follow up.&lt;/p&gt;</comment>
                            <comment id="14145243" author="stack" created="Tue, 23 Sep 2014 18:58:07 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;On commit add comment to each instance where you are doing this pass-through. Otherwise I see folks looking at it and just being stumped why. Add release note. I added note to our 1.0 issue that we need to call this one out in release notes: &quot;If you have written your own filter...&quot;&lt;/p&gt;</comment>
                            <comment id="14145255" author="enis" created="Tue, 23 Sep 2014 19:02:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;release notes: &quot;If you have written your own filter...&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1. That would be good mentioning that you better implement the new method yourself for better performance. &lt;/p&gt;</comment>
                            <comment id="14145735" author="anoop.hbase" created="Wed, 24 Sep 2014 01:14:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;On commit add comment to each instance where you are doing this pass-through. Otherwise I see folks looking at it and just being stumped why. Add release note. I added note to our 1.0 issue that we need to call this one out in release notes: &quot;If you have written your own filter...&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sure.&lt;br/&gt;
Thanks for the review Stack &amp;amp; Enis.&lt;br/&gt;
Yes &lt;a href=&quot;https://issues.apache.org/jira/browse/PHOENIX-1282&quot; title=&quot;Remove usage of KeyValueUtil.ensureKeyValue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PHOENIX-1282&quot;&gt;PHOENIX-1282&lt;/a&gt; is the issue in Phoenix side for the followup there.  In Phoenix master will have to do. 4.0 is based on 0.98 and there all are KeyValues any way.&lt;/p&gt;</comment>
                            <comment id="14146026" author="anoop.hbase" created="Wed, 24 Sep 2014 07:54:10 +0000"  >&lt;p&gt;Pushed to branch-1.  Thanks for the reviews Stack &amp;amp; Enis.&lt;/p&gt;</comment>
                            <comment id="14146191" author="hudson" created="Wed, 24 Sep 2014 10:48:37 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #224 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/224/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/224/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12068&quot; title=&quot;[Branch-1] Avoid need to always do KeyValueUtil#ensureKeyValue for Filter transformCell&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12068&quot;&gt;&lt;del&gt;HBASE-12068&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;Branch-1&amp;#93;&lt;/span&gt; Avoid need to always do KeyValueUtil#ensureKeyValue for Filter transformCell. (anoopsamjohn: rev af35daac777c06639d3eb1985def4846fda84cbb)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/RandomRowFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/PageFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/InclusiveStopFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/FirstKeyOnlyFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityController.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/SingleColumnValueExcludeFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/ColumnRangeFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/DependentColumnFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/access/AccessControlFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/SingleColumnValueFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/PrefixFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/ColumnPrefixFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/FuzzyRowFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/FilterList.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/ColumnPaginationFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/filter/FilterAllFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/TimestampsFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/FilterBase.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/MultipleColumnPrefixFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/CompareFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/FilterWrapper.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityLabelFilter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/Filter.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/filter/ColumnCountGetFilter.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14188134" author="hudson" created="Wed, 29 Oct 2014 08:32:43 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #5714 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5714/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5714/&lt;/a&gt;)&lt;br/&gt;
Add note to upgrade section on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12068&quot; title=&quot;[Branch-1] Avoid need to always do KeyValueUtil#ensureKeyValue for Filter transformCell&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12068&quot;&gt;&lt;del&gt;HBASE-12068&lt;/del&gt;&lt;/a&gt;; i.e. things to do if you have custom filters (stack: rev 3a9cf5b2cdc3c3d24a085b3a4d4c289dcce09766)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/main/docbkx/upgrading.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14331508" author="enis" created="Sat, 21 Feb 2015 23:41:29 +0000"  >&lt;p&gt;Closing this issue after 0.99.1 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12743142">HBASE-12048</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12670759" name="HBASE-12068.patch" size="30502" author="anoop.hbase" created="Tue, 23 Sep 2014 18:06:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 23 Sep 2014 18:50:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20efz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>When custom Filters are used, make sure to override Cell based methods and not keyValue based methods. ie.&lt;br/&gt;
transformCell(Cell) instead of transform(KeyValue) &lt;br/&gt;
getNextCellHint(Cell) instead of getNextKeyHint(KeyValue)&lt;br/&gt;
Else there can be possible performance hit of a conversion of a non KV Cell to a KV which required key and value deep copy.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>