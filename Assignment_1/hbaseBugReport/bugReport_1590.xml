<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:54:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1590/HBASE-1590.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1590] Extend TestHeapSize and ClassSize to do &quot;deep&quot; sizing of Objects</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1590</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;As discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1554&quot; title=&quot;TestHeapSize failing on Hudson&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1554&quot;&gt;&lt;del&gt;HBASE-1554&lt;/del&gt;&lt;/a&gt; there is a bit of a disconnect between how ClassSize calculates the heap size and how we need to calculate heap size in our implementations.&lt;/p&gt;

&lt;p&gt;For example, the LRU block cache can be sized via ClassSize, but it is a shallow sizing.  There is a backing ConcurrentHashMap that is the largest memory consumer.  However, ClassSize only counts that as a single reference.  But in our heapSize() reporting, we want to include &lt;b&gt;everything&lt;/b&gt; within that Object.&lt;/p&gt;

&lt;p&gt;This issue is to resolve that dissonance.  We may need to create an additional ClassSize.estimateDeep(), we may need to rethink our HeapSize interface, or maybe just leave it as is.  The two primary goals of all this testing is to 1) ensure that if something is changed and the sizing is not updated, our tests fail, and 2) ensure our sizing is as accurate as possible.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12429124">HBASE-1590</key>
            <summary>Extend TestHeapSize and ClassSize to do &quot;deep&quot; sizing of Objects</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="streamy">Jonathan Gray</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Jun 2009 21:01:45 +0000</created>
                <updated>Sun, 8 Jun 2014 21:53:50 +0000</updated>
                            <resolved>Sun, 8 Jun 2014 21:53:50 +0000</resolved>
                                    <version>0.20.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12725440" author="streamy" created="Tue, 30 Jun 2009 02:39:13 +0000"  >&lt;p&gt;I&apos;m not sure we need to do this anymore.  Patch going in for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1591&quot; title=&quot;HBASE-1554 broke org.apache.hadoop.hbase.io.hfile.TestLruBlockCache.testResizeBlockCache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1591&quot;&gt;&lt;del&gt;HBASE-1591&lt;/del&gt;&lt;/a&gt; cleaned up LruBlockCache heapsizing and it works well now and is accurate.&lt;/p&gt;

&lt;p&gt;Remaining issues are... &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;How do we really ensure sizing of the protected members of things like ConcurrentHashMap (Entry and Segment).  Can use SizeOf but would rather try to do some hackery/reflection business so we can dig in with ClassSize.&lt;/li&gt;
	&lt;li&gt;Review of MemStore heapSize implementation... Same issue as above for ConcurrentSkipListMap&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12725458" author="stack" created="Tue, 30 Jun 2009 03:48:04 +0000"  >&lt;p&gt;Move it out of 0.20.0?&lt;/p&gt;</comment>
                            <comment id="12725469" author="streamy" created="Tue, 30 Jun 2009 04:44:22 +0000"  >&lt;p&gt;Let&apos;s keep it open, would like to get Erik&apos;s input tomorrow.&lt;/p&gt;

&lt;p&gt;We need to address above 2 issues, this is as fine a place as any.&lt;/p&gt;</comment>
                            <comment id="12726234" author="erikholstad@gmail.com" created="Wed, 1 Jul 2009 21:38:46 +0000"  >&lt;p&gt;Have been working on a deepClassSize and have a working version of it. There are a couple of things that makes the whole concept of checking the size of a class rather than &lt;br/&gt;
an object hard. Let&apos;s take the TreeMap as an example, it has a reference to the root entry which in has references to entry left, right and parent, so how do you know when to stop?&lt;/p&gt;

&lt;p&gt;From the two main goals we already have 1 so we have 2 left.&lt;br/&gt;
One thing we could do, is to lift some test code using Instrumention.getObjectSize() into some test, so we don&apos;t have to include the jar. The problem is then how we should run it, since it requires  -javaagent:/home/erik/src/tgzs/SizeOf.jar at the moment. Will see if I can work around this, to be able to use in unit test.&lt;/p&gt;</comment>
                            <comment id="12726239" author="nitay" created="Wed, 1 Jul 2009 21:55:48 +0000"  >&lt;p&gt;What if you maintain a Set&amp;lt;Object&amp;gt; of references that have been counted already. That way you can traverse any data structure and check if you need to recurse. For example, when you get to the &apos;parent&apos; reference you&apos;ll see it has already been counted so you just count the reference itself without recursing into it. &lt;/p&gt;</comment>
                            <comment id="12726260" author="stack" created="Wed, 1 Jul 2009 23:03:14 +0000"  >&lt;p&gt;@holstad is Instrumention.getObjectSize() a sizeof call?  SizeOf is GPL, right?  Let me know if you want me to work on build to add like we have for clover where you point at a sizeof install and then run an ant task with -javaagent:/home/erik/src/tgzs/SizeOf.jar.  We could run this as part of hudson build (I think &amp;#8211; maybe GPL code is disallowed up on hudson ... would have to see)... or we could run it as part of release.&lt;/p&gt;</comment>
                            <comment id="12726272" author="erikholstad@gmail.com" created="Wed, 1 Jul 2009 23:35:23 +0000"  >&lt;p&gt;@Nitay,  yes that would work if we were checking sizes of Objects, but now we are just dealing with classes so it is very hard to take that approach.&lt;/p&gt;

&lt;p&gt;@Stack,  yup it is GPL, I just wasn&apos;t sure how you would add specific -jvm arguments to Hudson, been trying to get it to work from within eclipse without setting the arguments but without any luck so far. Seems like there are some tools that ship with the sun version but not with Openjdk until 7. So if we can run it with the arguments for now would be really nice.&lt;/p&gt;
</comment>
                            <comment id="12726675" author="streamy" created="Thu, 2 Jul 2009 20:55:14 +0000"  >&lt;p&gt;Punting to 0.20.1 ... Doing something for this will be useful but let&apos;s not hold up 0.20.0&lt;/p&gt;

&lt;p&gt;What needs to be done for 0.20.0 will now be handled over in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1607&quot; title=&quot;Redo MemStore heap sizing to be accurate, testable, and more like new LruBlockCache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1607&quot;&gt;&lt;del&gt;HBASE-1607&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12742637" author="streamy" created="Wed, 12 Aug 2009 22:52:42 +0000"  >&lt;p&gt;All testing on 0.20 shows we are more than okay w.r.t. our HeapSizing.  Will open a new issue against 0.21 if we do need any further improvements.&lt;/p&gt;</comment>
                            <comment id="12742654" author="stack" created="Wed, 12 Aug 2009 23:39:12 +0000"  >&lt;p&gt;Mind if I keep this open JG?  I think it&apos;d be sweet integrating the sizeof  jar fetching it if user asks for it.  Maybe when we move build to ivy it wouldn&apos;t be too hard.&lt;/p&gt;</comment>
                            <comment id="12742656" author="stack" created="Wed, 12 Aug 2009 23:39:43 +0000"  >&lt;p&gt;Assigned me, moved to 0.21 and made it trivial.&lt;/p&gt;</comment>
                            <comment id="12867030" author="stack" created="Thu, 13 May 2010 04:42:07 +0000"  >&lt;p&gt;Moved from 0.21 to 0.22 just after merge of old 0.20 branch into TRUNK.&lt;/p&gt;</comment>
                            <comment id="13047658" author="stack" created="Fri, 10 Jun 2011 22:58:15 +0000"  >&lt;p&gt;Moving out of 0.92.  Move it back in if you think differently.&lt;/p&gt;</comment>
                            <comment id="13047673" author="stack" created="Fri, 10 Jun 2011 22:58:18 +0000"  >&lt;p&gt;Moving out of 0.92.  Move it back in if you think differently.&lt;/p&gt;</comment>
                            <comment id="14021416" author="apurtell" created="Sun, 8 Jun 2014 21:53:50 +0000"  >&lt;p&gt;Stale issue. Reopen if still relevant (if there&apos;s new activity)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 30 Jun 2009 03:48:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32201</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0he5r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99556</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>