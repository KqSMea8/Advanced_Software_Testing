<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:58:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14988/HBASE-14988.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14988] AssertionError: results.length when doing batch with large number of increment</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14988</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Tried to do a 10K increment with batch. When using &lt;br/&gt;
public void batch(List&amp;lt;? extends Row&amp;gt; actions, Object[] results) &lt;br/&gt;
got &lt;br/&gt;
java.lang.reflect.InvocationTargetException&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)&lt;br/&gt;
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)&lt;br/&gt;
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)&lt;br/&gt;
	at java.lang.reflect.Method.invoke(Method.java:606)&lt;br/&gt;
	at com.simontuffs.onejar.Boot.run(Boot.java:340)&lt;br/&gt;
	at com.simontuffs.onejar.Boot.main(Boot.java:166)&lt;br/&gt;
Caused by: java.lang.AssertionError: results.length&lt;br/&gt;
	at org.apache.hadoop.hbase.client.AsyncProcess$AsyncRequestFutureImpl.&amp;lt;init&amp;gt;(AsyncProcess.java:763)&lt;br/&gt;
	at org.apache.hadoop.hbase.client.AsyncProcess.createAsyncRequestFuture(AsyncProcess.java:1578)&lt;br/&gt;
	at org.apache.hadoop.hbase.client.AsyncProcess.submitAll(AsyncProcess.java:554)&lt;br/&gt;
	at org.apache.hadoop.hbase.client.HTable.batch(HTable.java:1000)&lt;/p&gt;

&lt;p&gt;Interestingly no exception is thrown when using the deprecated method &lt;br/&gt;
public Object[] batch(List&amp;lt;? extends Row&amp;gt; actions)&lt;/p&gt;

&lt;p&gt;This is a sample code in Scala:&lt;/p&gt;

&lt;p&gt;val table = connection.getTable(TableName.valueOf(&quot;test_table&quot;))&lt;br/&gt;
val increments = for (i &amp;lt;- 0 until 10000) yield &lt;/p&gt;
{
val increment = new Increment(Random.nextDouble().toString.getBytes)
increment.addColumn(family, qualifier, Random.nextLong())
increment
}
&lt;p&gt;table.batch(increments, Array.empty&lt;span class=&quot;error&quot;&gt;&amp;#91;Object&amp;#93;&lt;/span&gt;)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12922215">HBASE-14988</key>
            <summary>AssertionError: results.length when doing batch with large number of increment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kmlk15">Keith Lui</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Dec 2015 00:50:55 +0000</created>
                <updated>Thu, 17 Dec 2015 07:33:46 +0000</updated>
                                            <version>1.0.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="15060669" author="ndimiduk" created="Wed, 16 Dec 2015 19:48:18 +0000"  >&lt;p&gt;Do other operations work with this onejar thing? I suspect it&apos;s muddled with the classloaders and is causing trouble.&lt;/p&gt;

&lt;p&gt;Regardless, this looks like it warrants a discussion on the mailing list until we know what need fixed in HBase. Please start a thread over on user@hbase.apache.org. We can reopen this ticket once we&apos;ve identified what product fix (if any) is required.&lt;/p&gt;</comment>
                            <comment id="15060728" author="kmlk15" created="Wed, 16 Dec 2015 20:04:20 +0000"  >&lt;p&gt;It&apos;s not related to the onejar for sure. Same issue happens when running in Apache Spark Streaming which tries to consume data from Kafka and writes to HBase.&lt;/p&gt;

&lt;p&gt;java.lang.AssertionError: results.length&lt;br/&gt;
    at org.apache.hadoop.hbase.client.AsyncProcess$AsyncRequestFutureImpl.&amp;lt;init&amp;gt;(AsyncProcess.java:763)&lt;br/&gt;
    at org.apache.hadoop.hbase.client.AsyncProcess.createAsyncRequestFuture(AsyncProcess.java:1578)&lt;br/&gt;
    at org.apache.hadoop.hbase.client.AsyncProcess.submitAll(AsyncProcess.java:554)&lt;br/&gt;
    at org.apache.hadoop.hbase.client.HTable.batch(HTable.java:1000)&lt;/p&gt;

&lt;p&gt;This error will not show up and run smoothly when using the deprecated batch method. In addition, when the number of increments decrease to 1K, it will not run into the same assertion error. So the issue should be related to the new batch method when the numbers of increment is huge. &lt;/p&gt;</comment>
                            <comment id="15060872" author="ndimiduk" created="Wed, 16 Dec 2015 21:09:31 +0000"  >&lt;p&gt;I read too quickly. This is apparently not related to the onejar reflection.&lt;/p&gt;</comment>
                            <comment id="15061657" author="anoop.hbase" created="Thu, 17 Dec 2015 07:33:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;table.batch(increments, Array.empty&lt;span class=&quot;error&quot;&gt;&amp;#91;Object&amp;#93;&lt;/span&gt;)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You seems not passing the Result array of required size.  The size should be same as that of the &apos;increments&apos; list.&lt;br/&gt;
In case of deprecated API, it was internally creating a Result array of needed size correctly.  Pls correct the code and check once.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Dec 2015 19:48:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2py9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>