<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:10:47 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3507/HBASE-3507.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3507] requests count per HRegion</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3507</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Path-1 add another mertic for HRegion to count request made to region.&lt;/p&gt;

&lt;p&gt;Path-2 add another command to hbase shell to grab all regions, sort by requests from Path-1 and move in round-robin algorithm to servers&lt;/p&gt;</description>
                <environment></environment>
        <key id="12497873">HBASE-3507</key>
            <summary>requests count per HRegion</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="anih">Sebastian Bauer</reporter>
                        <labels>
                    </labels>
                <created>Mon, 7 Feb 2011 17:21:57 +0000</created>
                <updated>Fri, 20 Nov 2015 12:41:34 +0000</updated>
                            <resolved>Sun, 18 Sep 2011 19:07:12 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                                    <component>metrics</component>
                    <component>Performance</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="12991482" author="anih" created="Mon, 7 Feb 2011 17:23:11 +0000"  >&lt;p&gt;Path-1&lt;/p&gt;</comment>
                            <comment id="12991483" author="anih" created="Mon, 7 Feb 2011 17:23:33 +0000"  >&lt;p&gt;Path-2&lt;/p&gt;</comment>
                            <comment id="12991605" author="yuzhihong@gmail.com" created="Mon, 7 Feb 2011 21:03:31 +0000"  >&lt;p&gt;In rebalance(), regions_table maps request count to region. However, we should consider regions with same number of requests - hash collision.&lt;br/&gt;
Also, we should consider the current region assignment before calling admin.move()&lt;br/&gt;
e.g. consider the top two most heavily read regions A (on RS1) and B (on RS2)&lt;br/&gt;
If later requests for B get higher than requests for A, current patch would shuffle region A (to RS2) with region B - an unnecessary action.&lt;br/&gt;
Using more complex logic, we should balance the sum of requests landed on each region server.&lt;/p&gt;</comment>
                            <comment id="12991609" author="ryanobjc" created="Mon, 7 Feb 2011 21:08:01 +0000"  >&lt;p&gt;how frequently would you move regions?  Moving a highly loaded region under load might be more disruptive than leaving where it is... Using a more sophisticated algorithm that uses a decaying moving average over some period of time seems like that might have a better impact.  For example do you move a region because it gets hot for 30 seconds? 1 minute? 5 minutes? 10 minutes even?  I&apos;m not sure where the line is, but it seems like the goal should be to move regions for persistent high long term load, not transient spikes.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="12991614" author="anih" created="Mon, 7 Feb 2011 21:18:16 +0000"  >&lt;p&gt;@Ted Yu: maybe average from all regionservers requests counters and if regionserver diverge from this average(+/- some percent) we move region that leverage this?&lt;/p&gt;


&lt;p&gt;@rayan rawson: this was needed only once after hadoop big crash when hbase cannot reassign regions to the same regionservers. In this form rebalance is not for frequently use&lt;/p&gt;</comment>
                            <comment id="12991615" author="yuzhihong@gmail.com" created="Mon, 7 Feb 2011 21:19:23 +0000"  >&lt;p&gt;I agree.&lt;br/&gt;
We may also provide number of read requests metric along side total number of requests.&lt;br/&gt;
Write requests are currently get balanced in the form of split regions.&lt;br/&gt;
We should establish different load balancing policies favoring:&lt;br/&gt;
1. read requests&lt;br/&gt;
2. write requests&lt;br/&gt;
3. read and write requests&lt;/p&gt;</comment>
                            <comment id="12991619" author="anih" created="Mon, 7 Feb 2011 21:25:11 +0000"  >&lt;p&gt;how writes balancing properly? i think childrens from split can land in one regionserver? and what with increaments, this is special case because this type of writes doesn&apos;t trigger splits so often&lt;/p&gt;</comment>
                            <comment id="12991623" author="yuzhihong@gmail.com" created="Mon, 7 Feb 2011 21:39:16 +0000"  >&lt;p&gt;What I did in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3373&quot; title=&quot;Allow regions to be load-balanced by table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3373&quot;&gt;&lt;del&gt;HBASE-3373&lt;/del&gt;&lt;/a&gt; is to rebalance newly split regions onto other region servers.&lt;/p&gt;</comment>
                            <comment id="12992151" author="yuzhihong@gmail.com" created="Tue, 8 Feb 2011 20:12:23 +0000"  >&lt;p&gt;TestHeapSize would fail without the following change in HRegion:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; FIXED_OVERHEAD = ClassSize.align(
      (5 * Bytes.SIZEOF_LONG) +
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12992665" author="yuzhihong@gmail.com" created="Wed, 9 Feb 2011 19:07:59 +0000"  >&lt;p&gt;In table.jsp, we should provide option to sort regions by request count.&lt;/p&gt;</comment>
                            <comment id="12993386" author="anih" created="Fri, 11 Feb 2011 08:23:20 +0000"  >&lt;p&gt;what is a difference between FIXED_OVERHEAD and DEEP_OVERHEAD? because memstoreSize is in DEEP_OVERHEAD&lt;/p&gt;</comment>
                            <comment id="12993446" author="anih" created="Fri, 11 Feb 2011 11:09:10 +0000"  >&lt;p&gt;new patch have long requestsCount and changed FIXED_OVERHEAD to pass TestHeapSize&lt;/p&gt;</comment>
                            <comment id="13005296" author="yuzhihong@gmail.com" created="Thu, 10 Mar 2011 19:59:11 +0000"  >&lt;p&gt;In preparation for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3616&quot; title=&quot;Add per region request information to HServerLoad&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3616&quot;&gt;&lt;del&gt;HBASE-3616&lt;/del&gt;&lt;/a&gt;, I think we need to enhance this method in SplitTransaction:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 HRegion createDaughterRegion(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HRegionInfo hri,
     &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; FlushRequester flusher)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;requestsCount is initially 0 for daughter regions which doesn&apos;t reflect the fact that parent region has been heavily accessed.&lt;br/&gt;
Maybe we can assign half of requestsCount of parent region to each daughter region ?&lt;/p&gt;</comment>
                            <comment id="13005356" author="yuzhihong@gmail.com" created="Thu, 10 Mar 2011 22:21:48 +0000"  >&lt;p&gt;Here is the patch that removes balancing portion and adds handling of region split/merge.&lt;/p&gt;</comment>
                            <comment id="13005489" author="stack" created="Fri, 11 Mar 2011 05:01:28 +0000"  >&lt;p&gt;@Ted How does your patch relate to Sebastians?&lt;/p&gt;</comment>
                            <comment id="13005490" author="stack" created="Fri, 11 Mar 2011 05:02:45 +0000"  >&lt;p&gt;@Ted On splitting requests between daughters, that sounds good.&lt;/p&gt;</comment>
                            <comment id="13005491" author="yuzhihong@gmail.com" created="Fri, 11 Mar 2011 05:06:21 +0000"  >&lt;p&gt;My patch is based on Sebastian&apos;s patch&lt;br/&gt;
I removed the balancing script and added handling of region split and merge.&lt;/p&gt;</comment>
                            <comment id="13005496" author="stack" created="Fri, 11 Mar 2011 05:20:14 +0000"  >&lt;p&gt;Seems odd that on construction you&apos;d pass in requests given as you are creating the region; how can a region have &apos;requests&apos; if its only being created.  Can&apos;t you use a setRequests function?  If you didn&apos;t take requests in the constructor, it looks like your patch would be half the size.&lt;/p&gt;

&lt;p&gt;Otherwise patch looks good Ted.&lt;/p&gt;



</comment>
                            <comment id="13005497" author="yuzhihong@gmail.com" created="Fri, 11 Mar 2011 05:34:27 +0000"  >&lt;p&gt;I thought of adding setRequests() but didn&apos;t go that route.&lt;br/&gt;
There&apos;re two reasons:&lt;br/&gt;
1. Request for region comes in one by one normally. The setter isn&apos;t used.&lt;br/&gt;
2. When region splits, the request count goes half/half to daughter regions. It is intuitive to assign the count in ctor.&lt;br/&gt;
I will upload another version which removes unnecessary changes in unit tests.&lt;/p&gt;

&lt;p&gt;BTW unit tests pass on my Mac.&lt;/p&gt;</comment>
                            <comment id="13005500" author="yuzhihong@gmail.com" created="Fri, 11 Mar 2011 05:36:21 +0000"  >&lt;p&gt;Removed trivial changes in unit tests.&lt;/p&gt;</comment>
                            <comment id="13005505" author="stack" created="Fri, 11 Mar 2011 05:55:24 +0000"  >&lt;p&gt;Hey Ted, a package private setRequests seems to be the way to go rather than pass in on construction just for the case of passing a request count on daughter split.  I can do it on commit if you want?&lt;/p&gt;</comment>
                            <comment id="13005506" author="yuzhihong@gmail.com" created="Fri, 11 Mar 2011 06:01:11 +0000"  >&lt;p&gt;Go ahead.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="13005522" author="stack" created="Fri, 11 Mar 2011 06:50:44 +0000"  >&lt;p&gt;Here is a version of the patch that has the HRegion#requestsCounter package private so it can be set by the SplitTransaction.  It removes the passing of requests count into the HRegion constructor.&lt;/p&gt;

&lt;p&gt;There seem to a few issues w/ the patch though.  First, I see that we only increment the new HRegion#requestsCounter on region open &amp;#8211; is that right?  Second, we&apos;re already doing counts up in HRegionServer.  Is the intent to count twice but this time at the HRegions&apos; scope?&lt;/p&gt;</comment>
                            <comment id="13005529" author="yuzhihong@gmail.com" created="Fri, 11 Mar 2011 07:03:39 +0000"  >&lt;p&gt;HRegion.startRegionOperation() is called in many methods, such as checkAndMutate(), delete(Delete delete, Integer lockid, boolean writeToWAL), increment().&lt;/p&gt;

&lt;p&gt;For item 2, the intent is to record the count at HRegion level so that we have more accurate measure for region server load.&lt;/p&gt;</comment>
                            <comment id="13006087" author="stack" created="Sat, 12 Mar 2011 20:18:18 +0000"  >&lt;p&gt;Ok on the startRegionOperation.&lt;/p&gt;

&lt;p&gt;So we are double-counting then?  Once at RS level and then again at the Region level?&lt;/p&gt;

&lt;p&gt;Should we check in this to do our counting? &lt;a href=&quot;http://sourceforge.net/projects/high-scale-lib/files/high-scale-lib/high-scale-lib-v1.1.1/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://sourceforge.net/projects/high-scale-lib/files/high-scale-lib/high-scale-lib-v1.1.1/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13006089" author="ryanobjc" created="Sat, 12 Mar 2011 20:26:59 +0000"  >&lt;p&gt;in my profiling runs, the AtomicInteger/Longs in our stats were&lt;br/&gt;
showing up as small hot spots. It wasnt a huge deal so I didn&apos;t do all&lt;br/&gt;
the surgery to switch in high scale lib counters, but we should&lt;br/&gt;
consider it at some point.&lt;/p&gt;</comment>
                            <comment id="13006097" author="yuzhihong@gmail.com" created="Sat, 12 Mar 2011 22:03:06 +0000"  >&lt;p&gt;I think we can try using ConcurrentAutoTable&lt;/p&gt;

&lt;p&gt;From &lt;a href=&quot;https://issues.apache.org/jira/browse/CASSANDRA-1888:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CASSANDRA-1888:&lt;/a&gt;&lt;br/&gt;
I committed 1.1.1 from (&lt;a href=&quot;http://repo1.maven.org/maven2/com/github/stephenc/high-scale-lib/high-scale-lib/1.1.1/high-scale-lib-1.1.1.jar&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://repo1.maven.org/maven2/com/github/stephenc/high-scale-lib/high-scale-lib/1.1.1/high-scale-lib-1.1.1.jar&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;How should I specify dependency in pom.xml ?&lt;/p&gt;</comment>
                            <comment id="13006139" author="yuzhihong@gmail.com" created="Sun, 13 Mar 2011 04:13:48 +0000"  >&lt;p&gt;Changed requestsCount to high-scale-lib&apos;s Counter class.&lt;br/&gt;
Also added the summation of region requestsCount&apos;s in HRegion.merge&lt;br/&gt;
This patch is based on latest trunk code.&lt;/p&gt;</comment>
                            <comment id="13006484" author="stack" created="Mon, 14 Mar 2011 16:14:19 +0000"  >&lt;p&gt;I took a quick look at this.  It looks great Ted.  I want to look again before commit.  Thats a nice find where you figured a maven repository location for the cliff click jar.  Good stuff Ted.&lt;/p&gt;</comment>
                            <comment id="13006485" author="stack" created="Mon, 14 Mar 2011 16:14:57 +0000"  >&lt;p&gt;Making major rather than trivial and filing against 0.92.&lt;/p&gt;</comment>
                            <comment id="13006722" author="stack" created="Mon, 14 Mar 2011 23:41:17 +0000"  >&lt;p&gt;I  just committed part 1 of this patch.  Thanks Ted and Sebastian for persisting.&lt;/p&gt;

&lt;p&gt;Regards part 2, it looks a bit wonky to me.  You are balancing based off requests though the balancer in place is balancing off the count of regions (you are running the balance yourself manually, external to hbase).  Thats kinda cool but I&apos;m not sure I should commit it.  For example, the  name of the shell command is &apos;rebalance&apos; when it probably should be &apos;rebalance_based_off_region_hits_but_native_balancer_must_be_disabled&apos;?&lt;/p&gt;

&lt;p&gt;Thanks lads.&lt;/p&gt;</comment>
                            <comment id="13007863" author="hudson" created="Thu, 17 Mar 2011 10:32:59 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1792 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1792/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1792/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="13047542" author="stack" created="Fri, 10 Jun 2011 22:45:45 +0000"  >&lt;p&gt;Moving out of 0.92.0. Pull it back in if you think different.&lt;/p&gt;</comment>
                            <comment id="13047777" author="stack" created="Fri, 10 Jun 2011 23:46:08 +0000"  >&lt;p&gt;Bringing back in; give it another review before punting.&lt;/p&gt;</comment>
                            <comment id="13107505" author="stack" created="Sun, 18 Sep 2011 19:03:32 +0000"  >&lt;p&gt;Changed the title to leave out the rebalance aspect.  Will open new issue for rebalance command (since we committed first part of this two-part patch against this issue already)&lt;/p&gt;</comment>
                            <comment id="13107506" author="stack" created="Sun, 18 Sep 2011 19:07:12 +0000"  >&lt;p&gt;Part 1 was committed a good while ago.  Thanks Ted and Sebastian.  I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4431&quot; title=&quot;Add region-requests hbase-3507 based balancing from client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4431&quot;&gt;&lt;del&gt;HBASE-4431&lt;/del&gt;&lt;/a&gt; to add the part two patch added above.  Lets do the part two work over in the new issue.&lt;/p&gt;</comment>
                            <comment id="15017013" author="lars_francke" created="Fri, 20 Nov 2015 12:41:34 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12500932">HBASE-3614</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12473489" name="hbase-3507-high-scale.txt" size="10615" author="yuzhihong@gmail.com" created="Sun, 13 Mar 2011 04:13:48 +0000"/>
                            <attachment id="12473369" name="hbase-3507-split-merge.txt" size="13546" author="yuzhihong@gmail.com" created="Fri, 11 Mar 2011 05:36:21 +0000"/>
                            <attachment id="12473337" name="hbase-3507-splitTxn.txt" size="16231" author="yuzhihong@gmail.com" created="Thu, 10 Mar 2011 22:21:48 +0000"/>
                            <attachment id="12473371" name="hbase-3507-v4.txt" size="12053" author="stack" created="Fri, 11 Mar 2011 06:50:44 +0000"/>
                            <attachment id="12470474" name="hbase-requestsCount-2.patch" size="3156" author="anih" created="Mon, 7 Feb 2011 17:23:33 +0000"/>
                            <attachment id="12470852" name="hbase-requestsCount-v2.patch" size="22925" author="anih" created="Fri, 11 Feb 2011 11:07:55 +0000"/>
                            <attachment id="12470473" name="hbase-requestsCount.patch" size="8318" author="anih" created="Mon, 7 Feb 2011 17:23:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 7 Feb 2011 21:03:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33059</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05i2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30024</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>