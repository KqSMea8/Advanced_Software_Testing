<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:04:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2743/HBASE-2743.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2743] Script to drop N regions from a table and then patch hole the hole by inserting a new hole spanning region to meta.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2743</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Script to help out our mozilla buddies.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12467296">HBASE-2743</key>
            <summary>Script to drop N regions from a table and then patch hole the hole by inserting a new hole spanning region to meta.</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                            <label>beginner</label>
                    </labels>
                <created>Fri, 18 Jun 2010 02:03:19 +0000</created>
                <updated>Tue, 5 Aug 2014 20:06:02 +0000</updated>
                                                                                <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12880043" author="stack" created="Fri, 18 Jun 2010 02:05:14 +0000"  >&lt;p&gt;Script that offlines regions in the first run and then on subsequent run, closes and deletes regions finishing by adding up a hole-plugging region to meta.  Needs more testing.&lt;/p&gt;</comment>
                            <comment id="12880241" author="stack" created="Fri, 18 Jun 2010 16:32:41 +0000"  >&lt;p&gt;Testing, the problem is better addressed with two scripts... one to do the offlining, close and delete with another to plug the hole.&lt;/p&gt;</comment>
                            <comment id="12880256" author="stack" created="Fri, 18 Jun 2010 17:21:03 +0000"  >&lt;p&gt;This version records changes made into designated table so we can undo at later date.&lt;/p&gt;</comment>
                            <comment id="12880288" author="stack" created="Fri, 18 Jun 2010 19:14:51 +0000"  >&lt;p&gt;Here is how the scripts work:&lt;/p&gt;

&lt;p&gt;Run excise_regions.rb as follows:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 ./bin/hbase org.jruby.Main bin/excise_regions.rb TestTable 0000107136 0104707253 archive
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The keys provided must be actual region startkeys that are present in the table.  &apos;archive&apos; is the name of the table we archive what we&apos;ve done into.  It must be present for this script to work.  It must have a column family named &apos;info&apos;.  Do:&lt;/p&gt;

&lt;p&gt;hbase&amp;gt; create &apos;archive&apos;, &apos;info&apos;&lt;/p&gt;

&lt;p&gt;... to create the table.&lt;/p&gt;

&lt;p&gt;Run the above multiple times till no more &apos;Offlined=&apos; and &apos;Closed and delete=&apos; messages.&lt;/p&gt;

&lt;p&gt;You may get an NPE from time to time.  Thats OK.  The master is asked to run parts of this job and when it goes to execute, the info it needs may not be present in .META. (Master needs a patch to not NPE).&lt;/p&gt;

&lt;p&gt;When no more messages, then you all regions between the passed key range will have been removed from .META. (and closed out on the regionservers).&lt;/p&gt;

&lt;p&gt;The regions that were removed from .META. will be listed in the passed archive table (&apos;archive&apos; in the cmdline above).&lt;/p&gt;

&lt;p&gt;You will now have a hole in your table.&lt;/p&gt;

&lt;p&gt;To plug the hole, run the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/hbase org.jruby.Main bin/plug_hole.rb TestTable 0000107136 0104707253
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This adds a region that spans the passed keys.&lt;/p&gt;</comment>
                            <comment id="12880290" author="stack" created="Fri, 18 Jun 2010 19:22:30 +0000"  >&lt;p&gt;I put the scripts here instead: &lt;a href=&quot;http://github.com/saintstack/hbase_bin_scripts&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/saintstack/hbase_bin_scripts&lt;/a&gt;  Latest versions have better documentation on their heads.&lt;/p&gt;</comment>
                            <comment id="12882898" author="deinspanjer" created="Sat, 26 Jun 2010 22:21:42 +0000"  >&lt;p&gt;I just used this script today to relieve burden on our cluster from too many regions.  Details of the operation with some before/after charts are here:&lt;br/&gt;
&lt;a href=&quot;https://bugzilla.mozilla.org/show_bug.cgi?id=574998&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://bugzilla.mozilla.org/show_bug.cgi?id=574998&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12882905" author="stack" created="Sun, 27 Jun 2010 02:04:14 +0000"  >&lt;p&gt;@Daniel It looks it worked then? 41k to 6k regions?&lt;/p&gt;</comment>
                            <comment id="12882949" author="deinspanjer" created="Sun, 27 Jun 2010 12:28:49 +0000"  >&lt;p&gt;Yes.  If we&apos;ve generated 6k regions since 2010-06-10, that&apos;s around 200 per day.  That means it would take us approximately 200 days of the same traffic shape to hit 40000 again.  We might want to try to tune that number a little more, but it doesn&apos;t seem terrible where it is.&lt;/p&gt;</comment>
                            <comment id="14064541" author="stack" created="Thu, 17 Jul 2014 03:40:45 +0000"  >&lt;p&gt;Reopening to mark as noob.  This comes up from time to time.  Someone will do it.&lt;/p&gt;</comment>
                            <comment id="14064630" author="esteban" created="Thu, 17 Jul 2014 06:22:00 +0000"  >&lt;p&gt;What about have something like &lt;tt&gt;snapshot &apos;region&apos;&lt;/tt&gt; and then &lt;tt&gt;drop &apos;region&apos;&lt;/tt&gt; in the hbase shell for consistency with other commands.&lt;/p&gt;</comment>
                            <comment id="14064633" author="esteban" created="Thu, 17 Jul 2014 06:24:52 +0000"  >&lt;p&gt;It could work in ranges also by specifying &lt;tt&gt;snapshot &apos;start_region&apos;,&apos;end_region&apos;&lt;/tt&gt; and &lt;tt&gt;drop &apos;start_region&apos;,&apos;end_region&apos;&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14065022" author="stack" created="Thu, 17 Jul 2014 15:20:30 +0000"  >&lt;p&gt;I like the idea of drop a range.  Why would we snapshot a range?&lt;/p&gt;</comment>
                            <comment id="14065122" author="esteban" created="Thu, 17 Jul 2014 16:54:34 +0000"  >&lt;p&gt;You could do a snapshot of the whole table if you want, but if you are trimming the table I think having a snapshot of the range might be handy if you change your mind and you want to re-load the data, perhaps the operator choose the wrong range initially.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 26 Jun 2010 22:21:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32747</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hj0n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>