<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:59:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2174/HBASE-2174.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2174] Stop from resolving HRegionServer addresses to names using DNS on every heartbeat</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2174</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Over the time many parts of the code have evolved in different ways and one issue is that addresses are handled differently in different parts of the code. We need to set a standard and correct any inconsistencies.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12447029">HBASE-2174</key>
            <summary>Stop from resolving HRegionServer addresses to names using DNS on every heartbeat</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="karthik.ranga">Karthik Ranganathan</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Fri, 29 Jan 2010 17:37:29 +0000</created>
                <updated>Fri, 12 Oct 2012 06:14:57 +0000</updated>
                            <resolved>Thu, 11 Mar 2010 20:07:37 +0000</resolved>
                                                    <fixVersion>0.20.4</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="12806434" author="jdcryans" created="Fri, 29 Jan 2010 18:55:28 +0000"  >&lt;p&gt;One example of weirdness is when the region server is told which address to use according to the master:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Master passed us address to use. Was=10.10.21.16:60020, Now=10.10.21.16
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12806455" author="jdcryans" created="Fri, 29 Jan 2010 19:24:39 +0000"  >&lt;p&gt;Another thing people see sometimes is that their region servers will have 2-3 znodes registered in zookeeper, I wasn&apos;t able to figure what the problem was right away but the issue exists and it&apos;s surely in the scope of this jira.&lt;/p&gt;</comment>
                            <comment id="12806561" author="kannanm" created="Fri, 29 Jan 2010 23:37:29 +0000"  >&lt;p&gt;JD: The cluster coming down when DNS is flaky (the issue we reported on hbase-dev yesterday) is basically a dup of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1679&quot; title=&quot;Flapping DNS does us more harm than it need to&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1679&quot;&gt;&lt;del&gt;HBASE-1679&lt;/del&gt;&lt;/a&gt;. It causes the master to send a &quot;startup&quot; message to an already running region server. This then leads to the region server creating new znodes in zookeeper (of the form /hbase/rs/&amp;lt;startcode&amp;gt;). &lt;/p&gt;</comment>
                            <comment id="12806562" author="kannanm" created="Fri, 29 Jan 2010 23:40:18 +0000"  >&lt;p&gt;To fill in some more details, this is what we think happened during DNS flakiness:&lt;/p&gt;

&lt;p&gt;A regionServer periodically sends a regionServerReport (RPC call) to the master. A HServerInfo argument is passed as an argument and it identifies the sending region server&apos;s identity in IP address format.&lt;/p&gt;

&lt;p&gt;The master, in ServerManager class, maintains a serversToServerInfo map which is hostname based. Every time a master receives a regionServerReport it converts the IP address based name to a hostname via the info.getServerName() call. Normally this call returns the hostname, but we suspect that during the DNS flakiness, it returned an IP address based string. And so, this caused ServerManager.java to think that it was hearing from a new server. And this lead to:&lt;/p&gt;

&lt;p&gt; HServerInfo storedInfo = serversToServerInfo.get(info.getServerName());&lt;br/&gt;
    if (storedInfo == null) {&lt;br/&gt;
      if (LOG.isDebugEnabled()) &lt;/p&gt;
{
        LOG.debug(&quot;Received report from unknown server -- telling it &quot; +   &amp;lt;&amp;lt;============
          &quot;to &quot; + CALL_SERVER_STARTUP + &quot;: &quot; + info.getServerName());  &amp;lt;&amp;lt;============
      }

&lt;p&gt;and bad things happened down the road (such as the region server registering itself multiple times in Zookeeper, cluster coming down, etc.).&lt;/p&gt;

&lt;p&gt;The above error message in our logs (example below) indeed identified the host in IP address syntax, even though normally the getServerName call would return the info in hostname format.&lt;/p&gt;

&lt;p&gt;2010-01-28 11:21:34,539 DEBUG org.apache.hadoop.hbase.master.ServerManager: Received report from unknown server &amp;#8211; telling it to MSG_CALL_SERVER_STARTUP: 10.129.68.203,60020,1263605543210&lt;/p&gt;

&lt;p&gt;&amp;#8211;&lt;/p&gt;

&lt;p&gt;Perhaps all we need to do is to change the ServerManager&apos;s internal maps to all be IP based? That way we avoid/bypass the master having to look up the hostname on every heartbeat.&lt;/p&gt;</comment>
                            <comment id="12806570" author="ryanobjc" created="Fri, 29 Jan 2010 23:59:28 +0000"  >&lt;p&gt;im wondering if we should do something radical and flexible in this area...&lt;/p&gt;

&lt;p&gt;right now if we use IP address, we can make it hard for clients to talk to hbase, since if their knowledge of hbase&apos;s IP and the one HBase uses are different, then bam.  Think: ec2 internal/external addresses.&lt;/p&gt;

&lt;p&gt;Maybe it makes sense to always use symbolic names and resolve them at the client when they need to make RPC calls?&lt;/p&gt;
</comment>
                            <comment id="12806580" author="jsensarma" created="Sat, 30 Jan 2010 00:28:59 +0000"  >&lt;p&gt;yeah - hostnames are much more flexible. we can review what hdfs does - it already works (for these reasons) in AWS (I was able to get my home pc to talk directly to hdfs nodes inside AWS once). &lt;/p&gt;

&lt;p&gt;hadoop also supports configurable hostname per machine (via conf file) (we saw this when we were comparing the hbase and hadoop hostname related code). there&apos;s probably some interesting use case for that as well.&lt;/p&gt;</comment>
                            <comment id="12806608" author="karthik.ranga" created="Sat, 30 Jan 2010 02:07:40 +0000"  >&lt;p&gt;@Joydeep/Ryan - good point about EC2. They expose a different IP to the outside world (elastic IP) which is different from the actual machine ip&apos;s. We should definitely stick to hostnames. &lt;/p&gt;

&lt;p&gt;I guess we should just stop the master from resolving each time and take what the client says its hostname-ip pair is as the truth. Zookeeper currently stores the ip of the root region server - not sure if thats an issue.&lt;/p&gt;</comment>
                            <comment id="12806611" author="kannanm" created="Sat, 30 Jan 2010 02:23:09 +0000"  >&lt;p&gt;Also, in &apos;.META.&apos;, the region assignments are stored as IP addresses. Wondering if that could present some &quot;upgrade/compatibility&quot; issues if everything was changed to be hostname based.&lt;/p&gt;</comment>
                            <comment id="12837031" author="karthik.ranga" created="Tue, 23 Feb 2010 01:35:22 +0000"  >&lt;p&gt;Add a fix on the HMaster side to stop it from resolving HRegionServer addresses to names using DNS.&lt;/p&gt;</comment>
                            <comment id="12837033" author="karthik.ranga" created="Tue, 23 Feb 2010 01:37:43 +0000"  >&lt;p&gt;Hey guys, I have attached a patch for this issue - its a very simple fix on the HMaster side. Do let me know if you have any comments.&lt;/p&gt;</comment>
                            <comment id="12837319" author="apurtell" created="Tue, 23 Feb 2010 17:09:24 +0000"  >&lt;p&gt;+1 on patch, tests running now, will commit if ok. &lt;/p&gt;</comment>
                            <comment id="12837349" author="stack" created="Tue, 23 Feb 2010 18:04:05 +0000"  >&lt;p&gt;Patch looks good.  I think though that if this patch goes in, to be safe, we should require a restart of hbase upgrading patch versions.  So, if we&apos;re talking about supporting a rolling restart in 0.20.4, this would go into a 0.20.5.... but its looking like hbase-2248 fix needs to go into 0.20.4 and if so, it dictates a restart.&lt;/p&gt;</comment>
                            <comment id="12837368" author="apurtell" created="Tue, 23 Feb 2010 18:32:22 +0000"  >&lt;p&gt;Tests look good. Commit to branch now or wait?&lt;/p&gt;</comment>
                            <comment id="12837370" author="stack" created="Tue, 23 Feb 2010 18:37:20 +0000"  >&lt;p&gt;I made a 0.20.5 and moved it here for now.  If 0.20.4 requires restart, we&apos;ll pull it back in to 0.20.4.  Thanks Andrew.&lt;/p&gt;</comment>
                            <comment id="12844205" author="stack" created="Thu, 11 Mar 2010 19:54:46 +0000"  >&lt;p&gt;Changed subject to match the posted patch.  Will open new issue to take up where this patch leaves off to finish the review of hbase to ensure we use hostnames everywhere...&lt;/p&gt;</comment>
                            <comment id="12844215" author="stack" created="Thu, 11 Mar 2010 20:07:37 +0000"  >&lt;p&gt;Applied branch and trunk.  Thanks for the patch Karthik.&lt;/p&gt;</comment>
                            <comment id="12853466" author="streamy" created="Mon, 5 Apr 2010 17:57:57 +0000"  >&lt;p&gt;This was committed to branch already which will be 0.20.4 not 0.20.5 (just updating fix version for clarity)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12436659" name="HBASE-2174_0.20.3.patch" size="4427" author="karthik.ranga" created="Tue, 23 Feb 2010 01:35:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 29 Jan 2010 23:37:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32440</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 37 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08syv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49293</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>