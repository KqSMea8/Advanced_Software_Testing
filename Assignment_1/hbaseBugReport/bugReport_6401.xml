<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:36:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6401/HBASE-6401.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6401] HBase may lose edits after a crash if used with HDFS 1.0.3 or older</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6401</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This comes from a hdfs bug, fixed in some hdfs versions. I haven&apos;t found the hdfs jira for this.&lt;/p&gt;

&lt;p&gt;Context: HBase Write Ahead Log features. This is using hdfs append. If the node crashes, the file that was written is read by other processes to replay the action.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;So we have in hdfs one (dead) process writing with another process reading.&lt;/li&gt;
	&lt;li&gt;But, despite the call to syncFs, we don&apos;t always see the data when we have a dead node. It seems to be because the call in DFSClient#updateBlockInfo ignores the ipc errors and set the length to 0.&lt;/li&gt;
	&lt;li&gt;So we may miss all the writes to the last block if we try to connect to the dead DN.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;hdfs 1.0.3, branch-1 or branch-1-win: we have the issue&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc/hadoop/common/branches/branch-1/src/hdfs/org/apache/hadoop/hdfs/DFSClient.java?revision=1359853&amp;amp;view=markup&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/hadoop/common/branches/branch-1/src/hdfs/org/apache/hadoop/hdfs/DFSClient.java?revision=1359853&amp;amp;view=markup&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;hdfs branch-2 or trunk: we should not have the issue (but not tested)&lt;br/&gt;
&lt;a href=&quot;http://svn.apache.org/viewvc/hadoop/common/branches/branch-2/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSInputStream.java?view=markup&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/hadoop/common/branches/branch-2/hadoop-hdfs-project/hadoop-hdfs/src/main/java/org/apache/hadoop/hdfs/DFSInputStream.java?view=markup&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;The attached test will fail ~50 of the time.&lt;/p&gt;</description>
                <environment>&lt;p&gt;all&lt;/p&gt;</environment>
        <key id="12599111">HBASE-6401</key>
            <summary>HBase may lose edits after a crash if used with HDFS 1.0.3 or older</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="nkeywal">Nicolas Liochon</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jul 2012 12:35:41 +0000</created>
                <updated>Wed, 5 Dec 2012 14:59:20 +0000</updated>
                            <resolved>Wed, 5 Dec 2012 14:59:20 +0000</resolved>
                                    <version>0.95.2</version>
                                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13416223" author="zhihyu@ebaysf.com" created="Tue, 17 Jul 2012 14:07:07 +0000"  >&lt;p&gt;The test is for hadoop.&lt;br/&gt;
Is there HADOOP- JIRA for this bug ?&lt;/p&gt;</comment>
                            <comment id="13416241" author="nkeywal" created="Tue, 17 Jul 2012 14:29:09 +0000"  >&lt;p&gt;Yeah, I wrote it for hadoop, but then saw it was fixed on their trunk, so I didn&apos;t created it. But I haven&apos;t found a related jira. We could want to fix it on 1.0.3, adding the ordering I was mentionning on the dev list (put the DN on the same box as the RS as the last locations to make sure we don&apos;t use a dead DN).&lt;/p&gt;</comment>
                            <comment id="13417149" author="lhofhansl" created="Wed, 18 Jul 2012 15:01:49 +0000"  >&lt;p&gt;This needs to be fixed in a hdfs. If it is fixed in Hadoop-2 there should be a jira to backport the change.&lt;br/&gt;
When I did &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-744&quot; title=&quot;Support hsync in HDFS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-744&quot;&gt;&lt;del&gt;HDFS-744&lt;/del&gt;&lt;/a&gt; I found Hadoop-1 and Hadoop-2 quite different in the way it handled packet shipping from the DFSClient, so the work might be non-trivial.&lt;/p&gt;</comment>
                            <comment id="13417161" author="stack" created="Wed, 18 Jul 2012 15:22:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;I haven&apos;t found the hdfs jira for this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Does svn blame/git bisecting not turn up the issue that fixed this?&lt;/p&gt;</comment>
                            <comment id="13419356" author="nkeywal" created="Fri, 20 Jul 2012 17:11:01 +0000"  >&lt;p&gt;@stack&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Does svn blame/git bisecting not turn up the issue that fixed this?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Will try.&lt;/p&gt;</comment>
                            <comment id="13419358" author="nkeywal" created="Fri, 20 Jul 2012 17:14:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6435&quot; title=&quot;Reading WAL files after a recovery leads to time lost in HDFS timeouts when using dead datanodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6435&quot;&gt;&lt;del&gt;HBASE-6435&lt;/del&gt;&lt;/a&gt; will lower the probability to get the issue but will not solve it totally.&lt;/p&gt;</comment>
                            <comment id="13419398" author="nkeywal" created="Fri, 20 Jul 2012 18:05:28 +0000"  >&lt;p&gt;@stack The oldest version of DFSInputStream.java (it&quot;s split from DFSClient) is one year old and seems ok on trunk.&lt;/p&gt;</comment>
                            <comment id="13419423" author="nkeywal" created="Fri, 20 Jul 2012 18:42:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-3222&quot; title=&quot;DFSInputStream#openInfo should not silently get the length as 0 when locations length is zero for last partial block.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-3222&quot;&gt;&lt;del&gt;HDFS-3222&lt;/del&gt;&lt;/a&gt; is not exactly this one, but not far, and fixed on 2.0 as well.&lt;/p&gt;</comment>
                            <comment id="13419579" author="stack" created="Fri, 20 Jul 2012 21:18:25 +0000"  >&lt;p&gt;@Nkeywal We need another patch on top of hdfs-3222?&lt;/p&gt;</comment>
                            <comment id="13419585" author="nkeywal" created="Fri, 20 Jul 2012 21:25:30 +0000"  >&lt;p&gt;On 1.x, yes, I think that backporting hdfs-3222 won&apos;t be enough. On 2.0, it seems it&apos;s ok, even if I can&apos;t find the good soul who fixed it. As I can&apos;t find a jira, I can create a new one &amp;amp; propose a fix specific to branch 1. &lt;/p&gt;</comment>
                            <comment id="13419787" author="stack" created="Sat, 21 Jul 2012 09:55:00 +0000"  >&lt;p&gt;@Nkeywal Sounds great.  A patch/JIRA will give us something to rally around.&lt;/p&gt;</comment>
                            <comment id="13463115" author="lhofhansl" created="Tue, 25 Sep 2012 18:52:48 +0000"  >&lt;p&gt;Hadoop-2 has other issues, though (see last few comments on &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-744&quot; title=&quot;Support hsync in HDFS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-744&quot;&gt;&lt;del&gt;HDFS-744&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13463144" author="nkeywal" created="Tue, 25 Sep 2012 19:35:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-3701&quot; title=&quot;HDFS may miss the final block when reading a file opened for writing if one of the datanode is dead&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-3701&quot;&gt;&lt;del&gt;HDFS-3701&lt;/del&gt;&lt;/a&gt; has just been fixed, so we may have a reasonable hdfs 1.1 version as &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-3703&quot; title=&quot;Decrease the datanode failure detection time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-3703&quot;&gt;&lt;del&gt;HDFS-3703&lt;/del&gt;&lt;/a&gt; made it as well. We need &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-3912&quot; title=&quot;Detecting and avoiding stale datanodes for writing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-3912&quot;&gt;&lt;del&gt;HDFS-3912&lt;/del&gt;&lt;/a&gt; to be complete from a failure management point of view. Then there is the question of durability...&lt;/p&gt;</comment>
                            <comment id="13474234" author="nkeywal" created="Thu, 11 Oct 2012 15:29:51 +0000"  >&lt;p&gt;Branch 1.1 contains the fix for this issue. So I would tend to think that we can resolved this at won&apos;t fix as this jira mentions the branch 1.0.&lt;/p&gt;</comment>
                            <comment id="13510516" author="nkeywal" created="Wed, 5 Dec 2012 14:59:20 +0000"  >&lt;p&gt;HDFS 1.1.x includes the fix.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12599648">HBASE-6435</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12551766">HBASE-5843</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12599834">HDFS-3701</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12536813" name="TestReadAppendWithDeadDN.java" size="4153" author="nkeywal" created="Tue, 17 Jul 2012 12:39:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 17 Jul 2012 14:07:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241751</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02c93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11586</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>