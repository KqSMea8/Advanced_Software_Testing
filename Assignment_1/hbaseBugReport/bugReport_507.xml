<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:44:54 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-507/HBASE-507.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-507] In master, there are a load of places where no sleep between retries</title>
                <link>https://issues.apache.org/jira/browse/HBASE-507</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Here is an example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 270308 2008-03-12 14:10:02,054 DEBUG org.apache.hadoop.hbase.HMaster: numberOfMetaRegions: 1, onlineMetaRegions.size(): 1                                                                                                                                             
270309 2008-03-12 14:10:02,054 DEBUG org.apache.hadoop.hbase.HMaster: process server shutdown scanning .META.,,1 on XX.XX.XX.184:60020 HMaster                                                                                                                        
270310 2008-03-12 14:10:02,056 DEBUG org.apache.hadoop.hbase.HMaster: process server shutdown scanning .META.,,1 on XX.XX.XX.184:60020 HMaster                                                                                                                        
270311 2008-03-12 14:10:02,057 DEBUG org.apache.hadoop.hbase.HMaster: process server shutdown scanning .META.,,1 on XX.XX.XX.184:60020 HMaster                                                                                                                        
270312 2008-03-12 14:10:02,059 DEBUG org.apache.hadoop.hbase.HMaster: process server shutdown scanning .META.,,1 on XX.XX.XX.184:60020 HMaster
270313 2008-03-12 14:10:02,060 DEBUG org.apache.hadoop.hbase.HMaster: process server shutdown scanning .META.,,1 on XX.XX.XX.184:60020 HMaster
270314 2008-03-12 14:10:02,062 WARN org.apache.hadoop.hbase.HMaster: Processing pending operations: ProcessServerShutdown of XX.XX.XX.180:60020                                                                                                                       
270315 org.apache.hadoop.hbase.NotServingRegionException: org.apache.hadoop.hbase.NotServingRegionException .META.,,1                                                                                                                                                 
270316         at org.apache.hadoop.hbase.HRegionServer.getRegion(HRegionServer.java:1606) 
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Whats actually going on here is 5 retries without a wait in between (logging should include index numbering retry.  Seems to be a bunch of duplicated code around retrying that we might be able to fix with a Callable.  Jim Firby today suggested we do expotential backoffs in our retries. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12390913">HBASE-507</key>
            <summary>In master, there are a load of places where no sleep between retries</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Mar 2008 06:26:06 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:11 +0000</updated>
                            <resolved>Sat, 5 Apr 2008 02:13:55 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12578166" author="stack" created="Thu, 13 Mar 2008 06:47:52 +0000"  >&lt;p&gt;Above looping is responsible for 20k+ lines within about 6 seconds in the log I&apos;m currently looking at.&lt;/p&gt;</comment>
                            <comment id="12581331" author="bryanduxbury" created="Sun, 23 Mar 2008 03:52:52 +0000"  >&lt;p&gt;We should make (or extend) tools for doing timed retry operations against regionservers, and then use them in the master and possibly HTable. The ServerCallable stuff in HTable might be a good starting point. &lt;/p&gt;

&lt;p&gt;Perhaps this should also incorporate the exponential backoff stuff? (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-511&quot; title=&quot;Do exponential backoff in clients on NSRE, WRE, ISE, etc.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-511&quot;&gt;&lt;del&gt;HBASE-511&lt;/del&gt;&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12581408" author="jimk" created="Sun, 23 Mar 2008 17:43:54 +0000"  >&lt;p&gt;Is this a blocker for 0.1.0 or should it be incorporated in 0.1.1?&lt;/p&gt;</comment>
                            <comment id="12581417" author="bryanduxbury" created="Sun, 23 Mar 2008 18:42:15 +0000"  >&lt;p&gt;I think we should do a simple retry scheme in 0.1 and plan for something more complex in 0.2. It&apos;s pretty much unacceptable that we don&apos;t pause between retries in the master - makes the logs harder to debug and puts undue stress on the whole system. &lt;/p&gt;</comment>
                            <comment id="12581442" author="stack" created="Sun, 23 Mar 2008 22:09:53 +0000"  >&lt;p&gt;I&apos;m fine if this is not fixed in 0.1.  Doesn&apos;t seem critical.&lt;/p&gt;

&lt;p&gt;If we do fix it, please lets not do it duplicating code if possilble.  Can we use the Callable pattern from the Client here too?&lt;/p&gt;</comment>
                            <comment id="12584245" author="jimk" created="Tue, 1 Apr 2008 18:45:10 +0000"  >&lt;p&gt;patch for 0.1&lt;/p&gt;</comment>
                            <comment id="12584246" author="jimk" created="Tue, 1 Apr 2008 18:45:55 +0000"  >&lt;p&gt;Patch for 0.1 available. Please review.&lt;/p&gt;</comment>
                            <comment id="12584249" author="stack" created="Tue, 1 Apr 2008 18:57:40 +0000"  >&lt;p&gt;+1 as patch for 0.1 branch.  Lets do real fix in 0.2.&lt;/p&gt;</comment>
                            <comment id="12584288" author="jimk" created="Tue, 1 Apr 2008 20:30:36 +0000"  >&lt;p&gt;Committed patch for 0.1 branch.&lt;/p&gt;</comment>
                            <comment id="12584291" author="jimk" created="Tue, 1 Apr 2008 20:31:56 +0000"  >&lt;p&gt;Unmarking for 0.1 because patch has been committed.&lt;/p&gt;</comment>
                            <comment id="12584782" author="bryanduxbury" created="Wed, 2 Apr 2008 21:14:55 +0000"  >&lt;p&gt;Should we clone this issue to 0.2 and remark this one as 0.1 so that it&apos;s clear it both got done in 0.1 and isn&apos;t actually patch available in 0.2?&lt;/p&gt;</comment>
                            <comment id="12584790" author="jimk" created="Wed, 2 Apr 2008 21:29:39 +0000"  >&lt;p&gt;If you want to do the extra work, go ahead. I almost have changes ready for 0.2.&lt;/p&gt;</comment>
                            <comment id="12584791" author="jimk" created="Wed, 2 Apr 2008 21:31:55 +0000"  >&lt;p&gt;Patch was for 0.1&lt;/p&gt;</comment>
                            <comment id="12584792" author="jimk" created="Wed, 2 Apr 2008 21:32:23 +0000"  >&lt;p&gt;Started work on 0.2&lt;/p&gt;</comment>
                            <comment id="12585816" author="jimk" created="Fri, 4 Apr 2008 22:51:46 +0000"  >&lt;p&gt;The &quot;real&quot; fix for trunk. Uses Callable pattern.&lt;/p&gt;</comment>
                            <comment id="12585817" author="jimk" created="Fri, 4 Apr 2008 22:52:43 +0000"  >&lt;p&gt;507-trunk.patch is the &quot;real&quot; fix for this problem, not the band-aid we applied to 0.1 branch.&lt;/p&gt;

&lt;p&gt;Please review.&lt;/p&gt;</comment>
                            <comment id="12585843" author="bryanduxbury" created="Fri, 4 Apr 2008 23:41:34 +0000"  >&lt;p&gt;RetryableOperation &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Needs a class comment.&lt;/li&gt;
	&lt;li&gt;It&apos;s not a generically retryable operation, so the name is a tad misleading. Maybe something like RetryableMetaOperation?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;TableOperation&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;process() - if you need to tag the end of your loops with comments, you should consider splitting the method into a few different methods. How about everything inside the Retryable becomes processSingleMetaRegion?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Nice to haves:&lt;/p&gt;

&lt;p&gt;ProcessRegionServerShutdown:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;process() is a very long method (100 lines). If it were broken up a little, might make the indentation in the anonymous Retryable classes a little less ugly.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Generally nice patch. Running unit tests now.&lt;/p&gt;</comment>
                            <comment id="12585851" author="bryanduxbury" created="Sat, 5 Apr 2008 00:07:25 +0000"  >&lt;p&gt;Tests pass. With some of above suggestions, +1.&lt;/p&gt;</comment>
                            <comment id="12585868" author="jimk" created="Sat, 5 Apr 2008 02:03:40 +0000"  >&lt;p&gt;&amp;gt; Bryan Duxbury - 04/Apr/08 04:41 PM&lt;br/&gt;
&amp;gt; RetryableOperation&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;    * Needs a class comment.&lt;/p&gt;

&lt;p&gt;Done.&lt;/p&gt;

&lt;p&gt;&amp;gt;    * It&apos;s not a generically retryable operation, so the name is a tad misleading. Maybe something like &lt;br/&gt;
&amp;gt; RetryableMetaOperation?&lt;/p&gt;

&lt;p&gt;Changed.&lt;/p&gt;

&lt;p&gt;&amp;gt; TableOperation&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;    * process() - if you need to tag the end of your loops with comments, you should consider splitting&lt;br/&gt;
&amp;gt;  the method into a few different methods. How about everything inside the Retryable becomes&lt;br/&gt;
&amp;gt;  processSingleMetaRegion?&lt;/p&gt;

&lt;p&gt;Well, those comments were from before when the retry logic was in place. It was not possible to factor&lt;br/&gt;
it out into a separate method, but I did create a private internal class that cleaned it up nicely.&lt;/p&gt;

&lt;p&gt;&amp;gt; Nice to haves:&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; ProcessRegionServerShutdown:&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt;    * process() is a very long method (100 lines). If it were broken up a little, might make the indentation&lt;br/&gt;
&amp;gt;  in the anonymous Retryable classes a little less ugly.&lt;/p&gt;

&lt;p&gt;Again, couldn&apos;t do it as a separate method, but did create two inner classes that cleans it up.&lt;/p&gt;</comment>
                            <comment id="12585873" author="jimk" created="Sat, 5 Apr 2008 02:13:55 +0000"  >&lt;p&gt;Committed to trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12379049" name="507-0.1.patch" size="1500" author="jimk" created="Tue, 1 Apr 2008 18:45:10 +0000"/>
                            <attachment id="12379438" name="507-trunk.patch" size="24949" author="jimk" created="Fri, 4 Apr 2008 22:51:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 23 Mar 2008 03:52:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25237</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 37 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h7pz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98513</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>