<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:28:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5482/HBASE-5482.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5482] In 0.90, balancer algo leading to same region balanced twice and picking same region with Src and Destination as same RS.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5482</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There are possibility of 2 problems&lt;br/&gt;
-&amp;gt; When we populate regionsToMove while iterating the serverinfo in descending manner there is a chance that the same region can be added twice.&lt;br/&gt;
Because in the first loop we do a randomization of the regions.&lt;br/&gt;
Where as when we get we have neededRegions!= 0 we just get the region in the index and add it again . This may lead to have same region in the regionsToMove list.&lt;br/&gt;
-&amp;gt; Another problem is &lt;br/&gt;
when the problem in the first point happens then there is a chance that&lt;br/&gt;
the regionToMove can have the same src and destination and the same region can be picked every 5 mins.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(Map.Entry&amp;lt;HServerInfo, List&amp;lt;HRegionInfo&amp;gt;&amp;gt; server :
        serversByLoad.descendingMap().entrySet()) {
        BalanceInfo balanceInfo = serverBalanceInfo.get(server.getKey());
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; idx =
          balanceInfo == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? 0 : balanceInfo.getNextRegionForUnload();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (idx &amp;gt;= server.getValue().size()) &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
        HRegionInfo region = server.getValue().get(idx);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (region.isMetaRegion()) &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;// Don&apos;t move meta regions.
&lt;/span&gt;        regionsToMove.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RegionPlan(region, server.getKey(), &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;));
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(--neededRegions == 0) {
          &lt;span class=&quot;code-comment&quot;&gt;// No more regions needed, done shedding
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
        }
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If i have meta and root in the top two loaded region server(totally 3 RS), we just skip the regions in those region server and populate the region from the least loaded RS.&lt;br/&gt;
Then in the next loop we iterate from the least loaded server and populate the destination as also the same server.&lt;br/&gt;
This is leading to a condition where every 5 min balancing happens and also the server is same for src and dest.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12544231">HBASE-5482</key>
            <summary>In 0.90, balancer algo leading to same region balanced twice and picking same region with Src and Destination as same RS.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="ram_krish">ramkrishna.s.vasudevan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 27 Feb 2012 08:39:23 +0000</created>
                <updated>Tue, 20 Mar 2012 06:21:42 +0000</updated>
                            <resolved>Tue, 20 Mar 2012 06:21:41 +0000</resolved>
                                    <version>0.90.5</version>
                                    <fixVersion>0.90.7</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13218244" author="ram_krish" created="Tue, 28 Feb 2012 14:53:26 +0000"  >&lt;p&gt;Patch for 0.90.&lt;/p&gt;</comment>
                            <comment id="13218246" author="ram_krish" created="Tue, 28 Feb 2012 14:54:44 +0000"  >&lt;p&gt;Checking if the patch similar to this is needed in trunk.  Once confirmed will prepare a patch for 0.92.&lt;/p&gt;</comment>
                            <comment id="13219350" author="zhihyu@ebaysf.com" created="Wed, 29 Feb 2012 17:31:07 +0000"  >&lt;p&gt;Patch v2 corrected grammar in comments&lt;/p&gt;</comment>
                            <comment id="13219352" author="zhihyu@ebaysf.com" created="Wed, 29 Feb 2012 17:38:07 +0000"  >&lt;p&gt;Patch looks good.&lt;/p&gt;

&lt;p&gt;Please add curly braces around break statement:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (idx &amp;gt;= server.getValue().size())
+            &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testBalanceClusterWithFirstRegionsRootMeta() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;the following should end with &apos;META are&apos;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not randomize in order to create a scenario where ROOT and META is &lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testPlanContainsDuplicateRegions() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Would testNoDuplicateRegionsInPlan() be a good name ?&lt;/p&gt;</comment>
                            <comment id="13220094" author="ram_krish" created="Thu, 1 Mar 2012 15:20:38 +0000"  >&lt;p&gt;Patch addressing Ted&apos;s comments.  &lt;br/&gt;
@Ted&lt;br/&gt;
If the patch is fine, we can commit it for 0.90.7?&lt;/p&gt;</comment>
                            <comment id="13220121" author="zhihyu@ebaysf.com" created="Thu, 1 Mar 2012 16:04:18 +0000"  >&lt;p&gt;The following tests passed based on patch v2:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  929  mt -Dtest=TestLoadBalancer
  931  mt -Dtest=TestRegionRebalancing
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;+1 on patch v2.&lt;/p&gt;</comment>
                            <comment id="13232757" author="ram_krish" created="Mon, 19 Mar 2012 17:43:37 +0000"  >&lt;p&gt;Committed to 0.90.  Thanks for the review Ted.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12516583" name="5482-v2.txt" size="11819" author="zhihyu@ebaysf.com" created="Wed, 29 Feb 2012 17:31:07 +0000"/>
                            <attachment id="12516335" name="HBASE-5482_1.patch" size="11811" author="ram_krish" created="Tue, 28 Feb 2012 14:53:26 +0000"/>
                            <attachment id="12516688" name="HBASE-5482_2.patch" size="11831" author="ram_krish" created="Thu, 1 Mar 2012 15:20:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 29 Feb 2012 17:31:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>229468</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 39 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06993:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34430</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>