<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:07:31 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3122/HBASE-3122.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3122] NPE in master.AssignmentManager if all region servers shut down</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3122</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;10/10/18 16:26:44 INFO catalog.CatalogTracker: acer,60020,1287443908850 carrying .META.; unsetting .META. location&lt;br/&gt;
10/10/18 16:26:44 INFO catalog.CatalogTracker: Current cached META location is not valid, resetting&lt;br/&gt;
10/10/18 16:26:44 INFO handler.ServerShutdownHandler: Splitting logs for acer,60020,1287443908850&lt;br/&gt;
10/10/18 16:26:44 INFO zookeeper.ZKUtil: hconnection-0x12bc1a2f0a60001 Set watcher on existing znode /hbase/root-region-server&lt;br/&gt;
10/10/18 16:26:44 INFO catalog.RootLocationEditor: Unsetting ROOT region location in ZooKeeper&lt;br/&gt;
10/10/18 16:26:44 DEBUG zookeeper.ZKAssign: master:60000-0x12bc1a2f0a60000 Creating (or updating) unassigned node for 70236052 with OFFLINE state&lt;br/&gt;
10/10/18 16:26:44 WARN master.LoadBalancer: Wanted to do random assignment but no servers to assign to&lt;br/&gt;
10/10/18 16:26:44 ERROR executor.EventHandler: Caught throwable while processing event M_SERVER_SHUTDOWN&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.hadoop.hbase.master.LoadBalancer$RegionPlan.toString(LoadBalancer.java:595)&lt;br/&gt;
	at java.lang.String.valueOf(String.java:2826)&lt;br/&gt;
	at java.lang.StringBuilder.append(StringBuilder.java:115)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.AssignmentManager.getRegionPlan(AssignmentManager.java:803)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.AssignmentManager.getRegionPlan(AssignmentManager.java:777)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:720)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:640)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.AssignmentManager.assignRoot(AssignmentManager.java:922)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.handler.ServerShutdownHandler.process(ServerShutdownHandler.java:97)&lt;br/&gt;
	at org.apache.hadoop.hbase.executor.EventHandler.run(EventHandler.java:150)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12477682">HBASE-3122</key>
            <summary>NPE in master.AssignmentManager if all region servers shut down</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Oct 2010 23:29:52 +0000</created>
                <updated>Fri, 20 Nov 2015 12:40:40 +0000</updated>
                            <resolved>Wed, 10 Nov 2010 05:35:45 +0000</resolved>
                                    <version>0.90.0</version>
                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12922440" author="stack" created="Tue, 19 Oct 2010 05:12:54 +0000"  >&lt;p&gt;This issue is a little more involved.  The kernel of the issue is what to do if no servers in the cluster when a shutdownserverhandler is running?  ShutdownServerHandler can&apos;t complete if not root or meta assigned.  I&apos;m thinking that SSH should just hang around.  Off in assign, we should check online servers and if none, then hold (unless master is asked shutdown).  The hold would be after the server&apos;s logs had been split.&lt;/p&gt;</comment>
                            <comment id="12927074" author="stack" created="Mon, 1 Nov 2010 18:20:49 +0000"  >&lt;p&gt;J-D just got this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
11:17 &amp;lt; jdcryans&amp;gt; I started just 1 master and 1 RS, but the RS died because of an NPE in some code I was testing
11:17 &amp;lt; jdcryans&amp;gt; by the time I redeployed the fix and restarted the RS, master was dying

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12927637" author="jdcryans" created="Tue, 2 Nov 2010 21:54:18 +0000"  >&lt;p&gt;Upgrading to blocker, need it for 0.90.0 for all the first time testers out there that will mess up their setup and will get stuck.&lt;/p&gt;</comment>
                            <comment id="12930494" author="stack" created="Wed, 10 Nov 2010 05:35:45 +0000"  >&lt;p&gt;Resolving as no longer valid.  Looks like this is fixed.  I tested killing single regionserver multiple times.  &lt;del&gt;ROOT&lt;/del&gt; and .META. hang out in RIT.. cycling, timing out waiting on someone to assign too... then if you start up an RS, it just goes ahead and assigns them... Here&apos;s log snippets:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
REGION_OPENED
2010-11-10 05:28:11,038 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x12c343c19d40000 Successfully deleted unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region 686d4b2520f56c32877d51bcc08b355a in expected state RS_ZK_REGION_OPENED
2010-11-10 05:28:11,039 DEBUG org.apache.hadoop.hbase.master.handler.OpenedRegionHandler: Opened region usertable,user992934061,1288992609496.686d4b2520f56c32877d51bcc08b355a. on sv2borg180,60020,1289366835169






2010-11-10 05:31:33,027 INFO org.apache.hadoop.hbase.zookeeper.RegionServerTracker: RegionServer ephemeral node deleted, processing expiration [sv2borg180,60020,1289366835169]
2010-11-10 05:31:33,028 DEBUG org.apache.hadoop.hbase.master.ServerManager: Added=sv2borg180,60020,1289366835169 to dead servers, submitted shutdown handler to be executed, root=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, meta=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2010-11-10 05:31:33,028 INFO org.apache.hadoop.hbase.master.handler.ServerShutdownHandler: Splitting logs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; sv2borg180,60020,1289366835169
2010-11-10 05:31:33,031 INFO org.apache.hadoop.hbase.regionserver.wal.HLogSplitter: Splitting 1 hlog(s) in hdfs:&lt;span class=&quot;code-comment&quot;&gt;//sv2borg180:20000/hbase/.logs/sv2borg180,60020,1289366835169
&lt;/span&gt;2010-11-10 05:31:33,031 DEBUG org.apache.hadoop.hbase.regionserver.wal.HLogSplitter: Splitting hlog 1 of 1: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//sv2borg180:20000/hbase/.logs/sv2borg180,60020,1289366835169/10.20.20.180%3A60020.1289366835754, length=0
&lt;/span&gt;
....

2010-11-10 05:31:47,409 DEBUG org.apache.hadoop.hbase.regionserver.wal.HLogSplitter: Moved 0 log files to /hbase/.oldlogs
2010-11-10 05:31:47,433 INFO org.apache.hadoop.hbase.regionserver.wal.HLogSplitter: hlog file splitting completed in 14404 ms &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hdfs:&lt;span class=&quot;code-comment&quot;&gt;//sv2borg180:20000/hbase/.logs/sv2borg180,60020,1289366835169
&lt;/span&gt;2010-11-10 05:31:47,443 INFO org.apache.hadoop.hbase.catalog.RootLocationEditor: Unsetting ROOT region location in ZooKeeper
2010-11-10 05:31:47,466 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x12c343c19d40000 Creating (or updating) unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 70236052 with OFFLINE state
2010-11-10 05:31:47,492 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x12c343c19d40000 Creating (or updating) unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 1028785192 with OFFLINE state
2010-11-10 05:31:47,517 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=M_ZK_REGION_OFFLINE, server=sv2borg180:60000, region=1028785192/.META.
2010-11-10 05:31:47,517 INFO org.apache.hadoop.hbase.catalog.CatalogTracker: Failed verification of .META.,,1 at address=sv2borg180:60020; java.net.ConnectException: Connection refused
2010-11-10 05:31:47,517 INFO org.apache.hadoop.hbase.catalog.CatalogTracker: Current cached META location is not valid, resetting
2010-11-10 05:32:23,752 INFO org.apache.hadoop.hbase.master.AssignmentManager: Regions in transition timed out:  .META.,,1.1028785192 state=OFFLINE, ts=1289367107492
2010-11-10 05:32:23,752 INFO org.apache.hadoop.hbase.master.AssignmentManager: Region has been OFFLINE &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, reassigning .META.,,1.1028785192 to a random server
2010-11-10 05:32:23,752 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Forcing OFFLINE; was=.META.,,1.1028785192 state=OFFLINE, ts=1289367107492
2010-11-10 05:32:23,752 INFO org.apache.hadoop.hbase.master.AssignmentManager: Regions in transition timed out:  -ROOT-,,0.70236052 state=OFFLINE, ts=1289367107466
2010-11-10 05:32:23,752 INFO org.apache.hadoop.hbase.master.AssignmentManager: Region has been OFFLINE &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, reassigning -ROOT-,,0.70236052 to a random server
2010-11-10 05:32:23,752 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Forcing OFFLINE; was=-ROOT-,,0.70236052 state=OFFLINE, ts=1289367107466
....


2010-11-10 05:33:16,718 INFO org.apache.hadoop.hbase.master.ServerManager: Registering server=sv2borg180,60020,1289367196372, regionCount=0, userLoad=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2010-11-10 05:33:23,753 INFO org.apache.hadoop.hbase.master.AssignmentManager: Regions in transition timed out:  .META.,,1.1028785192 state=OFFLINE, ts=1289367173753
2010-11-10 05:33:23,753 INFO org.apache.hadoop.hbase.master.AssignmentManager: Region has been OFFLINE &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, reassigning .META.,,1.1028785192 to a random server
2010-11-10 05:33:23,753 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Forcing OFFLINE; was=.META.,,1.1028785192 state=OFFLINE, ts=1289367173753
2010-11-10 05:33:23,754 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: No previous transition plan was found (or we are ignoring an existing plan) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; .META.,,1.1028785192 so generated a random one; hri=.META.,,1.1028785192, src=, dest=sv2borg180,60020,1289367196372; 1 (online=1, exclude=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) available servers
2010-11-10 05:33:23,754 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Assigning region .META.,,1.1028785192 to sv2borg180,60020,1289367196372
2010-11-10 05:33:23,754 DEBUG org.apache.hadoop.hbase.master.ServerManager: New connection to sv2borg180,60020,1289367196372
2010-11-10 05:33:23,802 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENING, server=sv2borg180,60020,1289367196372, region=1028785192/.META.
2010-11-10 05:33:24,202 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENING, server=sv2borg180,60020,1289367196372, region=1028785192/.META.
2010-11-10 05:33:33,754 INFO org.apache.hadoop.hbase.master.AssignmentManager: Regions in transition timed out:  -ROOT-,,0.70236052 state=OFFLINE, ts=1289367173754
2010-11-10 05:33:33,754 INFO org.apache.hadoop.hbase.master.AssignmentManager: Region has been OFFLINE &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, reassigning -ROOT-,,0.70236052 to a random server
2010-11-10 05:33:33,754 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Forcing OFFLINE; was=-ROOT-,,0.70236052 state=OFFLINE, ts=1289367173754
2010-11-10 05:33:33,754 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: No previous transition plan was found (or we are ignoring an existing plan) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; -ROOT-,,0.70236052 so generated a random one;   hri=-ROOT-,,0.70236052, src=, dest=sv2borg180,60020,1289367196372; 1 (online=1, exclude=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) available servers
2010-11-10 05:33:33,754 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Assigning region -ROOT-,,0.70236052 to sv2borg180,60020,1289367196372
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After all of the above done multiple times, hbck reports alls well.&lt;/p&gt;</comment>
                            <comment id="15016770" author="lars_francke" created="Fri, 20 Nov 2015 12:40:40 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 19 Oct 2010 05:12:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26660</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hkuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100639</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>