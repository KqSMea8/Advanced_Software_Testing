<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:25:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11646/HBASE-11646.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11646] Handle the MOB in compaction</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11646</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In the updated MOB design however, admins can set CF level thresholds that would force cell values &amp;gt; the threshold to use the MOB write path instead of the traditional path.  There are two cases where mobs need to interact with this threshold&lt;/p&gt;

&lt;p&gt;1) How do we handle the case when the threshold size is changed?&lt;br/&gt;
2) Today, you can bulkload hfiles that contain MOBs.  These cells will work as normal inside hbase.  Unfortunately the cells with MOBs in them will never benefit form the MOB write path.&lt;/p&gt;

&lt;p&gt;The proposal here is to modify compaction in mob enabled cf&apos;s such that the threshold value is honored with compactions.  This handles case #1 &amp;#8211; elements that should be moved out of the normal hfiles get &apos;compacted&apos; into refs and mob hfiles, and values that should be pulled into the cf get derefed and written out wholy in the compaction.  For case #2, we can maintain the same behavior and compaction would move data into the mob writepath/lifecycle.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12731294">HBASE-11646</key>
            <summary>Handle the MOB in compaction</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12721032">HBASE-11339</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jingcheng.du@intel.com">Jingcheng Du</assignee>
                                    <reporter username="jingcheng.du@intel.com">Jingcheng Du</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Aug 2014 08:51:24 +0000</created>
                <updated>Wed, 22 Jul 2015 22:48:48 +0000</updated>
                            <resolved>Thu, 18 Sep 2014 14:08:10 +0000</resolved>
                                    <version>hbase-11339</version>
                                    <fixVersion>hbase-11339</fixVersion>
                                    <component>Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="14086330" author="jmhsieh" created="Tue, 5 Aug 2014 14:45:46 +0000"  >&lt;p&gt;reorganized the description to make it easier to follow&lt;/p&gt;</comment>
                            <comment id="14087140" author="jingcheng.du@intel.com" created="Wed, 6 Aug 2014 02:21:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmhsieh&quot; class=&quot;user-hover&quot; rel=&quot;jmhsieh&quot;&gt;Jonathan Hsieh&lt;/a&gt; Thanks Jon for the descriptions.&lt;br/&gt;
for the case#1, if a threshold is set larger, do we need to save the mob data back to the HBase? Or just leave them in the mob files?&lt;/p&gt;</comment>
                            <comment id="14087205" author="jmhsieh" created="Wed, 6 Aug 2014 03:46:15 +0000"  >&lt;p&gt;The most important thing is that hbase serves the correct data regardless of whether we move data into or out of the mob write path.  My gut says we&apos;d want to put a new copy of the mob them back into normal hfiles if the threshold is changed &amp;#8211; having it only go one way and being irreversible seems inconsistent.  Can you come up with a case where we wouldn&apos;t want or expect the copy back into hfiles behavior?&lt;/p&gt;</comment>
                            <comment id="14087287" author="jingcheng.du@intel.com" created="Wed, 6 Aug 2014 05:41:46 +0000"  >&lt;p&gt;Thanks. I don&apos;t think I have. I agree with the bi-direction move.&lt;/p&gt;</comment>
                            <comment id="14098379" author="jingcheng.du@intel.com" created="Fri, 15 Aug 2014 09:21:26 +0000"  >&lt;p&gt;The threshold might be changed.&lt;br/&gt;
After that, some cells in the mob files need to be added back to HBase store file, some cells in the HBase store files needs to be added to mob files. These are done in the HBase compaction. And it&apos;s implemented in this patch.&lt;/p&gt;</comment>
                            <comment id="14102497" author="jmhsieh" created="Tue, 19 Aug 2014 17:25:57 +0000"  >&lt;p&gt;note &amp;#8211; the patch is being reviewed here &lt;a href=&quot;https://reviews.apache.org/r/24736/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/24736/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14113582" author="jingcheng.du@intel.com" created="Thu, 28 Aug 2014 09:16:24 +0000"  >&lt;p&gt;Refine the patch according to Jon, Ram and Anoop&apos;s comments and improvements. Thanks a lot.&lt;br/&gt;
Upload the latest patch, please help review and comment. Thanks.&lt;/p&gt;</comment>
                            <comment id="14114775" author="jingcheng.du@intel.com" created="Fri, 29 Aug 2014 02:36:39 +0000"  >&lt;p&gt;Refactor the code after changing the mob flag and threshold in the hcd from string to byte[].&lt;/p&gt;</comment>
                            <comment id="14115055" author="jingcheng.du@intel.com" created="Fri, 29 Aug 2014 09:39:03 +0000"  >&lt;p&gt;Update the patch to refine the class import in the Compactor.&lt;/p&gt;</comment>
                            <comment id="14122598" author="jingcheng.du@intel.com" created="Fri, 5 Sep 2014 08:13:21 +0000"  >&lt;p&gt;Update the patch after the value size of a reference cell in a mob-enabled column is changed from a long to an int.&lt;/p&gt;</comment>
                            <comment id="14131366" author="jingcheng.du@intel.com" created="Fri, 12 Sep 2014 10:45:08 +0000"  >&lt;p&gt;Upload the latest patch (V6). Refine the code and comments, add methods to parse the value of mob ref cell.&lt;/p&gt;</comment>
                            <comment id="14131370" author="hadoopqa" created="Fri, 12 Sep 2014 10:52:46 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12668311/HBASE-11646-V6.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12668311/HBASE-11646-V6.diff&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12668311&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10859//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10859//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14137005" author="jingcheng.du@intel.com" created="Wed, 17 Sep 2014 09:43:13 +0000"  >&lt;p&gt;Update the patch according Anoop&apos;s comments in RB.&lt;/p&gt;</comment>
                            <comment id="14137012" author="hadoopqa" created="Wed, 17 Sep 2014 09:52:28 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12669376/HBASE-11646-V7.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12669376/HBASE-11646-V7.diff&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12669376&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10942//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10942//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14137287" author="anoop.hbase" created="Wed, 17 Sep 2014 14:10:11 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14138147" author="jmhsieh" created="Wed, 17 Sep 2014 22:49:08 +0000"  >&lt;p&gt;I +1&apos;ed in review board.  Will commit to hbase-11339 pending clean test run.&lt;/p&gt;</comment>
                            <comment id="14138179" author="jmhsieh" created="Wed, 17 Sep 2014 23:12:40 +0000"  >&lt;p&gt;Did a minor tweak and ran &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 mvn clean test -Dtest=Test*Compact*
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It passed.  Commimtted to hbase-11339 branch.  thanks jingcheng and thanks for the reviews ram and anoop.&lt;/p&gt;
</comment>
                            <comment id="14138203" author="jmhsieh" created="Wed, 17 Sep 2014 23:33:41 +0000"  >&lt;p&gt;I cannot seem to commit currently.  will try again later and close issue then.&lt;/p&gt;</comment>
                            <comment id="14138205" author="jmhsieh" created="Wed, 17 Sep 2014 23:35:00 +0000"  >&lt;p&gt;attached th v8 version I tried to commit.&lt;/p&gt;</comment>
                            <comment id="14138557" author="jingcheng.du@intel.com" created="Thu, 18 Sep 2014 05:57:48 +0000"  >&lt;p&gt;Update the patch (V9) according to Jon and Ram&apos;s comments in RB.&lt;br/&gt;
1. &lt;span class=&quot;error&quot;&gt;Unable to render embedded object: File (Bytes.equals(emptyBytes, value) -&amp;gt; valueLength) not found.&lt;/span&gt;=0&lt;br/&gt;
2. Add comments to describe why we have to case the Store to HMobStore in DefaultMobCompactor.&lt;/p&gt;</comment>
                            <comment id="14138975" author="jmhsieh" created="Thu, 18 Sep 2014 14:07:58 +0000"  >&lt;p&gt;I&apos;ve commited v10 &amp;#8211; it has the same minor tweek v8 had.  Thanks jingcheng, ram and anoop.&lt;/p&gt;</comment>
                            <comment id="14637837" author="hudson" created="Wed, 22 Jul 2015 22:48:48 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6672 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6672/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6672/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11646&quot; title=&quot;Handle the MOB in compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11646&quot;&gt;&lt;del&gt;HBASE-11646&lt;/del&gt;&lt;/a&gt; Handle the MOB in compaction (Jingcheng Du) (jmhsieh: rev 7dbd828a90e36c3b94fcadf659ce047a1ddbce0e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HMobStore.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/Compactor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mob/MobUtils.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestMobCompaction.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/StripeCompactor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mob/DefaultMobCompactor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/DefaultCompactor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mob/MobStoreEngine.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12732216">HBASE-11683</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12731290">HBASE-11643</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12739309">HBASE-11901</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12664853" name="HBASE-11646-V2.diff" size="33818" author="jingcheng.du@intel.com" created="Thu, 28 Aug 2014 09:16:24 +0000"/>
                            <attachment id="12665190" name="HBASE-11646-V3.diff" size="33573" author="jingcheng.du@intel.com" created="Fri, 29 Aug 2014 02:36:39 +0000"/>
                            <attachment id="12665306" name="HBASE-11646-V4.diff" size="33195" author="jingcheng.du@intel.com" created="Fri, 29 Aug 2014 09:39:03 +0000"/>
                            <attachment id="12666685" name="HBASE-11646-V5.diff" size="33182" author="jingcheng.du@intel.com" created="Fri, 5 Sep 2014 08:13:21 +0000"/>
                            <attachment id="12668311" name="HBASE-11646-V6.diff" size="37848" author="jingcheng.du@intel.com" created="Fri, 12 Sep 2014 10:45:08 +0000"/>
                            <attachment id="12669376" name="HBASE-11646-V7.diff" size="36216" author="jingcheng.du@intel.com" created="Wed, 17 Sep 2014 09:43:13 +0000"/>
                            <attachment id="12669645" name="HBASE-11646-V9.diff" size="36377" author="jingcheng.du@intel.com" created="Thu, 18 Sep 2014 05:57:48 +0000"/>
                            <attachment id="12662036" name="HBASE-11646.diff" size="26816" author="jingcheng.du@intel.com" created="Fri, 15 Aug 2014 09:21:26 +0000"/>
                            <attachment id="12669734" name="hbase-11646-v10.patch" size="37206" author="jmhsieh" created="Thu, 18 Sep 2014 14:07:58 +0000"/>
                            <attachment id="12669563" name="hbase-11646-v8.patch" size="37046" author="jmhsieh" created="Wed, 17 Sep 2014 23:35:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 5 Aug 2014 14:45:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409366</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yfnz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409362</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>