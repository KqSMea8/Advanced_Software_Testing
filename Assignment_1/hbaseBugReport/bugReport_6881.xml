<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:40:41 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6881/HBASE-6881.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6881] All regionservers are marked offline even there is still one up</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6881</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+        RegionPlan newPlan = plan;
+        if (!regionAlreadyInTransitionException) {
+          // Force a new plan and reassign. Will return null if no servers.
+          newPlan = getRegionPlan(state, plan.getDestination(), true);
+        }
+        if (newPlan == null) {
           this.timeoutMonitor.setAllRegionServersOffline(true);
           LOG.warn(&quot;Unable to find a viable location to assign region &quot; +
             state.getRegion().getRegionNameAsString());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here, when newPlan is null, plan.getDestination() could be up actually.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12609109">HBASE-6881</key>
            <summary>All regionservers are marked offline even there is still one up</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jxiang">Jimmy Xiang</assignee>
                                    <reporter username="jxiang">Jimmy Xiang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Sep 2012 19:37:07 +0000</created>
                <updated>Mon, 23 Sep 2013 18:30:26 +0000</updated>
                            <resolved>Mon, 1 Oct 2012 18:07:51 +0000</resolved>
                                                    <fixVersion>0.95.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13463162" author="jxiang" created="Tue, 25 Sep 2012 20:04:12 +0000"  >&lt;p&gt;This is NOT an issue caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6438&quot; title=&quot;RegionAlreadyInTransitionException needs to give more info to avoid assignment inconsistencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6438&quot;&gt;&lt;del&gt;HBASE-6438&lt;/del&gt;&lt;/a&gt; actually. I fixed the description.  It is an existing issue.&lt;/p&gt;

&lt;p&gt;During unit test, there could be just one region server. This can lead to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6880&quot; title=&quot;Failure in assigning root causes system hang&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6880&quot;&gt;&lt;del&gt;HBASE-6880&lt;/del&gt;&lt;/a&gt;, and hanging tests.&lt;/p&gt;</comment>
                            <comment id="13463307" author="hadoopqa" created="Tue, 25 Sep 2012 22:48:54 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12546581/trunk-6881.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12546581/trunk-6881.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated 140 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 6 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2932//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13464240" author="stack" created="Wed, 26 Sep 2012 22:18:31 +0000"  >&lt;p&gt;This patch seems to be undoing hbase-6438?  Its ok to remove this bit added by hbase-6438?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!regionAlreadyInTransitionException ) {
-        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg = &lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected state : &quot;&lt;/span&gt; + state + &lt;span class=&quot;code-quote&quot;&gt;&quot; .. Cannot transit it to OFFLINE.&quot;&lt;/span&gt;;
-        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.abort(msg, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(msg));
-        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
-      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
-        LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected state : &quot;&lt;/span&gt; + state
-            + &lt;span class=&quot;code-quote&quot;&gt;&quot; but retrying to assign because RegionAlreadyInTransitionException.&quot;&lt;/span&gt;);
-      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suppose you are tightening up our state handling but the above seemed like a legit exception over in hbase-6438?&lt;/p&gt;


&lt;p&gt;Why change the final on the param?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void assign(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HRegionInfo region, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RegionState state,
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void assign(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HRegionInfo region, RegionState state,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You update state inside the method? You have to?  Can you make a local variable instead and leave the passed param final? Might make it easier to read?&lt;/p&gt;

&lt;p&gt;Here, what does the comment mean?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          &lt;span class=&quot;code-comment&quot;&gt;// The &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; plan could be the same as the existing plan.
&lt;/span&gt;+          newPlan = getRegionPlan(state, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We could get same plan again?  Is that ok?  It could be going back to the same server again since we don&apos;t pass the old destination server from previous plan?  Is that OK?&lt;/p&gt;
</comment>
                            <comment id="13464262" author="jxiang" created="Wed, 26 Sep 2012 22:50:13 +0000"  >&lt;p&gt;Thanks for the review.  I put it on RB for easy review:  &lt;a href=&quot;https://reviews.apache.org/r/7303/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/7303/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;For the removed code, it is not needed, because if regionAlreadyInTransition, we already transition the state to offline state in the exception handling part.&lt;/p&gt;

&lt;p&gt;For the final param, sure, I will use a local one. The state changes because we transition region state in this method.&lt;/p&gt;

&lt;p&gt;As to the comment, because we don&apos;t exclude the server of the origin plan.  Even we force a new plan, it is possible to get the original server since it is randomly selected.  If there is only one region server as in most unit tests, it will be the existing plan.  The reason we don&apos;t want to exclude the original server is that it could be the only server up at that time (as in most unit tests).  If we exclude it, the newPlan will be null and all servers will be marked offline.  If the region is ROOT, then it leads to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6880&quot; title=&quot;Failure in assigning root causes system hang&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6880&quot;&gt;&lt;del&gt;HBASE-6880&lt;/del&gt;&lt;/a&gt; and hanging unit test.&lt;/p&gt;


</comment>
                            <comment id="13464305" author="stack" created="Thu, 27 Sep 2012 00:09:31 +0000"  >&lt;p&gt;Thanks for the explanation.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;For the removed code, it is not needed, because if regionAlreadyInTransition, we already transition the state to offline state in the exception handling part.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is the above comment suppose to be relate to this code?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!hijack &amp;amp;&amp;amp; !state.isClosed() &amp;amp;&amp;amp; !state.isOffline()) {
-      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!regionAlreadyInTransitionException ) {
-        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg = &lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected state : &quot;&lt;/span&gt; + state + &lt;span class=&quot;code-quote&quot;&gt;&quot; .. Cannot transit it to OFFLINE.&quot;&lt;/span&gt;;
-        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.abort(msg, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(msg));
-        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
-      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
-        LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected state : &quot;&lt;/span&gt; + state
-            + &lt;span class=&quot;code-quote&quot;&gt;&quot; but retrying to assign because RegionAlreadyInTransitionException.&quot;&lt;/span&gt;);
-      }
+      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg = &lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected state : &quot;&lt;/span&gt; + state + &lt;span class=&quot;code-quote&quot;&gt;&quot; .. Cannot transit it to OFFLINE.&quot;&lt;/span&gt;;
+      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.abort(msg, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(msg));
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If so, I&apos;m not sure I follow.  The above code is a change which has us abort always if state is not closed or offline.  The old code did that  EXCEPT in the case where regionAlreadyInTransitionException is set.  You&apos;ve removed this latter special handling.&lt;/p&gt;

&lt;p&gt;Or are you saying that there is no need for this special exception handling because we&apos;ve successfully off-lined the region at #1498 in patched version up on RB at this line: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;currentState = regionStates.updateRegionState(&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;?&lt;/p&gt;

&lt;p&gt;I buy the other comments.  I see how excluding a server could be a problem.  This is a necessary fix.  I see that we preserve the basic idea of hbase-6384 which is keep old plan if RegionAlreadyInTransition (and now too if server not ready).&lt;/p&gt;
</comment>
                            <comment id="13464378" author="rajesh23" created="Thu, 27 Sep 2012 02:31:45 +0000"  >&lt;p&gt;@Jimmy,&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;For the removed code, it is not needed, because if regionAlreadyInTransition, we already transition the state to offline state in the exception handling part.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;there is a possibility that state can be changed to OPENING in handleRegion, after setting OFFLINE in exception handling part. That&apos;s why we are not aborting master even state is not offline/closed. We were able to produce this scenario while testing &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6438&quot; title=&quot;RegionAlreadyInTransitionException needs to give more info to avoid assignment inconsistencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6438&quot;&gt;&lt;del&gt;HBASE-6438&lt;/del&gt;&lt;/a&gt;. Please correct me if wrong.&lt;/p&gt;</comment>
                            <comment id="13464406" author="ram_krish" created="Thu, 27 Sep 2012 04:10:45 +0000"  >&lt;p&gt;@Jimmy&lt;br/&gt;
I typed my comment yesterday but i think it got lost due to some reasons.&lt;br/&gt;
In &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6438&quot; title=&quot;RegionAlreadyInTransitionException needs to give more info to avoid assignment inconsistencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6438&quot;&gt;&lt;del&gt;HBASE-6438&lt;/del&gt;&lt;/a&gt; we tried to handle the scenario where the region that is slow in processing could transition the node to OPENING and handleREgion could update the memory state to OPENING just after the assign retry as changed the state to OFFLINE.  This where we tried to handle &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6438&quot; title=&quot;RegionAlreadyInTransitionException needs to give more info to avoid assignment inconsistencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6438&quot;&gt;&lt;del&gt;HBASE-6438&lt;/del&gt;&lt;/a&gt; with some special handling.&lt;br/&gt;
Rajesh has commented what i missed out yesterday.&lt;/p&gt;</comment>
                            <comment id="13464875" author="jxiang" created="Thu, 27 Sep 2012 17:00:54 +0000"  >&lt;p&gt;Really good question.  It is great to work with you guys and the community.&lt;br/&gt;
My understanding is that you three all have concerns about the removed code.&lt;/p&gt;

&lt;p&gt;I think it is ok to remove it.  As stack pointed out, I think #1498 already transitions the state to offline.&lt;br/&gt;
handRegion can not transition the state now since we already hold the locker for this region, and will keep&lt;br/&gt;
the locker till the assign returns.&lt;/p&gt;

&lt;p&gt;I will look into it more and think about if there is a better way to handle RegionAlreadyInTransition.&lt;/p&gt;
</comment>
                            <comment id="13465043" author="jxiang" created="Thu, 27 Sep 2012 20:22:34 +0000"  >&lt;p&gt;In bulk assign, if a region is in transition, we think it is already opened.  Can we do the same for single assignment?&lt;br/&gt;
We need to check if the region is opening instead of closing though.  Or we should do the other way, changing bulk assign?&lt;/p&gt;</comment>
                            <comment id="13465049" author="stack" created="Thu, 27 Sep 2012 20:27:43 +0000"  >&lt;p&gt;Bulk assign is not to be copied in my opinion; its lax, absent critical checks.&lt;/p&gt;</comment>
                            <comment id="13465145" author="jxiang" created="Thu, 27 Sep 2012 21:57:03 +0000"  >&lt;p&gt;That&apos;s fine with me, agreed.&lt;/p&gt;</comment>
                            <comment id="13465784" author="jxiang" created="Fri, 28 Sep 2012 17:52:38 +0000"  >&lt;p&gt;Patch 3 is posted on RB: &lt;a href=&quot;https://reviews.apache.org/r/7303/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/7303/&lt;/a&gt;&lt;br/&gt;
Added retry in case of ServerNotRunningException&lt;/p&gt;

&lt;p&gt;For the bulk assignment handling of RegionAlreadyInTransitionException, I filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6896&quot; title=&quot;sync bulk and regular assigment handling socket timeout exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6896&quot;&gt;&lt;del&gt;HBASE-6896&lt;/del&gt;&lt;/a&gt;.  I can take care of it later on.&lt;/p&gt;

&lt;p&gt;One question is that, in case of ServerNotRunningException, I adjust the retry count till it is timed out, then try a new server.&lt;br/&gt;
Should we do not do that and let timeout monitor to handle it (i.e. fall back to patch 2 instead)?&lt;/p&gt;</comment>
                            <comment id="13465881" author="jxiang" created="Fri, 28 Sep 2012 20:30:47 +0000"  >&lt;p&gt;On the RB, Rajesh brought up a good point.  In case ServerNotRunningYetException, should we just try another region server, instead of waiting till it is up? I think we should do our best to use the same region server at first, because it could be a region server requested by the user, or there is some locality issue.  What do you think?&lt;/p&gt;</comment>
                            <comment id="13466682" author="ram_krish" created="Mon, 1 Oct 2012 07:42:43 +0000"  >&lt;p&gt;@Jimmy&lt;br/&gt;
The case here is mainly in case of one RS.  And i too feel trying to same RS should work out fine.  I feel this is ok as per the current patch.  Am +1 on commit too.&lt;/p&gt;</comment>
                            <comment id="13467019" author="hadoopqa" created="Mon, 1 Oct 2012 18:01:58 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12547012/trunk-6881_v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12547012/trunk-6881_v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2977//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2977//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13467026" author="jxiang" created="Mon, 1 Oct 2012 18:07:51 +0000"  >&lt;p&gt;Thanks for Stack, Ram and Rajesh for reviewing it. Integrated to trunk.&lt;/p&gt;</comment>
                            <comment id="13467050" author="ram_krish" created="Mon, 1 Oct 2012 18:23:33 +0000"  >&lt;p&gt;Sorry.  One query. The RegionAlreadyInTransition change you removed right that was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6438&quot; title=&quot;RegionAlreadyInTransitionException needs to give more info to avoid assignment inconsistencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6438&quot;&gt;&lt;del&gt;HBASE-6438&lt;/del&gt;&lt;/a&gt;? Is it ok? Or are we going to leave the change and address in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6896&quot; title=&quot;sync bulk and regular assigment handling socket timeout exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6896&quot;&gt;&lt;del&gt;HBASE-6896&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13467071" author="jxiang" created="Mon, 1 Oct 2012 18:37:50 +0000"  >&lt;p&gt;No problem. I think the removal is ok.  The majority of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6438&quot; title=&quot;RegionAlreadyInTransitionException needs to give more info to avoid assignment inconsistencies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6438&quot;&gt;&lt;del&gt;HBASE-6438&lt;/del&gt;&lt;/a&gt; is still there.&lt;/p&gt;

&lt;p&gt;For the removal, due to the locker, it won&apos;t be changed by the ZK event thread.&lt;br/&gt;
It can be changed by bulk assigner only before &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6611&quot; title=&quot;Forcing region state offline cause double assignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6611&quot;&gt;&lt;del&gt;HBASE-6611&lt;/del&gt;&lt;/a&gt; is in.&lt;br/&gt;
After &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6611&quot; title=&quot;Forcing region state offline cause double assignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6611&quot;&gt;&lt;del&gt;HBASE-6611&lt;/del&gt;&lt;/a&gt; is in, it won&apos;t be changed in the middle of this assign call.&lt;/p&gt;

&lt;p&gt;We can get it back in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6896&quot; title=&quot;sync bulk and regular assigment handling socket timeout exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6896&quot;&gt;&lt;del&gt;HBASE-6896&lt;/del&gt;&lt;/a&gt; if it turns out to be needed.&lt;/p&gt;
</comment>
                            <comment id="13467198" author="hudson" created="Mon, 1 Oct 2012 21:08:39 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3400 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3400/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3400/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6881&quot; title=&quot;All regionservers are marked offline even there is still one up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6881&quot;&gt;&lt;del&gt;HBASE-6881&lt;/del&gt;&lt;/a&gt; All regionservers are marked offline even there is still one up (Revision 1392467)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
jxiang : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13467299" author="hudson" created="Mon, 1 Oct 2012 23:20:27 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #202 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/202/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/202/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6881&quot; title=&quot;All regionservers are marked offline even there is still one up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6881&quot;&gt;&lt;del&gt;HBASE-6881&lt;/del&gt;&lt;/a&gt; All regionservers are marked offline even there is still one up (Revision 1392467)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
jxiang : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13618312" author="jmspaggi" created="Sun, 31 Mar 2013 12:12:47 +0000"  >&lt;p&gt;Sorry for beeing late on that:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
         RegionPlan newPlan = plan;
-        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!regionAlreadyInTransitionException) {
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!regionAlreadyInTransitionException &amp;amp;&amp;amp; !serverNotRunningYet) {
           &lt;span class=&quot;code-comment&quot;&gt;// Force a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; plan and reassign. Will &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; no servers.
&lt;/span&gt;-          newPlan = getRegionPlan(state, plan.getDestination(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
+          &lt;span class=&quot;code-comment&quot;&gt;// The &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; plan could be the same as the existing plan since we don&apos;t
&lt;/span&gt;+          &lt;span class=&quot;code-comment&quot;&gt;// exclude the server of the original plan, which should not be
&lt;/span&gt;+          &lt;span class=&quot;code-comment&quot;&gt;// excluded since it could be the only server up now.
&lt;/span&gt;+          newPlan = getRegionPlan(state, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
         }
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (newPlan == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If there is a possibility for newPlan to be null, than mean there is a possibility for plan to be null, and therefore for plan.getDestination() to fail with NPE? Or will plan never be null if regionAlreadyInTransitionException and serverNotRunningYet are false?&lt;/p&gt;</comment>
                            <comment id="13618357" author="jxiang" created="Sun, 31 Mar 2013 15:47:08 +0000"  >&lt;p&gt;That line is removed actually.  Is the latest code still this way?&lt;/p&gt;</comment>
                            <comment id="13618363" author="jxiang" created="Sun, 31 Mar 2013 15:56:10 +0000"  >&lt;p&gt;That&apos;s inside the assign method.  The plan over that should not be null. Checked the latest code, it is enhanced.&lt;/p&gt;</comment>
                            <comment id="13618421" author="jmspaggi" created="Sun, 31 Mar 2013 18:48:16 +0000"  >&lt;p&gt;I was looking at the patch only. Looking at the code directly in trunk, as you said, it&apos;s not there anymore. It changed a lot already. So my comment is not relevent anymore for the trunk code.&lt;/p&gt;</comment>
                            <comment id="13619194" author="hudson" created="Mon, 1 Apr 2013 21:26:22 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #934 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/934/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/934/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7925&quot; title=&quot;Back port HBASE-6881 into 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7925&quot;&gt;&lt;del&gt;HBASE-7925&lt;/del&gt;&lt;/a&gt; Back port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6881&quot; title=&quot;All regionservers are marked offline even there is still one up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6881&quot;&gt;&lt;del&gt;HBASE-6881&lt;/del&gt;&lt;/a&gt; into 0.94 (Rajeshbabu) (Revision 1463155)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13622795" author="hudson" created="Thu, 4 Apr 2013 21:16:28 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #130 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/130/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/130/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7925&quot; title=&quot;Back port HBASE-6881 into 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7925&quot;&gt;&lt;del&gt;HBASE-7925&lt;/del&gt;&lt;/a&gt; Back port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6881&quot; title=&quot;All regionservers are marked offline even there is still one up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6881&quot;&gt;&lt;del&gt;HBASE-6881&lt;/del&gt;&lt;/a&gt; into 0.94 (Rajeshbabu) (Revision 1463155)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13623164" author="hudson" created="Fri, 5 Apr 2013 01:00:51 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #13 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/13/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/13/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7925&quot; title=&quot;Back port HBASE-6881 into 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7925&quot;&gt;&lt;del&gt;HBASE-7925&lt;/del&gt;&lt;/a&gt; Back port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6881&quot; title=&quot;All regionservers are marked offline even there is still one up&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6881&quot;&gt;&lt;del&gt;HBASE-6881&lt;/del&gt;&lt;/a&gt; into 0.94 (Rajeshbabu) (Revision 1463155)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13774959" author="stack" created="Mon, 23 Sep 2013 18:30:26 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12609104">HBASE-6880</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12633876">HBASE-7925</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12546581" name="trunk-6881.patch" size="7308" author="jxiang" created="Tue, 25 Sep 2012 20:58:19 +0000"/>
                            <attachment id="12547012" name="trunk-6881_v3.patch" size="8037" author="jxiang" created="Fri, 28 Sep 2012 17:26:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 25 Sep 2012 22:48:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242437</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02ux3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14610</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>