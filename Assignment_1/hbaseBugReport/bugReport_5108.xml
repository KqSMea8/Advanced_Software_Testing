<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:24:50 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5108/HBASE-5108.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5108] ICV puts memstore before writing WAL first -- by default; make the default be &apos;correct&apos; and let better perf be optional</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5108</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;See this thread up on the list and Lars&apos; note on the end: &lt;a href=&quot;http://search-hadoop.com/m/Y6xTRp6sxq1/%2522Help+regarding+RowLock%2522&amp;amp;subj=Help+regarding+RowLock&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://search-hadoop.com/m/Y6xTRp6sxq1/%2522Help+regarding+RowLock%2522&amp;amp;subj=Help+regarding+RowLock&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I thought it was just ICV that did the memstore put first.  This issue is about making it so the described behavior is optional and that the default out of the box goes for correctness &amp;#8211; i.e. write WAL first and then memstore.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12536641">HBASE-5108</key>
            <summary>ICV puts memstore before writing WAL first -- by default; make the default be &apos;correct&apos; and let better perf be optional</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="4">Incomplete</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Dec 2011 04:46:49 +0000</created>
                <updated>Sat, 11 Apr 2015 01:03:06 +0000</updated>
                            <resolved>Sat, 11 Apr 2015 01:03:06 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13177552" author="lhofhansl" created="Fri, 30 Dec 2011 04:59:48 +0000"  >&lt;p&gt;When I wrote that paragraph I had ICV in mind. Sorry about the confusion. checkAnd* do the right thing.&lt;/p&gt;</comment>
                            <comment id="13177557" author="lhofhansl" created="Fri, 30 Dec 2011 05:05:22 +0000"  >&lt;p&gt;We can fix the ICV issue here (if we want). There is some discussion about this in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4583&quot; title=&quot;Integrate RWCC with Append and Increment operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4583&quot;&gt;&lt;del&gt;HBASE-4583&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13177559" author="stack" created="Fri, 30 Dec 2011 05:14:54 +0000"  >&lt;p&gt;np  Let me edit subject....&lt;/p&gt;</comment>
                            <comment id="13177570" author="lhofhansl" created="Fri, 30 Dec 2011 06:05:44 +0000"  >&lt;p&gt;As discussed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4583&quot; title=&quot;Integrate RWCC with Append and Increment operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4583&quot;&gt;&lt;del&gt;HBASE-4583&lt;/del&gt;&lt;/a&gt;, this will make ICV significantly slower, unless writeToWal is set to false.&lt;/p&gt;</comment>
                            <comment id="13177899" author="lhofhansl" created="Sat, 31 Dec 2011 05:09:35 +0000"  >&lt;p&gt;To be very precise, what happens (ICV, increment, append) is that the WAL is written with the lock held, but the sync request is issued after the lock is released.&lt;/p&gt;

&lt;p&gt;So what could happen is that the other clients see the updated value in the memstore (in fact they do see it right away - see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4583&quot; title=&quot;Integrate RWCC with Append and Increment operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4583&quot;&gt;&lt;del&gt;HBASE-4583&lt;/del&gt;&lt;/a&gt;). Now, if the region server dies before the sync was executed the clients might have based their logic upon uncommitted state.&lt;br/&gt;
We cannot roll back the memstore state for ICVs because the operation is not idempotent (and for various other reasons also explained in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4583&quot; title=&quot;Integrate RWCC with Append and Increment operations&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4583&quot;&gt;&lt;del&gt;HBASE-4583&lt;/del&gt;&lt;/a&gt;, all client scanners see the updates immediately).&lt;/p&gt;

&lt;p&gt;I am somewhat torn on this one. This failure scenario is pretty rare, and the performance implication of doing 100% correct would be significant. Maybe for ICVs there should be three different options: (1) write WAL synchronously, (2) don&apos;t write WAL, a new option (3) do a &quot;best effort&quot; WAL write.&lt;/p&gt;</comment>
                            <comment id="13177901" author="lhofhansl" created="Sat, 31 Dec 2011 05:09:56 +0000"  >&lt;p&gt;Where #3 would be the current behavior.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 30 Dec 2011 04:59:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>222324</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 50 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02ctr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11679</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>