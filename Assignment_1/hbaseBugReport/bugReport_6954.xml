<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:41:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6954/HBASE-6954.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6954] Column-counting filters can accept multiple versions of a column</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6954</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;It looks like the max version limit for a table or scanner is not applied to disregard older versions, prior to counting columns within a ColumnPaginationFilter or ColumnCountGetFilter. As a result, a Scan or Get can ultimately retrieve fewer than the requested number of columns when there is a sufficient number of existing columns to satisfy the request, if multiple versions of a column have been added to a row.&lt;/p&gt;

&lt;p&gt;A minimal test case demonstrating this behavior is attached.&lt;/p&gt;

&lt;p&gt;The javadoc for Get mentions &apos;Only Filter.filterKeyValue(KeyValue) is called AFTER all tests for ttl, column match, deletes and max versions have been run.&apos;; for these two filters this behavior does not appear to be true, as flattening of multiple versions appears to occur after the filter has been applied.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12610413">HBASE-6954</key>
            <summary>Column-counting filters can accept multiple versions of a column</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="noslowerdna">Andrew Olson</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Oct 2012 21:50:38 +0000</created>
                <updated>Sun, 14 Jul 2013 07:37:09 +0000</updated>
                                                                            <component>Filters</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13469807" author="zhihyu@ebaysf.com" created="Thu, 4 Oct 2012 22:53:51 +0000"  >&lt;p&gt;@Andrew:&lt;br/&gt;
There is already hbase-server/src/test/java/org/apache/hadoop/hbase/filter/TestColumnPaginationFilter.java in source repo&lt;br/&gt;
Can you fold your test into that class ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13474774" author="lhofhansl" created="Fri, 12 Oct 2012 04:26:32 +0000"  >&lt;p&gt;As I pointed out on the mailing list, this is by design.&lt;br/&gt;
Here&apos;s a comment to that extend in ScanQueryMatcher.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /**
     * Filters should be checked before checking column trackers. If we &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt;
     * otherwise, as was previously being done, ColumnTracker may increment its
     * counter &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; even that KV which may be discarded later on by Filter. This
     * would lead to incorrect results in certain cases.
     */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;There are cases where folks want filters before the version counting and cases where they want it after the version counting.&lt;br/&gt;
Can&apos;t have it both ways, unless we&apos;re adding mechanisms to have the filter decide.&lt;/p&gt;

&lt;p&gt;I made an effort to do this in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5257&quot; title=&quot;Allow INCLUDE_AND_NEXT_COL in filters and use it in ColumnPaginationFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5257&quot;&gt;&lt;del&gt;HBASE-5257&lt;/del&gt;&lt;/a&gt;, I can revive that if there is demand.&lt;/p&gt;</comment>
                            <comment id="13474995" author="noslowerdna" created="Fri, 12 Oct 2012 13:58:31 +0000"  >&lt;p&gt;Thanks Lars. Yes, I do think that it should be addressed to prevent the unexpected results &amp;#8211; took us some time to figure out this was the cause of one of our applications hanging. &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5257&quot; title=&quot;Allow INCLUDE_AND_NEXT_COL in filters and use it in ColumnPaginationFilter&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5257&quot;&gt;&lt;del&gt;HBASE-5257&lt;/del&gt;&lt;/a&gt; seems like a reasonable change to make, although it looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5104&quot; title=&quot;Provide a reliable intra-row pagination mechanism&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5104&quot;&gt;&lt;del&gt;HBASE-5104&lt;/del&gt;&lt;/a&gt; already addresses our particular scenario by introducing getMaxResultsPerColumnFamily() and getRowOffsetPerColumnFamily() methods for the Get and Scan classes. If that is the case, perhaps ColumnPaginationFilter and ColumnCountGetFilter could be deprecated?&lt;/p&gt;</comment>
                            <comment id="13707979" author="asafm" created="Sun, 14 Jul 2013 07:37:09 +0000"  >&lt;p&gt;I agree. If you set versions=3 you would expect to have no more than 3 in your filter. Maybe the column counting can be done a little bit differently to address the problem in the code comment.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12536610">HBASE-5104</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12539420">HBASE-5257</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12547834" name="ColumnPaginationFilterTest.java" size="4225" author="noslowerdna" created="Thu, 4 Oct 2012 21:52:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 4 Oct 2012 22:53:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241682</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02a6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11251</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>