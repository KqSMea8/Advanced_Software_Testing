<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:20:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4579/HBASE-4579.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4579] CST.requestCompaction semantics changed, logs are now spammed when too many store files</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4579</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Another bug I&apos;m not so sure what&apos;s going on. I see this in my log:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2011-10-12 00:23:43,435 DEBUG org.apache.hadoop.hbase.regionserver.Store: info: no store files to compact&lt;br/&gt;
2011-10-12 00:23:44,335 DEBUG org.apache.hadoop.hbase.regionserver.Store: info: no store files to compact&lt;br/&gt;
2011-10-12 00:23:45,236 DEBUG org.apache.hadoop.hbase.regionserver.Store: info: no store files to compact&lt;br/&gt;
2011-10-12 00:23:46,136 DEBUG org.apache.hadoop.hbase.regionserver.Store: info: no store files to compact&lt;br/&gt;
2011-10-12 00:23:47,036 DEBUG org.apache.hadoop.hbase.regionserver.Store: info: no store files to compact&lt;br/&gt;
2011-10-12 00:23:47,936 DEBUG org.apache.hadoop.hbase.regionserver.Store: info: no store files to compact&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It spams for a while, and a little later instead I get:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2011-10-12 00:26:52,139 DEBUG org.apache.hadoop.hbase.regionserver.Store: Skipped compaction of info.  Only 2 file(s) of size 176.4m have met compaction criteria.&lt;br/&gt;
2011-10-12 00:26:53,040 DEBUG org.apache.hadoop.hbase.regionserver.Store: Skipped compaction of info.  Only 2 file(s) of size 176.4m have met compaction criteria.&lt;br/&gt;
2011-10-12 00:26:53,940 DEBUG org.apache.hadoop.hbase.regionserver.Store: Skipped compaction of info.  Only 2 file(s) of size 176.4m have met compaction criteria.&lt;br/&gt;
2011-10-12 00:26:54,840 DEBUG org.apache.hadoop.hbase.regionserver.Store: Skipped compaction of info.  Only 2 file(s) of size 176.4m have met compaction criteria.&lt;br/&gt;
2011-10-12 00:26:55,741 DEBUG org.apache.hadoop.hbase.regionserver.Store: Skipped compaction of info.  Only 2 file(s) of size 176.4m have met compaction criteria.&lt;br/&gt;
2011-10-12 00:26:56,641 DEBUG org.apache.hadoop.hbase.regionserver.Store: Skipped compaction of info.  Only 2 file(s) of size 176.4m have met compaction criteria.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I believe I also saw something like that for flushes, but the region was closing so at least I know why it was spamming (would be nice if it just unrequested the flush):&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2011-10-12 00:26:40,693 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Flush requested on TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5.&lt;br/&gt;
2011-10-12 00:26:40,694 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: NOT flushing memstore for region TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5., flushing=false, writesEnabled=false&lt;br/&gt;
2011-10-12 00:26:40,733 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Flush requested on TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5.&lt;br/&gt;
2011-10-12 00:26:40,733 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: NOT flushing memstore for region TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5., flushing=false, writesEnabled=false&lt;br/&gt;
2011-10-12 00:26:40,873 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Flush requested on TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5.&lt;br/&gt;
2011-10-12 00:26:40,873 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: NOT flushing memstore for region TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5., flushing=false, writesEnabled=false&lt;br/&gt;
2011-10-12 00:26:40,873 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Flush requested on TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5.&lt;br/&gt;
2011-10-12 00:26:40,873 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: NOT flushing memstore for region TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5., flushing=false, writesEnabled=false&lt;br/&gt;
2011-10-12 00:26:40,921 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Flush requested on TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5.&lt;br/&gt;
2011-10-12 00:26:40,922 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: NOT flushing memstore for region TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5., flushing=false, writesEnabled=false&lt;br/&gt;
2011-10-12 00:26:40,923 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Flush requested on TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5.&lt;br/&gt;
2011-10-12 00:26:40,923 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: NOT flushing memstore for region TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5., flushing=false, writesEnabled=false&lt;br/&gt;
2011-10-12 00:26:40,923 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Flush requested on TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5.&lt;br/&gt;
2011-10-12 00:26:40,923 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: NOT flushing memstore for region TestTable,0038168581,1318378894213.2beb8a1e29382a8d3e90a88b9662e5f5., flushing=false, writesEnabled=false&lt;/p&gt;&lt;/blockquote&gt;</description>
                <environment></environment>
        <key id="12526781">HBASE-4579</key>
            <summary>CST.requestCompaction semantics changed, logs are now spammed when too many store files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Oct 2011 00:36:30 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:06 +0000</updated>
                            <resolved>Mon, 17 Oct 2011 18:22:46 +0000</resolved>
                                    <version>0.92.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13127069" author="jdcryans" created="Thu, 13 Oct 2011 22:44:10 +0000"  >&lt;p&gt;I spent some time debugging this and the debug I added really helped:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2011-10-13 22:04:16,633 DEBUG org.apache.hadoop.hbase.regionserver.CompactSplitThread: Large Compaction requested: regionName=TestTable,0028803615,1318381132063.1724203bae0dda87cddfaac9700b9dc6., storeName=info, fileCount=4, fileSize=219.6m (54.8m, 55.0m, 55.0m, 54.8m), priority=-1, time=6062002855079899; Because: regionserver62023.cacheFlusher; compaction_queue=(1:0), split_queue=0&lt;br/&gt;
2011-10-13 22:04:21,999 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Flush requested on TestTable,0028803615,1318381132063.1724203bae0dda87cddfaac9700b9dc6.&lt;br/&gt;
2011-10-13 22:04:21,999 WARN org.apache.hadoop.hbase.regionserver.MemStoreFlusher: Region TestTable,0028803615,1318381132063.1724203bae0dda87cddfaac9700b9dc6. has too many store files; delaying flush up to 90000ms&lt;br/&gt;
2011-10-13 22:04:21,999 DEBUG org.apache.hadoop.hbase.regionserver.Store: info: no store files to compact 1724203bae0dda87cddfaac9700b9dc6&lt;br/&gt;
2011-10-13 22:04:22,000 ERROR org.apache.hadoop.hbase.regionserver.Store:&lt;br/&gt;
java.lang.Exception&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.Store.compactSelection(Store.java:1007)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.Store.requestCompaction(Store.java:908)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.CompactSplitThread.requestCompaction(CompactSplitThread.java:204)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.CompactSplitThread.requestCompaction(CompactSplitThread.java:177)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MemStoreFlusher.flushRegion(MemStoreFlusher.java:360)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MemStoreFlusher.run(MemStoreFlusher.java:239)&lt;br/&gt;
...&lt;br/&gt;
2011-10-13 22:05:52,584 INFO org.apache.hadoop.hbase.regionserver.MemStoreFlusher: Waited 90585ms on a compaction to clean up &apos;too many store files&apos;; waited long enough... proceeding with flush of TestTable,0028803615,1318381132063.1724203bae0dda87cddfaac9700b9dc6.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The exception is there just to show me where the call was coming from.&lt;/p&gt;

&lt;p&gt;So what we see is that compaction is grabbing all the store files and during that time the MemStoreFlusher is trying to flush but hits the &quot;too many store files&quot; issue. It used to be that requesting a compaction was just putting something on a queue silently, but now it&apos;s actually going all the way down into Store and that&apos;s why it&apos;s now spammy.&lt;/p&gt;

&lt;p&gt;Fixes I think are required:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;For debugging purposes, show the encoded name when printing the &quot;info: no store files to compact&quot; message because it&apos;s pretty much useless if you don&apos;t know what it belongs to.&lt;/li&gt;
	&lt;li&gt;Require the compaction only once, the code already knows when it&apos;s the first time you spin so no need to ask it again and again.&lt;/li&gt;
	&lt;li&gt;Set a higher priority for the compaction&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13127117" author="jdcryans" created="Thu, 13 Oct 2011 23:24:32 +0000"  >&lt;p&gt;Does the 3 things I listed above, tested on a cluster and verified it stopped spamming.&lt;/p&gt;</comment>
                            <comment id="13127719" author="jdcryans" created="Fri, 14 Oct 2011 17:32:01 +0000"  >&lt;p&gt;Ted pointed out offline that setting the priority higher is actually putting it farther in the queue, and upon inspection of the code it seems like the blocking stuff is already taken care of.&lt;/p&gt;

&lt;p&gt;I must say, the compaction priority code isn&apos;t easy to grok.&lt;/p&gt;</comment>
                            <comment id="13128032" author="yuzhihong@gmail.com" created="Sat, 15 Oct 2011 01:45:59 +0000"  >&lt;p&gt;+1 on patch v2.&lt;/p&gt;</comment>
                            <comment id="13129061" author="jdcryans" created="Mon, 17 Oct 2011 18:22:46 +0000"  >&lt;p&gt;Committed to 0.92 and trunk, thanks for the review Ted!&lt;/p&gt;</comment>
                            <comment id="13129419" author="hudson" created="Tue, 18 Oct 2011 02:03:50 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2332 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2332/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2332/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4579&quot; title=&quot;CST.requestCompaction semantics changed, logs are now spammed when too many store files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4579&quot;&gt;&lt;del&gt;HBASE-4579&lt;/del&gt;&lt;/a&gt;  CST.requestCompaction semantics changed, logs are now&lt;br/&gt;
               spammed when too many store files&lt;br/&gt;
forgot the CHANGES&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4579&quot; title=&quot;CST.requestCompaction semantics changed, logs are now spammed when too many store files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4579&quot;&gt;&lt;del&gt;HBASE-4579&lt;/del&gt;&lt;/a&gt;  CST.requestCompaction semantics changed, logs are now&lt;br/&gt;
               spammed when too many store files&lt;/p&gt;

&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/MemStoreFlusher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15016142" author="lars_francke" created="Fri, 20 Nov 2015 11:54:06 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12499068" name="HBASE-4579-v2.patch" size="1753" author="jdcryans" created="Fri, 14 Oct 2011 17:32:01 +0000"/>
                            <attachment id="12498957" name="HBASE-4579.patch" size="2503" author="jdcryans" created="Thu, 13 Oct 2011 23:24:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 15 Oct 2011 01:45:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72543</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hrf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101704</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>MemStoreFlusher will now request only 1 compaction when waiting because there are too many store files, instead of one per check</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>