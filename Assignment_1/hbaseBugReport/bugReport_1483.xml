<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:53:52 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1483/HBASE-1483.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1483] HLog split loses track of edits</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1483</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;HLog:803&lt;br/&gt;
                  queue.push(new HLogEntry(val, key));&lt;/p&gt;

&lt;p&gt;The same val and key references are used in the iterator, so they keep changing their contents as we .next() through the loop.&lt;/p&gt;

&lt;p&gt;Thus, when we are done, all the HLogEntries in logEntries will have the same HLogEdits and HLogKeys! I don&apos;t think this would have ever worked unless there is only one region in the log being split.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12427153">HBASE-1483</key>
            <summary>HLog split loses track of edits</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="clint.morgan">Clint Morgan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Jun 2009 21:44:52 +0000</created>
                <updated>Fri, 21 Jan 2011 05:38:37 +0000</updated>
                            <resolved>Thu, 4 Jun 2009 22:47:35 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12716442" author="stack" created="Thu, 4 Jun 2009 22:47:35 +0000"  >&lt;p&gt;Committed below to trunk and branch... its a little different to what Clint posted.. please check it.&lt;/p&gt;

&lt;p&gt;Thanks for finding this Clint.  Please don&apos;t tell anyone that we had such a dumb bug.  For sure they&apos;ll think us all losers.&lt;/p&gt;

&lt;p&gt;Good stuff.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/java/org/apache/hadoop/hbase/regionserver/HLog.java
===================================================================
--- src/java/org/apache/hadoop/hbase/regionserver/HLog.java     (revision 780848)
+++ src/java/org/apache/hadoop/hbase/regionserver/HLog.java     (working copy)
@@ -795,13 +795,15 @@
           &lt;span class=&quot;code-comment&quot;&gt;// reports a zero length even &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the file has been sync&apos;d. Revisit &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;
&lt;/span&gt;           &lt;span class=&quot;code-comment&quot;&gt;// HADOOP-4751 is committed.
&lt;/span&gt;           &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; length = logfiles[i].getLen();
-          HLogKey key = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HLogKey();
-          KeyValue val = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KeyValue();
           SequenceFile.Reader in = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
               &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; count = 0;
           &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
             in = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SequenceFile.Reader(fs, logfiles[i].getPath(), conf);
             &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+              &lt;span class=&quot;code-comment&quot;&gt;// Make the key and value &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; each time; otherwise same instance
&lt;/span&gt;+              &lt;span class=&quot;code-comment&quot;&gt;// is used over and over.
&lt;/span&gt;+              HLogKey key = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HLogKey();
+              KeyValue val = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KeyValue();
               &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (in.next(key, val)) {
                 &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] regionName = key.getRegionName();
                 LinkedList&amp;lt;HLogEntry&amp;gt; queue = logEntries.get(regionName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12716446" author="clint.morgan" created="Thu, 4 Jun 2009 22:56:02 +0000"  >&lt;p&gt;Just tried to update 0.19 branch and don&apos;t see this change.&lt;/p&gt;

&lt;p&gt;But I don&apos;t think that above patch fixes it. We need to to a new for each iteration of the while(in.next(key,val)) loop...&lt;/p&gt;</comment>
                            <comment id="12716450" author="stack" created="Thu, 4 Jun 2009 23:05:29 +0000"  >&lt;p&gt;You are right.  Just did new commit.  Currently working on the TestHLog to add confirmation that splits have right edits.  Thanks Clint.&lt;/p&gt;</comment>
                            <comment id="12716469" author="stack" created="Fri, 5 Jun 2009 00:50:14 +0000"  >&lt;p&gt;I think there&apos;s another issue in here Clint.  Edits are coming out of the split file in reverse order... the newest first (It looks like its the LinkedList that is issue)... checking.&lt;/p&gt;</comment>
                            <comment id="12716490" author="stack" created="Fri, 5 Jun 2009 03:47:46 +0000"  >&lt;p&gt;I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1484&quot; title=&quot;commit log split writes files with newest edits first (since hbase-1430); should be other way round&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1484&quot;&gt;&lt;del&gt;HBASE-1484&lt;/del&gt;&lt;/a&gt; to fix order of edits in split files; they are newest to oldest when should be reverse.&lt;/p&gt;

&lt;p&gt;Here is what I committed to fix my original bad commit:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
URL: http:&lt;span class=&quot;code-comment&quot;&gt;//svn.apache.org/viewvc/hadoop/hbase/branches/0.19/src/java/org/apache/hadoop/hbase/regionserver/HLog.java?rev=781868&amp;amp;r1=781867&amp;amp;r2=781868&amp;amp;view=diff
&lt;/span&gt;==============================================================================
--- hadoop/hbase/branches/0.19/src/java/org/apache/hadoop/hbase/regionserver/HLog.java (original)
+++ hadoop/hbase/branches/0.19/src/java/org/apache/hadoop/hbase/regionserver/HLog.java Thu Jun  4 23:04:28 2009
@@ -785,13 +785,13 @@
            &lt;span class=&quot;code-comment&quot;&gt;// reports a zero length even &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the file has been sync&apos;d. Revisit &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// HADOOP-4751 is committed.
&lt;/span&gt;            &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; length = logfiles[i].getLen();
-            HLogKey key = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HLogKey();
-            HLogEdit val = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HLogEdit();
            SequenceFile.Reader in = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
              in = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SequenceFile.Reader(fs, logfiles[i].getPath(), conf);
              &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; count = 0;
+                HLogKey key = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HLogKey();
+                HLogEdit val = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HLogEdit();
                &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (in.next(key, val)) {
                  &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] regionName = key.getRegionName();
                  LinkedList&amp;lt;HLogEntry&amp;gt; queue = logEntries.get(regionName);
@@ -802,6 +802,10 @@
                  }
                  queue.push(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HLogEntry(val, key));
                  count++;
+                  &lt;span class=&quot;code-comment&quot;&gt;// Make the key and value &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; each time; otherwise same instance
&lt;/span&gt;+                  &lt;span class=&quot;code-comment&quot;&gt;// is used over and over.
&lt;/span&gt;+                  key = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HLogKey();
+                  val = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HLogEdit();
                }
                LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Pushed &quot;&lt;/span&gt; + count + &lt;span class=&quot;code-quote&quot;&gt;&quot; entries from &quot;&lt;/span&gt; +
                    logfiles[i].getPath());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12409909" name="1483.patch" size="1022" author="clint.morgan" created="Thu, 4 Jun 2009 21:58:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 4 Jun 2009 22:47:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25779</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 29 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hdin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99452</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>