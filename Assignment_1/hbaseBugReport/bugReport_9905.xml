<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:08:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9905/HBASE-9905.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9905] Enable using seqId as timestamp </title>
                <link>https://issues.apache.org/jira/browse/HBASE-9905</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This has been discussed previously, and Lars H. was mentioning an idea from the client to declare whether timestamps are used or not explicitly. &lt;/p&gt;

&lt;p&gt;The problem is that, for data models not using timestamps, we are still relying on clocks to order the updates. Clock skew, same milisecond puts after deletes, etc can cause unexpected behavior and data not being visible.  &lt;/p&gt;

&lt;p&gt;We should have a table descriptor / family property, which would declare that the data model does not use timestamps. Then we can populate this dimension with the seqId, so that global ordering of edits are not effected by wall clock. &lt;/p&gt;

&lt;p&gt;For example, META will use this. &lt;/p&gt;

&lt;p&gt;Once we have something like this, we can think of making it default for new tables, so that the unknowing user will not shoot herself in the foot. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12677877">HBASE-9905</key>
            <summary>Enable using seqId as timestamp </summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="octo47">Andrey Stepachev</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Nov 2013 22:13:19 +0000</created>
                <updated>Tue, 14 Jul 2015 18:39:06 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>22</watches>
                                                                <comments>
                            <comment id="13815414" author="enis" created="Wed, 6 Nov 2013 22:56:18 +0000"  >&lt;p&gt;Some offline discussion with Sergey, we probably need a couple of &quot;modes&quot; per table for &quot;timestamp mode&quot; : &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;mode_seqid           : The server supplies seqId to the cells. If ts is set for puts, the server will throw IllegelArgumentException.&lt;/li&gt;
	&lt;li&gt;mode_server_ts     : The server supplies ts to the cells from the wall clock. If ts is set for puts, the server will throw IllegelArgumentException.&lt;/li&gt;
	&lt;li&gt;mode_client_ts       : The client always supplies the timestamps (from clock or from ts oracle). The server throws exception if the cell does not have timestamp&lt;/li&gt;
	&lt;li&gt;mode_mixed          : Will operate similarly to current semantics. Will be deprecated.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;mode_server_ts is a special case for mode_mixed, and may not be needed. &lt;/p&gt;</comment>
                            <comment id="13815783" author="nkeywal" created="Thu, 7 Nov 2013 09:04:37 +0000"  >&lt;p&gt;When doing queries with a timestamps, you may/will want the timestamps to be &apos;consistent&apos; between the different tables across the machines.&lt;/p&gt;</comment>
                            <comment id="13815951" author="jmspaggi" created="Thu, 7 Nov 2013 13:29:10 +0000"  >&lt;p&gt;Is that almost the same thing as what we are discussing here: &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9879&quot; title=&quot;Can&amp;#39;t undelete a KeyValue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9879&quot;&gt;HBASE-9879&lt;/a&gt; ?&lt;/p&gt;

&lt;p&gt;Also, I disagree with deprecating the current mode_mixed. Someone might want to let HBase decide on the timestamp but might want to be able to take action on a specific cell in the table based on it&apos;s timestamp for later updates.&lt;/p&gt;</comment>
                            <comment id="13816464" author="sershe" created="Thu, 7 Nov 2013 21:45:51 +0000"  >&lt;p&gt;My 2c. I think relying on clock for any notion of consistency and versioning is an extremely bad idea, unless you are Spanner &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. We already have loads of potential timing issues in HBase with the ts that we are using. System clock can move backwards, and skew between servers when region is moved/fails over can be significant, leading to all kinds of weird behavior.&lt;br/&gt;
So I agree with Enis we should deprecate it. I don&apos;t think we need so many modes though.&lt;/p&gt;

&lt;p&gt;There are 3 ts sources - system-always, user-always, mixed. &lt;br/&gt;
For system-always (rejecting client timestamps), I am +1 on seqNum-mode, as discussed in the meetup, and above. Maybe make it default for new tables in 98-1.0? And migrate meta to it, probably out of bounds with upgrade via a script, so it would be optional. &lt;br/&gt;
For the others, I think /server/ should &lt;b&gt;never&lt;/b&gt; use clock for ts. Never-ever. For user-always, it&apos;s not a problem by definition; for mixed mode, we /could use/ seqNum-as-ts (client can make derived ts-es that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; mentions based on seqNum-ts, just as well as based on clock-ts; if client wants to store time as data (not version), a column is a proper place for it), but unfortunately due to backward compat it is not viable to make a complete switch.&lt;br/&gt;
So what we should do imho is have client library, instead of server, generate TS if user doesn&apos;t supply one (there&apos;d have to be some relatively easy backward compat). That way, the semantics are the same, but if the user screws up clocks, it&apos;s no longer an HBase consistency problem - if you want bulletproof clock-based versions (ts-es), manage your own, or manage your clock sync. For user-always vs mixed in this case, there&apos;s no need for special flag, from server point of view they look the same.&lt;/p&gt;

&lt;p&gt;Optionally we might want to create mixed mode with seqNums; or a special mode that would enforce user-always and reject requests without ts, but I don&apos;t think this is strictly necessary.&lt;/p&gt;

&lt;p&gt;If this is contentious I am +1 on just adding seqNum mode and not doing anything else also &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13834269" author="apurtell" created="Wed, 27 Nov 2013 22:47:49 +0000"  >&lt;p&gt;No patch, moving out of 0.98. Put back if you feel otherwise.&lt;/p&gt;</comment>
                            <comment id="13966766" author="billie.rinaldi" created="Fri, 11 Apr 2014 16:54:15 +0000"  >&lt;p&gt;Accumulo has two timestamp types, logical and milliseconds.  Logical time uses a one-up counter to set the timestamps.  Milliseconds time uses the server time, but it also ensures that it assigns monotonically non-decreasing timestamps within each tablet.  The last timestamp for the tablet is stored in the tablet&apos;s metadata, and the tserver assigns new timestamps as the maximum of servertime and lasttime+1 (or sometimes lasttime).  See &lt;a href=&quot;https://git-wip-us.apache.org/repos/asf?p=accumulo.git;a=blob;f=server/base/src/main/java/org/apache/accumulo/server/tablets/TabletTime.java;hb=HEAD&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;TabletTime&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13969140" author="enis" created="Tue, 15 Apr 2014 02:06:36 +0000"  >&lt;p&gt;Thanks Billie. This issue proposes a similar thing. Our seqId is a monotonically increasing number, and all edits in WAL are ordered by this, so if a table is predeclared to use this, the correctness in terms of ordering is guaranteed, plus a lot of optimizations are possible on the read side (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10247&quot; title=&quot;Client promises about timestamps&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10247&quot;&gt;&lt;del&gt;HBASE-10247&lt;/del&gt;&lt;/a&gt;) &lt;/p&gt;</comment>
                            <comment id="14000522" author="lhofhansl" created="Fri, 16 May 2014 23:55:45 +0000"  >&lt;p&gt;What about features like TTL that based on wall clock time? Are we going to unsupport them (unless the client sets the TSs)?&lt;/p&gt;</comment>
                            <comment id="14000586" author="enis" created="Sat, 17 May 2014 01:16:41 +0000"  >&lt;p&gt;We can say TTL requires wall clock based timestamps. seqId ts and TTL can be mutually exclusive. max versions should work though. Or maybe we can have a more coarse grained TTL where for every hfile from flush we keep the timestamp, and delete hfiles in compaction once expired. &lt;/p&gt;</comment>
                            <comment id="14004155" author="apurtell" created="Wed, 21 May 2014 00:30:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;What about features like TTL that based on wall clock time? Are we going to unsupport them (unless the client sets the TSs)?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think auto expiration and background garbage collection of data is still a valid use case for HBase. We would need an option that selects timestamps set by server time. If this option is active we&apos;d filter expired cells based on timestamp and TTL settings as today. If the user has chosen some other type of timestamp scheme, it&apos;s ok for TTL settings to be ignored or disallowed. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Or maybe we can have a more coarse grained TTL where for every hfile from flush we keep the timestamp, and delete hfiles in compaction once expired.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The trouble with this is it could be too coarse grained. If not taking writes and with major compaction disabled a region could carry those &apos;expired&apos; HFiles for a long time.&lt;/p&gt;</comment>
                            <comment id="14314162" author="octo47" created="Tue, 10 Feb 2015 13:23:19 +0000"  >&lt;p&gt;We can allow user to specify which seqId to use for TTL operations and advance this marker.&lt;br/&gt;
Marker can be stored in meta or file descriptor. With &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12035&quot; title=&quot;Keep table state in META&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12035&quot;&gt;&lt;del&gt;HBASE-12035&lt;/del&gt;&lt;/a&gt; it is possible to store it in &lt;br/&gt;
meta column family &apos;table&apos; introduced. That allows to use CAS operations for example.&lt;/p&gt;

&lt;p&gt;If we look more general we can introduce table attribute (stored in meta) named TTL override which can&lt;br/&gt;
be applied to all types of tables (or column families independently if that will not complicate code a lot). &lt;br/&gt;
This attribute allows user to override ttl value to which cells compared, if this attribute is present timestamp &lt;br/&gt;
will be checked against this value and cells with less and equal will be removed.&lt;br/&gt;
That can be useful even for regular tables, when user wants to fix ttl for some time. &lt;br/&gt;
Sure, for user specified seqId usage of this field would be mandatory and default value will be Long.MIN.&lt;/p&gt;</comment>
                            <comment id="14343315" author="octo47" created="Mon, 2 Mar 2015 16:10:27 +0000"  >&lt;p&gt;Thought about that idea and compiled document attached. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;, can you take a look on that, &lt;br/&gt;
does it sound alive.&lt;/p&gt;

&lt;p&gt;thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12844853">HBASE-14070</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12653582">HBASE-8763</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12653776">HBASE-8770</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12686507">HBASE-10247</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12701891" name="HBaseTimespaceGeneratorProposal.pdf" size="99576" author="octo47" created="Mon, 2 Mar 2015 16:10:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 7 Nov 2013 09:04:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357252</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 41 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pl53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>357542</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>