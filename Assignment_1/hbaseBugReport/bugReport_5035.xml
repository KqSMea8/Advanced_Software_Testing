<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:24:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5035/HBASE-5035.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5035] Runtime exceptions during meta scan</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5035</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Version: 0.90.3 + patches back ported &lt;/p&gt;

&lt;p&gt;The other day our client started spitting these two runtime exceptions. Not all clients connected to the cluster were under impact. Only 4 of them. While 3 of them were throwing NPE, one of them was throwing ArrayIndexOutOfBoundsException. The errors are : &lt;/p&gt;

&lt;p&gt;1. &lt;a href=&quot;http://pastie.org/2987926&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pastie.org/2987926&lt;/a&gt;&lt;br/&gt;
2. &lt;a href=&quot;http://pastie.org/2987927&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pastie.org/2987927&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Clients did not recover from this and I had to restart them. &lt;/p&gt;

&lt;p&gt;Motive of this jira is to identify and put null checks at appropriate places. Also with the given stack trace I can not tell which line caused NPE of AIOBE, hence additional motive is to make the trace more helpful. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12535248">HBASE-5035</key>
            <summary>Runtime exceptions during meta scan</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="4">Incomplete</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="shrijeet">Shrijeet Paliwal</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Dec 2011 03:25:33 +0000</created>
                <updated>Sat, 11 Apr 2015 01:01:50 +0000</updated>
                            <resolved>Sat, 11 Apr 2015 01:01:50 +0000</resolved>
                                    <version>0.90.3</version>
                                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                            <comments>
                            <comment id="13169955" author="shrijeet" created="Thu, 15 Dec 2011 03:28:56 +0000"  >&lt;p&gt;Here is the patched HCM &lt;a href=&quot;https://gist.github.com/1478070&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://gist.github.com/1478070&lt;/a&gt; , can be used to match line numbers.  &lt;/p&gt;</comment>
                            <comment id="13173697" author="shrijeet" created="Wed, 21 Dec 2011 00:50:45 +0000"  >&lt;p&gt;Ted, you had mentioned following in the email thread: &lt;/p&gt;

&lt;p&gt;&quot;Null check for regionInfo should be added&quot; &lt;/p&gt;

&lt;p&gt;I could not gather why regionInfo could possibly be null. The call &apos;Writables.getHRegionInfo(value);&apos; does not seem to return null ever. Could you please tell me your reasoning. &lt;/p&gt;

&lt;p&gt;Meanwhile I am still reading code and trying to find the place where NPE might occur.  &lt;/p&gt;</comment>
                            <comment id="13173716" author="zhihyu@ebaysf.com" created="Wed, 21 Dec 2011 01:09:50 +0000"  >&lt;p&gt;I checked the code again and think regionInfo is unlikely to be null.&lt;br/&gt;
Remaining possibilities are regionInfo.getTableDesc() and somewhere in the HSA ctor:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; HServerAddress(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; hostAndPort) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Making the trace more helpful should be the first action.&lt;/p&gt;</comment>
                            <comment id="13173780" author="shrijeet" created="Wed, 21 Dec 2011 02:16:31 +0000"  >&lt;p&gt;Amm you might be right. &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;final String serverAddress = Bytes.toString(value);

// instantiate the location
HRegionLocation loc = new HRegionLocation(regionInfo,
                new HServerAddress(serverAddress));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The Bytes.toString call, in theory, may return both an empty string or a null string.&lt;br/&gt;
In the case when it returns a null (see below), it tries to log an error which I didn&apos;t see in my log file. &lt;br/&gt;
So I am not still 100% sure this is out guy. &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; try {
      return new String(b, off, len, HConstants.UTF8_ENCODING);
    } catch (UnsupportedEncodingException e) {
      LOG.error(&quot;UTF-8 not supported?&quot;, e);
      return null;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nonetheless it will be good to put a check against serverAddress variable for emptiness as well nullness since HServerAddress construtor may throw runtime error otherwise. Interesting point is - it can throw both ArrayIndexOutOfBoundsException and NPE and I saw both cases.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;/**
   * @param hostAndPort Hostname and port formatted as &amp;lt;code&amp;gt;&amp;amp;lt;hostname&amp;gt; &apos;:&apos; &amp;amp;lt;port&amp;gt;&amp;lt;/code&amp;gt;
   */
  public HServerAddress(String hostAndPort) {
    int colonIndex = hostAndPort.lastIndexOf(&apos;:&apos;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;I will open a subtask to make the trace more helpful. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12535951">HBASE-5080</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 Dec 2011 01:09:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220932</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02bgf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11457</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>