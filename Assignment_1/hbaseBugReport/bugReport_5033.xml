<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:24:08 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5033/HBASE-5033.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5033] Opening/Closing store in parallel to reduce region open/close time</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5033</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Region servers are opening/closing each store and each store file for every store in sequential fashion, which may cause inefficiency to open/close regions. &lt;/p&gt;

&lt;p&gt;So this diff is to open/close each store in parallel in order to reduce region open/close time. Also it would help to reduce the cluster restart time.&lt;/p&gt;

&lt;p&gt;1) Opening each store in parallel&lt;br/&gt;
2) Loading each store file for every store in parallel&lt;br/&gt;
3) Closing each store in parallel&lt;br/&gt;
4) Closing each store file for every store in parallel.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12535224">HBASE-5033</key>
            <summary>Opening/Closing store in parallel to reduce region open/close time</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liyin">Liyin Tang</assignee>
                                    <reporter username="liyin">Liyin Tang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Dec 2011 23:38:08 +0000</created>
                <updated>Fri, 12 Oct 2012 05:34:56 +0000</updated>
                            <resolved>Fri, 13 Jan 2012 23:32:14 +0000</resolved>
                                                    <fixVersion>0.94.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13172715" author="phabricator@reviews.facebook.net" created="Mon, 19 Dec 2011 23:03:30 +0000"  >&lt;p&gt;Liyin requested code review of &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;br/&gt;
Reviewers: Kannan, mbautin, Karthik, JIRA&lt;/p&gt;

&lt;p&gt;  Region servers are opening/closing each store and each store file for every store in sequential fashion, which may cause inefficiency to open/close regions.&lt;/p&gt;

&lt;p&gt;  So this diff is to open/close each store in parallel in order to reduce region open/close time. Also it would help to reduce the cluster restart time.&lt;/p&gt;

&lt;p&gt;  1) Opening each store in parallel&lt;br/&gt;
  2) Loading each store file for every store in parallel&lt;br/&gt;
  3) Closing each store in parallel&lt;br/&gt;
  4) Closing each store file for every store in parallel.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  1) Running all the unit tests&lt;br/&gt;
  2) Test it on dev cluster to see how much time saved by close/open region in parallel when restart the cluster.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/Threads.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/1941/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/1941/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tip: use the X-Herald-Rules header to filter Herald messages in your client.&lt;/p&gt;</comment>
                            <comment id="13172731" author="phabricator@reviews.facebook.net" created="Mon, 19 Dec 2011 23:23:30 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  Nice work.&lt;/p&gt;

&lt;p&gt;  I don&apos;t see shutdown() being called on the newly added ThreadPoolExecutor&apos;s&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:474 Should read &apos;closing stores in parallel&apos;&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13172741" author="phabricator@reviews.facebook.net" created="Mon, 19 Dec 2011 23:43:30 +0000"  >&lt;p&gt;stack has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  I love it.&lt;/p&gt;

&lt;p&gt;  So, if exception during open/close, when we do Future.get, the exception comes out of the ExecutionException?&lt;/p&gt;

&lt;p&gt;  Good stuff.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13172770" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 00:17:30 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  @stack, yes, as you said, tasks described by Callable can throw checked and unchecked exceptions, and any code can throw an Error. Whatever the task code may throw, it is wrapped in an ExecutionException and rethrown from Future.get.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13172790" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 00:37:30 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  A couple of comments inline. Nice work!&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:570 Remove e.getCause().&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:818 Remove e.getCause().&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:482 The thread name should probably include region name.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:823 Shut down the thread pool here just in case.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13172990" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 06:55:30 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;br/&gt;
Reviewers: Kannan, mbautin, Karthik, JIRA&lt;/p&gt;

&lt;p&gt;  Address Mikhail&apos;s comments.&lt;br/&gt;
  1) When any exceptions caught during the store/store file open or close time, it would be safer to shut down the thread pool.&lt;br/&gt;
  If not shut down the thread pool for opening, then block cache may have the data related to the failed opened region.&lt;/p&gt;

&lt;p&gt;  If not shut down the thread pool for closing, then the region server may concurrently close the same store since the closeRegion operation could be retried in the region server.&lt;/p&gt;

&lt;p&gt;  2) Use different thread pool for store/store file opening and closing time. So we can shut down the thread pool separately and no need to worried about the dependency between open and close.&lt;/p&gt;



&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/Threads.java&lt;/p&gt;</comment>
                            <comment id="13173371" author="lhofhansl" created="Tue, 20 Dec 2011 18:19:13 +0000"  >&lt;p&gt;As a general comment obviously this will only improve latency for a single request and possibly be detrimental to the aggregate throughput of a regionserver (because of higher CPU/IO contention). It may also cause problems with fairness, where a few requests can hog a regionserver.&lt;br/&gt;
So as part of this we need to carefully verify that aggregate throughput is not impacted, and I think the amount of parallelisms needs to be configurable (I have not looked in detail at the patch, so the configuration might already be there).&lt;/p&gt;</comment>
                            <comment id="13173391" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 18:36:30 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;br/&gt;
Reviewers: Kannan, mbautin, Karthik, JIRA&lt;/p&gt;

&lt;p&gt;  Refactor the code&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/Threads.java&lt;/p&gt;</comment>
                            <comment id="13173428" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 19:02:30 +0000"  >&lt;p&gt;lhofhansl has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:536 Should these be daemon threads?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:814 Same here: daemon threads?&lt;br/&gt;
  Does this have to be a separate pool from the opener pool? (I guess yes, but just want to make sure)&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:294 This is a bit confusing to me. We already have a thread pool to open the stores, now we have another pool to open storefiles in each store.&lt;br/&gt;
  So in the worst case with the default pool size of 10 we could open 10*10 store files in parallel?&lt;br/&gt;
  Should there be different config options for the number of stores (i.e. CFs) in parallel and the number of store files per store to be opened in parallel?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13173457" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 19:32:30 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:294 As you suggested, it has already used 2 separate parameters to control the number of stores and store files,  which will be opened or closed in parallel.&lt;/p&gt;

&lt;p&gt;  For example:&lt;br/&gt;
  hbase.hregion.storeCloser.threads.max is to control the number of parallel closing stores.&lt;br/&gt;
  While hbase.hregion.storeFileCloser.threads.max is to control the number of parallel closing store files.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:814 It would be easy to control the life cycle of thread pool and decouple the dependency of open and close operation if using separate thread pool. There are some details explanation in the previous comments &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:536 I am not quite sure whether we need to set these threads as daemons since the thread pool will be shutdown in the &quot;finally&quot; block anyway.&lt;br/&gt;
  The main thread shall never leave any tasks running in these thread pools after the finally block.&lt;/p&gt;

&lt;p&gt;  Is there any specific reason ?&lt;br/&gt;
  or it will always be safe to set these threads as daemons ?&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13173460" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 19:46:30 +0000"  >&lt;p&gt;lhofhansl has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  Looks good then. Thanks for the explanation.&lt;br/&gt;
  Also please see my comment on the jira (this is only helping with request latency and might possibly be detrimental to aggregate throughput).&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:294 Oops... Didn&apos;t see ...storeOpener vs ...storeFileOpener.&lt;br/&gt;
  I think traditionally we&apos;d name them store.opener... and storefile.opener...&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:814 Since the threadpool is shutdown in a finally clause it is probably ok.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13173502" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 20:59:30 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  Thanks Lars for the reviewing &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
  I just read your comments in the jira and sorry to miss it at first.&lt;/p&gt;

&lt;p&gt;  I totally agree with you that we should be very careful about over-parallel and overwhelm the region server and name node too much. So these configuration parameter really matters.&lt;/p&gt;

&lt;p&gt;  Also considering we are still processing each message about region open and region close at one time, we may not get a throughput win too much by parallelizing the store/store file open and close process.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13173746" author="phabricator@reviews.facebook.net" created="Wed, 21 Dec 2011 01:31:30 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  Just discussed with Kannan offline, he found out that it wouldn&apos;t achieve the maximum parallelization across the regions from different tables, considering each table may has different number of stores.&lt;/p&gt;

&lt;p&gt;  One proposal is to just bound the total number of threads for this parallelization process for each region.&lt;br/&gt;
  And the following formula stands:&lt;br/&gt;
  the max number of threads for opening stores * the max number of threads for opening stores files = the total number of threads we have configured.&lt;/p&gt;

&lt;p&gt;  So If one region has less stores, this region will have more threads to run to open/close the store files in parallel and vice versa.&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13173888" author="phabricator@reviews.facebook.net" created="Wed, 21 Dec 2011 06:09:30 +0000"  >&lt;p&gt;lhofhansl has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  The last proposal make more sense. The number of threads for opening store files &quot;within&quot; a number of stores opened in parallel would be hard to grok in a real cluster.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13174342" author="phabricator@reviews.facebook.net" created="Wed, 21 Dec 2011 19:33:30 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;br/&gt;
Reviewers: Kannan, mbautin, Karthik, JIRA&lt;/p&gt;

&lt;p&gt;  Implement the proposal described in the previous comments.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/Threads.java&lt;/p&gt;</comment>
                            <comment id="13174456" author="phabricator@reviews.facebook.net" created="Wed, 21 Dec 2011 22:11:30 +0000"  >&lt;p&gt;lhofhansl has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  I guess I had envisioned that we&apos;d somehow share the same threadpool, but this works. LGTM.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HConstants.java:193 I think we don&apos;t use camel case in these properties.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13174460" author="phabricator@reviews.facebook.net" created="Wed, 21 Dec 2011 22:21:30 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:807 What&apos;s the likelihood that store opening and closing activities happen at the same time ?&lt;br/&gt;
  I suggest reusing storeOpenerThreadPool here.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13174489" author="phabricator@reviews.facebook.net" created="Wed, 21 Dec 2011 23:27:30 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:807 The region server will retry to close the store if the previous close operation failed.  So a local thread pool makes more sense here.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HConstants.java:193 I will update to &quot;hbase.hstore.open.close.threads.max&quot;&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13174541" author="phabricator@reviews.facebook.net" created="Thu, 22 Dec 2011 01:01:31 +0000"  >&lt;p&gt;Kannan has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  Liyin-- This looks very good. Some minor comments inlined.&lt;/p&gt;

&lt;p&gt;  Also: Initially, I was not sure if this parallelization is worth doing for close. But as you pointed out-- with EvictOnClose turned on, this parallelization might be useful for close scenario too.&lt;/p&gt;

&lt;p&gt;  On a separate note, with EvictOnClose, it seems like there are two cases related to closing a region.&lt;/p&gt;

&lt;p&gt;  a) cluster shutdown related region closes&lt;br/&gt;
  b) load balancing related region closes.&lt;/p&gt;

&lt;p&gt;  For the cluster shutdown case, even if EvictOnClose is true, I think we should by-pass the evictions to avoid the cost of cleaning up the blocks individually from the block cache since the server is shutting down anyway. For the load balancing case or normal compaction related file deletion case, it makes sense to keep do the evictions on close. I don&apos;t think the code currently distinguishes the two cases... (but I haven&apos;t looked carefully to double check).&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:529-541 might be good to make this block a helper function. This block of code is repeated 4 times with minor differences in params...&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:528 since 30 is repeated a few times, would be better to make a &quot;const&quot; for this too. And I would set the default much lower... to say 8 or something. Not sure how many disks is typical.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:294 Openner -&amp;gt; Opener&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:527 plural form here (maxStoreOpenerThread -&amp;gt; maxStoreOpenerThreads) and similarly in the other places.&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13174651" author="phabricator@reviews.facebook.net" created="Thu, 22 Dec 2011 06:39:30 +0000"  >&lt;p&gt;Liyin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;br/&gt;
Reviewers: Kannan, mbautin, Karthik, JIRA&lt;/p&gt;

&lt;p&gt;  Address @kannan &apos;s comments.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/Threads.java&lt;/p&gt;</comment>
                            <comment id="13174984" author="phabricator@reviews.facebook.net" created="Thu, 22 Dec 2011 19:25:30 +0000"  >&lt;p&gt;Kannan has accepted the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  Nice work! One pending comment from previous iteration inlined regarding the default.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HConstants.java:202 previous comment: &amp;lt;&amp;lt;&amp;lt; And I would set the default much lower... to say 8 or something. Not sure how many disks is typical.&amp;gt;&amp;gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13174998" author="phabricator@reviews.facebook.net" created="Thu, 22 Dec 2011 19:37:30 +0000"  >&lt;p&gt;Liyin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  Thanks Kannan for reviewing it.&lt;br/&gt;
  1) I will change the default number to a lower number, 8.&lt;br/&gt;
  2) Create another jira about avoiding the evictOnClose if the region server is going to stop.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13175130" author="phabricator@reviews.facebook.net" created="Thu, 22 Dec 2011 22:59:30 +0000"  >&lt;p&gt;Kannan has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt;[&lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt;]Opening/Closing store in parallel to reduce region open/close time&quot;.&lt;/p&gt;

&lt;p&gt;  Liyin - sounds good.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D933&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D933&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13176866" author="liyin" created="Wed, 28 Dec 2011 22:52:50 +0000"  >&lt;p&gt;The patch is based on the apache trunk. &lt;br/&gt;
This patch has passed all the unit tests except for TestCoprocessorEndpoint, which is failed with or without this change.&lt;/p&gt;</comment>
                            <comment id="13176869" author="hadoopqa" created="Wed, 28 Dec 2011 22:55:51 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12508798/HBASE-5033-apach-trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12508798/HBASE-5033-apach-trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/616//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/616//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13181134" author="liyin" created="Fri, 6 Jan 2012 05:44:40 +0000"  >&lt;p&gt;ping committers !&lt;/p&gt;</comment>
                            <comment id="13181158" author="lhofhansl" created="Fri, 6 Jan 2012 06:29:53 +0000"  >&lt;p&gt;It looks like you need to rebase the patch to latest trunk.&lt;br/&gt;
Also do you have any performance numbers as well as some guidelines about to size these threads pools?&lt;br/&gt;
We&apos;ll get the exact current behavior by setting the number of threads to 1, correct? Should that be the default instead, and folks would need to explicitly enable this? (or are you confident that we won&apos;t see any degradation in overall throughput and fairness?)&lt;/p&gt;

&lt;p&gt;I love this feature... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13181857" author="zhihyu@ebaysf.com" created="Sat, 7 Jan 2012 04:38:48 +0000"  >&lt;p&gt;Liyin&apos;s patch, usable by Hadoop QA.&lt;/p&gt;

&lt;p&gt;Please use &apos;--no-prefix&apos; to generate patch in the future.&lt;/p&gt;</comment>
                            <comment id="13181867" author="hadoopqa" created="Sat, 7 Jan 2012 05:16:09 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12509766/5033.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12509766/5033.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 80 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/694//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/694//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/694//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/694//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/694//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/694//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13183442" author="zhihyu@ebaysf.com" created="Tue, 10 Jan 2012 18:25:13 +0000"  >&lt;p&gt;@Liyin:&lt;br/&gt;
Do you happen to have some performance data when this feature is used ?&lt;/p&gt;</comment>
                            <comment id="13184567" author="liyin" created="Thu, 12 Jan 2012 00:04:52 +0000"  >&lt;p&gt;1) Based on the recent trunk and generate the patch --no-prefix&lt;br/&gt;
2) The default number of thread is set to 1.&lt;br/&gt;
3) Performance evaluation: the performance will be vary for different cluster environment such as the number of regions and the number of store files for each region.&lt;/p&gt;

&lt;p&gt;The simple restart test shows the single region server (22 regions) restart time decreased from 78 sec to 55 sec &lt;br/&gt;
So this will roughly save about 29% region server restart time. Also the cluster (100 nodes) restart time decreased from 316 secs to 189 secs, which has saved around 40% restart time.&lt;/p&gt;
</comment>
                            <comment id="13184584" author="zhihyu@ebaysf.com" created="Thu, 12 Jan 2012 00:22:49 +0000"  >&lt;p&gt;Resolved a conflict in HRegion.java&lt;/p&gt;

&lt;p&gt;In the future, please use --no-prefix to generate patch so that Hadoop QA can test it.&lt;/p&gt;</comment>
                            <comment id="13184603" author="liyin" created="Thu, 12 Jan 2012 00:45:58 +0000"  >&lt;p&gt;Thanks Ted. BTW, I do use --no-prefix for this recently submitted patch. &lt;/p&gt;</comment>
                            <comment id="13184608" author="zhihyu@ebaysf.com" created="Thu, 12 Jan 2012 00:48:38 +0000"  >&lt;p&gt;I doubt:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/src/main/java/org/apache/hadoop/hbase/HConstants.java b/src/main/java/org/apache/hadoop/hbase/HConstants.java
index 5120a3c..fcb024b 100644
--- a/src/main/java/org/apache/hadoop/hbase/HConstants.java
+++ b/src/main/java/org/apache/hadoop/hbase/HConstants.java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13184611" author="liyin" created="Thu, 12 Jan 2012 00:51:20 +0000"  >&lt;p&gt;Resubmit the patch. Thanks Ted for correction.&lt;/p&gt;</comment>
                            <comment id="13184625" author="hadoopqa" created="Thu, 12 Jan 2012 01:04:30 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12510282/5033-trunk.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12510282/5033-trunk.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -147 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 80 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/738//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/738//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/738//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/738//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/738//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/738//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13184631" author="zhihyu@ebaysf.com" created="Thu, 12 Jan 2012 01:20:47 +0000"  >&lt;p&gt;Integrated to TRUNK.&lt;/p&gt;

&lt;p&gt;Thanks for the patch, Liyin.&lt;/p&gt;

&lt;p&gt;Thanks for the review Lars and Kannan.&lt;/p&gt;

&lt;p&gt;Hopefully I got commit message right &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13184646" author="hadoopqa" created="Thu, 12 Jan 2012 01:37:55 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12510289/HBASE-5033.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12510289/HBASE-5033.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -147 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 80 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/739//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/739//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/739//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/739//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/739//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/739//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13184704" author="hudson" created="Thu, 12 Jan 2012 03:52:00 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2623 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2623/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2623/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt; Differential Revision: 933 Opening/Closing store in parallel to reduce region open/close time (Liyin)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/Threads.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13184825" author="hudson" created="Thu, 12 Jan 2012 08:43:22 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #75 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/75/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/75/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5033&quot; title=&quot;Opening/Closing store in parallel to reduce region open/close time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5033&quot;&gt;&lt;del&gt;HBASE-5033&lt;/del&gt;&lt;/a&gt; Differential Revision: 933 Opening/Closing store in parallel to reduce region open/close time (Liyin)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/Threads.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12510282" name="5033-trunk.txt" size="17067" author="zhihyu@ebaysf.com" created="Thu, 12 Jan 2012 00:22:49 +0000"/>
                            <attachment id="12509766" name="5033.txt" size="17949" author="zhihyu@ebaysf.com" created="Sat, 7 Jan 2012 04:38:47 +0000"/>
                            <attachment id="12507996" name="ASF.LICENSE.NOT.GRANTED--D933.1.patch" size="17072" author="phabricator@reviews.facebook.net" created="Mon, 19 Dec 2011 23:03:30 +0000"/>
                            <attachment id="12508055" name="ASF.LICENSE.NOT.GRANTED--D933.2.patch" size="17738" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 06:55:31 +0000"/>
                            <attachment id="12508110" name="ASF.LICENSE.NOT.GRANTED--D933.3.patch" size="17609" author="phabricator@reviews.facebook.net" created="Tue, 20 Dec 2011 18:36:31 +0000"/>
                            <attachment id="12508290" name="ASF.LICENSE.NOT.GRANTED--D933.4.patch" size="18821" author="phabricator@reviews.facebook.net" created="Wed, 21 Dec 2011 19:33:30 +0000"/>
                            <attachment id="12508350" name="ASF.LICENSE.NOT.GRANTED--D933.5.patch" size="17960" author="phabricator@reviews.facebook.net" created="Thu, 22 Dec 2011 06:39:31 +0000"/>
                            <attachment id="12510289" name="HBASE-5033.patch" size="18186" author="liyin" created="Thu, 12 Jan 2012 00:51:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 19 Dec 2011 23:03:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220908</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 49 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i015yv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4736</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>&amp;quot;hbase.hstore.open.and.close.threads.max&amp;quot; is introduced to control the number of threads for opening/closing Store and store files.&lt;br/&gt;
</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>