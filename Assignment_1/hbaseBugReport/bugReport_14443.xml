<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:53:05 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14443/HBASE-14443.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14443] Add request parameter to the TooSlow/TooLarge warn message of RpcServer</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14443</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The RpcServer will log a warn message for TooSlow or TooLarge request as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        logResponse(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[]{param},
            md.getName(), md.getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;(&quot;&lt;/span&gt; + param.getClass().getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;,
            (tooLarge ? &lt;span class=&quot;code-quote&quot;&gt;&quot;TooLarge&quot;&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;TooSlow&quot;&lt;/span&gt;),
            status.getClient(), startTime, processingTime, qTime,
            responseSize);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The RpcServer#logResponse will create the warn message as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (params.length == 2 &amp;amp;&amp;amp; server &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; HRegionServer &amp;amp;&amp;amp;
        params[0] &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] &amp;amp;&amp;amp;
        params[1] &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Operation) {
      ...
      responseInfo.putAll(((Operation) params[1]).toMap());
      ...
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (params.length == 1 &amp;amp;&amp;amp; server &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; HRegionServer &amp;amp;&amp;amp;
        params[0] &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Operation) {
      ...
      responseInfo.putAll(((Operation) params[0]).toMap());
      ...
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      ...
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Because the parameter is always a protobuf message, not an instance of Operation, the request parameter will not be added into the warn message. The parameter is helpful to find out the problem, for example, knowing the startRow/endRow is useful for a TooSlow scan. To improve the warn message, we can transform the protobuf request message to corresponding Operation subclass object by ProtobufUtil, so that it can be added the warn message. Suggestion and discussion are welcomed.  &lt;/p&gt;</description>
                <environment></environment>
        <key id="12868760">HBASE-14443</key>
            <summary>Add request parameter to the TooSlow/TooLarge warn message of RpcServer</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="cuijianwei">Jianwei Cui</assignee>
                                    <reporter username="cuijianwei">Jianwei Cui</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Sep 2015 12:34:08 +0000</created>
                <updated>Wed, 30 Mar 2016 08:38:38 +0000</updated>
                                            <version>1.2.1</version>
                                                    <component>IPC/RPC</component>
                    <component>Operability</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="14790528" author="stack" created="Wed, 16 Sep 2015 15:13:39 +0000"  >&lt;p&gt;Anything to make this stuff more useful is welcome (+1 on transform)&lt;/p&gt;</comment>
                            <comment id="14790841" author="ndimiduk" created="Wed, 16 Sep 2015 18:12:54 +0000"  >&lt;p&gt;Agreed. Anything will help here. Also, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14333&quot; title=&quot;responseTooLarge/Slow logs are not actionable when the rpc method is ExecService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14333&quot;&gt;&lt;del&gt;HBASE-14333&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14804939" author="cuijianwei" created="Fri, 18 Sep 2015 04:21:09 +0000"  >&lt;p&gt;The patch will add request parameters into warn message.&lt;br/&gt;
For get/scan/mutate request, the warn message will be formatted as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(operationTooSlow): {&lt;span class=&quot;code-quote&quot;&gt;&quot;region&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;test_table,,1442476299154.3ee9b59f45681b73c79b58b25d0be062.&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;Condition&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;family&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;C&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;qualifier&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;&quot;},&quot;&lt;/span&gt;Put&lt;span class=&quot;code-quote&quot;&gt;&quot;:{&quot;&lt;/span&gt;totalColumns&lt;span class=&quot;code-quote&quot;&gt;&quot;:1,&quot;&lt;/span&gt;families&lt;span class=&quot;code-quote&quot;&gt;&quot;:{&quot;&lt;/span&gt;C&lt;span class=&quot;code-quote&quot;&gt;&quot;:[{&quot;&lt;/span&gt;timestamp&lt;span class=&quot;code-quote&quot;&gt;&quot;:9223372036854775807,&quot;&lt;/span&gt;tag&lt;span class=&quot;code-quote&quot;&gt;&quot;:[],&quot;&lt;/span&gt;qualifier&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;vlen&lt;span class=&quot;code-quote&quot;&gt;&quot;:6}]},&quot;&lt;/span&gt;row&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;105&lt;span class=&quot;code-quote&quot;&gt;&quot;}, ... ,&quot;&lt;/span&gt;method&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;Mutate&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is a warn log for checkAndPut request, the condition and put info will both be included.&lt;br/&gt;
For multi request, the quantity of actions will be included as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(operationTooSlow): {...&lt;span class=&quot;code-quote&quot;&gt;&quot;method&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;Multi&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;MultiAction&quot;&lt;/span&gt;:{&lt;span class=&quot;code-quote&quot;&gt;&quot;Increment&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;Put&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;Append&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;Delete&quot;&lt;/span&gt;:1,&lt;span class=&quot;code-quote&quot;&gt;&quot;regions&quot;&lt;/span&gt;:1}} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For coprocessor exec, the coprocessor service and method name will be extracted from request and included as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(responseTooSlow): {&lt;span class=&quot;code-quote&quot;&gt;&quot;call&quot;&lt;/span&gt;:&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.pb.MultiRowMutationService#MutateRows(region: test_table,,1442476299154.3ee9b59f45681b73c79b58b25d0be062., row:106)&quot;&lt;/span&gt;,...}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14804946" author="cuijianwei" created="Fri, 18 Sep 2015 04:28:20 +0000"  >&lt;p&gt;The coprocessor info is also needed as described in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14443&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HBASE-14333&lt;/a&gt;. This patch include the coprocessor service and method name into warn message.  &lt;/p&gt;</comment>
                            <comment id="14876505" author="ndimiduk" created="Fri, 18 Sep 2015 21:43:21 +0000"  >&lt;p&gt;Those are sample log lines from your testing runs?&lt;/p&gt;

&lt;p&gt;Patch looks alright on the face of it. This looks like something that will easily suffer bit-rot because there&apos;s all this special code per operation type. Any way we can reflect- or automate-away some of those if/switch statements to keep this utility working long into the future?&lt;/p&gt;

&lt;p&gt;Nice work &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cuijianwei&quot; class=&quot;user-hover&quot; rel=&quot;cuijianwei&quot;&gt;Jianwei Cui&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14900161" author="cuijianwei" created="Mon, 21 Sep 2015 03:16:37 +0000"  >&lt;p&gt;Thanks for your comment&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt;. Yes, the above samples come from the testing runs. This patch is not flexible enough, especially when new operations are added in future. The reflect or automate-away way is interesting, I am not sure how to achieve this currently, I will study more details. &lt;/p&gt;</comment>
                            <comment id="14900992" author="ndimiduk" created="Mon, 21 Sep 2015 17:04:10 +0000"  >&lt;p&gt;I would be fine with committing a change like this and opening a future ticket for a more general solution &amp;#8211; what you have here will help quite a lot.&lt;/p&gt;

&lt;p&gt;One other comment though: probably folks are monitoring their log files and parsing this output &amp;#8211; I think we should consider it a &quot;loose&quot; API. Your changes here, do they remove any of the json fields that were generated previously? Do you change the meaning of any existing fields? I would prefer this change only add new fields to the json message, rather than change or remove existing fields. That way we don&apos;t break our ops friends&apos; automation.&lt;/p&gt;</comment>
                            <comment id="14901494" author="apurtell" created="Mon, 21 Sep 2015 22:03:02 +0000"  >&lt;p&gt;What about when table schema details might be sensitive? Row key might contain sensitive information? Wouldn&apos;t want those details going to the log in that case. &lt;/p&gt;</comment>
                            <comment id="14903854" author="cuijianwei" created="Wed, 23 Sep 2015 02:49:49 +0000"  >&lt;p&gt;It is reasonable to keep the existing fields in json message. I will update the patch to only add new fields.&lt;/p&gt;</comment>
                            <comment id="14903862" author="cuijianwei" created="Wed, 23 Sep 2015 02:58:00 +0000"  >&lt;p&gt;Interesting issue. The json message of Query/Mutation will contain the info of row key and families. Maybe we need to add an option to decide whether allowed to log such info?&lt;/p&gt;</comment>
                            <comment id="14910137" author="cuijianwei" created="Mon, 28 Sep 2015 07:59:05 +0000"  >&lt;p&gt;Keep origin fields for TooSlow/TooLarge warn message, add extra fields for method parameters.&lt;/p&gt;</comment>
                            <comment id="14910140" author="cuijianwei" created="Mon, 28 Sep 2015 08:00:38 +0000"  >&lt;p&gt;For if/else branches in RpcServer#logResponse:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (params.length == 2 &amp;amp;&amp;amp; server &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; HRegionServer &amp;amp;&amp;amp;
        params[0] &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] &amp;amp;&amp;amp;
        params[1] &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Operation) {
  ...
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (params.length == 1 &amp;amp;&amp;amp; server &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; HRegionServer &amp;amp;&amp;amp;
        params[0] &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; Operation) {
   ...
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    ...
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It seems the rpc calls won&apos;t reach the &apos;if/else if&apos; branches? Is there any situation that these branches can be reached?&lt;/p&gt;</comment>
                            <comment id="14935115" author="ndimiduk" created="Tue, 29 Sep 2015 12:50:31 +0000"  >&lt;p&gt;I like the latest patch, preserving the original format.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; can you outline the properties that would be good to omit, other than rowkey? Perhaps the patch can be selective of the fields consumed from the &lt;tt&gt;toMap&lt;/tt&gt; calls.&lt;/p&gt;</comment>
                            <comment id="15047201" author="bbeaudreault" created="Tue, 8 Dec 2015 18:29:02 +0000"  >&lt;p&gt;I see there is a patch available for this.  Any progress on getting it integrated? &lt;/p&gt;

&lt;p&gt;In terms of security, there are already tons of log lines with rowkeys in them. They are part of split and region names so show up in compactions, moves, etc.  Column family names also show up in various existing log lines.&lt;/p&gt;

&lt;p&gt;I understand not wanting to add to an existing problem if that is one we care about, so maybe we can add a configuration parameter for redacting the secure info.&lt;/p&gt;

&lt;p&gt;Considering the existing functionality is broken (and worked in at least 0.94.x) perhaps some pragmatism would be good in terms of weighing this concern vs just getting it shipped.&lt;/p&gt;</comment>
                            <comment id="15047209" author="apurtell" created="Tue, 8 Dec 2015 18:31:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;In terms of security, there are already tons of log lines with rowkeys in them.  They are part of split and region names so show up in compactions, moves, etc.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Bugs that should be fixed, we can replace with just the region hashes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Column family names also show up in various existing log lines.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Definitely bugs&lt;/p&gt;</comment>
                            <comment id="15047214" author="apurtell" created="Tue, 8 Dec 2015 18:33:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;Andrew Purtell can you outline the properties that would be good to omit, other than rowkey? Perhaps the patch can be selective of the fields consumed from the toMap calls.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Any user submitted data. &lt;/p&gt;</comment>
                            <comment id="15217665" author="tomu.tsuruhara" created="Wed, 30 Mar 2016 08:38:38 +0000"  >&lt;p&gt;How is this going?&lt;br/&gt;
I also want this feature.&lt;br/&gt;
How about introducing a global switch like &lt;tt&gt;hbase.ipc.warn.response.verbose&lt;/tt&gt;?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12860429">HBASE-14333</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12757204" name="HBASE-14443-trunk-v1.patch" size="11013" author="cuijianwei" created="Fri, 18 Sep 2015 04:21:09 +0000"/>
                            <attachment id="12762657" name="HBASE-14443-trunk-v2.patch" size="10235" author="cuijianwei" created="Mon, 28 Sep 2015 07:59:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Sep 2015 15:13:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            37 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2k8z3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>