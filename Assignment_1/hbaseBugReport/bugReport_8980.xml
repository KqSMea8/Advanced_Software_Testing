<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:00:19 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8980/HBASE-8980.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8980] Assistant Store ----------- An Index Store of HRegion</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8980</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;b&gt;Background&lt;/b&gt;&lt;br/&gt;
a.Generally, we would hope several organizations for the same data. e.g. Secondary Index sortes the data as the non-primary key.&lt;br/&gt;
b.Now, when we scanning the data on HBase with condition, like ValueFilter, its  efficiency seems low&lt;br/&gt;
c.We could create an Assistant Store to store the data with another organization for the data of HRegion&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Assistant Store&lt;/b&gt;&lt;br/&gt;
a.It&apos;s a store of HRegion, like HStore, could be created by user through adding ColumnFamliy&lt;/p&gt;

&lt;p&gt;b.Data in Assistant Store is the copy of data in HRegion, but using another organization ,The Exception is that its row could be not in the range of HRegion and its value is the same as the row of original KeyValue&lt;br/&gt;
For example, &lt;br/&gt;
The region(Range:&apos;row001&apos;~&apos;row999&apos;) includes the following KVs in the Store cf:&lt;br/&gt;
row001/cf:q1/val001&lt;br/&gt;
row002/cf:q1/val002&lt;br/&gt;
row003/cf:q1/val003&lt;br/&gt;
we could create an Assistant Store(named as) for the region which includes the following KVs:&lt;br/&gt;
val001/cf:q1/row001&lt;br/&gt;
val002/cf:q1/row002&lt;br/&gt;
val003/cf:q1/row003&lt;/p&gt;

&lt;p&gt;c.We could use local region transaction to ensure the Atomicity and Consistency&lt;/p&gt;

&lt;p&gt;e.Regionserver will put data into Assistant Store automatically, but user should read the data from Assistant Store himself&lt;/p&gt;


&lt;p&gt;&lt;b&gt;Example of Using Assistant Store&lt;/b&gt;&lt;br/&gt;
a.Supposing exist the empty table named t1 with the column family named c1, it has only one region (region&apos;s range is from EMPTY_START_ROW to EMPTY_END_ROW).&lt;/p&gt;

&lt;p&gt;b.Adding an Assistant Store for the table through adding a new column family named c2.&lt;/p&gt;

&lt;p&gt;c.User put following data to table:&lt;br/&gt;
r1/c1:q1/v1&lt;br/&gt;
r2/c1:q1/v2&lt;br/&gt;
r3/c1:q1/v1&lt;br/&gt;
r4/c1:q1/v2&lt;br/&gt;
r5/c1:q1/v1&lt;br/&gt;
r6/c1:q1/v2&lt;/p&gt;

&lt;p&gt;d.Then, the region will have the following data:&lt;br/&gt;
r1/c1:q1/v1&lt;br/&gt;
r2/c1:q1/v2&lt;br/&gt;
r3/c1:q1/v1&lt;br/&gt;
r4/c1:q1/v2&lt;br/&gt;
r5/c1:q1/v1&lt;br/&gt;
r6/c1:q1/v2&lt;/p&gt;

&lt;p&gt;v1/c2:q1/r1&lt;br/&gt;
v1/c2:q1/r3&lt;br/&gt;
v1/c2:q1/r5&lt;br/&gt;
v2/c2:q1/r2 (Generated by Assistant, Stored in Assistant Store)&lt;br/&gt;
v2/c2:q1/r4&lt;br/&gt;
v2/c2:q1/r6&lt;/p&gt;

&lt;p&gt;e.Splitting the region into daughter_a  and daughter_b with the split poit &apos;r4&apos;, &lt;/p&gt;

&lt;p&gt;then the daughter_a has the following data:&lt;br/&gt;
r1/c1:q1/v1&lt;br/&gt;
r2/c1:q1/v2&lt;br/&gt;
r3/c1:q1/v1&lt;/p&gt;

&lt;p&gt;v1/c2:q1/r1&lt;br/&gt;
v1/c2:q1/r3  (Data in Assistant Store)&lt;br/&gt;
v2/c2:q1/r2&lt;/p&gt;

&lt;p&gt;the daughter_b has the following data:&lt;/p&gt;

&lt;p&gt;r4/c1:q1/v2&lt;br/&gt;
r5/c1:q1/v1&lt;br/&gt;
r6/c1:q1/v2&lt;/p&gt;

&lt;p&gt;v1/c2:q1/r5&lt;br/&gt;
v2/c2:q1/r4(Data in Assistant Store)&lt;br/&gt;
v2/c2:q1/r6&lt;/p&gt;


&lt;p&gt;f.From the above, we could see that the data in Assistant Store is always corresponding to the original data in Region, its data is maintained by regionserver.&lt;/p&gt;

&lt;p&gt;g.How to use the data in Assistant Store? &lt;br/&gt;
Suppose we want to do a scan from &apos;r1&apos; to &apos;r7&apos; with the ValueFilter value = &apos;v2&apos;,&lt;br/&gt;
We must scan the whole table without Assistant Store.&lt;br/&gt;
But now we could use Assistant Store to speed up scanning:&lt;br/&gt;
Take a scan on Assistant Store from &apos;v2&apos; to &apos;v2+&apos;, and get the following result:&lt;br/&gt;
v2/c2:q1/r2&lt;br/&gt;
v2/c2:q1/r4&lt;br/&gt;
v2/c2:q1/r6&lt;/p&gt;

&lt;p&gt;Unfortunately, the scan result may not be ordered by row nor value, but be able to make it ordered by value.&lt;/p&gt;

&lt;p&gt;From the code view, I design the scan on Assistant Store as following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//Limit the scan range from the row
&lt;/span&gt;Scan scan = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Scan();
scan.setStartRow(&apos;r1&apos;);
scan.setStopRow(&apos;r7&apos;);

&lt;span class=&quot;code-comment&quot;&gt;//Do the scan on Assistant Store
&lt;/span&gt;Scan assistantScan = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Scan().setStartRow(&apos;v2&apos;).setStopRow(&apos;v2&apos;+&apos;(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;)0x00&apos;);
scan.setAssistantScan(assistantScan);&lt;span class=&quot;code-comment&quot;&gt;//After setting &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, region will run the scan with the assistant Scan
&lt;/span&gt;
scanner = htable.getScanner(scan);

&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(Result result:scanner){
&lt;span class=&quot;code-comment&quot;&gt;//out put
&lt;/span&gt;v2/c2:q1/r2
v2/c2:q1/r4
v2/c2:q1/r6
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;&lt;b&gt;Implementation Dependency&lt;/b&gt;&lt;br/&gt;
a.Split the StoreFile as value.(Now,we just split the file as row)&lt;br/&gt;
b.Support multi-row transaction in region (Alreadt implemented)&lt;/p&gt;

&lt;p&gt;Providing an initial patch on 0.94 version. &lt;br/&gt;
What do you think about such a Store.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12658465">HBASE-8980</key>
            <summary>Assistant Store ----------- An Index Store of HRegion</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="fuqiang">fuqiang cao</assignee>
                                    <reporter username="zjushch">chunhui shen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Jul 2013 08:04:35 +0000</created>
                <updated>Sun, 8 Nov 2015 16:41:23 +0000</updated>
                                                                            <component>regionserver</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>21</watches>
                                                                <comments>
                            <comment id="13712412" author="yuzhihong@gmail.com" created="Thu, 18 Jul 2013 15:27:16 +0000"  >&lt;p&gt;If a table has multiple column families, how many assistant stores would be created ?&lt;/p&gt;

&lt;p&gt;Do you have some performance numbers w.r.t. both impact on writing to the table and possibly assisted scanning ?&lt;/p&gt;

&lt;p&gt;In the patch, modification to store file is presented. People may be more interested in seeing how scanning / filtering is done on top of the assistant stores.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13712530" author="sershe" created="Thu, 18 Jul 2013 17:28:43 +0000"  >&lt;p&gt;If you want to search by value though, you have to scan all regions, right? A given value could be in any row and region is still partitioned by row.&lt;/p&gt;</comment>
                            <comment id="13713306" author="zjushch" created="Fri, 19 Jul 2013 03:39:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;If a table has multiple column families, how many assistant stores would be created ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Assistant stores are created by user, you could create one or more.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Do you have some performance numbers&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I start this work just now...&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;People may be more interested in seeing how scanning / filtering is done on top of the assistant stores.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Adding this in description&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If you want to search by value though, you have to scan all regions, right?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, you could consider the region as a sub-table and only the sub-table has its index store. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;region is still partitioned by row.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes&lt;/p&gt;</comment>
                            <comment id="13721840" author="stack" created="Sun, 28 Jul 2013 04:05:24 +0000"  >&lt;p&gt;Does this have to be in core hbase?  Can it be done as a decoration?  As a coprocessor?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12592934" name="8980-94.patch" size="82641" author="zjushch" created="Thu, 18 Jul 2013 08:05:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Jul 2013 15:27:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338659</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 20 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1meuf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>338979</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>