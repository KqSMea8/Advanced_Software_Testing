<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:06:13 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9636/HBASE-9636.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9636]  HBase shell/client &apos;scan table&apos; operation is getting failed inbetween the when the regions are shifted from one Region Server to another Region Server </title>
                <link>https://issues.apache.org/jira/browse/HBASE-9636</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;
Problem:
HBase shell/client &apos;scan table&apos; operation is getting failed inbetween the when the regions are shifted from one Region Server to another Region Server

When the table regions data moved from one Region Server to another Region Server then the client/shell should be able to handle the data from the 
new Region server automatically (because when we have huge data in terms of GB/TB at that time one of the Region Server going down in the cluster is frequent)


Procedure:
1. Setup Non HA Hadoop Cluster with two nodes (Node1-XX.XX.XX.XX,  Node2-YY.YY.YY.YY)
2. Install Zookeeper, HMaster &amp;amp; HRegionServer in Node-1
3. Install HRegionServer in Node-2
4. From Node2 create HBase Table ( table name &apos;t1&apos; with one column family &apos;cf1&apos; )
5. add around 367120 rows to the table
6. scan the table &apos;t1&apos; using hbase shell &amp;amp; at the same time switch the region server 1 &amp;amp; 2 (so that the table &apos;t1&apos; regions data are moved from Region Server 1 to 1 &amp;amp; vice versa)
7. During this time hbase shell is getting failed in between of the scan operation as below

...................................................................                                
 row172266                        column=cf1:a, timestamp=1379680737307, value=100                                              
 row172267                        column=cf1:a, timestamp=1379680737311, value=100                                              
 row172268                        column=cf1:a, timestamp=1379680737314, value=100                                              
 row172269                        column=cf1:a, timestamp=1379680737317, value=100                                              
 row17227                         column=cf1:a, timestamp=1379679668631, value=100                                              
 row17227                         column=cf1:b, timestamp=1379681090560, value=200                                             

ERROR: java.lang.RuntimeException: org.apache.hadoop.hbase.client.RetriesExhaustedException: Failed after attempts=7, exceptions:
Fri Sep 20 18:20:58 IST 2013, org.apache.hadoop.hbase.client.ScannerCallable@1999dc4f, java.net.ConnectException: Connection refused
Fri Sep 20 18:20:59 IST 2013, org.apache.hadoop.hbase.client.ScannerCallable@1999dc4f, org.apache.hadoop.hbase.ipc.HBaseClient$FailedServerException: This server is in the failed servers list: HOST-YY.YY.YY.YY/YY.YY.YY.YY:61020
Fri Sep 20 18:21:00 IST 2013, org.apache.hadoop.hbase.client.ScannerCallable@1999dc4f, java.net.ConnectException: Connection refused
Fri Sep 20 18:21:01 IST 2013, org.apache.hadoop.hbase.client.ScannerCallable@1999dc4f, org.apache.hadoop.hbase.ipc.HBaseClient$FailedServerException: This server is in the failed servers list: HOST-YY.YY.YY.YY/YY.YY.YY.YY:61020
Fri Sep 20 18:21:07 IST 2013, org.apache.hadoop.hbase.client.ScannerCallable@1999dc4f, java.net.ConnectException: Connection refused
Fri Sep 20 18:21:09 IST 2013, org.apache.hadoop.hbase.client.ScannerCallable@1999dc4f, java.net.ConnectException: Connection refused
Fri Sep 20 18:21:17 IST 2013, org.apache.hadoop.hbase.client.ScannerCallable@1999dc4f, java.net.ConnectException: Connection refused

hbase(main):014:0&amp;gt; 


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;SuSE11&lt;/p&gt;</environment>
        <key id="12670060">HBASE-9636</key>
            <summary> HBase shell/client &apos;scan table&apos; operation is getting failed inbetween the when the regions are shifted from one Region Server to another Region Server </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="rajesh23">rajeshbabu</assignee>
                                    <reporter username="shankarlingayya">shankarlingayya</reporter>
                        <labels>
                    </labels>
                <created>Mon, 23 Sep 2013 13:56:54 +0000</created>
                <updated>Thu, 6 Mar 2014 12:39:08 +0000</updated>
                            <resolved>Thu, 6 Mar 2014 12:39:08 +0000</resolved>
                                    <version>0.94.11</version>
                                                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13774730" author="jdcryans" created="Mon, 23 Sep 2013 17:07:08 +0000"  >&lt;p&gt;I&apos;m seeing a &quot;Connection Refused&quot; in there, so there&apos;s probably a different problem than what you originally thought.&lt;/p&gt;</comment>
                            <comment id="13922434" author="rajesh23" created="Thu, 6 Mar 2014 12:39:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=shankarlingayya&quot; class=&quot;user-hover&quot; rel=&quot;shankarlingayya&quot;&gt;shankarlingayya&lt;/a&gt;&lt;br/&gt;
 This is as expected behavior only.&lt;br/&gt;
 As for the logs you have shared, the region server holding row17-row18 range is went down at 18:20:58&lt;/p&gt;
 &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 Fri Sep 20 18:20:58 IST 2013, org.apache.hadoop.hbase.client.ScannerCallable@1999dc4f, java.net.ConnectException: Connection refused
 Fri Sep 20 18:20:59 IST 2013, org.apache.hadoop.hbase.client.ScannerCallable@1999dc4f, org.apache.hadoop.hbase.ipc.HBaseClient$FailedServerException: This server is in the failed servers list: HOST-10-18-40-172/10.18.40.172:61020
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt; After that the regions within the range took more time to assign, because the HOST-10-18-40-172 holds many regions and the need to assigned one by one after shutdown.&lt;br/&gt;
 From the logs we can observe this. Means the META table holds the old region server address and on each exception we will clear the cache and read from META. But meta also holds HOST-10-18-40-172 so scan failed after 7 retries.&lt;/p&gt;

 &lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-09-20 18:21:33,539 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Received request to open region: t1,row170593,1379679042365.1ad0997453c665bb9707907be08980fa.
 
2013-09-20 18:21:33,551 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:61020-0x1413b3594140079-0x1413b3594140079-0x1413b3594140079-0x1413b3594140079 Attempting to transition node 1ad0997453c665bb9707907be08980fa from M_ZK_REGION_OFFLINE to RS_ZK_REGION_OPENING
 
2013-09-20 18:21:33,557 DEBUG org.apache.hadoop.hbase.regionserver.Store: loaded hdfs:&lt;span class=&quot;code-comment&quot;&gt;//10.18.40.153:8020/hbase/t1/c18a2bbd6ef4b53f480b53207a68c44e/cf1/04b0a1c45c9f498ebbfd4f8909e693a4, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, isBulkL
&lt;/span&gt; &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; There are some configurations which should be tuned to avoid such kind of issues.&lt;br/&gt;
 1) increase retry count(hbase.client.retries.number - default 7 from shell and 10 from client)&lt;br/&gt;
 2) increase pause time for each retry(hbase.client.pause - default 1 sec)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 23 Sep 2013 17:07:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349890</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 41 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1obwn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>350188</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>