<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:37:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6469/HBASE-6469.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6469] Failure on enable/disable table will cause table state in zk to be left as enabling/disabling until master is restarted</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6469</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In Enable/DisableTableHandler code, if something goes wrong in handling, the table state in zk is left as ENABLING / DISABLING. After that we cannot force any more action from the API or CLI, and the only recovery path is restarting the master. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (done) {
      &lt;span class=&quot;code-comment&quot;&gt;// Flip the table to enabled.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.assignmentManager.getZKTable().setEnabledTable(
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.tableNameStr);
      LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Table &apos;&quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.tableNameStr
      + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos; was successfully enabled. Status: done=&quot;&lt;/span&gt; + done);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Table &apos;&quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.tableNameStr
      + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos; wasn&apos;t successfully enabled. Status: done=&quot;&lt;/span&gt; + done);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here, if done is false, the table state is not changed. There is also no way to set skipTableStateCheck from cli / api. &lt;/p&gt;

&lt;p&gt;We have run into this issue a couple of times before. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12600527">HBASE-6469</key>
            <summary>Failure on enable/disable table will cause table state in zk to be left as enabling/disabling until master is restarted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="rajesh23">rajeshbabu</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Jul 2012 22:45:00 +0000</created>
                <updated>Mon, 15 Sep 2014 20:07:33 +0000</updated>
                            <resolved>Mon, 15 Sep 2014 20:07:33 +0000</resolved>
                                    <version>0.94.6</version>
                                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>22</watches>
                                                                <comments>
                            <comment id="13440174" author="ram_krish" created="Thu, 23 Aug 2012 09:24:12 +0000"  >&lt;p&gt;HBCK also does not handle this case.  It only tries to assign or unassign based on ENABLING/DISABLING but does not set the state of the table.&lt;/p&gt;</comment>
                            <comment id="13440727" author="jmhsieh" created="Thu, 23 Aug 2012 22:29:11 +0000"  >&lt;p&gt;So would a reasonable plans here be:&lt;br/&gt;
1) to handle failures during enable/disable better &lt;br/&gt;
2) to default to disabling if either operaton failes&lt;br/&gt;
3) to expose an advanced method in the shell/admin that allows the state to be revoked?  (and then potentially something that verifies that state is ok?)&lt;/p&gt;</comment>
                            <comment id="13440842" author="enis" created="Fri, 24 Aug 2012 01:00:45 +0000"  >&lt;p&gt;For 3, we can have smt like -force to set skipTableStateCheck=true.&lt;/p&gt;</comment>
                            <comment id="13440926" author="ram_krish" created="Fri, 24 Aug 2012 04:01:40 +0000"  >&lt;p&gt;While doing 3 we should also ensure that the cache in ZKTable should also be updated even though we do it forcefully.  &lt;/p&gt;</comment>
                            <comment id="13441978" author="lhofhansl" created="Sat, 25 Aug 2012 22:09:47 +0000"  >&lt;p&gt;Pushing to 0.94.3&lt;/p&gt;</comment>
                            <comment id="13503001" author="wyukawa" created="Fri, 23 Nov 2012 03:40:38 +0000"  >&lt;p&gt;Recently, I&apos;ve got the following problem.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://comments.gmane.org/gmane.comp.java.hadoop.hbase.user/25974&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://comments.gmane.org/gmane.comp.java.hadoop.hbase.user/25974&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Environment:HBase 0.94.2&lt;br/&gt;
The result of hbase hbck  is INCONSISTENT.&lt;br/&gt;
The table state in zk is left as ENABLING.&lt;br/&gt;
The table is neither enable nor disable.&lt;/p&gt;

&lt;p&gt;Although I can&apos;t reproduce the problem, maybe the following procedure&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hbase(main):003:0&amp;gt; create &apos;table1&apos;, &apos;rowkey1&apos;
hbase(main):005:0&amp;gt; disable &apos;table1&apos;
hbase(main):007:0&amp;gt; alter &apos;table1&apos;, METHOD =&amp;gt; &apos;table_att&apos;, DEFERRED_LOG_FLUSH =&amp;gt; &apos;true&apos;
hbase(main):011:0&amp;gt; enable &apos;table1&apos; //error
hbase(main):009:0&amp;gt; is_enabled &apos;table1&apos;
false
hbase(main):006:0&amp;gt; is_disabled &apos;table1&apos;
false
hbase(main):011:0&amp;gt; drop &apos;table1&apos; //error
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The soution is the following&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase hbck -fix&lt;/li&gt;
	&lt;li&gt;HMaster reboot&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;I hope this information will be helpful.&lt;/p&gt;</comment>
                            <comment id="13509401" author="ndimiduk" created="Tue, 4 Dec 2012 01:11:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmhsieh&quot; class=&quot;user-hover&quot; rel=&quot;jmhsieh&quot;&gt;Jonathan Hsieh&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; Please recommend further detail regarding the kinds of checks that should be applied as part of an implementation of #3, above. I have a patch that exposes this option to the client/shell and adds an additional clause to the if(done) block described. Will post separately for review.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; please advise regarding this tweak in the context of your larger AssignmentManager improvements. Does your implementation provide a convenient hook into the state-machine logic, enabling an &quot;escape hatch&quot; as requested here?&lt;/p&gt;</comment>
                            <comment id="13509468" author="ndimiduk" created="Tue, 4 Dec 2012 03:03:46 +0000"  >&lt;p&gt;I don&apos;t think review board is cross-posting. &lt;a href=&quot;https://reviews.apache.org/r/8333/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/8333/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13509470" author="jmhsieh" created="Tue, 4 Dec 2012 03:08:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; Give some more thought, based on what I&apos;ve been working on recently, doing option 3 is a good stopgap, but only exposes a way to &quot;fix&quot; the problem when it happens but I don&apos;t think it fundamentally fix the problem.  &lt;/p&gt;

&lt;p&gt;I think the right way would essentially do something like 2pc where everyone would agree that they are enabling/disabling logging this decision, and then the master would &quot;commit&quot; the new table state.  This commit would be logged, so that if any rs/master failed along the way, when they be able to recover.  I&apos;m actually thinking this logging state can be held in META as extra columns associated with each region.  The overall table state would either need to be held in a special meta row (maybe the first?) or in hdfs. &lt;/p&gt;</comment>
                            <comment id="13509496" author="jxiang" created="Tue, 4 Dec 2012 04:24:21 +0000"  >&lt;p&gt;Currently, what&apos;s missing is some rollback logic.  If the call fails, the state is left in the middle and no process to clean it up.&lt;/p&gt;</comment>
                            <comment id="13509507" author="enis" created="Tue, 4 Dec 2012 05:00:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;Nick Dimiduk Give some more thought, based on what I&apos;ve been working on recently, doing option 3 is a good stopgap, but only exposes a way to &quot;fix&quot; the problem when it happens but I don&apos;t think it fundamentally fix the problem.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agreed, but the target of this issue is to force clean the state should it occurs, not to fix the actual problem. I am also thinking of attacking this problem. First, I&apos;ll do &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5991&quot; title=&quot;Introduce sequential ZNode based read/write locks &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5991&quot;&gt;&lt;del&gt;HBASE-5991&lt;/del&gt;&lt;/a&gt;, and then maybe a FATE based solution instead of 2PC (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5459&quot; title=&quot;Provide capability to find the status of Master coordinated tasks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5459&quot;&gt;HBASE-5459&lt;/a&gt;)?&lt;br/&gt;
I suggest let&apos;s just fix only the part 3 in this issue, and continue the discussion elsewhere. &lt;/p&gt;</comment>
                            <comment id="13509741" author="rajesh23" created="Tue, 4 Dec 2012 13:55:29 +0000"  >&lt;p&gt;Can we enable/disable partially enabled/disabled table after TM processes failed region transitions of the table?&lt;/p&gt;</comment>
                            <comment id="13525803" author="ndimiduk" created="Thu, 6 Dec 2012 22:03:46 +0000"  >&lt;p&gt;This completes the patch started in &lt;a href=&quot;https://reviews.apache.org/r/8333/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;review 8333&lt;/a&gt;. It exposes a new &quot;force&quot; option to the table enable and disable operators in the AdminMasterProtocol. It also updates the existing TestAdmin coverage of the enable and disable paths.&lt;/p&gt;

&lt;p&gt;Most of the change is serialization noise. The new work happens in the two Handler classes.&lt;/p&gt;</comment>
                            <comment id="13525883" author="yuzhihong@gmail.com" created="Thu, 6 Dec 2012 22:32:57 +0000"  >&lt;p&gt;Updating patch on review board would make review easier.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.retainAssignment) {
+      &lt;span class=&quot;code-comment&quot;&gt;// retainAssignment used as a proxy to skipTableStateCheck&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Would introducing protobuf enum make the above check easier to maintain ?&lt;/p&gt;</comment>
                            <comment id="13525985" author="ndimiduk" created="Thu, 6 Dec 2012 23:08:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;Updating patch on review board would make review easier.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Very well. The review has been re-opened and updated.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Would introducing protobuf enum make the above check easier to maintain ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t know. My protobuf exposure is minimal. Are you referring to replacing the &quot;boolean force&quot; with an enumeration? What would you call that enumeration? What other values would you advocate?&lt;/p&gt;</comment>
                            <comment id="13525999" author="yuzhihong@gmail.com" created="Thu, 6 Dec 2012 23:30:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;Are you referring to replacing the &quot;boolean force&quot; with an enumeration?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The enum, called flags e.g., may carry RETAIN_ASSIGNMENT and SKIP_TABLE_STATE_CHECK.&lt;/p&gt;

&lt;p&gt;When hbck detects table stuck in enabling / disabling state, it can use the new API to fix the problem.&lt;/p&gt;</comment>
                            <comment id="13526018" author="ndimiduk" created="Thu, 6 Dec 2012 23:48:23 +0000"  >&lt;p&gt;In the enable path, &lt;tt&gt;retainAssignment&lt;/tt&gt; is set from the argument &lt;tt&gt;skipTableStateCheck&lt;/tt&gt;. From what I can tell, there&apos;s no distinction between the two. If anything, it appears to me that the &lt;tt&gt;skipTableStateCheck&lt;/tt&gt; argument was cooped to mean something else (hence the &apos;rename&apos; to &lt;tt&gt;retainAssignment&lt;/tt&gt;). Is there a desire to expose &lt;tt&gt;retainAssignment&lt;/tt&gt; to via the admin console? My reading of the patch included in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6317&quot; title=&quot;Master clean start up and Partially enabled tables make region assignment inconsistent.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6317&quot;&gt;&lt;del&gt;HBASE-6317&lt;/del&gt;&lt;/a&gt; is not enlightening.&lt;/p&gt;</comment>
                            <comment id="13528897" author="rajesh23" created="Tue, 11 Dec 2012 11:48:43 +0000"  >&lt;p&gt;@Nick Dimiduk&lt;br/&gt;
retainAssignment flag is used to avoid assignment inconsistencies of enabling table regions during master start up.&lt;br/&gt;
This is set from skipTableStateCheck to get to know whether its recovery of enabling table or normal enable table call from admin. Yes, there is not distinction between the two.&lt;/p&gt;</comment>
                            <comment id="13530569" author="ndimiduk" created="Thu, 13 Dec 2012 01:17:03 +0000"  >&lt;p&gt;This patch folds &lt;tt&gt;renameAssignment&lt;/tt&gt; variable into &lt;tt&gt;skipTableStateCheck&lt;/tt&gt;. Include additional information in log messages when force option is triggered. Corresponds to diff r3 on review board.&lt;/p&gt;</comment>
                            <comment id="13530758" author="hadoopqa" created="Thu, 13 Dec 2012 07:27:37 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12560693/6469-expose-force-r3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12560693/6469-expose-force-r3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 106 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 25 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestSplitTransaction&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3521//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13536535" author="lhofhansl" created="Wed, 19 Dec 2012 22:59:06 +0000"  >&lt;p&gt;Can we even do this in 0.94 without an wire-incompatible change?&lt;/p&gt;</comment>
                            <comment id="13536706" author="enis" created="Thu, 20 Dec 2012 02:23:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can we even do this in 0.94 without an wire-incompatible change?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think we can introduce HMaster.enableTableWithForce() as another rpc call. It should not be too difficult. &lt;/p&gt;</comment>
                            <comment id="13542801" author="lhofhansl" created="Thu, 3 Jan 2013 08:28:09 +0000"  >&lt;p&gt;Generally why can&apos;t a 2nd call to enable/disable cleanup any failed previous attempt?&lt;br/&gt;
The is how I (with a user hat on) would expect this to work. I enable a table, something goes wrong, I&apos;ll just do it again to finish it.&lt;br/&gt;
We can automatically check for this condition, right?&lt;/p&gt;</comment>
                            <comment id="13563762" author="lhofhansl" created="Sun, 27 Jan 2013 08:06:59 +0000"  >&lt;p&gt;Any update? Moving out to 0.94.6&lt;/p&gt;</comment>
                            <comment id="13564642" author="ndimiduk" created="Mon, 28 Jan 2013 20:15:32 +0000"  >&lt;p&gt;I&apos;ve paused work on this because discussion as not reached a consensus on implementation. Specifically, the implementation described by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; appears to me divergent from that proposed by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Please advise.&lt;/p&gt;</comment>
                            <comment id="13574757" author="rajesh23" created="Fri, 8 Feb 2013 19:32:55 +0000"  >&lt;p&gt;Patch based on Lars&apos;s suggestion. This is basic patch. If its ok then I will refine more and add some test cases also. &lt;br/&gt;
Please review and provide any suggestions/comments.&lt;/p&gt;</comment>
                            <comment id="13574779" author="lhofhansl" created="Fri, 8 Feb 2013 20:13:09 +0000"  >&lt;p&gt;Hmm... That works too. What I had in mind is that instead of exposing a force flag, we can detect whether this condition happened and act accordingly when enable is executed again.&lt;/p&gt;

&lt;p&gt;Now, that would only work if the &quot;acting accordingly&quot; is free of side effects. If forcing a table online is nothing we want to do lightly then it should be exposed explicitly.&lt;/p&gt;</comment>
                            <comment id="13574800" author="hadoopqa" created="Fri, 8 Feb 2013 20:39:47 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12568619/HBASE-6469.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12568619/HBASE-6469.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.constraint.TestConstraint&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4385//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13575139" author="ram_krish" created="Sat, 9 Feb 2013 11:00:15 +0000"  >&lt;p&gt;@Rajesh babu&lt;br/&gt;
I am not sure how this will work.  Because if there is some problem with the State transitions of the regions then we need to first clear it out and then enable/disable the table.&lt;br/&gt;
I remember something related to this was done as part of HBCK. Let me try out the patch if i have some time.&lt;br/&gt;
So once we say HBCK -fixAssignments, then we need to see if the region assignment is done and then forcefully enable/disable the table state.&lt;br/&gt;
Another way could be forcefully provide an API to disable/enable the table based on region states and if needed correct them too.&lt;/p&gt;</comment>
                            <comment id="13575174" author="rajesh23" created="Sat, 9 Feb 2013 14:18:06 +0000"  >&lt;p&gt;@Ram,&lt;br/&gt;
How the patch works is :&lt;br/&gt;
1) TableStateUpdater Chore thread will keep observes any table in partial state(wakeup for every two minutes- we can configure this).&lt;br/&gt;
2) If enable/disable of a table fails it will be added to partial state tables map in TableStateUpdater. &lt;br/&gt;
3) In case of ENABLING table it will check whether all regions of the table are online or not.&lt;br/&gt;
If online then table state will be changed to ENABLED.&lt;br/&gt;
4) In case of DISABLING table it will check whether all regions of the table are offline or not.&lt;br/&gt;
if offline then table state will be changed to DISABLED.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So once we say HBCK -fixAssignments, then we need to see if the region assignment is done and then forcefully enable/disable the table state.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If some problems in assignment/unassignment HBCK -fixAssignments can fix it but user need to call forceful enable/disable again.But with this patch  table state will be updated automatically once online regions count of a table reaches expected region count in the map(expected region count is  number of regions in case of ENABLE and 0 in case of DISABLE)&lt;/p&gt;

&lt;p&gt;Any problem you see in this approach Ram?&lt;/p&gt;</comment>
                            <comment id="13584107" author="ram_krish" created="Fri, 22 Feb 2013 09:11:43 +0000"  >&lt;p&gt;Understood the patch now.  &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;LOG.error(&quot;Error trying to enable the table &quot; + tableEntry.getKey(), e);&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Change the error msg.&lt;br/&gt;
Should there be sync mechanism between the place where we remove the tableEntry and the place where we add it in Enable/DisableTable handler?&lt;/p&gt;</comment>
                            <comment id="13584290" author="rajesh23" created="Fri, 22 Feb 2013 14:06:33 +0000"  >&lt;p&gt;@Ram, Thanks for review.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Change the error msg.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I will change.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Should there be sync mechanism between the place where we remove the tableEntry and the place where we add it in Enable/DisableTable handler?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Its needed. I will prepare new patch with some test cases also. &lt;/p&gt;
</comment>
                            <comment id="13584743" author="yuzhihong@gmail.com" created="Fri, 22 Feb 2013 21:55:09 +0000"  >&lt;p&gt;Overall, looks quite good.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class TableStateUpdater &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Chore {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This class is internal to AssignmentManager and can be declared private.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void chore() {
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!tablesInPartialState.isEmpty()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If you write the condition differently, you should be able to save some indentation.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (KeeperException e) {
+              LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Error trying to enable the table &quot;&lt;/span&gt; + tableEntry.getKey(), e);
+            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;With the current position of the catch block, you need some flag so that &apos;enable&apos; and &apos;disable&apos; can be selected in the log.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tableEntry.getValue() == regionStates.getRegionsOfTable(
+              Bytes.toBytes(tableEntry.getKey())).size()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is it possible that region count gets bigger than tableEntry.getValue() ? If not, add PreCondition ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; tablesInPartialState = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TreeMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;nit: if you use byte[] as key (with proper comparator), you can save the Bytes.toBytes() call.&lt;/p&gt;</comment>
                            <comment id="13585895" author="rajesh23" created="Mon, 25 Feb 2013 14:50:40 +0000"  >&lt;p&gt;Patch addressing Ted&apos;s and Ram&apos;s comments.&lt;/p&gt;

&lt;p&gt;@Ted,@Ram&lt;br/&gt;
Please review. Is it ok?&lt;/p&gt;</comment>
                            <comment id="13585941" author="ram_krish" created="Mon, 25 Feb 2013 15:50:46 +0000"  >&lt;p&gt;@Rajesh&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Enable/disable the tables again if something wrong happened in the middle&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Improve the comments for this class. &lt;br/&gt;
Saw some formatting related issues.  Will go thro once again tomorrow and let you know.&lt;/p&gt;</comment>
                            <comment id="13585950" author="hadoopqa" created="Mon, 25 Feb 2013 16:01:52 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12570795/HBASE-6469_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12570795/HBASE-6469_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4527//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13586165" author="rajesh23" created="Mon, 25 Feb 2013 19:14:35 +0000"  >&lt;p&gt;Patch addressing Ram&apos;s comments.&lt;/p&gt;</comment>
                            <comment id="13586276" author="hadoopqa" created="Mon, 25 Feb 2013 21:00:26 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12570843/HBASE-6469_3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12570843/HBASE-6469_3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4535//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13586523" author="lhofhansl" created="Tue, 26 Feb 2013 00:33:54 +0000"  >&lt;p&gt;I am not sure I like this approach.&lt;br/&gt;
The problem here is that the ZK state is either stuck in ENABLING or DISABLING. A background thread checking on this does not seem to be that useful.&lt;br/&gt;
If a background can continue the transaction, why can&apos;t another (user initiated) attempt to either enable or disable the table?&lt;/p&gt;

&lt;p&gt;The expectation here is that a user won&apos;t care what care what state the table is currently in. If a disable is triggered the result should be a disabled table (and similar for an enable).&lt;/p&gt;

&lt;p&gt;Can we just make so that we allow transitioning from ENABLING to both ENABLED or DISABLED and from DISABLING to both ENABLED or DISABLED?&lt;/p&gt;</comment>
                            <comment id="13586771" author="lhofhansl" created="Tue, 26 Feb 2013 05:04:13 +0000"  >&lt;p&gt;Moving to 0.94.7.&lt;/p&gt;</comment>
                            <comment id="13586855" author="rajesh23" created="Tue, 26 Feb 2013 06:38:25 +0000"  >
&lt;p&gt;@Lars,&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;If a background can continue the transaction, why can&apos;t another (user initiated) attempt to either enable or disable the table?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Multiple calls of enable/disable may cause inconsistencies.&lt;br/&gt;
Here is the comment from EnableTableHandler/DisableTableHandler constructor.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-comment&quot;&gt;// There could be multiple client requests trying to disable or enable
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// the table at the same time. Ensure only the first request is honored
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// After that, no other requests can be accepted until the table reaches
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// DISABLED or ENABLED.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;&lt;p&gt;The expectation here is that a user won&apos;t care what care what state the table is currently in. If a disable is triggered the result should be a disabled table (and similar for an enable).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I agree but user need to know about the current state of assignments/unassignments(as of now) before calling force enable/disable. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can we just make so that we allow transitioning from ENABLING to both ENABLED or DISABLED and from DISABLING to both ENABLED or DISABLED?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If we transition from ENABLING to DISABLED then the regions which are in transtion or yet to start assignment wont be assigned. Some times even assigned regions will be unassigned. &lt;br/&gt;
Below are the some code snippets which are used to handle inconsistencies with disable and balance race.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void assign(RegionState state,
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; setOfflineInZK, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; forceNewPlan) {
      ....
	  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isDisabledorDisablingRegionInRIT(region)) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
          }
      ...
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;After completion of rit transition we will check once more that table is disabling or disabled&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
                &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; disabled = getZKTable().isDisablingOrDisabledTable(
                  regionInfo.getTableNameAsString());
                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!serverManager.isServerOnline(serverName) &amp;amp;&amp;amp; !disabled) {
                  LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Opened region &quot;&lt;/span&gt; + regionNameStr
                    + &lt;span class=&quot;code-quote&quot;&gt;&quot;but the region server is offline, reassign the region&quot;&lt;/span&gt;);
                  assign(regionInfo, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
                } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (disabled) {
                  &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; server is offline, no hurt to unassign again
&lt;/span&gt;                  LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Opened region &quot;&lt;/span&gt; + regionNameStr
                    + &lt;span class=&quot;code-quote&quot;&gt;&quot;but &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; table is disabled, triggering close of region&quot;&lt;/span&gt;);
                  unassign(regionInfo);
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;During master restart we will skip regions assignment of disabling/disabled tables(This case is if master restarted after transition). &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; disabledOrDisablingOrEnabling = ZKTable.getDisabledOrDisablingTables(watcher);
    disabledOrDisablingOrEnabling.addAll(ZKTable.getEnablingTables(watcher));
    &lt;span class=&quot;code-comment&quot;&gt;// Scan META &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; all user regions, skipping any disabled tables
&lt;/span&gt;    Map&amp;lt;HRegionInfo, ServerName&amp;gt; allRegions = MetaReader.fullScan(
      catalogTracker, disabledOrDisablingOrEnabling, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Exactly reverse(assign instead of unassign) will happen if we transition from DISABLING to ENABLED. &lt;br/&gt;
code snippet from ClosedRegionHandler.process()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.assignmentManager.getZKTable().
        isDisablingOrDisabledTable(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regionInfo.getTableNameAsString())) {
      assignmentManager.offlineDisabledRegion(regionInfo);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
    &lt;span class=&quot;code-comment&quot;&gt;// ZK Node is in CLOSED state, assign it.
&lt;/span&gt;    assignmentManager.getRegionStates().updateRegionState(
      regionInfo, RegionState.State.CLOSED, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
    &lt;span class=&quot;code-comment&quot;&gt;// This below has to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; w/ online enable/disable of a table
&lt;/span&gt;    assignmentManager.removeClosedRegion(regionInfo);
    assignmentManager.assign(regionInfo, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please correct me if I am wrong. Thanks Lars.&lt;/p&gt;</comment>
                            <comment id="13587336" author="rajesh23" created="Tue, 26 Feb 2013 18:18:19 +0000"  >&lt;p&gt;adding wait mechanism in TableStateUpdater if no failures in enable/disable.&lt;/p&gt;</comment>
                            <comment id="13597107" author="ram_krish" created="Fri, 8 Mar 2013 13:14:06 +0000"  >&lt;p&gt;I have similar concern as Lars has.  Infact if you see latest changes N and others are trying to remove this timing mechanisms.  So introducing such a thing will not welcomed.&lt;br/&gt;
Lets see what others say and check this out.&lt;/p&gt;</comment>
                            <comment id="13618231" author="lhofhansl" created="Sun, 31 Mar 2013 04:06:22 +0000"  >&lt;p&gt;What is it that restarting the Master does that fixes the problem? Can we do the same when we have another attempt at {en|dis}abling the table?&lt;/p&gt;</comment>
                            <comment id="13618450" author="rajesh23" created="Sun, 31 Mar 2013 19:33:35 +0000"  >&lt;p&gt;We can handle re attempts of enable/disable with with small changes while preparing EnableTableHandler/DisableTableHandler as in patch. Just for an idea uploading it. &lt;/p&gt;

&lt;p&gt;Exceptions used in the patch may not. People may not accept this idea also. &lt;/p&gt;

&lt;p&gt;One more idea is retry internally in EnableTableHandler until all regions become online even in failures or timeouts then set ENABLED(Samething happening in DisableTableHandler. It will retry until all regions become offline and then set to table state to DISABLED).&lt;/p&gt;</comment>
                            <comment id="13618465" author="hadoopqa" created="Sun, 31 Mar 2013 20:45:30 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12576298/HBASE-6469_retry_enable_or_disable.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12576298/HBASE-6469_retry_enable_or_disable.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.snapshot.TestRestoreFlushSnapshotFromClient&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestMasterObserver&lt;br/&gt;
                  org.apache.hadoop.hbase.util.TestMergeTable&lt;br/&gt;
                  org.apache.hadoop.hbase.util.TestHBaseFsck&lt;br/&gt;
                  org.apache.hadoop.hbase.procedure.TestZKProcedure&lt;br/&gt;
                  org.apache.hadoop.hbase.backup.TestHFileArchiving&lt;br/&gt;
                  org.apache.hadoop.hbase.master.handler.TestTableDeleteFamilyHandler&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestAdmin&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestCloneSnapshotFromClient&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestSnapshotMetadata&lt;br/&gt;
                  org.apache.hadoop.hbase.master.cleaner.TestSnapshotFromMaster&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestSnapshotCloneIndependence&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestRestoreSnapshotFromClient&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestDistributedLogSplitting&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestSnapshotFromClient&lt;br/&gt;
                  org.apache.hadoop.hbase.snapshot.TestExportSnapshot&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5075//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13618558" author="jxiang" created="Mon, 1 Apr 2013 02:02:44 +0000"  >&lt;p&gt;I think it is because the ZKTable states are cached.  Otherwise, we can manually reset the table state in ZK, then retry will be able to move on.&lt;/p&gt;

&lt;p&gt;If there is a feature to poke the cache, it will be great, so we don&apos;t have to restart the master.  I just filed &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8233&quot; title=&quot;Poke the ZKTable cache and let the system reload cached information&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8233&quot;&gt;HBASE-8233&lt;/a&gt;, which should be helpful in this case.&lt;/p&gt;</comment>
                            <comment id="13618975" author="rajesh23" created="Mon, 1 Apr 2013 17:55:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I think it is because the ZKTable states are cached. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Here even zktable states are cached still they are same as znode states in zk. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;we can manually reset the table state in ZK, then retry will be able to move on.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can you give more details how we can do this? How &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8233&quot; title=&quot;Poke the ZKTable cache and let the system reload cached information&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8233&quot;&gt;HBASE-8233&lt;/a&gt; really solves this problem? &lt;/p&gt;</comment>
                            <comment id="13618980" author="jxiang" created="Mon, 1 Apr 2013 18:01:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh23&quot; class=&quot;user-hover&quot; rel=&quot;rajesh23&quot;&gt;rajeshbabu&lt;/a&gt;, if we manually change the znode state in zk from zkcli, will the zktable state be updated?  Do we have a watcher on that znode?  If so, we can manually set the table to be disabled/enabled, then from hbase shell to retry enable/disable the table. Will this work?&lt;/p&gt;</comment>
                            <comment id="13619011" author="rajesh23" created="Mon, 1 Apr 2013 18:25:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; We dont have watcher on these znodes. May be we can do this but it will be little risky and difficult I feel.&lt;/p&gt;</comment>
                            <comment id="13619027" author="jxiang" created="Mon, 1 Apr 2013 18:38:39 +0000"  >&lt;p&gt;I agree. I think it is not needed.  That&apos;s why I suggested &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8233&quot; title=&quot;Poke the ZKTable cache and let the system reload cached information&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8233&quot;&gt;HBASE-8233&lt;/a&gt;, which may be useful in other scenarios too.&lt;/p&gt;</comment>
                            <comment id="13619039" author="rajesh23" created="Mon, 1 Apr 2013 18:46:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;That&apos;s why I suggested &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8233&quot; title=&quot;Poke the ZKTable cache and let the system reload cached information&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8233&quot;&gt;HBASE-8233&lt;/a&gt;, which may be useful in other scenarios too.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;But I didnt see any state mismatch with cache and znodes(in that case &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8233&quot; title=&quot;Poke the ZKTable cache and let the system reload cached information&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8233&quot;&gt;HBASE-8233&lt;/a&gt; may solve). May be I understood wrongly.&lt;/p&gt;</comment>
                            <comment id="13629488" author="lhofhansl" created="Thu, 11 Apr 2013 22:30:17 +0000"  >&lt;p&gt;Let me move this to 0.94.8&lt;/p&gt;</comment>
                            <comment id="13661749" author="lhofhansl" created="Mon, 20 May 2013 03:30:31 +0000"  >&lt;p&gt;Anybody still working on this one?&lt;/p&gt;</comment>
                            <comment id="13690813" author="lhofhansl" created="Fri, 21 Jun 2013 22:17:23 +0000"  >&lt;p&gt;No activity for a while. Removing from 0.94.&lt;/p&gt;</comment>
                            <comment id="13737207" author="stack" created="Mon, 12 Aug 2013 18:44:50 +0000"  >&lt;p&gt;Moving out.  Not being worked on.&lt;/p&gt;</comment>
                            <comment id="13752807" author="stack" created="Wed, 28 Aug 2013 20:23:04 +0000"  >&lt;p&gt;Moving out.  Still being worked on.&lt;/p&gt;</comment>
                            <comment id="14031151" author="mantonov" created="Fri, 13 Jun 2014 20:53:34 +0000"  >&lt;p&gt;Is that still critical and still in progress?&lt;/p&gt;

&lt;p&gt;I guess if &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7767&quot; title=&quot;Get rid of ZKTable, and table enable/disable state in ZK &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7767&quot;&gt;&lt;del&gt;HBASE-7767&lt;/del&gt;&lt;/a&gt; is done, this one would not be an issue.&lt;/p&gt;</comment>
                            <comment id="14134283" author="octo47" created="Mon, 15 Sep 2014 18:38:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7767&quot; title=&quot;Get rid of ZKTable, and table enable/disable state in ZK &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7767&quot;&gt;&lt;del&gt;HBASE-7767&lt;/del&gt;&lt;/a&gt; done, do we still need this?&lt;/p&gt;</comment>
                            <comment id="14134401" author="stack" created="Mon, 15 Sep 2014 20:07:33 +0000"  >&lt;p&gt;Resolving as no longer valid.  Master branch is &apos;different&apos; now &amp;#8211; no zk &amp;#8211; and branch-1 will likely get same change.  Reopen if fix for 0.94-0.98.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12600927">HBASE-6484</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12640025">HBASE-8233</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12560693" name="6469-expose-force-r3.patch" size="78725" author="ndimiduk" created="Thu, 13 Dec 2012 01:17:03 +0000"/>
                            <attachment id="12568619" name="HBASE-6469.patch" size="5199" author="rajesh23" created="Fri, 8 Feb 2013 19:32:55 +0000"/>
                            <attachment id="12570795" name="HBASE-6469_2.patch" size="10437" author="rajesh23" created="Mon, 25 Feb 2013 14:50:40 +0000"/>
                            <attachment id="12570843" name="HBASE-6469_3.patch" size="10540" author="rajesh23" created="Mon, 25 Feb 2013 19:14:35 +0000"/>
                            <attachment id="12571013" name="HBASE-6469_4.patch" size="11049" author="rajesh23" created="Tue, 26 Feb 2013 18:18:19 +0000"/>
                            <attachment id="12576298" name="HBASE-6469_retry_enable_or_disable.patch" size="14059" author="rajesh23" created="Sun, 31 Mar 2013 19:33:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 23 Aug 2012 09:24:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241827</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 13 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02dyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11862</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Introduces new &amp;#39;force&amp;#39; option for enabling and disabling tables. Allows an advanced user to impose a change on table status, ie, such as after running hbck.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>