<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:34:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6153/HBASE-6153.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6153] RS aborted due to rename problem (maybe a race)</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6153</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I had a RS crash with the following:&lt;/p&gt;

&lt;p&gt;2012-05-31 18:34:42,534 DEBUG org.apache.hadoop.hbase.regionserver.Store: Renaming flushed file at hdfs://ip-10-140-14-134.ec2.internal:8020/apps/hbase/data/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/.tmp/294a7a31f04949b8bf07682a43157b35 to hdfs://ip-10-140-14-134.ec2.internal:8020/apps/hbase/data/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/f1/294a7a31f04949b8bf07682a43157b35&lt;br/&gt;
2012-05-31 18:34:42,536 WARN org.apache.hadoop.hbase.regionserver.Store: Unable to rename hdfs://ip-10-140-14-134.ec2.internal:8020/apps/hbase/data/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/.tmp/294a7a31f04949b8bf07682a43157b35 to hdfs://ip-10-140-14-134.ec2.internal:8020/apps/hbase/data/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/f1/294a7a31f04949b8bf07682a43157b35&lt;br/&gt;
2012-05-31 18:34:42,541 FATAL org.apache.hadoop.hbase.regionserver.HRegionServer: ABORTING region server ip-10-68-7-146.ec2.internal,60020,1338343120038: Replay of HLog required. Forcing server shutdown&lt;br/&gt;
org.apache.hadoop.hbase.DroppedSnapshotException: region: TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d.&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1288)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1172)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:1114)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MemStoreFlusher.flushRegion(MemStoreFlusher.java:400)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MemStoreFlusher.flushRegion(MemStoreFlusher.java:374)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.MemStoreFlusher.run(MemStoreFlusher.java:243)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:662)&lt;br/&gt;
Caused by: java.io.FileNotFoundException: File does not exist: /apps/hbase/data/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/f1/294a7a31f04949b8bf07682a43157b35&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.openInfo(DFSClient.java:1901)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.&amp;lt;init&amp;gt;(DFSClient.java:1892)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DFSClient.open(DFSClient.java:636)&lt;br/&gt;
        at org.apache.hadoop.hdfs.DistributedFileSystem.open(DistributedFileSystem.java:154)&lt;br/&gt;
        at org.apache.hadoop.fs.FileSystem.open(FileSystem.java:427)&lt;br/&gt;
        at org.apache.hadoop.hbase.io.hfile.HFile.createReader(HFile.java:387)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.StoreFile$Reader.&amp;lt;init&amp;gt;(StoreFile.java:1008)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.StoreFile.open(StoreFile.java:470)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.StoreFile.createReader(StoreFile.java:548)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.Store.internalFlushCache(Store.java:595)&lt;/p&gt;


&lt;p&gt;On the NameNode logs:&lt;br/&gt;
2012-05-31 18:34:42,588 WARN org.apache.hadoop.hdfs.StateChange: DIR* FSDirectory.unprotectedRenameTo: failed to rename /apps/hbase/data/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/.tmp/294a7a31f04949b8bf07682a43157b35 to /apps/hbase/data/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/f1/294a7a31f04949b8bf07682a43157b35 because destination&apos;s parent does not exist&lt;/p&gt;


&lt;p&gt;I haven&apos;t looked deeply yet but I guess it is a race of some sort.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12559031">HBASE-6153</key>
            <summary>RS aborted due to rename problem (maybe a race)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="devaraj">Devaraj Das</reporter>
                        <labels>
                    </labels>
                <created>Sat, 2 Jun 2012 01:06:50 +0000</created>
                <updated>Wed, 22 Apr 2015 00:47:57 +0000</updated>
                            <resolved>Wed, 22 Apr 2015 00:47:57 +0000</resolved>
                                    <version>0.92.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13288992" author="devaraj" created="Mon, 4 Jun 2012 23:39:07 +0000"  >&lt;p&gt;From the analysis of the logs, it seems like this happened because the table in question was deleted (and the associated FS data was deleted too). For some reason, the RS wasn&apos;t fully aware of it and tried to use the deleted directory as the destination for the rename and failed.&lt;/p&gt;</comment>
                            <comment id="13288997" author="stack" created="Mon, 4 Jun 2012 23:44:22 +0000"  >&lt;p&gt;You disabled the table first (disabling closes out all table regions on cluster) before you dropped it?  Maybe this region wasn&apos;t disabled?&lt;/p&gt;</comment>
                            <comment id="13289003" author="devaraj" created="Mon, 4 Jun 2012 23:58:27 +0000"  >&lt;p&gt;I&apos;d have just disabled and dropped the table (from what I remember). I&apos;d expect that disabling the table would disable the regions too.. Isn&apos;t that the case? &lt;/p&gt;</comment>
                            <comment id="13289008" author="stack" created="Tue, 5 Jun 2012 00:03:16 +0000"  >&lt;p&gt;It is supposed to yes.  Maybe this region was doubly assigned so didn&apos;t get included in list of regions to disable (do you see other regions from the table being closed on this regionserver around this time?)&lt;/p&gt;

&lt;p&gt;St.Ack&lt;/p&gt;</comment>
                            <comment id="13289105" author="devaraj" created="Tue, 5 Jun 2012 03:01:36 +0000"  >&lt;p&gt;Yes, I do see from the master logs lots of line like these for the RegionServer in question:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-31 18:18:55,387 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_CLOSED, server=ip-10-68-7-146.ec2.internal,60020,1338343120038, region=853c3285c9e90e532a37fcf36e8dee27
2012-05-31 18:18:57,378 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_CLOSED, server=ip-10-68-7-146.ec2.internal,60020,1338343120038, region=f1742456972610dd1b47d69849135e90
2012-05-31 18:18:57,404 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_CLOSED, server=ip-10-68-7-146.ec2.internal,60020,1338343120038, region=801e6b62dd8bdbe1c0139b6d351af22d
2012-05-31 18:19:00,067 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_CLOSED, server=ip-10-68-7-146.ec2.internal,60020,1338343120038, region=f42aea93c92323de04925e8cab7d81b4
2012-05-31 18:19:01,968 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_CLOSED, server=ip-10-68-7-146.ec2.internal,60020,1338343120038, region=07c5db3cfb48cf644c2ac39687a40af2
2012-05-31 18:19:04,554 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_CLOSED, server=ip-10-68-7-146.ec2.internal,60020,1338343120038, region=a481cc63b07070ae4984d80f32a78c08
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but it doesn&apos;t have a line for the region 8974506aa04c5a04e5cc23c11de0039d .. &lt;/p&gt;

&lt;p&gt;This line is there:&lt;br/&gt;
2012-05-31 18:19:36,707 DEBUG org.apache.hadoop.hbase.master.handler.DeleteTableHandler: Deleting region TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d. from META and FS&lt;/p&gt;


&lt;p&gt;In the RegionServer logs, I do see lines like this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-31 18:18:57,205 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Updates disabled for region TestLoadAndVerify_1338488017181,\x81\xA5\x01\x00\x00\x00\x00\x00/000074_0,1338491056480.f1742456972610dd1b47d69849135e90.
2012-05-31 18:18:57,205 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Finished snapshotting TestLoadAndVerify_1338488017181,\x7F\xFF\xFF\xFF\xFF\xFF\xFF\xEE,1338491056480.801e6b62dd8bdbe1c0139b6d351af22d., commencing wait for mvcc, flushsize=7439360
2012-05-31 18:18:57,215 DEBUG org.apache.hadoop.hbase.io.hfile.HFileWriterV2: Initialized with CacheConfig:enabled [cacheDataOnRead=true] [cacheDataOnWrite=false] [cacheIndexesOnWrite=false] [cacheBloomsOnWrite=false] [cacheEvictOnClose=false] [cacheCompressed=false]
2012-05-31 18:18:57,218 DEBUG org.apache.hadoop.hbase.regionserver.Store: closed f1
2012-05-31 18:18:57,218 INFO org.apache.hadoop.hbase.regionserver.HRegion: Closed TestLoadAndVerify_1338488017181,\x81\xA5\x01\x00\x00\x00\x00\x00/000074_0,1338491056480.f1742456972610dd1b47d69849135e90.
2012-05-31 18:18:57,218 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:60020-0x3379b7614800004-0x3379b7614800004-0x3379b7614800004 Attempting to transition node f1742456972610dd1b47d69849135e90 from M_ZK_REGION_CLOSING to RS_ZK_REGION_CLOSED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Compaction started and failed:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-31 18:25:20,968 DEBUG org.apache.hadoop.hbase.regionserver.CompactSplitThread: Small Compaction requested: regionName=TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d., storeName=f1, fileCount=5, fileSize=182.6m (43.0m, 45.5m, 31.4m, 31.4m, 31.4m), priority=0, time=161781718961048; Because: regionserver60020.compactionChecker requests compaction; compaction_queue=(2:2), split_queue=433
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-31 18:25:33,383 ERROR org.apache.hadoop.hbase.regionserver.compactions.CompactionRequest: Compaction failed regionName=TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d., storeName=f1, fileCount=5, fileSize=182.6m (43.0m, 45.5m, 31.4m, 31.4m, 31.4m), priority=0, time=161781718961048
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Some more logs related to the region 8974506aa04c5a04e5cc23c11de0039d before the failure to rename&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-31 18:34:18,157 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: Too many hlogs: logs=33, maxlogs=32; forcing flush of 2 regions(s): 51c11f4eafdb5b5f0ff11ca998a07b43, 8974506aa04c5a04e5cc23c11de0039d
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-31 18:34:40,268 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Started memstore flush for TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d., current region memstore size 58.2m
2012-05-31 18:34:40,331 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Finished snapshotting TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d., commencing wait for mvcc, flushsize=61056152
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13289126" author="stack" created="Tue, 5 Jun 2012 03:58:46 +0000"  >&lt;p&gt;Can you back up further and figure how that region got assigned?  Did master think it closed it at an earlier time?  Looks like double-assign.  This was the region that was overshadowed.  The shadowing region probably got closed properly as part of table disable and delete; it probably removed the files the above crash regionserver was referencing (guessing).&lt;/p&gt;</comment>
                            <comment id="13289227" author="devaraj" created="Tue, 5 Jun 2012 08:04:29 +0000"  >&lt;p&gt;Seems like the problem is a side-effect of the issue reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6152&quot; title=&quot;Split abort is not handled properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6152&quot;&gt;&lt;del&gt;HBASE-6152&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Here is what I see in the master logs when I grep for the region 8974506aa04c5a04e5cc23c11de0039d :&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-31 18:19:36,707 DEBUG org.apache.hadoop.hbase.master.handler.DeleteTableHandler: Deleting region TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d. from META and FS
2012-05-31 18:19:36,709 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Deleted region TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d. from META
org.apache.hadoop.hbase.DroppedSnapshotException: region: TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d.
Caused by: java.io.FileNotFoundException: File does not exist: /apps/hbase/data/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/f1/294a7a31f04949b8bf07682a43157b35
2012-05-31 18:35:15,969 DEBUG org.apache.hadoop.hbase.regionserver.wal.HLogSplitter:  moved hdfs://ip-10-140-14-134.ec2.internal:8020/apps/hbase/data/splitlog/ip-10-190-174-211.ec2.internal,60020,1338419750242_hdfs%3A%2F%2Fip-10-140-14-134.ec2.internal%3A8020%2Fapps%2Fhbase%2Fdata%2F.logs%2Fip-10-68-7-146.ec2.internal%2C60020%2C1338343120038-splitting%2Fip-10-68-7-146.ec2.internal%252C60020%252C1338343120038.1338500685987/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/recovered.edits/0000000000017630961 =&amp;gt; hdfs://ip-10-140-14-134.ec2.internal:8020/apps/hbase/data/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/recovered.edits/0000000000017630961
2012-05-31 18:36:03,813 DEBUG org.apache.hadoop.hbase.regionserver.wal.HLogSplitter:  moved hdfs://ip-10-140-14-134.ec2.internal:8020/apps/hbase/data/splitlog/ip-10-190-38-165.ec2.internal,60020,1338343120042_hdfs%3A%2F%2Fip-10-140-14-134.ec2.internal%3A8020%2Fapps%2Fhbase%2Fdata%2F.logs%2Fip-10-68-7-146.ec2.internal%2C60020%2C1338343120038-splitting%2Fip-10-68-7-146.ec2.internal%252C60020%252C1338343120038.1338500629081/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/recovered.edits/0000000000017616838 =&amp;gt; hdfs://ip-10-140-14-134.ec2.internal:8020/apps/hbase/data/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/recovered.edits/0000000000017616838
2012-05-31 18:36:05,426 DEBUG org.apache.hadoop.hbase.regionserver.wal.HLogSplitter:  moved hdfs://ip-10-140-14-134.ec2.internal:8020/apps/hbase/data/splitlog/ip-10-190-174-211.ec2.internal,60020,1338419750242_hdfs%3A%2F%2Fip-10-140-14-134.ec2.internal%3A8020%2Fapps%2Fhbase%2Fdata%2F.logs%2Fip-10-68-7-146.ec2.internal%2C60020%2C1338343120038-splitting%2Fip-10-68-7-146.ec2.internal%252C60020%252C1338343120038.1338500749335/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/recovered.edits/0000000000017645273 =&amp;gt; hdfs://ip-10-140-14-134.ec2.internal:8020/apps/hbase/data/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/recovered.edits/0000000000017645273
2012-05-31 18:36:57,930 DEBUG org.apache.hadoop.hbase.regionserver.wal.HLogSplitter:  moved hdfs://ip-10-140-14-134.ec2.internal:8020/apps/hbase/data/splitlog/ip-10-190-174-211.ec2.internal,60020,1338419750242_hdfs%3A%2F%2Fip-10-140-14-134.ec2.internal%3A8020%2Fapps%2Fhbase%2Fdata%2F.logs%2Fip-10-68-7-146.ec2.internal%2C60020%2C1338343120038-splitting%2Fip-10-68-7-146.ec2.internal%252C60020%252C1338343120038.1338500559421/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/recovered.edits/0000000000017604560 =&amp;gt; hdfs://ip-10-140-14-134.ec2.internal:8020/apps/hbase/data/TestLoadAndVerify_1338488017181/8974506aa04c5a04e5cc23c11de0039d/recovered.edits/0000000000017604560
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When I poked at the regionserver logs where this region was hosted, at around the time the region was created, I saw:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-31 15:09:24,569 INFO org.apache.hadoop.hbase.regionserver.SplitTransaction: Starting split of region TestLoadAndVerify_1338488017181,\x145\xE5\x0DyC^N,1338489404005.106faef9e54a59c1c2b931d1fc36bdbe.
2012-05-31 15:09:24,569 DEBUG org.apache.hadoop.hbase.regionserver.SplitTransaction: regionserver:60020-0x3379b7614800004-0x3379b7614800004 Creating ephemeral node for 106faef9e54a59c1c2b931d1fc36bdbe in SPLITTING state
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and these:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-31 15:09:32,036 INFO org.apache.hadoop.hbase.regionserver.HRegion: Setting up tabledescriptor config now ...
2012-05-31 15:09:32,037 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Instantiated TestLoadAndVerify_1338488017181,\x145\xE5\x0DyC^N,1338491364569.51c11f4eafdb5b5f0ff11ca998a07b43.
2012-05-31 15:09:32,281 INFO org.apache.hadoop.hbase.regionserver.HRegion: Setting up tabledescriptor config now ...
2012-05-31 15:09:32,281 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Instantiated TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d.
2012-05-31 15:09:32,302 DEBUG org.apache.hadoop.hbase.io.hfile.HFileWriterV2: Initialized with CacheConfig:enabled [cacheDataOnRead=true] [cacheDataOnWrite=false] [cacheIndexesOnWrite=false] [cacheBloomsOnWrite=false] [cacheEvictOnClose=false] [cacheCompressed=false]
2012-05-31 15:09:32,423 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Offlined parent region TestLoadAndVerify_1338488017181,\x145\xE5\x0DyC^N,1338489404005.106faef9e54a59c1c2b931d1fc36bdbe. in META
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At some later point, some more logs in the regionserver related to the region 8974506aa04c5a04e5cc23c11de0039d:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-31 15:09:35,423 INFO org.apache.hadoop.hbase.regionserver.HRegion: Onlined TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d.; next sequenceid=14606548
2012-05-31 15:09:35,423 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Post open deploy tasks for region=TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d., daughter=true
2012-05-31 15:09:35,426 DEBUG org.apache.hadoop.hbase.regionserver.CompactSplitThread: Large Compaction requested: regionName=TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d., storeName=f1, fileCount=4, fileSize=1.1g (1.0g, 55.9m, 18.5m, 1.2m), priority=3, time=150035421657389; Because: Opening Region; compaction_queue=(13:0), split_queue=0
2012-05-31 15:09:35,555 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Added daughter TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d., serverName=ip-10-68-7-146.ec2.internal,60020,1338343120038
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;b&gt;However, a previous split attempt on the region 106faef9e54a59c1c2b931d1fc36bdbe had failed&lt;/b&gt;, and due to the issue reported in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6152&quot; title=&quot;Split abort is not handled properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6152&quot;&gt;&lt;del&gt;HBASE-6152&lt;/del&gt;&lt;/a&gt;, the master was not able to do anything about the split (and the following log lines went on and on and on at the master):&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-31 15:11:23,537 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_SPLIT, server=ip-10-68-7-146.ec2.internal,60020,1338343120038, region=106faef9e54a59c1c2b931d1fc36bdbe
2012-05-31 15:11:23,537 WARN org.apache.hadoop.hbase.master.AssignmentManager: Region 106faef9e54a59c1c2b931d1fc36bdbe not found on server ip-10-68-7-146.ec2.internal,60020,1338343120038; failed processing
2012-05-31 15:11:23,537 WARN org.apache.hadoop.hbase.master.AssignmentManager: Received SPLIT for region 106faef9e54a59c1c2b931d1fc36bdbe from server ip-10-68-7-146.ec2.internal,60020,1338343120038 but it doesn&apos;t exist anymore, probably already processed its split
2012-05-31 15:11:23,649 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_SPLIT, server=ip-10-68-7-146.ec2.internal,60020,1338343120038, region=106faef9e54a59c1c2b931d1fc36bdbe
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So I am tending to think that this anomaly threw the master off and it couldn&apos;t do a proper disabling for the daughter region 8974506aa04c5a04e5cc23c11de0039d..&lt;/p&gt;</comment>
                            <comment id="13289542" author="devaraj" created="Tue, 5 Jun 2012 17:15:39 +0000"  >&lt;p&gt;I am mostly sure that because the master couldn&apos;t record the split event successfully for the parent region 106faef9e54a59c1c2b931d1fc36bdbe, it didn&apos;t know about the daughter 8974506aa04c5a04e5cc23c11de0039d, and hence no master action was taken on the daughter when the table was dropped.. &lt;/p&gt;

&lt;p&gt;The fix in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6070&quot; title=&quot;AM.nodeDeleted and SSH races creating problems for regions under SPLIT&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6070&quot;&gt;&lt;del&gt;HBASE-6070&lt;/del&gt;&lt;/a&gt; should address this particular issue of master not noticing split events.&lt;/p&gt;

&lt;p&gt;Let me know if the analysis sounds right. We can resolve this issue, if so.&lt;/p&gt;</comment>
                            <comment id="13290367" author="zhihyu@ebaysf.com" created="Wed, 6 Jun 2012 20:21:34 +0000"  >&lt;p&gt;ip-10-68-7-146.ec2.internal went down:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-05-31 18:34:42,541 FATAL org.apache.hadoop.hbase.regionserver.HRegionServer: ABORTING region server ip-10-68-7-146.ec2.internal,60020,1338343120038: Replay of HLog required. Forcing server shutdown
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above lagged the other log snippets by 3 hours.&lt;br/&gt;
More log around 05-31 15:11 from ip-10-68-7-146.ec2.internal should help clarify.&lt;/p&gt;</comment>
                            <comment id="13290381" author="devaraj" created="Wed, 6 Jun 2012 20:49:09 +0000"  >&lt;p&gt;I think the issue happened because the split event for the region 106faef9e54a59c1c2b931d1fc36bdbe into two daughters 8974506aa04c5a04e5cc23c11de0039d and another was never recorded at the master. So when the table was dropped (around 18:19:36), no action was taken by the master on the new regions (and so the RS hosting the new regions didn&apos;t get this information on the new regions). However, the directory corresponding to the daughter region was deleted at the time of drop by the master.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-31 18:19:36,707 DEBUG org.apache.hadoop.hbase.master.handler.DeleteTableHandler: Deleting region TestLoadAndVerify_1338488017181,\x15\xD9\x01\x00\x00\x00\x00\x00/000087_0,1338491364569.8974506aa04c5a04e5cc23c11de0039d. from META and FS
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Later on, when the RS tried to flush the memstore corresponding to the region 8974506aa04c5a04e5cc23c11de0039d, it failed with the rename problem since the parent directory of the rename-destination didn&apos;t exist.&lt;/p&gt;</comment>
                            <comment id="14506142" author="apurtell" created="Wed, 22 Apr 2015 00:47:57 +0000"  >&lt;p&gt;Reopen if reproducible with currently shipping code&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 4 Jun 2012 23:44:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241794</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 34 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02d2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11719</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>