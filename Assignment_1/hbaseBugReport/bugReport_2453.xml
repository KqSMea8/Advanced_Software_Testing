<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:02:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2453/HBASE-2453.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2453] Revisit compaction policies after HBASE-2248 commit</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2453</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2248&quot; title=&quot;Provide new non-copy mechanism to assure atomic reads in get and scan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2248&quot;&gt;&lt;del&gt;HBASE-2248&lt;/del&gt;&lt;/a&gt; turned Gets into Scans server-side.  It also removed the invariant that deletes in a file only apply to other files and not itself (no longer processes MemStore deletes when the delete happens).  This has implications for our minor compaction policy.&lt;/p&gt;

&lt;p&gt;We are currently processing deletes during minor compactions in a way that makes it so we do the actual deleting as we compact, but we retain the delete records themselves.  This makes it so we retain the invariant of deletes only applying to other files.&lt;/p&gt;

&lt;p&gt;Since this is now gone post &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2248&quot; title=&quot;Provide new non-copy mechanism to assure atomic reads in get and scan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2248&quot;&gt;&lt;del&gt;HBASE-2248&lt;/del&gt;&lt;/a&gt;, we should revisit our compaction policies.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12462189">HBASE-2453</key>
            <summary>Revisit compaction policies after HBASE-2248 commit</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="streamy">Jonathan Gray</assignee>
                                    <reporter username="streamy">Jonathan Gray</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Apr 2010 21:20:44 +0000</created>
                <updated>Fri, 20 Nov 2015 12:41:54 +0000</updated>
                            <resolved>Fri, 16 Apr 2010 01:12:11 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12857548" author="streamy" created="Thu, 15 Apr 2010 21:27:00 +0000"  >&lt;p&gt;I think we should remove all delete processing from minor compactions in order to make minor compactions as fast as possible.  For me, that would suffice for closing this jira.&lt;/p&gt;

&lt;p&gt;Major compactions are another consideration.  As I described in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2450&quot; title=&quot;For single row reads of specific columns, seek to the first column in HFiles rather than start of row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2450&quot;&gt;&lt;del&gt;HBASE-2450&lt;/del&gt;&lt;/a&gt;, the fact that delete markers actually get removed during major compactions makes it so a background process impacts user-facing behavior.  This is because old delete records can impact new puts (if i put a value with an older timestamp than a row delete, for example).  Before the major it would not show up, after the major this put would be valid.&lt;/p&gt;

&lt;p&gt;One possibility is we change it so minors don&apos;t do anything, then majors do what minors do now (doing the actually deleting, but retaining the deletes themselves).  Only downside of that is that once you delete a row at a timestamp, you can never re-insert values older than that delete.  Today, this is the case &lt;em&gt;until&lt;/em&gt; there is a major compaction.  The way to fix this is by taking storefile age into account so that deletes in previous storefiles don&apos;t apply to newer storefiles.  If we did that, we would have to process deletes during regular compactions because you&apos;d need to look at the relative ages of the storefiles to determine if a particular delete applied or not.&lt;/p&gt;

&lt;p&gt;For now, I&apos;d be happy just removing delete tracking in minors and worrying about the rest of these issues for 0.21.&lt;/p&gt;</comment>
                            <comment id="12857555" author="streamy" created="Thu, 15 Apr 2010 21:42:00 +0000"  >&lt;p&gt;Patch removes delete tracking from minor compactions and updates the unit test.  Have not run against other tests, just a quick first go.&lt;/p&gt;</comment>
                            <comment id="12857634" author="stack" created="Fri, 16 Apr 2010 01:12:11 +0000"  >&lt;p&gt;Applied to 0.20.4 and 0.20.4 and trunk.  Made &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2454&quot; title=&quot;Revisit major compaction deletes after hbase-2248 (take storefile age into consideration)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2454&quot;&gt;&lt;del&gt;HBASE-2454&lt;/del&gt;&lt;/a&gt; for major compaction delete issue.  Thanks for patch Jon.&lt;/p&gt;</comment>
                            <comment id="12858030" author="kannanm" created="Fri, 16 Apr 2010 22:11:41 +0000"  >&lt;p&gt;Not totally convinced about this. If your workload is IO bound, processing the deletes more aggressively (i.e. during minor compactions) even if it meant some extra CPU might be good overall. &lt;/p&gt;

&lt;p&gt;Can we atleast make this a configurable option? We should do some numbers to see what the savings of not doing delete processing are.&lt;/p&gt;

</comment>
                            <comment id="12858046" author="streamy" created="Fri, 16 Apr 2010 22:49:20 +0000"  >&lt;p&gt;I agree that if you have an IO bound workload, and you have a significant number of deletes, then this may not be a win.  This seems this a fairly rare use case except for those applications which do a ton of deleting.  In those cases, you could always trigger majors.&lt;/p&gt;

&lt;p&gt;What we get by taking this out is not having to track deletes during minors (yes, we should measure this), retaining deleted records for sake of recovery/snapshotscanner type stuff, and (possibly) being able to do minor compactions against any storefiles (not just neighbors).&lt;/p&gt;

&lt;p&gt;Looking at the old minor and scan delete tracker code paths, it&apos;s not a ton of work in the case that there are no deletes, so I imagine it&apos;s not a big performance impact.  However once you take the delete tracking out, minors can actually be refactored to not keep track row by row as it still does even after this patch... Having to do row compares for every kv, plus the previous delete tracking, we could see some incremental boost from stripping down minors to the bare minimum.&lt;/p&gt;

&lt;p&gt;Let&apos;s keep the conversation going on these topics.&lt;/p&gt;

&lt;p&gt;Of note but not really that important, I believe the bigtable paper explicitly talks about deletes only being deleted during major compactions.&lt;/p&gt;</comment>
                            <comment id="12858073" author="stack" created="Sat, 17 Apr 2010 02:05:03 +0000"  >&lt;p&gt;Lets make a new issue to address the important performance considerations raised above.&lt;/p&gt;</comment>
                            <comment id="12858084" author="stack" created="Sat, 17 Apr 2010 03:22:01 +0000"  >&lt;p&gt;Does &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2462&quot; title=&quot;Review compaction heuristic and move compaction code out so standalone and independently testable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2462&quot;&gt;&lt;del&gt;HBASE-2462&lt;/del&gt;&lt;/a&gt; work as the issue for looking at performance doing deletes at minor compaction time?&lt;/p&gt;</comment>
                            <comment id="12858085" author="streamy" created="Sat, 17 Apr 2010 03:36:02 +0000"  >&lt;p&gt;+1, thanks stack let&apos;s move discussion there&lt;/p&gt;</comment>
                            <comment id="12866860" author="stack" created="Wed, 12 May 2010 23:52:37 +0000"  >&lt;p&gt;Marking these as fixed against 0.21.0 rather than against 0.20.5.&lt;/p&gt;</comment>
                            <comment id="15017104" author="lars_francke" created="Fri, 20 Nov 2015 12:41:54 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12462305">HBASE-2462</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12441879" name="ASF.LICENSE.NOT.GRANTED--HBASE-2453-v1.patch" size="4828" author="streamy" created="Thu, 15 Apr 2010 21:42:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 16 Apr 2010 01:12:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32594</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hhrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100141</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>