<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:20:32 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4613/HBASE-4613.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4613] hbase.util.Threads#threadDumpingIsAlive sleeps 1 second, slowing down the shutdown by 0.5s</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4613</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Current implementation is:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 
  /**
   * @param t Waits on the passed thread to die dumping a threaddump every
   * minute while its up.
   * @throws InterruptedException
   */
  public static void threadDumpingIsAlive(final Thread t)
  throws InterruptedException {
    if (t == null) {
      return;
    }
    long startTime = System.currentTimeMillis();
    while (t.isAlive()) {
      Thread.sleep(1000);
      if (System.currentTimeMillis() - startTime &amp;gt; 60000) {
        startTime = System.currentTimeMillis();
        ReflectionUtils.printThreadInfo(new PrintWriter(System.out),
            &quot;Automatic Stack Trace every 60 seconds waiting on &quot; +
            t.getName());
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 


&lt;p&gt;while this one would make more sense considering the documentation, and save around 0,5s when the MiniCluster shutdowns.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  public static void threadDumpingIsAlive(final Thread t)
    throws InterruptedException {
    if (t == null) {
      return;
    }

    while (t.isAlive()) {
      t.join(60 * 1000);
      if (t.isAlive()) {
        ReflectionUtils.printThreadInfo(new PrintWriter(System.out),
          &quot;Automatic Stack Trace every 60 seconds waiting on &quot; +
            t.getName());
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;However, it was replacing a previous implementation with a join without a timeout. So if anyone has a warning here...&lt;br/&gt;
Tests seems to be ok...&lt;/p&gt;</description>
                <environment>&lt;p&gt;all&lt;/p&gt;</environment>
        <key id="12527640">HBASE-4613</key>
            <summary>hbase.util.Threads#threadDumpingIsAlive sleeps 1 second, slowing down the shutdown by 0.5s</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkeywal">Nicolas Liochon</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Oct 2011 19:06:13 +0000</created>
                <updated>Fri, 20 Nov 2015 11:52:09 +0000</updated>
                            <resolved>Sat, 29 Oct 2011 22:02:20 +0000</resolved>
                                    <version>0.94.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13131897" author="stack" created="Thu, 20 Oct 2011 18:49:25 +0000"  >&lt;p&gt;I changed that because we had hanging tests.  This helps in that you get a bit of clue as to why the test won&apos;t go down.  What you want to do Nicolas?  Change the wait so we don&apos;t sleep so long?&lt;/p&gt;</comment>
                            <comment id="13131916" author="nkeywal" created="Thu, 20 Oct 2011 19:12:37 +0000"  >&lt;p&gt;The two implementations should be functionally equivalent, except if the issue comes from join vs. sleep. The code contained previously a join(), without timeout parameter, and has been replaced by a sleep.&lt;/p&gt;

&lt;p&gt;But t.join(60 * 1000) finishes when t is dead or after 60*1000 ms. So it&apos;s better (if it works &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; than 60 sleeps of 1s each because in average we will sleep 0.5 seconds after t&apos;s death. If you think the &quot;timeouted join&quot; is fine as well, I will publish the patch.&lt;/p&gt;</comment>
                            <comment id="13131922" author="stack" created="Thu, 20 Oct 2011 19:16:48 +0000"  >&lt;p&gt;Oh, sorry, I didn&apos;t see your change (though it was there right in front of my face).   join is better than sleep.  Please publish a patch.&lt;/p&gt;</comment>
                            <comment id="13131923" author="stack" created="Thu, 20 Oct 2011 19:16:49 +0000"  >&lt;p&gt;Oh, sorry, I didn&apos;t see your change (though it was there right in front of my face).   join is better than sleep.  Please publish a patch.&lt;/p&gt;</comment>
                            <comment id="13132095" author="nkeywal" created="Thu, 20 Oct 2011 21:59:15 +0000"  >&lt;p&gt;Tests result in a few hours.&lt;/p&gt;</comment>
                            <comment id="13139466" author="stack" created="Sat, 29 Oct 2011 22:02:20 +0000"  >&lt;p&gt;Committed trunk and 0.92 branch.  Thanks for the patch N.&lt;/p&gt;</comment>
                            <comment id="13139513" author="hudson" created="Sun, 30 Oct 2011 01:33:48 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2385 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2385/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2385/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4613&quot; title=&quot;hbase.util.Threads#threadDumpingIsAlive sleeps 1 second, slowing down the shutdown by 0.5s&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4613&quot;&gt;&lt;del&gt;HBASE-4613&lt;/del&gt;&lt;/a&gt; hbase.util.Threads#threadDumpingIsAlive sleeps 1 second, slowing down the shutdown by 0.5s&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/Threads.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13140829" author="hudson" created="Tue, 1 Nov 2011 02:07:59 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #90 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/90/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/90/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4613&quot; title=&quot;hbase.util.Threads#threadDumpingIsAlive sleeps 1 second, slowing down the shutdown by 0.5s&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4613&quot;&gt;&lt;del&gt;HBASE-4613&lt;/del&gt;&lt;/a&gt; hbase.util.Threads#threadDumpingIsAlive sleeps 1 second, slowing down the shutdown by 0.5s&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/util/Threads.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15015678" author="lars_francke" created="Fri, 20 Nov 2015 11:52:09 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12527439">HBASE-4602</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12499959" name="20111020_4613_Threads.patch" size="803" author="nkeywal" created="Thu, 20 Oct 2011 21:59:15 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 20 Oct 2011 18:49:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>88892</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hrjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101725</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>