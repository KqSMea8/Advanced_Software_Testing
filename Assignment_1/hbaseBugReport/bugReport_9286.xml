<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:03:04 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9286/HBASE-9286.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9286] [0.94] ageOfLastShippedOp replication metric doesn&apos;t update if the slave regionserver is stalled</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9286</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In replicationmanager&lt;br/&gt;
     HRegionInterface rrs = getRS();&lt;br/&gt;
        rrs.replicateLogEntries(Arrays.copyOf(this.entriesArray, currentNbEntries));&lt;br/&gt;
....&lt;br/&gt;
        this.metrics.setAgeOfLastShippedOp(&lt;br/&gt;
            this.entriesArray&lt;span class=&quot;error&quot;&gt;&amp;#91;currentNbEntries-1&amp;#93;&lt;/span&gt;.getKey().getWriteTime());&lt;br/&gt;
        break;&lt;/p&gt;

&lt;p&gt;which makes sense, but is wrong. The problem is that rrs.replicateLogEntries will block for a very long time if the slave server is suspended or unavailable but not down.&lt;/p&gt;

&lt;p&gt;However this is easy to fix. We just need to call       refreshAgeOfLastShippedOp();&lt;br/&gt;
on a regular basis, in a different thread. I&apos;ve attached a patch which fixed this for cdh4. I can make one for trunk and the like as well if you need me to do but it&apos;s a small change.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12664764">HBASE-9286</key>
            <summary>[0.94] ageOfLastShippedOp replication metric doesn&apos;t update if the slave regionserver is stalled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="posix4e">Alex Newman</assignee>
                                    <reporter username="posix4e">Alex Newman</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Aug 2013 04:42:11 +0000</created>
                <updated>Fri, 9 May 2014 06:34:24 +0000</updated>
                            <resolved>Fri, 6 Sep 2013 17:59:41 +0000</resolved>
                                                    <fixVersion>0.94.12</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13745780" author="posix4e" created="Wed, 21 Aug 2013 04:44:09 +0000"  >&lt;p&gt;This is against the &lt;br/&gt;
cdh4.3.0-release&lt;br/&gt;
hit me up if you want one against a different release.&lt;/p&gt;</comment>
                            <comment id="13745871" author="posix4e" created="Wed, 21 Aug 2013 08:30:55 +0000"  >&lt;p&gt;or does it make more sense to focus on 0.95.0 for now?&lt;/p&gt;</comment>
                            <comment id="13746788" author="stack" created="Wed, 21 Aug 2013 20:09:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=posix4e&quot; class=&quot;user-hover&quot; rel=&quot;posix4e&quot;&gt;Alex Newman&lt;/a&gt; 0.95/0.96 is the focus yes but if this is a fix for a 0.94 metric, fellas will be interested yes.&lt;/p&gt;

&lt;p&gt;Patch looks good to me.  Any of the replication heads want to ok it?&lt;/p&gt;</comment>
                            <comment id="13746852" author="jdcryans" created="Wed, 21 Aug 2013 21:13:21 +0000"  >&lt;p&gt;Mmm yeah that could work, did you try it Alex? What does it look like on a graph?&lt;/p&gt;</comment>
                            <comment id="13748210" author="posix4e" created="Fri, 23 Aug 2013 02:02:03 +0000"  >&lt;p&gt;Sorry for the delay apparently I&apos;m not getting jira email updates. JD you looking for an image. But yea I did try it and it works. Basically with this patch the graph looks like you expect. I rising line when the replicant is suspended and then it drops close to 0 when I unsuspend the replicant.&lt;/p&gt;</comment>
                            <comment id="13748222" author="posix4e" created="Fri, 23 Aug 2013 02:16:12 +0000"  >&lt;p&gt;Just printing out what is sent to the server&lt;br/&gt;
metric:Platform.HBase.hbase.posix4e-Satellite-S55-A.ageOfLastShippedOp 2321 1377059826&lt;br/&gt;
metric:Platform.HBase.hbase.posix4e-Satellite-S55-A.ageOfLastShippedOp 4092 1377059836&lt;br/&gt;
metric:Platform.HBase.hbase.posix4e-Satellite-S55-A.ageOfLastShippedOp 1695 1377059846&lt;br/&gt;
metric:Platform.HBase.hbase.posix4e-Satellite-S55-A.ageOfLastShippedOp 7575 1377059856&lt;br/&gt;
metric:Platform.HBase.hbase.posix4e-Satellite-S55-A.ageOfLastShippedOp 17576 1377059866&lt;br/&gt;
metric:Platform.HBase.hbase.posix4e-Satellite-S55-A.ageOfLastShippedOp 27575 1377059876&lt;br/&gt;
metric:Platform.HBase.hbase.posix4e-Satellite-S55-A.ageOfLastShippedOp 37575 1377059886&lt;br/&gt;
metric:Platform.HBase.hbase.posix4e-Satellite-S55-A.ageOfLastShippedOp 2899 1377059896&lt;br/&gt;
metric:Platform.HBase.hbase.posix4e-Satellite-S55-A.ageOfLastShippedOp 2853 1377059906&lt;br/&gt;
metric:Platform.HBase.hbase.posix4e-Satellite-S55-A.ageOfLastShippedOp 4006 1377059916&lt;br/&gt;
metric:Platform.HBase.hbase.posix4e-Satellite-S55-A.ageOfLastShippedOp 429 1377059926&lt;/p&gt;

&lt;p&gt;I suspeded the replication server at around 1377059856 and unsuspended around 1377059896&lt;/p&gt;</comment>
                            <comment id="13748225" author="posix4e" created="Fri, 23 Aug 2013 02:21:49 +0000"  >&lt;p&gt;testing on 0.95 now. By the way here&apos;s a graphite context for metrics2&lt;br/&gt;
&lt;a href=&quot;https://github.com/posix4e/GraphiteMetrics2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/posix4e/GraphiteMetrics2&lt;/a&gt;&lt;br/&gt;
v1 is at&lt;br/&gt;
&lt;a href=&quot;https://github.com/posix4e/GraphiteContext&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/posix4e/GraphiteContext&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13748694" author="jdcryans" created="Fri, 23 Aug 2013 16:42:47 +0000"  >&lt;p&gt;Yeah that looks good, let&apos;s see if we can get a Hadoop QA run just to be safe.&lt;/p&gt;</comment>
                            <comment id="13748765" author="hadoopqa" created="Fri, 23 Aug 2013 17:47:53 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12599106/0001-HBASE-9286.-ageOfLastShippedOp-replication-metric-do.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12599106/0001-HBASE-9286.-ageOfLastShippedOp-replication-metric-do.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6861//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6861//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13749684" author="hadoopqa" created="Sun, 25 Aug 2013 16:33:11 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12599106/0001-HBASE-9286.-ageOfLastShippedOp-replication-metric-do.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12599106/0001-HBASE-9286.-ageOfLastShippedOp-replication-metric-do.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6884//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6884//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13750362" author="jdcryans" created="Mon, 26 Aug 2013 18:25:22 +0000"  >&lt;p&gt;Oh it&apos;s a 0.94 patch. Can you provide one for trunk, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=posix4e&quot; class=&quot;user-hover&quot; rel=&quot;posix4e&quot;&gt;Alex Newman&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13757315" author="posix4e" created="Wed, 4 Sep 2013 00:38:06 +0000"  >&lt;p&gt;Is there no way to apply to a 0.94 branch? We have some customers using cdh so we want to get it into there. I will work on a 0.95 and trunk patch but I haven&apos;t even confirmed it exists there.&lt;/p&gt;</comment>
                            <comment id="13757737" author="stack" created="Wed, 4 Sep 2013 13:21:09 +0000"  >&lt;p&gt;It has been added for consideration on 0.94 by the RM.  Any chance of trunk and 0.96 patches?&lt;/p&gt;</comment>
                            <comment id="13757941" author="posix4e" created="Wed, 4 Sep 2013 16:56:05 +0000"  >&lt;p&gt;My pleasure. I&apos;ll get something soon.&lt;/p&gt;</comment>
                            <comment id="13759851" author="lhofhansl" created="Fri, 6 Sep 2013 04:28:28 +0000"  >&lt;p&gt;&amp;#43;1 on the 0.94 patch. This class does not exist in 0.96+, could somebody confirm whether this is a problem there as well?&lt;/p&gt;</comment>
                            <comment id="13759856" author="posix4e" created="Fri, 6 Sep 2013 04:39:53 +0000"  >&lt;p&gt;Doesn&apos;t seem to be a problem in future versions. Looking at the code it does the right thing.&lt;/p&gt;</comment>
                            <comment id="13759857" author="posix4e" created="Fri, 6 Sep 2013 04:40:08 +0000"  >&lt;p&gt;I checked trunk and 0.95&lt;/p&gt;</comment>
                            <comment id="13759922" author="lhofhansl" created="Fri, 6 Sep 2013 05:14:30 +0000"  >&lt;p&gt;Cool. Making it 0.94 only, then.&lt;br/&gt;
Going to commit tomorrow, unless I hear objections.&lt;/p&gt;</comment>
                            <comment id="13760433" author="lhofhansl" created="Fri, 6 Sep 2013 17:59:41 +0000"  >&lt;p&gt;Committed to 0.94. Thanks Alex!&lt;/p&gt;</comment>
                            <comment id="13760543" author="hudson" created="Fri, 6 Sep 2013 19:35:46 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-security #285 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/285/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/285/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9286&quot; title=&quot;[0.94] ageOfLastShippedOp replication metric doesn&amp;#39;t update if the slave regionserver is stalled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9286&quot;&gt;&lt;del&gt;HBASE-9286&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;0.94&amp;#93;&lt;/span&gt; ageOfLastShippedOp replication metric doesn&apos;t update if the slave regionserver is stalled (Alex Newman) (larsh: rev 1520646)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceMetrics.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13760570" author="hudson" created="Fri, 6 Sep 2013 20:09:27 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94 #1138 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1138/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1138/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9286&quot; title=&quot;[0.94] ageOfLastShippedOp replication metric doesn&amp;#39;t update if the slave regionserver is stalled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9286&quot;&gt;&lt;del&gt;HBASE-9286&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;0.94&amp;#93;&lt;/span&gt; ageOfLastShippedOp replication metric doesn&apos;t update if the slave regionserver is stalled (Alex Newman) (larsh: rev 1520646)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceMetrics.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12713228">HBASE-11143</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12599106" name="0001-HBASE-9286.-ageOfLastShippedOp-replication-metric-do.patch" size="1217" author="posix4e" created="Wed, 21 Aug 2013 04:44:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 Aug 2013 20:09:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>344707</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 14 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1nfzr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>345007</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>