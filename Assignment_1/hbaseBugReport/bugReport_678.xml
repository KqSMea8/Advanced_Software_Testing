<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:46:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-678/HBASE-678.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-678] hbase needs a &apos;safe-mode&apos;</title>
                <link>https://issues.apache.org/jira/browse/HBASE-678</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Internally we have a cluster of thousands of regions.  We just did a hbase restart w/ master on new node.  Just so happened that one of the regionservers was running extra slow (was downloaded by other processes).  Meant that its portion of the assigments was taking a long time to come up...  While these regions were stuck in deploy mode, the cluster is not useable.&lt;/p&gt;

&lt;p&gt;We need a sort of &apos;safe-mode&apos; in hbase where clients fail if they try to attach to a cluster not yet fully up.  UI should show when all assignments have been successfully made so admin can at least see when they have a problematic regionserver in their midst.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12397996">HBASE-678</key>
            <summary>hbase needs a &apos;safe-mode&apos;</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Jun 2008 22:18:22 +0000</created>
                <updated>Sun, 13 Sep 2009 22:26:25 +0000</updated>
                            <resolved>Tue, 11 Nov 2008 23:05:10 +0000</resolved>
                                                    <fixVersion>0.19.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                                                            <comments>
                            <comment id="12609424" author="jimk" created="Tue, 1 Jul 2008 01:49:49 +0000"  >&lt;p&gt;Marking as critial for 0.3.0 because several other issues will depend on this.&lt;/p&gt;</comment>
                            <comment id="12627779" author="dleffel" created="Tue, 2 Sep 2008 19:14:29 +0000"  >&lt;p&gt;One extra thing to tack onto this would be to block region balancing while in Safe Mode. Currently, I have 600 regions or so and as HBase is starting up, a lot of churn of regions closing and opening is happening during startup. It would be great if no balancing happened while in safe mode and then upon existing safe mode, regions got balanced.&lt;/p&gt;</comment>
                            <comment id="12629069" author="viper799" created="Mon, 8 Sep 2008 04:54:26 +0000"  >&lt;p&gt;I thank we should have a multi stage/process safe mode on the master not just for the clients but to handle crash recovery of regions and region balancing while we are in safe mode.&lt;br/&gt;
we have a issue for helping the balancing out on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-862&quot; title=&quot;region balancing is clumsy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-862&quot;&gt;&lt;del&gt;HBASE-862&lt;/del&gt;&lt;/a&gt; but I thank it will still be helpful to include all start up balancing while in safe mode&lt;/p&gt;

&lt;p&gt;Assuming we do not run just queue up needed compaction/split checks on loading regions while in safe mode.&lt;br/&gt;
Stage 1: Deploy all regions&lt;br/&gt;
Stage 2:  Do any crash recovery needed and do a flush to get that to disk (remove recovery logs on success flush)&lt;br/&gt;
Stage 3: Do any balancing of the regions before exiting the safe mode if needed.&lt;/p&gt;

&lt;p&gt;Stage 3 is there so we do not have any compactions or splits running on the regions and we can move them around as we need to to balance the region count out. &lt;br/&gt;
If there is no compactions running closes happen immediately.&lt;/p&gt;

&lt;p&gt;I seen some re balancing happen on start up and the region servers go crazy trying to balance as Daniel commented above. &lt;br/&gt;
This in my cluster is mostly from regions closing having to wait for running compaction creating a lag in the balancing counts&lt;br/&gt;
When the compactions finish and the region get closed and redeploy the counts are all out of balance again and the same thing happens over and over until almost all the compactions are done&lt;br/&gt;
and the regions can close and redeploy with out lag of the compactions.&lt;br/&gt;
Once we have done the above all will be ready for the clients to connect to the cluster with out having to worry about churn in balancing or crash recovering regions.&lt;/p&gt;

&lt;p&gt;Daniel: If we block region balancing while in Safe Mode your clients can connect when we come out of safe mode but then balancing will kick in and you will see the same churn as we have now.&lt;/p&gt;</comment>
                            <comment id="12629223" author="stack" created="Mon, 8 Sep 2008 17:30:10 +0000"  >&lt;p&gt;Yeah, Billy, as you suggest elsewhere, compaction should not be inline with close.&lt;/p&gt;

&lt;p&gt;In above, you are suggesting that when in &apos;safe mode&apos;, no compactions or splits so balancing happens promptly?&lt;/p&gt;

&lt;p&gt;On exit of &apos;safe mode&apos;, the compactions and splits could begin?&lt;/p&gt;

&lt;p&gt;I suppose the master can send a message to all regionservers when it wants all to leave &apos;safe mode&apos;.&lt;/p&gt;</comment>
                            <comment id="12629240" author="viper799" created="Mon, 8 Sep 2008 18:13:58 +0000"  >&lt;p&gt;yes that&apos;s what I was thanking we could still queue up the compaction request on the region server but only start the compactions once the master leaves safe mode. &lt;br/&gt;
Let the master send the message to the region server or let the region server query the master for safe mode status.&lt;/p&gt;

&lt;p&gt;If we do not want to stop compaction while in safe mode then we need to decline to close a region for redeployment while there is a compaction happening.&lt;/p&gt;
</comment>
                            <comment id="12646718" author="jimk" created="Tue, 11 Nov 2008 23:05:10 +0000"  >&lt;p&gt;All tasks completed. Resolving issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12406222">HBASE-919</subtask>
                            <subtask id="12406182">HBASE-918</subtask>
                            <subtask id="12406231">HBASE-921</subtask>
                            <subtask id="12408174">HBASE-988</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Jul 2008 01:49:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31811</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 6 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h8rz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98684</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>