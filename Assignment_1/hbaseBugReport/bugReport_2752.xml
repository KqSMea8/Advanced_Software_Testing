<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:04:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2752/HBASE-2752.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2752] Don&apos;t retry forever when waiting on too many store files</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2752</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2087&quot; title=&quot;The wait on compaction because &amp;quot;Too many store files&amp;quot; holds up all flushing&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2087&quot;&gt;&lt;del&gt;HBASE-2087&lt;/del&gt;&lt;/a&gt; introduced a way to not block all flushes when on region has too many store files. Unfortunately, that undid the behavior that if we waited for longer than 90 secs then that we would still flush the region... which means that when a  region blocks inserts because its memstore is too big it&apos;s actually holding off writes for a very long time, occupying handlers, etc.&lt;/p&gt;

&lt;p&gt;We need to add more smarts in MemStoreFlusher so that we detect when a region was held up for too long.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12467390">HBASE-2752</key>
            <summary>Don&apos;t retry forever when waiting on too many store files</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Jun 2010 23:38:41 +0000</created>
                <updated>Fri, 12 Oct 2012 06:15:38 +0000</updated>
                            <resolved>Sat, 19 Jun 2010 19:20:40 +0000</resolved>
                                                    <fixVersion>0.20.5</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12880369" author="jdcryans" created="Fri, 18 Jun 2010 23:40:52 +0000"  >&lt;p&gt;This is something that Dave Latham was hitting when trying out 0.20.5 RC3. One of his region server was compacting non-stop and a region could be blocked for minutes.&lt;/p&gt;</comment>
                            <comment id="12880376" author="stack" created="Sat, 19 Jun 2010 00:00:30 +0000"  >&lt;p&gt;So, after chatting w/ J-D (and Dave), the minimally invasive fix would keep the hbase-2087 fix that narrowed the flush block to a single memstore rather than block al flushes but keep the 0.20.3 behavior where if a compaction hadn&apos;t happened w/i 90seconds, go ahead w/ the flush anyways.&lt;/p&gt;</comment>
                            <comment id="12880386" author="stack" created="Sat, 19 Jun 2010 00:22:06 +0000"  >&lt;p&gt;Notes on the patch for 0.20.5RC4:&lt;/p&gt;

&lt;p&gt;Adds a delayqueue to hold regions to flush.&lt;/p&gt;

&lt;p&gt;The delay queue takes a data structure that holds Region and time of construction so can tell how long we&apos;ve been hanging out in the queue.&lt;/p&gt;

&lt;p&gt;The flushRegion method was refactored to remove crud.  Alot of the crud was old comments talking of &apos;compactions running inline with flush&apos;, behaviors long-since left behind.  The flushRegion was split up into two methods.  One that will check if we should delay first and then another method that holds everything else.  The former is called whenever we flush normally.  The latter is called directly when emergency flush required.&lt;/p&gt;

&lt;p&gt;Removed checkStoreFileCount.  It was only being used in the emergency flush case but, its use here was incorrect (if its an emergency flush, don&apos;t want to wait if too many store files).&lt;/p&gt;

&lt;p&gt;Please review.&lt;/p&gt;</comment>
                            <comment id="12880390" author="jdcryans" created="Sat, 19 Jun 2010 00:33:58 +0000"  >&lt;p&gt;I like it. Some comments:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;requeueCount in FQE could be a boolean, that&apos;s how it&apos;s used.&lt;/li&gt;
	&lt;li&gt;isMaximumWait isn&apos;t documented&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With that fixed and some cluster load testing, I&apos;m +1 for commit.&lt;/p&gt;</comment>
                            <comment id="12880422" author="davelatham" created="Sat, 19 Jun 2010 04:28:14 +0000"  >&lt;p&gt;Thanks for the quick work.  It&apos;s really aprpeciated.  I&apos;ll try to get this patch tested on a cluster.&lt;/p&gt;

&lt;p&gt;Minor nits:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The log on &quot;Cache flush failed&quot; should use toStringBinary for the region name.&lt;/li&gt;
	&lt;li&gt;blockingWaitTime / 100 seems somewhat arbitrary for check interval, but probably fine for now.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12880426" author="stack" created="Sat, 19 Jun 2010 05:18:06 +0000"  >&lt;p&gt;Thanks j-d for review.  I added in your first suggestion.  For the second, I kept count.  I think it&apos;ll be of use when we have a jsp page that dumps current state of the flush queue.&lt;/p&gt;

&lt;p&gt;I&apos;ve been running it up on cluster.  I see some of these during a big upload:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-06-18 18:02:17,864 INFO org.apache.hadoop.hbase.regionserver.MemStoreFlusher: Waited 90495ms on a compaction to clean up &apos;too many store files&apos;; waited &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; enough... proceeding with flush
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...so it looks like we got the 0.20.3 behavior back where we&apos;ll go ahead and flush regardless if we&apos;ve waited N ms (I left the interval at the 0.20.3 90 seconds which seems a bit long but...).&lt;/p&gt;

&lt;p&gt;I&apos;m going to commit and roll an RC&lt;/p&gt;</comment>
                            <comment id="12880427" author="stack" created="Sat, 19 Jun 2010 05:35:37 +0000"  >&lt;p&gt;Applied to branch and trunk (Lets talk jgray).&lt;/p&gt;</comment>
                            <comment id="12880529" author="stack" created="Sat, 19 Jun 2010 19:20:40 +0000"  >&lt;p&gt;Committed branch and trunk.  Resovling.  Thanks for review J-D.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12447517" name="2752.txt" size="14388" author="stack" created="Sat, 19 Jun 2010 00:22:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 19 Jun 2010 00:00:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32756</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 26 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08sin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49220</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>