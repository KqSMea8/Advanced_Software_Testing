<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:38:10 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12959/HBASE-12959.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12959]  Compact never end when table&apos;s dataBlockEncoding using  PREFIX_TREE</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12959</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I upgraded the hbase from 0.96.1.1 to 0.98.7 and hadoop from 2.2.0 to 2.5.1,some table encoding using prefix-tree was abnormal for compacting,  the gui shows the table&apos;s Compaction status is MAJOR_AND_MINOR(MAJOR) all the time.&lt;/p&gt;

&lt;p&gt;in the regionserver dump , there are some logs as below:&lt;/p&gt;


&lt;p&gt;Tasks:&lt;br/&gt;
===========================================================&lt;br/&gt;
Task: Compacting info in PREFIX_NOT_COMPACT,,1421954285670.41ef60e2c221772626e141d5080296c5.&lt;br/&gt;
Status: RUNNING:Compacting store info&lt;br/&gt;
Running for 1097s  (on the  site running more than 3 days)&lt;br/&gt;
............................&lt;/p&gt;

&lt;p&gt;Thread 197 (regionserver60020-smallCompactions-1421954341530):&lt;br/&gt;
  State: RUNNABLE&lt;br/&gt;
  Blocked count: 7&lt;br/&gt;
  Waited count: 3&lt;br/&gt;
  Stack:&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArrayScanner.followFan(PrefixTreeArrayScanner.java:329)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArraySearcher.positionAtOrAfter(PrefixTreeArraySearcher.java:149)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArraySearcher.seekForwardToOrAfter(PrefixTreeArraySearcher.java:183)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.PrefixTreeSeeker.seekToOrBeforeUsingPositionAtOrAfter(PrefixTreeSeeker.java:199)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.PrefixTreeSeeker.seekToKeyInBlock(PrefixTreeSeeker.java:162)&lt;br/&gt;
    org.apache.hadoop.hbase.io.hfile.HFileReaderV2$EncodedScannerV2.loadBlockAndSeekToKey(HFileReaderV2.java:1172)&lt;br/&gt;
    org.apache.hadoop.hbase.io.hfile.HFileReaderV2$AbstractScannerV2.reseekTo(HFileReaderV2.java:573)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreFileScanner.reseekAtOrAfter(StoreFileScanner.java:257)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreFileScanner.reseek(StoreFileScanner.java:173)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.NonLazyKeyValueScanner.doRealSeek(NonLazyKeyValueScanner.java:55)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.KeyValueHeap.generalizedSeek(KeyValueHeap.java:313)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.KeyValueHeap.reseek(KeyValueHeap.java:257)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreScanner.reseek(StoreScanner.java:697)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreScanner.seekAsDirection(StoreScanner.java:683)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreScanner.next(StoreScanner.java:533)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.compactions.Compactor.performCompaction(Compactor.java:222)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.compactions.DefaultCompactor.compact(DefaultCompactor.java:77)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.DefaultStoreEngine$DefaultCompactionContext.compact(DefaultStoreEngine.java:110)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.HStore.compact(HStore.java:1099)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.HRegion.compact(HRegion.java:1482)&lt;/p&gt;

&lt;p&gt;Thread 177 (regionserver60020-smallCompactions-1421954314809):&lt;br/&gt;
  State: RUNNABLE&lt;br/&gt;
  Blocked count: 40&lt;br/&gt;
  Waited count: 60&lt;br/&gt;
  Stack:&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.column.ColumnReader.populateBuffer(ColumnReader.java:81)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArrayScanner.populateQualifier(PrefixTreeArrayScanner.java:471)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArrayScanner.populateNonRowFields(PrefixTreeArrayScanner.java:452)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArrayScanner.nextRow(PrefixTreeArrayScanner.java:226)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArrayScanner.advance(PrefixTreeArrayScanner.java:208)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArraySearcher.positionAtQualifierTimestamp(PrefixTreeArraySearcher.java:244)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArraySearcher.positionAtOrAfter(PrefixTreeArraySearcher.java:123)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArraySearcher.seekForwardToOrAfter(PrefixTreeArraySearcher.java:183)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.PrefixTreeSeeker.seekToOrBeforeUsingPositionAtOrAfter(PrefixTreeSeeker.java:199)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.PrefixTreeSeeker.seekToKeyInBlock(PrefixTreeSeeker.java:162)&lt;br/&gt;
    org.apache.hadoop.hbase.io.hfile.HFileReaderV2$EncodedScannerV2.loadBlockAndSeekToKey(HFileReaderV2.java:1172)&lt;br/&gt;
    org.apache.hadoop.hbase.io.hfile.HFileReaderV2$AbstractScannerV2.reseekTo(HFileReaderV2.java:573)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreFileScanner.reseekAtOrAfter(StoreFileScanner.java:257)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreFileScanner.reseek(StoreFileScanner.java:173)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.NonLazyKeyValueScanner.doRealSeek(NonLazyKeyValueScanner.java:55)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.KeyValueHeap.generalizedSeek(KeyValueHeap.java:313)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.KeyValueHeap.reseek(KeyValueHeap.java:257)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreScanner.reseek(StoreScanner.java:697)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreScanner.seekAsDirection(StoreScanner.java:683)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreScanner.next(StoreScanner.java:533)&lt;/p&gt;

&lt;p&gt;Thread 170 (regionserver60020-smallCompactions-1421954306575):&lt;br/&gt;
  State: RUNNABLE&lt;br/&gt;
  Blocked count: 40&lt;br/&gt;
  Waited count: 46&lt;br/&gt;
  Stack:&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArrayScanner.nextRowInternal(PrefixTreeArrayScanner.java:259)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArrayScanner.nextRow(PrefixTreeArrayScanner.java:222)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArrayScanner.advance(PrefixTreeArrayScanner.java:208)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArraySearcher.positionAtQualifierTimestamp(PrefixTreeArraySearcher.java:244)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArraySearcher.positionAtOrAfter(PrefixTreeArraySearcher.java:123)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.decode.PrefixTreeArraySearcher.seekForwardToOrAfter(PrefixTreeArraySearcher.java:183)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.PrefixTreeSeeker.seekToOrBeforeUsingPositionAtOrAfter(PrefixTreeSeeker.java:199)&lt;br/&gt;
    org.apache.hadoop.hbase.codec.prefixtree.PrefixTreeSeeker.seekToKeyInBlock(PrefixTreeSeeker.java:162)&lt;br/&gt;
    org.apache.hadoop.hbase.io.hfile.HFileReaderV2$EncodedScannerV2.loadBlockAndSeekToKey(HFileReaderV2.java:1172)&lt;br/&gt;
    org.apache.hadoop.hbase.io.hfile.HFileReaderV2$AbstractScannerV2.reseekTo(HFileReaderV2.java:573)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreFileScanner.reseekAtOrAfter(StoreFileScanner.java:257)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreFileScanner.reseek(StoreFileScanner.java:173)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.NonLazyKeyValueScanner.doRealSeek(NonLazyKeyValueScanner.java:55)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.KeyValueHeap.generalizedSeek(KeyValueHeap.java:313)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.KeyValueHeap.reseek(KeyValueHeap.java:257)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreScanner.reseek(StoreScanner.java:697)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreScanner.seekAsDirection(StoreScanner.java:683)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.StoreScanner.next(StoreScanner.java:533)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.compactions.Compactor.performCompaction(Compactor.java:222)&lt;br/&gt;
    org.apache.hadoop.hbase.regionserver.compactions.DefaultCompactor.compact(DefaultCompactor.java:77)&lt;/p&gt;



&lt;p&gt;I also reproduce the appearance in the test env,actually the logs was fetch in my test env. &lt;/p&gt;

&lt;p&gt;schema :&lt;br/&gt;
create &apos;PREFIX_NOT_COMPACT&apos;, &lt;/p&gt;
{NAME=&amp;gt;&apos;info&apos;,VERSIONS=&amp;gt;1,BLOCKCACHE =&amp;gt; true,DATA_BLOCK_ENCODING =&amp;gt; &apos;PREFIX_TREE&apos;, BLOOMFILTER =&amp;gt; &apos;ROW&apos;, IN_MEMORY =&amp;gt; &apos;false&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, COMPRESSION =&amp;gt; &apos;LZ4&apos;,MIN_VERSIONS =&amp;gt; &apos;0&apos;, KEEP_DELETED_CELLS =&amp;gt; &apos;false&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, TTL =&amp;gt; &apos;600&apos;}
&lt;p&gt;,SPLITS =&amp;gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;#39;20150202&amp;#39;&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;data :&lt;br/&gt;
     see the attachments , load from the text data or storefiles.&lt;/p&gt;</description>
                <environment>&lt;p&gt;hbase 0.98.7&lt;br/&gt;
hadoop 2.5.1&lt;/p&gt;</environment>
        <key id="12771977">HBASE-12959</key>
            <summary> Compact never end when table&apos;s dataBlockEncoding using  PREFIX_TREE</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="bdifn">wuchengzhi</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Feb 2015 09:13:12 +0000</created>
                <updated>Tue, 10 Nov 2015 08:15:45 +0000</updated>
                                            <version>0.98.7</version>
                                                    <component>hbase</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="14302991" author="bdifn" created="Tue, 3 Feb 2015 09:23:14 +0000"  >&lt;p&gt;storefiles are too large i can&apos;t upload&lt;/p&gt;</comment>
                            <comment id="14303077" author="ram_krish" created="Tue, 3 Feb 2015 11:00:23 +0000"  >&lt;p&gt;Is this related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12952&quot; title=&quot;Seek with prefixtree may hang&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12952&quot;&gt;&lt;del&gt;HBASE-12952&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14304589" author="bdifn" created="Wed, 4 Feb 2015 03:29:36 +0000"  >&lt;p&gt;I try to use that patch just now, but it seems not fix my issue .&lt;/p&gt;</comment>
                            <comment id="14304644" author="ram_krish" created="Wed, 4 Feb 2015 04:52:48 +0000"  >&lt;p&gt;Okie, are you working on a patch for this?  If not I can take it up?&lt;/p&gt;</comment>
                            <comment id="14304659" author="bdifn" created="Wed, 4 Feb 2015 05:19:39 +0000"  >&lt;p&gt;Not yet,please help to fix it,thanks.&lt;/p&gt;</comment>
                            <comment id="14304717" author="apache9" created="Wed, 4 Feb 2015 06:56:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdifn&quot; class=&quot;user-hover&quot; rel=&quot;bdifn&quot;&gt;wuchengzhi&lt;/a&gt; Have you tried 0.98.10RC2? You can download it here.&lt;br/&gt;
&lt;a href=&quot;http://people.apache.org/~apurtell/0.98.10RC2/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://people.apache.org/~apurtell/0.98.10RC2/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12817&quot; title=&quot;Data missing while scanning using PREFIX_TREE data block encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12817&quot;&gt;&lt;del&gt;HBASE-12817&lt;/del&gt;&lt;/a&gt; have fixed a prefix tree decoding issue and will be released with 0.98.10.&lt;/p&gt;

&lt;p&gt;Thanks~&lt;/p&gt;</comment>
                            <comment id="14996402" author="wang_yongqiang" created="Mon, 9 Nov 2015 11:49:40 +0000"  >&lt;p&gt; Compact never end when table&apos;s dataBlockEncoding using  PREFIX_TREE&lt;br/&gt;
 does anybody know if this problem is solved?  will this problem happen in hbase0.98.10&lt;/p&gt;


&lt;p&gt;HBaseHBASE-12952, Seek with prefixtree may hang&lt;br/&gt;
and what about this problem, will this problem happen in hbase0.98.10&lt;/p&gt;


&lt;p&gt;many thanks&lt;/p&gt;






</comment>
                            <comment id="14997903" author="apache9" created="Tue, 10 Nov 2015 02:55:41 +0000"  >&lt;p&gt;I sent an email to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=bdifn&quot; class=&quot;user-hover&quot; rel=&quot;bdifn&quot;&gt;wuchengzhi&lt;/a&gt; long time ago to confirm whether &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12817&quot; title=&quot;Data missing while scanning using PREFIX_TREE data block encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12817&quot;&gt;&lt;del&gt;HBASE-12817&lt;/del&gt;&lt;/a&gt; solve this problem but he/she haven&apos;t replied yet...&lt;/p&gt;

&lt;p&gt;And PREFIX_TREE encoding has been used widely in our project for a long time. I haven&apos;t find any other problem after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12817&quot; title=&quot;Data missing while scanning using PREFIX_TREE data block encoding&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12817&quot;&gt;&lt;del&gt;HBASE-12817&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Hope this could help. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=wang_yongqiang&quot; class=&quot;user-hover&quot; rel=&quot;wang_yongqiang&quot;&gt;wangyongqiang&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14998218" author="wang_yongqiang" created="Tue, 10 Nov 2015 08:04:40 +0000"  >&lt;p&gt;you use hbase0.98.10, but this bug is fixed in hbase0.98.14, &lt;br/&gt;
u do not meet this problem?&lt;/p&gt;


&lt;p&gt;HBaseHBASE-13945&lt;br/&gt;
Prefix_Tree seekBefore() does not work correctly&lt;/p&gt;







</comment>
                            <comment id="14998232" author="apache9" created="Tue, 10 Nov 2015 08:15:45 +0000"  >&lt;p&gt;No, I haven&apos;t met this problem yet.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12771653">HBASE-12952</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12696138" name="PrefixTreeCompact.java" size="3824" author="bdifn" created="Tue, 3 Feb 2015 09:23:14 +0000"/>
                            <attachment id="12696132" name="txtfile-part1.txt.gz" size="7338530" author="bdifn" created="Tue, 3 Feb 2015 09:23:14 +0000"/>
                            <attachment id="12696133" name="txtfile-part2.txt.gz" size="1491354" author="bdifn" created="Tue, 3 Feb 2015 09:23:14 +0000"/>
                            <attachment id="12696134" name="txtfile-part4.txt.gz" size="7249089" author="bdifn" created="Tue, 3 Feb 2015 09:23:14 +0000"/>
                            <attachment id="12696135" name="txtfile-part5.txt.gz" size="958467" author="bdifn" created="Tue, 3 Feb 2015 09:23:14 +0000"/>
                            <attachment id="12696136" name="txtfile-part6.txt.gz" size="1571733" author="bdifn" created="Tue, 3 Feb 2015 09:23:14 +0000"/>
                            <attachment id="12696137" name="txtfile-part7.txt.gz" size="3680643" author="bdifn" created="Tue, 3 Feb 2015 09:23:14 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 3 Feb 2015 11:00:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 5 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2546v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>