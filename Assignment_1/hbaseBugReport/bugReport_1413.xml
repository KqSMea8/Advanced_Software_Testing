<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:53:18 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1413/HBASE-1413.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1413] fall back to filesystem block size default if hbase.regionserver.hlog.blocksize is not specified</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1413</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Fall back to filesystem block size default if hbase.regionserver.hlog.blocksize is not specified.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12425278">HBASE-1413</key>
            <summary>fall back to filesystem block size default if hbase.regionserver.hlog.blocksize is not specified</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Tue, 12 May 2009 22:43:08 +0000</created>
                <updated>Sun, 13 Sep 2009 22:34:58 +0000</updated>
                            <resolved>Wed, 13 May 2009 07:06:35 +0000</resolved>
                                                    <fixVersion>0.19.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12708691" author="stack" created="Tue, 12 May 2009 23:55:37 +0000"  >&lt;p&gt;I&apos;ve been playing in here Andrew.  I think we should remove this from the hbase-default.xml too:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &amp;lt;property&amp;gt;
    &amp;lt;name&amp;gt;hbase.regionserver.hlog.blocksize&amp;lt;/name&amp;gt;
    &amp;lt;value&amp;gt;1048576&amp;lt;/value&amp;gt;
    &amp;lt;description&amp;gt;Block size &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; HLog files. To minimize potential data loss,
    the size should be (avg key length) * (avg value length) * flushlogentries.
    Default 1MB.
    &amp;lt;/description&amp;gt;
  &amp;lt;/property&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Its looking like the original assumption that we&apos;d recover up to the last written block if dfs.support.append was set to true in hadoop doesn&apos;t hold.  Let me test more to be sure.&lt;/p&gt;</comment>
                            <comment id="12708692" author="apurtell" created="Tue, 12 May 2009 23:58:15 +0000"  >&lt;p&gt;Happy to remove hbase.regionserver.hlog.blocksize from hbase-default.xml upon commit of the patch.&lt;/p&gt;</comment>
                            <comment id="12708698" author="stack" created="Wed, 13 May 2009 00:15:44 +0000"  >&lt;p&gt;Yeah, append doesn&apos;t work in hadoop, even if I set:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;property&amp;gt;
  &amp;lt;name&amp;gt;dfs.support.append&amp;lt;/name&amp;gt;
  &amp;lt;value&amp;gt;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&amp;lt;/value&amp;gt;
  &amp;lt;description&amp;gt;Does HDFS allow appends to files?
               This is currently set to &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; because there are bugs in the
               &lt;span class=&quot;code-quote&quot;&gt;&quot;append code&quot;&lt;/span&gt; and is not supported in any prodction cluster.
  &amp;lt;/description&amp;gt;
&amp;lt;/property&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I set it in hadoop and in hbase-site, just in case.&lt;/p&gt;


&lt;p&gt;Here is what happens on recovery (I have hbase default of 1MB blocks):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-05-13 00:11:58,432 [HMaster] DEBUG org.apache.hadoop.hbase.regionserver.HLog: Splitting 7 of 8: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//aa0-000-12.u.powerset.com:9000/hbasetrunk2/.logs/aa0-000-13.u.powerset.com_1242172854122_60021/hlog.dat.1242173414309
&lt;/span&gt;2009-05-13 00:11:58,479 [HMaster] DEBUG org.apache.hadoop.hbase.regionserver.HLog: Creating &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; log file writer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; path hdfs:&lt;span class=&quot;code-comment&quot;&gt;//aa0-000-12.u.powerset.com:9000/hbasetrunk2/TestTable/1990997262/oldlogfile.log and region TestTable,0452208868,1242173387637
&lt;/span&gt;2009-05-13 00:12:03,302 [HMaster] DEBUG org.apache.hadoop.hbase.regionserver.HLog: Applied 104414 total edits from hdfs:&lt;span class=&quot;code-comment&quot;&gt;//aa0-000-12.u.powerset.com:9000/hbasetrunk2/.logs/aa0-000-13.u.powerset.com_1242172854122_60021/hlog.dat.1242173414309
&lt;/span&gt;2009-05-13 00:12:03,370 [HMaster] DEBUG org.apache.hadoop.hbase.regionserver.HLog: Splitting 8 of 8: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//aa0-000-12.u.powerset.com:9000/hbasetrunk2/.logs/aa0-000-13.u.powerset.com_1242172854122_60021/hlog.dat.1242173448263
&lt;/span&gt;2009-05-13 00:12:10,717 [HMaster] INFO org.apache.hadoop.hbase.regionserver.HLog: log file splitting completed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hdfs:&lt;span class=&quot;code-comment&quot;&gt;//aa0-000-12.u.powerset.com:9000/hbasetrunk2/.logs/aa0-000-13.u.powerset.com_1242172854122_60021&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nothing is recovered from eight file.....&lt;/p&gt;

&lt;p&gt;Let me try printing out log file sizes...&lt;/p&gt;</comment>
                            <comment id="12708712" author="stack" created="Wed, 13 May 2009 01:14:53 +0000"  >&lt;p&gt;I added logging of blocksize in HLog.  Indeed its 1MB.&lt;/p&gt;

&lt;p&gt;I added logging of the size of log files.  I ran a test.  The last log file was as follows:&lt;/p&gt;

&lt;p&gt;2009-05-13 01:10:44,538 &lt;span class=&quot;error&quot;&gt;&amp;#91;HMaster&amp;#93;&lt;/span&gt; DEBUG org.apache.hadoop.hbase.regionserver.HLog: Splitting 6 of 6: hdfs://aa0-000-12.u.powerset.com:9000/hbasetrunk2/.logs/aa0-000-13.u.powerset.com_1242176118526_60021/hlog.dat.1242176867603 length=87031808&lt;/p&gt;

&lt;p&gt;i.e. 87MBs in size.&lt;/p&gt;

&lt;p&gt;We got no edits out of it.  We just skipped over it.&lt;/p&gt;

&lt;p&gt;I even tried adding this code to HLog splitLog:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@@ -730,8 +739,25 @@
       &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; logfiles.length; i++) {
         &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled()) {
           LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Splitting &quot;&lt;/span&gt; + (i + 1) + &lt;span class=&quot;code-quote&quot;&gt;&quot; of &quot;&lt;/span&gt; + logfiles.length + &lt;span class=&quot;code-quote&quot;&gt;&quot;: &quot;&lt;/span&gt; +
-            logfiles[i].getPath());
+            logfiles[i].getPath() + &lt;span class=&quot;code-quote&quot;&gt;&quot; length=&quot;&lt;/span&gt; + logfiles[i].getLen());
         }
+&lt;span class=&quot;code-comment&quot;&gt;// Trying recovery
&lt;/span&gt;+&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; recovered = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+&lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!recovered) {
+  &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+    FSDataOutputStream out = fs.append(logfiles[i].getPath());
+    out.close();
+    recovered = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
+  } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
+    LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Triggering lease recovery&quot;&lt;/span&gt;, e);
+    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000);
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException ex) {
+      &lt;span class=&quot;code-comment&quot;&gt;// ignore it and &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; again
&lt;/span&gt;+    }
+  }
+}
+    LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Past out lease recovery&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Doesn&apos;t work in hadoop 0.20.0.. I get this over and over:&lt;/p&gt;

&lt;p&gt;org.apache.hadoop.ipc.RemoteException: org.apache.hadoop.hdfs.protocol.AlreadyBeingCreatedException: failed to create file /hbasetrunk2/.logs/aa0-000-13.u.powerset.com_1242174244206_60021/hlog.dat.1242175401082 for DFSClient_-775762375 on client 208.76.44.139 because current leaseholder is trying to recreate file.&lt;/p&gt;

&lt;p&gt;Andrew, mind if I take this.. let me put up a patch with some better logging added.&lt;/p&gt;</comment>
                            <comment id="12708715" author="stack" created="Wed, 13 May 2009 01:29:19 +0000"  >&lt;p&gt;What you think of this patch Andrew?&lt;/p&gt;

&lt;p&gt;Its your patch plus removal of the blocksize from hbase-default.xml.&lt;/p&gt;

&lt;p&gt;It adds logging on HLogs config.  Should be once per HRS startup.&lt;/p&gt;

&lt;p&gt;Then, if we are taking a long time committing an edit, it prints out number of edits so far.  This is useful figuring if every edit is taking a long time to go in or just the odd one.&lt;/p&gt;

&lt;p&gt;Also logs if an edit took &amp;gt; 1ms to go in.  When we start seeing these messages, there is something up w/ our commit logs or with hdfs.&lt;/p&gt;

&lt;p&gt;Finally prints length of edit log when running split.&lt;/p&gt;</comment>
                            <comment id="12708798" author="apurtell" created="Wed, 13 May 2009 06:57:37 +0000"  >&lt;p&gt;Reassign to stack.&lt;/p&gt;</comment>
                            <comment id="12708801" author="apurtell" created="Wed, 13 May 2009 07:06:35 +0000"  >&lt;p&gt;Committed -v2 patch to trunk.&lt;/p&gt;</comment>
                            <comment id="12709116" author="stack" created="Wed, 13 May 2009 20:52:19 +0000"  >&lt;p&gt;Backported to 0.19 branch.  0.19. shipped with this affliction in place.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12424950">HBASE-1394</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12407955" name="1413-v2.patch" size="3776" author="stack" created="Wed, 13 May 2009 01:29:19 +0000"/>
                            <attachment id="12407932" name="hbase-1413.patch" size="754" author="apurtell" created="Tue, 12 May 2009 22:44:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 12 May 2009 23:55:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32127</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hd3j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99384</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>