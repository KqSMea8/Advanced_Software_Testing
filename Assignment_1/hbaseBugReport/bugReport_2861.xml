<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:05:22 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2861/HBASE-2861.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2861] regionserver&apos;s logsyncer thread hangs on DFSClient$DFSOutputStream.waitForAckedSeqno</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2861</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;During loads into HBase, we are noticing that a RS is sometimes getting stuck.&lt;/p&gt;

&lt;p&gt;The logSyncer thread:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.waitForAckedSeqno(DFSClient.java:3367)
        - locked &amp;lt;0x00002aaac7fef748&amp;gt; (a java.util.LinkedList)
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.sync(DFSClient.java:3301)
        at org.apache.hadoop.fs.FSDataOutputStream.sync(FSDataOutputStream.java:97)
        at org.apache.hadoop.io.SequenceFile$Writer.syncFs(SequenceFile.java:944)
        at sun.reflect.GeneratedMethodAccessor3.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogWriter.sync(SequenceFileLogWriter.java:124)
        at org.apache.hadoop.hbase.regionserver.wal.HLog.hflush(HLog.java:949)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A lot of other threads are stuck on:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:1925)
        at org.apache.hadoop.hbase.regionserver.wal.HLog$LogSyncer.addToSyncQueue(HLog.java:916)
        at org.apache.hadoop.hbase.regionserver.wal.HLog.sync(HLog.java:936)
        at org.apache.hadoop.hbase.regionserver.wal.HLog.append(HLog.java:828)
        at org.apache.hadoop.hbase.regionserver.HRegion.put(HRegion.java:1657)
        at org.apache.hadoop.hbase.regionserver.HRegion.put(HRegion.java:1425)
        at org.apache.hadoop.hbase.regionserver.HRegion.put(HRegion.java:1393)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.put(HRegionServer.java:1665)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.multiPut(HRegionServer.java:2326)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Subsequently, trying to disable the table, which in turn attempts to close the region(s), caused internalFlushCache() also to get stuck here:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1114)
        at java.util.concurrent.locks.ReentrantReadWriteLock$WriteLock.lock(ReentrantReadWriteLock.java:807)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:974)
        at org.apache.hadoop.hbase.regionserver.HRegion.close(HRegion.java:511)
        - locked &amp;lt;0x00002aaab76af670&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
        at org.apache.hadoop.hbase.regionserver.HRegion.close(HRegion.java:463)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.closeRegion(HRegionServer.java:1468)
        at org.apache.hadoop.hbase.regionserver.HRegionServer$Worker.run(HRegionServer.java:1329)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll attach the full jstack trace soon.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12469845">HBASE-2861</key>
            <summary>regionserver&apos;s logsyncer thread hangs on DFSClient$DFSOutputStream.waitForAckedSeqno</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hairong">Hairong Kuang</assignee>
                                    <reporter username="kannanm">Kannan Muthukkaruppan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Jul 2010 18:49:11 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:59 +0000</updated>
                            <resolved>Mon, 1 Nov 2010 06:23:51 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12890821" author="kannanm" created="Wed, 21 Jul 2010 18:54:46 +0000"  >&lt;p&gt;Uploaded jstack trace (jstack.txt).&lt;/p&gt;

&lt;p&gt;Wondering if this is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-895&quot; title=&quot;Allow hflush/sync to occur in parallel with new writes to the file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-895&quot;&gt;&lt;del&gt;HDFS-895&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12890959" author="hairong" created="Thu, 22 Jul 2010 00:00:37 +0000"  >&lt;p&gt;It looks that org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.sync did not succeed. Need to take a look at the DataNode log to figure out what happened on the write pipeline. Also why the client did not time out?&lt;/p&gt;</comment>
                            <comment id="12891000" author="stack" created="Thu, 22 Jul 2010 04:34:10 +0000"  >&lt;p&gt;Bringing into 0.90.0 (Hurray! Hairong is here!)&lt;/p&gt;</comment>
                            <comment id="12892172" author="tlipcon" created="Mon, 26 Jul 2010 04:47:09 +0000"  >&lt;p&gt;Strange &amp;#8211; ResponseProcessor here is waiting to read an ack from the DN but not getting anything.&lt;/p&gt;

&lt;p&gt;Have you tweaked the DFS client timeout settings at all, by any chance?&lt;/p&gt;</comment>
                            <comment id="12892451" author="nspiegelberg" created="Mon, 26 Jul 2010 20:32:34 +0000"  >&lt;p&gt;No custom timeout settings.  We were similarly puzzled that it was stuck here.  The only thing I can think is that SocketIOWithTimeout has a bug.  While investigating this issue, we noticed in DataStreamer.run():&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;              &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!hasError &amp;amp;&amp;amp; ackQueue.size() != 0 &amp;amp;&amp;amp; clientRunning) {
                &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                  ackQueue.wait();   &lt;span class=&quot;code-comment&quot;&gt;// wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; acks to arrive from datanodes
&lt;/span&gt;                } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException  e) {
                }
              }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ackQueue.wait() has no timeout, but was inside a while() loop that included hasError, a volatile variable.  So I think that needs to be fixed.&lt;/p&gt;</comment>
                            <comment id="12892529" author="tlipcon" created="Mon, 26 Jul 2010 23:00:46 +0000"  >&lt;p&gt;Hrm, I don&apos;t think the wait timeout should be strictly necessary, since we always notify on ackQueue after changing hasError, right? But I guess it&apos;s good practice.&lt;/p&gt;</comment>
                            <comment id="12902167" author="jdcryans" created="Tue, 24 Aug 2010 23:50:02 +0000"  >&lt;p&gt;Kannan, did you ever see this issue again? Do you have more info from the DN&apos;s log or jstack?&lt;/p&gt;</comment>
                            <comment id="12902170" author="kannanm" created="Tue, 24 Aug 2010 23:55:21 +0000"  >&lt;p&gt;No, didn&apos;t see this again. And don&apos;t have any logs handy any more either. Should we close this out?&lt;/p&gt;</comment>
                            <comment id="12908915" author="kannanm" created="Mon, 13 Sep 2010 18:45:28 +0000"  >&lt;p&gt;We hit this issue again. Reopening. Looking at logs... will keep you posted.&lt;/p&gt;</comment>
                            <comment id="12909958" author="hairong" created="Thu, 16 Sep 2010 00:13:59 +0000"  >&lt;p&gt;What happened was that the first datanode in the pipeline got stuck at receiving the hflushed data although the client has already sent the packet over. Netstat shows that the packet is already at the datanode side, where port DD is the datanode and CC is the client. It happened that both the client and first datanode were on the same machine XX.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;netstat -v |grep CC&lt;br/&gt;
tcp      551      0 machineXX:DD machineXX:CC ESTABLISHED &lt;br/&gt;
tcp        0      0 machineXX:CC machineXX:DD ESTABLISHED&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="12913302" author="hairong" created="Tue, 21 Sep 2010 23:01:14 +0000"  >&lt;p&gt;Hit this problem again. It seems to me that this is either a JVM bug or an OS kernel problem.&lt;/p&gt;

&lt;p&gt;Although the root cause of the problem is not confirmed yet, pull in &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-724&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HDFS-724&lt;/a&gt; to the Hadoop 0.20 branch should fix the client stuck problem.&lt;/p&gt;</comment>
                            <comment id="12918207" author="stack" created="Tue, 5 Oct 2010 21:23:01 +0000"  >&lt;p&gt;Changed from blocker to critical.  Shouldn&apos;t hold up 0.90.  Will document this as known issue w/ hdfs-724 suggested workaround.&lt;/p&gt;</comment>
                            <comment id="12918215" author="hairong" created="Tue, 5 Oct 2010 21:31:24 +0000"  >&lt;p&gt;I&apos;ve already pulled in &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-724&quot; title=&quot;Pipeline close hangs if one of the datanode is not responsive.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-724&quot;&gt;&lt;del&gt;HDFS-724&lt;/del&gt;&lt;/a&gt; to our internal HDFS 0.20 branch. Will work on getting the fix to Apache HDFS append branch.&lt;/p&gt;</comment>
                            <comment id="12919409" author="stack" created="Fri, 8 Oct 2010 23:10:35 +0000"  >&lt;p&gt;@Hairong That&apos;d be cool.&lt;/p&gt;</comment>
                            <comment id="12926849" author="hairong" created="Mon, 1 Nov 2010 06:23:51 +0000"  >&lt;p&gt;Closing this since &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-724&quot; title=&quot;Pipeline close hangs if one of the datanode is not responsive.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-724&quot;&gt;&lt;del&gt;HDFS-724&lt;/del&gt;&lt;/a&gt; is committed to append20 branch.&lt;/p&gt;</comment>
                            <comment id="15017674" author="lars_francke" created="Fri, 20 Nov 2015 12:43:59 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12438768">HDFS-724</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12450077" name="jstack.txt" size="197053" author="kannanm" created="Wed, 21 Jul 2010 18:53:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 Jul 2010 00:00:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26503</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0eon3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>83754</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>