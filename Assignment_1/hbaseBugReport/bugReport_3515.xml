<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:10:51 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3515/HBASE-3515.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3515] [replication] ReplicationSource can miss a log after RS comes out of GC</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3515</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This is from Hudson build 1738, if a log is about to be rolled and the ZK connection is already closed then the replication code will fail at adding the new log in ZK but the log will still be rolled and it&apos;s possible that some edits will make it in.&lt;/p&gt;

&lt;p&gt;From the log:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2011-02-08 10:21:20,618 FATAL &lt;span class=&quot;error&quot;&gt;&amp;#91;RegionServer:0;vesta.apache.org,46117,1297160399378.logRoller&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1383):&lt;br/&gt;
 ABORTING region server serverName=vesta.apache.org,46117,1297160399378, load=(requests=1525, regions=12,&lt;br/&gt;
 usedHeap=273, maxHeap=1244): Failed add log to list&lt;br/&gt;
org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss for &lt;br/&gt;
 /1/replication/rs/vesta.apache.org,46117,1297160399378/2/vesta.apache.org%3A46117.1297160480509&lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;2011-02-08 10:21:22,444 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_META_SERVER_OPERATIONS-vesta.apache.org:56008-0&amp;#93;&lt;/span&gt; wal.HLogSplitter(258):&lt;br/&gt;
 Splitting hlog 8 of 8: hdfs://localhost:55474/user/hudson/.logs/vesta.apache.org,46117,1297160399378/vesta.apache.org%3A46117.1297160480509, length=0&lt;/p&gt;

&lt;p&gt;2011-02-08 10:21:22,862 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;MASTER_META_SERVER_OPERATIONS-vesta.apache.org:56008-0&amp;#93;&lt;/span&gt; wal.HLogSplitter(436):&lt;br/&gt;
 Pushed=31 entries from hdfs://localhost:55474/user/hudson/.logs/vesta.apache.org,46117,1297160399378/vesta.apache.org%3A46117.1297160480509&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The easiest thing to do would be let the exception out and cancel the log roll.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12498015">HBASE-3515</key>
            <summary>[replication] ReplicationSource can miss a log after RS comes out of GC</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Feb 2011 18:46:01 +0000</created>
                <updated>Fri, 20 Nov 2015 12:42:35 +0000</updated>
                            <resolved>Tue, 1 Nov 2011 23:45:55 +0000</resolved>
                                    <version>0.90.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12992124" author="jdcryans" created="Tue, 8 Feb 2011 19:24:11 +0000"  >&lt;p&gt;This patch simply adds a check if the region server is going down before closing the file. In the replication case it fixes the issue, since if it fails it will set that flag to true.&lt;/p&gt;

&lt;p&gt;The issue with throwing an exception on i.logRolled(newPath) is that since there&apos;s potentially many of them, throwing midway would mean that you have to implement a roll back. There&apos;s nothing at the moment that requires that level of complexity.&lt;/p&gt;</comment>
                            <comment id="12992147" author="stack" created="Tue, 8 Feb 2011 20:06:31 +0000"  >&lt;p&gt;+1  Is it needed in 0.90 too?&lt;/p&gt;</comment>
                            <comment id="12992149" author="jdcryans" created="Tue, 8 Feb 2011 20:09:54 +0000"  >&lt;p&gt;Yes, I was planning to putting this in branch and trunk.&lt;/p&gt;</comment>
                            <comment id="12992196" author="jdcryans" created="Tue, 8 Feb 2011 21:35:17 +0000"  >&lt;p&gt;Committed to branch and trunk.&lt;/p&gt;</comment>
                            <comment id="12992297" author="hudson" created="Wed, 9 Feb 2011 02:35:41 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1739 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1739/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1739/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3515&quot; title=&quot;[replication] ReplicationSource can miss a log after RS comes out of GC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3515&quot;&gt;&lt;del&gt;HBASE-3515&lt;/del&gt;&lt;/a&gt;  &lt;span class=&quot;error&quot;&gt;&amp;#91;replication&amp;#93;&lt;/span&gt; ReplicationSource can miss a log after RS comes&lt;br/&gt;
               out of GC&lt;/p&gt;</comment>
                            <comment id="12994550" author="jdcryans" created="Mon, 14 Feb 2011 23:11:31 +0000"  >&lt;p&gt;I mistakenly thought that hlog.closed was set when the region server was on it&apos;s way out, but I&apos;m wrong... it&apos;s just set when the HLog is closing. Need to find an alternative.&lt;/p&gt;</comment>
                            <comment id="13006744" author="jdcryans" created="Tue, 15 Mar 2011 00:35:00 +0000"  >&lt;p&gt;I&apos;m thinking of a more radical way of solving this issue, considering that the problem is that the RS is able to roll a log even tho we already lost our session, I&apos;m thinking that we should call fs.close() from inside HRS.abort() thus preventing any other call from reaching HDFS. The downside is that it&apos;s going to make a big BOOOM and every call to close regions will fail in the ugliest fashion.&lt;/p&gt;</comment>
                            <comment id="13007834" author="tlipcon" created="Thu, 17 Mar 2011 06:25:20 +0000"  >&lt;p&gt;hmm, this was reverted from branch but not trunk? is that right?&lt;/p&gt;</comment>
                            <comment id="13008245" author="jdcryans" created="Fri, 18 Mar 2011 00:40:30 +0000"  >&lt;p&gt;Thanks for reminding me my lazyness Todd, trunk is now clean.&lt;/p&gt;</comment>
                            <comment id="13008339" author="hudson" created="Fri, 18 Mar 2011 06:05:21 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1795 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1795/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1795/&lt;/a&gt;)&lt;br/&gt;
    Reverting &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3515&quot; title=&quot;[replication] ReplicationSource can miss a log after RS comes out of GC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3515&quot;&gt;&lt;del&gt;HBASE-3515&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13010500" author="jdcryans" created="Wed, 23 Mar 2011 22:42:00 +0000"  >&lt;p&gt;Punting, both a hackish fix and a good fix would be very involved.&lt;/p&gt;</comment>
                            <comment id="13134805" author="stack" created="Tue, 25 Oct 2011 07:22:16 +0000"  >&lt;p&gt;@J-D What you thinking regards this issue now?  Should it hold up 0.92?&lt;/p&gt;</comment>
                            <comment id="13135283" author="jdcryans" created="Tue, 25 Oct 2011 17:51:40 +0000"  >&lt;p&gt;I&apos;ll try to fix it today and will punt if I don&apos;t go anywhere.&lt;/p&gt;</comment>
                            <comment id="13135545" author="jdcryans" created="Tue, 25 Oct 2011 23:19:19 +0000"  >&lt;p&gt;To reiterate the problem, it&apos;s possible to not be able to add an HLog to replicate if the session is expired when log rolling. HLog currently doesn&apos;t get any feedback from the WALActionListeners, even if they fail at doing their job.&lt;/p&gt;

&lt;p&gt;One way of fixing it would be to throw an exception and stop the log rolling, but it means that if there&apos;s many listeners that some may already have processed the adding of the log. We could also kill the region server plain and simple if it happens.&lt;/p&gt;

&lt;p&gt;I&apos;m in favor of the latter.&lt;/p&gt;</comment>
                            <comment id="13135570" author="yuzhihong@gmail.com" created="Tue, 25 Oct 2011 23:52:12 +0000"  >&lt;p&gt;+1 on stopping region server if this situation happens.&lt;/p&gt;</comment>
                            <comment id="13135572" author="jdcryans" created="Tue, 25 Oct 2011 23:54:12 +0000"  >&lt;p&gt;It seems the code changed a lot because now in trunk postLogRoll throws an IOE that kills the server. All I need to do is to bubble it up!&lt;/p&gt;</comment>
                            <comment id="13135573" author="yuzhihong@gmail.com" created="Tue, 25 Oct 2011 23:59:22 +0000"  >&lt;p&gt;But for 0.92, we still have:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void logRolled(Path newFile);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13141763" author="jdcryans" created="Tue, 1 Nov 2011 23:33:20 +0000"  >&lt;p&gt;Attaching the patch for 0.92, for trunk you just need to remove the adding of the IOE since it&apos;s already there.&lt;/p&gt;</comment>
                            <comment id="13141766" author="stack" created="Tue, 1 Nov 2011 23:38:46 +0000"  >&lt;p&gt;+1 on patch.&lt;/p&gt;</comment>
                            <comment id="13141771" author="jdcryans" created="Tue, 1 Nov 2011 23:43:35 +0000"  >&lt;p&gt;And the patch for trunk.&lt;/p&gt;</comment>
                            <comment id="13141774" author="jdcryans" created="Tue, 1 Nov 2011 23:45:56 +0000"  >&lt;p&gt;Committed to 0.92 and trunk, thanks for looking at my patch Stack!&lt;/p&gt;</comment>
                            <comment id="13141864" author="hudson" created="Wed, 2 Nov 2011 02:56:58 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #96 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/96/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/96/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3515&quot; title=&quot;[replication] ReplicationSource can miss a log after RS comes out of GC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3515&quot;&gt;&lt;del&gt;HBASE-3515&lt;/del&gt;&lt;/a&gt;  &lt;span class=&quot;error&quot;&gt;&amp;#91;replication&amp;#93;&lt;/span&gt; ReplicationSource can miss a log after RS comes out of GC&lt;/p&gt;

&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/wal/WALActionsListener.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/replication/regionserver/Replication.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13141927" author="hudson" created="Wed, 2 Nov 2011 05:15:59 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2398 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2398/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2398/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3515&quot; title=&quot;[replication] ReplicationSource can miss a log after RS comes out of GC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3515&quot;&gt;&lt;del&gt;HBASE-3515&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;replication&amp;#93;&lt;/span&gt; ReplicationSource can miss a log after RS comes out of GC&lt;br/&gt;
           (fixing a missing handling of IOE in Replication)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3515&quot; title=&quot;[replication] ReplicationSource can miss a log after RS comes out of GC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3515&quot;&gt;&lt;del&gt;HBASE-3515&lt;/del&gt;&lt;/a&gt;  &lt;span class=&quot;error&quot;&gt;&amp;#91;replication&amp;#93;&lt;/span&gt; ReplicationSource can miss a log after RS comes out of GC&lt;/p&gt;

&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/replication/regionserver/Replication.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15017289" author="lars_francke" created="Fri, 20 Nov 2015 12:42:35 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12604703">HBASE-6649</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12501874" name="HBASE-3515-v2-0.92.patch" size="4298" author="jdcryans" created="Tue, 1 Nov 2011 23:33:20 +0000"/>
                            <attachment id="12501875" name="HBASE-3515-v2.patch" size="2918" author="jdcryans" created="Tue, 1 Nov 2011 23:43:35 +0000"/>
                            <attachment id="12470618" name="HBASE-3515.patch" size="580" author="jdcryans" created="Tue, 8 Feb 2011 19:24:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Feb 2011 20:06:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26896</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hmlb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100922</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>