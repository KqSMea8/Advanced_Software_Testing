<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:50:29 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7938/HBASE-7938.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7938] Add integration test for ImportTsv/LoadIncrementalHFiles workflow</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7938</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We have existing unit tests for smoke-testing the packaged MR jobs, however they do not create a runtime environment that is true to running on a real MR cluster. This is particularly true in regard to classpaths (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7934&quot; title=&quot;TableMapReduceUtil doesn&amp;#39;t include all dependency jars in new modular build&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7934&quot;&gt;&lt;del&gt;HBASE-7934&lt;/del&gt;&lt;/a&gt;) but also other static state (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4802&quot; title=&quot;Disable show table metrics in bulk loader&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4802&quot;&gt;&lt;del&gt;HBASE-4802&lt;/del&gt;&lt;/a&gt;). An integration test that can be pointed to run on a pseudo-distributed Hadoop deployed on localhost would find these kinds of problems.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12634033">HBASE-7938</key>
            <summary>Add integration test for ImportTsv/LoadIncrementalHFiles workflow</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12636666">HBASE-8084</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ndimiduk">Nick Dimiduk</assignee>
                                    <reporter username="ndimiduk">Nick Dimiduk</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Feb 2013 01:20:00 +0000</created>
                <updated>Mon, 23 Sep 2013 18:30:51 +0000</updated>
                            <resolved>Thu, 14 Mar 2013 22:32:02 +0000</resolved>
                                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.95.0</fixVersion>
                                    <component>mapreduce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13587537" author="stack" created="Tue, 26 Feb 2013 20:57:25 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13596327" author="ndimiduk" created="Thu, 7 Mar 2013 20:28:43 +0000"  >&lt;p&gt;In many cases, we already have decent coverage in the existing unit tests. The trouble is, some bugs cannot be caught using the classpath generated by Maven because it&apos;s too generous about including jars on our behalf. Rather than re-implementing bits from existing unit tests, I&apos;d like to modify IntegrationTestsDriver to accept any class that implements Tool. With that change, I can modify the existing unit tests to implement a run method where the prickly scenarios can be run against an external cluster, as configured by IntegratoinTestsDriver. I&apos;m hoping this will minimize changes to existing test code and also minimize code duplication.&lt;/p&gt;

&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="13596387" author="enis" created="Thu, 7 Mar 2013 21:20:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;d like to modify IntegrationTestsDriver to accept any class that implements Tool. With that change, I can modify the existing unit tests to implement a run method where the prickly scenarios can be run against an external cluster, as configured by IntegrationTestsDriver&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Having ITs being able to run from command line, or as an integration test or a unit test gives us the most flexible approach. For example, recently added TestLoadAndVerify does have this.&lt;br/&gt;
How do you plan to have IntegrationTestsDriver discover these tests, and figure out the arguments? &lt;/p&gt;</comment>
                            <comment id="13596420" author="ndimiduk" created="Thu, 7 Mar 2013 21:42:42 +0000"  >&lt;p&gt;Yeah, I like how that test is broken out. However, I think having a main per test and also being able to run from IntegrationTestsDriver is redundant. The reality is, the runtime classpath for these tests is a little bit prickly (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7971&quot; title=&quot;mvn clean compile on trunk and 0.95 does not produce target/cached_classpath.txt&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7971&quot;&gt;&lt;del&gt;HBASE-7971&lt;/del&gt;&lt;/a&gt;) and while it would be great for a user to be able to run the IT suite as a smoke-test of an upgrade or fresh install, we don&apos;t exactly make that easy right now.&lt;/p&gt;

&lt;p&gt;My thinking is that a test would configure itself via the run method, no additional arguments necessary. The biggest thing is hooking into Hadoop&apos;s GenericOptionsParser in order to set up an external -conf and any -D overrides the user wants to impose.&lt;/p&gt;</comment>
                            <comment id="13597375" author="nkeywal" created="Fri, 8 Mar 2013 18:25:16 +0000"  >&lt;p&gt;I&apos;m +1 of course.&lt;/p&gt;

&lt;p&gt;I don&apos;t really know the IntegrationTestsDriver, I use maven to run the integration tests (I&apos;m not saying it&apos;s a good thing, actually may be it&apos;s a bad thing). I will have a look.&lt;/p&gt;

&lt;p&gt;If it has not changed recently, we don&apos;t start a mini map reduce cluster when we do a start-hbase not distributed. We should add it may be, to ease manual tests?&lt;br/&gt;
Following the work done in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7840&quot; title=&quot;Enhance the java it framework to start &amp;amp; stop a distributed hbase &amp;amp; hadoop cluster &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7840&quot;&gt;&lt;del&gt;HBASE-7840&lt;/del&gt;&lt;/a&gt;, we could also add the start/stop of the map reduce part.&lt;/p&gt;

&lt;p&gt;Then the integration tests dependending on map reduce could start a real cluster. For the path, I don&apos;t know: if we include the test code in HBase, it will have copied all other the place anyway, so we won&apos;t be able to check this. The code would have to be quite smart to explicitly ask maven to do nothing about it.&lt;/p&gt;

</comment>
                            <comment id="13597391" author="ndimiduk" created="Fri, 8 Mar 2013 18:47:45 +0000"  >&lt;p&gt;In interest in exposure via integration tests is independence from the maven for the target cluster&apos;s classpath. I want to be able to easily run some tests on a real cluster, hence exposure via Tool interface. I don&apos;t think &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7840&quot; title=&quot;Enhance the java it framework to start &amp;amp; stop a distributed hbase &amp;amp; hadoop cluster &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7840&quot;&gt;&lt;del&gt;HBASE-7840&lt;/del&gt;&lt;/a&gt; provides this isolation, but I&apos;m prepared to be incorrect.&lt;/p&gt;</comment>
                            <comment id="13599084" author="ndimiduk" created="Mon, 11 Mar 2013 18:19:19 +0000"  >&lt;p&gt;This patch depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8011&quot; title=&quot;Refactor ImportTsv&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8011&quot;&gt;&lt;del&gt;HBASE-8011&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The new IntegrationTestImportTsv is written in the style of the recently added IntegrationTestLoadAndVerify. It is designed to be run from maven or directly against a distributed cluster. It shares core test logic with TestImportTsv, from which it inherits.&lt;/p&gt;

&lt;p&gt;To run it with maven, first refresh your install jars, and the run the test:&lt;/p&gt;

&lt;p&gt;  $ mvn clean package install -DskipTests&lt;br/&gt;
  $ cd hbase-it&lt;br/&gt;
  $ mvn test-compile failsafe:integration-test -Dit.test=IntegrationTestImportTsv&lt;/p&gt;

&lt;p&gt;Or run it stand-alone:&lt;/p&gt;

&lt;p&gt;  $ HBASE_CLASSPATH=&quot;hbase-it/target/hbase-it-&amp;lt;version&amp;gt;-tests.jar&quot; \&lt;br/&gt;
    ./bin/hbase org.apache.hadoop.hbase.mapreduce.IntegrationTestImportTsv&lt;/p&gt;

&lt;p&gt;When run stand-alone, it supports all the usual Hadoop Tool arguments, particularly -conf.&lt;/p&gt;

&lt;p&gt;ImportTsv was refactored to make code sharing easier. It is upgraded from MediumTest to LargeTest because it take 180+ seconds to run on my machine. Tests for the TsvParser are separated into their own SmallTest.&lt;/p&gt;</comment>
                            <comment id="13599325" author="ndimiduk" created="Mon, 11 Mar 2013 21:19:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8011&quot; title=&quot;Refactor ImportTsv&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8011&quot;&gt;&lt;del&gt;HBASE-8011&lt;/del&gt;&lt;/a&gt; is in, so this one is free and clear.&lt;/p&gt;</comment>
                            <comment id="13600610" author="enis" created="Tue, 12 Mar 2013 23:26:17 +0000"  >&lt;p&gt;This looks good. One nit is to change the test method name generateAndLoad() to start with &quot;test&quot; per convention. &lt;br/&gt;
This does not run using the local mapred job runner, but that is a know issue AFAIR. &lt;br/&gt;
One difference between running from command line and running by: &lt;br/&gt;
HBASE_CLASSPATH=hbase-it/target/hbase-it-0.97-SNAPSHOT-tests.jar bin/hbase org.apache.hadoop.hbase.IntegrationTestsDriver -test IntegrationTestImportTsv&lt;br/&gt;
is that the latter will run all of the tests (both TestImportTsv and IntegrationTestImportTsv) while the former will only run the generateAndLoad() test.&lt;/p&gt;

&lt;p&gt;Also got this exception while running from IntegrationTestsDriver.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
3) testBulkOutputWithoutAnExistingTable(org.apache.hadoop.hbase.mapreduce.IntegrationTestImportTsv)
org.apache.hadoop.mapred.FileAlreadyExistsException: Output directory /Users/enis/projects/svn-repos/hbase/target/test-data/644629ba-0333-473f-ac59-1adc1726ff8c/hfiles already exists
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13600633" author="hadoopqa" created="Tue, 12 Mar 2013 23:54:21 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12573135/0001-HBASE-7938-Add-integration-test-for-ImportTsv-LoadIn.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12573135/0001-HBASE-7938-Add-integration-test-for-ImportTsv-LoadIn.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 11 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): &lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4786//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13601513" author="ndimiduk" created="Wed, 13 Mar 2013 19:12:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;change the test method name generateAndLoad() to start with &quot;test&quot; per convention&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Can do.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;One difference between running from command line and running by: HBASE_CLASSPATH=hbase-it/target/hbase-it-0.97-SNAPSHOT-tests.jar bin/hbase org.apache.hadoop.hbase.IntegrationTestsDriver -test IntegrationTestImportTsv is that the latter will run all of the tests (both TestImportTsv and IntegrationTestImportTsv) while the former will only run the generateAndLoad() test&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s true. I considered using a reflection loop to execute all of the tests under this scenario, but I decided it wasn&apos;t really worth it. Maybe it could be done by programmatically driving JUnit, but getting the conf objects correct looks surprisingly difficult.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also got this exception while running from IntegrationTestsDriver&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This looks like the IntegrationTestingUtility didn&apos;t clean up the test directory after a run. Did you kill or have an error on a previous run?&lt;/p&gt;</comment>
                            <comment id="13601622" author="enis" created="Wed, 13 Mar 2013 20:54:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;I considered using a reflection loop to execute all of the tests under this scenario&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No need to do fancy stuff. We can just call the tests one-by-one within run().&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;This looks like the IntegrationTestingUtility didn&apos;t clean up the test directory after a run. Did you kill or have an error on a previous run?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It might be because, two of the tests use the same output dir. &lt;/p&gt;

</comment>
                            <comment id="13601632" author="ndimiduk" created="Wed, 13 Mar 2013 21:02:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;It might be because, two of the tests use the same output dir.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I wonder why I don&apos;t see that running locally with a pseudo-distributed cluster. I guess I assumed the test util did more for me than it does. I&apos;ll address this with the next patch.&lt;/p&gt;</comment>
                            <comment id="13601945" author="ndimiduk" created="Thu, 14 Mar 2013 01:44:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;No need to do fancy stuff. We can just call the tests one-by-one within run().&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Are you sure? That sounds brittle? IntegrationTestsDriver invokes JUnit manually; I&apos;d prefer to leave this up to the driver.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This looks like the IntegrationTestingUtility didn&apos;t clean up the test directory after a run.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I assumed way too much. HBaseCluster#restoreClusterStatus() does nothing, thus IntegrationTestingUtility#restoreCluster() does nothing. Does this mean paths returned by HBaseTestingUtility#getDataTestDirOnTestFS() are not cleaned after a test? Sad panda.&lt;/p&gt;</comment>
                            <comment id="13601951" author="ndimiduk" created="Thu, 14 Mar 2013 01:52:25 +0000"  >&lt;p&gt;New patch makes use of the subdirectory features of the test util&apos;s test directory method. Running via mvn and IntegrationTestsDriver locally, will report back.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; care to give this patch a go as well?&lt;/p&gt;</comment>
                            <comment id="13601992" author="hadoopqa" created="Thu, 14 Mar 2013 03:02:02 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12573650/0001-HBASE-7938-Add-integration-test-for-ImportTsv-LoadIn.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12573650/0001-HBASE-7938-Add-integration-test-for-ImportTsv-LoadIn.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 11 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 4 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestAtomicOperation&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestSplitLogWorker&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4807//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13602106" author="stack" created="Thu, 14 Mar 2013 07:27:30 +0000"  >&lt;p&gt;They your failures above Mr Nick?&lt;/p&gt;</comment>
                            <comment id="13602110" author="stack" created="Thu, 14 Mar 2013 07:29:43 +0000"  >&lt;p&gt;Skimmed the patch.  It looks excellent.  Nice commit message.  Use as release note?&lt;/p&gt;</comment>
                            <comment id="13602451" author="ndimiduk" created="Thu, 14 Mar 2013 17:19:26 +0000"  >&lt;p&gt;I don&apos;t believe those failures belong to me. I&apos;m having issues with local runs now...&lt;/p&gt;</comment>
                            <comment id="13602532" author="stack" created="Thu, 14 Mar 2013 18:18:06 +0000"  >&lt;p&gt;Yeah, was going to suggest rerunning your patch (you might have to reapply same patch IIRC).&lt;/p&gt;</comment>
                            <comment id="13602576" author="enis" created="Thu, 14 Mar 2013 19:03:50 +0000"  >&lt;p&gt;Let me retry this one more time on pseudo cluster. &lt;/p&gt;</comment>
                            <comment id="13602601" author="ndimiduk" created="Thu, 14 Mar 2013 19:18:24 +0000"  >&lt;p&gt;How do you guys let me get away with this slop?&lt;/p&gt;

&lt;p&gt;New patch, cleans up:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;deleted redundant code from TestImportTsv, using existing code in the test utilities.&lt;/li&gt;
	&lt;li&gt;added a couple helpers to HBaseCommonTestingUtility.&lt;/li&gt;
	&lt;li&gt;set dataTestDirOnTestFS to deleteOnExit when TestFS is local. This matched behavior of when TestFS is not local.&lt;/li&gt;
	&lt;li&gt;IntegrationTestImportTsv no longer extends TestImportTsv, primarily because the IT suffered a kind of split-brain syndrom when resolving the Configuration. Instead of inheritance, just helpers in test utils and protected static methods from ImportTsv.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The test works as intended when run stand-alone, but FAILS when run via maven. It looks like HFileOutputFormat is creating the paritions file on localFs instead of HDFS. I don&apos;t yet know why, but my most recent patch on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4285&quot; title=&quot;partitions file created in user&amp;#39;s home directory by importtsv&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4285&quot;&gt;&lt;del&gt;HBASE-4285&lt;/del&gt;&lt;/a&gt; gets rid of that nonsense, at least in part. I&apos;ll try rebasing that patch onto this one and see how the test behaves.&lt;/p&gt;</comment>
                            <comment id="13602618" author="stack" created="Thu, 14 Mar 2013 19:37:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;How do you guys let me get away with this slop?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Thanks for cleaning it up &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt;.  When you are done w/ the dishes, the silver needs some polish (if you can find any left over which I doubt going by the kind of characters you see hanging out in these parts)&lt;/p&gt;</comment>
                            <comment id="13602664" author="hadoopqa" created="Thu, 14 Mar 2013 20:18:32 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12573753/0001-HBASE-7938-Add-integration-test-for-ImportTsv-LoadIn.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12573753/0001-HBASE-7938-Add-integration-test-for-ImportTsv-LoadIn.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 14 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4820//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13602673" author="stack" created="Thu, 14 Mar 2013 20:25:15 +0000"  >&lt;p&gt;I will commit in a few unless objection.&lt;/p&gt;</comment>
                            <comment id="13602681" author="enis" created="Thu, 14 Mar 2013 20:28:48 +0000"  >&lt;p&gt;Give me 5 to test the latest patch, pls. &lt;/p&gt;</comment>
                            <comment id="13602689" author="stack" created="Thu, 14 Mar 2013 20:35:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; Even better.   Take your time.  I&apos;ll let you commit.&lt;/p&gt;</comment>
                            <comment id="13602693" author="ndimiduk" created="Thu, 14 Mar 2013 20:37:54 +0000"  >&lt;p&gt;Rebased &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4285&quot; title=&quot;partitions file created in user&amp;#39;s home directory by importtsv&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4285&quot;&gt;&lt;del&gt;HBASE-4285&lt;/del&gt;&lt;/a&gt; and the integration test passes both via maven and against pseudo-distributed.&lt;/p&gt;</comment>
                            <comment id="13602698" author="enis" created="Thu, 14 Mar 2013 20:42:26 +0000"  >&lt;p&gt;Thanks boss. Sorry to keep the patch up. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
cd hbase-it; mvn verify -Dit.test=IntegrationTestImportTsv 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;fails. I think it may be because of&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-03-14 13:38:38,239 WARN  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-248] mapred.LocalJobRunner$Job(298): job_local_0001
java.lang.IllegalArgumentException: Can&amp;amp;apos;t read partitions file
  at org.apache.hadoop.mapreduce.lib.partition.TotalOrderPartitioner.setConf(T
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I guess you had an open issue for this, right? Should we launch up a mini dfs + mapred cluster for running it as a unit test? &lt;/p&gt;

&lt;p&gt;Second question is that, whether we need to run the other 2 tests in TestImportTsv in IT mode? &lt;/p&gt;</comment>
                            <comment id="13602729" author="ndimiduk" created="Thu, 14 Mar 2013 20:59:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;I guess you had an open issue for this, right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah, that&apos;s what I ment when I said &quot;The test works as intended when run stand-alone, but FAILS when run via maven. It looks like HFileOutputFormat is creating the paritions file on localFs instead of HDFS.&quot; The test does spin up a cluster + mapred via IntegrationTestingUtility. Scroll back in the logs and you&apos;ll see &lt;tt&gt;INFO mapreduce.HFileOutputFormat: Writing partition information to&lt;/tt&gt; and then a long local file path. That path ends up not existing when the TotalOrderPartitioner gets around to looking for it; I don&apos;t know why. You&apos;ll also see an error about &quot;unable to create symlink&quot; a little later on, because that file path no longer exists.&lt;/p&gt;

&lt;p&gt;This business is fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4285&quot; title=&quot;partitions file created in user&amp;#39;s home directory by importtsv&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4285&quot;&gt;&lt;del&gt;HBASE-4285&lt;/del&gt;&lt;/a&gt;. I do away with the symlink stuff and drop the partitions file in /tmp instead of the working directory. I also request that the file be deleted at FS close.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Second question is that, whether we need to run the other 2 tests in TestImportTsv in IT mode?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The point of the integration test (in my mind) is that it can be run on a real cluster. If that&apos;s desirable for the tests in TestImportTsv, they might as well be merged. The alternative is to try setting up TestImportTsv with a main that can be run w.o maven.&lt;/p&gt;

&lt;p&gt;Personally, I don&apos;t think we gain very much by having the integration test stuff tied into maven. We don&apos;t have a persistent cluster that Jenkins can run them against, so when they run through maven they&apos;re using the minicluster, same as regular tests. After my experience with this thing, I think we&apos;re better off writing them all as Tools with a main that can be run against an externally specified conf.&lt;/p&gt;</comment>
                            <comment id="13602754" author="enis" created="Thu, 14 Mar 2013 21:08:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;This business is fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4285&quot; title=&quot;partitions file created in user&amp;#39;s home directory by importtsv&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4285&quot;&gt;&lt;del&gt;HBASE-4285&lt;/del&gt;&lt;/a&gt;. I do away with the symlink stuff and drop the partitions file in /tmp instead of the working directory. I also request that the file be deleted at FS close.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ok, we can get &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4285&quot; title=&quot;partitions file created in user&amp;#39;s home directory by importtsv&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4285&quot;&gt;&lt;del&gt;HBASE-4285&lt;/del&gt;&lt;/a&gt; committed after this. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The point of the integration test (in my mind) is that it can be run on a real cluster. If that&apos;s desirable for the tests in TestImportTsv, they might as well be merged&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I haven&apos;t inspected the tests in TestImportTsv. It is your call, if you think that we don&apos;t need them in IT, it is fine. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Personally, I don&apos;t think we gain very much by having the integration test stuff tied into maven.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;There is some value to running these tests in mini cluster more as well. But the bigger value is to run them against an actual cluster. Whether we run it via maven or IntegrationTestsDriver is a matter of convenience I think. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I think we&apos;re better off writing them all as Tools with a main that can be run against an externally specified conf&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think it is also necessary for these tests to be discoverable and run automatically from maven / IntegrationTestsDriver. We could not expect all of the users to know every test. But if we could be in a state where we can rely on these tests 100%, then we can say to the users that, once you setup your cluster, run these tests to see whether there is anything wrong with the setup. &lt;/p&gt;</comment>
                            <comment id="13602782" author="ndimiduk" created="Thu, 14 Mar 2013 21:27:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;It is your call, if you think that we don&apos;t need them in IT, it is fine.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Their inclusion was not my original intention. They snuck in via inheritance, and I thought it a nice to have. That was before I ran into the config split-brain problem. It would be nice to have them available for running in IT, but that&apos;s not my immediate goal here.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;But the bigger value is to run them against an actual cluster. Whether we run it via maven or IntegrationTestsDriver is a matter of convenience I think.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I agree on the actual cluster bit. How do you point a maven-run test against a real cluster? I don&apos;t see that functionality available as of now. Perhaps there&apos;s an incantation of IntegrationTestingUtility that I&apos;m unaware of. Further, maven does enough classpath nonsense on our behalf that I wouldn&apos;t trust it as, say, a driver for post-deploy smoke-tests. My opinion is the best way to know if something is broken or not is to run it via bin/hadoop or bin/hbase; don&apos;t let maven &quot;help&quot; with the classpath.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think it is also necessary for these tests to be discoverable and run automatically from maven / IntegrationTestsDriver.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Longer term, it would be great to be able to run any test that spins up a mini-cluster against a real one. I agree with you on the auto-discoverability part. IntegrationTestsDriver appears to do this with a class filter. Automating it with a script in bin would be ideal.&lt;/p&gt;</comment>
                            <comment id="13602810" author="enis" created="Thu, 14 Mar 2013 22:01:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;It would be nice to have them available for running in IT, but that&apos;s not my immediate goal here.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ok great, I&apos;ll commit this one then. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I agree on the actual cluster bit. How do you point a maven-run test against a real cluster? I don&apos;t see that functionality available as of now&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You are right that as of now, you cannot run ITs with maven against an actual cluster. With some maven dark magic, it should be possible. It should help with integrating the tests with external tools (like jenkins or bigtop invoking these tests), but I did not have the time to implement that. &lt;/p&gt;</comment>
                            <comment id="13602840" author="enis" created="Thu, 14 Mar 2013 22:32:02 +0000"  >&lt;p&gt;Committed this to 0.95 and trunk. Thanks Nick. &lt;/p&gt;</comment>
                            <comment id="13602951" author="hudson" created="Fri, 15 Mar 2013 00:46:20 +0000"  >&lt;p&gt;Integrated in hbase-0.95 #74 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/74/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/74/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7938&quot; title=&quot;Add integration test for ImportTsv/LoadIncrementalHFiles workflow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7938&quot;&gt;&lt;del&gt;HBASE-7938&lt;/del&gt;&lt;/a&gt; Add integration test for ImportTsv/LoadIncrementalHFiles workflow (Nick Dimiduk) (Revision 1456701)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce/IntegrationTestImportTsv.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportTsv.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportTsvParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13602977" author="hudson" created="Fri, 15 Mar 2013 01:03:39 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3960 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3960/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3960/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7938&quot; title=&quot;Add integration test for ImportTsv/LoadIncrementalHFiles workflow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7938&quot;&gt;&lt;del&gt;HBASE-7938&lt;/del&gt;&lt;/a&gt; Add integration test for ImportTsv/LoadIncrementalHFiles workflow (Nick Dimiduk) (Revision 1456700)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce/IntegrationTestImportTsv.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportTsv.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportTsvParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13603180" author="hudson" created="Fri, 15 Mar 2013 06:17:39 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #448 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/448/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/448/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7938&quot; title=&quot;Add integration test for ImportTsv/LoadIncrementalHFiles workflow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7938&quot;&gt;&lt;del&gt;HBASE-7938&lt;/del&gt;&lt;/a&gt; Add integration test for ImportTsv/LoadIncrementalHFiles workflow (Nick Dimiduk) (Revision 1456700)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce/IntegrationTestImportTsv.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportTsv.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportTsvParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13603198" author="hudson" created="Fri, 15 Mar 2013 07:06:45 +0000"  >&lt;p&gt;Integrated in hbase-0.95-on-hadoop2 #27 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95-on-hadoop2/27/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95-on-hadoop2/27/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7938&quot; title=&quot;Add integration test for ImportTsv/LoadIncrementalHFiles workflow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7938&quot;&gt;&lt;del&gt;HBASE-7938&lt;/del&gt;&lt;/a&gt; Add integration test for ImportTsv/LoadIncrementalHFiles workflow (Nick Dimiduk) (Revision 1456701)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
enis : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-it/src/test/java/org/apache/hadoop/hbase/mapreduce/IntegrationTestImportTsv.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportTsv.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportTsvParser.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13775153" author="stack" created="Mon, 23 Sep 2013 18:30:51 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12634017">HBASE-7934</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12628723">HBASE-7644</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12531695">HBASE-4802</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12635471">HBASE-8011</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12520651">HBASE-4285</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12573753" name="0001-HBASE-7938-Add-integration-test-for-ImportTsv-LoadIn.patch" size="42858" author="ndimiduk" created="Thu, 14 Mar 2013 19:18:24 +0000"/>
                            <attachment id="12573650" name="0001-HBASE-7938-Add-integration-test-for-ImportTsv-LoadIn.patch" size="39260" author="ndimiduk" created="Thu, 14 Mar 2013 01:52:25 +0000"/>
                            <attachment id="12573135" name="0001-HBASE-7938-Add-integration-test-for-ImportTsv-LoadIn.patch" size="39162" author="ndimiduk" created="Mon, 11 Mar 2013 18:19:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 26 Feb 2013 20:57:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314526</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1i9xz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314870</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>The new IntegrationTestImportTsv is written in the style of the&lt;br/&gt;
recently added IntegrationTestLoadAndVerify. It is designed to be run&lt;br/&gt;
from maven or directly against a distributed cluster. It shares core&lt;br/&gt;
test logic with TestImportTsv.&lt;br/&gt;
&lt;br/&gt;
To run it with maven, first refresh your install jars, and the run the&lt;br/&gt;
test:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;$ mvn clean package install -DskipTests&lt;br/&gt;
&amp;nbsp;&amp;nbsp;$ cd hbase-it&lt;br/&gt;
&amp;nbsp;&amp;nbsp;$ mvn failsafe:integration-test -Dit.test=IntegrationTestImportTsv&lt;br/&gt;
&lt;br/&gt;
NOTE: Running from maven fails because HFileOutputFormat is creating&lt;br/&gt;
the partition file on localFs, not HDFS.&lt;br/&gt;
&lt;br/&gt;
Or run it stand-alone:&lt;br/&gt;
&lt;br/&gt;
&amp;nbsp;&amp;nbsp;$ HBASE_CLASSPATH=&amp;quot;hbase-it/target/hbase-it-&amp;lt;version&amp;gt;-tests.jar&amp;quot; \&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;./bin/hbase org.apache.hadoop.hbase.mapreduce.IntegrationTestImportTsv&lt;br/&gt;
&lt;br/&gt;
When run stand-alone, it supports all the usual Hadoop Tool arguments,&lt;br/&gt;
particularly -conf.&lt;br/&gt;
&lt;br/&gt;
ImportTsv was refactored to make code sharing easier. It is upgraded&lt;br/&gt;
from MediumTest to LargeTest because it take 180+ seconds to run on my&lt;br/&gt;
machine. Tests for the TsvParser are separated into their own&lt;br/&gt;
SmallTest.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>