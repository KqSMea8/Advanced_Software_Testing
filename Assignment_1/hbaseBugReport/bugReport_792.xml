<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:47:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-792/HBASE-792.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-792] Rewrite getClosestAtOrJustBefore; doesn&apos;t scale as currently written</title>
                <link>https://issues.apache.org/jira/browse/HBASE-792</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;As currently written, as a table gets bigger, the number of rows .META. needs to keep count of grows.&lt;/p&gt;

&lt;p&gt;As written, our getClosestAtOrJustBefore, goes through every storefile and in each picks up any row that could be a possible candidate for closest before.  It doesn&apos;t just get the closest from the storefile, but all keys that are closest before.  Its not selective because how can it tell at the store file level which of the candidates will survive deletes that are sitting in later store files or up in memcache.&lt;/p&gt;

&lt;p&gt;So, if a store file has keys 0-10 and we ask to get the row that is closest or just before 7, it returns rows 0-7.. and so on per store file.&lt;/p&gt;

&lt;p&gt;Can bet big and slow weeding key wanted.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12401453">HBASE-792</key>
            <summary>Rewrite getClosestAtOrJustBefore; doesn&apos;t scale as currently written</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Aug 2008 02:55:00 +0000</created>
                <updated>Tue, 7 Dec 2010 20:41:54 +0000</updated>
                            <resolved>Tue, 7 Dec 2010 20:41:54 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12619116" author="stack" created="Fri, 1 Aug 2008 20:23:49 +0000"  >&lt;p&gt;My fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-751&quot; title=&quot;dfs exception and regionserver stuck during heavy write load&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-751&quot;&gt;&lt;del&gt;HBASE-751&lt;/del&gt;&lt;/a&gt; introduced this issue, thinking on it.  With this in place, it could get to a place where every request for closestAtOrBefore could end up loading all that is out on the filesystem, all of the flushes.&lt;/p&gt;

&lt;p&gt;We still need to rewrite this stuff; the number of seeks done per closestAtOrBefore can be astronomical but this patch takes off some of the heat.&lt;/p&gt;

&lt;p&gt;This patch narrows the number of possible candidates that come back.  &lt;/p&gt;

&lt;p&gt;It goes first to the memcache to find candidate rows.&lt;/p&gt;

&lt;p&gt;While there, it puts any deletes found between ultimate candidate and desired row into new delete Set.  This delete set is then carried down through the walk of store files.  We add new deletes as we encounter them so that candidates in older store files don&apos;t shine through if they&apos;ve been deleted earlier.&lt;/p&gt;</comment>
                            <comment id="12619126" author="jimk" created="Fri, 1 Aug 2008 20:54:33 +0000"  >&lt;p&gt;Patch looks good +1&lt;/p&gt;</comment>
                            <comment id="12619134" author="stack" created="Fri, 1 Aug 2008 21:03:34 +0000"  >&lt;p&gt;Committed 792.patch.  Leaving issue open.  Close after we do rewrite.&lt;/p&gt;</comment>
                            <comment id="12665996" author="stack" created="Wed, 21 Jan 2009 23:00:01 +0000"  >&lt;p&gt;This can actually be responsible for slowing down whole cluster (J-D saw it in 0.18 hbase up on his openspaces cluster)&lt;/p&gt;</comment>
                            <comment id="12701772" author="stack" created="Thu, 23 Apr 2009 00:56:21 +0000"  >&lt;p&gt;Moving it out.  KeyValue changes plus caching may put need for this off a while.&lt;/p&gt;</comment>
                            <comment id="12711273" author="stack" created="Wed, 20 May 2009 18:22:08 +0000"  >&lt;p&gt;I think this is being done in 0.20.0 as part of major refactor.  Bringing in.&lt;/p&gt;</comment>
                            <comment id="12716103" author="stack" created="Wed, 3 Jun 2009 23:47:52 +0000"  >&lt;p&gt;Moving out of 0.20.0.  Not going to happen unless its already done as part of hbase-1304 (haven&apos;t heard).&lt;/p&gt;</comment>
                            <comment id="12744183" author="stack" created="Mon, 17 Aug 2009 20:23:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1761&quot; title=&quot;getclosest doesn&amp;#39;t understand delete family; manifests as &amp;quot;HRegionInfo was null or empty in .META&amp;quot; A.K.A the BS problem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1761&quot;&gt;&lt;del&gt;HBASE-1761&lt;/del&gt;&lt;/a&gt; rewrote getclosestatorbefore.  Code is much cleaner and more focused on the target key.  We can do this now because of such as the axiom that deletes only apply to the flie that follows.  Doesn&apos;t carry around bulky Maps of candidates nor of deletes (now we have new style deletes) any more so should be more performant.&lt;/p&gt;

&lt;p&gt;The one thing left to do is an early-out if we get an answer early in the processing &amp;#8211; in memstore say.  I tried to do this as part of hbase-1761 but only worked if client asked for the first row in a region. Need to make it so getclosest when a meta table leverages HRegionInfo.  If target row key falls between the start and end key or the region, answer is the one we want so exit.&lt;/p&gt;</comment>
                            <comment id="12968962" author="stack" created="Tue, 7 Dec 2010 20:41:54 +0000"  >&lt;p&gt;Resolving as done for now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12387369" name="792.patch" size="25346" author="stack" created="Fri, 1 Aug 2008 20:23:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 1 Aug 2008 20:54:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25402</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h9h3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98797</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>