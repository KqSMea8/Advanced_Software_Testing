<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:24:07 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11536/HBASE-11536.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11536] Puts of region location to Meta may be out of order which causes inconsistent of region location</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11536</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In product hbase cluster, we found inconsistency of region location in the meta table. Region cdfa2ed711bbdf054d9733a92fd43eb5 is onlined in regionserver 10.237.12.13:11600 but the region location in Meta table is 10.237.12.15:11600.&lt;br/&gt;
This is because of the out-of-order puts for meta table.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;HMaster try to assign the region to 10.237.12.15:11600.&lt;/li&gt;
	&lt;li&gt;RegionServer: 10.237.12.15:11600. During the opening the region, the put of region location(10.237.12.15:11600) to meta table is timeout(60s) and the htable retry for second time. (regionserver serving meta has got the request of the put. The timeout is beause  ther is a bad disk in this regionserver and sync of hlog is very slow.&lt;br/&gt;
)&lt;br/&gt;
During the retry in htable, the OpenRegionHandler is timeout(100s) and the PostOpenDeployTasksThread is interrupted. Through the htable is closed in the MetaEditor finally, the share connection the htable used is not closed and the call of put for meta table is on-flying in the connection. Assumed that this on-flying call of put to meta is  named call A.&lt;/li&gt;
	&lt;li&gt;RegionServer: 10.237.12.15:11600. For the timeout of OpenRegionHandler, the OpenRegionHandler marks the assign state of this region to FAILED_OPEN.&lt;/li&gt;
	&lt;li&gt;HMaster watchs this event of FAILED_OPEN and assigns the region to another regionserver: 10.237.12.13:11600&lt;/li&gt;
	&lt;li&gt;RegionServer: 10.237.12.13:11600. This regionserver opens the region successfully . Assumed that the put of region location(10.237.12.13:11600) to meta table in this regionserver is named B.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;There is no order guarantee for call A and B. If call A is processed after call B in regionserver serving meta region, the region location in meta table will be wrong.&lt;/p&gt;

&lt;p&gt;From the raw scan of meta table we found:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scan &apos;.META.&apos;, {RAW =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, LIMIT =&amp;gt; 1, VERSIONS =&amp;gt; 10, STARTROW =&amp;gt; &apos;xxx.adfa2ed711bbdf054d9733a92fd43eb5.&apos;} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;

&lt;p&gt;xxx.adfa2ed711bbdf054d9733a92fd43eb5. column=info:server, timestamp=1404885460553(=&amp;gt; Wed Jul 09 13:57:40 +0800 2014), value=10.237.12.15:11600 --&amp;gt; Retry put from 10.237.12.15&lt;/p&gt;

&lt;p&gt;xxx.adfa2ed711bbdf054d9733a92fd43eb5. column=info:server, timestamp=1404885456731(=&amp;gt; Wed Jul 09 13:57:36 +0800 2014), value=10.237.12.13:11600 --&amp;gt; put from 10.237.12.13&lt;/p&gt;

&lt;p&gt;xxx.adfa2ed711bbdf054d9733a92fd43eb5. column=info:server, timestamp=1404885353122( Wed Jul 09 13:55:53 +0800 2014), value=10.237.12.15:11600  --&amp;gt; First put from 10.237.12.15&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Related hbase log is attached in this issue and disscusions are welcomed.&lt;/p&gt;

&lt;p&gt;For there is no order guarantee for puts from different htables, one solution for this issue is to give an increased id for each assignment of a region and use this id as the timestamp of put of region location to meta table. The region location with large assign id will be got by hbase clients.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12727872">HBASE-11536</key>
            <summary>Puts of region location to Meta may be out of order which causes inconsistent of region location</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liushaohui">Liu Shaohui</assignee>
                                    <reporter username="liushaohui">Liu Shaohui</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Jul 2014 08:03:53 +0000</created>
                <updated>Tue, 19 May 2015 01:35:37 +0000</updated>
                            <resolved>Mon, 25 Aug 2014 19:01:32 +0000</resolved>
                                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.94.23</fixVersion>
                    <fixVersion>0.98.6</fixVersion>
                                    <component>Region Assignment</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>14</watches>
                                                                <comments>
                            <comment id="14064754" author="tianq" created="Thu, 17 Jul 2014 09:46:42 +0000"  >&lt;p&gt;my 2 cents..&lt;br/&gt;
it is about tolerance vs exposure...tolerance provides more robustness, exposure provides in-time warning to avoid it gets worse..&lt;/p&gt;

&lt;p&gt;Considering the importance of meta data and ease of cluster management and PD, personally I prefer exposure policy.(e.g. meta data write must be successful - put to meta table without retry&amp;amp;timeout )&lt;/p&gt;</comment>
                            <comment id="14064768" author="liushaohui" created="Thu, 17 Jul 2014 10:03:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tianq&quot; class=&quot;user-hover&quot; rel=&quot;tianq&quot;&gt;Qiang Tian&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Considering the importance of meta data and ease of cluster management and PD, personally I prefer exposure policy.(e.g. meta data write must be successful - put to meta table without retry&amp;amp;timeout )&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Even there is no retry and timeout for put to meta , this inconsistent also may happen.&lt;br/&gt;
The root cause is that there is no order guarantee for puts from different htables.&lt;br/&gt;
A extreme example is that the order of two call of two  same row puts in call queue may be different with the order they be  processed in HRegionServer.&lt;/p&gt;</comment>
                            <comment id="14064835" author="liushaohui" created="Thu, 17 Jul 2014 11:33:49 +0000"  >&lt;p&gt;HRegionServer log for this issue.&lt;/p&gt;</comment>
                            <comment id="14065367" author="stack" created="Thu, 17 Jul 2014 18:56:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=liushaohui&quot; class=&quot;user-hover&quot; rel=&quot;liushaohui&quot;&gt;Liu Shaohui&lt;/a&gt; Nice debugging.  On region open, we pass a sequenceid (the zkid).  In 0.94 it is this:   &quot;public RegionOpeningState openRegion(HRegionInfo region, int versionOfOfflineNode)&quot;.  Use this as timestamp?  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; You&apos;d like this one.&lt;/p&gt;</comment>
                            <comment id="14065400" author="jxiang" created="Thu, 17 Jul 2014 19:19:50 +0000"  >&lt;p&gt;Yes, nice debugging. The problem here seems to be because we assume a timed-out call failed, but it could succeed, and with the newer version, unfortunately.  Will using the current timestamp in the client as the version in creating the Put object help, instead of using the default LATEST_TIMESTAMP, assuming the time-skew among these servers is small, and re-assignment takes a little time?&lt;/p&gt;

&lt;p&gt;BTW, ZKLess assignment should help since meta update is only done by master. &lt;/p&gt;</comment>
                            <comment id="14065907" author="tianq" created="Fri, 18 Jul 2014 02:12:01 +0000"  >&lt;p&gt;Hi Shaorui,&lt;br/&gt;
if I read the code correctly, normal client put is different from this regionserver put case. &lt;br/&gt;
the order issue you mentioned looks not an issue in most cases..&lt;br/&gt;
1)for normal client put,  suppose multiple clients put the same row, the requests go to the same regionserver. the rpc thread(&lt;tt&gt;processRowsWithLocks&lt;/tt&gt;) gives the timestamp when it hit that code path (&lt;tt&gt;EnvironmentEdgeManager.currentTimeMillis()&lt;/tt&gt;) . yes, in most cases they are processed by concurrent rpc handlers,  but from regionserver&apos;s perspective, the timestamp is unique --based on the sequence they are processed.&lt;/p&gt;


&lt;p&gt;2)for regionserver put, as you showed, there are 2 regionserver trying to put the same row,  the timestamp comes from 2 regionservers, so the sequence semantics based on timestamp is broken. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;, using client timestamp looks not working or hard to predict ? since they are from different sources?&lt;/p&gt;

&lt;p&gt;thanks.&lt;/p&gt;
</comment>
                            <comment id="14065915" author="liushaohui" created="Fri, 18 Jul 2014 02:28:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tianq&quot; class=&quot;user-hover&quot; rel=&quot;tianq&quot;&gt;Qiang Tian&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;2)for regionserver put, as you showed, there are 2 regionserver trying to put the same row, the timestamp comes from 2 regionservers, so the sequence semantics based on timestamp is broken.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In current codebase, the timestamp of meta puts is assigned by the regionserver serving meta region, not from 2 regionservers.&lt;br/&gt;
The problem is that the order of timestamp assigned is different from the order in which the puts are sent.&lt;/p&gt;</comment>
                            <comment id="14065964" author="tianq" created="Fri, 18 Jul 2014 03:14:25 +0000"  >&lt;p&gt;Thanks Shaohui,&lt;br/&gt;
but it looks using a shortCircuitConnection?  please see stacktrace in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11524&quot; title=&quot;TestReplicaWithCluster#testChangeTable and TestReplicaWithCluster#testCreateDeleteTable fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11524&quot;&gt;&lt;del&gt;HBASE-11524&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;
</comment>
                            <comment id="14066005" author="tianq" created="Fri, 18 Jul 2014 04:24:41 +0000"  >&lt;p&gt;oops I looked at the latest code(master branch), i.e. master is already a regionserver.  sendRegionOpen-&amp;gt;getRsAdmin returns getRSRpcServices. if a regionserver can execute openregion RPC and update meta with shortcircuit connection, it must be the master...&lt;/p&gt;</comment>
                            <comment id="14066137" author="liushaohui" created="Fri, 18 Jul 2014 07:31:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;On region open, we pass a sequenceid (the zkid). In 0.94 it is this: &quot;public RegionOpeningState openRegion(HRegionInfo region, int versionOfOfflineNode)&quot;. Use this as timestamp?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Good suggestion.&lt;br/&gt;
I will revisit the code about the versionOfOfflineNode in region assign and check if there are others potential risks.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Will using the current timestamp in the client as the version in creating the Put object help, instead of using the default LATEST_TIMESTAMP, assuming the time-skew among these servers is small, and re-assignment takes a little time?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think we can&apos;t depend on that time-skew among these servers is small. &lt;/p&gt;</comment>
                            <comment id="14066143" author="liushaohui" created="Fri, 18 Jul 2014 07:44:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;&lt;br/&gt;
What&apos;s about adding  the region assigning time in HMaster to openRegion request and using this time as the timestamp of put to meta?&lt;br/&gt;
Using versionOfOfflineNode will add more dependence on zk.&lt;br/&gt;
If the active HMaster failed, the failover time of Master usually is larger than the time-skew among HMasters.&lt;/p&gt;</comment>
                            <comment id="14066165" author="tianq" created="Fri, 18 Jul 2014 08:37:16 +0000"  >&lt;p&gt;hi Shaohui,&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The timeout is beause ther is a bad disk in this regionserver and sync of hlog is very slow.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;out of curiosity,  when you guys finally realized the regionserver problem? did it cause other problems? if yes, that might support to expose the problem as soon as possible? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14066181" author="liushaohui" created="Fri, 18 Jul 2014 09:07:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tianq&quot; class=&quot;user-hover&quot; rel=&quot;tianq&quot;&gt;Qiang Tian&lt;/a&gt;&lt;br/&gt;
The table get NotServingRegionException when accessing that region and we found there is problem in meta table and that regionServer.&lt;br/&gt;
In a time window,  we found the hlog sync is very slow with patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11240&quot; title=&quot;Print hdfs pipeline when hlog&amp;#39;s sync is slow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11240&quot;&gt;&lt;del&gt;HBASE-11240&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;From the attached regionserver&apos;s log, you will find that:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-07-09,13:57:36,058 WARN org.apache.hadoop.hbase.ipc.SecureServer: Call #280112; TooSlow; Served: HRegionInterface#multi queueTime=1 processingTime=90068 contents=1 values [ min=270 max=270 avg=270 ], 1 Put, 1 KeyValue
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To reproduce this problem, you can do some hack in the HRegion to make the puts from a regionserver to Meta delayed for 80s. &lt;/p&gt;</comment>
                            <comment id="14066197" author="tianq" created="Fri, 18 Jul 2014 09:45:39 +0000"  >&lt;p&gt;Hi Shaohui,&lt;br/&gt;
thanks for details!&lt;br/&gt;
that is what I guessed - the problem is exposed else where at a later time.  this looks not friendly to monitoring and PD. instead, without retry&amp;amp;timeout for meta put,  upper layer policy(OpenRegionHandler timeout) could have more choices, reassign the region, or even reassign the meta region since it is a clear sign that the regionserver got problem..&lt;br/&gt;
anyway, just brainstorming for different ideas. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="14066473" author="jxiang" created="Fri, 18 Jul 2014 16:08:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think we can&apos;t depend on that time-skew among these servers is small. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is a long existing issue. It&apos;s so rare that I think using the regionserver timestamp as the version is a good enhancement, especially since we are moving away from ZK for assignment.&lt;/p&gt;</comment>
                            <comment id="14066505" author="stack" created="Fri, 18 Jul 2014 16:45:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;Using versionOfOfflineNode will add more dependence on zk.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Currently it is the zk sequenceid, yes, but nothing says that this long has to come from zk; master could assign it from any source.  In zk-less assignment, IIRC, it is just ignored.  In a trunk version of the patch to address this issue, we might add the master keeping up a sequenceid for use by such as region open.&lt;/p&gt;

&lt;p&gt;In your 0.94 context, I was thinking that relying on zk to do the reliable, incrementing sequence id would be ok.  You could get a &apos;fix&apos; for small code change.  In trunk we&apos;d have to do a little more work.&lt;/p&gt;

&lt;p&gt;I agree with your that relying on timestamps, while it would work 9.99999999999999999999% of the time, because of the murphy&apos;s law, the one time it fails, it&apos;d be a high profile situation and we&apos;d all have to go home (smile).&lt;/p&gt;
</comment>
                            <comment id="14074201" author="liushaohui" created="Fri, 25 Jul 2014 08:29:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;&lt;br/&gt;
Agree that the one time it fails, it&apos;d be a high profile situation and we&apos;d fix it.&lt;/p&gt;

&lt;p&gt;Using versionOfOfflineNode has a potential risk that if we migrate an existing hbase cluster from a zk cluster from a new one, this method will not works.&lt;/p&gt;

&lt;p&gt;After an dicussion with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fenghh&quot; class=&quot;user-hover&quot; rel=&quot;fenghh&quot;&gt;Honghua Feng&lt;/a&gt;,  we agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;&apos;s suggestion: using the regionserver timestamp as the version. The deafult timeout of update meta is 100s which is far larger than time-skew between regionservers. And we have an alert if time-skew between hbase server and ntp server is larger than 100ms.&lt;/p&gt;

&lt;p&gt;In a long term, i think the update for meta only be done in one process eg: HMaster, which decide which update is illegal according the state machine in it.&lt;/p&gt;

&lt;p&gt;Another related problem is the META region location(for trunk). It&apos;s possible that the updates of META region locations are out of order when the opening of meta region is timeout.&lt;/p&gt;

&lt;p&gt;Looking forward your suggestion. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="14074203" author="liushaohui" created="Fri, 25 Jul 2014 08:30:20 +0000"  >&lt;p&gt;A patch for 0.94 using the regionserver timestamp as the version of meta put.&lt;/p&gt;</comment>
                            <comment id="14076759" author="stack" created="Mon, 28 Jul 2014 20:22:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;In a long term, i think the update for meta only be done in one process eg: HMaster, which decide which update is illegal according the state machine in it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.&lt;/p&gt;

&lt;p&gt;Currently if skew, we just WARN unless big difference:&lt;/p&gt;

&lt;p&gt;     maxSkew = c.getLong(&quot;hbase.master.maxclockskew&quot;, 30000);&lt;br/&gt;
     warningSkew = c.getLong(&quot;hbase.master.warningclockskew&quot;, 10000);&lt;/p&gt;

&lt;p&gt;I&apos;d be good w/ this patch for now given direction is one meta table editor only.  What you think mighty &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14076780" author="jxiang" created="Mon, 28 Jul 2014 20:30:26 +0000"  >&lt;p&gt;I am ok with it. +1.&lt;/p&gt;</comment>
                            <comment id="14081429" author="apurtell" created="Thu, 31 Jul 2014 20:41:21 +0000"  >&lt;p&gt;Setting fix versions. Please change if you disagree&lt;/p&gt;</comment>
                            <comment id="14081432" author="apurtell" created="Thu, 31 Jul 2014 20:42:02 +0000"  >&lt;p&gt;Happy to have it in 0.98.5 if there&apos;s a patch available in time for this coming Monday.&lt;/p&gt;</comment>
                            <comment id="14107860" author="lhofhansl" created="Sat, 23 Aug 2014 04:51:56 +0000"  >&lt;p&gt;Nice debugging. +1 on patch.&lt;br/&gt;
(we do assume in many places that the time skew between region server is less than the time it takes to move a region between server, so is this not making things worse)&lt;/p&gt;

&lt;p&gt;Mind making patches for the other branches too (0.98, 1.0, 2.0)? If not that&apos;s cool, I&apos;m happy to do it.&lt;/p&gt;</comment>
                            <comment id="14108738" author="lhofhansl" created="Mon, 25 Aug 2014 05:03:29 +0000"  >&lt;p&gt;Here&apos;s what I think this should be in trunk. MetaEditor is gone, I assume MetaTableAccessor is the right spot.&lt;/p&gt;

&lt;p&gt;I would like this in before 0.94.23.&lt;/p&gt;</comment>
                            <comment id="14108818" author="hadoopqa" created="Mon, 25 Aug 2014 06:44:53 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12664095/11536-trunk.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12664095/11536-trunk.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12664095&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 6 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.regionserver.TestRegionReplicaReplicationEndpoint&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10559//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14109440" author="lhofhansl" created="Mon, 25 Aug 2014 18:17:56 +0000"  >&lt;p&gt;TestRegionReplicaReplicationEndpoint passes locally. Any objections committing this to all branches?&lt;/p&gt;</comment>
                            <comment id="14109456" author="apurtell" created="Mon, 25 Aug 2014 18:26:45 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14109511" author="lhofhansl" created="Mon, 25 Aug 2014 19:01:32 +0000"  >&lt;p&gt;Committed to all branches.&lt;/p&gt;</comment>
                            <comment id="14109638" author="hudson" created="Mon, 25 Aug 2014 19:55:34 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-security #515 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/515/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/515/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11536&quot; title=&quot;Puts of region location to Meta may be out of order which causes inconsistent of region location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11536&quot;&gt;&lt;del&gt;HBASE-11536&lt;/del&gt;&lt;/a&gt; Puts of region location to Meta may be out of order which causes inconsistent of region location. (Liu Shaohui) (larsh: rev 6283ff920057260ed6ae69aa0d1a084ac8ac6c74)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14109650" author="hudson" created="Mon, 25 Aug 2014 20:12:21 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94 #1405 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1405/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1405/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11536&quot; title=&quot;Puts of region location to Meta may be out of order which causes inconsistent of region location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11536&quot;&gt;&lt;del&gt;HBASE-11536&lt;/del&gt;&lt;/a&gt; Puts of region location to Meta may be out of order which causes inconsistent of region location. (Liu Shaohui) (larsh: rev 6283ff920057260ed6ae69aa0d1a084ac8ac6c74)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14109660" author="hudson" created="Mon, 25 Aug 2014 20:20:06 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94-JDK7 #174 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-JDK7/174/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-JDK7/174/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11536&quot; title=&quot;Puts of region location to Meta may be out of order which causes inconsistent of region location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11536&quot;&gt;&lt;del&gt;HBASE-11536&lt;/del&gt;&lt;/a&gt; Puts of region location to Meta may be out of order which causes inconsistent of region location. (Liu Shaohui) (larsh: rev 6283ff920057260ed6ae69aa0d1a084ac8ac6c74)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14109741" author="hudson" created="Mon, 25 Aug 2014 21:11:48 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5425 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5425/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5425/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11536&quot; title=&quot;Puts of region location to Meta may be out of order which causes inconsistent of region location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11536&quot;&gt;&lt;del&gt;HBASE-11536&lt;/del&gt;&lt;/a&gt; Puts of region location to Meta may be out of order which causes inconsistent of region location. (Liu Shaohui) (larsh: rev c3d2d6127e9c1ed3af5480b5c3af7377564bb00e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/MetaTableAccessor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14109825" author="hudson" created="Mon, 25 Aug 2014 21:58:19 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #469 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/469/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/469/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11536&quot; title=&quot;Puts of region location to Meta may be out of order which causes inconsistent of region location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11536&quot;&gt;&lt;del&gt;HBASE-11536&lt;/del&gt;&lt;/a&gt; Puts of region location to Meta may be out of order which causes inconsistent of region location. (Liu Shaohui) (larsh: rev 5442d7f21bca1ced9137e57e5f1debc19fc0f2a7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14109932" author="hudson" created="Mon, 25 Aug 2014 23:04:07 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98-on-Hadoop-1.1 #442 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/442/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/442/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11536&quot; title=&quot;Puts of region location to Meta may be out of order which causes inconsistent of region location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11536&quot;&gt;&lt;del&gt;HBASE-11536&lt;/del&gt;&lt;/a&gt; Puts of region location to Meta may be out of order which causes inconsistent of region location. (Liu Shaohui) (larsh: rev 5442d7f21bca1ced9137e57e5f1debc19fc0f2a7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14109949" author="hudson" created="Mon, 25 Aug 2014 23:13:12 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.0 #122 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/122/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/122/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11536&quot; title=&quot;Puts of region location to Meta may be out of order which causes inconsistent of region location&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11536&quot;&gt;&lt;del&gt;HBASE-11536&lt;/del&gt;&lt;/a&gt; Puts of region location to Meta may be out of order which causes inconsistent of region location. (Liu Shaohui) (larsh: rev cfd79ac1c29a4abd9b343572d2a3a825c9ccfe4f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/MetaTableAccessor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14549628" author="enis" created="Tue, 19 May 2015 01:35:37 +0000"  >&lt;blockquote&gt;&lt;p&gt;I agree with your that relying on timestamps, while it would work 9.99999999999999999999% of the time, because of the murphy&apos;s law, the one time it fails, it&apos;d be a high profile situation and we&apos;d all have to go home (smile).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Murphy loves me. We can reproduce a failure because of this on EC2 clusters a lot more frequently than what you quote. This happens more for region replicas, because the master writes null entries for server columns for replicas, and then assigns those. When the replicas got assigned, if the RS&apos;s timestamp is lagging behind the master by more than the amount of time the assignment took place (a couple of seconds), then the server location becomes null for the replica. &lt;/p&gt;

&lt;p&gt;Anyway opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13709&quot; title=&quot;Updates to meta table server columns may be eclipsed&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13709&quot;&gt;&lt;del&gt;HBASE-13709&lt;/del&gt;&lt;/a&gt; detailing the issue. Please take a look. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12656262" name="10.237.12.13.log" size="995" author="liushaohui" created="Thu, 17 Jul 2014 11:33:49 +0000"/>
                            <attachment id="12656263" name="10.237.12.15.log" size="7280" author="liushaohui" created="Thu, 17 Jul 2014 11:33:49 +0000"/>
                            <attachment id="12664095" name="11536-trunk.txt" size="2043" author="lhofhansl" created="Mon, 25 Aug 2014 05:03:29 +0000"/>
                            <attachment id="12657800" name="HBASE-11536-0.94-v1.diff" size="1370" author="liushaohui" created="Fri, 25 Jul 2014 08:30:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Jul 2014 09:46:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>405977</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 30 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xv33:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>405997</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>