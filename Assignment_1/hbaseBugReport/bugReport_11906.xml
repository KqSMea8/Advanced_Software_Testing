<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:27:47 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11906/HBASE-11906.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11906] Meta data loss with distributed log replay</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11906</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In the attached log, you can see, before log replaying, the region is open on e1205:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;A3. 2014-09-05 16:38:46,705 INFO  [B.defaultRpcServer.handler=5,queue=2,port=20020] master.RegionStateStore: Updating row IntegrationTestBigLinkedList,\x90Jy\x04\xA7\x90Jp,1409959495482.cbb0d736ebfabcf4a07e5a7b395fcdf7. with state=OPEN&amp;amp;openSeqNum=40118237&amp;amp;server=e1205.halxg.cloudera.com,20020,1409960280431
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After the log replay, we got from meta the region is open on e1209&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;A4. 2014-09-05 16:41:12,257 INFO  [ActiveMasterManager] master.AssignmentManager: Loading from meta: {cbb0d736ebfabcf4a07e5a7b395fcdf7 state=OPEN, ts=1409960472257, server=e1209.halxg.cloudera.com,20020,1409959391651}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The replayed edits show the log does have the edit expected:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-09-05 16:41:11,862 INFO  [B.defaultRpcServer.handler=18,queue=0,port=20020] regionserver.RSRpcServices: Meta replay edit type=PUT,mutation={&quot;totalColumns&quot;:4,&quot;families&quot;:{&quot;info&quot;:[{&quot;timestamp&quot;:1409960326705,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x02bad&quot;],&quot;value&quot;:&quot;e1205.halxg.cloudera.com:20020&quot;,&quot;qualifier&quot;:&quot;server&quot;,&quot;vlen&quot;:30},{&quot;timestamp&quot;:1409960326705,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x02bad&quot;],&quot;value&quot;:&quot;\\x00\\x00\\x01HH.\\x81o&quot;,&quot;qualifier&quot;:&quot;serverstartcode&quot;,&quot;vlen&quot;:8},{&quot;timestamp&quot;:1409960326705,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x02bad&quot;],&quot;value&quot;:&quot;\\x00\\x00\\x00\\x00\\x02d&apos;\\xDD&quot;,&quot;qualifier&quot;:&quot;seqnumDuringOpen&quot;,&quot;vlen&quot;:8},{&quot;timestamp&quot;:1409960326706,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x02bad&quot;],&quot;value&quot;:&quot;OPEN&quot;,&quot;qualifier&quot;:&quot;state&quot;,&quot;vlen&quot;:4}]},&quot;row&quot;:&quot;IntegrationTestBigLinkedList,\\x90Jy\\x04\\xA7\\x90Jp,1409959495482.cbb0d736ebfabcf4a07e5a7b395fcdf7.&quot;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Why we picked up a wrong value with an older time stamp?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-09-05 16:41:11,063 INFO  [B.defaultRpcServer.handler=9,queue=0,port=20020] regionserver.RSRpcServices: Meta replay edit type=PUT,mutation={&quot;totalColumns&quot;:4,&quot;families&quot;:{&quot;info&quot;:[{&quot;timestamp&quot;:1409959994634,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x00\\x00\\x09\\x99&quot;],&quot;value&quot;:&quot;e1209.halxg.cloudera.com:20020&quot;,&quot;qualifier&quot;:&quot;server&quot;,&quot;vlen&quot;:30},{&quot;timestamp&quot;:1409959994634,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x00\\x00\\x09\\x99&quot;],&quot;value&quot;:&quot;\\x00\\x00\\x01HH \\xF1\\xA3&quot;,&quot;qualifier&quot;:&quot;serverstartcode&quot;,&quot;vlen&quot;:8},{&quot;timestamp&quot;:1409959994634,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x00\\x00\\x09\\x99&quot;],&quot;value&quot;:&quot;\\x00\\x00\\x00\\x00\\x00\\x01\\xB7\\xAB&quot;,&quot;qualifier&quot;:&quot;seqnumDuringOpen&quot;,&quot;vlen&quot;:8},{&quot;timestamp&quot;:1409959994634,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x00\\x00\\x09\\x99&quot;],&quot;value&quot;:&quot;OPEN&quot;,&quot;qualifier&quot;:&quot;state&quot;,&quot;vlen&quot;:4}]},&quot;row&quot;:&quot;IntegrationTestBigLinkedList,\\x90Jy\\x04\\xA7\\x90Jp,1409959495482.cbb0d736ebfabcf4a07e5a7b395fcdf7.&quot;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12739644">HBASE-11906</key>
            <summary>Meta data loss with distributed log replay</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jeffreyz">Jeffrey Zhong</assignee>
                                    <reporter username="jxiang">Jimmy Xiang</reporter>
                        <labels>
                    </labels>
                <created>Sat, 6 Sep 2014 00:30:14 +0000</created>
                <updated>Sat, 21 Feb 2015 23:41:39 +0000</updated>
                            <resolved>Sat, 20 Sep 2014 01:09:48 +0000</resolved>
                                    <version>0.99.0</version>
                    <version>2.0.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.99.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="14125076" author="stack" created="Sun, 7 Sep 2014 22:39:36 +0000"  >&lt;p&gt;Can you tell if it used to be on e1209 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;In the replay log are there other edits for this region?&lt;/p&gt;</comment>
                            <comment id="14125691" author="jxiang" created="Mon, 8 Sep 2014 15:55:57 +0000"  >&lt;p&gt;Yes, it used to be on e1209, right before moved to e1205. There are quite some edits for the region. The attached log has more details.&lt;/p&gt;</comment>
                            <comment id="14125795" author="jxiang" created="Mon, 8 Sep 2014 17:38:00 +0000"  >&lt;p&gt;I forgot to log the replaySeqId. Let me get a new log.&lt;/p&gt;</comment>
                            <comment id="14125894" author="enis" created="Mon, 8 Sep 2014 18:39:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt; FYI. &lt;/p&gt;</comment>
                            <comment id="14125899" author="jxiang" created="Mon, 8 Sep 2014 18:43:06 +0000"  >&lt;p&gt;Attached meta-data-loss-2.log. In this log, the region was open on e1206. However, after log replay, we got from meta the region was open on e1207.  &lt;/p&gt;

&lt;p&gt;We didn&apos;t pick up the right edit with seq id=40001551, ts=1410198840046. Instead, it seems that we picked up the edit with seq id=40000961, ts=1410198807834. &lt;/p&gt;

&lt;p&gt;The scan was logged at 2014-09-08 10:56:34,997 which is  about 2 minutes after ts=1410198840046(Mon Sep  8 10:54:00 PDT 2014). So I assume the meta scan used a proper timestamp.&lt;/p&gt;</comment>
                            <comment id="14126282" author="jeffreyz" created="Mon, 8 Sep 2014 23:17:51 +0000"  >&lt;p&gt;In both cases, it seems the last edit was replayed as shown below while for some reason the last edit couldn&apos;t be read. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; do you have some simple repro steps? In addition, Could you run a raw scan on the metadata row? Thanks.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-09-08 10:56:34,193 INFO  [B.defaultRpcServer.handler=24,queue=0,port=20020] regionserver.RSRpcServices: Meta replay seq id=40001551, edit type=PUT,mutation={&quot;totalColumns&quot;:4,&quot;families&quot;:{&quot;info&quot;:[{&quot;timestamp&quot;:1410198840046,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x02b`\\x0F&quot;],&quot;value&quot;:&quot;e1206.halxg.cloudera.com:20020&quot;,&quot;qualifier&quot;:&quot;server&quot;,&quot;vlen&quot;:30},{&quot;timestamp&quot;:1410198840046,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x02b`\\x0F&quot;],&quot;value&quot;:&quot;\\x00\\x00\\x01HVf\\x05)&quot;,&quot;qualifier&quot;:&quot;serverstartcode&quot;,&quot;vlen&quot;:8},{&quot;timestamp&quot;:1410198840046,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x02b`\\x0F&quot;],&quot;value&quot;:&quot;\\x00\\x00\\x00\\x00\\x04\\xC6~\\x7F&quot;,&quot;qualifier&quot;:&quot;seqnumDuringOpen&quot;,&quot;vlen&quot;:8},{&quot;timestamp&quot;:1410198840046,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x02b`\\x0F&quot;],&quot;value&quot;:&quot;OPEN&quot;,&quot;qualifier&quot;:&quot;state&quot;,&quot;vlen&quot;:4}]},&quot;row&quot;:&quot;IntegrationTestBigLinkedList,k\\x0D\\xF6\\xB0\\xDFk\\x0D\\xF0,1410197955915.cf591043d1fc374b8891599f6f133b17.&quot;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14126337" author="jxiang" created="Mon, 8 Sep 2014 23:59:35 +0000"  >&lt;p&gt;I ran ITBLL on master (edac84567f83287f3b053e818401d7012a6fe44e) with patch &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11760&quot; title=&quot;Tighten up region state transition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11760&quot;&gt;&lt;del&gt;HBASE-11760&lt;/del&gt;&lt;/a&gt;, plus some debug logging. When I noticed the issue has happened, the meta is already updated with some new value. Let me think about how I can get more info.&lt;/p&gt;</comment>
                            <comment id="14127358" author="jmhsieh" created="Tue, 9 Sep 2014 18:40:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; does this affect 1.0 or master pre-&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11760&quot; title=&quot;Tighten up region state transition&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11760&quot;&gt;&lt;del&gt;HBASE-11760&lt;/del&gt;&lt;/a&gt;?  &lt;/p&gt;</comment>
                            <comment id="14127395" author="jxiang" created="Tue, 9 Sep 2014 18:54:00 +0000"  >&lt;p&gt;Not sure, I haven&apos;t tried other branch yet.&lt;/p&gt;</comment>
                            <comment id="14127412" author="jxiang" created="Tue, 9 Sep 2014 19:11:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;, during log replay, I found the seq id is changed to a smaller number:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-09-09 10:59:40,084 INFO  [B.defaultRpcServer.handler=13,queue=1,port=20020] regionserver.HRegion: Log replay mvccNum = (seq id)40002911
2014-09-09 10:59:40,085 INFO  [B.defaultRpcServer.handler=13,queue=1,port=20020] mortbay.log: Replay edit seq number is changed from 40002911 to 40002315
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If the seq number should keep increasing, does this mean some data is lost here? The original seq num is not used during log replay. However, it is used during replaying recovered edits (log splitting).&lt;/p&gt;</comment>
                            <comment id="14127454" author="jeffreyz" created="Tue, 9 Sep 2014 19:46:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; Where your second log line is printed? I&apos;m assuming your first log line &quot;Log replay mvccNum = (seq id)40002911&quot; is from the following line in HRegion#doMiniBatchMutation&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
mvccNum = batchOp.getReplaySequenceId();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The basic idea is that we use original SeqId for replaying while the replayed edit will be assigned a new SeqId and is written with the new seqId along with original seqId stored in HLogKey#origLogSeqNum into replaying RS&apos;s WAL. During replay, region read point is bigger than current replay edit&apos;s mvcc value. Since we don&apos;t allow read during recovery, so it is fine here. &lt;/p&gt;

&lt;p&gt;If you open a scanner before recovery process(with smaller read point),  the scan will only see updates till its read point not the newest.&lt;/p&gt;</comment>
                            <comment id="14127456" author="yuzhihong@gmail.com" created="Tue, 9 Sep 2014 19:46:54 +0000"  >&lt;p&gt;@Jimmy:&lt;br/&gt;
Can you attach your patch which adds the extra logging ?&lt;/p&gt;</comment>
                            <comment id="14127471" author="jxiang" created="Tue, 9 Sep 2014 19:58:34 +0000"  >&lt;p&gt;Attached the patch that I am using (11760+logging). It&apos;s rebased to the master latest this morning.&lt;/p&gt;</comment>
                            <comment id="14127480" author="jxiang" created="Tue, 9 Sep 2014 20:12:07 +0000"  >&lt;p&gt;The second log is in MultiVersionConsistencyControl#completeMemstoreInsertWithSeqNum.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Since we don&apos;t allow read during recovery, so it is fine here.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Makes sense. I was wondering why the seq number decreased. Is it because when the meta table is open again, it doesn&apos;t know the latest seq number? If so, if all edits in the log are replayed in order, the seq number should not decrease, right?&lt;/p&gt;</comment>
                            <comment id="14127486" author="jeffreyz" created="Tue, 9 Sep 2014 20:21:40 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I was wondering why the seq number decreased. Is it because when the meta table is open again, it doesn&apos;t know the latest seq number? If so, if all edits in the log are replayed in order, the seq number should not decrease, right?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You&apos;re right. The new SeqId will be always increasing. In replay case, we also bump up the value when opening a region. It seems that we open the meta region with wrong seqId value. You can confirm that by checking the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;    LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Onlined &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.getRegionInfo().getShortNameToLog() +
      &lt;span class=&quot;code-quote&quot;&gt;&quot;; next sequenceid=&quot;&lt;/span&gt; + nextSeqid);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let me try your patch to see if I can find some info. Thanks.&lt;/p&gt;</comment>
                            <comment id="14127868" author="yuzhihong@gmail.com" created="Wed, 10 Sep 2014 00:43:40 +0000"  >&lt;p&gt;Jimmy:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       w = mvcc.beginMemstoreInsertWithSeqNum(mvccNum);
+      w.isReplay = isInReplay;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above assignment should be guarded by isInReplay, right ?&lt;br/&gt;
i.e.:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(isInReplay) {
+        w.isReplay = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Edit: pardon me, you were assigning isInReplay - it is correct.&lt;/p&gt;</comment>
                            <comment id="14127872" author="jeffreyz" created="Wed, 10 Sep 2014 00:49:51 +0000"  >&lt;p&gt;Jimmy and I have identified the cause. It&apos;s basically relating the way we bump up the sequenceId when opening a region for recovery. The particular issue is due to that a region has been suffering sequential failures before a single flush while seqId bump when opening a region is based on last flushed seqId so it&apos;s possible we assign a smaller seqId when opening a region. I&apos;m now thinking how to address this issue. Thanks.&lt;/p&gt;</comment>
                            <comment id="14129525" author="jeffreyz" created="Thu, 11 Sep 2014 02:11:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; has tested the patch locally and worked.  The reason I didn&#185;t use ZK to store SeqId info is due to two reasons though the work is about&lt;br/&gt;
same:&lt;/p&gt;

&lt;p&gt;1) There will involve some maintenance work as region merge/split could&lt;br/&gt;
left one seqid znode for the previous region&lt;br/&gt;
2) I also want to move recovering stats from ZK into FS in the future. For&lt;br/&gt;
recovering state, Master can tell a RS to open a region in recovery mode and after log replay the same master can tell the region go out of recovery date.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14129585" author="hadoopqa" created="Thu, 11 Sep 2014 03:45:22 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12667925/HBASE-11906.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12667925/HBASE-11906.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12667925&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 2 zombie test(s): 	at org.jboss.arquillian.container.test.impl.client.ContainerEventController.execute(ContainerEventController.java:101)&lt;br/&gt;
	at org.jboss.arquillian.test.impl.TestContextHandler.createClassContext(TestContextHandler.java:75)&lt;br/&gt;
	at org.jboss.arquillian.test.impl.TestContextHandler.createSuiteContext(TestContextHandler.java:60)&lt;br/&gt;
	at org.jboss.arquillian.test.impl.EventTestRunnerAdaptor.beforeClass(EventTestRunnerAdaptor.java:80)&lt;br/&gt;
	at org.apache.helix.integration.TestParticipantNameCollision.testParticiptantNameCollision(TestParticipantNameCollision.java:43)&lt;br/&gt;
	at org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:76)&lt;br/&gt;
	at org.testng.internal.Invoker.invokeMethod(Invoker.java:673)&lt;br/&gt;
	at org.testng.internal.Invoker.invokeTestMethod(Invoker.java:846)&lt;br/&gt;
	at org.testng.internal.Invoker.invokeTestMethods(Invoker.java:1170)&lt;br/&gt;
	at org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:125)&lt;br/&gt;
	at org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:109)&lt;br/&gt;
	at org.testng.TestRunner.runWorkers(TestRunner.java:1147)&lt;br/&gt;
	at org.testng.TestRunner.privateRun(TestRunner.java:749)&lt;br/&gt;
	at org.testng.TestRunner.run(TestRunner.java:600)&lt;br/&gt;
	at org.testng.SuiteRunner.runTest(SuiteRunner.java:317)&lt;br/&gt;
	at org.testng.SuiteRunner.runSequentially(SuiteRunner.java:312)&lt;br/&gt;
	at org.testng.SuiteRunner.privateRun(SuiteRunner.java:274)&lt;br/&gt;
	at org.testng.SuiteRunner.run(SuiteRunner.java:223)&lt;br/&gt;
	at org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)&lt;br/&gt;
	at org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:86)&lt;br/&gt;
	at org.testng.TestNG.runSuitesSequentially(TestNG.java:1039)&lt;br/&gt;
	at org.testng.TestNG.runSuitesLocally(TestNG.java:964)&lt;br/&gt;
	at org.testng.TestNG.run(TestNG.java:900)&lt;br/&gt;
	at org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:178)&lt;br/&gt;
	at org.apache.maven.surefire.testng.TestNGXmlTestSuite.execute(TestNGXmlTestSuite.java:92)&lt;br/&gt;
	at org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:96)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10826//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14130214" author="jxiang" created="Thu, 11 Sep 2014 16:09:54 +0000"  >&lt;p&gt;If you are going to move more info from ZK to FS, do you want to use just one file?  If so, probably it&apos;s better to plan the file format and data structure now?&lt;/p&gt;

&lt;p&gt;How about store such info in meta?  For meta, store it in ZK (meta znode, it&apos;s in pb)? Too much data in meta?&lt;/p&gt;</comment>
                            <comment id="14130231" author="stack" created="Thu, 11 Sep 2014 16:22:07 +0000"  >&lt;p&gt;Why the remove of the sync?&lt;/p&gt;

&lt;p&gt;Putting into meta would be more &apos;coherent&apos;.  We will have the interesting issues around meta being not available on occasion &amp;#8211; a crash of meta at about the same time &amp;#8211; and we&apos;ll need to give up if the server is supposed to be shutting down but it&apos;d be tidier, no?  We write a seqid to the master memory now so we can skip edits during log splitting.  Could we use that mechanism?  Let master hold the seqid during recovery or must the id persist?&lt;/p&gt;

&lt;p&gt;Good stuff lads (figuring and fixing)&lt;/p&gt;</comment>
                            <comment id="14130275" author="jxiang" created="Thu, 11 Sep 2014 16:49:54 +0000"  >&lt;p&gt;Another option is to put it ZK for now, and move them together later when you are ready.&lt;/p&gt;

&lt;p&gt;With the patch, I don&apos;t get meta data loss now. But I still see some other data loss. Probably we can use a different jira once we have some clue.&lt;/p&gt;</comment>
                            <comment id="14130402" author="jeffreyz" created="Thu, 11 Sep 2014 17:57:47 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Another option is to put it ZK for now, and move them together later when you are ready.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Actually that&apos;s what I&apos;m thinking too. There are some ideas that we can move the recovery state out of ZK. But we can do it once later. I&apos;ll post a revised patch soon. Thanks.&lt;/p&gt;</comment>
                            <comment id="14130413" author="jxiang" created="Thu, 11 Sep 2014 18:00:30 +0000"  >&lt;p&gt;In my log, I found lots of edits with the same replay seq id:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2014-09-10 17:09:04,414 INFO  [B.defaultRpcServer.handler=28,queue=1,port=20020] regionserver.RSRpcServices: Meta replay seq id=11, edit type=PUT,mutation={&quot;totalColumns&quot;:1,&quot;families&quot;:{&quot;info&quot;:[{&quot;timestamp&quot;:1410393186242,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x0B&quot;],&quot;value&quot;:&quot;PBUF\\x08\\xC2\\xB7\\xF0\\x8F\\x86)\\x12&apos;\\x0A\\x07default\\x12\\x1CIntegrationTestBigLinkedList\\x1A\\x08\\x04\\xA7\\x90Jy\\x04\\xA7\\x90\&quot;\\x08\\x09O \\x94\\xF2\\x09O (\\x000\\x008\\x00&quot;,&quot;qualifier&quot;:&quot;regioninfo&quot;,&quot;vlen&quot;:78}]},&quot;row&quot;:&quot;IntegrationTestBigLinkedList,\\x04\\xA7\\x90Jy\\x04\\xA7\\x90,1410393185218.92709681028d2a976810a36f6c6bc558.&quot;}
2014-09-10 17:09:04,416 INFO  [B.defaultRpcServer.handler=28,queue=1,port=20020] regionserver.RSRpcServices: Meta replay seq id=11, edit type=PUT,mutation={&quot;totalColumns&quot;:1,&quot;families&quot;:{&quot;info&quot;:[{&quot;timestamp&quot;:1410393186242,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x0B&quot;],&quot;value&quot;:&quot;PBUF\\x08\\xC2\\xB7\\xF0\\x8F\\x86)\\x12&apos;\\x0A\\x07default\\x12\\x1CIntegrationTestBigLinkedList\\x1A\\x00\&quot;\\x08\\x04\\xA7\\x90Jy\\x04\\xA7\\x90(\\x000\\x008\\x00&quot;,&quot;qualifier&quot;:&quot;regioninfo&quot;,&quot;vlen&quot;:70}]},&quot;row&quot;:&quot;IntegrationTestBigLinkedList,,1410393185218.69c946031b6eaa2b16b14cbc83ef57a3.&quot;}
2014-09-10 17:09:04,419 INFO  [B.defaultRpcServer.handler=28,queue=1,port=20020] regionserver.RSRpcServices: Meta replay seq id=11, edit type=PUT,mutation={&quot;totalColumns&quot;:1,&quot;families&quot;:{&quot;info&quot;:[{&quot;timestamp&quot;:1410393186242,&quot;tag&quot;:[&quot;3:\\x00\\x00\\x00\\x00\\x00\\x00\\x00\\x0B&quot;],&quot;value&quot;:&quot;PBUF\\x08\\xC2\\xB7\\xF0\\x8F\\x86)\\x12&apos;\\x0A\\x07default\\x12\\x1CIntegrationTestBigLinkedList\\x1A\\x08\\x17E\\xD1t]\\x17E\\xD0\&quot;\\x08\\x1B\\xEDa\\xBE\\xD6\\x1B\\xED`(\\x000\\x008\\x00&quot;,&quot;qualifier&quot;:&quot;regioninfo&quot;,&quot;vlen&quot;:78}]},&quot;row&quot;:&quot;IntegrationTestBigLinkedList,\\x17E\\xD1t]\\x17E\\xD0,1410393185218.35686221ee2ba55488a62a894ce26c48.&quot;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is this something I need to worry about?&lt;/p&gt;</comment>
                            <comment id="14130446" author="jeffreyz" created="Thu, 11 Sep 2014 18:17:30 +0000"  >&lt;p&gt;It&apos;s possible that all those KVs from same waledit. It seems all right to me.&lt;/p&gt;</comment>
                            <comment id="14132423" author="jeffreyz" created="Sat, 13 Sep 2014 01:06:21 +0000"  >&lt;p&gt;This is the zk based patch per &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;&apos;s suggestions. Thanks.&lt;/p&gt;</comment>
                            <comment id="14132460" author="hadoopqa" created="Sat, 13 Sep 2014 01:50:13 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12668530/hbase-11906-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12668530/hbase-11906-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12668530&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestClassFinder&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 4 zombie test(s): 	at org.apache.phoenix.hbase.index.covered.example.EndToEndCoveredIndexingIT.testMultipleTimestampsInSinglePut(EndToEndCoveredIndexingIT.java:197)&lt;br/&gt;
	at org.apache.phoenix.hbase.index.covered.example.EndToEndCoveredIndexingIT.testDeletesWithoutPreviousState(EndToEndCoveredIndexingIT.java:361)&lt;br/&gt;
	at org.apache.phoenix.mapreduce.CsvBulkLoadToolIT.testBasicImport(CsvBulkLoadToolIT.java:90)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10870//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14134133" author="jxiang" created="Mon, 15 Sep 2014 17:07:34 +0000"  >&lt;p&gt;With patch v2, I don&apos;t get meta data loss any more although ITBLL still fails on me.&lt;/p&gt;

&lt;p&gt;+1. Looks good to me. Just couple nits. There are some trailing whilespaces. Should we try to delete the znode only if DLR is enabled, and internalFlush is indeed invoked?&lt;/p&gt;</comment>
                            <comment id="14134196" author="stack" created="Mon, 15 Sep 2014 17:52:55 +0000"  >&lt;p&gt;It is a little odd adding state to zk when elsewhere we are busy undoing our keeping state in zk.  That aside, having an HRegion instance depend on being able to make use of a zk client is a mixing of tiers we&apos;d probably best avoid? (Sorry for speaking up a little late here).   I like the first patch.  It makes use of the fs, a dependency the HRegion has already.&lt;/p&gt;

&lt;p&gt;On the first patch, is this intentional:&lt;/p&gt;

&lt;p&gt;diff --git hbase-server/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKSplitLog.java hbase-server/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKSplitLog.java&lt;br/&gt;
index ac6042f..6f64417 100644&lt;br/&gt;
&amp;#8212; hbase-server/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKSplitLog.java&lt;br/&gt;
+++ hbase-server/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKSplitLog.java&lt;br/&gt;
@@ -143,6 +143,7 @@ public class ZKSplitLog {&lt;br/&gt;
     boolean result = false;&lt;br/&gt;
     String nodePath = ZKUtil.joinZNode(zkw.recoveringRegionsZNode, regionEncodedName);&lt;/p&gt;

&lt;p&gt;+    zkw.sync(nodePath);&lt;br/&gt;
     byte[] node = ZKUtil.getDataAndWatch(zkw, nodePath);&lt;br/&gt;
     if (node != null) {&lt;br/&gt;
       result = true;&lt;/p&gt;


&lt;p&gt;If so, comment why?&lt;/p&gt;




</comment>
                            <comment id="14135983" author="jeffreyz" created="Tue, 16 Sep 2014 19:04:30 +0000"  >&lt;p&gt;Thanks for the feedback!&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Should we try to delete the znode only if DLR is enabled, and internalFlush is indeed invoked?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes. I can add the check when DLR is enabled. For &quot;internalFlush is indeed invoked&quot;, current patch should already cover this because it&apos;s called after flush during region close. If flush fails, the delete will be skipped.&lt;/p&gt;

&lt;p&gt;For &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;On the first patch, is this intentional:&lt;br/&gt;
+ zkw.sync(nodePath);&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This was by intention but I don&apos;t think I need it. I can remove it upon my check in. Thanks.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt; I think we can do the zk -&amp;gt; file system migration later in one go. If you still like the v1 patch, I can check the v1 patch in. Thanks. &lt;/p&gt;</comment>
                            <comment id="14136137" author="stack" created="Tue, 16 Sep 2014 20:25:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt; I like the first patch (don&apos;t like HRegion writing zk).  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; You good w/ that?&lt;/p&gt;</comment>
                            <comment id="14136245" author="jxiang" created="Tue, 16 Sep 2014 21:16:07 +0000"  >&lt;p&gt;Yes, I am fine with that. Just one thing with v1: hbck will complain about the new file. Some minor fix should be good.&lt;/p&gt;

&lt;p&gt;One question, are we going to create another file later on when moving other DLR info from ZK to file?&lt;/p&gt;</comment>
                            <comment id="14136655" author="jeffreyz" created="Wed, 17 Sep 2014 01:51:53 +0000"  >&lt;blockquote&gt;
&lt;p&gt;One question, are we going to create another file later on when moving other DLR info from ZK to file?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If we have to store the related state somewhere, we can move to meta or extend current seqid files for that purpose.&lt;/p&gt;

&lt;p&gt;Ok. I&apos;ll check in the v1 patch by end of tomorrow after I fix small issues(such as hbck warnings &amp;amp; remove zkw.sync()) mentioned above upon check in if there is no objections. Thanks.&lt;/p&gt;</comment>
                            <comment id="14141634" author="enis" created="Sat, 20 Sep 2014 01:03:39 +0000"  >&lt;p&gt;implied +1 for branch-1 as well. &lt;/p&gt;</comment>
                            <comment id="14141642" author="jeffreyz" created="Sat, 20 Sep 2014 01:09:48 +0000"  >&lt;p&gt;I&apos;ve integrated the &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11906&quot; title=&quot;Meta data loss with distributed log replay&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11906&quot;&gt;&lt;del&gt;HBASE-11906&lt;/del&gt;&lt;/a&gt;.patch into master &amp;amp; branch-1 after minor changes on hbck warnings &amp;amp; zk.sync() form review comments. Thanks for all the reviews!&lt;/p&gt;</comment>
                            <comment id="14141687" author="hudson" created="Sat, 20 Sep 2014 02:30:06 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5538 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5538/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5538/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11906&quot; title=&quot;Meta data loss with distributed log replay&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11906&quot;&gt;&lt;del&gt;HBASE-11906&lt;/del&gt;&lt;/a&gt;: Meta data loss with distributed log replay (jeffreyz: rev 676a0126bc6dddc17796d18d8b27165312a1f1ed)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14141727" author="hudson" created="Sat, 20 Sep 2014 03:55:55 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #210 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/210/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/210/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11906&quot; title=&quot;Meta data loss with distributed log replay&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11906&quot;&gt;&lt;del&gt;HBASE-11906&lt;/del&gt;&lt;/a&gt;: Meta data loss with distributed log replay (jeffreyz: rev 1c127220f0aba64e9a5732fc141e5a0ff794cd48)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14331527" author="enis" created="Sat, 21 Feb 2015 23:41:39 +0000"  >&lt;p&gt;Closing this issue after 0.99.1 release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12667925" name="HBASE-11906.patch" size="8044" author="jeffreyz" created="Thu, 11 Sep 2014 02:11:56 +0000"/>
                            <attachment id="12667466" name="debugging.patch" size="89926" author="jxiang" created="Tue, 9 Sep 2014 19:58:34 +0000"/>
                            <attachment id="12668530" name="hbase-11906-v2.patch" size="10315" author="jeffreyz" created="Sat, 13 Sep 2014 01:06:21 +0000"/>
                            <attachment id="12667208" name="meta-data-loss-2.log" size="6856" author="jxiang" created="Mon, 8 Sep 2014 18:43:06 +0000"/>
                            <attachment id="12666952" name="meta-data-loss-with-dlr.log" size="60183" author="jxiang" created="Sat, 6 Sep 2014 00:30:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 7 Sep 2014 22:39:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zr3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>