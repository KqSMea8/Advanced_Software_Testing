<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:30:10 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5702/HBASE-5702.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5702] MasterSchemaChangeTracker.excludeRegionServerForSchemaChanges leaks a MonitoredTask per call</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5702</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This bug is so easy to reproduce I&apos;m wondering why it hasn&apos;t been reported yet. Stop any number of region servers on a 0.94/6 cluster and you&apos;ll see in the master interface one task per stopped region server saying the following:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Processing schema change exclusion for region server = sv4r27s44,62023,1333402175340&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;RUNNING (since 5sec ago)&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;No schema change in progress. Skipping exclusion for server = sv4r27s44,62023,1333402175340 (since 5sec ago)&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;It&apos;s gonna stay there until the master cleans it:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;WARN org.apache.hadoop.hbase.monitoring.TaskMonitor: Status Processing schema change exclusion for region server = sv4r27s44,62023,1333402175340: status=No schema change in progress. Skipping exclusion for server = sv4r27s44,62023,1333402175340, state=RUNNING, startTime=1333404636419, completionTime=-1 appears to have been leaked&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s not clear to me why it&apos;s using a MonitoredTask in the first place. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12549244">HBASE-5702</key>
            <summary>MasterSchemaChangeTracker.excludeRegionServerForSchemaChanges leaks a MonitoredTask per call</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Apr 2012 22:22:28 +0000</created>
                <updated>Sat, 11 Apr 2015 01:24:46 +0000</updated>
                            <resolved>Sat, 11 Apr 2015 01:24:46 +0000</resolved>
                                    <version>0.94.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13244801" author="jdcryans" created="Mon, 2 Apr 2012 23:01:59 +0000"  >&lt;p&gt;Looking at the code it seems it&apos;s leaking in other places... and that message shouldn&apos;t even be there in the first place because hbase.instant.schema.alter.enabled isn&apos;t enabled on this cluster.&lt;/p&gt;</comment>
                            <comment id="13244816" author="jdcryans" created="Mon, 2 Apr 2012 23:18:42 +0000"  >&lt;p&gt;Now that I&apos;ve tested &quot;instant&quot; schema updates, there&apos;s many more issues with MonitoredTask than I originally thought &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13244962" author="lhofhansl" created="Tue, 3 Apr 2012 04:21:40 +0000"  >&lt;p&gt;Seems bad, upping to critical.&lt;/p&gt;</comment>
                            <comment id="13245496" author="zhihyu@ebaysf.com" created="Tue, 3 Apr 2012 16:58:18 +0000"  >&lt;p&gt;The following method in ServerManager.java doesn&apos;t check the current value for hbase.instant.schema.alter.enabled config:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void excludeRegionServerFromSchemaChanges(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ServerName serverName) {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getSchemaChangeTracker()
        .excludeRegionServerForSchemaChanges(serverName.getServerName());
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13245648" author="iamknome" created="Tue, 3 Apr 2012 19:44:45 +0000"  >&lt;p&gt;I will take a look at it and address it as soon as possible.&lt;/p&gt;</comment>
                            <comment id="13245650" author="iamknome" created="Tue, 3 Apr 2012 19:46:59 +0000"  >&lt;p&gt;JD,&lt;/p&gt;

&lt;p&gt;Can you share with me the &quot;many more issues with MonitoredTask&quot; that you have mentioned? I believe the problems you have seen are all related to the MonitoredTask reporting during instant schema change process and not with the actual schema change process itself? Please let me know so we can categorize and address the issues accordingly.&lt;/p&gt;</comment>
                            <comment id="13245793" author="jdcryans" created="Tue, 3 Apr 2012 21:53:58 +0000"  >&lt;p&gt;Yeah when I opened this jira it had a narrow scope but I think it could be much bigger. Basically if you try to instant alter a table you&apos;ll see there&apos;s about two or three (sorry I can&apos;t be more precise at the moment, I&apos;m testing something else right now) tasks that are leaked.&lt;/p&gt;

&lt;p&gt;I can see some issues just looking at the code:&lt;/p&gt;

&lt;p&gt;MasterSchemaChangeTracker&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;processCompletedSchemaChanges: creates a task, sets the status, never closes it. It&apos;s a misuse of MonitoredTask I think, a task is normally something that&apos;s long running and you need to report progress.&lt;/li&gt;
	&lt;li&gt;processAlterStatus: creates a task but stops it right away, also creates one then kills it.&lt;/li&gt;
	&lt;li&gt;handleFailedOrExpiredSchemaChanges: creates a task, sets the status, never closes it. Also it has an extra white space.&lt;/li&gt;
	&lt;li&gt;createSchemaChangeNode: creates a task then closes/aborts it right away&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;SchemaChangeTracker&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;handleSchemaChange: creates a task, sets the status, never closes it.&lt;/li&gt;
	&lt;li&gt;reportAndLogSchemaRefreshError: can create task and set a status but doesn&apos;t close it.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There really should only be 1 task throughout the alter process.&lt;/p&gt;</comment>
                            <comment id="13247552" author="lhofhansl" created="Thu, 5 Apr 2012 19:20:47 +0000"  >&lt;p&gt;Unscheduling, since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt; was reverted.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12549531">HBASE-5715</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 3 Apr 2012 04:21:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>234235</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02cwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11691</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>