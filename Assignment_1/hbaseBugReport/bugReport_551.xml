<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:45:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-551/HBASE-551.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-551] Master stuck splitting server logs in shutdown loop; on each iteration, edits are aggregated up into the millions</title>
                <link>https://issues.apache.org/jira/browse/HBASE-551</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Lars cluster is sick with master trying to split logs.   The logs its replaying have millions of edits in them.  &lt;/p&gt;

&lt;p&gt;Here is sample from log.   First we get the shutdown and then in the shutdown process, we start to split up the shutdown servers log:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2008-03-28 16:29:45,305 INFO org.apache.hadoop.hbase.HMaster: process shutdown of server 192.168.105.37:60020: logSplit: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, rootRes
canned: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, numberOfMetaRegions: 1, onlineMetaRegions.size(): 1
2008-03-28 16:29:45,310 INFO org.apache.hadoop.hbase.HLog: splitting 3 log(s) in hdfs:&lt;span class=&quot;code-comment&quot;&gt;//lv1-xen-pdc-2.worldlingo.com:9000/hbase/log_192
&lt;/span&gt;.168.105.37_1206741382563_60020
2008-03-28 16:29:45,311 DEBUG org.apache.hadoop.hbase.HLog: Splitting 0 of 3: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//lv1-xen-pdc-2.worldlingo.com:9000/hbase/log_192.16
&lt;/span&gt;8.105.37_1206741382563_60020/hlog.dat.002
2008-03-28 16:29:45,380 DEBUG org.apache.hadoop.hbase.HLog: Creating &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; log file writer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; path hdfs:&lt;span class=&quot;code-comment&quot;&gt;//lv1-xen-pdc-2.worldlingo.com:9
&lt;/span&gt;000/hbase/pdc-docs/488338803/oldlogfile.log and region pdc-docs,EP01108687NWA2,1205739919655
2008-03-28 16:29:45,390 DEBUG org.apache.hadoop.hbase.HLog: Creating &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; log file writer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; path hdfs:&lt;span class=&quot;code-comment&quot;&gt;//lv1-xen-pdc-2.worldlingo.com:9
&lt;/span&gt;000/hbase/pdc-docs/447465883/oldlogfile.log and region pdc-docs,EP01900680NWA1,1205754584444
2008-03-28 16:29:45,403 DEBUG org.apache.hadoop.hbase.HLog: Creating &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; log file writer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; path hdfs:&lt;span class=&quot;code-comment&quot;&gt;//lv1-xen-pdc-2.worldlingo.com:9
&lt;/span&gt;000/hbase/pdc-docs/2035706226/oldlogfile.log and region pdc-docs,EP01119588NWA2,1205754281917
2008-03-28 16:29:45,428 DEBUG org.apache.hadoop.hbase.HLog: Creating &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; log file writer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; path hdfs:&lt;span class=&quot;code-comment&quot;&gt;//lv1-xen-pdc-2.worldlingo.com:9
&lt;/span&gt;000/hbase/pdc-docs/437772136/oldlogfile.log and region pdc-docs,EP00200190NWA2,120576451593
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We open a file in each region to take edits.  We then start replaying the 3 WAL files from the regionserver.&lt;/p&gt;

&lt;p&gt;On the second one, we get exception... &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2008-03-28 16:40:36,537 WARN org.apache.hadoop.hbase.HLog: Old log file hdfs:&lt;span class=&quot;code-comment&quot;&gt;//lv1-xen-pdc-2.worldlingo.com:9000/hbase/pdc-docs/1045858
&lt;/span&gt;46/oldlogfile.log already exists. Copying existing file to &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; file
2008-03-28 16:40:36,545 DEBUG org.apache.hadoop.hbase.HLog: Creating &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; log file writer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; path hdfs:&lt;span class=&quot;code-comment&quot;&gt;//lv1-xen-pdc-2.worldlingo.com:9
&lt;/span&gt;000/hbase/pdc-docs/104585846/oldlogfile.log and region pdc-docs,EP96104830NWA1,1205768785572
2008-03-28 16:40:36,979 DEBUG org.apache.hadoop.hbase.HLog: Copied 220000 edits
2008-03-28 16:40:38,853 DEBUG org.apache.hadoop.hbase.HLog: Applied 222812 total edits
2008-03-28 16:40:38,853 DEBUG org.apache.hadoop.hbase.HLog: Splitting 1 of 3: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//lv1-xen-pdc-2.worldlingo.com:9000/hbase/log_192.16
&lt;/span&gt;8.105.37_1206741382563_60020/hlog.dat.003
2008-03-28 16:40:56,883 WARN org.apache.hadoop.hbase.HLog: Old log file hdfs:&lt;span class=&quot;code-comment&quot;&gt;//lv1-xen-pdc-2.worldlingo.com:9000/hbase/pdc-docs/2118067
&lt;/span&gt;194/oldlogfile.log already exists. Copying existing file to &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; file
2008-03-28 16:40:56,891 DEBUG org.apache.hadoop.hbase.HLog: Creating &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; log file writer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; path hdfs:&lt;span class=&quot;code-comment&quot;&gt;//lv1-xen-pdc-2.worldlingo.com:9
&lt;/span&gt;000/hbase/pdc-docs/2118067194/oldlogfile.log and region pdc-docs,EP97302517NWA2,1205726201776
2008-03-28 16:41:12,910 DEBUG org.apache.hadoop.hbase.HLog: Applied 36638 total edits
2008-03-28 16:41:12,910 DEBUG org.apache.hadoop.hbase.HLog: Splitting 2 of 3: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//lv1-xen-pdc-2.worldlingo.com:9000/hbase/log_192.16
&lt;/span&gt;8.105.37_1206741382563_60020/hlog.dat.004
2008-03-28 16:41:18,684 WARN org.apache.hadoop.hbase.HMaster: Processing pending operations: ProcessServerShutdown of 192.168.105.37:60
020
java.io.EOFException
        at java.io.DataInputStream.readFully(DataInputStream.java:178)
        at org.apache.hadoop.io.DataOutputBuffer$Buffer.write(DataOutputBuffer.java:56)
        at org.apache.hadoop.io.DataOutputBuffer.write(DataOutputBuffer.java:90)
        at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:1829)
        at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:1729)
        at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:1775)
        at org.apache.hadoop.hbase.HLog.splitLog(HLog.java:540)
        at org.apache.hadoop.hbase.HMaster$ProcessServerShutdown.process(HMaster.java:2167)
        at org.apache.hadoop.hbase.HMaster.run(HMaster.java:1085)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A finally clause makes sure we close up all the new files we&apos;ve made in all regions.  These new files have accumulated some edits from the splitting of the first file.&lt;/p&gt;

&lt;p&gt;Because we got an exception, the shutdown processing runs again.&lt;/p&gt;

&lt;p&gt;Because regions have files in place with edits, we won&apos;t overwrite them second time through.  We instead copy the old into a new file to which we start appending until the exception happens again.&lt;/p&gt;

&lt;p&gt;After a couple of hours, we&apos;re up into the millions of edits.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12392643">HBASE-551</key>
            <summary>Master stuck splitting server logs in shutdown loop; on each iteration, edits are aggregated up into the millions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Sat, 29 Mar 2008 22:00:53 +0000</created>
                <updated>Sat, 12 Apr 2008 16:12:05 +0000</updated>
                            <resolved>Mon, 31 Mar 2008 20:53:05 +0000</resolved>
                                    <version>0.1.0</version>
                    <version>0.1.1</version>
                    <version>0.2.0</version>
                                    <fixVersion>0.1.1</fixVersion>
                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12583374" author="stack" created="Sat, 29 Mar 2008 22:17:53 +0000"  >&lt;p&gt;M  src/java/org/apache/hadoop/hbase/HLog.java&lt;br/&gt;
    (splitLog): If an exception processing a split, catch it.&lt;br/&gt;
    In finally, close and delete the split.  Don&apos;t try retrying.&lt;br/&gt;
    While in some circumstance, we might recover, its also&lt;br/&gt;
    likely that we just get same exception again.  If so, and&lt;br/&gt;
    multiple files, we&apos;ll just accumulate edits until the&lt;br/&gt;
    kingdom comes.&lt;/p&gt;</comment>
                            <comment id="12583377" author="stack" created="Sat, 29 Mar 2008 22:29:41 +0000"  >&lt;p&gt;Here&apos;s sampling from logs after the loop has run for a few hours:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
2008-03-29 02:01:45,609 DEBUG org.apache.hadoop.hbase.HLog: Applied 1893832 total edits
2008-03-29 02:03:39,417 DEBUG org.apache.hadoop.hbase.HLog: Applied 94150 total edits
2008-03-29 02:40:41,452 DEBUG org.apache.hadoop.hbase.HLog: Applied 1958102 total edits
2008-03-29 02:42:36,340 DEBUG org.apache.hadoop.hbase.HLog: Applied 96362 total edits
2008-03-29 03:20:39,816 DEBUG org.apache.hadoop.hbase.HLog: Applied 2022372 total edits
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Root cause was regionserver running out of memory.&lt;/p&gt;</comment>
                            <comment id="12583499" author="jimk" created="Sun, 30 Mar 2008 23:04:19 +0000"  >&lt;p&gt;Patch available for 0.1.1&lt;/p&gt;</comment>
                            <comment id="12583501" author="jimk" created="Sun, 30 Mar 2008 23:06:38 +0000"  >&lt;p&gt;Reviewed patch. +1&lt;/p&gt;</comment>
                            <comment id="12583848" author="stack" created="Mon, 31 Mar 2008 20:53:05 +0000"  >&lt;p&gt;Applied branch and TRUNK.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12378875" name="551.patch" size="1176" author="stack" created="Sat, 29 Mar 2008 22:17:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 30 Mar 2008 23:04:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25260</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 38 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h7zr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98557</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>