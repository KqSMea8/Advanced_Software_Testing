<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:43:01 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-304/HBASE-304.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-304] [hbase] Change abort to finalize; does nothing if commit ran successfully</title>
                <link>https://issues.apache.org/jira/browse/HBASE-304</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From Michael Bieniosek:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;I&apos;m trying to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; an update row, so I write code like:

&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; lockid = table.startUpdate(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Text(article.getName())); &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (File articleInfo: article.listFiles(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NonDirectories())) {          articleTable.put(lockid, columnName(articleInfo.getName()), readFile(articleInfo));     }
     table.commit(lockid);
} &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
    table.abort(lockid);
}

This doesn&apos;t work, because in the normal &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; it calls abort after commit.  But I&apos;m not sure what the code should be, eg.:

&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; lockid = table.startUpdate(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Text(article.getName())); &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (File articleInfo: article.listFiles(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NonDirectories())) {          articleTable.put(lockid, columnName(articleInfo.getName()), readFile(articleInfo));     }
     table.commit(lockid);
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
    table.abort(lockid);
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (RuntimeException e) {
    table.abort(lockid);
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
}

This gets unwieldy very quickly.  Could you maybe change abort() to finalize() which either aborts or does nothing &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a commit was successful?
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12383041">HBASE-304</key>
            <summary>[hbase] Change abort to finalize; does nothing if commit ran successfully</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Nov 2007 05:51:20 +0000</created>
                <updated>Thu, 2 May 2013 02:29:08 +0000</updated>
                            <resolved>Wed, 28 Nov 2007 20:38:53 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12545563" author="jimk" created="Mon, 26 Nov 2007 19:28:00 +0000"  >&lt;p&gt;Well, you could do the following instead:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; lockid = table.startUpdate(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Text(article.getName()));
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (File articleInfo: article.listFiles(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NonDirectories())) {
          articleTable.put(lockid, columnName(articleInfo.getName()), readFile(articleInfo)); 
    }
     table.commit(lockid);
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
    table.abort(lockid);
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;However, we can also change abort to not throw an exception (there&apos;s really no need for it to do so).&lt;/p&gt;</comment>
                            <comment id="12545614" author="bien" created="Mon, 26 Nov 2007 21:32:02 +0000"  >&lt;p&gt;The problem with your suggestion is that the enclosing function then needs to throw Exception.  &lt;/p&gt;</comment>
                            <comment id="12545690" author="jimk" created="Tue, 27 Nov 2007 02:47:26 +0000"  >&lt;p&gt;Changing abort(long) so that it only throws an exception if:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the table does not exist&lt;/li&gt;
	&lt;li&gt;the HTable is closed&lt;/li&gt;
	&lt;li&gt;there is an outstanding update and the lockid passed in does not match the lockid of the update.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;otherwise, it will just clean up and return.&lt;/p&gt;</comment>
                            <comment id="12545691" author="jimk" created="Tue, 27 Nov 2007 02:51:10 +0000"  >&lt;p&gt;So after this change you will be able to do the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; lockid = table.startUpdate(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Text(article.getName())); 
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (File articleInfo: article.listFiles(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NonDirectories())) {
          articleTable.put(lockid, columnName(articleInfo.getName()), readFile(articleInfo)); 
    }
     table.commit(lockid);
} &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
    table.abort(lockid);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12545693" author="jimk" created="Tue, 27 Nov 2007 02:55:34 +0000"  >&lt;p&gt;The patch for this issue will be incoporated in the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-394&quot; title=&quot;[hbase] Updating a row on non-existent table runs all the retries and timeouts instead of failing fast&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-394&quot;&gt;&lt;del&gt;HADOOP-2262&lt;/del&gt;&lt;/a&gt;,&lt;/p&gt;</comment>
                            <comment id="12545751" author="jimk" created="Tue, 27 Nov 2007 08:36:15 +0000"  >&lt;p&gt;Fixed by patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-394&quot; title=&quot;[hbase] Updating a row on non-existent table runs all the retries and timeouts instead of failing fast&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-394&quot;&gt;&lt;del&gt;HADOOP-2262&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12545823" author="hudson" created="Tue, 27 Nov 2007 13:15:26 +0000"  >&lt;p&gt;Integrated in Hadoop-Nightly #315 (See &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Nightly/315/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Nightly/315/&lt;/a&gt;)&lt;/p&gt;</comment>
                            <comment id="12545925" author="stack" created="Tue, 27 Nov 2007 17:19:38 +0000"  >&lt;p&gt;Jim, IMO, having users run an &apos;abort&apos; on every transaction as the hbase update idiom is a little odd.  Michael&apos;s original suggestion of finalize, though a better method name, is problematic since its a method that already exists on Object (and means something else).  Perhaps &apos;cleanup&apos; rather than abort?&lt;/p&gt;</comment>
                            <comment id="12545927" author="jimk" created="Tue, 27 Nov 2007 17:22:37 +0000"  >&lt;p&gt;Reopening.&lt;/p&gt;

&lt;p&gt;abort will be deprecated and replaced with some other method (although not finalize)&lt;/p&gt;</comment>
                            <comment id="12545976" author="jimk" created="Tue, 27 Nov 2007 19:20:55 +0000"  >&lt;p&gt;It turns out that commit already releases resources so that you never need to call abort unless you decide you don&apos;t want to commit the update. For example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; lockid = table.startUpdate(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Text(article.getName()));
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (File articleInfo: article.listFiles(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NonDirectories())) {
  &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; article = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
  &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    DataInputStream in = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; DataInputStream(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileInputStream(articleInfo));
    article = in.readUTF();
  } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
    &lt;span class=&quot;code-comment&quot;&gt;// Input error - abandon update
&lt;/span&gt;    table.abort(lockid);
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
  }
  &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    table.put(lockid, columnName(articleInfo.getName()), article.getBytes());
  } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (RuntimeException e) {
    &lt;span class=&quot;code-comment&quot;&gt;// Put failed - abandon update
&lt;/span&gt;    table.abort(lockid);
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
  }
}
table.commit(lockid);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I will be submitting a patch that updates the Javadoc for HTable that should make this clearer.&lt;/p&gt;</comment>
                            <comment id="12545977" author="jimk" created="Tue, 27 Nov 2007 19:22:01 +0000"  >&lt;p&gt;Updates Javadoc for HTable&lt;/p&gt;</comment>
                            <comment id="12546006" author="bien" created="Tue, 27 Nov 2007 21:27:18 +0000"  >&lt;p&gt;No, I don&apos;t think you understand my complaint.&lt;/p&gt;

&lt;p&gt;The problem with the current API is that I have to explicitly catch all the exceptions that my code can throw, so I can catch them and call abort().&lt;/p&gt;

&lt;p&gt;It is error-prone to list all the exceptions my code could possibly throw and attempt to catch and rethrow them.  For example, it is easy to forget RuntimeException and Error.  You can&apos;t just catch Throwable, because then you have to rethrow a Throwable, which changes the method&apos;s exception signature.&lt;/p&gt;

&lt;p&gt;When I wrote code against hibernate&apos;s API, (as far as I remember) I did something like &lt;/p&gt;

&lt;p&gt;&amp;lt;pre&amp;gt;&lt;br/&gt;
Transaction transaction = session.beginTransaction();&lt;br/&gt;
try &lt;/p&gt;
{
  ...
  transaction.commit();
}
&lt;p&gt; finally &lt;/p&gt;
{
  transaction.rollback();
}
&lt;p&gt;&amp;lt;/pre&amp;gt;&lt;/p&gt;

&lt;p&gt;This had the nice property that calling rollback() after commit() was a no-op.  This is what I&apos;d like to see in hbase.  &lt;/p&gt;</comment>
                            <comment id="12546085" author="jimk" created="Wed, 28 Nov 2007 02:31:22 +0000"  >&lt;p&gt;Since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-316&quot; title=&quot;[hbase] Increase parallelism in region servers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-316&quot;&gt;&lt;del&gt;HADOOP-2139&lt;/del&gt;&lt;/a&gt; phase 1, abort may be called without throwing an exception if no update is in progress. So if you want to do:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; lockid = table.startUpdate(....);
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
  table.put(...);
  table.delete(...);
  table.commit(...)
} &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
  table.abort(lockid);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This will work just fine. The only restriction is that the lockid match the one returned from startUpdate()&lt;/p&gt;

&lt;p&gt;I have updated the Javadoc for HTable to reflect this. When it is committed, hopefully this will be clearer.&lt;/p&gt;</comment>
                            <comment id="12546117" author="hadoopqa" created="Wed, 28 Nov 2007 05:25:40 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
&lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12370337/patch.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12370337/patch.txt&lt;/a&gt;&lt;br/&gt;
against trunk revision r598780.&lt;/p&gt;

&lt;p&gt;    @author +1.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    javadoc +1.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    javac +1.  The applied patch does not generate any new compiler warnings.&lt;/p&gt;

&lt;p&gt;    findbugs +1.  The patch does not introduce any new Findbugs warnings.&lt;/p&gt;

&lt;p&gt;    core tests -1.  The patch failed core unit tests.&lt;/p&gt;

&lt;p&gt;    contrib tests +1.  The patch passed contrib unit tests.&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/1182/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/1182/testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/1182/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/1182/artifact/trunk/build/test/findbugs/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle results: &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/1182/artifact/trunk/build/test/checkstyle-errors.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/1182/artifact/trunk/build/test/checkstyle-errors.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/1182/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Patch/1182/console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="12546378" author="jimk" created="Wed, 28 Nov 2007 20:38:53 +0000"  >&lt;p&gt;Fixed by latest commit to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-249&quot; title=&quot;[hbase] address regression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-249&quot;&gt;&lt;del&gt;HADOOP-2276&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12546677" author="hudson" created="Thu, 29 Nov 2007 11:39:23 +0000"  >&lt;p&gt;Integrated in Hadoop-Nightly #317 (See &lt;a href=&quot;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Nightly/317/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://lucene.zones.apache.org:8080/hudson/job/Hadoop-Nightly/317/&lt;/a&gt;)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12383237">HBASE-249</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12383042">HBASE-394</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12370337" name="patch.txt" size="2739" author="jimk" created="Tue, 27 Nov 2007 19:22:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 26 Nov 2007 19:28:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25088</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            9 years, 4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h6fb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>