<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:47:08 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13836/HBASE-13836.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13836] Do not reset the mvcc for bulk loaded mob reference cells in reading</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13836</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Now in scanner, the cells mvcc of the bulk loaded files are reset by the seqId parsed from the file name. We need to skip this if the hfiles are bulkloaded in mob compactions.&lt;br/&gt;
In mob compaction, the bulk loaded ref cell might not be the latest cell among the ones that have the same row key. In reading, the mvcc is reset by the largest one, it will cover the real latest ref cell. We have to skip the resetting in this case.&lt;br/&gt;
The solution is we add a new field to fileinfo, when this field is set as true, we skip the resetting.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12835355">HBASE-13836</key>
            <summary>Do not reset the mvcc for bulk loaded mob reference cells in reading</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12721032">HBASE-11339</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jingcheng.du@intel.com">Jingcheng Du</assignee>
                                    <reporter username="jingcheng.du@intel.com">Jingcheng Du</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Jun 2015 10:35:21 +0000</created>
                <updated>Wed, 22 Jul 2015 22:48:47 +0000</updated>
                            <resolved>Wed, 10 Jun 2015 12:36:05 +0000</resolved>
                                    <version>hbase-11339</version>
                                    <fixVersion>hbase-11339</fixVersion>
                                    <component>mob</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14578428" author="jingcheng.du@intel.com" created="Tue, 9 Jun 2015 06:45:22 +0000"  >&lt;p&gt;Upload the patch. Please take a look, thanks a lot!&lt;/p&gt;</comment>
                            <comment id="14578649" author="ram_krish" created="Tue, 9 Jun 2015 09:50:17 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] SKIP_RESET_SEQ_ID = Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;SKIP_RESET_SEQ_ID&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;May be you can add the reason and specify used in MOB cases.  It will help to understand later because it is specific to MOB.&lt;br/&gt;
Also you can always make this &apos;true&apos; and avoid the setSkipResetSeqId(true) every time for a non-bulk load case? If is a bulk load you can set based on the metadata info.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; skipResetSeqId = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14578660" author="anoop.hbase" created="Tue, 9 Jun 2015 10:04:33 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if (this.cur != null &amp;amp;&amp;amp; this.reader.isBulkLoaded()) {&lt;br/&gt;
+    if (this.cur != null &amp;amp;&amp;amp; !this.reader.isSkipResetSeqId()) {&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It will be better for readability that this check is this.cur != null &amp;amp;&amp;amp; this.reader.isBulkLoaded() &amp;amp;&amp;amp;  !this.reader.isSkipResetSeqId()&lt;/p&gt;

&lt;p&gt;Also no need to call setter on reader for non bulk loaded cases.. Just set it only for bulk loaded files. And  pls add some comments that why we do this skip.&lt;/p&gt;</comment>
                            <comment id="14580074" author="jingcheng.du@intel.com" created="Wed, 10 Jun 2015 05:59:05 +0000"  >&lt;p&gt;Update the patch according to comments from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoopsamjohn&quot; class=&quot;user-hover&quot; rel=&quot;anoopsamjohn&quot;&gt;Anoop Sam John&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt;. Thanks.&lt;/p&gt;</comment>
                            <comment id="14580134" author="anoop.hbase" created="Wed, 10 Jun 2015 06:56:03 +0000"  >&lt;p&gt;Sorry for not observing this in 1st review.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; seqId = cell.getSequenceId();
+    assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;After compaction: mob value&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;mobValue1&quot;&lt;/span&gt;,
+      Bytes.toString(CellUtil.cloneValue(cell)));
+    &lt;span class=&quot;code-comment&quot;&gt;// read the ref cell, not read further to the mob cell.
&lt;/span&gt;+    get.setAttribute(MobConstants.MOB_SCAN_RAW, Bytes.toBytes(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;));
+    result = hTable.get(get);
+    cell = result.getColumnLatestCell(hcd1.getName(), Bytes.toBytes(qf1));
+    assertEquals(&lt;span class=&quot;code-quote&quot;&gt;&quot;After compaction: mob cell seqId&quot;&lt;/span&gt;, seqId, cell.getSequenceId());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here we try to assert the seqId of cell at client side.  We don&apos;t write it over wire.  SeqId make sense only at server.  May be you can have a test which do mob compaction and after that the read will return the correct MOB value.&lt;/p&gt;

&lt;p&gt;Or else your test has to have some CPs where the postGet can get the seqId of returned cell. This may be not really needed IMO.&lt;/p&gt;</comment>
                            <comment id="14580138" author="jingcheng.du@intel.com" created="Wed, 10 Jun 2015 07:02:31 +0000"  >&lt;p&gt;Thanks Anoop, got it. I will improve the unit test.&lt;/p&gt;</comment>
                            <comment id="14580184" author="jingcheng.du@intel.com" created="Wed, 10 Jun 2015 07:54:41 +0000"  >&lt;p&gt;Improve the unit test, and upload the new patch (V3).&lt;/p&gt;</comment>
                            <comment id="14637833" author="hudson" created="Wed, 22 Jul 2015 22:48:47 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6672 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6672/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6672/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13836&quot; title=&quot;Do not reset the mvcc for bulk loaded mob reference cells in reading&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13836&quot;&gt;&lt;del&gt;HBASE-13836&lt;/del&gt;&lt;/a&gt; Do not reset the mvcc for bulk loaded mob reference cells in reading. (Jingcheng) (anoopsamjohn: rev 26893aa451215ef0395b7df16f129414b7b86c86)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFileScanner.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/mob/compactions/TestMobCompactor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mob/compactions/PartitionedMobCompactor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12738746" name="HBASE-13836-V2.diff" size="9303" author="jingcheng.du@intel.com" created="Wed, 10 Jun 2015 05:59:05 +0000"/>
                            <attachment id="12738763" name="HBASE-13836-V3.diff" size="10661" author="jingcheng.du@intel.com" created="Wed, 10 Jun 2015 07:54:41 +0000"/>
                            <attachment id="12738524" name="HBASE-13836.diff" size="8831" author="jingcheng.du@intel.com" created="Tue, 9 Jun 2015 06:45:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 9 Jun 2015 09:50:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fmjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>