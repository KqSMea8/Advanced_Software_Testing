<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:00:22 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-15161/HBASE-15161.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-15161] Umbrella: Miscellaneous improvements from production usage</title>
                <link>https://issues.apache.org/jira/browse/HBASE-15161</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We use HBase to (mainly) build index for our search engine in Alibaba. Recently we are upgrading our online cluster from 0.98.12 to 1.x and I&apos;d like to take the opportunity to contribute a bunch of our private patches to community (better late than never, I hope &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;). This is an umbrella to track this effort.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12933750">HBASE-15161</key>
            <summary>Umbrella: Miscellaneous improvements from production usage</summary>
                <type id="14" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/genericissue.png">Umbrella</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="carp84">Yu Li</assignee>
                                    <reporter username="carp84">Yu Li</reporter>
                        <labels>
                    </labels>
                <created>Mon, 25 Jan 2016 09:06:02 +0000</created>
                <updated>Thu, 11 Aug 2016 09:31:31 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                                                            <comments>
                            <comment id="15115046" author="anoop.hbase" created="Mon, 25 Jan 2016 11:03:40 +0000"  >&lt;p&gt;Better to raise other issues as subtask.&lt;/p&gt;</comment>
                            <comment id="15115314" author="carp84" created="Mon, 25 Jan 2016 14:50:59 +0000"  >&lt;p&gt;Thanks for the note Anoop, will do.&lt;/p&gt;</comment>
                            <comment id="15117392" author="carp84" created="Tue, 26 Jan 2016 15:34:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14061&quot; title=&quot;Support CF-level Storage Policy&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14061&quot;&gt;HBASE-14061&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15172&quot; title=&quot;Support setting storage policy in bulkload&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15172&quot;&gt;HBASE-15172&lt;/a&gt; are for tiered HFile storage thus created as sub-task of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6572&quot; title=&quot;Tiered HFile storage&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6572&quot;&gt;HBASE-6572&lt;/a&gt; rather than this JIRA, and we use links to show the relationship.&lt;/p&gt;</comment>
                            <comment id="15228877" author="enis" created="Wed, 6 Apr 2016 18:48:22 +0000"  >&lt;p&gt;In sub tasks of these for new metrics, especially per-table, per-user and hdfs IO metrics, we discussed briefly about possible perf impact. General agreement is that we should be careful in adding new metrics to not affect the hot code paths. For example, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15160&quot; title=&quot;Put back HFile&amp;#39;s HDFS op latency sampling code and add metrics for monitoring&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15160&quot;&gt;HBASE-15160&lt;/a&gt; adds the fs IO latency metrics back which was removed from before. The way it works is the hfile block reader emits the latency and offers it to a array blocking queue, and later the metrics collector which runs periodically drains these queues and adds it to the latency histogram metrics. Instead of this, I was suggesting to increment the metrics directly inline in the hot code paths directly, because in-theory using &lt;tt&gt;Counter}}s should be better than using {{ArrayBlockingQueue&lt;/tt&gt; &lt;/p&gt;

&lt;p&gt;To quantify whether it is the case or not, I&apos;ve written a JMH suite for testing Counter vs AtomicLong vs MetricHistogram vs ArrayBlockingQueue. &lt;br/&gt;
&lt;a href=&quot;https://github.com/enis/hbase-counters-benchmark/blob/master/src/main/java/org/apache/hbase/CountersBenchmark.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/enis/hbase-counters-benchmark/blob/master/src/main/java/org/apache/hbase/CountersBenchmark.java&lt;/a&gt; &lt;/p&gt;

&lt;p&gt;Running these with 1,2,4,8,16,24 threads, some of the results are expected and good confirmation (Counter is really far better than AtomicLong), however it seems that MutableHistogram is very expensive:&lt;br/&gt;
&lt;a href=&quot;https://docs.google.com/spreadsheets/d/1C_V0Y59Ct4gM_1xhbiaTFk-5OkyJHkR6UkF85NSMWdA/edit?usp=sharing&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://docs.google.com/spreadsheets/d/1C_V0Y59Ct4gM_1xhbiaTFk-5OkyJHkR6UkF85NSMWdA/edit?usp=sharing&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="15239215" author="carp84" created="Wed, 13 Apr 2016 13:19:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; I tested with your &lt;tt&gt;CountersBenchmark&lt;/tt&gt; and the default JMH options for 1 and 16 threads, and the result looks a little bit different from yours:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;1 thread
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# JMH 1.12 (released 12 days ago)
# VM version: JDK 1.7.0_45, VM 24.45-b08
# VM invoker: /home/hadoop/hadoop_hbase/jdk1.7.0_45/jre/bin/java
# VM options: &amp;lt;none&amp;gt;
# Warmup: 20 iterations, 1 s each
# Measurement: 20 iterations, 1 s each
# Timeout: 10 min per iteration
# Threads: 1 thread, will synchronize iterations
# Benchmark mode: Throughput, ops/time
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Benchmark&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Mode&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Cnt&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Score&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Error&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Units&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CountersBenchmark.testAddHistogramConstantValue&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;thrpt&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;200&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;8021489.491&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#177;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;28496.232 ops/s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CountersBenchmark.testAddHistogramRandomValue&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;thrpt&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;200&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7264625.900&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#177;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;20687.454 ops/s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CountersBenchmark.testAddToBlockingQueue&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;thrpt&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;200&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;15193156.700&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#177;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;9852.702 ops/s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CountersBenchmark.testIncrementAtomicLong&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;thrpt&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;200&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;61286471.569&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#177;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;157590.540 ops/s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CountersBenchmark.testIncrementCounter&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;thrpt&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;200&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;40704390.815&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#177;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;92169.826 ops/s&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;16 threads:
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# JMH 1.12 (released 12 days ago)
# VM version: JDK 1.7.0_45, VM 24.45-b08
# VM invoker: /home/hadoop/hadoop_hbase/jdk1.7.0_45/jre/bin/java
# VM options: &amp;lt;none&amp;gt;
# Warmup: 20 iterations, 1 s each
# Measurement: 20 iterations, 1 s each
# Timeout: 10 min per iteration
# Threads: 16 threads, will synchronize iterations
# Benchmark mode: Throughput, ops/time
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Benchmark&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Mode&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Cnt&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Score&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Error&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;Units&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CountersBenchmark.testAddHistogramConstantValue&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;thrpt&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;200&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;7943543.369&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#177;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;495590.594 ops/s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CountersBenchmark.testAddHistogramRandomValue&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;thrpt&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;200&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;5383866.653&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#177;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;96536.075 ops/s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CountersBenchmark.testAddToBlockingQueue&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;thrpt&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;200&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;6946474.250&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#177;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;44876.268 ops/s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CountersBenchmark.testIncrementAtomicLong&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;thrpt&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;200&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;12637791.647&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#177;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;107859.658 ops/s&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;CountersBenchmark.testIncrementCounter&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;thrpt&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;200&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;605886122.169&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#177;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2663966.723 ops/s&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;From my result it seems MutableHistogram is much less expensive than BlockingQueue, and performs good on heavy load.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310060">
                    <name>Container</name>
                                            <outwardlinks description="contains">
                                        <issuelink>
            <issuekey id="12844411">HBASE-14061</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12934132">HBASE-15172</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12996476">HBASE-16393</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12922116">HBASE-14983</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12956996">HBASE-15614</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12958357">HBASE-15643</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12933733">HBASE-15160</subtask>
                            <subtask id="12933753">HBASE-15162</subtask>
                            <subtask id="12933849">HBASE-15163</subtask>
                            <subtask id="12934120">HBASE-15171</subtask>
                            <subtask id="12946022">HBASE-15376</subtask>
                            <subtask id="12946024">HBASE-15377</subtask>
                            <subtask id="12947788">HBASE-15412</subtask>
                            <subtask id="12948502">HBASE-15435</subtask>
                            <subtask id="12950133">HBASE-15464</subtask>
                            <subtask id="12952546">HBASE-15518</subtask>
                            <subtask id="12952549">HBASE-15519</subtask>
                            <subtask id="12956233">HBASE-15595</subtask>
                            <subtask id="12959796">HBASE-15671</subtask>
                            <subtask id="12959872">HBASE-15675</subtask>
                            <subtask id="12960499">HBASE-15683</subtask>
                            <subtask id="12963323">HBASE-15728</subtask>
                            <subtask id="12964015">HBASE-15740</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 25 Jan 2016 11:03:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            35 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2rwx3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>