<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:58:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8793/HBASE-8793.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8793] Regionserver ubuntu&apos;s startup script return code always 0</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8793</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;hbase-regionserver startup script always returns 0 (exit 0 at the end of the script) this is wrong behaviour which causes issues when trying to recognise true status of the service.&lt;br/&gt;
Replacing it with &apos;exit $?&apos; seems to fix the problem, looking at hbase master return codes are assigned to RETVAL variable which is used with exit.&lt;/p&gt;

&lt;p&gt;Not sure if the problem exist in other versions.&lt;/p&gt;

&lt;p&gt;&amp;gt; /etc/init.d/hbase-regionserver.orig status&lt;br/&gt;
hbase-regionserver is not running.&lt;br/&gt;
&amp;gt; echo $?&lt;/p&gt;

&lt;p&gt;After fix:&lt;/p&gt;

&lt;p&gt;&amp;gt; /etc/init.d/hbase-regionserver status&lt;br/&gt;
hbase-regionserver is not running.&lt;br/&gt;
&amp;gt; echo $?&lt;br/&gt;
1&lt;/p&gt;</description>
                <environment>&lt;p&gt;Description:    Ubuntu 12.04.2 LTS&lt;br/&gt;
Hbase: 0.94.6+96-1.cdh4.3.0.p0.13~precise-cdh4.3.0&lt;/p&gt;</environment>
        <key id="12654457">HBASE-8793</key>
            <summary>Regionserver ubuntu&apos;s startup script return code always 0</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="jmspaggi">Jean-Marc Spaggiari</assignee>
                                    <reporter username="mcz">Micha&#322; Czerwi&#324;ski</reporter>
                        <labels>
                    </labels>
                <created>Mon, 24 Jun 2013 10:08:17 +0000</created>
                <updated>Wed, 26 Jun 2013 14:56:54 +0000</updated>
                            <resolved>Tue, 25 Jun 2013 16:56:34 +0000</resolved>
                                    <version>0.94.6</version>
                                                    <component>scripts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13691952" author="jmspaggi" created="Mon, 24 Jun 2013 13:24:30 +0000"  >&lt;p&gt;Strange, there is already an exit command on this script...&lt;/p&gt;

&lt;p&gt;status_of_proc -p $&lt;/p&gt;
{HBASE_PID_DIR}
&lt;p&gt;/hbase-hbase-regionserver.pid $&lt;/p&gt;
{JAVA_HOME}
&lt;p&gt;/bin/java hbase-regionserver &amp;amp;&amp;amp; exit 0 || exit $?&lt;/p&gt;

&lt;p&gt;So the exit at the end of the script should not be used.&lt;/p&gt;

&lt;p&gt;Can you had some traces on your init script to verify why those 2 exits are not done and why it&apos;s using the last exit?&lt;/p&gt;</comment>
                            <comment id="13691960" author="mcz" created="Mon, 24 Jun 2013 13:37:50 +0000"  >&lt;p&gt;Well I think that the whole script is different than the on you are using (see below).&lt;br/&gt;
The problem is that when checking status, status() function only &quot;returns&quot; and probably should call exit with a return code. Because return is not handled in any way &quot;exit 0&quot; (last line) takes place indicating invalid service status.&lt;br/&gt;
The package comes from Cloudera&apos;s CDH4.&lt;/p&gt;

&lt;p&gt;&amp;#8212; CUT HERE &amp;#8212;&lt;/p&gt;

&lt;p&gt;#! /bin/bash&lt;br/&gt;
#&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Licensed to the Apache Software Foundation (ASF) under one or more&lt;/li&gt;
	&lt;li&gt;contributor license agreements.  See the NOTICE file distributed with&lt;/li&gt;
	&lt;li&gt;this work for additional information regarding copyright ownership.&lt;/li&gt;
	&lt;li&gt;The ASF licenses this file to You under the Apache License, Version 2.0&lt;/li&gt;
	&lt;li&gt;(the &quot;License&quot;); you may not use this file except in compliance with&lt;/li&gt;
	&lt;li&gt;the License.  You may obtain a copy of the License at&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;&lt;a href=&quot;http://www.apache.org/licenses/LICENSE-2.0&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.apache.org/licenses/LICENSE-2.0&lt;/a&gt;&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;Unless required by applicable law or agreed to in writing, software&lt;/li&gt;
	&lt;li&gt;distributed under the License is distributed on an &quot;AS IS&quot; BASIS,&lt;/li&gt;
	&lt;li&gt;WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.&lt;/li&gt;
	&lt;li&gt;See the License for the specific language governing permissions and&lt;/li&gt;
	&lt;li&gt;limitations under the License.&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;This file is used to run multiple instances of certain HBase daemons using init scripts.&lt;/li&gt;
	&lt;li&gt;It replaces the local-regionserver.sh and local-master.sh scripts for Bigtop packages.&lt;/li&gt;
	&lt;li&gt;By default, this script runs a single daemon normally. If offsets are provided, additional&lt;/li&gt;
	&lt;li&gt;daemons are run, identified by the offset in log and pid files, and listening on the default&lt;/li&gt;
	&lt;li&gt;port + the offset. Offsets can be provided as arguments when invoking init scripts directly:&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;/etc/init.d/hbase-regionserver start 1 2 3 4&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;or you can list the offsets to run in /etc/init.d/regionserver_offsets:&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;echo &quot;regionserver_OFFSETS=&apos;1 2 3 4&apos; &amp;gt;&amp;gt; /etc/default/hbase&quot;&lt;/li&gt;
	&lt;li&gt;sudo service hbase-$HBASE_DAEMON@ start&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;Offsets specified on the command-line always override the offsets file. If no offsets are&lt;/li&gt;
	&lt;li&gt;specified on the command-line when stopping or restarting daemons, all running instances of the&lt;/li&gt;
	&lt;li&gt;daemon are stopped (regardless of the contents of the offsets file).&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;chkconfig: 2345 87 13&lt;/li&gt;
	&lt;li&gt;description: Summary: HBase is the Hadoop database. Use it when you need random, realtime read/write access to your Big Data. This project&apos;s goal is the hosting of very large tables &amp;#8211; billions of rows X millions of columns &amp;#8211; atop clusters of commodity hardware.&lt;/li&gt;
	&lt;li&gt;processname: HBase&lt;br/&gt;
#
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;BEGIN INIT INFO&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
	&lt;li&gt;Provides:          hbase-regionserver&lt;/li&gt;
	&lt;li&gt;Required-Start:    $network $local_fs $remote_fs&lt;/li&gt;
	&lt;li&gt;Required-Stop:     $remote_fs&lt;/li&gt;
	&lt;li&gt;Should-Start:      $named&lt;/li&gt;
	&lt;li&gt;Should-Stop:&lt;/li&gt;
	&lt;li&gt;Default-Start:     2 3 4 5&lt;/li&gt;
	&lt;li&gt;Default-Stop:      0 1 6&lt;/li&gt;
	&lt;li&gt;Short-Description: Hadoop HBase regionserver daemon
	&lt;ol&gt;
		&lt;li&gt;
		&lt;ol&gt;
			&lt;li&gt;END INIT INFO&lt;/li&gt;
		&lt;/ol&gt;
		&lt;/li&gt;
	&lt;/ol&gt;
	&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;. /etc/default/hadoop&lt;br/&gt;
. /etc/default/hbase&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Autodetect JAVA_HOME if not defined&lt;br/&gt;
. /usr/lib/bigtop-utils/bigtop-detect-javahome&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Our default HBASE_HOME, HBASE_PID_DIR and HBASE_CONF_DIR&lt;br/&gt;
export HBASE_HOME=$
{HBASE_HOME:-/usr/lib/hbase}
&lt;p&gt;export HBASE_PID_DIR=$&lt;/p&gt;
{HBASE_PID_DIR:-/var/run/hbase}&lt;br/&gt;
export HBASE_LOG_DIR=${HBASE_LOG_DIR:-/var/log/hbase}&lt;br/&gt;
&lt;br/&gt;
install -d -m 0755 -o hbase -g hbase ${HBASE_PID_DIR}&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin&lt;br/&gt;
DAEMON_SCRIPT=$HBASE_HOME/bin/hbase-daemon.sh&lt;br/&gt;
NAME=hbase-regionserver&lt;br/&gt;
DESC=&quot;Hadoop HBase regionserver daemon&quot;&lt;br/&gt;
PID_FILE=$HBASE_PID_DIR/hbase-hbase-regionserver.pid&lt;br/&gt;
CONF_DIR=/etc/hbase/conf&lt;/p&gt;

&lt;p&gt;DODTIME=3                   # Time to wait for the server to die, in seconds&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;If this value is set too low you might not&lt;/li&gt;
	&lt;li&gt;let some servers to die gracefully and&lt;/li&gt;
	&lt;li&gt;&apos;restart&apos; will not work&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;UPPERCASE_HBASE_DAEMON=$(echo regionserver | tr &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;:lower:&amp;#93;&lt;/span&gt;&apos; &apos;&lt;span class=&quot;error&quot;&gt;&amp;#91;:upper:&amp;#93;&lt;/span&gt;&apos;)&lt;/p&gt;

&lt;p&gt;ALL_DAEMONS_RUNNING=0&lt;br/&gt;
NO_DAEMONS_RUNNING=1&lt;br/&gt;
SOME_OFFSET_DAEMONS_FAILING=2&lt;br/&gt;
INVALID_OFFSETS_PROVIDED=3&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;These limits are not easily configurable - they are enforced by HBase&lt;br/&gt;
if [ &quot;regionserver&quot; == &quot;master&quot; ] ; then&lt;br/&gt;
    FIRST_PORT=60000&lt;br/&gt;
    FIRST_INFO_PORT=60010&lt;br/&gt;
    OFFSET_LIMIT=10&lt;br/&gt;
elif [ &quot;regionserver&quot; == &quot;regionserver&quot; ] ; then&lt;br/&gt;
    FIRST_PORT=60200&lt;br/&gt;
    FIRST_INFO_PORT=60300&lt;br/&gt;
    OFFSET_LIMIT=100&lt;br/&gt;
fi&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;validate_offsets() {&lt;br/&gt;
    for OFFSET in $1; do&lt;br/&gt;
        if [[ ! $OFFSET =~ ^((0)|(&lt;span class=&quot;error&quot;&gt;&amp;#91;1-9&amp;#93;&lt;/span&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;0-9&amp;#93;&lt;/span&gt;&lt;/p&gt;
{0,2}
&lt;p&gt;))$ ]]; then&lt;br/&gt;
            echo &quot;ERROR: All offsets must be positive integers (no leading zeros, max $OFFSET_LIMIT)&quot;&lt;br/&gt;
            exit $INVALID_OFFSETS_PROVIDED&lt;br/&gt;
        fi&lt;br/&gt;
        if [ $&lt;/p&gt;
{OFFSET} -lt 0 ] ; then&lt;br/&gt;
            echo &quot;ERROR: Cannot start regionserver with negative offset&quot; &amp;gt;&amp;amp;2&lt;br/&gt;
            exit $INVALID_OFFSETS_PROVIDED&lt;br/&gt;
        fi&lt;br/&gt;
        if [ ${OFFSET}
&lt;p&gt; -ge $&lt;/p&gt;
{OFFSET_LIMIT}
&lt;p&gt; ] ; then&lt;br/&gt;
            echo &quot;ERROR: Cannot start regionserver with offset higher than $OFFSET_LIMIT&quot; &amp;gt;&amp;amp;2&lt;br/&gt;
            exit $INVALID_OFFSETS_PROVIDED&lt;br/&gt;
        fi&lt;br/&gt;
    done&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;offset_pidfile() &lt;/p&gt;
{
    echo $HBASE_PID_DIR/hbase-hbase-$1-regionserver.pid
}

&lt;p&gt;OFFSETS_FROM_CLI=&quot;${*:2}&quot;&lt;br/&gt;
validate_offsets &quot;$OFFSETS_FROM_CLI&quot;&lt;br/&gt;
if [ -n &quot;$(eval echo \${$&lt;/p&gt;
{UPPERCASE_HBASE_DAEMON}_OFFSETS})&quot; ] ; then&lt;br/&gt;
    OFFSETS_FROM_DEFAULT=&quot;$(eval echo \${${UPPERCASE_HBASE_DAEMON}
&lt;p&gt;_OFFSETS})&quot;&lt;br/&gt;
    validate_offsets &quot;$OFFSETS_FROM_DEFAULT&quot;&lt;br/&gt;
fi&lt;br/&gt;
OFFSET_PID_FILES=&quot;`ls $HBASE_PID_DIR/hbase-hbase-*-regionserver.pid 2&amp;gt;/dev/null`&quot;&lt;br/&gt;
if [ -n &quot;$OFFSET_PID_FILES&quot; ] ; then&lt;br/&gt;
    OFFSETS_FROM_PIDS=`echo &quot;$OFFSET_PID_FILES&quot; | sed &quot;s#$HBASE_PID_DIR/hbase-hbase-##&quot; | sed &quot;s#-.*##&quot; | tr &apos;\n&apos; &apos; &apos;`&lt;br/&gt;
fi&lt;/p&gt;

&lt;p&gt;multi_hbase_daemon_check_pidfiles() &lt;/p&gt;
{
  if [ -z &quot;$OFFSETS_FROM_PIDS&quot; ] ; then
    return $NO_DAEMONS_RUNNING
  fi
  if [ -n &quot;$OFFSETS_FROM_CLI&quot; ] ; then
    OFFSETS=&quot;$OFFSETS_FROM_CLI&quot;
  else
    OFFSETS=&quot;$OFFSETS_FROM_PIDS&quot;
  fi

  RESULT=$ALL_DAEMONS_RUNNING
  for OFFSET in $OFFSETS; do
    echo -n &quot;HBase regionserver $OFFSET: &quot;
    if hbase_check_pidfile `offset_pidfile $OFFSET` ; then
      echo &quot;running&quot;
    else
      echo &quot;not running&quot;
      RESULT=$SOME_OFFSET_DAEMONS_FAILING
    fi
  done
  return $RESULT
}

&lt;p&gt;multi_hbase_daemon_stop_pidfiles() &lt;/p&gt;
{
  if [ -z &quot;$OFFSETS_FROM_PIDS&quot; ] ; then
    return $NO_DAEMONS_RUNNING
  fi
  if [ -n &quot;$OFFSETS_FROM_CLI&quot; ] ; then
    OFFSETS=&quot;$OFFSETS_FROM_CLI&quot;
  else
    OFFSETS=&quot;$OFFSETS_FROM_PIDS&quot;
  fi

  RESULT=$NO_DAEMONS_RUNNING
  for OFFSET in $OFFSETS; do
    echo -n &quot;Forcefully stopping HBase regionserver $OFFSET: &quot;
    PID_FILE=`offset_pidfile $OFFSET`
    hbase_stop_pidfile $PID_FILE
    if hbase_check_pidfile $PID_FILE ; then
      echo &quot;ERROR.&quot;
    else
      echo &quot;OK.&quot;
      rm -f $PID_FILE
    fi
  done
  return $RESULT
}

&lt;ol&gt;
	&lt;li&gt;Starts and stops multiple instances of HBase daemons&lt;br/&gt;
multi_hbase_daemon() {&lt;br/&gt;
    COMMAND=$1&lt;br/&gt;
    OFFSETS=&quot;$OFFSETS_FROM_CLI&quot;&lt;br/&gt;
    if [ &quot;$COMMAND&quot; == &quot;start&quot; ] ; then&lt;br/&gt;
        ACTION=&quot;Starting&quot;&lt;br/&gt;
        RUNNING=&quot;OK&quot;&lt;br/&gt;
        STOPPED=&quot;ERROR&quot;&lt;br/&gt;
        if [ -z &quot;$OFFSETS_FROM_CLI&quot; ] ; then&lt;br/&gt;
            OFFSETS=&quot;$OFFSETS_FROM_DEFAULT&quot;&lt;br/&gt;
        fi&lt;br/&gt;
    elif [ &quot;$COMMAND&quot; == &quot;stop&quot; ] ; then&lt;br/&gt;
        ACTION=&quot;Stopping&quot;&lt;br/&gt;
        RUNNING=&quot;ERROR&quot;&lt;br/&gt;
        STOPPED=&quot;OK&quot;&lt;br/&gt;
        if [ -z &quot;$OFFSETS_FROM_CLI&quot; ] ; then&lt;br/&gt;
            OFFSETS=&quot;$OFFSETS_FROM_PIDS&quot;&lt;br/&gt;
        fi&lt;br/&gt;
    else&lt;br/&gt;
        echo &quot;ERROR: Illegal command: $COMMAND&quot;&lt;br/&gt;
        exit 1&lt;br/&gt;
    fi&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    export HBASE_$&lt;/p&gt;
{UPPERCASE_HBASE_DAEMON}
&lt;p&gt;_OPTS=&quot; &quot;&lt;/p&gt;

&lt;p&gt;    for OFFSET in $&lt;/p&gt;
{OFFSETS}
&lt;p&gt; ; do&lt;br/&gt;
        echo -n &quot;$ACTION regionserver daemon $OFFSET: &quot;&lt;br/&gt;
        export HBASE_IDENT_STRING=&quot;hbase-$&lt;/p&gt;
{OFFSET}&quot;&lt;br/&gt;
        LOG_FILE=&quot;$HBASE_LOG_DIR/hbase-$HBASE_IDENT_STRING-regionserver-$HOSTNAME.pid&quot;&lt;br/&gt;
        PID_FILE=&quot;$HBASE_PID_DIR/hbase-$HBASE_IDENT_STRING-regionserver.pid&quot;&lt;br/&gt;
        HBASE_MULTI_ARGS=&quot;-D hbase.regionserver.port=`expr ${FIRST_PORT} + $OFFSET` \&lt;br/&gt;
                          -D hbase.regionserver.info.port=`expr ${FIRST_INFO_PORT} + ${OFFSET}
&lt;p&gt;`&quot;&lt;br/&gt;
        hbase_check_pidfile $PID_FILE&lt;br/&gt;
        STATUS=$?&lt;br/&gt;
        if [[ &quot;$STATUS&quot; == &quot;0&quot; &amp;amp;&amp;amp; &quot;$COMMAND&quot; == &quot;start&quot; ]] ; then&lt;br/&gt;
            echo &quot;Already running&quot;&lt;br/&gt;
            continue&lt;br/&gt;
        elif [[ &quot;$STATUS&quot; != &quot;0&quot; &amp;amp;&amp;amp; &quot;$COMMAND&quot; == &quot;stop&quot; ]] ; then&lt;br/&gt;
            rm -f $PID_FILE&lt;br/&gt;
            echo &quot;Already stopped&quot;&lt;br/&gt;
            continue&lt;br/&gt;
        fi&lt;br/&gt;
        su -s /bin/bash hbase -c &quot;$&lt;/p&gt;
{DAEMON_SCRIPT}
&lt;p&gt; $&lt;/p&gt;
{COMMAND}
&lt;p&gt; regionserver $&lt;/p&gt;
{HBASE_MULTI_ARGS}
&lt;p&gt; &amp;gt;&amp;gt; $&lt;/p&gt;
{LOG_FILE}
&lt;p&gt;&quot;&lt;br/&gt;
        if [[ &quot;$COMMAND&quot; == &quot;stop&quot; ]] ; then&lt;br/&gt;
            rm -f $PID_FILE&lt;br/&gt;
        fi&lt;br/&gt;
        if hbase_check_pidfile $PID_FILE ; then&lt;br/&gt;
            echo &quot;$RUNNING&quot;&lt;br/&gt;
        else&lt;br/&gt;
            echo &quot;$STOPPED&quot;&lt;br/&gt;
        fi&lt;br/&gt;
    done&lt;br/&gt;
    return 0&lt;br/&gt;
}&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Checks if the given pid represents a live process.&lt;/li&gt;
	&lt;li&gt;Returns 0 if the pid is a live process, 1 otherwise&lt;br/&gt;
hbase_is_process_alive() 
{
  local pid=&quot;$1&quot;
  ps -fp $pid | grep $pid | grep regionserver &amp;gt; /dev/null 2&amp;gt;&amp;amp;1
}&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Check if the process associated to a pidfile is running.&lt;/li&gt;
	&lt;li&gt;Return 0 if the pidfile exists and the process is running, 1 otherwise&lt;br/&gt;
hbase_check_pidfile() 
{
  local pidfile=&quot;$1&quot; # IN
  local pid

  pid=`cat &quot;$pidfile&quot; 2&amp;gt;/dev/null`
  if [ &quot;$pid&quot; = &apos;&apos; ]; then
    # The file probably does not exist or is empty.
    return 1
  fi

  set -- $pid
  pid=&quot;$1&quot;

  hbase_is_process_alive $pid
}&lt;/li&gt;
&lt;/ol&gt;


&lt;ol&gt;
	&lt;li&gt;Kill the process associated to a pidfile&lt;br/&gt;
hbase_stop_pidfile() 
{
   local pidfile=&quot;$1&quot; # IN
   local pid

   pid=`cat &quot;$pidfile&quot; 2&amp;gt;/dev/null`
   if [ &quot;$pid&quot; = &apos;&apos; ]; then
      # The file probably does not exist or is empty. Success
      return 0
   fi

   set -- $pid
   pid=&quot;$1&quot;

   # First try the easy way
   if hbase_process_kill &quot;$pid&quot; 15; then
      rm $pidfile
      return 0
   fi

   # Otherwise try the hard way
   if hbase_process_kill &quot;$pid&quot; 9; then
      rm $pidfile
      return 0
   fi

   return 1
}&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;hbase_process_kill() &lt;/p&gt;
{
    local pid=&quot;$1&quot;    # IN
    local signal=&quot;$2&quot; # IN
    local second

    kill -$signal $pid 2&amp;gt;/dev/null

   # Wait a bit to see if the dirty job has really been done
    for second in 0 1 2 3 4 5 6 7 8 9 10; do
        if hbase_is_process_alive &quot;$pid&quot;; then
         # Success
            return 0
        fi

        sleep 1
    done

   # Timeout
    return 1
}

&lt;p&gt;start() {&lt;br/&gt;
    if [ -n &quot;$&lt;/p&gt;
{OFFSETS_FROM_CLI}${OFFSETS_FROM_DEFAULT}&quot; ] ; then&lt;br/&gt;
        if hbase_check_pidfile $PID_FILE ; then&lt;br/&gt;
            echo &quot;$NAME has already been started - cannot start other regionserver daemons.&quot;&lt;br/&gt;
            exit 1&lt;br/&gt;
        fi&lt;br/&gt;
        multi_hbase_daemon &quot;start&quot;&lt;br/&gt;
        exit $?&lt;br/&gt;
    fi&lt;br/&gt;
    multi_hbase_daemon_check_pidfiles &amp;gt; /dev/null&lt;br/&gt;
    if [ &quot;$?&quot; != &quot;$NO_DAEMONS_RUNNING&quot; ] ; then&lt;br/&gt;
      echo &quot;Cannot start $NAME - other regionserver daemons have already been started.&quot;&lt;br/&gt;
      exit 1&lt;br/&gt;
    fi&lt;br/&gt;
    echo -n &quot;Starting $DESC: &quot;&lt;br/&gt;
    su -s /bin/sh hbase -c &quot;$DAEMON_SCRIPT start regionserver&quot;&lt;br/&gt;
    if hbase_check_pidfile $PID_FILE ; then&lt;br/&gt;
        echo &quot;$NAME.&quot;&lt;br/&gt;
    else&lt;br/&gt;
        echo &quot;ERROR.&quot;&lt;br/&gt;
    fi&lt;br/&gt;
}&lt;br/&gt;
stop() {&lt;br/&gt;
    if [ -n &quot;${OFFSETS_FROM_CLI}
&lt;p&gt;$&lt;/p&gt;
{OFFSETS_FROM_PIDS}
&lt;p&gt;&quot; ] ; then&lt;br/&gt;
        multi_hbase_daemon &quot;stop&quot;&lt;br/&gt;
        return &quot;$?&quot;&lt;br/&gt;
    fi&lt;/p&gt;

&lt;p&gt;    echo -n &quot;Stopping $DESC: &quot;&lt;br/&gt;
    su -s /bin/sh hbase -c &quot;$DAEMON_SCRIPT stop regionserver&quot;&lt;br/&gt;
    if hbase_check_pidfile $PID_FILE ; then&lt;br/&gt;
        echo &quot;ERROR.&quot;&lt;br/&gt;
    else&lt;br/&gt;
        echo &quot;$NAME.&quot;&lt;br/&gt;
    fi&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;force_stop() &lt;/p&gt;
{
    MULTI_HBASE_DAEMON_STATUS_TEXT=`multi_hbase_daemon_check_pidfiles`
    MULTI_HBASE_DAEMON_STATUS=$?
    if [ &quot;$MULTI_HBASE_DAEMON_STATUS&quot; == &quot;$NO_DAEMONS_RUNNING&quot; ] ; then
        echo -n &quot;Forcefully stopping $DESC: &quot;
        hbase_stop_pidfile $PID_FILE
        if hbase_check_pidfile $PID_FILE ; then
            echo &quot; ERROR.&quot;
        else
            echo &quot;$NAME.&quot;
        fi
    else
        multi_hbase_daemon_stop_pidfiles
    fi
}

&lt;p&gt;force_reload() &lt;/p&gt;
{
  # check wether $DAEMON is running. If so, restart
  hbase_check_pidfile $PID_FILE &amp;amp;&amp;amp; $0 restart $OFFSETS_FROM_CLI
}

&lt;p&gt;restart() &lt;/p&gt;
{
    echo -n &quot;Restarting $DESC: &quot;
    $0 stop
    [ -n &quot;$DODTIME&quot; ] &amp;amp;&amp;amp; sleep $DODTIME
    $0 start $OFFSETS_FROM_CLI
}

&lt;p&gt;status() &lt;/p&gt;
{
    MULTI_HBASE_DAEMON_STATUS_TEXT=`multi_hbase_daemon_check_pidfiles`
    MULTI_HBASE_DAEMON_STATUS=$?
    if [ &quot;$MULTI_HBASE_DAEMON_STATUS&quot; == &quot;$NO_DAEMONS_RUNNING&quot; ] ; then
        echo -n &quot;$NAME is &quot;
        if hbase_check_pidfile $PID_FILE ;  then
            echo &quot;running&quot;
        else
            echo &quot;not running.&quot;
            return $NO_DAEMONS_RUNNING
        fi
    else
        IFS=&apos;&apos;
        echo $MULTI_HBASE_DAEMON_STATUS_TEXT
        return $MULTI_HBASE_DAEMONS_STATUS
    fi
}

&lt;p&gt;condrestart()&lt;/p&gt;
{
    status $@ &amp;gt;/dev/null 2&amp;gt;/dev/null
    DAEMON_STATUS=$?
    if [ &quot;$DAEMON_STATUS&quot; == &quot;$ALL_DAEMONS_RUNNING&quot; -o &quot;$DAEMON_STATUS&quot; == &quot;$SOME_OFFSET_DAEMONS_FAILING&quot; ] ; then
        restart $@
    fi
}

&lt;p&gt;case &quot;$1&quot; in&lt;br/&gt;
  start)&lt;br/&gt;
        start&lt;br/&gt;
  ;;&lt;br/&gt;
  stop)&lt;br/&gt;
        stop&lt;br/&gt;
  ;;&lt;br/&gt;
  force-stop)&lt;br/&gt;
        force_stop&lt;br/&gt;
  ;;&lt;br/&gt;
  force-reload)&lt;br/&gt;
        force_reload&lt;br/&gt;
  ;;&lt;br/&gt;
  restart)&lt;br/&gt;
        restart&lt;br/&gt;
        exit $?&lt;br/&gt;
    ;;&lt;br/&gt;
  condrestart)&lt;br/&gt;
        condrestart&lt;br/&gt;
  ;;&lt;br/&gt;
  status)&lt;br/&gt;
        status&lt;br/&gt;
    ;;&lt;br/&gt;
  *)&lt;br/&gt;
  N=/etc/init.d/$NAME&lt;br/&gt;
  echo &quot;Usage: $N &lt;/p&gt;
{start|stop|restart|force-reload|status|force-stop|condrestart}
&lt;p&gt;&quot; &amp;gt;&amp;amp;2&lt;br/&gt;
  exit 1&lt;br/&gt;
  ;;&lt;br/&gt;
esac&lt;/p&gt;

&lt;p&gt;exit 0&lt;/p&gt;
</comment>
                            <comment id="13691963" author="mcz" created="Mon, 24 Jun 2013 13:39:49 +0000"  >&lt;p&gt;The paste did not work out well, try this: &lt;a href=&quot;http://pastebin.com/cm9g3mtr&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pastebin.com/cm9g3mtr&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13691980" author="jmspaggi" created="Mon, 24 Jun 2013 13:57:28 +0000"  >&lt;p&gt;Hi Michael,&lt;/p&gt;

&lt;p&gt;The version of this script for the Cloudera distribution has been modified a lot. So you will need to report the issue on the Cloudera&apos;s CDH distribution list and open a defect on that side. This defect (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8793&quot; title=&quot;Regionserver ubuntu&amp;#39;s startup script return code always 0&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8793&quot;&gt;&lt;del&gt;HBASE-8793&lt;/del&gt;&lt;/a&gt;) will have to be closed since this doesn&apos;t applied to the Apache version. Let me know if you are not on the CDH distribution list and I will point you to the right URLs/directions.&lt;/p&gt;</comment>
                            <comment id="13691985" author="mcz" created="Mon, 24 Jun 2013 13:59:34 +0000"  >&lt;p&gt;I understand, sounds good, if you can drop me a link that would be great, thanks again for your time.&lt;/p&gt;</comment>
                            <comment id="13692139" author="jmspaggi" created="Mon, 24 Jun 2013 16:56:14 +0000"  >&lt;p&gt;Hi Michael,&lt;/p&gt;

&lt;p&gt;Here is the CDH list: &lt;a href=&quot;https://groups.google.com/a/cloudera.org/forum/#!forum/cdh-user&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://groups.google.com/a/cloudera.org/forum/#!forum/cdh-user&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Alway willing to help. Talk to you on the CDH list &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13692937" author="jmspaggi" created="Tue, 25 Jun 2013 11:24:14 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; or &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; can one of you please close this defect? Thanks.&lt;/p&gt;</comment>
                            <comment id="13693639" author="stack" created="Wed, 26 Jun 2013 05:02:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; You are a contributor now.  Try doing stuff in JIRA.  Let me know if you can&apos;t.  Thanks boss.&lt;/p&gt;</comment>
                            <comment id="13693955" author="jmspaggi" created="Wed, 26 Jun 2013 13:19:31 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;, Thanks for that! However, I tried to close 8803 or to modify one comment, or change the status, but I&apos;m still not able. I can modify the few attributs, but not the resolution nor the status. Same in this defect, not able to modify those fields.&lt;/p&gt;</comment>
                            <comment id="13694005" author="stack" created="Wed, 26 Jun 2013 14:44:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; Try again (smile); I added you to the &apos;committer&apos;s list though you ain&apos;t..&lt;/p&gt;</comment>
                            <comment id="13694006" author="stack" created="Wed, 26 Jun 2013 14:44:51 +0000"  >&lt;p&gt;Yet...&lt;/p&gt;</comment>
                            <comment id="13694015" author="jmspaggi" created="Wed, 26 Jun 2013 14:56:54 +0000"  >&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Thanks for the &quot;yet&quot; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I just retried and sent you an email about the result.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 24 Jun 2013 13:24:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334734</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lqp3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335060</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>hbase upstart</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>