<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:01:52 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2432/HBASE-2432.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2432] enhance hbase.util.Bytes.toBytes() with length limit</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2432</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The following stack trace is seen in our hadoop log:&lt;/p&gt;

&lt;p&gt;java.lang.IllegalArgumentException: Row &amp;gt; 32767&lt;br/&gt;
	at org.apache.hadoop.hbase.KeyValue.createByteArray(KeyValue.java:437)&lt;br/&gt;
	at org.apache.hadoop.hbase.KeyValue.(KeyValue.java:405)&lt;br/&gt;
	at org.apache.hadoop.hbase.KeyValue.(KeyValue.java:374)&lt;br/&gt;
	at org.apache.hadoop.hbase.KeyValue.(KeyValue.java:353)&lt;br/&gt;
	at org.apache.hadoop.hbase.client.Put.add(Put.java:137)&lt;br/&gt;
	at org.apache.hadoop.hbase.client.Put.add(Put.java:108)&lt;br/&gt;
	at org.apache.nutch.scoring.webgraph.ScoreUpdater$ScoreUpdaterReducer.reduce(ScoreUpdater.java:170)&lt;br/&gt;
	at org.apache.nutch.scoring.webgraph.ScoreUpdater$ScoreUpdaterReducer.reduce(ScoreUpdater.java:127)&lt;br/&gt;
	at org.apache.hadoop.mapreduce.Reducer.run(Reducer.java:174)&lt;br/&gt;
	at org.apache.hadoop.mapred.ReduceTask.runNewReducer(ReduceTask.java:563)&lt;br/&gt;
	at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:408)&lt;br/&gt;
	at org.apache.hadoop.mapred.Child.main(Child.java:170)&lt;/p&gt;

&lt;p&gt;Bytes.toBytes(Float.valueOf(score).toString()) may return an array longer than 32767 bytes.&lt;/p&gt;

&lt;p&gt;We should enhance Bytes.toBytes() to include length limit:&lt;br/&gt;
  public static byte[] toBytes(String s, int length) &lt;/p&gt;

&lt;p&gt;String.getBytes() doesn&apos;t have length limit&lt;/p&gt;</description>
                <environment></environment>
        <key id="12461698">HBASE-2432</key>
            <summary>enhance hbase.util.Bytes.toBytes() with length limit</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="4">Incomplete</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ted_yu">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Apr 2010 18:16:34 +0000</created>
                <updated>Sun, 26 Jan 2014 22:06:05 +0000</updated>
                            <resolved>Sun, 26 Jan 2014 22:06:05 +0000</resolved>
                                    <version>0.20.1</version>
                                                    <component>util</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12855551" author="ted_yu" created="Sat, 10 Apr 2010 12:52:39 +0000"  >&lt;p&gt;Here is one implementation:&lt;/p&gt;

&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Converts a string to a UTF-8 byte array with limited length.&lt;/li&gt;
	&lt;li&gt;@param s the string&lt;/li&gt;
	&lt;li&gt;@param len the length limit&lt;/li&gt;
	&lt;li&gt;@return the byte array&lt;br/&gt;
   */&lt;br/&gt;
  public static byte[] toBytes(String s, int len) {&lt;br/&gt;
    if (s == null) 
{
      throw new IllegalArgumentException(&quot;string cannot be null&quot;);
    }
&lt;p&gt;    if (len &amp;lt;= 0) &lt;/p&gt;
{
      throw new IllegalArgumentException(&quot;string length should be positive&quot;);
    }
&lt;p&gt;    byte [] result = null;&lt;br/&gt;
	byte [] ary = null;&lt;br/&gt;
    try &lt;/p&gt;
{
      ary = s.getBytes(HConstants.UTF8_ENCODING);
    }
&lt;p&gt; catch (UnsupportedEncodingException e) &lt;/p&gt;
{
      e.printStackTrace();
    }
&lt;p&gt;	if (ary.length &amp;gt; len)&lt;/p&gt;
	{
	  result = new byte[len];
	  System.arraycopy(ary, 0, result, 0, len);
	}
&lt;p&gt;	else result = ary;&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    return result;&lt;br/&gt;
  }&lt;/p&gt;</comment>
                            <comment id="12855664" author="ted_yu" created="Sun, 11 Apr 2010 01:37:19 +0000"  >&lt;p&gt;String.format() can be used to limit the length of String representation for float or double.&lt;/p&gt;</comment>
                            <comment id="12855749" author="stack" created="Sun, 11 Apr 2010 16:43:28 +0000"  >&lt;p&gt;Please attach a patch Ted.  Include a unit test and it&apos;ll make it more likely your patch will be committed.  Thanks.&lt;/p&gt;</comment>
                            <comment id="12855775" author="ted_yu" created="Sun, 11 Apr 2010 21:03:55 +0000"  >&lt;p&gt;Added&lt;br/&gt;
  public static byte[] toBytes(String s, int len) {&lt;/p&gt;</comment>
                            <comment id="12855818" author="ted_yu" created="Mon, 12 Apr 2010 02:59:11 +0000"  >&lt;p&gt;Added a test in TestBytes for the new method.&lt;/p&gt;</comment>
                            <comment id="12856014" author="stack" created="Mon, 12 Apr 2010 15:26:29 +0000"  >&lt;p&gt;What are you trying to achieve Ted?  You want to make a row that is &amp;lt; 32k? (You realize that maximum row size in 32k in hbase?).&lt;/p&gt;

&lt;p&gt;Regards your patch, you are cutting the byte array at an arbitrary point.  Do you want to do that?  What if your cut happens in the middle of a multibyte character.  You&apos;ll have difficulty making a String of it out on the other side (presuming you want to do such a thing which seems likely given your source is a String).&lt;/p&gt;</comment>
                            <comment id="12856119" author="ted_yu" created="Mon, 12 Apr 2010 18:52:16 +0000"  >&lt;p&gt;The motivation was due to row size limit of 32767.&lt;/p&gt;

&lt;p&gt;The initial patch targeted String which represents Float. So it is not suitable for restoring to arbitrary data types. For multibyte character strings, I checked &lt;br/&gt;
StringCoding.encode(String charsetName, char[] ca, int off, int len) which resorts to StringEncoder, a private class.&lt;/p&gt;

&lt;p&gt;So more work is needed for multibyte character strings.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12441439" name="ASF.LICENSE.NOT.GRANTED--HBASE-2432.patch" size="1307" author="ted_yu" created="Mon, 12 Apr 2010 02:59:11 +0000"/>
                            <attachment id="12441423" name="ASF.LICENSE.NOT.GRANTED--HBASE-2432.patch" size="948" author="ted_yu" created="Sun, 11 Apr 2010 21:03:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 11 Apr 2010 16:43:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32582</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 36 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02g1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12202</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>