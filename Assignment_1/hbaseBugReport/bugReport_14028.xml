<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:49:03 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14028/HBASE-14028.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14028] DistributedLogReplay drops edits when ITBLL 125M</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14028</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Testing DLR before 1.2.0RC gets cut, we are dropping edits.&lt;/p&gt;

&lt;p&gt;Issue seems to be around replay into a deployed region that is on a server that dies before all edits have finished replaying. Logging is sparse on sequenceid accounting so can&apos;t tell for sure how it is happening (and if our now accounting by Store is messing up DLR). Digging.&lt;/p&gt;

&lt;p&gt;I notice also that DLR does not refresh its cache of region location on error &amp;#8211; it just keeps trying till whole WAL fails.... 8 retries...about 30 seconds. We could do a bit of refactor and have the replay find region in new location if moved during DLR replay.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12843020">HBASE-14028</key>
            <summary>DistributedLogReplay drops edits when ITBLL 125M</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="7">Later</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Mon, 6 Jul 2015 23:01:50 +0000</created>
                <updated>Tue, 22 Sep 2015 03:56:43 +0000</updated>
                            <resolved>Tue, 22 Sep 2015 03:56:43 +0000</resolved>
                                    <version>1.2.0</version>
                                                    <component>Recovery</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="14615868" author="vrodionov" created="Mon, 6 Jul 2015 23:21:24 +0000"  >&lt;p&gt;This -recovery-from-failure-during-recovery-from-failure thing looks quite complicated to me. I am working on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7912&quot; title=&quot;HBase Backup/Restore Based on HBase Snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7912&quot;&gt;HBASE-7912&lt;/a&gt; and one of the improvements which is on the list is WALPlayer into HFiles followed by a bulk load. Pounding HBase with millions of puts is not the right approach.&lt;/p&gt;</comment>
                            <comment id="14615977" author="stack" created="Tue, 7 Jul 2015 00:34:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;This -recovery-from-failure-during-recovery-from-failure thing looks quite complicated to me. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. It should work. All the pieces are there.  Smile.  I&apos;ve done a few more runs and it passes sometimes.  Let me try and figure the hole.&lt;/p&gt;</comment>
                            <comment id="14617997" author="stack" created="Wed, 8 Jul 2015 05:16:37 +0000"  >&lt;p&gt;I have been playing more with this. Losing data is pretty easy to do. Trying to find why the end of a WAL goes missing during replay; there is not enough info to debug and it is a little tough to trace where we&apos;re at at any one time. Trying to back fill.&lt;/p&gt;</comment>
                            <comment id="14618938" author="stack" created="Wed, 8 Jul 2015 17:03:36 +0000"  >&lt;p&gt;Latest:&lt;/p&gt;

&lt;p&gt;I see a swath of edits that were posted below not showing up on the far end though they were apparently successfully digested on the remote end (found by aligning count of edits and some extra logging of sequenceids added in testbed):&lt;/p&gt;

&lt;p&gt;2015-07-07 07:16:35,728 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_LOG_REPLAY_OPS-c2024:16020-0-Writer-2&amp;#93;&lt;/span&gt; wal.WALEditsReplaySink: Replayed 231 edits in 2458ms into region=IntegrationTestBigLinkedList,\x7F\xFF\xFF\xFF\xFF\xFF\xFF\xF8,1436277280607.bb166b99140bcd32df68676b4e1b60b2., hostname=c2025.halxg.cloudera.com,16020,1436278565173, seqNum=320072187, lastSequenceId=280072763&lt;/p&gt;

&lt;p&gt;At the time, the recovering region is flushing &amp;#8211; a few logs are being replayed into this recovering region concurrently &amp;#8211; which is what is unusual around this event.&lt;/p&gt;

&lt;p&gt;I don&apos;t really seen filtering going on sink-side (except if not the primary replica).&lt;/p&gt;

&lt;p&gt;Adding more logging and retrying.&lt;/p&gt;
</comment>
                            <comment id="14619615" author="stack" created="Thu, 9 Jul 2015 00:03:21 +0000"  >&lt;p&gt;I added logging and reran. Found another failure type beyond the above described replay over a coincident flush.&lt;/p&gt;

&lt;p&gt;Highlevel, region opens, we start to replay edits but well before the replay can finish, the server hosting the newly opened region crashes. Edits in the WAL we were replaying get skipped on second attempt.&lt;/p&gt;

&lt;p&gt;Here is open before crash:&lt;/p&gt;

&lt;p&gt;2015-07-08 12:45:38,317 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-c2023:16020-0&amp;#93;&lt;/span&gt; wal.WALSplitter: Wrote region seqId=hdfs://c2020.halxg.cloudera.com:8020/hbase/data/default/IntegrationTestBigLinkedList/467eaf13c7ce1f2e1afb1c567322c9e7/recovered.edits/760185051.seqid to file, newSeqId=760185051, maxSeqId=720162792&lt;/p&gt;

&lt;p&gt;Here is open after crash:&lt;/p&gt;

&lt;p&gt;2015-07-08 12:45:49,920 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_OPEN_REGION-c2025:16020-1&amp;#93;&lt;/span&gt; wal.WALSplitter: Wrote region seqId=hdfs://c2020.halxg.cloudera.com:8020/hbase/data/default/IntegrationTestBigLinkedList/467eaf13c7ce1f2e1afb1c567322c9e7/recovered.edits/800185051.seqid to file, newSeqId=800185051, maxSeqId=760185051&lt;/p&gt;

&lt;p&gt;See how newSeqId the first time around becomes the maxSeqId the second time we open. This is broke (this is the well-padded sequence id set well in advance of any edits that could come in during replay). See how on subsequent replay we end up skipping most of the edits:&lt;/p&gt;

&lt;p&gt;2015-07-08 12:46:25,103 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;RS_LOG_REPLAY_OPS-c2025:16020-1&amp;#93;&lt;/span&gt; wal.WALSplitter: Processed 80 edits across 0 regions; edits skipped=1583; log file=hdfs://c2020.halxg.cloudera.com:8020/hbase/WALs/c2021.halxg.cloudera.com,16020,1436383987497-splitting/c2021.halxg.cloudera.com%2C16020%2C1436383987497.default.1436384632799, length=72993715, corrupted=false, progress failed=false&lt;/p&gt;

&lt;p&gt;(Says 80 edits for ZERO regions... )&lt;/p&gt;

&lt;p&gt;The maximum sequence id in the WAL to replay is 720185601 even though we did not replay all edits. &lt;/p&gt;

&lt;p&gt;So, at least two issues.&lt;/p&gt;

&lt;p&gt;Let me put this aside since it looks like it won&apos;t make hbase-1.2.0 at this late stage.&lt;/p&gt;



</comment>
                            <comment id="14619616" author="stack" created="Thu, 9 Jul 2015 00:04:38 +0000"  >&lt;p&gt;Patch w/ extra logging used digging in on DLR.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12612336">HBASE-7006</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12744368" name="14028.logging.txt" size="7036" author="stack" created="Thu, 9 Jul 2015 00:04:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 6 Jul 2015 23:21:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2gwqn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>