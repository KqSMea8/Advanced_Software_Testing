<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:44:52 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7346/HBASE-7346.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7346] Restored snapshot replay problem</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7346</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The situation is a coarse-grained problem. The key problem is that writes that shouldn&apos;t be replayed (since they don&apos;t belong to the restored image), would not normally get replayed, but would potentially get replayed if recovery was triggered.&lt;br/&gt;
Previously, without restore, we could depend on the timestamps &#8211; if something was replayed but there was newer data, the newer data would win. In a restore situation, the &quot;newer&quot; data is has the old time stamps from before recovery, and new data that shouldn&apos;t get replayed could be.&lt;br/&gt;
ex: &lt;br/&gt;
1) write 100 rows&lt;br/&gt;
2) ss1 (with logs)&lt;br/&gt;
3) write 50 rows&lt;br/&gt;
4) restore ss1&lt;br/&gt;
5) crash&lt;br/&gt;
6) writes from 1 and 3 both get replayed in log splitting recovery. Oops.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12623773">HBASE-7346</key>
            <summary>Restored snapshot replay problem</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jmhsieh">Jonathan Hsieh</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Dec 2012 16:11:48 +0000</created>
                <updated>Thu, 21 Feb 2013 04:33:24 +0000</updated>
                                            <version>hbase-6055</version>
                                    <fixVersion>hbase-6055</fixVersion>
                                    <component>Client</component>
                    <component>master</component>
                    <component>regionserver</component>
                    <component>snapshots</component>
                    <component>Zookeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13531139" author="jmhsieh" created="Thu, 13 Dec 2012 16:15:39 +0000"  >&lt;p&gt;It was suggested by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt; that we probably can adding a restore timestamp somewhere to a restored snapshot and have log splitting not restore data before that timestamp in that case.  Since we require a disable before restore, this may be able to avoid restore ragged edges due to having many rs&apos;s with different timestamps.&lt;/p&gt;</comment>
                            <comment id="13531349" author="jesse_yates" created="Thu, 13 Dec 2012 19:16:49 +0000"  >&lt;p&gt;When we do restore a table, it needds be disabled first (no inflight restores!), which flushes everything to disk and rolls the WAL. This seems as simple as just removing the existing recovered.edits directory under a table before we restore the table.&lt;/p&gt;

&lt;p&gt;As an aside, offline snapshots don&apos;t actually reference any of the WALs and just copy the recovered.edits directory over, just incase something is in there. This should only apply to the online snapshot cases.&lt;/p&gt;</comment>
                            <comment id="13531404" author="jmhsieh" created="Thu, 13 Dec 2012 19:56:19 +0000"  >&lt;p&gt;This crash I&apos;m talking about is after the restore has successfully completed (after step 4).  &lt;/p&gt;

&lt;p&gt;Does the disable table flushing + log rolling guarantee that logs are moved out of the way so that they won&apos;t be replayed?  &lt;/p&gt;

&lt;p&gt;Let&apos;s double check and add a test case for this.  That is the easiest way to convince that this is or isn&apos;t a problem on the offline or online cases.&lt;/p&gt;

</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 13 Dec 2012 19:16:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>297473</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14oxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>235505</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>