<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:24:00 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5017/HBASE-5017.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5017] Bump the default hfile.block.cache.size because of HFileV2</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5017</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Here&apos;s the email I sent to the mailing list describing the problem:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;A thought just stuck me while I was writing down a more detailed block&lt;br/&gt;
caching documentation: with HFileV2, the indexes now live in the block&lt;br/&gt;
cache which means that those who upgrade may all of a sudden get&lt;br/&gt;
terrible cache hit ratios because of all that memory taken by the&lt;br/&gt;
indexes. This is somewhat mitigated by the fact that people don&apos;t&lt;br/&gt;
usually need to keep &lt;em&gt;all&lt;/em&gt; the index blocks in memory so in the end&lt;br/&gt;
we&apos;re more efficient.&lt;/p&gt;

&lt;p&gt;Which brings me to a question: should we set hfile.block.cache.size&lt;br/&gt;
higher since indexes are now kept in the block cache? Currently it&apos;s&lt;br/&gt;
set to 20%.&lt;/p&gt;

&lt;p&gt;Looking over my own production machines I see that the&lt;br/&gt;
storefileIndexSize is around 600-700MB so that&apos;s potentially how much&lt;br/&gt;
more data I&apos;d have to block cache (more likely it&apos;s half of that&lt;br/&gt;
that&apos;s really being used actively).&lt;/p&gt;

&lt;p&gt;What would be a good new default? 25%? 30%? How do we handle those&lt;br/&gt;
that will be pushed over the BC+memstore size limit because of that&lt;br/&gt;
change?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll bump this to 25% and put in the release note the fact that people should verify their settings before upgrading to make sure memstore+block cache isn&apos;t over 80% (meaning they&apos;d haven&apos;t change the block cache size but would have bumped the memstores from 40% to 60%).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12534991">HBASE-5017</key>
            <summary>Bump the default hfile.block.cache.size because of HFileV2</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Dec 2011 18:09:55 +0000</created>
                <updated>Fri, 12 Oct 2012 05:34:50 +0000</updated>
                            <resolved>Tue, 13 Dec 2011 21:57:36 +0000</resolved>
                                    <version>0.92.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                    <fixVersion>0.94.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13168565" author="stack" created="Tue, 13 Dec 2011 18:16:57 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13168570" author="zhihyu@ebaysf.com" created="Tue, 13 Dec 2011 18:19:29 +0000"  >&lt;p&gt;Can we perform some validation against the sum of hbase.regionserver.global.memstore.upperLimit and hfile.block.cache.size so that we can remind the user of the proper mix ?&lt;br/&gt;
The reminder can be displayed on master UI.&lt;/p&gt;</comment>
                            <comment id="13168575" author="jdcryans" created="Tue, 13 Dec 2011 18:23:17 +0000"  >&lt;p&gt;We perform the validation inside HBaseConfiguration at the moment in checkForClusterFreeMemoryLimit(), it prints out in stdout.&lt;/p&gt;</comment>
                            <comment id="13168578" author="stack" created="Tue, 13 Dec 2011 18:29:23 +0000"  >&lt;p&gt;I think thats good enough for 0.92, at least for next RC (almost ready to cut it).&lt;br/&gt;
St.Ack&lt;/p&gt;</comment>
                            <comment id="13168584" author="jdcryans" created="Tue, 13 Dec 2011 18:33:41 +0000"  >&lt;p&gt;Made the change, plus while looking for the configuration in the code I saw that it was a big mess so I did a little refactoring.&lt;/p&gt;</comment>
                            <comment id="13168722" author="stack" created="Tue, 13 Dec 2011 21:11:14 +0000"  >&lt;p&gt;+1 on commit to trunk and 0.92&lt;/p&gt;</comment>
                            <comment id="13168757" author="jdcryans" created="Tue, 13 Dec 2011 21:44:52 +0000"  >&lt;p&gt;Patch for trunk, notice that I fixed a comment that was wrongly placed in the first patch. It will be fixed for 0.92 too.&lt;/p&gt;</comment>
                            <comment id="13168765" author="jdcryans" created="Tue, 13 Dec 2011 21:54:31 +0000"  >&lt;p&gt;I generated the patch too early, was missing a few more fixes specific to trunk.&lt;/p&gt;</comment>
                            <comment id="13168766" author="jdcryans" created="Tue, 13 Dec 2011 21:57:36 +0000"  >&lt;p&gt;Committed to branch and trunk.&lt;/p&gt;</comment>
                            <comment id="13168951" author="hudson" created="Wed, 14 Dec 2011 01:18:34 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #188 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/188/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/188/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5017&quot; title=&quot;Bump the default hfile.block.cache.size because of HFileV2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5017&quot;&gt;&lt;del&gt;HBASE-5017&lt;/del&gt;&lt;/a&gt;  Bump the default hfile.block.cache.size because of HFileV2&lt;/p&gt;

&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/HBaseConfiguration.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/resources/hbase-default.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13169061" author="hudson" created="Wed, 14 Dec 2011 03:54:53 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #189 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/189/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/189/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5017&quot; title=&quot;Bump the default hfile.block.cache.size because of HFileV2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5017&quot;&gt;&lt;del&gt;HBASE-5017&lt;/del&gt;&lt;/a&gt;&apos;s commit was missing one patch that was applied to trunk&lt;/p&gt;

&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13169097" author="hudson" created="Wed, 14 Dec 2011 05:58:32 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2544 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2544/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2544/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5017&quot; title=&quot;Bump the default hfile.block.cache.size because of HFileV2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5017&quot;&gt;&lt;del&gt;HBASE-5017&lt;/del&gt;&lt;/a&gt;  Bump the default hfile.block.cache.size because of HFileV2&lt;/p&gt;

&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HBaseConfiguration.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/HFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/resources/hbase-default.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13169099" author="hudson" created="Wed, 14 Dec 2011 05:59:22 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #38 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/38/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/38/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5017&quot; title=&quot;Bump the default hfile.block.cache.size because of HFileV2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5017&quot;&gt;&lt;del&gt;HBASE-5017&lt;/del&gt;&lt;/a&gt;&apos;s commit was missing one patch that was applied to trunk&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5017&quot; title=&quot;Bump the default hfile.block.cache.size because of HFileV2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5017&quot;&gt;&lt;del&gt;HBASE-5017&lt;/del&gt;&lt;/a&gt;  Bump the default hfile.block.cache.size because of HFileV2&lt;/p&gt;

&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/HBaseConfiguration.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/resources/hbase-default.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13169121" author="hudson" created="Wed, 14 Dec 2011 07:01:36 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #31 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/31/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/31/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5017&quot; title=&quot;Bump the default hfile.block.cache.size because of HFileV2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5017&quot;&gt;&lt;del&gt;HBASE-5017&lt;/del&gt;&lt;/a&gt;  Bump the default hfile.block.cache.size because of HFileV2&lt;/p&gt;

&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HBaseConfiguration.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/HFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/resources/hbase-default.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12507252" name="HBASE-5017-trunk-v2.patch" size="7246" author="jdcryans" created="Tue, 13 Dec 2011 21:54:30 +0000"/>
                            <attachment id="12507250" name="HBASE-5017-trunk.patch" size="5041" author="jdcryans" created="Tue, 13 Dec 2011 21:44:52 +0000"/>
                            <attachment id="12507218" name="HBASE-5017.patch" size="5041" author="jdcryans" created="Tue, 13 Dec 2011 18:33:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 13 Dec 2011 18:16:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>220675</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 1 week, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08rmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49076</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>The default percentage of heap space allocated to the block cache has been increased from 20% to 25%. However, index caching is now accounted for in the block cache, so total heap usage should be minimally affected.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>