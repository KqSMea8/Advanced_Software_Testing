<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:50:58 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7985/HBASE-7985.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7985] TestMasterFailover.testMasterFailoverWithMockedRITOnDeadRS fails frequently in 0.94</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7985</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;4 failures of this test in the last 6 builds.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12635043">HBASE-7985</key>
            <summary>TestMasterFailover.testMasterFailoverWithMockedRITOnDeadRS fails frequently in 0.94</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Sun, 3 Mar 2013 20:58:30 +0000</created>
                <updated>Thu, 14 Mar 2013 16:34:47 +0000</updated>
                            <resolved>Thu, 14 Mar 2013 16:34:47 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13591959" author="ram_krish" created="Mon, 4 Mar 2013 03:23:41 +0000"  >&lt;p&gt;I can check this today.&lt;/p&gt;</comment>
                            <comment id="13591973" author="lhofhansl" created="Mon, 4 Mar 2013 03:48:32 +0000"  >&lt;p&gt;Thanks Ram. Was also going to look, let&apos;s see what we can find.&lt;/p&gt;</comment>
                            <comment id="13591981" author="ram_krish" created="Mon, 4 Mar 2013 04:30:20 +0000"  >&lt;p&gt;Could find the reason for one of the region why it is in RIT.  Checking with a case where it ran successfully then will update.&lt;/p&gt;</comment>
                            <comment id="13591990" author="ram_krish" created="Mon, 4 Mar 2013 04:53:21 +0000"  >&lt;p&gt;This is what is happening.  &lt;br/&gt;
Whenever the test passes, the the RS that we abort in the test is the one that carried META.  Whenever the test fails the RS that we abort does not have the META.&lt;br/&gt;
As part of master initialization i saw that the following code exists, it checks if META was down on master restart&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// log splitting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; .META. server
&lt;/span&gt;    ServerName preMetaServer = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.catalogTracker.getMetaLocationOrReadLocationFromRoot();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (preMetaServer != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; failedServers.contains(preMetaServer)) {
      &lt;span class=&quot;code-comment&quot;&gt;// create recovered edits file &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; .META. server
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fileSystemManager.splitLog(preMetaServer);
      failedServers.remove(preMetaServer);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here we see that the META RS is removed from the failedServer.&lt;br/&gt;
In a normal case where RS that did not carry META was aborted, the below code will add the server to the ServerManager.deadServer list.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (ServerName curServer : failedServers) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.serverManager.processDeadServer(curServer);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now when the RS is part of the deadServer, when master tries to do AM.joinCluser(), if we find the deadServer name in any of the znode that was left over we tend to skip the znode expecting SSH to take care.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Set&amp;lt;ServerName&amp;gt; actualDeadServers = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.serverManager.getDeadServers();
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;ServerName, List&amp;lt;Pair&amp;lt;HRegionInfo, Result&amp;gt;&amp;gt;&amp;gt; deadServer : 
        deadServers.entrySet()) {
        &lt;span class=&quot;code-comment&quot;&gt;// skip regions of dead servers because SSH will process regions during rs expiration.
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// see HBASE-5916
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (actualDeadServers.contains(deadServer.getKey())) {
          &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Pair&amp;lt;HRegionInfo, Result&amp;gt; deadRegion : deadServer.getValue()) {
            nodes.remove(deadRegion.getFirst().getEncodedName());
          }
          &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In case where the RS was having the META, because the RS was not added to deadServer list we were able to bypass this &apos;continue&apos; and the test went on fine.  I remember &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5916&quot; title=&quot;RS restart just before master intialization we make the cluster non operative&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5916&quot;&gt;&lt;del&gt;HBASE-5916&lt;/del&gt;&lt;/a&gt; was there for a long time but was the test failing so frequently for the past 2 or 3 months?&lt;/p&gt;</comment>
                            <comment id="13591991" author="ram_krish" created="Mon, 4 Mar 2013 04:56:42 +0000"  >&lt;p&gt;Or because of some new changes related to processing the .META.  Let me check.&lt;/p&gt;</comment>
                            <comment id="13591992" author="ram_krish" created="Mon, 4 Mar 2013 05:05:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7824&quot; title=&quot;Improve master start up time when there is log splitting work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7824&quot;&gt;&lt;del&gt;HBASE-7824&lt;/del&gt;&lt;/a&gt; has changed the area that i was mentioning above.  Will check what that patch does and understand it and then come up with a fix.&lt;/p&gt;</comment>
                            <comment id="13592003" author="lhofhansl" created="Mon, 4 Mar 2013 05:23:51 +0000"  >&lt;p&gt;Thank you Ram!&lt;/p&gt;</comment>
                            <comment id="13592010" author="ram_krish" created="Mon, 4 Mar 2013 05:57:15 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadservers.add(serverName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Removing the above line from ServerManager.processDeadServer() makes the test pass reliably.  I have asked over &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7824&quot; title=&quot;Improve master start up time when there is log splitting work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7824&quot;&gt;&lt;del&gt;HBASE-7824&lt;/del&gt;&lt;/a&gt; to understand the reasoning for adding it.  Let  me wait for Jeff&apos;s response.&lt;/p&gt;</comment>
                            <comment id="13602401" author="lhofhansl" created="Thu, 14 Mar 2013 16:34:47 +0000"  >&lt;p&gt;This is no longer a problem with the changes in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7824&quot; title=&quot;Improve master start up time when there is log splitting work&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7824&quot;&gt;&lt;del&gt;HBASE-7824&lt;/del&gt;&lt;/a&gt; (was reverted and then fixed). Closing this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12631850">HBASE-7824</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 4 Mar 2013 03:23:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>315536</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 40 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ig6f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>315880</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>