<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:10:04 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3422/HBASE-3422.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3422] Balancer will try to rebalance thousands of regions in one go; needs an upper bound added.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3422</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3420&quot; title=&quot;Handling a big rebalance, we can queue multiple instances of a Close event; messes up state&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3420&quot;&gt;&lt;del&gt;HBASE-3420&lt;/del&gt;&lt;/a&gt;.  Therein, a wonky cluster had 5k regions on one server and &amp;lt; 1k on others.  Balancer ran and wanted to redistribute 3k+ all in one go.  Madness.&lt;/p&gt;

&lt;p&gt;If a load of rebalancing to be done, should be done somewhat piecemeal.  We need maximum regions to rebalance at a time upper bound at a minimum.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12494771">HBASE-3422</key>
            <summary>Balancer will try to rebalance thousands of regions in one go; needs an upper bound added.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Jan 2011 21:38:04 +0000</created>
                <updated>Fri, 20 Nov 2015 12:42:46 +0000</updated>
                            <resolved>Sun, 20 Mar 2011 02:43:01 +0000</resolved>
                                    <version>0.90.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13008124" author="yuzhihong@gmail.com" created="Thu, 17 Mar 2011 20:55:28 +0000"  >&lt;p&gt;How about introducing hbase.balancer.maxregions.perround ?&lt;/p&gt;</comment>
                            <comment id="13008131" author="stack" created="Thu, 17 Mar 2011 21:03:19 +0000"  >&lt;p&gt;Sounds good Ted.  Should not apply to the bulk assign on startup though.  Good stuff.&lt;/p&gt;</comment>
                            <comment id="13008132" author="yuzhihong@gmail.com" created="Thu, 17 Mar 2011 21:07:22 +0000"  >&lt;p&gt;In terms of putting upper bound on the time it takes per call to HMaster.balance(), I think master should establish some metric about the execution time of plan execution.&lt;br/&gt;
Here is related code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      List&amp;lt;RegionPlan&amp;gt; plans = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.balancer.balanceCluster(assignments);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (plans != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !plans.isEmpty()) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (RegionPlan plan: plans) {
          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;balance &quot;&lt;/span&gt; + plan);
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.assignmentManager.balance(plan);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If the metric is collected for assignmentManager.balance() calls, balancer.balanceCluster() can make use of the metric and adjust the maximum number of regions assigned in one round.&lt;/p&gt;</comment>
                            <comment id="13008286" author="stack" created="Fri, 18 Mar 2011 02:24:15 +0000"  >&lt;p&gt;@Ted I like that idea.&lt;/p&gt;</comment>
                            <comment id="13008447" author="yuzhihong@gmail.com" created="Fri, 18 Mar 2011 14:22:30 +0000"  >&lt;p&gt;Currently it is possible for one HMaster.balance() call to last longer than hbase.balancer.period&lt;/p&gt;

&lt;p&gt;We should limit the execution time of HMaster.balance() by hbase.balancer.period&lt;br/&gt;
Is this equivalent to introducing hbase.balancer.maxregions.perround ?&lt;/p&gt;</comment>
                            <comment id="13008498" author="yuzhihong@gmail.com" created="Fri, 18 Mar 2011 16:25:32 +0000"  >&lt;p&gt;First attempt of using heuristics to decide whether executing the next RegionPlan would make single balancer() call too long.&lt;/p&gt;</comment>
                            <comment id="13008673" author="yuzhihong@gmail.com" created="Fri, 18 Mar 2011 23:18:23 +0000"  >&lt;p&gt;Summary of chat with Stack on IRC (see &lt;a href=&quot;http://pastebin.com/4uK9M1Z7):&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://pastebin.com/4uK9M1Z7):&lt;/a&gt;&lt;br/&gt;
Since it is difficult to estimate the appropriate number of regions to balance in one invocation of balance(), I resort to respecting the hbase.balancer.period&lt;br/&gt;
Another option would be to limit execution time of balance() to certain percentage of hbase.balancer.period&lt;br/&gt;
But that would introduce another parameter which complicates our scenario.&lt;/p&gt;</comment>
                            <comment id="13008702" author="yuzhihong@gmail.com" created="Sat, 19 Mar 2011 00:57:15 +0000"  >&lt;p&gt;Related unit tests: TestMasterObserver, TestMultiParallel, TestLoadBalancer and TestRegionRebalancing all pass.&lt;/p&gt;</comment>
                            <comment id="13008869" author="stack" created="Sun, 20 Mar 2011 02:43:01 +0000"  >&lt;p&gt;Lets try it Ted.  On commit I added in being able to set in config. an explicit limit on how long balancer would run but that default is that this is not specified.  I also added logging (DEBUG) for when balancer is cutoff because it ran out of time.&lt;/p&gt;

&lt;p&gt;Thanks for the patch Ted.  Committed to TRUNK.&lt;/p&gt;</comment>
                            <comment id="13008890" author="hudson" created="Sun, 20 Mar 2011 07:38:21 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1798 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1798/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1798/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3422&quot; title=&quot;Balancer will try to rebalance thousands of regions in one go; needs an upper bound added.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3422&quot;&gt;&lt;del&gt;HBASE-3422&lt;/del&gt;&lt;/a&gt; Balancer will try to rebalance thousands of regions in one go; needs an upper bound added&lt;/p&gt;</comment>
                            <comment id="15017339" author="lars_francke" created="Fri, 20 Nov 2015 12:42:46 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12494748">HBASE-3420</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12474013" name="hbase-3422.txt" size="2255" author="yuzhihong@gmail.com" created="Fri, 18 Mar 2011 16:25:32 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Mar 2011 20:55:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33017</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hm7z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100862</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>