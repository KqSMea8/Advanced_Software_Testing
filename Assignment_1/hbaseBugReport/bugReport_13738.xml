<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:46:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13738/HBASE-13738.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13738] Scan with RAW type for increment data insertions is displaying only latest two KV&apos;s </title>
                <link>https://issues.apache.org/jira/browse/HBASE-13738</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Scenario for Reproducing &amp;#93;&lt;/span&gt;:&lt;br/&gt;
1. Create an HBase table with single column family by keeping the versions=1 (DEFAULT)&lt;br/&gt;
2. Increment Insertion more than 2 times for the same row and for same qualifier.&lt;br/&gt;
3. scan the table with raw= true and versions= 10  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scan &apos;tbl&apos;, {RAW =&amp;gt; TRUE, VERSIONS =&amp;gt; 10}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Expected Result:&lt;br/&gt;
===============&lt;br/&gt;
Raw scan should result in all the versions until the table flushed&lt;/p&gt;</description>
                <environment>&lt;p&gt;Suse 11 SP3&lt;/p&gt;</environment>
        <key id="12831682">HBASE-13738</key>
            <summary>Scan with RAW type for increment data insertions is displaying only latest two KV&apos;s </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="pankaj2461">Pankaj Kumar</assignee>
                                    <reporter username="neha.bathra">neha</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 May 2015 10:15:20 +0000</created>
                <updated>Sat, 18 Jul 2015 11:36:09 +0000</updated>
                                                                            <component>Scanners</component>
                        <due>Sun, 31 May 2015 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="14554141" author="anoop.hbase" created="Thu, 21 May 2015 11:31:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;Create an HBase table with single column family by keeping the versions=1&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If you would like to see old values (cells) by raw scan, then you have to keep the CF versions &amp;gt;1. If CF version is 1, we will upsert the new cell to memstore and so can remove old entries.  Pls test with &amp;gt;1 max_versions.&lt;/p&gt;</comment>
                            <comment id="14554190" author="pankaj2461" created="Thu, 21 May 2015 12:16:36 +0000"  >&lt;p&gt;INCR old entries are getting removed from memstore when CF version is 1.&lt;/p&gt;

&lt;p&gt;But cell upsert having some problem seems, it is retaining two entries always. Ideally it should be one.&lt;/p&gt;

&lt;p&gt;{ code&lt;/p&gt;

&lt;p&gt;  // versions visible to oldest scanner&lt;br/&gt;
    int versionsVisible = 0;&lt;br/&gt;
    while ( it.hasNext() ) {&lt;br/&gt;
      Cell cur = it.next();&lt;/p&gt;

&lt;p&gt;      if (cell == cur) &lt;/p&gt;
{
        // ignore the one just put in
        continue;
      }
&lt;p&gt;      // check that this is the row and column we are interested in, otherwise bail&lt;br/&gt;
      if (CellUtil.matchingRow(cell, cur) &amp;amp;&amp;amp; CellUtil.matchingQualifier(cell, cur)) {&lt;br/&gt;
        // only remove Puts that concurrent scanners cannot possibly see&lt;br/&gt;
        if (cur.getTypeByte() == KeyValue.Type.Put.getCode() &amp;amp;&amp;amp;&lt;br/&gt;
            cur.getSequenceId() &amp;lt;= readpoint) {&lt;br/&gt;
          if (versionsVisible &amp;gt;= 1) &lt;/p&gt;
{

 code }</comment>
                            <comment id="14558106" author="pankaj2461" created="Mon, 25 May 2015 10:52:46 +0000"  >&lt;p&gt;Patch for review.&lt;/p&gt;</comment>
                            <comment id="14558126" author="anoop.hbase" created="Mon, 25 May 2015 11:21:18 +0000"  >&lt;p&gt;Can not increment versionsVisible blindly.  Check whether this version is visible for the oldest scanner.  That is the readPoint passed. When cur cell seqId &amp;gt; smallestReadPoint, we can not increment the variable...&lt;br/&gt;
You can add a test with concurrent scan case also.  &lt;br/&gt;
Add increment&lt;br/&gt;
Open a scanner  but no next call&lt;br/&gt;
Add increment&lt;br/&gt;
Add increment&lt;br/&gt;
Add increment&lt;br/&gt;
Now next on scanner.&lt;br/&gt;
The later increments has to preserve the 1st cell for the old scanner.  &lt;br/&gt;
Close scanner&lt;br/&gt;
Now if u again add one more increment see how many cells.&lt;/p&gt;</comment>
                            <comment id="14625140" author="apurtell" created="Mon, 13 Jul 2015 18:41:31 +0000"  >&lt;p&gt;Are you planning on putting up another version addressing Anoop&apos;s feedback &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pankaj_kumar&quot; class=&quot;user-hover&quot; rel=&quot;pankaj_kumar&quot;&gt;Pankaj Kumar&lt;/a&gt;? &lt;/p&gt;</comment>
                            <comment id="14626801" author="pankaj2461" created="Tue, 14 Jul 2015 18:14:39 +0000"  >&lt;p&gt;Sorry for late reply, I will provide another patch version soon addressing Anoop&apos;s feedback.&lt;/p&gt;</comment>
                            <comment id="14632391" author="lhofhansl" created="Sat, 18 Jul 2015 11:36:09 +0000"  >&lt;p&gt;Looks like we&apos;re fixing another problem now. The behavior described with VERSION=&amp;gt;1 is expected. If there&apos;s a problem and it keeps two version when it should only keep one, that&apos;s a different problem, and not a correctness issue.&lt;/p&gt;

&lt;p&gt;Maybe the second issue is already fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12931&quot; title=&quot;The existing KeyValues in memstore are not removed completely after inserting cell into memStore &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12931&quot;&gt;&lt;del&gt;HBASE-12931&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12735145" name="HBASE-13738.patch" size="2782" author="pankaj2461" created="Mon, 25 May 2015 10:52:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 21 May 2015 11:31:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 21 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f1fz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>