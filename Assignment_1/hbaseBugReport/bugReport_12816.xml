<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:36:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12816/HBASE-12816.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12816] GC logs are lost upon Region Server restart if GCLogFileRotation is enabled</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12816</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When -XX:+UseGCLogFileRotation is used gc log files end with .gc.0 instead of .gc.  hbase_rotate_log () in hbase-daemon.sh does not handle this correctly and hence when a RS is restarted old gc logs are lost(overwritten).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12765332">HBASE-12816</key>
            <summary>GC logs are lost upon Region Server restart if GCLogFileRotation is enabled</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="3" iconUrl="https://issues.apache.org/jira/images/icons/statuses/inprogress.png" description="This issue is being actively worked on at the moment by the assignee.">In Progress</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="abhishek.chouhan">Abhishek Singh Chouhan</assignee>
                                    <reporter username="abhishek.chouhan">Abhishek Singh Chouhan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Jan 2015 09:05:21 +0000</created>
                <updated>Sat, 31 Oct 2015 21:22:36 +0000</updated>
                                                            <fixVersion>2.0.0</fixVersion>
                                    <component>scripts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14268641" author="ndimiduk" created="Thu, 8 Jan 2015 01:06:25 +0000"  >&lt;p&gt;Good find &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abhishek.chouhan&quot; class=&quot;user-hover&quot; rel=&quot;abhishek.chouhan&quot;&gt;Abhishek Singh Chouhan&lt;/a&gt;. Hows your shell scripting? Care to provide a patch? Thanks.&lt;/p&gt;</comment>
                            <comment id="14269408" author="abhishek.chouhan" created="Thu, 8 Jan 2015 15:04:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; Does this patch look good?&lt;/p&gt;</comment>
                            <comment id="14272224" author="lhofhansl" created="Sat, 10 Jan 2015 01:43:19 +0000"  >&lt;p&gt;Looks good to me. Would this clash with the JVM writing new GC.x files?&lt;/p&gt;</comment>
                            <comment id="14272226" author="lhofhansl" created="Sat, 10 Jan 2015 01:45:55 +0000"  >&lt;p&gt;Actually, what about .1, .2, etc. That would still not be handled correctly, right?&lt;/p&gt;</comment>
                            <comment id="14278967" author="apurtell" created="Thu, 15 Jan 2015 17:22:42 +0000"  >&lt;p&gt;Aiming for the next 0.98 RC to happen on Monday Jan 19. This should be committed by then or let&apos;s move it to .11. &lt;/p&gt;</comment>
                            <comment id="14279413" author="enis" created="Thu, 15 Jan 2015 22:33:45 +0000"  >&lt;p&gt;maybe we should not custom rotate the logs in case &lt;tt&gt;-XX:+UseGCLogFileRotation&lt;/tt&gt; is set? &lt;/p&gt;</comment>
                            <comment id="14280009" author="abhishek.chouhan" created="Fri, 16 Jan 2015 09:11:36 +0000"  >&lt;p&gt;This patch handles log rotation correctly when # gc log files is 1.It&apos;ll rotate the log files correctly even if #gc log files &amp;gt;1 but in that case when the JVM rolls the file it&apos;ll overwrite the existing rotated file.&lt;br/&gt;
abc.gc.0 is rotated to abc.gc.1 upon restart. But after restart when the JVM rolls abc.gc.0  over(lets say it reaches its size limit) it&apos;ll overwrite the existing abc.gc.1. The jvm GC logger is not aware of the log files already there.&lt;/p&gt;

&lt;p&gt;One possible solution to this that i can think of is if we append timestamp in the log file.&lt;br/&gt;
DATE=`date +%Y-%m-%d-%H-%M`&lt;br/&gt;
-Xloggc:$DATE.gc.log&lt;br/&gt;
and then we can use GC log file rotation as is.Downside is that upon multiple restarts we can have many gc log files, but we can handle this in the stop method of hbase-daemon.sh, ie instead of calling hbase_rotate_logs on start we can have something like hbase_check_gc_logs which will make sure that only N gc log files are there.&lt;/p&gt;

&lt;p&gt;Any thoughts on this?&lt;/p&gt;

&lt;p&gt;Also a single GC file of considerable size (lets say 512 M ) will work perfectly and we wont lose any logs but then we lose on flexibility.&lt;/p&gt;</comment>
                            <comment id="14282760" author="apurtell" created="Mon, 19 Jan 2015 17:46:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abhishek.chouhan&quot; class=&quot;user-hover&quot; rel=&quot;abhishek.chouhan&quot;&gt;Abhishek Singh Chouhan&lt;/a&gt;, agreed appending the timestamp to the file when we rotate it seems reasonable.&lt;/p&gt;

&lt;p&gt;Should we also look at renaming any files rolled over by the JVM with UseGCLogFileRotation with timestamps for consistency&apos;s sake? &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12690859" name="HBASE-12816.patch" size="763" author="abhishek.chouhan" created="Thu, 8 Jan 2015 15:01:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 8 Jan 2015 01:06:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 47 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i240yn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>