<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:24:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5100/HBASE-5100.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5100] Rollback of split could cause closed region to be opened again</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5100</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;If master sending close region to rs and region&apos;s split transaction concurrently happen,&lt;br/&gt;
it may cause closed region to opened. &lt;/p&gt;

&lt;p&gt;See the detailed code in SplitTransaction#createDaughters&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
List&amp;lt;StoreFile&amp;gt; hstoreFilesToSplit = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;{
      hstoreFilesToSplit = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.parent.close(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hstoreFilesToSplit == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-comment&quot;&gt;// The region was closed by a concurrent thread.  We can&apos;t &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// with the split, instead we must just abandon the split.  If we
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// reopen or split &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; could cause problems because the region has
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// probably already been moved to a different server, or is in the
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// process of moving to a different server.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to close region: already closed by &quot;&lt;/span&gt; +
          &lt;span class=&quot;code-quote&quot;&gt;&quot;another thread&quot;&lt;/span&gt;);
      }
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.journal.add(JournalEntry.CLOSED_PARENT_REGION);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;when rolling back, the JournalEntry.CLOSED_PARENT_REGION causes this.parent.initialize();&lt;/p&gt;

&lt;p&gt;Although this region is not onlined in the regionserver, it may bring some potential problem.&lt;/p&gt;

&lt;p&gt;For example, in our environment, the closed parent region is rolled back sucessfully , and then starting compaction and split again.&lt;/p&gt;

&lt;p&gt;The parent region is f892dd6107b6b4130199582abc78e9c1&lt;/p&gt;

&lt;p&gt;master log&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2011-12-26 00:24:42,693 INFO org.apache.hadoop.hbase.master.HMaster: balance hri=writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1., src=dw87.kgb.sqa.cm4,60020,1324827866085, dest=dw80.kgb.sqa.cm4,60020,1324827865780
2011-12-26 00:24:42,693 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Starting unassignment of region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1. (offlining)
2011-12-26 00:24:42,694 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Sent CLOSE to serverName=dw87.kgb.sqa.cm4,60020,1324827866085, load=(requests=0, regions=0, usedHeap=0, maxHeap=0) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.
2011-12-26 00:24:42,699 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; unassigned node: /hbase-tbfs/unassigned/f892dd6107b6b4130199582abc78e9c1 (region=writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1., server=dw87.kgb.sqa.cm4,60020,1324827866085, state=RS_ZK_REGION_CLOSING)
2011-12-26 00:24:42,699 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_CLOSING, server=dw87.kgb.sqa.cm4,60020,1324827866085, region=f892dd6107b6b4130199582abc78e9c1
2011-12-26 00:24:45,348 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_CLOSED, server=dw87.kgb.sqa.cm4,60020,1324827866085, region=f892dd6107b6b4130199582abc78e9c1
2011-12-26 00:24:45,349 DEBUG org.apache.hadoop.hbase.master.handler.ClosedRegionHandler: Handling CLOSED event &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; f892dd6107b6b4130199582abc78e9c1
2011-12-26 00:24:45,349 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Forcing OFFLINE; was=writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1. state=CLOSED, ts=1324830285347
2011-12-26 00:24:45,349 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x13447f283f40e73 Creating (or updating) unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; f892dd6107b6b4130199582abc78e9c1 with OFFLINE state
2011-12-26 00:24:45,354 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=M_ZK_REGION_OFFLINE, server=dw75.kgb.sqa.cm4:60000, region=f892dd6107b6b4130199582abc78e9c1
2011-12-26 00:24:45,354 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Found an existing plan &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1. destination server is + serverName=dw80.kgb.sqa.cm4,60020,1324827865780, load=(requests=0, regions=1, usedHeap=0, maxHeap=0)
2011-12-26 00:24:45,354 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Using pre-existing plan &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.; plan=hri=writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1., src=dw87.kgb.sqa.cm4,60020,1324827866085, dest=dw80.kgb.sqa.cm4,60020,1324827865780
2011-12-26 00:24:45,354 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Assigning region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1. to dw80.kgb.sqa.cm4,60020,1324827865780
2011-12-26 00:24:46,899 DEBUG org.apache.hadoop.hbase.master.handler.OpenedRegionHandler: Opened region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1. on dw80.kgb.sqa.cm4,60020,1324827865780
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;RE_dw87 log&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2011-12-26 00:24:42,694 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Received close region: writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.
2011-12-26 00:24:42,694 DEBUG org.apache.hadoop.hbase.regionserver.handler.CloseRegionHandler: Processing close of writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.
2011-12-26 00:24:42,694 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:60020-0x43447f30cb31367 Creating unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; f892dd6107b6b4130199582abc78e9c1 in a CLOSING state
2011-12-26 00:24:42,699 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Closing writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.: disabling compactions &amp;amp; flushes
2011-12-26 00:24:42,699 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; compaction to complete &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.
2011-12-26 00:24:43,340 INFO org.apache.hadoop.hbase.regionserver.HRegion: aborted compaction on region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1. after 49sec
2011-12-26 00:24:43,340 INFO org.apache.hadoop.hbase.regionserver.HRegion: Running close preflush of writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.
2011-12-26 00:24:43,340 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Started memstore flush &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1., current region memstore size 59.5m
2011-12-26 00:24:43,340 INFO org.apache.hadoop.hbase.regionserver.SplitTransaction: Starting split of region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.
2011-12-26 00:24:45,347 INFO org.apache.hadoop.hbase.regionserver.HRegion: Closed writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.
2011-12-26 00:24:45,347 WARN org.apache.hadoop.hbase.regionserver.HRegion: Region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1. already closed
2011-12-26 00:24:45,347 WARN org.apache.hadoop.hbase.regionserver.CompactSplitThread: Running rollback of failed split of writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.; Failed to close region: already closed by another thread
2011-12-26 00:24:45,348 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:60020-0x43447f30cb31367 Successfully transitioned node f892dd6107b6b4130199582abc78e9c1 from RS_ZK_REGION_CLOSING to RS_ZK_REGION_CLOSED
2011-12-26 00:24:45,348 DEBUG org.apache.hadoop.hbase.regionserver.handler.CloseRegionHandler: Closed region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.
2011-12-26 00:24:46,837 INFO org.apache.hadoop.hbase.regionserver.HRegion: Onlined writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.; next sequenceid=717341809
2011-12-26 00:24:46,841 INFO org.apache.hadoop.hbase.regionserver.CompactSplitThread: Successful rollback of failed split of writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.
2011-12-26 00:24:46,841 INFO org.apache.hadoop.hbase.regionserver.HRegion: Starting compaction on region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.
2011-12-26 00:25:23,288 INFO org.apache.hadoop.hbase.regionserver.HRegion: completed compaction on region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1. after 36sec
2011-12-26 00:25:23,288 INFO org.apache.hadoop.hbase.regionserver.SplitTransaction: Starting split of region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1.
2011-12-26 00:25:24,847 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Offlined parent region writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1. in META
2011-12-26 00:25:26,165 INFO org.apache.hadoop.hbase.regionserver.CompactSplitThread: Region split, META updated, and report to master. Parent=writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324829936318.f892dd6107b6b4130199582abc78e9c1., &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; regions: writetest,8ZW417DZP93OU6SZ0QQMKTALTDP4883KW5AXSAFMQ952Y6J6VPPXEXRRPCWBR2PK7DQV3RKK28222JMOJSW3JJ8AB05MIREM1CL6,1324830323288.595f458507cecf208640cb4a1be8e293., writetest,DHZX0CD7A4OE1KRILMWEJL2HTBN6OJVSFOKGU0P938DJ1M44B79C068NCZPXK1Z5OD2RQJ6LMA41TC0D44H05525TO3AHLZ4BZXX,1324830323288.ba9376c83327c34c7926fccb68c3b9e3.. Split took 2sec

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12536473">HBASE-5100</key>
            <summary>Rollback of split could cause closed region to be opened again</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zjushch">chunhui shen</assignee>
                                    <reporter username="zjushch">chunhui shen</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Dec 2011 05:51:40 +0000</created>
                <updated>Fri, 12 Oct 2012 05:35:03 +0000</updated>
                            <resolved>Sat, 31 Dec 2011 16:50:44 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                    <fixVersion>0.94.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13176465" author="zjushch" created="Wed, 28 Dec 2011 05:57:37 +0000"  >&lt;p&gt;When this.parent.close(false) returns null(It means region has already been closed), we needn&apos;t add the JournalEntry.CLOSED_PARENT_REGION&lt;/p&gt;</comment>
                            <comment id="13176473" author="zhihyu@ebaysf.com" created="Wed, 28 Dec 2011 06:08:20 +0000"  >&lt;p&gt;@Chunhui:&lt;br/&gt;
Do you have a patch ?&lt;/p&gt;</comment>
                            <comment id="13176475" author="zjushch" created="Wed, 28 Dec 2011 06:14:43 +0000"  >&lt;p&gt;@Zhihong:&lt;br/&gt;
Patch is submit&lt;/p&gt;</comment>
                            <comment id="13176476" author="zhihyu@ebaysf.com" created="Wed, 28 Dec 2011 06:23:07 +0000"  >&lt;p&gt;I think closedJE means addClosedParentRegionJournalEntry.&lt;br/&gt;
Since that name is too long, how about naming the boolean exceptionEncountered ?&lt;/p&gt;</comment>
                            <comment id="13176480" author="zjushch" created="Wed, 28 Dec 2011 06:35:46 +0000"  >&lt;p&gt;If returns not null&#65292; exceptionEncountered  is also false.&lt;br/&gt;
what about naming the boolean alreadyClosed, or closedBefore,or other similars...&lt;/p&gt;</comment>
                            <comment id="13176523" author="hadoopqa" created="Wed, 28 Dec 2011 08:40:24 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12508728/hbase-5100.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12508728/hbase-5100.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 77 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestDrainingServer&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/607//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/607//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/607//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/607//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/607//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/607//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13176550" author="zhihyu@ebaysf.com" created="Wed, 28 Dec 2011 09:56:59 +0000"  >&lt;p&gt;I think we can remove the try/finally construct and put this.journal.add(JournalEntry.CLOSED_PARENT_REGION); in else block of:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hstoreFilesToSplit == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;@Chunhui:&lt;br/&gt;
What do you think ?&lt;/p&gt;</comment>
                            <comment id="13176927" author="zjushch" created="Thu, 29 Dec 2011 01:28:49 +0000"  >&lt;p&gt;@Zhihong&lt;br/&gt;
If we remove the try/finally construct, when encountering excepiton in this.parent.close(false), the rollback of split would not do this.parent.initialize() because of no JournalEntry.CLOSED_PARENT_REGION.&lt;/p&gt;</comment>
                            <comment id="13176930" author="zhihyu@ebaysf.com" created="Thu, 29 Dec 2011 01:35:03 +0000"  >&lt;p&gt;@Chunhui:&lt;br/&gt;
My comment @ 28/Dec/11 06:35 renames the boolean whose initial value would be false.&lt;br/&gt;
The renamed boolean carries negated value compared to that for closedJE.&lt;/p&gt;

&lt;p&gt;What do you think ?&lt;/p&gt;</comment>
                            <comment id="13176932" author="zjushch" created="Thu, 29 Dec 2011 01:40:12 +0000"  >&lt;p&gt;@Zhihong&lt;br/&gt;
If the initial boolean value is false, when encountering excepiton in this.parent.close(false), it will be false all the same which causes JournalEntry.CLOSED_PARENT_REGION not added in this.journal&lt;/p&gt;</comment>
                            <comment id="13176934" author="zhihyu@ebaysf.com" created="Thu, 29 Dec 2011 01:45:37 +0000"  >&lt;p&gt;Current form of patch is fine.&lt;br/&gt;
How about renaming closedJE as addJournalEntry ?&lt;/p&gt;</comment>
                            <comment id="13176936" author="zjushch" created="Thu, 29 Dec 2011 01:51:17 +0000"  >&lt;p&gt;@Zhihong&lt;br/&gt;
En, it&apos;s better.&lt;/p&gt;</comment>
                            <comment id="13176948" author="ram_krish" created="Thu, 29 Dec 2011 02:17:13 +0000"  >&lt;p&gt;@Chunhui&lt;br/&gt;
Good catch. What about addClosedJournalEntry?&lt;/p&gt;

&lt;p&gt;Other than that +1 on patch.&lt;/p&gt;</comment>
                            <comment id="13176993" author="jeason" created="Thu, 29 Dec 2011 05:03:43 +0000"  >&lt;p&gt;The patch is good. If region has been closed by other thread, just abondon the split.That region should not be online again while rolling back. Meanwhile, we just need to clean the splitDir.&lt;/p&gt;</comment>
                            <comment id="13177268" author="zhihyu@ebaysf.com" created="Thu, 29 Dec 2011 16:56:34 +0000"  >&lt;p&gt;I thought I like Java until I understood what createDaughters() should be doing - with Chunhui&apos;s patch, i.e.&lt;/p&gt;

&lt;p&gt;The case is that we need to handle two types of exceptions: the one coming out of parent.close(false) call and the IOE thrown from within the try block.&lt;/p&gt;

&lt;p&gt;I got some idea when I was driving this morning. 5100.txt is my proposed form where I tried to disambiguate the two types of exceptions by removing finally block.&lt;br/&gt;
closedByOtherException is a singleton so the overhead of my proposal vs. introducing a boolean is negligible.&lt;/p&gt;

&lt;p&gt;I ran split-related tests and they passed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  806  mt -Dtest=TestCoprocessorInterface
  807  mt -Dtest=TestSplitTransaction
  808  mt -Dtest=TestSplitTransactionOnCluster
  809  mt -Dtest=TestEndToEndSplitTransaction
  810  mt -Dtest=TestHRegion
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please share your comments.&lt;/p&gt;</comment>
                            <comment id="13177333" author="hadoopqa" created="Thu, 29 Dec 2011 19:15:47 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12508859/5100.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12508859/5100.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 76 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.coprocessor.TestMasterObserver&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/627//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/627//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/627//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/627//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/627//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/627//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13177339" author="zhihyu@ebaysf.com" created="Thu, 29 Dec 2011 19:24:13 +0000"  >&lt;p&gt;TestMasterObserver passed locally on my MacBook.&lt;/p&gt;</comment>
                            <comment id="13177437" author="hadoopqa" created="Thu, 29 Dec 2011 22:46:45 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12508876/5100.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12508876/5100.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 76 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/631//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/631//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/631//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/631//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/631//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/631//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13177505" author="zjushch" created="Fri, 30 Dec 2011 01:51:17 +0000"  >&lt;p&gt;@Zhihong:&lt;br/&gt;
I like the modify of 5100.txt,&lt;br/&gt;
However,is it any possible to throw other exception in this.parent.close(false) ,such as NullPointerException? Maybe it is impossible and needn&apos;t worry.&lt;/p&gt;</comment>
                            <comment id="13177506" author="zhihyu@ebaysf.com" created="Fri, 30 Dec 2011 01:57:14 +0000"  >&lt;p&gt;According to &lt;a href=&quot;http://docs.oracle.com/javase/1.4.2/docs/api/java/lang/NullPointerException.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oracle.com/javase/1.4.2/docs/api/java/lang/NullPointerException.html&lt;/a&gt;, NPE is an Exception &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13177539" author="zhihyu@ebaysf.com" created="Fri, 30 Dec 2011 03:53:44 +0000"  >&lt;p&gt;There was no hung test in &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/631/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/631/console&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13177558" author="stack" created="Fri, 30 Dec 2011 05:14:07 +0000"  >&lt;p&gt;This is a good catch Chunhui; nice one.&lt;/p&gt;

&lt;p&gt;Patch looks fine but seems a bit involved.  I tried my hand at it and ended up w/ the below which is not much better so +1 on commit:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java
===================================================================
--- src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java    (revision 1221978)
+++ src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java    (working copy)
@@ -246,18 +246,24 @@
     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.journal.add(JournalEntry.CREATE_SPLIT_DIR);
  
     List&amp;lt;StoreFile&amp;gt; hstoreFilesToSplit = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
-    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;{
+    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; someoneElseClosedRegion = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
       hstoreFilesToSplit = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.parent.close(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hstoreFilesToSplit == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
         &lt;span class=&quot;code-comment&quot;&gt;// The region was closed by a concurrent thread.  We can&apos;t &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;
&lt;/span&gt;-        &lt;span class=&quot;code-comment&quot;&gt;// with the split, instead we must just abandon the split.  If we
&lt;/span&gt;-        &lt;span class=&quot;code-comment&quot;&gt;// reopen or split &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; could cause problems because the region has
&lt;/span&gt;-        &lt;span class=&quot;code-comment&quot;&gt;// probably already been moved to a different server, or is in the
&lt;/span&gt;-        &lt;span class=&quot;code-comment&quot;&gt;// process of moving to a different server.
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// with the split. Instead we must abandon the split.  If we reopen
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// or split &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; could cause problems because the region has probably
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// already been moved to a different server, or is in the process of
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// moving to a different server.  Set &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;.  See &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; clause
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; how its handled.
&lt;/span&gt;+        someoneElseClosedRegion = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
+      }
+    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (someoneElseClosedRegion) {
+        &lt;span class=&quot;code-comment&quot;&gt;// If closed by someone &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt;, don&apos;t add journal entry.
&lt;/span&gt;         &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to close region: already closed by &quot;&lt;/span&gt; +
-          &lt;span class=&quot;code-quote&quot;&gt;&quot;another thread&quot;&lt;/span&gt;);
+          another thread&quot;);
       }
-    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.journal.add(JournalEntry.CLOSED_PARENT_REGION);
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13177562" author="zjushch" created="Fri, 30 Dec 2011 05:23:22 +0000"  >&lt;p&gt;@Zhihong&lt;br/&gt;
NPE doesn&apos;t belong to IOException, so it will not be catched, and will not add the JournalEntry.CLOSED_PARENT_REGION.&lt;/p&gt;</comment>
                            <comment id="13177566" author="stack" created="Fri, 30 Dec 2011 05:32:16 +0000"  >&lt;p&gt;Reviewing the other, older patch (Ted just wrote me to review it instead), it looks cleaner (hbase-5100.patch).  I don&apos;t know what closedJE is.  I&apos;m +1 on commit but suggest we use a better name &amp;#8211; perhaps closedParent &amp;#8211; on commit or the above suggested long name (I don&apos;t think it too long)&lt;/p&gt;</comment>
                            <comment id="13177567" author="zhihyu@ebaysf.com" created="Fri, 30 Dec 2011 05:42:02 +0000"  >&lt;p&gt;IOException should have been Exception that we catch.&lt;/p&gt;</comment>
                            <comment id="13177569" author="zhihyu@ebaysf.com" created="Fri, 30 Dec 2011 06:05:16 +0000"  >&lt;p&gt;Chunhui&apos;s patch with new boolean renamed&lt;/p&gt;</comment>
                            <comment id="13177585" author="hadoopqa" created="Fri, 30 Dec 2011 08:07:23 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12508916/5100-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12508916/5100-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 76 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/639//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/639//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/639//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/639//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/639//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/639//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13177610" author="zhihyu@ebaysf.com" created="Fri, 30 Dec 2011 10:29:58 +0000"  >&lt;p&gt;Patch that covers runtime exception coming out of parent.close(false)&lt;/p&gt;</comment>
                            <comment id="13177622" author="hadoopqa" created="Fri, 30 Dec 2011 12:30:52 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12508926/5100-double-exeception.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12508926/5100-double-exeception.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 76 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/641//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/641//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/641//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/641//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/641//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/641//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13177683" author="zhihyu@ebaysf.com" created="Fri, 30 Dec 2011 15:51:26 +0000"  >&lt;p&gt;See discussion &apos;detecting presence of exception inside finally block&apos; on seajug@yahoogroups.com where I polled Java developers on my proposed formation.&lt;/p&gt;</comment>
                            <comment id="13177785" author="stack" created="Fri, 30 Dec 2011 22:00:04 +0000"  >&lt;p&gt;Whats happening now in this issue?  There is a v2.  Is that now the candidate fix?&lt;/p&gt;</comment>
                            <comment id="13177794" author="zhihyu@ebaysf.com" created="Fri, 30 Dec 2011 22:34:57 +0000"  >&lt;p&gt;I was trying to come up with easier to understand code.&lt;/p&gt;

&lt;p&gt;Chunhui&apos;s patch may be the one to use. 5100-v2.txt is the candidate with closedJE renamed.&lt;/p&gt;</comment>
                            <comment id="13177868" author="zjushch" created="Sat, 31 Dec 2011 01:31:45 +0000"  >&lt;p&gt;@Zhihong&lt;br/&gt;
I think both are ok now.&lt;br/&gt;
I agree to commit 5100-double-exeception.txt since it is more understand understandable.&lt;/p&gt;</comment>
                            <comment id="13177879" author="zhihyu@ebaysf.com" created="Sat, 31 Dec 2011 02:46:22 +0000"  >&lt;p&gt;Thanks for the feedback, Chunhui.&lt;/p&gt;

&lt;p&gt;I integrated double exception patch to 0.92 and TRUNK.&lt;/p&gt;

&lt;p&gt;Thanks for initial patch, Chunhui.&lt;/p&gt;

&lt;p&gt;Thanks for the review, Stack.&lt;/p&gt;</comment>
                            <comment id="13177908" author="hudson" created="Sat, 31 Dec 2011 06:16:32 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #220 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/220/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/220/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5100&quot; title=&quot;Rollback of split could cause closed region to be opened again&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5100&quot;&gt;&lt;del&gt;HBASE-5100&lt;/del&gt;&lt;/a&gt;  Rollback of split could cause closed region to be opened again (Chunhui)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13177911" author="hudson" created="Sat, 31 Dec 2011 08:12:43 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #55 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/55/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/55/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5100&quot; title=&quot;Rollback of split could cause closed region to be opened again&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5100&quot;&gt;&lt;del&gt;HBASE-5100&lt;/del&gt;&lt;/a&gt;  Rollback of split could cause closed region to be opened again (Chunhui)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13177971" author="hudson" created="Sat, 31 Dec 2011 09:54:58 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2595 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2595/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2595/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5100&quot; title=&quot;Rollback of split could cause closed region to be opened again&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5100&quot;&gt;&lt;del&gt;HBASE-5100&lt;/del&gt;&lt;/a&gt;  Rollback of split could cause closed region to be opened again (Chunhui)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13178007" author="hudson" created="Sat, 31 Dec 2011 13:39:50 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #56 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/56/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/56/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5100&quot; title=&quot;Rollback of split could cause closed region to be opened again&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5100&quot;&gt;&lt;del&gt;HBASE-5100&lt;/del&gt;&lt;/a&gt;  Rollback of split could cause closed region to be opened again (Chunhui)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13178043" author="ram_krish" created="Sat, 31 Dec 2011 16:50:44 +0000"  >&lt;p&gt;Resolved as committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12508926" name="5100-double-exeception.txt" size="2371" author="zhihyu@ebaysf.com" created="Fri, 30 Dec 2011 10:29:58 +0000"/>
                            <attachment id="12508916" name="5100-v2.txt" size="1244" author="zhihyu@ebaysf.com" created="Fri, 30 Dec 2011 06:05:16 +0000"/>
                            <attachment id="12508728" name="hbase-5100.patch" size="1169" author="zjushch" created="Wed, 28 Dec 2011 06:12:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 28 Dec 2011 06:08:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>222156</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 50 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i069sv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34519</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>