<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:41:54 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13303/HBASE-13303.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13303] Fix size calculation of results on the region server</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13303</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;One of the problems in the parent is due to different size calculation between client and server when HFilev3 is used.&lt;/p&gt;

&lt;p&gt;Since tags are &lt;em&gt;never&lt;/em&gt; shipped to the client in a scan, we can have special size function (or a flag on the current one) that does not include the tags and the tags meta information (the length is what causes the issue), so that client and server will always calculate the same size.&lt;/p&gt;

&lt;p&gt;I&apos;ll make a patch within the hour, unless somebody beats me to it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;, FYI.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12783689">HBASE-13303</key>
            <summary>Fix size calculation of results on the region server</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12782590">HBASE-13262</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="apurtell">Andrew Purtell</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Mar 2015 17:31:12 +0000</created>
                <updated>Tue, 28 Apr 2015 19:18:36 +0000</updated>
                            <resolved>Sat, 28 Mar 2015 05:26:45 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.0.1</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                    <fixVersion>0.98.12</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="14371729" author="apurtell" created="Fri, 20 Mar 2015 17:51:19 +0000"  >&lt;p&gt;Something like this?&lt;/p&gt;</comment>
                            <comment id="14371736" author="apurtell" created="Fri, 20 Mar 2015 17:53:39 +0000"  >&lt;p&gt;Now let me move that to CellUtil&lt;/p&gt;</comment>
                            <comment id="14371775" author="apurtell" created="Fri, 20 Mar 2015 18:14:21 +0000"  >&lt;p&gt;Is this what you had in mind &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; ? &lt;/p&gt;

&lt;p&gt;This code makes me want to cry, though, backwards compatible mis-estimations. &lt;/p&gt;

&lt;p&gt;The instanceof check in the static helper should be fine. In interpreter or C1, Hotspot will build a type profile for every cast and instanceof and optimistically specialize in C2 if it only sees one type at the receiver (with a trap to deopt if wrong).&lt;/p&gt;</comment>
                            <comment id="14371817" author="lhofhansl" created="Fri, 20 Mar 2015 18:35:33 +0000"  >&lt;p&gt;Looks good to me. Makes my eyes bleed too. We should try to have a unittest.&lt;br/&gt;
Not sure how easy that is... Something along the lines of test I added to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13297&quot; title=&quot;0.98 and 1.0: Remove client side result size calculation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13297&quot;&gt;&lt;del&gt;HBASE-13297&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14371825" author="apurtell" created="Fri, 20 Mar 2015 18:39:25 +0000"  >&lt;p&gt;Ok, let me look at unit testing&lt;/p&gt;</comment>
                            <comment id="14371870" author="apurtell" created="Fri, 20 Mar 2015 18:59:15 +0000"  >&lt;p&gt;Updated patches including one for master. Looking at testing next.&lt;/p&gt;</comment>
                            <comment id="14371897" author="apurtell" created="Fri, 20 Mar 2015 19:18:49 +0000"  >&lt;p&gt;Updated patches including the test from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13297&quot; title=&quot;0.98 and 1.0: Remove client side result size calculation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13297&quot;&gt;&lt;del&gt;HBASE-13297&lt;/del&gt;&lt;/a&gt; as suggested, plus copyright headers. The new test passes. &lt;/p&gt;</comment>
                            <comment id="14371902" author="apurtell" created="Fri, 20 Mar 2015 19:20:36 +0000"  >&lt;p&gt;Correction, passes on master only, so this isn&apos;t good enough yet&lt;/p&gt;</comment>
                            <comment id="14371942" author="lhofhansl" created="Fri, 20 Mar 2015 19:40:49 +0000"  >&lt;p&gt;The test in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13297&quot; title=&quot;0.98 and 1.0: Remove client side result size calculation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13297&quot;&gt;&lt;del&gt;HBASE-13297&lt;/del&gt;&lt;/a&gt; would fail with this fix (that&apos;s expected - the test there explicitly sets up client and server with different max result sizes). For this we need to change the test to (somehow) use Hfilev3 to cause the problem.&lt;/p&gt;</comment>
                            <comment id="14371955" author="apurtell" created="Fri, 20 Mar 2015 19:48:39 +0000"  >&lt;p&gt;Though the change on the server side looks &quot;reasonable&quot;, the client is using KeyValue.heapSize() for the estimation, and we can&apos;t change this if interoperating with older clients. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; heapSize() {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; sum = 0;
    sum += ClassSize.OBJECT;&lt;span class=&quot;code-comment&quot;&gt;// the KeyValue object itself
&lt;/span&gt;    sum += ClassSize.REFERENCE;&lt;span class=&quot;code-comment&quot;&gt;// pointer to &lt;span class=&quot;code-quote&quot;&gt;&quot;bytes&quot;&lt;/span&gt;
&lt;/span&gt;    sum += ClassSize.align(ClassSize.ARRAY);&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-quote&quot;&gt;&quot;bytes&quot;&lt;/span&gt;
&lt;/span&gt;    sum += ClassSize.align(length);&lt;span class=&quot;code-comment&quot;&gt;// number of bytes of data in the &lt;span class=&quot;code-quote&quot;&gt;&quot;bytes&quot;&lt;/span&gt; array
&lt;/span&gt;    sum += 2 * Bytes.SIZEOF_INT;&lt;span class=&quot;code-comment&quot;&gt;// offset, length
&lt;/span&gt;    sum += Bytes.SIZEOF_LONG;&lt;span class=&quot;code-comment&quot;&gt;// memstoreTS
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ClassSize.align(sum);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think we would need two variations on heapSize on the server instead of the current patch, where we twiddle with the value of &apos;length&apos;, to subtract the size of the tags area if the KeyValue came from a V3 HFile. I could do that.&lt;/p&gt;

&lt;p&gt;However, after looking at this from a different perspective the change on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13297&quot; title=&quot;0.98 and 1.0: Remove client side result size calculation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13297&quot;&gt;&lt;del&gt;HBASE-13297&lt;/del&gt;&lt;/a&gt; that updates the client is probably better. It&apos;s a cleaner change with less brittle magic. It results in an extra RPC, but this can be fixed later by backporting proper scan state updates to the scanner PB. We don&apos;t have to do this for 0.98.12. If we have the proper fix available in time for 0.98.13 we can address this then. In the meantime we can document how to mitigate the issue with configuration. &lt;/p&gt;</comment>
                            <comment id="14371962" author="apurtell" created="Fri, 20 Mar 2015 19:49:41 +0000"  >&lt;p&gt;Nah, patch was wrong anyhow, see below.&lt;/p&gt;</comment>
                            <comment id="14371992" author="apurtell" created="Fri, 20 Mar 2015 20:05:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think we would need two variations on heapSize on the server instead of the current patch, where we twiddle with the value of &apos;length&apos;, to subtract the size of the tags area if the KeyValue came from a V3 HFile&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;ll do that here anyway just so we can see what it looks like.&lt;/p&gt;</comment>
                            <comment id="14372027" author="apurtell" created="Fri, 20 Mar 2015 20:20:45 +0000"  >&lt;p&gt;BTW, here&apos;s a test that fails with tag data&lt;/p&gt;</comment>
                            <comment id="14372041" author="apurtell" created="Fri, 20 Mar 2015 20:31:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think we would need two variations on heapSize on the server instead of the current patch, where we twiddle with the value of &apos;length&apos;, to subtract the size of the tags area if the KeyValue came from a V3 HFile&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This gets the test to pass&lt;/p&gt;</comment>
                            <comment id="14372118" author="apurtell" created="Fri, 20 Mar 2015 21:07:10 +0000"  >&lt;p&gt;Updated patches with changes for heapSize estimation without considering tag data&lt;/p&gt;</comment>
                            <comment id="14372150" author="apurtell" created="Fri, 20 Mar 2015 21:25:53 +0000"  >&lt;p&gt;Updated the test so conditions in each unit are identical&lt;/p&gt;</comment>
                            <comment id="14372188" author="apurtell" created="Fri, 20 Mar 2015 21:49:49 +0000"  >&lt;p&gt;As far as what fix versions to set, I think we will only need this in 0.98, branch-1.0, and branch-1, right? Assuming there may well be some other reason to upgrade to 2.0 from 0.98 via 1.x first. &lt;/p&gt;</comment>
                            <comment id="14372193" author="lhofhansl" created="Fri, 20 Mar 2015 21:53:27 +0000"  >&lt;p&gt;+1 on patch&lt;br/&gt;
+1 on 0.98 and branch-1.0&lt;/p&gt;

&lt;p&gt;branch-1 has &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt;, which will provide a better fix, I think.&lt;/p&gt;</comment>
                            <comment id="14372197" author="apurtell" created="Fri, 20 Mar 2015 21:54:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;branch-1 has &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt;, which will provide a better fix, I think.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes but we&apos;d still have an issue if rolling upgrade from 0.98 to 1.1.x or 1.2.x or ... &lt;/p&gt;</comment>
                            <comment id="14372223" author="enis" created="Fri, 20 Mar 2015 22:12:49 +0000"  >&lt;p&gt;+1 for the patch. We still need &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13297&quot; title=&quot;0.98 and 1.0: Remove client side result size calculation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13297&quot;&gt;&lt;del&gt;HBASE-13297&lt;/del&gt;&lt;/a&gt; I guess due to scan max result sizes configured differently? In case of 1.0, we may not be able to backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="14372235" author="lhofhansl" created="Fri, 20 Mar 2015 22:25:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;Yes but we&apos;d still have an issue if rolling upgrade from 0.98 to 1.1.x or 1.2.x or ... &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I see. Then why not put it everywhere? Can undo from 2.0 if it&apos;s not needed. Unless we&apos;re sure to break upgrades to 2.0.&lt;/p&gt;</comment>
                            <comment id="14372236" author="lhofhansl" created="Fri, 20 Mar 2015 22:25:56 +0000"  >&lt;p&gt;In any case +1 to branch-1.&lt;/p&gt;</comment>
                            <comment id="14372243" author="apurtell" created="Fri, 20 Mar 2015 22:28:56 +0000"  >&lt;p&gt;Yeah I can commit this to master too. We&apos;d want to go back and pull it out as soon as reasonable though. Insta-deprecation. I will add deprecation annotations on commit. &lt;/p&gt;

&lt;p&gt;Committing shortly everywhere unless objection &lt;/p&gt;</comment>
                            <comment id="14372306" author="hadoopqa" created="Fri, 20 Mar 2015 23:23:40 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12706043/HBASE-13303.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12706043/HBASE-13303.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit f4eb7191be66ada04c94cd555acbfe34efc350c1.&lt;br/&gt;
  ATTACHMENT ID: 12706043&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13340//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14372358" author="hadoopqa" created="Sat, 21 Mar 2015 00:15:04 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12706051/HBASE-13303.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12706051/HBASE-13303.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 09151911679a608db31cca63c25cfd52818a311c.&lt;br/&gt;
  ATTACHMENT ID: 12706051&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13341//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14372388" author="apurtell" created="Sat, 21 Mar 2015 00:36:17 +0000"  >&lt;p&gt;Pushed to 0.98+&lt;/p&gt;</comment>
                            <comment id="14372441" author="hudson" created="Sat, 21 Mar 2015 01:58:34 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #819 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/819/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/819/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13303&quot; title=&quot;Fix size calculation of results on the region server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13303&quot;&gt;&lt;del&gt;HBASE-13303&lt;/del&gt;&lt;/a&gt; Fix size calculation of results on the region server (apurtell: rev e5d5c7f973c9af279b1cb294a26fd99c57885221)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestResultSizeEstimation.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/KeyValue.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/CellUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14372463" author="hudson" created="Sat, 21 Mar 2015 02:39:11 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6286 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6286/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6286/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13303&quot; title=&quot;Fix size calculation of results on the region server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13303&quot;&gt;&lt;del&gt;HBASE-13303&lt;/del&gt;&lt;/a&gt; Fix size calculation of results on the region server (apurtell: rev 8dfed5dc88f1c8008345b22e99224cb945fd0941)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestResultSizeEstimation.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/CellUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/KeyValue.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14372467" author="hudson" created="Sat, 21 Mar 2015 02:49:59 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1 #309 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/309/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/309/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13303&quot; title=&quot;Fix size calculation of results on the region server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13303&quot;&gt;&lt;del&gt;HBASE-13303&lt;/del&gt;&lt;/a&gt; Fix size calculation of results on the region server (apurtell: rev e90ac5f812b1a6af8886e3afd7fa41528cfad30e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/CellUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RSRpcServices.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestResultSizeEstimation.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/KeyValue.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14372548" author="hudson" created="Sat, 21 Mar 2015 06:11:57 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #916 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/916/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/916/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13303&quot; title=&quot;Fix size calculation of results on the region server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13303&quot;&gt;&lt;del&gt;HBASE-13303&lt;/del&gt;&lt;/a&gt; Fix size calculation of results on the region server (apurtell: rev 0ada8fd7b38fa8cc16c9721d4c0c3b7d7fd2fbfe)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestResultSizeEstimation.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/KeyValue.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14372609" author="hudson" created="Sat, 21 Mar 2015 09:11:10 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98-on-Hadoop-1.1 #870 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/870/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/870/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13303&quot; title=&quot;Fix size calculation of results on the region server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13303&quot;&gt;&lt;del&gt;HBASE-13303&lt;/del&gt;&lt;/a&gt; Fix size calculation of results on the region server (apurtell: rev 0ada8fd7b38fa8cc16c9721d4c0c3b7d7fd2fbfe)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestResultSizeEstimation.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/KeyValue.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14375426" author="anoop.hbase" created="Mon, 23 Mar 2015 05:40:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;   &lt;br/&gt;
Still on the client side we will use CellUtil#estimatedHeapSizeOf  for the Cell size calc right?   When the scan is issued by the super user we will send back the tags (so that the tool like Export will export tags also)  In such a case there will be size mismatch and issues?&lt;/p&gt;</comment>
                            <comment id="14375437" author="apurtell" created="Mon, 23 Mar 2015 06:00:09 +0000"  >&lt;p&gt;As you can see from the unit test in this patch, we definitely have issues if the server estimates a larger size that the client, which will happen if we include tags in the sizing.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if it is a problem if the client underestimates the amount of data coming back. I will have to look at the code when next at my desk. &lt;/p&gt;

&lt;p&gt;We could have the server estimate with tag size included if the user is a superuser, but then this graduates from a hack to a really ugly layering violation. &lt;/p&gt;

&lt;p&gt;Since you&apos;ve pointed out what you think is a problem maybe you have a suggestion to solve it Anoop? &lt;/p&gt;</comment>
                            <comment id="14375446" author="anoop.hbase" created="Mon, 23 Mar 2015 06:21:19 +0000"  >&lt;p&gt;I am also not sure whether the math in the loop(client side) will create any issue.  Was just pointing out.. Let me look more closely at this math Andy.  Will report back if any issue.  &lt;/p&gt;</comment>
                            <comment id="14375449" author="apurtell" created="Mon, 23 Mar 2015 06:24:12 +0000"  >&lt;p&gt;Thanks Anoop. I&apos;ll look into your concerns tomorrow too&lt;/p&gt;</comment>
                            <comment id="14375641" author="anoop.hbase" created="Mon, 23 Mar 2015 09:55:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure if it is a problem if the client underestimates the amount of data coming back. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I have checked.  Yes you are right.  The math at client side should not create any data miss issue.&lt;br/&gt;
Only issue is we might not be honoring the actual max result size what user specified. Especially when the tags are returned back. The client will have to keep more data size as server pushed it more than what is actually expected (as per the max size limit) . It is fine as of now. When we solve &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13262&quot; title=&quot;ResultScanner doesn&amp;#39;t return all rows in Scan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13262&quot;&gt;&lt;del&gt;HBASE-13262&lt;/del&gt;&lt;/a&gt; correctly we can consider this aspects also.&lt;/p&gt;</comment>
                            <comment id="14376784" author="apurtell" created="Mon, 23 Mar 2015 22:28:24 +0000"  >&lt;p&gt;Agreed. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Only issue is we might not be honoring the actual max result size what user specified. Especially when the tags are returned back. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, this could be significantly more than expected. &lt;/p&gt;

&lt;p&gt;Also agreed we can handle this better as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13262&quot; title=&quot;ResultScanner doesn&amp;#39;t return all rows in Scan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13262&quot;&gt;&lt;del&gt;HBASE-13262&lt;/del&gt;&lt;/a&gt; or a similar issue&lt;/p&gt;</comment>
                            <comment id="14382554" author="jonathan.lawlor" created="Thu, 26 Mar 2015 20:05:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; Apologies for the late catch, but while working on the addendum to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt; I just came across a calculation that was missed with this patch in branch-1+. Specifically in &lt;tt&gt;StoreScanner#next(List, int, long)&lt;/tt&gt; the calculation used for totalHeapSize still uses to &lt;tt&gt;CellUtil#estimatedHeapSizeOf&lt;/tt&gt;. Same goes for &lt;tt&gt;RegionScannerImpl#calculateResultSize&lt;/tt&gt;. &lt;/p&gt;

&lt;p&gt;These places should use the new &quot;estimate without tags&quot; as well because size calculations are performed once down in StoreScanner and the calculation propagates up to RSRpcServices through the NextState (thus the change in RSRpcServices alone won&apos;t be sufficient since &lt;tt&gt;skipResultSizeCalculation&lt;/tt&gt; would be true). Would this be fixed as an addendum here or should I file elsewhere? Or, given that the point of the addendum to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt; is to get rid of NextState, would it be more appropriate to fix there?&lt;/p&gt;</comment>
                            <comment id="14382699" author="apurtell" created="Thu, 26 Mar 2015 21:23:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;Would this be fixed as an addendum here or should I file elsewhere? Or, given that the point of the addendum to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt; is to get rid of NextState, would it be more appropriate to fix there?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think it really matters. Won&apos;t be an issue in 0.98, so we can get a release out on that line. Not sure about branch-1.0 but there&apos;s no release on deck there yet. Whenever we have a better solution for branch-1+ we should revert this hack anyhow. Would be nice to have a better solution for branch-1.0 and 0.98 also, then we can revert this hack in those branches as well. &lt;/p&gt;</comment>
                            <comment id="14382701" author="apurtell" created="Thu, 26 Mar 2015 21:24:50 +0000"  >&lt;p&gt;So in summary if the addendum to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt; fixes this issue properly in branch-1+, let&apos;s simply revert &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13303&quot; title=&quot;Fix size calculation of results on the region server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13303&quot;&gt;&lt;del&gt;HBASE-13303&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="14382742" author="jonathan.lawlor" created="Thu, 26 Mar 2015 21:44:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;Not sure about branch-1.0 but there&apos;s no release on deck there yet&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The improper calculations I called out above would only be relevant where &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt; is (branch-1+), so branch-1.0 wouldn&apos;t need to change.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So in summary if the addendum to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt; fixes this issue properly in branch-1+, let&apos;s simply revert &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13303&quot; title=&quot;Fix size calculation of results on the region server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13303&quot;&gt;&lt;del&gt;HBASE-13303&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I believe the only fix that would allow this to be reverted would be the fix from the parent issue, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13262&quot; title=&quot;ResultScanner doesn&amp;#39;t return all rows in Scan&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13262&quot;&gt;&lt;del&gt;HBASE-13262&lt;/del&gt;&lt;/a&gt; (and even with that fix I&apos;m not sure we could revert the hack because of the possibility that the server could be talking to an older client that doesn&apos;t recognize the new flag being added). The addendum to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt; wouldn&apos;t properly fix the issue in branch-1+ but rather would adapt its size calculation to use the hack.&lt;/p&gt;</comment>
                            <comment id="14382780" author="apurtell" created="Thu, 26 Mar 2015 22:00:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;The addendum to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11544&quot; title=&quot;[Ergonomics] hbase.client.scanner.caching is dogged and will try to return batch even if it means OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11544&quot;&gt;&lt;del&gt;HBASE-11544&lt;/del&gt;&lt;/a&gt; wouldn&apos;t properly fix the issue in branch-1+ but rather would adapt its size calculation to use the hack&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks, let&apos;s fix it with an addendum here then.&lt;/p&gt;</comment>
                            <comment id="14382922" author="jonathan.lawlor" created="Thu, 26 Mar 2015 23:22:12 +0000"  >&lt;p&gt;Okay, makes sense to me. Since I was working in that area I made a quick patch (attached) so the two spots mentioned above use the WithoutTags size calculation. Patch should apply cleanly against branch-1+. &lt;/p&gt;

&lt;p&gt;Reopening to get a QA run in.&lt;/p&gt;</comment>
                            <comment id="14383181" author="hadoopqa" created="Fri, 27 Mar 2015 01:41:25 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12707635/HBASE-13303-addendum-v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12707635/HBASE-13303-addendum-v1.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 18256fc9544866fc7182dfc5dd9d73b8cef02d66.&lt;br/&gt;
  ATTACHMENT ID: 12707635&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13453//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13453//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13453//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13453//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13453//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13453//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13453//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13453//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14384962" author="apurtell" created="Sat, 28 Mar 2015 00:23:13 +0000"  >&lt;p&gt;Any last thoughts or comments? I will commit this in a couple of hours.&lt;/p&gt;</comment>
                            <comment id="14385140" author="apurtell" created="Sat, 28 Mar 2015 05:26:45 +0000"  >&lt;p&gt;Committed addendum to branch-1 and master.&lt;/p&gt;</comment>
                            <comment id="14385173" author="hudson" created="Sat, 28 Mar 2015 07:06:00 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.1 #335 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/335/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/335/&lt;/a&gt;)&lt;br/&gt;
Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13303&quot; title=&quot;Fix size calculation of results on the region server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13303&quot;&gt;&lt;del&gt;HBASE-13303&lt;/del&gt;&lt;/a&gt; Fix size calculation of results on the region server (apurtell: rev 7da7a77ff970b23c52106ef95520543dccf9d0c5)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14385207" author="hudson" created="Sat, 28 Mar 2015 09:28:49 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #6315 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6315/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6315/&lt;/a&gt;)&lt;br/&gt;
Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13303&quot; title=&quot;Fix size calculation of results on the region server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13303&quot;&gt;&lt;del&gt;HBASE-13303&lt;/del&gt;&lt;/a&gt; Fix size calculation of results on the region server (apurtell: rev 5038fc76c950029c78681dff816d7465f6acbb91)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14517760" author="enis" created="Tue, 28 Apr 2015 19:18:36 +0000"  >&lt;p&gt;Closing this issue after 1.0.1 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                                                <inwardlinks description="is superceded by">
                                        <issuelink>
            <issuekey id="12782590">HBASE-13262</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12706050" name="HBASE-13303-0.98.patch" size="8741" author="apurtell" created="Fri, 20 Mar 2015 21:25:53 +0000"/>
                            <attachment id="12706042" name="HBASE-13303-0.98.patch" size="8696" author="apurtell" created="Fri, 20 Mar 2015 21:06:48 +0000"/>
                            <attachment id="12706007" name="HBASE-13303-0.98.patch" size="7700" author="apurtell" created="Fri, 20 Mar 2015 19:18:49 +0000"/>
                            <attachment id="12707635" name="HBASE-13303-addendum-v1.patch" size="2029" author="jonathan.lawlor" created="Thu, 26 Mar 2015 23:22:12 +0000"/>
                            <attachment id="12706051" name="HBASE-13303.patch" size="10157" author="apurtell" created="Fri, 20 Mar 2015 21:25:53 +0000"/>
                            <attachment id="12706043" name="HBASE-13303.patch" size="10112" author="apurtell" created="Fri, 20 Mar 2015 21:06:48 +0000"/>
                            <attachment id="12706008" name="HBASE-13303.patch" size="7439" author="apurtell" created="Fri, 20 Mar 2015 19:18:49 +0000"/>
                            <attachment id="12706026" name="TestResultSizeEstimation.java" size="4649" author="apurtell" created="Fri, 20 Mar 2015 20:24:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 20 Mar 2015 17:51:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 33 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2720v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>