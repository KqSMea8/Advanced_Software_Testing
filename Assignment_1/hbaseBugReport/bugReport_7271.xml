<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:44:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7271/HBASE-7271.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7271] Have a single executor for all zkWorkers in the assignment manager</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7271</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The current strategy is to have an array of monothreaded executor, and hash the zk path to ensure that there are no two events on the same region executed in parallel  &lt;/p&gt;

&lt;p&gt;I think a single executor, as presented in the attached patch, is better because:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;we&apos;re guaranteed to use all threads at any time&lt;/li&gt;
	&lt;li&gt;if managing one of the event takes longer that expected, the slowness is limited to this region, and not to all regions that have the same hashed/moduloed code&lt;/li&gt;
	&lt;li&gt;For the nodeChildrenChanged, there is no need to choose randomly one of the worker (or, once again, the risk to get stuck if one of the event takes time to be managed).&lt;/li&gt;
&lt;/ul&gt;

</description>
                <environment></environment>
        <key id="12618740">HBASE-7271</key>
            <summary>Have a single executor for all zkWorkers in the assignment manager</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkeywal">Nicolas Liochon</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Dec 2012 15:06:15 +0000</created>
                <updated>Mon, 23 Sep 2013 18:30:55 +0000</updated>
                            <resolved>Tue, 11 Dec 2012 08:40:19 +0000</resolved>
                                    <version>0.95.2</version>
                                    <fixVersion>0.95.0</fixVersion>
                                    <component>master</component>
                    <component>Region Assignment</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13510303" author="stack" created="Wed, 5 Dec 2012 06:28:22 +0000"  >&lt;p&gt;Assigning Jimmy for his opinion on nkeyway&apos;s proposed change.&lt;/p&gt;</comment>
                            <comment id="13510573" author="jxiang" created="Wed, 5 Dec 2012 16:38:29 +0000"  >&lt;p&gt;Looked at the patch.  The idea is great.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-comment&quot;&gt;// In a multimap, the put order is kept when we retrieve the collection back. We need &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
&lt;/span&gt;+  &lt;span class=&quot;code-comment&quot;&gt;//  as we want the events to be managed in the same order as we received them.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Are we sure the order is kept?  It seems to me HashMultiMap uses just a regular HashSet to store the values which don&apos;t keep the order.&lt;br/&gt;
If so, we can just use a hash map from region name to a linked list of RegionRunnable instead.&lt;/p&gt;</comment>
                            <comment id="13510574" author="jxiang" created="Wed, 5 Dec 2012 16:40:36 +0000"  >&lt;p&gt;Good idea, nkeyway!  Back to you.&lt;/p&gt;</comment>
                            <comment id="13510616" author="yuzhihong@gmail.com" created="Wed, 5 Dec 2012 17:32:06 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-comment&quot;&gt;// We want don&apos;t want to have two events on the same region managed simultaneously.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Remove the first &apos;want&apos; above.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; inProgress = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There&apos;re many actions in progress. How about naming the above variable regionsInProgress ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Multimap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, RegionRunnable&amp;gt; todo =  HashMultimap.create()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Would zkEventWorkerWaitingList be a better name for todo ?&lt;br/&gt;
nit: remove one space before HashMultimap.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void zkEventWorkersSubmit(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RegionRunnable regRunnable) {
+    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (inProgress) {
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (inProgress.contains(regRunnable.getRegionName())) {
+        &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (todo){
+          todo.put(regRunnable.getRegionName(), regRunnable);
+        }
+      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;nit: if you return from if block, you can save one indent for else block where else keyword can be omitted.&lt;/p&gt;</comment>
                            <comment id="13510674" author="yuzhihong@gmail.com" created="Wed, 5 Dec 2012 18:48:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;If so, we can just use a hash map from region name to a linked list of RegionRunnable instead.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;LinkedHashMultimap would give us the ordering guarantee. See its javadoc:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 * Implementation of {@code Multimap} that does not allow duplicate key-value
 * entries and that returns collections whose iterators follow the ordering in
 * which the data was added to the multimap.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13510688" author="jxiang" created="Wed, 5 Dec 2012 19:03:36 +0000"  >&lt;p&gt;+1 for LinkedHashMultimap&lt;/p&gt;</comment>
                            <comment id="13510692" author="yuzhihong@gmail.com" created="Wed, 5 Dec 2012 19:13:05 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; RegionRunnable &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;{
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above interface is only used within AssignmentManager - it can be made private.&lt;/p&gt;</comment>
                            <comment id="13510703" author="nkeywal" created="Wed, 5 Dec 2012 19:24:29 +0000"  >&lt;p&gt;I&apos;m ok will all the comments, I will provide an updated version tomorrow, my time.&lt;/p&gt;</comment>
                            <comment id="13511559" author="nkeywal" created="Thu, 6 Dec 2012 17:50:19 +0000"  >&lt;p&gt;v2, with all comments taken into accounts. I fixed two unrelated nits unrelated to my patch as well. Local tests ok.&lt;/p&gt;</comment>
                            <comment id="13511589" author="hadoopqa" created="Thu, 6 Dec 2012 18:26:23 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12555949/7271.v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12555949/7271.v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 101 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 23 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3451//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13511603" author="yuzhihong@gmail.com" created="Thu, 6 Dec 2012 18:38:57 +0000"  >&lt;p&gt;Patch v2 looks good. Following can be addressed on commit.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; workers = conf.getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.assignment.zkevent.workers&quot;&lt;/span&gt;, 20);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;nit: why the increase in number of workers ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+            &lt;span class=&quot;code-comment&quot;&gt;// now that we have finished, let see &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there is an event &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the same region in the&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;nit: &apos;let see&apos; -&amp;gt; &quot;let&apos;s see&quot;&lt;/p&gt;</comment>
                            <comment id="13512003" author="nkeywal" created="Thu, 6 Dec 2012 18:51:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;nit: why the increase in number of workers ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It&apos;s far from nit &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I think 5 is not enough. I&apos;ve done tests bumping the number of threads everywhere in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7248&quot; title=&quot;Improve the resources usage in assignement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7248&quot;&gt;HBASE-7248&lt;/a&gt;. I will redo it after once &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7247&quot; title=&quot;Assignment performances decreased by 50% because of regionserver.OpenRegionHandler#tickleOpening&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7247&quot;&gt;&lt;del&gt;HBASE-7247&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7246&quot; title=&quot;Assignment#nodeChildrenChanged calls listChildrenAndWatchForNewChildren, overloading master &amp;amp; zookeper needlessly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7246&quot;&gt;HBASE-7246&lt;/a&gt; are committed, so identify something reasonably optimal, but I wanted to put a first stone there...&lt;/p&gt;</comment>
                            <comment id="13512016" author="stack" created="Thu, 6 Dec 2012 19:06:15 +0000"  >&lt;p&gt;On commit, perhaps change thread name to have hosting servername prefix (see other thread namings).&lt;/p&gt;

&lt;p&gt;The check in the below should be under the synchronization block too...&lt;/p&gt;

&lt;p&gt;+      if (regionsInProgress.contains(regRunnable.getRegionName())) {&lt;br/&gt;
+        synchronized (zkEventWorkerWaitingList)&lt;/p&gt;
{
+          zkEventWorkerWaitingList.put(regRunnable.getRegionName(), regRunnable);
+        }
&lt;p&gt;+        return;&lt;br/&gt;
+      }&lt;/p&gt;

&lt;p&gt;Can do on commit.&lt;/p&gt;

&lt;p&gt;+1 on commit.&lt;/p&gt;
</comment>
                            <comment id="13526049" author="jxiang" created="Fri, 7 Dec 2012 00:50:18 +0000"  >&lt;p&gt;On commit, probably set the iterator to a local variable, and call iterator.remove() instead.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+                  RegionRunnable next = waiting.iterator().next();
+                  zkEventWorkerWaitingList.remove(next.getRegionName(), next);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13526454" author="nkeywal" created="Fri, 7 Dec 2012 15:29:46 +0000"  >&lt;p&gt;v3. Testing locally. &lt;br/&gt;
All comments above taken into account, excepted:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The check in the below should be under the synchronization block too...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The code as it is is ok imho?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;On commit, probably set the iterator to a local variable, and call iterator.remove() instead.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Guava should return something nicer than a simple Set, so it&apos;s not perfect whatever we do... I added some comments and renamed a variable.&lt;/p&gt;</comment>
                            <comment id="13526610" author="stack" created="Fri, 7 Dec 2012 18:30:44 +0000"  >&lt;blockquote&gt;&lt;p&gt;The check in the below should be under the synchronization block too...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Doing the check outside of the sync block and then doing the put inside the sync block allows that the backing map can change between the check and put.  Why not move the check under the sync too?&lt;/p&gt;</comment>
                            <comment id="13526671" author="nkeywal" created="Fri, 7 Dec 2012 19:19:59 +0000"  >&lt;p&gt;We&apos;ve got two lists, hence two locks: we keep the lock on the first one:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (regionsInProgress) {
+      &lt;span class=&quot;code-comment&quot;&gt;// If we&apos;re there is already a task with &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; region, we add it to the
&lt;/span&gt;+      &lt;span class=&quot;code-comment&quot;&gt;//  waiting list and &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;.
&lt;/span&gt;+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (regionsInProgress.contains(regRunnable.getRegionName())) {
+        &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (zkEventWorkerWaitingList){
+          zkEventWorkerWaitingList.put(regRunnable.getRegionName(), regRunnable);
+        }
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
         ====&amp;gt; We won&apos;t touch anymore zkEventWorkerWaitingList, we can release the lock
+      }
+
====&amp;gt; We still have the lock on regionsInProgress
+      &lt;span class=&quot;code-comment&quot;&gt;// No event in progress on &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; region =&amp;gt; we can submit a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; task immediately.
&lt;/span&gt;+      regionsInProgress.add(regRunnable.getRegionName());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13527888" author="nkeywal" created="Mon, 10 Dec 2012 11:39:20 +0000"  >&lt;p&gt;Committed v3, I will amend (or revert &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ) if it&apos;s necessary.&lt;/p&gt;</comment>
                            <comment id="13527919" author="hudson" created="Mon, 10 Dec 2012 13:03:21 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3604 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3604/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3604/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7271&quot; title=&quot;Have a single executor for all zkWorkers in the assignment manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7271&quot;&gt;&lt;del&gt;HBASE-7271&lt;/del&gt;&lt;/a&gt; Have a single executor for all zkWorkers in the assignment manager (Revision 1419351)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
nkeywal : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13528143" author="stack" created="Mon, 10 Dec 2012 18:32:30 +0000"  >&lt;p&gt;Sorry.  I was reading the contains check as being done on the zkEventWorkerWaitingList list.  +1 on commit.&lt;/p&gt;</comment>
                            <comment id="13528479" author="hudson" created="Tue, 11 Dec 2012 00:13:10 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #291 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/291/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/291/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7271&quot; title=&quot;Have a single executor for all zkWorkers in the assignment manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7271&quot;&gt;&lt;del&gt;HBASE-7271&lt;/del&gt;&lt;/a&gt; Have a single executor for all zkWorkers in the assignment manager (Revision 1419351)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
nkeywal : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13528808" author="nkeywal" created="Tue, 11 Dec 2012 08:40:09 +0000"  >&lt;p&gt;Thanks for the reviews. Resolving...&lt;/p&gt;</comment>
                            <comment id="13775182" author="stack" created="Mon, 23 Sep 2013 18:30:55 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12551766">HBASE-5843</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12555949" name="7271.v1.patch" size="7790" author="nkeywal" created="Tue, 4 Dec 2012 16:08:57 +0000"/>
                            <attachment id="12556381" name="7271.v2.patch" size="9212" author="nkeywal" created="Thu, 6 Dec 2012 17:49:27 +0000"/>
                            <attachment id="12556380" name="7271.v2.patch" size="9212" author="nkeywal" created="Thu, 6 Dec 2012 17:49:03 +0000"/>
                            <attachment id="12559877" name="7271.v3.patch" size="9342" author="nkeywal" created="Fri, 7 Dec 2012 15:27:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 5 Dec 2012 06:28:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>295978</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i144f3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>232179</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>