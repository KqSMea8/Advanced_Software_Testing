<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:15:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4024/HBASE-4024.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4024] Major compaction may not be triggered, even though region server log says it is triggered</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4024</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The trunk version of regionserver/Store.java, method   List&amp;lt;StoreFile&amp;gt; compactSelection(List&amp;lt;StoreFile&amp;gt; candidates) has this code to determine whether major compaction should be done or not: &lt;/p&gt;

&lt;p&gt;    // major compact on user action or age (caveat: we have too many files)&lt;br/&gt;
    boolean majorcompaction = (forcemajor || isMajorCompaction(filesToCompact))&lt;br/&gt;
      &amp;amp;&amp;amp; filesToCompact.size() &amp;lt; this.maxFilesToCompact;&lt;/p&gt;


&lt;p&gt;The isMajorCompaction(filesToCompact) method internally determines whether or not major compaction is required (and logs this as &quot;Major compaction triggered ... &quot; log message. However, after the call, the compactSelection method subsequently applies the filesToCompact.size() &amp;lt; this.maxFilesToCompact check which can turn off major compaction. &lt;/p&gt;

&lt;p&gt;This would result in a &quot;Major compaction triggered&quot; log message without actually triggering a major compaction.&lt;/p&gt;

&lt;p&gt;The filesToCompact.size() check should probably be moved inside the isMajorCompaction(filesToCompact) method.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12511414">HBASE-4024</key>
            <summary>Major compaction may not be triggered, even though region server log says it is triggered</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="5" iconUrl="https://issues.apache.org/jira/images/icons/priorities/trivial.png">Trivial</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="svarma">Suraj Varma</reporter>
                        <labels>
                    </labels>
                <created>Thu, 23 Jun 2011 22:50:30 +0000</created>
                <updated>Fri, 20 Nov 2015 11:55:33 +0000</updated>
                            <resolved>Wed, 27 Jul 2011 04:40:56 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13054522" author="yuzhihong@gmail.com" created="Fri, 24 Jun 2011 16:18:23 +0000"  >&lt;p&gt;Added filesToCompact.size() check in isMajorCompaction()&lt;/p&gt;

&lt;p&gt;TestCompaction and TestCompactSelection pass.&lt;/p&gt;</comment>
                            <comment id="13054558" author="jdcryans" created="Fri, 24 Jun 2011 17:11:18 +0000"  >&lt;p&gt;Regarding the last edit in the patch, I don&apos;t think you should remove that whitespace and what would be the reason to keep the check on the number of files there if it&apos;s moved into isMajorCompaction?&lt;/p&gt;</comment>
                            <comment id="13054562" author="yuzhihong@gmail.com" created="Fri, 24 Jun 2011 17:18:43 +0000"  >&lt;p&gt;I can revert the whitespace change.&lt;br/&gt;
The check on the number of files was kept for the case when forcemajor is true.&lt;/p&gt;</comment>
                            <comment id="13054568" author="yuzhihong@gmail.com" created="Fri, 24 Jun 2011 17:30:28 +0000"  >&lt;p&gt;Removed the whitespace adjustment.&lt;/p&gt;</comment>
                            <comment id="13054618" author="jdcryans" created="Fri, 24 Jun 2011 18:36:13 +0000"  >&lt;p&gt;I&apos;m starting to think that the check should be refactored out of the ifs and put right at the beginning, and then maybe print a nice message on why it&apos;s skipping?&lt;/p&gt;</comment>
                            <comment id="13054626" author="yuzhihong@gmail.com" created="Fri, 24 Jun 2011 19:00:31 +0000"  >&lt;p&gt;Allow me to reformat a portion of existing code in v2.&lt;/p&gt;</comment>
                            <comment id="13056080" author="nspiegelberg" created="Mon, 27 Jun 2011 22:54:32 +0000"  >&lt;p&gt;+1 to JD&apos;s comment.  refactor to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; majorcompaction = filesToCompact.size() &amp;lt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.maxFilesToCompact 
  &amp;amp;&amp;amp; (forcemajor || isMajorCompaction(filesToCompact));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and just utilize short-circuit evaluation.&lt;/p&gt;</comment>
                            <comment id="13056185" author="yuzhihong@gmail.com" created="Mon, 27 Jun 2011 23:13:43 +0000"  >&lt;p&gt;In 4024-v2.txt, the additional message is logged in isMajorCompaction(). That would be short-circuited by the proposed change above.&lt;/p&gt;

&lt;p&gt;So the above proposal is all that we need.&lt;/p&gt;</comment>
                            <comment id="13056210" author="yuzhihong@gmail.com" created="Mon, 27 Jun 2011 23:47:46 +0000"  >&lt;p&gt;Patch version 3.&lt;/p&gt;</comment>
                            <comment id="13056272" author="stack" created="Tue, 28 Jun 2011 03:35:52 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13056275" author="yuzhihong@gmail.com" created="Tue, 28 Jun 2011 03:55:39 +0000"  >&lt;p&gt;Integrate patch version 3 into TRUNK.&lt;/p&gt;

&lt;p&gt;Thanks for the hint Nicholas.&lt;/p&gt;</comment>
                            <comment id="13056844" author="hudson" created="Tue, 28 Jun 2011 22:42:48 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1995 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/1995/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/1995/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="13071509" author="stack" created="Wed, 27 Jul 2011 04:40:56 +0000"  >&lt;p&gt;This was committed a while back.&lt;/p&gt;</comment>
                            <comment id="15016515" author="lars_francke" created="Fri, 20 Nov 2015 11:55:33 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12483757" name="4024-v2.txt" size="1333" author="yuzhihong@gmail.com" created="Fri, 24 Jun 2011 19:00:31 +0000"/>
                            <attachment id="12484363" name="4024-v3.txt" size="830" author="yuzhihong@gmail.com" created="Mon, 27 Jun 2011 23:47:46 +0000"/>
                            <attachment id="12483748" name="4024.txt" size="1215" author="yuzhihong@gmail.com" created="Fri, 24 Jun 2011 17:32:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 24 Jun 2011 16:18:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27133</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hp1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101319</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>