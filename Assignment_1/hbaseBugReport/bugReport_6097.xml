<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:33:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6097/HBASE-6097.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6097] TestHRegion.testBatchPut is flaky on 0.92</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6097</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;If I run this test in a loop, I get failures like the following:&lt;/p&gt;

&lt;p&gt;Error Message:&lt;br/&gt;
expected:&amp;lt;1&amp;gt; but was:&amp;lt;2&amp;gt;&lt;/p&gt;

&lt;p&gt;Stack Trace:&lt;br/&gt;
junit.framework.AssertionFailedError: expected:&amp;lt;1&amp;gt; but was:&amp;lt;2&amp;gt;&lt;br/&gt;
at junit.framework.Assert.fail(Assert.java:50)&lt;br/&gt;
at junit.framework.Assert.failNotEquals(Assert.java:287)&lt;br/&gt;
at junit.framework.Assert.assertEquals(Assert.java:67)&lt;br/&gt;
at junit.framework.Assert.assertEquals(Assert.java:134)&lt;br/&gt;
at junit.framework.Assert.assertEquals(Assert.java:140)&lt;br/&gt;
at org.apache.hadoop.hbase.regionserver.TestHRegion.testBatchPut(TestHRegion.java:536)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12558149">HBASE-6097</key>
            <summary>TestHRegion.testBatchPut is flaky on 0.92</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="gchanan">Gregory Chanan</assignee>
                                    <reporter username="gchanan">Gregory Chanan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 May 2012 17:48:51 +0000</created>
                <updated>Fri, 20 Nov 2015 11:55:07 +0000</updated>
                            <resolved>Tue, 29 May 2012 19:00:58 +0000</resolved>
                                    <version>0.92.1</version>
                                    <fixVersion>0.92.2</fixVersion>
                                    <component>test</component>
                    <component>wal</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13283637" author="gchanan" created="Fri, 25 May 2012 17:59:03 +0000"  >&lt;p&gt;The issue is that this test checks that a sync happened like so:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
assertEquals(1, HLog.getSyncOps());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But in 0.92, the LogSyncer thread will sync, and increment HLog.getSyncOps(), even if there are no updates to the wal.  This has been fixed in 0.94+.&lt;/p&gt;

&lt;p&gt;So, you can trigger a failure by setting hbase.regionserver.optionallogflushinterval to an extremely low value and throwing in random sleeps to the test.&lt;/p&gt;

&lt;p&gt;Possibilities for fixing:&lt;br/&gt;
1) Backport the work from 0.94+ that avoids syncing if there are no updates to the wal&lt;br/&gt;
2) Only change the test and just check that a sync ran, e.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt;(HLog.getSyncOps() &amp;gt; 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This makes the test a bit too accepting, because then it is possible that the syncer can sync nothing and we&apos;d think a sync actually ran.&lt;/p&gt;

&lt;p&gt;I&apos;ll investigate some more.&lt;/p&gt;</comment>
                            <comment id="13283802" author="gchanan" created="Fri, 25 May 2012 23:06:28 +0000"  >&lt;ul&gt;
	&lt;li&gt;Attached &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6097&quot; title=&quot;TestHRegion.testBatchPut is flaky on 0.92&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6097&quot;&gt;&lt;del&gt;HBASE-6097&lt;/del&gt;&lt;/a&gt;.patch *&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Fixes race by setting the timeout of the LogSyncerThread to a very high value so it won&apos;t affect the number of sync ops.&lt;/p&gt;</comment>
                            <comment id="13283827" author="zhihyu@ebaysf.com" created="Fri, 25 May 2012 23:57:48 +0000"  >&lt;p&gt;I think backporting work from 0.94+ would be better.&lt;/p&gt;</comment>
                            <comment id="13283828" author="hadoopqa" created="Fri, 25 May 2012 23:59:09 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12529817/HBASE-6097.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12529817/HBASE-6097.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 33 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2005//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2005//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2005//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2005//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2005//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2005//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13283843" author="gchanan" created="Sat, 26 May 2012 00:18:55 +0000"  >&lt;p&gt;@Ted:&lt;/p&gt;

&lt;p&gt;I considered that but these backports are tricky HLog-performance/bug fixes that are 0.94 specific.  We would need at least &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4487&quot; title=&quot;The increment operation can release the rowlock before sync-ing the Hlog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4487&quot;&gt;&lt;del&gt;HBASE-4487&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5782&quot; title=&quot;Edits can be appended out of seqid order since HBASE-4487&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5782&quot;&gt;&lt;del&gt;HBASE-5782&lt;/del&gt;&lt;/a&gt;, and possibly many more.&lt;/p&gt;

&lt;p&gt;I thought it makes more sense to have that stuff live only in 0.94+ and to make the minimal change for the flaky test.&lt;/p&gt;</comment>
                            <comment id="13283852" author="zhihyu@ebaysf.com" created="Sat, 26 May 2012 00:37:00 +0000"  >&lt;p&gt;Changes in HLog from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4487&quot; title=&quot;The increment operation can release the rowlock before sync-ing the Hlog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4487&quot;&gt;&lt;del&gt;HBASE-4487&lt;/del&gt;&lt;/a&gt; are relatively big.&lt;br/&gt;
It is fine to fix test first.&lt;/p&gt;</comment>
                            <comment id="13285009" author="stack" created="Tue, 29 May 2012 19:00:58 +0000"  >&lt;p&gt;+1 on minimal fix for an old branch rather than pull in a bunch of new code.&lt;/p&gt;

&lt;p&gt;Thanks for the patch Gregory.&lt;/p&gt;</comment>
                            <comment id="13285148" author="hudson" created="Tue, 29 May 2012 21:27:24 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #426 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/426/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/426/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6097&quot; title=&quot;TestHRegion.testBatchPut is flaky on 0.92&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6097&quot;&gt;&lt;del&gt;HBASE-6097&lt;/del&gt;&lt;/a&gt; TestHRegion.testBatchPut is flaky on 0.92 (Revision 1343921)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13287238" author="hudson" created="Fri, 1 Jun 2012 08:08:18 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #109 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/109/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/109/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6097&quot; title=&quot;TestHRegion.testBatchPut is flaky on 0.92&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6097&quot;&gt;&lt;del&gt;HBASE-6097&lt;/del&gt;&lt;/a&gt; TestHRegion.testBatchPut is flaky on 0.92 (Revision 1343921)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15016402" author="lars_francke" created="Fri, 20 Nov 2015 11:55:07 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12529817" name="HBASE-6097.patch" size="1040" author="gchanan" created="Fri, 25 May 2012 23:06:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 25 May 2012 23:57:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241966</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02h93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12396</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>