<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:14:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-16492/HBASE-16492.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-16492] Setting timeout on blocking operations in read/write path</title>
                <link>https://issues.apache.org/jira/browse/HBASE-16492</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15593&quot; title=&quot;Time limit of scanning should be offered by client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15593&quot;&gt;&lt;del&gt;HBASE-15593&lt;/del&gt;&lt;/a&gt;, we can use rpc timeout provided by client to prevent wasting time on requests that have been dropped by client. In request-handling path there are some points that are suitable to check if we can finish this request in time.&lt;/p&gt;

&lt;p&gt;We can do this work in several sub-tasks to make sure each one is simple and easy to maintain.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12999591">HBASE-16492</key>
            <summary>Setting timeout on blocking operations in read/write path</summary>
                <type id="14" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/genericissue.png">Umbrella</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="yangzhe1991">Phil Yang</assignee>
                                    <reporter username="yangzhe1991">Phil Yang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Aug 2016 09:48:43 +0000</created>
                <updated>Thu, 8 Sep 2016 06:12:14 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                                                            <comments>
                            <comment id="15434620" author="yangzhe1991" created="Wed, 24 Aug 2016 09:51:47 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-16285&quot; title=&quot;Drop RPC requests if it must be considered as timeout at client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-16285&quot;&gt;&lt;del&gt;HBASE-16285&lt;/del&gt;&lt;/a&gt; do this work when pulling requests from the RPC queue. So change it to a sub-task.&lt;/p&gt;</comment>
                            <comment id="15434625" author="apache9" created="Wed, 24 Aug 2016 09:55:40 +0000"  >&lt;p&gt;I think this could a start point of changing RS to SEDA? The suitable points would be the start/end of stages?&lt;/p&gt;</comment>
                            <comment id="15434645" author="yangzhe1991" created="Wed, 24 Aug 2016 10:13:24 +0000"  >&lt;p&gt;Sounds interesting &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Indeed, &quot;the suitable points&quot; for checking if we can drop requests are usually the points that we may block the current handler thread. Setting a timeout provided by client to these blocking operations can free the handler much earlier then now. And if we can make these operations non-blocking, we can make a big progress to SEDA. And of course, not all check points need non-blocking, I think the most suitable points for stages is the operation that relies on the load of other nodes, for example, HDFS read/write operations. A slow datanode may occupy all handler, which is very similar to the scene in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-16388&quot; title=&quot;Prevent client threads being blocked by only one slow region server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-16388&quot;&gt;&lt;del&gt;HBASE-16388&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="15436168" author="carp84" created="Thu, 25 Aug 2016 02:48:34 +0000"  >&lt;p&gt;I could see quite some good jobs done/in-progress about preventing client being stuck, such as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15593&quot; title=&quot;Time limit of scanning should be offered by client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15593&quot;&gt;&lt;del&gt;HBASE-15593&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-16388&quot; title=&quot;Prevent client threads being blocked by only one slow region server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-16388&quot;&gt;&lt;del&gt;HBASE-16388&lt;/del&gt;&lt;/a&gt; and this one. There might be more and maybe it&apos;s worthwhile to open an Umbrella linking all these stuff so we could get an overview about all relative improvements?&lt;/p&gt;

&lt;p&gt;Regarding SEDA, agree that it&apos;s time to think more about it, and we&apos;ve also started some work on this in Alibaba. Maybe another Umbrella so we could collaborate on this?&lt;/p&gt;

&lt;p&gt;Thanks. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="15436777" author="yangzhe1991" created="Thu, 25 Aug 2016 12:50:09 +0000"  >&lt;p&gt;There is a problem that all the blocking operations can only set timeout, not deadline. In each RPC request we know the rpc timeout and the start time, so we know the deadline. In each blocking operation in the request handling logic, the exact timeout should be deadline-currentTime. Call System.currentTime for several times may not be not a good idea, but I think there are only a small amount of check points in read/write path, so I think the cost will not be high and it is worth to do.&lt;br/&gt;
What do you think? Thanks.&lt;/p&gt;</comment>
                            <comment id="15438551" author="yangzhe1991" created="Fri, 26 Aug 2016 06:35:59 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Regarding SEDA, agree that it&apos;s time to think more about it, and we&apos;ve also started some work on this in Alibaba.  Maybe another Umbrella so we could collaborate on this?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Glad to see we can do this together &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt; and I discuss offline, we think we need change Region interface(LimitedPrivate for COPROC) which should support passing a deadline to the operations of Region first, and then make it async as the first step to SEDA, which means the methods of operations in Region returns nothing and we pass a Context into the methods and then wait the async context done in RPCServer. Finally the RPCServer only do the first stage, the final stage which writes response to client will be in a independent logic. Or we can use gRPC&apos;s framework. &lt;/p&gt;

&lt;p&gt;What do you think, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=carp84&quot; class=&quot;user-hover&quot; rel=&quot;carp84&quot;&gt;Yu Li&lt;/a&gt;? Thanks.&lt;/p&gt;</comment>
                            <comment id="15444721" author="yangzhe1991" created="Mon, 29 Aug 2016 03:57:18 +0000"  >&lt;p&gt;We have two options here: Change the Region interface&apos;s to non-blocking and add a context parameter, or add a new interface called AsyncRegion. Any ideas? Thanks&lt;/p&gt;</comment>
                            <comment id="15451643" author="carp84" created="Wed, 31 Aug 2016 08:59:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangzhe1991&quot; class=&quot;user-hover&quot; rel=&quot;yangzhe1991&quot;&gt;Phil Yang&lt;/a&gt; Sorry for the late response, busy preparing for 11-11 recently...&lt;/p&gt;

&lt;p&gt;I could see work already started following the AsyncRegion design, and it LGTM.&lt;/p&gt;

&lt;p&gt;Have you and mighty Duo made any overall design for SEDA? Any doc to share? We&apos;ve started some work on RpcServer and let&apos;s see how to cooperate.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aoxiang&quot; class=&quot;user-hover&quot; rel=&quot;aoxiang&quot;&gt;binlijin&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xharlie&quot; class=&quot;user-hover&quot; rel=&quot;xharlie&quot;&gt;Charlie Qiangeng Xu&lt;/a&gt;, please also follow this thread fellas.&lt;/p&gt;</comment>
                            <comment id="15451792" author="apache9" created="Wed, 31 Aug 2016 10:02:28 +0000"  >&lt;p&gt;No. I&apos;m currently working on the netty rpc client and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yangzhe1991&quot; class=&quot;user-hover&quot; rel=&quot;yangzhe1991&quot;&gt;Phil Yang&lt;/a&gt; is working on the delete semantic fix. We do not have much time on other project so we do not have a clear degisn of SEDA right now. But we believe that the interface change is needed no matter how you implement SEDA. We need something like a Context to pass timeout and other parameters down and also pass the return value up. We can not use thread local as in SEDA one request will be executed with several stages and each stages has its own thread pool.&lt;/p&gt;</comment>
                            <comment id="15472927" author="yangzhe1991" created="Thu, 8 Sep 2016 06:12:14 +0000"  >&lt;p&gt;Created &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-16583&quot; title=&quot;Make Region&amp;#39;s implementation asynchronous&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-16583&quot;&gt;HBASE-16583&lt;/a&gt; for SEDA. We can continue the discussion there &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12956140">HBASE-15593</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="13003459">HBASE-16583</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12992529">HBASE-16285</subtask>
                            <subtask id="13000280">HBASE-16505</subtask>
                            <subtask id="12999628">HBASE-16494</subtask>
                            <subtask id="13024468">HBASE-17210</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 24 Aug 2016 09:55:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            14 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i32po7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>