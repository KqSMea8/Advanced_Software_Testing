<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:18:07 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10885/HBASE-10885.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10885] Support visibility expressions on Deletes</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10885</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Accumulo can specify visibility expressions for delete markers. During compaction the cells covered by the tombstone are determined in part by matching the visibility expression. This is useful for the use case of data set coalescing, where entries from multiple data sets carrying different labels are combined into one common large table. Later, a subset of entries can be conveniently removed using visibility expressions.&lt;/p&gt;

&lt;p&gt;Currently doing the same in HBase would only be possible with a custom coprocessor. Otherwise, a Delete will affect all cells covered by the tombstone regardless of any visibility expression scoping. This is correct behavior in that no data spill is possible, but certainly could be surprising, and is only meant to be transitional. We decided not to support visibility expressions on Deletes to control the complexity of the initial implementation.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12705871">HBASE-10885</key>
            <summary>Support visibility expressions on Deletes</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Apr 2014 07:59:59 +0000</created>
                <updated>Sat, 21 Feb 2015 23:29:10 +0000</updated>
                            <resolved>Fri, 4 Jul 2014 18:32:17 +0000</resolved>
                                    <version>0.98.1</version>
                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>0.98.4</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                                                            <comments>
                            <comment id="13956211" author="apurtell" created="Tue, 1 Apr 2014 08:03:46 +0000"  >&lt;p&gt;How we handle deletes in the AccessController is to only allow the delete if it has covering permission. By that I mean CF ACLs and any ACLs in cells that would be covered by the tombstone not already covered by a tombstone must grant the subject access. If any do not, the delete is denied. We run an internal RegionScanner to enumerate the cells that would be affected by the operation. &lt;/p&gt;

&lt;p&gt;One way to do this for the VisibilityController is we could similarly run an internal RegionScanner with the parameters of the submitted Delete op, filter cells by effective visibility, and issue deletes scoped only to those cells visible to the subject. This would be easier than trying to hook compaction scanners and evaluating visibility expression tags there, because we will have the effective label set for the user in the RPC context, not at compaction time. &lt;/p&gt;</comment>
                            <comment id="13956297" author="ram_krish" created="Tue, 1 Apr 2014 09:22:39 +0000"  >&lt;p&gt;Delete.setCellVisibility() should be supported now. And these labels passed here will be only a list of labels and not visibility expressions like A|B!C?&lt;br/&gt;
Which means if an existing put had A&amp;amp;B now the delete should pass A&amp;amp;B or it could be A,B like how we pass for Authorization?&lt;/p&gt;</comment>
                            <comment id="13956348" author="apurtell" created="Tue, 1 Apr 2014 10:21:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;Delete.setCellVisibility() should be supported now.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;And these labels passed here will be only a list of labels and not visibility expressions like A|B!C?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No. Deletes should support visibility expressions just like Put, etc. The supplied visibility expression is then associated with the delete marker(s).&lt;/p&gt;

&lt;p&gt;Actually, scratch what I said above in the first comment. We can store the delete marker as a cell with a visibility expression tag and do the work later, by hooking the compaction scanner. We would check for visibility expressions in tags on delete markers at compaction time. If we find one, then we have to filter only the cells covered by the tombstone that have a matching expression.&lt;/p&gt;

&lt;p&gt;If we are not storing visibility expression terminals (LeafExpressionNodes) in sorted order by ordinal we probably should consider it. (I don&apos;t think we are.) Because e.g. A|B == B|A. It would be most efficient if we can simply do byte comparison of serialized visibility expressions on the delete marker and any found while enumerating cells covered by it. &lt;/p&gt;

&lt;p&gt;If a delete marker has a visibility expression, then we only apply it to cells with matching visibility  expressions. If a cell has no visibility tag then it does not match. (A|B != nil)&lt;/p&gt;

&lt;p&gt;Should we check that the supplied expression does not exceed the maximal authorization set for the user submitting the Delete in the preDelete hook? In other words, should we we allow a user only granted authorization A to submit a delete with visibility expression A|B? We should not, in my opinion. Recommend we answer this question for other op types on another JIRA, should there be any.&lt;/p&gt;</comment>
                            <comment id="13958607" author="ram_krish" created="Thu, 3 Apr 2014 07:41:18 +0000"  >&lt;p&gt;Doing like what ACL does may be easier because we could see which subject issues the delete.  If a super user/admin that makes the put does the delete then we can just allow the delete to happen.&lt;br/&gt;
So assume we have user A with labels CONFIDENTIAL  associated with him.&lt;br/&gt;
And there is a Put already done with row1, cf1, q1, CONFIDENTIAL and another version&lt;br/&gt;
row1,cf1,q1, TOPSECRET&amp;amp;CONFIDENTIAL&lt;br/&gt;
If suppose user A tries to issue a delete ( not using Cellvisibility) - by using the labels associated with User A we could find that we will not be able to delete this row. Because one of the versions has additional labels associated with it.&lt;br/&gt;
But allowing the delete to be added and then verifying the visibility expression during compaction time - then we may have to handle the logic of deletes and corresponding puts in the compaction scanner hook that we create.  Also what about the scans that happens? May be there is a matching delete for a put with exactly same visibility expression, ideally the scan should not return that KV.  &lt;br/&gt;
Apart from this with the ACL delete handling case, some doubts regarding the handling of the deleteColumn() -  which deletes only the latest version.  But with the current implementation even though the current version allows the delete with valid permissions for the user, because there is an older version with lesser permission we deny the delete.  Is that valid? same applies with deleteFamily() also.&lt;/p&gt;</comment>
                            <comment id="13958648" author="apurtell" created="Thu, 3 Apr 2014 08:59:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;Doing like what ACL does may be easier because we could see which subject issues the delete. If a super user/admin that makes the put does the delete then we can just allow the delete to happen.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Above I suggest splitting the authorization check and the actual delete handling. Do the authorization check in the preDelete hook because we have the user&apos;s effective label set in the RPC context. Do the delete handling in compaction because for the deleteColumn or deleteFamily cases if we convert that delete request to a set of per-cell deletes, this could produce an explosion of tombstones. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Apart from this with the ACL delete handling case, some doubts regarding the handling of the deleteColumn() -  which deletes only the latest version.  But with the current implementation even though the current version allows the delete with valid permissions for the user, because there is an older version with lesser permission we deny the delete.  Is that valid? same applies with deleteFamily() also.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, the rule is all visible cells with an ACL must allow the delete, or the delete will be denied. However, we should respect the MAX_VERSIONS of column families as defined in the schema when determining the scope of visibility and so changes are needed for that (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10899&quot; title=&quot;[AccessController] Apply MAX_VERSIONS from schema or request when scanning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10899&quot;&gt;&lt;del&gt;HBASE-10899&lt;/del&gt;&lt;/a&gt;). &lt;/p&gt;</comment>
                            <comment id="13969254" author="anoop.hbase" created="Tue, 15 Apr 2014 06:02:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;Do the delete handling in compaction because for the deleteColumn or deleteFamily cases if we convert that delete request to a set of per-cell deletes, this could produce an explosion of tombstones. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;+1&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;If we are not storing visibility expression terminals (LeafExpressionNodes) in sorted order by ordinal we probably should consider it. (I don&apos;t think we are.) Because e.g. A|B == B|A. It would be most efficient if we can simply do byte comparison of serialized visibility expressions on the delete marker and any found while enumerating cells covered by it. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes +1.&lt;/p&gt;

&lt;p&gt; So when we decide at the compaction time by direct byte compare of expressions in Delete kv and other kvs, what abt the old HFile data written using 98.0 or 98.1 versions?  This will be like not sorted.&lt;br/&gt;
Also it wont one simple bytes compare.   A&amp;amp;B will be stored as one Tag. In case of &apos;|&apos; it will be stored as 2 tags.   So we need to consider all these tags and compare all.  Just a note before starting the impl.&lt;/p&gt;
</comment>
                            <comment id="13969688" author="apurtell" created="Tue, 15 Apr 2014 16:26:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also it wont one simple bytes compare. A&amp;amp;B will be stored as one Tag. In case of &apos;|&apos; it will be stored as 2 tags. So we need to consider all these tags and compare all. Just a note before starting the impl.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok thanks Anoop.&lt;/p&gt;</comment>
                            <comment id="13974871" author="apurtell" created="Sat, 19 Apr 2014 14:08:07 +0000"  >&lt;p&gt;Critical for 0.98.2&lt;/p&gt;</comment>
                            <comment id="13978475" author="ram_krish" created="Wed, 23 Apr 2014 17:11:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;what abt the old HFile data written using 98.0 or 98.1 versions?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is a very much valid concern. Any suggestions?&lt;/p&gt;</comment>
                            <comment id="13978485" author="apurtell" created="Wed, 23 Apr 2014 17:19:44 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;what abt the old HFile data written using 98.0 or 98.1 versions?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is a very much valid concern&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We don&apos;t consider sorting expression terminals by ordinal after all. Right? &lt;/p&gt;</comment>
                            <comment id="13980520" author="apurtell" created="Fri, 25 Apr 2014 00:00:28 +0000"  >&lt;p&gt;On sorting of terminals or not, a discussion that Ram, Anoop, and I had included this topic and it seems reasonable to change the serialization. I think we should start by splitting out the ad hoc visibility tag serialization in VisibilityController to a separate file. We could put magic bytes in front and test for those, falling back to an expensive comparison of we don&apos;t find the magic, otherwise use one optimized for sorted representation. While we are at it we could use protobuf for the new serialization and so the magic preamble would be &apos;PBUF&apos; I suppose. &lt;/p&gt;</comment>
                            <comment id="13983976" author="ram_krish" created="Tue, 29 Apr 2014 04:24:52 +0000"  >&lt;p&gt;First version for review.  Once shell support is committed in the sub-task this patch could be easily tested from shell also.&lt;br/&gt;
Tried out the option of using VisiblityDeleteFilters also, but it has some code duplication required and all the scan should be of type raw (incase of user scan and compaction).  So we may have to lose the information if the scan has already been attached with the families and qualifiers that needs to be retrieved.&lt;/p&gt;</comment>
                            <comment id="13984189" author="ram_krish" created="Tue, 29 Apr 2014 10:46:43 +0000"  >&lt;p&gt;Found a bug while testing with shells.  Will fix and update the patch soon.&lt;/p&gt;</comment>
                            <comment id="13984211" author="ram_krish" created="Tue, 29 Apr 2014 11:32:01 +0000"  >&lt;p&gt;Fixes the bug, when two deleteFamilies are issued , first with a lower timestamp and next with a higher timestamp.  The delete tombstone of the higher one should be applied and the visibility expression of the higher should be considered and mask based on that rather than considering the visibility expression of the delete family with lower timestamp.&lt;/p&gt;</comment>
                            <comment id="13984487" author="yuzhihong@gmail.com" created="Tue, 29 Apr 2014 16:51:18 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * Add the specified KeyValue to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; Delete operation.  Operation assumes that
+   * the passed Cell is immutable and its backing array will not be modified
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;KeyValue appears in first line and Cell in second. Better make the terms consistent.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!KeyValue.isDelete(kv.getTypeByte())) {
+      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; WrongRowIOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;The cell &quot;&lt;/span&gt; + kv.toString() + &lt;span class=&quot;code-quote&quot;&gt;&quot;is not of Delete type&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Would IllegalArgumentException be more appropriate above ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isDeleteColumn(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Cell cell) {
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; cell.getTypeByte() == Type.Delete.getCode();
+  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In KeyValue, the above comparison is in a method called isDeleteType().&lt;/p&gt;

&lt;p&gt;In VisibilityController#preDelete():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], List&amp;lt;Cell&amp;gt;&amp;gt; e : delete.getFamilyCellMap().entrySet()) {
+      &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] family = e.getKey();
+      List&amp;lt;Cell&amp;gt; cells = e.getValue();
+      Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt; kvCount = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TreeMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;(Bytes.BYTES_COMPARATOR);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The tree map can be reused across iterations, right ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!matchFound &amp;amp;&amp;amp; isDeleteLatest) {
+/*        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;No matching cell with given visibility expression found &quot;&lt;/span&gt;
+            + delete);*/
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;What&apos;s your plan for the above comment ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class VisibilityScanDeleteTracker &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; ScanDeleteTracker {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Add annotation for audience.&lt;/p&gt;

&lt;p&gt;Putting patch on review board would be nice.&lt;/p&gt;</comment>
                            <comment id="13984830" author="hadoopqa" created="Tue, 29 Apr 2014 21:37:36 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12642441/HBASE-10885_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12642441/HBASE-10885_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12642441&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.security.visibility.TestVisibilityLabels&lt;br/&gt;
                  org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelsOpWithDifferentUsersNoACL&lt;br/&gt;
                  org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelsWithDistributedLogReplay&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9426//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13985030" author="apurtell" created="Wed, 30 Apr 2014 01:17:19 +0000"  >&lt;p&gt;Will review patch after we have a clean run of o.a.h.h.security.visibility.* tests.&lt;/p&gt;</comment>
                            <comment id="13985034" author="apurtell" created="Wed, 30 Apr 2014 01:22:36 +0000"  >&lt;p&gt;Rolling the 0.98.2 RC0 tommorrow. This looks almost ready but not quite. No problem, making a blocker for 0.98.3, we can get in in there for sure. The integration test for deletes-with-visibility is slotted for 0.98.3 anyhow.&lt;/p&gt;</comment>
                            <comment id="13985141" author="ram_krish" created="Wed, 30 Apr 2014 04:05:20 +0000"  >&lt;p&gt;Corrected the patch and now all cases passes.&lt;/p&gt;</comment>
                            <comment id="13985310" author="ram_krish" created="Wed, 30 Apr 2014 09:21:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/20887/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/20887/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13985765" author="ram_krish" created="Wed, 30 Apr 2014 17:16:44 +0000"  >&lt;p&gt;What should be the behaviour in this case&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
put &apos;t1&apos;,&apos;r1&apos;,&apos;f1:c1&apos;,&apos;100&apos;,101,{VISIBILITY=&amp;gt;&apos;PRIVATE|SECRET&apos;}
put &apos;t1&apos;,&apos;r1&apos;,&apos;f1:c1&apos;,&apos;100&apos;,102,{VISIBILITY=&amp;gt;&apos;PRIVATE&apos;}
put &apos;t1&apos;,&apos;r1&apos;,&apos;f1:c1&apos;,&apos;100&apos;,103,{VISIBILITY=&amp;gt;&apos;(SECRET&amp;amp;TOPSECRET)|(PRIVATE&amp;amp;CONFIDENTIAL)&apos;}
put &apos;t1&apos;,&apos;r1&apos;,&apos;f1:c1&apos;,&apos;100&apos;,104,{VISIBILITY=&amp;gt;&apos;(SECRET&amp;amp;TOPSECRET)&apos;}
put &apos;t1&apos;,&apos;r1&apos;,&apos;f1:c1&apos;,&apos;100&apos;,105,{VISIBILITY=&amp;gt;&apos;(SECRET&amp;amp;TOPSECRET)|(PRIVATE&amp;amp;CONFIDENTIAL)&apos;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now if we issue a deleteColumn with specific timestamp for ts = 104 and visibility=(SECRET&amp;amp;TOPSECRET). Then cell with ts=104 gets deleted.&lt;br/&gt;
Now if there is a deleteFamily issued with ts = 103 and visibility = (SECRET&amp;amp;TOPSECRET)|(PRIVATE&amp;amp;CONFIDENTIAL) now should we delete cells from 103 to 101 and also the cell at 104 caused by the first deleteColumn?&lt;br/&gt;
In case of cells without visibility the behaviour is finally only the cell with 105 is available and others are deleted.&lt;br/&gt;
In such cases should we need to track the visibility expression per ts.  It is possible but in case of cases where the number of versions are more then this tracking would be a bit of an overhead. Thoughts? All these cases happens when things are in memstore and no flushes/compactions.&lt;/p&gt;</comment>
                            <comment id="13986315" author="anoop.hbase" created="Thu, 1 May 2014 03:09:03 +0000"  >&lt;p&gt;Yes as u said , without vis exp  the delete will remove all cells except ts=105&lt;br/&gt;
With vis exp in delete, the exact version delete should delete cell ts=104 as the vis exps are matching. For deleteFamily case all cells with ts &amp;lt;=103 are candidates for delete but u can see only one cell with ts=103 is having matching vis exp withh that in the delete cell. Cells with ts 102 and 101 are not having matching vis exps and so should not be getting deleted. &lt;/p&gt;</comment>
                            <comment id="13986319" author="ram_krish" created="Thu, 1 May 2014 03:17:11 +0000"  >&lt;p&gt;In the current case only one gets applied.  So need to track the vis expression based on ts.&lt;br/&gt;
One more thing to note here is &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;For deleteFamily case all cells with ts &amp;lt;=103 are candidates for delete&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Here because deleteFamily with ts = 103 satisfies the condition I think from that cell onwards all the cells less than 103 should also be covered because it is deleteFamily.  If it is deleteFamilyVersion then we need to check for exact match only.  But here I think once we find the cell with matching visibility expression the ones below that also should get deleted.&lt;br/&gt;
Which means if a deleteFamily says ts = 103 and assume in this case the ts =101 only matches the vis expression then from 101 on wards all cells less than 101 should be masked.&lt;/p&gt;</comment>
                            <comment id="13986320" author="ram_krish" created="Thu, 1 May 2014 03:19:17 +0000"  >&lt;p&gt;Let me change the code to track the visibility expression per ts.&lt;/p&gt;</comment>
                            <comment id="13993976" author="hadoopqa" created="Fri, 9 May 2014 22:07:33 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12644102/HBASE-10885_new_tag_type_1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12644102/HBASE-10885_new_tag_type_1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12644102&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 2 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +  // Latest_timestamp.  In such cases the ts in the delete marker and the masking put will not be same.&lt;br/&gt;
+  // and also ensure that the combination of different type of deletes with diff ts would also work fine&lt;br/&gt;
+            d.setCellVisibility(new CellVisibility(&quot;(&quot; + CONFIDENTIAL + &quot;&amp;amp;&quot; + PRIVATE + &quot;)|(&quot; + TOPSECRET&lt;br/&gt;
+  public void testDeleteColumnAndDeleteFamilylSpecificTimeStampWithMulipleVersion() throws Exception {&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestMultiParallel&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestEncryptionKeyRotation&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9493//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13996785" author="anoop.hbase" created="Tue, 13 May 2014 19:05:53 +0000"  >&lt;p&gt;Left some comments in RB. Review is not over. Will complete it soon.&lt;/p&gt;</comment>
                            <comment id="13999428" author="hadoopqa" created="Thu, 15 May 2014 23:57:41 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12644400/HBASE-10885_new_tag_type_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12644400/HBASE-10885_new_tag_type_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12644400&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 58 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 2 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestAssignmentManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9516//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13999717" author="ram_krish" created="Fri, 16 May 2014 10:06:49 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
58 warnings
[WARNING] Javadoc Warnings
[WARNING] javadoc: warning - Multiple sources of &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; comments found &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.hadoop.hbase.io.hfile&quot;&lt;/span&gt;
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java:120: warning - Tag @link: reference not found: BUCKET_CACHE_COMBINED_KEY
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java:88: warning - Tag @link: reference not found: BUCKET_CACHE_SIZE_KEY
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java:99: warning - Tag @link: reference not found: BUCKET_CACHE_COMBINED_KEY
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java:99: warning - Tag @link: reference not found: BUCKET_CACHE_COMBINED_PERCENTAGE_KEY
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CacheConfig.java:120: warning - Tag @link: reference not found: BUCKET_CACHE_COMBINED_KEY
[WARNING] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/io/hfile/CombinedBlockCache.java:40: warning - Missing closing &apos;}&apos; character &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; inline tag: &quot;{@link #getBlock(BlockCacheKey, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;) reads
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is not part of the patch.&lt;/p&gt;</comment>
                            <comment id="14004830" author="apurtell" created="Wed, 21 May 2014 16:02:34 +0000"  >&lt;p&gt;Move to 0.98.4. This is about ready but there is shell support and integration test related issues that should go in at the same time. Unlikely all will make the train for .3 but likely all will make it for .4.&lt;/p&gt;</comment>
                            <comment id="14011343" author="ram_krish" created="Wed, 28 May 2014 17:24:01 +0000"  >&lt;p&gt;Patch based on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11126&quot; title=&quot;Add RegionObserver pre hooks that operate under row lock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11126&quot;&gt;&lt;del&gt;HBASE-11126&lt;/del&gt;&lt;/a&gt;. Can rebase once again after it gets committed.&lt;/p&gt;</comment>
                            <comment id="14018456" author="ram_krish" created="Thu, 5 Jun 2014 03:56:41 +0000"  >&lt;p&gt;Updated patch after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11126&quot; title=&quot;Add RegionObserver pre hooks that operate under row lock&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11126&quot;&gt;&lt;del&gt;HBASE-11126&lt;/del&gt;&lt;/a&gt; went in.  Tested the patch with an IT case that am working on internally.  Will also add the IT patch once it is tested fully.&lt;br/&gt;
Will add it to the RB also.&lt;/p&gt;</comment>
                            <comment id="14018503" author="hadoopqa" created="Thu, 5 Jun 2014 05:57:43 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12648430/HBASE-10885_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12648430/HBASE-10885_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12648430&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportTSVWithVisibilityLabels&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): &lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14018535" author="ram_krish" created="Thu, 5 Jun 2014 06:46:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;org.apache.hadoop.hbase.mapreduce.TestImportTSVWithVisibilityLabels&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I tried running this on 0.98 it passed.  Let me check with trunk. &lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9696//testReport/&lt;/a&gt; - does not have the test reports like we used to have.&lt;/p&gt;</comment>
                            <comment id="14019673" author="ram_krish" created="Fri, 6 Jun 2014 08:34:51 +0000"  >&lt;p&gt;The TestImportTSVWithVisibilityLabels seems to pass even in trunk. wil resubmit again to see if it is an actual issue.&lt;/p&gt;</comment>
                            <comment id="14019739" author="hadoopqa" created="Fri, 6 Jun 2014 10:37:35 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12648616/HBASE-10885_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12648616/HBASE-10885_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12648616&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.mapreduce.TestTableMapReduceBase.testMultiRegionTable(TestTableMapReduceBase.java:96)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9704//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14019870" author="stack" created="Fri, 6 Jun 2014 14:15:49 +0000"  >&lt;p&gt;I&apos;ve not seen TestTableMapReduceBase.testMultiRegionTable( failing recently....  Let me retry the patch.&lt;/p&gt;</comment>
                            <comment id="14019871" author="stack" created="Fri, 6 Jun 2014 14:16:26 +0000"  >&lt;p&gt;Retry&lt;/p&gt;</comment>
                            <comment id="14019960" author="hadoopqa" created="Fri, 6 Jun 2014 15:58:59 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12648643/HBASE-10885_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12648643/HBASE-10885_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12648643&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9705//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14020626" author="apurtell" created="Sat, 7 Jun 2014 01:31:34 +0000"  >&lt;p&gt;Test results look good.&lt;/p&gt;

&lt;p&gt;Minor stuff.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git hbase-common/src/main/java/org/apache/hadoop/hbase/TagType.java hbase-common/src/main/java/org/apache/hadoop/hbase/TagType.java
index 6c43c78..6e79038 100644
--- hbase-common/src/main/java/org/apache/hadoop/hbase/TagType.java
+++ hbase-common/src/main/java/org/apache/hadoop/hbase/TagType.java
@@ -27,4 +27,5 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; class TagType {
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; ACL_TAG_TYPE = (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 1;
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; VISIBILITY_TAG_TYPE = (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 2;
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; LOG_REPLAY_TAG_TYPE = (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) 3;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; VISBILITY_EXP_SERIALIZATION_FORMAT = (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;)4;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Misspelled. Also, can we use a better name for this? Everything else is named foo_TAG_TYPE.&lt;/p&gt;

&lt;p&gt;When you write that new tag e.g. in VisibilityController#createVisibilityTags you are doing this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// Add &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; tag type
&lt;/span&gt;+    tags.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Tag(VisibilityUtils.VISBILITY_EXP_SERIALIZATION_FORMAT,
+        HConstants.EMPTY_BYTE_ARRAY));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The tag is empty (length 0) - doesn&apos;t seem right. Later checks for whether the serialization format has sorted ordinals or not use the presence of this tag as definitive, e.g.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(tag.getType() == VisibilityUtils.VISBILITY_EXP_SERIALIZATION_FORMAT) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That doesn&apos;t seem right either. The intent is versioning the serialization format. Therefore let&apos;s version it, with an integer value, and test the value. &lt;/p&gt;

&lt;p&gt;Comments in VisibilityScanDeleteTracker are good.&lt;/p&gt;

&lt;p&gt;Many unit tests, representing the bulk of the patch, good.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Tested the patch with an IT case that am working on internally. Will also add the IT patch once it is tested fully. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;But not in the v2 patch, right? So that will be in v3?&lt;/p&gt;</comment>
                            <comment id="14021663" author="ram_krish" created="Mon, 9 Jun 2014 06:26:59 +0000"  >&lt;p&gt;Thanks for the reviews. Updated patch addressing the comments.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;But not in the v2 patch, right? So that will be in v3?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I meant that once my IT is ready will attach it in the relevant JIRA. Not along with this patch. &lt;/p&gt;</comment>
                            <comment id="14021732" author="hadoopqa" created="Mon, 9 Jun 2014 08:11:08 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12648921/HBASE-10885_v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12648921/HBASE-10885_v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12648921&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 2 zombie test(s): 	at org.apache.hadoop.hbase.regionserver.TestHRegion.testWritesWhileGetting(TestHRegion.java:3499)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.TestHRegion.testWritesWhileGetting(TestHRegion.java:3500)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9723//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14027509" author="ram_krish" created="Wed, 11 Jun 2014 07:27:12 +0000"  >&lt;p&gt;Any more comments on this patch? &lt;/p&gt;</comment>
                            <comment id="14027971" author="anoop.hbase" created="Wed, 11 Jun 2014 16:24:25 +0000"  >&lt;p&gt;Can you put the latest patch in RB?&lt;/p&gt;</comment>
                            <comment id="14028975" author="anoop.hbase" created="Thu, 12 Jun 2014 09:43:01 +0000"  >&lt;p&gt;Copying the discussion from RB to here because it will get better attention &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If suppose there are no tags in the delete cell, but the Cell that is getting covered by the delete has a Tag, then we should not delete the cell right?  If that cell also does not have the tag then it is ok to consider it deleted as per the case.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No. IMO no need to go this way. visibility tags might be there with put cells. This was done to control the visibility across different users. But delete can be like normal delete as today. A delete is issued and it is not having vis exp in it. Means all the cells covered by that tombstone must be deleted (irrespective of whether the put cells having tags or not).  Issuing deletes with vis exp in it is special kind of deletion. There only do the matching of the exps and only the exp matching put cells can be deleted.&lt;/p&gt;

&lt;p&gt;So in the isDeleted() check the existing logic can still be good here in your new DeleteTracker impl. Under every case, have extra check for vis exp matching also. (When the delete tombstone under consideration was having a vis exp in it.)&lt;/p&gt;

&lt;p&gt;Correct me if I am wrong &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14028985" author="anoop.hbase" created="Thu, 12 Jun 2014 10:05:41 +0000"  >&lt;p&gt;In 98.3 we allow the puts to have the vis exp in it.  When a user issue delete, it will delete all covered cells (irrespective of whether the put cells having tags in it or not).  This way it works till 98.3 Now in 98.4 we will change this behavior. Is that okey?&lt;/p&gt;</comment>
                            <comment id="14028994" author="ram_krish" created="Thu, 12 Jun 2014 10:17:52 +0000"  >&lt;p&gt;We have this special case of visibility expression matching just to ensure that we try to delete only the matching visibility tag, if again we do the normal way of deleting also then may be we are not giving accumulo type of behaviour?&lt;br/&gt;
AnyPut is considered to be tagged with a visibility and so only a matching delete should be used a tombstone I feel. BC break, in my perspective here is that may be we are adding this functionality to define Delete behaviour correctly in terms of Visibility exp.&lt;br/&gt;
Then for delete family also if once a visibiity expression matches.. from there we could delete all the cells less that that particular version. That also defines the right behaviour in terms of delete family combined with visibility exp. In the current patch we only delete matching cells that are less than the given ts.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;This way it works till 98.3 Now in 98.4 we will change this behavior. Is that okey?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If we just give the old behaviour also then there is no point in all these changes and this code should go only in major release only. &lt;/p&gt;

</comment>
                            <comment id="14029478" author="apurtell" created="Thu, 12 Jun 2014 17:38:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;In 98.3 we allow the puts to have the vis exp in it. When a user issue delete, it will delete all covered cells (irrespective of whether the put cells having tags in it or not). This way it works till 98.3 Now in 98.4 we will change this behavior.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. &lt;/p&gt;

&lt;p&gt;What we should accomplish with this patch are two objectives:&lt;br/&gt;
1) Support deletes with user specified visibility expressions (if they have the authorizations)&lt;br/&gt;
2) Do not allow users without visibility from covering cells with tombstones, effectively.&lt;/p&gt;

&lt;p&gt;#2 is the semantic change from earlier versions.&lt;/p&gt;

&lt;p&gt;From 0.98.0 we have been communicating at every opportunity that these features are experimental until 1.0.  If there are still concerns or objections for this kind of change, we can guard the new behavior with a configuration toggle as a bridge from earlier 0.98 releases to 1.0.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;If suppose there are no tags in the delete cell, but the Cell that is getting covered by the delete has a Tag, then we should not delete the cell right? If that cell also does not have the tag then it is ok to consider it deleted as per the case.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This isn&apos;t quite right though. If there are no tags in the delete cell, but the cell that is covered by the delete has a &lt;em&gt;visibility expression&lt;/em&gt; tag, then we need to check if the effective auths of the user who issued the delete grant visibility to the covered cell. Only if true do we delete it. If the covered cell has no visibility expression tag it is ok to delete (cells without visibility expressions evaluate is visible to everyone)&lt;/p&gt;

&lt;p&gt;What do you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14030338" author="ram_krish" created="Fri, 13 Jun 2014 07:10:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;then we need to check if the effective auths of the user who issued the delete grant visibility to the covered cell. Only if true do we delete it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Oh.. Then this becomes more complex.  So not only the cell visibility associated with the delete needs to be considered, in cases that is not present then go with the Auths defined in the labels table? In that sense I feel passing Cell visibility itself is not needed right?  Apply deletes only based on the Auths associated with the user issuing the delete. Also if this behaviour we need not only we need to match the exact labels but also do as in Scan and find out if the labels in the cell is a subset of the auths and then decide the delete behaviour.   &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;#2 is the semantic change from earlier versions.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I agree that we can change the semantics without which we are not allowing the deletes to function properly.&lt;br/&gt;
I was testing more scenarios today and ended up in more tricky situations&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
put &apos;t1&apos;,&apos;r1&apos;,&apos;f1:c1&apos;,&apos;100&apos;,101,{VISIBILITY=&amp;gt;&apos;PRIVATE|SECRET&apos;}
put &apos;t1&apos;,&apos;r1&apos;,&apos;f1:c1&apos;,&apos;100&apos;,102,{VISIBILITY=&amp;gt;&apos;PRIVATE&apos;}
put &apos;t1&apos;,&apos;r1&apos;,&apos;f1:c1&apos;,&apos;100&apos;,103,{VISIBILITY=&amp;gt;&apos;(SECRET&amp;amp;TOPSECRET)|(PRIVATE&amp;amp;CONFIDENTIAL)&apos;}
put &apos;t1&apos;,&apos;r1&apos;,&apos;f1:c1&apos;,&apos;100&apos;,104,{VISIBILITY=&amp;gt;&apos;(SECRET&amp;amp;TOPSECRET)&apos;}
put &apos;t1&apos;,&apos;r1&apos;,&apos;f1:c1&apos;,&apos;100&apos;,105,{VISIBILITY=&amp;gt;&apos;(SECRET&amp;amp;TOPSECRET)|(PRIVATE&amp;amp;CONFIDENTIAL)&apos;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now issue these two deletes&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
delete_column_timeStamp &apos;t1&apos;,&apos;r1&apos;,&apos;f1:c1&apos;,104,&apos;SECRET&amp;amp;TOPSECRET&apos;
delete_familyversion &apos;t1&apos;,&apos;r1&apos;,&apos;f1:c1&apos;,103,&apos;(CONFIDENTIAL&amp;amp;PRIVATE)|(TOPSECRET&amp;amp;SECRET)&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now when we do&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
delete_family &apos;t1&apos;,&apos;r1&apos;,&apos;f1&apos;,&apos;PRIVATE|SECRET&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then we are bound to get back all the previously deleted cells also as per the current patch because DELETE_FAMILY being a higher precedence we don check for lower types of deletes and only match the visibility labels for those cells with PRIVATE|SECRET and this makes already deleted cells to reappear.&lt;/p&gt;</comment>
                            <comment id="14030597" author="ram_krish" created="Fri, 13 Jun 2014 13:03:42 +0000"  >&lt;p&gt;Latest patch updating the comments.  The delete family related issue is solved.  &lt;br/&gt;
The delete cells with and without Visibility tags is not yet handled. I think we could discuss and then proceed on that.&lt;/p&gt;</comment>
                            <comment id="14030705" author="hadoopqa" created="Fri, 13 Jun 2014 15:06:51 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12650293/HBASE-10885_v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12650293/HBASE-10885_v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12650293&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestMultiParallel&lt;br/&gt;
                  org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelsWithDeletes&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.regionserver.TestHRegion.testWritesWhileGetting(TestHRegion.java:3499)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9766//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14031793" author="ram_krish" created="Sun, 15 Jun 2014 06:24:26 +0000"  >&lt;p&gt;Not sure why this &lt;br/&gt;
org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelsWithDeletes&lt;br/&gt;
failed.  Seems to pass always. Not able to see the reports over there.  Let me resubmit once again to know if I uploaded a wrong patch.&lt;/p&gt;</comment>
                            <comment id="14031806" author="hadoopqa" created="Sun, 15 Jun 2014 08:07:57 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12650472/HBASE-10885_v5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12650472/HBASE-10885_v5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12650472&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelsWithDeletes&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14032195" author="ram_krish" created="Mon, 16 Jun 2014 07:36:55 +0000"  >&lt;p&gt;The reason for the test failure is due to the presence of an assert stmt in VisisbilityScanDeleteTracker - the scenario is possible now.  Now the test case passes though the same was passing in my IDE as there was no assertion enabled.&lt;br/&gt;
Will upload a new patch after some internal discussions are updated in the patch (after finalising).&lt;/p&gt;</comment>
                            <comment id="14032366" author="anoop.hbase" created="Mon, 16 Jun 2014 11:54:12 +0000"  >&lt;p&gt;We can&apos;t see the test failure report in the link. Actually it gives 404 error..&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9775//testReport/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It got broken recently. Any one having some idea?&lt;/p&gt;</comment>
                            <comment id="14032626" author="yuzhihong@gmail.com" created="Mon, 16 Jun 2014 16:49:15 +0000"  >&lt;p&gt;I can access above URL:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Tests in error: 
  testVisibilityExpressionWithNotEqualORCondition(org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelsWithDeletes): Failed after retry of OutOfOrderScannerNextException: was there a rpc timeout?
  testDeleteColumnSpecificTimeStampWithMulipleVersionsDoneTwice2(org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelsWithDeletes): Failed after retry of OutOfOrderScannerNextException: was there a rpc timeout?
  testDeleteColumnWithSpecificTimeStampUsingMultipleVersionsUnMatchingVisExpression(org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelsWithDeletes): Failed after retry of OutOfOrderScannerNextException: was there a rpc timeout?
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14032634" author="yuzhihong@gmail.com" created="Mon, 16 Jun 2014 16:57:03 +0000"  >&lt;p&gt;Test output from QA run.&lt;/p&gt;</comment>
                            <comment id="14032639" author="ram_krish" created="Mon, 16 Jun 2014 17:04:45 +0000"  >&lt;p&gt;I already saw that in my local machine and corrected the patch.  That was due to an assertion that was added in the code.  I have corrected it but as I said we are working on some more things.  Once it is finalised I will update the patch.  Any way after removing the assertion the failed cases passes.&lt;/p&gt;</comment>
                            <comment id="14033061" author="apurtell" created="Mon, 16 Jun 2014 21:55:38 +0000"  >&lt;blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This isn&apos;t quite right though. If there are no tags in the delete cell, but the cell that is covered by the delete has a visibility expression tag, then we need to check if the effective auths of the user who issued the delete grant visibility to the covered cell. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Oh.. Then this becomes more complex. So not only the cell visibility associated with the delete needs to be considered, in cases that is not present then go with the Auths defined in the labels table? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That&apos;s a good point. We may be getting ahead of ourselves here. &lt;/p&gt;

&lt;p&gt;Let us separate mechanism and policy considerations.&lt;/p&gt;

&lt;p&gt;For mechanism, we have a goal like: IF a delete operation has a visibility expression associated with it, then the tombstone we lay down should be tagged with that visibility expression for later evaluation during delete tracking.  A visibility expression defines the auths needed to see the mutation. A delete mutation is the negation of a put.  Therefore, any cells with visibility expressions that match or are a subset of the expression on the tombstone should be removed by the delete tracker.&lt;/p&gt;

&lt;p&gt;For policy, we have considerations like whether or not to validate if the visibility expression supplied by a user contains only labels from their effective auth set. &lt;/p&gt;

&lt;p&gt;So why not separate the two for sake of discussion and completing this issue?&lt;/p&gt;

&lt;p&gt;If we separate mechanism from policy, then we can complete this issue by implementing visibility expression based delete tracking but not the other stuff I started talking about like checking if the effective auths of the user who issued the delete allow them to use all of the labels in the expression. It also means that visibility expression based filtering during deletes can be bypassed by a user just issuing a delete with no expression. However, that&apos;s fine if the goal is providing mechanisms for higher layers to use. It only becomes a problem if, after finishing this issue, we then debate whether we should check on all mutations if the labels supplied are in the auth set of the user....&lt;/p&gt;</comment>
                            <comment id="14034900" author="ram_krish" created="Wed, 18 Jun 2014 06:56:03 +0000"  >&lt;p&gt;Updated patch.  Addressing the review comments.  &lt;br/&gt;
The idea of checking with the user&apos;s auth for a given mutation before applying the mutation and if the deletes does not have a cell visibility checking for the user&apos;s auth issuing the delete and based on that decide the covering cells will be done in a follow up issue.&lt;/p&gt;</comment>
                            <comment id="14035521" author="hadoopqa" created="Wed, 18 Jun 2014 09:43:17 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12650978/HBASE-10885_v7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12650978/HBASE-10885_v7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12650978&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestMasterNoCluster&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestHRegion&lt;br/&gt;
                  org.apache.hadoop.hbase.snapshot.TestFlushSnapshotFromClient&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9788//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14041694" author="ram_krish" created="Tue, 24 Jun 2014 05:07:20 +0000"  >&lt;p&gt;Ping!!&lt;/p&gt;</comment>
                            <comment id="14041702" author="anoop.hbase" created="Tue, 24 Jun 2014 05:25:33 +0000"  >&lt;p&gt;Will review today Ram.  Sorry for the delay.&lt;/p&gt;</comment>
                            <comment id="14042029" author="anoop.hbase" created="Tue, 24 Jun 2014 12:17:16 +0000"  >&lt;p&gt;Done. Added some comments in RB.&lt;/p&gt;</comment>
                            <comment id="14042845" author="apurtell" created="Tue, 24 Jun 2014 23:33:33 +0000"  >&lt;p&gt;Sorry Ram. &lt;/p&gt;

&lt;p&gt;Anoop added good comments. I added a couple complimentary ones.&lt;/p&gt;</comment>
                            <comment id="14043344" author="ram_krish" created="Wed, 25 Jun 2014 11:26:49 +0000"  >&lt;p&gt;Updated patch addressing all the comments in the RB.  &lt;/p&gt;</comment>
                            <comment id="14044415" author="ram_krish" created="Thu, 26 Jun 2014 07:27:52 +0000"  >&lt;p&gt;Latest patch.  There is one change in the Visibility Delete Tracker where multiple family delete are handled by tracking those time stamps and also multiple delete columns are also handled.  I think this covers all the cases and the cases have been verified running the IT test case that will be attached in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11039&quot; title=&quot;[VisibilityController] Integration test for labeled data set mixing and filtered excise&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11039&quot;&gt;&lt;del&gt;HBASE-11039&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14044416" author="ram_krish" created="Thu, 26 Jun 2014 07:29:52 +0000"  >&lt;p&gt;One round of review on the VisisbilityDeleteTracker would be great before committing this.&lt;/p&gt;</comment>
                            <comment id="14045505" author="anoop.hbase" created="Fri, 27 Jun 2014 04:20:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;One round of review on the VisisbilityDeleteTracker would be great before committing this.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Good testing Ram. U found the missing scenario we missed in reviews also..&lt;/p&gt;

&lt;p&gt;Looking at this VisisbilityDeleteTracker  I think still need changes.&lt;br/&gt;
I think for every delete type u have to track TS vs vis exp.&lt;br/&gt;
In normal case, for family delete, the latest TS only we need to track and delete all under that TS.&lt;br/&gt;
Now with vis exp also in place, the combination of TS + vis exp us becoming something based on which the decision of whether cell is deleted or not is calculated.&lt;br/&gt;
So in this tracking if same family comes and vis exp is different you have to track that TS vs vis exp.  And if again same family comes wih same as previous vis exp, just ignore (As the second one TS will be lower. We need consider the higher TS value)&lt;/p&gt;

&lt;p&gt;Similar way for all types we will need track.&lt;/p&gt;

&lt;p&gt;Things are bit complex &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14045870" author="ram_krish" created="Fri, 27 Jun 2014 11:50:18 +0000"  >&lt;p&gt;Adds cases where a put reappears with already deleted vis exp. Thanks Anoop for the review.&lt;/p&gt;</comment>
                            <comment id="14046732" author="ram_krish" created="Sat, 28 Jun 2014 05:17:08 +0000"  >&lt;p&gt;REsubmitting&lt;/p&gt;</comment>
                            <comment id="14046841" author="ram_krish" created="Sat, 28 Jun 2014 12:21:31 +0000"  >&lt;p&gt;Final review before commit pls?&lt;/p&gt;</comment>
                            <comment id="14047047" author="ram_krish" created="Sun, 29 Jun 2014 03:50:16 +0000"  >&lt;p&gt;Ping!!!&lt;/p&gt;</comment>
                            <comment id="14047060" author="anoop.hbase" created="Sun, 29 Jun 2014 05:43:19 +0000"  >&lt;p&gt;Give me a day time Ram. Busy with another patch.&lt;/p&gt;</comment>
                            <comment id="14047076" author="anoop.hbase" created="Sun, 29 Jun 2014 08:20:07 +0000"  >&lt;p&gt;One more quick comment&lt;br/&gt;
Check for the new tag type (ie. the Serialization format tag type) also in the VC reserved tags check.&lt;/p&gt;

&lt;p&gt;Will check new ScanDeleteTracker code once again.&lt;/p&gt;</comment>
                            <comment id="14047625" author="ram_krish" created="Mon, 30 Jun 2014 12:57:47 +0000"  >&lt;p&gt;Updated the comment regarding the REserved tags.  And to be on the safer side using Map&amp;lt;Long,List&amp;lt;Tag&amp;gt;&amp;gt; for the delete column specific version.&lt;/p&gt;</comment>
                            <comment id="14047627" author="ram_krish" created="Mon, 30 Jun 2014 12:58:26 +0000"  >&lt;p&gt;If i get +1s - I will commit later today/tomorrow.&lt;/p&gt;</comment>
                            <comment id="14047679" author="hadoopqa" created="Mon, 30 Jun 2014 14:07:07 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12653152/HBASE-10885_v13.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12653152/HBASE-10885_v13.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12653152&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to cause Findbugs (version 1.3.9) to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +    // TODO : See if HRegion.updateDeleteLatestVersionTimeStamp() could be called only if the hook is&lt;br/&gt;
+    // We are creating a new type of delete tracker here which is able to track the timestamps and also the&lt;br/&gt;
+    // visibility tags per cell. The covering cells are determined not only based on the delete type and ts&lt;br/&gt;
+  public void testVisibilityLabelsWithDeleteColumnsWithNoMatchVisExpWithMultipleVersionsNoTimestamp()&lt;br/&gt;
+  public void testVisibilityLabelsWithDeleteFamilyWithNoMatchingVisExpWithMultipleVersionsNoTimestamp()&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.http.TestSSLHttpServer&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9891//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9891//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9891//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9891//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14047861" author="anoop.hbase" created="Mon, 30 Jun 2014 17:13:00 +0000"  >&lt;p&gt;VisibilityScanDeleteTracker#add()&lt;br/&gt;
For the deleteColumns case and delete column versions, We keep on extracting tags and add to a List.  This List is cleared only on reset() which is called only when a row changes..   &lt;br/&gt;
But we need to reset these 2 Lists when the column (cf:q) changes.&lt;/p&gt;</comment>
                            <comment id="14047875" author="ram_krish" created="Mon, 30 Jun 2014 17:23:57 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        deleteBuffer = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+        visibilityTagsDeleteColumns = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+        visiblityTagsDeleteColumnVersion = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It is reset here also when the column qualifier changes.&lt;/p&gt;</comment>
                            <comment id="14048803" author="hadoopqa" created="Tue, 1 Jul 2014 12:21:24 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12653366/HBASE-10885_v15.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12653366/HBASE-10885_v15.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12653366&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 13 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 2 zombie test(s): 	at org.apache.hadoop.hdfs.server.namenode.TestCheckpoint.testSecondaryFailsWithErrorBeforeSettingHeaders(TestCheckpoint.java:570)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.TestHRegion.testWritesWhileGetting(TestHRegion.java:3500)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9920//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14049382" author="apurtell" created="Tue, 1 Jul 2014 22:21:04 +0000"  >&lt;p&gt;This is a blocker for 0.98 but should not go in here before commit to 1.0. Please ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; when ready. &lt;/p&gt;</comment>
                            <comment id="14049628" author="ram_krish" created="Wed, 2 Jul 2014 05:04:15 +0000"  >&lt;p&gt;Sure.  Its in the final stages of review.  We got lot of new scenarios while reviewing and also while fixing one we got new types of combinations.&lt;br/&gt;
Some small minor logical changes were suggested by Anoop on the final review.  Just discussing them if the changes (if we make it or not) are fine then we can commit it later today EOD my time.  Also Anoop is on travel now so once he finalises the patch we can be ready for commit.&lt;/p&gt;</comment>
                            <comment id="14050939" author="anoop.hbase" created="Thu, 3 Jul 2014 01:01:47 +0000"  >&lt;p&gt;+1 for the latest patch in RB&lt;br/&gt;
nit :  Pls add private Interface audience to VisibilityScanDeleteTracker.  Can fix on commit.&lt;/p&gt;

&lt;p&gt;Thanks for the efforts and great work Ram.&lt;/p&gt;</comment>
                            <comment id="14051008" author="ram_krish" created="Thu, 3 Jul 2014 02:53:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;&lt;br/&gt;
Can this be committed to branch 1.0 also?  Waiting for your nod.  Only later I will commit to 0.98.&lt;/p&gt;</comment>
                            <comment id="14051060" author="ram_krish" created="Thu, 3 Jul 2014 04:42:01 +0000"  >&lt;p&gt;Latest patch addressing all the comments. Added new test case for the ImportTSV case so that after loading thro MR we can verify the deletes also. This is what I will be committing.  &lt;br/&gt;
In the previous QA run it shows 13 find bugs.  I am not able to see that link.  I ran mvn package findbugs:findbugs and saw the XML but inferring from them is bit difficult becuase it shows line that was not added by this patch also. For eg,&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
instanceOccurrenceNum=&apos;0&apos; priority=&apos;2&apos; abbrev=&apos;IS&apos; type=&apos;IS2_INCONSISTENT_SYNC&apos; instanceOccurrenceMax=&apos;0&apos;&amp;gt;&amp;lt;ShortMessage&amp;gt;Inconsistent synchronization&amp;lt;/ShortMessage&amp;gt;&amp;lt;LongMessage&amp;gt;Inconsistent synchronization of org.apache.hadoop.hbase.security.visibility.VisibilityController.regionEnv; locked 62% of time&amp;lt;/LongMessage&amp;gt;&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; classname=&apos;org.apache.hadoop.hbase.security.visibility.VisibilityController&apos; primary=&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;&amp;gt;&amp;lt;SourceLine start=&apos;132&apos; classname=&apos;org.apache.hadoop.hbase.security.visibility.VisibilityController&apos; sourcepath=&apos;org/apache/hadoop/hbase/security/visibility/VisibilityController.java&apos; sourcefile=&apos;VisibilityController.java&apos; end=&apos;1501&apos;&amp;gt;&amp;lt;Message&amp;gt;At VisibilityController.java:[lines 132-1501]&amp;lt;/Message&amp;gt;&amp;lt;/SourceLine&amp;gt;&amp;lt;Message&amp;gt;In class org.apache.hadoop.hbase.security.visibility.VisibilityController&amp;lt;/Message&amp;gt;&amp;lt;/&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;gt;&amp;lt;Field isStatic=&apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos; classname=&apos;org.apache.hadoop.hbase.security.visibility.VisibilityController&apos; name=&apos;regionEnv&apos; primary=&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos; signature=&apos;Lorg/apache/hadoop/hbase/coprocessor/RegionCoprocessorEnvironment;&apos;&amp;gt;&amp;lt;SourceLine classname=&apos;org.apache.hadoop.hbase.security.visibility.VisibilityController&apos; sourcepath=&apos;org/apache/hadoop/hbase/security/visibility/VisibilityController.java&apos; sourcefile=&apos;VisibilityController.java&apos;&amp;gt;&amp;lt;Message&amp;gt;In VisibilityController.java&amp;lt;/Message&amp;gt;&amp;lt;/SourceLine&amp;gt;&amp;lt;Message&amp;gt;Field org.apache.hadoop.hbase.security.visibility.VisibilityController.regionEnv&amp;lt;/Message&amp;gt;&amp;lt;/Field&amp;gt;&amp;lt;Int value=&apos;62&apos; role=&apos;INT_SYNC_PERCENT&apos;&amp;gt;&amp;lt;Message&amp;gt;Synchronized 62% of the time&amp;lt;/Message&amp;gt;&amp;lt;/Int&amp;gt;&amp;lt;SourceLine endBytecode=&apos;9&apos; startBytecode=&apos;9&apos; start=&apos;1320&apos; classname=&apos;org.apache.hadoop.hbase.security.visibility.VisibilityController&apos; primary=&apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos; sourcepath=&apos;org/apache/hadoop/hbase/security/visibility/VisibilityController.java&apos; role=&apos;SOURCE_LINE_UNSYNC_ACCESS&apos; sourcefile=&apos;VisibilityController.java&apos; end=&apos;1320&apos;&amp;gt;&amp;lt;Message&amp;gt;Unsynchronized access at VisibilityController.java:[line 1320]&amp;lt;/Message&amp;gt;&amp;lt;/SourceLine&amp;gt;&amp;lt;SourceLine endBytecode=&apos;72&apos; startBytecode=&apos;72&apos; start=&apos;192&apos; classname=&apos;org.apache.hadoop.hbase.security.visibility.VisibilityController&apos; sourcepath=&apos;org/apache/hadoop/hbase/security/visibility/VisibilityController.java&apos; role=&apos;SOURCE_LINE_UNSYNC_ACCESS&apos; sourcefile=&apos;VisibilityController.java&apos; end=&apos;192&apos;&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So if there any any real find bug issue will fix it as a followup?&lt;/p&gt;</comment>
                            <comment id="14051063" author="ram_krish" created="Thu, 3 Jul 2014 04:53:11 +0000"  >&lt;p&gt;0.98 version&apos;s patch.&lt;/p&gt;</comment>
                            <comment id="14051071" author="ram_krish" created="Thu, 3 Jul 2014 05:06:06 +0000"  >&lt;p&gt;Branch-1 patch.  I think already there is some compilation issue with the branch-1 and master.&lt;/p&gt;</comment>
                            <comment id="14051091" author="ram_krish" created="Thu, 3 Jul 2014 05:45:24 +0000"  >&lt;p&gt;Verified in cluster with a table with puts before the patch (so that they are not sorted). The applied the patch and issued deletes. The patch works fine.&lt;/p&gt;</comment>
                            <comment id="14052112" author="ram_krish" created="Fri, 4 Jul 2014 03:00:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;&lt;br/&gt;
Ping !! Can i commit this to branch-1?&lt;/p&gt;</comment>
                            <comment id="14052220" author="anoop.hbase" created="Fri, 4 Jul 2014 07:05:01 +0000"  >&lt;p&gt;Reattaching V17 patch for trunk for QA run.&lt;/p&gt;</comment>
                            <comment id="14052252" author="enis" created="Fri, 4 Jul 2014 08:19:07 +0000"  >&lt;p&gt;+1 for branch-1, because this will help complete the story for cell level visibility. &lt;/p&gt;</comment>
                            <comment id="14052273" author="hadoopqa" created="Fri, 4 Jul 2014 08:56:05 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12654057/HBASE-10885_v17.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12654057/HBASE-10885_v17.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12654057&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 4 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14052323" author="ram_krish" created="Fri, 4 Jul 2014 09:54:33 +0000"  >&lt;p&gt;Comparing the reports of &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9968//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt; and&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9967//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9967//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
both seems similar.  So I think this patch is not introducing any findbugs.  Should be a residue from some previous patch.&lt;/p&gt;</comment>
                            <comment id="14052555" author="apurtell" created="Fri, 4 Jul 2014 16:44:46 +0000"  >&lt;p&gt;+1 for 0.98&lt;/p&gt;</comment>
                            <comment id="14052611" author="ram_krish" created="Fri, 4 Jul 2014 18:32:17 +0000"  >&lt;p&gt;Committed to 0.98, branch-1 and trunk.&lt;br/&gt;
Thanks for excellent reviews to Anoop.  It was very helpful to identify some missing cases. &lt;/p&gt;</comment>
                            <comment id="14052625" author="hudson" created="Fri, 4 Jul 2014 19:32:00 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #13 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/13/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/13/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10885&quot; title=&quot;Support visibility expressions on Deletes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10885&quot;&gt;&lt;del&gt;HBASE-10885&lt;/del&gt;&lt;/a&gt; Support visibility expressions on Deletes (Ram) (ramkrishna: rev c7efcd0fb32e90dc2a3c2aeeeb8f6eb43758e39c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityConstants.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DeleteTracker.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportTSVWithVisibilityLabels.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/LabelExpander.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/ScanDeleteTracker.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/security/visibility/TestVisibilityLabelsWithDeletes.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityUtils.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityScanDeleteTracker.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/CellUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityController.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/TagType.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14052672" author="hudson" created="Fri, 4 Jul 2014 21:20:17 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #5273 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5273/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5273/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10885&quot; title=&quot;Support visibility expressions on Deletes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10885&quot;&gt;&lt;del&gt;HBASE-10885&lt;/del&gt;&lt;/a&gt; Support visibility expressions on Deletes (Ram) (ramkrishna: rev 62c048660bd3d4062e56646ae7c17b9a2ef15614)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/LabelExpander.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/security/visibility/TestVisibilityLabelsWithDeletes.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/ScanDeleteTracker.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityScanDeleteTracker.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityConstants.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityUtils.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DeleteTracker.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityController.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportTSVWithVisibilityLabels.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/TagType.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/CellUtil.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14052681" author="hudson" created="Fri, 4 Jul 2014 21:46:26 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #376 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/376/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/376/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10885&quot; title=&quot;Support visibility expressions on Deletes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10885&quot;&gt;&lt;del&gt;HBASE-10885&lt;/del&gt;&lt;/a&gt; Support visibility expressions on Deletes (Ram) (ramkrishna: rev 4ad9bb39aef8c98bb6608223d77c7e147ae6d946)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/security/visibility/TestVisibilityLabelsWithDeletes.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityUtils.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityConstants.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/LabelExpander.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/TagType.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/ScanDeleteTracker.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/CellUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityScanDeleteTracker.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportTSVWithVisibilityLabels.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityController.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DeleteTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14052711" author="hudson" created="Fri, 4 Jul 2014 23:07:42 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #356 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/356/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/356/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10885&quot; title=&quot;Support visibility expressions on Deletes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10885&quot;&gt;&lt;del&gt;HBASE-10885&lt;/del&gt;&lt;/a&gt; Support visibility expressions on Deletes (Ram) (ramkrishna: rev 4ad9bb39aef8c98bb6608223d77c7e147ae6d946)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityConstants.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/DeleteTracker.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/CellUtil.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityScanDeleteTracker.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/ScanDeleteTracker.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/LabelExpander.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityUtils.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/security/visibility/TestVisibilityLabelsWithDeletes.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/mapreduce/TestImportTSVWithVisibilityLabels.java&lt;/li&gt;
	&lt;li&gt;hbase-common/src/main/java/org/apache/hadoop/hbase/TagType.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityController.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14053522" author="ram_krish" created="Mon, 7 Jul 2014 10:04:09 +0000"  >&lt;p&gt;Just to add on &lt;br/&gt;
The deletes happen based on pattern matching.  If suppose a Cell has SECRET&amp;amp;TOPSECRET as the visibility expression then any delete coming with the same expression is matched for, but TOPSECRET&amp;amp;SECRET is also considered to be same&lt;br/&gt;
A&amp;amp;B&amp;lt;=&amp;gt;B&amp;amp;A&lt;br/&gt;
A|B&amp;lt;=&amp;gt;B|A.&lt;br/&gt;
This is the difference between what Accumulo does in terms of delete where only the exact match is looked out for.&lt;/p&gt;</comment>
                            <comment id="14053546" author="anoop.hbase" created="Mon, 7 Jul 2014 11:04:27 +0000"  >&lt;p&gt;Ram, can you add release notes pls&lt;/p&gt;</comment>
                            <comment id="14330531" author="enis" created="Sat, 21 Feb 2015 23:29:10 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12715717">HBASE-11222</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12716842">HBASE-11256</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12650596" name="10885-org.apache.hadoop.hbase.security.visibility.TestVisibilityLabelsWithDeletes-output.txt" size="3311467" author="yuzhihong@gmail.com" created="Mon, 16 Jun 2014 16:57:03 +0000"/>
                            <attachment id="12653759" name="HBASE-10885_0.98_1.patch" size="175468" author="ram_krish" created="Thu, 3 Jul 2014 04:53:11 +0000"/>
                            <attachment id="12642399" name="HBASE-10885_1.patch" size="91074" author="ram_krish" created="Tue, 29 Apr 2014 04:24:52 +0000"/>
                            <attachment id="12642441" name="HBASE-10885_2.patch" size="101395" author="ram_krish" created="Tue, 29 Apr 2014 11:32:01 +0000"/>
                            <attachment id="12653761" name="HBASE-10885_branch_1.patch" size="175456" author="ram_krish" created="Thu, 3 Jul 2014 05:06:06 +0000"/>
                            <attachment id="12644102" name="HBASE-10885_new_tag_type_1.patch" size="114971" author="ram_krish" created="Fri, 9 May 2014 12:12:56 +0000"/>
                            <attachment id="12644400" name="HBASE-10885_new_tag_type_2.patch" size="115127" author="ram_krish" created="Mon, 12 May 2014 11:10:16 +0000"/>
                            <attachment id="12647171" name="HBASE-10885_v1.patch" size="144509" author="ram_krish" created="Wed, 28 May 2014 17:24:01 +0000"/>
                            <attachment id="12652994" name="HBASE-10885_v12.patch" size="151921" author="ram_krish" created="Sat, 28 Jun 2014 05:17:41 +0000"/>
                            <attachment id="12652812" name="HBASE-10885_v12.patch" size="151921" author="ram_krish" created="Fri, 27 Jun 2014 11:50:18 +0000"/>
                            <attachment id="12653152" name="HBASE-10885_v13.patch" size="156817" author="ram_krish" created="Mon, 30 Jun 2014 12:57:47 +0000"/>
                            <attachment id="12653366" name="HBASE-10885_v15.patch" size="162345" author="ram_krish" created="Tue, 1 Jul 2014 10:14:56 +0000"/>
                            <attachment id="12654057" name="HBASE-10885_v17.patch" size="175456" author="anoop.hbase" created="Fri, 4 Jul 2014 07:05:01 +0000"/>
                            <attachment id="12653756" name="HBASE-10885_v17.patch" size="175456" author="ram_krish" created="Thu, 3 Jul 2014 04:42:01 +0000"/>
                            <attachment id="12648643" name="HBASE-10885_v2.patch" size="115715" author="stack" created="Fri, 6 Jun 2014 14:16:26 +0000"/>
                            <attachment id="12648616" name="HBASE-10885_v2.patch" size="115715" author="ram_krish" created="Fri, 6 Jun 2014 08:37:08 +0000"/>
                            <attachment id="12648430" name="HBASE-10885_v2.patch" size="115715" author="ram_krish" created="Thu, 5 Jun 2014 03:56:41 +0000"/>
                            <attachment id="12648921" name="HBASE-10885_v3.patch" size="116737" author="ram_krish" created="Mon, 9 Jun 2014 06:26:59 +0000"/>
                            <attachment id="12650293" name="HBASE-10885_v4.patch" size="132961" author="ram_krish" created="Fri, 13 Jun 2014 13:03:42 +0000"/>
                            <attachment id="12650472" name="HBASE-10885_v5.patch" size="132961" author="ram_krish" created="Sun, 15 Jun 2014 06:25:01 +0000"/>
                            <attachment id="12650978" name="HBASE-10885_v7.patch" size="131463" author="ram_krish" created="Wed, 18 Jun 2014 06:56:03 +0000"/>
                            <attachment id="12652390" name="HBASE-10885_v8.patch" size="132247" author="ram_krish" created="Wed, 25 Jun 2014 11:26:49 +0000"/>
                            <attachment id="12652567" name="HBASE-10885_v9.patch" size="141552" author="ram_krish" created="Thu, 26 Jun 2014 07:27:52 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12710007">HBASE-11053</subtask>
                            <subtask id="12710011">HBASE-11054</subtask>
                            <subtask id="12710888">HBASE-11088</subtask>
                            <subtask id="12722718">HBASE-11384</subtask>
                            <subtask id="12722719">HBASE-11385</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>23.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Apr 2014 09:22:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384195</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1u6t3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>384463</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Deletes can be specified with Cell Visibility as done for puts.&lt;br/&gt;
Cells covered by the delete is found by doing pattern matching. &lt;br/&gt;
A deleteFamily issued for row1, f1 with Cell Visibility (A &amp;amp; B) would delete only those cells of row1 under family f1 which has cell visibility A&amp;amp;B or B&amp;amp;A. A delete without any cell visibility would only delete those cells that does not have any cell visibility.&lt;br/&gt;
In case of delete specific column with latest version only the latest cell with the specified cell visibility will be covered by the delete marker. In case there is no such cell with the specified cell visibility then no cell gets deleted.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>