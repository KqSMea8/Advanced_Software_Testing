<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:44:07 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-423/HBASE-423.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-423] Test cases need a mechanism to tell HConnectionManager to shutdown</title>
                <link>https://issues.apache.org/jira/browse/HBASE-423</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;One of the reason many test cases take so long is that HConnectionManager continues trying to refind tables, meta and root region even when the test is done but has not completely shut down yet.&lt;/p&gt;

&lt;p&gt;The test case should be able to call the connection manager and tell it to shutdown, meaning:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;release all references (clear out all its maps)&lt;/li&gt;
	&lt;li&gt;do not accept any new requests&lt;/li&gt;
	&lt;li&gt;if any requests are in progress, abort them.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12388116">HBASE-423</key>
            <summary>Test cases need a mechanism to tell HConnectionManager to shutdown</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jimk">Jim Kellerman</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 Feb 2008 17:30:53 +0000</created>
                <updated>Thu, 5 Nov 2009 22:12:58 +0000</updated>
                            <resolved>Thu, 5 Nov 2009 22:12:58 +0000</resolved>
                                                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12610595" author="jdcryans" created="Fri, 4 Jul 2008 14:40:49 +0000"  >&lt;p&gt;Isn&apos;t the call on HConnectionManager.deleteConnectionInfo() in the tearDown of HBaseClusterTestCase enough? I tried adding a boolean called acceptingRequests in HCM that is checked like this :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; HConnection getConnection(HBaseConfiguration conf) {
    TableServers connection = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(acceptingRequests) {
      
      &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (HBASE_INSTANCES) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; instanceName = conf.get(HBASE_DIR);
        connection = HBASE_INSTANCES.get(instanceName);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (connection == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          connection = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TableServers(conf);
          HBASE_INSTANCES.put(instanceName, connection);
        }
      }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; connection;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and I think I saw that each tests took 1 second less. &lt;/p&gt;</comment>
                            <comment id="12610630" author="stack" created="Fri, 4 Jul 2008 17:44:19 +0000"  >&lt;p&gt;Maybe deleteConnectionInfo was added after this issue was filed? I remember doing some messing here a while back.  If so, it might made this issue into a non-item.&lt;/p&gt;</comment>
                            <comment id="12611444" author="stack" created="Tue, 8 Jul 2008 04:04:06 +0000"  >&lt;p&gt;Looking in svn, I see that a deleteConnectionInfo that takes no argument and that deletes all from the cache is what is new.   But I&apos;d guess that the one that is in HBaseClusterTestCase where it passes a Configuration should work fine too.&lt;/p&gt;

&lt;p&gt;J-D, w/ your patch above, when getConnection returns null, what happens?  There is no retry?&lt;/p&gt;

&lt;p&gt;Should we just add an open table and close table altogether?&lt;/p&gt;</comment>
                            <comment id="12612573" author="jdcryans" created="Thu, 10 Jul 2008 17:03:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;J-D, w/ your patch above, when getConnection returns null, what happens? There is no retry?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In my patch, acceptingRequests can only be set by this method :&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void closeConnectionsForTests() {
  deleteConnectionInfo();
  acceptingRequests = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So this should happen only when finishing a test case. I did that for what Jim wrote :&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;do not accept any new requests&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So acceptingRequests is checked at the beginning of each HCM methods.&lt;/p&gt;

&lt;p&gt;Regarding open and close table, could you explain a bit more?&lt;/p&gt;</comment>
                            <comment id="12612589" author="stack" created="Thu, 10 Jul 2008 17:51:59 +0000"  >&lt;p&gt;I was thinking that we&apos;d set the acceptingRequests to false when user calls &apos;close&apos; and to true when user calls &apos;open&apos;... but thats a pain.  Lets go w/ your suggestion above &amp;#8211; make a method only used by tests (Maybe make this clear in javadoc too as well as in name &amp;#8211; pity we can&apos;t make it package private so it doesn&apos;t show in public API).&lt;/p&gt;</comment>
                            <comment id="12612940" author="jdcryans" created="Fri, 11 Jul 2008 17:47:36 +0000"  >&lt;p&gt;Patch that enables the HCM to refuse requests.&lt;/p&gt;</comment>
                            <comment id="12627528" author="jimk" created="Mon, 1 Sep 2008 19:57:13 +0000"  >&lt;p&gt;Is this issue really needed since we added HConnectionManager.deleteConnectionInfo ?&lt;/p&gt;</comment>
                            <comment id="12634271" author="jimk" created="Wed, 24 Sep 2008 20:11:16 +0000"  >&lt;p&gt;Although this patch no longer applies to trunk, the changes do the &quot;right thing&quot;. So, modified to apply to trunk, +1. &lt;/p&gt;

&lt;p&gt;Once modified, feel free to commit this JD.&lt;/p&gt;</comment>
                            <comment id="12709874" author="jdcryans" created="Fri, 15 May 2009 15:22:22 +0000"  >&lt;p&gt;This issue has been open forever, do we still need this? Here is an updated patch just in case.&lt;/p&gt;</comment>
                            <comment id="12774109" author="jdcryans" created="Thu, 5 Nov 2009 22:12:58 +0000"  >&lt;p&gt;Closing as everything changed now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12408256" name="hbase-423-trunk.patch" size="3405" author="jdcryans" created="Fri, 15 May 2009 15:22:22 +0000"/>
                            <attachment id="12385889" name="hbase-423-v1.patch" size="3580" author="jdcryans" created="Fri, 11 Jul 2008 17:47:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 4 Jul 2008 14:40:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31697</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h77z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98432</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>