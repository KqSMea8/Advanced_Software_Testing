<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:38:44 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6660/HBASE-6660.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6660] Meta assignment to a region server caused continuous NPE loop during postOpenDeployTasks</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6660</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Recently I upgraded three data centers to our own checkout of 0.92.2, last commit :&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;commit 5accb6a1be4776630126ac21d07adb652b74df95
Author: Zhihong Yu &amp;lt;tedyu@apache.org&amp;gt;
Date:   Mon Aug 20 18:19:45 2012 +0000
HBASE-6608 Fix for HBASE-6160, META entries from daughters can be deleted before parent entries, shouldn&apos;t compare HRegionInfo&apos;s (Enis)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Two upgrades went fine, upgrade to one data center failed. Failed in the sense that ROOT and META assignment took forever. Panic struck I restarted master and all region servers. I may have deleted zookeeper node /hbase/root-region-server as well, dont ask me why &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;

&lt;p&gt;After this I managed to get ROOT assigned. But META assignment got stuck again. &lt;/p&gt;

&lt;p&gt;The log is here : &lt;a href=&quot;https://raw.github.com/gist/3455435/adebd118b47aa3d715201010aa09e5eb8930033c/npe_rs_0.92.2.log&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://raw.github.com/gist/3455435/adebd118b47aa3d715201010aa09e5eb8930033c/npe_rs_0.92.2.log&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Notice how region server was stuck in a loop of NPE (grep processBatchCallback). There is one more NPE related to zookeeper constructor. &lt;/p&gt;</description>
                <environment>&lt;p&gt;CentOS release 5.7&lt;/p&gt;</environment>
        <key id="12604925">HBASE-6660</key>
            <summary>Meta assignment to a region server caused continuous NPE loop during postOpenDeployTasks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="shrijeet">Shrijeet Paliwal</reporter>
                        <labels>
                    </labels>
                <created>Fri, 24 Aug 2012 21:25:56 +0000</created>
                <updated>Wed, 16 Nov 2016 22:09:52 +0000</updated>
                            <resolved>Wed, 16 Nov 2016 22:09:50 +0000</resolved>
                                    <version>0.92.2</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13441516" author="enis" created="Fri, 24 Aug 2012 21:37:28 +0000"  >&lt;p&gt;From the log, and the code: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-08-22 20:26:28,045 WARN org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler: Exception running postOpenDeployTasks; region=1028785192
java.lang.NullPointerException
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.processBatchCallback(HConnectionManager.java:1527)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.processBatch(HConnectionManager.java:1411)
	at org.apache.hadoop.hbase.client.HTable.flushCommits(HTable.java:915)
	at org.apache.hadoop.hbase.client.HTable.doPut(HTable.java:792)
	at org.apache.hadoop.hbase.client.HTable.put(HTable.java:767)
	at org.apache.hadoop.hbase.catalog.MetaEditor.put(MetaEditor.java:99)
	at org.apache.hadoop.hbase.catalog.MetaEditor.putToCatalogTable(MetaEditor.java:89)
	at org.apache.hadoop.hbase.catalog.MetaEditor.updateLocation(MetaEditor.java:260)
	at org.apache.hadoop.hbase.catalog.MetaEditor.updateMetaLocation(MetaEditor.java:222)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.postOpenDeployTasks(HRegionServer.java:1494)
	at org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler$PostOpenDeployTasksThread.run(OpenRegionHandler.java:242)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It seems that HConnectionManager.locateRegion() returned null, since RootRegionTracker.waitRootRegionLocation() returned null:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; HRegionLocation locateRegion(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] tableName,
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] row, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; useCache)
    &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.closed) &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(toString() + &lt;span class=&quot;code-quote&quot;&gt;&quot; closed&quot;&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tableName == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || tableName.length == 0) {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(
            &lt;span class=&quot;code-quote&quot;&gt;&quot;table name cannot be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; or zero length&quot;&lt;/span&gt;);
      }

      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Bytes.equals(tableName, HConstants.ROOT_TABLE_NAME)) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          ServerName servername =
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootRegionTracker.waitRootRegionLocation(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rpcTimeout);
          LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Lookedup root region location, connection=&quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot;; serverName=&quot;&lt;/span&gt; + ((servername == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)? &quot;&quot;: servername.toString()));
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (servername == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From my understanding, the root location in ZK seems corrupted. Do you have a chance to post the master and the region server(who deployed ROOT) logs?&lt;/p&gt;
</comment>
                            <comment id="13441518" author="shrijeet" created="Fri, 24 Aug 2012 21:41:21 +0000"  >&lt;p&gt;Enis, &lt;br/&gt;
Did you notice I mentioned in an attempt to get things going down - I not only did complete restart I also deleted zookeeper node /hbase/root-region-server , but I did this delete when all region servers and master were down. &lt;/p&gt;

&lt;p&gt;Let me get the other two logs. &lt;/p&gt;</comment>
                            <comment id="13441542" author="shrijeet" created="Fri, 24 Aug 2012 22:17:29 +0000"  >&lt;p&gt;Master log &lt;a href=&quot;https://raw.github.com/gist/3456346/defc781b356832e3a2bfc4264b28a3fa3ba2bd8b/master.log&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://raw.github.com/gist/3456346/defc781b356832e3a2bfc4264b28a3fa3ba2bd8b/master.log&lt;/a&gt;&lt;br/&gt;
Root region server log (based on what I understood master assigned root to): &lt;a href=&quot;https://raw.github.com/gist/3456292/38058d59fb147fd928b5b0a0107feab5fd8dc648/root.log&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://raw.github.com/gist/3456292/38058d59fb147fd928b5b0a0107feab5fd8dc648/root.log&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13441545" author="shrijeet" created="Fri, 24 Aug 2012 22:20:12 +0000"  >&lt;p&gt;Also does any one else find these log messages odd: &lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-08-22 20:15:10,231 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Attempting connect to Master server at ine-60.rfiserve.net,60000,1345680901361
2012-08-22 20:15:10,336 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Connected to master at ine-51.rfiserve.net/172.22.2.51:60020
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;ine-60 is HMaster, ine-51 is a region server which printed these log messages. &lt;/p&gt;</comment>
                            <comment id="13441586" author="shrijeet" created="Fri, 24 Aug 2012 23:11:01 +0000"  >&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6662&quot; title=&quot;Region server incorrectly reports its own address as master&amp;#39;s address&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6662&quot;&gt;&lt;del&gt;HBASE-6662&lt;/del&gt;&lt;/a&gt; for the incorrect address reporting issue.&lt;/p&gt;

&lt;p&gt;Edit: URL for JIRA wouldn&apos;t reflect the latest status.&lt;/p&gt;</comment>
                            <comment id="13441597" author="enis" created="Fri, 24 Aug 2012 23:34:13 +0000"  >&lt;p&gt;I noticed only one odd thing. Other than that everything seems normal. Master, running at ine-60 deployed ROOT to ine-48, around 2012-08-22 20:15:30. Around 2012-08-22 20:24:33, the master seems to be restarted, but not ine-48. After it comes up, it tries to assign META, &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-08-22 20:24:43,060 INFO org.apache.hadoop.hbase.master.HMaster: -ROOT- assigned=0, rit=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, location=ine-48.rfiserve.net,60020,1345680918003
2012-08-22 20:24:43,325 INFO org.apache.hadoop.hbase.catalog.CatalogTracker: Failed verification of .META.,,1 at address=ine-50.rfiserve.net,60020,1345680145127
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But the logs from the META RS, seems to indicate that it has a hostname of ine-51, but the master thinks that META is assigned at ine-50. Could you be having a DNS issue, or a hostname mixup?  &lt;/p&gt;</comment>
                            <comment id="13443329" author="stack" created="Tue, 28 Aug 2012 18:10:03 +0000"  >&lt;p&gt;@Shrijeet Did you want to make this a blocker on 0.92.2?  What you think of Enis&apos;s question?&lt;/p&gt;</comment>
                            <comment id="13443397" author="shrijeet" created="Tue, 28 Aug 2012 18:59:37 +0000"  >&lt;p&gt;Sorry for late response. &lt;/p&gt;

&lt;p&gt;Response to Enis&apos;s question: DNS issue and hostname mixup is unlikely. DNS is well setup and has been working reliably since long time. &lt;/p&gt;

&lt;p&gt;Stack, I do not have enough evidence and confidence to label this as blocker. I did nasty things (killed processes out of order, deleted zookeeper data etc. etc.) It could be a pebkac issue. &lt;/p&gt;

&lt;p&gt;I am planning to upgrade one more data center today/tomorrow. I will use the same HBase checkout as this bug report. Upto you guys if you want to wait for my report. &lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13443408" author="stack" created="Tue, 28 Aug 2012 19:11:20 +0000"  >&lt;p&gt;We can wait.  There are a few unit tests yet to clean up.&lt;/p&gt;</comment>
                            <comment id="13443410" author="yuzhihong@gmail.com" created="Tue, 28 Aug 2012 19:11:40 +0000"  >&lt;p&gt;@Shrijeet:&lt;br/&gt;
We&apos;ll wait for your next upgrade.&lt;/p&gt;

&lt;p&gt;Thanks for trying out new 0.92 build.&lt;/p&gt;</comment>
                            <comment id="13443842" author="shrijeet" created="Wed, 29 Aug 2012 06:30:40 +0000"  >&lt;p&gt;Latest upgrade went smooth. OK with me to make this &apos;not a blocker&apos;. &lt;br/&gt;
Thanks guys.&lt;/p&gt;</comment>
                            <comment id="13444063" author="yuzhihong@gmail.com" created="Wed, 29 Aug 2012 13:51:34 +0000"  >&lt;p&gt;Thanks for the update.&lt;/p&gt;

&lt;p&gt;Waiting for this issue to be reproduced.&lt;/p&gt;</comment>
                            <comment id="15671818" author="stack" created="Wed, 16 Nov 2016 22:09:51 +0000"  >&lt;p&gt;Old hbase. Reopen if can repro in new hbase.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 24 Aug 2012 21:37:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241829</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02e2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11881</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>