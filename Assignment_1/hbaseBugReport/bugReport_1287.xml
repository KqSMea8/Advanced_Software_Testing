<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:52:17 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1287/HBASE-1287.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1287] Partitioner class not used in TableMapReduceUtil.initTableReduceJob()</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1287</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Upon checking the available utility methods in TableMapReduceUtil I came across this code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void initTableReduceJob(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; table,
    &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;&amp;lt;? &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; TableReduce&amp;gt; reducer, JobConf job, &lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt; partitioner)
  &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    job.setOutputFormat(TableOutputFormat.class);
    job.setReducerClass(reducer);
    job.set(TableOutputFormat.OUTPUT_TABLE, table);
    job.setOutputKeyClass(ImmutableBytesWritable.class);
    job.setOutputValueClass(BatchUpdate.class);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (partitioner != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      job.setPartitionerClass(HRegionPartitioner.class);
      HTable outputTable = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTable(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HBaseConfiguration(job), table);
      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; regions = outputTable.getRegionsInfo().size();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (job.getNumReduceTasks() &amp;gt; regions){
    	job.setNumReduceTasks(outputTable.getRegionsInfo().size());
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It seems though as it should be&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (partitioner != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      job.setPartitionerClass(partitioner);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the provided HRegionPartitioner can be handed in to that call or a custom one can be provided.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12419384">HBASE-1287</key>
            <summary>Partitioner class not used in TableMapReduceUtil.initTableReduceJob()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="viper799">Billy Pearson</assignee>
                                    <reporter username="larsgeorge">Lars George</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Mar 2009 12:12:12 +0000</created>
                <updated>Thu, 20 Sep 2012 22:10:38 +0000</updated>
                            <resolved>Fri, 24 Apr 2009 22:45:35 +0000</resolved>
                                                    <fixVersion>0.19.2</fixVersion>
                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12689100" author="larsgeorge" created="Wed, 25 Mar 2009 12:59:18 +0000"  >&lt;p&gt;Fixes the usage of the partitioner class as opposed to be using the hardcoded default class.&lt;/p&gt;</comment>
                            <comment id="12689112" author="stack" created="Wed, 25 Mar 2009 13:44:59 +0000"  >&lt;p&gt;Yeah, that looks silly Lars; always using HRegionPartitioner regardless of whats passed.&lt;/p&gt;

&lt;p&gt;Does the rest of that function belong inside the &apos;    if (partitioner != null) { }&apos; loop?  The bit where its doing:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      HTable outputTable = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTable(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HBaseConfiguration(job), table);
      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; regions = outputTable.getRegionsInfo().size();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (job.getNumReduceTasks() &amp;gt; regions){
    	job.setNumReduceTasks(outputTable.getRegionsInfo().size());
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should it be rather something like if partition == HRegionPartition.class, do above?  Otherwise, presume the custom partitioner is figuring the number of reduce tasks?&lt;/p&gt;</comment>
                            <comment id="12689115" author="larsgeorge" created="Wed, 25 Mar 2009 13:59:02 +0000"  >&lt;p&gt;I was wondering about this too Michael and was about to ask. I am not sure who added it and why (I have yet to figure out how to search the file history for a specific change as opposed to browse them one by one). Anyhow, I do a similar thing, computing the number of mappers, in my main MR program. Why this is here and why it is executed just when a custom partitioner is given eludes me. Either you do it always, or never - or have an extra flag that triggers it. &lt;/p&gt;

&lt;p&gt;It also sets the upper limit only when the given number of reducers is higher than the actual regions. Why though? I am using this only to compute the number of mappers so that I do not have to specify this on the command line. &lt;/p&gt;

&lt;p&gt;All in all I would drop the whole thing if there is no reason to keep it and rather ask the caller to set the boundaries. Or add another helper method that computes these on demand, for example&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; setNumMapTasks(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; table, JobConf job) {...}
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; setNumReduceTasks(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; table, JobConf job) {...}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;where both simply do the same thing, get the number of region and assign that value to the respective field in the job configuration.&lt;/p&gt;</comment>
                            <comment id="12693731" author="stack" created="Mon, 30 Mar 2009 11:36:22 +0000"  >&lt;p&gt;Hey Lars:  I did svn blame and svn log against that file.  Looks like its my commit of a Billy Pearson patch, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-987&quot; title=&quot;We need a Hbase Partitioner for TableMapReduceUtil.initTableReduceJob MR Jobs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-987&quot;&gt;&lt;del&gt;HBASE-987&lt;/del&gt;&lt;/a&gt; that added the partitioner test.  As is, as you say, its broke.  Regards your suggestion, would you still be able to pass a custom partitioner?&lt;/p&gt;</comment>
                            <comment id="12693907" author="larsgeorge" created="Mon, 30 Mar 2009 21:04:56 +0000"  >&lt;p&gt;Hi Stack, yes, that would stay the same, I would simply move the next few lines below the partitioner part to specific helper methods that can be called if needed - as opposed to implicitly assuming that is always what a caller wants when they set a custom partitioner. Does that make sense?&lt;/p&gt;</comment>
                            <comment id="12694287" author="stack" created="Tue, 31 Mar 2009 21:30:20 +0000"  >&lt;p&gt;Sounds great Lars.&lt;/p&gt;</comment>
                            <comment id="12695269" author="larsgeorge" created="Fri, 3 Apr 2009 07:01:46 +0000"  >&lt;p&gt;As discussed. Moved code that ensured upper limits to separate methods and added generic setters to be able to specify the number of mappers or reducers for a given job. Also added setting the default HRegionPartitioner back in as that seemed like it was the original intention. So either the given one is set or the default one when that specific method is called. The initTableReduceJob without the partitioner parameter is unchanged and does not set anything specific related to the partitioner class.&lt;/p&gt;</comment>
                            <comment id="12698606" author="viper799" created="Tue, 14 Apr 2009 01:04:59 +0000"  >&lt;p&gt;yea that was my mess up should have used partitioner in the function but just hard linked the Hregion one for no reasion.&lt;/p&gt;

&lt;p&gt;The idea behind setting the number of reducers is to lower it if the number of reducers if it is set &amp;gt; then we have regions the &lt;br/&gt;
HRegionPartitioner will handle if the number of reduce is set lower then the number of regions it just converts back to using default hashPartitioner&lt;br/&gt;
if greater then number of regions it will still work but will be a wast of launching reducers that will have no work to do.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (partitioner != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      job.setPartitionerClass(HRegionPartitioner.class);
      HTable outputTable = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTable(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HBaseConfiguration(job), table);
      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; regions = outputTable.getRegionsInfo().size();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (job.getNumReduceTasks() &amp;gt; regions){
    	job.setNumReduceTasks(outputTable.getRegionsInfo().size());
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;should be something like this&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (partitioner == HRegionPartitioner.class) {
      job.setPartitionerClass(HRegionPartitioner.class);
      HTable outputTable = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTable(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HBaseConfiguration(job), table);
      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; regions = outputTable.getRegionsInfo().size();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (job.getNumReduceTasks() &amp;gt; regions){
    	job.setNumReduceTasks(outputTable.getRegionsInfo().size());
      }
  } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
    job.setPartitionerClass(partitioner);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="12698610" author="viper799" created="Tue, 14 Apr 2009 01:24:32 +0000"  >&lt;p&gt;upload patch to fix I thank what you are talking about I would like to keep the setNumReduceTasks for HRegion Partitioner&lt;/p&gt;</comment>
                            <comment id="12698615" author="viper799" created="Tue, 14 Apr 2009 01:44:48 +0000"  >&lt;p&gt;forgot to include it will patch trunk and branch-0.19&lt;/p&gt;</comment>
                            <comment id="12701799" author="stack" created="Thu, 23 Apr 2009 04:31:14 +0000"  >&lt;p&gt;@Lars  You good w/ Billy&apos;s patch?  (It looks good to me).&lt;/p&gt;</comment>
                            <comment id="12701904" author="larsgeorge" created="Thu, 23 Apr 2009 11:53:48 +0000"  >&lt;p&gt;No. His patch is negating on the comparison, while I assume from his comment that he wanted to have an equal:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (partitioner != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (partitioner != HRegionPartitioner.class) { &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;should be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;-    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (partitioner != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (partitioner == HRegionPartitioner.class) { &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;?&lt;/p&gt;

&lt;p&gt;Also I would like to keep the setters I added if there is no objection against it. Because I need them and I have also talked to others that need those too by the looks. &lt;/p&gt;</comment>
                            <comment id="12701964" author="stack" created="Thu, 23 Apr 2009 15:33:18 +0000"  >&lt;p&gt;Billy, want to make a new patch?  Or want Lars or I to do it?  Thanks.&lt;/p&gt;</comment>
                            <comment id="12701975" author="viper799" created="Thu, 23 Apr 2009 16:06:40 +0000"  >&lt;p&gt;Sorry about that fixed&lt;/p&gt;</comment>
                            <comment id="12702006" author="larsgeorge" created="Thu, 23 Apr 2009 17:01:05 +0000"  >&lt;p&gt;Combined patch including BIlly&apos;s patch and the additional functions I see being useful (and use myself). Also cleaned up JavaDoc of all other methods.&lt;/p&gt;</comment>
                            <comment id="12702029" author="viper799" created="Thu, 23 Apr 2009 17:50:30 +0000"  >&lt;p&gt;+1 I like the added functions I can see where they will be used often in hbase MR jobs&lt;/p&gt;</comment>
                            <comment id="12702033" author="viper799" created="Thu, 23 Apr 2009 17:55:49 +0000"  >&lt;p&gt;question?&lt;br/&gt;
the default partitioner should be hash defualt in hadoop&lt;br/&gt;
if we pass null as we do in line 75&lt;br/&gt;
and its set in line 105 as null will hadoop use default hash or will this break the partitioner?&lt;/p&gt;</comment>
                            <comment id="12702037" author="viper799" created="Thu, 23 Apr 2009 18:05:49 +0000"  >&lt;p&gt;Edited the to not set partitioner if null is as in from 75 passed &lt;br/&gt;
it gives java.lang.NullPointerException otherwise&lt;br/&gt;
+1&lt;/p&gt;</comment>
                            <comment id="12702333" author="larsgeorge" created="Fri, 24 Apr 2009 11:59:38 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12702593" author="stack" created="Fri, 24 Apr 2009 22:45:35 +0000"  >&lt;p&gt;Committed to branch and trunk.  Thanks Lars and Billy for figuring this patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12404511" name="1287-2.patch" size="3468" author="larsgeorge" created="Fri, 3 Apr 2009 07:01:46 +0000"/>
                            <attachment id="12405371" name="1287-3-patch.txt" size="1119" author="viper799" created="Tue, 14 Apr 2009 01:24:32 +0000"/>
                            <attachment id="12406243" name="1287-4-patch.txt" size="1135" author="viper799" created="Thu, 23 Apr 2009 16:06:40 +0000"/>
                            <attachment id="12406250" name="1287-5.patch" size="5740" author="larsgeorge" created="Thu, 23 Apr 2009 17:01:05 +0000"/>
                            <attachment id="12406258" name="1287-6.patch.txt" size="11125" author="viper799" created="Thu, 23 Apr 2009 18:05:49 +0000"/>
                            <attachment id="12403605" name="1287.patch" size="754" author="larsgeorge" created="Wed, 25 Mar 2009 12:59:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 25 Mar 2009 13:44:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25667</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 34 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hcev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99273</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>