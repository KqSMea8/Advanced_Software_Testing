<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:47:17 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7600/HBASE-7600.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7600] TestAdmin.testCreateBadTables is failing occasionally</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7600</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;See in a 0.94 test run.&lt;br/&gt;
Looks like in some cases it is possible to create two tables with the same name, which is worrisome.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.AssertionError: expected:&amp;lt;1&amp;gt; but was:&amp;lt;2&amp;gt;
	at org.junit.Assert.fail(Assert.java:93)
	at org.junit.Assert.failNotEquals(Assert.java:647)
	at org.junit.Assert.assertEquals(Assert.java:128)
	at org.junit.Assert.assertEquals(Assert.java:472)
	at org.junit.Assert.assertEquals(Assert.java:456)
	at org.apache.hadoop.hbase.client.TestAdmin.testCreateBadTables(TestAdmin.java:1091)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12627962">HBASE-7600</key>
            <summary>TestAdmin.testCreateBadTables is failing occasionally</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liushaohui">Liu Shaohui</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Jan 2013 00:48:15 +0000</created>
                <updated>Fri, 13 Dec 2013 11:46:54 +0000</updated>
                            <resolved>Fri, 25 Oct 2013 04:25:45 +0000</resolved>
                                    <version>0.94.4</version>
                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.94.13</fixVersion>
                    <fixVersion>0.96.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13555739" author="lhofhansl" created="Thu, 17 Jan 2013 01:37:50 +0000"  >&lt;p&gt;Ran it for a while in a loop locally. Cannot reproduce it.&lt;/p&gt;</comment>
                            <comment id="13793308" author="liushaohui" created="Sat, 12 Oct 2013 09:25:02 +0000"  >&lt;p&gt;reproduce this issue in our ci env.  The key problem that two create table threads may both success in hmaster.&lt;/p&gt;

&lt;p&gt;parallel create table threads are serialized in ZKTable:checkAndSetEnablingTable, but the ZKTable:checkAndSetEnablingTable only check the enabling status, not check other states.&lt;br/&gt;
if: &lt;br/&gt;
t1: If two threads start to create same name table&lt;br/&gt;
t2: two master threads start to create CreateTableHandler objects&lt;br/&gt;
t3: two master threads pass the MetaReader.tableExists check in creation of CreateTableHandler&lt;br/&gt;
t4: thread 1 pass this.assignmentManager.getZKTable().checkAndSetEnablingTable, for  there is no table status in master, and set table status to enabling&lt;br/&gt;
t5: other thread process the CreateTableHandler created by thread 1, and finish create table, and set table status to enabled.&lt;br/&gt;
t6: thread 2 pass this.assignmentManager.getZKTable().checkAndSetEnablingTable for the table status is enabled. &lt;br/&gt;
t7:  other thread process the CreateTableHandler created by thread 2, and start create table.&lt;/p&gt;

&lt;p&gt;Two threads both create table success in master.&lt;/p&gt;
</comment>
                            <comment id="13793309" author="liushaohui" created="Sat, 12 Oct 2013 09:25:35 +0000"  >&lt;p&gt;patch for hbase 0.94&lt;/p&gt;</comment>
                            <comment id="13793313" author="liushaohui" created="Sat, 12 Oct 2013 09:40:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The patch does not solve all the problems. Same problem when:&lt;br/&gt;
there are two create table threads and one disable table thread.&lt;/p&gt;

&lt;p&gt; t1: thread 1/2 start to create table&lt;br/&gt;
 t2: thread 1/2 pass the   MetaReader.tableExists&lt;br/&gt;
 t3: thread 1 pass checkAndSetEnablingTable, set table to enabling, and other thread finish to create table, set table status to enabled&lt;br/&gt;
 t4: thread 3 start to disable table, and set table status to disabling&lt;br/&gt;
 t5: thread 2 pass checkAndSetEnablingTable, for table status is disabling &lt;br/&gt;
See: two threads create table success.&lt;/p&gt;

&lt;p&gt;if we add  disabling and disabled check in checkAndSetEnablingTable, this will bing create success -&amp;gt; disable success -&amp;gt; delete table success -&amp;gt; create may fail problem.&lt;br/&gt;
The reason is that delete-table is async and  will return true if there is no table region in meta. But at this moment, delete-table handler may have no finished, the table status in hmaster may be disabled, which cause the later create table failed.&lt;/p&gt;</comment>
                            <comment id="13793467" author="stack" created="Sat, 12 Oct 2013 20:49:52 +0000"  >&lt;p&gt;Reopening so it gets notice.&lt;/p&gt;</comment>
                            <comment id="13801088" author="lhofhansl" created="Mon, 21 Oct 2013 21:19:16 +0000"  >&lt;p&gt;How about this. Same in principle, but more in line with the rest of ZKTable.&lt;br/&gt;
If there are no objection I will commit this.&lt;/p&gt;</comment>
                            <comment id="13802418" author="stack" created="Tue, 22 Oct 2013 23:32:38 +0000"  >&lt;p&gt;Go for it.  +1&lt;/p&gt;</comment>
                            <comment id="13804917" author="lhofhansl" created="Fri, 25 Oct 2013 01:40:22 +0000"  >&lt;p&gt;Trunk version.&lt;/p&gt;</comment>
                            <comment id="13804920" author="lhofhansl" created="Fri, 25 Oct 2013 01:45:44 +0000"  >&lt;p&gt;Committed to all branches. Thanks Liu.&lt;/p&gt;</comment>
                            <comment id="13805019" author="hudson" created="Fri, 25 Oct 2013 04:36:36 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #4645 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4645/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4645/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7600&quot; title=&quot;TestAdmin.testCreateBadTables is failing occasionally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7600&quot;&gt;&lt;del&gt;HBASE-7600&lt;/del&gt;&lt;/a&gt; TestAdmin.testCreateBadTables is failing occasionally (Liu Shaohui) (larsh: rev 1535604)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-client/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13805035" author="hudson" created="Fri, 25 Oct 2013 04:49:15 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94 #1182 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1182/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1182/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7600&quot; title=&quot;TestAdmin.testCreateBadTables is failing occasionally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7600&quot;&gt;&lt;del&gt;HBASE-7600&lt;/del&gt;&lt;/a&gt; TestAdmin.testCreateBadTables is failing occasionally (Liu Shaohui) (larsh: rev 1535606)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13805078" author="hudson" created="Fri, 25 Oct 2013 06:15:43 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96 #160 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/160/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/160/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7600&quot; title=&quot;TestAdmin.testCreateBadTables is failing occasionally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7600&quot;&gt;&lt;del&gt;HBASE-7600&lt;/del&gt;&lt;/a&gt; TestAdmin.testCreateBadTables is failing occasionally (Liu Shaohui) (larsh: rev 1535605)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-client/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13805108" author="hudson" created="Fri, 25 Oct 2013 07:07:28 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.96-hadoop2 #101 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96-hadoop2/101/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96-hadoop2/101/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7600&quot; title=&quot;TestAdmin.testCreateBadTables is failing occasionally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7600&quot;&gt;&lt;del&gt;HBASE-7600&lt;/del&gt;&lt;/a&gt; TestAdmin.testCreateBadTables is failing occasionally (Liu Shaohui) (larsh: rev 1535605)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-client/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13805290" author="hudson" created="Fri, 25 Oct 2013 13:23:32 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #810 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/810/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/810/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7600&quot; title=&quot;TestAdmin.testCreateBadTables is failing occasionally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7600&quot;&gt;&lt;del&gt;HBASE-7600&lt;/del&gt;&lt;/a&gt; TestAdmin.testCreateBadTables is failing occasionally (Liu Shaohui) (larsh: rev 1535604)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-client/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13810633" author="hudson" created="Thu, 31 Oct 2013 20:01:16 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-security #325 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/325/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/325/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7600&quot; title=&quot;TestAdmin.testCreateBadTables is failing occasionally&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7600&quot;&gt;&lt;del&gt;HBASE-7600&lt;/del&gt;&lt;/a&gt; TestAdmin.testCreateBadTables is failing occasionally (Liu Shaohui) (larsh: rev 1535606)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13846690" author="lhofhansl" created="Thu, 12 Dec 2013 20:12:40 +0000"  >&lt;p&gt;Actually this fix has an interesting side effect.&lt;br/&gt;
Sometimes an HBase cluster is wiped by just removing the HDFS data. If the ZK state stays around we can now no longer create tables for which there exists a znode already. Before this patch that was possible. So the element of surprised has increased.&lt;/p&gt;</comment>
                            <comment id="13847426" author="lshmouse" created="Fri, 13 Dec 2013 11:46:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Yes. We also encountered this problem in out test cluster.&lt;/p&gt;

&lt;p&gt;I think the root of the problem is that there are two places (meta table and zk) to check if a table exists, and the states of these two places may be no consistent. &lt;br/&gt;
I have added this task to my list and try to fix it later.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12684360">HBASE-10145</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12610215" name="7600-trunk-v2.txt" size="1089" author="lhofhansl" created="Fri, 25 Oct 2013 01:40:22 +0000"/>
                            <attachment id="12609522" name="7600-v2.txt" size="1024" author="lhofhansl" created="Mon, 21 Oct 2013 21:19:16 +0000"/>
                            <attachment id="12608144" name="HBASE-7600-0.94-v1.patch" size="1430" author="liushaohui" created="Sat, 12 Oct 2013 09:25:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 12 Oct 2013 09:25:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>304810</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 1 week ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17w3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>254171</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>