<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:07:01 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3059/HBASE-3059.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3059] TestReadWriteConsistencyControl occasionally hangs</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3059</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The test hung when I ran mvn test today. The jstack shows that a Writer thread hung at&lt;/p&gt;

&lt;p&gt;&quot;Thread-1&quot; prio=10 tid=0x00002aaad81d2800 nid=0x6ce9 in Object.wait() &lt;span class=&quot;error&quot;&gt;&amp;#91;0x0000000040f37000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: WAITING (on object monitor)  at java.lang.Object.wait(Native Method)&lt;br/&gt;
  at org.apache.hadoop.hbase.regionserver.ReadWriteConsistencyControl.completeMemstoreInsert(ReadWriteConsistencyControl.java:130)&lt;br/&gt;
  &amp;#8211; locked &amp;lt;0x00002aaac9fa0f50&amp;gt; (a java.lang.Object)                &lt;br/&gt;
  at org.apache.hadoop.hbase.regionserver.TestReadWriteConsistencyControl$Writer.run(TestReadWriteConsistencyControl.java:56)  at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;

&lt;p&gt;It seems to be caused by a race condition in ReadWriteConsistencyControl#completeMemStoreInsert. Accesses/updates of the value of memStoreRead should be done while holding the readWaiters lock.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475550">HBASE-3059</key>
            <summary>TestReadWriteConsistencyControl occasionally hangs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="hairong">Hairong Kuang</assignee>
                                    <reporter username="hairong">Hairong Kuang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 30 Sep 2010 21:32:07 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:28 +0000</updated>
                            <resolved>Wed, 6 Oct 2010 01:45:05 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12916691" author="ryanobjc" created="Thu, 30 Sep 2010 21:42:47 +0000"  >&lt;p&gt;what jvm version were you using?&lt;/p&gt;</comment>
                            <comment id="12916693" author="ryanobjc" created="Thu, 30 Sep 2010 21:45:17 +0000"  >&lt;p&gt;a few questions:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;What jvm are you using?  You must be using a 64 bit jvm to run hbase.  32 bit jvms dont offer atomic updates to longs, which is required for this code.&lt;/li&gt;
	&lt;li&gt;how and why does this fix the hang?  The variable is volatile, so adding a synchronized block should not improve the characteristics according the the JMM.&lt;/li&gt;
	&lt;li&gt;How much does this slow down the code?  Readwaiters is a fairly sensitive lock and holding it for less time would be better.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12916721" author="hairong" created="Thu, 30 Sep 2010 22:40:48 +0000"  >&lt;p&gt;I ran with 64 bit jvm.&lt;/p&gt;

&lt;p&gt;But this bug can not be fixed by atomic update. The problem is that it is possible that after a writer W1 checked&lt;br/&gt;
memstoreRead &amp;lt; e.getWriterNumber() to be true, another Writer W2 sets memestoreRead = nextReadValue then does a notifyAll(). Then W1 does readWaiters.wait(0). Since it misses the singal from W2, W1 waits there forever.&lt;/p&gt;</comment>
                            <comment id="12917769" author="kannanm" created="Mon, 4 Oct 2010 21:22:59 +0000"  >&lt;p&gt;+1 on the patch.&lt;/p&gt;</comment>
                            <comment id="12917776" author="ryanobjc" created="Mon, 4 Oct 2010 21:29:24 +0000"  >&lt;p&gt;thanks, the patch looks good, i&apos;ll commit it&lt;/p&gt;</comment>
                            <comment id="12918384" author="ryanobjc" created="Wed, 6 Oct 2010 01:45:05 +0000"  >&lt;p&gt;committed, thanks for that.&lt;/p&gt;

&lt;p&gt;Strange that we did not notice it sooner...&lt;/p&gt;</comment>
                            <comment id="15017529" author="lars_francke" created="Fri, 20 Nov 2015 12:43:28 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12456064" name="hbase_trunk_consistency.patch" size="926" author="hairong" created="Thu, 30 Sep 2010 21:35:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 30 Sep 2010 21:42:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26618</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hkk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100593</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>