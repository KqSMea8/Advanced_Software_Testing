<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:11:22 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3580/HBASE-3580.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3580] Remove RS from DeadServer when new instance checks in</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3580</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Keeping the servers in DeadServer until it reaches some maximum isn&apos;t super friendly, it confuses even the best of our users:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;09:27 &amp;lt; gbowyer&amp;gt; Hi all, I have apparently three dead RS in my cluster, I cannot find references to them in HDFS or in ZK, how do I still report dead RS&lt;br/&gt;
09:27 &amp;lt; gbowyer&amp;gt; also the same nodes are reported as live region servers&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The subtil startcode difference can be hard to catch, also this behavior differs from 0.20 (so old users get confused, like I did when debugging this problem) and it also differs from Hadoop&apos;s handling of dead DataNodes. It was introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3282&quot; title=&quot;Need to retain DeadServers to ensure we don&amp;#39;t allow previously expired RS instances to rejoin cluster&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3282&quot;&gt;&lt;del&gt;HBASE-3282&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think this should be improved by doing like Hadoop does, removing the RS from DeadServers when a new instance with the same hostname+port checks in. Stack says we should do it in ServerManager.checkIsDead&lt;/p&gt;</description>
                <environment></environment>
        <key id="12499958">HBASE-3580</key>
            <summary>Remove RS from DeadServer when new instance checks in</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Feb 2011 18:15:48 +0000</created>
                <updated>Fri, 20 Nov 2015 12:41:23 +0000</updated>
                            <resolved>Wed, 20 Apr 2011 22:00:01 +0000</resolved>
                                    <version>0.90.0</version>
                                    <fixVersion>0.90.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13000448" author="tlipcon" created="Mon, 28 Feb 2011 18:24:46 +0000"  >&lt;p&gt;If we do this, will it still properly tell the dead RS to go away if it were to come back to life? ie do we do some compare to check if there&apos;s already a dead or live RS with the same port and a newer startcode?&lt;/p&gt;</comment>
                            <comment id="13000456" author="jdcryans" created="Mon, 28 Feb 2011 18:33:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;ie do we do some compare to check if there&apos;s already a dead or live RS with the same port and a newer startcode?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We currently check the full servername in checkIsDead, also I don&apos;t think you can have 2 region servers running on the same port so the old instance would be really dead when you start the new one.&lt;/p&gt;</comment>
                            <comment id="13000657" author="ryanobjc" created="Tue, 1 Mar 2011 01:37:23 +0000"  >&lt;p&gt;presumably the new regionserver has a new startcode, so therefore the old one with the older start code cannot exist anymore, that seems sound to me.&lt;/p&gt;</comment>
                            <comment id="13001216" author="iamknome" created="Wed, 2 Mar 2011 00:54:18 +0000"  >&lt;p&gt;As per conversation with jdcryans:&lt;br/&gt;
1. Removed the deadServerList&lt;br/&gt;
2. Check whether the server reporting for duty is a dead one coming back alive, and if so, update the deadserverList and remove this server. &lt;/p&gt;</comment>
                            <comment id="13001217" author="iamknome" created="Wed, 2 Mar 2011 00:55:38 +0000"  >&lt;p&gt;Submitted first draft of the patch. &lt;/p&gt;

&lt;p&gt;Will include/update necessary test cases based on review comments. &lt;/p&gt;</comment>
                            <comment id="13002348" author="jdcryans" created="Fri, 4 Mar 2011 00:17:28 +0000"  >&lt;p&gt;In DeadServer.remove, don&apos;t decrement numprocessing since it&apos;s already done way before that.&lt;/p&gt;

&lt;p&gt;The new DeadServer.isDeadServerComingBackAlive doesn&apos;t look right. It says the server name can be passed as either form, but then tells HSI.isServer that it&apos;s passing hostAndPortOnly.&lt;/p&gt;

&lt;p&gt;In ServerManager, I don&apos;t think you should use 2 methods... it looks more confusing than it should be:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!IsDeadServerComingBackAlive(serverName)) {
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadservers.isDeadServer(serverName)) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;BTW don&apos;t use upper case for the first letter of the first word in the method name.&lt;/p&gt;

&lt;p&gt;Also this won&apos;t work:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadservers.remove(serverName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since it&apos;s the full server name (host,port,startcode) and we check if it&apos;s not dead, then it definitely shouldn&apos;t be in there!&lt;/p&gt;

&lt;p&gt;What should be done instead is checking if the full servername is in DeadServer, if not then also check if its host+port form is in there and if it is then delete it.&lt;/p&gt;</comment>
                            <comment id="13002804" author="iamknome" created="Fri, 4 Mar 2011 20:47:35 +0000"  >&lt;p&gt;1. Added test cases&lt;br/&gt;
2. Fixed the logic as per jdcryans suggestions.&lt;/p&gt;</comment>
                            <comment id="13002806" author="iamknome" created="Fri, 4 Mar 2011 20:48:56 +0000"  >&lt;p&gt;jdcryans: Thanks for the review comments. I had already figured out that some thing was not quite right and prepared the next version of patch that addresses your concerns.&lt;/p&gt;

&lt;p&gt;I have attached the patch and the only thing that I am not sure about is: &lt;/p&gt;

&lt;p&gt;This patch assumes that the server name in the deadServer set is always going to be in the format of &lt;br/&gt;
&amp;lt;serverName,port,startcode&amp;gt; and wondering whether we should handle cases where it could also be &lt;br/&gt;
&amp;lt;serverName:port&amp;gt;?&lt;/p&gt;

&lt;p&gt;Please let me know and I will be more than happy to address that as well.&lt;/p&gt;</comment>
                            <comment id="13005525" author="stack" created="Fri, 11 Mar 2011 06:57:39 +0000"  >&lt;p&gt;Marking patch available&lt;/p&gt;</comment>
                            <comment id="13010906" author="stack" created="Thu, 24 Mar 2011 20:42:08 +0000"  >&lt;p&gt;The hardcoding of port numbers in the test look wrong Subbu.  Does it work every time you run the test?&lt;/p&gt;</comment>
                            <comment id="13014078" author="jdcryans" created="Thu, 31 Mar 2011 17:16:15 +0000"  >&lt;p&gt;Bringing back in 0.90.3, also Subbu could you checkout what Stack said about the patch?&lt;/p&gt;</comment>
                            <comment id="13021340" author="jdcryans" created="Mon, 18 Apr 2011 23:34:03 +0000"  >&lt;p&gt;I refactored Subbu&apos;s patch (long lines, long variable names, bad indent) and by testing it I saw that it wasn&apos;t removing the right server name from the dead list (it was passing the new name instead).&lt;/p&gt;

&lt;p&gt;I think this is good for commit.&lt;/p&gt;</comment>
                            <comment id="13021400" author="stack" created="Tue, 19 Apr 2011 04:10:50 +0000"  >&lt;p&gt;Are port numbers hardcoded?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// Already dead =       127.0.0.1,9090,112321
&lt;/span&gt;+    &lt;span class=&quot;code-comment&quot;&gt;// Coming back alive =  127.0.0.1,9090,223341&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If so, do they have to be?&lt;/p&gt;

&lt;p&gt;Otherwise patch looks good to me.&lt;/p&gt;</comment>
                            <comment id="13021402" author="jdcryans" created="Tue, 19 Apr 2011 04:12:58 +0000"  >&lt;p&gt;It&apos;s just strings used to play with DeadServer, no region server is being started in this test.&lt;/p&gt;</comment>
                            <comment id="13021659" author="stack" created="Tue, 19 Apr 2011 16:54:36 +0000"  >&lt;p&gt;I missed that.&lt;/p&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13022326" author="iamknome" created="Wed, 20 Apr 2011 19:31:46 +0000"  >&lt;p&gt;thanks JD for taking a closer look. I reviewed your patch and it looks good to me.&lt;/p&gt;

&lt;p&gt;+1 for a commit.&lt;/p&gt;</comment>
                            <comment id="13022394" author="jdcryans" created="Wed, 20 Apr 2011 22:00:01 +0000"  >&lt;p&gt;Committed to branch and trunk with a fix for a typo in HServerInfo, thanks Subbu for the initial work and Stack for the review!&lt;/p&gt;</comment>
                            <comment id="15016963" author="lars_francke" created="Fri, 20 Nov 2015 12:41:23 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12522366">HBASE-4359</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12472377" name="HBASE-3580-Remove-RS-from-DeadServer-when-new-instance-checks-in.patch" size="4148" author="iamknome" created="Wed, 2 Mar 2011 00:54:18 +0000"/>
                            <attachment id="12476665" name="HBASE-3580-v3.patch" size="6338" author="jdcryans" created="Mon, 18 Apr 2011 23:34:03 +0000"/>
                            <attachment id="12472700" name="HBASE-3580_-_Remove_RS_from_dead_server_when_the_RS_when_new_instance_checks_in3.patch" size="7396" author="iamknome" created="Fri, 4 Mar 2011 20:47:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 28 Feb 2011 18:24:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33098</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hmvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100967</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>