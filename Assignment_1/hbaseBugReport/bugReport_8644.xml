<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:57:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8644/HBASE-8644.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8644] &quot;hbck -fixReferenceFiles&quot; checks for write permissions in / even if sidelineDir is specified</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8644</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We found a situation where a temporary reference file got left in META&apos;s recovered.edits directory and this was causing hbck to report inconsistency with HBase.  When trying to repair it with the &quot;hbck -fixReferenceFiles&quot; command, an access control exception was thrown, because hbck was trying to put the sidelined reference file in the root of HDFS and the hbase user did not have permissions.  But even after specifying a &quot;sidelineDir&quot; (hbck -fixReferenceFiles -sidelineDir hdfs://&amp;lt;namespace&amp;gt;/tmp), the same exception was thrown (logs obfuscated below):&lt;/p&gt;

&lt;p&gt;INFO util.HBaseFsck: Trying to sildeline reference filehdfs://&amp;lt;namespace&amp;gt;/hbase/.META./1028685194/recovered.edits/0000000000000000016.temp to hdfs://&amp;lt;namespace&amp;gt;/0000000000000000016.temp &lt;br/&gt;
Exception in thread &quot;main&quot; org.apache.hadoop.security.AccessControlException: Permission denied: user=hbase, access=WRITE, inode=&quot;/&quot;:hdfs:hadoop:drwxr-xr-x &lt;/p&gt;

&lt;p&gt;Since the operation requires moving data around in HDFS, we tried the same command as the &quot;hdfs&quot; user which should have no permission problems, but an exception was thrown nonetheless:&lt;/p&gt;

&lt;p&gt;... &lt;br/&gt;
WARN util.HBaseFsck: Got AccessControlException when preCheckPermission &lt;br/&gt;
org.apache.hadoop.security.AccessControlException: Permission denied: action=WRITE path=hdfs://&amp;lt;namespace&amp;gt;/hbase/&lt;del&gt;ROOT&lt;/del&gt; user=hdfs &lt;/p&gt;

&lt;p&gt;Ultimately in order to get this working, we ran this command to tell hbck to not run it&apos;s prechecks:&lt;/p&gt;

&lt;p&gt;hbase hbck -fixReferenceFiles -sidelineDir hdfs://&amp;lt;namespace&amp;gt;/tmp -ignorePreCheckPermission&lt;/p&gt;


&lt;p&gt;A few thoughts here:&lt;/p&gt;

&lt;p&gt;1) it seems that / is a bad default location to attempt to sideline files&lt;/p&gt;

&lt;p&gt;2) shouldn&apos;t hbck be run as the hbase user?  If so, it should sideline files to a directory it has write permissions to.&lt;/p&gt;

&lt;p&gt;3) if we expect hbck to be run as the hdfs user, permissions should not be denied that user when HDFS itself will not deny them.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12649993">HBASE-8644</key>
            <summary>&quot;hbck -fixReferenceFiles&quot; checks for write permissions in / even if sidelineDir is specified</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="heathcd">Clint Heath</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 May 2013 19:53:54 +0000</created>
                <updated>Wed, 29 May 2013 19:53:54 +0000</updated>
                                            <version>0.94.2</version>
                                                    <component>hbck</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>330320</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 29 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1kzkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>330654</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>