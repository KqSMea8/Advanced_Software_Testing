<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:14:47 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3984/HBASE-3984.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3984] CT.verifyRegionLocation isn&apos;t doing a very good check, can delay cluster recovery</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3984</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;After some extensive debugging in the thread &lt;a href=&quot;http://search-hadoop.com/m/Qb0BMnrTPZ1&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;A sudden msg of &quot;java.io.IOException: Server not running, aborting&quot;&lt;/a&gt;, we figured that the region servers weren&apos;t able to talk to the new .META. location because the old one was still alive but on it&apos;s way down after a OOME.&lt;/p&gt;

&lt;p&gt;It translates into exceptions like &quot;Server not running&quot; coming from trying to edit .META. and digging in the code I see that CT.waitForMetaServerConnectionDefault -&amp;gt; waitForMeta -&amp;gt; getMetaServerConnection(true) calls verifyRegionLocation since we force the refresh. In this method we check if the RS is good by calling getRegionInfo which &lt;b&gt;does not&lt;/b&gt; check if the region server is trying to close.&lt;/p&gt;

&lt;p&gt;What this means is that a cluster can&apos;t recover a .META.-serving RS failure until it has fully shutdown since every time a RS tries to open a region (like right after the log splitting) or split it fails editing .META.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12510126">HBASE-3984</key>
            <summary>CT.verifyRegionLocation isn&apos;t doing a very good check, can delay cluster recovery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Mon, 13 Jun 2011 18:36:14 +0000</created>
                <updated>Fri, 20 Nov 2015 11:53:47 +0000</updated>
                            <resolved>Wed, 29 Jun 2011 22:29:10 +0000</resolved>
                                    <version>0.90.3</version>
                                    <fixVersion>0.90.4</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13052951" author="jdcryans" created="Tue, 21 Jun 2011 23:56:22 +0000"  >&lt;p&gt;Those patches for branch and trunk fix the issue by adding the checkOpen call to every method exposed HRegionInterface except in branch were I needed to add a IOException to one method so that change is only in trunk.&lt;/p&gt;</comment>
                            <comment id="13053029" author="stack" created="Wed, 22 Jun 2011 03:51:54 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13053493" author="jdcryans" created="Wed, 22 Jun 2011 21:56:59 +0000"  >&lt;p&gt;Now that I&apos;m running the unit tests, I can see that the Master doesn&apos;t handle the case where it&apos;s assigning a region to a region server that is shutting down. This will create some ripples, I&apos;ll try to keep it contained on trunk.&lt;/p&gt;</comment>
                            <comment id="13053554" author="jdcryans" created="Thu, 23 Jun 2011 00:09:16 +0000"  >&lt;p&gt;Less risky version of the patch for 0.90, passes the unit tests.&lt;/p&gt;</comment>
                            <comment id="13053638" author="stack" created="Thu, 23 Jun 2011 04:07:40 +0000"  >&lt;p&gt;+1 again for trunk patch. +1 on 0.90 patch but how do you get away w/o amending tests?  You are not changing everywhere?&lt;/p&gt;</comment>
                            <comment id="13053640" author="stack" created="Thu, 23 Jun 2011 04:09:28 +0000"  >&lt;p&gt;Were you going to change the exception that comes up out of checkOpen?&lt;/p&gt;</comment>
                            <comment id="13053647" author="jdcryans" created="Thu, 23 Jun 2011 04:42:41 +0000"  >&lt;p&gt;I haven&apos;t changed trunk yet after today&apos;s discoveries, that&apos;s where the meaty part is. I don&apos;t want that in 0.90, I&apos;m keeping it more confined in order to change as less code as possible but still fixing the bug.&lt;/p&gt;</comment>
                            <comment id="13056824" author="jdcryans" created="Tue, 28 Jun 2011 22:29:27 +0000"  >&lt;p&gt;New patch for trunk that introduces a new exception for when a RS is asked to shutdown. It had a few ripple effects since some methods were accessed in the unit tests even after a RS was asked to shutdown (that&apos;s why I needed to change the way we wait on RSs to die in one test).&lt;/p&gt;

&lt;p&gt;I&apos;m also modifying the behavior of SingleServerBulkAssigner, it will not kill the master anymore when it gets an exception trying to talk to a RS (unless it&apos;s interrupted). Instead it will just log the problem and the RIT will get timed out by the TimeoutMonitor. It currently works for TestSplitTransactionOnCluster.&lt;/p&gt;

&lt;p&gt;Most of the unit test pass but it&apos;s hard to tell with all the others that are already failing if it&apos;s caused by this patch.&lt;/p&gt;</comment>
                            <comment id="13056832" author="stack" created="Tue, 28 Jun 2011 22:41:20 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13056835" author="yuzhihong@gmail.com" created="Tue, 28 Jun 2011 22:42:41 +0000"  >&lt;p&gt;In TestSplitTransactionOnCluster.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (cluster.getMaster().getClusterStatus().getServers().size() == 2) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Maybe a constant should be introduced, e.g. INIT_CLUSTER_SIZE so that it can be used by TESTING_UTIL.startMiniCluster() as well.&lt;/p&gt;</comment>
                            <comment id="13057522" author="jdcryans" created="Wed, 29 Jun 2011 22:29:10 +0000"  >&lt;p&gt;Commmitted the 0.90 patch to branch and the other patch to trunk including the fix that Ted pointed to. Thanks guys for the reviews.&lt;/p&gt;</comment>
                            <comment id="13057587" author="hudson" created="Thu, 30 Jun 2011 02:37:58 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1998 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/1998/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/1998/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3984&quot; title=&quot;CT.verifyRegionLocation isn&amp;#39;t doing a very good check, can delay cluster recovery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3984&quot;&gt;&lt;del&gt;HBASE-3984&lt;/del&gt;&lt;/a&gt;  CT.verifyRegionLocation isn&apos;t doing a very good check,&lt;br/&gt;
            can delay cluster recovery&lt;/p&gt;

&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HBaseServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HRegionInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestHMasterRPCException.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/TestGlobalMemStoreSize.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerStoppedException.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/ServerNotRunningYetException.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestRollingRestart.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransactionOnCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/ServerNotRunningException.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15016062" author="lars_francke" created="Fri, 20 Nov 2015 11:53:47 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12483525" name="HBASE-3984-0.90-v2.patch" size="3152" author="jdcryans" created="Thu, 23 Jun 2011 00:09:16 +0000"/>
                            <attachment id="12483375" name="HBASE-3984-0.90.patch" size="4104" author="jdcryans" created="Tue, 21 Jun 2011 23:56:22 +0000"/>
                            <attachment id="12484571" name="HBASE-3984-trunk-v2.patch" size="26816" author="jdcryans" created="Tue, 28 Jun 2011 22:29:27 +0000"/>
                            <attachment id="12483376" name="HBASE-3984-trunk.patch" size="11931" author="jdcryans" created="Tue, 21 Jun 2011 23:56:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 22 Jun 2011 03:51:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27119</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hou7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101286</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>In trunk:&lt;br/&gt;
All HRegionInferface methods will now throw a RegionServerStoppedException if it&amp;#39;s in that state, whereas we used to only check it for a few methods.&lt;br/&gt;
SingleServerBulkAssigner will not kill the Master anymore when getting IOEs, instead it will just log an error and the TimeoutMonitor will take care of picking up the pieces.&lt;br/&gt;
&lt;br/&gt;
In 0.90:&lt;br/&gt;
Only a couple of checkOpen calls were added in order to change as less code as possible while still fixing the issue.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>