<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:01:12 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2358/HBASE-2358.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2358] Store doReconstructionLog will fail if oldlogfile.log is empty and won&apos;t load region</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2358</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;doReconstructionLog doesn&apos;t handle empty files correctly:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    FileStatus stat = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs.getFileStatus(reconstructionLog);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stat.getLen() &amp;lt;= 0) {
      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Passed reconstruction log &quot;&lt;/span&gt; + reconstructionLog +
        &lt;span class=&quot;code-quote&quot;&gt;&quot; is zero-length. Deleting existing file&quot;&lt;/span&gt;);
       fs.delete(reconstructionLog, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice it actually compares the length of the array instead of the file length.&lt;/p&gt;

&lt;p&gt;It should call getLen() and delete the file afterwards&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   FileStatus stat = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs.getFileStatus(reconstructionLog);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stat.getLen() &amp;lt;= 0) {
      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Passed reconstruction log &quot;&lt;/span&gt; + reconstructionLog +
        &lt;span class=&quot;code-quote&quot;&gt;&quot; is zero-length. Deleting existing file&quot;&lt;/span&gt;);
       fs.delete(reconstructionLog, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also. This is a situation that shouldn&apos;t happen as an empty oldlogfile.log should be deleted when HMaster does the split in HLog.splitLog().&lt;br/&gt;
I couldn&apos;t figure what would make it leave it there as I also see in the logs that other empty logs are deleted. This might expose a thornier situation.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Any&lt;/p&gt;</environment>
        <key id="12459890">HBASE-2358</key>
            <summary>Store doReconstructionLog will fail if oldlogfile.log is empty and won&apos;t load region</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="clehene">Cosmin Lehene</assignee>
                                    <reporter username="clehene">Cosmin Lehene</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Mar 2010 18:01:37 +0000</created>
                <updated>Fri, 12 Oct 2012 06:15:01 +0000</updated>
                            <resolved>Mon, 22 Mar 2010 21:40:32 +0000</resolved>
                                    <version>0.20.3</version>
                                    <fixVersion>0.20.4</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                    <component>regionserver</component>
                        <due>Tue, 23 Mar 2010 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="12848249" author="clehene" created="Mon, 22 Mar 2010 18:04:07 +0000"  >&lt;p&gt;Attaching a patch to check for file length correctly and delete the empty file. &lt;/p&gt;</comment>
                            <comment id="12848251" author="clehene" created="Mon, 22 Mar 2010 18:05:03 +0000"  >&lt;p&gt;Linking &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1994&quot; title=&quot;Master will lose hlog entries while splitting if region has empty oldlogfile.log&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1994&quot;&gt;&lt;del&gt;HBASE-1994&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12848252" author="clehene" created="Mon, 22 Mar 2010 18:06:13 +0000"  >&lt;p&gt;redoing the link with &quot;relates to&quot; instead of &quot;blocks&quot;&lt;/p&gt;</comment>
                            <comment id="12848296" author="stack" created="Mon, 22 Mar 2010 19:27:26 +0000"  >&lt;p&gt;Add into 0.20.4.&lt;/p&gt;</comment>
                            <comment id="12848367" author="stack" created="Mon, 22 Mar 2010 21:40:32 +0000"  >&lt;p&gt;Applied to branch and trunk.  I agree that the fact that this file is zero in first place is symptom of some other problem but empty log shouldn&apos;t get in the way of our deploying a region.  Thanks for the patch Cosmin.&lt;/p&gt;</comment>
                            <comment id="12848375" author="tlipcon" created="Mon, 22 Mar 2010 21:51:29 +0000"  >&lt;p&gt;Are you seeing this issue in practice, Cosmin?&lt;/p&gt;

&lt;p&gt;To me it seems like a sign of a serious problem, so we should get at the root of it (not just band-aid it)&lt;/p&gt;</comment>
                            <comment id="12848381" author="stack" created="Mon, 22 Mar 2010 22:00:20 +0000"  >&lt;p&gt;I can revert if thought is that this is a &quot;band-aid&quot; and that its better to have the horrorshow failure because it&apos;ll bring spotlight to root cause.&lt;/p&gt;</comment>
                            <comment id="12848386" author="tlipcon" created="Mon, 22 Mar 2010 22:07:27 +0000"  >&lt;p&gt;eh, I&apos;m sensitive to the needs of people running in production who can tolerate a bit of dataloss. For them, the bandaid makes sense. I opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2363&quot; title=&quot;Add configuration for tunable dataloss sensitivity&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2363&quot;&gt;&lt;del&gt;HBASE-2363&lt;/del&gt;&lt;/a&gt; to discuss maybe making band-aids a tunable option.&lt;/p&gt;</comment>
                            <comment id="12848552" author="clehene" created="Tue, 23 Mar 2010 05:59:39 +0000"  >&lt;p&gt;Todd,&lt;/p&gt;

&lt;p&gt;We&apos;ve just seen this yesterday. It happened on a cluster that was running a trunk snapshot from Feburary. It was a fix for the previous &quot;band-aid&quot; and I didn&apos;t get to look on the HLog code, but I&apos;ll give it thorough look. &lt;/p&gt;

&lt;p&gt;Also, I suggest we instrument the code to measure coverage and run a server for a while to identify dead or seldom touched code so we could review it. &lt;/p&gt;</comment>
                            <comment id="12848553" author="tlipcon" created="Tue, 23 Mar 2010 06:02:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also, I suggest we instrument the code to measure coverage and run a server for a while to identify dead or seldom touched code so we could review it. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Great idea! I&apos;ll add this to the ticket about end-to-end testing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12441192">HBASE-1994</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12439479" name="HBASE-2358.patch" size="1056" author="clehene" created="Mon, 22 Mar 2010 18:04:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 22 Mar 2010 19:27:26 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 39 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00xav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3327</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>