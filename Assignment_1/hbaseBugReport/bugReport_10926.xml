<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:18:31 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10926/HBASE-10926.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10926] Use global procedure to flush table memstore cache</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10926</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently, user can trigger table flush through hbase shell or HBaseAdmin API.  To flush the table cache, each region server hosting the regions is contacted and flushed sequentially, which is less efficient.&lt;br/&gt;
In HBase snapshot global procedure is used to coordinate and flush the regions in a distributed way.&lt;br/&gt;
Let&apos;s provide a distributed table flush for general use.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12707087">HBASE-10926</key>
            <summary>Use global procedure to flush table memstore cache</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jinghe">Jerry He</assignee>
                                    <reporter username="jinghe">Jerry He</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Apr 2014 00:58:51 +0000</created>
                <updated>Sat, 21 Feb 2015 23:31:25 +0000</updated>
                            <resolved>Sun, 4 May 2014 18:05:55 +0000</resolved>
                                    <version>0.96.2</version>
                    <version>0.98.1</version>
                                    <fixVersion>0.99.0</fixVersion>
                                    <component>Admin</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>15</watches>
                                                                <comments>
                            <comment id="13963088" author="apurtell" created="Tue, 8 Apr 2014 15:41:15 +0000"  >&lt;p&gt;+1!&lt;/p&gt;</comment>
                            <comment id="13983262" author="jinghe" created="Mon, 28 Apr 2014 17:34:43 +0000"  >&lt;p&gt;Attached v1 for the patch.&lt;br/&gt;
Here is the summary:&lt;/p&gt;

&lt;p&gt;New files:&lt;/p&gt;

&lt;p&gt;MasterFlushTableProcedureManager  &lt;br/&gt;
         &amp;#8211; Initiate global procedure from the master.  Similar to SnapshotManager.&lt;/p&gt;

&lt;p&gt;RegionServerFlushTableProcedureManager  &lt;br/&gt;
         &amp;#8211; Prodecure manager/memeber on the region server.  Similar to RegionServerSnapshotManager.&lt;/p&gt;

&lt;p&gt;FlushTableSubprocedure&lt;br/&gt;
         &amp;#8211; The subprodure that does the actual work on the region server.  Similar to FlushSnapshotSubprocedure.&lt;/p&gt;

&lt;p&gt;Changes:&lt;/p&gt;

&lt;p&gt;HBaseAdmin  &lt;br/&gt;
       &amp;#8211; Invokes exeProcedure&lt;/p&gt;

&lt;p&gt;HMaster &lt;br/&gt;
       &amp;#8211; Register MasterFlushTableProcedureManager&lt;/p&gt;

&lt;p&gt;RegionServerProcedureManagerHost  &lt;br/&gt;
      &amp;#8211; Register RegionServerFlushTableProcedureManager&lt;/p&gt;</comment>
                            <comment id="13983273" author="mbertozzi" created="Mon, 28 Apr 2014 17:41:16 +0000"  >&lt;p&gt;quick look and the code looks good to me&lt;/p&gt;

&lt;p&gt;a couple of notes, hbase.procedure only contains the &quot;Procedure infrastructure&quot;&lt;br/&gt;
i guess you can move the flush procedure in hbase.regionserver.flushprocedure or hbase.procedure.flush or somewhere else.&lt;br/&gt;
The RegionServerFlushTableProcedureManager looks like a copy-paste from the snapshot one&lt;br/&gt;
can you think a way to remove some steps? I was thinking at maybe we can get something like&lt;br/&gt;
OnlineRegionsProcedureManager as base class for all the operations that tries to execute something&lt;br/&gt;
on all the online regions (but this may be done as separate jira).&lt;/p&gt;

&lt;p&gt;what happens if a region is down or not responding within the timeout? no one executes the flush?&lt;br/&gt;
can you document the semantic change in the Admin documentation, if the above is true&lt;/p&gt;</comment>
                            <comment id="13983274" author="yuzhihong@gmail.com" created="Mon, 28 Apr 2014 17:41:20 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+@InterfaceAudience.Private
+@InterfaceStability.Unstable
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class FlushTableSubprocedure &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Subprocedure {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Private implies Unstable.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-comment&quot;&gt;// Using the completion service to process the futures that finish first first.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;first&apos; was repeated.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          Future&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Void&lt;/span&gt;&amp;gt; f = taskPool.take();
+          f.get();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You may want to add timeout for the get() call.&lt;/p&gt;</comment>
                            <comment id="13983392" author="stack" created="Mon, 28 Apr 2014 18:58:47 +0000"  >&lt;p&gt;Should the subprocedure be in the regionserver package since that is what it is working against?&lt;/p&gt;

&lt;p&gt;This is probably your just picking up the pattern from snapshots but why this:&lt;/p&gt;

&lt;p&gt;+  private final FlushTableSubprocedurePool taskManager;&lt;/p&gt;

&lt;p&gt;How does a task manager become a pool?&lt;/p&gt;

&lt;p&gt;Do the new classes have to be public?  Can they be package private?&lt;/p&gt;

&lt;p&gt;Should +public class MasterFlushTableProcedureManager extends MasterProcedureManager { be in the master package?  And RegionServerProcedureManager in RS package?&lt;/p&gt;

&lt;p&gt;This is interesting.  Probably should add a short circuit for this in:&lt;/p&gt;

&lt;p&gt;+    // We need to run the subprocedure even if we have no relevant regions.  The coordinator&lt;br/&gt;
+    // expects participation in the procedure and without sending message the master procedure&lt;br/&gt;
+    // will hang and fail.&lt;/p&gt;

&lt;p&gt;No need of a test?&lt;/p&gt;

&lt;p&gt;Whatever Matteo said.&lt;/p&gt;

&lt;p&gt;This is nice work Jerry.  Thanks for using Procedure.&lt;/p&gt;

&lt;p&gt;Separate, could we do a revamp of the naming of Procedure participants now it has been around a while (it is all private so should be safe)?  ForeignException, ProcedureMember always have me scrambling to read class and package doc because trouble figuring their roles. Should rethrowException be rethrowIfException?&lt;/p&gt;</comment>
                            <comment id="13983422" author="mbertozzi" created="Mon, 28 Apr 2014 19:14:17 +0000"  >&lt;blockquote&gt;
&lt;p&gt;// We need to run the subprocedure even if we have no relevant regions.  The coordinator&lt;br/&gt;
// expects participation in the procedure and without sending message the master procedure&lt;br/&gt;
// will hang and fail.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt; This comment is a bit misleading. The Mater procedure includes in the &quot;procedure&quot; only the &lt;br/&gt;
RSs that are handling regions of the specified table (grep getTableRegionsAndLocations).&lt;br/&gt;
but you may end up in the case where the master send a request to a RS and the RS has just moved &quot;all&quot; the regions of the table that you want to flush.&lt;br/&gt;
It also means that the moved regions will not be flushed, but this may not be a problem in this case, since their cache is already &quot;empty&quot; due to the restart.&lt;/p&gt;</comment>
                            <comment id="13983433" author="stack" created="Mon, 28 Apr 2014 19:22:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt; Thanks.  Maybe in new patch Jerry you can add some qualification.  Thanks.&lt;/p&gt;</comment>
                            <comment id="13983437" author="hadoopqa" created="Mon, 28 Apr 2014 19:23:46 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12642282/HBASE-10926-trunk-v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12642282/HBASE-10926-trunk-v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12642282&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +  private static final String CONCURENT_FLUSH_TASKS_KEY = &quot;hbase.flush.procedure.region.concurrentTasks&quot;;&lt;br/&gt;
+  public static final String FLUSH_REQUEST_THREADS_KEY = &quot;hbase.flush.procedure.region.pool.threads&quot;;&lt;br/&gt;
+  public static final String FLUSH_REQUEST_WAKE_MILLIS_KEY = &quot;hbase.flush.procedure.region.wakefrequency&quot;;&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9414//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13983514" author="jinghe" created="Mon, 28 Apr 2014 20:43:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;&lt;br/&gt;
Thanks for the quick review.&lt;br/&gt;
For the location of the new files, what about I move them to hbase.procedure.flush?&lt;br/&gt;
There are indeed a lot of duplicate code in the ProcedureManager side and in the SubProcedure side.&lt;br/&gt;
Unfortunately some of them are common boilerplate code to set up procedure and get it going.&lt;br/&gt;
Good point. I agree we should be able to provide something like a base template class to include the common. In another JIRA?&lt;/p&gt;</comment>
                            <comment id="13983516" author="mbertozzi" created="Mon, 28 Apr 2014 20:45:39 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;Jerry He&lt;/a&gt; I&apos;m ok on both, use hbase.procedure.flush and the refactor will be done in another jira&lt;/p&gt;</comment>
                            <comment id="13983517" author="jinghe" created="Mon, 28 Apr 2014 20:46:04 +0000"  >&lt;blockquote&gt;&lt;p&gt;For the location of the new files, what about I move them to hbase.procedure.flush?&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13983521" author="jinghe" created="Mon, 28 Apr 2014 20:48:58 +0000"  >&lt;p&gt;Sorry, didn&apos;t see this one from &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Should +public class MasterFlushTableProcedureManager extends MasterProcedureManager { be in the master package? And RegionServerProcedureManager in RS package?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;What do you think about this, Metteo?&lt;/p&gt;</comment>
                            <comment id="13983532" author="jinghe" created="Mon, 28 Apr 2014 21:02:20 +0000"  >&lt;p&gt;Also, regarding any behavior change.&lt;br/&gt;
The original behavior is this:&lt;br/&gt;
   Inside HBaseAdmin, we loop through each region with its region server, and a call is made to the region server directly for a flush.&lt;br/&gt;
   If any region is moved or not available while in the loop, we will log the NotServingRegionException, but continue on the next one.&lt;br/&gt;
The behavior with the distributed procedure:&lt;br/&gt;
   On the master side, we will collect the list of online regions with their region servers. The region servers will be the participating members.&lt;br/&gt;
   On the region server side, each member will again get its list of the online regions for the table, and flush the regions.&lt;br/&gt;
   There could be a race condition when the region moved in between master&apos;s server list and region server flush tasks. We may miss some regions.&lt;br/&gt;
   This miss is similar to the original NotServingRegionException.  But we should have a much smaller window to miss in the distributed case.&lt;br/&gt;
   Any error during flush will be thrown as foreign exception.&lt;/p&gt;</comment>
                            <comment id="13983546" author="jinghe" created="Mon, 28 Apr 2014 21:11:13 +0000"  >&lt;p&gt;HI, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuzhihong%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yuzhihong@gmail.com&quot;&gt;Ted Yu&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The timeout for the taskPool is covered by the timer that dictates almost everything in the procedure.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.executionTimeoutTimer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TimeoutExceptionInjector(monitor, timeout);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I will correct the other things you mentioned.&lt;/p&gt;</comment>
                            <comment id="13983555" author="jinghe" created="Mon, 28 Apr 2014 21:17:36 +0000"  >&lt;p&gt;Regarding testing, I did a search.  There are several places in our UT that invokes/exercises HBaseAdmin.flush().&lt;br/&gt;
This is an existing feature. So we have some coverage already. Please let me know if more is needed, maybe from a different angle?&lt;/p&gt;</comment>
                            <comment id="13983641" author="jinghe" created="Mon, 28 Apr 2014 21:59:57 +0000"  >&lt;p&gt;One more missing piece I need to add is the security check.&lt;br/&gt;
Currently preFlush() check is done on the region server security observer.&lt;br/&gt;
It works well originally since the RPC user from client is checked on the region server.&lt;br/&gt;
But now the master starts the procedure and the region server hosting the regions initiates the flush. That means the principal is &apos;hbase&apos;?&lt;br/&gt;
We need to add preFlush() hook on the procedure master to check CREATE, ADMIN on the table before we start the procedure.&lt;/p&gt;</comment>
                            <comment id="13983717" author="mbertozzi" created="Mon, 28 Apr 2014 23:16:24 +0000"  >&lt;p&gt;The behavior change more is related to the failure case, if a RS is not-responding with the procedure you fail the flush, while with the old method some of them got flushed.&lt;/p&gt;

&lt;p&gt;for where to place the files, i think procedures/flush is ok.&lt;br/&gt;
At least we know that every component is in a single place, the snapshots have the snapshot and rs division but which is conceptually more correct, but more painful when you try to read the code the first time.&lt;/p&gt;

&lt;p&gt;For the testing I think you should add the case where a RS is not responding. I guess you can mock it.&lt;/p&gt;

&lt;p&gt;For the preFlush() you are correct. You have to add the call to the coprocessor on the master side.&lt;/p&gt;

&lt;p&gt;I&apos;m looking at the code in more details, and I think there is something wrong with the MasterFlushTableProcedureManager. execProcedure() starts by resetting the done and call the flush procedure, but there is nothing that prevent multiple calls of flush on the same table or different table.&lt;br/&gt;
This means, that if you call a second flush() while the other is running your &quot;done&quot; flag is not describing what you expect and so on.&lt;/p&gt;</comment>
                            <comment id="13983824" author="jinghe" created="Tue, 29 Apr 2014 00:55:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;The behavior change more is related to the failure case, if a RS is not-responding with the procedure you fail the flush, while with the old method some of them got flushed.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Good point. Since the region servers are not in &apos;reached&apos; state yet, nothing will proceed.  &lt;br/&gt;
If they are in &apos;reached&apos; state, but one of them fails to flush for whatever reason, we will get &apos;some regions flushed, some not&apos; case again.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;execProcedure() starts by resetting the done and call the flush procedure, but there is nothing that prevent multiple calls of flush on the same table or different table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Good catch as well.&lt;br/&gt;
My thinking was to rely on the &apos;procedure name&apos; which is the table name to prevent another flush request for the same table. Only one flush request for the same table at a time.&lt;br/&gt;
But I do want to allow different tables to go through. Will think more on how to accomplish this.  Any suggestion from you is welcome.&lt;/p&gt;</comment>
                            <comment id="13983830" author="mbertozzi" created="Tue, 29 Apr 2014 01:00:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;Only one flush request for the same table at a time.&lt;br/&gt;
But I do want to allow different tables to go through. Will think more on how to accomplish this. Any suggestion from you is welcome.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In the snapshot we used a simple map &amp;lt;TableName, IsInProgress&amp;gt; and when you exec the procedure, you check the map. If is in and is in progress you throw an exception &quot;flush on the same table already running&quot; otherwise you set the In-progress state and go on. and isDone() is using the table name to lookup the state from the map. I guess this is the easy way, maybe someone else have a better idea.&lt;/p&gt;</comment>
                            <comment id="13983931" author="jinghe" created="Tue, 29 Apr 2014 03:06:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;The behavior change more is related to the failure case, if a RS is not-responding with the procedure you fail the flush, while with the old method some of them got flushed.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Regarding this behavior, if I put the flush region tasks in &apos;acquireBarrier&apos; phase, not the &apos;insideBarrier&apos; phase, it will probably help somehow to maintain the old behavior. &lt;br/&gt;
We don&apos;t need to have the agreement or consistency to flush across region servers anyway.&lt;br/&gt;
Any concern?&lt;/p&gt;</comment>
                            <comment id="13983950" author="mbertozzi" created="Tue, 29 Apr 2014 03:37:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;We don&apos;t need to have the agreement or consistency to flush across region servers anyway. Any concern?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ok, I read the description of this jira. and what you really want is just broadcasting a command to all the regions. not using a two-phase commit like system.&lt;/p&gt;

&lt;p&gt;If you look at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9864&quot; title=&quot;Notifications bus for use by cluster members keeping up-to-date on changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9864&quot;&gt;HBASE-9864&lt;/a&gt;, there is some agreement to implement two notification systems. &lt;br/&gt;
a two-phase commit one for broadcasting operations like grant/revoke on every region server (the procedure),&lt;br/&gt;
and another one which is just a &quot;state change&quot; notification, which doesn&apos;t require strong guarantees, which will probably be used by quotas as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11059&quot; title=&quot;ZK-less region assignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11059&quot;&gt;&lt;del&gt;HBASE-11059&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;since you have already done the patch, and all the code seems to be isolated in procedure/flush i guess is fine if you just use acquireBarrier() to do the flush&lt;/p&gt;</comment>
                            <comment id="13985854" author="apurtell" created="Wed, 30 Apr 2014 18:08:21 +0000"  >&lt;blockquote&gt;
&lt;p&gt;One more missing piece I need to add is the security check.&lt;br/&gt;
Currently preFlush() check is done on the region server security observer.&lt;br/&gt;
It works well originally since the RPC user from client is checked on the region server.&lt;br/&gt;
But now the master starts the procedure and the region server hosting the regions initiates the flush. That means the principal is &apos;hbase&apos;?&lt;br/&gt;
We need to add preFlush() hook on the procedure master to check CREATE, ADMIN on the table before we start the procedure.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes it is critical that this behavior is preserved or an unprivileged user can mount a denial of service attack.&lt;/p&gt;</comment>
                            <comment id="13985966" author="stack" created="Wed, 30 Apr 2014 19:39:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;since you have already done the patch, and all the code seems to be isolated in procedure/flush i guess is fine if you just use acquireBarrier() to do the flush&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;m w/ &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt; here.  Can file an issue to refactor once the &apos;state change&apos; notification system goes in.&lt;/p&gt;</comment>
                            <comment id="13987158" author="jinghe" created="Thu, 1 May 2014 23:18:04 +0000"  >&lt;p&gt;Attached v2 that addressed the comments.&lt;/p&gt;

&lt;p&gt;Also more files are involved because security is dragged in.&lt;br/&gt;
Tested on a secure cluster:&lt;br/&gt;
1.  The user has Create or Admin permission on the table.&lt;br/&gt;
2.   The user does not have Create or Admin on the table.&lt;/p&gt;</comment>
                            <comment id="13987174" author="mbertozzi" created="Thu, 1 May 2014 23:31:24 +0000"  >&lt;p&gt;You now have the procMap used for isProcedureDone() but you don&apos;t reject concurrent flush on the same table, is that on purpose?&lt;/p&gt;

&lt;p&gt;There is a missing T in FLUSH_IMEOUT_MILLIS_KEY and I guess the timeout conf is a little bit tricky (I know that you have followed the snapshots). In theory the timeout master should be &amp;gt; than the rs timeout, but you are using the default procedure timeout, so the conf on the rs is &quot;not considered&quot; in case you want to bump that up.&lt;/p&gt;

&lt;p&gt;all the other stuff looks ok to me&lt;/p&gt;</comment>
                            <comment id="13987246" author="jinghe" created="Fri, 2 May 2014 01:34:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;you don&apos;t reject concurrent flush on the same table, is that on purpose?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Concurrent flush on the same table is rejected.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// We rely on the existing Distributed Procedure framework to prevent any concurrent
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// procedure with the same name.
&lt;/span&gt;    Procedure proc = coordinator.startProcedure(monitor, desc.getInstance(),
      &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[0], Lists.newArrayList(regionServers));
    monitor.rethrowException();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (proc == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg = &lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to submit distributed procedure &quot;&lt;/span&gt; + desc.getSignature() + &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &apos;&quot;&lt;/span&gt;
          + desc.getInstance() + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;. &quot;&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot;Another flush procedure is running?&quot;&lt;/span&gt;;
      LOG.error(msg);
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(msg);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the master log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-05-01 11:15:26,630 INFO org.apache.hadoop.hbase.master.HMaster: Client=biadmin&lt;span class=&quot;code-comment&quot;&gt;//9.30.194.18 procedure request &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;: flush-table-proc
&lt;/span&gt;2014-05-01 11:15:26,644 WARN org.apache.hadoop.hbase.procedure.ProcedureCoordinator: Procedure table2 currently running.  Rejecting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; request
2014-05-01 11:15:26,644 ERROR org.apache.hadoop.hbase.procedure.ProcedureCoordinator: Failed to submit procedure &apos;table2&apos;
2014-05-01 11:15:26,644 ERROR org.apache.hadoop.hbase.procedure.flush.MasterFlushTableProcedureManager: Failed to submit distributed procedure flush-table-proc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &apos;table2&apos;. Another flush procedure is running?
2014-05-01 11:15:26,852 INFO org.apache.hadoop.hbase.master.HMaster: Client=biadmin&lt;span class=&quot;code-comment&quot;&gt;//9.30.194.18 procedure request &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;: flush-table-proc
&lt;/span&gt;2014-05-01 11:15:26,869 WARN org.apache.hadoop.hbase.procedure.ProcedureCoordinator: Procedure table2 currently running.  Rejecting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; request
2014-05-01 11:15:26,869 ERROR org.apache.hadoop.hbase.procedure.ProcedureCoordinator: Failed to submit procedure &apos;table2&apos;
2014-05-01 11:15:26,869 ERROR org.apache.hadoop.hbase.procedure.flush.MasterFlushTableProcedureManager: Failed to submit distributed procedure flush-table-proc &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &apos;table2&apos;. Another flush procedure is running?
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Interestingly, in HBaseAdmin executeCallable, which execProcedure() uses , is RPC with retries. So in the log you can see the client just keeps trying until the previous flush procedure completes.&lt;br/&gt;
Then it will be able to run on the same table.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-05-01 11:15:38,788 INFO org.apache.hadoop.hbase.master.HMaster: Client=biadmin&lt;span class=&quot;code-comment&quot;&gt;//9.30.194.18 procedure request &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;: flush-table-proc
&lt;/span&gt;2014-05-01 11:15:38,804 DEBUG org.apache.hadoop.hbase.procedure.ProcedureCoordinator: Procedure table2 was in running list but was completed.  Accepting &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; attempt.
2014-05-01 11:15:38,804 INFO org.apache.hadoop.hbase.procedure.Procedure: Starting procedure &apos;table2&apos;
2014-05-01 11:15:38,804 DEBUG org.apache.hadoop.hbase.errorhandling.TimeoutExceptionInjector: Scheduling process timer to run in: 60000 ms
2014-05-01 11:15:38,804 DEBUG org.apache.hadoop.hbase.procedure.Procedure: Procedure &apos;table2&apos; starting &apos;acquire&apos;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So effectively concurrent requests from the client will be executed sequentially.&lt;/p&gt;</comment>
                            <comment id="13987256" author="mbertozzi" created="Fri, 2 May 2014 01:43:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;Concurrent flush on the same table is rejected.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ok, you rely on the fact that coordinator.startProcedure() will return null since the name is already used...&lt;br/&gt;
I don&apos;t see in the doc of ProcedureCoordinator anything that says that the startProcedure() request is &quot;rejected&quot; if one with the same name is there, you are relying on a current implementation detail, which sounds more an implementation limitation than a feature that we wanted. &lt;br/&gt;
worth adding a comment in both places.&lt;/p&gt;</comment>
                            <comment id="13987284" author="hadoopqa" created="Fri, 2 May 2014 02:57:35 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12642951/HBASE-10926-trunk-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12642951/HBASE-10926-trunk-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12642951&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +            LOG.debug(&quot;Procedure &quot; + procName + &quot; was in running list but was completed.  Accepting new attempt.&quot;);&lt;br/&gt;
+          LOG.debug(&quot;Procedure &quot; + procName + &quot; was in running list but has exception.  Accepting new attempt.&quot;);&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9439//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13987291" author="jinghe" created="Fri, 2 May 2014 03:42:25 +0000"  >&lt;p&gt;This is another testimony of the distributed procedure framework. Solid work there.&lt;br/&gt;
I will add code comment to make it more clear regarding the concurrent procedures with same type and same name.&lt;/p&gt;

&lt;p&gt;I will also make the timeout on the master side to be symmetric with the rs. Not using defaults. &lt;/p&gt;</comment>
                            <comment id="13988087" author="jinghe" created="Fri, 2 May 2014 18:50:51 +0000"  >&lt;p&gt;Attached v3 that addressed the latest comments from Matteo.&lt;/p&gt;</comment>
                            <comment id="13988140" author="mbertozzi" created="Fri, 2 May 2014 19:41:40 +0000"  >&lt;p&gt;v3 looks good to me&lt;/p&gt;</comment>
                            <comment id="13988211" author="yuzhihong@gmail.com" created="Fri, 2 May 2014 20:40:54 +0000"  >&lt;p&gt;lgtm&lt;br/&gt;
nit:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @param ctxc the environment to interact with the framework and master
+   * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
+   */
+  void preTableFlush(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ObserverContext&amp;lt;MasterCoprocessorEnvironment&amp;gt; ctx,
+      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TableName tableName) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Parameter name of ctxc was misspelled. Please add javadoc for tableName.&lt;/p&gt;</comment>
                            <comment id="13988416" author="jinghe" created="Fri, 2 May 2014 23:22:24 +0000"  >&lt;p&gt;Attached v4, update after Ted&apos;s comment.&lt;/p&gt;</comment>
                            <comment id="13988524" author="yuzhihong@gmail.com" created="Sat, 3 May 2014 01:58:49 +0000"  >&lt;p&gt;From &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9450/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9450/console&lt;/a&gt; :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/home/jenkins/tools/maven/latest/bin/mvn clean &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; javadoc:javadoc -DskipTests -DHBasePatchProcess &amp;gt; /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/patchprocess/patchJavadocWarnings.txt 2&amp;gt;&amp;amp;1

There appear to be 2 javadoc warnings generated by the patched build.
...
Tests run: 2, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.193 sec
FATAL: hudson.remoting.RequestAbortedException: java.io.IOException: Unexpected termination of the channel
hudson.remoting.RequestAbortedException: hudson.remoting.RequestAbortedException: java.io.IOException: Unexpected termination of the channel
	at hudson.remoting.RequestAbortedException.wrapForRethrow(RequestAbortedException.java:41)
	at hudson.remoting.RequestAbortedException.wrapForRethrow(RequestAbortedException.java:34)
	at hudson.remoting.Request.call(Request.java:174)
	at hudson.remoting.Channel.call(Channel.java:739)
	at hudson.remoting.RemoteInvocationHandler.invoke(RemoteInvocationHandler.java:168)
	at com.sun.proxy.$Proxy53.join(Unknown Source)
	at hudson.Launcher$RemoteLauncher$ProcImpl.join(Launcher.java:951)
	at hudson.tasks.CommandInterpreter.join(CommandInterpreter.java:137)
	at hudson.tasks.CommandInterpreter.perform(CommandInterpreter.java:97)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please fix javadoc warnings and run test suite - QA bot is not reliable.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13988884" author="apurtell" created="Sun, 4 May 2014 01:04:20 +0000"  >&lt;p&gt;It would be good if you could report back a successful local unit test suite run &lt;span class=&quot;error&quot;&gt;&amp;#91;~jerryjch&amp;#93;&lt;/span&gt;, but the committer can do this at commit time as well. &lt;/p&gt;</comment>
                            <comment id="13989027" author="yuzhihong@gmail.com" created="Sun, 4 May 2014 16:09:18 +0000"  >&lt;p&gt;Test suite passed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[INFO] HBase ............................................. SUCCESS [1.588s]
[INFO] HBase - Common .................................... SUCCESS [30.163s]
[INFO] HBase - Protocol .................................. SUCCESS [0.295s]
[INFO] HBase - Client .................................... SUCCESS [35.068s]
[INFO] HBase - Hadoop Compatibility ...................... SUCCESS [5.062s]
[INFO] HBase - Hadoop Two Compatibility .................. SUCCESS [1.288s]
[INFO] HBase - Prefix Tree ............................... SUCCESS [2.613s]
[INFO] HBase - Server .................................... SUCCESS [1:12:31.923s]
[INFO] HBase - Testing Util .............................. SUCCESS [1.206s]
[INFO] HBase - Thrift .................................... SUCCESS [2:03.521s]
[INFO] HBase - Shell ..................................... SUCCESS [1:44.361s]
[INFO] HBase - Integration Tests ......................... SUCCESS [0.887s]
[INFO] HBase - Examples .................................. SUCCESS [5.497s]
[INFO] HBase - Assembly .................................. SUCCESS [0.806s]
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1:17:44.897s
[INFO] Finished at: Sun May 04 16:04:56 UTC 2014
[INFO] Final Memory: 49M/474M
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13989031" author="yuzhihong@gmail.com" created="Sun, 4 May 2014 16:13:18 +0000"  >&lt;p&gt;Integrated to trunk.&lt;/p&gt;

&lt;p&gt;Thanks for the patch, Jerry.&lt;/p&gt;</comment>
                            <comment id="13989065" author="jinghe" created="Sun, 4 May 2014 17:52:32 +0000"  >&lt;p&gt;Thanks, Ted, Andrew.&lt;br/&gt;
I spent some time yesterday trying to fix javadoc warnings Ted mentioned. I could not see the location of the warnings. &lt;br/&gt;
I tried to run &apos;mvn clean package javadoc:javadoc -DskipTests -DHBasePatchProcess&apos;. But couldn&apos;t find details in the output either.&lt;br/&gt;
I had to turn on javadoc warning in my Eclipse, which shows a bunch of warnings for existing code as well.  &lt;br/&gt;
Was still thinking whether I should fix them or not yesterday ...&lt;/p&gt;</comment>
                            <comment id="13989071" author="apurtell" created="Sun, 4 May 2014 18:05:55 +0000"  >&lt;p&gt;Ted already committed this to trunk &lt;span class=&quot;error&quot;&gt;&amp;#91;~jerryjch&amp;#93;&lt;/span&gt;, so we can fix the javadoc issues with an addendum or follow up issue. &lt;/p&gt;

&lt;p&gt;I think this could be ok to go into 0.98 also. The coprocessor API changes only add new methods. We should consider a bit more if the flush behavior changes are ok in the 0.98 context so will open a backport issue for that discussion.&lt;/p&gt;

&lt;p&gt;Resolving this issue.&lt;/p&gt;</comment>
                            <comment id="13989073" author="apurtell" created="Sun, 4 May 2014 18:07:56 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11114&quot; title=&quot;Backport HBASE-10926 (Use global procedure to flush table memstore cache) to 0.98&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11114&quot;&gt;&lt;del&gt;HBASE-11114&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13989178" author="hudson" created="Sun, 4 May 2014 22:44:22 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5127 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5127/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5127/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10926&quot; title=&quot;Use global procedure to flush table memstore cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10926&quot;&gt;&lt;del&gt;HBASE-10926&lt;/del&gt;&lt;/a&gt; Use global procedure to flush table memstore cache (Jerry He) (tedyu: rev 1592368)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-client/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseMasterObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/MasterObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterCoprocessorHost.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/Procedure.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/ProcedureCoordinator.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/RegionServerProcedureManagerHost.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/Subprocedure.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/FlushTableSubprocedure.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/MasterFlushTableProcedureManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/procedure/flush/RegionServerFlushTableProcedureManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/security/access/AccessController.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/security/visibility/VisibilityController.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14029777" author="apurtell" created="Thu, 12 Jun 2014 20:45:51 +0000"  >&lt;p&gt;I started a minicluster based instance of recent trunk and ran LoadTestTool concurrent with flushing every 10 seconds, to generate a lot of HFiles. In the logs I notice a lot of Procedure related WARNs:&lt;/p&gt;

&lt;p&gt;122 of these logged over 30 minutes: &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;main-EventThread&amp;#93;&lt;/span&gt; procedure.ProcedureCoordinator: Member &apos;cluster_test&apos; is trying to release an unknown procedure &apos;reached&apos;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;112 of these logged over 30 minutes:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;main-EventThread&amp;#93;&lt;/span&gt; procedure.ProcedureMember: A completed old subproc cluster_test is still present, removing&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Given the rate at which I was triggering flushes, there would have been ~180 procedure executions, meaning we had these warnings 67% of the time. At a minimum this is noisy WARN level logging.&lt;/p&gt;</comment>
                            <comment id="14029858" author="yuzhihong@gmail.com" created="Thu, 12 Jun 2014 21:30:58 +0000"  >&lt;p&gt;Would lowering the above logs to DEBUG level be better ?&lt;/p&gt;</comment>
                            <comment id="14029873" author="apurtell" created="Thu, 12 Jun 2014 21:39:40 +0000"  >&lt;p&gt;The first question I have is are those WARN level logs indicative of a problem with this feature or the Procedure framework? &lt;/p&gt;</comment>
                            <comment id="14029882" author="mbertozzi" created="Thu, 12 Jun 2014 21:46:58 +0000"  >&lt;p&gt;The warn means that someone joined the procedure &quot;later&quot;, which in this case is not really a problem.&lt;br/&gt;
but more in general it is part of the problem described in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11221&quot; title=&quot;Make the MasterProcedure aware of RS and Regions changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11221&quot;&gt;HBASE-11221&lt;/a&gt;. once the procedure start it is not aware of the new server joining or regions moving. I&apos;m working on a patch, but I&apos;m stuck in finding a way to make it compatible for a rolling restart.&lt;/p&gt;</comment>
                            <comment id="14029884" author="apurtell" created="Thu, 12 Jun 2014 21:48:02 +0000"  >&lt;p&gt;But is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11221&quot; title=&quot;Make the MasterProcedure aware of RS and Regions changes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11221&quot;&gt;HBASE-11221&lt;/a&gt; relevant in a single master + single RS minicluster? &lt;/p&gt;</comment>
                            <comment id="14029891" author="mbertozzi" created="Thu, 12 Jun 2014 21:52:06 +0000"  >&lt;p&gt;uh.. no in theory you should receive a single event in that case. but if you get the warn means you receive two. let me look into it&lt;/p&gt;</comment>
                            <comment id="14029900" author="apurtell" created="Thu, 12 Jun 2014 21:58:26 +0000"  >&lt;p&gt;To reproduce:&lt;/p&gt;

&lt;p&gt;Prep:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ cd ./src/hbase
$ git checkout master
$ mvn -DskipTests clean install
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In one console:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ./bin/hbase master start
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In another console:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ./bin/hbase org.apache.hadoop.hbase.util.LoadTestTool -num_keys 100000 \
    -read 10:100 -write 1:100:10
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In a third console:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$ ./bin/hbase shell
hbase&amp;gt; while true do ; flush &apos;cluster_test&apos; ; sleep 10 ; end
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14030246" author="jinghe" created="Fri, 13 Jun 2014 04:12:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;main-EventThread&amp;#93;&lt;/span&gt; procedure.ProcedureMember: A completed old subproc cluster_test is still present, removing&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This one seems to be normal and expected. That is the only way to normally remove a completed subproc from the list.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;WARN &lt;span class=&quot;error&quot;&gt;&amp;#91;main-EventThread&amp;#93;&lt;/span&gt; procedure.ProcedureCoordinator: Member &apos;cluster_test&apos; is trying to release an unknown procedure &apos;reached&apos;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This one is puzzling.  It comes from this part in the code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  void memberFinishedBarrier(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; procName, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; member, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] dataFromMember) {
    Procedure proc = procedures.get(procName);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (proc == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Member &apos;&quot;&lt;/span&gt;+ member +&lt;span class=&quot;code-quote&quot;&gt;&quot;&apos; is trying to release an unknown procedure &apos;&quot;&lt;/span&gt;+ procName +&lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&quot;&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
    }
    proc.barrierReleasedByMember(member, dataFromMember);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;cluster_test&apos; should be the proc name.&lt;br/&gt;
Are there any errors/exceptions or procedure timeout in the output?&lt;/p&gt;</comment>
                            <comment id="14030287" author="jinghe" created="Fri, 13 Jun 2014 06:06:33 +0000"  >&lt;p&gt;The normal layout of the zk node for the &apos;reached&apos; phase:&lt;/p&gt;

&lt;p&gt;: |-/hbase/flush-table-proc&lt;br/&gt;
:   |-reached&lt;br/&gt;
:   |----cluster_test&lt;br/&gt;
:   |-------hdtest010.svl.ibm.com,60020,1402634727563&lt;br/&gt;
:   |-------hdtest011.svl.ibm.com,60020,1402634727508&lt;/p&gt;

&lt;p&gt;procName = ZKUtil.getNodeName(ZKUtil.getParent(path))     --&amp;gt; cluster_test&lt;br/&gt;
member = ZKUtil.getNodeName(path)    --&amp;gt;  hdtest010.svl.ibm.com,60020,1402634727563&lt;/p&gt;

&lt;p&gt;But from the warning message, we seem to have the wrong layout (my deduction, not actual test result):&lt;/p&gt;

&lt;p&gt;: |-/hbase/flush-table-proc&lt;br/&gt;
:  |-reached&lt;br/&gt;
:  |----cluster_test&lt;/p&gt;

&lt;p&gt;The leaf nodes were missing.  Therefore we got:&lt;br/&gt;
procName = ZKUtil.getNodeName(ZKUtil.getParent(path))   --&amp;gt; reached&lt;br/&gt;
member = ZKUtil.getNodeName(path)  --&amp;gt;  cluster_test&lt;/p&gt;

&lt;p&gt;Either the leaf node was not created or cleared due to race?&lt;/p&gt;</comment>
                            <comment id="14030288" author="jinghe" created="Fri, 13 Jun 2014 06:08:29 +0000"  >&lt;p&gt;BTW. I am on vacation in China &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;br/&gt;
Access to gmail and google is slow &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14030341" author="mbertozzi" created="Fri, 13 Jun 2014 07:24:23 +0000"  >&lt;p&gt;ZKProcedureCoordinatorRpcs receives a nodeCreated() event on /hbase/flush-table-proc/reached/cluster_test and when we check isReachedPathNode() we don&apos;t verify if the node is the &quot;member&quot; or the root. so the warn is caused by the &quot;root&quot; creation event.&lt;/p&gt;</comment>
                            <comment id="14030585" author="jinghe" created="Fri, 13 Jun 2014 12:49:33 +0000"  >&lt;p&gt;Right, we don&apos;t verify.&lt;br/&gt;
But on the other hand, we don&apos;t &apos;watch&apos; for the parent &apos;root&apos; path on the coordinator side, we only &apos;watch&apos; for the expected member path.  Right?&lt;/p&gt;</comment>
                            <comment id="14030588" author="mbertozzi" created="Fri, 13 Jun 2014 12:55:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;But on the other hand, we don&apos;t &apos;watch&apos; for the parent &apos;root&apos; path on the coordinator side, we only &apos;watch&apos; for the expected member path. Right?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The watcher is on the ProcedureCoordinator not on the members. &lt;br/&gt;
we have a single watcher for all the acquired/reached/abort events.&lt;br/&gt;
so we get the parent events too&lt;/p&gt;</comment>
                            <comment id="14030635" author="jinghe" created="Fri, 13 Jun 2014 13:51:14 +0000"  >&lt;p&gt;On the region server side, we watch for &apos;/hbase/flush-table-proc/reached/cluster_test&apos;.&lt;br/&gt;
The master and region server are the same JVM? and share the same ZK watcher?&lt;/p&gt;</comment>
                            <comment id="14330821" author="enis" created="Sat, 21 Feb 2015 23:31:25 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12633702">HBASE-7912</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12666797">HBASE-9426</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12710741">HBASE-11085</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12706227">HBASE-10900</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12642282" name="HBASE-10926-trunk-v1.patch" size="29722" author="jinghe" created="Mon, 28 Apr 2014 17:25:54 +0000"/>
                            <attachment id="12642951" name="HBASE-10926-trunk-v2.patch" size="42285" author="jinghe" created="Thu, 1 May 2014 23:13:08 +0000"/>
                            <attachment id="12643094" name="HBASE-10926-trunk-v3.patch" size="43556" author="jinghe" created="Fri, 2 May 2014 18:49:58 +0000"/>
                            <attachment id="12643155" name="HBASE-10926-trunk-v4.patch" size="43645" author="jinghe" created="Fri, 2 May 2014 23:21:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Apr 2014 15:41:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385410</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ue9r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385677</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>