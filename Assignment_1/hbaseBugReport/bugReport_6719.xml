<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:39:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6719/HBASE-6719.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6719] [replication] Data will lose if open a Hlog failed more than maxRetriesMultiplier</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6719</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Please Take a look below code&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ReplicationSource.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; openReader(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; sleepMultiplier) {
{
  ...
  &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {

      LOG.warn(peerClusterZnode + &lt;span class=&quot;code-quote&quot;&gt;&quot; Got: &quot;&lt;/span&gt;, ioe);
      &lt;span class=&quot;code-comment&quot;&gt;// TODO Need a better way to determinate &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a file is really gone but
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// TODO without scanning all logs dir
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sleepMultiplier == &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.maxRetriesMultiplier) {
        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Waited too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file, considering dumping&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; !processEndOfFile(); &lt;span class=&quot;code-comment&quot;&gt;// Open a file failed over maxRetriesMultiplier(&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; 10)
&lt;/span&gt;      }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;


  ...
}

  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; processEndOfFile() {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.queue.size() != 0) {    &lt;span class=&quot;code-comment&quot;&gt;// Skipped &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; Hlog . Data loss
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.currentPath = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.position = 0;
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.queueRecovered) {   &lt;span class=&quot;code-comment&quot;&gt;// Terminate Failover Replication source thread ,data loss
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.manager.closeRecoveredQueue(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
      LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Finished recovering the queue&quot;&lt;/span&gt;);
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.running = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
  }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 


&lt;p&gt;Some Time HDFS will meet some problem but actually Hlog file is OK , So after HDFS back  ,Some data will lose and can not find them back in slave cluster.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12606217">HBASE-6719</key>
            <summary>[replication] Data will lose if open a Hlog failed more than maxRetriesMultiplier</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="terry_zhang">terry zhang</assignee>
                                    <reporter username="terry_zhang">terry zhang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Sep 2012 08:49:51 +0000</created>
                <updated>Wed, 16 Nov 2016 22:13:58 +0000</updated>
                                            <version>2.0.0</version>
                                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="13448578" author="terry_zhang" created="Wed, 5 Sep 2012 08:54:22 +0000"  >&lt;p&gt;I think we need to handle the IOException carefully and better not to skip the Hlog unless it is really corrupted. We can log this failture as a fatal in Log and skip the Hlog (by delete the hlog zk node manually ) if we have to.&lt;/p&gt;</comment>
                            <comment id="13448584" author="terry_zhang" created="Wed, 5 Sep 2012 09:10:13 +0000"  >&lt;p&gt;now we can handler it like below:&lt;/p&gt;

&lt;p&gt;hlog size = 0, Hlog queue =0,Recovery thread = yes. Terminate recovery thread(return !processEndOfFile())&lt;br/&gt;
hlog size = 0, Hlog queue =0,Recovery thread = no. Continue Loop (return !processEndOfFile())&lt;br/&gt;
hlog size = 0, Hlog queue !=0,Recovery thread = yes. Skip hlog (return !processEndOfFile())&lt;br/&gt;
hlog size = 0, Hlog queue !=0,Recovery thread = no. skip hlog (return !processEndOfFile())&lt;/p&gt;

&lt;p&gt;hlog size = 1, Hlog queue =0,Recovery thread = yes. LOG as a Fatal mistake in regionserver&apos;s log&lt;br/&gt;
hlog size = 1, Hlog queue =0,Recovery thread = no. LOG as a Fatal mistake in regionserver&apos;s log&lt;br/&gt;
hlog size = 1, Hlog queue !=0,Recovery thread = yes. LOG as a Fatal mistake in regionserver&apos;s log&lt;br/&gt;
hlog size = 1, Hlog queue !=0,Recovery thread = no. LOG as a Fatal mistake in regionserver&apos;s log&lt;/p&gt;</comment>
                            <comment id="13448586" author="terry_zhang" created="Wed, 5 Sep 2012 09:14:52 +0000"  >&lt;p&gt;hlog size=1 Means hlog size is not 0.( hlog size != 0)&lt;/p&gt;</comment>
                            <comment id="13449269" author="lhofhansl" created="Wed, 5 Sep 2012 23:42:40 +0000"  >&lt;p&gt;Looks like this a similar issue to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6649&quot; title=&quot;[0.92 UNIT TESTS] TestReplication.queueFailover occasionally fails [Part-1]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6649&quot;&gt;&lt;del&gt;HBASE-6649&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13450331" author="stack" created="Fri, 7 Sep 2012 04:20:35 +0000"  >&lt;p&gt;Its similar I&apos;d say but can&apos;t fix same way, right Terry?&lt;/p&gt;

&lt;p&gt;Looking at your patch:&lt;/p&gt;

&lt;p&gt;What happens when we return false?  We&apos;ll retry?  That seems right.&lt;/p&gt;

&lt;p&gt;Please make your formatting suit the rest of the file (spaces after &apos;if&apos; and before opening bracket, etc.)&lt;/p&gt;

&lt;p&gt;Should this be a LOG.fatal?  Fatal implies shutdown.  WARN if we are going to go around again on this file?&lt;/p&gt;

&lt;p&gt;You log same message three times though circumstance is different each time you log.  Change the log to suit context?&lt;/p&gt;</comment>
                            <comment id="13453214" author="lhofhansl" created="Tue, 11 Sep 2012 17:39:35 +0000"  >&lt;p&gt;@Terry: What do you think of Stacks comments?&lt;br/&gt;
I would like to cut 0.94.2 soon. 0.94.3 will be soon after, so not a big deal if it gets into the next point release.&lt;/p&gt;</comment>
                            <comment id="13454538" author="lhofhansl" created="Thu, 13 Sep 2012 01:16:47 +0000"  >&lt;p&gt;Can we rewrite the patch this way?&lt;br/&gt;
One concern I have: What if the file is actually gone for some reason? In that case it seems we&apos;d never stop retrying.&lt;/p&gt;

&lt;p&gt;@J-D: what do you think?&lt;/p&gt;</comment>
                            <comment id="13455027" author="jdcryans" created="Thu, 13 Sep 2012 17:27:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can we rewrite the patch this way?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah I think this works.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;One concern I have: What if the file is actually gone for some reason? In that case it seems we&apos;d never stop retrying.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If you go up in the file you&apos;ll see that after we looked everywhere I currently don&apos;t have a good solution for files that are missing completely. Basically my heuristic was &quot;if I can&apos;t open or get to the file and there&apos;s another one that&apos;s available, I&apos;ll dump it&quot;. This indeed doesn&apos;t work if there&apos;s a transient error that lasts long enough for the retries to exhaust.&lt;/p&gt;

&lt;p&gt;Should we introduce a quarantine?&lt;/p&gt;</comment>
                            <comment id="13479627" author="lhofhansl" created="Fri, 19 Oct 2012 05:30:56 +0000"  >&lt;p&gt;Quarantining might be a good solution.&lt;br/&gt;
In any case I do not see this getting committed soon.&lt;br/&gt;
Removing from 0.94 for now.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12604703">HBASE-6649</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12544916" name="6719.txt" size="1119" author="lhofhansl" created="Thu, 13 Sep 2012 01:16:47 +0000"/>
                            <attachment id="12543829" name="hbase-6719.patch" size="1501" author="terry_zhang" created="Wed, 5 Sep 2012 08:54:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 5 Sep 2012 23:42:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241759</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 9 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02cev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11612</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>