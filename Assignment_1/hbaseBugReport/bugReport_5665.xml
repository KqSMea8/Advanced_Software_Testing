<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:29:51 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5665/HBASE-5665.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5665] Repeated split causes HRegionServer failures and breaks table </title>
                <link>https://issues.apache.org/jira/browse/HBASE-5665</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Repeated splits on large tables (2 consecutive would suffice) will essentially &quot;break&quot; the table (and the cluster), unrecoverable.&lt;br/&gt;
The regionserver doing the split dies and the master will get into an infinite loop trying to assign regions that seem to have the files missing from HDFS.&lt;/p&gt;

&lt;p&gt;The table can be disabled once. upon trying to re-enable it, it will remain in an intermediary state forever.&lt;/p&gt;

&lt;p&gt;I was able to reproduce this on a smaller table consistently.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):030:0&amp;gt; (0..10000).each{|x| put &apos;t1&apos;, &lt;span class=&quot;code-quote&quot;&gt;&quot;#{x}&quot;&lt;/span&gt;, &apos;f1:t&apos;, &apos;dd&apos;}
hbase(main):030:0&amp;gt; (0..1000).each{|x| split &apos;t1&apos;, &lt;span class=&quot;code-quote&quot;&gt;&quot;#{x*10}&quot;&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running overlapping splits in parallel (e.g. &quot;#&lt;/p&gt;
{x*10+1}
&lt;p&gt;&quot;, &quot;#&lt;/p&gt;
{x*10+2}
&lt;p&gt;&quot;... ) will reproduce the issue almost instantly and consistently. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-03-28 10:57:16,320 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Offlined parent region t1,,1332957435767.2fb0473f4e71339e88dab0ee0d4dffa1. in META
2012-03-28 10:57:16,321 DEBUG org.apache.hadoop.hbase.regionserver.CompactSplitThread: Split requested &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; t1,5,1332957435767.648d30de55a5cec6fc2f56dcb3c7eee1..  compaction_queue=(0:1), split_queue=10
2012-03-28 10:57:16,343 INFO org.apache.hadoop.hbase.regionserver.SplitRequest: Running rollback/cleanup of failed split of t1,,1332957435767.2fb0473f4e71339e88dab0ee0d4dffa1.; Failed ld2,60020,1332957343833-daughterOpener=2469c5650ea2aeed631eb85d3cdc3124
java.io.IOException: Failed ld2,60020,1332957343833-daughterOpener=2469c5650ea2aeed631eb85d3cdc3124
        at org.apache.hadoop.hbase.regionserver.SplitTransaction.openDaughters(SplitTransaction.java:363)
        at org.apache.hadoop.hbase.regionserver.SplitTransaction.execute(SplitTransaction.java:451)
        at org.apache.hadoop.hbase.regionserver.SplitRequest.run(SplitRequest.java:67)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
Caused by: java.io.FileNotFoundException: File does not exist: /hbase/t1/589c44cabba419c6ad8c9b427e5894e3.2fb0473f4e71339e88dab0ee0d4dffa1/f1/d62a852c25ad44e09518e102ca557237
        at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.openInfo(DFSClient.java:1822)
        at org.apache.hadoop.hdfs.DFSClient$DFSInputStream.&amp;lt;init&amp;gt;(DFSClient.java:1813)
        at org.apache.hadoop.hdfs.DFSClient.open(DFSClient.java:544)
        at org.apache.hadoop.hdfs.DistributedFileSystem.open(DistributedFileSystem.java:187)
        at org.apache.hadoop.fs.FileSystem.open(FileSystem.java:456)
        at org.apache.hadoop.hbase.io.hfile.HFile.createReader(HFile.java:341)
        at org.apache.hadoop.hbase.regionserver.StoreFile$Reader.&amp;lt;init&amp;gt;(StoreFile.java:1008)
        at org.apache.hadoop.hbase.io.HalfStoreFileReader.&amp;lt;init&amp;gt;(HalfStoreFileReader.java:65)
        at org.apache.hadoop.hbase.regionserver.StoreFile.open(StoreFile.java:467)
        at org.apache.hadoop.hbase.regionserver.StoreFile.createReader(StoreFile.java:548)
        at org.apache.hadoop.hbase.regionserver.Store.loadStoreFiles(Store.java:284)
        at org.apache.hadoop.hbase.regionserver.Store.&amp;lt;init&amp;gt;(Store.java:221)
        at org.apache.hadoop.hbase.regionserver.HRegion.instantiateHStore(HRegion.java:2511)
        at org.apache.hadoop.hbase.regionserver.HRegion.initialize(HRegion.java:450)
        at org.apache.hadoop.hbase.regionserver.HRegion.openHRegion(HRegion.java:3229)
        at org.apache.hadoop.hbase.regionserver.SplitTransaction.openDaughterRegion(SplitTransaction.java:504)
        at org.apache.hadoop.hbase.regionserver.SplitTransaction$DaughterOpener.run(SplitTransaction.java:484)
        ... 1 more
2012-03-28 10:57:16,345 FATAL org.apache.hadoop.hbase.regionserver.HRegionServer: ABORTING region server ld2,60020,1332957343833: Abort; we got an error after point-of-no-&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;a href=&quot;http://hastebin.com/diqinibajo.avrasm&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hastebin.com/diqinibajo.avrasm&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;later edit:&lt;/p&gt;

&lt;p&gt;(I&apos;m using the last 4 characters from each string)&lt;br/&gt;
Region 94e3 has storefile 7237&lt;br/&gt;
Region 94e3 gets splited in daughters a: ffa1 and b: eee1&lt;br/&gt;
Daughter region ffa1 get&apos;s splitted in daughters a: 3124 and b: dc77&lt;br/&gt;
ffa1 has a reference: 7237.94e3 for it&apos;s store file&lt;br/&gt;
when ffa1 gets splited it will create another reference: 7237.94e3.ffa1&lt;br/&gt;
when SplitTransaction will execute() it will try to open that (openDaughters above) and it will match it from left to right &lt;span class=&quot;error&quot;&gt;&amp;#91;storefile&amp;#93;&lt;/span&gt;.&lt;span class=&quot;error&quot;&gt;&amp;#91;region&amp;#93;&lt;/span&gt; &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;^([0-9a-f]+)(?:\\.(.+))?$&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and will attempt to go to /hbase/t1/&lt;span class=&quot;error&quot;&gt;&amp;#91;region&amp;#93;&lt;/span&gt; which resolves to &lt;br/&gt;
/hbase/t1/94e3.ffa1/f1/7237 - which obviously doesn&apos;t exist and will fail. &lt;/p&gt;

&lt;p&gt;This seems like a design problem: we should either stop from splitting if the path is reference or be able to recursively resolve reference paths (e.g. parse right to left 7237.94e3.ffa1 -&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;7237.94e3&amp;#93;&lt;/span&gt;.ffa1 -&amp;gt; open /hbase/t1/ffa1/f1/7237.94e3 -&amp;gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;7237&amp;#93;&lt;/span&gt;.94e3 -&amp;gt; open /hbase/t1/94e3/7237)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12548534">HBASE-5665</key>
            <summary>Repeated split causes HRegionServer failures and breaks table </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="clehene">Cosmin Lehene</assignee>
                                    <reporter username="clehene">Cosmin Lehene</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 Mar 2012 18:47:04 +0000</created>
                <updated>Fri, 12 Oct 2012 05:34:48 +0000</updated>
                            <resolved>Mon, 2 Apr 2012 20:52:59 +0000</resolved>
                                    <version>0.92.0</version>
                    <version>0.92.1</version>
                                    <fixVersion>0.92.2</fixVersion>
                    <fixVersion>0.94.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13241392" author="clehene" created="Thu, 29 Mar 2012 17:04:47 +0000"  >&lt;p&gt;Adding patch.&lt;br/&gt;
From Reference.java documentation &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 * Note, a region is itself not splitable &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it has instances of store file
 * references.  References are cleaned up by compactions.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SplitTransaction.prepare() should check if the parent region has references.&lt;/p&gt;

&lt;p&gt;I added a unit test and patch. Funny enough the HRegion.hasReferences was implemented but only used from a unit test.&lt;/p&gt;

&lt;p&gt;I think recursive references wouldn&apos;t be so hard to have if there&apos;s a good reason to have them in the first place.&lt;/p&gt;</comment>
                            <comment id="13241394" author="clehene" created="Thu, 29 Mar 2012 17:08:42 +0000"  >&lt;p&gt;0.94 and trunk seem to suffer from this as well and not checking if parent has references.&lt;/p&gt;</comment>
                            <comment id="13241555" author="stack" created="Thu, 29 Mar 2012 19:36:37 +0000"  >&lt;p&gt;Did we drop the check for references along the way Cosmin?  It used to be impossible to even attempt a split of a region with references.  Are you working on it?  I agree this a blocker all around.&lt;/p&gt;</comment>
                            <comment id="13241556" author="stack" created="Thu, 29 Mar 2012 19:37:26 +0000"  >&lt;p&gt;Or, is this a problem only with forced splits?  It doesn&apos;t happen when we split &apos;naturally&apos; because we&apos;ll check for references?&lt;/p&gt;</comment>
                            <comment id="13241586" author="clehene" created="Thu, 29 Mar 2012 20:04:31 +0000"  >&lt;p&gt;Indeed it seems to be a problem with forced splits. I&apos;m not sure though if the natural splits are safe - they seem to be, but I need to test that too. &lt;/p&gt;

&lt;p&gt;RegionSplitPolicy.getSplitPoint() calls Store.getSplitPoint()&lt;br/&gt;
Store.getSplitPoint seems to do the check. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (StoreFile sf : storefiles) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sf.isReference()) {
          &lt;span class=&quot;code-comment&quot;&gt;// Should already be enforced since we &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; in &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; : &lt;span class=&quot;code-quote&quot;&gt;&quot;getSplitPoint() called on a region that can&apos;t split!&quot;&lt;/span&gt;;
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;BTW, we also have Store.hasReferences()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; hasReferences(Collection&amp;lt;StoreFile&amp;gt; files) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (files != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; files.size() &amp;gt; 0) {
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (StoreFile hsf: files) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hsf.isReference()) {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        }
      }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
  }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;However here&apos;s the code in HRegion.checkSplit()&lt;br/&gt;
If there&apos;s an explicit split point it won&apos;t get to do the reference check.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] checkSplit() {
    &lt;span class=&quot;code-comment&quot;&gt;// Can&apos;t split META
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (getRegionInfo().isMetaRegion()) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (shouldForceSplit()) {
        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Cannot split meta regions in HBase 0.20 and above&quot;&lt;/span&gt;);
      }
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.explicitSplitPoint != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.explicitSplitPoint;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!splitPolicy.shouldSplit()) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    }

    &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] ret = splitPolicy.getSplitPoint();

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ret != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        checkRow(ret, &lt;span class=&quot;code-quote&quot;&gt;&quot;calculated split&quot;&lt;/span&gt;);
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
        LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Ignoring invalid split&quot;&lt;/span&gt;, e);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ret;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Multiple return points + a ret variable - this could use some polishing too &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m a bit puzzled about the natural split, because, I&apos;ve seen the problem with a forced split from UI where I don&apos;t think we provide an explicit split point. &lt;/p&gt;

&lt;p&gt;Cosmin&lt;/p&gt;</comment>
                            <comment id="13241593" author="clehene" created="Thu, 29 Mar 2012 20:13:59 +0000"  >&lt;p&gt;BTW - I don&apos;t think getSplitPoint should do that check, and we also shouldn&apos;t have to places where we check for references - perhaps we should have another JIRA to fix this in trunk?&lt;/p&gt;</comment>
                            <comment id="13241611" author="hadoopqa" created="Thu, 29 Mar 2012 20:51:04 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12520458/HBASE-5665-0.92.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12520458/HBASE-5665-0.92.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1347//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1347//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1347//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1347//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1347//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1347//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13241765" author="stack" created="Thu, 29 Mar 2012 21:08:05 +0000"  >&lt;p&gt;Nice test Cosmin&lt;/p&gt;</comment>
                            <comment id="13243771" author="mbertozzi" created="Sun, 1 Apr 2012 16:37:47 +0000"  >&lt;p&gt;Can we also add a couple of methods to the region like isSplittable() and isAvailable()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isAvailable() {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; !isClosed() &amp;amp;&amp;amp; !isClosing();
}

&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isSplittable() {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; isAvailable() &amp;amp;&amp;amp; !hasReferences();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;just to avoid similar problems in future...&lt;br/&gt;
For example in HRegionServer both getMostLoadedRegions() and closeUserRegions() does the same &quot;isAvailable()&quot; check...&lt;/p&gt;</comment>
                            <comment id="13243842" author="yuzhihong@gmail.com" created="Sun, 1 Apr 2012 20:29:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5665&quot; title=&quot;Repeated split causes HRegionServer failures and breaks table &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5665&quot;&gt;&lt;del&gt;HBASE-5665&lt;/del&gt;&lt;/a&gt;-trunk.patch looks good.&lt;/p&gt;</comment>
                            <comment id="13243898" author="hadoopqa" created="Sun, 1 Apr 2012 23:24:21 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12520847/HBASE-5665-trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12520847/HBASE-5665-trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1362//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1362//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1362//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1362//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1362//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1362//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13244603" author="stack" created="Mon, 2 Apr 2012 20:51:36 +0000"  >&lt;p&gt;Same as last patch but w/ fixed javadoc... isAvailable is not closed and not closing.&lt;/p&gt;</comment>
                            <comment id="13244605" author="stack" created="Mon, 2 Apr 2012 20:53:00 +0000"  >&lt;p&gt;Committed to 0.92, 0.94, and trunk.  Thanks Cosmin and Matteo.&lt;/p&gt;</comment>
                            <comment id="13244713" author="hudson" created="Mon, 2 Apr 2012 22:05:45 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #79 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/79/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/79/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5665&quot; title=&quot;Repeated split causes HRegionServer failures and breaks table &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5665&quot;&gt;&lt;del&gt;HBASE-5665&lt;/del&gt;&lt;/a&gt; Repeated split causes HRegionServer failures and breaks table (Revision 1308547)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13244830" author="hudson" created="Mon, 2 Apr 2012 23:31:10 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2704 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2704/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2704/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5665&quot; title=&quot;Repeated split causes HRegionServer failures and breaks table &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5665&quot;&gt;&lt;del&gt;HBASE-5665&lt;/del&gt;&lt;/a&gt; Repeated split causes HRegionServer failures and breaks table (Revision 1308545)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13244858" author="hudson" created="Mon, 2 Apr 2012 23:58:31 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #351 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/351/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/351/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5665&quot; title=&quot;Repeated split causes HRegionServer failures and breaks table &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5665&quot;&gt;&lt;del&gt;HBASE-5665&lt;/del&gt;&lt;/a&gt; Repeated split causes HRegionServer failures and breaks table (Revision 1308549)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13245008" author="hudson" created="Tue, 3 Apr 2012 05:54:38 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #156 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/156/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/156/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5665&quot; title=&quot;Repeated split causes HRegionServer failures and breaks table &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5665&quot;&gt;&lt;del&gt;HBASE-5665&lt;/del&gt;&lt;/a&gt; Repeated split causes HRegionServer failures and breaks table (Revision 1308545)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13246905" author="hudson" created="Thu, 5 Apr 2012 00:53:33 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #7 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/7/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/7/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5665&quot; title=&quot;Repeated split causes HRegionServer failures and breaks table &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5665&quot;&gt;&lt;del&gt;HBASE-5665&lt;/del&gt;&lt;/a&gt; Repeated split causes HRegionServer failures and breaks table (Revision 1308547)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13246965" author="hudson" created="Thu, 5 Apr 2012 02:52:07 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #104 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/104/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/104/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5665&quot; title=&quot;Repeated split causes HRegionServer failures and breaks table &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5665&quot;&gt;&lt;del&gt;HBASE-5665&lt;/del&gt;&lt;/a&gt; Repeated split causes HRegionServer failures and breaks table (Revision 1308549)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12521034" name="5665trunk.v2.patch" size="4348" author="stack" created="Mon, 2 Apr 2012 20:51:36 +0000"/>
                            <attachment id="12520458" name="HBASE-5665-0.92.patch" size="2599" author="clehene" created="Thu, 29 Mar 2012 17:04:47 +0000"/>
                            <attachment id="12520847" name="HBASE-5665-trunk.patch" size="4331" author="mbertozzi" created="Sun, 1 Apr 2012 20:11:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 29 Mar 2012 19:36:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>233631</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 37 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00xa7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3324</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>