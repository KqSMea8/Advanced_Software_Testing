<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:20:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4641/HBASE-4641.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4641] Block cache can be mistakenly instantiated on Master</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4641</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;After changes in the block cache instantiation over in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4422&quot; title=&quot;Move block cache parameters and references into single CacheConf class&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4422&quot;&gt;&lt;del&gt;HBASE-4422&lt;/del&gt;&lt;/a&gt;, it looks like the HMaster can now end up with a block cache instantiated.  Not a huge deal but prevents the process from shutting down properly.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12528040">HBASE-4641</key>
            <summary>Block cache can be mistakenly instantiated on Master</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="streamy">Jonathan Gray</assignee>
                                    <reporter username="streamy">Jonathan Gray</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Oct 2011 22:15:19 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:42 +0000</updated>
                            <resolved>Fri, 28 Oct 2011 21:44:26 +0000</resolved>
                                    <version>0.92.0</version>
                    <version>0.94.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13132122" author="streamy" created="Thu, 20 Oct 2011 22:22:50 +0000"  >&lt;p&gt;In the HMaster constructor, makes a local copy of the passed-in Configuration and then sets the cache size to 0.&lt;/p&gt;

&lt;p&gt;This seems like the wrong way to do this.&lt;/p&gt;

&lt;p&gt;It seems like the only way this happens now is on create table (because HRegion instantiation happens in master at this time).  I could set/reset the conf in that place instead?&lt;/p&gt;</comment>
                            <comment id="13132126" author="streamy" created="Thu, 20 Oct 2011 22:27:21 +0000"  >&lt;p&gt;This version does the same thing but now does it in the CreateTableHandler which should not be disruptive like the other change.&lt;/p&gt;</comment>
                            <comment id="13132303" author="yuzhihong@gmail.com" created="Fri, 21 Oct 2011 03:26:59 +0000"  >&lt;p&gt;For HMaster.finishInitialization(), ROOT region is created. CreateTableHandler isn&apos;t involved.&lt;br/&gt;
So patch v2 wouldn&apos;t totally solve the issue.&lt;/p&gt;</comment>
                            <comment id="13132854" author="streamy" created="Fri, 21 Oct 2011 17:33:52 +0000"  >&lt;p&gt;Thanks Ted.  You see any others?&lt;/p&gt;</comment>
                            <comment id="13134797" author="stack" created="Tue, 25 Oct 2011 07:12:12 +0000"  >&lt;p&gt;Any progress on this patch (want to wrap up 0.92).  Didn&apos;t we have a soln. to this once?&lt;/p&gt;</comment>
                            <comment id="13137622" author="yuzhihong@gmail.com" created="Thu, 27 Oct 2011 22:15:09 +0000"  >&lt;p&gt;I haven&apos;t found other code path leading to block cache creation on master.&lt;/p&gt;</comment>
                            <comment id="13138041" author="stack" created="Fri, 28 Oct 2011 05:21:53 +0000"  >&lt;p&gt;@Jon Why clone a Configuration down in CreateTableHandler?  Why not do it once in the HMaster constructor and set the 0.0f in here.  Then we&apos;ll not create a block cache in master whether bootstrapping root/meta or whether its new table creation (Add a bit of a comment to say why the 0.0f voodoo?)&lt;/p&gt;</comment>
                            <comment id="13138053" author="streamy" created="Fri, 28 Oct 2011 05:38:32 +0000"  >&lt;p&gt;Stack, that&apos;s what I had in v1.  I felt like it was an ugly hack and might have an impact on unit tests that modify a conf after hmaster is instantiated.&lt;/p&gt;

&lt;p&gt;I can just try that again and run the unit tests to see if they do all pass.&lt;/p&gt;

</comment>
                            <comment id="13138054" author="stack" created="Fri, 28 Oct 2011 05:38:35 +0000"  >&lt;p&gt;Attached a suggested patch.  Have to run on a cluster to see it actually works (because in unit tests, regionservers usually come up first and make a cache instance that the master ends up sharing regardless).&lt;/p&gt;

&lt;p&gt;This suggestion is not right either.  If block cache and configuration were separate I suppose it&apos;d be easier but thats a big change.&lt;/p&gt;</comment>
                            <comment id="13138061" author="streamy" created="Fri, 28 Oct 2011 05:44:32 +0000"  >&lt;p&gt;The real fix is for the block cache to be instantiated in HRS and not be static.&lt;/p&gt;

&lt;p&gt;This slightly complicates things but is possible.&lt;/p&gt;

</comment>
                            <comment id="13138066" author="stack" created="Fri, 28 Oct 2011 05:50:20 +0000"  >&lt;p&gt;@Jon Sorry. Missed your v1.  Yes, its not right either.&lt;/p&gt;</comment>
                            <comment id="13138114" author="yuzhihong@gmail.com" created="Fri, 28 Oct 2011 06:38:27 +0000"  >&lt;p&gt;Initially I was thinking of resorting to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
StackTraceElement[] stackTraceElements =
  &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().getStackTrace();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above is ugly too.&lt;/p&gt;

&lt;p&gt;Can HMaster add one more entry to its Configuration conf which signifies that the conf is not owned by region server ?&lt;br/&gt;
Store can check this entry and make decision accordingly.&lt;/p&gt;</comment>
                            <comment id="13138118" author="stack" created="Fri, 28 Oct 2011 06:46:25 +0000"  >&lt;p&gt;I&apos;m not sure that will work since the Configuration is shared among the servers in the minicluster.&lt;/p&gt;</comment>
                            <comment id="13138126" author="yuzhihong@gmail.com" created="Fri, 28 Oct 2011 06:53:46 +0000"  >&lt;p&gt;Looking at MiniHBaseCluster.init(), we already clone conf and give to each region server:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i=0; i&amp;lt;nRegionNodes; i++) {
        Configuration rsConf = HBaseConfiguration.create(conf);
        User user = HBaseTestingUtility.getDifferentUser(rsConf,
            &lt;span class=&quot;code-quote&quot;&gt;&quot;.hfs.&quot;&lt;/span&gt;+index++);
        hbaseCluster.addRegionServer(rsConf, i, user);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Since Configuration object isn&apos;t shared by master and region server(s) in minicluster, there is no need to replicate Configuration as patch v1 did.&lt;/p&gt;</comment>
                            <comment id="13138634" author="yuzhihong@gmail.com" created="Fri, 28 Oct 2011 18:54:20 +0000"  >&lt;p&gt;Patch v4 uses the approach from comment @ 28/Oct/11 06:38&lt;/p&gt;

&lt;p&gt;I verified through breakpoint that both CreateTableHandler and meta region creation are covered.&lt;br/&gt;
For region server, the following condition evaluates to false:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (conf.getBoolean(HConstants.IS_MASTER, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13138670" author="stack" created="Fri, 28 Oct 2011 19:24:58 +0000"  >&lt;p&gt;+1 on commit&lt;/p&gt;

&lt;p&gt;Its hacky but until we break apart cache config from cache instance, this will do.&lt;/p&gt;</comment>
                            <comment id="13138792" author="streamy" created="Fri, 28 Oct 2011 21:33:33 +0000"  >&lt;p&gt;I like v4 much less than the other changes.  My v1 patch makes it so we could potentially break something because it&apos;s expecting to be able to manipulate the conf after construction (an easy assumption to document / test for).  The v4 patch now takes the conf passed in by reference and modifies it.  It then modifies the same conf reference later in Store.  Seems like this could have some bad side-effects in the opposite direction.&lt;/p&gt;

&lt;p&gt;At this point, I vote for the v1 hack until we make the cache non-static.  As long as unit tests still pass.&lt;/p&gt;</comment>
                            <comment id="13138798" author="yuzhihong@gmail.com" created="Fri, 28 Oct 2011 21:40:14 +0000"  >&lt;p&gt;Patch v1 is fine with me.&lt;/p&gt;</comment>
                            <comment id="13138800" author="yuzhihong@gmail.com" created="Fri, 28 Oct 2011 21:43:03 +0000"  >&lt;p&gt;One benefit for patch v4 is that it allows different components to make decisions based on whether JVM is for master or region server.&lt;br/&gt;
We can revisit this topic when more config parameters are set in this regard.&lt;/p&gt;</comment>
                            <comment id="13138803" author="streamy" created="Fri, 28 Oct 2011 21:44:26 +0000"  >&lt;p&gt;Committed v1 to branch and trunk.  Thanks guys.&lt;/p&gt;</comment>
                            <comment id="13138809" author="streamy" created="Fri, 28 Oct 2011 21:46:37 +0000"  >&lt;p&gt;Opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4697&quot; title=&quot;Block cache reference should not be static&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4697&quot;&gt;&lt;del&gt;HBASE-4697&lt;/del&gt;&lt;/a&gt; to deal with &quot;real&quot; solution.&lt;/p&gt;</comment>
                            <comment id="13138991" author="hudson" created="Sat, 29 Oct 2011 00:08:39 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2380 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2380/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2380/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4641&quot; title=&quot;Block cache can be mistakenly instantiated on Master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4641&quot;&gt;&lt;del&gt;HBASE-4641&lt;/del&gt;&lt;/a&gt;  Block cache can be mistakenly instantiated on Master (jgray)&lt;/p&gt;

&lt;p&gt;jgray : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13139462" author="stack" created="Sat, 29 Oct 2011 21:53:06 +0000"  >&lt;p&gt;Smile.  Seems like two of us are voting for v4 but v1 gets committed.&lt;/p&gt;

&lt;p&gt;Issues w/ v1:&lt;/p&gt;

&lt;p&gt;+ imports a class from a subpackage that is one up and then two subpackages down in the package hierarchy; makes for bad package cohesion.&lt;br/&gt;
+ The first thing done on Construction of the master is some wonky cache-size setting; its hard to grok whats going on and why this is first thing we&apos;re doing constructing an HMaster instance (comment could be better why we are up to such pervertions).&lt;br/&gt;
+ We clone a Configuration.&lt;/p&gt;

&lt;p&gt;v4 should have a better comment on what its about and that its dependent on how minihbasecluster currently has a Configuration per Server (which is needed for lots of reasons such as Connections and User in Security so its fine depending on this behavior) but v4 has the merit of going from the general &amp;#8211; I&apos;m a Master Configuration (which could be leveraged in other ways than whats needed here) &amp;#8211; to the specific down in HStore when it starts to mess with Cache.&lt;/p&gt;

&lt;p&gt;I&apos;d say leave things as is.  v1 will work for now.  Its going to change when the CacheConfig stuff gets a refactoring.&lt;/p&gt;</comment>
                            <comment id="13140825" author="hudson" created="Tue, 1 Nov 2011 02:07:58 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #90 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/90/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/90/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4641&quot; title=&quot;Block cache can be mistakenly instantiated on Master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4641&quot;&gt;&lt;del&gt;HBASE-4641&lt;/del&gt;&lt;/a&gt;  Block cache can be mistakenly instantiated on Master (jgray)&lt;/p&gt;

&lt;p&gt;jgray : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15016296" author="lars_francke" created="Fri, 20 Nov 2015 11:54:42 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12501236" name="4641-suggestion-v3.txt" size="1506" author="stack" created="Fri, 28 Oct 2011 05:38:35 +0000"/>
                            <attachment id="12501340" name="4641-v4.txt" size="2130" author="yuzhihong@gmail.com" created="Fri, 28 Oct 2011 18:51:41 +0000"/>
                            <attachment id="12499964" name="HBASE-4641-v1.patch" size="1103" author="streamy" created="Thu, 20 Oct 2011 22:22:50 +0000"/>
                            <attachment id="12499966" name="HBASE-4641-v2.patch" size="1244" author="streamy" created="Thu, 20 Oct 2011 22:27:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 21 Oct 2011 03:26:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>96253</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hrn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101740</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>