<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:35:37 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12707/HBASE-12707.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12707] TestMasterObserver#testTableOperations may fail due to race condition</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12707</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Here was the failure I saw:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testTableOperations(org.apache.hadoop.hbase.coprocessor.TestMasterObserver)  Time elapsed: 5.153 sec  &amp;lt;&amp;lt;&amp;lt; FAILURE!
java.lang.AssertionError: Delete table handler should be called.
        at org.junit.Assert.fail(Assert.java:88)
        at org.junit.Assert.assertTrue(Assert.java:41)
        at org.apache.hadoop.hbase.coprocessor.TestMasterObserver.testTableOperations(TestMasterObserver.java:1302)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is relevant part of test output:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-12-18 00:18:47,788 DEBUG [MASTER_TABLE_OPERATIONS-kiyo:56800-0] backup.HFileArchiver(438): Finished archiving from class org.apache.hadoop.hbase.backup.HFileArchiver$FileablePath, file:hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:49506/user/hortonzy/test-data/caaed63b-db6f-4dad-a455-3f63897555f7/.tmp/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/observed_table/294700c0c28e634c9e046d5368559666/recovered.edits/7.seqid, to hdfs://localhost:49506/user/hortonzy/test-data/caaed63b-db6f-4dad-a455-3f63897555f7/archive/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/observed_table/294700c0c28e634c9e046d5368559666/recovered.edits/7.seqid
&lt;/span&gt;2014-12-18 00:18:47,789 INFO  [IPC Server handler 2 on 49506] blockmanagement.BlockManager(1074): BLOCK* addToInvalidates: blk_1073741879_1055 127.0.0.1:60154 127.0.0.1:38435
2014-12-18 00:18:47,789 DEBUG [MASTER_TABLE_OPERATIONS-kiyo:56800-0] backup.HFileArchiver(453): Deleted all region files in: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:49506/user/hortonzy/test-data/caaed63b-db6f-4dad-a455-3f63897555f7/.tmp/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/observed_table/294700c0c28e634c9e046d5368559666
&lt;/span&gt;2014-12-18 00:18:47,790 INFO  [IPC Server handler 0 on 49506] blockmanagement.BlockManager(1074): BLOCK* addToInvalidates: blk_1073741883_1059 127.0.0.1:60154 127.0.0.1:38435
2014-12-18 00:18:47,791 DEBUG [MASTER_TABLE_OPERATIONS-kiyo:56800-0] handler.DeleteTableHandler(160): Table &apos;observed_table&apos; archived!
2014-12-18 00:18:47,791 DEBUG [MASTER_TABLE_OPERATIONS-kiyo:56800-0] handler.DeleteTableHandler(110): Removing &apos;observed_table&apos; descriptor.
2014-12-18 00:18:47,792 DEBUG [MASTER_TABLE_OPERATIONS-kiyo:56800-0] handler.DeleteTableHandler(116): Removing &apos;observed_table&apos; from region states.
2014-12-18 00:18:47,792 DEBUG [MASTER_TABLE_OPERATIONS-kiyo:56800-0] handler.DeleteTableHandler(120): Marking &apos;observed_table&apos; as deleted.
2014-12-18 00:18:47,874 DEBUG [B.defaultRpcServer.handler=2,queue=0,port=56800] util.FSTableDescriptors(177): Exception during readTableDecriptor. Current table name = observed_table
org.apache.hadoop.hbase.TableInfoMissingException: No table descriptor file under hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:49506/user/hortonzy/test-data/caaed63b-db6f-4dad-a455-3f63897555f7/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/observed_table
&lt;/span&gt;        at org.apache.hadoop.hbase.util.FSTableDescriptors.getTableDescriptorFromFs(FSTableDescriptors.java:509)
        at org.apache.hadoop.hbase.util.FSTableDescriptors.getTableDescriptorFromFs(FSTableDescriptors.java:487)
        at org.apache.hadoop.hbase.util.FSTableDescriptors.get(FSTableDescriptors.java:172)
        at org.apache.hadoop.hbase.master.HMaster.listTableDescriptors(HMaster.java:2166)
        at org.apache.hadoop.hbase.master.MasterRpcServices.getTableDescriptors(MasterRpcServices.java:788)
        at org.apache.hadoop.hbase.protobuf.generated.MasterProtos$MasterService$2.callBlockingMethod(MasterProtos.java:42402)
        at org.apache.hadoop.hbase.ipc.RpcServer.call(RpcServer.java:2028)
        at org.apache.hadoop.hbase.ipc.CallRunner.run(CallRunner.java:108)
        at org.apache.hadoop.hbase.ipc.RpcExecutor.consumerLoop(RpcExecutor.java:112)
        at org.apache.hadoop.hbase.ipc.RpcExecutor$1.run(RpcExecutor.java:92)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:724)
2014-12-18 00:18:47,875 INFO  [main] client.HBaseAdmin(738): Deleted observed_table
2014-12-18 00:18:47,880 WARN  [main] hbase.MetaTableAccessor$1(344): No serialized HRegionInfo in keyvalues={observed_table,,1418861912253.8551edbe4ffb771a607ad362bfc6642d./info:seqnumDuringOpen/1418861917732/Put/vlen=8/seqid=0, observed_table,,1418861912253.8551edbe4ffb771a607ad362bfc6642d./info:server/1418861917732/Put/vlen=28/seqid=0, observed_table,,1418861912253.8551edbe4ffb771a607ad362bfc6642d./info:serverstartcode/1418861917732/Put/vlen=8/seqid=0}
2014-12-18 00:18:47,924 INFO  [main] hbase.ResourceChecker(171): after: coprocessor.TestMasterObserver#testTableOperations &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;=600 (was 475)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is related code in DeleteTableHandler#handleTableOperation():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    removeTableData(regions);

    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cpHost != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      cpHost.postDeleteTableHandler(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.tableName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Table data is removed first, then postDeleteTableHandler is called.&lt;br/&gt;
However, the loop in HBaseAdmin checks for the presence of TableDescriptor. The loop exits if TableDescriptor is not found. Hence the assertion in test may be executed earlier than postDeleteTableHandler is called, leading to test failure.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12762447">HBASE-12707</key>
            <summary>TestMasterObserver#testTableOperations may fail due to race condition</summary>
                <type id="6" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/requirement.png">Test</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Dec 2014 00:51:16 +0000</created>
                <updated>Sat, 4 Jul 2015 14:31:00 +0000</updated>
                            <resolved>Sat, 4 Jul 2015 14:31:00 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                        <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i23jxz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>