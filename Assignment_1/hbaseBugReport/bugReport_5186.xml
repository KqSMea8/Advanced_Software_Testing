<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:25:32 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5186/HBASE-5186.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5186] Add metrics to ThriftServer</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5186</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;It will be useful to have some metrics (queue length, waiting time, processing time ...) similar to Hadoop RPC server. This allows us to monitor system health also provide a tool to diagnose the problem where thrift calls are slow.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12538253">HBASE-5186</key>
            <summary>Add metrics to ThriftServer</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="schen">Scott Chen</assignee>
                                    <reporter username="schen">Scott Chen</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Jan 2012 19:34:15 +0000</created>
                <updated>Fri, 12 Oct 2012 05:34:52 +0000</updated>
                            <resolved>Fri, 3 Feb 2012 19:04:57 +0000</resolved>
                                                    <fixVersion>0.94.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13193541" author="phabricator@reviews.facebook.net" created="Thu, 26 Jan 2012 03:55:39 +0000"  >&lt;p&gt;sc requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;br/&gt;
Reviewers: dhruba, tedyu, JIRA&lt;/p&gt;

&lt;p&gt;  Add metrics to ThriftServer&lt;/p&gt;

&lt;p&gt;  It will be useful to have some metrics (queue length, waiting time, processing&lt;br/&gt;
  time ...) similar to Hadoop RPC server. This allows us to monitor system health&lt;br/&gt;
  also provide a tool to diagnose the problem where thrift calls are slow.&lt;/p&gt;

&lt;p&gt;  It will be useful to have some metrics (queue length, waiting time, processing time ...) similar to Hadoop RPC server. This allows us to monitor system health also provide a tool to diagnose the problem where thrift calls are slow.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  pom.xml&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/HbaseHandlerMetricsProxy.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/TBoundedThreadPoolServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestThriftServer.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/3021/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/3021/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tip: use the X-Herald-Rules header to filter Herald messages in your client.&lt;/p&gt;</comment>
                            <comment id="13193547" author="phabricator@reviews.facebook.net" created="Thu, 26 Jan 2012 03:57:38 +0000"  >&lt;p&gt;sc updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;br/&gt;
Reviewers: dhruba, tedyu, JIRA&lt;/p&gt;

&lt;p&gt;  Remove the debug change&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/HbaseHandlerMetricsProxy.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/TBoundedThreadPoolServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestThriftServer.java&lt;/p&gt;</comment>
                            <comment id="13193553" author="phabricator@reviews.facebook.net" created="Thu, 26 Jan 2012 04:59:38 +0000"  >&lt;p&gt;sc updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;br/&gt;
Reviewers: dhruba, tedyu, JIRA&lt;/p&gt;

&lt;p&gt;  Add TestCallQueue&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/HbaseHandlerMetricsProxy.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/TBoundedThreadPoolServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestCallQueue.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestThriftServer.java&lt;/p&gt;</comment>
                            <comment id="13193580" author="phabricator@reviews.facebook.net" created="Thu, 26 Jan 2012 06:05:39 +0000"  >&lt;p&gt;sc updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;br/&gt;
Reviewers: dhruba, tedyu, JIRA, heyongqiang&lt;/p&gt;

&lt;p&gt;  Remove some dead variables&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionThriftServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/HbaseHandlerMetricsProxy.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/TBoundedThreadPoolServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestCallQueue.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestThriftServer.java&lt;/p&gt;</comment>
                            <comment id="13194394" author="phabricator@reviews.facebook.net" created="Fri, 27 Jan 2012 03:13:41 +0000"  >&lt;p&gt;sc updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;br/&gt;
Reviewers: dhruba, tedyu, JIRA, heyongqiang&lt;/p&gt;

&lt;p&gt;  Remove unnecessary locking in ThriftMetrics&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionThriftServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/HbaseHandlerMetricsProxy.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/TBoundedThreadPoolServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestCallQueue.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestThriftServer.java&lt;/p&gt;</comment>
                            <comment id="13195677" author="hadoopqa" created="Sun, 29 Jan 2012 02:46:20 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12512070/HBASE-5186.D1461.5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12512070/HBASE-5186.D1461.5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -140 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 161 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestFromClientSide&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestHFileBlock&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/865//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/865//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/865//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/865//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/865//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/865//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13195690" author="phabricator@reviews.facebook.net" created="Sun, 29 Jan 2012 04:52:09 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java:2 Year is not needed.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java:44 Would ThriftMetrics be created for thrift2 ?&lt;br/&gt;
  Fine if you plan to do it in another JIRA.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java:53 As the code on line 102 shows, &quot;hbase.thrift.slow.response.nano.second&quot; may be a better name for this config.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:57 Would timeInQueue be a better method name ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:29 Does the call queue length in metrics match &apos;total elements removed&apos; in javadoc ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:128 According to &lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html#drainTo%28java.util.Collection%29:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oracle.com/javase/6/docs/api/java/util/concurrent/BlockingQueue.html#drainTo%28java.util.Collection%29:&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Attempts to drain a queue to itself result in IllegalArgumentException.&lt;/p&gt;

&lt;p&gt;  We should maintain the above semantics.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:153 Can we add the new Call object to underlyingQueue ?&lt;br/&gt;
  This way we don&apos;t need to create toBeAdded&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13195762" author="phabricator@reviews.facebook.net" created="Sun, 29 Jan 2012 15:13:08 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;  Methods in class CallQueue look packed.&lt;br/&gt;
  Usually we leave one empty line between methods.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13195918" author="phabricator@reviews.facebook.net" created="Mon, 30 Jan 2012 03:03:11 +0000"  >&lt;p&gt;sc has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;  Ted: Thanks for reviewing. I will make the change to this patch soon. I will make the change for thrift2 in another JIRA.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13196027" author="schen" created="Mon, 30 Jan 2012 10:19:38 +0000"  >&lt;p&gt;I have opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5298&quot; title=&quot;Add thrift metrics to thrift2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5298&quot;&gt;&lt;del&gt;HBASE-5298&lt;/del&gt;&lt;/a&gt; for thrift2 metrics.&lt;/p&gt;</comment>
                            <comment id="13196092" author="phabricator@reviews.facebook.net" created="Mon, 30 Jan 2012 12:49:09 +0000"  >&lt;p&gt;sc has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:128 good catch&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13196093" author="phabricator@reviews.facebook.net" created="Mon, 30 Jan 2012 12:49:11 +0000"  >&lt;p&gt;sc updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;br/&gt;
Reviewers: dhruba, tedyu, JIRA, heyongqiang&lt;/p&gt;

&lt;p&gt;  Addressed Ted&apos;s comments&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionThriftServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/HbaseHandlerMetricsProxy.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/TBoundedThreadPoolServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestCallQueue.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestThriftServer.java&lt;/p&gt;</comment>
                            <comment id="13196114" author="hadoopqa" created="Mon, 30 Jan 2012 13:38:22 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12512410/HBASE-5186.D1461.6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12512410/HBASE-5186.D1461.6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -140 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 161 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/871//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/871//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/871//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/871//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/871//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/871//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13196236" author="phabricator@reviews.facebook.net" created="Mon, 30 Jan 2012 17:26:17 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:67 Should we consider startTime when performing equality check ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:77 Same comment as above: include startTime in hash code ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:34 The class is CallQueue. Should we tighten the type parameter to Call ?&lt;/p&gt;

&lt;p&gt;  The reasoning is that users of CallQueue should use offer(), put(), etc to insert Runnable&apos;s and these methods wrap the Runnable in Call already.&lt;/p&gt;

&lt;p&gt;  That way we can save instanceof checks.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13196861" author="phabricator@reviews.facebook.net" created="Tue, 31 Jan 2012 12:12:09 +0000"  >&lt;p&gt;sc has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:34 good idea. I will make the change.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13196905" author="phabricator@reviews.facebook.net" created="Tue, 31 Jan 2012 13:36:09 +0000"  >&lt;p&gt;sc updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;br/&gt;
Reviewers: dhruba, tedyu, JIRA, heyongqiang&lt;/p&gt;

&lt;p&gt;  Make underlyingQueue a BlockingQueue&amp;lt;Call&amp;gt;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionThriftServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/HbaseHandlerMetricsProxy.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/TBoundedThreadPoolServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestCallQueue.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestThriftServer.java&lt;/p&gt;</comment>
                            <comment id="13196906" author="phabricator@reviews.facebook.net" created="Tue, 31 Jan 2012 13:36:11 +0000"  >&lt;p&gt;sc has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:67 I am not sure if we should check startTime. One might want to remove a Runnable added to the CallQueue (which is a BlockingQueue&amp;lt;Runnable&amp;gt;). Adding the startTime check will remove this ability.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13196954" author="hadoopqa" created="Tue, 31 Jan 2012 14:38:41 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12512562/HBASE-5186.D1461.7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12512562/HBASE-5186.D1461.7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -140 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 161 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.io.hfile.TestLruBlockCache&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/881//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/881//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/881//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/881//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/881//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/881//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13197030" author="phabricator@reviews.facebook.net" created="Tue, 31 Jan 2012 17:37:10 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:126 We iterate underlyingQueue twice.&lt;br/&gt;
  Can we reduce to one iteration ? We can call underlyingQueue.clear() at the end.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:125 Can we reuse the drainTo() at line 134 and specify Integer.MAX_VALUE here ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:141 Reduce to one iteration.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/HbaseHandlerMetricsProxy.java:34 Should read &apos;each call&apos;&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13197781" author="phabricator@reviews.facebook.net" created="Wed, 1 Feb 2012 12:22:57 +0000"  >&lt;p&gt;sc has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;  @tedyu: Thanks! The comments make sense. I will update the patch soon.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13197800" author="phabricator@reviews.facebook.net" created="Wed, 1 Feb 2012 12:44:57 +0000"  >&lt;p&gt;sc has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:126 @tedyu: On second thought, I think using draintTo() might still be better.&lt;/p&gt;

&lt;p&gt;  Iterating underlyingQueue and then calling clear() doesn&apos;t work for the case that maxElements is given. Also there may be some thread-safe issues need to be solved.&lt;/p&gt;

&lt;p&gt;  Am I understanding your comment correctly? What do you think?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13197816" author="phabricator@reviews.facebook.net" created="Wed, 1 Feb 2012 12:58:57 +0000"  >&lt;p&gt;sc updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;br/&gt;
Reviewers: dhruba, tedyu, JIRA, heyongqiang&lt;/p&gt;

&lt;p&gt;  Addressed Ted&apos;s comments&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionThriftServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/HbaseHandlerMetricsProxy.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/TBoundedThreadPoolServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestCallQueue.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/thrift/TestThriftServer.java&lt;/p&gt;</comment>
                            <comment id="13197869" author="hadoopqa" created="Wed, 1 Feb 2012 14:31:08 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12512748/HBASE-5186.D1461.8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12512748/HBASE-5186.D1461.8.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -140 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 157 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.coprocessor.TestMasterObserver&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/887//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/887//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/887//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/887//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/887//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/887//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13198008" author="phabricator@reviews.facebook.net" created="Wed, 1 Feb 2012 18:02:58 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;  Thanks for the hard work.&lt;br/&gt;
  One last comment &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:131 Good point about clear() unsuitable for this method.&lt;/p&gt;

&lt;p&gt;  Can we use underlyingQueue.iterator() and remove at most maxElements elements from underlyingQueue ?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13198073" author="zhihyu@ebaysf.com" created="Wed, 1 Feb 2012 19:28:44 +0000"  >&lt;p&gt;Patch v9 is almost same as patch v8.&lt;br/&gt;
I used an iterator to traverse underlyingQueue in drainTo().&lt;/p&gt;

&lt;p&gt;@Scott:&lt;br/&gt;
If v9 looks good to you, I will integrate tomorrow.&lt;/p&gt;</comment>
                            <comment id="13198110" author="hadoopqa" created="Wed, 1 Feb 2012 20:12:22 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12512780/5186-v9.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12512780/5186-v9.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -140 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 157 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestAdmin&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestReplicationPeer&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestHFileBlock&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/888//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/888//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/888//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/888//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/888//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/888//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13198304" author="zhihyu@ebaysf.com" created="Wed, 1 Feb 2012 23:15:15 +0000"  >&lt;p&gt;Ran the two additional failed tests locally based on patch v9 and they passed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  822  mt -Dtest=TestReplicationPeer
  824  mt -Dtest=TestAdmin
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13198326" author="phabricator@reviews.facebook.net" created="Wed, 1 Feb 2012 23:35:52 +0000"  >&lt;p&gt;sc has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:131 If there is another thread also adding elements at the same time, we may remove the wrong element. It is not clean to me how to solve the concurrency problem here.&lt;/p&gt;

&lt;p&gt;  Ted: Do you have any suggestions?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13198338" author="phabricator@reviews.facebook.net" created="Wed, 1 Feb 2012 23:51:52 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:131 Good point.&lt;br/&gt;
  Addressed the concurrency issue in patch v10.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13198339" author="zhihyu@ebaysf.com" created="Wed, 1 Feb 2012 23:52:05 +0000"  >&lt;p&gt;Patch v10 addresses concurrency issue in drainTo().&lt;/p&gt;</comment>
                            <comment id="13198356" author="phabricator@reviews.facebook.net" created="Thu, 2 Feb 2012 00:13:52 +0000"  >&lt;p&gt;sc has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:131 Ted: Looked at v10. It seems to me that we also need to lock this.lock while invoking other methods (take, poll...) on underlyingQueue. Otherwise the lock may not be protecting these operations.&lt;/p&gt;

&lt;p&gt;  But if we do that the performance may be degraded because some of the BlockingQueue use only compareAndSet with no locking.&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13198370" author="phabricator@reviews.facebook.net" created="Thu, 2 Feb 2012 00:27:52 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:131 I don&apos;t see compareAndSet in &lt;a href=&quot;http://fuseyism.com/classpath/doc/java/util/concurrent/ArrayBlockingQueue-source.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://fuseyism.com/classpath/doc/java/util/concurrent/ArrayBlockingQueue-source.html&lt;/a&gt;&lt;br/&gt;
  Or here: &lt;a href=&quot;http://fuseyism.com/classpath/doc/java/util/concurrent/LinkedBlockingQueue-source.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://fuseyism.com/classpath/doc/java/util/concurrent/LinkedBlockingQueue-source.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Will upload patch v11 which adds protection for other methods.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13198411" author="zhihyu@ebaysf.com" created="Thu, 2 Feb 2012 00:52:20 +0000"  >&lt;p&gt;Patch v11 adds protection to other methods of CallQueue.java&lt;/p&gt;</comment>
                            <comment id="13198456" author="phabricator@reviews.facebook.net" created="Thu, 2 Feb 2012 01:53:52 +0000"  >&lt;p&gt;sc has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:131 Cool. If they all use locking as concurrency control, adding one extra lock will not change the performance much.&lt;/p&gt;

&lt;p&gt;  v11 looks good to me. I only have one question. I notice that there is no lock for add, remove, addAll, containsAll, retainAll and removeAll in v11. Is that intentional?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13198471" author="hadoopqa" created="Thu, 2 Feb 2012 02:13:57 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12512887/5186-v11.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12512887/5186-v11.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -140 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 157 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.thrift.TestThriftServerCmdLine&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/891//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/891//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/891//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/891//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/891//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/891//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13198498" author="phabricator@reviews.facebook.net" created="Thu, 2 Feb 2012 02:55:52 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:131 I searched HBase code base and didn&apos;t find any call to drainTo().&lt;/p&gt;

&lt;p&gt;  For simplicity and correctness, I think patch v8 looks better.&lt;/p&gt;

&lt;p&gt;  If drainTo() becomes performance bottleneck, we can come back optimizing it.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13198503" author="phabricator@reviews.facebook.net" created="Thu, 2 Feb 2012 03:13:54 +0000"  >&lt;p&gt;sc has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:131 Ted: I agree. I think ExecutorService only do put() and take() to this queue. It&apos;s better to keep things simple. Thanks for the effort for optimizing the code &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13198505" author="phabricator@reviews.facebook.net" created="Thu, 2 Feb 2012 03:23:53 +0000"  >&lt;p&gt;sc has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java:131 Just checked openjdk ThreadPoolExecutor.java&lt;br/&gt;
  &lt;a href=&quot;http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/6-b14/java/util/concurrent/ThreadPoolExecutor.java#ThreadPoolExecutor&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://grepcode.com/file/repository.grepcode.com/java/root/jdk/openjdk/6-b14/java/util/concurrent/ThreadPoolExecutor.java#ThreadPoolExecutor&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  drainTo() is called by drainQueue() which is called only in shutdownNow(). So I guess you are right about that we can leave this for now.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13198855" author="zhihyu@ebaysf.com" created="Thu, 2 Feb 2012 15:04:26 +0000"  >&lt;p&gt;Patch v12 adds logging to CallQueue.java&lt;/p&gt;</comment>
                            <comment id="13198892" author="hadoopqa" created="Thu, 2 Feb 2012 15:54:34 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12512964/5186-v12.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12512964/5186-v12.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -140 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 157 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/895//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/895//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/895//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/895//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/895//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/895//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13199015" author="zhihyu@ebaysf.com" created="Thu, 2 Feb 2012 17:31:16 +0000"  >&lt;p&gt;Integrated to TRUNK.&lt;/p&gt;

&lt;p&gt;Thanks for the patch Scott.&lt;/p&gt;</comment>
                            <comment id="13199272" author="hudson" created="Thu, 2 Feb 2012 22:05:49 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2652 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2652/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2652/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; Add metrics to ThriftServer (Scott Chen)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionThriftServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/thrift/HbaseHandlerMetricsProxy.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/thrift/TBoundedThreadPoolServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/thrift/TestCallQueue.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/thrift/TestThriftServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13199538" author="hudson" created="Fri, 3 Feb 2012 05:46:08 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #96 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/96/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/96/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; Add metrics to ThriftServer (Scott Chen)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionThriftServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/thrift/CallQueue.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/thrift/HbaseHandlerMetricsProxy.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/thrift/TBoundedThreadPoolServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/thrift/ThriftMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/thrift/ThriftServerRunner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/thrift/TestCallQueue.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/thrift/TestThriftServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13199558" author="schen" created="Fri, 3 Feb 2012 06:44:25 +0000"  >&lt;p&gt;Ted: Thanks for the review on this patch. That helped a lot.&lt;/p&gt;</comment>
                            <comment id="13201048" author="phabricator@reviews.facebook.net" created="Mon, 6 Feb 2012 05:41:59 +0000"  >&lt;p&gt;dhruba has accepted the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13272653" author="phabricator@reviews.facebook.net" created="Thu, 10 May 2012 19:08:48 +0000"  >&lt;p&gt;sc has closed the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5186&quot; title=&quot;Add metrics to ThriftServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5186&quot;&gt;&lt;del&gt;HBASE-5186&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Add metrics to ThriftServer&quot;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1461&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1461&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;To: dhruba, tedyu, JIRA, heyongqiang, sc&lt;br/&gt;
Cc: tedyu, sc, dhruba&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12512873" name="5186-v10.txt" size="34976" author="zhihyu@ebaysf.com" created="Wed, 1 Feb 2012 23:52:05 +0000"/>
                            <attachment id="12512887" name="5186-v11.txt" size="36480" author="zhihyu@ebaysf.com" created="Thu, 2 Feb 2012 00:52:20 +0000"/>
                            <attachment id="12512964" name="5186-v12.txt" size="34953" author="zhihyu@ebaysf.com" created="Thu, 2 Feb 2012 15:04:26 +0000"/>
                            <attachment id="12512780" name="5186-v9.txt" size="34782" author="zhihyu@ebaysf.com" created="Wed, 1 Feb 2012 19:28:44 +0000"/>
                            <attachment id="12511939" name="ASF.LICENSE.NOT.GRANTED--HBASE-5186.D1461.1.patch" size="28294" author="phabricator@reviews.facebook.net" created="Thu, 26 Jan 2012 03:55:40 +0000"/>
                            <attachment id="12511940" name="ASF.LICENSE.NOT.GRANTED--HBASE-5186.D1461.2.patch" size="27203" author="phabricator@reviews.facebook.net" created="Thu, 26 Jan 2012 03:57:39 +0000"/>
                            <attachment id="12511943" name="ASF.LICENSE.NOT.GRANTED--HBASE-5186.D1461.3.patch" size="32958" author="phabricator@reviews.facebook.net" created="Thu, 26 Jan 2012 04:59:40 +0000"/>
                            <attachment id="12511948" name="ASF.LICENSE.NOT.GRANTED--HBASE-5186.D1461.4.patch" size="33226" author="phabricator@reviews.facebook.net" created="Thu, 26 Jan 2012 06:05:40 +0000"/>
                            <attachment id="12512070" name="ASF.LICENSE.NOT.GRANTED--HBASE-5186.D1461.5.patch" size="33001" author="phabricator@reviews.facebook.net" created="Fri, 27 Jan 2012 03:13:43 +0000"/>
                            <attachment id="12512410" name="ASF.LICENSE.NOT.GRANTED--HBASE-5186.D1461.6.patch" size="33320" author="phabricator@reviews.facebook.net" created="Mon, 30 Jan 2012 12:49:11 +0000"/>
                            <attachment id="12512562" name="ASF.LICENSE.NOT.GRANTED--HBASE-5186.D1461.7.patch" size="34801" author="phabricator@reviews.facebook.net" created="Tue, 31 Jan 2012 13:36:09 +0000"/>
                            <attachment id="12512748" name="ASF.LICENSE.NOT.GRANTED--HBASE-5186.D1461.8.patch" size="34664" author="phabricator@reviews.facebook.net" created="Wed, 1 Feb 2012 12:58:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 26 Jan 2012 03:55:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223759</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 32 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0163b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4756</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>