<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:51:07 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1144/HBASE-1144.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1144] Store the ROOT region location in Zookeeper</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1144</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description></description>
                <environment></environment>
        <key id="12412928">HBASE-1144</key>
            <summary>Store the ROOT region location in Zookeeper</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12392373">HBASE-546</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nitay">Nitay Joffe</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Jan 2009 19:04:12 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:21 +0000</updated>
                            <resolved>Fri, 30 Jan 2009 01:19:12 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12667120" author="nitay" created="Sun, 25 Jan 2009 18:52:17 +0000"  >&lt;p&gt;I&apos;ve attached a patch which is an update of the patches from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-546&quot; title=&quot;Use Zookeeper in HBase&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-546&quot;&gt;&lt;del&gt;HBASE-546&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Replying to comments from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-546:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-546:&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&amp;gt; Jean-Daniel Cryans - 21/Jan/09 07:33 AM&lt;br/&gt;
&amp;gt; Nitay,&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; The config in hbase-default.xml should be expressed as numbers and not operations like zookeeper.pause should be 2000 and not 2 * 1000. Also, since zookeeper.servers requires to be set for a fully distributed HBase,so you should modify the src/java/overview.html file.&lt;/p&gt;

&lt;p&gt;Fixed.&lt;/p&gt;

&lt;p&gt;&amp;gt; stack - 21/Jan/09 02:46 PM&lt;br/&gt;
&amp;gt; For zookeeper.servers, you specify a quorum by listing the quorum members?&lt;/p&gt;

&lt;p&gt;Yes. This parameter feeds directly into the ZooKeeper object constructor. For example, I&apos;m using in my config:&lt;/p&gt;

&lt;p&gt;&amp;lt;name&amp;gt;zookeeper.servers&amp;lt;/name&amp;gt;&lt;br/&gt;
&amp;lt;value&amp;gt;aa0-001-13.u.powerset.com:2181,aa0-000-12.u.powerset.com:2181,aa0-000-13.u.powerset.com:2181,aa0-000-14.u.powerset.com:2181...&lt;/p&gt;

&lt;p&gt;&amp;gt; When single-instance of zk that has been started by hbase runs, where does it write its logs. Can that be configurable?&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; What if I specify a full-path for zookeeper.znode.rootserver, will that write root region location outside of zookeeper.znode.parent?&lt;/p&gt;

&lt;p&gt;Not as it was. Now it will. Fixed.&lt;/p&gt;

&lt;p&gt;&amp;gt; (Regards a question you asked on IRC a few days ago) If things like DEFAULT_ZOOKEEPER_SERVERS , are only used in one place, I&apos;d say don&apos;t need to be in HConstants... just do it in place used. If used more than once, its good to define HConstants AND they are used by more than one class (otherwise, do the define inside that class)&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; Should below be synchronized nitay?&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; + private ZooKeeperWrapper getZooKeeperWrapper() throws IOException {&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; Is there danger that two threads could be asking for it at about same time?&lt;/p&gt;

&lt;p&gt;Yes, good call. Fixed.&lt;/p&gt;

&lt;p&gt;&amp;gt; This is an interesting change Nitay: - public HServerAddress findRootRegion();... removing it from the Master. I like it. ZK rules now!&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; Below....&lt;br/&gt;
&amp;gt; + * Copyright 2008 The Apache Software Foundation&lt;br/&gt;
&amp;gt; ... should be 2009&lt;/p&gt;

&lt;p&gt;Fixed.&lt;/p&gt;

&lt;p&gt;&amp;gt; Below has trailing &apos;\&apos;&lt;br/&gt;
&amp;gt;&lt;br/&gt;
&amp;gt; + * Wraps a ZooKeeper instance and adds HBase specific functionality.\&lt;/p&gt;

&lt;p&gt;Fixed.&lt;/p&gt;

&lt;p&gt;&amp;gt; Can these be final in ZKWrapper?&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; + private ZooKeeper zooKeeper;&lt;br/&gt;
&amp;gt; + private WatcherWrapper watcher;&lt;/p&gt;

&lt;p&gt;Fixed.&lt;/p&gt;

&lt;p&gt;&amp;gt; ... same in HRS:&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; + private ZooKeeperWrapper zooKeeperWrapper;&lt;/p&gt;

&lt;p&gt;Fixed.&lt;/p&gt;

&lt;p&gt;&amp;gt; In below...&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; + rootRegionZNode = parentZNode + &quot;/&quot; + rootServerZNodeName;&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; ... does ZK have a define for path separator?&lt;/p&gt;

&lt;p&gt;Not that I can see in the code. I filed a JIRA for this: &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-277&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/ZOOKEEPER-277&lt;/a&gt;. I put in my own constant for this with a comment to fix when that issue gets resolved.&lt;/p&gt;

&lt;p&gt;&amp;gt; We don&apos;t throw exception if we fail to get root:&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; +    try &lt;/p&gt;
{
&amp;gt; +      data = zooKeeper.getData(rootRegionZNode, false, null);
&amp;gt; +    }
&lt;p&gt; catch (InterruptedException e) &lt;/p&gt;
{
&amp;gt; +      return null;
&amp;gt; +    } catch (KeeperException e) {
&amp;gt; +      return null;
&amp;gt; +    }
&lt;p&gt;&amp;gt; &lt;br/&gt;
&amp;gt; ... is that good? Does caller handle null?&lt;/p&gt;

&lt;p&gt;Yes. There are two callers to this method:&lt;/p&gt;

&lt;p&gt;HConnectionManager:&lt;/p&gt;

&lt;p&gt;  if (outOfSafeMode) &lt;/p&gt;
{
    rootRegionAddress = zooKeeperWrapper.readRootRegionLocation();
  }
&lt;p&gt;  if (rootRegionAddress == null) {&lt;br/&gt;
    try {&lt;br/&gt;
      if (LOG.isDebugEnabled()) &lt;/p&gt;
{
        LOG.debug(&quot;Sleeping &quot; + getPauseTime(tries) +
          &quot;ms, waiting for root region.&quot;);
      }
&lt;p&gt;      Thread.sleep(getPauseTime(tries));&lt;br/&gt;
    } catch (InterruptedException iex) &lt;/p&gt;
{
      // continue
    }
&lt;p&gt;    localTimeouts++;&lt;br/&gt;
  }&lt;/p&gt;

&lt;p&gt;HRegionServer:&lt;/p&gt;

&lt;p&gt;  HServerAddress rootServer = zooKeeperWrapper.readRootRegionLocation();&lt;br/&gt;
  if (rootServer != null) &lt;/p&gt;
{
    // By setting the root region location, we bypass the wait imposed on
    // HTable for all regions being assigned.
    this.connection.setRootRegionLocation(
        new HRegionLocation(HRegionInfo.ROOT_REGIONINFO, rootServer));
    haveRootRegion.set(true);
  }

&lt;p&gt;&amp;gt; Whats story w/ data in ZK? Its byte arrays? Should they be UTF-8? If so, Bytes.toBytes over in hbase util might help. E.g. rather than + String addressString = new String(data); ...&lt;br/&gt;
&amp;gt; which could give different answers if the client was in different local than original writer, be explicit its utf-8 and do Bytes.toBytes(....) when writing and Bytes.toString(... when getting?&lt;/p&gt;

&lt;p&gt;Good call. I was doing the Bytes.toBytes() side of things, but not the Bytes.toString() side. Fixed.&lt;/p&gt;</comment>
                            <comment id="12667125" author="nitay" created="Sun, 25 Jan 2009 19:07:17 +0000"  >&lt;p&gt;Updates to the overview.html documentation.&lt;/p&gt;

&lt;p&gt;While writing this and thinking about Stack&apos;s comments I realized that our current system for configuring ZooKeeper is too complicated.&lt;/p&gt;

&lt;p&gt;We have certain pieces of information which needs to be duplicated in zoo.cfg, zookeepers, and hbase-site.xml.&lt;/p&gt;

&lt;p&gt;From my example in the documentation:&lt;/p&gt;

&lt;p&gt;zoo.cfg:&lt;/p&gt;

&lt;p&gt;  tickTime=2000&lt;br/&gt;
  dataDir=/var/zookeeper&lt;br/&gt;
  clientPort=2181&lt;br/&gt;
  initLimit=5&lt;br/&gt;
  syncLimit=2&lt;br/&gt;
  server.1=zoo1:2888:3888&lt;br/&gt;
  server.2=zoo2:2888:3888&lt;br/&gt;
  server.3=zoo3:2888:3888&lt;/p&gt;

&lt;p&gt;zookeepers:&lt;/p&gt;

&lt;p&gt;  zoo1&lt;br/&gt;
  zoo2&lt;br/&gt;
  zoo3&lt;/p&gt;

&lt;p&gt;hbase-site.xml:&lt;/p&gt;

&lt;p&gt;  &amp;lt;configuration&amp;gt;&lt;br/&gt;
    ...&lt;br/&gt;
    &amp;lt;property&amp;gt;&lt;br/&gt;
      &amp;lt;name&amp;gt;zookeeper.servers&amp;lt;/name&amp;gt;&lt;br/&gt;
      &amp;lt;value&amp;gt;zoo1:2181,zoo2:2181,zoo3:2181&amp;lt;/value&amp;gt;&lt;br/&gt;
      &amp;lt;description&amp;gt;The host and port that the ZooKeeper quorum servers run at.&lt;br/&gt;
      &amp;lt;/description&amp;gt;&lt;br/&gt;
    &amp;lt;/property&amp;gt;&lt;br/&gt;
    ...&lt;br/&gt;
  &amp;lt;/configuration&amp;gt;&lt;/p&gt;


&lt;p&gt;Specifically, the list of quorum servers in zoo.cfg is written to the zookeepers file so that HBase can start/stop the daemons on remote nodes. In hbase-site.xml we put the host1:port,host2:port list of quorum servers so that clients know who to talk to.&lt;/p&gt;

&lt;p&gt;Instead, I think we should get rid of the zookeepers file and the zookeeper.servers option in hbase-site.xml and rely solely on zoo.cfg. We do not need to change/add any options to zoo.cfg, it remains strictly a ZooKeeper configuration file, but we can parse everything we need out of it.&lt;/p&gt;

&lt;p&gt;The zookeepers file is simply the host part of the server.X lines. The zookeeper.servers option in hbase-site.xml is the hosts with the clientPort appended to them.&lt;/p&gt;

&lt;p&gt;The only reason I can think of to keep it separated is in cases where we want HBase to use some existing ZooKeeper cluster which would mean leaving the zookeepers file empty. I think this case can be controlled with some new boolean option in hbase-site.xml (defaulting to true) which tells HBase whether to try starting/stopping ZooKeeper.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="12667342" author="stack" created="Mon, 26 Jan 2009 18:28:25 +0000"  >&lt;p&gt;+1 on your last comment nitay.  info in 3 places is for sure result in twisted knickers.  in hbase-default.xml, add an empty zookeeper.servers.  when empty, hbase starts/stops zk.  when populated, hbase uses the pointed-to zk cluster&lt;/p&gt;</comment>
                            <comment id="12667345" author="stack" created="Mon, 26 Jan 2009 18:36:18 +0000"  >&lt;p&gt;In IRC nitay put me right.  I agree that a boolean in hbase-default.xml is way to go (clients read the quorum address from zoo.conf whether local or remote &amp;#8211; makes sense).  boolean says whether or not quorum members are hbase-managed&lt;/p&gt;</comment>
                            <comment id="12667617" author="apparition" created="Tue, 27 Jan 2009 08:06:28 +0000"  >&lt;p&gt;Am I right that you are going provide access for clients to ZK servers? Is it secure? &lt;br/&gt;
As I understand ZK is like nervous system for distributed system, to share: configuration, information about status for each nod, some massages about some events. For INTERNAL purposes only. So may be we can even reduce all chatting between nods to sharing information in ZK. It can be really nice &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
But clients are EXTERNAL, is it good to make external access to such sacred place as nervous system of DB?&lt;/p&gt;

&lt;p&gt;There is a problem that in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-546&quot; title=&quot;Use Zookeeper in HBase&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-546&quot;&gt;&lt;del&gt;HBASE-546&lt;/del&gt;&lt;/a&gt; we are going to store in ZK information about which master is active. So clients need in this information to get active master. May be we can just give list of all possible masters (active and hot ready) for clients and they will try to find active by sending requests.&lt;/p&gt;</comment>
                            <comment id="12668326" author="nitay" created="Thu, 29 Jan 2009 04:23:39 +0000"  >&lt;p&gt;Evgeny,&lt;/p&gt;

&lt;p&gt;ZooKeeper does have access control lists that we can use to try to prevent external clients from corrupting things. That said though, I think the whole point of this is to get both the external clients and internal servers coordinating through ZooKeeper rather than each other.&lt;/p&gt;

&lt;p&gt;Perhaps Stack/JDCryans can elaborate further.&lt;/p&gt;</comment>
                            <comment id="12668327" author="nitay" created="Thu, 29 Jan 2009 04:25:04 +0000"  >&lt;p&gt;Added parsing of conf/zoo.cfg to get clientPort/list of servers. If there are no server.X lines it is assumed that we are running our local ZooKeeper on the master server.&lt;br/&gt;
Also updated the overview.html file.&lt;/p&gt;</comment>
                            <comment id="12668683" author="stack" created="Fri, 30 Jan 2009 00:49:18 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I&apos;ll add javadoc to the Wrapper* class in its class comment location.&lt;/p&gt;

&lt;p&gt;Will also add to overview doc. that user should make sure dataDir is good.&lt;/p&gt;</comment>
                            <comment id="12668696" author="stack" created="Fri, 30 Jan 2009 01:19:12 +0000"  >&lt;p&gt;On adding to overview, we&apos;re going to fix fact that user needs to currently configure in zoo.conf so I did NOT change overview.html.  Thanks for the patch Nitay.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12413319">HBASE-1156</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12413344">HBASE-1157</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12398975" name="hbase-1144-v2.patch" size="53682" author="nitay" created="Thu, 29 Jan 2009 04:25:04 +0000"/>
                            <attachment id="12398693" name="hbase-1144.patch" size="49259" author="nitay" created="Sun, 25 Jan 2009 18:52:17 +0000"/>
                            <attachment id="12398695" name="overview.patch" size="4233" author="nitay" created="Sun, 25 Jan 2009 19:07:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 25 Jan 2009 18:52:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32003</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 47 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hbl3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99139</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>