<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:00:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9032/HBASE-9032.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9032] Result.getBytes() returns null if backed by KeyValue array</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9032</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This applies only to 0.94 (and earlier) branch.&lt;/p&gt;

&lt;p&gt;If the Result object was constructed using either of Result(KeyValue[]) or Result(List&amp;lt;KeyValue&amp;gt;), calling Result.getBytes() returns null instead of the serialized ImmutableBytesWritable object.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12659463">HBASE-9032</key>
            <summary>Result.getBytes() returns null if backed by KeyValue array</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="adityakishore">Aditya Kishore</assignee>
                                    <reporter username="adityakishore">Aditya Kishore</reporter>
                        <labels>
                    </labels>
                <created>Tue, 23 Jul 2013 23:24:51 +0000</created>
                <updated>Wed, 21 Aug 2013 00:08:48 +0000</updated>
                            <resolved>Mon, 29 Jul 2013 18:54:49 +0000</resolved>
                                    <version>0.94.9</version>
                                    <fixVersion>0.94.11</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13717762" author="yuzhihong@gmail.com" created="Tue, 23 Jul 2013 23:31:02 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) { /* should never happen */ }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Add a log in case of catching IOException ?&lt;/p&gt;

&lt;p&gt;If you reverse the condition for if statement, you should be able to save some indentation.&lt;/p&gt;</comment>
                            <comment id="13717767" author="adityakishore" created="Tue, 23 Jul 2013 23:34:37 +0000"  >&lt;p&gt;Attached is a simple patch which serializes the KeyValue array into ImmutableBytesWritable if the former is not null while later is.&lt;/p&gt;

&lt;p&gt;Not submitting patch to Hadoop QA since this is not intended for 0.95 or trunk.&lt;/p&gt;</comment>
                            <comment id="13717774" author="jmspaggi" created="Tue, 23 Jul 2013 23:45:36 +0000"  >&lt;p&gt;Same comment as Ted. Apart from that, I&apos;m +1.&lt;/p&gt;</comment>
                            <comment id="13717775" author="adityakishore" created="Tue, 23 Jul 2013 23:45:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;Add a log in case of catching IOException ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;These are the instances where Java&apos;s checked exceptions add unnecessary verbosity to the code. The only error/exception that could happen in this clock is OOM since the IO is to memory buffer. Any attempt to log that would be pointless. Beside, this class has been LOG less so far so did not want to do that.&lt;/p&gt;

&lt;p&gt;In any case, would do if you insist &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If you reverse the condition for if statement, you should be able to save some indentation.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Either that or introduce double return from the function. Was trying to avoid the later. Further, other functions in this class follow similar style.&lt;/p&gt;</comment>
                            <comment id="13717793" author="jmspaggi" created="Tue, 23 Jul 2013 23:59:12 +0000"  >&lt;p&gt;I will say costs nothing to add a LOG here. It will not add any cpu overhead and as you said should never be called. But if any exception occurs for any obscure reason, that might still help to track it?&lt;/p&gt;</comment>
                            <comment id="13717800" author="adityakishore" created="Wed, 24 Jul 2013 00:06:31 +0000"  >&lt;p&gt;Would throwing a wrapped RuntimeException make more sense? Will let the application code decide how to handle.&lt;/p&gt;</comment>
                            <comment id="13717848" author="yuzhihong@gmail.com" created="Wed, 24 Jul 2013 00:56:48 +0000"  >&lt;p&gt;Throwing RuntimeException is fine.&lt;/p&gt;</comment>
                            <comment id="13717866" author="jmspaggi" created="Wed, 24 Jul 2013 01:18:06 +0000"  >&lt;p&gt;I will say that both at fine for me. With a little + for the RuntimeException. Ted? On your side?&lt;/p&gt;</comment>
                            <comment id="13717900" author="adityakishore" created="Wed, 24 Jul 2013 02:11:20 +0000"  >&lt;p&gt;Attached is the new patch on account of review comments.&lt;/p&gt;

&lt;p&gt;Thanks Ted and Jean-Marc for reviewing.&lt;/p&gt;</comment>
                            <comment id="13717942" author="lhofhansl" created="Wed, 24 Jul 2013 03:53:02 +0000"  >&lt;p&gt;Do you have a specific use case why you need this?&lt;br/&gt;
The bytes object is only used for serialization. One could argue that getBytes() should not be public.&lt;/p&gt;

&lt;p&gt;I&apos;m not saying we should not fix it, but I&apos;m curious as to why you would need it.&lt;/p&gt;</comment>
                            <comment id="13717991" author="adityakishore" created="Wed, 24 Jul 2013 05:10:04 +0000"  >&lt;p&gt;Lars,&lt;/p&gt;

&lt;p&gt;I agree that the underlying byte array object is implementation detail and should not be public.&lt;/p&gt;

&lt;p&gt;Unfortunately it is public and as a result some of our advanced users have been using it in their applications. I am not privy to the exact use case but it worked for them until it did not and we diagnosed this to be the reason. They are aware that this is going to go away in next major version but it will be some time before their applications will be migrated to the new APIs.&lt;/p&gt;

&lt;p&gt;Thanks for having a look.&lt;/p&gt;</comment>
                            <comment id="13718622" author="stack" created="Wed, 24 Jul 2013 17:43:49 +0000"  >&lt;p&gt;+1 for 0.94&lt;/p&gt;</comment>
                            <comment id="13721928" author="adityakishore" created="Sun, 28 Jul 2013 09:09:23 +0000"  >&lt;p&gt;Updating the patch with a test case.&lt;/p&gt;</comment>
                            <comment id="13721942" author="jmspaggi" created="Sun, 28 Jul 2013 12:27:05 +0000"  >&lt;p&gt;Nice to have a test! Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adityakishore&quot; class=&quot;user-hover&quot; rel=&quot;adityakishore&quot;&gt;Aditya Kishore&lt;/a&gt;. However, I will have prefered to user Assert.assertNotNull(r1.getBytes()); instead of &quot;Result r2 = new Result(r1.getBytes());&quot;. Because the only exception you are looking for is the NPE, if any other exception occurs you will still mark this test as failed.&lt;/p&gt;</comment>
                            <comment id="13722030" author="adityakishore" created="Sun, 28 Jul 2013 19:46:58 +0000"  >&lt;p&gt;Jean-Marc,&lt;/p&gt;

&lt;p&gt;With my patch, r1.getBytes() is always going to be not null (unless someone modifies it).&lt;/p&gt;

&lt;p&gt;What I was going for is verification that deserialization is in sync with serialization, i.e. you can create a valid Result object using the returned ImmutableBytesWritable and that both are equal. compareResults() throws exception if both the Result objects are not equal.&lt;/p&gt;</comment>
                            <comment id="13722071" author="jmspaggi" created="Sun, 28 Jul 2013 22:19:53 +0000"  >&lt;p&gt;Ok I see.&lt;/p&gt;

&lt;p&gt;There can be 2 cases here.&lt;/p&gt;

&lt;p&gt;1) r1.getBytes() can be null (before your patch).&lt;br/&gt;
2) r1.getBytes() can be different than expected.&lt;/p&gt;

&lt;p&gt;If r1.getBytes() send null, Result() constructor will still work but the comparison will fail. If r1.getBytes() works but send a differenlt result that expected, the comparison will faile too. So you don&apos;t really have a differentiation between the 2 cases. Adding  Assert.assertNotNull(r1.getBytes()) will allow to differentiate that. In both cases, test will fail, but that will help to know what failed in it.&lt;/p&gt;

&lt;p&gt;So, forget what I said about &quot; instead of Result r2 = new&quot;, it should have been &quot; in addition of Result.compareResults(r1, r2);&quot; (just before).&lt;/p&gt;

&lt;p&gt;Make sense? &lt;/p&gt;</comment>
                            <comment id="13722100" author="adityakishore" created="Mon, 29 Jul 2013 01:15:27 +0000"  >&lt;p&gt;Sure. Patch modified and attached.&lt;/p&gt;</comment>
                            <comment id="13722101" author="jmspaggi" created="Mon, 29 Jul 2013 01:22:46 +0000"  >&lt;p&gt;Excellent. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adityakishore&quot; class=&quot;user-hover&quot; rel=&quot;adityakishore&quot;&gt;Aditya Kishore&lt;/a&gt;! I&apos;m +1.&lt;/p&gt;

&lt;p&gt;You have +1 from Stack, so I guess you just need another +1 from another commiter to get it pushed. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;, good for you?&lt;/p&gt;</comment>
                            <comment id="13722154" author="lhofhansl" created="Mon, 29 Jul 2013 04:59:59 +0000"  >&lt;p&gt;Sorry, -0 from me.&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;This ties the caller to the internal workings of the Result object&lt;/li&gt;
	&lt;li&gt;It cements this API even further for other user just starting with 0.94. This method should have never been public.&lt;/li&gt;
	&lt;li&gt;As you point out, this API is going away in 0.95&lt;/li&gt;
	&lt;li&gt;There might be code out there relying on the current behavior (maybe for detecting whether a Result object was deserialized from RPC)&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Now, I am not blocking it. It won&apos;t do much harm I think. But I would prefer if somebody else commits it. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13722834" author="stack" created="Mon, 29 Jul 2013 18:54:49 +0000"  >&lt;p&gt;I like &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; take that this should never have been public.  Given that it is and that it sometimes is broke, I committed the patch to 0.94 trunk.  Thanks Aditya.&lt;/p&gt;</comment>
                            <comment id="13722921" author="adityakishore" created="Mon, 29 Jul 2013 20:13:58 +0000"  >&lt;p&gt;Thanks Lars, Stack.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12594617" name="HBASE-9032.patch" size="3296" author="adityakishore" created="Mon, 29 Jul 2013 01:15:27 +0000"/>
                            <attachment id="12594585" name="HBASE-9032.patch" size="2866" author="adityakishore" created="Sun, 28 Jul 2013 09:09:23 +0000"/>
                            <attachment id="12593828" name="HBASE-9032.patch" size="1523" author="adityakishore" created="Wed, 24 Jul 2013 02:11:20 +0000"/>
                            <attachment id="12593805" name="HBASE-9032.patch" size="1465" author="adityakishore" created="Tue, 23 Jul 2013 23:25:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 23 Jul 2013 23:31:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339656</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1mkzz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339976</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>