<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:57:48 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8709/HBASE-8709.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8709] consider a scheme to allow compacting files in any combination</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8709</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We were discussing something and I came up with the following scheme. Consider this. The main problem for choosing out-of-order files for compactions is full key collisions (k, cf:c, ts are the same). We rely on file seqnum to resolve these. There&apos;d be no problem if we stored seqnum for each KV, but that is an overkill. What can we do is this.&lt;br/&gt;
1) Store min seqnum for a file together with the max. Assume file seqnum ranges don&apos;t overlap.&lt;br/&gt;
2) Store seqnum for each KV in memory of the memstore.&lt;br/&gt;
3) On flush, don&apos;t write out seqnums unless there&apos;s a full conflict inside this memstore. We will have to change file format unfortunately to tuck on a bit somewhere to indicate there&apos;s varint seqnum.&lt;br/&gt;
4) On compaction, when dropping versions we can drop these seqnums.&lt;br/&gt;
5) On compaction, if we see a full conflict with no seqnums (i.e. KVs coming from different files), write out seqnums for the KVs involved as median of the respective file ranges (or something like that). We only ever use these KVs to resolve full conflicts so we don&apos;t care about relations between keys. &lt;/p&gt;

&lt;p&gt;Both of the places where we write seqnums we will need to see the next KV before writing previous KV, so there&apos;s some complexity, however the &quot;buffering&quot; is never more than one KV long - if we see different k-c-t we know we don&apos;t need a seqnum unless we are in conflict with previous KVs which we have already written, if we see the same one we know we need a seqnum. &lt;/p&gt;

</description>
                <environment></environment>
        <key id="12651751">HBASE-8709</key>
            <summary>consider a scheme to allow compacting files in any combination</summary>
                <type id="13" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/genericissue.png">Brainstorming</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Jun 2013 18:01:45 +0000</created>
                <updated>Mon, 10 Jun 2013 20:27:06 +0000</updated>
                            <resolved>Fri, 7 Jun 2013 18:03:27 +0000</resolved>
                                                                    <component>Compaction</component>
                    <component>HFile</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13678224" author="sershe" created="Fri, 7 Jun 2013 18:03:28 +0000"  >&lt;p&gt;Scratch that, after the first out-of-order choice the ranges can overlap&lt;/p&gt;</comment>
                            <comment id="13678229" author="sershe" created="Fri, 7 Jun 2013 18:06:14 +0000"  >&lt;p&gt;Well, I guess you could store ranges in header, and then have each KV contain few bits for which range it&apos;s coming from, but that now becomes complex.&lt;/p&gt;</comment>
                            <comment id="13678680" author="stack" created="Sat, 8 Jun 2013 04:45:28 +0000"  >&lt;blockquote&gt;&lt;p&gt;...if we stored seqnum for each KV...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We have talked of doing this in the past a few times.  We currently have in KV an extra data member to hold the current mvcc number and when we flush an hfile we write out the highest keys&apos; mvcc number so we know where to slot in it&apos;s content in say an outstanding scan.&lt;/p&gt;

&lt;p&gt;Adding seqnum to some KVs and persisting out to storefile would take some work.&lt;/p&gt;

&lt;p&gt;When we store the seqid in memstore, would we sort on it?  Would we allow multiple versions in memstore distingushed by their seqid only?  Currently the newer edit would overwrite the older in memstore.&lt;/p&gt;
</comment>
                            <comment id="13679688" author="sershe" created="Mon, 10 Jun 2013 17:54:22 +0000"  >&lt;p&gt;The latter doesn&apos;t seem to be correct behavior, it should be a separate version right?&lt;/p&gt;</comment>
                            <comment id="13679776" author="stack" created="Mon, 10 Jun 2013 18:59:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;The latter doesn&apos;t seem to be correct behavior, it should be a separate version right?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Currently overwrites though seqid different which is fine I believe except in the case of out-of-order distributed log replay... In this case we want to ensure an older write does not overwrite a newer one.&lt;/p&gt;</comment>
                            <comment id="13679782" author="stack" created="Mon, 10 Jun 2013 19:07:04 +0000"  >&lt;p&gt;... we would need to preserve seqid too if files to compact were not in order.&lt;/p&gt;</comment>
                            <comment id="13679869" author="sershe" created="Mon, 10 Jun 2013 20:27:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;... we would need to preserve seqid too if files to compact were not in order.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 8 Jun 2013 04:45:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332076</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 27 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lacn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332405</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>