<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:50:34 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14182/HBASE-14182.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14182] My regionserver change ip. But hmaster still connect to old ip after the rs restart</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14182</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I use docker to deploy my hbase cluster, and the RS ip changed. When restart this RS,  hmaster webUI shows it connect to hmaster, but regions num. is zero after a long time. I check the hmaster log and found that master still use old ip to connect this rs.&lt;/p&gt;

&lt;p&gt;This is hmaster&apos;s log below:&lt;br/&gt;
PS: 10.11.21.140 is old ip of  rs dx-ape-regionserver1-online&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-08-04 17:24:00,081 INFO  [AM.ZK.Worker-pool2-t14141] master.AssignmentManager: Assigning solar_image,\x01Y\x8E\xA3y,1434968237206.4a1bdeec85b9f55b962596f9fb2cd07f. to dx-ape-regionserver1-online,60020,1438679950072
2015-08-04 17:24:06,800 WARN  [AM.ZK.Worker-pool2-t14133] master.AssignmentManager: Failed assignment of solar_image,\x00\x94\x09\x8D\x95,1430991781025.b0f5b755f443d41cf306026a60675020. to dx-ape-regionserver1-online,60020,1438679950072, trying to assign elsewhere instead; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;=3 of 10
java.net.ConnectException: Connection timed out
        at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)
        at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:716)
        at org.apache.hadoop.net.SocketIOWithTimeout.connect(SocketIOWithTimeout.java:206)
        at org.apache.hadoop.net.NetUtils.connect(NetUtils.java:529)
        at org.apache.hadoop.net.NetUtils.connect(NetUtils.java:493)
        at org.apache.hadoop.hbase.ipc.RpcClient$Connection.setupConnection(RpcClient.java:578)
        at org.apache.hadoop.hbase.ipc.RpcClient$Connection.setupIOstreams(RpcClient.java:868)
        at org.apache.hadoop.hbase.ipc.RpcClient.getConnection(RpcClient.java:1543)
        at org.apache.hadoop.hbase.ipc.RpcClient.call(RpcClient.java:1442)
        at org.apache.hadoop.hbase.ipc.RpcClient.callBlockingMethod(RpcClient.java:1661)
        at org.apache.hadoop.hbase.ipc.RpcClient$BlockingRpcChannelImplementation.callBlockingMethod(RpcClient.java:1719)
        at org.apache.hadoop.hbase.protobuf.generated.AdminProtos$AdminService$BlockingStub.openRegion(AdminProtos.java:20964)
        at org.apache.hadoop.hbase.master.ServerManager.sendRegionOpen(ServerManager.java:671)
        at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:2097)
        at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:1577)
        at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:1550)
        at org.apache.hadoop.hbase.master.handler.ClosedRegionHandler.process(ClosedRegionHandler.java:104)
        at org.apache.hadoop.hbase.master.AssignmentManager.handleRegion(AssignmentManager.java:999)
        at org.apache.hadoop.hbase.master.AssignmentManager$6.run(AssignmentManager.java:1447)
        at org.apache.hadoop.hbase.master.AssignmentManager$3.run(AssignmentManager.java:1260)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
2015-08-04 17:24:06,801 WARN  [AM.ZK.Worker-pool2-t14140] master.AssignmentManager: Failed assignment of solar_image,\x00(.\xE7\xB1L,1430024620929.534025fcf4cae5516513b9c9a4cf73dc. to dx-ape-regionserver1-online,60020,1438679950072, trying to assign elsewhere instead; &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;=2 of 10
java.net.ConnectException: Call to dx-ape-regionserver1-online/10.11.21.140:60020 failed on connection exception: java.net.ConnectException: Connection timed out
        at org.apache.hadoop.hbase.ipc.RpcClient.wrapException(RpcClient.java:1483)
        at org.apache.hadoop.hbase.ipc.RpcClient.call(RpcClient.java:1461)
        at org.apache.hadoop.hbase.ipc.RpcClient.callBlockingMethod(RpcClient.java:1661)
        at org.apache.hadoop.hbase.ipc.RpcClient$BlockingRpcChannelImplementation.callBlockingMethod(RpcClient.java:1719)
        at org.apache.hadoop.hbase.protobuf.generated.AdminProtos$AdminService$BlockingStub.openRegion(AdminProtos.java:20964)
        at org.apache.hadoop.hbase.master.ServerManager.sendRegionOpen(ServerManager.java:671)
        at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:2097)
        at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:1577)
        at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:1550)
        at org.apache.hadoop.hbase.master.handler.ClosedRegionHandler.process(ClosedRegionHandler.java:104)
        at org.apache.hadoop.hbase.master.AssignmentManager.handleRegion(AssignmentManager.java:999)
        at org.apache.hadoop.hbase.master.AssignmentManager$6.run(AssignmentManager.java:1447)
        at org.apache.hadoop.hbase.master.AssignmentManager$3.run(AssignmentManager.java:1260)
        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)
        at java.util.concurrent.FutureTask.run(FutureTask.java:266)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.net.ConnectException: Connection timed out
        at sun.nio.ch.SocketChannelImpl.checkConnect(Native Method)
        at sun.nio.ch.SocketChannelImpl.finishConnect(SocketChannelImpl.java:716)
        at org.apache.hadoop.net.SocketIOWithTimeout.connect(SocketIOWithTimeout.java:206)
        at org.apache.hadoop.net.NetUtils.connect(NetUtils.java:529)
        at org.apache.hadoop.net.NetUtils.connect(NetUtils.java:493)
        at org.apache.hadoop.hbase.ipc.RpcClient$Connection.setupConnection(RpcClient.java:578)
        at org.apache.hadoop.hbase.ipc.RpcClient$Connection.setupIOstreams(RpcClient.java:868)
        at org.apache.hadoop.hbase.ipc.RpcClient.getConnection(RpcClient.java:1543)
        at org.apache.hadoop.hbase.ipc.RpcClient.call(RpcClient.java:1442)
        ... 16 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12851367">HBASE-14182</key>
            <summary>My regionserver change ip. But hmaster still connect to old ip after the rs restart</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="chenheng">Heng Chen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Aug 2015 11:02:47 +0000</created>
                <updated>Wed, 5 Aug 2015 01:02:13 +0000</updated>
                            <resolved>Tue, 4 Aug 2015 22:23:03 +0000</resolved>
                                    <version>0.98.6</version>
                                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="14653730" author="chenheng" created="Tue, 4 Aug 2015 14:33:55 +0000"  >&lt;p&gt;I think i found the answer!&lt;/p&gt;

&lt;p&gt;RpcClient use InetAddress class in Java.  And InetAddress has a cache to store &amp;lt;host,ip&amp;gt; pair&lt;br/&gt;
getAllByName0 will be called when request ip for a host, the source code in jdk1.8 is below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; InetAddress[] getAllByName0 (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; host, InetAddress reqAddr, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; check)
        &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; UnknownHostException  {

        /* If it gets here it is presumed to be a hostname */
        /* Cache.get can &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, unknownAddress, or InetAddress[] */

        /* make sure the connection to the host is allowed, before we
         * give out a hostname
         */
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (check) {
            &lt;span class=&quot;code-object&quot;&gt;SecurityManager&lt;/span&gt; security = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.getSecurityManager();
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (security != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                security.checkConnect(host, -1);
            }
        }

        InetAddress[] addresses = getCachedAddresses(host);

        /* If no entry in cache, then &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; the host lookup */
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (addresses == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            addresses = getAddressesFromNameService(host, reqAddr);
        }

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (addresses == unknown_array)
            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; UnknownHostException(host);

        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; addresses.clone();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It will request cache first.  &lt;/p&gt;

&lt;p&gt;So we can&apos;t change rs ip without hmaster restart.&lt;/p&gt;

&lt;p&gt;One solution is that we can store ip information in ZK, and pass ip information into InetAddress Constructor when generate new instance.  The problem will be solved. &lt;/p&gt;
</comment>
                            <comment id="14653748" author="chenheng" created="Tue, 4 Aug 2015 14:46:09 +0000"  >&lt;p&gt;It seems has a better solution.  As JDK docs said &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;InetAddress Caching&lt;br/&gt;
The InetAddress class has a cache to store successful as well as unsuccessful host name resolutions.&lt;br/&gt;
By default, when a security manager is installed, in order to protect against DNS spoofing attacks, the result of positive host name resolutions are cached forever. When a security manager is not installed, the default behavior is to cache entries for a finite (implementation dependent) period of time. The result of unsuccessful host name resolution is cached for a very short period of time (10 seconds) to improve performance.&lt;/p&gt;

&lt;p&gt;If the default behavior is not desired, then a Java security property can be set to a different Time-to-live (TTL) value for positive caching. Likewise, a system admin can configure a different negative caching TTL value when needed.&lt;/p&gt;

&lt;p&gt;Two Java security properties control the TTL values used for positive and negative host name resolution caching:&lt;/p&gt;

&lt;p&gt;networkaddress.cache.ttl&lt;br/&gt;
Indicates the caching policy for successful name lookups from the name service. The value is specified as as integer to indicate the number of seconds to cache the successful lookup. The default setting is to cache for an implementation specific period of time.&lt;br/&gt;
A value of -1 indicates &quot;cache forever&quot;.&lt;/p&gt;

&lt;p&gt;networkaddress.cache.negative.ttl (default: 10)&lt;br/&gt;
Indicates the caching policy for un-successful name lookups from the name service. The value is specified as as integer to indicate the number of seconds to cache the failure for un-successful lookups.&lt;br/&gt;
A value of 0 indicates &quot;never cache&quot;. A value of -1 indicates &quot;cache forever&quot;.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can set networkaddress.cache.ttl to be a limit time. &lt;/p&gt;</comment>
                            <comment id="14654464" author="apurtell" created="Tue, 4 Aug 2015 22:23:03 +0000"  >&lt;p&gt;Please write in to user@hbase.apache.org for help troubleshooting issues. This is the project dev tracker. Thanks!&lt;/p&gt;</comment>
                            <comment id="14654609" author="chenheng" created="Wed, 5 Aug 2015 01:02:13 +0000"  >&lt;p&gt;You means i just write email to user@hbase.apache.org and ask for help for this issue?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 4 Aug 2015 22:23:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 19 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ib7j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>