<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:05:25 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2866/HBASE-2866.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2866] Region permanently offlined </title>
                <link>https://issues.apache.org/jira/browse/HBASE-2866</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;After split, master attempts to reassign a region to a region server. Occasionally, such a region can get permanently offlined.&lt;/p&gt;


&lt;p&gt;Master:&lt;br/&gt;
---------&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-07-22 01:26:00,914 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_SPLIT_INCLUDES_DAUGHTERS: test1,6512200000,1279784117114.6466481aa931f8c1fa87622735487a72.: Daughters; test1,6512200000,1279787158624.6ead25ae677116cc88fc5420bb39d52e., test1,6531790000,1279787\
158624.8d5490bfc166c687657cb09203bd7d44. from test024.test.xyz.com,60020,1279780567744; 1 of 1                                                                                                                                                                                                     
2010-07-22 01:26:00,935 DEBUG org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper: Creating UNASSIGNED region 8d5490bfc166c687657cb09203bd7d44 in state = M2ZK_REGION_OFFLINE

2010-07-22 01:26:00,935 DEBUG org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper: Creating UNASSIGNED region 8d5490bfc166c687657cb09203bd7d44 in state = M2ZK_REGION_OFFLINE

2010-07-22 01:26:00,945 INFO org.apache.hadoop.hbase.master.RegionManager: Assigning region test1,6531790000,1279787158624.8d5490bfc166c687657cb09203bd7d44. to test024.test.xyz.com,60020,1279780567744

2010-07-22 01:26:00,949 DEBUG org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper: While updating UNASSIGNED region 8d5490bfc166c687657cb09203bd7d44 exists, state = M2ZK_REGION_OFFLINE

2010-07-22 01:26:00,954 DEBUG org.apache.hadoop.hbase.master.RegionManager: Created UNASSIGNED zNode test1,6531790000,1279787158624.8d5490bfc166c687657cb09203bd7d44. in state M2ZK_REGION_OFFLINE
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;-------------------&lt;/p&gt;

&lt;p&gt;Region Server:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-07-22 01:26:00,947 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: MSG_REGION_OPEN: test1,6531790000,1279787158624.8d5490bfc166c687657cb09203bd7d44.
2010-07-22 01:26:00,947 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: MSG_REGION_OPEN: test1,6512200000,1279787158624.6ead25ae677116cc88fc5420bb39d52e.
2010-07-22 01:26:00,947 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Worker: MSG_REGION_OPEN: test1,6531790000,1279787158624.8d5490bfc166c687657cb09203bd7d44.
2010-07-22 01:26:00,948 DEBUG org.apache.hadoop.hbase.regionserver.RSZookeeperUpdater: Updating ZNode /hbase/UNASSIGNED/8d5490bfc166c687657cb09203bd7d44 with [RS2ZK_REGION_OPENING] expected version = 0
2010-07-22 01:26:00,952 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Got ZooKeeper event, state: SyncConnected, type: NodeDataChanged, path: /hbase/UNASSIGNED/8d5490bfc166c687657cb09203bd7d44
2010-07-22 01:26:00,974 WARN org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper: &amp;lt;msgstorectrl001.test.xyz.com,msgstorectrl021.test.xyz.com,msgstorectrl041.test.xyz.com,msgstorectrl061.test.xyz.com,msgstorectrl081.ash2.facebook\
.com:/hbase,test024.test.xyz.com,60020,1279780567744&amp;gt;Failed to write data to ZooKeeper
org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /hbase/UNASSIGNED/8d5490bfc166c687657cb09203bd7d44
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:106)
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:42)
        at org.apache.zookeeper.ZooKeeper.setData(ZooKeeper.java:1038)
        at org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper.writeZNode(ZooKeeperWrapper.java:1062)
        at org.apache.hadoop.hbase.regionserver.RSZookeeperUpdater.updateZKWithEventData(RSZookeeperUpdater.java:161)
        at org.apache.hadoop.hbase.regionserver.RSZookeeperUpdater.startRegionOpenEvent(RSZookeeperUpdater.java:115)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.openRegion(HRegionServer.java:1428)
        at org.apache.hadoop.hbase.regionserver.HRegionServer$Worker.run(HRegionServer.java:1337)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
2010-07-22 01:26:00,975 ERROR org.apache.hadoop.hbase.regionserver.HRegionServer: Error opening test1,6531790000,1279787158624.8d5490bfc166c687657cb09203bd7d44.
java.io.IOException: org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /hbase/UNASSIGNED/8d5490bfc166c687657cb09203bd7d44
        at org.apache.hadoop.hbase.zookeeper.ZooKeeperWrapper.writeZNode(ZooKeeperWrapper.java:1072)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Meta:&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;Relevant section of META.&lt;/p&gt;

&lt;p&gt;Note that these are the only two entries for the problem region. The first one is the parent region (and this problem&lt;br/&gt;
region is its splitB).  For the next one, note that there is no &quot;info:server&quot; and &quot;info:serverstartcode&quot; columns.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 test1,6512200000,12797841 column=info:splitB, timestamp=1279787160693, value=\x00\x0A6551820000\x00
 17114.6466481aa931f8c1fa8 \x00\x00\x01)\xF9BL`@test1,6531790000,1279787158624.8d5490bfc166c687657cb
 7622735487a72.            09203bd7d44.\x00\x0A6531790000\x00\x00\x00\x05\x05test1\x00\x00\x00\x00\x
                           00\x02\x00\x00\x00\x07IS_ROOT\x00\x00\x00\x05false\x00\x00\x00\x07IS_META
                           \x00\x00\x00\x05false\x00\x00\x00\x01\x08\x07actions\x00\x00\x00\x08\x00\
                           x00\x00\x0BBLOOMFILTER\x00\x00\x00\x04NONE\x00\x00\x00\x11REPLICATION_SCO
                           PE\x00\x00\x00\x010\x00\x00\x00\x0BCOMPRESSION\x00\x00\x00\x04NONE\x00\x0
                           0\x00\x08VERSIONS\x00\x00\x00\x013\x00\x00\x00\x03TTL\x00\x00\x00\x0A2147
                           483647\x00\x00\x00\x09BLOCKSIZE\x00\x00\x00\x0565536\x00\x00\x00\x09IN_ME
                           MORY\x00\x00\x00\x05false\x00\x00\x00\x0ABLOCKCACHE\x00\x00\x00\x04true\x
                           FE\xA0\xFD\xC5

 ..

 test1,6531790000,12797871 column=info:regioninfo, timestamp=1279787160782, value=REGION =&amp;gt; {NAME =&amp;gt;
 58624.8d5490bfc166c687657  &apos;test1,6531790000,1279787158624.8d5490bfc166c687657cb09203bd7d44.&apos;, STAR
 cb09203bd7d44.            TKEY =&amp;gt; &apos;6531790000&apos;, ENDKEY =&amp;gt; &apos;6551820000&apos;, ENCODED =&amp;gt; 8d5490bfc166c687
                           657cb09203bd7d44, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;test1&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;acti
                           ons&apos;, BLOOMFILTER =&amp;gt; &apos;NONE&apos;, REPLICATION_SCOPE =&amp;gt; &apos;0&apos;, VERSIONS =&amp;gt; &apos;3&apos;, C
                           OMPRESSION =&amp;gt; &apos;NONE&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMOR
                           Y =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}]}}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;I think Karthik has a handle on the first part (i.e. why the RS ran into the version mismatch, and aborted opening the region). He&apos;ll add details to the JIRA. But what we aren&apos;t clear about at this stage is why the base scanner didn&apos;t kick in and try to reassign the region.&lt;/p&gt;

&lt;p&gt;BTW, HBase &quot;hbck&quot; reported this as well (which was good!):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of Tables: 5
&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of live region servers:92
&lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of dead region servers:0
.........
ERROR: Region test1,6512200000,1279784117114.6466481aa931f8c1fa87622735487a72. is not served by any region server  but is listed in META to be on server &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
ERROR: Region test1,6531790000,1279787158624.8d5490bfc166c687657cb09203bd7d44. is not served by any region server  but is listed in META to be on server &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</description>
                <environment></environment>
        <key id="12469949">HBASE-2866</key>
            <summary>Region permanently offlined </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="karthik.ranga">Karthik Ranganathan</assignee>
                                    <reporter username="kannanm">Kannan Muthukkaruppan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Jul 2010 20:20:10 +0000</created>
                <updated>Fri, 20 Nov 2015 12:42:57 +0000</updated>
                            <resolved>Fri, 23 Jul 2010 22:45:33 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12891381" author="jdcryans" created="Thu, 22 Jul 2010 22:53:05 +0000"  >&lt;p&gt;This issue looks like the one in TestAdmin that fails every now and then on Hudson like: &lt;a href=&quot;http://hudson.zones.apache.org/hudson/job/HBase-TRUNK/1397/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hudson.zones.apache.org/hudson/job/HBase-TRUNK/1397/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12891449" author="kannanm" created="Fri, 23 Jul 2010 02:05:15 +0000"  >&lt;p&gt;@Stack: Attached the master&apos;s log.&lt;/p&gt;</comment>
                            <comment id="12891483" author="stack" created="Fri, 23 Jul 2010 06:04:09 +0000"  >&lt;p&gt;@Kannan Thanks.  Looking at master and at code, my thought is that the fixup code didn&apos;t run because that region is stuck in transition.   Here is where we&apos;d skip out starting at about #562 in BaseScanner:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.getRegionManager()) {
      /* We don&apos;t assign regions that are offline, in transition or were on
       * a dead server. Regions that were on a dead server will get reassigned
       * by ProcessServerShutdown
       */
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (info.isOffline() ||
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.getRegionManager().regionIsInTransition(info.getRegionNameAsString()) ||
         &lt;span class=&quot;code-comment&quot;&gt;// St.Ack ^^^^^^^^^^ My guess is we are in here^^^^^^^^^
&lt;/span&gt;          (serverName != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.getServerManager().isDead(serverName))) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think &apos;status&apos; in shell:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):003:0&amp;gt; status &apos;detailed&apos;
version 0.89.0-SNAPSHOT
0 regionsInTransition
1 live servers
    192.168.1.157:49248 1279864501042
        requests=0, regions=3, usedHeap=32, maxHeap=994
        .META.,,1
            stores=2, storefiles=0, storefileSizeMB=0, memstoreSizeMB=0, storefileIndexSizeMB=0
        x,,1279864569260.65c4857477eb31bff0fafae4797a90d8.
            stores=1, storefiles=0, storefileSizeMB=0, memstoreSizeMB=0, storefileIndexSizeMB=0
        -ROOT-,,0
            stores=1, storefiles=1, storefileSizeMB=0, memstoreSizeMB=0, storefileIndexSizeMB=0
0 dead servers
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;@Karthik Give me a clue as to what you are thinking and I&apos;ll have a go at fixing this one if you don&apos;t have the time boss.&lt;/p&gt;</comment>
                            <comment id="12891649" author="karthik.ranga" created="Fri, 23 Jul 2010 16:04:47 +0000"  >&lt;p&gt;Hey Stack,&lt;/p&gt;

&lt;p&gt;Have a fix ready - testing now, will put it up in a bit.&lt;/p&gt;

&lt;p&gt;Fix is simple: we get into this situation because we update the same region in transition in ZK again and again, which bumps up the revision number of the ZNode. This causes the update to fail. So if the ZNode is already in the target state, do not update it again.&lt;/p&gt;

&lt;p&gt;The above explanation is super-cryptic &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;, so will sync up with you on the issue and the fix.&lt;/p&gt;</comment>
                            <comment id="12891689" author="kannanm" created="Fri, 23 Jul 2010 17:54:37 +0000"  >&lt;p&gt;Stack:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):002:0&amp;gt; status &apos;detailed&apos;
status &apos;detailed&apos;
version 0.21.0-SNAPSHOT
1 regionsInTransition
    name=test1,6531790000,1279787158624.8d5490bfc166c687657cb09203bd7d44., state=PENDING_OPEN
92 live servers
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So we find one region in PENDING_OPEN state. HBase &quot;hbck&quot; though complained about 2 regions. (So need to look into what was happening with the other region).&lt;/p&gt;

&lt;p&gt;And, surprisingly though, ZK UNASSIGNED node shows 4 entries.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):006:0&amp;gt; zk &lt;span class=&quot;code-quote&quot;&gt;&quot;ls /hbase/UNASSIGNED&quot;&lt;/span&gt;
zk &lt;span class=&quot;code-quote&quot;&gt;&quot;ls /hbase/UNASSIGNED&quot;&lt;/span&gt;
[9d675cd0b61c44c6605e752490a36eaf, 2e8c1def6dfe3ee1b8fc965629a93041, 9697bd45dc3d62d7e6b519a13d668062, 8d5490bfc166c687657cb09203bd7d44]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="12891694" author="kannanm" created="Fri, 23 Jul 2010 18:02:42 +0000"  >&lt;p&gt;Wondering how this case is handled...&lt;/p&gt;

&lt;p&gt;Master asks a RS to open a region, and I guess adds &lt;br/&gt;
it to regions in transition. If RS dies before even starting&lt;br/&gt;
to work on the region, is there some timeout mechanism&lt;br/&gt;
that kicks in and master realized it needs to give this&lt;br/&gt;
region to someone else?&lt;/p&gt;

&lt;p&gt;---------&lt;/p&gt;

&lt;p&gt;For now, what&apos;s the manual steps to be taken to get master &lt;br/&gt;
to reassign the region? Restarting the master would work&lt;br/&gt;
I suppose for now. Any other ideas?&lt;/p&gt;



</comment>
                            <comment id="12891716" author="karthik.ranga" created="Fri, 23 Jul 2010 18:33:04 +0000"  >&lt;p&gt;One thing we can try is to change the state of the region to &quot;CLOSED&quot; in UNASSIGNED in zk...&lt;/p&gt;

&lt;p&gt;Alternatively, is it possible to edit META somehow to set the region unassigned? &lt;/p&gt;</comment>
                            <comment id="12891766" author="stack" created="Fri, 23 Jul 2010 20:02:30 +0000"  >&lt;p&gt;@Kannan&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;...So need to look into what was happening with the other region...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. Would help improve hbck tool.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;...And, surprisingly though, ZK UNASSIGNED node shows 4 entries....&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Whats up w/ that?&lt;/p&gt;

&lt;p&gt;So, jgray and karthik, the current state of code in master is that its in transition still.. we have not yet hit the end point &amp;#8211; that there is still a bunch of change coming.  Right?  Can we have a fixup for this issue for now?  I&apos;d like to roll a new 0.89.x but w/ a fix for this (sounds like you have it Karthik).&lt;/p&gt;

&lt;p&gt;@Kannan Restart master is how its addressed currently.  Want to add a little tool to UI?&lt;/p&gt;

&lt;p&gt;@Karthik A region is unassigned in .META. if it does not have a server and startcode as this one does.&lt;/p&gt;</comment>
                            <comment id="12891804" author="karthik.ranga" created="Fri, 23 Jul 2010 21:21:47 +0000"  >&lt;p&gt;&lt;br/&gt;
Stack - just uploaded a review at &lt;a href=&quot;http://review.hbase.org/r/380/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12891806" author="hbasereviewboard" created="Fri, 23 Jul 2010 21:27:49 +0000"  >&lt;p&gt;Message from: &quot;Karthik Ranganathan&quot; &amp;lt;karthik.ranga@gmail.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/380/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-07-23 14:26:01.718168)&lt;/p&gt;


&lt;p&gt;Review request for hbase, stack and Kannan Muthukkaruppan.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Adding hbase group&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Region permanently offlined - if the ZNode is already in the target state, do not update it again.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2866&quot; title=&quot;Region permanently offlined &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2866&quot;&gt;&lt;del&gt;HBASE-2866&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2866&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2866&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/src/main/java/org/apache/hadoop/hbase/master/ZKUnassignedWatcher.java 967128 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java 967128 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/380/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Ran unit tests, went through fine (except TestRowAtomicity, which is known to be failing).&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Karthik&lt;/p&gt;

</comment>
                            <comment id="12891814" author="hbasereviewboard" created="Fri, 23 Jul 2010 21:53:45 +0000"  >&lt;p&gt;Message from: &quot;Kannan Muthukkaruppan&quot; &amp;lt;kannan@facebook.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/380/#review470&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/#review470&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/380/#comment1960&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/#comment1960&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    should this be:&lt;/p&gt;

&lt;p&gt;     update = true;&lt;/p&gt;




&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Kannan&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12891818" author="hbasereviewboard" created="Fri, 23 Jul 2010 22:02:18 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/380/#review471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/#review471&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Some nits, I&apos;m also trying it out (with the update=true fix)&lt;/p&gt;


&lt;p&gt;trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/380/#comment1962&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/#comment1962&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Remove all the trailing white spaces&lt;/p&gt;



&lt;p&gt;trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/380/#comment1963&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/#comment1963&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Reuse curState and newState instead&lt;/p&gt;



&lt;p&gt;trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/380/#comment1961&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/#comment1961&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Simply return when you figure that you should, then you can get rid of &quot;update&quot;&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jean-Daniel&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12891822" author="hbasereviewboard" created="Fri, 23 Jul 2010 22:06:04 +0000"  >&lt;p&gt;Message from: &quot;Karthik Ranganathan&quot; &amp;lt;karthik.ranga@gmail.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/380/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-07-23 14:53:37.123965)&lt;/p&gt;


&lt;p&gt;Review request for hbase, stack and Kannan Muthukkaruppan.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Good catch Kannan... updated the diff with comments this time.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Region permanently offlined - if the ZNode is already in the target state, do not update it again.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2866&quot; title=&quot;Region permanently offlined &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2866&quot;&gt;&lt;del&gt;HBASE-2866&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2866&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2866&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/src/main/java/org/apache/hadoop/hbase/master/ZKUnassignedWatcher.java 967128 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java 967128 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/380/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Ran unit tests, went through fine (except TestRowAtomicity, which is known to be failing).&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Karthik&lt;/p&gt;

</comment>
                            <comment id="12891825" author="hbasereviewboard" created="Fri, 23 Jul 2010 22:13:30 +0000"  >&lt;p&gt;Message from: &quot;Karthik Ranganathan&quot; &amp;lt;karthik.ranga@gmail.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/380/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-07-23 15:08:16.286786)&lt;/p&gt;


&lt;p&gt;Review request for hbase, stack and Kannan Muthukkaruppan.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Addressed some comments (re-use variables, removed white spaces)&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Region permanently offlined - if the ZNode is already in the target state, do not update it again.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2866&quot; title=&quot;Region permanently offlined &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2866&quot;&gt;&lt;del&gt;HBASE-2866&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2866&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2866&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/src/main/java/org/apache/hadoop/hbase/master/ZKUnassignedWatcher.java 967128 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java 967128 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/380/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Ran unit tests, went through fine (except TestRowAtomicity, which is known to be failing).&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Karthik&lt;/p&gt;

</comment>
                            <comment id="12891831" author="hbasereviewboard" created="Fri, 23 Jul 2010 22:35:40 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/380/#review474&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/#review474&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;Just one comment&lt;/p&gt;


&lt;p&gt;trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/380/#comment1965&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/#comment1965&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    What is the watcher being triggered if data is not changing?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12891832" author="hbasereviewboard" created="Fri, 23 Jul 2010 22:39:50 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/380/#review473&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/380/#review473&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;+1 LGTM and TestAdmin passes on my machine without flinching&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jean-Daniel&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12891835" author="jdcryans" created="Fri, 23 Jul 2010 22:45:33 +0000"  >&lt;p&gt;Committed to trunk, thanks Karthik!&lt;/p&gt;</comment>
                            <comment id="15017393" author="lars_francke" created="Fri, 20 Nov 2015 12:42:57 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12450252" name="master.log" size="6850090" author="kannanm" created="Fri, 23 Jul 2010 02:05:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 Jul 2010 22:53:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26506</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hjlj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100437</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>