<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:17:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4288/HBASE-4288.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4288] &quot;Server not running&quot; exception during meta verification causes RS abort</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4288</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The master tried to verify the META location just as that server was shutting down due to an abort. This caused the &quot;Server not running&quot; exception to get thrown, which wasn&apos;t handled properly in the master, causing it to abort.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12520658">HBASE-4288</key>
            <summary>&quot;Server not running&quot; exception during meta verification causes RS abort</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Aug 2011 23:40:43 +0000</created>
                <updated>Thu, 12 Jul 2012 00:04:20 +0000</updated>
                                            <version>0.90.4</version>
                                    <fixVersion>0.90.7</fixVersion>
                    <fixVersion>0.92.0</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13093312" author="tlipcon" created="Mon, 29 Aug 2011 23:40:58 +0000"  >&lt;p&gt;2011-08-29 16:37:50,485 FATAL org.apache.hadoop.hbase.master.HMaster: Unhandled exception. Starting shutdown.&lt;br/&gt;
org.apache.hadoop.ipc.RemoteException: java.io.IOException: Server not running, aborting&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.checkOpen(HRegionServer.java:2407)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegionInfo(HRegionServer.java:1648)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor13.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:570)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1039)&lt;/p&gt;

&lt;p&gt;        at org.apache.hadoop.hbase.ipc.HBaseClient.call(HBaseClient.java:771)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Invoker.invoke(HBaseRPC.java:258)&lt;br/&gt;
        at $Proxy7.getRegionInfo(Unknown Source)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.CatalogTracker.verifyRegionLocation(CatalogTracker.java:426)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.CatalogTracker.getMetaServerConnection(CatalogTracker.java:273)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.CatalogTracker.waitForMeta(CatalogTracker.java:333)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.CatalogTracker.waitForMetaServerConnectionDefault(CatalogTracker.java:366)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.MetaReader.getRegion(MetaReader.java:355)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.AssignmentManager.processRegionInTransition(AssignmentManager.java:312)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.AssignmentManager.processRegionsInTransition(AssignmentManager.java:263)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.AssignmentManager.processFailover(AssignmentManager.java:227)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.HMaster.finishInitialization(HMaster.java:421)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:294)&lt;/p&gt;</comment>
                            <comment id="13093343" author="tlipcon" created="Tue, 30 Aug 2011 00:50:56 +0000"  >&lt;p&gt;This is a little tricky. I don&apos;t think we can just catch this and return false, since there&apos;s no verification that the server is dead &lt;em&gt;yet&lt;/em&gt;, just that it&apos;s shutting down. If we were to return false, then the users of this code would delete the root location from ZK and start re-assigning even though the old server may have unflushed edits, etc.&lt;/p&gt;

&lt;p&gt;Though, this makes me think: why is it &lt;em&gt;ever&lt;/em&gt; safe to delete the root location and reassign it before the old location&apos;s logs have split?&lt;/p&gt;</comment>
                            <comment id="13144831" author="stack" created="Sat, 5 Nov 2011 21:07:22 +0000"  >&lt;p&gt;I think this scenario unlikely now we have retries in place.  Writing a unit test to prove it (Its not done yet).&lt;/p&gt;</comment>
                            <comment id="13147477" author="stack" created="Thu, 10 Nov 2011 04:04:28 +0000"  >&lt;p&gt;Test to prove that this no longer an issue.  I think we should commit this test because it does some test refactoring and fixes some tests NPEs.&lt;/p&gt;

&lt;p&gt;First, here is description of the patch:&lt;/p&gt;


&lt;p&gt;M src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java                       &lt;br/&gt;
  Fix javadoc warnings.  Change some logging that could be profuse                        &lt;br/&gt;
  from DEBUG to TRACE level (now it works).                                               &lt;br/&gt;
  (setMetaLocation) Changed from private to package protected so could                    &lt;br/&gt;
  use in tests.                                                                           &lt;/p&gt;

&lt;p&gt;M src/test/java/org/apache/hadoop/hbase/catalog/TestCatalogTracker.java                   &lt;br/&gt;
  (constructAndStartCatalogTracker): Removed.  Has null Connection so NPEs.               &lt;br/&gt;
  (testInterruptWaitOnMetaAndRoot): Now we use HTables instead                            &lt;br/&gt;
  of server interfaces, we need to do a bit more work getting the right                   &lt;br/&gt;
  HConnection into place.  Use new mockConnection method.  Make sure we                   &lt;br/&gt;
  cleanup the connection when we are done.                                                &lt;br/&gt;
  (testServerNotRunningIOException): Added test to prove hbase-4288                       &lt;br/&gt;
  is fixed.  This is the important addition here.                                         &lt;br/&gt;
  (testGetMetaServerConnectionFails): Refactored to use new mockConnection                &lt;br/&gt;
  utility methods.                                                                        &lt;br/&gt;
  (mockConnection): utility mocking up a connection.                                      &lt;br/&gt;
  (getMetaTableRowResult): New utility method that fakes a Result.   &lt;/p&gt;</comment>
                            <comment id="13147481" author="stack" created="Thu, 10 Nov 2011 04:08:21 +0000"  >&lt;p&gt;Oops... let me reattach the change description:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
M src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java                       
  Fix javadoc warnings.  Change some logging that could be profuse                        
  from DEBUG to TRACE level (now it works).                                               
  (setMetaLocation) Changed from &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; so could                    
  use in tests.                                                                           
                                                                                          
M src/test/java/org/apache/hadoop/hbase/catalog/TestCatalogTracker.java                   
  (constructAndStartCatalogTracker): Removed.  Has &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; Connection so NPEs.               
  (testInterruptWaitOnMetaAndRoot): Now we use HTables instead                            
  of server interfaces, we need to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; a bit more work getting the right                   
  HConnection into place.  Use &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; mockConnection method.  Make sure we                   
  cleanup the connection when we are done.                                                
  (testServerNotRunningIOException): Added test to prove hbase-4288                       
  is fixed.  This is the important addition here.                                         
  (testGetMetaServerConnectionFails): Refactored to use &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; mockConnection                
  utility methods.                                                                        
  (mockConnection): utility mocking up a connection.                                      
  (getMetaTableRowResult): New utility method that fakes a Result.      
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Here is the proof.  Here&apos;s logs from the test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2011-11-09 19:50:29,433 INFO  [main] catalog.CatalogTracker(597): Failed verification of .META.,,1 at address=example.org,1234,1320897021185; java.io.IOException: Server not running, aborting
2011-11-09 19:50:29,433 DEBUG [main] catalog.CatalogTracker(492): Current cached META location, example.org,1234,1320897021185, is not valid, resetting
2011-11-09 19:50:29,438 DEBUG [main] catalog.CatalogTracker(504): Set &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; cached META location: example.org,1234,1320897021185
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;See how now when we get an IOE &apos;Server not running&apos;, it doesn&apos;t kill us &amp;#8211; instead, we have the .META. location as bad and we clear the bad value (In the third log line, we found a good value and set the new meta location).&lt;/p&gt;</comment>
                            <comment id="13147508" author="hadoopqa" created="Thu, 10 Nov 2011 05:53:25 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12503165/4288-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12503165/4288-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -164 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 52 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestLogRolling&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/221//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/221//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/221//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/221//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/221//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/221//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13148126" author="stack" created="Thu, 10 Nov 2011 23:56:48 +0000"  >&lt;p&gt;Seems odd that adding a test to TestCatalogTracker would call TestLogRolling fail.  I tried it local w/ patch applied and TLR passes.  Going to commit this test (We can open new issue if you find hole in my reasoning above post-commit)&lt;/p&gt;</comment>
                            <comment id="13148138" author="stack" created="Fri, 11 Nov 2011 00:12:09 +0000"  >&lt;p&gt;Committed the verification test to trunk and 0.92 branch.&lt;/p&gt;</comment>
                            <comment id="13148139" author="stack" created="Fri, 11 Nov 2011 00:12:33 +0000"  >&lt;p&gt;Hmm... yeah, still issue in 0.90 branch so leaving open.&lt;/p&gt;</comment>
                            <comment id="13148229" author="hudson" created="Fri, 11 Nov 2011 02:56:27 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2427 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2427/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2427/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4288&quot; title=&quot;&amp;quot;Server not running&amp;quot; exception during meta verification causes RS abort&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4288&quot;&gt;HBASE-4288&lt;/a&gt; &quot;Server not running&quot; exception during meta verification causes RS abort&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/catalog/TestCatalogTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13148298" author="hudson" created="Fri, 11 Nov 2011 06:31:38 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #123 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/123/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/123/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4288&quot; title=&quot;&amp;quot;Server not running&amp;quot; exception during meta verification causes RS abort&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4288&quot;&gt;HBASE-4288&lt;/a&gt; &quot;Server not running&quot; exception during meta verification causes RS abort&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/catalog/TestCatalogTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13193632" author="ram_krish" created="Thu, 26 Jan 2012 07:44:52 +0000"  >&lt;p&gt;Moving into 0.90.7&lt;/p&gt;</comment>
                            <comment id="13193638" author="ram_krish" created="Thu, 26 Jan 2012 07:48:35 +0000"  >&lt;p&gt;Already committed to 0.92 and trunk  But not into 0.90.  Hence not resolving just updating fix version.&lt;/p&gt;</comment>
                            <comment id="13412382" author="jmhsieh" created="Thu, 12 Jul 2012 00:04:20 +0000"  >&lt;p&gt;First glance seems related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5883&quot; title=&quot;Backup master is going down due to connection refused exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5883&quot;&gt;&lt;del&gt;HBASE-5883&lt;/del&gt;&lt;/a&gt; &amp;#8211; may have been resolved by that.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12552830">HBASE-5883</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12503165" name="4288-v2.txt" size="14835" author="stack" created="Thu, 10 Nov 2011 04:04:28 +0000"/>
                            <attachment id="12502620" name="4288.txt" size="2565" author="stack" created="Sat, 5 Nov 2011 21:07:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 5 Nov 2011 21:07:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27244</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 23 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02bvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11527</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>