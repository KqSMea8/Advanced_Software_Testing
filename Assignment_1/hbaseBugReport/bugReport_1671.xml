<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:55:24 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1671/HBASE-1671.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1671] HBASE-1609 broke scanners riding across splits</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1671</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;On split, we close region and close out scanner leases.  Scanners coming in get USEs instead of NSREs.  Fix.  Broke by hbase-1609.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12430836">HBASE-1671</key>
            <summary>HBASE-1609 broke scanners riding across splits</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Sat, 18 Jul 2009 01:27:20 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:51 +0000</updated>
                            <resolved>Tue, 28 Jul 2009 18:35:46 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12732981" author="stack" created="Sun, 19 Jul 2009 07:45:01 +0000"  >&lt;p&gt;Hmm.... looking, this ain&apos;t as bad as I thought but behavior is a little indeterminate; i don&apos;t see a check to see if region is closing or closed.&lt;/p&gt;</comment>
                            <comment id="12735869" author="stack" created="Tue, 28 Jul 2009 00:53:38 +0000"  >&lt;p&gt;Dirty patch, has loads of debugging.&lt;/p&gt;

&lt;p&gt;So, adds test of scanners riding over splits and adds at least one necessary fix but not done yet.&lt;/p&gt;

&lt;p&gt;If scanner outstanding while split we get a NSRE; we never recover.  Trying to fix that now.&lt;/p&gt;</comment>
                            <comment id="12736070" author="stack" created="Tue, 28 Jul 2009 13:53:23 +0000"  >&lt;p&gt;Still not done.&lt;/p&gt;</comment>
                            <comment id="12736164" author="stack" created="Tue, 28 Jul 2009 17:32:52 +0000"  >&lt;p&gt;Posting patch for J-D review.&lt;/p&gt;

&lt;p&gt;Here&apos;s the story.&lt;/p&gt;

&lt;p&gt;Previous, splitting, we would not close the region until all outstanding scanners were done.&lt;/p&gt;

&lt;p&gt;Philosophy is not to wait any more. &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1609&quot; title=&quot;[part of hbase-1583] We wait on leases to expire before regionserver goes down.  Rather, just let client fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1609&quot;&gt;&lt;del&gt;HBASE-1609&lt;/del&gt;&lt;/a&gt; did some of that work undoing waits on scanner leases.&lt;/p&gt;

&lt;p&gt;Remaining was how to deal with case where region split undering an outstanding scanner.  As per above, we punted dealing with this in past.&lt;/p&gt;

&lt;p&gt;This patch moves handling the scanner across region splits to the client.&lt;/p&gt;

&lt;p&gt;First, server-side, if a next is called on a region the regionserver has since closed, we now return a NSRE (and close out the scanner that was).&lt;/p&gt;

&lt;p&gt;Client-side, its kinda ugly because ScannerCallable is in the way.  On one hand we want the retrying but only sometimes.  We don&apos;t want to retry an NSRE on a next.  A NSRE inside in a scanner next will never recover.  Whats wanted is a scanner reset where scanner goes and figures new location of region.  Location figuring only happens inside in scanner open so we need to reopen scanner.&lt;/p&gt;

&lt;p&gt;We can&apos;t reset down in ScannerCallable.  Reset has to happen higher up where there is more context inside in the ClientScanner#next.&lt;/p&gt;

&lt;p&gt;So we have ugly mechanism for sending a signal from ScannerCallable up to ClientScanner#next using a DoRetryException caused by a NSRE.&lt;/p&gt;

&lt;p&gt;Once the scanner has been reset, we need to discard first row since we&apos;ve already returned this.&lt;/p&gt;


</comment>
                            <comment id="12736177" author="jdcryans" created="Tue, 28 Jul 2009 17:50:34 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;I did not test it but from what I see it does the right thing, also it adds a test case. Waiting for a scanner to finish before splitting is dangerous IMO, imagine a job that writes inside a table it scans... could take a long time before it finishes and we could get very big regions! So now with the client handling that we should have a better story.&lt;/p&gt;

&lt;p&gt;Some nitpicks, some classes have unused imports after this patch like HCM and I also wonder why you use org.mortbay.log.Log inside ScannerCallable as we never used that class anywhere else.&lt;/p&gt;</comment>
                            <comment id="12736178" author="stack" created="Tue, 28 Jul 2009 17:52:26 +0000"  >&lt;p&gt;Latter was mistake on my part.  Will fix up imports before committing.  Thanks for review J-D.&lt;/p&gt;</comment>
                            <comment id="12736207" author="stack" created="Tue, 28 Jul 2009 18:35:46 +0000"  >&lt;p&gt;Thanks for review J-D.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12414742" name="1671-v2.patch" size="19099" author="stack" created="Tue, 28 Jul 2009 13:53:23 +0000"/>
                            <attachment id="12414769" name="1671-v3.patch" size="20030" author="stack" created="Tue, 28 Jul 2009 17:32:52 +0000"/>
                            <attachment id="12414689" name="1671.patch" size="14537" author="stack" created="Tue, 28 Jul 2009 00:53:38 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 28 Jul 2009 17:50:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25904</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 21 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0helz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99629</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>