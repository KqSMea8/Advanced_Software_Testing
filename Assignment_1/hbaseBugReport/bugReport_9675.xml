<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:06:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9675/HBASE-9675.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9675] Root-cause analysis is difficult with AsyncProcess</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9675</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The AsyncProcess swallows up informative exceptions returned from the RS. For instance, diagnosing the cause of a failed mapreduce task is pretty opaque right now. The client log tells me that my async requests have been retried and rejected, but not why:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-09-27 22:47:03,391 INFO [main] org.apache.hadoop.hbase.client.AsyncProcess: : Waiting for the global number of running tasks to be equals or less than 0, tasksSent=6184, tasksDone=6180, currentTasksDone=6180, tableName=IntegrationTestLoadAndVerify
// repeat about 30 times
2013-09-27 22:53:13,886 INFO [main] org.apache.hadoop.hbase.client.AsyncProcess: : Waiting for the global number of running tasks to be equals or less than 0, tasksSent=12140, tasksDone=12135, currentTasksDone=12135, tableName=IntegrationTestLoadAndVerify
2013-09-27 22:53:13,890 WARN [htable-pool1-t51] org.apache.hadoop.hbase.client.AsyncProcess: Attempt #35/35 failed for 4 ops on hor17n37.gq1.ygridcore.net,60020,1380321099619 NOT resubmitting.region=IntegrationTestLoadAndVerify,+\xC6\x02\x00\x00\x00\x00\x00/000009_0,1380321873859.871b9482f305686a5848615f26a8a7f9., hostname=hor17n37.gq1.ygridcore.net,60020,1380321099619, seqNum=4990837
2013-09-27 22:53:14,030 WARN [htable-pool1-t51] org.apache.hadoop.hbase.client.AsyncProcess: Attempt #35/35 failed for 8 ops on hor17n37.gq1.ygridcore.net,60020,1380321099619 NOT resubmitting.region=IntegrationTestLoadAndVerify,+\xC6\x02\x00\x00\x00\x00\x00/000009_0,1380321873859.871b9482f305686a5848615f26a8a7f9., hostname=hor17n37.gq1.ygridcore.net,60020,1380321099619, seqNum=4990837
2013-09-27 22:53:14,179 WARN [htable-pool1-t51] org.apache.hadoop.hbase.client.AsyncProcess: Attempt #35/35 failed for 8 ops on hor17n37.gq1.ygridcore.net,60020,1380321099619 NOT resubmitting.region=IntegrationTestLoadAndVerify,+\xC6\x02\x00\x00\x00\x00\x00/000009_0,1380321873859.871b9482f305686a5848615f26a8a7f9., hostname=hor17n37.gq1.ygridcore.net,60020,1380321099619, seqNum=4990837
2013-09-27 22:53:14,251 WARN [htable-pool1-t51] org.apache.hadoop.hbase.client.AsyncProcess: Attempt #35/35 failed for 8 ops on hor17n37.gq1.ygridcore.net,60020,1380321099619 NOT resubmitting.region=IntegrationTestLoadAndVerify,+\xC6\x02\x00\x00\x00\x00\x00/000009_0,1380321873859.871b9482f305686a5848615f26a8a7f9., hostname=hor17n37.gq1.ygridcore.net,60020,1380321099619, seqNum=4990837
2013-09-27 22:53:14,277 WARN [htable-pool1-t51] org.apache.hadoop.hbase.client.AsyncProcess: Attempt #35/35 failed for 8 ops on hor17n37.gq1.ygridcore.net,60020,1380321099619 NOT resubmitting.region=IntegrationTestLoadAndVerify,+\xC6\x02\x00\x00\x00\x00\x00/000009_0,1380321873859.871b9482f305686a5848615f26a8a7f9., hostname=hor17n37.gq1.ygridcore.net,60020,1380321099619, seqNum=4990837
2013-09-27 22:53:26,862 INFO [main] org.apache.hadoop.hbase.client.AsyncProcess: : Waiting for the global number of running tasks to be equals or less than 0, tasksSent=12186, tasksDone=12185, currentTasksDone=12185, tableName=IntegrationTestLoadAndVerify
2013-09-27 22:53:26,915 INFO [main] org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation: Closing zookeeper sessionid=0x14160ad6eb404c3
2013-09-27 22:53:26,920 INFO [main] org.apache.zookeeper.ZooKeeper: Session: 0x14160ad6eb404c3 closed
2013-09-27 22:53:26,920 INFO [main-EventThread] org.apache.zookeeper.ClientCnxn: EventThread shut down
2013-09-27 22:53:26,936 ERROR [main] org.apache.hadoop.security.UserGroupInformation: PriviledgedActionException as:hrt_qa (auth:SIMPLE) cause:org.apache.hadoop.hbase.client.RetriesExhaustedWithDetailsException: Failed 36 actions: ConnectException: 4 times, FailedServerException: 32 times, 
2013-09-27 22:53:26,937 WARN [main] org.apache.hadoop.mapred.YarnChild: Exception running child : org.apache.hadoop.hbase.client.RetriesExhaustedWithDetailsException: Failed 36 actions: ConnectException: 4 times, FailedServerException: 32 times, 
	at org.apache.hadoop.hbase.client.AsyncProcess$BatchErrors.makeException(AsyncProcess.java:163)
	at org.apache.hadoop.hbase.client.AsyncProcess$BatchErrors.access$500(AsyncProcess.java:147)
	at org.apache.hadoop.hbase.client.AsyncProcess.getErrors(AsyncProcess.java:711)
	at org.apache.hadoop.hbase.client.HTable.backgroundFlushCommits(HTable.java:939)
	at org.apache.hadoop.hbase.client.HTable.flushCommits(HTable.java:1315)
	at org.apache.hadoop.hbase.test.IntegrationTestLoadAndVerify$LoadMapper.map(IntegrationTestLoadAndVerify.java:237)
	at org.apache.hadoop.hbase.test.IntegrationTestLoadAndVerify$LoadMapper.map(IntegrationTestLoadAndVerify.java:159)
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:763)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:339)
	at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:162)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:415)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1483)
	at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:157)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Likewise, there&apos;s nothing &quot;broken&quot; in the RS logs. It&apos;s sending back RegionTooBusyExceptions but neither RS nor client inform the user of this.&lt;/p&gt;

&lt;p&gt;We need to add logging somewhere, probably on the client side, but maybe both, to tell our owner-operator what&apos;s going on. The client log doesn&apos;t say much and all you have in the RS log is a whole bunch of flush and compaction activity. In this case, it would have been nice to see something like &quot;RegionTooBusyException: above the memstore limit&quot;. Even better, include a recommendation to get around the problem, such as &quot;slow down, tiger, that&apos;s quite the write throughput&quot; or &quot;maybe you want to increase memstore size a bit&quot;. Or maybe the right approach is to advise tweaks to the client settings (retries, sleep periods, buffer size, &amp;amp;c.)?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12671052">HBASE-9675</key>
            <summary>Root-cause analysis is difficult with AsyncProcess</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ndimiduk">Nick Dimiduk</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Sep 2013 23:59:21 +0000</created>
                <updated>Tue, 22 Oct 2013 20:30:13 +0000</updated>
                                            <version>0.95.2</version>
                                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13780587" author="ndimiduk" created="Sat, 28 Sep 2013 00:00:03 +0000"  >&lt;p&gt;Bumping to critical because the user is flying blind currently. Feel free to adjust if you disagree.&lt;/p&gt;</comment>
                            <comment id="13781973" author="nkeywal" created="Mon, 30 Sep 2013 16:13:57 +0000"  >&lt;p&gt;The info is supposed to be there:&lt;br/&gt;
2013-09-27 22:53:26,936 ERROR &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; org.apache.hadoop.security.UserGroupInformation: PriviledgedActionException as:hrt_qa (auth:SIMPLE) cause:org.apache.hadoop.hbase.client.RetriesExhaustedWithDetailsException: Failed 36 actions: ConnectException: 4 times, FailedServerException: 32 times, &lt;/p&gt;

&lt;p&gt;What&apos;s strange here is that:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the FailedServerException means that the server is known as dead: so the client doesn&apos;t try to connect.&lt;/li&gt;
	&lt;li&gt;ConnectException is widely used, but usually it means that we tried to connect but the server timeouted or refused the connection.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;So it&apos;s not at all related to &apos;RegionTooBusyException&apos;. The error says the server is dead.&lt;/p&gt;

&lt;p&gt;One of the issues with RetriesExhaustedWithDetailsException is that it gives only the status of the last error; i.e; if we retry 10 actions 31 times, the message is about the 10 final errors, that can be different from the 31 * 10 errors you had on the &quot;path to failure&quot; (for example, you can image to have something like RegionMoved --&amp;gt; RegionNotOpenYet --&amp;gt; RegionTooBusy --&amp;gt; ConnectException --&amp;gt; FailedServerException. This history is not shown. &lt;/p&gt;

&lt;p&gt;We could try to do all the history, and then group by common history, but in most cases it could mean printing one line per action, as on 31 retries it&apos;s very likely that they will differ. But I can give it a try if you&apos;re ok with the approach.&lt;/p&gt;</comment>
                            <comment id="13782016" author="ndimiduk" created="Mon, 30 Sep 2013 17:05:06 +0000"  >&lt;p&gt;Including the individual failures as they happened at the DEBUG level seems reasonable and useful. Please give it a shot, if you&apos;re up for it!&lt;/p&gt;</comment>
                            <comment id="13782036" author="stack" created="Mon, 30 Sep 2013 17:39:06 +0000"  >&lt;p&gt;IIRC, we cut down how many exceptions the RetriesExhaustedWithDetailsException returned because it could be a large amount of data if many retries; this costs not only in how much we need keep around but also when comes time to dump it out, it could be volumes &amp;#8211; so much the actual fail reason is obscured (who wants to look at 32 stack traces in a a log especially when they are all the &apos;same&apos; usually).  Would suggest keeping a synopsis only of the exceptions rather than full stack trace&lt;/p&gt;</comment>
                            <comment id="13797274" author="nkeywal" created="Wed, 16 Oct 2013 21:26:27 +0000"  >&lt;p&gt;Hum.&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We&apos;ve got a regression there: we don&apos;t print the servers as we used to do (we build the string but we do not return it).&lt;/li&gt;
	&lt;li&gt;We&apos;ve got some stuff enabled only in trace mode. I think it&apos;s not very useful: when you want it you don&apos;t have the trace enabled.&lt;/li&gt;
	&lt;li&gt;something we could do is:&lt;/li&gt;
	&lt;li&gt;start to store the exceptions after a given number, something like 15 failures.&lt;/li&gt;
	&lt;li&gt;then if it fails, we will return the full path for one row that failed until the end. Something like &lt;a href=&quot;#16, hbaseserver14:60030,7648764: NotServingRegion; #17 ....&quot;&gt;#15, hbaseserver13:60030,47894798: RegionMoved to hbaseserver14; #16, hbaseserver14:60030,7648764: NotServingRegion; #17 ....&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;What do you think?&lt;/p&gt;</comment>
                            <comment id="13802227" author="ndimiduk" created="Tue, 22 Oct 2013 20:30:13 +0000"  >&lt;p&gt;Hehe, debug is the new trace? I like adding a breadcrumb to the error messages; row, destination, reason as you have is helpful. As for the number of failures, 15 seems like an arbitrary number. Is that any 15 failures, only failures of a certain class of exception?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 30 Sep 2013 16:13:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>350881</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 8 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ohyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>351172</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>