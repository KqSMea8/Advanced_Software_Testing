<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:57:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1949/HBASE-1949.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1949] KeyValue expiration by Time-to-Live during major compaction is broken</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1949</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;During a major compaction on a region in a column family with a configured TTL, it looks like all KeyValues in a row after the first expired KeyValue are skipping and thrown out of the newly written file (regardless of whether the would have been expired or not).&lt;/p&gt;

&lt;p&gt;The StoreScanner is skipping to the next row, even when other columns with a non-expirable timestamp exists.  Unless I&apos;m misunderstanding it, it seems like it should just seek to the next column instead.  I discovered this when altering a table to lower the TTL for a column family and force the expiration of some data which led to the entire row being expired in some instances.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12439577">HBASE-1949</key>
            <summary>KeyValue expiration by Time-to-Live during major compaction is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ghelmling">Gary Helmling</assignee>
                                    <reporter username="ghelmling">Gary Helmling</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Oct 2009 22:17:41 +0000</created>
                <updated>Fri, 12 Oct 2012 06:13:24 +0000</updated>
                            <resolved>Thu, 5 Nov 2009 21:52:39 +0000</resolved>
                                    <version>0.20.1</version>
                                    <fixVersion>0.20.2</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12772124" author="ghelmling" created="Fri, 30 Oct 2009 22:19:30 +0000"  >&lt;p&gt;The attached patch (against the 0.20 branch) changes the ScanQueryMatcher.match() return value in this case to just seek to the next column and adds a test for this case.&lt;/p&gt;</comment>
                            <comment id="12772715" author="ghelmling" created="Mon, 2 Nov 2009 22:03:47 +0000"  >&lt;p&gt;Same patch for ScanQueryMatcher.match() return value and extra unit test, applied against current trunk.&lt;/p&gt;</comment>
                            <comment id="12773512" author="ghelmling" created="Wed, 4 Nov 2009 15:12:02 +0000"  >&lt;p&gt;This patch is the same as previous ttl_expire-0.20.patch, just updated to current hbase-0.20 branch and renamed for consistency.  I&apos;ll remove the other to avoid confusion.&lt;/p&gt;</comment>
                            <comment id="12773516" author="ghelmling" created="Wed, 4 Nov 2009 15:16:02 +0000"  >&lt;p&gt;Okay, one more time, actually including the issue number in the filename.  JIRA really needs a &quot;rename file&quot; feature.&lt;/p&gt;</comment>
                            <comment id="12773974" author="ghelmling" created="Thu, 5 Nov 2009 17:01:35 +0000"  >&lt;p&gt;The previous version of this patch missed an additional case in QueryMatcher.match() &amp;#8211; called from ScanFileGetScan &amp;#8211; which would exit early on a row for get requests when the first expired KeyValue was encountered.  This would not actually remove data (like the previous occurance) but would mask existing data from this client.&lt;/p&gt;

&lt;p&gt;This version adds a change for the QueryMatcher.match() instance to return MatchCode.SKIP instead of MatchCode.NEXT in order to keep processing any following kvs.&lt;/p&gt;</comment>
                            <comment id="12773975" author="ghelmling" created="Thu, 5 Nov 2009 17:02:40 +0000"  >&lt;p&gt;This is an updated version of the patch against trunk, which adds the fix for QueryMatcher.match() and a couple extra tests in TestQueryMatcher to confirm the fix.&lt;/p&gt;</comment>
                            <comment id="12774019" author="ghelmling" created="Thu, 5 Nov 2009 18:28:31 +0000"  >&lt;p&gt;I&apos;ve been running the &quot;v2&quot; patch (applied against the 0.20.1 release) in my development setup for a couple days with correct expiration behavior.  I should have the patched version deployed and tested against my live data early next week, at which point I should be able to completely verify the fix.&lt;/p&gt;

&lt;p&gt;This could definitely use a good review by someone more familiar with the compaction process.  The actual code changes are very minor and the new and existing tests all pass.  But the changes eliminate early exits from the KeyValue iteration on rows in two places, so it would be good to assess any performance impact from the change.&lt;/p&gt;</comment>
                            <comment id="12774034" author="streamy" created="Thu, 5 Nov 2009 19:08:05 +0000"  >&lt;p&gt;Reviewed patch.  Looks great.  Thanks Gary.&lt;/p&gt;

&lt;p&gt;+1 for commit&lt;/p&gt;</comment>
                            <comment id="12774096" author="stack" created="Thu, 5 Nov 2009 21:52:39 +0000"  >&lt;p&gt;Thanks for the patch Gary.  Applied branch and trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12424030" name="HBASE-1949-0.20.patch" size="3012" author="ghelmling" created="Wed, 4 Nov 2009 15:16:02 +0000"/>
                            <attachment id="12423856" name="HBASE-1949-trunk.patch" size="3132" author="ghelmling" created="Mon, 2 Nov 2009 22:03:47 +0000"/>
                            <attachment id="12424133" name="HBASE-1949-v2-0.20.patch" size="7678" author="ghelmling" created="Thu, 5 Nov 2009 17:01:35 +0000"/>
                            <attachment id="12424134" name="HBASE-1949-v2-trunk.patch" size="7887" author="ghelmling" created="Thu, 5 Nov 2009 17:02:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Nov 2009 19:08:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26076</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 7 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08s27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49146</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fixed expiring of individual column values within rows via the column family time-to-live configuration.  Previously all column values following the first expired value in a row would be truncated.  Though in practice this might only be seen when lowering the TTL configuration on a column family with existing data.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>