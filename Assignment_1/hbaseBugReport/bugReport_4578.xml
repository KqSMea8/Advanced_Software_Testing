<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:20:10 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4578/HBASE-4578.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4578] NPE when altering a table that has moving regions</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4578</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I&apos;m still not a 100% sure on the source of this error, but here&apos;s what I was able to get twice while altering a table that was doing a bunch of splits:&lt;/p&gt;

&lt;blockquote&gt;

&lt;p&gt;2011-10-11 23:48:59,344 INFO org.apache.hadoop.hbase.master.handler.SplitRegionHandler: Handled SPLIT report); parent=TestTable,0002608338,1318376880454.a75d6815fdfc513fb1c8aabe086c6763. daughter a=TestTable,0002608338,1318376938764.ef170ff6cd8695dc8aec92e542dc9ac1.daughter b=TestTable,0003301408,1318376938764.36eb2530341bd46888ede312c5559b5d.&lt;br/&gt;
2011-10-11 23:49:09,579 DEBUG org.apache.hadoop.hbase.master.handler.TableEventHandler: Ignoring table not disabled exception for supporting online schema changes.&lt;br/&gt;
2011-10-11 23:49:09,580 INFO org.apache.hadoop.hbase.master.handler.TableEventHandler: Handling table operation C_M_MODIFY_TABLE on table TestTable&lt;br/&gt;
2011-10-11 23:49:09,612 INFO org.apache.hadoop.hbase.util.FSUtils: TableInfoPath = hdfs://sv4r11s38:9100/hbase/TestTable/.tableinfo tmpPath = hdfs://sv4r11s38:9100/hbase/TestTable/.tmp/.tableinfo.1318376949612&lt;br/&gt;
2011-10-11 23:49:09,692 INFO org.apache.hadoop.hbase.util.FSUtils: TableDescriptor stored. TableInfoPath = hdfs://sv4r11s38:9100/hbase/TestTable/.tableinfo&lt;br/&gt;
2011-10-11 23:49:09,693 INFO org.apache.hadoop.hbase.util.FSUtils: Updated tableinfo=hdfs://sv4r11s38:9100/hbase/TestTable/.tableinfo to blah&lt;br/&gt;
2011-10-11 23:49:09,695 INFO org.apache.hadoop.hbase.master.handler.TableEventHandler: Bucketing regions by region server...&lt;br/&gt;
2011-10-11 23:49:09,695 DEBUG org.apache.hadoop.hbase.client.MetaScanner: Scanning .META. starting at row=TestTable,,00000000000000 for max=2147483647 rows&lt;br/&gt;
2011-10-11 23:49:09,709 DEBUG org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation: The connection to hconnection-0x132f043bbde02e9 has been closed.&lt;br/&gt;
2011-10-11 23:49:09,709 ERROR org.apache.hadoop.hbase.executor.EventHandler: Caught throwable while processing event C_M_MODIFY_TABLE&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at java.util.TreeMap.getEntry(TreeMap.java:324)&lt;br/&gt;
	at java.util.TreeMap.containsKey(TreeMap.java:209)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.handler.TableEventHandler.reOpenAllRegions(TableEventHandler.java:114)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.handler.TableEventHandler.process(TableEventHandler.java:90)&lt;br/&gt;
	at org.apache.hadoop.hbase.executor.EventHandler.run(EventHandler.java:168)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)&lt;br/&gt;
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The first time the shell reported that all the regions were updated correctly, the second time it got stuck for a while:&lt;/p&gt;

&lt;blockquote&gt;

&lt;p&gt;6/14 regions updated.&lt;br/&gt;
0/14 regions updated.&lt;br/&gt;
...&lt;br/&gt;
0/14 regions updated.&lt;br/&gt;
2/16 regions updated.&lt;br/&gt;
...&lt;br/&gt;
2/16 regions updated.&lt;br/&gt;
8/9 regions updated.&lt;br/&gt;
...&lt;br/&gt;
8/9 regions updated.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;After which I killed it, redid the alter and it worked.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12526778">HBASE-4578</key>
            <summary>NPE when altering a table that has moving regions</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sunnygao">gaojinchao</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Oct 2011 23:58:55 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:04 +0000</updated>
                            <resolved>Mon, 24 Oct 2011 23:11:24 +0000</resolved>
                                    <version>0.92.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13127832" author="jdcryans" created="Fri, 14 Oct 2011 20:25:25 +0000"  >&lt;p&gt;Upgrading this as a blocker for 0.92.0, if this isn&apos;t fixed our schema changing functionality will be a lot less stable.&lt;/p&gt;</comment>
                            <comment id="13131461" author="sunnygao" created="Thu, 20 Oct 2011 08:56:28 +0000"  >&lt;p&gt;J-D, Do you process this issue ?  Can you share the logs?  If I have a free time, I want to dig it.&lt;/p&gt;</comment>
                            <comment id="13131662" author="sunnygao" created="Thu, 20 Oct 2011 14:42:26 +0000"  >&lt;p&gt;Hi J-D&lt;br/&gt;
The reason seems that:&lt;br/&gt;
//getTableRegions includes the offlined split parent region.&lt;br/&gt;
List&amp;lt;HRegionInfo&amp;gt; hris =&lt;br/&gt;
        MetaReader.getTableRegions(this.server.getCatalogTracker(),&lt;br/&gt;
          tableName);&lt;/p&gt;

&lt;p&gt;// but getRegionLocations don&apos;t include the offlined split parent region.&lt;br/&gt;
NavigableMap&amp;lt;HRegionInfo, ServerName&amp;gt; hriHserverMapping = table.getRegionLocations();&lt;/p&gt;

&lt;p&gt;// So we get &quot;rsLocation&quot; of the offlined split parent region from hriHserverMapping is null&lt;br/&gt;
for (HRegionInfo hri : regions) {&lt;br/&gt;
      ServerName rsLocation = hriHserverMapping.get(hri);&lt;br/&gt;
      if (!serverToRegions.containsKey(rsLocation)) &lt;/p&gt;
{
        LinkedList&amp;lt;HRegionInfo&amp;gt; hriList = Lists.newLinkedList();
        serverToRegions.put(rsLocation, hriList);
      }
&lt;p&gt;      serverToRegions.get(rsLocation).add(hri);&lt;br/&gt;
    }&lt;/p&gt;

&lt;p&gt;Other issue is the parameter &quot;offlined&quot; in allTableRegions doesn&apos;t use.&lt;/p&gt;</comment>
                            <comment id="13131785" author="stack" created="Thu, 20 Oct 2011 17:17:29 +0000"  >&lt;p&gt;@Gaojinchao Your reasoning looks good to me.&lt;/p&gt;</comment>
                            <comment id="13133238" author="sunnygao" created="Sat, 22 Oct 2011 03:31:40 +0000"  >&lt;p&gt;I try to make a patch. But I amn&apos;t sure. Can you review this patch before testing in a real cluster ?&lt;/p&gt;</comment>
                            <comment id="13133239" author="yuzhihong@gmail.com" created="Sat, 22 Oct 2011 03:46:14 +0000"  >&lt;p&gt;Patch makes sense to me.&lt;br/&gt;
There are some unnecessary formatting, such as moving the trailing + to the beginning of the next line.&lt;/p&gt;</comment>
                            <comment id="13133321" author="sunnygao" created="Sat, 22 Oct 2011 08:56:01 +0000"  >&lt;p&gt;Ted&lt;br/&gt;
Thanks for your review. &lt;br/&gt;
I use the code format to provide the community and reformat it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I will fix this.&lt;/p&gt;</comment>
                            <comment id="13133345" author="ram_krish" created="Sat, 22 Oct 2011 11:43:33 +0000"  >&lt;p&gt;Good one Gao&lt;/p&gt;</comment>
                            <comment id="13133885" author="sunnygao" created="Mon, 24 Oct 2011 08:13:42 +0000"  >&lt;p&gt;The real cluster test passed.  I found that shell show regions is inconsistent with real online regions&lt;/p&gt;

&lt;p&gt;looks the logs:&lt;br/&gt;
hbase(main):049:0&amp;gt; alter &apos;t1&apos;, NAME =&amp;gt; &apos;f1&apos;, VERSIONS =&amp;gt; 3&lt;br/&gt;
Updating all regions with the new schema...&lt;/p&gt;

&lt;p&gt;// It said that the cluster has 10 regions. but the cluster has 8 regions and 2 offlined regions. &lt;br/&gt;
// This needs modify or not? &lt;br/&gt;
10/10 regions updated.                              &lt;br/&gt;
Done.&lt;br/&gt;
0 row(s) in 3.3680 seconds&lt;/p&gt;


&lt;p&gt;2011-10-24 04:01:06,510 INFO org.apache.hadoop.hbase.master.handler.TableEventHandler: Skip REGION =&amp;gt; &lt;/p&gt;
{NAME =&amp;gt; &apos;t1,20,1319077909713.0b5fa089e2de0430e4b3087492fc239a.&apos;, TableName =&amp;gt; &apos;t1&apos;, STARTKEY =&amp;gt; &apos;20&apos;, ENDKEY =&amp;gt; &apos;30&apos;, ENCODED =&amp;gt; 0b5fa089e2de0430e4b3087492fc239a, OFFLINE =&amp;gt; true, SPLIT =&amp;gt; true,}
&lt;p&gt;2011-10-24 04:01:06,510 INFO org.apache.hadoop.hbase.master.handler.TableEventHandler: Skip REGION =&amp;gt; &lt;/p&gt;
{NAME =&amp;gt; &apos;t1,40,1319077909713.e2db32ef132229401ecb5b57305b8c8e.&apos;, TableName =&amp;gt; &apos;t1&apos;, STARTKEY =&amp;gt; &apos;40&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; e2db32ef132229401ecb5b57305b8c8e, OFFLINE =&amp;gt; true, SPLIT =&amp;gt; true,}
&lt;p&gt;2011-10-24 04:01:06,510 INFO org.apache.hadoop.hbase.master.handler.TableEventHandler: Reopening 8 regions on 3 region servers.&lt;br/&gt;
2011-10-24 04:01:06,510 DEBUG org.apache.hadoop.hbase.master.BulkReOpen: Creating threads for each region server &lt;/p&gt;

</comment>
                            <comment id="13134227" author="stack" created="Mon, 24 Oct 2011 16:48:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;// It said that the cluster has 10 regions. but the cluster has 8 regions and 2 offlined regions. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think the fact that it says 10 regions updated seems fine.  When you say offlined, what do you mean?  They are offline parents of splits?  If so, they should probably not be counted but no harm done I&apos;d say.  You thinking that we should not be altering split, offlined regions?  That sounds good but in another issue?&lt;/p&gt;</comment>
                            <comment id="13134229" author="stack" created="Mon, 24 Oct 2011 16:50:54 +0000"  >&lt;p&gt;+1 on patch.  Will apply in a little while unless objection.&lt;/p&gt;</comment>
                            <comment id="13134615" author="stack" created="Mon, 24 Oct 2011 23:11:24 +0000"  >&lt;p&gt;Applied to trunk and branch.  Thanks for the patch gaojinchao.&lt;/p&gt;</comment>
                            <comment id="13135006" author="hudson" created="Tue, 25 Oct 2011 13:04:14 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2366 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2366/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2366/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4578&quot; title=&quot;NPE when altering a table that has moving regions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4578&quot;&gt;&lt;del&gt;HBASE-4578&lt;/del&gt;&lt;/a&gt; NPE when altering a table that has moving regions&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13135126" author="hudson" created="Tue, 25 Oct 2011 14:59:58 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #79 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/79/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/79/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4578&quot; title=&quot;NPE when altering a table that has moving regions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4578&quot;&gt;&lt;del&gt;HBASE-4578&lt;/del&gt;&lt;/a&gt; NPE when altering a table that has moving regions&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15016136" author="lars_francke" created="Fri, 20 Nov 2015 11:54:04 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12500409" name="HBASE-4578_Trunk_V1.patch" size="2241" author="sunnygao" created="Mon, 24 Oct 2011 08:26:45 +0000"/>
                            <attachment id="12500289" name="HBASE-4578_trial_Trunk.patch" size="3640" author="sunnygao" created="Sat, 22 Oct 2011 03:32:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 20 Oct 2011 08:56:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>72540</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hrev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101703</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>