<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:08:34 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3239/HBASE-3239.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3239] Handle null regions to flush in HLog.cleanOldLogs</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3239</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Note from Kannan&lt;/p&gt;

&lt;p&gt;findMemstoresWithEditsEqualOrOlderThan() can return NULL it seems like. And we don&apos;t check NULL, before &quot;region.length&quot;.&lt;/p&gt;

&lt;p&gt;      regions = findMemstoresWithEditsEqualOrOlderThan(this.outputfiles.firstKey(),&lt;br/&gt;
        this.lastSeqWritten);&lt;br/&gt;
      StringBuilder sb = new StringBuilder();&lt;br/&gt;
      for (int i = 0; i &amp;lt; regions.length; i++) {&lt;/p&gt;

&lt;p&gt;===&lt;/p&gt;


&lt;p&gt;Stack Trace&lt;/p&gt;

&lt;p&gt;2010-11-15 19:19:54,258 DEBUG org.apache.hadoop.hbase.io.hfile.LruBlockCache: LRU Stats: total=6.1 GB, free=1.71 GB, max=7.81 GB, blocks=385740, accesses=7020255, hits=6329399, hitRatio=90.15%%, cachingAccesses=6765050, cachingHits=6329399, cachingHitsRatio=93.56%%, evictions=1, evicted=49911, evictedPerRun=49911.0&lt;br/&gt;
2010-11-15 19:21:05,204 INFO org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogWriter: Using syncFs &amp;#8211; &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-200&quot; title=&quot;In HDFS, sync() not yet guarantees data available to the new readers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-200&quot;&gt;&lt;del&gt;HDFS-200&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
2010-11-15 19:21:05,211 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: Roll /PUMAHBASE001-SNC5-HBASE/.logs/pumahbase042.snc5.facebook.com,60020,1289856892583/10.38.28.57%3A60020.1289877154987, entries=649004, filesize=255069060. New hlog /PUMAHBASE001-SNC5-HBASE/.logs/pumahbase042.snc5.facebook.com,60020,1289856892583/10.38.28.57%3A60020.1289877665062&lt;br/&gt;
2010-11-15 19:21:05,222 ERROR org.apache.hadoop.hbase.regionserver.LogRoller: Log rolling failed&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.wal.HLog.cleanOldLogs(HLog.java:648)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.wal.HLog.rollWriter(HLog.java:528)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.LogRoller.run(LogRoller.java:94)&lt;br/&gt;
2010-11-15 19:21:05,226 FATAL org.apache.hadoop.hbase.regionserver.HRegionServer: ABORTING region server serverName=pumahbase042.snc5.facebook.com,60020,1289856892583, load=(requests=3476, regions=40, usedHeap=8388, maxHeap=15987): Log rolling failed&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.wal.HLog.cleanOldLogs(HLog.java:648)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.wal.HLog.rollWriter(HLog.java:528)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.LogRoller.run(LogRoller.java:94)&lt;br/&gt;
2010-11-15 19:21:05,227 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Dump of metrics: request=1264.5834, regions=40, stores=70, storefiles=98, storefileIndexSize=35, memstoreSize=83, compactionQueueSize=0, usedHeap=8370, maxHeap=15987, blockCacheSize=6593768536, blockCacheFree=1788154792, blockCacheCount=388283, blockCacheHitRatio=90, blockCacheHitCachingRatio=93&lt;br/&gt;
2010-11-15 19:21:05,227 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: STOPPED: Log rolling failed&lt;br/&gt;
2010-11-15 19:21:05,227 INFO org.apache.hadoop.hbase.regionserver.LogRoller: LogRoller exiting.&lt;br/&gt;
2010-11-15 19:21:07,255 INFO org.apache.hadoop.ipc.HBaseServer: Stopping server on 60020&lt;/p&gt;


&lt;p&gt;===&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12480142">HBASE-3239</key>
            <summary>Handle null regions to flush in HLog.cleanOldLogs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kannanm">Kannan Muthukkaruppan</assignee>
                                    <reporter username="khemani">Prakash Khemani</reporter>
                        <labels>
                    </labels>
                <created>Tue, 16 Nov 2010 20:22:29 +0000</created>
                <updated>Fri, 20 Nov 2015 12:42:22 +0000</updated>
                            <resolved>Thu, 18 Nov 2010 00:55:14 +0000</resolved>
                                    <version>0.90.0</version>
                                    <fixVersion>0.90.0</fixVersion>
                    <fixVersion>0.92.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12932766" author="kannanm" created="Wed, 17 Nov 2010 01:45:32 +0000"  >&lt;p&gt;While the fix seems straightforward, i.e. add a safety check before going into the loop, I still haven&apos;t been able to explain how this case arises, namely, that we have a lot of log files accumulated, but we can&apos;t find a single region/memstore that contains some edits present in the oldest log.&lt;/p&gt;</comment>
                            <comment id="12932962" author="streamy" created="Wed, 17 Nov 2010 14:27:46 +0000"  >&lt;p&gt;Making blocker against 0.90&lt;/p&gt;</comment>
                            <comment id="12932965" author="streamy" created="Wed, 17 Nov 2010 14:46:58 +0000"  >&lt;p&gt;@Kannan, I think the case you&apos;re describing and what is seen here is a fairly &quot;normal&quot; behavior, though it may not be seen often in practice if you have good distribution of writes across regions.&lt;/p&gt;

&lt;p&gt;Two possible but maybe not common/real world examples:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;All edits in the oldest log are for regions that have moved to other servers&lt;/li&gt;
	&lt;li&gt;You have 4 regions, flush size is 64MB, hlog size is 64MB, you hold max 10 logs.  With even distribution of writes, you would expect only the most recent 4 logs (latest 256MB of writes) to have any data which is present in the current memstores (maximum total size of 64*4=256MB).  Eviction of the oldest logs will not contain any edits that are in the memstores of these regions.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12932970" author="streamy" created="Wed, 17 Nov 2010 14:53:50 +0000"  >&lt;p&gt;Assigning to Kannan who made a fix for this in our internal branch.&lt;/p&gt;</comment>
                            <comment id="12933003" author="kannanm" created="Wed, 17 Nov 2010 16:11:08 +0000"  >&lt;p&gt;The patch uploaded as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3241&quot; title=&quot;check to see if we exceeded hbase.regionserver.maxlogs limit is incorrect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3241&quot;&gt;&lt;del&gt;HBASE-3241&lt;/del&gt;&lt;/a&gt; also contains a fix for this issue.&lt;/p&gt;</comment>
                            <comment id="12933041" author="jdcryans" created="Wed, 17 Nov 2010 17:32:48 +0000"  >&lt;p&gt;I think a possible reason why we haven&apos;t seen this before is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3198&quot; title=&quot;Log rolling archives files prematurely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3198&quot;&gt;&lt;del&gt;HBASE-3198&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3208&quot; title=&quot;HLog.findMemstoresWithEditsOlderThan needs to look for edits that are equal to too&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3208&quot;&gt;&lt;del&gt;HBASE-3208&lt;/del&gt;&lt;/a&gt;, since we were archiving the logs prematurely. &lt;/p&gt;

&lt;p&gt;Also regarding:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;All edits in the oldest log are for regions that have moved to other servers&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think it could also happen with splits.&lt;/p&gt;</comment>
                            <comment id="12933144" author="kannanm" created="Wed, 17 Nov 2010 20:35:12 +0000"  >&lt;p&gt;Jonathan/JD: Still not sure about the examples. So my understanding is as follows. &lt;/p&gt;

&lt;p&gt;cleanOldLogs() has two stages:&lt;/p&gt;

&lt;p&gt;#1. remove any old logs which contain edits older than any outstanding/unflushed edits in a memstore.&lt;br/&gt;
#2. if at this point we are still over the threshold, flush regions containing edits from the oldest log.&lt;/p&gt;

&lt;p&gt;For the case you mention: &quot;All edits in the oldest log are for regions that have moved to other servers&quot; &amp;#8211; wouldn&apos;t stage #1 itself have removed the said log? At the end of stage #1, any logs remaining should at least have one memstore that&apos;s preventing that log from being reclaimed in stage #1, correct?&lt;/p&gt;
</comment>
                            <comment id="12933191" author="kannanm" created="Wed, 17 Nov 2010 22:12:56 +0000"  >&lt;p&gt;Note: The cluster this happened on didn&apos;t have &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3208&quot; title=&quot;HLog.findMemstoresWithEditsOlderThan needs to look for edits that are equal to too&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3208&quot;&gt;&lt;del&gt;HBASE-3208&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3198&quot; title=&quot;Log rolling archives files prematurely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3198&quot;&gt;&lt;del&gt;HBASE-3198&lt;/del&gt;&lt;/a&gt; fixes. &lt;/p&gt;</comment>
                            <comment id="12933255" author="jdcryans" created="Thu, 18 Nov 2010 00:24:50 +0000"  >&lt;p&gt;So we confirmed that the cluster only had &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3198&quot; title=&quot;Log rolling archives files prematurely&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3198&quot;&gt;&lt;del&gt;HBASE-3198&lt;/del&gt;&lt;/a&gt; and NOT &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3208&quot; title=&quot;HLog.findMemstoresWithEditsOlderThan needs to look for edits that are equal to too&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3208&quot;&gt;&lt;del&gt;HBASE-3208&lt;/del&gt;&lt;/a&gt;, which fixed this particular NPE.&lt;/p&gt;

&lt;p&gt;@Kannan, would you mind rescoping the title of this jira to something more around handling the NPE rather than the NPE itself?&lt;/p&gt;</comment>
                            <comment id="12933266" author="jdcryans" created="Thu, 18 Nov 2010 00:48:12 +0000"  >&lt;p&gt;About to commit, changing the title.&lt;/p&gt;</comment>
                            <comment id="12933271" author="jdcryans" created="Thu, 18 Nov 2010 00:55:14 +0000"  >&lt;p&gt;Committed to trunk and 0.90, thanks Kannan!&lt;/p&gt;</comment>
                            <comment id="15017232" author="lars_francke" created="Fri, 20 Nov 2015 12:42:22 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 17 Nov 2010 01:45:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26733</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hldb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100724</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>