<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:19:20 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4485/HBASE-4485.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4485] Eliminate window of missing Data</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4485</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;After incorporating v11 of the 2856 fix, we discovered that we are still having some ACID violations.&lt;/p&gt;

&lt;p&gt;This time, however, the problem is not about including &quot;newer&quot; updates; but, about missing older updates&lt;br/&gt;
that should be including. &lt;/p&gt;

&lt;p&gt;Here is what seems to be happening.&lt;/p&gt;

&lt;p&gt;There is a race condition in the StoreScanner.getScanners()&lt;/p&gt;

&lt;p&gt;  private List&amp;lt;KeyValueScanner&amp;gt; getScanners(Scan scan,&lt;br/&gt;
      final NavigableSet&amp;lt;byte[]&amp;gt; columns) throws IOException {&lt;br/&gt;
    // First the store file scanners&lt;br/&gt;
    List&amp;lt;StoreFileScanner&amp;gt; sfScanners = StoreFileScanner&lt;br/&gt;
      .getScannersForStoreFiles(store.getStorefiles(), cacheBlocks,&lt;br/&gt;
                                isGet, false);&lt;br/&gt;
    List&amp;lt;KeyValueScanner&amp;gt; scanners =&lt;br/&gt;
      new ArrayList&amp;lt;KeyValueScanner&amp;gt;(sfScanners.size()+1);&lt;/p&gt;

&lt;p&gt;    // include only those scan files which pass all filters&lt;br/&gt;
    for (StoreFileScanner sfs : sfScanners) {&lt;br/&gt;
      if (sfs.shouldSeek(scan, columns)) &lt;/p&gt;
{
        scanners.add(sfs);
      }
&lt;p&gt;    }&lt;/p&gt;

&lt;p&gt;    // Then the memstore scanners&lt;br/&gt;
    if (this.store.memstore.shouldSeek(scan)) &lt;/p&gt;
{
      scanners.addAll(this.store.memstore.getScanners());
    }
&lt;p&gt;    return scanners;&lt;br/&gt;
  }&lt;/p&gt;


&lt;p&gt;If for example there is a call to Store.updateStorefiles() that happens between&lt;br/&gt;
the store.getStorefiles() and this.store.memstore.getScanners(); then&lt;br/&gt;
it is possible that there was a new HFile created, that is not seen by the&lt;br/&gt;
StoreScanner, and the data is not present in the Memstore.snapshot either.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12524659">HBASE-4485</key>
            <summary>Eliminate window of missing Data</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12469746">HBASE-2856</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="amitanand">Amitanand Aiyer</assignee>
                                    <reporter username="amitanand">Amitanand Aiyer</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Sep 2011 16:18:02 +0000</created>
                <updated>Fri, 12 Oct 2012 05:34:58 +0000</updated>
                            <resolved>Fri, 18 Nov 2011 02:21:49 +0000</resolved>
                                                    <fixVersion>0.94.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13114763" author="amitanand" created="Mon, 26 Sep 2011 16:29:03 +0000"  >&lt;p&gt;One way to fix this issue, would be to swap the order in which we clear the snapshot, in Store.updateStoreFiles.&lt;/p&gt;

&lt;p&gt;We might want to notifyReaders() before doing the clearSnapshot(). While it seems like this might fix&lt;br/&gt;
the issue. Here are some issues that it may raise.&lt;/p&gt;

&lt;p&gt;  (a) If say Scanner 1 got updated; but Scanner 2 is yet to be updated (waiting for the lock). Scanner 1 may&lt;br/&gt;
now see duplicate data. Some KV&apos;s exist both in the new file and in the snapshot.&lt;br/&gt;
     Not sure if our current KVHeap mechanism is able to handle this. esp in terms of the number of updates we &lt;br/&gt;
have&lt;br/&gt;
  (b) performance concerns about holding on to the snapshot until all the scanners/readers finish scanning&lt;br/&gt;
the columnFamily to allow StoreScanner.updateReaders() to get the lock.&lt;/p&gt;</comment>
                            <comment id="13114767" author="amitanand" created="Mon, 26 Sep 2011 16:32:37 +0000"  >&lt;p&gt;v1 is the Initial diff. May have other issues/repurcussions of the change.&lt;/p&gt;

&lt;p&gt;Have not yet tested. Just out there for initial feedback.&lt;/p&gt;</comment>
                            <comment id="13115438" author="amitanand" created="Tue, 27 Sep 2011 12:26:55 +0000"  >&lt;p&gt;Here is a way to repro the bug.&lt;/p&gt;

&lt;p&gt;uses unnecessary sleep to get things to go bad. Not intended to be included in the final diff/submission.&lt;/p&gt;</comment>
                            <comment id="13115537" author="amitanand" created="Tue, 27 Sep 2011 14:35:13 +0000"  >&lt;p&gt;fix the issue using locks to ensure that Store.updateStoreFiles does not get called between StoreScanner getting the List of store files, and it getting to the MemStoreScanner.&lt;/p&gt;</comment>
                            <comment id="13115538" author="amitanand" created="Tue, 27 Sep 2011 14:37:02 +0000"  >&lt;p&gt;Move some functions to Store.java so that we do not have to access store.lock from StoreScanner.java&lt;/p&gt;

&lt;p&gt;Passes the TestAcidGuarantees on the internal branch (0.89). &lt;/p&gt;

&lt;p&gt;Running the test suite on the open source trunk (in progress)&lt;/p&gt;</comment>
                            <comment id="13115559" author="amitanand" created="Tue, 27 Sep 2011 15:11:58 +0000"  >&lt;p&gt;move notifyChangeReaderObservers() outside the lock at all places.&lt;/p&gt;

&lt;p&gt;Testing in progress.&lt;/p&gt;</comment>
                            <comment id="13116660" author="stack" created="Wed, 28 Sep 2011 18:15:17 +0000"  >&lt;p&gt;@Amit Great stuff.  I like the reasoning above especially the bit where the fix I&apos;d have done, the swapping order, likely has issues.&lt;/p&gt;

&lt;p&gt;Looks like a little pollution in this patch from hbase-4344 but no matter since you&apos;ve merged this into hbase-4344 over in hbase-4344 (getMaxMemstoreTS?).&lt;/p&gt;

&lt;p&gt;Why move the notify outside of the lock?  Is it possible that when done outside of the lock, that observers could ever see different lists of readers?&lt;/p&gt;

</comment>
                            <comment id="13127164" author="jmhsieh" created="Fri, 14 Oct 2011 00:17:51 +0000"  >&lt;p&gt;@Amitanand&lt;/p&gt;

&lt;p&gt;I&apos;ve applied &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2856&quot; title=&quot;TestAcidGuarantee broken on trunk &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2856&quot;&gt;&lt;del&gt;HBASE-2856&lt;/del&gt;&lt;/a&gt;&apos;s from (&lt;a href=&quot;https://reviews.apache.org/r/2224/diff/#index_header&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2224/diff/#index_header&lt;/a&gt;) onto trunk (with minor tweak) and then applied &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4485&quot; title=&quot;Eliminate window of missing Data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4485&quot;&gt;&lt;del&gt;HBASE-4485&lt;/del&gt;&lt;/a&gt; but have a compile failure.  Specificially matcher.ignoreNewerKVs() seems to be missing.  Is there another commit that I&apos;m missing?  &lt;/p&gt;</comment>
                            <comment id="13127696" author="yuzhihong@gmail.com" created="Fri, 14 Oct 2011 16:58:30 +0000"  >&lt;p&gt;Here is the related change w.r.t. ignoreNewerKVs():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/main/java/org/apache/hadoop/hbase/regionserver/ScanQueryMatcher.java
===================================================================
--- src/main/java/org/apache/hadoop/hbase/regionserver/ScanQueryMatcher.java    (revision 1176657)
+++ src/main/java/org/apache/hadoop/hbase/regionserver/ScanQueryMatcher.java    (working copy)
@@ -59,6 +59,12 @@
   /** Row the query is on */
   &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] row;

+  /** Should we ignore KV&apos;s with a newer RWCC timestamp **/
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; ignoreNewerKVs = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void ignoreNewerKVs() {
+    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ignoreNewerKVs = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
+  }
+
   /**
    * Constructs a ScanQueryMatcher &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a Scan.
    * @param scan
@@ -166,6 +172,12 @@
         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; columns.getNextRowOrNextColumn(bytes, offset, qualLength);
     }

+    &lt;span class=&quot;code-comment&quot;&gt;// The compaction thread has no readPoint set. For other operations, we
&lt;/span&gt;+    &lt;span class=&quot;code-comment&quot;&gt;// will ignore updates that are done after the read operation has started.
&lt;/span&gt;+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ignoreNewerKVs &amp;amp;&amp;amp;
+        kv.getMemstoreTS() &amp;gt; ReadWriteConsistencyControl.getThreadReadPoint())
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; MatchCode.SKIP;
+
     &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; type = kv.getType();
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isDelete(type)) {
       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tr.withinOrAfterTimeRange(timestamp)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13131833" author="amitanand" created="Thu, 20 Oct 2011 17:53:12 +0000"  >&lt;p&gt;@Stack. The reason that I wanted to move notifyChangedReaders outside the lock is to avoid a potential race condition where.&lt;/p&gt;

&lt;p&gt;Thread A holds the lock for the Store.java, and wants to do notifyChangedReaders holding the lock.&lt;br/&gt;
  NotifyChangedReaders calls updateReaders on a StoreScanner &amp;#8211; Say scanner-B&lt;/p&gt;

&lt;p&gt;Thread B is doing a seek on scanner-B so it holds a lock on the StoreScanner object.&lt;br/&gt;
  Thread B could now have to call getScanners() (which is now a synchronized function in store) if the heap == null.&lt;/p&gt;

&lt;p&gt;This could end up in a deadlock where Thread A has the lock for Store.java but needs the lock for StoreScanner to get into updateReaders.&lt;br/&gt;
Thread B has the lock for StoreScanner.java but needs the lock for Store.java to get into getScanners and finish the seek().&lt;/p&gt;

</comment>
                            <comment id="13131844" author="amitanand" created="Thu, 20 Oct 2011 18:00:06 +0000"  >&lt;p&gt;I am not clear on weather we need the notifyChangedReader to be under the lock or not? I guess that depends on the&lt;br/&gt;
state that the lock is trying to guard. My understanding/assumption was that &lt;/p&gt;

&lt;p&gt;(a) The lock in Store.java  is guarding the list-of-store-files plus the state of MemStore&apos;s (kvset and snapshot) references. &lt;/p&gt;

&lt;p&gt;(b) Was also assuming that StoreScanner is okay with seeing an older older set of files, as long as the memStoreScanner that&lt;br/&gt;
it is using is current (i.e. The StoreScanner&apos;s view of the world may not be accurate as of &quot;now&quot;. But it is guaranteed&lt;br/&gt;
to be consistent across the set of storefiles and the memstore (at the time getScanners was called to create the scanners).&lt;/p&gt;

&lt;p&gt;I don&apos;t think that we can totally avoid (b) even if we have notifyChangedReaders under the lock. StoreScanner could already&lt;br/&gt;
be processing a next() operation, during which the updateReader will just have to wait to let the StoreScanner complete, however&lt;br/&gt;
long it takes.&lt;/p&gt;

&lt;p&gt;Please correct me if my assumptions/understanding are wrong.&lt;/p&gt;</comment>
                            <comment id="13131845" author="amitanand" created="Thu, 20 Oct 2011 18:00:59 +0000"  >
&lt;p&gt;Btw, Ted also has a fix to this issue where in we use a reader lock and a writer lock in Store.java, and the writerlock is used&lt;br/&gt;
when we update the files. We switch back to the reader lock when we do the notifyChangedReaders.&lt;/p&gt;

&lt;p&gt;We could definitely use that to be &quot;safe&quot;. But, I am still trying to understand the case where having notifyChangedReaders&lt;br/&gt;
outside the lock could cause problems.&lt;/p&gt;</comment>
                            <comment id="13131917" author="jiraposter@reviews.apache.org" created="Thu, 20 Oct 2011 19:14:10 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2481/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for Ted Yu, Michael Stack, Jonathan Gray, Lars Hofhansl, Amitanand Aiyer, Kannan Muthukkaruppan, Karthik Ranganathan, and Nicolas Spiegelberg.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Part of the 2856 diff split into 3 parts for easier review&lt;/p&gt;

&lt;p&gt;The first part is v6 of the patch submitted to:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2224/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2224/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is the fix for HBase-4485&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-4485.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/hbase-4485&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hbase-4485&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 7761c42 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java f5b5c4c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java 34263e4 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2481/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;running mvn test with all 3 patches together.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Amitanand&lt;/p&gt;
</comment>
                            <comment id="13131988" author="yuzhihong@gmail.com" created="Thu, 20 Oct 2011 20:26:29 +0000"  >&lt;p&gt;In Store.completeCompaction(), the following code is outside lock.writeLock:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-comment&quot;&gt;// Tell observers that list of StoreFiles has changed.
&lt;/span&gt;      notifyChangedReadersObservers();
      &lt;span class=&quot;code-comment&quot;&gt;// Finally, delete old store files.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (StoreFile hsf: compactedFiles) {
        hsf.deleteReader();
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think the above should be placed in (downgraded) lock.readLock&lt;/p&gt;</comment>
                            <comment id="13131994" author="yuzhihong@gmail.com" created="Thu, 20 Oct 2011 20:32:33 +0000"  >&lt;p&gt;In StoreScanner.useRWCC(boolean flag):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    List&amp;lt;KeyValueScanner&amp;gt; allStoreScanners = 
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.store.getScanners(cacheBlocks, isGet);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I am not sure if allStoreScanners is a good name - MemStoreScanner is checked later in the method.&lt;br/&gt;
I suggest we keep the original name - scanners.&lt;/p&gt;</comment>
                            <comment id="13132355" author="jiraposter@reviews.apache.org" created="Fri, 21 Oct 2011 06:12:33 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2481/#review2736&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/#review2736&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Looks good to me. Would be awesome to get this finally out of the way!&lt;br/&gt;
A few nits (like trailing spaces). And some questions below.&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2481/#comment6164&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/#comment6164&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can this now be a static inner class (if we pass kvSet, etc) to the MemstoreScanner constructor?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2481/#comment6166&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/#comment6166&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Can these be private?&lt;br/&gt;
    volatile because you did not want synchronous in the MemstoreScanner constructor?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2481/#comment6162&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/#comment6162&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Cool.&lt;/p&gt;

&lt;p&gt;    Only concern is that while the scanner exists we may need more memory than before.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2481/#comment6160&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/#comment6160&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why can you move this up?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2481/#comment6159&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/#comment6159&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I&apos;m not usually a fan of instanceof - unless necessary of course.&lt;br/&gt;
    Why did you need to fold this into one loop?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Lars&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-10-20 19:13:56, Amitanand Aiyer wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2481/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-20 19:13:56)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for Ted Yu, Michael Stack, Jonathan Gray, Lars Hofhansl, Amitanand Aiyer, Kannan Muthukkaruppan, Karthik Ranganathan, and Nicolas Spiegelberg.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Part of the 2856 diff split into 3 parts for easier review&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The first part is v6 of the patch submitted to:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2224/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2224/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is the fix for HBase-4485&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug hbase-4485.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/hbase-4485&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hbase-4485&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 7761c42 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java f5b5c4c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java 34263e4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2481/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;running mvn test with all 3 patches together.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Amitanand&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13132733" author="jiraposter@reviews.apache.org" created="Fri, 21 Oct 2011 15:12:32 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-10-21 06:13:51, Lars Hofhansl wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java, line 645&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2481/diff/1/?file=51676#file51676line645&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/diff/1/?file=51676#file51676line645&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Can these be private?&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     volatile because you did not want synchronous in the MemstoreScanner constructor?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;actually, I had this volatile because the kvset in the Memstore is volatile.&lt;/p&gt;

&lt;p&gt;But, on second thought, it seems like we can get rid of that. While the kvset and snapshot in Memstore &lt;br/&gt;
can be accessed from different threads (running different Memstorescanners). The reference in the&lt;br/&gt;
MemstoreScanner should only be used in the Thread that is performing the scan.&lt;/p&gt;

&lt;p&gt;Will update the diff and send it again.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-10-21 06:13:51, Lars Hofhansl wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java, line 712&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2481/diff/1/?file=51676#file51676line712&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/diff/1/?file=51676#file51676line712&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Cool.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Only concern is that while the scanner exists we may need more memory than before.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;you are right. &lt;/p&gt;

&lt;p&gt;Are we guaranteed to do a seek() only once? If so, we probably can reset kvset/snapshot to null, &lt;br/&gt;
once we have evaluated kvTail and snapshotTail.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-10-21 06:13:51, Lars Hofhansl wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/regionserver/Store.java, line 1335&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2481/diff/1/?file=51677#file51677line1335&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/diff/1/?file=51677#file51677line1335&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Why can you move this up?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Here is my understanding/assumption:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4485?focusedCommentId=13131844&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13131844&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4485?focusedCommentId=13131844&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13131844&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Let me know if that is wrong &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Amitanand&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2481/#review2736&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/#review2736&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-10-20 19:13:56, Amitanand Aiyer wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2481/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-20 19:13:56)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for Ted Yu, Michael Stack, Jonathan Gray, Lars Hofhansl, Amitanand Aiyer, Kannan Muthukkaruppan, Karthik Ranganathan, and Nicolas Spiegelberg.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Part of the 2856 diff split into 3 parts for easier review&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The first part is v6 of the patch submitted to:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2224/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2224/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is the fix for HBase-4485&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug hbase-4485.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/hbase-4485&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hbase-4485&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 7761c42 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java f5b5c4c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java 34263e4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2481/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;running mvn test with all 3 patches together.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Amitanand&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13132740" author="jiraposter@reviews.apache.org" created="Fri, 21 Oct 2011 15:18:32 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-10-21 06:13:51, Lars Hofhansl wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java, line 216&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/2481/diff/1/?file=51678#file51678line216&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/diff/1/?file=51678#file51678line216&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     I&apos;m not usually a fan of instanceof - unless necessary of course.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Why did you need to fold this into one loop?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The reason for having one loop is because we want to get the&lt;br/&gt;
Scanners for the storefiles and the scanners for memstore at&lt;br/&gt;
the same time. This is required for ensuring that the view of&lt;br/&gt;
the StoreScanner is consistent with the state of the store,&lt;br/&gt;
at some point in the execution history.&lt;/p&gt;

&lt;p&gt;I agree, instance of is kinda ugly. Will try to get rid of that.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Amitanand&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2481/#review2736&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/#review2736&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-10-20 19:13:56, Amitanand Aiyer wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2481/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-20 19:13:56)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for Ted Yu, Michael Stack, Jonathan Gray, Lars Hofhansl, Amitanand Aiyer, Kannan Muthukkaruppan, Karthik Ranganathan, and Nicolas Spiegelberg.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Part of the 2856 diff split into 3 parts for easier review&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;The first part is v6 of the patch submitted to:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2224/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2224/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is the fix for HBase-4485&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug hbase-4485.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/hbase-4485&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hbase-4485&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 7761c42 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java f5b5c4c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java 34263e4 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2481/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;running mvn test with all 3 patches together.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Amitanand&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13132809" author="yuzhihong@gmail.com" created="Fri, 21 Oct 2011 16:38:08 +0000"  >&lt;p&gt;In order to avoid using instanceof in useRWCC(), we have at least two options:&lt;/p&gt;

&lt;p&gt;1. create a tuple for each KeyValueScanner discovered with boolean flag indicating whether the KeyValueScanner is StoreFileScanner or not.&lt;br/&gt;
Thus scanners would be List&amp;lt;KeyValueScannerWrapper&amp;gt;&lt;/p&gt;

&lt;p&gt;2. Make scanners a Map&amp;lt;KeyValueScanner, Boolean&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13152413" author="jiraposter@reviews.apache.org" created="Thu, 17 Nov 2011 22:43:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2481/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-17 22:43:10.296972)&lt;/p&gt;


&lt;p&gt;Review request for Ted Yu, Michael Stack, Jonathan Gray, Lars Hofhansl, Amitanand Aiyer, Kannan Muthukkaruppan, Karthik Ranganathan, and Nicolas Spiegelberg.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added comments, based on kannan/nicolas&apos; comments on the 89 branch.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Part of the 2856 diff split into 3 parts for easier review&lt;/p&gt;

&lt;p&gt;The first part is v6 of the patch submitted to:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2224/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2224/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is the fix for HBase-4485&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-4485.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/hbase-4485&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hbase-4485&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java 34263e4 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 7761c42 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java f5b5c4c &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2481/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;running mvn test with all 3 patches together.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Amitanand&lt;/p&gt;
</comment>
                            <comment id="13152425" author="yuzhihong@gmail.com" created="Thu, 17 Nov 2011 22:57:56 +0000"  >&lt;p&gt;@Amit:&lt;br/&gt;
Can you highlight the changes in the latest patch ?&lt;br/&gt;
There&apos;re 12 files where the patch doesn&apos;t cleanly apply.&lt;/p&gt;

&lt;p&gt;The patch is much larger than diff-oct-14.diff:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-rw-r--r--@ 1 zhihyu  110088321  60773 Nov 17 14:51 4485-nov-17.txt
-rw-r--r--  1 zhihyu  110088321  33693 Oct 14 15:18 4485.v14
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13152450" author="jiraposter@reviews.apache.org" created="Thu, 17 Nov 2011 23:29:56 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2481/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-17 23:28:27.463840)&lt;/p&gt;


&lt;p&gt;Review request for Ted Yu, Michael Stack, Jonathan Gray, Lars Hofhansl, Amitanand Aiyer, Kannan Muthukkaruppan, Karthik Ranganathan, and Nicolas Spiegelberg.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;added comments based on kannan/nicolas&apos; feedback.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Part of the 2856 diff split into 3 parts for easier review&lt;/p&gt;

&lt;p&gt;The first part is v6 of the patch submitted to:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2224/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2224/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is the fix for HBase-4485&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-4485.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/hbase-4485&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hbase-4485&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java 34263e4 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 7761c42 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java f5b5c4c &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2481/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;running mvn test with all 3 patches together.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Amitanand&lt;/p&gt;
</comment>
                            <comment id="13152573" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 01:35:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2481/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-18 01:35:33.881853)&lt;/p&gt;


&lt;p&gt;Review request for Ted Yu, Michael Stack, Jonathan Gray, Lars Hofhansl, Amitanand Aiyer, Kannan Muthukkaruppan, Karthik Ranganathan, and Nicolas Spiegelberg.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;rebased with the latest.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Part of the 2856 diff split into 3 parts for easier review&lt;/p&gt;

&lt;p&gt;The first part is v6 of the patch submitted to:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2224/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2224/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This is the fix for HBase-4485&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-4485.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/hbase-4485&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hbase-4485&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java 747a90b &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java fec5547 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java 6512a54 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2481/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2481/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;running mvn test with all 3 patches together.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Amitanand&lt;/p&gt;
</comment>
                            <comment id="13152596" author="nspiegelberg" created="Fri, 18 Nov 2011 02:17:30 +0000"  >&lt;p&gt;+1 lgtm.  went over this with kannan.&lt;/p&gt;</comment>
                            <comment id="13152700" author="hudson" created="Fri, 18 Nov 2011 07:12:04 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2454 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2454/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2454/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4485&quot; title=&quot;Eliminate window of missing Data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4485&quot;&gt;&lt;del&gt;HBASE-4485&lt;/del&gt;&lt;/a&gt; Eliminate window of missing Data&lt;/p&gt;

&lt;p&gt;nspiegelberg : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/MemStore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12526531">HBASE-4570</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12496496" name="4485-v1.diff" size="949" author="amitanand" created="Mon, 26 Sep 2011 16:32:37 +0000"/>
                            <attachment id="12496691" name="4485-v2.diff" size="5729" author="amitanand" created="Tue, 27 Sep 2011 14:35:13 +0000"/>
                            <attachment id="12496692" name="4485-v3.diff" size="6293" author="amitanand" created="Tue, 27 Sep 2011 14:37:02 +0000"/>
                            <attachment id="12496695" name="4485-v4.diff" size="9561" author="amitanand" created="Tue, 27 Sep 2011 15:11:58 +0000"/>
                            <attachment id="12504133" name="4485-v5.diff" size="10860" author="amitanand" created="Thu, 17 Nov 2011 23:19:40 +0000"/>
                            <attachment id="12504158" name="4485-v6.diff" size="11172" author="amitanand" created="Fri, 18 Nov 2011 01:25:22 +0000"/>
                            <attachment id="12496676" name="repro_bug-4485.diff" size="996" author="amitanand" created="Tue, 27 Sep 2011 12:26:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 28 Sep 2011 18:15:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3234</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 5 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08r8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49014</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>