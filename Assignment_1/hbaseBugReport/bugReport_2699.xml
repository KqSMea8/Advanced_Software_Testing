<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:04:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2699/HBASE-2699.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2699] Reimplement load balancing to be a background process and to not use heartbeats</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2699</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description></description>
                <environment></environment>
        <key id="12466500">HBASE-2699</key>
            <summary>Reimplement load balancing to be a background process and to not use heartbeats</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12466475">HBASE-2692</parent>
                                    <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="streamy">Jonathan Gray</assignee>
                                    <reporter username="streamy">Jonathan Gray</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jun 2010 21:41:07 +0000</created>
                <updated>Fri, 20 Nov 2015 12:44:05 +0000</updated>
                            <resolved>Wed, 1 Sep 2010 05:09:30 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12876967" author="ryanobjc" created="Wed, 9 Jun 2010 06:06:03 +0000"  >&lt;p&gt;thinking about this, the background load balancer would occasionally&lt;br/&gt;
run, determine the optimal moves then enter them into a &apos;make it&lt;br/&gt;
happen queue&apos;.  this queue is a series of logical operations as&lt;br/&gt;
multiple micro-steps, eg: close region A on server X and then open&lt;br/&gt;
region A on server Y (after it was closed on X of course).&lt;/p&gt;

&lt;p&gt;it would allow the load balancer to &quot;explain&quot; what it wants to do in&lt;br/&gt;
logs and then you can evaluate 2 aspects:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;is the load balancer choosing the right thing to do? (hopefully easy&lt;br/&gt;
to unit test)&lt;/li&gt;
	&lt;li&gt;given these moves, are they getting executed correctly?&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;The latter is a little tricky, since the real world may have changed&lt;br/&gt;
since the balancer ran, and the code will have to check pre-conditions&lt;br/&gt;
and potentially abort if they are not met.&lt;/p&gt;

</comment>
                            <comment id="12886381" author="streamy" created="Thu, 8 Jul 2010 17:31:44 +0000"  >&lt;p&gt;Adds new &lt;tt&gt;LoadBalancer&lt;/tt&gt; class to the master package.  Class defines three primary methods.&lt;/p&gt;

&lt;p&gt;The new load balancing algorithm drops the notion of slop and fully balances the cluster (this will be a background process so no need to use slop to prevent churn).  The method is a bit long but I did my best to document it... at least it&apos;s in one method and testable now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Balancing uses the following method which takes a map of all the servers to their regions and returns a list of regions to be moved with their source and destination servers:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public List&amp;lt;RegionPlan&amp;gt; balanceCluster(Map&amp;lt;HServerInfo,List&amp;lt;HRegionInfo&amp;gt;&amp;gt; serverInfo)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For cluster startup, there is a bulk assignment method.  Currently this is implemented as round-robin but should eventually be extended to use block locations (there are some methods in this class to help but not integrated yet):&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public Map&amp;lt;HServerInfo,List&amp;lt;HRegionInfo&amp;gt;&amp;gt; bulkAssignment(List&amp;lt;HRegionInfo&amp;gt; regions, List&amp;lt;HServerInfo&amp;gt; servers)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The other time we may need to determine assignments of regions is after master failover.  A new master may find regions who have been closed but no longer has in-memory state (a &lt;tt&gt;RegionPlan&lt;/tt&gt;) to say where it should be opened.  In this case, the master will use an immediate assignment method, the goal of which is to just come up with an assignment as fast as possible.  Currently it randomly picks a server for each input region.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;public Map&amp;lt;HRegionInfo,HServerInfo&amp;gt; immediateAssignment(List&amp;lt;HRegionInfo&amp;gt; regions, List&amp;lt;HServerInfo&amp;gt; servers)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Patch also adds a nice fat TestLoadBalancer unit test with tests for each of the three methods.  It has input arrays for a bunch of mock cluster states and methods to verify the balancing invariants to ensure correctness.&lt;/p&gt;

&lt;p&gt;If anyone has more good edge cases let&apos;s get em added!&lt;/p&gt;

&lt;p&gt;Yay, a testable load balancer!&lt;/p&gt;</comment>
                            <comment id="12886382" author="streamy" created="Thu, 8 Jul 2010 17:32:12 +0000"  >&lt;p&gt;btw, patch does not integrate at all with existing code, just standalone for now and unit tested.&lt;/p&gt;</comment>
                            <comment id="12886400" author="tlipcon" created="Thu, 8 Jul 2010 18:33:05 +0000"  >&lt;p&gt;I haven&apos;t looked at the patch yet, but can you elaborate a little bit on why we don&apos;t need slop anymore? I&apos;m not sure I understand what you mean by &quot;it runs as a background process&quot; - even if we are computing balancing plans in the background, if it&apos;s always trying to get exact balancing, and we always enact the latest plan, won&apos;t it cause churn?&lt;/p&gt;

&lt;p&gt;Or is the plan to only &quot;enact&quot; the plan if we notice that the cluster has slipped out of balance?&lt;/p&gt;
</comment>
                            <comment id="12886403" author="streamy" created="Thu, 8 Jul 2010 18:42:58 +0000"  >&lt;p&gt;The load balancer will be triggered according to some configurable period, like every 5 minutes (if you don&apos;t mind more churn) or once every hour (to keep churn down).&lt;/p&gt;

&lt;p&gt;The first thing it does is check that the cluster is in fact &quot;out of balance&quot;, and without slop this is strict.  We used to not have slop but it was introduced to prevent load balancing from getting triggered after just one or two splits threw things just off balance.  As a periodic background process, we won&apos;t be sensitive to things like this and instead will do the balancing on a fixed period.&lt;/p&gt;

&lt;p&gt;There could be some improvements later that force a load balance if the cluster reaches a certain level of &quot;out of balance&quot; but that&apos;s an optimization, not considering it now.&lt;/p&gt;

&lt;p&gt;This balancer should eventually move towards something cost-based that takes a much more complete picture of &quot;load&quot; into account.  I&apos;m not sure a notion of &quot;slop&quot; makes sense in this context... the goal will always be to balance as best as possible (with a side-goal of not moving regions around if it doesn&apos;t improve the balance... meaning, if a region could be on X or Y server and achieve the same balance, it should bias towards staying where it is, minimal churn).  The algo will certainly need an overhaul when we implement this.&lt;/p&gt;

&lt;p&gt;In any case, slop adds unnecessary complexity and the original purpose it was added is no longer relevant IMO.  With this new balancer, it would mean overloaded servers would always hover at the top of the slop range, underloaded servers would hover at the bottom of the slop range.  Why not actually balance?  Simpler algorithm.&lt;/p&gt;

&lt;p&gt;I also expect region movement to be quite fast with the double-flush and zk-based transitions.  Hopefully have some real timings next week.&lt;/p&gt;</comment>
                            <comment id="12886533" author="streamy" created="Thu, 8 Jul 2010 22:38:52 +0000"  >&lt;p&gt;Patch has been reviewed on rb and +1&apos;d by jd and todd.  This is the patch I am committing to the branch.  Thanks guys.&lt;/p&gt;</comment>
                            <comment id="12887993" author="stack" created="Tue, 13 Jul 2010 20:37:39 +0000"  >&lt;p&gt;I wonder why my comments on the patch don&apos;t show here?    Posted &apos;Posted 1 day, 2 hours ago (July 12th, 2010, 11:31 a.m.)&apos; at &lt;a href=&quot;http://review.hbase.org/r/287/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/287/&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12888027" author="streamy" created="Tue, 13 Jul 2010 21:37:28 +0000"  >&lt;p&gt;I hadn&apos;t been adding the &apos;hbase&apos; group to my reviews which kept it off the jiras.  WIll fix moving forward.&lt;/p&gt;

&lt;p&gt;I responded to your comments over on rb.&lt;/p&gt;</comment>
                            <comment id="12889414" author="stack" created="Fri, 16 Jul 2010 23:41:46 +0000"  >&lt;p&gt;We have to wait on other stuff before this can go in?&lt;/p&gt;</comment>
                            <comment id="12904908" author="stack" created="Wed, 1 Sep 2010 05:09:30 +0000"  >&lt;p&gt;Committed as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2692&quot; title=&quot;Master rewrite and cleanup for 0.90&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2692&quot;&gt;&lt;del&gt;HBASE-2692&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12904910" author="stack" created="Wed, 1 Sep 2010 05:10:55 +0000"  >&lt;p&gt;LoadBalancer is floated by Master inside an instance of Chore.&lt;/p&gt;</comment>
                            <comment id="15017702" author="lars_francke" created="Fri, 20 Nov 2015 12:44:05 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12430964">HBASE-1676</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12473058">HBASE-2950</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12462821">HBASE-2480</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12448990" name="HBASE-2699-LoadBalancer-v2.patch" size="33910" author="streamy" created="Thu, 8 Jul 2010 17:31:43 +0000"/>
                            <attachment id="12449024" name="HBASE-2699-LoadBalancer-v5.patch" size="38037" author="streamy" created="Thu, 8 Jul 2010 22:38:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Jun 2010 06:06:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32726</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hitb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100310</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>