<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:46:10 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13737/HBASE-13737.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13737] [HBase MOB] MOBTable cloned from a snapshot leads to data loss, when that actual snapshot and main table is deleted.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13737</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;clone snapshot on mob feature leads to data loss for mob data.&lt;br/&gt;
steps to reproduce:&lt;br/&gt;
===============&lt;br/&gt;
1. created MOB table with two column families like &quot;mobcf&quot; (mob is enabled) and &quot;norcf&quot;&lt;br/&gt;
2. insert mob data and normal data at a time into the table.&lt;br/&gt;
3. scan the MOB table.&lt;br/&gt;
4. take snapshot by specifying the table name.&lt;br/&gt;
5. clone the snapshot by specifying the new table name.&lt;br/&gt;
6. check the new table is created or not and try scan for the new table which have both mob data and normal data should give back to the client.&lt;br/&gt;
7. delete the snapshot which done in step 4.&lt;br/&gt;
8. delete the main table which done in step 1.&lt;br/&gt;
9. Now scan the new table again.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12831635">HBASE-13737</key>
            <summary>[HBase MOB] MOBTable cloned from a snapshot leads to data loss, when that actual snapshot and main table is deleted.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ashutosh_jindal">Ashutosh Jindal</assignee>
                                    <reporter username="sreenivasulureddy">Y. SREENIVASULU REDDY</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 May 2015 07:22:38 +0000</created>
                <updated>Wed, 22 Jul 2015 22:48:46 +0000</updated>
                            <resolved>Tue, 16 Jun 2015 09:36:04 +0000</resolved>
                                    <version>hbase-11339</version>
                                    <fixVersion>hbase-11339</fixVersion>
                                    <component>mob</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="14553961" author="anoop.hbase" created="Thu, 21 May 2015 09:25:12 +0000"  >&lt;p&gt;What about the non mob cf data?&lt;/p&gt;</comment>
                            <comment id="14554217" author="ashutosh_jindal" created="Thu, 21 May 2015 12:44:40 +0000"  >&lt;p&gt;Non mob data is intact.&lt;br/&gt;
As per initial analysis, the problem is in HFileLinkCleaner.isFileDeletable . Once we clone a snapshot, the data is moved to &quot;/hbase/archive/&quot; .HFileCleaner checks for back reference for all the files in &quot;/hbase/archive/&quot; dir but it checks for back references in rootDir i.e. /hbase. In case of MOB data, cleaner will not find it in rootDir and will delete the link. Here we need to check in for references in /hbase/mobdir also. &lt;/p&gt;</comment>
                            <comment id="14554222" author="anoop.hbase" created="Thu, 21 May 2015 12:48:50 +0000"  >&lt;p&gt;Ya I was thinking some thing of this sort might be the cause and that is why asked abt the normal CF data. Agree this is a critical bug in MOB snapshot feature.  Hope you guys will give patch. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14554278" author="ashutosh_jindal" created="Thu, 21 May 2015 13:39:42 +0000"  >&lt;p&gt;Attached a patch. Please review&lt;/p&gt;</comment>
                            <comment id="14554366" author="yuzhihong@gmail.com" created="Thu, 21 May 2015 14:38:57 +0000"  >&lt;p&gt;Is it possible to add a test in TestMobCloneSnapshotFromClient.java so that regression is prevented in the future ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="14581330" author="jingcheng.du@intel.com" created="Thu, 11 Jun 2015 01:44:36 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ashutosh_jindal&quot; class=&quot;user-hover&quot; rel=&quot;ashutosh_jindal&quot;&gt;Ashutosh Jindal&lt;/a&gt; for the patch.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;HFileLink.getHFileFromBackReference(MobUtils.getMobHome(getConf()), filePath);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For the MobUtils.getMobHome(getConf()), how about to move it to the constructor instead of getting it per invoking?&lt;br/&gt;
Besides, would you mind adding unit tests for this case? Thanks a lot.&lt;/p&gt;</comment>
                            <comment id="14583186" author="jingcheng.du@intel.com" created="Fri, 12 Jun 2015 09:31:30 +0000"  >&lt;p&gt;Alright, I&apos;ll supplement the unit test.&lt;/p&gt;</comment>
                            <comment id="14583190" author="jingcheng.du@intel.com" created="Fri, 12 Jun 2015 09:38:53 +0000"  >&lt;p&gt;Supplement unit test in patch (V2).&lt;br/&gt;
Hi guys, please help take a look. Thanks!&lt;/p&gt;</comment>
                            <comment id="14585607" author="jingcheng.du@intel.com" created="Mon, 15 Jun 2015 08:03:22 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuzhihong%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yuzhihong@gmail.com&quot;&gt;Ted Yu&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoopsamjohn&quot; class=&quot;user-hover&quot; rel=&quot;anoopsamjohn&quot;&gt;Anoop Sam John&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt;. Do you want to take a look at the new patch? Thanks.&lt;/p&gt;</comment>
                            <comment id="14587713" author="anoop.hbase" created="Tue, 16 Jun 2015 09:01:35 +0000"  >&lt;p&gt;+1&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt; Any chance for a review and +1?&lt;/p&gt;</comment>
                            <comment id="14587741" author="ram_krish" created="Tue, 16 Jun 2015 09:27:45 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14587755" author="anoop.hbase" created="Tue, 16 Jun 2015 09:36:04 +0000"  >&lt;p&gt;Thanks for the patch Ashutosh. Thanks for the test Jingcheng.&lt;/p&gt;</comment>
                            <comment id="14637830" author="hudson" created="Wed, 22 Jul 2015 22:48:46 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6672 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6672/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6672/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13737&quot; title=&quot;[HBase MOB] MOBTable cloned from a snapshot leads to data loss, when that actual snapshot and main table is deleted.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13737&quot;&gt;&lt;del&gt;HBASE-13737&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;HBase MOB&amp;#93;&lt;/span&gt; MOBTable cloned from a snapshot leads to data loss, when that actual snapshot and main table is deleted. (Ashutosh Jindal) (anoopsamjohn: rev 2e2742183fac824dcf19c556fdc8ae1da326ba7c)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/cleaner/HFileLinkCleaner.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/client/TestMobSnapshotCloneIndependence.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12739193" name="HBASE-13737-V2.diff" size="5497" author="jingcheng.du@intel.com" created="Fri, 12 Jun 2015 09:38:53 +0000"/>
                            <attachment id="12734455" name="HBASE-13737-hbase-11339.patch" size="1700" author="ashutosh_jindal" created="Thu, 21 May 2015 13:39:42 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 21 May 2015 09:25:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 21 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2f15j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>