<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:22:19 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4823/HBASE-4823.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4823] long running scans lose benefit of bloomfilters and timerange hints</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4823</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When you have a long running scan due to say an MR job, you can lose the benefit of timerange hints &amp;amp; bloom filters midway if your scanner gets reset. &lt;span class=&quot;error&quot;&gt;&amp;#91;Note: The scanners can get reset say due to a flush or compaction&amp;#93;&lt;/span&gt;.&lt;/p&gt;

&lt;p&gt;In one of our workloads, we periodically want to do rollups on recent 15 minutes of data in a column family... but the timerange hint benefit is lost midway when this resetScannerStack (shown below) happens. And end result-- we end up reading all the old HFiles rather than just the recent HFiles.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

 &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void resetScannerStack(KeyValue lastTopKey) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (heap != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RuntimeException(&lt;span class=&quot;code-quote&quot;&gt;&quot;StoreScanner.reseek run on an existing heap!&quot;&lt;/span&gt;);
    }

    /* When we have the scan object, should we not pass it to getScanners()
     * to get a limited set of scanners? We did so in the constructor and we
     * could have done it now by storing the scan object from the constructor */
    List&amp;lt;KeyValueScanner&amp;gt; scanners = getScanners();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The comment in the code seems to be aware of this issue and even has the suggested fix!&lt;/p&gt;</description>
                <environment></environment>
        <key id="12532030">HBASE-4823</key>
            <summary>long running scans lose benefit of bloomfilters and timerange hints</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="amitanand">Amitanand Aiyer</assignee>
                                    <reporter username="kannanm">Kannan Muthukkaruppan</reporter>
                        <labels>
                    </labels>
                <created>Sat, 19 Nov 2011 02:15:49 +0000</created>
                <updated>Wed, 16 May 2012 19:55:49 +0000</updated>
                            <resolved>Wed, 16 May 2012 19:55:49 +0000</resolved>
                                                    <fixVersion>0.89-fb</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13153655" author="khemani" created="Sun, 20 Nov 2011 03:14:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3415&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-3415&lt;/a&gt; is also related&lt;/p&gt;</comment>
                            <comment id="13154374" author="kannanm" created="Mon, 21 Nov 2011 19:11:13 +0000"  >&lt;p&gt;Amitanand will be helping on this issue.&lt;/p&gt;</comment>
                            <comment id="13154900" author="kannanm" created="Tue, 22 Nov 2011 06:05:09 +0000"  >&lt;p&gt;Unit test demonstrating inefficiency that creeps in if say a flush were to happen in the middle of a scan. &lt;span class=&quot;error&quot;&gt;&amp;#91;I wrote the test wrt to 0.89-fb branch, but should more or less be reproducible against trunk as well.&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13156132" author="phabricator@reviews.facebook.net" created="Wed, 23 Nov 2011 18:59:39 +0000"  >&lt;p&gt;aaiyer requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4823&quot; title=&quot;long running scans lose benefit of bloomfilters and timerange hints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4823&quot;&gt;&lt;del&gt;HBASE-4823&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; long running scans lose benefit of bloomfilters and timerange hints&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  Changes to the StoreScanner so that whenever we do a resetScannerStack&lt;br/&gt;
  we use the same getScanner() method as done in the constructor to ignore&lt;br/&gt;
  files that are not going to be touched by the scan.&lt;/p&gt;

&lt;p&gt;  Includes a test to ensure correctness.&lt;/p&gt;

&lt;p&gt;  When you have a long running scan due to say an MR job, you can lose the benefit of timerange hints &amp;amp; bloom filters midway if your scanner gets reset. &amp;lt;span class=&quot;error&quot;&amp;gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;Note: The scanners can get reset say due to a flush or compaction&amp;#93;&lt;/span&gt;&amp;lt;/span&amp;gt;.&lt;/p&gt;

&lt;p&gt;  In one of our workloads, we periodically want to do rollups on recent 15 minutes of data in a column family... but the timerange hint benefit is lost midway when this resetScannerStack (shown below) happens. And end result-- we end up reading all the old HFiles rather than just the recent HFiles.   &amp;lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&amp;gt;&amp;lt;div class=&quot;codeContent panelContent&quot;&amp;gt; &amp;lt;pre class=&quot;code-java&quot;&amp;gt;&amp;lt;span class=&quot;code-keyword&quot;&amp;gt;private&amp;lt;/span&amp;gt; void resetScannerStack(KeyValue lastTopKey) &amp;lt;span class=&quot;code-keyword&quot;&amp;gt;throws&amp;lt;/span&amp;gt; IOException {     &amp;lt;span class=&quot;code-keyword&quot;&amp;gt;if&amp;lt;/span&amp;gt; (heap != &amp;lt;span class=&quot;code-keyword&quot;&amp;gt;null&amp;lt;/span&amp;gt;) &lt;/p&gt;
{       &amp;lt;span class=&quot;code-keyword&quot;&amp;gt;throw&amp;lt;/span&amp;gt; &amp;lt;span class=&quot;code-keyword&quot;&amp;gt;new&amp;lt;/span&amp;gt; RuntimeException(&amp;lt;span class=&quot;code-quote&quot;&amp;gt;&quot;StoreScanner.reseek run on an existing heap!&quot;&amp;lt;/span&amp;gt;);     }
&lt;p&gt;      /* When we have the scan object, should we not pass it to getScanners()      * to get a limited set of scanners? We did so in the constructor and we &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;could have done it now by storing the scan object from the constructor */     List&amp;lt;KeyValueScanner&amp;gt; scanners = getScanners();&amp;lt;/pre&amp;gt; &amp;lt;/div&amp;gt;&amp;lt;/div&amp;gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  The comment in the code seems to be aware of this issue and even has the suggested fix!&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  EMPTY&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D519&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D519&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestScannerResets.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/1149/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/1149/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tip: use the X-Herald-Rules header to filter Herald messages in your client.&lt;/p&gt;</comment>
                            <comment id="13156204" author="phabricator@reviews.facebook.net" created="Wed, 23 Nov 2011 19:19:39 +0000"  >&lt;p&gt;Kannan has accepted the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4823&quot; title=&quot;long running scans lose benefit of bloomfilters and timerange hints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4823&quot;&gt;&lt;del&gt;HBASE-4823&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; long running scans lose benefit of bloomfilters and timerange hints&quot;.&lt;/p&gt;

&lt;p&gt;  Super!&lt;/p&gt;

&lt;p&gt;  +1 for commit.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D519&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D519&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13157975" author="phabricator@reviews.facebook.net" created="Sun, 27 Nov 2011 19:33:39 +0000"  >&lt;p&gt;khemani has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4823&quot; title=&quot;long running scans lose benefit of bloomfilters and timerange hints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4823&quot;&gt;&lt;del&gt;HBASE-4823&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; long running scans lose benefit of bloomfilters and timerange hints&quot;.&lt;/p&gt;

&lt;p&gt;  +1&lt;/p&gt;

&lt;p&gt;  looks good. This same change should also apply to trunk even though it has filesonly and memstote-only scans.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D519&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D519&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13158105" author="phabricator@reviews.facebook.net" created="Mon, 28 Nov 2011 00:04:40 +0000"  >&lt;p&gt;lhofhansl has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4823&quot; title=&quot;long running scans lose benefit of bloomfilters and timerange hints&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4823&quot;&gt;&lt;del&gt;HBASE-4823&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; long running scans lose benefit of bloomfilters and timerange hints&quot;.&lt;/p&gt;

&lt;p&gt;  +1 lgtm&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestScannerResets.java:1 Wanna add a Copyright notice?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D519&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D519&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12504908" name="ASF.LICENSE.NOT.GRANTED--HBASE-4823.D519.1.patch" size="9773" author="phabricator@reviews.facebook.net" created="Wed, 23 Nov 2011 18:59:40 +0000"/>
                            <attachment id="12504705" name="TestScannerResets-89fb.txt" size="7072" author="kannanm" created="Tue, 22 Nov 2011 06:05:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 20 Nov 2011 03:14:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>217766</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 3 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i015xj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4730</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>