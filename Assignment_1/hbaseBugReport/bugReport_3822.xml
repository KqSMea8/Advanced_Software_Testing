<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:13:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3822/HBASE-3822.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3822] region server stuck in waitOnAllRegionsToClose</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3822</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The regionserver is not able to exit because the rs thread is stuck here&lt;/p&gt;



&lt;p&gt;&quot;regionserver60020&quot; prio=10 tid=0x00002ab2b039e000 nid=0x760a waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x000000004365e000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: TIMED_WAITING (sleeping)&lt;br/&gt;
        at java.lang.Thread.sleep(Native Method)&lt;br/&gt;
        at org.apache.hadoop.hbase.util.Threads.sleep(Threads.java:126)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.waitOnAllRegionsToClose(HRegionServer.java:736)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:689)&lt;br/&gt;
        at java.lang.Thread.run(Thread.java:619)&lt;/p&gt;


&lt;p&gt;===&lt;/p&gt;

&lt;p&gt;In CloseRegionHandler.process() we do not call removeFromOnlineRegions() if there is an exception. (In this case I suspect there was a log-rolling exception because of another issue)&lt;/p&gt;

&lt;p&gt;    // Close the region&lt;br/&gt;
    try {&lt;br/&gt;
      // TODO: If we need to keep updating CLOSING stamp to prevent against&lt;br/&gt;
      // a timeout if this is long-running, need to spin up a thread?&lt;br/&gt;
      if (region.close(abort) == null) &lt;/p&gt;
{
        // This region got closed.  Most likely due to a split. So instead
        // of doing the setClosedState() below, let&apos;s just ignore and continue.
        // The split message will clean up the master state.
        LOG.warn(&quot;Can&apos;t close region: was already closed during close(): &quot; +
          regionInfo.getRegionNameAsString());
        return;
      }
&lt;p&gt;    } catch (IOException e) &lt;/p&gt;
{
      LOG.error(&quot;Unrecoverable exception while closing region &quot; +
        regionInfo.getRegionNameAsString() + &quot;, still finishing close&quot;, e);
    }

&lt;p&gt;    this.rsServices.removeFromOnlineRegions(regionInfo.getEncodedName());&lt;/p&gt;


&lt;p&gt;===&lt;/p&gt;

&lt;p&gt;I think we set the closing flag on the region, it won&apos;t be taking any more requests, it is as good as offline.&lt;/p&gt;

&lt;p&gt;Either we should refine the check in waitOnAllRegionsToClose() or CloseRegionHandler.process() should remove the region from online-regions set.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12505225">HBASE-3822</key>
            <summary>region server stuck in waitOnAllRegionsToClose</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="khemani">Prakash Khemani</reporter>
                        <labels>
                    </labels>
                <created>Tue, 26 Apr 2011 18:16:45 +0000</created>
                <updated>Thu, 28 Apr 2011 23:30:45 +0000</updated>
                            <resolved>Thu, 28 Apr 2011 23:30:45 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13025443" author="khemani" created="Tue, 26 Apr 2011 21:26:01 +0000"  >&lt;p&gt;The code snippet that I pointed out doesn&apos;t have a problem - that piece of code will remove the region from online regions even if there is an exception. Sorry for the confusion. I don&apos;t really know why the onlineRegions set was not cleaned up.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27043</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 34 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ho27:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101160</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>The description is invalid. Will open a new one.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>