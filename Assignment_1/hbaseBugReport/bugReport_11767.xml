<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:26:25 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11767/HBASE-11767.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11767] [0.94] Unnecessary garbage produced by schema metrics during scanning</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11767</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Near the end of StoreScanner.next(...) we find this gem:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cumulativeMetric &amp;gt; 0 &amp;amp;&amp;amp; metric != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        RegionMetricsStorage.incrNumericMetric(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.metricNamePrefix + metric,
            cumulativeMetric);
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, for each row generated we build up a new metric string, that will be identical for each invocation of the StoreScanner anyway (a store scanner is valid for at most one region and one operation).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12734577">HBASE-11767</key>
            <summary>[0.94] Unnecessary garbage produced by schema metrics during scanning</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Sat, 16 Aug 2014 07:23:56 +0000</created>
                <updated>Tue, 9 Sep 2014 04:19:31 +0000</updated>
                            <resolved>Sun, 17 Aug 2014 04:52:40 +0000</resolved>
                                                    <fixVersion>0.94.23</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14099540" author="lhofhansl" created="Sat, 16 Aug 2014 07:28:54 +0000"  >&lt;p&gt;Not pretty (because I cannot change the API in 0.94).&lt;/p&gt;

&lt;p&gt;Exploits the fact that we pass &lt;tt&gt;SchemaMetrics.METRIC_NEXTSIZE&lt;/tt&gt; through the layers and hence uses identify to check that and then prebuild the metric name for the duration of the scanner.&lt;/p&gt;</comment>
                            <comment id="14099543" author="mbertozzi" created="Sat, 16 Aug 2014 07:30:56 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14099547" author="lhofhansl" created="Sat, 16 Aug 2014 07:38:34 +0000"  >&lt;p&gt;Verified that String/StringBuilder/Char[] are no longer created per row... Saving a whooping 520MB of garbage in my 20m row scan test.&lt;br/&gt;
(With the recommended young gen sizes for HBase - around 256mb - this save two entire young collections.)&lt;/p&gt;</comment>
                            <comment id="14099880" author="lhofhansl" created="Sun, 17 Aug 2014 04:52:40 +0000"  >&lt;p&gt;Committed to 0.94.&lt;br/&gt;
Thanks for having a look &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14099881" author="lhofhansl" created="Sun, 17 Aug 2014 04:55:54 +0000"  >&lt;p&gt;Some more stats. The creates 5 unneeded objects per row. The char[] array created under the hood (because the Stringbuilder has to be resized) is that &lt;b&gt;largest&lt;/b&gt; source of garbage during scanning. This patch removes that completely.&lt;/p&gt;</comment>
                            <comment id="14099889" author="hudson" created="Sun, 17 Aug 2014 06:17:51 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-JDK7 #171 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-JDK7/171/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-JDK7/171/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11767&quot; title=&quot;[0.94] Unnecessary garbage produced by schema metrics during scanning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11767&quot;&gt;&lt;del&gt;HBASE-11767&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;0.94&amp;#93;&lt;/span&gt; Unnecessary garbage produced by schema metrics during scanning. (larsh: rev 0ea4b86b07b32d46b23f4f35de032370d64dd021)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14099890" author="hudson" created="Sun, 17 Aug 2014 06:18:45 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94 #1402 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1402/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1402/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11767&quot; title=&quot;[0.94] Unnecessary garbage produced by schema metrics during scanning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11767&quot;&gt;&lt;del&gt;HBASE-11767&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;0.94&amp;#93;&lt;/span&gt; Unnecessary garbage produced by schema metrics during scanning. (larsh: rev 0ea4b86b07b32d46b23f4f35de032370d64dd021)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14099892" author="hudson" created="Sun, 17 Aug 2014 06:27:54 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-security #512 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/512/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/512/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11767&quot; title=&quot;[0.94] Unnecessary garbage produced by schema metrics during scanning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11767&quot;&gt;&lt;del&gt;HBASE-11767&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;0.94&amp;#93;&lt;/span&gt; Unnecessary garbage produced by schema metrics during scanning. (larsh: rev 0ea4b86b07b32d46b23f4f35de032370d64dd021)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
	&lt;li&gt;src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12662247" name="11767.txt" size="2561" author="lhofhansl" created="Sat, 16 Aug 2014 07:28:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 16 Aug 2014 07:30:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412517</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 17 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yyrj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412504</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>