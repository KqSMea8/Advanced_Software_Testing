<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:25:51 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5222/HBASE-5222.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5222] Stopping replication via the &quot;stop_replication&quot; command in hbase shell on a slave cluster isn&apos;t acknowledged in the replication sink</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5222</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;After running &quot;stop_replication&quot; in the hbase shell on our slave cluster we saw replication continue for weeks. Turns out that the replication sink is missing a check to get the replication state and therefore continued to write.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12538704">HBASE-5222</key>
            <summary>Stopping replication via the &quot;stop_replication&quot; command in hbase shell on a slave cluster isn&apos;t acknowledged in the replication sink</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jbwyme">Josh Wymer</reporter>
                        <labels>
                    </labels>
                <created>Tue, 17 Jan 2012 22:20:17 +0000</created>
                <updated>Mon, 15 Aug 2016 18:43:01 +0000</updated>
                            <resolved>Tue, 1 Apr 2014 00:41:20 +0000</resolved>
                                    <version>0.90.4</version>
                                                    <component>Replication</component>
                    <component>shell</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13235331" author="v.himanshu" created="Thu, 22 Mar 2012 04:19:58 +0000"  >&lt;p&gt;Shouldn&apos;t this command be run on the master cluster instead?&lt;/p&gt;</comment>
                            <comment id="13235795" author="jdcryans" created="Thu, 22 Mar 2012 17:48:07 +0000"  >&lt;p&gt;&lt;tt&gt;stop_replication&lt;/tt&gt; is a kill switch that should normally kill everything that&apos;s related to replication. In this case, it&apos;s not stopping the region servers from accepting incoming replication traffic.&lt;/p&gt;</comment>
                            <comment id="13236639" author="v.himanshu" created="Fri, 23 Mar 2012 14:48:07 +0000"  >&lt;p&gt;@JD: When you want to use replication, you ought to run these commands (plus setting replication hbase.replication to true in the hase-config.xml) on the master cluster. The slave cluster configs is not changed (in case of simple Master-slave replication). &lt;br/&gt;
So, in case when hbase.replication is false (or default) on the slave, its replication specific code will be null, and make these commands non-effective; no?&lt;/p&gt;</comment>
                            <comment id="13236692" author="jbwyme" created="Fri, 23 Mar 2012 15:44:36 +0000"  >&lt;p&gt;@HV, @JD: Please correct me if I&apos;m wrong here. If you stop replication on the master, the logs are no longer stored to be pushed down stream like they would with replication enabled. Instead they would be cleaned up based on the default timeout. If we need to stop replicating to a slave cluster for maintenance, etc we don&apos;t want the master throwing away non-replicated logs (thinking it has no need to keep them). The bug, however, causes the slave to keep accepting logs even while disabled although the other processes on slave cluster respect the disabled flag.&lt;/p&gt;</comment>
                            <comment id="13236742" author="v.himanshu" created="Fri, 23 Mar 2012 16:27:23 +0000"  >&lt;p&gt;@Josh: In case you want to do some maintenance on the slave cluster, while you do want to resume the replication once it is restored, you don&apos;t need to pull the stop trigger. The master cluster RS see that they can&apos;t connect to the slave cluster&apos;s RS anymore and will keep on waiting till they are up (sleeping/awaking loop). &lt;br/&gt;
But in case you are also stopping the slave cluster&apos;s ZK, then you might have to remove/add it again. As the Master cluster just stops caring about it then.&lt;/p&gt;

&lt;p&gt;There is also a jira in the upstream in which you can enable/disable a particular peer (HBase-3143). &lt;br/&gt;
So, afaik, running commands on the slave cluster are futile as its the master  cluster which does all the work. &lt;/p&gt;

&lt;p&gt;PS: This is based on &quot;few days using plus 1 day code digging (yesterday&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&quot; experience. So, let&apos;s see what JD says.&lt;/p&gt;</comment>
                            <comment id="13236767" author="jdcryans" created="Fri, 23 Mar 2012 16:46:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;So, let&apos;s see what JD says.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Here he goes:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;When you want to use replication, you ought to run these commands&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not sure which commands you&apos;re talking about. In the specific case of &lt;tt&gt;stop_replication&lt;/tt&gt;, it&apos;s a kill switch in the proper sense (quote from wikipedia):&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;a kill switch is designed and configured to a) completely abort the operation at all costs and b) be operable in a manner that is quick, simple (so that even a panicking user with impaired executive function can operate it), and, usually, c) be obvious even to an untrained operator or a bystander&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We hit on a) and b), the c) part might not be there yet. The issue here is that the command is respected on the master cluster (when ran there) but not on the slave cluster (when ran there).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If you stop replication on the master, the logs are no longer stored to be pushed down stream like they would with replication enabled.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The bug, however, causes the slave to keep accepting logs even while disabled although the other processes on slave cluster respect the disabled flag&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Since it&apos;s a kill switch, what&apos;s going to happen is the slave cluster is going to &lt;b&gt;drop the log edits&lt;/b&gt;. This is not what you want, you want is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3134&quot; title=&quot;[replication] Add the ability to enable/disable streams&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3134&quot;&gt;&lt;del&gt;HBASE-3134&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;So, afaik, running commands on the slave cluster are futile as its the master cluster which does all the work.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think you understand the issue here reasonably well, and indeed most of the commands won&apos;t do anything on the slave cluster, except here the kill switch should stop all replication-related activity including applying incoming logs.&lt;/p&gt;</comment>
                            <comment id="13955949" author="jdcryans" created="Tue, 1 Apr 2014 00:41:20 +0000"  >&lt;p&gt;The kill switch was completely removed, closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12656084">HBASE-8861</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 Mar 2012 04:19:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224207</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 37 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02cfb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11614</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>