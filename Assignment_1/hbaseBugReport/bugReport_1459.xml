<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:53:40 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1459/HBASE-1459.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1459] CME during memcache flush forces HRS shutdown</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1459</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I just saw this on my 0.19.1 cluster:&lt;/p&gt;

&lt;p&gt;2009-05-30 03:57:19,559 FATAL org.apache.hadoop.hbase.regionserver.MemcacheFlusher: Replay of hlog required. Forcing server shutdown&lt;br/&gt;
org.apache.hadoop.hbase.DroppedSnapshotException: region: table,rowkey,1243547152622&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:897)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:790)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.flushRegion(MemcacheFlusher.java:228)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.run(MemcacheFlusher.java:138)&lt;br/&gt;
Caused by: java.util.ConcurrentModificationException&lt;br/&gt;
    at java.util.TreeMap$PrivateEntryIterator.nextEntry(TreeMap.java:1100)&lt;br/&gt;
    at java.util.TreeMap$EntryIterator.next(TreeMap.java:1136)&lt;br/&gt;
    at java.util.TreeMap$EntryIterator.next(TreeMap.java:1131)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HStore.internalFlushCache(HStore.java:678)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:636)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:882)&lt;br/&gt;
    ... 3 more&lt;/p&gt;</description>
                <environment></environment>
        <key id="12426738">HBASE-1459</key>
            <summary>CME during memcache flush forces HRS shutdown</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="rafan">Rong-En Fan</reporter>
                        <labels>
                    </labels>
                <created>Sat, 30 May 2009 15:14:18 +0000</created>
                <updated>Thu, 5 May 2011 07:11:25 +0000</updated>
                            <resolved>Thu, 5 May 2011 07:11:25 +0000</resolved>
                                    <version>0.19.1</version>
                                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12714744" author="stack" created="Sat, 30 May 2009 16:59:48 +0000"  >&lt;p&gt;This should never happen (smile).  We&apos;re iterating a memcache but it should be offlined when we are here; other threads should not be inserting.  This issue we won&apos;t see in TRUNK because memcache is different type now (skiplistset).&lt;/p&gt;</comment>
                            <comment id="12714899" author="stack" created="Sun, 31 May 2009 16:48:20 +0000"  >&lt;p&gt;Does this happen often Rong-en?&lt;/p&gt;</comment>
                            <comment id="12714903" author="rafan" created="Sun, 31 May 2009 17:18:44 +0000"  >&lt;p&gt;Nope, it&apos;s the first time I saw on this 0.19.1 instance (for two months)&lt;/p&gt;</comment>
                            <comment id="12715285" author="stack" created="Mon, 1 Jun 2009 22:29:27 +0000"  >&lt;p&gt;Rong-en:  Looking at this one, its an odd one.  Its saying that the snapshot is being modified while we&apos;re flushing.  The memcache makes a snapshot when it moves current memcache aside replacing it with a new one.  Until the snapshot is successfully flushed, its read-only.  Somehow a write is going into the snapshot.  Should never happen.  Can I have logs from around the above exception if you still have them.&lt;/p&gt;

&lt;p&gt;Mind if I move this out of 0.19.4?  It looks rare and its not going to happen in 0.20.0 because the memcache datastructure now can be iterated without throwing CME.  Thanks Rong-en.&lt;/p&gt;</comment>
                            <comment id="12715335" author="rafan" created="Tue, 2 Jun 2009 02:17:10 +0000"  >&lt;p&gt;stack, here you go, and I&apos;m ok to move out this from 0.19.4.&lt;/p&gt;

&lt;p&gt;2009-05-30 03:47:52,079 INFO org.apache.hadoop.hbase.regionserver.HLog: Closed hdfs://nn:8020/hbase/log_x.x.x.x_1243602404362_60020/hlog.dat.1243625003085, entries=100001. New log writer: /hbase/log_x.x.x.x_1243602404362_60020/hlog.dat.1243626472077&lt;br/&gt;
2009-05-30 03:57:19,559 FATAL org.apache.hadoop.hbase.regionserver.MemcacheFlusher: Replay of hlog required. Forcing server shutdown&lt;br/&gt;
org.apache.hadoop.hbase.DroppedSnapshotException: region: table,row,1243547152622&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.j ava:897)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:790)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.flushRegion(MemcacheFlusher.java:228)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.run(MemcacheFlusher.java:138)Caused&lt;br/&gt;
by: java.util.ConcurrentModificationException    &lt;br/&gt;
    at java.util.TreeMap$PrivateEntryIterator.nextEntry(TreeMap.java:1100)&lt;br/&gt;
    at java.util.TreeMap$EntryIterator.next(TreeMap.java:1136)    &lt;br/&gt;
    at java.util.TreeMap$EntryIterator.next(TreeMap.java:1131)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HStore.internalFlushCache(HStore.java:678)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:636)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:882)&lt;br/&gt;
    ... 3 more&lt;br/&gt;
2009-05-30 03:57:19,572 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server handler 12 on 60020, call batchUpdates([B@4051c386, [Lorg.apache.hadoop.hbase.io.BatchUpdate;@37fbb367) from x.x.x.y:37001: error: java.io.IOException: Server not running, aborting&lt;br/&gt;
java.io.IOException: Server not running, aborting&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegionServer.checkOpen(HRegionServer.java:2109)&lt;br/&gt;
    at org.apache.hadoop.hbase.regionserver.HRegionServer.batchUpdates(HRegionServer.java:1618)&lt;br/&gt;
    at sun.reflect.GeneratedMethodAccessor8.invoke(Unknown Source)&lt;br/&gt;
    at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
    at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
    at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:632)&lt;br/&gt;
    at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:912)&lt;/p&gt;</comment>
                            <comment id="12715362" author="stack" created="Tue, 2 Jun 2009 04:13:30 +0000"  >&lt;p&gt;I was hoping there&apos;d be a clue in the log but doesn&apos;t seem to be.  All seems normal.  Oh well.  I&apos;ll move it to 0.19.5 (smile).  I&apos;ll roll a 0.19.4 with the meta/root fixes.  Thats important.&lt;/p&gt;

&lt;p&gt;Thanks Rong-en.&lt;/p&gt;
</comment>
                            <comment id="12715366" author="rafan" created="Tue, 2 Jun 2009 04:33:21 +0000"  >&lt;p&gt;move to 0.19.5 and remove 0.20.0 as it&apos;s not an issue there.&lt;/p&gt;</comment>
                            <comment id="12717549" author="rafan" created="Tue, 9 Jun 2009 04:14:19 +0000"  >&lt;p&gt;just saw it on latest 0.19 branch on a single-box&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-06-08 13:31:30,832 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Flush requested on table,,1244366951415
2009-06-08 13:31:30,937 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Started memcache flush &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region table,,1244366951415. Current region memcache size 64.0m
[... Memcache: blahblahb: expired or in deletes, skipped ...]
2009-06-08 13:31:35,261 FATAL org.apache.hadoop.hbase.regionserver.MemcacheFlusher: Replay of hlog required. Forcing server shutdown
org.apache.hadoop.hbase.DroppedSnapshotException: region: table,,1244366951415
    at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:903)
    at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:796)
    at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.flushRegion(MemcacheFlusher.java:265)
    at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.run(MemcacheFlusher.java:148)
Caused by: java.util.ConcurrentModificationException
    at java.util.TreeMap$PrivateEntryIterator.nextEntry(TreeMap.java:1100)
    at java.util.TreeMap$EntryIterator.next(TreeMap.java:1136)
    at java.util.TreeMap$EntryIterator.next(TreeMap.java:1131)
    at org.apache.hadoop.hbase.regionserver.HStore.internalFlushCache(HStore.java:678)
    at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:636)
    at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:888)
    at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:796)
    at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.flushRegion(MemcacheFlusher.java:265)
    at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.run(MemcacheFlusher.java:148)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12717658" author="rafan" created="Tue, 9 Jun 2009 12:05:29 +0000"  >&lt;p&gt;I keep seeing this on a 1 master + 3 HRS setup w/ latest rev from branch-0.19. Good news is w/ 0.19.4 my cluster recovered after 15~20 mins. Let me dig into Memcache implementation to see if I can smell something...&lt;/p&gt;</comment>
                            <comment id="12717702" author="rafan" created="Tue, 9 Jun 2009 15:04:33 +0000"  >&lt;p&gt;Now I recall after a change in my client on May 27, I started to see this. I was seeing more today because I was pushing harder from client.&lt;/p&gt;

&lt;p&gt;The client did something like this:&lt;/p&gt;

&lt;p&gt;HTable.deleteAll(rowKey)&lt;br/&gt;
HTable.commit(BatchUpdate(rowKey, /data/))&lt;/p&gt;

&lt;p&gt;in a very frequent way (many times per seconds). I was trying to clear out previous data because not every col may be overwritten when commit() is called.&lt;/p&gt;

&lt;p&gt;Hope this helps.&lt;/p&gt;</comment>
                            <comment id="13029209" author="stack" created="Thu, 5 May 2011 07:11:25 +0000"  >&lt;p&gt;stale&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 30 May 2009 16:59:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25763</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 33 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hddr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99430</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>