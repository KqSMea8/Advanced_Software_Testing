<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:36:19 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6389/HBASE-6389.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6389] Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6389</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Continuing from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6375&quot; title=&quot;Master may be using a stale list of region servers for creating assignment plan during startup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6375&quot;&gt;&lt;del&gt;HBASE-6375&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;It seems I was mistaken in my assumption that changing the value of &quot;hbase.master.wait.on.regionservers.mintostart&quot; to a sufficient number (from default of 1) can help prevent assignment of all regions to one (or a small number of) region server(s).&lt;/p&gt;

&lt;p&gt;While this was the case in 0.90.x and 0.92.x, the behavior has changed in 0.94.0 onwards to address &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4993&quot; title=&quot;Performance regression in minicluster creation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4993&quot;&gt;&lt;del&gt;HBASE-4993&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;From 0.94.0 onwards, Master will proceed immediately after the timeout has lapsed, even if &quot;hbase.master.wait.on.regionservers.mintostart&quot; has not reached.&lt;/p&gt;

&lt;p&gt;Reading the current conditions of waitForRegionServers() clarifies it&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;ServerManager.java (trunk rev:1360470)&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
....
581	  /**
582	   * Wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the region servers to report in.
583	   * We will wait until one of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; condition is met:
584	   *  - the master is stopped
585	   *  - the &apos;hbase.master.wait.on.regionservers.timeout&apos; is reached
586	   *  - the &apos;hbase.master.wait.on.regionservers.maxtostart&apos; number of
587	   *    region servers is reached
588	   *  - the &apos;hbase.master.wait.on.regionservers.mintostart&apos; is reached AND
589	   *   there have been no &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; region server in &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
590	   *      &apos;hbase.master.wait.on.regionservers.interval&apos; time
591	   *
592	   * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException
593	   */
594	  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void waitForRegionServers(MonitoredTask status)
595	  &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException {
....
....
612	    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (
613	      !&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.isStopped() &amp;amp;&amp;amp;
614	        slept &amp;lt; timeout &amp;amp;&amp;amp;
615	        count &amp;lt; maxToStart &amp;amp;&amp;amp;
616	        (lastCountChange+interval &amp;gt; now || count &amp;lt; minToStart)
617	      ){
....
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So with the current conditions, the wait will end as soon as timeout is reached even lesser number of RS have checked-in with the Master and the master will proceed with the region assignment among these RSes alone.&lt;/p&gt;

&lt;p&gt;As mentioned in &lt;del&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4993?focusedCommentId=13237196#comment-13237196&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;HBASE-4993&lt;/a&gt;&lt;/del&gt;, and I concur, this could have disastrous effect in large cluster especially now that MSLAB is turned on.&lt;/p&gt;

&lt;p&gt;To enforce the required quorum as specified by &quot;hbase.master.wait.on.regionservers.mintostart&quot; irrespective of timeout, these conditions need to be modified as following&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;ServerManager.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
..
  /**
   * Wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the region servers to report in.
   * We will wait until one of &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; condition is met:
   *  - the master is stopped
   *  - the &apos;hbase.master.wait.on.regionservers.maxtostart&apos; number of
   *    region servers is reached
   *  - the &apos;hbase.master.wait.on.regionservers.mintostart&apos; is reached AND
   *   there have been no &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; region server in &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
   *      &apos;hbase.master.wait.on.regionservers.interval&apos; time AND
   *   the &apos;hbase.master.wait.on.regionservers.timeout&apos; is reached
   *
   * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException
   */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void waitForRegionServers(MonitoredTask status)
..
..
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; minToStart = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.getConfiguration().
    getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.master.wait.on.regionservers.mintostart&quot;&lt;/span&gt;, 1);
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; maxToStart = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.getConfiguration().
    getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.master.wait.on.regionservers.maxtostart&quot;&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.MAX_VALUE);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (maxToStart &amp;lt; minToStart) {
      maxToStart = minToStart;
    }
..
..
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (
      !&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.isStopped() &amp;amp;&amp;amp;
        count &amp;lt; maxToStart &amp;amp;&amp;amp;
        (lastCountChange+interval &amp;gt; now || timeout &amp;gt; slept || count &amp;lt; minToStart)
      ){
..
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12598653">HBASE-6389</key>
            <summary>Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="adityakishore">Aditya Kishore</assignee>
                                    <reporter username="adityakishore">Aditya Kishore</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Jul 2012 01:05:08 +0000</created>
                <updated>Tue, 26 Feb 2013 08:20:54 +0000</updated>
                            <resolved>Sat, 3 Nov 2012 22:56:03 +0000</resolved>
                                    <version>0.94.0</version>
                    <version>0.95.2</version>
                                    <fixVersion>0.94.3</fixVersion>
                    <fixVersion>0.95.0</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="13413406" author="adityakishore" created="Fri, 13 Jul 2012 01:09:14 +0000"  >&lt;p&gt;With the changed condition, Master will wait until one of the following conditions is met&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The master is stopped.&lt;/li&gt;
	&lt;li&gt;The &apos;hbase.master.wait.on.regionservers.maxtostart&apos; number of region servers is reached.&lt;/li&gt;
	&lt;li&gt;The &apos;hbase.master.wait.on.regionservers.mintostart&apos; is reached&lt;br/&gt;
   AND&lt;br/&gt;
  No new region server checks-in for &apos;hbase.master.wait.on.regionservers.interval&apos; time.&lt;br/&gt;
   AND&lt;br/&gt;
  The &apos;hbase.master.wait.on.regionservers.timeout&apos; is reached.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="13413408" author="adityakishore" created="Fri, 13 Jul 2012 01:15:04 +0000"  >&lt;p&gt;Patch for trunk.&lt;/p&gt;</comment>
                            <comment id="13413410" author="lhofhansl" created="Fri, 13 Jul 2012 01:16:03 +0000"  >&lt;p&gt;I&apos;ll hold 0.94.1 for this.&lt;/p&gt;</comment>
                            <comment id="13413411" author="adityakishore" created="Fri, 13 Jul 2012 01:17:37 +0000"  >&lt;p&gt;Apart from the main issue, this patch ensures &quot;maxToStart &amp;gt;= minToStart&quot; in case of incorrect configuration.&lt;/p&gt;</comment>
                            <comment id="13413425" author="adityakishore" created="Fri, 13 Jul 2012 01:51:34 +0000"  >&lt;p&gt;Also, please note that &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4993&quot; title=&quot;Performance regression in minicluster creation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4993&quot;&gt;&lt;del&gt;HBASE-4993&lt;/del&gt;&lt;/a&gt; has been addressed by the &lt;a href=&quot;http://svn.apache.org/viewvc/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java?r1=1212688&amp;amp;r2=1214419&amp;amp;diff_format=h&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;other change&lt;/a&gt; alone by setting maxToStart = minToStart before launching the mini cluster. So this change does not undo &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4993&quot; title=&quot;Performance regression in minicluster creation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4993&quot;&gt;&lt;del&gt;HBASE-4993&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13413439" author="lhofhansl" created="Fri, 13 Jul 2012 02:33:04 +0000"  >&lt;p&gt;+1 on patch. I&apos;d add a warning (or at least an info) if maxToStart &amp;lt; minToStart.&lt;br/&gt;
Man, it&apos;s hard to wrap the head around this logic and ensure it&apos;s correct.&lt;/p&gt;</comment>
                            <comment id="13413441" author="zhihyu@ebaysf.com" created="Fri, 13 Jul 2012 02:42:44 +0000"  >&lt;p&gt;Several variables are no longer final but I only see this extra assignment:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        maxToStart = minToStart;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It would be nice to keep other variables final.&lt;/p&gt;</comment>
                            <comment id="13413449" author="adityakishore" created="Fri, 13 Jul 2012 02:52:51 +0000"  >&lt;p&gt;Modified patch.&lt;/p&gt;</comment>
                            <comment id="13413461" author="hadoopqa" created="Fri, 13 Jul 2012 03:31:02 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12536317/HBASE-6389_trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12536317/HBASE-6389_trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 8 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestMasterFailover&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2377//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2377//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2377//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2377//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2377//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2377//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2377//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2377//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13413467" author="adityakishore" created="Fri, 13 Jul 2012 03:54:27 +0000"  >&lt;p&gt;The test failure is related to this patch, I am looking into this.&lt;/p&gt;</comment>
                            <comment id="13413482" author="hadoopqa" created="Fri, 13 Jul 2012 04:16:47 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12536324/HBASE-6389_trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12536324/HBASE-6389_trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 8 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestMasterFailover&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2379//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2379//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2379//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2379//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2379//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2379//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2379//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2379//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13413559" author="nkeywal" created="Fri, 13 Jul 2012 07:47:37 +0000"  >&lt;p&gt;We could remove the timeout? That would make things a little simpler.&lt;br/&gt;
Or we could keep it as an error case, and throw an exception if the timeout is reached. The intend would be to stop the master.&lt;/p&gt;</comment>
                            <comment id="13414031" author="adityakishore" created="Fri, 13 Jul 2012 20:40:27 +0000"  >&lt;p&gt;I like the idea of treating timeout as error case and if we do decide on that, two things need to be taken care of.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The current default timeout of 4.5 sec may not be appropriate and may require upward revision (to the tune of few minutes), and&lt;/li&gt;
	&lt;li&gt;The master would need to do a cluster shutdown including other standby masters, otherwise each standby master may continue after the previous one has given up. In the worst case scenario of this case, if somehow &apos;minToStart&apos; number of RSes join the last master, the cluster may be left with no standby master.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;For this JIRA, I would like to revert to the original behavior (until 0.92) of Master of waiting for &apos;minToStart&apos; number of RSes.&lt;/p&gt;</comment>
                            <comment id="13414042" author="adityakishore" created="Fri, 13 Jul 2012 20:53:09 +0000"  >&lt;p&gt;The test failure were result of masked error in test code which this change brought out.&lt;/p&gt;

&lt;p&gt;There were two such errors.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;The function org.apache.hadoop.hbase.HBaseTestingUtility.startMiniHBaseCluster() was overriding the value of &apos;mintostart&apos; and &apos;maxtostart&apos; with a single value, even if the caller has set them explicitly.&lt;/li&gt;
	&lt;li&gt;org.apache.hadoop.hbase.regionserver.TestRSKilledWhenMasterInitializing did not set these values even though it kills one RS during master initialization.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The attached patch fixes these two.&lt;/p&gt;</comment>
                            <comment id="13414106" author="hadoopqa" created="Fri, 13 Jul 2012 22:19:47 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12536453/HBASE-6389_trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12536453/HBASE-6389_trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 8 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestHLogRecordReader&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2384//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2384//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2384//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2384//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2384//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2384//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2384//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2384//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13414185" author="lhofhansl" created="Sat, 14 Jul 2012 00:15:38 +0000"  >&lt;p&gt;+1 on last patch.&lt;br/&gt;
If there are no objections I&apos;ll commit this to 0.94 and 0.96.&lt;/p&gt;

&lt;p&gt;Let&apos;s discuss the failure after timeout idea in a different jira.&lt;/p&gt;</comment>
                            <comment id="13414201" author="lhofhansl" created="Sat, 14 Jul 2012 00:31:18 +0000"  >&lt;p&gt;Ran TestHLogRecordReader locally. Passes fine (I did not expect that to be related to this patch).&lt;/p&gt;</comment>
                            <comment id="13414219" author="lhofhansl" created="Sat, 14 Jul 2012 00:47:29 +0000"  >&lt;p&gt;Committed to 0.94 and 0.96&lt;/p&gt;</comment>
                            <comment id="13414241" author="hudson" created="Sat, 14 Jul 2012 01:24:56 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #41 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/41/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/41/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments (Aditya Kishore) (Revision 1361458)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13414250" author="hudson" created="Sat, 14 Jul 2012 01:46:27 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #316 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/316/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/316/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments (Aditya Kishore) (Revision 1361458)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13414265" author="hudson" created="Sat, 14 Jul 2012 02:09:00 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3126 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3126/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3126/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments (Aditya Kishore) (Revision 1361456)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13414283" author="hudson" created="Sat, 14 Jul 2012 03:33:04 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #94 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/94/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/94/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments (Aditya Kishore) (Revision 1361456)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13417697" author="zhihyu@ebaysf.com" created="Wed, 18 Jul 2012 21:26:59 +0000"  >&lt;p&gt;I tried to see why TestZooKeeper hung strangely:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-07-18 14:05:59,533 DEBUG [pool-57-thread-1] zookeeper.ZKUtil(1142): master:52861-0x1389be8bd6e0000-0x1389be8bd6e000a-0x1389be8bd6e000b Retrieved 39 &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;(s) of data from znode /hbase/root-region-server and set watcher; X.ebay.com,44052,1342645522433

2012-07-18 14:05:59,533 WARN  [pool-52-thread-1] zookeeper.RecoverableZooKeeper(218): Possibly &lt;span class=&quot;code-keyword&quot;&gt;transient&lt;/span&gt; ZooKeeper exception: org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /hbase/root-region-server

2012-07-18 14:05:59,533 INFO  [pool-52-thread-1] util.RetryCounter(55): Sleeping 2000ms before retry #1...

2012-07-18 14:05:59,536 INFO  [main] ipc.HBaseRpcMetrics(66): Initializing RPC Metrics with hostName=MiniHBaseCluster$MiniHBaseClusterRegionServer, port=44030

2012-07-18 14:05:59,537 INFO  [Master:0;X.ebay.com,52861,1342645522110] master.HMaster(455): HMaster main thread exiting
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Basically the test hung in setup().&lt;/p&gt;

&lt;p&gt;I then traced where TestZooKeeper stopped showing up in test result and this was the first URL giving me 404 error:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/view/G-L/view/HBase/job/HBase-TRUNK/3126/testReport/org.apache.hadoop.hbase/TestZooKeeper/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/G-L/view/HBase/job/HBase-TRUNK/3126/testReport/org.apache.hadoop.hbase/TestZooKeeper/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That was when this patch went in.&lt;/p&gt;</comment>
                            <comment id="13417715" author="zhihyu@ebaysf.com" created="Wed, 18 Jul 2012 21:42:43 +0000"  >&lt;p&gt;After reverting the patch, test passed smoothly:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Running org.apache.hadoop.hbase.TestZooKeeper
Tests run: 11, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 48.678 sec

Results :

Tests run: 11, Failures: 0, Errors: 0, Skipped: 0

[INFO] 
[INFO] --- maven-surefire-plugin:2.10:test (secondPartTestsExecution) @ hbase-server ---
[INFO] Tests are skipped.
[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 58.563s
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13417820" author="lhofhansl" created="Wed, 18 Jul 2012 23:24:53 +0000"  >&lt;p&gt;Thanks Ted. Revert the patch? Sink the RC?&lt;/p&gt;</comment>
                            <comment id="13417825" author="zhihyu@ebaysf.com" created="Wed, 18 Jul 2012 23:30:12 +0000"  >&lt;p&gt;Patch for 0.94 wasn&apos;t attached here.&lt;/p&gt;

&lt;p&gt;@Lars:&lt;br/&gt;
Can you revert the patches ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13417869" author="zhihyu@ebaysf.com" created="Wed, 18 Jul 2012 23:52:09 +0000"  >&lt;p&gt;Reverted trunk patch.&lt;/p&gt;

&lt;p&gt;Have not touched 0.94 branch yet.&lt;/p&gt;</comment>
                            <comment id="13417880" author="lhofhansl" created="Thu, 19 Jul 2012 00:09:26 +0000"  >&lt;p&gt;The change is sound, though. I looked at the logic again and I can see no flaw in it.&lt;br/&gt;
Maybe the tests expect a certain (incorrect) behavior?&lt;/p&gt;</comment>
                            <comment id="13417885" author="lhofhansl" created="Thu, 19 Jul 2012 00:15:00 +0000"  >&lt;p&gt;Trunk build 3126 was on July 14th. We also had no successful 0.94 since then.&lt;br/&gt;
So while I do not think this patch is incorrect, I agree it should be reverted for now to work out why it causes these problems.&lt;/p&gt;</comment>
                            <comment id="13417894" author="adityakishore" created="Thu, 19 Jul 2012 00:24:14 +0000"  >&lt;p&gt;I am looking at the test failure and so far it looks like error in test condition than the patch code, will update as soon as I have something more.&lt;/p&gt;</comment>
                            <comment id="13417900" author="hudson" created="Thu, 19 Jul 2012 00:34:11 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3145 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3145/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3145/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; Revert, the patch breaks TestZooKeeper (Revision 1363179)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13417902" author="lhofhansl" created="Thu, 19 Jul 2012 00:37:30 +0000"  >&lt;p&gt;I think this patch indeed needs more discussion. If does not want the timeout one can in fact just increase it, and hence force the HMaster to wait for the minimum count.&lt;/p&gt;

&lt;p&gt;I&apos;ll revert in 0.94 and sink the RC.&lt;/p&gt;</comment>
                            <comment id="13417916" author="lhofhansl" created="Thu, 19 Jul 2012 00:53:15 +0000"  >&lt;p&gt;Reverted from 0.94.&lt;br/&gt;
Let&apos;s regroup.&lt;/p&gt;</comment>
                            <comment id="13417920" author="lhofhansl" created="Thu, 19 Jul 2012 00:59:34 +0000"  >&lt;p&gt;The change is logically no longer in 0.94.1. Moving to 0.94.2.&lt;/p&gt;</comment>
                            <comment id="13417950" author="hudson" created="Thu, 19 Jul 2012 01:35:14 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #337 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/337/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/337/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; revert (Revision 1363193)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13417956" author="lhofhansl" created="Thu, 19 Jul 2012 01:38:40 +0000"  >&lt;p&gt;And... We actually got the first successful test run since July 13th!&lt;/p&gt;</comment>
                            <comment id="13417979" author="lhofhansl" created="Thu, 19 Jul 2012 02:01:45 +0000"  >&lt;p&gt;I&apos;m now not even sure we need to change this.&lt;br/&gt;
One can already control this by setting the timeout to a large value (minutes) and then set minToStart to the desired value... That&apos;s what the timeout is for anyway.&lt;/p&gt;</comment>
                            <comment id="13418018" author="adityakishore" created="Thu, 19 Jul 2012 03:06:15 +0000"  >&lt;p&gt;As suspected, the failure was result of a partial shutdown of region server expired in the previous test.&lt;/p&gt;

&lt;p&gt;The region server thread of this expired server was still alive when the next test started which lead the test pre-condition to believe that enough number of RSes are available.&lt;/p&gt;

&lt;p&gt;The new patch take care of the problem.&lt;/p&gt;</comment>
                            <comment id="13418025" author="zhihyu@ebaysf.com" created="Thu, 19 Jul 2012 03:17:42 +0000"  >&lt;p&gt;@Aditya:&lt;br/&gt;
Can you remove the sentence in Release Notes ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13418028" author="lhofhansl" created="Thu, 19 Jul 2012 03:25:37 +0000"  >&lt;p&gt;What&apos;s the general thought here? Reapply the patch?&lt;br/&gt;
The timeout after the patch is not really a timeout any longer, so at the very least the config option is misnamed now.&lt;br/&gt;
Or in different words: What is the point of this timeout now?&lt;/p&gt;</comment>
                            <comment id="13418030" author="zhihyu@ebaysf.com" created="Thu, 19 Jul 2012 03:34:02 +0000"  >&lt;p&gt;It has been 12 minutes since I started running TestZooKeeper based on latest patch.&lt;br/&gt;
Here is the tail of jstack:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; prio=5 tid=102801000 nid=0x100601000 in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [1005fe000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
	- waiting on &amp;lt;78ebfee68&amp;gt; (a org.apache.hadoop.hbase.util.JVMClusterUtil$RegionServerThread)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.join(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:1210)
	- locked &amp;lt;78ebfee68&amp;gt; (a org.apache.hadoop.hbase.util.JVMClusterUtil$RegionServerThread)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.join(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:1263)
	at org.apache.hadoop.hbase.LocalHBaseCluster.waitOnRegionServer(LocalHBaseCluster.java:262)
	at org.apache.hadoop.hbase.MiniHBaseCluster.waitOnRegionServer(MiniHBaseCluster.java:285)
	at org.apache.hadoop.hbase.TestZooKeeper.testRegionServerSessionExpired(TestZooKeeper.java:201)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please take a look at:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6406?focusedCommentId=13417665&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13417665&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-6406?focusedCommentId=13417665&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13417665&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;See if your finding can explain that symptom.&lt;/p&gt;</comment>
                            <comment id="13418071" author="hadoopqa" created="Thu, 19 Jul 2012 05:07:00 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12537127/HBASE-6389_trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12537127/HBASE-6389_trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 12 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2406//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13418160" author="nkeywal" created="Thu, 19 Jul 2012 08:20:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;What&apos;s the general thought here? Reapply the patch? The timeout after the patch is not really a timeout any longer, so at the very least the config option is misnamed now. Or in different words: What is the point of this timeout now?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;After some thinking about it:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;if you want the exact same behavior as proposed by the patch you wan set hbase.master.wait.on.regionservers.timeout and hbase.master.wait.on.regionservers.interval to a high value&lt;/li&gt;
	&lt;li&gt;if you want to fix the problem mentioned in this patch we could solve it by throwing an exception when hbase.master.wait.on.regionservers.timeout is reached. This would require to increase the default as Aditya said it above.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;On a side note, I wonder what would be the impact when you&apos;re loosing a large part of your servers. Someone setting this value to its exact number of nodes will be disappointed.&lt;/p&gt;

</comment>
                            <comment id="13418224" author="hudson" created="Thu, 19 Jul 2012 11:38:56 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #99 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/99/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/99/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; Revert, the patch breaks TestZooKeeper (Revision 1363179)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13418731" author="adityakishore" created="Thu, 19 Jul 2012 22:30:05 +0000"  >&lt;p&gt;@Ted&lt;/p&gt;

&lt;p&gt;The last patch address the exact issue listed at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6406?focusedCommentId=13417665&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13417665&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-6406?focusedCommentId=13417665&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13417665&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;What had happened is that in most test runs, the test testRegionServerSessionExpired() get launched before testMasterSessionExpired() or testMasterZKSessionRecoveryFailure(). This test testRegionServerSessionExpired() brings down one of the two region servers but this RS is not dead by the time testMasterSessionExpired() or testMasterZKSessionRecoveryFailure() starts.&lt;/p&gt;

&lt;p&gt;The precondition of each test evaluates and ensure than a minimum of two region servers are online (by testing if their threads are &quot;alive&quot; and not by testing their ZK node or connecting to it).&lt;/p&gt;

&lt;p&gt;So while one of the RS is shutting itself down (and its thread is still alive), and either of testMasterSessionExpired() or testMasterZKSessionRecoveryFailure() could start because the test precondition is satisfied. However, both of these test cases result in Master recovery and reinitialization which actually attempts to check for the quorum of 2 Online region servers and since there is only one region server online at this point, the initialization fails with timeout and the master is killed.&lt;/p&gt;

&lt;p&gt;By this time the dying region server&apos;s thread is dead and the precondition of the next test sees that it needs to create one region server. But since no master is running at this point, the newly created region server&apos;s run thread gets blocked in HRegionServer.blockAndCheckIfStopped() and the RS does not come online. As a result the test thread which is waiting for the RS to come online keeps waiting which is why you see the test hung in setup().&lt;/p&gt;

&lt;p&gt;My last patch ensured that the dying RS is completely stopped before testRegionServerSessionExpired() completes so that the subsequent tests&apos; precondition does not get fooled into thinking that the minimum server count is met and start the testcase.&lt;/p&gt;</comment>
                            <comment id="13418738" author="zhihyu@ebaysf.com" created="Thu, 19 Jul 2012 22:37:45 +0000"  >&lt;p&gt;Thanks for your explanation.&lt;/p&gt;

&lt;p&gt;Have you seen the test failure that I described above @ 19/Jul/12 03:34 ?&lt;/p&gt;</comment>
                            <comment id="13418742" author="stack" created="Thu, 19 Jul 2012 22:42:42 +0000"  >&lt;p&gt;@Aditya Thanks for the debugging that went into your figuring the above.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The precondition of each test evaluates and ensure than a minimum of two region servers are online (by testing if their threads are &quot;alive&quot; and not by testing their ZK node or connecting to it).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Does this patch change how we evaluate &quot;alive&quot; regionservers?  (If not should, given your debug above, it seems like a good change for HTU).&lt;/p&gt;

&lt;p&gt;What is the below changing doing?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;conf.setInt(&quot;hbase.master.wait.on.regionservers.mintostart&quot;, numSlaves);&lt;/li&gt;
	&lt;li&gt;conf.setInt(&quot;hbase.master.wait.on.regionservers.maxtostart&quot;, numSlaves);&lt;br/&gt;
+    String count = String.valueOf(numSlaves);&lt;br/&gt;
+    conf.setIfUnset(&quot;hbase.master.wait.on.regionservers.mintostart&quot;, count);&lt;br/&gt;
+    conf.setIfUnset(&quot;hbase.master.wait.on.regionservers.maxtostart&quot;, count);&lt;br/&gt;
{code]&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13418744" author="adityakishore" created="Thu, 19 Jul 2012 22:44:36 +0000"  >&lt;p&gt;Unfortunately, even after repeated attempts, I am not able to fail the test after applying the last patch. But I do have a theory.&lt;/p&gt;

&lt;p&gt;Could you please test the last patch once again with debug logging enabled and send me the log.&lt;/p&gt;</comment>
                            <comment id="13418748" author="zhihyu@ebaysf.com" created="Thu, 19 Jul 2012 22:50:09 +0000"  >&lt;p&gt;Here was the test output from yesterday.&lt;/p&gt;</comment>
                            <comment id="13418750" author="adityakishore" created="Thu, 19 Jul 2012 22:52:29 +0000"  >&lt;p&gt;@Stack&lt;/p&gt;

&lt;p&gt;No, the current patch does not modify the way a live RS is evaluated, but it ensures that the dying RS&apos;s thread is actually dead before moving forward.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;What is the below changing doing?&lt;/p&gt;

&lt;p&gt;    conf.setInt(&quot;hbase.master.wait.on.regionservers.mintostart&quot;, numSlaves);&lt;br/&gt;
    conf.setInt(&quot;hbase.master.wait.on.regionservers.maxtostart&quot;, numSlaves);&lt;br/&gt;
    + String count = String.valueOf(numSlaves);&lt;br/&gt;
    + conf.setIfUnset(&quot;hbase.master.wait.on.regionservers.mintostart&quot;, count);&lt;br/&gt;
    + conf.setIfUnset(&quot;hbase.master.wait.on.regionservers.maxtostart&quot;, count);&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This change was to preserve the values of &apos;mintostart&apos; and &apos;maxtostart&apos; in the configuration if the caller of HBaseTestingUtility.startMiniHBaseCluster(int, int) has set them (which was the case with TestMasterFailover#testMasterFailoverWithMockedRITOnDeadRS failure).&lt;/p&gt;</comment>
                            <comment id="13418752" author="zhihyu@ebaysf.com" created="Thu, 19 Jul 2012 22:54:33 +0000"  >&lt;p&gt;Looking at &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2406/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2406/console&lt;/a&gt;, there was still some hanging test although I wasn&apos;t able to find which test hung.&lt;/p&gt;</comment>
                            <comment id="13418766" author="stack" created="Thu, 19 Jul 2012 23:07:07 +0000"  >&lt;p&gt;@Aditya Makes sense.  You got what you needed from Ted?  Let us know.  Thanks.&lt;/p&gt;</comment>
                            <comment id="13418767" author="hadoopqa" created="Thu, 19 Jul 2012 23:08:15 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12537258/org.apache.hadoop.hbase.TestZooKeeper-output.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12537258/org.apache.hadoop.hbase.TestZooKeeper-output.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 10 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2415//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2415//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13418771" author="lhofhansl" created="Thu, 19 Jul 2012 23:10:49 +0000"  >&lt;p&gt;I&apos;d like to leave this with 0.94.2. Unless you think this must go into 0.94.1&lt;/p&gt;</comment>
                            <comment id="13418789" author="adityakishore" created="Thu, 19 Jul 2012 23:27:58 +0000"  >&lt;p&gt;My vote was for its inclusion for 2 reasons.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;This was a behavior change in 0.94.0 and I am not sure we have completely understood its impact.&lt;/li&gt;
	&lt;li&gt;In a large MSLAB enabled cluster, I have repeatedly seen all the regions (in excess of 5K with &lt;b&gt;&#931;&lt;/b&gt;&lt;sub&gt;i=1..n&lt;/sub&gt;(&lt;b&gt;R&lt;/b&gt;&lt;sub&gt;i&lt;/sub&gt;&lt;b&gt;CF&lt;/b&gt;&lt;sub&gt;i&lt;/sub&gt;) &amp;gt; 8K; with MSLAB on, RS needs &amp;gt; 16G just to open) being assigned to a single region server leading it to OOM crash and creating quite a few HBCK inconsistencies on subsequent recovery.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Lastly, so far all the test failures seems to be due to errors in the test code unmasked by this change.&lt;/p&gt;</comment>
                            <comment id="13418808" author="lhofhansl" created="Thu, 19 Jul 2012 23:44:36 +0000"  >&lt;p&gt;@Aditya: I do agree. (see my comment about how I&apos;m sure the logic of this change is correct).&lt;/p&gt;

&lt;p&gt;It now seems, though, that it is the default timeout that is too short (4.5s).&lt;br/&gt;
Folks with 5k regions should know to increase the minToStart parameter and the timeout. We should document that better.&lt;br/&gt;
I can also see to change the timeout to failure condition (as discussed above).&lt;/p&gt;

&lt;p&gt;I&apos;m not opposed. It&apos;s just that 0.94.1 needs to go out because of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6311&quot; title=&quot;Data error after majorCompaction caused by keeping MVCC for opened scanners&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6311&quot;&gt;&lt;del&gt;HBASE-6311&lt;/del&gt;&lt;/a&gt;, I do not want to risk delaying this further. It also seems this can use further discussion.&lt;br/&gt;
(Sometimes it is amazing how much discussion a two line change can cause &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )&lt;/p&gt;

&lt;p&gt;@Ted and @Stack: What do you guys think? &lt;/p&gt;

&lt;p&gt;Edit: Spelling.&lt;/p&gt;</comment>
                            <comment id="13418812" author="adityakishore" created="Thu, 19 Jul 2012 23:49:57 +0000"  >&lt;p&gt;@Lars&lt;/p&gt;

&lt;p&gt;Completely agree and definitely would not want to hold 0.94.1 for this. (That&apos;s why &quot;My vote &lt;b&gt;was&lt;/b&gt;... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ).&lt;/p&gt;

&lt;p&gt;Documentation can take care of this in 0.94.1&lt;/p&gt;</comment>
                            <comment id="13418815" author="lhofhansl" created="Thu, 19 Jul 2012 23:57:03 +0000"  >&lt;p&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; didn&apos;t pick up on the &quot;was&quot;&lt;/p&gt;</comment>
                            <comment id="13418866" author="zhihyu@ebaysf.com" created="Fri, 20 Jul 2012 01:33:00 +0000"  >&lt;p&gt;I ran test suite with latest patch on trunk and got:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Failed tests:   testRunThriftServer[12](org.apache.hadoop.hbase.thrift.TestThriftServerCmdLine): expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;
  testRunThriftServer[14](org.apache.hadoop.hbase.thrift.TestThriftServerCmdLine): expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;
  testRunThriftServer[15](org.apache.hadoop.hbase.thrift.TestThriftServerCmdLine): expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;
  testRunThriftServer[16](org.apache.hadoop.hbase.thrift.TestThriftServerCmdLine): expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;
  testRunThriftServer[17](org.apache.hadoop.hbase.thrift.TestThriftServerCmdLine): expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;

Tests in error:
  testRegionCaching(org.apache.hadoop.hbase.client.TestHCM): org.apache.hadoop.hbase.UnknownRegionException: bd992463917ba68fe5389c5bf9e94a3a
  testCloseRegionThatFetchesTheHRIFromMeta(org.apache.hadoop.hbase.client.TestAdmin): -1
  testTableExists(org.apache.hadoop.hbase.catalog.TestMetaReaderEditor): org.apache.hadoop.hbase.TableNotEnabledException: testTableExists
  testRunThriftServer[11](org.apache.hadoop.hbase.thrift.TestThriftServerCmdLine): test timed out after 60000 milliseconds
  testRunThriftServer[13](org.apache.hadoop.hbase.thrift.TestThriftServerCmdLine): test timed out after 60000 milliseconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There was one hanging test:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
	at org.apache.hadoop.hbase.replication.TestReplication.setUp(TestReplication.java:183)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;BTW what do &lt;b&gt;R&lt;/b&gt;&lt;sub&gt;i&lt;/sub&gt;, C and &lt;b&gt;F&lt;/b&gt;&lt;sub&gt;i&lt;/sub&gt; represent in the formula above ?&lt;/p&gt;</comment>
                            <comment id="13418871" author="zhihyu@ebaysf.com" created="Fri, 20 Jul 2012 01:37:09 +0000"  >&lt;p&gt;jstack for the hanging TestReplication&lt;/p&gt;</comment>
                            <comment id="13418895" author="hadoopqa" created="Fri, 20 Jul 2012 03:06:18 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12537286/testReplication.jstack&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12537286/testReplication.jstack&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2416//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2416//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13419491" author="adityakishore" created="Fri, 20 Jul 2012 19:41:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;BTW what do Ri, C and Fi represent in the formula above ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&apos;n&apos; is the number of tables in the cluster, &lt;b&gt;R&lt;/b&gt;&lt;sub&gt;i&lt;/sub&gt; is the number of regions and &lt;b&gt;CF&lt;/b&gt;&lt;sub&gt;i&lt;/sub&gt; is the number of column families in table &apos;i&apos; &lt;sup&gt;[1]&lt;/sup&gt;.&lt;/p&gt;

&lt;p&gt;1. &lt;a href=&quot;http://hbase.apache.org/book/upgrade0.92.html#d1952e2965&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;MSLAB is ON by default&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13419529" author="stack" created="Fri, 20 Jul 2012 20:25:09 +0000"  >&lt;p&gt;@Lars Its up to you (But since you asked, fine by me ... I like what you are doing though Aditya... thanks for the help).&lt;/p&gt;</comment>
                            <comment id="13419649" author="hudson" created="Fri, 20 Jul 2012 22:53:20 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #44 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/44/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/44/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; revert (Revision 1363193)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13428740" author="hudson" created="Sun, 5 Aug 2012 00:51:14 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #6 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/6/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/6/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; revert (Revision 1363193)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments (Aditya Kishore) (Revision 1361458)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13441720" author="lhofhansl" created="Sat, 25 Aug 2012 01:28:57 +0000"  >&lt;p&gt;I am removing this from 0.94. We can still aim for 0.96.&lt;br/&gt;
Pull back if you disagree.&lt;/p&gt;</comment>
                            <comment id="13479015" author="adityakishore" created="Thu, 18 Oct 2012 14:03:09 +0000"  >&lt;p&gt;The new patch addresses test failures in couple of test cases (including TestReplication, TestZookeeper).&lt;/p&gt;

&lt;p&gt;Also, since the config params are used in quite a few places, I have moved them as a public constant.&lt;/p&gt;

&lt;p&gt;Please note that there is no change in the logic of the fix. This only fixes few bugs in test cases which surfaced due to the fix.&lt;/p&gt;

&lt;p&gt;I&apos;ll submit the review request later during the day.&lt;/p&gt;</comment>
                            <comment id="13479058" author="hadoopqa" created="Thu, 18 Oct 2012 15:04:46 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12549692/HBASE-6389_trunk_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12549692/HBASE-6389_trunk_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 15 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 82 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3076//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13479405" author="adityakishore" created="Thu, 18 Oct 2012 21:49:32 +0000"  >&lt;p&gt;Resubmitting the patch with some minor changes.&lt;/p&gt;</comment>
                            <comment id="13479443" author="hadoopqa" created="Thu, 18 Oct 2012 22:48:13 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12549763/HBASE-6389_trunk_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12549763/HBASE-6389_trunk_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 15 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 82 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 4 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.backup.example.TestZooKeeperTableArchiveClient&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3083//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13479451" author="adityakishore" created="Thu, 18 Oct 2012 22:57:23 +0000"  >&lt;p&gt;The test failure is unrelated and most likely is due to the same reason as observed here&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6707?focusedCommentId=13469675&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13469665&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-6707?focusedCommentId=13469675&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13469665&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13479464" author="stack" created="Thu, 18 Oct 2012 23:11:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adityakishore&quot; class=&quot;user-hover&quot; rel=&quot;adityakishore&quot;&gt;Aditya Kishore&lt;/a&gt; Patch looks good Aditya.  Mind describing in release note how this patch changes startup?  What kind of testing do you do sir?  I can commit to trunk.  Should it go into 0.94 too?&lt;/p&gt;</comment>
                            <comment id="13480444" author="adityakishore" created="Fri, 19 Oct 2012 22:11:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Have added the release note describing the behavior change, kindly review.&lt;/p&gt;

&lt;p&gt;I have tested it in following scenario while setting the min value to higher than 1 (mostly 2):&lt;/p&gt;

&lt;p&gt;0. Normal cluster startup.&lt;br/&gt;
1. Cluster start with 1 master and 1 region server and delaying the start of other RSes by 10s of seconds.&lt;br/&gt;
2. Same as 1 but with 2 masters and then failover the master once the cluster is up and running.&lt;br/&gt;
3. Same as 2 but with stopping the RSes while failing over the Master and bringing only 1 RS back while other joining later.&lt;br/&gt;
4. Some random Master/RS failover.&lt;/p&gt;</comment>
                            <comment id="13480457" author="adityakishore" created="Fri, 19 Oct 2012 22:25:45 +0000"  >&lt;p&gt;And yes, I think this is important for 0.94 branch as well judging from the number of instances I have seen this impacting some of our large deployments which were running with the default value of 1 in both 0.90 and 0.92.&lt;/p&gt;

&lt;p&gt;The configuration too needs to be part of &quot;Important configuration&quot;. Will file separate JIRA for doc update, if you agree.&lt;/p&gt;</comment>
                            <comment id="13480540" author="yuzhihong@gmail.com" created="Fri, 19 Oct 2012 23:55:04 +0000"  >&lt;p&gt;+1 on patch.&lt;/p&gt;</comment>
                            <comment id="13487634" author="adityakishore" created="Wed, 31 Oct 2012 09:34:15 +0000"  >&lt;p&gt;Attaching patch for 0.94 branch. The patch passes full test suit on my test machine.&lt;/p&gt;</comment>
                            <comment id="13487636" author="adityakishore" created="Wed, 31 Oct 2012 09:36:36 +0000"  >&lt;p&gt;Not sure how to submit it for 0.94 builds. Ted, could you please help me out here.&lt;/p&gt;</comment>
                            <comment id="13487639" author="hadoopqa" created="Wed, 31 Oct 2012 09:42:09 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12551509/HBASE-6389_0.94.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12551509/HBASE-6389_0.94.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3199//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3199//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13487665" author="yuzhihong@gmail.com" created="Wed, 31 Oct 2012 10:42:16 +0000"  >&lt;p&gt;Hadoop QA only checks patch for trunk. &lt;/p&gt;</comment>
                            <comment id="13488483" author="lhofhansl" created="Thu, 1 Nov 2012 05:40:05 +0000"  >&lt;p&gt;I do not know this area well.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; Wanna have a look too?&lt;/p&gt;
</comment>
                            <comment id="13489551" author="stack" created="Fri, 2 Nov 2012 17:15:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=adityakishore&quot; class=&quot;user-hover&quot; rel=&quot;adityakishore&quot;&gt;Aditya Kishore&lt;/a&gt; So, what happens on startup now (I don&apos;t recall how it worked way back in 0.92!).  We wait for how long for the minimum servers to check in?  Once that period has elapsed, we start the assign to whoever has checked in?  Thanks (I can take care of making a note in important configurations section, np).&lt;/p&gt;</comment>
                            <comment id="13489612" author="adityakishore" created="Fri, 2 Nov 2012 18:11:13 +0000"  >&lt;p&gt;Master waits infinitely until the minimum number of Region Servers have cheked-in.&lt;/p&gt;

&lt;p&gt;This protects against overloading a small number of RSes with the initial region assignment. With the default of 1, most of the cluster will start assignment after 4.5 seconds (again default) even if a single RS has registered. But this setting gives an option to delay the assignments in large clusters until a good number of RSes have registered.&lt;/p&gt;

&lt;p&gt;The wait timeout comes into effect only if the minimum number has reached within the timeout period.&lt;/p&gt;

&lt;p&gt;I have updated the conditions describing the behavior in the Java-doc as well.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /**
   * Wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the region servers to report in.
   * We will wait until one of these condition is met:
   *  - the master is stopped
   *  - the &apos;hbase.master.wait.on.regionservers.maxtostart&apos; number of
   *    region servers is reached
   *  - the &apos;hbase.master.wait.on.regionservers.mintostart&apos; is reached AND
   *   there have been no &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; region server in &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
   *      &apos;hbase.master.wait.on.regionservers.interval&apos; time AND
   *   the &apos;hbase.master.wait.on.regionservers.timeout&apos; is reached
   *
   * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException
   */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13489621" author="zhihyu@ebaysf.com" created="Fri, 2 Nov 2012 18:17:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;The wait timeout comes into effect only if the minimum number has reached within the timeout period.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I guess you meant: if the minimum number has &lt;b&gt;not&lt;/b&gt; reached&lt;/p&gt;</comment>
                            <comment id="13489638" author="adityakishore" created="Fri, 2 Nov 2012 18:32:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;I guess you meant: if the minimum number has not reached&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No, timeout applies in conjunction with the minimum number of RS. As the java-doc describes, the wait ends as soon as &lt;b&gt;even one&lt;/b&gt; of the 3 conditions are met. The first 2 are straightforward. The last one is a conjunction of 3 conditions and &lt;b&gt;all of them&lt;/b&gt; must become true for the overall condition to become true and for wait to end. &lt;/p&gt;

&lt;p&gt;Which means (timeout has elapsed) &lt;b&gt;AND&lt;/b&gt; (quorum of RS has registered) &lt;b&gt;AND&lt;/b&gt; (no new RS has has registered in last 1.5 seconds).&lt;/p&gt;</comment>
                            <comment id="13489682" author="stack" created="Fri, 2 Nov 2012 19:24:43 +0000"  >&lt;p&gt;Committed to trunk.  Thanks for the clarifications Aditya (and the fix).  Lars, you want this for 0.94.3?  I marked it as an &apos;incompatible change&apos; but this is a bug fix, and the behavior now more rational.&lt;/p&gt;</comment>
                            <comment id="13489687" author="adityakishore" created="Fri, 2 Nov 2012 19:28:24 +0000"  >&lt;p&gt;Thanks Stack and Ted for reviewing the changes.&lt;/p&gt;</comment>
                            <comment id="13489691" author="stack" created="Fri, 2 Nov 2012 19:33:48 +0000"  >&lt;p&gt;I added a note on this config. to the reference guide under required configurations.  Also updated the release note to include Adhitya&apos;s clean javadoc excerpt on how this now works.&lt;/p&gt;</comment>
                            <comment id="13489949" author="lhofhansl" created="Sat, 3 Nov 2012 06:33:54 +0000"  >&lt;p&gt;I&apos;m going to commit the 0.94 patch.&lt;/p&gt;</comment>
                            <comment id="13490122" author="lhofhansl" created="Sat, 3 Nov 2012 22:56:03 +0000"  >&lt;p&gt;Committed to 0.94 as well.&lt;/p&gt;</comment>
                            <comment id="13490133" author="hudson" created="Sun, 4 Nov 2012 01:49:43 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #571 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/571/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/571/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments (Aditya Kishore) (Revision 1405440)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13490228" author="hudson" created="Sun, 4 Nov 2012 17:31:44 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #248 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/248/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/248/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments (Revision 1405111)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/TestZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestMasterNoCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13490393" author="hudson" created="Mon, 5 Nov 2012 01:35:36 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #9 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/9/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/9/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments (Aditya Kishore) (Revision 1405440)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13490410" author="hudson" created="Mon, 5 Nov 2012 01:54:04 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #82 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/82/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/82/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6389&quot; title=&quot;Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6389&quot;&gt;&lt;del&gt;HBASE-6389&lt;/del&gt;&lt;/a&gt; Modify the conditions to ensure that Master waits for sufficient number of Region Servers before starting region assignments (Aditya Kishore) (Revision 1405440)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13534435" author="v.himanshu" created="Mon, 17 Dec 2012 23:38:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;What is the reason for having the &quot;incompatible change&quot; flag?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12551509" name="HBASE-6389_0.94.patch" size="9686" author="adityakishore" created="Wed, 31 Oct 2012 09:34:15 +0000"/>
                            <attachment id="12537127" name="HBASE-6389_trunk.patch" size="5355" author="adityakishore" created="Thu, 19 Jul 2012 03:06:15 +0000"/>
                            <attachment id="12536453" name="HBASE-6389_trunk.patch" size="4724" author="adityakishore" created="Fri, 13 Jul 2012 20:53:09 +0000"/>
                            <attachment id="12536324" name="HBASE-6389_trunk.patch" size="2672" author="adityakishore" created="Fri, 13 Jul 2012 02:52:51 +0000"/>
                            <attachment id="12549763" name="HBASE-6389_trunk_v2.patch" size="11498" author="adityakishore" created="Thu, 18 Oct 2012 21:48:53 +0000"/>
                            <attachment id="12549692" name="HBASE-6389_trunk_v2.patch" size="11199" author="adityakishore" created="Thu, 18 Oct 2012 13:58:49 +0000"/>
                            <attachment id="12537258" name="org.apache.hadoop.hbase.TestZooKeeper-output.txt" size="122880" author="zhihyu@ebaysf.com" created="Thu, 19 Jul 2012 22:50:09 +0000"/>
                            <attachment id="12537286" name="testReplication.jstack" size="209130" author="zhihyu@ebaysf.com" created="Fri, 20 Jul 2012 01:37:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 13 Jul 2012 01:16:03 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241737</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02bw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11528</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Reverts the cluster startup behavior to pre 0.94.0.&lt;br/&gt;
&lt;br/&gt;
With this, Master will wait until &amp;quot;hbase.master.wait.on.regionservers.mintostart&amp;quot; number of Region Servers have registered with it before it starts region assignment. The default value of this setting is 1.&lt;br/&gt;
&lt;br/&gt;
In large clusters with thousands of regions you may want to increase this to a higher number which is sufficient to handle the task of opening those region in parallel.&lt;br/&gt;
&lt;br/&gt;
If left to the default, at times, the Master could assign all regions to a single Region Server which will result in slow startup and in worst case could OOM the Region Server (some time resulting in META inconsistency).&lt;br/&gt;
&lt;br/&gt;
Here is how it works now (from the javadoc):&lt;br/&gt;
&lt;br/&gt;
We wait until one of these condition is met:&lt;br/&gt;
&amp;nbsp;- the master is stopped&lt;br/&gt;
&amp;nbsp;- the &amp;#39;hbase.master.wait.on.regionservers.maxtostart&amp;#39; number of region servers is reached&lt;br/&gt;
&amp;nbsp;- the &amp;#39;hbase.master.wait.on.regionservers.mintostart&amp;#39; is reached AND there have been no new region server in for &amp;#39;hbase.master.wait.on.regionservers.interval&amp;#39; time AND the &amp;#39;hbase.master.wait.on.regionservers.timeout&amp;#39; is reached</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>