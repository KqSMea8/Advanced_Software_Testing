<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:36:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6371/HBASE-6371.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6371] [89-fb] Tier based compaction</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6371</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently, the compaction selection is not very flexible and is not sensitive to the hotness of the data. Very old data is likely to be accessed less, and very recent data is likely to be in the block cache. Both of these considerations make it inefficient to compact these files as aggressively as other files. In some use-cases, the access-pattern is particularly obvious even though there is no way to control the compaction algorithm in those cases.&lt;/p&gt;

&lt;p&gt;In the new compaction selection algorithm, we plan to divide the candidate files into different levels according to oldness of the data that is present in those files. For each level, parameters like compaction ratio, minimum number of store-files in each compaction may be different. Number of levels, time-ranges, and parameters for each level will be configurable online on a per-column family basis.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12598354">HBASE-6371</key>
            <summary>[89-fb] Tier based compaction</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="11">Done</resolution>
                                        <assignee username="liyin">Liyin Tang</assignee>
                                    <reporter username="akashnil07">Akashnil</reporter>
                        <labels>
                            <label>beginner</label>
                    </labels>
                <created>Wed, 11 Jul 2012 11:02:04 +0000</created>
                <updated>Sat, 10 Jan 2015 01:59:30 +0000</updated>
                            <resolved>Sat, 10 Jan 2015 01:59:30 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>36</watches>
                                                                <comments>
                            <comment id="13423504" author="lhofhansl" created="Thu, 26 Jul 2012 22:12:19 +0000"  >&lt;p&gt;Can that all be done with coprocessors?&lt;br/&gt;
Coprocessor can already pre-select the HFiles to compact and also intercept the resulting scanner and hence split the stream into multiple target streams.&lt;/p&gt;</comment>
                            <comment id="13439025" author="nspiegelberg" created="Tue, 21 Aug 2012 20:48:10 +0000"  >&lt;p&gt;@Lars: I think we want to put level-based &amp;amp; tiered compactions in the core instead of as coprocessors because these are generic strategies versus app-specific logic.&lt;/p&gt;

&lt;p&gt;@Akashnil: the algorithm you describe is technically referred to as a &quot;tiered compaction&quot;.  DataStax has a nice writeup on tiered compactions versus level-based: &lt;a href=&quot;http://www.datastax.com/dev/blog/leveled-compaction-in-apache-cassandra&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.datastax.com/dev/blog/leveled-compaction-in-apache-cassandra&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13444318" author="nspiegelberg" created="Wed, 29 Aug 2012 18:49:34 +0000"  >&lt;p&gt;@Ted: what&apos;s the reason for the 89-fb tag? This is currently developed for this branch, but probably should be ported to trunk as well.  This is an improvement on the default algorithm, not an app specialization.&lt;/p&gt;</comment>
                            <comment id="13444321" author="yuzhihong@gmail.com" created="Wed, 29 Aug 2012 18:54:31 +0000"  >&lt;p&gt;@Nicolas:&lt;br/&gt;
This feature has been checked into 0.89-fb branch.&lt;/p&gt;

&lt;p&gt;It would be clearer for another JIRA / task to port this feature to trunk.&lt;/p&gt;</comment>
                            <comment id="13446331" author="mikhail" created="Fri, 31 Aug 2012 20:20:17 +0000"  >&lt;p&gt;Ted: we have been reusing the same JIRA for 89-fb and trunk commits for a lot of features. I think it is up to the developer of a particular feature to decide whether to use the same JIRA or different JIRAs.&lt;/p&gt;</comment>
                            <comment id="13466012" author="stack" created="Fri, 28 Sep 2012 23:37:05 +0000"  >&lt;p&gt;This would be a nice one to forward port.  Marking as noob if someone wants to pull it from 0.89-fb and make it fit trunk.&lt;/p&gt;</comment>
                            <comment id="13475952" author="liyin" created="Mon, 15 Oct 2012 04:01:07 +0000"  >&lt;p&gt;As Nicolas suggested, rename the jira as tier based compaction.&lt;/p&gt;</comment>
                            <comment id="13478537" author="lhofhansl" created="Thu, 18 Oct 2012 00:46:58 +0000"  >&lt;p&gt;Is this in the 0.89 branch, and is it finished?&lt;/p&gt;

&lt;p&gt;Does this only change the compaction selection?&lt;/p&gt;

&lt;p&gt;A feature I&apos;d be interested in is separating old and new data, such it would not typically be compacted into the same file(s) - even in a major compaction.&lt;br/&gt;
If there is hot new data and lot of older data that is only occasionally queried, if old and new data ends up in the same set of files, scanning is slow, because scanning the latest version only is hitting many more blocks then necessary and old versions of KVs need to be skipped (and HFiles with only old data could otherwise simply be ignored).&lt;/p&gt;

&lt;p&gt;An approach LevelDB might be interesting. Here&apos;s a description: &lt;a href=&quot;http://code.google.com/p/leveldb/source/browse/doc/impl.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://code.google.com/p/leveldb/source/browse/doc/impl.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Is that what we are trying to do with this?&lt;/p&gt;</comment>
                            <comment id="13478543" author="lhofhansl" created="Thu, 18 Oct 2012 00:53:51 +0000"  >&lt;p&gt;Specifically a scenario I&apos;d be interested in, is to keep a days (or two) worth of changes in a live HBase cluster. In extreme cases this might be lead to 1000&apos;s of versions, and scan performance of the latest version suffers significantly, &lt;b&gt;especially&lt;/b&gt; after a major compaction which will cause all version of KVs to be jumbled together in the same file.&lt;/p&gt;</comment>
                            <comment id="13483609" author="sershe" created="Wed, 24 Oct 2012 21:32:28 +0000"  >&lt;p&gt;I am attaching the 0.89fb commit for reference.&lt;br/&gt;
The commit hash is 1b3e7bb4df1ed05d7d268cb90ffc23f5955c4398 &lt;/p&gt;</comment>
                            <comment id="13483616" author="lhofhansl" created="Wed, 24 Oct 2012 21:39:43 +0000"  >&lt;p&gt;This is from before there were coprocessors, interesting.&lt;/p&gt;</comment>
                            <comment id="13483729" author="sershe" created="Wed, 24 Oct 2012 23:36:10 +0000"  >&lt;p&gt;I think updateConfiguration mechanism from this patch deserves separate commit; it&apos;s more generic than this change (I hope) and will have to be changed to protobufs. &lt;br/&gt;
I will create a JIRA.&lt;/p&gt;</comment>
                            <comment id="13483759" author="nspiegelberg" created="Thu, 25 Oct 2012 00:23:35 +0000"  >&lt;p&gt;@Lars:  you are correct about doing a better job of partitioning newly-written and stale data.  With leveled compaction, the different tiers end up implicitly becoming different age groups.  This was the primary motivation for us.&lt;/p&gt;

&lt;p&gt;Also note that we are looking into coprocessor-based compactions, but will probably utilize that for TSDB-style compactions and other stuff that is more niche and is questionable if it belongs in the core.&lt;/p&gt;</comment>
                            <comment id="13484382" author="sershe" created="Thu, 25 Oct 2012 19:07:45 +0000"  >&lt;p&gt;I am working on trunk patch, just for reference (not sure if it would be right to reassign this to myself from original author).&lt;/p&gt;</comment>
                            <comment id="13484389" author="lhofhansl" created="Thu, 25 Oct 2012 19:18:57 +0000"  >&lt;p&gt;Maybe create a porting jira and assign to you, Sergey?&lt;br/&gt;
(Or turn this jira into a porting jira - by changing the title)&lt;/p&gt;</comment>
                            <comment id="13484395" author="lhofhansl" created="Thu, 25 Oct 2012 19:22:07 +0000"  >&lt;p&gt;I agree that not all this can or should be done with coprocessors (I came to that conclusion as well in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6428&quot; title=&quot;Pluggable Compaction policies&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6428&quot;&gt;&lt;del&gt;HBASE-6428&lt;/del&gt;&lt;/a&gt;, which more and more looks like a dup of this one)&lt;/p&gt;</comment>
                            <comment id="13485251" author="sershe" created="Fri, 26 Oct 2012 22:37:38 +0000"  >&lt;p&gt;trunk patch v1 is in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7055&quot; title=&quot;port HBASE-6371 tier-based compaction from 0.89-fb to trunk (with changes)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7055&quot;&gt;&lt;del&gt;HBASE-7055&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="13487199" author="hudson" created="Tue, 30 Oct 2012 20:36:18 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3498 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3498/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3498/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7055&quot; title=&quot;port HBASE-6371 tier-based compaction from 0.89-fb to trunk (with changes)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7055&quot;&gt;&lt;del&gt;HBASE-7055&lt;/del&gt;&lt;/a&gt; port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6371&quot; title=&quot;[89-fb] Tier based compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6371&quot;&gt;&lt;del&gt;HBASE-6371&lt;/del&gt;&lt;/a&gt; tier-based compaction from 0.89-fb to trunk (Sergey) (Revision 1403852)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-common/src/main/java/org/apache/hadoop/hbase/HBaseConfiguration.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/HFileOutputFormat.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/CompactionConfiguration.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/CompactionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Compactor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/TierCompactionConfiguration.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/TierCompactionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactSelection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionRequest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/resources/hbase-compactions.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactSelection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestDefaultCompactSelection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestStore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestTierCompactSelection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13487458" author="hudson" created="Wed, 31 Oct 2012 02:21:34 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3499 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3499/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3499/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7055&quot; title=&quot;port HBASE-6371 tier-based compaction from 0.89-fb to trunk (with changes)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7055&quot;&gt;&lt;del&gt;HBASE-7055&lt;/del&gt;&lt;/a&gt; port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6371&quot; title=&quot;[89-fb] Tier based compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6371&quot;&gt;&lt;del&gt;HBASE-6371&lt;/del&gt;&lt;/a&gt; tier-based compaction from 0.89-fb to trunk - revert for further discussion (Revision 1403890)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-common/src/main/java/org/apache/hadoop/hbase/HBaseConfiguration.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/HFileOutputFormat.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/CompactionConfiguration.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/CompactionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Compactor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/TierCompactionConfiguration.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/TierCompactionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactSelection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionRequest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/resources/hbase-compactions.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactSelection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestDefaultCompactSelection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestTierCompactSelection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13491233" author="liyin" created="Tue, 6 Nov 2012 06:13:25 +0000"  >&lt;p&gt;The design doc for HBase Tier-based Compaction from Akashnil.&lt;/p&gt;</comment>
                            <comment id="13551362" author="sershe" created="Fri, 11 Jan 2013 18:30:30 +0000"  >&lt;p&gt;Should this issue be resolved? Backport is handled in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7055&quot; title=&quot;port HBASE-6371 tier-based compaction from 0.89-fb to trunk (with changes)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7055&quot;&gt;&lt;del&gt;HBASE-7055&lt;/del&gt;&lt;/a&gt; and assorted spin-off issues.&lt;/p&gt;</comment>
                            <comment id="14272245" author="apurtell" created="Sat, 10 Jan 2015 01:59:30 +0000"  >&lt;p&gt;Resolved as Done&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12599400">HBASE-6428</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12509055">CASSANDRA-2735</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12613405">HBASE-7049</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12613574">HBASE-7055</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12550689" name="HBASE-6371-089fb-commit.patch" size="151690" author="sershe" created="Wed, 24 Oct 2012 21:32:28 +0000"/>
                            <attachment id="12552321" name="HBase_Tier_Base_Compaction.pdf" size="1098624" author="liyin" created="Tue, 6 Nov 2012 18:54:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 26 Jul 2012 22:12:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>240856</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i016k7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4832</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>beginner</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>