<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:10:03 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3421/HBASE-3421.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3421] Very wide rows -- 30M plus -- cause us OOME</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3421</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From the list, see &apos;jvm oom&apos; in &lt;a href=&quot;http://mail-archives.apache.org/mod_mbox/hbase-user/201101.mbox/browser&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://mail-archives.apache.org/mod_mbox/hbase-user/201101.mbox/browser&lt;/a&gt;, it looks like wide rows &amp;#8211; 30M or so &amp;#8211; causes OOME during compaction.  We should check it out. Can the scanner used during compactions use the &apos;limit&apos; when nexting?  If so, this should save our OOME&apos;ing (or, we need to add to the next a max size rather than count of KVs).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12494769">HBASE-3421</key>
            <summary>Very wide rows -- 30M plus -- cause us OOME</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nputnam">Nate Putnam</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Wed, 5 Jan 2011 21:33:08 +0000</created>
                <updated>Fri, 20 Nov 2015 12:41:54 +0000</updated>
                            <resolved>Tue, 20 Sep 2011 22:31:01 +0000</resolved>
                                    <version>0.90.0</version>
                                    <fixVersion>0.90.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="12978016" author="nspiegelberg" created="Wed, 5 Jan 2011 22:56:34 +0000"  >&lt;p&gt;Note that you can limit the number of StoreFiles that can be compacted at one time...&lt;/p&gt;

&lt;p&gt;Store.java#204:  this.maxFilesToCompact =&lt;br/&gt;
conf.getInt(&quot;hbase.hstore.compaction.max&quot;, 10)&lt;/p&gt;

&lt;p&gt;30M * 10 SF == 300MB.  What is your RAM capacity?  You are likely stuck on an merging outlier that exists in every SF.  I would run:&lt;/p&gt;

&lt;p&gt;bin/hbase org.apache.hadoop.hbase.io.hfile.HFile -f &amp;lt;FILE_NAME&amp;gt; -p |sed &apos;s/V:.*$//g&apos;|less&lt;/p&gt;

&lt;p&gt;on the HFiles in that Store to see what your high watermark is.&lt;/p&gt;</comment>
                            <comment id="12978054" author="nspiegelberg" created="Thu, 6 Jan 2011 00:10:28 +0000"  >&lt;p&gt;For interested parties...&lt;/p&gt;

&lt;p&gt;From: Ted Yu&lt;br/&gt;
Hi,&lt;br/&gt;
I used the command you suggested in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3421&quot; title=&quot;Very wide rows -- 30M plus -- cause us OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3421&quot;&gt;&lt;del&gt;HBASE-3421&lt;/del&gt;&lt;/a&gt; on a table and got:&lt;/p&gt;

&lt;p&gt;K: 0012F2157E58883070B9814047048E8B/v:_/1283909035492/Put/vlen=1308 &lt;br/&gt;
K: 0041A80A545C4CBF412865412065BF5E/v:_/1283909035492/Put/vlen=1311 &lt;br/&gt;
K: 00546F4AA313020E551E049E848949C6/v:_/1283909035492/Put/vlen=1866 &lt;br/&gt;
K: 0068CC263C81CE65B65FC5425EFEBBCD/v:_/1283909035492/Put/vlen=1191 &lt;br/&gt;
K: 006DB8745D6D1B624F77E0F06C177C0B/v:_/1283909035492/Put/vlen=1021 &lt;br/&gt;
K: 006F9037BD7A8F081B54C5B03756C143/v:_/1283909035492/Put/vlen=1382 &lt;br/&gt;
...&lt;/p&gt;

&lt;p&gt;Can you briefly describe what conclusion can be drawn here ?&lt;/p&gt;

&lt;p&gt;~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~&lt;br/&gt;
From: Nicolas Spiegelberg&lt;/p&gt;

&lt;p&gt;You&apos;re basically seeing all the KeyValues in that HFile.  The format is basically:&lt;/p&gt;

&lt;p&gt;K: &amp;lt;KeyValue.toString()&amp;gt;&lt;/p&gt;

&lt;p&gt;If you look at KeyValue.toString(), you&apos;ll see that the format is roughly:&lt;/p&gt;

&lt;p&gt;row/family:qualifier/timestamp/type/value_length&lt;/p&gt;

&lt;p&gt;So, it looks like you only have one qualifier per row and each row is roughly ~1500 bytes of data.  For the user with the 30K columns per row, you should see an output that contains a ton of lines with the same row.  If you grep that row, cut the number after vlen=, and sum the values, you can see the size of your rows on a per-Hfile basis.&lt;/p&gt;</comment>
                            <comment id="13040082" author="tlipcon" created="Fri, 27 May 2011 06:33:40 +0000"  >&lt;p&gt;I think I&apos;m seeing this on one workload as well - I added a &quot;stats&quot; command for the HFile tool, then ran it on a problematic 1.5GB gzip-compressed HFile that won&apos;t compact due to OOME.&lt;/p&gt;

&lt;p&gt;Key length: count: 272358037    min: 59 max: 2259       mean: 59.620136732003246&lt;br/&gt;
Val length: count: 272358037    min: 0  max: 0  mean: 0.0&lt;br/&gt;
Row size (bytes): count: 1287745        min: 67 max: 15615127736        mean: 14301.657317248368&lt;br/&gt;
Row size (columns): count: 1287745      min: 1  max: 233061608  mean: 211.49997631518661&lt;/p&gt;

&lt;p&gt;so in this case there&apos;s actually a row with 233 million columns which takes up 15GB uncompressed!&lt;/p&gt;</comment>
                            <comment id="13040102" author="tlipcon" created="Fri, 27 May 2011 07:21:17 +0000"  >&lt;p&gt;Anyone foresee an issue with just using a limit of 10 KVs on the scan(kvs) call in the compaction loop? TestCompaction passes fine with that change.&lt;/p&gt;</comment>
                            <comment id="13040260" author="stack" created="Fri, 27 May 2011 14:41:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;Anyone foresee an issue with just using a limit of 10 KVs on the scan(kvs) call in the compaction loop?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No. Things might run imperceptibly slower.&lt;/p&gt;</comment>
                            <comment id="13105652" author="nputnam" created="Thu, 15 Sep 2011 20:05:36 +0000"  >&lt;p&gt;Been running in our prod cluster for a couple days without issue. &lt;/p&gt;</comment>
                            <comment id="13105660" author="yuzhihong@gmail.com" created="Thu, 15 Sep 2011 20:20:19 +0000"  >&lt;p&gt;A limit of 10 is used here. Should a config parameter be introduced for the limit ?&lt;/p&gt;</comment>
                            <comment id="13105766" author="nputnam" created="Thu, 15 Sep 2011 23:26:23 +0000"  >&lt;p&gt;Sure. I&apos;ll submit a new patch tomorrow. &lt;/p&gt;</comment>
                            <comment id="13108832" author="nputnam" created="Tue, 20 Sep 2011 17:08:20 +0000"  >&lt;p&gt;Added hbase.hstore.compaction.kv.max config option. &lt;/p&gt;</comment>
                            <comment id="13108844" author="yuzhihong@gmail.com" created="Tue, 20 Sep 2011 17:32:11 +0000"  >&lt;p&gt;Patch v2 looks good.&lt;br/&gt;
Minor comment: 10 should be replaced with new config below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-comment&quot;&gt;// Limit &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; to 10 to avoid OOME&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The patch doesn&apos;t apply on TRUNK.&lt;br/&gt;
Please prepare another patch for 0.92/TRUNK.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13108847" author="nputnam" created="Tue, 20 Sep 2011 17:35:56 +0000"  >&lt;p&gt;Clarify code comment. &lt;/p&gt;</comment>
                            <comment id="13108848" author="nputnam" created="Tue, 20 Sep 2011 17:36:36 +0000"  >&lt;p&gt;Clarify code comment. Grant a license this time &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;</comment>
                            <comment id="13108854" author="yuzhihong@gmail.com" created="Tue, 20 Sep 2011 17:46:34 +0000"  >&lt;p&gt;Patch v3 included changes to HBaseConfiguration.java&lt;br/&gt;
If I commit v3, Todd would kill me &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13108856" author="nputnam" created="Tue, 20 Sep 2011 17:49:06 +0000"  >&lt;p&gt;Sorry about that. My mistake, I should be more careful when creating patches. v4 is the winner. Thanks for your patience. &lt;/p&gt;</comment>
                            <comment id="13108864" author="yuzhihong@gmail.com" created="Tue, 20 Sep 2011 17:59:34 +0000"  >&lt;p&gt;+1 on patch v4.&lt;/p&gt;</comment>
                            <comment id="13108872" author="stack" created="Tue, 20 Sep 2011 18:05:58 +0000"  >&lt;p&gt;+1 on patch.&lt;/p&gt;</comment>
                            <comment id="13108979" author="yuzhihong@gmail.com" created="Tue, 20 Sep 2011 20:29:36 +0000"  >&lt;p&gt;Integrate to 0.90.5, 0.92 and TRUNK.&lt;/p&gt;

&lt;p&gt;Thanks for the patch Nate.&lt;/p&gt;

&lt;p&gt;Thanks for the review Michael.&lt;/p&gt;</comment>
                            <comment id="13109026" author="hudson" created="Tue, 20 Sep 2011 22:13:08 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2239 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2239/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2239/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3421&quot; title=&quot;Very wide rows -- 30M plus -- cause us OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3421&quot;&gt;&lt;del&gt;HBASE-3421&lt;/del&gt;&lt;/a&gt;  Very wide rows &amp;#8211; 30M plus &amp;#8211; cause us OOME (Nate Putnam)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13109109" author="hudson" created="Wed, 21 Sep 2011 00:01:31 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #6 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/6/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/6/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3421&quot; title=&quot;Very wide rows -- 30M plus -- cause us OOME&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3421&quot;&gt;&lt;del&gt;HBASE-3421&lt;/del&gt;&lt;/a&gt;  Very wide rows &amp;#8211; 30M plus &amp;#8211; cause us OOME (Nate Putnam)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13109243" author="yuzhihong@gmail.com" created="Wed, 21 Sep 2011 03:51:14 +0000"  >&lt;p&gt;Addendum fixes Store.FIXED_OVERHEAD&lt;/p&gt;</comment>
                            <comment id="15017103" author="lars_francke" created="Fri, 20 Nov 2015 12:41:54 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12508571">HBASE-3929</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12495318" name="3421.addendum" size="757" author="yuzhihong@gmail.com" created="Wed, 21 Sep 2011 03:51:14 +0000"/>
                            <attachment id="12494685" name="HBASE-3421.patch" size="776" author="nputnam" created="Thu, 15 Sep 2011 20:05:36 +0000"/>
                            <attachment id="12495242" name="HBASE-34211-v2.patch" size="1464" author="nputnam" created="Tue, 20 Sep 2011 17:09:27 +0000"/>
                            <attachment id="12495247" name="HBASE-34211-v3.patch" size="2293" author="nputnam" created="Tue, 20 Sep 2011 17:36:36 +0000"/>
                            <attachment id="12495249" name="HBASE-34211-v4.patch" size="1507" author="nputnam" created="Tue, 20 Sep 2011 17:49:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 5 Jan 2011 22:56:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26852</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i015w7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4724</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>A new config parameter, &amp;quot;hbase.hstore.compaction.kv.max&amp;quot;, has been added to limit the number of rows processed in each iteration of the internal compaction code.&lt;br/&gt;
Default value is 10.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>