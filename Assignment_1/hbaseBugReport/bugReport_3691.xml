<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:12:17 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3691/HBASE-3691.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3691] Add compressor support for &apos;snappy&apos;, google&apos;s compressor</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3691</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;http://code.google.com/p/snappy/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://code.google.com/p/snappy/&lt;/a&gt; is apache licensed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Snappy is a compression/decompression library. It does not aim for maximum compression, or compatibility with any other compression library; instead, it aims for very high speeds and reasonable compression. For instance, compared to the fastest mode of zlib, Snappy is an order of magnitude faster for most inputs, but the resulting compressed files are anywhere from 20% to 100% bigger. On a single core of a Core i7 processor in 64-bit mode, Snappy compresses at about 250 MB/sec or more and decompresses at about 500 MB/sec or more.&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;Snappy is widely used inside Google, in everything from BigTable and MapReduce to our internal RPC systems. (Snappy has previously been referred to as &quot;Zippy&quot; in some presentations and the likes.)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Lets get it in.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12502193">HBASE-3691</key>
            <summary>Add compressor support for &apos;snappy&apos;, google&apos;s compressor</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Wed, 23 Mar 2011 15:37:26 +0000</created>
                <updated>Thu, 2 May 2013 02:29:39 +0000</updated>
                            <resolved>Thu, 19 May 2011 23:01:16 +0000</resolved>
                                                    <fixVersion>0.90.7</fixVersion>
                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>4</votes>
                                    <watches>19</watches>
                                                                <comments>
                            <comment id="13010234" author="streamy" created="Wed, 23 Mar 2011 17:22:13 +0000"  >&lt;p&gt;It&apos;s slightly faster for both compression and decompression when compared to LZO (169/434 vs. 250/500).&lt;/p&gt;

&lt;p&gt;I&apos;m unsure of the difference in compression ratios but we can ship with it, yay&lt;/p&gt;</comment>
                            <comment id="13029278" author="nicktelford" created="Thu, 5 May 2011 11:00:15 +0000"  >&lt;p&gt;As far as I can tell this is all that&apos;s required in Hbase to add support for Snappy. Since it&apos;s an optional runtime dependency, and we can guarantee the class name (SnappyCodec) and it&apos;s interface (CompressionCodec) we&apos;re not actually blocked by the addition of the CompressionCodec itself (&lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7206&quot; title=&quot;Integrate Snappy compression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7206&quot;&gt;&lt;del&gt;HADOOP-7206&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;I&apos;ve tested this against the preliminary support for Snappy in &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-7206&quot; title=&quot;Integrate Snappy compression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-7206&quot;&gt;&lt;del&gt;HADOOP-7206&lt;/del&gt;&lt;/a&gt;, as far as I can tell they&apos;re simply waiting on some licensing constraints to be resolved (which doesn&apos;t affect this patch).&lt;/p&gt;</comment>
                            <comment id="13029279" author="nicktelford" created="Thu, 5 May 2011 11:00:50 +0000"  >&lt;p&gt;The patch itself.&lt;/p&gt;</comment>
                            <comment id="13029325" author="nicktelford" created="Thu, 5 May 2011 13:40:31 +0000"  >&lt;p&gt;Seems I&apos;d accidentally based the patch against 0.90.2, not trunk.&lt;/p&gt;

&lt;p&gt;Re-based against trunk.&lt;/p&gt;</comment>
                            <comment id="13029523" author="stack" created="Thu, 5 May 2011 19:29:36 +0000"  >&lt;p&gt;Nicolas: Any chance of a bit of doc. on what you did to make it work?  Add a sentence or two here and I&apos;ll add it over into &lt;a href=&quot;http://hbase.apache.org/book.html#compression&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hbase.apache.org/book.html#compression&lt;/a&gt; on commit.  Good stuff.&lt;/p&gt;</comment>
                            <comment id="13029905" author="kntreadway" created="Fri, 6 May 2011 12:00:23 +0000"  >&lt;p&gt;Thanks for the patch...I made a few additional changes in HColumnDescriptor, and I updated the test files to include snappy.&lt;/p&gt;

&lt;p&gt;I noticed there are places in the hbase.avro classes where snappy support would need to be added in. Is it ok to add these changes in the patch, or do the avro classes need to be auto-generated somehow?&lt;/p&gt;</comment>
                            <comment id="13029907" author="kntreadway" created="Fri, 6 May 2011 12:02:04 +0000"  >&lt;p&gt;Accidentally selected wrong license option.&lt;/p&gt;</comment>
                            <comment id="13030661" author="nicktelford" created="Mon, 9 May 2011 09:23:31 +0000"  >&lt;p&gt;Thanks Nichole, without your patch to HColumnDescriptor it wasn&apos;t possible to use snappy. I&apos;d only tested it using CompressionTest, which I see now is not a complete enough test: it only tests that compression on an HFile works, not that Column Families can use it.&lt;/p&gt;

&lt;p&gt;One thing that does concern me: it seems as though in your patch the Algorithm implementation for SNAPPY has moved places in the enum. From the comments it sounds like it should be added as the &lt;em&gt;last&lt;/em&gt; implementation to avoid breaking HFiles compressed with the other implementations. This looks like it may just be a merge glitch when you first applied my patch.&lt;/p&gt;

&lt;p&gt;Using Nichole&apos;s patch, the steps to getting Snappy working are currently:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Install hadoop-snappy using these instructions: &lt;a href=&quot;http://code.google.com/p/hadoop-snappy/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://code.google.com/p/hadoop-snappy/&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;You need to ensure the hadoop-snappy libs (incl. the native libs) are in the HBase classpath. Unless there are any other recommendations, I just symlinked the libs from HADOOP_HOME/lib to HBASE_HOME/lib. This needs to be done on all HBase nodes, as with LZO.&lt;/li&gt;
	&lt;li&gt;Use CompressionTest to verify snappy support is enabled and the libs can be loaded:
&lt;blockquote&gt;&lt;p&gt;$ hbase org.apache.hadoop.hbase.util.CompressionTest hdfs://host/path/to/hbase snappy&lt;/p&gt;&lt;/blockquote&gt;&lt;/li&gt;
	&lt;li&gt;Create a column family with snappy compression and verify it:
    &lt;blockquote&gt;&lt;p&gt;$ hbase shell&lt;br/&gt;
    &amp;gt; create &apos;t1&apos;, { NAME =&amp;gt; &apos;cf1&apos;, COMPRESSION =&amp;gt; &apos;snappy&apos; }&lt;br/&gt;
    &amp;gt; describe &apos;t1&apos;&lt;/p&gt;&lt;/blockquote&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;    In the output of the &quot;describe&quot; command, you need to ensure it lists &quot;COMPRESSION =&amp;gt; &apos;snappy&apos;&quot;&lt;/p&gt;</comment>
                            <comment id="13030671" author="nicktelford" created="Mon, 9 May 2011 09:50:31 +0000"  >&lt;p&gt;Moved Compression.Algorithm.SNAPPY to end of enum to retain backwards compatibility with existing HFiles.&lt;/p&gt;

&lt;p&gt;Otherwise, patch is same as 003&lt;/p&gt;</comment>
                            <comment id="13036558" author="stack" created="Thu, 19 May 2011 23:01:16 +0000"  >&lt;p&gt;Committed to TRUNK.  Thanks  Nicolas and Nichole for the patches.  Nicolas, I added your howto above to the book into the compression appendix.  Thanks.&lt;/p&gt;</comment>
                            <comment id="13037168" author="hudson" created="Sat, 21 May 2011 00:04:25 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1930 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/HBase-TRUNK/1930/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/HBase-TRUNK/1930/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="13038252" author="heitmann" created="Mon, 23 May 2011 21:41:05 +0000"  >&lt;p&gt;In the new instructions this:&lt;/p&gt;

&lt;p&gt;COMPRESSION =&amp;gt; &apos;snappy&apos;&lt;/p&gt;

&lt;p&gt;should be this:&lt;/p&gt;

&lt;p&gt;COMPRESSION =&amp;gt; &apos;SNAPPY&apos;&lt;/p&gt;</comment>
                            <comment id="13038260" author="stack" created="Mon, 23 May 2011 21:45:56 +0000"  >&lt;p&gt;Thanks John.  I fixed it in book (We should fix case sensitivity too for compressor names)&lt;/p&gt;</comment>
                            <comment id="13265059" author="waterson" created="Mon, 30 Apr 2012 17:58:41 +0000"  >&lt;p&gt;What is the likelihood that this could be back-ported to the 0.90.x branch?&lt;/p&gt;</comment>
                            <comment id="13265070" author="stack" created="Mon, 30 Apr 2012 18:11:34 +0000"  >&lt;p&gt;@Chris Have you tried the patch on 0.90?  Does it work for you?&lt;/p&gt;</comment>
                            <comment id="13265876" author="waterson" created="Tue, 1 May 2012 16:03:10 +0000"  >&lt;p&gt;Yes, I have.  I&apos;ve applied hbase-snappy-0.90.5.patch and it seems to be working on a small (but heavily loaded) HBase 0.90.6 cluster.&lt;/p&gt;</comment>
                            <comment id="13265877" author="waterson" created="Tue, 1 May 2012 16:03:55 +0000"  >&lt;p&gt;Urg, &quot;I&apos;ve applied hbase-snappy-0.90.6.patch...&quot;&lt;/p&gt;</comment>
                            <comment id="13265986" author="stack" created="Tue, 1 May 2012 19:12:55 +0000"  >&lt;p&gt;Applied to 0.90 branch.&lt;/p&gt;</comment>
                            <comment id="13266074" author="zhihyu@ebaysf.com" created="Tue, 1 May 2012 20:47:09 +0000"  >&lt;p&gt;This test failure might be related:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Running org.apache.hadoop.hbase.util.TestCompressionTest
Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.028 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13266093" author="stack" created="Tue, 1 May 2012 21:00:49 +0000"  >&lt;p&gt;Removed snappy test; the plumbing is not usually in place (Thanks for noticing Ted)&lt;/p&gt;</comment>
                            <comment id="13266094" author="stack" created="Tue, 1 May 2012 21:01:02 +0000"  >&lt;p&gt;Applied addendum to 0.90 branch.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12502119">HADOOP-7206</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12506738">HBASE-3873</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12525219" name="3691-addendum.txt" size="673" author="stack" created="Tue, 1 May 2012 21:00:49 +0000"/>
                            <attachment id="12525180" name="hbase-snappy-0.90.6.patch" size="5466" author="waterson" created="Tue, 1 May 2012 16:03:10 +0000"/>
                            <attachment id="12478273" name="hbase-snappy-3691-trunk-002.patch" size="1145" author="nicktelford" created="Thu, 5 May 2011 13:40:31 +0000"/>
                            <attachment id="12478404" name="hbase-snappy-3691-trunk-003.patch" size="5647" author="kntreadway" created="Fri, 6 May 2011 12:02:04 +0000"/>
                            <attachment id="12478578" name="hbase-snappy-3691-trunk-004.patch" size="5631" author="nicktelford" created="Mon, 9 May 2011 09:50:31 +0000"/>
                            <attachment id="12478267" name="hbase-snappy-3691-trunk.patch" size="1180" author="nicktelford" created="Thu, 5 May 2011 11:00:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 23 Mar 2011 17:22:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33150</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 33 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i015wf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4725</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Added support for Google&amp;#39;s Snappy compression codec.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>