<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:50:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7893/HBASE-7893.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7893] hbase.hregion.majorcompaction not taking effect.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7893</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;For disabling auto major compaction, I configured hbase.hregion.majorcompaction = 0 in the config file and restarted the cluster. In spite of this, major compaction continues to run everyday. Here is the config I set:&lt;/p&gt;

&lt;p&gt;&amp;lt;property&amp;gt;&lt;br/&gt;
  &amp;lt;name&amp;gt;hbase.hregion.majorcompaction&amp;lt;/name&amp;gt;&lt;br/&gt;
  &amp;lt;value&amp;gt;0&amp;lt;/value&amp;gt;&lt;br/&gt;
&amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;What other way can I disable auto major compaction? I expected this config to work. What am I doing wrong here? &lt;/p&gt;

&lt;p&gt;Please advice. Thanks a lot.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux &amp;lt;hostname&amp;gt; 2.6.21.7-2.fc8xen-ec2-v1.0 #1 SMP Tue Sep 1 10:25:30 EDT 2009 x86_64 x86_64 x86_64 GNU/Linux&lt;br/&gt;
Fedora release 8 (Werewolf)&lt;/p&gt;</environment>
        <key id="12633362">HBASE-7893</key>
            <summary>hbase.hregion.majorcompaction not taking effect.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="posharma">Pranav Sharma</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Feb 2013 09:45:33 +0000</created>
                <updated>Thu, 28 Mar 2013 03:23:18 +0000</updated>
                            <resolved>Thu, 28 Mar 2013 03:23:18 +0000</resolved>
                                    <version>0.92.2</version>
                                                    <component>Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13583110" author="anoopsamjohn" created="Thu, 21 Feb 2013 11:17:42 +0000"  >&lt;p&gt;A normal compaction can get promoted as a major compaction.&lt;/p&gt;</comment>
                            <comment id="13583272" author="jmspaggi" created="Thu, 21 Feb 2013 15:29:48 +0000"  >&lt;p&gt;Is this related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2559&quot; title=&quot;Set hbase.hregion.majorcompaction to 0 to disable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2559&quot;&gt;&lt;del&gt;HBASE-2559&lt;/del&gt;&lt;/a&gt;? I will mark as duplicate and comment in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2559&quot; title=&quot;Set hbase.hregion.majorcompaction to 0 to disable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2559&quot;&gt;&lt;del&gt;HBASE-2559&lt;/del&gt;&lt;/a&gt; to get it done in 0.94.x branch too...&lt;/p&gt;</comment>
                            <comment id="13583281" author="jmspaggi" created="Thu, 21 Feb 2013 15:33:27 +0000"  >&lt;p&gt;Please disregard what I just said. Sorry. It&apos;s there in 0.90.0. Mixed up with 0.96.0&lt;/p&gt;</comment>
                            <comment id="13583547" author="posharma" created="Thu, 21 Feb 2013 21:02:42 +0000"  >&lt;p&gt;Hi Anoop, based on your comment, does that mean the configuration of hbase.hregion.majorcompaction=0 is irrelevant? Please advice. Thanks.&lt;/p&gt;</comment>
                            <comment id="13583692" author="sershe" created="Thu, 21 Feb 2013 23:57:56 +0000"  >&lt;p&gt;The configuration is still relevant for when the system chooses to force major compaction...&lt;br/&gt;
I think what happens is that the system picks best files for minor compaction, and it turns out that it&apos;s all files, so it is marked major. Can you post logs/how you found about major compaction? &lt;/p&gt;</comment>
                            <comment id="13583844" author="posharma" created="Fri, 22 Feb 2013 02:43:40 +0000"  >&lt;p&gt;I saw the following line in the log file: 2013-02-18 23:53:29,652 INFO org.apache.hadoop.hbase.regionserver.Store: Completed major compaction of 3 file(s) in &amp;lt;blah&amp;gt;, size=61.8m; total size for store is 61.8m&lt;/p&gt;

&lt;p&gt;Also, from my cursory look at this piece of code in Store.java:requestCompaction, it doesn&apos;t look like it is honoring the config at all. &lt;/p&gt;

&lt;p&gt;				// major compaction iff all StoreFiles are included&lt;br/&gt;
				boolean isMajor = (filesToCompact.size() == this.storefiles.size());&lt;br/&gt;
				if (isMajor) &lt;/p&gt;
{
					// since we&apos;re enqueuing a major, update the compaction wait interval
					this.forceMajor = false;
					this.majorCompactionTime = getNextMajorCompactTime();
				}

&lt;p&gt;				// everything went better than expected. create a compaction request&lt;br/&gt;
				int pri = getCompactPriority(priority);&lt;br/&gt;
				ret = new CompactionRequest(region, this, filesToCompact, isMajor, pri);&lt;/p&gt;</comment>
                            <comment id="13583879" author="anoopsamjohn" created="Fri, 22 Feb 2013 03:43:54 +0000"  >&lt;p&gt;Yes when minor compaction selects all files under the store, this is promoted as a major compaction. This promotion can happen irrespective of the config value. This config value is used to decided when an auto major compaction work should be done in the system. You experiencing some problem with this major compaction?&lt;/p&gt;</comment>
                            <comment id="13583881" author="ram_krish" created="Fri, 22 Feb 2013 03:46:47 +0000"  >&lt;p&gt;To really know if major compaction is happening or not, one way is to if any compaction is getting triggered every 24 hours.&lt;br/&gt;
The logs that you attached will have some logs before them that will indicate whether it was really a direct major comapction or a minor compaction promoted to  major.&lt;/p&gt;</comment>
                            <comment id="13583949" author="posharma" created="Fri, 22 Feb 2013 06:12:05 +0000"  >&lt;p&gt;Major compactions (promoted or otherwise) interfere with long running jobs causing the region server to die. I thought this config would disable major compactions altogether.   &lt;/p&gt;</comment>
                            <comment id="13583952" author="ram_krish" created="Fri, 22 Feb 2013 06:15:26 +0000"  >&lt;p&gt;I still don think the minor getting promoted to major compaction should not kill your RS.  It may cause more IO to take place.&lt;br/&gt;
Is the RS suffering from full GC when this happens?&lt;/p&gt;</comment>
                            <comment id="13583954" author="anoopsamjohn" created="Fri, 22 Feb 2013 06:16:17 +0000"  >&lt;p&gt;As per your log sample, it was a minor compaction on all the store files. Now the extra work as part of major compaction will be to deal with the delete markers. That makes RS to die?&lt;br/&gt;
I agree that the long running major compaction on all the files (large number) interfere with your job. That is why you dont want that to happen automatically in your system (You might be doing this manually)&lt;/p&gt;</comment>
                            <comment id="13583956" author="anoopsamjohn" created="Fri, 22 Feb 2013 06:17:11 +0000"  >&lt;p&gt;Oh Ram and Me commenting at the same time with the same question. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13585622" author="posharma" created="Mon, 25 Feb 2013 04:50:24 +0000"  >&lt;p&gt;Hi Anoop, Ram: I&apos;ve attached 2 log files - one of the master and one of the region server that died. I&apos;m not sure if this is due to major compaction, but you can see that major compaction took place several hundred times. Before the region server died, I see in the master that a log split was going on. Could the death be due to the region split? Thanks.&lt;/p&gt;</comment>
                            <comment id="13585626" author="posharma" created="Mon, 25 Feb 2013 05:04:11 +0000"  >&lt;p&gt;I&apos;ve zookeeper.session.timeout=180000 and &lt;br/&gt;
export HBASE_REGIONSERVER_OPTS=&quot;-Xms1000m -Xmx8000m -Xmn256m -XX:+UseConcMarkSweepGC -XX:CMSInitiatingOccupancyFraction=70 -XX:+AggressiveOpts -verbose:gc -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -Xloggc:/mnt/hbase/logs/hbase-regionserver-gc.log&quot;&lt;/p&gt;</comment>
                            <comment id="13585787" author="anoopsamjohn" created="Mon, 25 Feb 2013 10:37:33 +0000"  >&lt;p&gt;I can see in this RS log that it is getting YouAreDeadException from Master. Also ZK session timeout exceptions present. Can you check the GC for this process. Is this suffering from long full GCs? &lt;/p&gt;</comment>
                            <comment id="13585791" author="ram_krish" created="Mon, 25 Feb 2013 10:46:01 +0000"  >&lt;p&gt;Yes it should be GC problem. Lot of timeouts from HDFS side also. &lt;/p&gt;</comment>
                            <comment id="13586960" author="posharma" created="Tue, 26 Feb 2013 09:28:47 +0000"  >&lt;p&gt;Yes, it is quite possible that GC times are very long. For e.g. in the logs, I found no activity between &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;2013-02-24 07:19:25 and 2013-02-24 07:28:57&lt;/li&gt;
	&lt;li&gt;2013-02-24 07:44:20,332 and 2013-02-24 08:18:41,943&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ve posted my GC config above. Do you have any other suggestions in tuning the GC? Thanks.&lt;/p&gt;</comment>
                            <comment id="13610115" author="anoopsamjohn" created="Fri, 22 Mar 2013 10:41:46 +0000"  >&lt;p&gt;IMO we can close this issue. It is not dealing with any bugs. The GC issues should be solved by proper tuning of your system. What others say?&lt;/p&gt;</comment>
                            <comment id="13615579" author="sershe" created="Wed, 27 Mar 2013 18:14:49 +0000"  >&lt;p&gt;+1 to close...&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12570726" name="hbase-hadoop-master-ip-10-118-138-149.log" size="2935817" author="posharma" created="Mon, 25 Feb 2013 04:50:24 +0000"/>
                            <attachment id="12570725" name="hbase-hadoop-regionserver-ip-10-118-187-126.log" size="4351910" author="posharma" created="Mon, 25 Feb 2013 04:50:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 21 Feb 2013 11:17:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313858</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 38 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1i5tr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>314203</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>