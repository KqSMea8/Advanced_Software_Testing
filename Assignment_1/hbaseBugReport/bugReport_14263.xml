<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:51:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14263/HBASE-14263.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14263] ExploringCompactionPolicy logic around file selection is broken</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14263</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;It seems that logic around selection of store file candidates is broken:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-comment&quot;&gt;// Compute the total size of files that will
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// have to be read &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; set of files is compacted.
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; size = getTotalStoreSize(potentialMatchFiles);
        &lt;span class=&quot;code-comment&quot;&gt;// Store the smallest set of files.  This stored set of files will be used
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it looks like the algorithm is stuck.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (mightBeStuck &amp;amp;&amp;amp; size &amp;lt; smallestSize) {
          smallest = potentialMatchFiles;
          smallestSize = size;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (size &amp;gt; comConf.getMaxCompactSize()) {
          &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
        }

        ++opts;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (size &amp;gt;= comConf.getMinCompactSize()
            &amp;amp;&amp;amp; !filesInRatio(potentialMatchFiles, currentRatio)) {
          &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is from applyCompactionPolicy method. As you can see, both min compaction size and max compaction size are applied to a &lt;b&gt;selection&lt;/b&gt; of files and not to individual files. It mostly works as expected only because nobody seems using non-default hbase.hstore.compaction.max.size, which is  Long.MAX_VALUE  and  it  is not  that  easy  to  figure out  what  is  going  on  on an opposite side (why small files do not get included?)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12857367">HBASE-14263</key>
            <summary>ExploringCompactionPolicy logic around file selection is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="vrodionov">Vladimir Rodionov</assignee>
                                    <reporter username="vrodionov">Vladimir Rodionov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Aug 2015 00:00:24 +0000</created>
                <updated>Thu, 27 Aug 2015 20:53:12 +0000</updated>
                            <resolved>Thu, 27 Aug 2015 20:48:19 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14704018" author="vrodionov" created="Thu, 20 Aug 2015 00:02:37 +0000"  >&lt;p&gt;Basically, the current implementation won&apos;t work for custom max file size (&lt;b&gt;hbase.hstore.compaction.max.size&lt;/b&gt;) and it does not work as expected doing selection on a small store files (smaller than &lt;b&gt;hbase.hstore.compaction.min.size&lt;/b&gt;). &lt;/p&gt;</comment>
                            <comment id="14704279" author="vrodionov" created="Thu, 20 Aug 2015 04:40:47 +0000"  >&lt;p&gt;Patch for master.&lt;/p&gt;</comment>
                            <comment id="14705379" author="stack" created="Thu, 20 Aug 2015 17:38:06 +0000"  >&lt;p&gt;Patch looks reasonable mighty &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vrodionov&quot; class=&quot;user-hover&quot; rel=&quot;vrodionov&quot;&gt;Vladimir Rodionov&lt;/a&gt; Any chance of our getting a test in here so can guard against regression? Thanks.&lt;/p&gt;</comment>
                            <comment id="14705536" author="vrodionov" created="Thu, 20 Aug 2015 18:47:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;, Existing tests are not enough? Not sure, what type of regression we could test on. Will think about this.  &lt;/p&gt;</comment>
                            <comment id="14717365" author="vrodionov" created="Thu, 27 Aug 2015 19:30:50 +0000"  >&lt;p&gt;Having thought about current interpretation of &lt;b&gt;hbase.hstore.compaction.max.size&lt;/b&gt; and &lt;b&gt;hbase.hstore.compaction.min.size&lt;/b&gt; in ExploringCompactionPolicy as a limits for selection size not a single file size - I like it more, I think this makes more sense than limiting single file. I would leave everything as is and change compaction section (description of these config parameters) in HBase book. &lt;/p&gt;</comment>
                            <comment id="14717369" author="vrodionov" created="Thu, 27 Aug 2015 19:34:33 +0000"  >&lt;p&gt;By setting &lt;b&gt;hbase.hstore.compaction.max.size&lt;/b&gt; we limit &lt;b&gt;total&lt;/b&gt; size of a minor compaction, it makes sense when we try to minimize impact during peak hours. By setting  &lt;b&gt;hbase.hstore.compaction.min.size&lt;/b&gt; we automatically include selections lower that this value into selection candidate list, without applying to a selection file ratio test - make sense for small new files, right after flush.&lt;/p&gt;</comment>
                            <comment id="14717404" author="vrodionov" created="Thu, 27 Aug 2015 19:56:31 +0000"  >&lt;p&gt;I think we need to change wording/definition of these config parameters in HBase book, they are misleading:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;hbase.hstore.compaction.min.size&lt;br/&gt;
Description&lt;br/&gt;
A StoreFile smaller than this size will always be eligible for minor compaction. HFiles this size or larger are evaluated by hbase.hstore.compaction.ratio to determine if they are eligible. Because this limit represents the &quot;automatic include&quot;limit for all StoreFiles smaller than this value, this value may need to be reduced in write-heavy environments where many StoreFiles in the 1-2 MB range are being flushed, because every StoreFile will be targeted for compaction and the resulting StoreFiles may still be under the minimum size and require further compaction. If this parameter is lowered, the ratio check is triggered more quickly. This addressed some issues seen in earlier versions of HBase but changing this parameter is no longer necessary in most situations. Default: 128 MB expressed in bytes.&lt;/p&gt;

&lt;p&gt;Default&lt;br/&gt;
134217728&lt;/p&gt;

&lt;p&gt;hbase.hstore.compaction.max.size&lt;br/&gt;
Description&lt;br/&gt;
A StoreFile larger than this size will be excluded from compaction. The effect of raising hbase.hstore.compaction.max.size is fewer, larger StoreFiles that do not get compacted often. If you feel that compaction is happening too often without much benefit, you can try raising this value. Default: the value of LONG.MAX_VALUE, expressed in bytes.&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="14717496" author="hadoopqa" created="Thu, 27 Aug 2015 20:46:25 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12751409/HBASE-14263.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12751409/HBASE-14263.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 8f95318f6252c1c0b7a073619525eae6d991f47b.&lt;br/&gt;
  ATTACHMENT ID: 12751409&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestDefaultCompactSelection&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15304//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15304//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15304//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15304//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15304//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15304//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15304//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15304//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14717500" author="vrodionov" created="Thu, 27 Aug 2015 20:48:20 +0000"  >&lt;p&gt;Invalid. I will open doc JIRA instead.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12859711">HBASE-14326</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12751409" name="HBASE-14263.patch" size="1451" author="vrodionov" created="Thu, 20 Aug 2015 04:40:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 20 Aug 2015 17:38:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 16 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j4o7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>