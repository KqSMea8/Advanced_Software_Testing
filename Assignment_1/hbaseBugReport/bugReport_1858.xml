<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:56:58 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1858/HBASE-1858.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1858] Master can&apos;t split logs created by THBase</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1858</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When master tries to split logs created by THbase, it fails because it tries to read in the wrong key type. (THBase subclasses HLogKey to add fields to the key).&lt;/p&gt;

&lt;p&gt;2009-09-16 09:03:01,943 WARN org.apache.hadoop.hbase.regionserver.HLog:&lt;br/&gt;
Exception processing&lt;br/&gt;
hdfs://domU-12-31-39-07-CC-A2.compute-1.internal:9000/hbase/.logs/domU-12-31-39-07-CC-A2.compute-1.internal,60020,1253103101743/hlog.dat.1253103102168&lt;br/&gt;
&amp;#8211; continuing. Possible DATA LOSS!&lt;br/&gt;
java.io.IOException: wrong key class:&lt;br/&gt;
org.apache.hadoop.hbase.regionserver.HLogKey is not class&lt;br/&gt;
org.apache.hadoop.hbase.regionserver.transactional.THLogKey&lt;br/&gt;
       at&lt;br/&gt;
org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:1824)&lt;br/&gt;
       at&lt;br/&gt;
org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:1876)&lt;br/&gt;
       at org.apache.hadoop.hbase.regionserver.HLog.splitLog(HLog.java:880)&lt;br/&gt;
       at org.apache.hadoop.hbase.regionserver.HLog.splitLog(HLog.java:802)&lt;br/&gt;
       at&lt;br/&gt;
org.apache.hadoop.hbase.master.ProcessServerShutdown.process(ProcessServerShutdown.java:274)&lt;br/&gt;
       at&lt;br/&gt;
org.apache.hadoop.hbase.master.HMaster.processToDoQueue(HMaster.java:492)&lt;br/&gt;
       at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:426)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12436324">HBASE-1858</key>
            <summary>Master can&apos;t split logs created by THBase</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="clint.morgan">Clint Morgan</assignee>
                                    <reporter username="clint.morgan">Clint Morgan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Sep 2009 17:51:14 +0000</created>
                <updated>Fri, 20 Nov 2015 13:02:00 +0000</updated>
                            <resolved>Sat, 26 Sep 2009 21:20:40 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.1</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12758491" author="stack" created="Tue, 22 Sep 2009 23:29:27 +0000"  >&lt;p&gt;Do you have a fix for this Clint?&lt;/p&gt;</comment>
                            <comment id="12758521" author="clint.morgan" created="Wed, 23 Sep 2009 01:00:46 +0000"  >&lt;p&gt;I have a fix for this (define the HLogKey class in the conf), but I&apos;ve found some other issues with restoring from trx log that I&apos;m working on. &lt;/p&gt;

&lt;p&gt;Should have something by tomorrow.&lt;/p&gt;</comment>
                            <comment id="12759260" author="clint.morgan" created="Thu, 24 Sep 2009 21:01:41 +0000"  >&lt;p&gt;This patch clean up the transaction WALing, and makes it work. &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Introduce config property &quot;hbase.regionserver.hlog.keyclass&quot; which is used to instantiate keys.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;When we commit a transaction, we let the puts/deletes go into the normal WAL. This way, they are handled normally during recovery. The only time we need to do special WAL recovery in the transactional layer is when we find a transaction that started, but does not have an commit or abort message. In this case, its status should be in the &quot;global&quot; trx log.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Clean up the use of the &quot;global&quot; transaction log. This holds the state of a transaction while the transaction is still in-process. This state can be forgotten after a successful commit/abort. This state is only used when we recover from the WAL and don&apos;t know what actually happened to the transaction.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ports HbaseBackTransactionalLogger to the new API.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;fixes a bug: when multiple puts in the same transaction to the same cell, make the last put should be used for a trx-local get.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I tested the WAL recovery and it works for me.&lt;/p&gt;</comment>
                            <comment id="12759323" author="clint.morgan" created="Thu, 24 Sep 2009 23:27:33 +0000"  >&lt;p&gt;Forgot to update the test. All tests now pass.&lt;/p&gt;</comment>
                            <comment id="12759827" author="apurtell" created="Sat, 26 Sep 2009 00:13:45 +0000"  >&lt;p&gt;+1 will commit if all tests pass. &lt;/p&gt;</comment>
                            <comment id="12759847" author="apurtell" created="Sat, 26 Sep 2009 01:58:49 +0000"  >&lt;p&gt;Committed to trunk only. TestTHLogRecovery fails for me on 0.20:
&lt;br class=&quot;atl-forced-newline&quot; /&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Testcase: testWithoutFlush took 30.077 sec
Caused an ERROR
java.io.IOException: Only Puts in BU as of 0.20.0
java.lang.RuntimeException: java.io.Exception: Only Puts in BU as of 0.20.0
at org.apache.hadoop.hbase.client.transactional.HBaseBackedTransactionLogger.forgetTransaction
(HBaseBackedTransactionLogger.java:136)
at org.apache.hadoop.hbase.client.transactional.TransactionManager.doCommit
(TransactionManager.java:192)
at org.apache.hadoop.hbase.client.transactional.TransactionManager.tryCommit
(TransactionManager.java:154)
at org.apache.hadoop.hbase.regionserver.transactional.TestTHLogRecovery.testWithoutFlush
(TestTHLogRecovery.java:118)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12759945" author="stack" created="Sat, 26 Sep 2009 20:26:12 +0000"  >&lt;p&gt;Backporting Jon&apos;s fixes to TestTHLogRecover in trunk where he updates to new API seems to make it pass the test.  I&apos;m running all tests now.&lt;/p&gt;</comment>
                            <comment id="12759953" author="stack" created="Sat, 26 Sep 2009 21:20:40 +0000"  >&lt;p&gt;Applied to branch.  Closing.  Thanks for the patch Clint.&lt;/p&gt;</comment>
                            <comment id="12907260" author="gstathis" created="Wed, 8 Sep 2010 15:38:17 +0000"  >&lt;p&gt;Folks, unless there is something special that needs to be done when configuring transactional tables, it unfortunately seems that this problem is still occurring in 0.20.3:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2010-08-27 15:53:06,030 DEBUG regionserver.HLog - Splitting hlog 2 of 31: hdfs://domU-12-31-39-18-19-65.compute-1.internal:9000/hbase/.logs/domU-12-31-39-18-15-24.compute-1.internal,60020,1282782970585/
hlog.dat.1282798940318, length=9831249
2010-08-27 15:53:06,033 DEBUG regionserver.HLog - IOE Pushed=0 entries from hdfs://domU-12-31-39-18-19-65.compute-1.internal:9000/hbase/.logs/domU-12-31-39-18-15-24.compute-1.internal,60020,128278297058
5/hlog.dat.1282798940318
2010-08-27 15:53:06,033 WARN  regionserver.HLog - Exception processing hdfs://domU-12-31-39-18-19-65.compute-1.internal:9000/hbase/.logs/domU-12-31-39-18-15-24.compute-1.internal,60020,1282782970585/hlo
g.dat.1282798940318 -- continuing. Possible DATA LOSS!
java.io.IOException: wrong key class: org.apache.hadoop.hbase.regionserver.HLogKey is not class org.apache.hadoop.hbase.regionserver.transactional.THLogKey
	at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:1824)
	at org.apache.hadoop.io.SequenceFile$Reader.next(SequenceFile.java:1876)
	at org.apache.hadoop.hbase.regionserver.HLog.splitLog(HLog.java:966)
	at org.apache.hadoop.hbase.regionserver.HLog.splitLog(HLog.java:872)
	at org.apache.hadoop.hbase.master.ProcessServerShutdown.process(ProcessServerShutdown.java:286)
	at org.apache.hadoop.hbase.master.HMaster.processToDoQueue(HMaster.java:494)
	at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:429)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m not sure though that the &quot;define the HLogKey class in the conf&quot; part means, so I might be missing that...&lt;/p&gt;</comment>
                            <comment id="12908936" author="jk-public@troove.net" created="Mon, 13 Sep 2010 19:09:57 +0000"  >&lt;p&gt;You do need to specify the HLogKey instance in hour config:&lt;/p&gt;

&lt;p&gt;&amp;lt;property&amp;gt;&lt;br/&gt;
	    &amp;lt;name&amp;gt;hbase.regionserver.hlog.keyclass&amp;lt;/name&amp;gt;&lt;br/&gt;
	    &amp;lt;value&amp;gt;org.apache.hadoop.hbase.regionserver.transactional.THLogKey&amp;lt;/value&amp;gt;&lt;br/&gt;
&amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;I apologize for the poor documentation in the hbase-transactional-indexed project.  It is not mature yet though we have significant updates going in soon that&lt;br/&gt;
are compatible with HBase 0.89.  Note that in that version you will NOT need to specify THLogKey in the config.&lt;/p&gt;
</comment>
                            <comment id="12909006" author="gstathis" created="Mon, 13 Sep 2010 21:21:34 +0000"  >&lt;p&gt;James, do you know if I can make the hbase.regionserver.hlog.keyclass config change on a cluster that already has transactional tables with data in them or do I need some sort of data conversion process now?&lt;/p&gt;</comment>
                            <comment id="12909058" author="jk-public@troove.net" created="Tue, 14 Sep 2010 00:09:50 +0000"  >&lt;p&gt;Well the THLog.class does overwrite the read/write serialization methods to add it&apos;s own fields. So if you&apos;ve already serialized HLogs you may run into trouble.&lt;/p&gt;

&lt;p&gt;I can say for sure though what will happen without digging further.&lt;br/&gt;
I suggest you try without conversion and see what happens.&lt;br/&gt;
Backup your data first though.&lt;/p&gt;</comment>
                            <comment id="15017951" author="lars_francke" created="Fri, 20 Nov 2015 13:02:00 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12420511" name="1858-v2.patch" size="24003" author="clint.morgan" created="Thu, 24 Sep 2009 23:27:33 +0000"/>
                            <attachment id="12420487" name="1858.patch" size="21638" author="clint.morgan" created="Thu, 24 Sep 2009 21:01:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 22 Sep 2009 23:29:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26021</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hfnb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99797</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>