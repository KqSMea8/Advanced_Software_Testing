<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:25:16 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5155/HBASE-5155.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5155] ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5155</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;ServerShutDownHandler and disable/delete table handler races.  This is not an issue due to TM.&lt;br/&gt;
-&amp;gt; A regionserver goes down.  In our cluster the regionserver holds lot of regions.&lt;br/&gt;
-&amp;gt; A region R1 has two daughters D1 and D2.&lt;br/&gt;
-&amp;gt; The ServerShutdownHandler gets called and scans the META and gets all the user regions&lt;br/&gt;
-&amp;gt; Parallely a table is disabled. (No problem in this step).&lt;br/&gt;
-&amp;gt; Delete table is done.&lt;br/&gt;
-&amp;gt; The tables and its regions are deleted including R1, D1 and D2.. (So META is cleaned)&lt;br/&gt;
-&amp;gt; Now ServerShutdownhandler starts to processTheDeadRegion&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hri.isOffline() &amp;amp;&amp;amp; hri.isSplit()) {
      LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Offlined and split region &quot;&lt;/span&gt; + hri.getRegionNameAsString() +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;; checking daughter presence&quot;&lt;/span&gt;);
      fixupDaughters(result, assignmentManager, catalogTracker);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As part of fixUpDaughters as the daughers D1 and D2 is missing for R1 &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isDaughterMissing(catalogTracker, daughter)) {
      LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Fixup; missing daughter &quot;&lt;/span&gt; + daughter.getRegionNameAsString());
      MetaEditor.addDaughter(catalogTracker, daughter, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);

      &lt;span class=&quot;code-comment&quot;&gt;// TODO: Log WARN &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the regiondir does not exist in the fs.  If its not
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// there then something wonky about the split -- things will keep going
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// but could be missing references to parent region.
&lt;/span&gt;
      &lt;span class=&quot;code-comment&quot;&gt;// And assign it.
&lt;/span&gt;      assignmentManager.assign(daughter, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;we call assign of the daughers.  &lt;br/&gt;
Now after this we again start with the below code.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (processDeadRegion(e.getKey(), e.getValue(),
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getAssignmentManager(),
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.getCatalogTracker())) {
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getAssignmentManager().assign(e.getKey(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now when the SSH scanned the META it had R1, D1 and D2.&lt;br/&gt;
So as part of the above code D1 and D2 which where assigned by fixUpDaughters&lt;br/&gt;
is again assigned by &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getAssignmentManager().assign(e.getKey(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Thus leading to a zookeeper issue due to bad version and killing the master.&lt;br/&gt;
The important part here is the regions that were deleted are recreated which i think is more critical.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12537741">HBASE-5155</key>
            <summary>ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="ram_krish">ramkrishna.s.vasudevan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Jan 2012 13:16:52 +0000</created>
                <updated>Sat, 10 Jan 2015 02:15:58 +0000</updated>
                            <resolved>Sat, 10 Jan 2015 02:15:58 +0000</resolved>
                                    <version>0.90.4</version>
                                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13182648" author="ram_krish" created="Mon, 9 Jan 2012 17:23:50 +0000"  >&lt;p&gt;Can we prevent disable and delete table from happening if ServerShutDownHandler is in progress?&lt;/p&gt;</comment>
                            <comment id="13182653" author="zhihyu@ebaysf.com" created="Mon, 9 Jan 2012 17:30:55 +0000"  >&lt;p&gt;Then we need to detect whether the table being deleted/disabled has region on the underlying server.&lt;/p&gt;</comment>
                            <comment id="13182715" author="zhihyu@ebaysf.com" created="Mon, 9 Jan 2012 19:07:00 +0000"  >&lt;p&gt;I think Ram&apos;s question @ 09/Jan/12 17:23 hints at introducing synchronization between DeleteTableHandler and ServerShutdownhandler.&lt;/p&gt;</comment>
                            <comment id="13182932" author="stack" created="Mon, 9 Jan 2012 23:43:52 +0000"  >&lt;p&gt;@Ram Nice one.  Do you have a snippet of log that shows this?&lt;/p&gt;

&lt;p&gt;So, ServerShutdownHandler should be checking if table is disabled before it does either fixup or assign?  (Thats what the check of (hri.isOffline()...) is supposed to be doing only the enable/disable semantic changed so that now when a table is disabled, we now set a flag for the table in zk rather than do it individually on each region; i.e. offline it).&lt;/p&gt;

&lt;p&gt;Or, are you saying the table was completely deleted when servershutdownhandler started to run?  If so, then the create of the region should fail; we should make sure that if the parent table directory not present, then the we should not be able to create region subdirs.  We&apos;d need a mkdir that did not do a recursive create (we need newer hadoop/hdfs for this?)&lt;/p&gt;

&lt;p&gt;On the question of synchronization between DeleteTableHandler and ServerShutdownHandler, yes, we need to have all threads in master coordinate around state changes whether the balancer thread, servershutdownhander executor thread, incoming splits, etc.  I&apos;d like to put up a harness in which we can repro all these race conditions... HBase-3154 helps with this (the test included shows how to mock a balance and a server shutdown handler &amp;#8211; would need to make them interleave or have them reproduce this issue &amp;#8211; the log would help with reproducing the event sequence).&lt;/p&gt;</comment>
                            <comment id="13183122" author="ram_krish" created="Tue, 10 Jan 2012 07:09:09 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2012-01-10 11:43:34,303 INFO org.apache.hadoop.hbase.master.ServerManager: Received REGION_SPLIT: j9t6,,1326109762514.adcbae41a5024c60c72f5752c6e1c8d4.: Daughters; j9t6,,1326176002507.49c3665a4bc656f3f6473659b64798f7., j9t6,23443]5767435g,1326176002507.0b96b5ed4c0426d3b3f13e586179c9bc. from linux-129,60020,1326175677339




2012-01-10 12:05:19,122 INFO org.apache.hadoop.hbase.master.handler.ServerShutdownHandler: Splitting logs &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; linux-129,60020,1326175677339
2012-01-10 12:06:07,153 DEBUG org.apache.hadoop.hbase.master.HMaster: Not running balancer because processing dead regionserver(s): [linux-129,60020,1326175677339]
2012-01-10 12:09:57,865 INFO org.apache.hadoop.hbase.master.handler.ServerShutdownHandler: Reassigning 7 region(s) that linux-129,60020,1326175677339 was carrying (skipping 0 regions(s) that are already in transition)




2012-01-10 12:11:30,988 INFO org.apache.hadoop.hbase.master.handler.DisableTableHandler: Attemping to disable table j9t6
2012-01-10 12:12:21,513 INFO org.apache.hadoop.hbase.master.handler.DisableTableHandler: Disabled table is done=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;





2012-01-10 12:13:41,624 INFO org.apache.hadoop.hbase.master.handler.TableEventHandler: Handling table operation C_M_DELETE_TABLE on table j9t6
2012-01-10 12:14:00,811 DEBUG org.apache.hadoop.hbase.master.handler.DeleteTableHandler: Deleting region j9t6,,1326109762514.adcbae41a5024c60c72f5752c6e1c8d4. from META and FS
2012-01-10 12:14:02,230 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Deleted region j9t6,,1326109762514.adcbae41a5024c60c72f5752c6e1c8d4. from META
2012-01-10 12:14:07,330 DEBUG org.apache.hadoop.hbase.master.handler.DeleteTableHandler: Deleting region j9t6,,1326176002507.49c3665a4bc656f3f6473659b64798f7. from META and FS
2012-01-10 12:14:07,521 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Deleted region j9t6,,1326176002507.49c3665a4bc656f3f6473659b64798f7. from META
2012-01-10 12:14:09,860 DEBUG org.apache.hadoop.hbase.master.handler.DeleteTableHandler: Deleting region j9t6,23443]5767435g,1326176002507.0b96b5ed4c0426d3b3f13e586179c9bc. from META and FS
2012-01-10 12:14:10,096 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Deleted region j9t6,23443]5767435g,1326176002507.0b96b5ed4c0426d3b3f13e586179c9bc. from META








2012-01-10 12:18:11,081 DEBUG org.apache.hadoop.hbase.master.handler.ServerShutdownHandler: Offlined and split region j9t6,,1326109762514.adcbae41a5024c60c72f5752c6e1c8d4.; checking daughter presence
2012-01-10 12:18:46,450 INFO org.apache.hadoop.hbase.master.handler.ServerShutdownHandler: Fixup; missing daughter j9t6,,1326176002507.49c3665a4bc656f3f6473659b64798f7.
2012-01-10 12:18:46,775 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Added daughter j9t6,,1326176002507.49c3665a4bc656f3f6473659b64798f7. in region .META.,,1, serverInfo=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2012-01-10 12:18:47,135 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x134c5dbd0a60000 Creating (or updating) unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 49c3665a4bc656f3f6473659b64798f7 with OFFLINE state
2012-01-10 12:18:47,142 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: No previous transition plan was found (or we are ignoring an existing plan) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; j9t6,,1326176002507.49c3665a4bc656f3f6473659b64798f7. so generated a random one; hri=j9t6,,1326176002507.49c3665a4bc656f3f6473659b64798f7., src=, dest=linux146,60020,1326169560093; 1 (online=1, exclude=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) available servers
2012-01-10 12:18:47,143 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Assigning region j9t6,,1326176002507.49c3665a4bc656f3f6473659b64798f7. to linux146,60020,1326169560093
2012-01-10 12:18:47,155 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handle region called from node nodeDataChanged
2012-01-10 12:18:47,155 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENING, server=linux146,60020,1326169560093, region=49c3665a4bc656f3f6473659b64798f7
2012-01-10 12:18:47,202 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handle region called from node nodeDataChanged
2012-01-10 12:18:47,202 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENING, server=linux146,60020,1326169560093, region=49c3665a4bc656f3f6473659b64798f7
2012-01-10 12:18:47,221 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handle region called from node nodeDataChanged
2012-01-10 12:18:47,221 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENED, server=linux146,60020,1326169560093, region=49c3665a4bc656f3f6473659b64798f7
2012-01-10 12:18:47,222 DEBUG org.apache.hadoop.hbase.master.handler.OpenedRegionHandler: Handling OPENED event &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; j9t6,,1326176002507.49c3665a4bc656f3f6473659b64798f7. from serverName=linux146,60020,1326169560093, load=(requests=0, regions=7, usedHeap=30, maxHeap=996); deleting unassigned node
2012-01-10 12:18:47,222 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x134c5dbd0a60000 Deleting existing unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 49c3665a4bc656f3f6473659b64798f7 that is in expected state RS_ZK_REGION_OPENED
2012-01-10 12:18:47,230 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x134c5dbd0a60000 Successfully deleted unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region 49c3665a4bc656f3f6473659b64798f7 in expected state RS_ZK_REGION_OPENED
2012-01-10 12:18:47,232 DEBUG org.apache.hadoop.hbase.master.handler.OpenedRegionHandler: The master has opened the region j9t6,,1326176002507.49c3665a4bc656f3f6473659b64798f7. that was online on serverName=linux146,60020,1326169560093, load=(requests=0, regions=7, usedHeap=30, maxHeap=996)

2012-01-10 12:19:01,801 INFO org.apache.hadoop.hbase.master.handler.ServerShutdownHandler: Fixup; missing daughter j9t6,23443]5767435g,1326176002507.0b96b5ed4c0426d3b3f13e586179c9bc.
2012-01-10 12:19:02,261 INFO org.apache.hadoop.hbase.catalog.MetaEditor: Added daughter j9t6,23443]5767435g,1326176002507.0b96b5ed4c0426d3b3f13e586179c9bc. in region .META.,,1, serverInfo=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
2012-01-10 12:19:02,984 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x134c5dbd0a60000 Creating (or updating) unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 0b96b5ed4c0426d3b3f13e586179c9bc with OFFLINE state
2012-01-10 12:19:02,992 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: No previous transition plan was found (or we are ignoring an existing plan) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; j9t6,23443]5767435g,1326176002507.0b96b5ed4c0426d3b3f13e586179c9bc. so generated a random one; hri=j9t6,23443]5767435g,1326176002507.0b96b5ed4c0426d3b3f13e586179c9bc., src=, dest=linux146,60020,1326169560093; 1 (online=1, exclude=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) available servers
2012-01-10 12:19:02,992 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Assigning region j9t6,23443]5767435g,1326176002507.0b96b5ed4c0426d3b3f13e586179c9bc. to linux146,60020,1326169560093
2012-01-10 12:19:03,062 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handle region called from node nodeDataChanged
2012-01-10 12:19:03,062 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENING, server=linux146,60020,1326169560093, region=0b96b5ed4c0426d3b3f13e586179c9bc
2012-01-10 12:19:03,107 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handle region called from node nodeDataChanged
2012-01-10 12:19:03,108 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENING, server=linux146,60020,1326169560093, region=0b96b5ed4c0426d3b3f13e586179c9bc
2012-01-10 12:19:03,164 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handle region called from node nodeDataChanged
2012-01-10 12:19:03,164 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENED, server=linux146,60020,1326169560093, region=0b96b5ed4c0426d3b3f13e586179c9bc
2012-01-10 12:19:03,165 DEBUG org.apache.hadoop.hbase.master.handler.OpenedRegionHandler: Handling OPENED event &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; j9t6,23443]5767435g,1326176002507.0b96b5ed4c0426d3b3f13e586179c9bc. from serverName=linux146,60020,1326169560093, load=(requests=11, regions=8, usedHeap=33, maxHeap=996); deleting unassigned node
2012-01-10 12:19:03,165 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x134c5dbd0a60000 Deleting existing unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 0b96b5ed4c0426d3b3f13e586179c9bc that is in expected state RS_ZK_REGION_OPENED
2012-01-10 12:19:03,169 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x134c5dbd0a60000 Successfully deleted unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region 0b96b5ed4c0426d3b3f13e586179c9bc in expected state RS_ZK_REGION_OPENED
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13183205" author="ram_krish" created="Tue, 10 Jan 2012 12:00:41 +0000"  >&lt;p&gt;@Stack&lt;br/&gt;
After analysing the code found one thing. May be avoiding SSH and DisableTableHandler and DeleteTableHandler parallely is a bigger discussion. &lt;br/&gt;
But the above problem can be solved. &lt;br/&gt;
In SSH &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; processDeadRegion(HRegionInfo hri, Result result,
      AssignmentManager assignmentManager, CatalogTracker catalogTracker)
  &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-comment&quot;&gt;// If table is not disabled but the region is offlined,
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; disabled = assignmentManager.getZKTable().isDisabledTable(
        hri.getTableDesc().getNameAsString());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;we check if the table is disabled.  But if you look at the above logs it is the DeleteTableHandler that has already deleted the region and also removed the cache from ZkTable.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
am.getZKTable().setEnabledTable(Bytes.toString(tableName));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Currently setEnabledTable means removing the entry from the map.  So we do not have a differentiation between enabled table and delete the table because both places we remove from the cache map.&lt;/p&gt;

&lt;p&gt;So can we  use the unused TableState.ENABLED in case of enable table handler and only delete table handler will remove it.&lt;br/&gt;
This will ensure that in SSH.processDeadRegion() we can first check if the table is not present in the map and then proceed. If not present we can ensure that the table is already deleted.  &lt;br/&gt;
Pls give your opinion.&lt;/p&gt;</comment>
                            <comment id="13183592" author="zhihyu@ebaysf.com" created="Tue, 10 Jan 2012 21:32:55 +0000"  >&lt;p&gt;+1 on utilizing TableState.ENABLED&lt;br/&gt;
Nice finding, Ram.&lt;/p&gt;</comment>
                            <comment id="13183786" author="zjushch" created="Wed, 11 Jan 2012 01:50:02 +0000"  >&lt;p&gt;I think using TableState.ENABLED is helpful and HMaster.TableDescriptors has similar function.&lt;/p&gt;

&lt;p&gt;But in this issue should we consider the situation of the deleted table is created again?&lt;br/&gt;
Maybe SSH could differentiate the above situation.&lt;/p&gt;</comment>
                            <comment id="13183898" author="stack" created="Wed, 11 Jan 2012 06:10:39 +0000"  >&lt;p&gt;Ugh, I wrote a comment and lost it.&lt;/p&gt;

&lt;p&gt;So, when you say above that &apos;-&amp;gt; The tables and its regions are deleted including R1, D1 and D2.. (So META is cleaned)&apos;, you are saying that this happens AFTER SSH has scanned .META. and that we&apos;re doing the region processing AFTER the deletes (I was going to say its odd that we fixup a daughter when parent is missing but checking .META. and filesystem before each daughter fixup would still have a hole during which a delete could come in....)&lt;/p&gt;

&lt;p&gt;On keeping a TableState.ENABLED up in zk, that could work (Can&apos;t remember why didn&apos;t do it that way originally &amp;#8211; only thought is that was trying to save on the state kept up in zk which is a pretty pathetic reason).  You&apos;ll need to add an AM.isEnabledTable method to match the isDisabledTable, etc., stuff that is already there.  Good stuff Ram.&lt;/p&gt;</comment>
                            <comment id="13184164" author="ram_krish" created="Wed, 11 Jan 2012 16:06:07 +0000"  >&lt;p&gt;I could not upload the patch today as still some test case is failing.  Will upload it tomorrow.&lt;/p&gt;</comment>
                            <comment id="13184844" author="ram_krish" created="Thu, 12 Jan 2012 09:39:38 +0000"  >&lt;p&gt;@Stack&lt;br/&gt;
I am afraid will this cause any compatability issues? Because now we try to create the enabled node and enabled state.  If the master fails over we still go with the node presence in zk to form the zkTable.cache.&lt;br/&gt;
So if we have a rolling restart scenario then this will be a problem right ?  Previously the table node will not be present for the Enabled state but now we will create it.&lt;br/&gt;
&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13185030" author="ram_krish" created="Thu, 12 Jan 2012 15:56:43 +0000"  >&lt;p&gt;TestRollingRestart is passing.&lt;br/&gt;
I have tried to handle the different scenarios. TestMasterFailOver related scenarios also handled.&lt;/p&gt;</comment>
                            <comment id="13185095" author="zhihyu@ebaysf.com" created="Thu, 12 Jan 2012 17:42:32 +0000"  >&lt;p&gt;In AssignmentManager.java, setEnabledTable():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to ensure that the table will be&quot;&lt;/span&gt;
+          + &lt;span class=&quot;code-quote&quot;&gt;&quot; enabled because of a ZooKeeper issue&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please include tableName in the log.&lt;/p&gt;

&lt;p&gt;In bulkAssignUserRegions():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    List&amp;lt;HRegionInfo&amp;gt; regionsList = java.util.Arrays.asList(regions);
+    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (HRegionInfo regionInfo : regionsList) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can we directly iterate over regions array ?&lt;/p&gt;

&lt;p&gt;In ZKTable.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isEnabledOrDisablingTable(tableName)) {
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isEnabledOrDisablingTable(tableName)) {
         LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Moving table &quot;&lt;/span&gt; + tableName + &lt;span class=&quot;code-quote&quot;&gt;&quot; state to disabling but was &quot;&lt;/span&gt; +
           &lt;span class=&quot;code-quote&quot;&gt;&quot;not first in enabled state: &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cache.get(tableName));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Why was the above change necessary ? Now the warning doesn&apos;t match the check.&lt;/p&gt;

&lt;p&gt;I see some long line:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      TEST_UTIL.createTable(TABLENAME, FAMILYNAME);
+     assertTrue(m.assignmentManager.getZKTable().isEnabledTable(Bytes.toString(TABLENAME)));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Overall, this patch looks very good.&lt;br/&gt;
Thanks for plugging a hole w.r.t. cache in ZkTable.&lt;/p&gt;</comment>
                            <comment id="13185114" author="ram_krish" created="Thu, 12 Jan 2012 18:06:32 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
Thanks for your review. I will address all the comments. I will do some more testing tomorrow and then submit an updated patch.&lt;br/&gt;
Currently i can verify in 0.90.  Trunk will be doing sometime later next week.&lt;/p&gt;</comment>
                            <comment id="13185201" author="zhihyu@ebaysf.com" created="Thu, 12 Jan 2012 20:15:26 +0000"  >&lt;p&gt;Test suite passed based on Ram&apos;s patch.&lt;/p&gt;</comment>
                            <comment id="13185633" author="ram_krish" created="Fri, 13 Jan 2012 15:37:48 +0000"  >&lt;p&gt;The latest patch addresses the rolling restart scenarios also.  One thing is as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4083&quot; title=&quot;If Enable table is not completed and is partial, then scanning of the table is not working &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4083&quot;&gt;&lt;del&gt;HBASE-4083&lt;/del&gt;&lt;/a&gt; is not checked into 0.90 the scenario pertaining to that defect will not be supported. &lt;br/&gt;
Tested the following &lt;br/&gt;
-&amp;gt; Master fail over with and with out patch&lt;br/&gt;
-&amp;gt; RS fail over&lt;br/&gt;
-&amp;gt; RS with parital disable state&lt;/p&gt;

&lt;p&gt;One thing is this patch should get applied on the master for the patch to take into effect because enabling, disabling of tables is started by the master.&lt;/p&gt;</comment>
                            <comment id="13185634" author="ram_krish" created="Fri, 13 Jan 2012 15:38:31 +0000"  >&lt;p&gt;Pls provide your comments.&lt;/p&gt;</comment>
                            <comment id="13185723" author="zhihyu@ebaysf.com" created="Fri, 13 Jan 2012 18:13:11 +0000"  >&lt;p&gt;+1.&lt;/p&gt;

&lt;p&gt;Minor comments:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; == checkIfRegionBelongsToDisabled(regionInfo)) {
+          disabled = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can the above be written as:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  disabled = checkIfRegionBelongsToDisabled(regionInfo);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-comment&quot;&gt;// need to enable the table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not disable or disabling&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should read &apos;not disabled ...&apos;&lt;/p&gt;</comment>
                            <comment id="13185745" author="zhihyu@ebaysf.com" created="Fri, 13 Jan 2012 18:50:49 +0000"  >&lt;p&gt;I tried to port the patch to trunk.&lt;br/&gt;
It turns out that AssignmentManager.java is quite different between 0.90 and trunk.&lt;br/&gt;
e.g. the following code in rebuildUserRegions() of 0.90:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; disablingTables = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;(1);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But in trunk, disablingTables is a field in AssignmentManager&lt;/p&gt;</comment>
                            <comment id="13185748" author="ram_krish" created="Fri, 13 Jan 2012 18:55:16 +0000"  >&lt;p&gt;Yes Ted. Some of that part was refactored by some defect by Ming.&lt;/p&gt;

&lt;p&gt;Also in trunk as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4083&quot; title=&quot;If Enable table is not completed and is partial, then scanning of the table is not working &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4083&quot;&gt;&lt;del&gt;HBASE-4083&lt;/del&gt;&lt;/a&gt; is there we have disablingTables and also enablingTables.  So for trunk may be we may have to apply the changes considering the code there.&lt;/p&gt;</comment>
                            <comment id="13185753" author="ram_krish" created="Fri, 13 Jan 2012 18:57:18 +0000"  >&lt;p&gt;Updated patch addressing Ted&apos;s comments.&lt;/p&gt;</comment>
                            <comment id="13185858" author="stack" created="Fri, 13 Jan 2012 21:13:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;So if we have a rolling restart scenario then this will be a problem right ? Previously the table node will not be present for the Enabled state but now we will create it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Have you tried it?  In rolling restart we&apos;ll upgrade the master first usually.  Won&apos;t it know how to deal w/ new zk node for ENABLED state?&lt;/p&gt;

&lt;p&gt;FYI, don&apos;t do these kinda changes in future:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (HRegionInfo region: regions) {
+      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (HRegionInfo region : regions) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What was there previous was fine... It adds bulk to your patch.&lt;/p&gt;

&lt;p&gt;This looks like a method used internally by AM only.  Does it need to be public?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setEnabledTable(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tableName) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In processDeadRegion, should we check parent exists before doing daughter fixups? (It could have been deleted?)&lt;/p&gt;

&lt;p&gt;I don&apos;t undersand this comment:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// Enable the ROOT table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; on process fail over the RS containing ROOT
&lt;/span&gt;+    &lt;span class=&quot;code-comment&quot;&gt;// was active.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Same for the one on .meta.&lt;/p&gt;

&lt;p&gt;Why we have to enable the meta and root tables?  Aren&apos;t they always on?&lt;/p&gt;

&lt;p&gt;Is this right:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * Check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the table is in DISABLED state in cache
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Is it just checking cache?  This class gets updated when the zk changes right?  So its not just a &apos;cache&apos;?  I think should drop &apos;from cache&apos; in your public javadoc.&lt;/p&gt;

&lt;p&gt;Same for isDisabling, etc&lt;/p&gt;

&lt;p&gt;Is this right below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isEnabledTable(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tableName) {
-    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cache) {
-      &lt;span class=&quot;code-comment&quot;&gt;// No entry in cache means enabled table.
&lt;/span&gt;-      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; !&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cache.containsKey(tableName);
-    }
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; isTableState(tableName, TableState.ENABLED);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Else patch looks good to me.  Was afraid it too much for 0.90.6 but its looking ok.&lt;/p&gt;

</comment>
                            <comment id="13185878" author="zhihyu@ebaysf.com" created="Fri, 13 Jan 2012 21:34:42 +0000"  >&lt;p&gt;Minor comment:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; istableEnabled = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.zkTable.isEnabledTable(tableName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;istableEnabled should be named isTableEnabled.&lt;/p&gt;

&lt;p&gt;@Stack:&lt;br/&gt;
w.r.t the following comment:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// Enable the ROOT table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; on process fail over the RS containing ROOT
&lt;/span&gt;+    &lt;span class=&quot;code-comment&quot;&gt;// was active.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;AssignmentManager delegates to this.zkTable.setEnabledTable(). This is to set the meta tables enabled in ZkTable cache.&lt;/p&gt;</comment>
                            <comment id="13186084" author="ram_krish" created="Sat, 14 Jan 2012 04:26:48 +0000"  >&lt;blockquote&gt;&lt;p&gt;This looks like a method used internally by AM only. Does it need to be public?&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setEnabledTable(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tableName) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I did not have this as public in the beginning.  But later in HMaster.rebuildUserRegions() i had to set enabled table.  So thought of exposing this from AM so that i can use it there instead of repeating the same code in HMaster.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Have you tried it? In rolling restart we&apos;ll upgrade the master first usually. Won&apos;t it know how to deal w/ new zk node for ENABLED state?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If master is restarted first even then the above changes will be necessary as when the master builds the table state he will not find the ENABLED state in zk.  So the above changes in Master will help him to build that state.  Yes rolling restart was tested.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;FYI, don&apos;t do these kinda changes in future:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;When applying a formatter it happened. Sure Stack i will take care of those changes.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isEnabledTable(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tableName) {
-    &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cache) {
-      &lt;span class=&quot;code-comment&quot;&gt;// No entry in cache means enabled table.
&lt;/span&gt;-      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; !&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cache.containsKey(tableName);
-    }
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; isTableState(tableName, TableState.ENABLED);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The isTableState will anyway have a synchronized(this.cache) so it should be ok?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * Check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the table is in DISABLED state in cache
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;My idea of adding &apos;in cache&apos; was like the state is checked only in Memory and it is not going to zk to check the state . So i thought like the &apos;in cache&apos; word will tell the user like to ZK is used in checking it.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// Enable the ROOT table &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; on process fail over the RS containing ROOT
&lt;/span&gt;+    &lt;span class=&quot;code-comment&quot;&gt;// was active.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This scenario comes when the master is restarted but the RS is still alive.  Now the master should enable the ROOT and META also because when he comes up he should create the enabled node in zk.&lt;br/&gt;
If we don&apos;t do this step then for ROOT and META we will not have a node in zk in the above scenario.&lt;br/&gt;
But if the master explicitly assign ROOT and META then there will be a zk node. So to unify this i had to do the zkTable.setEnabledTable().&lt;br/&gt;
@Stack&lt;br/&gt;
Is it fine Stack? I can reprepare a patch based on your feedback and then upload a final one?&lt;br/&gt;
@Ted&lt;br/&gt;
You have any more comments or feedback so that i can incorporate in the next patch.&lt;/p&gt;
</comment>
                            <comment id="13186089" author="zhihyu@ebaysf.com" created="Sat, 14 Jan 2012 04:50:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;will tell the user like to ZK is used in checking it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think you wanted to say &apos;will tell the user like no ZK is used in checking it.&apos;&lt;/p&gt;

&lt;p&gt;I don&apos;t have other comments, except the one @ 13/Jan/12 21:34&lt;/p&gt;

&lt;p&gt;If you have time, please port this to 0.92&lt;br/&gt;
Otherwise we can open another JIRA.&lt;/p&gt;

&lt;p&gt;Good job, Ramkrishna.&lt;/p&gt;</comment>
                            <comment id="13186150" author="ram_krish" created="Sat, 14 Jan 2012 10:02:29 +0000"  >&lt;p&gt;Addressing comments and also avoided unnecessary zookeeper check to enable a table under process fail over flow&lt;/p&gt;</comment>
                            <comment id="13186169" author="zhihyu@ebaysf.com" created="Sat, 14 Jan 2012 11:42:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;_2.patch looks good to me.&lt;/p&gt;</comment>
                            <comment id="13186243" author="ram_krish" created="Sat, 14 Jan 2012 15:50:53 +0000"  >&lt;p&gt;I am planning to commit this today.&lt;/p&gt;</comment>
                            <comment id="13186287" author="ram_krish" created="Sat, 14 Jan 2012 18:05:59 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hri.isOffline() &amp;amp;&amp;amp; hri.isSplit()) {
-      LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Offlined and split region &quot;&lt;/span&gt; + hri.getRegionNameAsString() +
-        &lt;span class=&quot;code-quote&quot;&gt;&quot;; checking daughter presence&quot;&lt;/span&gt;);
+      LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Offlined and split region &quot;&lt;/span&gt; + hri.getRegionNameAsString()
+          + &lt;span class=&quot;code-quote&quot;&gt;&quot;; checking daughter presence&quot;&lt;/span&gt;);
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (MetaReader.getRegion(catalogTracker, hri.getRegionName()) == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+      }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Just added the above code as Stack commented.&lt;/p&gt;</comment>
                            <comment id="13186299" author="ram_krish" created="Sat, 14 Jan 2012 18:48:39 +0000"  >&lt;p&gt;Committed to 0.90.&lt;br/&gt;
Stack , Ted and Chunhui for the review.  &lt;/p&gt;</comment>
                            <comment id="13186723" author="ram_krish" created="Mon, 16 Jan 2012 06:12:54 +0000"  >&lt;p&gt;committed to branch 0.90.&lt;/p&gt;</comment>
                            <comment id="13187155" author="jdcryans" created="Mon, 16 Jan 2012 20:15:02 +0000"  >&lt;p&gt;Please don&apos;t forget to set the assignee.&lt;/p&gt;</comment>
                            <comment id="13229638" author="hudson" created="Wed, 14 Mar 2012 21:25:37 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2680 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2680/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2680/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5206&quot; title=&quot;Port HBASE-5155 to 0.92, 0.94, and TRUNK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5206&quot;&gt;&lt;del&gt;HBASE-5206&lt;/del&gt;&lt;/a&gt; port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt; to TRUNK (Ashutosh Jindal) (Revision 1300711)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterRestartAfterDisablingTable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13229926" author="hudson" created="Thu, 15 Mar 2012 05:54:05 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #138 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/138/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/138/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5206&quot; title=&quot;Port HBASE-5155 to 0.92, 0.94, and TRUNK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5206&quot;&gt;&lt;del&gt;HBASE-5206&lt;/del&gt;&lt;/a&gt; port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt; to TRUNK (Ashutosh Jindal) (Revision 1300711)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterRestartAfterDisablingTable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13231579" author="hudson" created="Fri, 16 Mar 2012 20:12:04 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2685 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2685/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2685/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5206&quot; title=&quot;Port HBASE-5155 to 0.92, 0.94, and TRUNK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5206&quot;&gt;&lt;del&gt;HBASE-5206&lt;/del&gt;&lt;/a&gt; Port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt; to trunk (Ashutosh Jindal) (Revision 1301709)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/TestDrainingServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterRestartAfterDisablingTable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13231637" author="hudson" created="Fri, 16 Mar 2012 21:19:24 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #36 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/36/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/36/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5206&quot; title=&quot;Port HBASE-5155 to 0.92, 0.94, and TRUNK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5206&quot;&gt;&lt;del&gt;HBASE-5206&lt;/del&gt;&lt;/a&gt; port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt; to 0.94 (Ashutosh Jindal) (Revision 1301737)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTable.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/TestDrainingServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestMasterRestartAfterDisablingTable.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13231861" author="hudson" created="Sat, 17 Mar 2012 05:56:29 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #140 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/140/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/140/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5206&quot; title=&quot;Port HBASE-5155 to 0.92, 0.94, and TRUNK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5206&quot;&gt;&lt;del&gt;HBASE-5206&lt;/del&gt;&lt;/a&gt; Port &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt; to trunk (Ashutosh Jindal) (Revision 1301709)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKTable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/TestDrainingServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterRestartAfterDisablingTable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKTable.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13265019" author="ram_krish" created="Mon, 30 Apr 2012 16:48:38 +0000"  >&lt;p&gt;I have added a release note on this issue.  Pls review.&lt;br/&gt;
Sorry about the problem introduced.&lt;/p&gt;</comment>
                            <comment id="13265020" author="ram_krish" created="Mon, 30 Apr 2012 16:48:57 +0000"  >&lt;p&gt;Will close this once the release note is reviewed.&lt;/p&gt;</comment>
                            <comment id="13265114" author="dsw" created="Mon, 30 Apr 2012 19:01:49 +0000"  >&lt;p&gt;Ram,&lt;/p&gt;

&lt;p&gt;&amp;gt; If the HBase client does not have the changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt; and the server has the  changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;, then if we try to Enable a table then the client will hang. &lt;/p&gt;

&lt;p&gt;Actually, I noticed that the hang happens in the opposite case: when the client has the changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;, and the server does not.&lt;/p&gt;

&lt;p&gt;Otherwise the release note looks OK to me.&lt;/p&gt;</comment>
                            <comment id="13265633" author="ram_krish" created="Tue, 1 May 2012 04:12:40 +0000"  >&lt;p&gt;@David&lt;br/&gt;
Updated the release notes. Thanks for your review.&lt;/p&gt;</comment>
                            <comment id="13266099" author="stack" created="Tue, 1 May 2012 21:04:00 +0000"  >&lt;p&gt;Should we revert and roll a 0.90.7?&lt;/p&gt;</comment>
                            <comment id="14269161" author="clehene" created="Thu, 8 Jan 2015 10:33:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ramkrishna.s.vasudevan%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;ramkrishna.s.vasudevan@gmail.com&quot;&gt;ramkrishna vasudevan&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; still valid?&lt;/p&gt;</comment>
                            <comment id="14272265" author="apurtell" created="Sat, 10 Jan 2015 02:15:58 +0000"  >&lt;p&gt;This was ported to trunk in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5206&quot; title=&quot;Port HBASE-5155 to 0.92, 0.94, and TRUNK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5206&quot;&gt;&lt;del&gt;HBASE-5206&lt;/del&gt;&lt;/a&gt;, I&apos;m going to resolve as Fixed&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12510510" name="HBASE-5155_1.patch" size="25560" author="ram_krish" created="Fri, 13 Jan 2012 18:57:18 +0000"/>
                            <attachment id="12510569" name="HBASE-5155_2.patch" size="25756" author="ram_krish" created="Sat, 14 Jan 2012 10:02:29 +0000"/>
                            <attachment id="12510592" name="HBASE-5155_3.patch" size="25992" author="ram_krish" created="Sat, 14 Jan 2012 18:05:59 +0000"/>
                            <attachment id="12510380" name="HBASE-5155_latest.patch" size="19080" author="ram_krish" created="Thu, 12 Jan 2012 15:54:28 +0000"/>
                            <attachment id="12510496" name="hbase-5155_6.patch" size="25599" author="ram_krish" created="Fri, 13 Jan 2012 15:37:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 9 Jan 2012 17:30:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223247</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02btr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11517</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This issue is an incompatible change.&lt;br/&gt;
If an HBase client with the changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;strike&gt;HBASE-5155&lt;/strike&gt;&lt;/a&gt; and a server (master) without the changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;strike&gt;HBASE-5155&lt;/strike&gt;&lt;/a&gt; is used, then the is_enabled (from HBase Shell) or isTableEnabled() (from HBaseAdmin) will return false though the table is already enabled as per the master.&lt;br/&gt;
&lt;br/&gt;
If the HBase client does have the changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;strike&gt;HBASE-5155&lt;/strike&gt;&lt;/a&gt; and the server does not have the changes for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;strike&gt;HBASE-5155&lt;/strike&gt;&lt;/a&gt;, then if we try to Enable a table then the client will hang.&lt;br/&gt;
&lt;br/&gt;
The reason is because,&lt;br/&gt;
Prior to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;strike&gt;HBASE-5155&lt;/strike&gt;&lt;/a&gt; once the table is enabled the znode in the zookeeper created for the table is deleted.&lt;br/&gt;
After &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;strike&gt;HBASE-5155&lt;/strike&gt;&lt;/a&gt; once the table is enabled the znode in the zookeeper created for the table is not deleted, whereas the same node is updated with the status ENABLED.&lt;br/&gt;
&lt;br/&gt;
The client also expects the status of the znode in the zookeeper to be in the ENABLED state if the table has been enabled successfully.&lt;br/&gt;
The above changes makes the client behaviour incompatible if the client does not have this fix whereas the server has this fix.&lt;br/&gt;
If both the client and the server does not have this fix, then the behaviour is as expected.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>