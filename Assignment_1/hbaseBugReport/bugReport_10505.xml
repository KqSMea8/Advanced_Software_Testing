<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:14:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10505/HBASE-10505.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10505] Import.filterKv does not call Filter.filterRowKey</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10505</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The general contract of a Filter is that filterRowKey is called before filterKeyValue.&lt;br/&gt;
Import is using Filters for custom filtering but it does not called filterRowKey at all. That throws off some Filters (such as RowFilter, and more recently PrefixFilter, and InclusiveStopFilter). See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10493&quot; title=&quot;InclusiveStopFilter#filterKeyValue() should perform filtering on row key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10493&quot;&gt;&lt;del&gt;HBASE-10493&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10485&quot; title=&quot;PrefixFilter#filterKeyValue() should perform filtering on row key&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10485&quot;&gt;&lt;del&gt;HBASE-10485&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12694656">HBASE-10505</key>
            <summary>Import.filterKv does not call Filter.filterRowKey</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Wed, 12 Feb 2014 02:28:38 +0000</created>
                <updated>Wed, 26 Feb 2014 04:45:37 +0000</updated>
                            <resolved>Wed, 12 Feb 2014 04:42:30 +0000</resolved>
                                                    <fixVersion>0.96.2</fixVersion>
                    <fixVersion>0.94.17</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                                                            <comments>
                            <comment id="13898705" author="lhofhansl" created="Wed, 12 Feb 2014 02:41:01 +0000"  >&lt;p&gt;Here&apos;s a 0.94 patch.&lt;br/&gt;
Actually TestImportExport.testWithFilter only passes by pure accident, because PrefixFilter.filterKeyValue never filtered anything.&lt;/p&gt;</comment>
                            <comment id="13898715" author="yuzhihong@gmail.com" created="Wed, 12 Feb 2014 02:53:55 +0000"  >&lt;p&gt;Thanks for fixing this.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @param row on which to apply the filter
+   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the key should not be written, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; otherwise
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please add javadoc for other parameters.&lt;/p&gt;</comment>
                            <comment id="13898719" author="yuzhihong@gmail.com" created="Wed, 12 Feb 2014 02:58:38 +0000"  >&lt;p&gt;In trunk, we have:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (filter == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || !filter.filterRowKey(key.get(), key.getOffset(), key.getLength())) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Cell kv : result.rawCells()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So this problem doesn&apos;t exist in trunk.&lt;/p&gt;</comment>
                            <comment id="13898729" author="lhofhansl" created="Wed, 12 Feb 2014 03:14:52 +0000"  >&lt;p&gt;Heh, I hadn&apos;t sync&apos;ed trunk in a but, was just fixed recently. I&apos;ll fix it the same way in 0.94 and 0.96 (so it&apos;s all the same).&lt;/p&gt;</comment>
                            <comment id="13898733" author="lhofhansl" created="Wed, 12 Feb 2014 03:25:21 +0000"  >&lt;p&gt;Patches for 0.94 and 0.96 to make it like trunk.&lt;/p&gt;</comment>
                            <comment id="13898735" author="lhofhansl" created="Wed, 12 Feb 2014 03:28:09 +0000"  >&lt;p&gt;0.98 is fine too.&lt;/p&gt;</comment>
                            <comment id="13898741" author="lhofhansl" created="Wed, 12 Feb 2014 03:36:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vmariyala&quot; class=&quot;user-hover&quot; rel=&quot;vmariyala&quot;&gt;Vasu Mariyala&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jesse_yates&quot; class=&quot;user-hover&quot; rel=&quot;jesse_yates&quot;&gt;Jesse Yates&lt;/a&gt;, not sure if that any impact on our stuff.&lt;/p&gt;</comment>
                            <comment id="13898772" author="lhofhansl" created="Wed, 12 Feb 2014 04:19:04 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuzhihong%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yuzhihong@gmail.com&quot;&gt;Ted Yu&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;, you good with the patch? Including 0.96? (Without it filtering in Import is broken)&lt;/p&gt;</comment>
                            <comment id="13898779" author="ram_krish" created="Wed, 12 Feb 2014 04:30:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;&lt;br/&gt;
Patch looks good to me.  Can we try adding a filter testcase in testimportExport that validates this behaviour.  The current test as you said my be just passing.  Even sometime back I found that the testcases in TestImport were just passing without actually getting any KVs.  So add a testcase for this behaviour. If it takes time, then we can address in a seperate JIRA.&lt;br/&gt;
+1 on patch.&lt;/p&gt;</comment>
                            <comment id="13898787" author="lhofhansl" created="Wed, 12 Feb 2014 04:37:11 +0000"  >&lt;p&gt;I&apos;d like to address the issues first.&lt;br/&gt;
It&apos;s not much work to add a non-matching row/kvs to TestImportExport.testWithFilter, but that would need to be in branches.&lt;/p&gt;

&lt;p&gt;I&apos;ll file a subtask for that.&lt;/p&gt;</comment>
                            <comment id="13898792" author="stack" created="Wed, 12 Feb 2014 04:39:26 +0000"  >&lt;p&gt;+1 for 0.96&lt;/p&gt;</comment>
                            <comment id="13898793" author="lhofhansl" created="Wed, 12 Feb 2014 04:42:30 +0000"  >&lt;p&gt;Committed to 0.94 and 0.96.&lt;/p&gt;</comment>
                            <comment id="13898842" author="hudson" created="Wed, 12 Feb 2014 06:20:56 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94-security #409 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/409/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/409/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10505&quot; title=&quot;Import.filterKv does not call Filter.filterRowKey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10505&quot;&gt;&lt;del&gt;HBASE-10505&lt;/del&gt;&lt;/a&gt; Import.filterKv does not call Filter.filterRowKey. (larsh: rev 1567522)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/mapreduce/Import.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13898851" author="hudson" created="Wed, 12 Feb 2014 06:28:17 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-on-Hadoop-2 #20 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-on-Hadoop-2/20/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-on-Hadoop-2/20/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10505&quot; title=&quot;Import.filterKv does not call Filter.filterRowKey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10505&quot;&gt;&lt;del&gt;HBASE-10505&lt;/del&gt;&lt;/a&gt; Import.filterKv does not call Filter.filterRowKey. (larsh: rev 1567522)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/mapreduce/Import.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13898866" author="hudson" created="Wed, 12 Feb 2014 06:51:52 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94 #1284 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1284/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1284/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10505&quot; title=&quot;Import.filterKv does not call Filter.filterRowKey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10505&quot;&gt;&lt;del&gt;HBASE-10505&lt;/del&gt;&lt;/a&gt; Import.filterKv does not call Filter.filterRowKey. (larsh: rev 1567522)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/mapreduce/Import.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13898899" author="hudson" created="Wed, 12 Feb 2014 07:52:06 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-JDK7 #47 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-JDK7/47/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-JDK7/47/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10505&quot; title=&quot;Import.filterKv does not call Filter.filterRowKey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10505&quot;&gt;&lt;del&gt;HBASE-10505&lt;/del&gt;&lt;/a&gt; Import.filterKv does not call Filter.filterRowKey. (larsh: rev 1567522)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/mapreduce/Import.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13898902" author="hudson" created="Wed, 12 Feb 2014 07:54:41 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.96 #291 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/291/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/291/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10505&quot; title=&quot;Import.filterKv does not call Filter.filterRowKey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10505&quot;&gt;&lt;del&gt;HBASE-10505&lt;/del&gt;&lt;/a&gt; Import.filterKv does not call Filter.filterRowKey. (larsh: rev 1567524)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/Import.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13899073" author="hudson" created="Wed, 12 Feb 2014 13:04:20 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.96-hadoop2 #201 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96-hadoop2/201/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96-hadoop2/201/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10505&quot; title=&quot;Import.filterKv does not call Filter.filterRowKey&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10505&quot;&gt;&lt;del&gt;HBASE-10505&lt;/del&gt;&lt;/a&gt; Import.filterKv does not call Filter.filterRowKey. (larsh: rev 1567524)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/mapreduce/Import.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13899618" author="vasu.mariyala@gmail.com" created="Wed, 12 Feb 2014 21:46:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; May be this is one of the issues of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10416&quot; title=&quot;Improvements to the import flow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10416&quot;&gt;&lt;del&gt;HBASE-10416&lt;/del&gt;&lt;/a&gt; ?&lt;/p&gt;

&lt;p&gt;I think we need to fix the TestImportExport.testWithFilter test case by inserting atleast another row. This works currently because we insert only one row (&quot;row1&quot;), perform export, perform import with prefix filter. The prefix filter filterRowKey is never called (before this fix) so all the rows are included in the import. But since we only have one row (&quot;row1&quot;), the test case doesn&apos;t really test the functionality of import with filter.&lt;/p&gt;</comment>
                            <comment id="13899675" author="apurtell" created="Wed, 12 Feb 2014 22:20:13 +0000"  >&lt;p&gt;Why not branches &amp;gt; 0.96?&lt;/p&gt;</comment>
                            <comment id="13899746" author="vasu.mariyala@gmail.com" created="Wed, 12 Feb 2014 23:21:20 +0000"  >&lt;p&gt;For branches &amp;gt; 0.96, the issue is fixed with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10416&quot; title=&quot;Improvements to the import flow&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10416&quot;&gt;&lt;del&gt;HBASE-10416&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13899914" author="lhofhansl" created="Thu, 13 Feb 2014 01:50:25 +0000"  >&lt;p&gt;Yeah, this is fixed in 0.98 and later.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12628421" name="10505-0.94-v2.txt" size="3549" author="lhofhansl" created="Wed, 12 Feb 2014 03:25:21 +0000"/>
                            <attachment id="12628412" name="10505-0.94.txt" size="1460" author="lhofhansl" created="Wed, 12 Feb 2014 02:41:01 +0000"/>
                            <attachment id="12628422" name="10505-0.96-v2.txt" size="3760" author="lhofhansl" created="Wed, 12 Feb 2014 03:25:21 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12694666">HBASE-10507</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 12 Feb 2014 02:53:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373164</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1sb3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373465</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>