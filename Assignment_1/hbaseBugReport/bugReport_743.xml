<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:47:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-743/HBASE-743.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-743] bin/hbase migrate upgrade fails when redo logs exists</title>
                <link>https://issues.apache.org/jira/browse/HBASE-743</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I migrated several hbase-0.1.3 instances to hbase trunk and even if I stop hbase-0.1.3 cleanup it leaves redo logs on hdfs. The problems is that when migrating the data with hbase-trunk it fails because it finds these redo-logs and quit with a error message saying that we should reinstall the old hbase and shut it down cleanly and that in theory it erases the redo logs. The work around has been to delete the redo logs manually... which is bad.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12400133">HBASE-743</key>
            <summary>bin/hbase migrate upgrade fails when redo logs exists</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="irubin">Izaak Rubin</assignee>
                                    <reporter username="srainville">Sebastien Rainville</reporter>
                        <labels>
                    </labels>
                <created>Fri, 11 Jul 2008 18:05:34 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:20 +0000</updated>
                            <resolved>Mon, 21 Jul 2008 21:47:31 +0000</resolved>
                                    <version>0.2.0</version>
                                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12613484" author="irubin" created="Mon, 14 Jul 2008 23:09:07 +0000"  >&lt;p&gt;Hi Sebastien,&lt;/p&gt;

&lt;p&gt;I&apos;m having difficulty replicating the problem on my machine. I don&apos;t totally understand what you mean by the hbase-0.1.3 cleanup, but I&apos;ll explain what I did and you can tell me if I did something different. I started a version of hbase-0.1.3 running on top of hadoop-0.16.4, created a table with a bunch of data, shut down hbase, and then upgraded my hadoop from 0.16.4 to 0.17.1. I followed the hadoop upgrading instructions at &lt;a href=&quot;http://wiki.apache.org/hadoop/Hadoop%20Upgrade&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/hadoop/Hadoop%20Upgrade&lt;/a&gt;. Then I went to my hbase-trunk and ran:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/hbase migrate update
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Which ran successfully. I then started up hbase-trunk and the table i had created looked unchanged.&lt;/p&gt;

&lt;p&gt;It&apos;s true that the migrate script will fail if it sees these stray log files in the dfs. Shutting down hbase normally should clean up these log files... This is where I&apos;m a bit confused about what you mean by &quot;hbase-0.1.3 cleanup,&quot; and that even if you do stop it it&apos;ll leave redo-logs? Wouldn&apos;t it be that if you didn&apos;t stop the cleanup it leaves redo-logs? (Since the cleanup should get rid of the redo logs?)&lt;/p&gt;</comment>
                            <comment id="12614690" author="srainville" created="Fri, 18 Jul 2008 10:37:11 +0000"  >&lt;p&gt;Here&apos;s how I reproduce the problem:&lt;/p&gt;

&lt;p&gt;(in hbase-0.1.3)&lt;br/&gt;
rm -Rf $HBASE_DATA_DIR&lt;br/&gt;
bin/start-hbase.sh&lt;br/&gt;
ls $HBASE_DATA_DIR =&amp;gt; a redo log exists&lt;br/&gt;
bin/stop-hbase.sh&lt;br/&gt;
ls $HBASE_DATA_DIR =&amp;gt; the redo log is not there anymore: so far so good&lt;br/&gt;
bin/start-hbase.sh&lt;br/&gt;
ls $HBASE_DATA_DIR =&amp;gt; a redo log exists&lt;br/&gt;
kill -9 $HBASE_MASTER_PID&lt;br/&gt;
ls $HBASE_DATA_DIR =&amp;gt; a redo log still exists&lt;br/&gt;
bin/start-hbase.sh&lt;br/&gt;
ls $HBASE_DATA_DIR =&amp;gt; now there are 2 redo logs&lt;br/&gt;
bin/stop-hbase.sh&lt;br/&gt;
ls $HBASE_DATA_DIR =&amp;gt; now there is only 1 redo log: the bad one&lt;/p&gt;

&lt;p&gt;(in hbase-trunk)&lt;br/&gt;
bin/hbase migrate upgrade =&amp;gt; FAIL because of an unrecovered redo log&lt;/p&gt;

&lt;p&gt;Now, I don&apos;t know how that&apos;s supposed to be handled but the thing is that HBase wasn&apos;t always very &lt;b&gt;stable&lt;/b&gt; so remaining redo logs like that are likely to exist for other people so it&apos;s going to come up again.&lt;/p&gt;</comment>
                            <comment id="12614779" author="irubin" created="Fri, 18 Jul 2008 16:35:20 +0000"  >&lt;p&gt;I see, that makes sense.  I&apos;m not sure that this is necessarily a problem with the migrate command, although I suppose it could be a bit more tolerant.  I&apos;ll ask Jim or Stack about this.&lt;/p&gt;

&lt;p&gt;Still, I think the right thing to do would be to just warn people about this before they migrate, and show them how to remove any stray redo logs.  I&apos;ll make a note of this on the wiki page.&lt;/p&gt;</comment>
                            <comment id="12614911" author="irubin" created="Fri, 18 Jul 2008 23:00:17 +0000"  >&lt;p&gt;I&apos;ve updated the HBase Wiki page on migrations, mentioning the issue of unrecovered redo logs:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://wiki.apache.org/hadoop/Hbase/HowToMigrate&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/hadoop/Hbase/HowToMigrate&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if there&apos;s a way for HBase to go through and merge-in these redo logs - if so, I&apos;ll post it to the migration page as well.  If something like this doesn&apos;t exist, it might be a good idea to make it.&lt;/p&gt;</comment>
                            <comment id="12615383" author="stack" created="Mon, 21 Jul 2008 19:36:06 +0000"  >&lt;p&gt;Sebastien, what with Izaak&apos;s documentation above and my change to the message that comes out of the migration when logs are present, is that sufficient to close this issue?&lt;/p&gt;

&lt;p&gt;Here is the message that comes out of the migration when redo logs are present:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (unrecoveredLogs.size() != 0) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;There are &quot;&lt;/span&gt; + unrecoveredLogs.size() +
          &lt;span class=&quot;code-quote&quot;&gt;&quot; unrecovered region server logs. Please uninstall &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; version of &quot;&lt;/span&gt; +
          &lt;span class=&quot;code-quote&quot;&gt;&quot;HBase, re-install the previous version, start your cluster and &quot;&lt;/span&gt; +
          &lt;span class=&quot;code-quote&quot;&gt;&quot;shut it down cleanly, so that all region server logs are recovered&quot;&lt;/span&gt; +
          &lt;span class=&quot;code-quote&quot;&gt;&quot; and deleted.  Or, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; you are sure logs are vestige of old &quot;&lt;/span&gt; +
          &lt;span class=&quot;code-quote&quot;&gt;&quot;failures in hbase, remove them and then rerun the migration.  &quot;&lt;/span&gt; +
          &lt;span class=&quot;code-quote&quot;&gt;&quot;See &apos;Redo Logs&apos; in http:&lt;span class=&quot;code-comment&quot;&gt;//wiki.apache.org/hadoop/Hbase/HowToMigrate. &quot;&lt;/span&gt; +
&lt;/span&gt;          &lt;span class=&quot;code-quote&quot;&gt;&quot;Here are the problem log files: &quot;&lt;/span&gt; + unrecoveredLogs);
    } 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12615437" author="srainville" created="Mon, 21 Jul 2008 21:33:13 +0000"  >&lt;p&gt;It&apos;s good enough.&lt;/p&gt;</comment>
                            <comment id="12615444" author="stack" created="Mon, 21 Jul 2008 21:47:31 +0000"  >&lt;p&gt;Resolving (with Sebastien&apos;s OK)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 14 Jul 2008 23:09:07 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25373</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 22 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h96f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98749</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>