<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:21:44 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11282/HBASE-11282.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11282] Load balancer may move a region which is participating in snapshot</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11282</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The region was tableone,,1394495094967.289ebdee6adf0a3b9c2bbcbe2ff522e7.&lt;br/&gt;
From master log:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-03-10 23:48:09,035 DEBUG [AM.ZK.Worker-pool2-t42] master.AssignmentManager: Found an existing plan &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; tableone,,1394495094967.289ebdee6adf0a3b9c2bbcbe2ff522e7.       destination server is h2-ubuntu12-sec-1394425849-hbase-4.cs1cloud.internal,60020,1394494963812 accepted as a dest server = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2014-03-10 23:48:09,035 DEBUG [AM.ZK.Worker-pool2-t42] master.AssignmentManager: Using pre-existing plan &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; tableone,,1394495094967.289ebdee6adf0a3b9c2bbcbe2ff522e7.;     plan=hri=tableone,,1394495094967.289ebdee6adf0a3b9c2bbcbe2ff522e7., src=h2-ubuntu12-sec-1394425849-hbase-9.cs1cloud.internal,60020,1394494962165, dest=h2-ubuntu12-sec-     1394425849-hbase-4.cs1cloud.internal,60020,1394494963812
2014-03-10 23:48:09,035 INFO  [AM.ZK.Worker-pool2-t42] master.RegionStates: Transitioned {289ebdee6adf0a3b9c2bbcbe2ff522e7 state=CLOSED, ts=1394495289035, server=h2-       ubuntu12-sec-1394425849-hbase-9.cs1cloud.internal,60020,1394494962165} to {289ebdee6adf0a3b9c2bbcbe2ff522e7 state=OFFLINE, ts=1394495289035, server=h2-ubuntu12-sec-        1394425849-hbase-9.cs1cloud.internal,60020,1394494962165}
2014-03-10 23:48:09,035 DEBUG [AM.ZK.Worker-pool2-t42] zookeeper.ZKAssign: master:60000-0x244aa9920190b04, quorum=h2-ubuntu12-sec-1394425849-hbase-8.cs1cloud.internal:2181,h2-ubuntu12-sec-1394425849-hbase-1.cs1cloud.internal:2181,h2-ubuntu12-sec-1394425849-hbase-4.cs1cloud.internal:2181, baseZNode=/hbase Creating (or updating) unassigned     node 289ebdee6adf0a3b9c2bbcbe2ff522e7 with OFFLINE state
2014-03-10 23:48:09,044 INFO  [AM.ZK.Worker-pool2-t42] master.AssignmentManager: Assigning tableone,,1394495094967.289ebdee6adf0a3b9c2bbcbe2ff522e7. to h2-ubuntu12-sec-    1394425849-hbase-4.cs1cloud.internal,60020,1394494963812
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;From hbase-hbase-regionserver-h2-ubuntu12-sec-1394425849-hbase-9.log :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-03-10 23:48:08,487 WARN  [member: &apos;h2-ubuntu12-sec-1394425849-hbase-9.cs1cloud.internal,60020,1394494962165&apos; subprocedure-pool1-thread-1] snapshot.                    RegionServerSnapshotManager: Got Exception in SnapshotSubprocedurePool
java.util.concurrent.ExecutionException: org.apache.hadoop.hbase.NotServingRegionException: tableone,,1394495094967.289ebdee6adf0a3b9c2bbcbe2ff522e7. is closing
  at java.util.concurrent.FutureTask$Sync.innerGet(FutureTask.java:222)
  at java.util.concurrent.FutureTask.get(FutureTask.java:83)
  at org.apache.hadoop.hbase.regionserver.snapshot.RegionServerSnapshotManager$SnapshotSubprocedurePool.waitForOutstandingTasks(RegionServerSnapshotManager.java:325)
  at org.apache.hadoop.hbase.regionserver.snapshot.FlushSnapshotSubprocedure.flushSnapshot(FlushSnapshotSubprocedure.java:118)
  at org.apache.hadoop.hbase.regionserver.snapshot.FlushSnapshotSubprocedure.insideBarrier(FlushSnapshotSubprocedure.java:137)
  at org.apache.hadoop.hbase.procedure.Subprocedure.call(Subprocedure.java:181)
  at org.apache.hadoop.hbase.procedure.Subprocedure.call(Subprocedure.java:52)
  at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
  at java.util.concurrent.FutureTask.run(FutureTask.java:138)
  at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
Caused by: org.apache.hadoop.hbase.NotServingRegionException: tableone,,1394495094967.289ebdee6adf0a3b9c2bbcbe2ff522e7. is closing
  at org.apache.hadoop.hbase.regionserver.HRegion.startRegionOperation(HRegion.java:5699)
  at org.apache.hadoop.hbase.regionserver.HRegion.startRegionOperation(HRegion.java:5663)
  at org.apache.hadoop.hbase.regionserver.snapshot.FlushSnapshotSubprocedure$RegionSnapshotTask.call(FlushSnapshotSubprocedure.java:79)
  at org.apache.hadoop.hbase.regionserver.snapshot.FlushSnapshotSubprocedure$RegionSnapshotTask.call(FlushSnapshotSubprocedure.java:65)
  at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
  at java.util.concurrent.FutureTask.run(FutureTask.java:138)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Load balancer&apos;s move of the underlying region caused FlushSnapshotSubprocedure to fail.&lt;/p&gt;

&lt;p&gt;Mechanism of making load balancer be aware of region operation is desirable such that snapshot doesn&apos;t fail due to the above scenario.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12717926">HBASE-11282</key>
            <summary>Load balancer may move a region which is participating in snapshot</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="7">Later</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 2 Jun 2014 16:09:37 +0000</created>
                <updated>Wed, 4 Jun 2014 00:39:10 +0000</updated>
                            <resolved>Wed, 4 Jun 2014 00:39:10 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="14015596" author="stack" created="Mon, 2 Jun 2014 17:20:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;Mechanism of making load balancer be aware of region operation is desirable such that snapshot doesn&apos;t fail due to the above scenario.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It is allowed that snapshots may fail for any of myriad reasons.&lt;/p&gt;

&lt;p&gt;Tying together two systems we&apos;d like to keep disparate &amp;#8211; the balancer and snapshotting &amp;#8211; unless it really necessary seems like a bad direction to me.&lt;/p&gt;</comment>
                            <comment id="14017002" author="apurtell" created="Tue, 3 Jun 2014 19:01:48 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt;, do you have a concrete proposal for addressing what you described in the description?&lt;/p&gt;</comment>
                            <comment id="14017215" author="yuzhihong@gmail.com" created="Tue, 3 Jun 2014 22:20:41 +0000"  >&lt;p&gt;Will come up with something after Hadoop Summit.&lt;/p&gt;

&lt;p&gt;One approach is to let load balancer know the regions whose table is under table lock. For the duration of active table lock, the regions of the table wouldn&apos;t be moved.&lt;/p&gt;</comment>
                            <comment id="14017230" author="apurtell" created="Tue, 3 Jun 2014 22:46:00 +0000"  >&lt;blockquote&gt;&lt;p&gt;One approach is to let load balancer know the regions whose table is under table lock. For the duration of active table lock, the regions of the table wouldn&apos;t be moved.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Looking forward to the patch. This avoids Stack&apos;s concern about directly tying the balancer and snapshotting together. Avoiding moving regions while the table is locked does not do that and sounds plausible. &lt;/p&gt;</comment>
                            <comment id="14017268" author="stack" created="Tue, 3 Jun 2014 23:54:21 +0000"  >&lt;p&gt;Now we tie the balancer to the lock manager instead?  Is the lock manager then the arbiter of whether a region should be moved or should there be a higher level service the balancer would ask?  And all to address a snapshot failure, when the contract for snapshots has it that they can fail?  Can we work on something more pressing?&lt;/p&gt;</comment>
                            <comment id="14017287" author="apurtell" created="Wed, 4 Jun 2014 00:32:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can we work on something more pressing?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure, I&apos;d be +1 for resolving this as Later or Wont Fix&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 2 Jun 2014 17:20:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>396128</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 28 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1w78n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>396254</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>