<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:04:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2786/HBASE-2786.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2786] TestHLog.testSplit hangs</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2786</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This a blocker had it blocks and times out Hudson.&lt;/p&gt;

&lt;p&gt;It seems that when we upgraded to latest of 0.20-append we got into a new situation where we can&apos;t recover a file that&apos;s empty if the original writer is still alive:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2010-06-24 10:41:20,645 DEBUG [main] wal.HLog(1281): Splitting hlog 4 of 4: hdfs://localhost:64456/hbase/testSplit/.logs/hlog.1277401279534, length=0
2010-06-24 10:41:20,645 INFO  [main] util.FSUtils(612): Recovering filehdfs://localhost:64456/hbase/testSplit/.logs/hlog.1277401279534
2010-06-24 10:41:20,647 WARN  [IPC Server handler 5 on 64456] namenode.FSNamesystem(1156): DIR* NameSystem.startFile: 
failed to create file /hbase/testSplit/.logs/hlog.1277401279534 for DFSClient_-1981892617 on client 127.0.0.1 because current leaseholder is trying to recreate file
...

2010-06-24 10:42:24,919 WARN  [IPC Server handler 0 on 64456] namenode.FSNamesystem(1156): DIR* NameSystem.startFile: 
failed to create file /hbase/testSplit/.logs/hlog.1277401279534 for DFSClient_-1981892617 on client 127.0.0.1 because current leaseholder is trying to recreate file.
2010-06-24 10:42:24,919 WARN  [main] util.FSUtils(631): Waited 64274ms for lease recovery on 
hdfs://localhost:64456/hbase/testSplit/.logs/hlog.1277401279534:org.apache.hadoop.hdfs.protocol.AlreadyBeingCreatedException: 
failed to create file /hbase/testSplit/.logs/hlog.1277401279534 for DFSClient_-1981892617 on client 127.0.0.1 because current leaseholder is trying to recreate file.
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.startFileInternal(FSNamesystem.java:1058)
        at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.appendFile(FSNamesystem.java:1171)
        at org.apache.hadoop.hdfs.server.namenode.NameNode.append(NameNode.java:396)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We could just not roll the latest log and it would probably fix the issue, but I wonder if we could change something in HDFS instead. Todd?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12467825">HBASE-2786</key>
            <summary>TestHLog.testSplit hangs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nspiegelberg">Nicolas Spiegelberg</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Jun 2010 18:15:12 +0000</created>
                <updated>Thu, 2 May 2013 02:29:31 +0000</updated>
                            <resolved>Thu, 24 Jun 2010 20:57:28 +0000</resolved>
                                                    <fixVersion>0.20.6</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12882265" author="nspiegelberg" created="Thu, 24 Jun 2010 18:20:36 +0000"  >&lt;p&gt;in our branch, we have &lt;/p&gt;

&lt;p&gt;      Configuration new_conf = new Configuration(this.conf);&lt;br/&gt;
      new_conf.setBoolean(&quot;dfs.support.append&quot;, false);&lt;br/&gt;
      Path splitsdir = new Path(this.dir, &quot;splits&quot;);&lt;br/&gt;
      List&amp;lt;Path&amp;gt; splits =&lt;br/&gt;
        HLog.splitLog(splitsdir, logdir, this.oldLogDir, this.fs, new_conf);&lt;br/&gt;
      verifySplits(splits, howmany);&lt;/p&gt;

&lt;p&gt;I need to remember what the exact problem is, but that should temporarily fix your issue.&lt;/p&gt;</comment>
                            <comment id="12882285" author="jdcryans" created="Thu, 24 Jun 2010 18:55:09 +0000"  >&lt;p&gt;Downgrading to major now that &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2345&quot; title=&quot;Add Test in 0.20 to Check for proper HDFS-200 append/sync support&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2345&quot;&gt;&lt;del&gt;HBASE-2345&lt;/del&gt;&lt;/a&gt; was committed with a temp fix.&lt;/p&gt;</comment>
                            <comment id="12882294" author="nspiegelberg" created="Thu, 24 Jun 2010 19:24:36 +0000"  >&lt;p&gt;hey, this should permanently fix the issue.  The problem is that log rolling closes the writer that we care about, then creates a 2nd writer with empty data.  Need to close that 2nd writer or we&apos;ll infinite wait in the hfile.append() call.  Calling log.close() should be sufficient.  I think I quickly hobbled together the previous patch because I considered this a test of split correctness, not whether you could recover data on open files.&lt;/p&gt;</comment>
                            <comment id="12882327" author="jdcryans" created="Thu, 24 Jun 2010 20:57:28 +0000"  >&lt;p&gt;I was under the impression that a close of some sort was needed, I committed that to trunk. Thanks Nicolas!&lt;/p&gt;</comment>
                            <comment id="12882440" author="apurtell" created="Fri, 25 Jun 2010 04:40:13 +0000"  >&lt;p&gt;This happens on 0.20 branch too now that 0.20-append enables append by default. Committed there. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12459596">HBASE-2345</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12447976" name="HBASE-2786.patch" size="972" author="nspiegelberg" created="Thu, 24 Jun 2010 19:24:36 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Jun 2010 18:20:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26468</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08scf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49192</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>