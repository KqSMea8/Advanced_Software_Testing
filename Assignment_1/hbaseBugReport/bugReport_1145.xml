<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:51:07 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1145/HBASE-1145.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1145] Ensure that there is only 1 Master with Zookeeper (part of HA Master)</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1145</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description></description>
                <environment></environment>
        <key id="12412929">HBASE-1145</key>
            <summary>Ensure that there is only 1 Master with Zookeeper (part of HA Master)</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12392373">HBASE-546</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nitay">Nitay Joffe</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Jan 2009 19:05:00 +0000</created>
                <updated>Thu, 2 May 2013 02:29:20 +0000</updated>
                            <resolved>Wed, 25 Mar 2009 14:13:31 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12666240" author="stack" created="Thu, 22 Jan 2009 18:29:51 +0000"  >&lt;p&gt;Evgeny:&lt;/p&gt;

&lt;p&gt;If you are particularly interested in this topic, go for it but maybe you&apos;d do better working on another issue.  Two fellas are already hacking on ZK and hbase and have been working closely on the integration (jdcryans and nitay).  Just FYI.&lt;/p&gt;</comment>
                            <comment id="12666953" author="apparition" created="Sat, 24 Jan 2009 16:44:31 +0000"  >&lt;p&gt;For this issue can be used Leader Election algorithm   &lt;a href=&quot;http://hadoop.apache.org/zookeeper/docs/r3.0.1/recipes.html#sc_leaderElection&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hadoop.apache.org/zookeeper/docs/r3.0.1/recipes.html#sc_leaderElection&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;1) Create a znode for master election if it not exists:&lt;br/&gt;
      create(&quot;master-election&quot;, new byte&lt;span class=&quot;error&quot;&gt;&amp;#91;0&amp;#93;&lt;/span&gt;, PERSISTENT);&lt;br/&gt;
if node exits, catch NodeExistsException and keep going&lt;/p&gt;

&lt;p&gt;2) create(&quot;master-election/master-&quot;, masterLocation, EPHEMERAL_SEQUENTIAL);&lt;/p&gt;

&lt;p&gt;3) getChildren(&quot;master-election&quot;, false);&lt;br/&gt;
    if there is only one child (that was just created) then master becomes ACTIVE;&lt;br/&gt;
4) else &lt;br/&gt;
    let j be smallest SEQUENTIAL number for master nodes&lt;br/&gt;
5) exists(&quot;master-election/master-&quot; + j, true);&lt;br/&gt;
if exists go to 3&lt;br/&gt;
else&lt;br/&gt;
become a &quot;hot-ready&quot; master wait till EVENT (triggering of watch)&lt;br/&gt;
if event goto 3&lt;/p&gt;</comment>
                            <comment id="12667023" author="ryanobjc" created="Sat, 24 Jan 2009 23:58:47 +0000"  >&lt;p&gt;Evegeny, I&apos;m not sure where you are going with that, but we should follow the advice here:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://hadoop.apache.org/zookeeper/docs/r3.0.1/recipes.html#sc_leaderElection&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hadoop.apache.org/zookeeper/docs/r3.0.1/recipes.html#sc_leaderElection&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Which indicates how to (a) elect a master and (b) indicates how to indicate which is the current master.&lt;/p&gt;

&lt;p&gt;This implies that Hbase clients must consult ZK to know who the current master is... that way clients would no longer be configured with a specific IP/port, they would take a ZK path to know what master they are on.&lt;/p&gt;</comment>
                            <comment id="12667032" author="apparition" created="Sun, 25 Jan 2009 00:59:06 +0000"  >&lt;p&gt;2 ryan rawson :&lt;br/&gt;
thx for your remarks. I have edited my post and now it&apos;s much better &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12667498" author="apparition" created="Mon, 26 Jan 2009 23:46:41 +0000"  >&lt;p&gt;After talk with Nitay Joffe on IRC we decide that he will do this issue because it&apos;s closely related to  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1144&quot; title=&quot;Store the ROOT region location in Zookeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1144&quot;&gt;&lt;del&gt;HBASE-1144&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
So I am unassigning...&lt;/p&gt;</comment>
                            <comment id="12669261" author="nitay" created="Sat, 31 Jan 2009 21:47:35 +0000"  >&lt;p&gt;Eventually, the leader election described above is the way to go. Then any regionservers can assume the master role and there are no special master servers. That implementation requires a lot of heavy changes, so for right now we are going to just do a master lock.&lt;/p&gt;

&lt;p&gt;Users will spin up multiple masters, and they will race to grab the master lock in ZooKeeper. Whoever grabs it creates the ephemeral node and writes their server address to the ZNode. The rest of the masters will sit around waiting for the ephemeral node to go away (master goes down) and then the race repeats.&lt;/p&gt;

&lt;p&gt;Region servers and clients will go to this location in ZooKeeper to get the master address. This means we can get rid of the hbase.master property in hbase-site.xml. To retain the option of running in &quot;local&quot; mode, we will add a &quot;run.distributed&quot; property to the hbase-site.xml which defaults to false. For backwards compatibility, if users have their hbase.master set to something other than &quot;local&quot;, we can override the run.distributed option and produce a warning that the &quot;hbase.master&quot; option is going away and they should update their hbase-site.xml with the new &quot;run.distributed&quot; property.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="12669305" author="nitay" created="Sun, 1 Feb 2009 00:54:25 +0000"  >&lt;p&gt;There is a bit of an issue regarding getting rid of the &quot;hbase.master&quot; property in hbase-site.xml. Currently, anybody in HBase needing ZooKeeper parses the server.X lines out of conf/zoo.cfg to know how to connect to ZooKeeper. If there are no server.X lines, it means we are running a single instance ZooKeeper on the master server. To find that server, we use the &quot;hbase.master&quot; property in hbase-site.xml.&lt;/p&gt;

&lt;p&gt;After discussing it with Andrew Purtell and Michael Stack, we came up with the following:&lt;/p&gt;

&lt;p&gt;We have three cases:&lt;br/&gt;
1) &quot;local&quot; mode. All servers/clients are on localhost.&lt;br/&gt;
2) Distributed operation with single instance ZooKeeper running on master host.&lt;br/&gt;
3) Distributed operation with distributed ZooKeeper running.&lt;/p&gt;

&lt;p&gt;To fix these cases (1 and 2) and allow us to remove the &quot;hbase.master&quot; property from hbase-site.xml, we need to make sure there is &lt;em&gt;always&lt;/em&gt; a server.X line with the master&apos;s address in the zoo.cfg. Even when you&apos;re running a single instance ZooKeeper on the master server, there should be a single server.X line with the master&apos;s address.&lt;/p&gt;

&lt;p&gt;To avoid adding a lot of configuration headache on the user, we want to have the default conf/zoo.cfg have a sensible default for the single server master hostname case. We suggest shipping a new ZooKeeper jar with &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-279&quot; title=&quot;Allow specialization of quorum config parsing (e.g. variable expansion in zoo.cfg)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-279&quot;&gt;&lt;del&gt;ZOOKEEPER-279&lt;/del&gt;&lt;/a&gt; patched in, and using the variable substitution to inject the master hostname into zoo.cfg. For example, our new zoo.cfg would look something like:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# The number of milliseconds of each tick
tickTime=2000
# The number of ticks that the initial 
# synchronization phase can take
initLimit=10
# The number of ticks that can pass between 
# sending a request and getting an acknowledgement
syncLimit=5
# the directory where the snapshot is stored.
dataDir=${hbase.tmp.dir}/zookeeper
# the port at which the clients will connect
clientPort=2181 

server.0=${master.address.hostname}:2888:3888
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;The &quot;master.address.hostname&quot; is a new property being added to the hbase-site.xml during this period while we transition users to ZooKeeper. If the property is not set, we will use gethostname() to fill in the variable and produce copious warning messages that it may not work and the user should either fill in that variable in hbase-site.xml, or edit zoo.cfg by hand.&lt;/p&gt;</comment>
                            <comment id="12674839" author="nitay" created="Thu, 19 Feb 2009 00:48:28 +0000"  >&lt;p&gt;First stab at this.&lt;/p&gt;

&lt;p&gt;In this patch:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Remove &quot;hbase.master&quot; hbase-default.xml. This property is not required anymore, but it still used if it exists. Replaced &quot;local&quot; mode with a new boolean property, &quot;run.distributed&quot; which defaults to false. Local mode is used if &quot;hbase.master&quot; is either missing or null, and &quot;run.distributed&quot; is false.&lt;/li&gt;
	&lt;li&gt;Add property for master port. When &quot;hbase.master&quot; does not exist, we construct the master&apos;s address by looking up our hostname and appending the port to that.&lt;/li&gt;
	&lt;li&gt;HConnectionManager/HRegionServer read master address form ZooKeeper.&lt;/li&gt;
	&lt;li&gt;Master startup is done by a race to grab the ephemeral ZNode in ZooKeeper. The user is free to spin up as many masters as they like. When a master starts up it waits until the ZNode is available (either because it didn&apos;t exist or because the master owning it died and triggered a NodeDeleted event to the watcher). Once it&apos;s available, the master tries to write its address to it. Whoever wins continues with its initialization and becomes the master while the others resume watching the ZNode.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;Note that currently if a master goes down and another one takes over the regionservers will not find it. I will file a separate issue for the regionservers to check/watch the master address in ZooKeeper.&lt;/p&gt;</comment>
                            <comment id="12675095" author="stack" created="Thu, 19 Feb 2009 19:22:55 +0000"  >&lt;p&gt;Thanks for the comments on patch.  Helps reading the patch src.  Patch looks great.  One question, how do I override what hbase finds looking up hostname?   Add to zoo.cfg an explicit address? (I just saw this +    String addressStr = conf.get(MASTER_ADDRESS)&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Regards this property, run.distributed, give it a hbase prefix; our stuff can be mixed in with hadoop and who ever else uses the hadoop Configuration system.&lt;/p&gt;

&lt;p&gt;Regards this comment &quot;Enable this to run a distributed HBase. When this is disabled&lt;br/&gt;
+    (the default) HBase runs all processes on the current host in a local mode.&quot;, if &apos;false&apos;, we don&apos;t read the regionservers file?&lt;/p&gt;

&lt;p&gt;Can this be final since set in constructor?&lt;/p&gt;

&lt;p&gt;+  private ZooKeeperWrapper zooKeeper;&lt;/p&gt;

&lt;p&gt;You don&apos;t need a patched ZK jar to do this?&lt;/p&gt;</comment>
                            <comment id="12675103" author="nitay" created="Thu, 19 Feb 2009 19:44:27 +0000"  >&lt;p&gt;The conf.get(MASTER_ADDRESS) is only for backwards compatibility. It&apos;s used in the master code when trying to figure out what its hostname/port is. It overrides the rest of the options, but is also optional. The line with hostname got deleted for some reason, I&apos;ll put it back in the next version. The code for finding out master&apos;s hostname/port should look like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; addressStr = conf.get(MASTER_ADDRESS);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (addressStr == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  addressStr = conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.master.hostname&quot;&lt;/span&gt;);
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (addressStr == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    addressStr = InetAddress.getLocalHost().getCanonicalHostName();
  }
  addressStr += &lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;;
  addressStr += conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.master.port&quot;&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;.toString(DEFAULT_MASTER_PORT));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Will fix distributed property name.&lt;/p&gt;

&lt;p&gt;Will fix final ZooKeeperWrapper.&lt;/p&gt;

&lt;p&gt;The patches ZK jar is needed. Essentially we just need to make sure there is always at least one server.X line in conf/zoo.cfg for things to work right. In order to do that, we want to update the template to use the &quot;hbase.master.hostname&quot; property. This is why this issue depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1204&quot; title=&quot;Ensure there is always at least one server.X line in ZooKeeper conf/zoo.cfg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1204&quot;&gt;&lt;del&gt;HBASE-1204&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12682591" author="nitay" created="Tue, 17 Mar 2009 08:26:02 +0000"  >&lt;p&gt;This patch includes &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1204&quot; title=&quot;Ensure there is always at least one server.X line in ZooKeeper conf/zoo.cfg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1204&quot;&gt;&lt;del&gt;HBASE-1204&lt;/del&gt;&lt;/a&gt;, because they are very closely related and require each other.&lt;/p&gt;

&lt;p&gt;This version contains fixes for the things mentioned by stack. It also includes everything from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1204&quot; title=&quot;Ensure there is always at least one server.X line in ZooKeeper conf/zoo.cfg&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1204&quot;&gt;&lt;del&gt;HBASE-1204&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Still need to update overview.html for deprecated &quot;hbase.master&quot; options and new &quot;run.distributed&quot;, &quot;hbase.master.hostname&quot;, and &quot;hbase.master.port&quot; options.&lt;/p&gt;

&lt;p&gt;Also, will open a JIRA after this to make RegionServers watch master ZNode so that when master moves they will get the updated location.&lt;/p&gt;</comment>
                            <comment id="12683159" author="stack" created="Wed, 18 Mar 2009 20:41:51 +0000"  >&lt;p&gt;Committed.  Thanks for the sweet patch Nitay.  Be aware, after this patch hbase.master goes away (radical!)&lt;/p&gt;</comment>
                            <comment id="12683243" author="nitay" created="Wed, 18 Mar 2009 23:54:20 +0000"  >&lt;p&gt;Update to overview.html.&lt;br/&gt;
Also changes property &quot;run.distributed&quot; to &quot;hbase.fully.distributed&quot;.&lt;/p&gt;

&lt;p&gt;Speaking of which, why do we actually need that property? What about just assuming distributed mode if hbase.master.hostname is not localhost instead? In other words in the LocalHBaseCluster#isLocal check, we test if hbase.master is missing or &quot;local/local:&quot; and hbase.master.hostname is &quot;localhost&quot;.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;</comment>
                            <comment id="12689086" author="stack" created="Wed, 25 Mar 2009 11:28:47 +0000"  >&lt;p&gt;Nitay, process note, make a new issue for the doc change.  I&apos;ll wait on commit till we figure answer to your question above.&lt;/p&gt;

&lt;p&gt;On the hbase.fully.distributed, agree, we don&apos;t need it.  We just need to be clear on how to enable &apos;local&apos; mode.    &apos;localhost&apos; in hbase.master.hostname is not sufficient though, right?  What if user wants to run in pseudo-distributed mode.  Here their hbase.master.hostname is &apos;localhost&apos; but master and regionserver are separate daemons as opposed to both running in the one JVM as happens when you used to set hbase.master to &apos;local&apos;.  Can we set hbase.master.hostname to &apos;local&apos; to trigger master and regionserver in the one JVM?&lt;/p&gt;</comment>
                            <comment id="12689119" author="stack" created="Wed, 25 Mar 2009 14:13:31 +0000"  >&lt;p&gt;Committed.  You didn&apos;t break the thrift test Tim.  Thanks for the patch (Test would be too hard &amp;#8211; don&apos;t worry about it).&lt;/p&gt;</comment>
                            <comment id="12689289" author="stack" created="Thu, 26 Mar 2009 00:07:07 +0000"  >&lt;p&gt;Closed with mistaken reference to hbase-1285 but looks like this issue should be closed anyways after hbase-1289 went in (Please reopen if I got it wrong Nitay)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12415106">HBASE-1204</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12415107">HBASE-1205</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12402363" name="hbase-1145.patch" size="33803" author="nitay" created="Tue, 17 Mar 2009 08:26:02 +0000"/>
                            <attachment id="12400464" name="hbase-1145.patch" size="20970" author="nitay" created="Thu, 19 Feb 2009 00:48:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 Jan 2009 18:29:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32004</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 39 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hblb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99140</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>