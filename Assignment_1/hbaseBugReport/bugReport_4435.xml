<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:18:54 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4435/HBASE-4435.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4435] Add Group By functionality using Coprocessors</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4435</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Adds in a Group By -like functionality to HBase, using the Coprocessor framework. &lt;/p&gt;

&lt;p&gt;It provides the ability to group the result set on one or more columns (groupBy families). It computes statistics (max, min, sum, count, sum of squares, number missing) for a second column, called the stats column. &lt;/p&gt;

&lt;p&gt;To use, I&apos;ve provided two implementations.&lt;/p&gt;

&lt;p&gt;1. In the first, you specify a single group-by column and a stats field:&lt;/p&gt;

&lt;p&gt;      statsMap = gbc.getStats(tableName, scan, groupByFamily, groupByQualifier, statsFamily, statsQualifier, statsFieldColumnInterpreter);&lt;/p&gt;

&lt;p&gt;The result is a map with the Group By column value (as a String) to a GroupByStatsValues object. The GroupByStatsValues object has max,min,sum etc. of the stats column for that group.&lt;/p&gt;

&lt;p&gt;2. The second implementation allows you to specify a list of group-by columns and a stats field. The List of group-by columns is expected to contain lists of &lt;/p&gt;
{column family, qualifier}
&lt;p&gt; pairs. &lt;/p&gt;

&lt;p&gt;      statsMap = gbc.getStats(tableName, scan, listOfGroupByColumns, statsFamily, statsQualifier, statsFieldColumnInterpreter);&lt;/p&gt;


&lt;p&gt;The GroupByStatsValues code is adapted from the Solr Stats component.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12523558">HBASE-4435</key>
            <summary>Add Group By functionality using Coprocessors</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kntreadway">Nichole Treadway</reporter>
                        <labels>
                            <label>by</label>
                            <label>coprocessors</label>
                            <label>group</label>
                            <label>hbase</label>
                    </labels>
                <created>Mon, 19 Sep 2011 14:03:10 +0000</created>
                <updated>Fri, 7 Aug 2015 16:20:08 +0000</updated>
                                                                            <component>Coprocessors</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>16</watches>
                                                                <comments>
                            <comment id="13107891" author="kntreadway" created="Mon, 19 Sep 2011 15:12:16 +0000"  >&lt;p&gt;My first patch included some additional unrelated changes to other parts of the code base that I did not want to include in this patch...sorry about that.&lt;/p&gt;</comment>
                            <comment id="13167477" author="hammer" created="Mon, 12 Dec 2011 12:49:24 +0000"  >&lt;p&gt;How does this approach compare to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1512&quot; title=&quot;Coprocessors: Support aggregate functions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1512&quot;&gt;&lt;del&gt;HBASE-1512&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13225933" author="kele8boy" created="Fri, 9 Mar 2012 08:33:37 +0000"  >&lt;p&gt;60000 millis timeout while waiting for channel to be ready for read. ch : java.nio.channels.SocketChannel&lt;/p&gt;</comment>
                            <comment id="13255546" author="kele8boy" created="Tue, 17 Apr 2012 13:17:52 +0000"  >&lt;p&gt;when can this patch be put into hbase?&lt;/p&gt;</comment>
                            <comment id="13255557" author="zhihyu@ebaysf.com" created="Tue, 17 Apr 2012 13:29:28 +0000"  >&lt;p&gt;@Nicole:&lt;br/&gt;
The attached patch is half year old. Do you have a newer version ?&lt;/p&gt;</comment>
                            <comment id="13478247" author="aartokhy" created="Wed, 17 Oct 2012 19:01:53 +0000"  >&lt;p&gt;I have a newer version of the patch:&lt;/p&gt;

&lt;p&gt;Improvements:&lt;/p&gt;

&lt;p&gt;1) Added implementations of ColumnInterpreter classes so both AggregationClient and GroupByClient could perform aggregations on Long, Short, Integer, Double, Float, Character (or unsigned short), and BigDecimal types.&lt;/p&gt;

&lt;p&gt;2) The GroupByStatsValues class is a Java generic that constrains on Java types that only implement the &apos;Number&apos; interface.  This way the generic is constrained for those types at compile time.&lt;/p&gt;

&lt;p&gt;3) Previously, a HashMap was returned at the end of each RPC call.  HashMap uses java.io.Serializable, which is relatively heavyweight.  Switched to using the Hadoop Writable interface so all objects passed between clients and regionservers use the Hadoop Writable interface.&lt;/p&gt;

&lt;p&gt;4) Fixed some validateParameter bugs in the previous patch which would allow selections of column qualifiers not found in the Scan object to go through.&lt;/p&gt;

&lt;p&gt;Caveats:&lt;/p&gt;

&lt;p&gt;1) This works well if your resultset fits into memory as group by values are aggregated into a HashMap on the client.  Therefore, if the cardinality of the aggregation table is too high, you may get an OOME.&lt;/p&gt;

&lt;p&gt;2) All aggregations are calculated by the &apos;GroupByStatsValues&apos; container.  Perhaps at object construction, a &apos;statsvalues&apos; can be constructed to only perform some of the aggregations instead of all of them at the same time.  However this operation is Scan (IO) bound, so improvements would be minimal here.&lt;/p&gt;

&lt;p&gt;3) Like all coprocessors that accept a Scan object, if the aggregation is performing a full table scan, this will run on all regionservers.  Each region level coprocessor is loaded into an IPC handler (default of 10) on the regionserver.  If the regionserver has more regions than IPC handlers, only 10 group by operations will run at a time.&lt;/p&gt;

&lt;p&gt;Depending on your table schema, region size and blockCacheHitRatio, your mileage may vary.  If data can be preaggregated for a group by operation, this patch would be handy for aggregating a single column value projection of the original full table.  A column oriented representation of the original table would work well in this case, or possibly a client/coprocessor managed secondary index.&lt;/p&gt;

&lt;p&gt;The patch applies cleanly onto HBase 0.92.1 and HBase 0.94.1.&lt;/p&gt;</comment>
                            <comment id="13478311" author="yuzhihong@gmail.com" created="Wed, 17 Oct 2012 19:56:34 +0000"  >&lt;p&gt;Thanks for the patch.&lt;br/&gt;
Can you provide trunk patch following the example of:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6785&quot; title=&quot;Convert AggregateProtocol to protobuf defined coprocessor service&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6785&quot;&gt;&lt;del&gt;HBASE-6785&lt;/del&gt;&lt;/a&gt; &apos;Convert AggregateProtocol to protobuf defined coprocessor service&apos;&lt;/p&gt;

&lt;p&gt;Will provide comments soon.&lt;/p&gt;

&lt;p&gt;For patch of this size, review board (&lt;a href=&quot;https://reviews.apache.org&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org&lt;/a&gt;) would help reviewers.&lt;/p&gt;</comment>
                            <comment id="13478351" author="yuzhihong@gmail.com" created="Wed, 17 Oct 2012 20:41:51 +0000"  >&lt;p&gt;I didn&apos;t find any test in the patch. It would be difficult for a feature to be accepted without new tests.&lt;br/&gt;
Should GroupByStatsValues be named GroupByStats (since stats imply some values) ?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ * Copyright 2012 The Apache Software Foundation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above line is no longer needed in license header.&lt;/p&gt;

&lt;p&gt;BigDecimalColumnInterpreter is covered in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6669&quot; title=&quot;Add BigDecimalColumnInterpreter for doing aggregations using AggregationClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6669&quot;&gt;&lt;del&gt;HBASE-6669&lt;/del&gt;&lt;/a&gt;. To make the workload reasonable for this JIRA, you can exclude it from patch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class CharacterColumnInterpreter &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; ColumnInterpreter&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Character&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Character&lt;/span&gt;&amp;gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Add annotation for audience and stability for public classes.&lt;/p&gt;

&lt;p&gt;In GroupByClient.java, the following import can be removed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; com.sun.istack.logging.Logger;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    Map&amp;lt;Text, GroupByStatsValues&amp;lt;T, S&amp;gt;&amp;gt; getStats(
+      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] tableName, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Scan scan, 
+      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [][]&amp;gt; groupByTuples, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[][] statsTuple, 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The @param for the above method doesn&apos;t match actual parameters - probably you changed API in later iteration.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    class RowNumCallback &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above class can be made private.&lt;br/&gt;
I think we should find a better name for the above class - it does aggregation.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; bt = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please use EnvironmentEdge instead.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    table.close();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please enclose the above in finally clause.&lt;/p&gt;</comment>
                            <comment id="13478408" author="aartokhy" created="Wed, 17 Oct 2012 21:27:10 +0000"  >&lt;p&gt;Thanks for the quick review, I&apos;ll soon update JIRA with a new patch, based off of SVN trunk, though not at the moment.  Also I&apos;ll have to clean up some of the code, thanks for the quick feedback!&lt;/p&gt;

&lt;p&gt;I may also change a few other things, such as using HashedBytes instead of Text to be able to perform roll-ups of types other than UTF-8 strings.&lt;/p&gt;</comment>
                            <comment id="13540856" author="anoopsamjohn" created="Sat, 29 Dec 2012 11:22:21 +0000"  >&lt;p&gt;May be good to add to the CP examples section. Someone working with this?&lt;/p&gt;</comment>
                            <comment id="13549291" author="aartokhy" created="Thu, 10 Jan 2013 02:08:09 +0000"  >&lt;p&gt;I was working on other coprocessors in addition to this one in performing reverse indexing for range queries as well as filters that could be used to only scan a small portion of a region given a key-list.&lt;/p&gt;

&lt;p&gt;I created a Github for this work, so that I could split this work out into individual JIRA tickets.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/atokhy/secondary-index-coprocessor&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/atokhy/secondary-index-coprocessor&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ll be working with HBase 0.94.1 until I have a complete working implementation, and eventually rewrite most of it to use Google&apos;s protobuf API as another attempt.&lt;/p&gt;</comment>
                            <comment id="14662049" author="nmarasoi" created="Fri, 7 Aug 2015 16:20:08 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Is this still ongoing? I looked on github and seemed that only one metric like sum(column) is done, not multiple ones. The general case is of course group by (d1,..,dn) sum(c1) hyperlogUniq(c2) i.e. multiple metrics.&lt;/p&gt;

&lt;p&gt;Thank you,&lt;br/&gt;
Nicu&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12427760">HBASE-1512</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12625635">HBASE-7474</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12549553" name="HBASE-4435-v2.patch" size="52766" author="aartokhy" created="Wed, 17 Oct 2012 19:01:52 +0000"/>
                            <attachment id="12495084" name="HBase-4435.patch" size="29711" author="kntreadway" created="Mon, 19 Sep 2011 15:12:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 12 Dec 2011 12:49:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33552</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 19 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02esn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11998</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>