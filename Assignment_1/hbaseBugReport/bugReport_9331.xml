<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:03:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9331/HBASE-9331.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9331] FuzzyRow filter getNextForFuzzyRule not working properly for special case</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9331</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The case that getNextForFuzzyRule() fails is when the result (fuzzy key) is extended in length (zero padded) to match the current row for comparisons.  If the hint is returned with zero padded bytes, the next seek may skip over a valid match.  See the example below.&lt;/p&gt;

&lt;p&gt;    /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The code below circumvents the following situation.&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;fuzzy.key  = visitor,session,Logon&lt;/li&gt;
	&lt;li&gt;fuzzy.mask = 000000001111111000000&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;example hbase row data:&lt;/li&gt;
	&lt;li&gt;visitor,session,AddToCart&lt;/li&gt;
	&lt;li&gt;&quot;       &quot;    FacebookLike&lt;/li&gt;
	&lt;li&gt;&quot;       &quot;    Logon&lt;/li&gt;
	&lt;li&gt;&quot;       &quot;    MobileSpecial&lt;/li&gt;
	&lt;li&gt;...&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;For row &quot;visitor,sessionAddToCart&quot;, the current code would&lt;/li&gt;
	&lt;li&gt;return a hint of &quot;visitor,session,Logon\0\0\0\0&quot; (zero padded).&lt;/li&gt;
	&lt;li&gt;The next seek would skip &quot;visitor,session,Logon&quot; and jump&lt;/li&gt;
	&lt;li&gt;to &quot;visitor,session,MobileSpecial&quot;.&lt;br/&gt;
     */&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;    // trim trailing zeros that were not part of the original fuzzy key&lt;br/&gt;
    int i = result.length;&lt;br/&gt;
    for (; i &amp;gt; fuzzyKeyBytes.length; i--)&lt;/p&gt;
    {
    	if (result[i-1] != 0x00)
    		break;
    }
&lt;p&gt;    if (i != result.length)&lt;/p&gt;
    {
    	result = Arrays.copyOf(result, i);
    }

&lt;p&gt;The code above added to the end of getNextFuzzyRule() will circumvent the issue.  I tested my scenario and it produces the correct results.  There may be a better solution.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Issue is not dependent upon environment.&lt;/p&gt;</environment>
        <key id="12665346">HBASE-9331</key>
            <summary>FuzzyRow filter getNextForFuzzyRule not working properly for special case</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="saspad">Tony Dean</reporter>
                        <labels>
                    </labels>
                <created>Fri, 23 Aug 2013 23:24:32 +0000</created>
                <updated>Fri, 13 Sep 2013 02:24:38 +0000</updated>
                                            <version>0.94.11</version>
                                                    <component>Filters</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13749161" author="yuzhihong@gmail.com" created="Fri, 23 Aug 2013 23:40:58 +0000"  >&lt;p&gt;@Tony:&lt;br/&gt;
Can you put the above scenario in a unit test ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13749523" author="saspad" created="Sun, 25 Aug 2013 04:19:17 +0000"  >&lt;p&gt;The TestFuzzyRowFilter unittest needs modification to produce the correct results.  A unix diff of this file is attached.&lt;/p&gt;</comment>
                            <comment id="13749833" author="vmariyala" created="Mon, 26 Aug 2013 05:07:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuzhihong%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yuzhihong@gmail.com&quot;&gt;Ted Yu&lt;/a&gt; Does FuzzyRowFilter have the below assumptions?&lt;/p&gt;

&lt;p&gt;a) All the row keys are off the same length because the next for a valid fuzzy row match (key=&lt;/p&gt;
{0,1,1,1}
&lt;p&gt;) can always be a zero appended byte array (key=&lt;/p&gt;
{0,1,1,1,0}
&lt;p&gt;). If this assumption is always true, this jira could no longer be an issue.&lt;/p&gt;

&lt;p&gt;b) The length of the row key must always be greater than or equal to the length of fuzzy row key or fuzzy info.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    Assert.assertEquals(FuzzyRowFilter.SatisfiesCode.YES,
        FuzzyRowFilter.satisfies(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]{1, 0, 1}, &lt;span class=&quot;code-comment&quot;&gt;// row to check only 3 bytes
&lt;/span&gt;                                 &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]{1, 0, 1, 0, 1}, &lt;span class=&quot;code-comment&quot;&gt;// fuzzy row contains 5 bytes
&lt;/span&gt;                                 &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]{0, 1, 0, 0, 0})); &lt;span class=&quot;code-comment&quot;&gt;// mask contains 5 bytes
&lt;/span&gt;
    The intention is to extract the rows off the pattern 1?101. But a row 101 satisfies the pattern and is included in the results.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;c) Does fuzzy row key need to have &apos;0&apos;s even in the places where the fuzzy info contains a 1 (indicates a non-fixed byte)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    assertNext(
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]{1, 1, 1, 1},  &lt;span class=&quot;code-comment&quot;&gt;//fuzzy row
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]{0, 0, 1, 1},  &lt;span class=&quot;code-comment&quot;&gt;//fuzzy mask (info)
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]{0, 1, 3, 2},  &lt;span class=&quot;code-comment&quot;&gt;//current row
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]{1, 1, 1, 1}); &lt;span class=&quot;code-comment&quot;&gt;//next row (expected). FAILURE: There is a potential match at {1,1,0,0} and has been ignored by the FuzzyRowFilter.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13766187" author="saspad" created="Fri, 13 Sep 2013 02:24:38 +0000"  >&lt;p&gt;I did not see any limitation about the row key length having to be &amp;gt;= fuzzy key length.  IMHO I think it is common that the data exhibit differing row key lengths.  If it is a current limitation can we remove it.  Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12599820" name="TestFuzzyRowFilter.patch" size="816" author="saspad" created="Sun, 25 Aug 2013 04:19:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 23 Aug 2013 23:40:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>345286</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1njkf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>345587</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>