<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:17:49 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-16786/HBASE-16786.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-16786] Procedure V2 - Move ZK-lock&apos;s uses to Procedure framework locks (LockProcedure)</title>
                <link>https://issues.apache.org/jira/browse/HBASE-16786</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description></description>
                <environment></environment>
        <key id="13010297">HBASE-16786</key>
            <summary>Procedure V2 - Move ZK-lock&apos;s uses to Procedure framework locks (LockProcedure)</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12860901">HBASE-14350</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="mbertozzi">Matteo Bertozzi</assignee>
                                    <reporter username="appy">Appy</reporter>
                        <labels>
                    </labels>
                <created>Thu, 6 Oct 2016 22:33:52 +0000</created>
                <updated>Tue, 6 Dec 2016 17:44:05 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15561153" author="appy" created="Mon, 10 Oct 2016 03:32:24 +0000"  >&lt;p&gt;Uploaded first version of patch. Still need to figure out how to handle mob locks.&lt;br/&gt;
Mob advertises that it uses zk locks for mutual exclusion between sweep job which won&apos;t be possible now if master is down.&lt;br/&gt;
Also this non-trivial lock operations: &lt;a href=&quot;https://github.com/apache/hbase/blob/master/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HMobStore.java#L465&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/hbase/blob/master/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HMobStore.java#L465&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We have two options:&lt;br/&gt;
1. keep zk locks: maybe external tools take master lock (if master is available) otherwise,  zk lock. When master starts up, it too tries to take zk lock.&lt;br/&gt;
2. Get rid of zk locks: If master isn&apos;t alive, tools don&apos;t work until forced by cmd line option, say &quot;--ignore-locks&quot;. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;, how should we do it?&lt;/p&gt;</comment>
                            <comment id="15570583" author="jingcheng.du@intel.com" created="Thu, 13 Oct 2016 02:24:40 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=appy&quot; class=&quot;user-hover&quot; rel=&quot;appy&quot;&gt;Appy&lt;/a&gt;.&lt;br/&gt;
The lock in MOB is trying to avoid making deleted cells live again.&lt;br/&gt;
If we always retain the delete markers - until they are expired - in major compaction like what we do now in major compaction when write lock cannot be acquired, the locks are not needed anymore. How do you think about this approach? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmhsieh&quot; class=&quot;user-hover&quot; rel=&quot;jmhsieh&quot;&gt;Jonathan Hsieh&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15580792" author="appy" created="Mon, 17 Oct 2016 00:16:56 +0000"  >&lt;p&gt;Tested on a 2 node cluster.&lt;br/&gt;
Turned on debugging log for org.apache.hadoop.hbase.master.procedure (LockProcedure) and org.apache.hadoop.hbase.zookeeper.lock (removed ZK locks) on master, and for org.apache.hadoop.hbase.client on RS.&lt;/p&gt;

&lt;p&gt;Tried split, merge, and snapshot.&lt;br/&gt;
Here are log snippets.&lt;/p&gt;

&lt;p&gt;MASTER SIDE:&lt;/p&gt;

&lt;p&gt;For split&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2016-10-16 16:56:23,414 DEBUG [ProcedureExecutor-2] procedure.LockProcedure: LOCKED - org.apache.hadoop.hbase.master.procedure.LockProcedureregions=[b483519eec2363741d93d385c4c80658,], level=REGION, type=EXCLUSIVE id=6 owner=root state=RUNNABLE
.....splitting logs....
2016-10-16 16:56:23,516 INFO  [RpcServer.FifoWFPBQ.default.handler=29,queue=2,port=16000] master.RegionStateStore: Updating hbase:meta row t,5,1476662183411.55213a2fd15ee64c7ad84ff54c19f6c3. with state=OPEN, openSeqNum=1, server=appy-2.vpc.cloudera.com,16020,1476661149567
2016-10-16 16:56:23,523 DEBUG [ProcedureExecutor-3] procedure.LockProcedure: UNLOCKED - org.apache.hadoop.hbase.master.procedure.LockProcedureregions=[b483519eec2363741d93d385c4c80658,], level=REGION, type=EXCLUSIVE id=6 owner=root state=RUNNABLE
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For merge&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2016-10-16 17:06:38,869 DEBUG [ProcedureExecutor-3] procedure.LockProcedure: LOCKED - org.apache.hadoop.hbase.master.procedure.LockProcedureregions=[8958d3630516df4bac518faea9db09ce,55213a2fd15ee64c7ad84ff54c19f6c3,], level=REGION, type=EXCLUSIVE id=8 owner=root state=RUNNABLE
....other merge regions log....
2016-10-16 17:06:39,923 INFO  [RpcServer.FifoWFPBQ.default.handler=29,queue=2,port=16000] master.RegionStates: Transition {7b208ef804e26f84f8a59d5d850d6300 state=MERGING_NEW, ts=1476662799833, server=appy-2.vpc.cloudera.com,16020,1476661149567} to {7b208ef804e26f84f8a59d5d850d6300 state=OPEN, ts=1476662799923, server=appy-2.vpc.cloudera.com,16020,1476661149567}
2016-10-16 17:06:39,923 INFO  [RpcServer.FifoWFPBQ.default.handler=29,queue=2,port=16000] master.RegionStateStore: Updating hbase:meta row t,2,1476662799821.7b208ef804e26f84f8a59d5d850d6300. with state=OPEN, openSeqNum=1, server=appy-2.vpc.cloudera.com,16020,1476661149567
2016-10-16 17:06:39,930 DEBUG [ProcedureExecutor-0] procedure.LockProcedure: UNLOCKED - org.apache.hadoop.hbase.master.procedure.LockProcedureregions=[8958d3630516df4bac518faea9db09ce,55213a2fd15ee64c7ad84ff54c19f6c3,], level=REGION, type=EXCLUSIVE id=8 owner=root state=RUNNABLE
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For snapshot (takes lock only for getting table descriptor)&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2016-10-16 17:09:55,898 DEBUG [ProcedureExecutor-2] procedure.LockProcedure: LOCKED - org.apache.hadoop.hbase.master.procedure.LockProcedurename=t, level=TABLE, type=EXCLUSIVE id=9 owner=org.apache.hadoop.hbase.master.snapshot.EnabledTableSnapshotHandler state=RUNNABLE
2016-10-16 17:09:55,899 DEBUG [ProcedureExecutor-1] procedure.LockProcedure: UNLOCKED - org.apache.hadoop.hbase.master.procedure.LockProcedurename=t, level=TABLE, type=EXCLUSIVE id=9 owner=org.apache.hadoop.hbase.master.snapshot.EnabledTableSnapshotHandler state=RUNNABLE
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;RS SIDE&lt;/p&gt;

&lt;p&gt;For split.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2016-10-16 16:56:23,415 INFO  [regionserver/appy-2.vpc.cloudera.com/172.26.25.176:16020-splits-1476661525821] client.HBaseLock: Acquired lock: lock_level: REGION
lock_type: EXCLUSIVE
region_info {
  region_id: 1476661526014
  table_name {
    namespace: &quot;default&quot;
    qualifier: &quot;t&quot;
  }
  start_key: &quot;2&quot;
  end_key: &quot;&quot;
  offline: false
  split: false
  replica_id: 0
}
description: &quot;SPLIT_REGION: t,2,1476661526014.b483519eec2363741d93d385c4c80658.&quot;
nonce_group: 11972038343199202908
nonce: 6801264726420137337
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15580798" author="appy" created="Mon, 17 Oct 2016 00:21:40 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jingcheng.du%40intel.com&quot; class=&quot;user-hover&quot; rel=&quot;jingcheng.du@intel.com&quot;&gt;Jingcheng Du&lt;/a&gt;, i don&apos;t know mob much to answer that question. Maybe bring it up on a thread on dev@ since it&apos;s not the main theme of this jira.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="13011549">HBASE-16812</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13009025">HBASE-16744</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="13019941">HBASE-17067</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12832397" name="HBASE-16786.master.001.patch" size="70858" author="appy" created="Mon, 10 Oct 2016 03:13:41 +0000"/>
                            <attachment id="12833013" name="HBASE-16786.master.002.patch" size="118978" author="appy" created="Thu, 13 Oct 2016 01:41:19 +0000"/>
                            <attachment id="12833078" name="HBASE-16786.master.003.patch" size="124151" author="appy" created="Thu, 13 Oct 2016 08:47:07 +0000"/>
                            <attachment id="12833188" name="HBASE-16786.master.004.patch" size="139510" author="appy" created="Thu, 13 Oct 2016 19:39:19 +0000"/>
                            <attachment id="12833693" name="HBASE-16786.master.005.patch" size="124528" author="appy" created="Mon, 17 Oct 2016 07:45:55 +0000"/>
                            <attachment id="12834779" name="HBASE-16786.master.006.patch" size="124562" author="appy" created="Fri, 21 Oct 2016 23:22:26 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 13 Oct 2016 02:24:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i34jn3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>