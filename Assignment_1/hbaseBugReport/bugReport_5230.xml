<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:25:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5230/HBASE-5230.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5230] Ensure compactions do not cache-on-write data blocks</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5230</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Create a unit test for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3976&quot; title=&quot;Disable Block Cache On Compactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3976&quot;&gt;&lt;del&gt;HBASE-3976&lt;/del&gt;&lt;/a&gt; (making sure we don&apos;t cache data blocks on write during compactions even if cache-on-write is enabled generally enabled). This is because we have very different implementations of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3976&quot; title=&quot;Disable Block Cache On Compactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3976&quot;&gt;&lt;del&gt;HBASE-3976&lt;/del&gt;&lt;/a&gt; without &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4422&quot; title=&quot;Move block cache parameters and references into single CacheConf class&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4422&quot;&gt;&lt;del&gt;HBASE-4422&lt;/del&gt;&lt;/a&gt; CacheConfig (on top of 89-fb, created by Liyin) and with CacheConfig (presumably it&apos;s there but not sure if it even works, since the patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3976&quot; title=&quot;Disable Block Cache On Compactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3976&quot;&gt;&lt;del&gt;HBASE-3976&lt;/del&gt;&lt;/a&gt; may not have been committed). We need to create a unit test to verify that we don&apos;t cache data blocks on write during compactions, and resolve &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3976&quot; title=&quot;Disable Block Cache On Compactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3976&quot;&gt;&lt;del&gt;HBASE-3976&lt;/del&gt;&lt;/a&gt; so that this new unit test does not fail.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12538908">HBASE-5230</key>
            <summary>Ensure compactions do not cache-on-write data blocks</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mikhail">Mikhail Bautin</assignee>
                                    <reporter username="mikhail">Mikhail Bautin</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Jan 2012 01:17:50 +0000</created>
                <updated>Fri, 10 Feb 2012 02:47:10 +0000</updated>
                            <resolved>Fri, 10 Feb 2012 02:44:55 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13190239" author="phabricator@reviews.facebook.net" created="Sat, 21 Jan 2012 01:04:39 +0000"  >&lt;p&gt;mbautin requested code review of &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5230&quot; title=&quot;Ensure compactions do not cache-on-write data blocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5230&quot;&gt;&lt;del&gt;HBASE-5230&lt;/del&gt;&lt;/a&gt; Extend TestCacheOnWrite to ensure we don&apos;t cache data blocks on compaction&quot;.&lt;br/&gt;
Reviewers: nspiegelberg, tedyu, Liyin, stack, JIRA&lt;/p&gt;

&lt;p&gt;  Adding another test method to TestCacheOnWrite that generates some data, clears the cache, does a compaction through HRegion API, and verifies that no data blocks have been cached. When I wrote the unit test, it failed, so I modified compaction code to use an alternative CacheConfig instance with cache-on-write turned off for data blocks. This fixed the unit test. We should also be able to resolve &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3976&quot; title=&quot;Disable Block Cache On Compactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3976&quot;&gt;&lt;del&gt;HBASE-3976&lt;/del&gt;&lt;/a&gt; when this goes in.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  Run all unit tests&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1353&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1353&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/LruBlockCache.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/2817/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/2817/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tip: use the X-Herald-Rules header to filter Herald messages in your client.&lt;/p&gt;</comment>
                            <comment id="13190291" author="phabricator@reviews.facebook.net" created="Sat, 21 Jan 2012 03:08:40 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5230&quot; title=&quot;Ensure compactions do not cache-on-write data blocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5230&quot;&gt;&lt;del&gt;HBASE-5230&lt;/del&gt;&lt;/a&gt; Extend TestCacheOnWrite to ensure we don&apos;t cache data blocks on compaction&quot;.&lt;/p&gt;

&lt;p&gt;  Good job.&lt;/p&gt;

&lt;p&gt;  Some minor comments.&lt;/p&gt;

&lt;p&gt;  Please submit to Hadoop QA for test suite run.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/LruBlockCache.java:746 Can this method be made package private ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:756 Please add javadoc for parameter isCompaction&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java:880 Can we add the following line at the beginning of this method ?&lt;br/&gt;
  if (!LOG.isDebugEnabled()) return;&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java:253 Would testCacheOnWriteOffDuringCompaction be a better name ?&lt;/p&gt;

&lt;p&gt;  Alternatively javadoc can be added for this method to explain what it does.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java:295 Nice.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1353&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1353&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13190352" author="phabricator@reviews.facebook.net" created="Sat, 21 Jan 2012 08:42:39 +0000"  >&lt;p&gt;mbautin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5230&quot; title=&quot;Ensure compactions do not cache-on-write data blocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5230&quot;&gt;&lt;del&gt;HBASE-5230&lt;/del&gt;&lt;/a&gt; Extend TestCacheOnWrite to ensure we don&apos;t cache data blocks on compaction&quot;.&lt;br/&gt;
Reviewers: nspiegelberg, tedyu, Liyin, stack, JIRA&lt;/p&gt;

&lt;p&gt;  Addressing Ted&apos;s comments. Also fixing TestFromClientSide to take into account that data blocks are not being cached on compactions.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1353&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1353&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/LruBlockCache.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java&lt;/p&gt;</comment>
                            <comment id="13190354" author="mikhail" created="Sat, 21 Jan 2012 08:54:33 +0000"  >&lt;p&gt;Attaching patch for Jenkins testing.&lt;/p&gt;</comment>
                            <comment id="13190358" author="hadoopqa" created="Sat, 21 Jan 2012 09:36:37 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12511373/Don-t-cache-data-blocks-on-compaction-2012-01-21_00_53_54.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12511373/Don-t-cache-data-blocks-on-compaction-2012-01-21_00_53_54.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 8 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -145 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 82 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestAtomicOperation&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/824//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/824//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/824//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/824//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/824//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/824//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13191316" author="phabricator@reviews.facebook.net" created="Mon, 23 Jan 2012 18:22:40 +0000"  >&lt;p&gt;mbautin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5230&quot; title=&quot;Ensure compactions do not cache-on-write data blocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5230&quot;&gt;&lt;del&gt;HBASE-5230&lt;/del&gt;&lt;/a&gt; Extend TestCacheOnWrite to ensure we don&apos;t cache data blocks on compaction&quot;.&lt;br/&gt;
Reviewers: nspiegelberg, tedyu, Liyin, stack, JIRA&lt;/p&gt;

&lt;p&gt;  Rebasing on trunk changes.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1353&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1353&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/LruBlockCache.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java&lt;/p&gt;</comment>
                            <comment id="13191318" author="mikhail" created="Mon, 23 Jan 2012 18:24:30 +0000"  >&lt;p&gt;Attaching the most recent patch (rebased on trunk changes &amp;#8211; maybe even identical).&lt;/p&gt;</comment>
                            <comment id="13191320" author="mikhail" created="Mon, 23 Jan 2012 18:27:34 +0000"  >&lt;p&gt;@Ted: the unit test failure at &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/824//testReport/org.apache.hadoop.hbase.regionserver/TestAtomicOperation/testRowMutationMultiThreads/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/824//testReport/org.apache.hadoop.hbase.regionserver/TestAtomicOperation/testRowMutationMultiThreads/&lt;/a&gt; seems unrelated. Is this patch OK to be committed? (We can wait for another run of unit tests if necessary, I&apos;ve just re-uploaded the patch.)&lt;/p&gt;</comment>
                            <comment id="13191345" author="zhihyu@ebaysf.com" created="Mon, 23 Jan 2012 18:48:44 +0000"  >&lt;p&gt;TestAtomicOperation passed locally.&lt;br/&gt;
The patch should be good to go.&lt;/p&gt;</comment>
                            <comment id="13191357" author="hadoopqa" created="Mon, 23 Jan 2012 19:10:09 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12511528/Don-t-cache-data-blocks-on-compaction-2012-01-23_10_23_45.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12511528/Don-t-cache-data-blocks-on-compaction-2012-01-23_10_23_45.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 8 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -145 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 84 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.coprocessor.TestClassLoading&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/840//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/840//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/840//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/840//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/840//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/840//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13191372" author="mikhail" created="Mon, 23 Jan 2012 19:32:19 +0000"  >&lt;p&gt;The above failed tests passed locally:&lt;/p&gt;

&lt;p&gt;Running org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
Tests run: 9, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 216.187 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 78.841 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.mapreduce.TestTableMapReduce&lt;br/&gt;
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 97.529 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 64.111 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.coprocessor.TestClassLoading&lt;br/&gt;
Tests run: 5, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 28.787 sec&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests run: 24, Failures: 0, Errors: 0, Skipped: 0&lt;/p&gt;</comment>
                            <comment id="13191488" author="phabricator@reviews.facebook.net" created="Mon, 23 Jan 2012 21:39:40 +0000"  >&lt;p&gt;nspiegelberg has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5230&quot; title=&quot;Ensure compactions do not cache-on-write data blocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5230&quot;&gt;&lt;del&gt;HBASE-5230&lt;/del&gt;&lt;/a&gt; Extend TestCacheOnWrite to ensure we don&apos;t cache data blocks on compaction&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:764-766 currently, there is no intelligence to estimate the resulting compacted filesize and cache compactions up to a max size, correct?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java:879-880 use this static function to write a toString method?&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java:4502 this comment should be changed&lt;/p&gt;

&lt;p&gt;      // read the row, this should be a cache miss because we don&apos;t cache on compaction&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java:254 add&lt;/p&gt;

&lt;p&gt;     // TODO: need to change this test if we add a cache size threshold for compactions&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java:295 Assert.assertNull() is nice for clarity&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1353&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1353&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13191497" author="zhihyu@ebaysf.com" created="Mon, 23 Jan 2012 21:43:04 +0000"  >&lt;p&gt;This patch should be applied to 0.92, right ?&lt;br/&gt;
A patch for 0.92 would be desirable.&lt;/p&gt;</comment>
                            <comment id="13191606" author="phabricator@reviews.facebook.net" created="Mon, 23 Jan 2012 23:23:39 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5230&quot; title=&quot;Ensure compactions do not cache-on-write data blocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5230&quot;&gt;&lt;del&gt;HBASE-5230&lt;/del&gt;&lt;/a&gt; Extend TestCacheOnWrite to ensure we don&apos;t cache data blocks on compaction&quot;.&lt;/p&gt;

&lt;p&gt;  Responses to comments inline.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/LruBlockCache.java:746 Done.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:756 Done.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java:880 Replaced this with a method that &quot;prints out&quot; the metrics into a StringBuilder and returns a string.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java:253 Since this is for data blocks, I renamed this to testNotCachingDataBlocksDuringCompaction.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:764-766 That is correct, to my best knowledge. Eventually, I think we would like to intelligently decide whether to cache-on-write a block based on whether the data in question is already in the block cache as part of uncompacted files: &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5263&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5263&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java:879-880 In my debugging I have not yet come across a case when I would have found a SchemaMetrics.toString method useful. Also, adapting this static method to implement toString would be tricky, since it relies on getMetricsSnapshot() that takes a &quot;snapshot&quot; of &lt;em&gt;all&lt;/em&gt; metrics, not just those for a particular table/CF combination corresponding to one SchemaMetrics instance. Therefore, I would prefer to leave SchemaMetrics.toString() out for now.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java:4502 Done.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java:254 Added.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java:295 Done.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1353&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1353&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13191607" author="phabricator@reviews.facebook.net" created="Mon, 23 Jan 2012 23:23:40 +0000"  >&lt;p&gt;mbautin updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5230&quot; title=&quot;Ensure compactions do not cache-on-write data blocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5230&quot;&gt;&lt;del&gt;HBASE-5230&lt;/del&gt;&lt;/a&gt; Extend TestCacheOnWrite to ensure we don&apos;t cache data blocks on compaction&quot;.&lt;br/&gt;
Reviewers: nspiegelberg, tedyu, Liyin, stack, JIRA&lt;/p&gt;

&lt;p&gt;  Addressing Nicolas&apos;s comments. Re-running all unit tests.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1353&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1353&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/hfile/LruBlockCache.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java&lt;/p&gt;</comment>
                            <comment id="13191616" author="mikhail" created="Mon, 23 Jan 2012 23:27:52 +0000"  >&lt;p&gt;A new patch addressing Nicolas&apos;s comments.&lt;/p&gt;</comment>
                            <comment id="13191657" author="hadoopqa" created="Tue, 24 Jan 2012 00:08:01 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12511585/Don-t-cache-data-blocks-on-compaction-2012-01-23_15_27_23.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12511585/Don-t-cache-data-blocks-on-compaction-2012-01-23_15_27_23.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 8 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -145 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 84 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestSplitLogManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/843//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/843//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/843//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/843//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/843//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/843//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13191959" author="stack" created="Tue, 24 Jan 2012 07:01:16 +0000"  >&lt;p&gt;lgtm&lt;/p&gt;</comment>
                            <comment id="13192479" author="mikhail" created="Tue, 24 Jan 2012 20:26:26 +0000"  >&lt;p&gt;Re-running failed unit tests locally.&lt;/p&gt;

&lt;p&gt;Running org.apache.hadoop.hbase.master.TestSplitLogManager&lt;br/&gt;
Tests run: 12, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 15.748 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 128.254 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
Tests run: 9, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 215.328 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 85.367 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.mapreduce.TestTableMapReduce&lt;br/&gt;
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 95.431 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 63.762 sec&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests run: 39, Failures: 0, Errors: 0, Skipped: &lt;/p&gt;</comment>
                            <comment id="13193307" author="phabricator@reviews.facebook.net" created="Wed, 25 Jan 2012 20:39:39 +0000"  >&lt;p&gt;mbautin has abandoned the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5230&quot; title=&quot;Ensure compactions do not cache-on-write data blocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5230&quot;&gt;&lt;del&gt;HBASE-5230&lt;/del&gt;&lt;/a&gt; Extend TestCacheOnWrite to ensure we don&apos;t cache data blocks on compaction&quot;.&lt;/p&gt;

&lt;p&gt;  This has been committed to HBase trunk. Abandoning the diff since I forgot to include differential revision in the commit message.&lt;/p&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1353&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1353&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13193545" author="hudson" created="Thu, 26 Jan 2012 03:57:25 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2646 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2646/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2646/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5230&quot; title=&quot;Ensure compactions do not cache-on-write data blocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5230&quot;&gt;&lt;del&gt;HBASE-5230&lt;/del&gt;&lt;/a&gt; : ensure that compactions do not cache-on-write data blocks&lt;/p&gt;

&lt;p&gt;mbautin : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/LruBlockCache.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13193566" author="hudson" created="Thu, 26 Jan 2012 05:45:46 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #90 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/90/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/90/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5230&quot; title=&quot;Ensure compactions do not cache-on-write data blocks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5230&quot;&gt;&lt;del&gt;HBASE-5230&lt;/del&gt;&lt;/a&gt; : ensure that compactions do not cache-on-write data blocks&lt;/p&gt;

&lt;p&gt;mbautin : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileReaderV2.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/HFileWriterV2.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/io/hfile/LruBlockCache.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/io/hfile/TestCacheOnWrite.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12509782">HBASE-3976</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12511341" name="ASF.LICENSE.NOT.GRANTED--D1353.1.patch" size="10854" author="phabricator@reviews.facebook.net" created="Sat, 21 Jan 2012 01:04:40 +0000"/>
                            <attachment id="12511372" name="ASF.LICENSE.NOT.GRANTED--D1353.2.patch" size="13234" author="phabricator@reviews.facebook.net" created="Sat, 21 Jan 2012 08:42:40 +0000"/>
                            <attachment id="12511527" name="ASF.LICENSE.NOT.GRANTED--D1353.3.patch" size="13234" author="phabricator@reviews.facebook.net" created="Mon, 23 Jan 2012 18:22:41 +0000"/>
                            <attachment id="12511581" name="ASF.LICENSE.NOT.GRANTED--D1353.4.patch" size="15820" author="phabricator@reviews.facebook.net" created="Mon, 23 Jan 2012 23:23:41 +0000"/>
                            <attachment id="12511373" name="Don-t-cache-data-blocks-on-compaction-2012-01-21_00_53_54.patch" size="14829" author="mikhail" created="Sat, 21 Jan 2012 08:54:32 +0000"/>
                            <attachment id="12511528" name="Don-t-cache-data-blocks-on-compaction-2012-01-23_10_23_45.patch" size="14829" author="mikhail" created="Mon, 23 Jan 2012 18:24:30 +0000"/>
                            <attachment id="12511585" name="Don-t-cache-data-blocks-on-compaction-2012-01-23_15_27_23.patch" size="17528" author="mikhail" created="Mon, 23 Jan 2012 23:27:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 21 Jan 2012 01:04:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>224411</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 47 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01693:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4782</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>