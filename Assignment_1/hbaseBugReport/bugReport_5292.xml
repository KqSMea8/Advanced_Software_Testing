<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:26:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5292/HBASE-5292.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5292] getsize per-CF metric incorrectly counts compaction related reads as well </title>
                <link>https://issues.apache.org/jira/browse/HBASE-5292</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The per-CF &quot;getsize&quot; metric&apos;s intent was to track bytes returned (to HBase clients) per-CF. &lt;a href=&quot;#of HFileBlock&amp;#39;s read for compaction vs. non-compaction cases -- e.g., compactionblockreadcnt vs. fsblockreadcnt.&quot;&gt;Note: We already have metrics to track # of HFileBlock&apos;s read for compaction vs. non-compaction cases -- e.g., compactionblockreadcnt vs. fsblockreadcnt.&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Currently, the &quot;getsize&quot; metric gets updated for both client initiated Get/Scan operations as well for compaction related reads. The metric is updated in StoreScanner.java:next() when the Scan query matcher returns an INCLUDE* code via a:&lt;/p&gt;

&lt;p&gt; HRegion.incrNumericMetric(this.metricNameGetsize, copyKv.getLength());&lt;/p&gt;

&lt;p&gt;We should not do the above in case of compactions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12539986">HBASE-5292</key>
            <summary>getsize per-CF metric incorrectly counts compaction related reads as well </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kannanm">Kannan Muthukkaruppan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 Jan 2012 01:17:24 +0000</created>
                <updated>Sun, 7 Apr 2013 04:33:28 +0000</updated>
                            <resolved>Sat, 25 Aug 2012 04:34:40 +0000</resolved>
                                    <version>0.89.20100924</version>
                                    <fixVersion>0.94.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13196007" author="phabricator@reviews.facebook.net" created="Mon, 30 Jan 2012 09:43:10 +0000"  >&lt;p&gt;zhiqiu requested code review of &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; Prevent counting getSize on compacations&quot;.&lt;br/&gt;
Reviewers: Kannan, Liyin, JIRA&lt;/p&gt;

&lt;p&gt;  Added two separate metrics for both get() and next()&lt;/p&gt;

&lt;p&gt;  One problem is that both Get and Scan can have multiple column families.&lt;br/&gt;
  And this diff counts the size of multiple cfs in total (instead of per&lt;br/&gt;
  CF).&lt;/p&gt;

&lt;p&gt;  Task ID: #898948&lt;/p&gt;

&lt;p&gt;  Blame Rev:&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  Passed unit tests.&lt;/p&gt;

&lt;p&gt;  Revert Plan:&lt;/p&gt;

&lt;p&gt;  Tags:&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/ScannerCallable.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/3183/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/3183/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tip: use the X-Herald-Rules header to filter Herald messages in your client.&lt;/p&gt;</comment>
                            <comment id="13197352" author="phabricator@reviews.facebook.net" created="Tue, 31 Jan 2012 22:53:58 +0000"  >&lt;p&gt;zhiqiu updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compacations&quot;.&lt;br/&gt;
Reviewers: Kannan, Liyin, JIRA&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Support per-CF getsize/nextsize&lt;/li&gt;
	&lt;li&gt;Add unit test to verify it works properly&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/InternalScanner.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/KeyValueHeap.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerMetrics.java&lt;/p&gt;</comment>
                            <comment id="13197357" author="phabricator@reviews.facebook.net" created="Tue, 31 Jan 2012 22:57:57 +0000"  >&lt;p&gt;stack has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compacations&quot;.&lt;/p&gt;

&lt;p&gt;  lgtm&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13199255" author="phabricator@reviews.facebook.net" created="Thu, 2 Feb 2012 21:40:53 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compacations&quot;.&lt;/p&gt;

&lt;p&gt;  Please fix the misspelling in the title &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
  Have not really reviewed the diff yet.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13199258" author="phabricator@reviews.facebook.net" created="Thu, 2 Feb 2012 21:42:51 +0000"  >&lt;p&gt;zhiqiu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;  Fixed. Thx a lot!&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13199307" author="phabricator@reviews.facebook.net" created="Thu, 2 Feb 2012 22:40:53 +0000"  >&lt;p&gt;Kannan has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;  Zhiqui: Looks very good. A few comments inlined...&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:299 i think we can avoid this hashset and &quot;contains&quot; check later.&lt;/p&gt;

&lt;p&gt;  Since this is all internal code, we can assume that if caller pass a non-null metric name, it is good to use.&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java:200 we need to a append a &quot;.&quot; here for compatibility with old code, and for readability.&lt;/p&gt;

&lt;p&gt;  Otherwise, the metric names will be&lt;br/&gt;
    cf.column_familygetsize&lt;br/&gt;
  instead of&lt;br/&gt;
    cf.column_family.getsize.&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerMetrics.java:136 nice test!&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java:345 as mentioned earlier, I think we can get rid of the hashset.&lt;/p&gt;

&lt;p&gt;  Also, can we pass in null (instead of &quot;&quot;) for all the places you don&apos;t want this metric to be  tracked. And this check would simply become:&lt;/p&gt;

&lt;p&gt;  if (metric != null)&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13199345" author="phabricator@reviews.facebook.net" created="Thu, 2 Feb 2012 23:10:53 +0000"  >&lt;p&gt;zhiqiu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:299 Sure. Will remove this. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java:200 I checked the implementation of generateSchemaMetricsPrefix() and found that a &quot;.&quot; is already appended to the cf name.&lt;/p&gt;

&lt;p&gt;      schemaMetricPrefix +=&lt;br/&gt;
        cfName.equals(TOTAL_KEY) ? &quot;&quot; : CF_PREFIX + cfName + &quot;.&quot;;&lt;/p&gt;

&lt;p&gt;  Actually I removed it because in the test log, I found the name is like &quot;tbl.SizeMetricTest.cf.cf1..getsize&quot;, w/ one extra &quot;.&quot;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java:345 Yes, it will be much simpler by changing it to null. Will do this right now. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13199347" author="phabricator@reviews.facebook.net" created="Thu, 2 Feb 2012 23:12:54 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;  @zhiqiu: yes, please make sure we don&apos;t end up with two dots in metric names. We have had one bug of this kind in production already. Thanks!&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13199350" author="phabricator@reviews.facebook.net" created="Thu, 2 Feb 2012 23:14:52 +0000"  >&lt;p&gt;Kannan has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;  Ok, the &quot;..getsize&quot; issue was something Liyin fixed recently. Perhaps you are not rebased on that.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13199391" author="phabricator@reviews.facebook.net" created="Fri, 3 Feb 2012 00:14:52 +0000"  >&lt;p&gt;zhiqiu updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compactions&quot;.&lt;br/&gt;
Reviewers: Kannan, Liyin, JIRA&lt;/p&gt;

&lt;p&gt;  Address Kannan&apos;s comments:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Removed the metric name Hashset&lt;/li&gt;
	&lt;li&gt;Re-based on Liyin&apos;s fix of &quot;..getsize&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/InternalScanner.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/KeyValueHeap.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerMetrics.java&lt;/p&gt;</comment>
                            <comment id="13199484" author="phabricator@reviews.facebook.net" created="Fri, 3 Feb 2012 02:29:52 +0000"  >&lt;p&gt;Kannan has accepted the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;  nice work Zhiqui!&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13200013" author="phabricator@reviews.facebook.net" created="Fri, 3 Feb 2012 20:09:53 +0000"  >&lt;p&gt;zhiqiu updated the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compactions&quot;.&lt;br/&gt;
Reviewers: Kannan, Liyin, JIRA&lt;/p&gt;

&lt;p&gt;  Fixed a bug that the two tests in TestRegionServerMetrics cannot be run together&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/InternalScanner.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/KeyValueHeap.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerMetrics.java&lt;/p&gt;</comment>
                            <comment id="13200094" author="phabricator@reviews.facebook.net" created="Fri, 3 Feb 2012 22:11:53 +0000"  >&lt;p&gt;Kannan has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;  ok - looks good.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13202026" author="phabricator@reviews.facebook.net" created="Tue, 7 Feb 2012 02:45:00 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;  @zhiqiu: does this problem exist in the open-source HBase trunk? If so, could you please port this patch to trunk? If this is not applicable to trunk, could you please set the JIRA status to &quot;resolved&quot;? Thanks!&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13202050" author="phabricator@reviews.facebook.net" created="Tue, 7 Feb 2012 03:40:57 +0000"  >&lt;p&gt;zhiqiu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;89-fb&amp;#93;&lt;/span&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;  @mbautin Sure. I&apos;ll port it to open-source trunk right now. Thank you so much for reminding me this. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/biggrin.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1527&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1527&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13202098" author="phabricator@reviews.facebook.net" created="Tue, 7 Feb 2012 05:49:00 +0000"  >&lt;p&gt;zhiqiu requested code review of &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; Prevent counting getSize on compactions&quot;.&lt;br/&gt;
Reviewers: Kannan, mbautin, Liyin, JIRA&lt;/p&gt;

&lt;p&gt;  Added two separate metrics for both get() and next(). This is done by&lt;br/&gt;
  refactoring on internal next() API. To be more specific, only Get.get()&lt;br/&gt;
  and ResultScanner.next() passes the metric name (&quot;getsize&quot; and&lt;br/&gt;
  &quot;nextsize&quot; repectively) to&lt;br/&gt;
    HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt;, String)&lt;/p&gt;

&lt;p&gt;  This will eventually hit StoreScanner()::next((List&amp;lt;KeyValue&amp;gt;,&lt;br/&gt;
  int, String) where the metrics are counted.&lt;/p&gt;

&lt;p&gt;  And their call paths are:&lt;/p&gt;

&lt;p&gt;  1) Get&lt;/p&gt;

&lt;p&gt;  HTable::get(final Get get)&lt;br/&gt;
  =&amp;gt; HRegionServer::get(byte [] regionName, Get get)&lt;br/&gt;
  =&amp;gt; HRegion::get(final Get get, final Integer lockid)&lt;br/&gt;
  =&amp;gt; HRegion::get(final Get get)      [pass METRIC_GETSIZE to the&lt;br/&gt;
  callee]&lt;/p&gt;

&lt;p&gt;  =&amp;gt; HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt; outResults, String&lt;br/&gt;
  metric)&lt;br/&gt;
  =&amp;gt; HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt; outResults, int limit,&lt;br/&gt;
  String metric)&lt;br/&gt;
  =&amp;gt; HRegion::RegionScanner::nextInternal(int limit, String metric)&lt;br/&gt;
  =&amp;gt; KeyValueHeap::next(List&amp;lt;KeyValue&amp;gt; result, int limit, String&lt;br/&gt;
  metric)&lt;br/&gt;
  =&amp;gt; StoreScanner::next(List&amp;lt;KeyValue&amp;gt; outResult, int limit, String&lt;br/&gt;
  metric)&lt;/p&gt;

&lt;p&gt;  2) Next&lt;/p&gt;

&lt;p&gt;  HTable::ClientScanner::next()&lt;br/&gt;
  =&amp;gt; ScannerCallable::call()&lt;br/&gt;
  =&amp;gt; HRegionServer::next(long scannerId)&lt;br/&gt;
  =&amp;gt; HRegionServer::next(final long scannerId, int nbRows)  [pass&lt;br/&gt;
  METRIC_NEXTSIZE to the callee]&lt;/p&gt;

&lt;p&gt;  =&amp;gt; HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt; outResults, String&lt;br/&gt;
  metric)&lt;br/&gt;
  =&amp;gt; HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt; outResults, int limit,&lt;br/&gt;
  String metric)&lt;br/&gt;
  =&amp;gt; HRegion::RegionScanner::nextInternal(int limit, String metric)&lt;br/&gt;
  =&amp;gt; KeyValueHeap::next(List&amp;lt;KeyValue&amp;gt; result, int limit, String&lt;br/&gt;
  metric)&lt;br/&gt;
  =&amp;gt; StoreScanner::next(List&amp;lt;KeyValue&amp;gt; outResult, int limit, String&lt;br/&gt;
  metric)&lt;/p&gt;

&lt;p&gt;  Task ID: #898948&lt;/p&gt;

&lt;p&gt;  Blame Rev:&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  1. Passed unit tests.&lt;br/&gt;
  2. Created a testcase TestRegionServerMetrics::testGetNextSize to&lt;br/&gt;
  guarantee:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Get/Next contributes to getsize/nextsize metrics&lt;/li&gt;
	&lt;li&gt;Both getsize/nextsize are per Column Family&lt;/li&gt;
	&lt;li&gt;Flush/compaction won&apos;t affect these two metrics&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;  Revert Plan:&lt;/p&gt;

&lt;p&gt;  Tags:&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1617&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1617&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/InternalScanner.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/KeyValueHeap.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/coprocessor/TestCoprocessorInterface.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionObserverInterface.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerMetrics.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/3441/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/3441/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tip: use the X-Herald-Rules header to filter Herald messages in your client.&lt;/p&gt;</comment>
                            <comment id="13202689" author="phabricator@reviews.facebook.net" created="Tue, 7 Feb 2012 19:48:59 +0000"  >&lt;p&gt;mbautin has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;  @zhiqiu: thank you for submitting the trunk patch. Could you please upload a patch to the JIRA and set the JIRA status to &quot;patch available&quot;, as I described at &lt;a href=&quot;https://reviews.facebook.net/D1539#comment-7?&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1539#comment-7?&lt;/a&gt; Thanks!&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1617&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1617&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13202695" author="phabricator@reviews.facebook.net" created="Tue, 7 Feb 2012 19:51:00 +0000"  >&lt;p&gt;zhiqiu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;  @mbautin Sure. I thought I need to wait for this diff to be accepted. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I&apos;ll upload a patch ASAP.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1617&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1617&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13202703" author="phabricator@reviews.facebook.net" created="Tue, 7 Feb 2012 19:56:58 +0000"  >&lt;p&gt;zhiqiu has commented on the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;  Patch submitted: &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5292&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1617&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1617&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13202751" author="hadoopqa" created="Tue, 7 Feb 2012 20:40:12 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12513670/0001-jira-HBASE-5292-Prevent-counting-getSize-on-compacti.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12513670/0001-jira-HBASE-5292-Prevent-counting-getSize-on-compacti.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -136 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 156 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplication&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/914//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/914//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/914//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/914//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/914//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/914//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13203277" author="stack" created="Wed, 8 Feb 2012 04:59:43 +0000"  >&lt;p&gt;This patch is for trunk?  You going to commit Mikhail?  Seems like TestReplication failed only which is probably unrelated?&lt;/p&gt;</comment>
                            <comment id="13226412" author="mikhail" created="Fri, 9 Mar 2012 20:22:55 +0000"  >&lt;p&gt;@Stack: yes, I will commit this. Sorry it&apos;s been a while.&lt;/p&gt;</comment>
                            <comment id="13226416" author="phabricator@reviews.facebook.net" created="Fri, 9 Mar 2012 20:26:56 +0000"  >&lt;p&gt;mbautin has accepted the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1617&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1617&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;BRANCH&lt;br/&gt;
  getsize&lt;/p&gt;</comment>
                            <comment id="13226486" author="mikhail" created="Fri, 9 Mar 2012 21:27:29 +0000"  >&lt;p&gt;Rebased patch for Hadoop QA testing&lt;/p&gt;</comment>
                            <comment id="13226542" author="hadoopqa" created="Fri, 9 Mar 2012 22:16:01 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12517792/jira-HBASE-5292-Prevent-counting-getSize-on-compacti-2012-03-09_13_26_52.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12517792/jira-HBASE-5292-Prevent-counting-getSize-on-compacti-2012-03-09_13_26_52.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -123 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 159 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1150//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1150//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1150//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1150//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1150//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1150//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13226626" author="mikhail" created="Sat, 10 Mar 2012 00:20:02 +0000"  >&lt;p&gt;Re-run failed tests locally:&lt;/p&gt;

&lt;p&gt;Running org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
Tests run: 9, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 244.11 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
Tests run: 8, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 83.249 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.mapreduce.TestTableMapReduce&lt;br/&gt;
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 100.749 sec&lt;br/&gt;
Running org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 71.473 sec&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests run: 19, Failures: 0, Errors: 0, Skipped: 0&lt;/p&gt;

&lt;p&gt;Someone please confirm if it is OK to commit this.&lt;/p&gt;</comment>
                            <comment id="13226631" author="stack" created="Sat, 10 Mar 2012 00:27:11 +0000"  >&lt;p&gt;+1 on commit.&lt;/p&gt;</comment>
                            <comment id="13226726" author="phabricator@reviews.facebook.net" created="Sat, 10 Mar 2012 02:28:57 +0000"  >&lt;p&gt;mbautin has committed the revision &quot;&lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; Prevent counting getSize on compactions&quot;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D1617&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1617&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;COMMIT&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/rHBASE1299147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/rHBASE1299147&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13226767" author="hudson" created="Sat, 10 Mar 2012 05:55:49 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #133 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/133/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/133/&lt;/a&gt;)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; Prevent counting getSize on compactions&lt;/p&gt;

&lt;p&gt;Author: Zhiqiu Kong&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
Added two separate metrics for both get() and next(). This is done by&lt;br/&gt;
refactoring on internal next() API. To be more specific, only Get.get()&lt;br/&gt;
and ResultScanner.next() passes the metric name (&quot;getsize&quot; and&lt;br/&gt;
&quot;nextsize&quot; repectively) to&lt;br/&gt;
  HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt;, String)&lt;/p&gt;

&lt;p&gt;This will eventually hit StoreScanner()::next((List&amp;lt;KeyValue&amp;gt;,&lt;br/&gt;
int, String) where the metrics are counted.&lt;/p&gt;

&lt;p&gt;And their call paths are:&lt;/p&gt;

&lt;p&gt;1) Get&lt;/p&gt;

&lt;p&gt;HTable::get(final Get get)&lt;br/&gt;
=&amp;gt; HRegionServer::get(byte [] regionName, Get get)&lt;br/&gt;
=&amp;gt; HRegion::get(final Get get, final Integer lockid)&lt;br/&gt;
=&amp;gt; HRegion::get(final Get get)      [pass METRIC_GETSIZE to the&lt;br/&gt;
callee]&lt;/p&gt;

&lt;p&gt;=&amp;gt; HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt; outResults, String&lt;br/&gt;
metric)&lt;br/&gt;
=&amp;gt; HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt; outResults, int limit,&lt;br/&gt;
String metric)&lt;br/&gt;
=&amp;gt; HRegion::RegionScanner::nextInternal(int limit, String metric)&lt;br/&gt;
=&amp;gt; KeyValueHeap::next(List&amp;lt;KeyValue&amp;gt; result, int limit, String&lt;br/&gt;
metric)&lt;br/&gt;
=&amp;gt; StoreScanner::next(List&amp;lt;KeyValue&amp;gt; outResult, int limit, String&lt;br/&gt;
metric)&lt;/p&gt;

&lt;p&gt;2) Next&lt;/p&gt;

&lt;p&gt;HTable::ClientScanner::next()&lt;br/&gt;
=&amp;gt; ScannerCallable::call()&lt;br/&gt;
=&amp;gt; HRegionServer::next(long scannerId)&lt;br/&gt;
=&amp;gt; HRegionServer::next(final long scannerId, int nbRows)  [pass&lt;br/&gt;
METRIC_NEXTSIZE to the callee]&lt;/p&gt;

&lt;p&gt;=&amp;gt; HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt; outResults, String&lt;br/&gt;
metric)&lt;br/&gt;
=&amp;gt; HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt; outResults, int limit,&lt;br/&gt;
String metric)&lt;br/&gt;
=&amp;gt; HRegion::RegionScanner::nextInternal(int limit, String metric)&lt;br/&gt;
=&amp;gt; KeyValueHeap::next(List&amp;lt;KeyValue&amp;gt; result, int limit, String&lt;br/&gt;
metric)&lt;br/&gt;
=&amp;gt; StoreScanner::next(List&amp;lt;KeyValue&amp;gt; outResult, int limit, String&lt;br/&gt;
metric)&lt;/p&gt;

&lt;p&gt;Test Plan:&lt;br/&gt;
1. Passed unit tests.&lt;br/&gt;
2. Created a testcase TestRegionServerMetrics::testGetNextSize to&lt;br/&gt;
guarantee:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Get/Next contributes to getsize/nextsize metrics&lt;/li&gt;
	&lt;li&gt;Both getsize/nextsize are per Column Family&lt;/li&gt;
	&lt;li&gt;Flush/compaction won&apos;t affect these two metrics&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewed By: mbautin&lt;/p&gt;

&lt;p&gt;Reviewers: Kannan, mbautin, Liyin, JIRA&lt;/p&gt;

&lt;p&gt;CC: Kannan, mbautin, Liyin, zhiqiu&lt;/p&gt;

&lt;p&gt;Differential Revision: &lt;a href=&quot;https://reviews.facebook.net/D1617&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1617&lt;/a&gt; (Revision 1299147)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
mbautin : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/InternalScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/KeyValueHeap.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestCoprocessorInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionObserverInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerMetrics.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13227978" author="hudson" created="Mon, 12 Mar 2012 22:14:59 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2676 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2676/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2676/&lt;/a&gt;)&lt;br/&gt;
    &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; Prevent counting getSize on compactions&lt;/p&gt;

&lt;p&gt;Author: Zhiqiu Kong&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
Added two separate metrics for both get() and next(). This is done by&lt;br/&gt;
refactoring on internal next() API. To be more specific, only Get.get()&lt;br/&gt;
and ResultScanner.next() passes the metric name (&quot;getsize&quot; and&lt;br/&gt;
&quot;nextsize&quot; repectively) to&lt;br/&gt;
  HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt;, String)&lt;/p&gt;

&lt;p&gt;This will eventually hit StoreScanner()::next((List&amp;lt;KeyValue&amp;gt;,&lt;br/&gt;
int, String) where the metrics are counted.&lt;/p&gt;

&lt;p&gt;And their call paths are:&lt;/p&gt;

&lt;p&gt;1) Get&lt;/p&gt;

&lt;p&gt;HTable::get(final Get get)&lt;br/&gt;
=&amp;gt; HRegionServer::get(byte [] regionName, Get get)&lt;br/&gt;
=&amp;gt; HRegion::get(final Get get, final Integer lockid)&lt;br/&gt;
=&amp;gt; HRegion::get(final Get get)      [pass METRIC_GETSIZE to the&lt;br/&gt;
callee]&lt;/p&gt;

&lt;p&gt;=&amp;gt; HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt; outResults, String&lt;br/&gt;
metric)&lt;br/&gt;
=&amp;gt; HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt; outResults, int limit,&lt;br/&gt;
String metric)&lt;br/&gt;
=&amp;gt; HRegion::RegionScanner::nextInternal(int limit, String metric)&lt;br/&gt;
=&amp;gt; KeyValueHeap::next(List&amp;lt;KeyValue&amp;gt; result, int limit, String&lt;br/&gt;
metric)&lt;br/&gt;
=&amp;gt; StoreScanner::next(List&amp;lt;KeyValue&amp;gt; outResult, int limit, String&lt;br/&gt;
metric)&lt;/p&gt;

&lt;p&gt;2) Next&lt;/p&gt;

&lt;p&gt;HTable::ClientScanner::next()&lt;br/&gt;
=&amp;gt; ScannerCallable::call()&lt;br/&gt;
=&amp;gt; HRegionServer::next(long scannerId)&lt;br/&gt;
=&amp;gt; HRegionServer::next(final long scannerId, int nbRows)  [pass&lt;br/&gt;
METRIC_NEXTSIZE to the callee]&lt;/p&gt;

&lt;p&gt;=&amp;gt; HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt; outResults, String&lt;br/&gt;
metric)&lt;br/&gt;
=&amp;gt; HRegion::RegionScanner::next(List&amp;lt;KeyValue&amp;gt; outResults, int limit,&lt;br/&gt;
String metric)&lt;br/&gt;
=&amp;gt; HRegion::RegionScanner::nextInternal(int limit, String metric)&lt;br/&gt;
=&amp;gt; KeyValueHeap::next(List&amp;lt;KeyValue&amp;gt; result, int limit, String&lt;br/&gt;
metric)&lt;br/&gt;
=&amp;gt; StoreScanner::next(List&amp;lt;KeyValue&amp;gt; outResult, int limit, String&lt;br/&gt;
metric)&lt;/p&gt;

&lt;p&gt;Test Plan:&lt;br/&gt;
1. Passed unit tests.&lt;br/&gt;
2. Created a testcase TestRegionServerMetrics::testGetNextSize to&lt;br/&gt;
guarantee:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Get/Next contributes to getsize/nextsize metrics&lt;/li&gt;
	&lt;li&gt;Both getsize/nextsize are per Column Family&lt;/li&gt;
	&lt;li&gt;Flush/compaction won&apos;t affect these two metrics&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Reviewed By: mbautin&lt;/p&gt;

&lt;p&gt;Reviewers: Kannan, mbautin, Liyin, JIRA&lt;/p&gt;

&lt;p&gt;CC: Kannan, mbautin, Liyin, zhiqiu&lt;/p&gt;

&lt;p&gt;Differential Revision: &lt;a href=&quot;https://reviews.facebook.net/D1617&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D1617&lt;/a&gt; (Revision 1299147)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
mbautin : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/InternalScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/KeyValueHeap.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestCoprocessorInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionObserverInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerMetrics.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13441560" author="lhofhansl" created="Fri, 24 Aug 2012 22:33:07 +0000"  >&lt;p&gt;This is marked again 0.94.0, but was never checked into 0.94.&lt;/p&gt;</comment>
                            <comment id="13441564" author="lhofhansl" created="Fri, 24 Aug 2012 22:34:47 +0000"  >&lt;p&gt;I&apos;ll make a 0.94 version of this patch.&lt;/p&gt;</comment>
                            <comment id="13441585" author="lhofhansl" created="Fri, 24 Aug 2012 23:08:39 +0000"  >&lt;p&gt;Here&apos;s a 0.94 patch. Took a slight bit of massaging.&lt;/p&gt;</comment>
                            <comment id="13441663" author="lhofhansl" created="Sat, 25 Aug 2012 00:17:47 +0000"  >&lt;p&gt;Going to commit, unless there are objections w.r.t. to 0.94.&lt;br/&gt;
I think this is important for two reasons: &lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Metric collection isn&apos;t free. This will slow flushes and compactions and unnecessarily use CPU cycles&lt;/li&gt;
	&lt;li&gt;If the metric includes the compaction/flush reads, it&apos;s not useful.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Note that this patch also include the split of the &quot;get&quot; metric into &quot;get&quot; and &quot;next&quot; metrics, which is also useful.&lt;/p&gt;</comment>
                            <comment id="13441769" author="lhofhansl" created="Sat, 25 Aug 2012 04:34:40 +0000"  >&lt;p&gt;Back ported to 0.94.&lt;/p&gt;</comment>
                            <comment id="13441791" author="hudson" created="Sat, 25 Aug 2012 06:03:20 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #434 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/434/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/434/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; getsize per-CF metric incorrectly counts compaction related reads as well (Revision 1377205)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/InternalScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/KeyValueHeap.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/coprocessor/TestCoprocessorInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionObserverInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerMetrics.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13441846" author="hudson" created="Sat, 25 Aug 2012 11:37:39 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #50 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/50/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/50/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; getsize per-CF metric incorrectly counts compaction related reads as well (Revision 1377205)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/InternalScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/KeyValueHeap.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/coprocessor/TestCoprocessorInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionObserverInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerMetrics.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13448343" author="hudson" created="Wed, 5 Sep 2012 00:57:16 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #7 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/7/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/7/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5292&quot; title=&quot;getsize per-CF metric incorrectly counts compaction related reads as well &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5292&quot;&gt;&lt;del&gt;HBASE-5292&lt;/del&gt;&lt;/a&gt; getsize per-CF metric incorrectly counts compaction related reads as well (Revision 1377205)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/InternalScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/KeyValueHeap.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/SchemaMetrics.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/coprocessor/TestCoprocessorInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionObserverInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerMetrics.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13624636" author="stack" created="Sun, 7 Apr 2013 04:33:28 +0000"  >&lt;p&gt;Fix up after bulk move overwrote some 0.94.2 fix versions w/ 0.95.0 (Noticed by Lars Hofhansl)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12513670" name="0001-jira-HBASE-5292-Prevent-counting-getSize-on-compacti.patch" size="22935" author="zhiqiu" created="Tue, 7 Feb 2012 19:53:36 +0000"/>
                            <attachment id="12542362" name="5292-0.94.txt" size="18367" author="lhofhansl" created="Fri, 24 Aug 2012 23:08:39 +0000"/>
                            <attachment id="12512396" name="ASF.LICENSE.NOT.GRANTED--D1527.1.patch" size="4328" author="phabricator@reviews.facebook.net" created="Mon, 30 Jan 2012 09:43:10 +0000"/>
                            <attachment id="12512683" name="ASF.LICENSE.NOT.GRANTED--D1527.2.patch" size="15491" author="phabricator@reviews.facebook.net" created="Tue, 31 Jan 2012 22:54:02 +0000"/>
                            <attachment id="12513073" name="ASF.LICENSE.NOT.GRANTED--D1527.3.patch" size="15157" author="phabricator@reviews.facebook.net" created="Fri, 3 Feb 2012 00:14:53 +0000"/>
                            <attachment id="12513167" name="ASF.LICENSE.NOT.GRANTED--D1527.4.patch" size="14882" author="phabricator@reviews.facebook.net" created="Fri, 3 Feb 2012 20:09:54 +0000"/>
                            <attachment id="12513575" name="ASF.LICENSE.NOT.GRANTED--D1617.1.patch" size="18240" author="phabricator@reviews.facebook.net" created="Tue, 7 Feb 2012 05:49:01 +0000"/>
                            <attachment id="12517792" name="jira-HBASE-5292-Prevent-counting-getSize-on-compacti-2012-03-09_13_26_52.patch" size="22924" author="mikhail" created="Fri, 9 Mar 2012 21:27:29 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 30 Jan 2012 09:43:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>225489</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i01667:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4769</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>