<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:39:38 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13094/HBASE-13094.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13094] Consider Filters that are evaluated before deletes and see delete markers</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13094</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;That would be good for full control filtering of all cells, such as needed for some transaction implementations.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ghelmling&quot; class=&quot;user-hover&quot; rel=&quot;ghelmling&quot;&gt;Gary Helmling&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12777363">HBASE-13094</key>
            <summary>Consider Filters that are evaluated before deletes and see delete markers</summary>
                <type id="13" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/genericissue.png">Brainstorming</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Feb 2015 00:40:57 +0000</created>
                <updated>Mon, 22 Aug 2016 18:27:05 +0000</updated>
                                                                            <component>regionserver</component>
                    <component>Scanners</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="15423087" author="lhofhansl" created="Tue, 16 Aug 2016 17:15:59 +0000"  >&lt;p&gt;I&apos;d like to warm this up again.&lt;br/&gt;
There are several ways to do this:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Add a special Filter that can wrap any other filter. This filter would be evaluated before the delete markers are checked. This needs to be the only Filter used.&lt;/li&gt;
	&lt;li&gt;Variation of #1, which would allow to add this wrapper to a FilterList, then some logic to evaluate the right parts before or after delete markers are handled.&lt;/li&gt;
	&lt;li&gt;Add a new API to filter, in order to indicate whether this filter is to be evaluated before or after delete markers.&lt;/li&gt;
	&lt;li&gt;Add a new API to Scan and Get to allow adding a 2nd filter, that is evaluated before deletes.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;#1 is simplest and can be done 100% backwards compatible. #4 seems cleanest. Comments?&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15423475" author="lhofhansl" created="Tue, 16 Aug 2016 22:03:09 +0000"  >&lt;p&gt;Here&apos;s a pretty trivial patch doing #1.&lt;/p&gt;

&lt;p&gt;Defines a PreDeleteFilter class that can wrap any other filter. When SQM detects this class, it is will evaluate the wrapped filter&apos;s filterKeyValue method before delete markers and columns are filtered.&lt;/p&gt;

&lt;p&gt;Also creates a convenience BaseDelegateFilter class that can be used to implement Filter delegates.&lt;/p&gt;

&lt;p&gt;Warning: COMPLETELY UNTESTED. Just want to park it here. Probably a it hacky.&lt;/p&gt;</comment>
                            <comment id="15423556" author="apurtell" created="Tue, 16 Aug 2016 23:00:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;When SQM detects this class, it is will evaluate the wrapped filter&apos;s filterKeyValue method before delete markers and columns are filtered.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Hmm. Feels like special magic to me. &lt;/p&gt;

&lt;p&gt;I&apos;d go for #4. It&apos;s explicit. It allows for registration of a filter list, although I suppose &quot;PreDeleteFilter&quot; could become an empty interface used for tagging and then something could extend FilterList and implement that tagging iface... (EVen more hacky)&lt;/p&gt;</comment>
                            <comment id="15424894" author="lhofhansl" created="Wed, 17 Aug 2016 16:55:42 +0000"  >&lt;p&gt;PreDeleteFilter can wrap a FilterList too. But I agree, too much magic.&lt;br/&gt;
A wrinkle with #4 that occurred to me that than it would be possible to add two filters on a scan/get, and the logic to combine their outcomes would be ... interesting (one filter, which may be a FilterList, would run before deletes, and another, also perhaps a FilterList, runs after. When the 1st passes and the second doesn&apos;t, combining these outcomes would be tricky and hard to understand and reason about.)&lt;/p&gt;</comment>
                            <comment id="15424905" author="apurtell" created="Wed, 17 Aug 2016 17:00:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;A wrinkle with #4 that occurred to me that than it would be possible to add two filters on a scan/get, and the logic to combine their outcomes &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Except I would imagine we would not advertise the outcomes of two filter lists installed in different phases of the scan are going to be transparently combined by the system. We&apos;d be clear in documentation that a filter list installed &apos;pre delete&apos; is an advanced API, not meant to be used unless you know what you are doing (like the CP API), and if you&apos;d like to know more please see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13094&quot; title=&quot;Consider Filters that are evaluated before deletes and see delete markers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13094&quot;&gt;HBASE-13094&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="15425313" author="lhofhansl" created="Wed, 17 Aug 2016 20:29:43 +0000"  >&lt;p&gt;Yep. Or we come up with an API that enforces this structurally.&lt;/p&gt;

&lt;p&gt;For example we could adapt #4 to add an API to Get/Scan that instead only controls whether the Filter.filterKeyValue (set as before with setFilter) is evaluated either pre or post deletes. The effect would be the same as the patch I have, but with a clean no-magic API. (Although that almost leads me back to the approach of indicating the &quot;pre-postness&quot; in the Filter itself). Or one could think about option #3 above.&lt;/p&gt;</comment>
                            <comment id="15431374" author="lhofhansl" created="Mon, 22 Aug 2016 18:27:05 +0000"  >&lt;p&gt;Another complication with option #4 and two filters: All hooks other than filterKeyValue would be ignored (or we&apos;d need complicated logic to combine the two filter everywhere for all hooks - with no added value over just a single filter). Could document that only filterKeyValue is used, of course. The more I think about this, the less I like it.&lt;/p&gt;

&lt;p&gt;I think we simply need a way to decide whether the &lt;em&gt;one&lt;/em&gt; filter passed is execute before or after the delete/column-selection logic in SQM. It will be too confusing otherwise. That can be done with a new flag on Scan/Get or with the hack I did in the patch here.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=giacomotaylor&quot; class=&quot;user-hover&quot; rel=&quot;giacomotaylor&quot;&gt;James Taylor&lt;/a&gt;, would the 2nd theme I describe (only allowing a single Filter, which could be a FilterList) suffice for the Phoenix transaction use case?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12824001" name="13094-0.98.txt" size="15948" author="lhofhansl" created="Tue, 16 Aug 2016 22:03:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 16 Aug 2016 23:00:33 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2607j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>