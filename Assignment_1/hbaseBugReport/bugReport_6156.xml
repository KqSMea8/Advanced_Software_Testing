<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:34:16 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6156/HBASE-6156.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6156] Improve multiop performances in HTable#flushCommits</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6156</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This code:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  @Override
  public void flushCommits() throws IOException {
    try {
      Object[] results = new Object[writeBuffer.size()];
      try {
        this.connection.processBatch(writeBuffer, tableName, pool, results);
      } catch (InterruptedException e) {
        throw new IOException(e);
      } finally {
        // mutate list so that it is empty for complete success, or contains
        // only failed records results are returned in the same order as the
        // requests in list walk the list backwards, so we can remove from list
        // without impacting the indexes of earlier members
        for (int i = results.length - 1; i&amp;gt;=0; i--) {
          if (results[i] instanceof Result) {
            // successful Puts are removed from the list here.
            writeBuffer.remove(i);
          }
        }
      }
    } finally {
      if (clearBufferOnFail) {
        writeBuffer.clear();
        currentWriteBufferSize = 0;
      } else {
        // the write buffer was adjusted by processBatchOfPuts
        currentWriteBufferSize = 0;
        for (Put aPut : writeBuffer) {
          currentWriteBufferSize += aPut.heapSize();
        }
      }
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can be improved by:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;not iterating on the list if clearBufferOnFail is set&lt;/li&gt;
	&lt;li&gt;not iterating the the list of there are no error&lt;/li&gt;
	&lt;li&gt;iterating on the list only once instead of two when we really have to.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12559157">HBASE-6156</key>
            <summary>Improve multiop performances in HTable#flushCommits</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkeywal">Nicolas Liochon</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Jun 2012 10:05:21 +0000</created>
                <updated>Mon, 23 Sep 2013 18:31:06 +0000</updated>
                            <resolved>Wed, 20 Jun 2012 10:17:27 +0000</resolved>
                                    <version>0.95.2</version>
                                    <fixVersion>0.95.0</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13397404" author="nkeywal" created="Wed, 20 Jun 2012 10:17:27 +0000"  >&lt;p&gt;Fixed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5924&quot; title=&quot;In the client code, don&amp;#39;t wait for all the requests to be executed before resubmitting a request in error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5924&quot;&gt;&lt;del&gt;HBASE-5924&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13397556" author="nkeywal" created="Wed, 20 Jun 2012 14:50:14 +0000"  >&lt;p&gt;Small status as of June.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;Improvements identified&lt;br/&gt;
  Failure detection time: performed by ZK, with a timeout. With the default value, we needed 90 seconds before starting to act on a software or hardware issue.&lt;br/&gt;
  Recovery time - server side: split in two parts: reassigning the regions of a dead RS to a new RS, replaying the WAL. Must be as fast as possible.&lt;br/&gt;
  Recovery time - client side: errors should be transparent for the user code. On the client side, we must as well limit the time lost on errors to a minimum.&lt;br/&gt;
  Planned rolling restart: just make this as fast and less disruptive as possible&lt;br/&gt;
  Other possible changes. detailed below.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Status&lt;br/&gt;
Failure detection time: software crash - done&lt;br/&gt;
  Done in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5844&quot; title=&quot;Delete the region servers znode after a regions server crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5844&quot;&gt;&lt;del&gt;HBASE-5844&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5926&quot; title=&quot;Delete the master znode after a master crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5926&quot;&gt;&lt;del&gt;HBASE-5926&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Failure detection time: hardware issue - not started&lt;br/&gt;
 1) as much as possible, it should be handled by ZooKeeper and not HBase, see open Jira as &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-702&quot; title=&quot;GSoC 2010: Failure Detector Model&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-702&quot;&gt;ZOOKEEPER-702&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-922&quot; title=&quot;enable faster timeout of sessions in case of unexpected socket disconnect&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-922&quot;&gt;ZOOKEEPER-922&lt;/a&gt;, ...&lt;br/&gt;
 2) we need to make easy for a monitoring tool to tag a RS or Master as dead. This way, specialized HW tools could point out dead RS. Jira to open.&lt;/p&gt;

&lt;p&gt;Recovery time - Server: in progress&lt;br/&gt;
 1) bulk assignment: To be retested, there are many just-closed JIRA on this (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5998&quot; title=&quot;Bulk assignment: regionserver optimization by using a temporary cache for table descriptors when receveing an open regions request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5998&quot;&gt;&lt;del&gt;HBASE-5998&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6109&quot; title=&quot;Improve RIT performances during assignment on large clusters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6109&quot;&gt;&lt;del&gt;HBASE-6109&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5970&quot; title=&quot;Improve the AssignmentManager#updateTimer and speed up handling opened event&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5970&quot;&gt;&lt;del&gt;HBASE-5970&lt;/del&gt;&lt;/a&gt;, ...). A lot of work by many people. There are still possible improvements (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6058&quot; title=&quot;Use ZK 3.4 API &amp;#39;multi&amp;#39; in bulk assignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6058&quot;&gt;&lt;del&gt;HBASE-6058&lt;/del&gt;&lt;/a&gt;, ...)&lt;br/&gt;
 2) Log replay: To be retested, there are many just-closed JIRA on this (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6134&quot; title=&quot;Improvement for split-worker to speed up distributed log splitting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6134&quot;&gt;&lt;del&gt;HBASE-6134&lt;/del&gt;&lt;/a&gt;, ...).&lt;/p&gt;

&lt;p&gt;Recovery time - Client - done&lt;br/&gt;
 1) The RS now returns the new RS to the client after a region move (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5992&quot; title=&quot;Generalization of region move implementation + manage draining servers in bulk assign&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5992&quot;&gt;&lt;del&gt;HBASE-5992&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5877&quot; title=&quot;When a query fails because the region has moved, let the regionserver return the new address to the client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5877&quot;&gt;&lt;del&gt;HBASE-5877&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
 2) Client retries sooner on errors (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5924&quot; title=&quot;In the client code, don&amp;#39;t wait for all the requests to be executed before resubmitting a request in error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5924&quot;&gt;&lt;del&gt;HBASE-5924&lt;/del&gt;&lt;/a&gt;).&lt;br/&gt;
 3) In the future, it could be interesting to share the region location in ZK with the client. It&apos;s not reasonable today as it could lead to have too many connection to ZK. &lt;a href=&quot;https://issues.apache.org/jira/browse/ZOOKEEPER-1147&quot; title=&quot;Add support for local sessions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;ZOOKEEPER-1147&quot;&gt;&lt;del&gt;ZOOKEEPER-1147&lt;/del&gt;&lt;/a&gt; is an open JIRA on this.&lt;/p&gt;

&lt;p&gt;Planned rolling restart performances - in progress&lt;br/&gt;
  Benefits from the modifications in the client mentioned above.&lt;br/&gt;
  To do: analyze move performances to make it faster if possible.&lt;/p&gt;

&lt;p&gt;Other possible changes&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Restart the server immediately on software crash: done in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5939&quot; title=&quot;Add an autorestart option in the start scripts&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5939&quot;&gt;&lt;del&gt;HBASE-5939&lt;/del&gt;&lt;/a&gt;&lt;/li&gt;
	&lt;li&gt;Reuse the same assignment on software crash: not planned&lt;/li&gt;
	&lt;li&gt;Use spare hardware to reuse the same assignment on hardware failure: not planned&lt;/li&gt;
	&lt;li&gt;Multiple RS for the same region (excluded in the initial document: hbase architecture change previously discussed by Gary H./Andy P.): not planned&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13397562" author="nkeywal" created="Wed, 20 Jun 2012 14:55:35 +0000"  >&lt;p&gt;It seems I can&apos;t update my comments... The comment above is for hbase-5843.&lt;/p&gt;</comment>
                            <comment id="13775256" author="stack" created="Mon, 23 Sep 2013 18:31:06 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12551766">HBASE-5843</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 23 Sep 2013 18:31:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245390</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i06887:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34264</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>