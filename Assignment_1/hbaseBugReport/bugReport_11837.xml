<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:27:07 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11837/HBASE-11837.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11837] Scanner from RegionCoprocessorEnvironment.getTable(TableName) returns no local data</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11837</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Might be fixed as a byproduct of the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11766&quot; title=&quot;Backdoor CoprocessorHConnection is no longer being used for local writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11766&quot;&gt;&lt;del&gt;HBASE-11766&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Here&apos;s what I&apos;m seeing:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;From an endpoint coprocessor on SYSTEM.CATALOG table&lt;/li&gt;
	&lt;li&gt;Rows exist in the table, but are all in a single region&lt;/li&gt;
	&lt;li&gt;Scan is a new, empty scan created like this: new Scan()&lt;/li&gt;
	&lt;li&gt;The following scanner &lt;b&gt;does&lt;/b&gt; return data:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    RegionScanner scanner = region.getScanner(scan);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;The following scanner &lt;b&gt;does not&lt;/b&gt; return any data:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HTableInterface hTable = env.getTable(region.getTableDesc().getTableName());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
	&lt;li&gt;The following scanner &lt;b&gt;does&lt;/b&gt; return data:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        HTablePool pool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTablePool (env.getConfiguration(),1);
        HTableInterface hTable = pool.getTable(&lt;span class=&quot;code-quote&quot;&gt;&quot;SYSTEM.CATALOG&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12737145">HBASE-11837</key>
            <summary>Scanner from RegionCoprocessorEnvironment.getTable(TableName) returns no local data</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jeffreyz">Jeffrey Zhong</assignee>
                                    <reporter username="jamestaylor">James Taylor</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Aug 2014 16:53:49 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:09 +0000</updated>
                            <resolved>Fri, 29 Aug 2014 18:26:34 +0000</resolved>
                                    <version>0.98.4</version>
                                    <fixVersion>0.98.6</fixVersion>
                                    <component>Coprocessors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="14112470" author="jamestaylor" created="Wed, 27 Aug 2014 17:16:50 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jesse_yates&quot; class=&quot;user-hover&quot; rel=&quot;jesse_yates&quot;&gt;Jesse Yates&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14112596" author="jeffreyz" created="Wed, 27 Aug 2014 18:21:31 +0000"  >&lt;p&gt;I tried to repo and put the following in MetaDataRegionObserver.java after &quot;region.getScanner(scan);&quot; returns something and it also return something. So I did not see the issue you mentioned.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    HTableInterface hTable = env.getTable(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.env.getRegion().getTableDesc().getTableName());
    ResultScanner testScan = hTable.getScanner(scan);
    Result testR = testScan.next();
    LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Dump Result=&quot;&lt;/span&gt; + testR);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14112609" author="jamestaylor" created="Wed, 27 Aug 2014 18:34:33 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;. Is this with or without the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11766&quot; title=&quot;Backdoor CoprocessorHConnection is no longer being used for local writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11766&quot;&gt;&lt;del&gt;HBASE-11766&lt;/del&gt;&lt;/a&gt;? This is in the context of the Phoenix SYSTEM.CATALOG table and our check for a table having a view before allowing it to be dropped (on HBase 0.98.4). I did try in that code to remove the filters to rule that out. See &lt;a href=&quot;https://issues.apache.org/jira/browse/PHOENIX-1208&quot; title=&quot;Check for existence of views doesn&amp;#39;t take into account the fact that SYSTEM.CATALOG could be split across regions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PHOENIX-1208&quot;&gt;&lt;del&gt;PHOENIX-1208&lt;/del&gt;&lt;/a&gt; for me working around the issue.&lt;/p&gt;</comment>
                            <comment id="14112614" author="jamestaylor" created="Wed, 27 Aug 2014 18:37:04 +0000"  >&lt;p&gt;To repro the issue, run the following Phoenix unit test: TenantSpecificTablesDDLIT.testDropParentTableWithExistingTenantTable()&lt;/p&gt;</comment>
                            <comment id="14112659" author="jeffreyz" created="Wed, 27 Aug 2014 19:06:45 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Is this with or without the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11766&quot; title=&quot;Backdoor CoprocessorHConnection is no longer being used for local writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11766&quot;&gt;&lt;del&gt;HBASE-11766&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I tried without hbase-11766 to repo.&lt;/p&gt;</comment>
                            <comment id="14113282" author="apurtell" created="Thu, 28 Aug 2014 03:20:14 +0000"  >&lt;p&gt;Using head of branch 4.0, I couldn&apos;t reproduce with 0.98.6:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;apurtell-ltm1:phoenix apurtell$ mvn -Dhbase.version=0.98.6-hadoop2 clean install -Dtest=TenantSpecificTablesDDLIT -DfailIfNoTests=false

Running org.apache.phoenix.end2end.TenantSpecificTablesDDLIT
Tests run: 16, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 58.639 sec - in org.apache.phoenix.end2end.TenantSpecificTablesDDLIT

Results :

Tests run: 16, Failures: 0, Errors: 0, Skipped: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Or 0.98.5:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;apurtell-ltm1:phoenix apurtell$ mvn -Dhbase.version=0.98.5-hadoop2 clean install -Dtest=TenantSpecificTablesDDLIT -DfailIfNoTests=false

Running org.apache.phoenix.end2end.TenantSpecificTablesDDLIT
Tests run: 16, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 59.706 sec - in org.apache.phoenix.end2end.TenantSpecificTablesDDLIT

Results :

Tests run: 16, Failures: 0, Errors: 0, Skipped: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14113336" author="jamestaylor" created="Thu, 28 Aug 2014 04:47:18 +0000"  >&lt;p&gt;The Phoenix test is not in a broken state. We discovered this issue when trying to address a Phoenix issue. Please apply this patch to the Phoenix 4.0 branch and the test I indicated with fail for 0.98.4.&lt;/p&gt;</comment>
                            <comment id="14113371" author="apurtell" created="Thu, 28 Aug 2014 05:44:26 +0000"  >&lt;p&gt;This one is bizarre. I can reproduce the problem. If I change CoprocessorHost.Environment#getTable to simply do a &apos;new HTable(tableName)&apos; that doesn&apos;t fix the problem, but as far as I can tell will do what HTablePool would. If I uncomment James&apos; workaround in the Phoenix code indeed using HTablePool to create a table does work around the issue.&lt;/p&gt;</comment>
                            <comment id="14113377" author="apurtell" created="Thu, 28 Aug 2014 05:48:50 +0000"  >&lt;p&gt;And no &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11766&quot; title=&quot;Backdoor CoprocessorHConnection is no longer being used for local writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11766&quot;&gt;&lt;del&gt;HBASE-11766&lt;/del&gt;&lt;/a&gt; does not fix this (testing with 0.98.6)&lt;/p&gt;</comment>
                            <comment id="14113389" author="apurtell" created="Thu, 28 Aug 2014 06:02:12 +0000"  >&lt;p&gt;I also tried commenting out the code in CoprocessorHConnection#getConnectionForEnvironment where we specialize a cut through connection and this didn&apos;t fix the test. Currently stumped.&lt;/p&gt;</comment>
                            <comment id="14114450" author="jeffreyz" created="Thu, 28 Aug 2014 22:03:39 +0000"  >&lt;p&gt;I think I found the root cause. Let me update this thread shortly.&lt;/p&gt;</comment>
                            <comment id="14114452" author="apurtell" created="Thu, 28 Aug 2014 22:05:44 +0000"  >&lt;p&gt;Fantastic&lt;/p&gt;</comment>
                            <comment id="14114656" author="jeffreyz" created="Fri, 29 Aug 2014 00:26:04 +0000"  >&lt;p&gt;After tracing the steps in scan code path, I found that region server does return result back through CellScanner while CoprocessorHConnection#callBlockingMethod just drops CellScanner quietly. &lt;/p&gt;

&lt;p&gt;This is &quot;data loss&quot; issue because client drops data on the fly. I tested with the test and it passed:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Running org.apache.phoenix.end2end.TenantSpecificTablesDDLIT
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 100.844 sec - in org.apache.phoenix.end2end.TenantSpecificTablesDDLIT
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;  </comment>
                            <comment id="14114663" author="hadoopqa" created="Fri, 29 Aug 2014 00:32:49 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12665173/HBASE-11837.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12665173/HBASE-11837.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12665173&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10630//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10630//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14114670" author="apurtell" created="Fri, 29 Aug 2014 00:42:25 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14114991" author="anoop.hbase" created="Fri, 29 Aug 2014 07:44:24 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="14115622" author="jeffreyz" created="Fri, 29 Aug 2014 18:26:34 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andrew.purtell%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;andrew.purtell@gmail.com&quot;&gt;Andrew Purtell&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt; for reviews! I&apos;ve integrated the fix into 0.98 branch and there is no need for trunk branch.&lt;/p&gt;</comment>
                            <comment id="14115756" author="hudson" created="Fri, 29 Aug 2014 20:14:39 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #485 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/485/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/485/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11837&quot; title=&quot;Scanner from RegionCoprocessorEnvironment.getTable(TableName) returns no local data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11837&quot;&gt;&lt;del&gt;HBASE-11837&lt;/del&gt;&lt;/a&gt;: Scanner from RegionCoprocessorEnvironment.getTable(TableName) returns no local data (jeffreyz: rev fd35f67040dce49bebb6f01db3b402eac136b90d)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/client/CoprocessorHConnection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14116015" author="hudson" created="Fri, 29 Aug 2014 23:04:28 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98-on-Hadoop-1.1 #459 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/459/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/459/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11837&quot; title=&quot;Scanner from RegionCoprocessorEnvironment.getTable(TableName) returns no local data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11837&quot;&gt;&lt;del&gt;HBASE-11837&lt;/del&gt;&lt;/a&gt;: Scanner from RegionCoprocessorEnvironment.getTable(TableName) returns no local data (jeffreyz: rev fd35f67040dce49bebb6f01db3b402eac136b90d)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/client/CoprocessorHConnection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15016155" author="lars_francke" created="Fri, 20 Nov 2015 11:54:09 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12665173" name="HBASE-11837.patch" size="2625" author="jeffreyz" created="Fri, 29 Aug 2014 00:26:04 +0000"/>
                            <attachment id="12664823" name="PHOENIX-1208-torepro.patch" size="11651" author="jamestaylor" created="Thu, 28 Aug 2014 04:47:18 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 27 Aug 2014 18:21:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zeev:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>