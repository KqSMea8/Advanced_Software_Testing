<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:25:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5153/HBASE-5153.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5153] Add retry logic in HConnectionImplementation#resetZooKeeperTrackers</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5153</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4893&quot; title=&quot;HConnectionImplementation is closed but not deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4893&quot;&gt;&lt;del&gt;HBASE-4893&lt;/del&gt;&lt;/a&gt; is related to this issue. In that issue, we know, if multi-threads share a same connection, once this connection got abort in one thread, the other threads will got a &quot;HConnectionManager$HConnectionImplementation@18fb1f7 closed&quot; exception.&lt;/p&gt;

&lt;p&gt;It solve the problem of &quot;stale connection can&apos;t removed&quot;. But the orignal HTable instance cann&apos;t be continue to use. The connection in HTable should be recreated.&lt;/p&gt;

&lt;p&gt;Actually, there&apos;s two aproach to solve this:&lt;br/&gt;
1. In user code, once catch an IOE, close connection and re-create HTable instance. We can use this as a workaround.&lt;br/&gt;
2. In HBase Client side, catch this exception, and re-create connection.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12537717">HBASE-5153</key>
            <summary>Add retry logic in HConnectionImplementation#resetZooKeeperTrackers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jeason">Jieshan Bean</assignee>
                                    <reporter username="jeason">Jieshan Bean</reporter>
                        <labels>
                    </labels>
                <created>Mon, 9 Jan 2012 08:52:15 +0000</created>
                <updated>Fri, 20 Nov 2015 11:53:58 +0000</updated>
                            <resolved>Mon, 19 Mar 2012 04:24:55 +0000</resolved>
                                    <version>0.90.4</version>
                                    <fixVersion>0.90.6</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13182419" author="jeason" created="Mon, 9 Jan 2012 08:54:16 +0000"  >&lt;p&gt;Plz share your comments, thank you.&lt;/p&gt;</comment>
                            <comment id="13182433" author="ram_krish" created="Mon, 9 Jan 2012 09:52:49 +0000"  >&lt;p&gt;Your idea is correct.&lt;br/&gt;
Few comments&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Copyright 2010 The Apache Software Foundation
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This can be removed.&lt;br/&gt;
Also add javadoc for the new class added.&lt;/p&gt;</comment>
                            <comment id="13182438" author="jeason" created="Mon, 9 Jan 2012 10:07:51 +0000"  >&lt;p&gt;Thank you, Rama. I update the patch&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13182467" author="zhihyu@ebaysf.com" created="Mon, 9 Jan 2012 12:11:08 +0000"  >&lt;p&gt;Can you add a unit test ?&lt;br/&gt;
Testing this in cluster is also desirable. &lt;/p&gt;</comment>
                            <comment id="13182472" author="jeason" created="Mon, 9 Jan 2012 12:33:37 +0000"  >&lt;p&gt;Thanks, Ted. I&apos;ll add the unit test code immediately.&lt;/p&gt;</comment>
                            <comment id="13182552" author="zhihyu@ebaysf.com" created="Mon, 9 Jan 2012 15:23:29 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.closed)
+        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConnectionClosedException(toString() + &lt;span class=&quot;code-quote&quot;&gt;&quot; closed&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please enclose the throw statement in curly braces.&lt;/p&gt;

&lt;p&gt;Please also prepare patch for TRUNK.&lt;/p&gt;</comment>
                            <comment id="13183290" author="jeason" created="Tue, 10 Jan 2012 14:22:53 +0000"  >&lt;p&gt;Only do that in flushCommits maybe not enough. I&apos;ll go though the code and give a more considerate approach. and also will give a patch for TRUNK.&lt;/p&gt;</comment>
                            <comment id="13184092" author="zhihyu@ebaysf.com" created="Wed, 11 Jan 2012 14:22:33 +0000"  >&lt;p&gt;@Jieshan:&lt;br/&gt;
Can you prepare a patch for trunk ?&lt;/p&gt;</comment>
                            <comment id="13184211" author="stack" created="Wed, 11 Jan 2012 17:27:12 +0000"  >&lt;p&gt;Patch looks good.  I like your addition of a specific Exception for closed state.&lt;/p&gt;

&lt;p&gt;Does this have to be public Jieshan?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getRegionServerWithRetries
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Same for processBatch and getRegionLocation.&lt;/p&gt;

&lt;p&gt;If public should be in HTableInterface but they seem implementation methods rather than something that should be part of public interface.&lt;/p&gt;

&lt;p&gt;A style nit &amp;#8211; i.e. not important but if you are going to redo the patch you miight want to address it &amp;#8211; is that you do this in handleConnectionClosedException....&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ioe &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ConnectionClosedException) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the whole method is dealing with the case where above is true.  I&apos;d suggest that you might do:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(ioe &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; ConnectionClosedException)) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... then you save a whole indent and its clear that the method is all about dealing with ConnectionClosedException.&lt;/p&gt;

&lt;p&gt;Is it right including this in HTable?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
getPauseTime
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In trunk that is in a new ConnectionUtils class.  Maybe you have to do it for 0.90?&lt;/p&gt;

&lt;p&gt;I&apos;m wondering if the class ConnectionClosedException needs to be public also?  Its only used in this package, right?&lt;/p&gt;

</comment>
                            <comment id="13184705" author="jeason" created="Thu, 12 Jan 2012 03:54:05 +0000"  >&lt;p&gt;@Ted, the patch for TRUNK seems very different, and i still need some time to check it. hope i can provide today&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;@Stack, I think ConnectionUtils is reasonable. I can add it&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I will update the patch.&lt;/p&gt;

&lt;p&gt;Thank you all.&lt;/p&gt;</comment>
                            <comment id="13185107" author="zhihyu@ebaysf.com" created="Thu, 12 Jan 2012 17:53:27 +0000"  >&lt;p&gt;Jieshan&apos;s patch for TRUNK.&lt;/p&gt;</comment>
                            <comment id="13185117" author="zhihyu@ebaysf.com" created="Thu, 12 Jan 2012 18:13:11 +0000"  >&lt;p&gt;For the trunk patch:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @param actions
+   *          The collection of actions.
+   * @param tableName
+   *          Name of the hbase table
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The explanation should be on the same line as parameter name.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * Check the connection. If it has been closed, we should recreate the
+   * Connection. See HBASE-5153.
+   * 
+   * @param ioe
+   *          The IOE throwed by the HConnection methods.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Connection on second line above should start with lower case &apos;c&apos;.&lt;br/&gt;
throwed should be thrown.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RetriesExhaustedException(
+            &lt;span class=&quot;code-quote&quot;&gt;&quot;Retry to recreate connection in HTable, but failed.&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please include the value of tries in the exception message.&lt;/p&gt;

&lt;p&gt;Good work.&lt;/p&gt;</comment>
                            <comment id="13185135" author="hadoopqa" created="Thu, 12 Jan 2012 18:40:57 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12510397/5153-trunk.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12510397/5153-trunk.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -147 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 80 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplicationPeer&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/748//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/748//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/748//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/748//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/748//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/748//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13185415" author="jeason" created="Fri, 13 Jan 2012 03:48:16 +0000"  >&lt;p&gt;I updated the patches. &lt;/p&gt;</comment>
                            <comment id="13185426" author="hadoopqa" created="Fri, 13 Jan 2012 04:24:58 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12510458/HBASE-5153-trunk-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12510458/HBASE-5153-trunk-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -147 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 80 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/751//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/751//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/751//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/751//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/751//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/751//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13185453" author="zhihyu@ebaysf.com" created="Fri, 13 Jan 2012 06:17:20 +0000"  >&lt;p&gt;+1 on latest patches.&lt;/p&gt;</comment>
                            <comment id="13185455" author="lhofhansl" created="Fri, 13 Jan 2012 06:23:00 +0000"  >&lt;p&gt;The trunk and 0.92 patch won&apos;t work with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4805&quot; title=&quot;Allow better control of resource consumption in HTable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4805&quot;&gt;&lt;del&gt;HBASE-4805&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
I would rather see a way to be able to reuse the connection rather than getting a new one as this defeats the whole idea of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4805&quot; title=&quot;Allow better control of resource consumption in HTable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4805&quot;&gt;&lt;del&gt;HBASE-4805&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13185456" author="lhofhansl" created="Fri, 13 Jan 2012 06:34:39 +0000"  >&lt;p&gt;Is the only time when this happens a loss of the ZK connection?&lt;br/&gt;
All that a new HConnectionImplementation is doing is a call to setupZookeeperTrackers.&lt;br/&gt;
HConnectionImplementation.abort already does this. Why would that succeed in the new Connection? Is it because we retry?&lt;/p&gt;

&lt;p&gt;Maybe HConnectionImplementation.resetZooKeeperTrackers should have the retry logic.&lt;/p&gt;

&lt;p&gt;-1 on current patches.&lt;/p&gt;</comment>
                            <comment id="13185487" author="jeason" created="Fri, 13 Jan 2012 08:38:32 +0000"  >&lt;p&gt;Maybe retry in resetZooKeeperTrackers is better. We try our best to re-use the original connection. The worst case is even if we retried max times and still fail, then abort, but i think we&apos;re responsible for letting the user level know this. &lt;/p&gt;</comment>
                            <comment id="13185571" author="zhihyu@ebaysf.com" created="Fri, 13 Jan 2012 13:00:33 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
Hbase-4805 is not in 0.90&lt;br/&gt;
So in spirit, this Jira should be able to go into 0.90&lt;br/&gt;
What do you think ?&lt;/p&gt;</comment>
                            <comment id="13185601" author="jeason" created="Fri, 13 Jan 2012 14:20:39 +0000"  >&lt;p&gt;Thanks, Ted.&lt;/p&gt;

&lt;p&gt;Without &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3065&quot; title=&quot;Retry all &amp;#39;retryable&amp;#39; zk operations; e.g. connection loss&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3065&quot;&gt;&lt;del&gt;HBASE-3065&lt;/del&gt;&lt;/a&gt;, 0.90 doesn&apos;t handle the ConnectionLossException correctly. Consider the below case:&lt;br/&gt;
1. Somewhere trigger a HConnection#abort. &lt;br/&gt;
2. Suppose the check of &quot;if (t instanceof KeeperException.SessionExpiredException)&quot; is true. Then called the resetZooKeeperTrackers().&lt;br/&gt;
3. A ConnectionLossException occur during ZookeeperNodeTracker#start. then trigger a new HConnection#abort. At this scenario, the previous abort may print a log of &lt;br/&gt;
&quot;Reconnected successfully. This disconnect could have been caused by a network partition or a long-running GC pause......&quot;&lt;br/&gt;
4. The new abort carry a Throwable with a type which is not KeeperException.SessionExpiredException. so this time abort directly.&lt;/p&gt;

&lt;p&gt;It seems a recursion here.&lt;/p&gt;

&lt;p&gt;Either re-use the old connection by resetZooKeeperTrackers, or re-create the connection, the ZookeeperWatcher will be a new one. So  I still think the patch for 0.90 is reasonable.&lt;/p&gt;

&lt;p&gt;Trunk patch will be made big changes.&lt;/p&gt;

&lt;p&gt;So any other good suggestions? Thanks.&lt;/p&gt;</comment>
                            <comment id="13185619" author="zhihyu@ebaysf.com" created="Fri, 13 Jan 2012 14:58:16 +0000"  >&lt;p&gt;I think we can solve &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5084&quot; title=&quot;Allow different HTable instances to share one ExecutorService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5084&quot;&gt;&lt;del&gt;HBASE-5084&lt;/del&gt;&lt;/a&gt; first by not bundling the HConnection and ExecutorService.&lt;br/&gt;
After that, this JIRA&apos;s patch for TRUNK can be modified to take effect when HConnection is managed internally.&lt;/p&gt;</comment>
                            <comment id="13185668" author="lhofhansl" created="Fri, 13 Jan 2012 16:46:57 +0000"  >&lt;p&gt;@Ted: This could go into 0.90. Downside then is that 0.90 would behave quite differently.&lt;br/&gt;
I feel ambivalent about &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5084&quot; title=&quot;Allow different HTable instances to share one ExecutorService&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5084&quot;&gt;&lt;del&gt;HBASE-5084&lt;/del&gt;&lt;/a&gt; (seems we&apos;re over engineering this, but if you think we need that, then let&apos;s fix that first and then revisit this).&lt;/p&gt;

&lt;p&gt;@Jieshan &amp;amp; Ted: Maybe have some retry logic resetZooKeeperTrackers &lt;b&gt;and&lt;/b&gt; give HConnection an extra &quot;reset&quot; method? That way app code can redo the reset if needed.&lt;/p&gt;</comment>
                            <comment id="13185700" author="ram_krish" created="Fri, 13 Jan 2012 17:53:45 +0000"  >&lt;p&gt;@Lars&lt;br/&gt;
Ok Lars.  Tomorrow may be we can upload a new patch with a retry logic in resetZooKeeperTrackers.  I will discuss with Jieshan tomorrow. Thanks Lars.&lt;/p&gt;</comment>
                            <comment id="13185709" author="lhofhansl" created="Fri, 13 Jan 2012 18:00:57 +0000"  >&lt;p&gt;Thanks Ram (and Jieshan and Ted).&lt;br/&gt;
In my previous comments I did not mean to be abrasive. Thanks for finding this problem and working on a patch for it (I completely missed this when I worked on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4805&quot; title=&quot;Allow better control of resource consumption in HTable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4805&quot;&gt;&lt;del&gt;HBASE-4805&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13185716" author="ram_krish" created="Fri, 13 Jan 2012 18:04:41 +0000"  >&lt;p&gt;No problem Lars.  Its good to get the best suggestions and ideas. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13186171" author="jeason" created="Sat, 14 Jan 2012 11:50:46 +0000"  >&lt;p&gt;This is the new patch for 90 according to Lars&apos; suggestion. Tell me if anything still need to change.&lt;/p&gt;

&lt;p&gt;Thank you Ted, Lars &amp;amp; Ram.&lt;/p&gt;</comment>
                            <comment id="13186238" author="zhihyu@ebaysf.com" created="Sat, 14 Jan 2012 15:35:06 +0000"  >&lt;p&gt;For patch v5, setupZookeeperTrackers():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootRegionTracker.start();
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootRegionTracker.start(allowAbort)
+          &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.masterAddressTracker.start(allowAbort);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If rootRegionTracker.start() returns false, masterAddressTracker.start() would be skipped.&lt;br/&gt;
Since setupZookeeperTrackers() is called by HConnectionImplementation ctor, I suggest making setupZookeeperTrackers() reentrant (checking masterAddressTracker and rootRegionTracker against null) and calling it in HConnectionImplementation ctor.&lt;/p&gt;</comment>
                            <comment id="13186241" author="zhihyu@ebaysf.com" created="Sat, 14 Jan 2012 15:47:05 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * Close the original connection and create a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; one.
+   * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ZooKeeperConnectionException  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; unable to connect to zookeeper
+   */
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void resetConnection() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; ZooKeeperConnectionException;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The first line should read &apos;Closes the original connection and creates a new one.&apos;&lt;br/&gt;
Since resetZooKeeperTrackersWithRetries() is called underneath, I think naming this new method resetZooKeeperTrackersWithRetries() seems better.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+/**
+ * Thrown when HConnection has been closed.
+ */
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class InvalidConnectionException &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Going over the patch, the new exception is indeed used to indicate closed connection. I think naming it ClosedConnectionException is better.&lt;/p&gt;</comment>
                            <comment id="13186271" author="lhofhansl" created="Sat, 14 Jan 2012 17:32:57 +0000"  >&lt;p&gt;Thanks Jieshan. This patch is great.&lt;br/&gt;
+1 after Ted&apos;s comments are fixed.&lt;/p&gt;

&lt;p&gt;Are you planning to make a 0.92 and trunk patch as well?&lt;br/&gt;
(After Stacks changes in trunk that might be not completely trivial).&lt;/p&gt;</comment>
                            <comment id="13186274" author="lhofhansl" created="Sat, 14 Jan 2012 17:36:31 +0000"  >&lt;p&gt;Oh, and should probably change the title of this jira.&lt;/p&gt;</comment>
                            <comment id="13186710" author="jeason" created="Mon, 16 Jan 2012 05:56:24 +0000"  >&lt;p&gt;Changes:&lt;br/&gt;
1. Add a method &quot;unregisterListener&quot; in ZookeeperWatcher. This will be called in ZookeeperNodeTracker&apos;s stop method.&lt;br/&gt;
2. Stop the trackers if start failed during the retries.&lt;/p&gt;

&lt;p&gt;Thank you , Ted.&lt;/p&gt;

&lt;p&gt;@Lars, I will make the patches for trunk and 92, patch for 90 seems more urgent&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;..Thank you.  &lt;/p&gt;</comment>
                            <comment id="13186719" author="zhihyu@ebaysf.com" created="Mon, 16 Jan 2012 06:07:30 +0000"  >&lt;p&gt;Minor comment:&lt;br/&gt;
In setupZookeeperTrackers(), after calling stop(), the masterAddressTracker / rootRegionTracker should be set to null.&lt;/p&gt;

&lt;p&gt;Please run patch v6 over test suite.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13186721" author="jeason" created="Mon, 16 Jan 2012 06:11:05 +0000"  >&lt;p&gt;The test is still running. Before I get the results, I want your comments&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;br/&gt;
Thank you.&lt;/p&gt;</comment>
                            <comment id="13186730" author="jeason" created="Mon, 16 Jan 2012 06:42:28 +0000"  >&lt;p&gt;I will upload the new patch after the tests finish(Including this minor change), Thanks, Ted.&lt;/p&gt;</comment>
                            <comment id="13186985" author="jeason" created="Mon, 16 Jan 2012 15:57:30 +0000"  >&lt;p&gt;Ran the tests again, got the same results: 5 tests failed due to the hostName problem. Please find the results from the attachment &quot;TestResults-hbase5153.out&quot;.&lt;/p&gt;</comment>
                            <comment id="13187011" author="zhihyu@ebaysf.com" created="Mon, 16 Jan 2012 16:37:56 +0000"  >&lt;p&gt;@Jieshan:&lt;br/&gt;
Please find a machine which has access to internet to run the test suite.&lt;br/&gt;
maven needs to download artifacts.&lt;/p&gt;

&lt;p&gt;I ran the 5 tests on MacBook and they passed.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  839  mt -Dtest=TestClockSkewDetection
  840  mt -Dtest=TestScanner
  841  mt -Dtest=TestCatalogTrackerOnCluster
  842  mt -Dtest=TestCatalogTracker
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;+1 on latest patch.&lt;/p&gt;</comment>
                            <comment id="13187277" author="lhofhansl" created="Mon, 16 Jan 2012 22:51:44 +0000"  >&lt;p&gt;+1 on latest patch&lt;/p&gt;</comment>
                            <comment id="13187341" author="zhihyu@ebaysf.com" created="Tue, 17 Jan 2012 00:41:13 +0000"  >&lt;p&gt;Patch for TRUNK.&lt;/p&gt;</comment>
                            <comment id="13187347" author="lhofhansl" created="Tue, 17 Jan 2012 00:50:01 +0000"  >&lt;p&gt;+1 on trunk patch. 0.92 is similar?&lt;/p&gt;</comment>
                            <comment id="13187367" author="hadoopqa" created="Tue, 17 Jan 2012 01:34:48 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12510779/5153-trunk.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12510779/5153-trunk.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 18 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -144 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 83 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/783//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/783//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/783//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/783//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/783//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/783//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13187429" author="zhihyu@ebaysf.com" created="Tue, 17 Jan 2012 04:07:39 +0000"  >&lt;p&gt;Integrated to 0.90 and TRUNK.&lt;/p&gt;

&lt;p&gt;Waiting for 0.92 security build to pass before integrating to 0.92&lt;/p&gt;

&lt;p&gt;Thanks for the patch Jieshan.&lt;/p&gt;

&lt;p&gt;Thanks for the review Lars.&lt;/p&gt;</comment>
                            <comment id="13187436" author="zhihyu@ebaysf.com" created="Tue, 17 Jan 2012 04:33:26 +0000"  >&lt;p&gt;Patch for 0.92 branch&lt;/p&gt;</comment>
                            <comment id="13187440" author="zhihyu@ebaysf.com" created="Tue, 17 Jan 2012 04:43:21 +0000"  >&lt;p&gt;Integrated to 0.92 branch.&lt;/p&gt;</comment>
                            <comment id="13187442" author="jeason" created="Tue, 17 Jan 2012 04:47:54 +0000"  >&lt;p&gt;Thank you, Ted.&lt;/p&gt;</comment>
                            <comment id="13187446" author="ram_krish" created="Tue, 17 Jan 2012 04:52:51 +0000"  >&lt;p&gt;Thanks a lot Ted. Nice of you .&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13187475" author="hudson" created="Tue, 17 Jan 2012 06:14:08 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2635 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2635/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2635/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5153&quot; title=&quot;Add retry logic in HConnectionImplementation#resetZooKeeperTrackers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5153&quot;&gt;&lt;del&gt;HBASE-5153&lt;/del&gt;&lt;/a&gt;  Add retry logic in HConnectionImplementation#resetZooKeeperTrackers (Jieshan)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/ClosedConnectionException.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithAbort.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithRemove.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionServerCoprocessorExceptionWithAbort.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperNodeTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13187495" author="hudson" created="Tue, 17 Jan 2012 06:58:10 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #79 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/79/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/79/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5153&quot; title=&quot;Add retry logic in HConnectionImplementation#resetZooKeeperTrackers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5153&quot;&gt;&lt;del&gt;HBASE-5153&lt;/del&gt;&lt;/a&gt;  Add retry logic in HConnectionImplementation#resetZooKeeperTrackers (Jieshan)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/ClosedConnectionException.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithAbort.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithRemove.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionServerCoprocessorExceptionWithAbort.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperNodeTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13187585" author="hudson" created="Tue, 17 Jan 2012 10:51:54 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #246 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/246/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/246/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5153&quot; title=&quot;Add retry logic in HConnectionImplementation#resetZooKeeperTrackers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5153&quot;&gt;&lt;del&gt;HBASE-5153&lt;/del&gt;&lt;/a&gt;  Add retry logic in HConnectionImplementation#resetZooKeeperTrackers (Jieshan)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/ClosedConnectionException.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/ConnectionUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnection.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithAbort.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithRemove.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperNodeTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13187684" author="hudson" created="Tue, 17 Jan 2012 13:47:10 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #81 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/81/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/81/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5153&quot; title=&quot;Add retry logic in HConnectionImplementation#resetZooKeeperTrackers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5153&quot;&gt;&lt;del&gt;HBASE-5153&lt;/del&gt;&lt;/a&gt;  Add retry logic in HConnectionImplementation#resetZooKeeperTrackers (Jieshan)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/ClosedConnectionException.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/ConnectionUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnection.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithAbort.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithRemove.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperNodeTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13187774" author="zhihyu@ebaysf.com" created="Tue, 17 Jan 2012 16:13:08 +0000"  >&lt;p&gt;When I ran TestMergeTool on TRUNK, I got:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; prio=5 tid=102801000 nid=0x100601000 waiting on condition [1005fb000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (sleeping)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(Native Method)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:302)
	at java.util.concurrent.TimeUnit.sleep(TimeUnit.java:328)
	at org.apache.hadoop.hbase.util.RetryCounter.sleepUntilNextRetry(RetryCounter.java:55)
	at org.apache.hadoop.hbase.zookeeper.RecoverableZooKeeper.exists(RecoverableZooKeeper.java:171)
	at org.apache.hadoop.hbase.zookeeper.ZKUtil.watchAndCheckExists(ZKUtil.java:230)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:80)
	- locked &amp;lt;784a83930&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;7854b9898&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;7854b98e0&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;7854b9928&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;78f991ad0&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790b9f540&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790b9f560&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790b9f580&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790b9f5a0&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;78f98ae20&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;78f98ae40&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;78f98ae60&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;78e8b6ac8&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;78e8b6ae8&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;78e8b6b08&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790d0e640&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790d0e660&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790d0e600&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790d0e620&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790d0e5c0&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790d0e5e0&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790d0e580&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790d0e5a0&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790d0e540&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790d0e560&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.resetZooKeeperTrackersWithRetries(HConnectionManager.java:625)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.abort(HConnectionManager.java:1711)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.start(ZooKeeperNodeTracker.java:93)
	- locked &amp;lt;790d0e500&amp;gt; (a org.apache.hadoop.hbase.MasterAddressTracker)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.setupZookeeperTrackers(HConnectionManager.java:590)
	- locked &amp;lt;790b70180&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation)
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.&amp;lt;init&amp;gt;(HConnectionManager.java:577)
	at org.apache.hadoop.hbase.client.HConnectionManager.getConnection(HConnectionManager.java:184)
	- locked &amp;lt;790c46258&amp;gt; (a org.apache.hadoop.hbase.client.HConnectionManager$1)
	at org.apache.hadoop.hbase.client.HBaseAdmin.&amp;lt;init&amp;gt;(HBaseAdmin.java:98)
	at org.apache.hadoop.hbase.client.HBaseAdmin.checkHBaseAvailable(HBaseAdmin.java:1570)
	at org.apache.hadoop.hbase.util.Merge.run(Merge.java:94)
	at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:65)
	at org.apache.hadoop.hbase.util.TestMergeTool.mergeAndVerify(TestMergeTool.java:190)
	at org.apache.hadoop.hbase.util.TestMergeTool.testMergeTool(TestMergeTool.java:268)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at junit.framework.TestCase.runTest(TestCase.java:168)
	at junit.framework.TestCase.runBare(TestCase.java:134)
	at junit.framework.TestResult$1.protect(TestResult.java:110)
	at junit.framework.TestResult.runProtected(TestResult.java:128)
	at junit.framework.TestResult.run(TestResult.java:113)
	at junit.framework.TestCase.run(TestCase.java:124)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)
	at org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:53)
	at org.apache.maven.surefire.junit4.JUnit4Provider.executeTestSet(JUnit4Provider.java:123)
	at org.apache.maven.surefire.junit4.JUnit4Provider.invoke(JUnit4Provider.java:104)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.maven.surefire.util.ReflectionUtils.invokeMethodWithArray(ReflectionUtils.java:164)
	at org.apache.maven.surefire.booter.ProviderFactory$ProviderProxy.invoke(ProviderFactory.java:110)
	at org.apache.maven.surefire.booter.SurefireStarter.invokeProvider(SurefireStarter.java:175)
	at org.apache.maven.surefire.booter.SurefireStarter.runSuitesInProcessWhenForked(SurefireStarter.java:81)
	at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:68)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13187810" author="zhihyu@ebaysf.com" created="Tue, 17 Jan 2012 17:17:26 +0000"  >&lt;p&gt;Reverted from 0.92 and TRUNK due to failed Jenkins builds.&lt;/p&gt;</comment>
                            <comment id="13187845" author="lhofhansl" created="Tue, 17 Jan 2012 18:09:21 +0000"  >&lt;p&gt;Was that repeatable? Might be a problem with the test (relying on the fact that an HConnection would just give up after one try).&lt;/p&gt;</comment>
                            <comment id="13187848" author="zhihyu@ebaysf.com" created="Tue, 17 Jan 2012 18:14:33 +0000"  >&lt;p&gt;TestMergeTool hung in several builds.&lt;br/&gt;
That was why I ran it on MacBook.&lt;/p&gt;</comment>
                            <comment id="13187989" author="hudson" created="Tue, 17 Jan 2012 20:48:34 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #248 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/248/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/248/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5153&quot; title=&quot;Add retry logic in HConnectionImplementation#resetZooKeeperTrackers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5153&quot;&gt;&lt;del&gt;HBASE-5153&lt;/del&gt;&lt;/a&gt; revert due to failed Jenkins builds&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/ClosedConnectionException.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/ConnectionUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnection.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithAbort.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithRemove.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperNodeTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13188350" author="hudson" created="Wed, 18 Jan 2012 09:16:41 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #83 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/83/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/83/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5153&quot; title=&quot;Add retry logic in HConnectionImplementation#resetZooKeeperTrackers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5153&quot;&gt;&lt;del&gt;HBASE-5153&lt;/del&gt;&lt;/a&gt; revert due to failed Jenkins builds&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/ClosedConnectionException.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/ConnectionUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnection.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithAbort.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithRemove.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperNodeTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13188384" author="hudson" created="Wed, 18 Jan 2012 10:35:08 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #81 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/81/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/81/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5153&quot; title=&quot;Add retry logic in HConnectionImplementation#resetZooKeeperTrackers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5153&quot;&gt;&lt;del&gt;HBASE-5153&lt;/del&gt;&lt;/a&gt; revert due to failed Jenkins builds&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/ClosedConnectionException.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithAbort.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithRemove.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionServerCoprocessorExceptionWithAbort.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperNodeTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13189005" author="hudson" created="Thu, 19 Jan 2012 08:53:06 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2639 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2639/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2639/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5153&quot; title=&quot;Add retry logic in HConnectionImplementation#resetZooKeeperTrackers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5153&quot;&gt;&lt;del&gt;HBASE-5153&lt;/del&gt;&lt;/a&gt; revert due to failed Jenkins builds&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/ClosedConnectionException.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperNodeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithAbort.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterCoprocessorExceptionWithRemove.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionServerCoprocessorExceptionWithAbort.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperNodeTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13194176" author="krystian" created="Thu, 26 Jan 2012 21:03:28 +0000"  >&lt;p&gt;FYI: &lt;span class=&quot;nobr&quot;&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12510683/12510683_HBASE-5153-V6-90-minorchange.patch&quot; title=&quot;HBASE-5153-V6-90-minorchange.patch attached to HBASE-5153&quot;&gt;HBASE-5153-V6-90-minorchange.patch&lt;sup&gt;&lt;img class=&quot;rendericon&quot; src=&quot;https://issues.apache.org/jira/images/icons/link_attachment_7.gif&quot; height=&quot;7&quot; width=&quot;7&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/sup&gt;&lt;/a&gt;&lt;/span&gt; also fixes &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5289&quot; title=&quot;NullPointerException in resetZooKeeperTrackers in HConnectionManager / HConnectionImplementation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5289&quot;&gt;&lt;del&gt;HBASE-5289&lt;/del&gt;&lt;/a&gt; (linked)&lt;/p&gt;</comment>
                            <comment id="13194189" author="lhofhansl" created="Thu, 26 Jan 2012 21:21:00 +0000"  >&lt;p&gt;Also it occurred to me that another nice change would be to be able specify the retry count for resetZooKeeperTrackersWithRetries different from the other operations. &lt;br/&gt;
The thinking is this:&lt;br/&gt;
While the ZK is not reachable the HConnection (and any other HConnection) is essentially not usable. In some settings it might be good to have the connection just sit there, and retry until the connection is bad. Maybe for another jira.&lt;/p&gt;

&lt;p&gt;Where are we with this generally?&lt;br/&gt;
Is it just TestMergeTool hanging? If so I&apos;ll have a look at it today.&lt;/p&gt;</comment>
                            <comment id="13194193" author="zhihyu@ebaysf.com" created="Thu, 26 Jan 2012 21:30:48 +0000"  >&lt;p&gt;There were two failed tests:&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/81/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/81/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;If you can resolve the hanging TestMergeTool, that would be great.&lt;/p&gt;

&lt;p&gt;I am on-call this week, FYI&lt;/p&gt;</comment>
                            <comment id="13194347" author="lhofhansl" created="Fri, 27 Jan 2012 01:36:40 +0000"  >&lt;p&gt;So is this change in 0.90 now? I&apos;m confused. Should revert it from there too, I guess.&lt;br/&gt;
I will see what&apos;s up with TestMergeTool in trunk now.&lt;/p&gt;</comment>
                            <comment id="13194357" author="lhofhansl" created="Fri, 27 Jan 2012 01:57:52 +0000"  >&lt;p&gt;So here&apos;s the problem. This is hanging while validating that HBase is not running via HBaseAdmin.checkHBaseAvailable, which just attempts to create a new HBaseAdmin after it sets hbase.client.retries.number to 1. However HConnectionImpl caches hbase.client.retries.number in numRetries, and hence if ZK is not running resetZooKeeperTrackersWithRetries will retry for a while.&lt;br/&gt;
The simplest fix would be for resetZooKeeperTrackersWithRetries to ignore he cached setting and to retrieve the value again from the setting. While I am at it, I&apos;ll also add another option to a different number of retries here.&lt;/p&gt;</comment>
                            <comment id="13194373" author="zhihyu@ebaysf.com" created="Fri, 27 Jan 2012 02:39:10 +0000"  >&lt;p&gt;Thanks for tracking down the issue, Lars.&lt;br/&gt;
If you can upload the latest 5153-trunk.txt to reviewboard first followed by your new patch, that would help us know your changes easily.&lt;/p&gt;</comment>
                            <comment id="13194388" author="lhofhansl" created="Fri, 27 Jan 2012 03:04:51 +0000"  >&lt;p&gt;Sure... There&apos;s a bit more to this too. resetZooKeeperTrackersWithRetries on its last try calls setupZookeeperTrackers with allow aborts, which will call resetZooKeeperTrackersWithRetries again. Leading to an endless loop. Need to think about how to refactor this.&lt;/p&gt;</comment>
                            <comment id="13194406" author="jeason" created="Fri, 27 Jan 2012 03:40:21 +0000"  >&lt;p&gt;It should not leading to an endless loop. Unless, each retry will get a ZookeeperLossException. If this exception happened for long time, Zookeeper must has some problem. so when create a new Zookeeper instance, it already thrown a Exception. So it won&apos;t be an endless loop:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;if ((t instanceof KeeperException.SessionExpiredException)
          || (t instanceof KeeperException.ConnectionLossException)) {
        try {
          LOG.info(&quot;This client just lost it&apos;s session with ZooKeeper, trying&quot; +
              &quot; to reconnect.&quot;);
          resetZooKeeperTrackersWithRetries();
          LOG.info(&quot;Reconnected successfully. This disconnect could have been&quot; +
              &quot; caused by a network partition or a long-running GC pause,&quot; +
              &quot; either way it&apos;s recommended that you verify your environment.&quot;);
          return;
        } catch (ZooKeeperConnectionException e) {
          LOG.error(&quot;Could not reconnect to ZooKeeper after session&quot; +
              &quot; expiration, aborting&quot;);
          t = e;
        }
      }
      if (t != null) LOG.fatal(msg, t);
      else LOG.fatal(msg);
      HConnectionManager.deleteStaleConnection(this);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13194412" author="jeason" created="Fri, 27 Jan 2012 03:45:16 +0000"  >&lt;p&gt;As discussed with Ted. Trunk and 92 already including a retry logic in RecoverableZooKeeper. So that makes the retry logic in resetZooKeeperTrackersWithRetries less important.&lt;/p&gt;</comment>
                            <comment id="13194414" author="zhihyu@ebaysf.com" created="Fri, 27 Jan 2012 03:49:10 +0000"  >&lt;p&gt;See the stack trace I pasted here:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5153?focusedCommentId=13187774&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13187774&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5153?focusedCommentId=13187774&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13187774&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;If this exception happened for long time, Zookeeper must has some problem.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We should be prepared when the above indeed happens. I am sure this scenario is possible.&lt;/p&gt;

&lt;p&gt;See also this part of the code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ZooKeeperConnectionException zkce) {
+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isLastTime) {
+            &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; zkce;
+          }
+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13194426" author="jeason" created="Fri, 27 Jan 2012 03:59:30 +0000"  >&lt;p&gt;Thanks, Ted...I will take a look at that stack trace.&lt;/p&gt;

&lt;p&gt;If a ZooKeeperConnectionException thrown by the below code:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;       try {
          if (setupZookeeperTrackers(isLastTime)) {
            break;
          }
        } catch (ZooKeeperConnectionException zkce) {
          if (isLastTime) {
            throw zkce;
          }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If will be catched in abort method, then calling LOG.fatal(msg, t);&lt;/p&gt;

&lt;p&gt;No problem here. Don&apos;t know whether I get you correctly&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="13194435" author="lhofhansl" created="Fri, 27 Jan 2012 04:14:23 +0000"  >&lt;p&gt;I have a new patch... Testing it now.&lt;br/&gt;
It is mostly what you have Jieshan, but it does not need all the changes to the ZookeeperNodeTracker and subclasses.&lt;br/&gt;
I&apos;ll attach it soon... Then please let me know what you think.&lt;/p&gt;</comment>
                            <comment id="13194437" author="lhofhansl" created="Fri, 27 Jan 2012 04:16:00 +0000"  >&lt;p&gt;There was also some weird stuff in HBaseAdmin.checkHBaseAvailable. It did set the client retry to 1, but left the the retry count on in RecoverableZookeeper, which leads to long, unnecessary waits.&lt;/p&gt;</comment>
                            <comment id="13194439" author="lhofhansl" created="Fri, 27 Jan 2012 04:20:40 +0000"  >&lt;p&gt;Please let me know what you think of 5153-trunk-v2.txt... Thanks&lt;/p&gt;</comment>
                            <comment id="13194441" author="lhofhansl" created="Fri, 27 Jan 2012 04:22:31 +0000"  >&lt;p&gt;@Jieshan: The endless loop happens when ZK is actually down.&lt;/p&gt;</comment>
                            <comment id="13194443" author="lhofhansl" created="Fri, 27 Jan 2012 04:26:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;As discussed with Ted. Trunk and 92 already including a retry logic in RecoverableZooKeeper. So that makes the retry logic in resetZooKeeperTrackersWithRetries less important.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Are you guys saying we do not need this in 0.92+?&lt;/p&gt;</comment>
                            <comment id="13194444" author="jeason" created="Fri, 27 Jan 2012 04:26:58 +0000"  >&lt;p&gt;Thanks Lars. It&apos;s nice of you&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13194445" author="jeason" created="Fri, 27 Jan 2012 04:30:27 +0000"  >&lt;p&gt;&quot;The endless loop happens when ZK is actually down.&quot;&lt;br/&gt;
If ZK is actually down, the below code will throw a Exception:&lt;br/&gt;
 this.zooKeeper = getZooKeeperWatcher();&lt;br/&gt;
Then catched by the below code:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  try {
          LOG.info(&quot;This client just lost it&apos;s session with ZooKeeper, trying&quot; +
              &quot; to reconnect.&quot;);
          resetZooKeeperTrackersWithRetries();
          LOG.info(&quot;Reconnected successfully. This disconnect could have been&quot; +
              &quot; caused by a network partition or a long-running GC pause,&quot; +
              &quot; either way it&apos;s recommended that you verify your environment.&quot;);
          return;
        } catch (ZooKeeperConnectionException e) {
          LOG.error(&quot;Could not reconnect to ZooKeeper after session&quot; +
              &quot; expiration, aborting&quot;);
          t = e;
        }
      if (t != null) LOG.fatal(msg, t);
      else LOG.fatal(msg);
      HConnectionManager.deleteStaleConnection(this);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It should not be a endless loop. Does that make sense?&lt;/p&gt;</comment>
                            <comment id="13194447" author="jeason" created="Fri, 27 Jan 2012 04:35:05 +0000"  >&lt;blockquote&gt;&lt;p&gt;Are you guys saying we do not need this in 0.92+?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We need this, but the patch for 0.92+ should take notice of this&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13194450" author="zhihyu@ebaysf.com" created="Fri, 27 Jan 2012 04:46:07 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isResettingZKTrackers) {
+          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I was thinking about something similar to the above.&lt;/p&gt;

&lt;p&gt;In resetZooKeeperTrackersWithRetries(), shall we call zooKeeper.close() before resetting zooKeeper?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.zooKeeper.close();
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.zooKeeper = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Thanks for the help.&lt;/p&gt;

&lt;p&gt;I think we need an addendum for 0.90&lt;/p&gt;</comment>
                            <comment id="13194451" author="jeason" created="Fri, 27 Jan 2012 04:47:10 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
Adding a &quot;isResettingZKTrackers&quot; sounds good to me. One doubt: Is it necessary to add the keyword of &quot;volatile&quot;?&lt;/p&gt;</comment>
                            <comment id="13194453" author="lhofhansl" created="Fri, 27 Jan 2012 04:52:57 +0000"  >&lt;p&gt;@Jieshan: Hmm... I do see the endless loop in the debugger. It happens from HBaseAdmin.checkHBaseAvailable when HBase is actually down. We get into resetZooKeeperTrackersWithRetries, which calls setupZookeeperTrackers, which causes abort to be called, which calls resetZooKeeperTrackersWithRetries.&lt;br/&gt;
I am not sure getZooKeeperWatcher() would throw if ZK is not available.&lt;/p&gt;

&lt;p&gt;@Ted: calling this.zooKeeper.close() (if it is not null) first seems prudent.&lt;/p&gt;

&lt;p&gt;@Jieshan: Good catch, yes it should be volatile.&lt;/p&gt;</comment>
                            <comment id="13194457" author="hadoopqa" created="Fri, 27 Jan 2012 05:01:56 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12512077/5153-trunk-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12512077/5153-trunk-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -140 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 162 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.io.hfile.TestHFileBlock&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/857//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/857//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/857//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/857//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/857//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/857//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13194519" author="jeason" created="Fri, 27 Jan 2012 06:48:37 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
During the retry, if we get any exceptions, Zookeeper and the Trackers also need to close.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+          try {
+            setupZookeeperTrackers();
+            break;
+          } catch (ZooKeeperConnectionException zkce) {
+            if (tries &amp;gt;= this.numRetries) {
+              throw zkce;
+            }
+          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13194541" author="jeason" created="Fri, 27 Jan 2012 08:35:31 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
One more doubt basing on the previous comment, regading on the below code:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+          try {
+            setupZookeeperTrackers();
+            break;
+          } catch (ZooKeeperConnectionException zkce) {
+            if (tries &amp;gt;= this.numRetries) {
+              throw zkce;
+            }
+          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;if ZookeeperNodeTracker#start get an exception, then catches and calls abort(Doesn&apos;t throw it). The above retries will be break under this situation. So this retries takes no effects.Correct me if am wrong. &lt;/p&gt;</comment>
                            <comment id="13194594" author="jeason" created="Fri, 27 Jan 2012 10:22:11 +0000"  >&lt;p&gt;This is the addendum for 90.&lt;/p&gt;</comment>
                            <comment id="13194801" author="zhihyu@ebaysf.com" created="Fri, 27 Jan 2012 14:43:18 +0000"  >&lt;p&gt;+1 on addendum for 0.90&lt;/p&gt;</comment>
                            <comment id="13194805" author="ram_krish" created="Fri, 27 Jan 2012 14:47:01 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
Thanks for the review.&lt;br/&gt;
@Lars&lt;br/&gt;
Can you review the 0.90 patch and provide your comments.&lt;br/&gt;
If it is ok i can integrate to 0.90 and take another RC. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13194904" author="lhofhansl" created="Fri, 27 Jan 2012 16:43:36 +0000"  >&lt;p&gt;+1 on addendum. Technically we should change ZooKeeperNodeTracker.start back to be void, but that is not necessary.&lt;br/&gt;
I&apos;ll update the trunk patch soon.&lt;/p&gt;</comment>
                            <comment id="13194906" author="lhofhansl" created="Fri, 27 Jan 2012 16:45:41 +0000"  >&lt;p&gt;@Jieshan... I see your point. Need to think about that.&lt;/p&gt;</comment>
                            <comment id="13194913" author="lhofhansl" created="Fri, 27 Jan 2012 16:57:12 +0000"  >&lt;p&gt;Actually then the addendum is not right either. If ZooKeeperNodeTracker.start gets an exception it&apos;ll call abort (and hence not return false)&lt;/p&gt;</comment>
                            <comment id="13195019" author="lhofhansl" created="Fri, 27 Jan 2012 19:04:09 +0000"  >&lt;p&gt;I take this back... The 0.90 addendum is good. If abort is called from the reset method it&apos;ll return right away, and in ZooKeeperNodeTracker.start fall through to return false.&lt;/p&gt;

&lt;p&gt;This entire thing is too complicated. Let&apos;s hold off on the 0.92 and trunk patches, but leave it in 0.90 (although I am not a big fan of diverging code bases either).&lt;/p&gt;</comment>
                            <comment id="13195039" author="zhihyu@ebaysf.com" created="Fri, 27 Jan 2012 19:37:08 +0000"  >&lt;p&gt;Dropping Fix versions as Lars suggested.&lt;/p&gt;</comment>
                            <comment id="13195186" author="lhofhansl" created="Fri, 27 Jan 2012 22:43:17 +0000"  >&lt;p&gt;Here&apos;s a minimal patch for trunk.&lt;/p&gt;

&lt;p&gt;If the HConnection is not usable for any reason, the using application can attempt to reset it.&lt;br/&gt;
I kept CloseConnectionException and the idea that ZooKeeperWatcher can unregister a listener.&lt;/p&gt;

&lt;p&gt;If ZK is really not available that is probably an event that the application has to deal with anyway.&lt;/p&gt;

&lt;p&gt;Long term HConnection should &lt;b&gt;not&lt;/b&gt; hold persistent connections to ZK anyway, but only establish a connection when needed.&lt;/p&gt;</comment>
                            <comment id="13195188" author="lhofhansl" created="Fri, 27 Jan 2012 22:44:54 +0000"  >&lt;p&gt;Noticed one flaw in the 0.90 addendum patch. Should be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ZooKeeperConnectionException zkce) {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tries+1 &amp;gt;= &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.numRetries) {
    &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; zkce;
  }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;(note the +1 in there)&lt;/p&gt;</comment>
                            <comment id="13195210" author="zhihyu@ebaysf.com" created="Fri, 27 Jan 2012 23:08:44 +0000"  >&lt;p&gt;For resetConnection() in the new patch, I see:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.closed = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In HConnectionImplementation.close(), we have:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (master != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (stopProxy) {
          HBaseRPC.stopProxy(master);
        }
        master = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This seems to imply that once a connection is closed, we cannot simply change this.closed to false in resetConnection().&lt;/p&gt;</comment>
                            <comment id="13195240" author="hadoopqa" created="Fri, 27 Jan 2012 23:37:15 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12512248/5153-trunk-minimal.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12512248/5153-trunk-minimal.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -140 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 161 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestAdmin&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestHFileBlock&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/861//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/861//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/861//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/861//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/861//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/861//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13195241" author="lhofhansl" created="Fri, 27 Jan 2012 23:37:41 +0000"  >&lt;p&gt;That is just guard against closed = true in HConnectionImplementation.abort().&lt;br/&gt;
abort probably not set closed to true, but then a bunch of other places would need to be changed too.&lt;/p&gt;</comment>
                            <comment id="13195438" author="ram_krish" created="Sat, 28 Jan 2012 05:52:52 +0000"  >&lt;p&gt;@Lars&lt;br/&gt;
Addressing your comments.&lt;br/&gt;
Based on your feedback will commit the patch if it is ok.&lt;/p&gt;</comment>
                            <comment id="13195443" author="hadoopqa" created="Sat, 28 Jan 2012 06:25:52 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12512291/HBASE-5153_addendum_0.90_1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12512291/HBASE-5153_addendum_0.90_1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/864//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/864//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13195444" author="lhofhansl" created="Sat, 28 Jan 2012 06:27:44 +0000"  >&lt;p&gt;@Ram: Sure. I now feel the whole logic is too complicated, but we&apos;ll not fix that any time soon. So +1 on addendum.&lt;/p&gt;</comment>
                            <comment id="13195445" author="ram_krish" created="Sat, 28 Jan 2012 06:43:52 +0000"  >&lt;p&gt;@Lars&lt;br/&gt;
I understand your point.  But as this JIRA is now committed in 0.90 so this addendum is needed.&lt;br/&gt;
I think we can ensure such things doesn&apos;t happen for other JIRAs.&lt;br/&gt;
Good on you Lars.&lt;/p&gt;</comment>
                            <comment id="13232434" author="ram_krish" created="Mon, 19 Mar 2012 04:24:55 +0000"  >&lt;p&gt;This got committed to 0.90.6.&lt;br/&gt;
Sorry for not resolving it at that time.&lt;/p&gt;</comment>
                            <comment id="15016108" author="lars_francke" created="Fri, 20 Nov 2015 11:53:58 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12539964">HBASE-5289</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12510806" name="5153-92.txt" size="25605" author="zhihyu@ebaysf.com" created="Tue, 17 Jan 2012 04:33:26 +0000"/>
                            <attachment id="12512248" name="5153-trunk-minimal.txt" size="6066" author="lhofhansl" created="Fri, 27 Jan 2012 22:43:17 +0000"/>
                            <attachment id="12512077" name="5153-trunk-v2.txt" size="13445" author="lhofhansl" created="Fri, 27 Jan 2012 04:20:40 +0000"/>
                            <attachment id="12510779" name="5153-trunk.txt" size="26236" author="zhihyu@ebaysf.com" created="Tue, 17 Jan 2012 00:41:13 +0000"/>
                            <attachment id="12510397" name="5153-trunk.txt" size="12361" author="zhihyu@ebaysf.com" created="Thu, 12 Jan 2012 17:53:27 +0000"/>
                            <attachment id="12509917" name="HBASE-5153-V2.patch" size="6506" author="jeason" created="Mon, 9 Jan 2012 14:52:41 +0000"/>
                            <attachment id="12510179" name="HBASE-5153-V3.patch" size="19317" author="jeason" created="Wed, 11 Jan 2012 12:44:14 +0000"/>
                            <attachment id="12510457" name="HBASE-5153-V4-90.patch" size="26897" author="jeason" created="Fri, 13 Jan 2012 03:48:16 +0000"/>
                            <attachment id="12510573" name="HBASE-5153-V5-90.patch" size="26340" author="jeason" created="Sat, 14 Jan 2012 11:50:46 +0000"/>
                            <attachment id="12510683" name="HBASE-5153-V6-90-minorchange.patch" size="27260" author="jeason" created="Mon, 16 Jan 2012 09:27:56 +0000"/>
                            <attachment id="12510667" name="HBASE-5153-V6-90.txt" size="27095" author="jeason" created="Mon, 16 Jan 2012 05:56:24 +0000"/>
                            <attachment id="12510458" name="HBASE-5153-trunk-v2.patch" size="12312" author="jeason" created="Fri, 13 Jan 2012 03:48:16 +0000"/>
                            <attachment id="12510382" name="HBASE-5153-trunk.patch" size="12361" author="jeason" created="Thu, 12 Jan 2012 16:12:08 +0000"/>
                            <attachment id="12509890" name="HBASE-5153.patch" size="4071" author="jeason" created="Mon, 9 Jan 2012 10:07:51 +0000"/>
                            <attachment id="12512291" name="HBASE-5153_addendum_0.90_1.patch" size="11144" author="ram_krish" created="Sat, 28 Jan 2012 05:52:52 +0000"/>
                            <attachment id="12512100" name="HBase-5153-90-addendum.patch" size="11141" author="jeason" created="Fri, 27 Jan 2012 10:22:11 +0000"/>
                            <attachment id="12510715" name="TestResults-hbase5153.out" size="26519" author="jeason" created="Mon, 16 Jan 2012 15:57:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>17.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 9 Jan 2012 09:52:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223223</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i069r3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34511</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>