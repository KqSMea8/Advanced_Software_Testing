<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:23:37 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11479/HBASE-11479.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11479] SecureConnection can&apos;t be closed when SecureClient is stopping because InterruptedException won&apos;t be caught in SecureClient#setupIOstreams()</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11479</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When HBaseClient.stop() is invoked, all cached HBaseClient.Connections will be interrupted, marked as closed and then finally closed. HBaseClient.stop() won&apos;t return before all cached HBaseClient.Connections have been closed. However, SecureConnection might not be closed after HBaseClient.stop() is invoked because of the following code in SecureClient,setupIOstreams():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
     ...
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
              continueSasl =
                ticket.runAs(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrivilegedExceptionAction&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;&amp;gt;() {
                  @Override
                  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt; run() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
                    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; setupSaslConnection(in2, out2);
                  }
                });
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception ex) {
              &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rand == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
                rand = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Random();
              }
              &lt;span class=&quot;code-comment&quot;&gt;// == InterruptedException won&apos;t be caught ==
&lt;/span&gt;              handleSaslConnectionFailure(numRetries++, MAX_RETRIES, ex, rand, ticket);
              &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
              ...
            }
        }
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
        markClosed(e);
        close();

        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
      }

...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SecureClient.handleSaslConnectionFailure(...) will throw InterruptedException exception(there will be Thread.sleep() in SecureClient.handleSaslConnectionFailure(...)) when HBaseClient#stop() is invoked. However, this InterruptedException won&apos;t be caught, making this SecureConnection can&apos;t be closed.&lt;/p&gt;

&lt;p&gt;This problem might make regionserver can&apos;t exit because regionserver will wait all SecureConnection closed when exiting. A simple way to fix this bug is to catch InterruptedException in SecureClient#setupIOstreams() and close the SecureConnection.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12726033">HBASE-11479</key>
            <summary>SecureConnection can&apos;t be closed when SecureClient is stopping because InterruptedException won&apos;t be caught in SecureClient#setupIOstreams()</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="cuijianwei">Jianwei Cui</assignee>
                                    <reporter username="cuijianwei">Jianwei Cui</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jul 2014 10:00:46 +0000</created>
                <updated>Sat, 9 Aug 2014 04:40:02 +0000</updated>
                            <resolved>Fri, 11 Jul 2014 20:12:20 +0000</resolved>
                                    <version>0.94.20</version>
                                    <fixVersion>0.94.22</fixVersion>
                                    <component>security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14054793" author="lhofhansl" created="Tue, 8 Jul 2014 10:06:59 +0000"  >&lt;p&gt;lgtm&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;, what do you think?&lt;/p&gt;</comment>
                            <comment id="14055071" author="apurtell" created="Tue, 8 Jul 2014 15:52:11 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Any chance of a trunk patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=cuijianwei&quot; class=&quot;user-hover&quot; rel=&quot;cuijianwei&quot;&gt;Jianwei Cui&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="14058540" author="cuijianwei" created="Fri, 11 Jul 2014 08:12:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;, I see the code of RpcClient#setupIOstreams for 0.96, 0.98 and trunk. It will catch Throwable in RpcClient#setupIOstreams so that won&apos;t suffer from this problem.&lt;/p&gt;</comment>
                            <comment id="14059285" author="apurtell" created="Fri, 11 Jul 2014 20:12:20 +0000"  >&lt;p&gt;Committed to 0.94 only, Lars already acked it. Thanks for the patch!&lt;/p&gt;</comment>
                            <comment id="14059454" author="hudson" created="Fri, 11 Jul 2014 22:39:54 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94-security #498 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/498/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/498/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11479&quot; title=&quot;SecureConnection can&amp;#39;t be closed when SecureClient is stopping because InterruptedException won&amp;#39;t be caught in SecureClient#setupIOstreams()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11479&quot;&gt;&lt;del&gt;HBASE-11479&lt;/del&gt;&lt;/a&gt; SecureConnection can&apos;t be closed when SecureClient is stopping (cuijianwei) (apurtell: rev 24b3584a1735b5a0fcd0f25a5d3903b31901b227)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14059465" author="hudson" created="Fri, 11 Jul 2014 22:55:48 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-JDK7 #153 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-JDK7/153/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-JDK7/153/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11479&quot; title=&quot;SecureConnection can&amp;#39;t be closed when SecureClient is stopping because InterruptedException won&amp;#39;t be caught in SecureClient#setupIOstreams()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11479&quot;&gt;&lt;del&gt;HBASE-11479&lt;/del&gt;&lt;/a&gt; SecureConnection can&apos;t be closed when SecureClient is stopping (cuijianwei) (apurtell: rev 24b3584a1735b5a0fcd0f25a5d3903b31901b227)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14059523" author="hudson" created="Sat, 12 Jul 2014 00:02:17 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94 #1385 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1385/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1385/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11479&quot; title=&quot;SecureConnection can&amp;#39;t be closed when SecureClient is stopping because InterruptedException won&amp;#39;t be caught in SecureClient#setupIOstreams()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11479&quot;&gt;&lt;del&gt;HBASE-11479&lt;/del&gt;&lt;/a&gt; SecureConnection can&apos;t be closed when SecureClient is stopping (cuijianwei) (apurtell: rev 24b3584a1735b5a0fcd0f25a5d3903b31901b227)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;security/src/main/java/org/apache/hadoop/hbase/ipc/SecureClient.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12654561" name="HBASE-11479-0.94-v1.patch" size="888" author="cuijianwei" created="Tue, 8 Jul 2014 10:02:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Jul 2014 10:06:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>404140</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 22 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1xjyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>404180</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>