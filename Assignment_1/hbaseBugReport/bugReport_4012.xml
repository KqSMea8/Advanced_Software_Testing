<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:15:01 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4012/HBASE-4012.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4012] Further optimize byte comparison methods</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4012</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Guava uses some clever tricks with sun.misc.Unsafe to compare byte arrays about 100% faster than the naive byte-by-byte implementation: &lt;a href=&quot;http://guava-libraries.googlecode.com/svn/trunk/guava/src/com/google/common/primitives/UnsignedBytes.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://guava-libraries.googlecode.com/svn/trunk/guava/src/com/google/common/primitives/UnsignedBytes.java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We should borrow this &lt;span class=&quot;error&quot;&gt;&amp;#91;Apache 2 licensed&amp;#93;&lt;/span&gt; code.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12511051">HBASE-4012</key>
            <summary>Further optimize byte comparison methods</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Jun 2011 08:05:03 +0000</created>
                <updated>Fri, 20 Nov 2015 11:55:41 +0000</updated>
                            <resolved>Tue, 5 Jul 2011 19:48:33 +0000</resolved>
                                    <version>0.92.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>util</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13052693" author="apurtell" created="Tue, 21 Jun 2011 17:35:21 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Byte comparison is the top hotspot for all workloads I&apos;ve profiled. Can get big wins here.&lt;/p&gt;</comment>
                            <comment id="13052698" author="stack" created="Tue, 21 Jun 2011 17:40:31 +0000"  >&lt;p&gt;I like this kinda comment:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
         * Compare 8 bytes at a time. Benchmarking shows comparing 8 bytes at a
         * time is no slower than comparing 4 bytes at a time even on 32-bit.
         * On the other hand, it is substantially faster on 64-bit.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13056301" author="yuzhihong@gmail.com" created="Tue, 28 Jun 2011 04:52:56 +0000"  >&lt;p&gt;@Todd:&lt;br/&gt;
If you don&apos;t have time, I can try coming up with a patch.&lt;/p&gt;</comment>
                            <comment id="13056356" author="tlipcon" created="Tue, 28 Jun 2011 07:13:01 +0000"  >&lt;p&gt;was figuring I might work on this on Thursday at the contributor meetup. But, if you want to take a crack, feel free.&lt;/p&gt;</comment>
                            <comment id="13056537" author="yuzhihong@gmail.com" created="Tue, 28 Jun 2011 14:34:16 +0000"  >&lt;p&gt;TestBytes passed.&lt;br/&gt;
Running test suite.&lt;/p&gt;</comment>
                            <comment id="13056595" author="yuzhihong@gmail.com" created="Tue, 28 Jun 2011 15:57:32 +0000"  >&lt;p&gt;Test suite got stuck in TestSplitTransactionOnCluster&lt;br/&gt;
There was no other test failure thus far.&lt;/p&gt;</comment>
                            <comment id="13056656" author="tlipcon" created="Tue, 28 Jun 2011 17:34:32 +0000"  >&lt;p&gt;The current implementation won&apos;t work on non-sun JVMs. Note how the guava code uses a static inner class, and then the getBestComparator code catches any exceptions thrown trying to classload it. We need to do something similar.&lt;/p&gt;</comment>
                            <comment id="13056710" author="yuzhihong@gmail.com" created="Tue, 28 Jun 2011 19:05:29 +0000"  >&lt;p&gt;Version 2 created a Comparer interface to accommodate the original compareTo() method.&lt;/p&gt;

&lt;p&gt;I verified through debugging TestBytes that UnsafeComparer was used.&lt;/p&gt;</comment>
                            <comment id="13056894" author="stack" created="Tue, 28 Jun 2011 23:46:27 +0000"  >&lt;p&gt;This looks fine to me.  +1&lt;/p&gt;</comment>
                            <comment id="13056902" author="yuzhihong@gmail.com" created="Tue, 28 Jun 2011 23:57:11 +0000"  >&lt;p&gt;Integrated to TRUNK.&lt;/p&gt;

&lt;p&gt;Thanks for the review Todd and Stack.&lt;/p&gt;</comment>
                            <comment id="13056937" author="hudson" created="Wed, 29 Jun 2011 01:25:26 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1996 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/1996/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/1996/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4012&quot; title=&quot;Further optimize byte comparison methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4012&quot;&gt;&lt;del&gt;HBASE-4012&lt;/del&gt;&lt;/a&gt; Further optimize byte comparison methods (Ted Yu)&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/Bytes.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13056969" author="stack" created="Wed, 29 Jun 2011 03:19:24 +0000"  >&lt;p&gt;Interesting.  It looks like we&apos;ve now picked up the below on build:&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

[INFO] --- maven-compiler-plugin:2.0.2:compile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-compile) @ hbase ---
[INFO] Compiling 527 source files to /home/hudson/hudson-slave/workspace/HBase-TRUNK/trunk/target/classes
[WARNING] /home/hudson/hudson-slave/workspace/HBase-TRUNK/trunk/src/main/java/org/apache/hadoop/hbase/util/Bytes.java:[44,15] sun.misc.Unsafe is Sun proprietary API and may be removed in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release

[WARNING] /home/hudson/hudson-slave/workspace/HBase-TRUNK/trunk/src/main/java/org/apache/hadoop/hbase/util/Bytes.java:[1037,19] sun.misc.Unsafe is Sun proprietary API and may be removed in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release

[WARNING] /home/hudson/hudson-slave/workspace/HBase-TRUNK/trunk/src/main/java/org/apache/hadoop/hbase/util/Bytes.java:[1043,21] sun.misc.Unsafe is Sun proprietary API and may be removed in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release

[WARNING] /home/hudson/hudson-slave/workspace/HBase-TRUNK/trunk/src/main/java/org/apache/hadoop/hbase/util/Bytes.java:[1048,28] sun.misc.Unsafe is Sun proprietary API and may be removed in a &lt;span class=&quot;code-keyword&quot;&gt;future&lt;/span&gt; release

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13057578" author="yuzhihong@gmail.com" created="Thu, 30 Jun 2011 02:15:14 +0000"  >&lt;p&gt;I don&apos;t think there is a way to suppress the warning:&lt;br/&gt;
&lt;a href=&quot;http://webcache.googleusercontent.com/search?q=cache:UBSRBVvlv6AJ:bugs.sun.com/bugdatabase/view_bug.do%3Fbug_id%3D6476630+suppress+is+Sun+proprietary+API+and&amp;amp;cd=1&amp;amp;hl=en&amp;amp;ct=clnk&amp;amp;gl=us&amp;amp;client=firefox-a&amp;amp;source=www.google.com&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://webcache.googleusercontent.com/search?q=cache:UBSRBVvlv6AJ:bugs.sun.com/bugdatabase/view_bug.do%3Fbug_id%3D6476630+suppress+is+Sun+proprietary+API+and&amp;amp;cd=1&amp;amp;hl=en&amp;amp;ct=clnk&amp;amp;gl=us&amp;amp;client=firefox-a&amp;amp;source=www.google.com&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13057709" author="eric@apache.org" created="Thu, 30 Jun 2011 09:21:58 +0000"  >&lt;p&gt;sun.msc.Unsafe is still in jdk7 (&lt;a href=&quot;http://hg.openjdk.java.net/jdk7/jdk7/jdk/file/tip/src/share/classes/sun/misc/Unsafe.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hg.openjdk.java.net/jdk7/jdk7/jdk/file/tip/src/share/classes/sun/misc/Unsafe.java&lt;/a&gt;)&lt;br/&gt;
I tried to build hbase trunk with JDK build 1.7.0-ea-b143, and it&apos;s OK.&lt;/p&gt;

&lt;p&gt;There&apos;s always a risk it will be renamed one day &quot;oracle.msc.Unsafe&quot;...&lt;br/&gt;
I also remember my surprise going from JDK1.4 to JDK1.5 and having a sun class related to encoding simply being removed, although I had been warned.&lt;/p&gt;

&lt;p&gt;Are there any metric tests that give indication on performance gain?&lt;/p&gt;</comment>
                            <comment id="13058875" author="stack" created="Fri, 1 Jul 2011 23:51:17 +0000"  >&lt;p&gt;@Ted The comments in that issue are kinda funny.  They are fine.  I was just pointing them out.&lt;/p&gt;

&lt;p&gt;@Eric Thanks for checking Unsafe is still in 1.7 (ugh, oracle.* is inevitable I&apos;d say).&lt;/p&gt;</comment>
                            <comment id="13089228" author="hudson" created="Tue, 23 Aug 2011 02:40:01 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2131 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2131/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2131/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4239&quot; title=&quot;HBASE-4012 introduced duplicate variable Bytes.LONG_BYTES&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4239&quot;&gt;&lt;del&gt;HBASE-4239&lt;/del&gt;&lt;/a&gt;  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4012&quot; title=&quot;Further optimize byte comparison methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4012&quot;&gt;&lt;del&gt;HBASE-4012&lt;/del&gt;&lt;/a&gt; introduced duplicate variable Bytes.LONG_BYTES&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/Bytes.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13935878" author="manukranthk" created="Sat, 15 Mar 2014 00:25:56 +0000"  >&lt;p&gt;I know that this Jira was long closed. I stumbled upon this and realized that we don&apos;t have it in 0.89-fb. Is it possible to have a regression in some cases. I tried to benchmark some scenarios where the comparisions are done on byte arrays with common prefixes. I found that as we the&lt;/p&gt;

&lt;p&gt;Prefix : 50, gain : 30.949085592296317 &lt;br/&gt;
Prefix : 45, gain : 29.72626255629741 &lt;br/&gt;
Prefix : 40, gain : 26.434751984314396 &lt;br/&gt;
Prefix : 35, gain : 24.259677810557402 &lt;br/&gt;
Prefix : 30, gain : 22.717778496708313 &lt;br/&gt;
Prefix : 25, gain : 14.16316408302645 &lt;br/&gt;
Prefix : 20, gain : 8.768630290777425 &lt;br/&gt;
Prefix : 15, gain : 1.2726417069570561 &lt;br/&gt;
Prefix : 10, gain : -17.46894837698785 &lt;br/&gt;
Prefix : 5, gain : -34.9383386755005 &lt;br/&gt;
Prefix : 0, gain : -117.8493223109523 &lt;/p&gt;

&lt;p&gt;In most of the cases we will have considerable amount of data in each row key, So, the KVComparator.compareRows will mostly return 0, so this should help the cause. But did anyone see a regression by switching to this?&lt;/p&gt;</comment>
                            <comment id="13935977" author="stack" created="Sat, 15 Mar 2014 04:19:56 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=manukranthk&quot; class=&quot;user-hover&quot; rel=&quot;manukranthk&quot;&gt;Manukranth Kolloju&lt;/a&gt; How do I read the above?  If the keys have the first 50 bytes in common, then guava compare is 30% faster?  If &amp;lt;10 characters in common, it is slower?  Thanks.&lt;/p&gt;</comment>
                            <comment id="13935995" author="lhofhansl" created="Sat, 15 Mar 2014 05:10:46 +0000"  >&lt;p&gt;I did some - entirely unscientific - tests on this a while ago, and in my scenarios there was no measurable difference between the two implementations (naive byte[] compare and the unsafe code).&lt;/p&gt;</comment>
                            <comment id="13936041" author="manukranthk" created="Sat, 15 Mar 2014 07:00:23 +0000"  >&lt;p&gt;Yes, In the above paste, prefix ~ Common prefix. The actual rows can be arbitrarily long. It is reasonable to have very good performance in case of long prefixes. But I was curious if someone else also did study the short prefixes case. Especially where the common prefix was comparable to length of long. I was groping to see parity in those cases but instead there was a regression. As far as my simple benchmarks show. &lt;/p&gt;</comment>
                            <comment id="13938275" author="manukranthk" created="Mon, 17 Mar 2014 19:38:40 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;... I was hoping* to see parity ...&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13938327" author="stack" created="Mon, 17 Mar 2014 20:23:55 +0000"  >&lt;p&gt;Sounds like this is worth a bit of retesting given &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=manukranthk&quot; class=&quot;user-hover&quot; rel=&quot;manukranthk&quot;&gt;Manukranth Kolloju&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; findings.&lt;/p&gt;</comment>
                            <comment id="13938330" author="stack" created="Mon, 17 Mar 2014 20:26:48 +0000"  >&lt;p&gt;I made &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10775&quot; title=&quot;Revisit the HBASE-4012 byte comprare optimization&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10775&quot;&gt;HBASE-10775&lt;/a&gt; to look at this again.&lt;/p&gt;</comment>
                            <comment id="13938353" author="lhofhansl" created="Mon, 17 Mar 2014 20:42:07 +0000"  >&lt;p&gt;If &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=manukranthk&quot; class=&quot;user-hover&quot; rel=&quot;manukranthk&quot;&gt;Manukranth Kolloju&lt;/a&gt;&apos;s results are right I would expect the unsafe comparisons to be more efficient with many columns and/or versions, and potentially detrimental otherwise.&lt;/p&gt;</comment>
                            <comment id="13938390" author="stack" created="Mon, 17 Mar 2014 21:14:36 +0000"  >&lt;p&gt;It is as though we should compare first 5 bytes with old method and if any over, then filp to Unsafe.&lt;/p&gt;</comment>
                            <comment id="15016546" author="lars_francke" created="Fri, 20 Nov 2015 11:55:41 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12527984">HADOOP-7761</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12484497" name="4012-v2.txt" size="10763" author="yuzhihong@gmail.com" created="Tue, 28 Jun 2011 20:41:27 +0000"/>
                            <attachment id="12484449" name="4012.txt" size="4328" author="yuzhihong@gmail.com" created="Tue, 28 Jun 2011 14:34:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 21 Jun 2011 17:35:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33323</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hoyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101307</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>