<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:34:52 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6224/HBASE-6224.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6224] add Pre and Post coprocessor hooks for BulkLoad</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6224</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description></description>
                <environment></environment>
        <key id="12593986">HBASE-6224</key>
            <summary>add Pre and Post coprocessor hooks for BulkLoad</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12544698">HBASE-5498</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="toffer">Francis Liu</assignee>
                                    <reporter username="toffer">Francis Liu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 18 Jun 2012 01:42:00 +0000</created>
                <updated>Tue, 26 Feb 2013 08:15:49 +0000</updated>
                            <resolved>Sat, 23 Jun 2012 01:54:47 +0000</resolved>
                                    <version>0.94.1</version>
                    <version>0.95.2</version>
                                    <fixVersion>0.94.1</fixVersion>
                    <fixVersion>0.95.0</fixVersion>
                                    <component>Coprocessors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13393643" author="toffer" created="Mon, 18 Jun 2012 01:45:35 +0000"  >&lt;p&gt;After a discussion with Andy during the HBase BOF. I simplified the signature to just pass the CF-Path pair and let the user create the StoreFile instance if he needs to. I&apos;ve also added a post hook.&lt;/p&gt;</comment>
                            <comment id="13397918" author="apurtell" created="Wed, 20 Jun 2012 21:55:40 +0000"  >&lt;p&gt;This is the patch on &lt;a href=&quot;https://reviews.apache.org/r/5380/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/5380/&lt;/a&gt; right? &lt;/p&gt;

&lt;p&gt;&lt;del&gt;+1 if so.&lt;/del&gt;&lt;/p&gt;

&lt;p&gt;Edit: Found issues on re-review.&lt;/p&gt;</comment>
                            <comment id="13398037" author="apurtell" created="Thu, 21 Jun 2012 01:03:37 +0000"  >&lt;p&gt;Attached patch that addresses my re-review comments. &lt;/p&gt;

&lt;p&gt;Here&apos;s the functional difference:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java
===================================================================
--- hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java	(revision 1352336)
+++ hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java	(working copy)
@@ -3122,10 +3122,20 @@
       HRegion region = getRegion(request.getRegion());
       List&amp;lt;Pair&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;&amp;gt; familyPaths = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;Pair&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;&amp;gt;();
       &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (FamilyPath familyPath: request.getFamilyPathList()) {
-        familyPaths.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Pair&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;(
-          familyPath.getFamily().toByteArray(), familyPath.getPath()));
+        familyPaths.add(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Pair&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;(familyPath.getFamily().toByteArray(),
+          familyPath.getPath()));
       }
-      &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; loaded = region.bulkLoadHFiles(familyPaths);
+      &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; bypass = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (region.getCoprocessorHost() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+        bypass = region.getCoprocessorHost().preBulkLoadHFile(familyPaths);
+      }
+      &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; loaded = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!bypass) {
+        loaded = region.bulkLoadHFiles(familyPaths);
+      }
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (region.getCoprocessorHost() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+        loaded = region.getCoprocessorHost().postBulkLoadHFile(familyPaths, loaded);
+      }
       BulkLoadHFileResponse.Builder builder = BulkLoadHFileResponse.newBuilder();
       builder.setLoaded(loaded);
       &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; builder.build();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13398044" author="apurtell" created="Thu, 21 Jun 2012 01:11:00 +0000"  >&lt;p&gt;@Francis, if you are agreeable to my modifications to your patch, we can commit this.&lt;/p&gt;</comment>
                            <comment id="13399616" author="toffer" created="Fri, 22 Jun 2012 21:25:13 +0000"  >&lt;p&gt;@Andy, looks good to me. Good catch on the bypass and loaded. Should I come up with another patch?&lt;/p&gt;</comment>
                            <comment id="13399625" author="apurtell" created="Fri, 22 Jun 2012 21:35:32 +0000"  >&lt;p&gt;@Francis, not unless you want to add more. Otherwise I&apos;ll commit the -apurtell patch in a few hours. Thanks for the ltgm.&lt;/p&gt;</comment>
                            <comment id="13399641" author="stack" created="Fri, 22 Jun 2012 21:54:27 +0000"  >&lt;p&gt;Patch looks good.  Its a pity StoreFile has to be made public but at list its limited private.  Fix this on commit:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @param familyPaths family and path pairs to be bulk loaded
+   * @param hasLoaded whether load was successful or not
+   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;
+   * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
+   */
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Add something for return since this is a class that will be implemented (Maybe say what the pair Paths are too?  StoreFiles?)&lt;/p&gt;

&lt;p&gt;Else lgtm.  +1&lt;/p&gt;
</comment>
                            <comment id="13399650" author="apurtell" created="Fri, 22 Jun 2012 22:03:24 +0000"  >&lt;p&gt;@stack Ok. &lt;/p&gt;</comment>
                            <comment id="13399696" author="toffer" created="Fri, 22 Jun 2012 22:57:47 +0000"  >&lt;p&gt;@Andy, nope nothing to add. BTW can we backport this to 0.94 and 0.92? We&apos;re still mulling over wether to pickup 0.92 or 0.94. Though it would be good to get bulkload security covered in the current stable release anyway?&lt;/p&gt;</comment>
                            <comment id="13399715" author="apurtell" created="Fri, 22 Jun 2012 23:30:00 +0000"  >&lt;p&gt;@Francis These hooks can go back to 0.92 IMHO, no problem there. However, we&apos;ve not been committing &quot;AccessController v2&quot; changes to 0.92, only 0.94 and trunk. Seems prudent to leave 0.92 as &quot;AccessController v1&quot;. Therefore I&apos;d recommend you pick up 0.94.&lt;/p&gt;</comment>
                            <comment id="13399770" author="toffer" created="Sat, 23 Jun 2012 01:01:59 +0000"  >&lt;p&gt;Is &quot;AccessController v2&quot; already in a usable state in 0.94? If not what are the patches that need to go in?&lt;/p&gt;</comment>
                            <comment id="13399772" author="apurtell" created="Sat, 23 Jun 2012 01:04:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;Is &quot;AccessController v2&quot; already in a usable state in 0.94? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, but it&apos;s under development (in a backwards compatible way). See umbrella issue &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6096&quot; title=&quot;AccessController v2&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6096&quot;&gt;&lt;del&gt;HBASE-6096&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13399801" author="apurtell" created="Sat, 23 Jun 2012 01:54:47 +0000"  >&lt;p&gt;Committed to trunk and 0.94 branches. Tests pass locally. Thanks for the patch Francis!&lt;/p&gt;</comment>
                            <comment id="13399817" author="hudson" created="Sat, 23 Jun 2012 03:12:12 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #274 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/274/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/274/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6224&quot; title=&quot;add Pre and Post coprocessor hooks for BulkLoad&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6224&quot;&gt;&lt;del&gt;HBASE-6224&lt;/del&gt;&lt;/a&gt;. Add pre and post coprocessor hooks for bulk load (Francis Liu) (Revision 1353060)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
apurtell : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/coprocessor/RegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/RegionCoprocessorHost.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFileScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/coprocessor/SimpleRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionObserverInterface.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13399918" author="hudson" created="Sat, 23 Jun 2012 11:46:31 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #66 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/66/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/66/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6224&quot; title=&quot;add Pre and Post coprocessor hooks for BulkLoad&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6224&quot;&gt;&lt;del&gt;HBASE-6224&lt;/del&gt;&lt;/a&gt;. Add pre and post coprocessor hooks for bulk load (Francis Liu) (Revision 1353057)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
apurtell : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/coprocessor/RegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionCoprocessorHost.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFileScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/coprocessor/SimpleRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionObserverInterface.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13400013" author="hudson" created="Sat, 23 Jun 2012 18:23:12 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #37 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/37/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/37/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6224&quot; title=&quot;add Pre and Post coprocessor hooks for BulkLoad&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6224&quot;&gt;&lt;del&gt;HBASE-6224&lt;/del&gt;&lt;/a&gt;. Add pre and post coprocessor hooks for bulk load (Francis Liu) (Revision 1353060)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
apurtell : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/coprocessor/BaseRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/coprocessor/RegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/RegionCoprocessorHost.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFileScanner.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/coprocessor/SimpleRegionObserver.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/coprocessor/TestRegionObserverInterface.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12595356">HBASE-6249</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12533145" name="HBASE-6224-apurtell-0.94.patch" size="14277" author="apurtell" created="Sat, 23 Jun 2012 01:02:13 +0000"/>
                            <attachment id="12532806" name="HBASE-6224-apurtell.patch" size="15549" author="apurtell" created="Thu, 21 Jun 2012 01:07:33 +0000"/>
                            <attachment id="12532357" name="HBASE-6224.patch" size="16126" author="toffer" created="Mon, 18 Jun 2012 01:45:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 20 Jun 2012 21:55:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>247873</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 25 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08ruv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49113</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>