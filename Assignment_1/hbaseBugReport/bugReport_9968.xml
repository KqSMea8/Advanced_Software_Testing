<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:09:16 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9968/HBASE-9968.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9968] Cluster is non operative if the RS carrying -ROOT- is expiring after deleting -ROOT- region transition znode and before adding it to online regions.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9968</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When we check whether the dead region is carrying root or meta, first we will check any transition znode for the region is there or not. In this case it got deleted. So from zookeeper we cannot find the region location. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      data = ZKAssign.getData(master.getZooKeeper(), hri.getEncodedName());
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (KeeperException e) {
      master.abort(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected ZK exception reading unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region=&quot;&lt;/span&gt;
        + hri.getEncodedName(), e);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now we will check from the AssignmentManager whether its in online regions or not&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    ServerName addressFromAM = getRegionServerOfRegion(hri);
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; matchAM = (addressFromAM != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp;
      addressFromAM.equals(serverName));
    LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;based on AM, current region=&quot;&lt;/span&gt; + hri.getRegionNameAsString() +
      &lt;span class=&quot;code-quote&quot;&gt;&quot; is on server=&quot;&lt;/span&gt; + (addressFromAM != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? addressFromAM : &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;) +
      &lt;span class=&quot;code-quote&quot;&gt;&quot; server being checked: &quot;&lt;/span&gt; + serverName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;From AM we will get null because  while adding region to online regions we will check whether the RS is in onlineservers or not and if not we will not add the region to online regions.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isServerOnline(sn)) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regions.put(regionInfo, sn);
        addToServers(sn, regionInfo);
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regions.notifyAll();
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;The server is not in online servers, ServerName=&quot;&lt;/span&gt; + 
          sn.getServerName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;, region=&quot;&lt;/span&gt; + regionInfo.getEncodedName());
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Even though the dead regionserver carrying ROOT region, its returning false. After that ROOT region never assigned.&lt;/p&gt;

&lt;p&gt;Here are the logs&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-11-11 18:04:14,730 INFO org.apache.hadoop.hbase.catalog.RootLocationEditor: Unsetting ROOT region location in ZooKeeper
2013-11-11 18:04:14,775 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: No previous transition plan was found (or we are ignoring an existing plan) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; -ROOT-,,0.70236052 so generated a random one; hri=-ROOT-,,0.70236052, src=, dest=HOST-10-18-40-69,60020,1384173244404; 1 (online=1, available=1) available servers
2013-11-11 18:04:14,809 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Assigning region -ROOT-,,0.70236052 to HOST-10-18-40-69,60020,1384173244404
2013-11-11 18:04:18,375 DEBUG org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation: Looked up root region location, connection=org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation@12133926; serverName=HOST-10-18-40-69,60020,1384173244404
2013-11-11 18:04:26,213 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_OPENED, server=HOST-10-18-40-69,60020,1384173244404, region=70236052/-ROOT-
2013-11-11 18:04:26,213 INFO org.apache.hadoop.hbase.master.handler.OpenedRegionHandler: Handling OPENED event &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; -ROOT-,,0.70236052 from HOST-10-18-40-69,60020,1384173244404; deleting unassigned node
2013-11-11 18:04:31,553 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: based on AM, current region=-ROOT-,,0.70236052 is on server=&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; server being checked: HOST-10-18-40-69,60020,1384173244404
2013-11-11 18:04:31,561 DEBUG org.apache.hadoop.hbase.master.ServerManager: Added=HOST-10-18-40-69,60020,1384173244404 to dead servers, submitted shutdown handler to be executed, root=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, meta=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-11-11 18:04:32,323 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: The znode of region -ROOT-,,0.70236052 has been deleted.
2013-11-11 18:04:32,323 INFO org.apache.hadoop.hbase.master.AssignmentManager: The server is not in online servers, ServerName=HOST-10-18-40-69,60020,1384173244404, region=70236052
2013-11-11 18:04:32,323 INFO org.apache.hadoop.hbase.master.AssignmentManager: The master has opened the region -ROOT-,,0.70236052 that was online on HOST-10-18-40-69,60020,1384173244404
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12679157">HBASE-9968</key>
            <summary>Cluster is non operative if the RS carrying -ROOT- is expiring after deleting -ROOT- region transition znode and before adding it to online regions.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="rajesh23">rajeshbabu</assignee>
                                    <reporter username="rajesh23">rajeshbabu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 14 Nov 2013 05:48:03 +0000</created>
                <updated>Wed, 16 Nov 2016 21:48:56 +0000</updated>
                            <resolved>Wed, 16 Nov 2016 21:48:55 +0000</resolved>
                                    <version>0.94.11</version>
                                                    <component>Region Assignment</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13822201" author="lhofhansl" created="Thu, 14 Nov 2013 06:19:24 +0000"  >&lt;p&gt;That sounds bad. Have a fix &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh23&quot; class=&quot;user-hover&quot; rel=&quot;rajesh23&quot;&gt;rajeshbabu&lt;/a&gt;?&lt;br/&gt;
This is only a 0.94 issue?&lt;/p&gt;</comment>
                            <comment id="13822217" author="rajesh23" created="Thu, 14 Nov 2013 06:41:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;&lt;br/&gt;
Trunk also should have this problem with meta region . Any way I will check.&lt;br/&gt;
To fix this I feel its better read from catalog tracker if we don&apos;t find the region location in AM or transition znode. I will test this and upload the patch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        ServerName addressFromCT =
            hri.isRootRegion() ? &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.catalogTracker.getRootLocation()
                : hri.isMetaRegion() ? &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.catalogTracker.getMetaLocationOrReadLocationFromRoot()
                    : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;      
        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; matchCT = (addressFromCT != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; addressFromCT.equals(serverName));
        LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;based on CT, current region=&quot;&lt;/span&gt; + hri.getRegionNameAsString() +
          &lt;span class=&quot;code-quote&quot;&gt;&quot; is on server=&quot;&lt;/span&gt; + (addressFromCT != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ? addressFromCT : &lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;&quot;&lt;/span&gt;) +
          &lt;span class=&quot;code-quote&quot;&gt;&quot; server being checked: &quot;&lt;/span&gt; + serverName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15671744" author="esteban" created="Wed, 16 Nov 2016 21:48:56 +0000"  >&lt;p&gt;We no longer have &lt;tt&gt;&lt;del&gt;ROOT&lt;/del&gt;&lt;/tt&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 14 Nov 2013 06:19:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>358522</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1psyv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>358812</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>