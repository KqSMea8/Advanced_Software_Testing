<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:44:10 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13526/HBASE-13526.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13526] TestRegionServerReportForDuty can be flaky: hang or timeout</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13526</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This test case is from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13317&quot; title=&quot;Region server reportForDuty stuck looping if there is a master change&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13317&quot;&gt;&lt;del&gt;HBASE-13317&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
The test uses a custom region server to simulate reportForDuty in a master failover case.  This custom RS would start, then the primary master would fail, then the custom RS would  reportForDuty to the second master after master failover.&lt;/p&gt;

&lt;p&gt;The test occasionally will hang or timeout.&lt;br/&gt;
The root cause is that during first master initialization, the master would assign meta (and create and assign namespace table). It is possible that the meta is assigned to the custom RS, which has started (place a rs node on the ZK), but will not really check-in and be online. Then the master will go thru multiple re-assignment, which can be lengthy and cause trouble.&lt;/p&gt;

&lt;p&gt;There are a couple of issues I see in the master assignment code:&lt;br/&gt;
1.  Master puts all the region servers obtained from ZK rs node into the online server list, including those that have not checked-in via RPC.  And we will assign meta or other regions based on whole list.&lt;br/&gt;
2. When one assign plan fails, we don&apos;t exclude the failed server when picking the next destination, which may prolong the assignment process.&lt;/p&gt;

&lt;p&gt;I will provide a patch to fix the test case.  The other issues mentioned are up to discussion.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12822800">HBASE-13526</key>
            <summary>TestRegionServerReportForDuty can be flaky: hang or timeout</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jinghe">Jerry He</assignee>
                                    <reporter username="jinghe">Jerry He</reporter>
                        <labels>
                    </labels>
                <created>Tue, 21 Apr 2015 21:17:27 +0000</created>
                <updated>Sat, 4 Jul 2015 12:30:15 +0000</updated>
                            <resolved>Thu, 23 Apr 2015 06:03:37 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.1.0</version>
                    <version>0.98.12</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.1.0</fixVersion>
                    <fixVersion>0.98.13</fixVersion>
                    <fixVersion>1.0.2</fixVersion>
                                    <component>test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14506041" author="jinghe" created="Tue, 21 Apr 2015 23:49:56 +0000"  >&lt;p&gt;Attached a patch to fix the test case.&lt;br/&gt;
The change is to start the custom RS only after the primary master has completed initialization.&lt;/p&gt;</comment>
                            <comment id="14506050" author="yuzhihong@gmail.com" created="Tue, 21 Apr 2015 23:53:28 +0000"  >&lt;p&gt;lgtm&lt;/p&gt;</comment>
                            <comment id="14506051" author="jinghe" created="Tue, 21 Apr 2015 23:53:41 +0000"  >&lt;p&gt;I have tested the patch on branch-1 and master, 30 times. No hang, no timeout.&lt;/p&gt;</comment>
                            <comment id="14507944" author="jinghe" created="Wed, 22 Apr 2015 21:29:22 +0000"  >&lt;p&gt;Re-attach to trigger a QA run.&lt;/p&gt;</comment>
                            <comment id="14508180" author="hadoopqa" created="Wed, 22 Apr 2015 23:59:38 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12727345/HBASE-13526.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12727345/HBASE-13526.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit afd7a8f4742ddbc575b45fc141a75551b55c56f5.&lt;br/&gt;
  ATTACHMENT ID: 12727345&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13781//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13781//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13781//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13781//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13781//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13781//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13781//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13781//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14508285" author="jinghe" created="Thu, 23 Apr 2015 01:46:22 +0000"  >&lt;p&gt;Will commit soon if there is no more comment.  Test case change only.&lt;/p&gt;</comment>
                            <comment id="14508559" author="hudson" created="Thu, 23 Apr 2015 06:54:14 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1.0RC0-JDK8 #4 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1.0RC0-JDK8/4/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1.0RC0-JDK8/4/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13526&quot; title=&quot;TestRegionServerReportForDuty can be flaky: hang or timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13526&quot;&gt;&lt;del&gt;HBASE-13526&lt;/del&gt;&lt;/a&gt; TestRegionServerReportForDuty can be flaky: hang or timeout (jerryjch: rev 92e689ddd8948335bb7211a5de3bc13ad7a2f7f2)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerReportForDuty.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14508578" author="hudson" created="Thu, 23 Apr 2015 07:17:54 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #17 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/17/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/17/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13526&quot; title=&quot;TestRegionServerReportForDuty can be flaky: hang or timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13526&quot;&gt;&lt;del&gt;HBASE-13526&lt;/del&gt;&lt;/a&gt; TestRegionServerReportForDuty can be flaky: hang or timeout (jerryjch: rev f1c29a83859380f284e411adc5c81c36626c7ca7)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerReportForDuty.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14508585" author="hudson" created="Thu, 23 Apr 2015 07:23:46 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.1 #424 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/424/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/424/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13526&quot; title=&quot;TestRegionServerReportForDuty can be flaky: hang or timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13526&quot;&gt;&lt;del&gt;HBASE-13526&lt;/del&gt;&lt;/a&gt; TestRegionServerReportForDuty can be flaky: hang or timeout (jerryjch: rev 92e689ddd8948335bb7211a5de3bc13ad7a2f7f2)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerReportForDuty.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14508600" author="hudson" created="Thu, 23 Apr 2015 07:33:37 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1.0RC0-JDK7 #4 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1.0RC0-JDK7/4/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1.0RC0-JDK7/4/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13526&quot; title=&quot;TestRegionServerReportForDuty can be flaky: hang or timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13526&quot;&gt;&lt;del&gt;HBASE-13526&lt;/del&gt;&lt;/a&gt; TestRegionServerReportForDuty can be flaky: hang or timeout (jerryjch: rev 92e689ddd8948335bb7211a5de3bc13ad7a2f7f2)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerReportForDuty.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14508613" author="hudson" created="Thu, 23 Apr 2015 07:51:03 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6403 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6403/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6403/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13526&quot; title=&quot;TestRegionServerReportForDuty can be flaky: hang or timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13526&quot;&gt;&lt;del&gt;HBASE-13526&lt;/del&gt;&lt;/a&gt; TestRegionServerReportForDuty can be flaky: hang or timeout (jerryjch: rev 6c427175b826ad54ccb4ca4a65b1cd9aeeb6fdc6)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerReportForDuty.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14508662" author="hudson" created="Thu, 23 Apr 2015 08:31:57 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #878 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/878/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/878/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13526&quot; title=&quot;TestRegionServerReportForDuty can be flaky: hang or timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13526&quot;&gt;&lt;del&gt;HBASE-13526&lt;/del&gt;&lt;/a&gt; TestRegionServerReportForDuty can be flaky: hang or timeout (jerryjch: rev 67b8fa8ca3c164502307251459cf3a50717be704)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerReportForDuty.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14508996" author="hudson" created="Thu, 23 Apr 2015 12:48:52 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98 #961 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/961/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/961/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13526&quot; title=&quot;TestRegionServerReportForDuty can be flaky: hang or timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13526&quot;&gt;&lt;del&gt;HBASE-13526&lt;/del&gt;&lt;/a&gt; TestRegionServerReportForDuty can be flaky: hang or timeout (jerryjch: rev 868027a50051db2e20e5fb9f2babd782793a646b)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerReportForDuty.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14509184" author="hudson" created="Thu, 23 Apr 2015 15:04:46 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #914 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/914/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/914/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13526&quot; title=&quot;TestRegionServerReportForDuty can be flaky: hang or timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13526&quot;&gt;&lt;del&gt;HBASE-13526&lt;/del&gt;&lt;/a&gt; TestRegionServerReportForDuty can be flaky: hang or timeout (jerryjch: rev 868027a50051db2e20e5fb9f2babd782793a646b)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRegionServerReportForDuty.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14571044" author="ndimiduk" created="Wed, 3 Jun 2015 15:28:31 +0000"  >&lt;p&gt;Closing issues released in 1.1.0.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12727345" name="HBASE-13526.patch" size="2425" author="jinghe" created="Wed, 22 Apr 2015 21:29:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 21 Apr 2015 23:53:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 28 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2dkan:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>