<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:17:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10829/HBASE-10829.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10829] Flush is skipped after log replay if the last recovered edits file is skipped</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10829</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We caught this in an extended test run where IntegrationTestBigLinkedList failed with some missing keys. &lt;/p&gt;

&lt;p&gt;The problem is that HRegion.replayRecoveredEdits() would return -1 if all the edits in the log file is skipped, which is true for example if the log file only contains a single compaction record (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2231&quot; title=&quot;Compaction events should be written to HLog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2231&quot;&gt;&lt;del&gt;HBASE-2231&lt;/del&gt;&lt;/a&gt;) or somehow the edits cannot be applied (column family deleted, etc). &lt;/p&gt;

&lt;p&gt;The callee, HRegion.replayRecoveredEditsIfAny() only looks for the last returned seqId to decide whether a flush is necessary or not before opening the region, and discarding replayed recovered edits files. &lt;/p&gt;

&lt;p&gt;Therefore, if the last recovered edits file is skipped but some edits from earlier recovered edits files are applied, the mandatory flush before opening the region is skipped. If the region server dies after this point before a flush, the edits are lost. &lt;/p&gt;

&lt;p&gt;This is important to fix, though the sequence of events are super rare for a production cluster. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12703544">HBASE-10829</key>
            <summary>Flush is skipped after log replay if the last recovered edits file is skipped</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enis">Enis Soztutar</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Mar 2014 18:26:09 +0000</created>
                <updated>Sat, 21 Feb 2015 23:31:42 +0000</updated>
                            <resolved>Wed, 26 Mar 2014 17:33:00 +0000</resolved>
                                                    <fixVersion>0.98.1</fixVersion>
                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>0.96.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13946911" author="enis" created="Tue, 25 Mar 2014 18:31:44 +0000"  >&lt;p&gt;Here is a log of events in case you are interested. The region (9514935e6a659bd90faa21bf458a842e) was happily hosted by some region server. After the writes have settled down, the region had some un-flushed data. The last flush happened, and after some time, the write tasks finished, so no more data was coming in for some time:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-03-24 20:54:30,924 INFO  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-22] regionserver.HRegion: Finished memstore flush of ~128.2 M/134443296, currentsize=12.7 M/13270608 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region IntegrationTestBigLinkedList,\x07\xFE\xDA\x1Chv\xF9\x7F\x18s\xEE\x0C\x85X\xFCU,1395690539958.9514935e6a659bd90faa21bf458a842e. in 7324ms, sequenceid=119978, compaction requested=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After some more time, the region decided to do a compaction. At this point no writes were coming.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
compaction
2014-03-24 20:55:52,764 INFO  [regionserver60020-smallCompactions-1395694311085] regionserver.HStore: Starting compaction of 5 file(s) in meta of IntegrationTestBigLinkedList,\x07\xFE\xDA\x1Chv\xF9\x7F\x18s\xEE\x0C\x85X\xFCU,1395690539958.9514935e6a659bd90faa21bf458a842e. into tmpdir=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/.tmp, totalSize=212.2 M&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After this compaction, but before any more flush, the region server got killed around: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-03-24 20:56:44,466 DEBUG [regionserver60020-EventThread] regionserver.SplitLogWorker: tasks arrived or departed
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Because of the region server got killed, the cluster performed a log split, which completed without any issues (logs are not necessary). This resulted in 7 log files to be split, resulting in 7 files in recovered.edits under region dir. &lt;/p&gt;

&lt;p&gt;Then, some other region server opens the region and applies the recovered edits in memory:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Open region:
2014-03-24 20:57:28,196 DEBUG [StoreOpener-9514935e6a659bd90faa21bf458a842e-1] regionserver.HStore: loaded hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/meta/02f7152afee34b07b40fa31e0de5a3de, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, isBulkLoadResult=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, seqid=119978, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
&lt;/span&gt;2014-03-24 20:57:28,240 DEBUG [StoreOpener-9514935e6a659bd90faa21bf458a842e-1] regionserver.HStore: loaded hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/meta/69260a6d4ffc45a1806dd501204b73ce, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, isBulkLoadResult=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, seqid=88532, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/span&gt;
2014-03-24 20:57:28,264 INFO  [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Replaying edits from hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000118699
&lt;/span&gt;2014-03-24 20:57:28,457 DEBUG [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Applied 0, skipped 187830, firstSequenceidInLog=118084, maxSequenceidInLog=-1, path=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000118699
&lt;/span&gt;2014-03-24 20:57:28,460 INFO  [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Replaying edits from hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000119351
&lt;/span&gt;2014-03-24 20:57:28,630 DEBUG [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Applied 0, skipped 199401, firstSequenceidInLog=118700, maxSequenceidInLog=-1, path=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000119351
&lt;/span&gt;2014-03-24 20:57:28,632 INFO  [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Replaying edits from hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000120086
&lt;/span&gt;2014-03-24 20:57:28,873 DEBUG [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Applied 37938, skipped 148185, firstSequenceidInLog=119352, maxSequenceidInLog=120086, path=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000120086
&lt;/span&gt;2014-03-24 20:57:28,876 INFO  [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Replaying edits from hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000120806
&lt;/span&gt;2014-03-24 20:57:30,130 DEBUG [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Applied 189648, skipped 0, firstSequenceidInLog=120087, maxSequenceidInLog=120806, path=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000120806
&lt;/span&gt;2014-03-24 20:57:30,133 INFO  [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Replaying edits from hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000121436
&lt;/span&gt;2014-03-24 20:57:31,622 DEBUG [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Applied 187988, skipped 0, firstSequenceidInLog=120807, maxSequenceidInLog=121436, path=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000121436
&lt;/span&gt;2014-03-24 20:57:31,625 INFO  [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Replaying edits from hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000122408
&lt;/span&gt;2014-03-24 20:57:33,850 DEBUG [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Applied 206643, skipped 0, firstSequenceidInLog=121437, maxSequenceidInLog=122408, path=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000122408
&lt;/span&gt;2014-03-24 20:57:33,860 INFO  [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Replaying edits from hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000122409
&lt;/span&gt;2014-03-24 20:57:33,864 DEBUG [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HStore: Completing compaction from the WAL marker  ====&amp;gt; we replay the compaction marker
2014-03-24 20:57:33,866 DEBUG [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Applied 0, skipped 1, firstSequenceidInLog=122409, maxSequenceidInLog=-1,  ====&amp;gt; contains only compaction record path=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000122409&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As per above, some of the edits are skipped, and the rest is applied to memstore. The latest flush file had seqId=119978, and we were able to replay up to seqId=122409. However notice that the final log file contains ONLY a compaction record! This record has the seqId, but we still return -1 to the caller. This results in the region skipping the mandatory memstore flush BEFORE opening the region for writes and deleting the log files: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
  seqid = replayRecoveredEdits(edits, maxSeqIdInStores, reporter);
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
}
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (seqid &amp;gt; minSeqIdForTheRegion) {
  &lt;span class=&quot;code-comment&quot;&gt;// Then we added some edits to memory. Flush and cleanup split edit files.
&lt;/span&gt;  internalFlushcache(&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, seqid, status);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, the region is opened without the flush, and we also delete the recovered.edit logs thinking that we made the edits durable: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-03-24 20:57:33,893 DEBUG [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Deleted recovered.edits file=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000118699
&lt;/span&gt;2014-03-24 20:57:33,983 DEBUG [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Deleted recovered.edits file=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hor9n01.gq1.ygridcore.net:8020/apps/hbase/data/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/IntegrationTestBigLinkedList/9514935e6a659bd90faa21bf458a842e/recovered.edits/0000000000000119351
&lt;/span&gt;2014-03-24 20:57:34,110 INFO  [RS_OPEN_REGION-hor9n08:60020-2] regionserver.HRegion: Onlined 9514935e6a659bd90faa21bf458a842e; next sequenceid=119979  ====&amp;gt; NO FLUSH
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Notice the lack of flush above. Since the CM is still running, now this region server is killed before a flush happens in this region, resulting in data loss on the in memory data. Since recovered.edits files are also deleted, there is no recovery back. &lt;/p&gt;

&lt;p&gt;Thanks to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=devaraj&quot; class=&quot;user-hover&quot; rel=&quot;devaraj&quot;&gt;Devaraj Das&lt;/a&gt; for pair-debugging this issue. &lt;/p&gt;</comment>
                            <comment id="13946930" author="enis" created="Tue, 25 Mar 2014 18:41:56 +0000"  >&lt;p&gt;Attaching a patch which fixes the return value from replayRecoveredEdits() and replayRecoveredEditsIfAny() now choses the max value. &lt;/p&gt;</comment>
                            <comment id="13947004" author="yuzhihong@gmail.com" created="Tue, 25 Mar 2014 19:17:32 +0000"  >&lt;p&gt;lgtm&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testSkipRecoveredEditsReplayTheLastFileIgnored() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
+    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; method = &lt;span class=&quot;code-quote&quot;&gt;&quot;testSkipRecoveredEditsReplaySomeIgnored&quot;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;nit: method name should match test name.&lt;/p&gt;</comment>
                            <comment id="13947019" author="enis" created="Tue, 25 Mar 2014 19:26:09 +0000"  >&lt;p&gt;Thanks Ted for review. v2 fixes test name. &lt;/p&gt;</comment>
                            <comment id="13947036" author="yuzhihong@gmail.com" created="Tue, 25 Mar 2014 19:36:19 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13947053" author="yuzhihong@gmail.com" created="Tue, 25 Mar 2014 19:46:11 +0000"  >&lt;p&gt;Spoke too soon &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:2.5.1:testCompile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-testCompile) on project hbase-server: Compilation failure: Compilation failure:
[ERROR] /homes/hortonzy/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java:[583,49] error: cannot find symbol
[ERROR] symbol:   variable conf
[ERROR] location: class TestHRegion
[ERROR] /homes/hortonzy/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java:[600,88] error: cannot find symbol
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13947217" author="hadoopqa" created="Tue, 25 Mar 2014 21:55:24 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12636761/hbase-10829_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12636761/hbase-10829_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12636761&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javac&lt;/font&gt;.  The patch appears to cause mvn compile goal to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to cause Findbugs (version 1.3.9) to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9093//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9093//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9093//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9093//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13947222" author="stack" created="Tue, 25 Mar 2014 21:57:57 +0000"  >&lt;p&gt;Nice debugging lads.  Patch lgtm&lt;/p&gt;</comment>
                            <comment id="13947300" author="enis" created="Tue, 25 Mar 2014 22:50:20 +0000"  >&lt;p&gt;Thanks for reviews. Will commit v3 to all branches if qa passes. &lt;/p&gt;</comment>
                            <comment id="13947407" author="hadoopqa" created="Wed, 26 Mar 2014 00:53:12 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12636804/hbase-10829_v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12636804/hbase-10829_v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12636804&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 6 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.regionserver.wal.TestLogRolling.testLogRollOnDatanodeDeath(TestLogRolling.java:368)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9094//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13948185" author="enis" created="Wed, 26 Mar 2014 17:33:00 +0000"  >&lt;p&gt;Committed this to 0.99, 0.98 and 0.96. Thanks for reviews. &lt;/p&gt;</comment>
                            <comment id="13948378" author="hudson" created="Wed, 26 Mar 2014 20:02:56 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #5042 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5042/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5042/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10829&quot; title=&quot;Flush is skipped after log replay if the last recovered edits file is skipped&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10829&quot;&gt;&lt;del&gt;HBASE-10829&lt;/del&gt;&lt;/a&gt; Flush is skipped after log replay if the last recovered edits file is skipped (enis: rev 1581947)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13948447" author="hudson" created="Wed, 26 Mar 2014 20:55:36 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #236 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/236/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/236/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10829&quot; title=&quot;Flush is skipped after log replay if the last recovered edits file is skipped&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10829&quot;&gt;&lt;del&gt;HBASE-10829&lt;/del&gt;&lt;/a&gt; Flush is skipped after log replay if the last recovered edits file is skipped (enis: rev 1581954)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13948789" author="hudson" created="Thu, 27 Mar 2014 02:28:52 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96-hadoop2 #253 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96-hadoop2/253/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96-hadoop2/253/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10829&quot; title=&quot;Flush is skipped after log replay if the last recovered edits file is skipped&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10829&quot;&gt;&lt;del&gt;HBASE-10829&lt;/del&gt;&lt;/a&gt; Flush is skipped after log replay if the last recovered edits file is skipped (enis: rev 1581957)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13949262" author="hudson" created="Thu, 27 Mar 2014 13:00:06 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.96 #369 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/369/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/369/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10829&quot; title=&quot;Flush is skipped after log replay if the last recovered edits file is skipped&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10829&quot;&gt;&lt;del&gt;HBASE-10829&lt;/del&gt;&lt;/a&gt; Flush is skipped after log replay if the last recovered edits file is skipped (enis: rev 1581957)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13949704" author="hudson" created="Thu, 27 Mar 2014 17:51:02 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #253 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/253/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/253/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10829&quot; title=&quot;Flush is skipped after log replay if the last recovered edits file is skipped&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10829&quot;&gt;&lt;del&gt;HBASE-10829&lt;/del&gt;&lt;/a&gt; Flush is skipped after log replay if the last recovered edits file is skipped (enis: rev 1581954)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13965680" author="clehene" created="Thu, 10 Apr 2014 18:46:32 +0000"  >&lt;p&gt;I can&apos;t find this issue in the 0.98.1 release notes. Perhaps fix version should be 0.98.2?&lt;/p&gt;</comment>
                            <comment id="14330859" author="enis" created="Sat, 21 Feb 2015 23:31:42 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12636749" name="hbase-10829_v1.patch" size="5175" author="enis" created="Tue, 25 Mar 2014 18:41:56 +0000"/>
                            <attachment id="12636761" name="hbase-10829_v2.patch" size="5182" author="enis" created="Tue, 25 Mar 2014 19:26:09 +0000"/>
                            <attachment id="12636804" name="hbase-10829_v3.patch" size="6623" author="enis" created="Tue, 25 Mar 2014 22:50:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 25 Mar 2014 19:17:32 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>381878</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tskf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382153</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>