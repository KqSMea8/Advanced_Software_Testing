<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:32:12 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5926/HBASE-5926.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5926] Delete the master znode after a master crash</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5926</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This is the continuation of the work done in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5844&quot; title=&quot;Delete the region servers znode after a regions server crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5844&quot;&gt;&lt;del&gt;HBASE-5844&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
But we can&apos;t apply exactly the same strategy: for the region server, there is a znode per region server, while for the master &amp;amp; backup master there is a single znode for both.&lt;/p&gt;

&lt;p&gt;So if we apply the same strategy as for a regionserver, we may have this scenario:&lt;br/&gt;
1) Master starts&lt;br/&gt;
2) Backup master starts&lt;br/&gt;
3) Master dies&lt;br/&gt;
4) ZK detects it&lt;br/&gt;
5) Backup master receives the update from ZK&lt;br/&gt;
6) Backup master creates the new master node and become the main master&lt;br/&gt;
7) Previous master script continues&lt;br/&gt;
8) Previous master script deletes the master node in ZK&lt;br/&gt;
9) =&amp;gt; issue: we deleted the node just created by the new master&lt;/p&gt;

&lt;p&gt;This should not happen often (usually the znode will be deleted soon enough), but it can happen.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12553765">HBASE-5926</key>
            <summary>Delete the master znode after a master crash</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkeywal">Nicolas Liochon</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 May 2012 14:23:31 +0000</created>
                <updated>Mon, 23 Sep 2013 18:30:25 +0000</updated>
                            <resolved>Fri, 18 May 2012 17:44:41 +0000</resolved>
                                    <version>0.95.2</version>
                                    <fixVersion>0.95.0</fixVersion>
                                    <component>master</component>
                    <component>scripts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13277172" author="nkeywal" created="Wed, 16 May 2012 21:41:05 +0000"  >&lt;p&gt;the race condition is decreased to a production-acceptable minimum imho. We do a compare &amp;amp; delete in the java code, so the race condition is now: between the comparison and the delete, we fail if, and only if: the session expires and the master node is deleted and the master backup recreates the node. That&apos;s unlikely. &lt;/p&gt;</comment>
                            <comment id="13277180" author="zhihyu@ebaysf.com" created="Wed, 16 May 2012 21:49:51 +0000"  >&lt;p&gt;I cannot find CleanZnode class in the patch.&lt;/p&gt;</comment>
                            <comment id="13277190" author="zhihyu@ebaysf.com" created="Wed, 16 May 2012 22:00:56 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-quote&quot;&gt;&quot;Usage: Master [opts] start|stop|cleanZNode\n&quot;&lt;/span&gt; +
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please add document for cleanZNode command.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * delete the znode master &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; its content is same to the parameter
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;znode master&apos; -&amp;gt; &apos;master znode&apos;, &apos;same to&apos; -&amp;gt; &apos;same as&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (KeeperException ignore) {
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ignore) {
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I would expect some logging for above cases.&lt;/p&gt;</comment>
                            <comment id="13277684" author="nkeywal" created="Thu, 17 May 2012 09:12:52 +0000"  >&lt;p&gt;v8. with Ted&apos;s comments taken into account.&lt;/p&gt;</comment>
                            <comment id="13277696" author="hadoopqa" created="Thu, 17 May 2012 10:01:09 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12527816/5926.v8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12527816/5926.v8.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 33 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestSplitTransactionOnCluster&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1909//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1909//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1909//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1909//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1909//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1909//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13277702" author="nkeywal" created="Thu, 17 May 2012 10:15:38 +0000"  >&lt;p&gt;These tests run ok locally.&lt;/p&gt;</comment>
                            <comment id="13277971" author="zhihyu@ebaysf.com" created="Thu, 17 May 2012 17:00:33 +0000"  >&lt;p&gt;Please add javadoc for the new class:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class CleanZnode {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;readMyEphemeralNodeOnDisk() throws IOException but writeMyEphemeralNodeOnDisk() doesn&apos;t. What was the reason ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * Get the name of the file used to store the znode
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please add &apos; contents&apos; at the end of the above.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; cleanZNode(Configuration conf) {
+    conf.setInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;zookeeper.recovery.retry&quot;&lt;/span&gt;, 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should the setting be restored before exiting the above method ?&lt;/p&gt;</comment>
                            <comment id="13277996" author="nkeywal" created="Thu, 17 May 2012 17:23:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;javadoc&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;readMyEphemeralNodeOnDisk() throws IOException but writeMyEphemeralNodeOnDisk() doesn&apos;t. What was the reason ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;When we write we ignore the results (i.e. we don&apos;t stop the master or the region server if we can&apos;t store the znode, we just continue). When we read, we&apos;re interested in the exception: the pattern in HMasterCommandLine is to return -1 on error.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Please add &apos; contents&apos; at the end of the above.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;ok.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Should the setting be restored before exiting the above method ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I now clone the conf.&lt;/p&gt;</comment>
                            <comment id="13277997" author="zhihyu@ebaysf.com" created="Thu, 17 May 2012 17:27:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;I now clone the conf.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That is safer, avoiding race condition w.r.t. the original conf.&lt;/p&gt;</comment>
                            <comment id="13278052" author="hadoopqa" created="Thu, 17 May 2012 18:17:25 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12527860/5926.v9.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12527860/5926.v9.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 33 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1912//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1912//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1912//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1912//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1912//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1912//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13278065" author="zhihyu@ebaysf.com" created="Thu, 17 May 2012 18:28:01 +0000"  >&lt;p&gt;@Stack:&lt;br/&gt;
Can you comment on the latest patch ?&lt;/p&gt;</comment>
                            <comment id="13278078" author="stack" created="Thu, 17 May 2012 18:43:01 +0000"  >&lt;p&gt;CleanZNode should be in the tool package or in zookeeper (probably the latter since thats its dependencies)  ... hmmm.. but hangon, I see why you have it here... because its used by master and regionserver packages.  Thats fine.  Its in the right place I&apos;d say.&lt;/p&gt;

&lt;p&gt;You should look at the javadoc that is created from your src.  Its going to be a jumble.  Check it out.  You need a little bit of html in there at least for your list of strategy dependencies.&lt;/p&gt;

&lt;p&gt;What is the filecontent?  We don&apos;t need any, right?  The name of the file is enough?&lt;/p&gt;

&lt;p&gt;This should be boolean rather than int?  Or is it returned to shell?  If so, should say so in the comment: &quot;+   * @return if done returns 0 else -1.&quot;&lt;/p&gt;

&lt;p&gt;Is CleanZNode a good name?  How about ZNodeCleaner or ZNodeClearer or CrashZNodeCleaner?&lt;/p&gt;

&lt;p&gt;I think in HMasterCommandLine, should be start|stop|clear so it fits format of the other commands.&lt;/p&gt;

&lt;p&gt;In MasterAddressTracker, can you get the znode sequence id and only delete if the sequence id  matches?&lt;/p&gt;</comment>
                            <comment id="13278147" author="nkeywal" created="Thu, 17 May 2012 19:37:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;You should look at the javadoc that is created from your src. Its going to be a jumble. Check it out. You need a little bit of html in there at least for your list of strategy dependencies.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What is the filecontent? We don&apos;t need any, right? The name of the file is enough?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We need the content. For the regionserver, the content is the znode path. For the master it&apos;s the full ServerName (stringified).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This should be boolean rather than int? Or is it returned to shell? If so, should say so in the comment: &quot;+ * @return if done returns 0 else -1.&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is CleanZNode a good name? How about ZNodeCleaner or ZNodeClearer or CrashZNodeCleaner?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Renamed to ZNodeClearer &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think in HMasterCommandLine, should be start|stop|clear so it fits format of the other commands.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;In MasterAddressTracker, can you get the znode sequence id and only delete if the sequence id matches?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We store the full ServerName so if there is a restart we will see it. But maybe you&apos;re speaking about the znode version? Because I looked at the zk api, and with the version we could remove totally the race condition...&lt;/p&gt;</comment>
                            <comment id="13278180" author="stack" created="Thu, 17 May 2012 19:59:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;We need the content. For the regionserver, the content is the znode path. For the master it&apos;s the full ServerName (stringified).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Does it have to be full path?  Can it not just be the node name?  Thats safe to put in the fs?  Master servername stringified should be safe in the fs too.&lt;/p&gt;

&lt;p&gt;Yeah, version.&lt;/p&gt;</comment>
                            <comment id="13278259" author="nkeywal" created="Thu, 17 May 2012 21:00:35 +0000"  >&lt;p&gt;Yes, it could be the node name only. Does it make a difference? To me, they can both be safely written in the fs.&lt;br/&gt;
I check the version in v11, so there is no race condition at all now.&lt;/p&gt;</comment>
                            <comment id="13278305" author="zhihyu@ebaysf.com" created="Thu, 17 May 2012 21:45:54 +0000"  >&lt;p&gt;@N:&lt;br/&gt;
Did you forget to include ZNodeClearer class in the latest patch ?&lt;/p&gt;</comment>
                            <comment id="13278312" author="zhihyu@ebaysf.com" created="Thu, 17 May 2012 21:48:39 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (KeeperException e) {
+      LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Can&apos;t get or delete the master znode&quot;&lt;/span&gt;, e);
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (DeserializationException e) {
+      LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Can&apos;t get or delete the master znode&quot;&lt;/span&gt;, e);
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think the above log should be at WARN level.&lt;/p&gt;</comment>
                            <comment id="13278342" author="stack" created="Thu, 17 May 2012 22:21:11 +0000"  >&lt;p&gt;Its fine putting it in file.  And what Ted said.  Thanks N.&lt;/p&gt;</comment>
                            <comment id="13278654" author="nkeywal" created="Fri, 18 May 2012 09:06:10 +0000"  >&lt;p&gt;v13 should do it...&lt;/p&gt;</comment>
                            <comment id="13278682" author="hadoopqa" created="Fri, 18 May 2012 09:58:33 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12528018/5926.v13.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12528018/5926.v13.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 33 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestSplitTransactionOnCluster&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1927//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1927//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1927//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1927//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1927//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1927//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13278919" author="nkeywal" created="Fri, 18 May 2012 16:21:23 +0000"  >&lt;p&gt;I think it&apos;s ok, I don&apos;t have this locally...&lt;/p&gt;</comment>
                            <comment id="13278967" author="zhihyu@ebaysf.com" created="Fri, 18 May 2012 17:04:51 +0000"  >&lt;p&gt;Minor comments:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ * servers. It allows to delete immediately the znode when the master or the regions server crash.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;regions server crash&apos; -&amp;gt; &apos;region server crashes&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ * The region server / master write a specific file when they start / become main master. When they
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;write a specific&apos; -&amp;gt; &apos;writes a specific&apos;. &apos;they start / become&apos; -&amp;gt; &apos;it starts / becomes&apos;&lt;br/&gt;
I think using &apos;they&apos; is confusing because region server and master have different roles.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-quote&quot;&gt;&quot; clear  Delete the master znode in ZooKeeper after a master crash\n &quot;&lt;/span&gt;+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;master crash&apos; -&amp;gt; &apos;master crashes&apos;&lt;/p&gt;</comment>
                            <comment id="13279000" author="stack" created="Fri, 18 May 2012 17:38:51 +0000"  >&lt;p&gt;+1 on patch v14&lt;/p&gt;</comment>
                            <comment id="13279005" author="stack" created="Fri, 18 May 2012 17:41:23 +0000"  >&lt;p&gt;I&apos;ll fix Ted comments on commit.&lt;/p&gt;</comment>
                            <comment id="13279008" author="stack" created="Fri, 18 May 2012 17:44:41 +0000"  >&lt;p&gt;Looks like N already addressed Ted&apos;s review comments.  Great.&lt;/p&gt;

&lt;p&gt;Applied to trunk.  Thanks for the patch N.&lt;/p&gt;</comment>
                            <comment id="13279031" author="hudson" created="Fri, 18 May 2012 18:08:59 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2899 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2899/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2899/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5926&quot; title=&quot;Delete the master znode after a master crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5926&quot;&gt;&lt;del&gt;HBASE-5926&lt;/del&gt;&lt;/a&gt; Delete the master znode after a master crash (Revision 1340185)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/bin/hbase-daemon.sh&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMasterCommandLine.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterAddressTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperNodeTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13279040" author="zhihyu@ebaysf.com" created="Fri, 18 May 2012 18:16:27 +0000"  >&lt;p&gt;ZNodeClearer.java isn&apos;t in source repo.&lt;/p&gt;</comment>
                            <comment id="13279042" author="hadoopqa" created="Fri, 18 May 2012 18:16:37 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12528104/5926.v14.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12528104/5926.v14.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 33 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1933//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1933//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1933//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1933//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1933//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1933//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13279048" author="stack" created="Fri, 18 May 2012 18:18:53 +0000"  >&lt;p&gt;Fixed.  Thanks Ted.&lt;/p&gt;</comment>
                            <comment id="13279122" author="hudson" created="Fri, 18 May 2012 19:50:54 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2900 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2900/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2900/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5926&quot; title=&quot;Delete the master znode after a master crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5926&quot;&gt;&lt;del&gt;HBASE-5926&lt;/del&gt;&lt;/a&gt; Delete the master znode after a master crash (Revision 1340200)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ZNodeClearer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13279333" author="hudson" created="Fri, 18 May 2012 23:27:02 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #10 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/10/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/10/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5926&quot; title=&quot;Delete the master znode after a master crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5926&quot;&gt;&lt;del&gt;HBASE-5926&lt;/del&gt;&lt;/a&gt; Delete the master znode after a master crash (Revision 1340200)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5926&quot; title=&quot;Delete the master znode after a master crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5926&quot;&gt;&lt;del&gt;HBASE-5926&lt;/del&gt;&lt;/a&gt; Delete the master znode after a master crash (Revision 1340185)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ZNodeClearer.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/bin/hbase-daemon.sh&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMasterCommandLine.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterAddressTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperNodeTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13506801" author="jdcryans" created="Thu, 29 Nov 2012 21:14:16 +0000"  >&lt;p&gt;This jira has the odd side-effect of printing out a lot of garbage when running in standalone and killing it with -9, gist of it being:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-11-29 13:08:27,227 WARN org.apache.hadoop.hbase.zookeeper.RecoverableZooKeeper: Possibly transient ZooKeeper exception: org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss for /hbase/master
2012-11-29 13:08:27,227 ERROR org.apache.hadoop.hbase.zookeeper.RecoverableZooKeeper: ZooKeeper getData failed after 0 retries
2012-11-29 13:08:27,227 WARN org.apache.hadoop.hbase.zookeeper.ZKUtil: clean znode for master Unable to get data of znode /hbase/master
org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss for /hbase/master
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:99)
        at org.apache.zookeeper.KeeperException.create(KeeperException.java:51)
        at org.apache.zookeeper.ZooKeeper.getData(ZooKeeper.java:1131)
        at org.apache.hadoop.hbase.zookeeper.RecoverableZooKeeper.getData(RecoverableZooKeeper.java:291)
        at org.apache.hadoop.hbase.zookeeper.ZKUtil.getDataNoWatch(ZKUtil.java:562)
        at org.apache.hadoop.hbase.zookeeper.MasterAddressTracker.deleteIfEquals(MasterAddressTracker.java:168)
        at org.apache.hadoop.hbase.ZNodeClearer.clear(ZNodeClearer.java:150)
        at org.apache.hadoop.hbase.master.HMasterCommandLine.run(HMasterCommandLine.java:110)
        at org.apache.hadoop.util.ToolRunner.run(ToolRunner.java:65)
        at org.apache.hadoop.hbase.util.ServerCommandLine.doMain(ServerCommandLine.java:78)
        at org.apache.hadoop.hbase.master.HMaster.main(HMaster.java:2298)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Basically the znode cleaner fails hard because ZK is offline.&lt;/p&gt;

&lt;p&gt;I was confused to see more logs being printed out after running the kill.&lt;/p&gt;</comment>
                            <comment id="13774951" author="stack" created="Mon, 23 Sep 2013 18:30:25 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12624557">HBASE-7386</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12551767">HBASE-5844</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12551766">HBASE-5843</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12527899" name="5926.v10.patch" size="13452" author="nkeywal" created="Thu, 17 May 2012 19:48:38 +0000"/>
                            <attachment id="12527919" name="5926.v11.patch" size="13995" author="nkeywal" created="Thu, 17 May 2012 21:01:09 +0000"/>
                            <attachment id="12528018" name="5926.v13.patch" size="19533" author="nkeywal" created="Fri, 18 May 2012 09:05:36 +0000"/>
                            <attachment id="12528104" name="5926.v14.patch" size="19538" author="nkeywal" created="Fri, 18 May 2012 17:27:35 +0000"/>
                            <attachment id="12527715" name="5926.v6.patch" size="13201" author="nkeywal" created="Wed, 16 May 2012 21:36:46 +0000"/>
                            <attachment id="12527816" name="5926.v8.patch" size="17954" author="nkeywal" created="Thu, 17 May 2012 09:12:06 +0000"/>
                            <attachment id="12527860" name="5926.v9.patch" size="18901" author="nkeywal" created="Thu, 17 May 2012 17:26:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 May 2012 21:49:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>237972</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hu9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>102165</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>