<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:01:13 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2361/HBASE-2361.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2361] WALEdit broke replication scope</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2361</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Before &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2283&quot; title=&quot;row level atomicity &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2283&quot;&gt;&lt;del&gt;HBASE-2283&lt;/del&gt;&lt;/a&gt;, each KV had a HLogKey with a replication scope. Now a key applies to a list of KVs that spans multiple families so a single scope doesn&apos;t work anymore. Multiple possible solutions:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Each KV have their own scope. We already ruled that out in a previous jira since that means the scope would end up in the HFiles.&lt;/li&gt;
	&lt;li&gt;Store pairs of scope/KV in WALEdit instead of straight KVs.&lt;/li&gt;
	&lt;li&gt;Have 2 parallel lists in WALEdit, one for KVs and the other for scopes.&lt;/li&gt;
	&lt;li&gt;Subclass KV and add the scope there, those would be created when inserted in the WAL and would contain the KV stored in the HFiles.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m sure there are other solutions, discuss.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12459903">HBASE-2361</key>
            <summary>WALEdit broke replication scope</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Mar 2010 19:28:30 +0000</created>
                <updated>Fri, 20 Nov 2015 12:44:00 +0000</updated>
                            <resolved>Tue, 30 Mar 2010 17:19:21 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="12848370" author="jdcryans" created="Mon, 22 Mar 2010 21:43:28 +0000"  >&lt;p&gt;This patch implements the third solution. It adds a new list for scopes which by default is set to local. It also optimizes reading the fields so that we only set the size of each list to what&apos;s needed.&lt;/p&gt;</comment>
                            <comment id="12848404" author="stack" created="Mon, 22 Mar 2010 22:31:57 +0000"  >&lt;p&gt;Patch looks good.  Option #3 seems fine in above.&lt;/p&gt;

&lt;p&gt;+ Would it be worthwhile making the &quot;optimization&quot; that if no replication config, do not create a scopes List?  Or would this make things a little involved?&lt;br/&gt;
+ REPLICATION_SCOPE_LOCAL should be in HLog rather than in HConstants?  Is it ever used outside of HLog?&lt;br/&gt;
+ For usual case, are we making two kvs arrays everytime we do a readFields?  Once when the WALEdit is constructed as part of construction and then again inside inside the if/elses?  We should make it once only?  Before this patch inside in readFields, we were doing a new ArrayList() when perhaps it should have been if (!this.kvs.empty()) this.kvs.clear() or new ArrayList().  Same for scopes List.&lt;br/&gt;
+ Is this right: +      kvs = new ArrayList&amp;lt;KeyValue&amp;gt;(0);?   Should be &apos;1&apos;?&lt;/p&gt;</comment>
                            <comment id="12848413" author="jdcryans" created="Mon, 22 Mar 2010 22:41:21 +0000"  >&lt;blockquote&gt;&lt;p&gt;+ Would it be worthwhile making the &quot;optimization&quot; that if no replication config, do not create a scopes List? Or would this make things a little involved?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not sure how WALEdit could know that.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;REPLICATION_SCOPE_LOCAL should be in HLog rather than in HConstants? Is it ever used outside of HLog?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes it is.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;For usual case, are we making two kvs arrays everytime we do a readFields? &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah had the same idea. And make those finals?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;+ Is this right: + kvs = new ArrayList&amp;lt;KeyValue&amp;gt;(0);? Should be &apos;1&apos;?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Oversight, thx.&lt;/p&gt;</comment>
                            <comment id="12848496" author="jdcryans" created="Tue, 23 Mar 2010 01:43:54 +0000"  >&lt;p&gt;After some more discussions with Stack, here&apos;s a fifth solution that also includes some of his comments:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;A Map is kept to keep the scope for each family contained in the WAL edit.&lt;/li&gt;
	&lt;li&gt;That map is always null when replication is off. For that we need a setter that mdc_replication uses to set the scopes when needed.&lt;/li&gt;
	&lt;li&gt;I moved the fixed overhead to a final variable and played with the heapSize a bit, not 100% sure it&apos;s done right since this class doesn&apos;t implement HeapSize.&lt;/li&gt;
	&lt;li&gt;The kvs list is now final and cleared when reading fields.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12848541" author="stack" created="Tue, 23 Mar 2010 04:32:32 +0000"  >&lt;p&gt;There is an extraneous comment:&lt;/p&gt;

&lt;p&gt;+      // Set it to the right size since we know it&lt;/p&gt;

&lt;p&gt;Does this method need to take a NavigableMap or SortedMap:&lt;/p&gt;

&lt;p&gt;+  public void setScopes (Map&amp;lt;byte[], Integer&amp;gt; scopes) {&lt;/p&gt;

&lt;p&gt;... to underline you can&apos;t have a Map with a byte [] unless it sorted.&lt;/p&gt;

&lt;p&gt;Otherwise patch looks good to me J-D.&lt;/p&gt;
</comment>
                            <comment id="12848805" author="jdcryans" created="Tue, 23 Mar 2010 17:06:51 +0000"  >&lt;p&gt;I will include Stack&apos;s comment on commit (minor stuff). I&apos;m also marking this issue as depending on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2359&quot; title=&quot;WALEdit doesn&amp;#39;t implement HeapSize&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2359&quot;&gt;&lt;del&gt;HBASE-2359&lt;/del&gt;&lt;/a&gt; since I&apos;m not sure at this point what&apos;s happening with the heapSize modifications.&lt;/p&gt;</comment>
                            <comment id="12851211" author="jdcryans" created="Tue, 30 Mar 2010 01:52:03 +0000"  >&lt;p&gt;Rebased after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2359&quot; title=&quot;WALEdit doesn&amp;#39;t implement HeapSize&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2359&quot;&gt;&lt;del&gt;HBASE-2359&lt;/del&gt;&lt;/a&gt; went in.&lt;/p&gt;</comment>
                            <comment id="12851231" author="stack" created="Tue, 30 Mar 2010 03:34:55 +0000"  >&lt;p&gt;+1 on commit&lt;/p&gt;</comment>
                            <comment id="12851472" author="jdcryans" created="Tue, 30 Mar 2010 17:19:21 +0000"  >&lt;p&gt;Committed to trunk, thanks for the review Stack!&lt;/p&gt;</comment>
                            <comment id="15017679" author="lars_francke" created="Fri, 20 Nov 2015 12:44:00 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12459895">HBASE-2359</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12439535" name="HBASE-2361-2.patch" size="4207" author="jdcryans" created="Tue, 23 Mar 2010 01:43:54 +0000"/>
                            <attachment id="12440167" name="HBASE-2361-3.patch" size="3608" author="jdcryans" created="Tue, 30 Mar 2010 01:52:03 +0000"/>
                            <attachment id="12439511" name="HBASE-2361.patch" size="3780" author="jdcryans" created="Mon, 22 Mar 2010 21:43:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 22 Mar 2010 22:31:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26274</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hhf3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100084</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>