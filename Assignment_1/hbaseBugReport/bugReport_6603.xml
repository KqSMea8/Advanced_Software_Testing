<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:38:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6603/HBASE-6603.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6603] RegionMetricsStorage.incrNumericMetric is called too often</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6603</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Running an HBase scan load through the profiler revealed that RegionMetricsStorage.incrNumericMetric is called way too often.&lt;/p&gt;

&lt;p&gt;It turns out that we make this call for &lt;b&gt;each&lt;/b&gt; KV in StoreScanner.next(...).&lt;br/&gt;
Incrementing AtomicLong requires expensive memory barriers.&lt;/p&gt;

&lt;p&gt;The observation here is that StoreScanner.next(...) can maintain a simple &lt;br/&gt;
long in its internal loop and only update the metric upon exit. Thus the AtomicLong is not updated nearly as often.&lt;/p&gt;

&lt;p&gt;That cuts about 10% runtime from scan only load (I&apos;ll quantify this better soon).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12603813">HBASE-6603</key>
            <summary>RegionMetricsStorage.incrNumericMetric is called too often</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mycnyc">M. Chen</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Fri, 17 Aug 2012 00:16:58 +0000</created>
                <updated>Sun, 7 Apr 2013 04:49:03 +0000</updated>
                            <resolved>Mon, 20 Aug 2012 23:43:53 +0000</resolved>
                                                    <fixVersion>0.94.2</fixVersion>
                                    <component>Performance</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13436465" author="eclark" created="Fri, 17 Aug 2012 00:20:13 +0000"  >&lt;p&gt;wow that&apos;s a huge perf gain.&lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                            <comment id="13436495" author="kannanm" created="Fri, 17 Aug 2012 01:03:13 +0000"  >&lt;p&gt;Also mentioned as item #4 in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6066&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-6066&lt;/a&gt;. I think a patch for this is already out. Let me check.&lt;/p&gt;</comment>
                            <comment id="13436497" author="kannanm" created="Fri, 17 Aug 2012 01:04:36 +0000"  >&lt;p&gt;Item #4 in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6066&quot; title=&quot;some low hanging read path improvement ideas &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6066&quot;&gt;&lt;del&gt;HBASE-6066&lt;/del&gt;&lt;/a&gt; was forked off into &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6217&quot; title=&quot;reduce overhead of maintaing get/next size metric&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6217&quot;&gt;HBASE-6217&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13436498" author="lhofhansl" created="Fri, 17 Aug 2012 01:06:07 +0000"  >&lt;p&gt;I should say that I tested with very wide rows. With narrow rows the percentage gain is probably less.&lt;/p&gt;</comment>
                            <comment id="13436520" author="stack" created="Fri, 17 Aug 2012 02:13:24 +0000"  >&lt;p&gt;This is a dup of hbase-6217 then?&lt;/p&gt;</comment>
                            <comment id="13436538" author="lhofhansl" created="Fri, 17 Aug 2012 03:40:32 +0000"  >&lt;p&gt;The patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6217&quot; title=&quot;reduce overhead of maintaing get/next size metric&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6217&quot;&gt;HBASE-6217&lt;/a&gt; is similar to the change that I had made locally. (I did not add a try/finally block, but instead updated the metric at the spots where the method returns. But it&apos;s the same in principle)&lt;/p&gt;

&lt;p&gt;Damn, and I was so proud of my profiling detective work. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;So, should I close this as dup and mark &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6217&quot; title=&quot;reduce overhead of maintaing get/next size metric&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6217&quot;&gt;HBASE-6217&lt;/a&gt; against 0.94 and 0.96 also? Or leave &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6217&quot; title=&quot;reduce overhead of maintaing get/next size metric&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6217&quot;&gt;HBASE-6217&lt;/a&gt; against fb89 only and use this for the 0.94 and 0.96 patches?&lt;/p&gt;</comment>
                            <comment id="13436792" author="stack" created="Fri, 17 Aug 2012 15:27:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;Damn, and I was so proud of my profiling detective work.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You impressed me.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;...or leave &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6217&quot; title=&quot;reduce overhead of maintaing get/next size metric&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6217&quot;&gt;HBASE-6217&lt;/a&gt; against fb89 only and use this for the 0.94 and 0.96 patches?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;That makes sense I&apos;d say.  Easier to track (having this issue for trunk and 0.94 and hbase-6217 for 89fb)&lt;/p&gt;</comment>
                            <comment id="13437106" author="kannanm" created="Fri, 17 Aug 2012 22:05:09 +0000"  >&lt;p&gt;but any reason the same patch (as 89fb) wouldn&apos;t work for trunk as well? I was checking into 89fb tree yet, and looks like the change hasn&apos;t been committed there either. Following up with Michael Chen.&lt;/p&gt;
</comment>
                            <comment id="13437636" author="lhofhansl" created="Mon, 20 Aug 2012 02:44:34 +0000"  >&lt;p&gt;Sure. Just make a 0.94/0.96 patch there. Patch there looks good to me. (copykv is gone now, though).&lt;/p&gt;</comment>
                            <comment id="13438085" author="lhofhansl" created="Mon, 20 Aug 2012 18:48:36 +0000"  >&lt;p&gt;Here&apos;s a version of the &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6217&quot; title=&quot;reduce overhead of maintaing get/next size metric&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6217&quot;&gt;HBASE-6217&lt;/a&gt; patch for trunk.&lt;/p&gt;

&lt;p&gt;In an extreme test with Gets of 60.000 columns the time went from about 164ms/iteration to 124ms.&lt;/p&gt;</comment>
                            <comment id="13438105" author="stack" created="Mon, 20 Aug 2012 19:11:26 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13438294" author="lhofhansl" created="Mon, 20 Aug 2012 23:03:50 +0000"  >&lt;p&gt;OK... Going to commit soon. @Kannan: This is essentially the same patch as in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6217&quot; title=&quot;reduce overhead of maintaing get/next size metric&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6217&quot;&gt;HBASE-6217&lt;/a&gt;. I&apos;ll attribute it to M.Chen.&lt;/p&gt;</comment>
                            <comment id="13438304" author="enis" created="Mon, 20 Aug 2012 23:27:40 +0000"  >&lt;p&gt;Great find. Can we merge to 0.92 as well. &lt;/p&gt;</comment>
                            <comment id="13438310" author="lhofhansl" created="Mon, 20 Aug 2012 23:39:48 +0000"  >&lt;p&gt;Committed to 0.94 and 0.96.&lt;/p&gt;</comment>
                            <comment id="13438318" author="lhofhansl" created="Mon, 20 Aug 2012 23:43:53 +0000"  >&lt;p&gt;Turns out that 0.92 does not collect this metric, so backport is not needed.&lt;/p&gt;</comment>
                            <comment id="13438372" author="hudson" created="Tue, 21 Aug 2012 01:09:19 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #410 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/410/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/410/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6603&quot; title=&quot;RegionMetricsStorage.incrNumericMetric is called too often&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6603&quot;&gt;&lt;del&gt;HBASE-6603&lt;/del&gt;&lt;/a&gt; RegionMetricsStorage.incrNumericMetric is called too often (M. Chen and Lars H) (Revision 1375318)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13438380" author="hudson" created="Tue, 21 Aug 2012 01:28:28 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3246 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3246/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3246/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6603&quot; title=&quot;RegionMetricsStorage.incrNumericMetric is called too often&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6603&quot;&gt;&lt;del&gt;HBASE-6603&lt;/del&gt;&lt;/a&gt; RegionMetricsStorage.incrNumericMetric is called too often (M. Chen) (Revision 1375312)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13438408" author="kannanm" created="Tue, 21 Aug 2012 02:24:28 +0000"  >&lt;p&gt;Thanks Lars.&lt;/p&gt;</comment>
                            <comment id="13438624" author="hudson" created="Tue, 21 Aug 2012 11:45:04 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #140 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/140/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/140/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6603&quot; title=&quot;RegionMetricsStorage.incrNumericMetric is called too often&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6603&quot;&gt;&lt;del&gt;HBASE-6603&lt;/del&gt;&lt;/a&gt; RegionMetricsStorage.incrNumericMetric is called too often (M. Chen) (Revision 1375312)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13438954" author="lhofhansl" created="Tue, 21 Aug 2012 19:06:15 +0000"  >&lt;p&gt;Also note that for scans with few columns the collection of this metric still shows up and consumes a significant portion of the time.&lt;br/&gt;
Are these metric that useful (total get size, total next size)? Can we remove them (or at least optionally not collect them)?&lt;/p&gt;</comment>
                            <comment id="13438958" author="stack" created="Tue, 21 Aug 2012 19:09:51 +0000"  >&lt;p&gt;@Lars Thats another issue?&lt;/p&gt;</comment>
                            <comment id="13439054" author="lhofhansl" created="Tue, 21 Aug 2012 21:18:09 +0000"  >&lt;p&gt;@Stack: For sure, just wanted to gauge what the general opinion is.&lt;/p&gt;</comment>
                            <comment id="13439510" author="hudson" created="Wed, 22 Aug 2012 13:48:09 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #48 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/48/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/48/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6603&quot; title=&quot;RegionMetricsStorage.incrNumericMetric is called too often&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6603&quot;&gt;&lt;del&gt;HBASE-6603&lt;/del&gt;&lt;/a&gt; RegionMetricsStorage.incrNumericMetric is called too often (M. Chen and Lars H) (Revision 1375318)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13448298" author="hudson" created="Wed, 5 Sep 2012 00:57:14 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #7 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/7/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/7/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6603&quot; title=&quot;RegionMetricsStorage.incrNumericMetric is called too often&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6603&quot;&gt;&lt;del&gt;HBASE-6603&lt;/del&gt;&lt;/a&gt; RegionMetricsStorage.incrNumericMetric is called too often (M. Chen and Lars H) (Revision 1375318)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/StoreScanner.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13624669" author="stack" created="Sun, 7 Apr 2013 04:49:03 +0000"  >&lt;p&gt;Fix up after bulk move overwrote some 0.94.2 fix versions w/ 0.95.0 (Noticed by Lars Hofhansl)&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12541627" name="6503-0.96.txt" size="6971" author="lhofhansl" created="Mon, 20 Aug 2012 18:48:35 +0000"/>
                            <attachment id="12541673" name="6603-0.94.txt" size="5436" author="lhofhansl" created="Mon, 20 Aug 2012 23:40:59 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 17 Aug 2012 00:20:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245263</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i067fz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34137</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>