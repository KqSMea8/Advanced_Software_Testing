<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:52:12 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14352/HBASE-14352.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14352] Replication is terribly slow with WAL compression</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14352</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;For the same load, replication with WAL compression enabled is almost 6x slower than with compression turned off. Age of last shipped operation is also correspondingly much higher when compression is turned on. &lt;/p&gt;

&lt;p&gt;By observing Size of log queue we can see that it is taking too much time for the queue to clear up.&lt;/p&gt;

&lt;p&gt;Attaching corresponding graphs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12860915">HBASE-14352</key>
            <summary>Replication is terribly slow with WAL compression</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="abhishek.chouhan">Abhishek Singh Chouhan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Sep 2015 07:00:16 +0000</created>
                <updated>Wed, 16 Sep 2015 23:35:18 +0000</updated>
                                            <version>0.98.13</version>
                                                        <due></due>
                            <votes>1</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="14724892" author="abhishek.chouhan" created="Tue, 1 Sep 2015 07:03:23 +0000"  >&lt;p&gt;Graph of Age of last shipped operation without compression followed with compression for the same workload.&lt;/p&gt;</comment>
                            <comment id="14724893" author="abhishek.chouhan" created="Tue, 1 Sep 2015 07:06:52 +0000"  >&lt;p&gt;Graph of Size of log queue without and with WAL compression enabled. It takes much more time for the queue to clear up with WAL compression turned on.&lt;/p&gt;</comment>
                            <comment id="14725192" author="ram_krish" created="Tue, 1 Sep 2015 11:04:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abhishek.chouhan&quot; class=&quot;user-hover&quot; rel=&quot;abhishek.chouhan&quot;&gt;Abhishek Singh Chouhan&lt;/a&gt;&lt;br/&gt;
I would like to know how to interpret the size_of_log_queue.png.  The y axis is the size of the queue and the time to taken to clear the queue has some difference on or before Aug 25?  Am i reading it right?&lt;/p&gt;</comment>
                            <comment id="14725243" author="abhishek.chouhan" created="Tue, 1 Sep 2015 11:40:07 +0000"  >&lt;p&gt;The graph is of two back to back workloads and shows point in time size of log queue of a particular host(each coloured line is a different host). When replication is complete, it goes back to 0.For the earlier load you can see the size of log queue going up and then coming down,at the point it comes back to 0, we have completely replicated all the edits. For the latter workload you can see that it is very spread out (it took too much time for the queue to clear up).&lt;/p&gt;</comment>
                            <comment id="14725250" author="abhishek.chouhan" created="Tue, 1 Sep 2015 11:42:21 +0000"  >&lt;p&gt;The latter workload was the one where compression was enabled. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14725254" author="ram_krish" created="Tue, 1 Sep 2015 11:43:26 +0000"  >&lt;p&gt;Got it. Thanks for the explanation.&lt;/p&gt;</comment>
                            <comment id="14725599" author="carp84" created="Tue, 1 Sep 2015 15:47:55 +0000"  >&lt;p&gt;+1, we observed a similar issue in our product env&lt;/p&gt;</comment>
                            <comment id="14725850" author="ram_krish" created="Tue, 1 Sep 2015 18:26:48 +0000"  >&lt;p&gt;Some one planning to work on this? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abhishek.chouhan&quot; class=&quot;user-hover&quot; rel=&quot;abhishek.chouhan&quot;&gt;Abhishek Singh Chouhan&lt;/a&gt;? If not I can take this up. &lt;/p&gt;</comment>
                            <comment id="14726868" author="abhishek.chouhan" created="Wed, 2 Sep 2015 07:01:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; I&apos;m not working on this right now. You can take this up. Let me know if i can help along the way &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14744971" author="ram_krish" created="Tue, 15 Sep 2015 07:09:34 +0000"  >&lt;p&gt;In your case does both the source and peer cluster both have WAL compression enabled?&lt;/p&gt;</comment>
                            <comment id="14790911" author="abhishek.chouhan" created="Wed, 16 Sep 2015 18:48:45 +0000"  >&lt;p&gt;Yep...both of them had compression enabled.&lt;/p&gt;</comment>
                            <comment id="14791052" author="lhofhansl" created="Wed, 16 Sep 2015 20:09:47 +0000"  >&lt;p&gt;I took a look at the code some weeks back. The problem immediately jumps out... At the source we constantly reset the read position into the current WAL. With compression it means we have start from a point where the compression dictionary is written. That is very expensive.&lt;/p&gt;

&lt;p&gt;We have to do that in order to be sure we&apos;ll see the edits in the current block being written.&lt;br/&gt;
So I don&apos;t see immediately a way out of it. Perhaps we simply tail until we reach the end of a file. And that case we&apos;ll try one more time with a reset, and only declare the WAL done when that is done.&lt;/p&gt;</comment>
                            <comment id="14791070" author="apurtell" created="Wed, 16 Sep 2015 20:22:24 +0000"  >&lt;p&gt;When I&apos;ve tested wal compression I&apos;ve found the hit to write performance (increased latency leading to a lower aggregate write ceiling cluster-wide) to outweigh space savings and any gains from that. Is this the general experience? Maybe the answer is to deprecate WAL compression? &lt;/p&gt;</comment>
                            <comment id="14791304" author="lhofhansl" created="Wed, 16 Sep 2015 23:35:18 +0000"  >&lt;p&gt;That&apos;s a good point. If there&apos;s no advantage to compresses WALs ever, let&apos;s get rid of the code.&lt;/p&gt;

&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=abhishek.chouhan&quot; class=&quot;user-hover&quot; rel=&quot;abhishek.chouhan&quot;&gt;Abhishek Singh Chouhan&lt;/a&gt; found write performance neutral with much reduced storage (20%). Only replication was significantly slower. Would certainly be nice if we could compress between DC when doing replication (but that&apos;s a different issue).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12753475" name="age_of_last_shipped.png" size="66193" author="abhishek.chouhan" created="Tue, 1 Sep 2015 07:03:23 +0000"/>
                            <attachment id="12753476" name="size_of_log_queue.png" size="85875" author="abhishek.chouhan" created="Tue, 1 Sep 2015 07:06:52 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Sep 2015 11:04:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2jmw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>