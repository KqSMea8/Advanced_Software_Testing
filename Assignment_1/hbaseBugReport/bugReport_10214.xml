<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:11:39 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10214/HBASE-10214.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10214] Regionserver shutdown improperly and leaves the dir in .old not deleted</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10214</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;RegionServer log&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-12-18 15:17:45,771 DEBUG org.apache.hadoop.hbase.regionserver.HRegionServer: Waiting on 51b27391410efdca841db264df46085f
2013-12-18 15:17:45,776 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Connected to master at &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;

2013-12-18 15:17:48,776 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: STOPPED: Exiting; cluster shutdown set and not carrying any regions
2013-12-18 15:17:48,776 FATAL org.apache.hadoop.hbase.regionserver.HRegionServer: ABORTING region server node,60020,1384410974572: Unhandled exception: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
java.lang.NullPointerException
        at org.apache.hadoop.hbase.regionserver.HRegionServer.tryRegionServerReport(HRegionServer.java:880)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:753)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12685790">HBASE-10214</key>
            <summary>Regionserver shutdown improperly and leaves the dir in .old not deleted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aoxiang">binlijin</assignee>
                                    <reporter username="aoxiang">binlijin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Dec 2013 11:19:32 +0000</created>
                <updated>Tue, 21 Jan 2014 01:31:39 +0000</updated>
                            <resolved>Tue, 24 Dec 2013 05:58:15 +0000</resolved>
                                    <version>0.94.14</version>
                                    <fixVersion>0.94.16</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13853876" author="aoxiang" created="Fri, 20 Dec 2013 11:23:08 +0000"  >&lt;p&gt;Looks like the trunk don&apos;t have this problem and the patch is based on 0.94-branch.&lt;/p&gt;</comment>
                            <comment id="13853952" author="jmspaggi" created="Fri, 20 Dec 2013 13:27:31 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aoxiang&quot; class=&quot;user-hover&quot; rel=&quot;aoxiang&quot;&gt;binlijin&lt;/a&gt;, which HBase version did you try with? The trace doesn&apos;t seems to allign with a recent one.&lt;/p&gt;</comment>
                            <comment id="13853959" author="aoxiang" created="Fri, 20 Dec 2013 13:37:16 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt;&#65292;i use 0.94.10 , this patch is for 0.94 version.&lt;/p&gt;</comment>
                            <comment id="13853967" author="jmspaggi" created="Fri, 20 Dec 2013 13:56:12 +0000"  >&lt;p&gt;I&apos;m not able to find the same lines into 0.94.10 neither.&lt;/p&gt;

&lt;p&gt;Line 880 of HRegionServer is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
closeWAL(abortRequested ? &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; : &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Line 753 is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
registerMBean();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Code for 0.94.10 and 0.94.15 is the same for tryRegionServerReport() so should not be an issue. But might be interesting to see what was throwing this NPE... Was it hbaseMaster like in your patch?&lt;/p&gt;</comment>
                            <comment id="13853984" author="aoxiang" created="Fri, 20 Dec 2013 14:18:40 +0000"  >&lt;p&gt;oh, sorry, the line is not match with the apache hbase 0.94.10 version, this is our own internal version which based on apache hbase 0.94.10.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; now = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((now - lastMsg) &amp;gt;= msgInterval) {
          doMetrics();
          tryRegionServerReport();  &lt;span class=&quot;code-comment&quot;&gt;// 753
&lt;/span&gt;          lastMsg = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.stopped) &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.sleeper.sleep();


  void tryRegionServerReport()
  &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    HServerLoad hsl = buildServerLoad();
    &lt;span class=&quot;code-comment&quot;&gt;// Why we &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;?
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.requestCount.set(0);
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.hbaseMaster.regionServerReport(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.serverNameFromMasterPOV.getVersionedBytes(), hsl); &lt;span class=&quot;code-comment&quot;&gt;// line 880
&lt;/span&gt;    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ioe &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; RemoteException) {
        ioe = ((RemoteException)ioe).unwrapRemoteException();
      }
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ioe &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; YouAreDeadException) {
        &lt;span class=&quot;code-comment&quot;&gt;// This will be caught and handled as a fatal error in run()
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; ioe;
      }
      &lt;span class=&quot;code-comment&quot;&gt;// Couldn&apos;t connect to the master, get location from zk and reconnect
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// Method blocks until &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; master is found or we are stopped
&lt;/span&gt;      getMaster();
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13854013" author="jmspaggi" created="Fri, 20 Dec 2013 14:49:53 +0000"  >&lt;p&gt;Ok. Make sense now &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Thanks for the clarification.&lt;/p&gt;

&lt;p&gt;Is there any risk for isClusterUp() to return true but for hbaseMaster to be null? If so, we will still get a NPE. no?&lt;/p&gt;</comment>
                            <comment id="13854055" author="aoxiang" created="Fri, 20 Dec 2013 15:21:33 +0000"  >&lt;p&gt;No, lt looks like impossible.&lt;/p&gt;</comment>
                            <comment id="13855347" author="zjushch" created="Mon, 23 Dec 2013 02:49:13 +0000"  >&lt;p&gt;Looks good to me,  make a trunk patch and run HadoopQA?&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aoxiang&quot; class=&quot;user-hover&quot; rel=&quot;aoxiang&quot;&gt;binlijin&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13855352" author="zjushch" created="Mon, 23 Dec 2013 03:10:19 +0000"  >&lt;p&gt;I see the above comment now that trunk don&apos;t need this patch,  &lt;/p&gt;

&lt;p&gt;Could you run the tests for 0.94 branch and upload the test result? Thanks&lt;/p&gt;</comment>
                            <comment id="13855355" author="yuzhihong@gmail.com" created="Mon, 23 Dec 2013 03:22:05 +0000"  >&lt;p&gt;nit:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-comment&quot;&gt;// the current server is stoping&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;typo: stoping -&amp;gt; stopping&lt;/p&gt;</comment>
                            <comment id="13855384" author="aoxiang" created="Mon, 23 Dec 2013 05:04:18 +0000"  >&lt;p&gt;@chunhui shen,  test result is:&lt;/p&gt;

&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Tests run: 1405, Failures: 0, Errors: 0, Skipped: 13&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; BUILD SUCCESS&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Total time: 50:11.332s&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Finished at: Mon Dec 23 12:09:17 CST 2013&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; Final Memory: 38M/751M&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;INFO&amp;#93;&lt;/span&gt; ------------------------------------------------------------------------&lt;/p&gt;


&lt;p&gt;All test passed.&lt;/p&gt;</comment>
                            <comment id="13855389" author="zjushch" created="Mon, 23 Dec 2013 05:11:43 +0000"  >&lt;p&gt;+1 for patch v3&lt;/p&gt;

&lt;p&gt;Will commit it if no further comment &lt;/p&gt;</comment>
                            <comment id="13856169" author="zjushch" created="Tue, 24 Dec 2013 05:58:03 +0000"  >&lt;p&gt;Committed to 0.94 branch.&lt;/p&gt;

&lt;p&gt;Thanks binlijin for the patch &lt;/p&gt;</comment>
                            <comment id="13856212" author="hudson" created="Tue, 24 Dec 2013 07:41:27 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-security #368 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/368/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/368/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10214&quot; title=&quot;Regionserver shutdown improperly and leaves the dir in .old not deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10214&quot;&gt;&lt;del&gt;HBASE-10214&lt;/del&gt;&lt;/a&gt; Regionserver shutdown improperly and leaves the dir in .old not deleted(binlijin) (zjushch: rev 1553246)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13856223" author="hudson" created="Tue, 24 Dec 2013 08:10:01 +0000"  >&lt;p&gt;ABORTED: Integrated in HBase-0.94 #1237 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1237/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1237/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10214&quot; title=&quot;Regionserver shutdown improperly and leaves the dir in .old not deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10214&quot;&gt;&lt;del&gt;HBASE-10214&lt;/del&gt;&lt;/a&gt; Regionserver shutdown improperly and leaves the dir in .old not deleted(binlijin) (zjushch: rev 1553246)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12619837" name="HBASE-10214-94-V2.patch" size="1039" author="aoxiang" created="Fri, 20 Dec 2013 15:29:25 +0000"/>
                            <attachment id="12620118" name="HBASE-10214-94-V3.patch" size="1040" author="aoxiang" created="Mon, 23 Dec 2013 03:33:38 +0000"/>
                            <attachment id="12619797" name="HBASE-10214-94.patch" size="1039" author="aoxiang" created="Fri, 20 Dec 2013 11:23:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 20 Dec 2013 13:27:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>364899</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 51 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qw93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365199</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>