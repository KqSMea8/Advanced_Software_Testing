<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:44:12 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-433/HBASE-433.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-433] region server should deleted restore log after successfull restore</title>
                <link>https://issues.apache.org/jira/browse/HBASE-433</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently we do not remove the restore log &quot;oldlogfile.log&quot; after we reopen a region after a crashed region server.&lt;/p&gt;

&lt;p&gt;Suggestion would be to remove after we successfully flush of all the edits to a mapfile&lt;/p&gt;

&lt;p&gt;so something like:&lt;br/&gt;
replay log &lt;br/&gt;
memcache flush&lt;br/&gt;
deleted log&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12388282">HBASE-433</key>
            <summary>region server should deleted restore log after successfull restore</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="viper799">Billy Pearson</reporter>
                        <labels>
                    </labels>
                <created>Sat, 9 Feb 2008 23:03:11 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:08 +0000</updated>
                            <resolved>Wed, 12 Mar 2008 17:07:20 +0000</resolved>
                                    <version>0.1.0</version>
                                    <fixVersion>0.1.0</fixVersion>
                    <fixVersion>0.2.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12567373" author="viper799" created="Sat, 9 Feb 2008 23:11:09 +0000"  >&lt;p&gt;might also take a look at what point the master sees a region as crashed from a region server&lt;/p&gt;

&lt;p&gt;example&lt;/p&gt;

&lt;p&gt;say I have a failed region server and master loads and saves restore logs for each region &lt;/p&gt;

&lt;p&gt;on the reopen of a region and say it replaying the logs and crashes &lt;/p&gt;

&lt;p&gt;Would the master overwrite the old log file with a new one or would the master not consider the region as part of the region server on a crash until it receives an MSG_REPORT_PROCESS_OPEN message?&lt;br/&gt;
Should look in to this so we do not have a risk of over writing a restore log file that has not successfully loaded and flushed to disk.&lt;/p&gt;</comment>
                            <comment id="12567390" author="jimk" created="Sun, 10 Feb 2008 01:31:28 +0000"  >&lt;p&gt;Current situation:&lt;/p&gt;

&lt;p&gt;If a region server crashes before it has closed any log files, then all it will leave is one zero length log file which will be ignored.&lt;/p&gt;

&lt;p&gt;However, if the region server crashes after closing one or more log files, and the region server was starting up a region that had an old log file (and the region server crashed before recovering the old log file), then yes, the old log file would be overwritten.&lt;/p&gt;

&lt;p&gt;Solution for current situation:&lt;/p&gt;

&lt;p&gt;HLog.splitLog should check for the presence of an existing log file, and copy its contents into a new file before processing the region server&apos;s log file(s).&lt;/p&gt;

&lt;p&gt;Future (when HDFS has appends):&lt;/p&gt;

&lt;p&gt;The region server will never leave a zero length log file unless it has received no updates since it started or since it closed the most recent log file.&lt;/p&gt;

&lt;p&gt;Solution for future:&lt;/p&gt;

&lt;p&gt;If HDFS supports appends to an existing file, then splitLog should open the region&apos;s old log file for append or create it if it does not exist.&lt;/p&gt;

&lt;p&gt;If HDFS does not support appends to an existing file, then the solution for the current situation would still work.&lt;/p&gt;</comment>
                            <comment id="12567391" author="jimk" created="Sun, 10 Feb 2008 01:33:28 +0000"  >&lt;p&gt;And yes, the region server should delete the old log file once it has been completely recovered and flushed.&lt;/p&gt;</comment>
                            <comment id="12577631" author="jimk" created="Tue, 11 Mar 2008 22:25:17 +0000"  >&lt;p&gt;HLog&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;don&apos;t overwrite oldlogfile in splitLog if it already exists. Rename it and copy it into the new oldlogfile. Then delete it once it has been copied.&lt;/li&gt;
	&lt;li&gt;use FileUtil.fullyDelete to delete region server log directory.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HRegion&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;delete oldlogfile once it has been successfully processed&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12577632" author="jimk" created="Tue, 11 Mar 2008 22:25:32 +0000"  >&lt;p&gt;Please review.&lt;/p&gt;</comment>
                            <comment id="12577661" author="viper799" created="Wed, 12 Mar 2008 01:07:01 +0000"  >&lt;p&gt;I would test but my test cluster is in route to the data center. someone could hard kill a region server and see if the logs get removed after the region recovers.&lt;/p&gt;</comment>
                            <comment id="12577709" author="bryanduxbury" created="Wed, 12 Mar 2008 05:00:26 +0000"  >&lt;p&gt;Silly comment, but should the math happen after the LOG.isDebugEnabled() so that when not in debug we don&apos;t do the math on HLog:586?&lt;/p&gt;

&lt;p&gt;Tests pass, code looks pretty good. +1&lt;/p&gt;</comment>
                            <comment id="12577867" author="jimk" created="Wed, 12 Mar 2008 15:06:58 +0000"  >&lt;p&gt;Good point. I had just cut and pasted from below, but you&apos;re right. Why do the math if you aren&apos;t going to use the results? I&apos;ll change that before I check it in.&lt;/p&gt;</comment>
                            <comment id="12577870" author="jimk" created="Wed, 12 Mar 2008 15:13:36 +0000"  >&lt;p&gt;Same as before, but don&apos;t do the math if you aren&apos;t going to use it.&lt;/p&gt;</comment>
                            <comment id="12577926" author="jimk" created="Wed, 12 Mar 2008 17:07:20 +0000"  >&lt;p&gt;Committed to 0.1 and trunk.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12386302">HBASE-251</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12384805">HBASE-236</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12377702" name="patch.txt" size="5507" author="jimk" created="Wed, 12 Mar 2008 15:13:36 +0000"/>
                            <attachment id="12377645" name="patch.txt" size="5380" author="jimk" created="Tue, 11 Mar 2008 22:25:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 10 Feb 2008 01:31:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25197</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 41 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h7a7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98442</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>