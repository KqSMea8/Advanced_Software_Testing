<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:51:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14274/HBASE-14274.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14274] Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14274</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Looking into parent issue, got a hang locally of TestDistributedLogReplay.&lt;/p&gt;

&lt;p&gt;We have region closes here:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;RS_CLOSE_META-localhost:59610-0&quot;&lt;/span&gt; prio=5 tid=0x00007ff65c03f800 nid=0x54347 waiting on condition [0x000000011f7ac000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x000000075636d8c0&amp;gt; (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:867)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1197)
	at java.util.concurrent.locks.ReentrantReadWriteLock$WriteLock.lock(ReentrantReadWriteLock.java:945)
	at org.apache.hadoop.hbase.regionserver.MetricsRegionAggregateSourceImpl.deregister(MetricsRegionAggregateSourceImpl.java:78)
	at org.apache.hadoop.hbase.regionserver.MetricsRegionSourceImpl.close(MetricsRegionSourceImpl.java:120)
	at org.apache.hadoop.hbase.regionserver.MetricsRegion.close(MetricsRegion.java:41)
	at org.apache.hadoop.hbase.regionserver.HRegion.doClose(HRegion.java:1500)
	at org.apache.hadoop.hbase.regionserver.HRegion.close(HRegion.java:1344)
	- locked &amp;lt;0x00000007ff878190&amp;gt; (a java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;)
	at org.apache.hadoop.hbase.regionserver.handler.CloseRegionHandler.process(CloseRegionHandler.java:102)
	at org.apache.hadoop.hbase.executor.EventHandler.run(EventHandler.java:103)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;They are trying to MetricsRegionAggregateSourceImpl.deregister. They want to get a write lock on this classes local ReentrantReadWriteLock while holding MetricsRegionSourceImpl&apos;s readWriteLock write lock.&lt;/p&gt;

&lt;p&gt;Then, elsewhere the JmxCacheBuster is running trying to get metrics with above locks held in reverse:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;HBase-Metrics2-1&quot;&lt;/span&gt; daemon prio=5 tid=0x00007ff65e14b000 nid=0x59a03 waiting on condition [0x0000000140ea5000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;  &amp;lt;0x00000007cade1480&amp;gt; (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)
	at java.util.concurrent.locks.LockSupport.park(LockSupport.java:186)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:834)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.doAcquireShared(AbstractQueuedSynchronizer.java:964)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireShared(AbstractQueuedSynchronizer.java:1282)
	at java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock.lock(ReentrantReadWriteLock.java:731)
	at org.apache.hadoop.hbase.regionserver.MetricsRegionSourceImpl.snapshot(MetricsRegionSourceImpl.java:193)
	at org.apache.hadoop.hbase.regionserver.MetricsRegionAggregateSourceImpl.getMetrics(MetricsRegionAggregateSourceImpl.java:115)
	at org.apache.hadoop.metrics2.impl.MetricsSourceAdapter.getMetrics(MetricsSourceAdapter.java:195)
	at org.apache.hadoop.metrics2.impl.MetricsSourceAdapter.updateJmxCache(MetricsSourceAdapter.java:172)
	at org.apache.hadoop.metrics2.impl.MetricsSourceAdapter.getMBeanInfo(MetricsSourceAdapter.java:151)
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getNewMBeanClassName(DefaultMBeanServerInterceptor.java:333)
	at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:319)
	at com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:522)
	at org.apache.hadoop.metrics2.util.MBeans.register(MBeans.java:57)
	at org.apache.hadoop.metrics2.impl.MetricsSourceAdapter.startMBeans(MetricsSourceAdapter.java:221)
	- locked &amp;lt;0x00000007e654bdc0&amp;gt; (a org.apache.hadoop.metrics2.impl.MetricsSourceAdapter)
	at org.apache.hadoop.metrics2.impl.MetricsSourceAdapter.start(MetricsSourceAdapter.java:96)
	at org.apache.hadoop.metrics2.impl.MetricsSystemImpl.registerSource(MetricsSystemImpl.java:245)
	- locked &amp;lt;0x0000000754302660&amp;gt; (a org.apache.hadoop.metrics2.impl.MetricsSystemImpl)
	at org.apache.hadoop.metrics2.impl.MetricsSystemImpl$1.postStart(MetricsSystemImpl.java:229)
	at sun.reflect.GeneratedMethodAccessor45.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.lang.reflect.Method.invoke(Method.java:606)
	at org.apache.hadoop.metrics2.impl.MetricsSystemImpl$3.invoke(MetricsSystemImpl.java:290)
	at com.sun.proxy.$Proxy13.postStart(Unknown Source)
	at org.apache.hadoop.metrics2.impl.MetricsSystemImpl.start(MetricsSystemImpl.java:185)
	- locked &amp;lt;0x0000000754302660&amp;gt; (a org.apache.hadoop.metrics2.impl.MetricsSystemImpl)
	at org.apache.hadoop.metrics2.impl.JmxCacheBuster$JmxCacheBusterRunnable.run(JmxCacheBuster.java:81)

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12857625">HBASE-14274</key>
            <summary>Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12857363">HBASE-14262</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eclark">Elliott Clark</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 20 Aug 2015 19:17:46 +0000</created>
                <updated>Thu, 17 Sep 2015 06:14:24 +0000</updated>
                            <resolved>Fri, 21 Aug 2015 03:48:48 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="14705591" author="stack" created="Thu, 20 Aug 2015 19:18:42 +0000"  >&lt;p&gt;Full thread dump. Ugly.&lt;/p&gt;</comment>
                            <comment id="14705605" author="apurtell" created="Thu, 20 Aug 2015 19:35:31 +0000"  >&lt;p&gt;JMX cache buster came in on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14166&quot; title=&quot;Per-Region metrics can be stale&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14166&quot;&gt;&lt;del&gt;HBASE-14166&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14705671" author="stack" created="Thu, 20 Aug 2015 20:01:26 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt; How about this?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java b/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java
index 7290c56..87272c4 100644
--- a/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java
+++ b/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java
@@ -133,11 +133,10 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class MetricsRegionSourceImpl &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; MetricsRegionSource {
       registry.removeHistogramMetrics(regionScanNextKey);

       regionWrapper = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
-
-      JmxCacheBuster.clearJmxCache();
     } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
       lock.unlock();
     }
+    JmxCacheBuster.clearJmxCache();
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We don&apos;t need the cache buster to run under the lock, right? And we can be stale for a few millis?&lt;/p&gt;

&lt;p&gt;Let me try and make a test.&lt;/p&gt;</comment>
                            <comment id="14705672" author="stack" created="Thu, 20 Aug 2015 20:02:44 +0000"  >&lt;p&gt;Hmm... not enough. I see the cache buster runs every 5 mins anyways, not just on region close.&lt;/p&gt;</comment>
                            <comment id="14705687" author="eclark" created="Thu, 20 Aug 2015 20:19:24 +0000"  >&lt;p&gt;Yeah cache buster runs in the background, so it will be better to put it out side of the lock but it shouldn&apos;t change much.&lt;/p&gt;</comment>
                            <comment id="14705701" author="eclark" created="Thu, 20 Aug 2015 20:28:02 +0000"  >&lt;p&gt;I can just remove the lock in metrics region aggregate source impl.&lt;/p&gt;</comment>
                            <comment id="14705707" author="eclark" created="Thu, 20 Aug 2015 20:32:55 +0000"  >&lt;p&gt;Something like this?&lt;/p&gt;</comment>
                            <comment id="14705723" author="stack" created="Thu, 20 Aug 2015 20:45:52 +0000"  >&lt;p&gt;I was going to ask if CHM would do.&lt;/p&gt;

&lt;p&gt;What about MetricsRegionSourceImpl#close?  It calls add.deregister which will run the cache buster... then still inside the lock, we&apos;ll again call clearJmxCache.  Move the add.deregister in place of the call to clearJmxCache?&lt;/p&gt;

&lt;p&gt;How we know this stuff is doing the metrics clearing you want &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;? Thanks.&lt;/p&gt;</comment>
                            <comment id="14705727" author="stack" created="Thu, 20 Aug 2015 20:49:47 +0000"  >&lt;p&gt;Was thinking of doing this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java b/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java
index 7290c56..fab6861 100644
--- a/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java
+++ b/hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java
@@ -117,7 +117,6 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class MetricsRegionSourceImpl &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; MetricsRegionSource {
       }

       closed = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
-      agg.deregister(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);

       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isTraceEnabled()) {
         LOG.trace(&lt;span class=&quot;code-quote&quot;&gt;&quot;Removing region Metrics: &quot;&lt;/span&gt; + regionWrapper.getRegionName());
@@ -131,10 +130,8 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class MetricsRegionSourceImpl &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; MetricsRegionSource {
       registry.removeMetric(regionScanNextKey);
       registry.removeHistogramMetrics(regionGetKey);
       registry.removeHistogramMetrics(regionScanNextKey);
-
       regionWrapper = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
-
-      JmxCacheBuster.clearJmxCache();
+      agg.deregister(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
     } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
       lock.unlock();
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... but not sure how registry places with aggregating bean.  We need this extra run of clearJmxCache in here?&lt;/p&gt;</comment>
                            <comment id="14705776" author="eclark" created="Thu, 20 Aug 2015 21:20:24 +0000"  >&lt;p&gt;We can get away without the clearJmxCache however I think that we need to have agg.deregister above all the removeMetric things or we risk a race.&lt;/p&gt;</comment>
                            <comment id="14705781" author="stack" created="Thu, 20 Aug 2015 21:23:44 +0000"  >&lt;p&gt;It will run the cachebuster... It could run before stuff is removed here in MetricsRegionSourceImpl? Would that leave dangling metrics? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14705898" author="stack" created="Thu, 20 Aug 2015 22:28:24 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Shouldn&apos;t deadlock anymore given you&apos;ve removed both locks (smile).&lt;/p&gt;

&lt;p&gt;I tried it local and it is good. I was able to deadlock pretty easily locally but not w/ this patch applied.&lt;/p&gt;</comment>
                            <comment id="14705903" author="stack" created="Thu, 20 Aug 2015 22:33:21 +0000"  >&lt;p&gt;This related to your change? Should protect against it?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
119113 2015-08-20 15:31:10,704 WARN  [HBase-Metrics2-1] impl.MetricsConfig(124): Cannot locate configuration: tried hadoop-metrics2-hbase.properties,hadoop-metrics2.properties
119114 2015-08-20 15:31:10,710 ERROR [HBase-Metrics2-1] lib.MethodMetric$2(118): Error invoking method getBlocksTotal
119115 java.lang.reflect.InvocationTargetException
119116 &#8250;   at sun.reflect.GeneratedMethodAccessor72.invoke(Unknown Source)
119117 &#8250;   at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
119118 &#8250;   at java.lang.reflect.Method.invoke(Method.java:606)
119119 &#8250;   at org.apache.hadoop.metrics2.lib.MethodMetric$2.snapshot(MethodMetric.java:111)
119120 &#8250;   at org.apache.hadoop.metrics2.lib.MethodMetric.snapshot(MethodMetric.java:144)
119121 &#8250;   at org.apache.hadoop.metrics2.lib.MetricsRegistry.snapshot(MetricsRegistry.java:387)
119122 &#8250;   at org.apache.hadoop.metrics2.lib.MetricsSourceBuilder$1.getMetrics(MetricsSourceBuilder.java:79)
119123 &#8250;   at org.apache.hadoop.metrics2.impl.MetricsSourceAdapter.getMetrics(MetricsSourceAdapter.java:195)
119124 &#8250;   at org.apache.hadoop.metrics2.impl.MetricsSourceAdapter.updateJmxCache(MetricsSourceAdapter.java:172)
119125 &#8250;   at org.apache.hadoop.metrics2.impl.MetricsSourceAdapter.getMBeanInfo(MetricsSourceAdapter.java:151)
119126 &#8250;   at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.getNewMBeanClassName(DefaultMBeanServerInterceptor.java:333)
119127 &#8250;   at com.sun.jmx.interceptor.DefaultMBeanServerInterceptor.registerMBean(DefaultMBeanServerInterceptor.java:319)
119128 &#8250;   at com.sun.jmx.mbeanserver.JmxMBeanServer.registerMBean(JmxMBeanServer.java:522)
119129 &#8250;   at org.apache.hadoop.metrics2.util.MBeans.register(MBeans.java:57)
119130 &#8250;   at org.apache.hadoop.metrics2.impl.MetricsSourceAdapter.startMBeans(MetricsSourceAdapter.java:221)
119131 &#8250;   at org.apache.hadoop.metrics2.impl.MetricsSourceAdapter.start(MetricsSourceAdapter.java:96)
119132 &#8250;   at org.apache.hadoop.metrics2.impl.MetricsSystemImpl.registerSource(MetricsSystemImpl.java:245)
119133 &#8250;   at org.apache.hadoop.metrics2.impl.MetricsSystemImpl$1.postStart(MetricsSystemImpl.java:229)
119134 &#8250;   at sun.reflect.GeneratedMethodAccessor50.invoke(Unknown Source)
119135 &#8250;   at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
119136 &#8250;   at java.lang.reflect.Method.invoke(Method.java:606)
119137 &#8250;   at org.apache.hadoop.metrics2.impl.MetricsSystemImpl$3.invoke(MetricsSystemImpl.java:290)
119138 &#8250;   at com.sun.proxy.$Proxy13.postStart(Unknown Source)
119139 &#8250;   at org.apache.hadoop.metrics2.impl.MetricsSystemImpl.start(MetricsSystemImpl.java:185)
119140 &#8250;   at org.apache.hadoop.metrics2.impl.JmxCacheBuster$JmxCacheBusterRunnable.run(JmxCacheBuster.java:81)
119141 &#8250;   at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)
119142 &#8250;   at java.util.concurrent.FutureTask.run(FutureTask.java:262)
119143 &#8250;   at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$201(ScheduledThreadPoolExecutor.java:178)
119144 &#8250;   at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:292)
119145 &#8250;   at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
119146 &#8250;   at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
119147 &#8250;   at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:744)
119148 Caused by: java.lang.NullPointerException
119149 &#8250;   at org.apache.hadoop.hdfs.server.blockmanagement.BlocksMap.size(BlocksMap.java:198)
119150 &#8250;   at org.apache.hadoop.hdfs.server.blockmanagement.BlockManager.getTotalBlocks(BlockManager.java:3158)
119151 &#8250;   at org.apache.hadoop.hdfs.server.namenode.FSNamesystem.getBlocksTotal(FSNamesystem.java:5652)
119152 &#8250;   ... 32 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In particular the NPE there near the end.&lt;/p&gt;</comment>
                            <comment id="14705929" author="eclark" created="Thu, 20 Aug 2015 22:56:23 +0000"  >&lt;p&gt;For that one it seems like the cache buster ran before the nn was all set up. I don&apos;t think that it&apos;s caused by the patch, more likely caused the fact that HBase has to stop and start the metrics system.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;That shouldn&apos;t be an issue in real life.&lt;/li&gt;
	&lt;li&gt;Let me get something up so that the logs are cleaner.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="14706009" author="eclark" created="Fri, 21 Aug 2015 00:06:26 +0000"  >&lt;p&gt;Ok so I can&apos;t get that log message to go away without lots of interesting work other places. so lets get this in and we can work on the log message more in a follow on jira.&lt;/p&gt;</comment>
                            <comment id="14706208" author="stack" created="Fri, 21 Aug 2015 03:48:48 +0000"  >&lt;p&gt;Pushed to master. Let me make a subtask to deal w/ the exception. Good one &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14706210" author="stack" created="Fri, 21 Aug 2015 03:51:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=busbey&quot; class=&quot;user-hover&quot; rel=&quot;busbey&quot;&gt;Sean Busbey&lt;/a&gt; Looks like this is needed for 1.2 too. I applied to branch-1.&lt;/p&gt;</comment>
                            <comment id="14706275" author="busbey" created="Fri, 21 Aug 2015 06:03:43 +0000"  >&lt;p&gt;cherry-picked to 1.2&lt;/p&gt;</comment>
                            <comment id="14706358" author="hudson" created="Fri, 21 Aug 2015 07:43:20 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3-IT #108 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/108/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/108/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl (stack: rev f4ad31c8f91782e51e0bffdcd11c587a6c1dd3e9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionAggregateSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14706539" author="hudson" created="Fri, 21 Aug 2015 10:52:00 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6744 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6744/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6744/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl (stack: rev bcef28eefaf192b0ad48c8011f98b8e944340da5)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionAggregateSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14707397" author="yuzhihong@gmail.com" created="Fri, 21 Aug 2015 20:16:26 +0000"  >&lt;p&gt;Looks like the attached addendum was what Elliott intended.&lt;/p&gt;</comment>
                            <comment id="14707458" author="hudson" created="Fri, 21 Aug 2015 21:04:11 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2-IT #106 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/106/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/106/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl (busbey: rev 909e2fe504169f978989e4c1c3778291b3da2418)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionAggregateSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14707575" author="eclark" created="Fri, 21 Aug 2015 22:35:58 +0000"  >&lt;p&gt;Yep &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt; that&apos;s what I meant. Want to commit that to every branch ?&lt;/p&gt;</comment>
                            <comment id="14707613" author="yuzhihong@gmail.com" created="Fri, 21 Aug 2015 23:00:20 +0000"  >&lt;p&gt;Pushed addendum to the 3 branches.&lt;/p&gt;</comment>
                            <comment id="14707743" author="hudson" created="Sat, 22 Aug 2015 01:07:32 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2-IT #107 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/107/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/107/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; Addendum sets closed to true when closing (tedyu: rev 1484aecc2635fdaecfeeeb368eafa2204041a8a9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14707753" author="hudson" created="Sat, 22 Aug 2015 01:20:49 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3 #126 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/126/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/126/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; Addendum sets closed to true when closing (tedyu: rev f05770b96f6246ffe851e6878dc07c4b7c02906f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14707756" author="hudson" created="Sat, 22 Aug 2015 01:21:15 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3-IT #109 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/109/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/109/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; Addendum sets closed to true when closing (tedyu: rev f05770b96f6246ffe851e6878dc07c4b7c02906f)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14707804" author="hudson" created="Sat, 22 Aug 2015 02:57:41 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #130 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/130/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/130/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; Addendum sets closed to true when closing (tedyu: rev 1484aecc2635fdaecfeeeb368eafa2204041a8a9)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14707825" author="hudson" created="Sat, 22 Aug 2015 03:52:26 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6746 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6746/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6746/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; Addendum sets closed to true when closing (tedyu: rev 9b2325e16fac7f2f37ac3539aee4faf6cdb8d6a6)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14791449" author="hudson" created="Thu, 17 Sep 2015 02:00:18 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3-IT #162 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/162/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/162/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14278&quot; title=&quot;Fix NPE that is showing up since HBASE-14274 went in&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14278&quot;&gt;&lt;del&gt;HBASE-14278&lt;/del&gt;&lt;/a&gt; Fix NPE that is showing up since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; went in (eclark: rev 2029e851827fa1bf59436c7baa1971b52ac5833e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/test/java/org/apache/hadoop/hbase/regionserver/TestMetricsRegionSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionServerSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/metrics2/impl/JmxCacheBuster.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionAggregateSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14791454" author="hudson" created="Thu, 17 Sep 2015 02:03:16 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2-IT #152 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/152/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/152/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14278&quot; title=&quot;Fix NPE that is showing up since HBASE-14274 went in&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14278&quot;&gt;&lt;del&gt;HBASE-14278&lt;/del&gt;&lt;/a&gt; Fix NPE that is showing up since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; went in (eclark: rev a229ac91fbab2608ae89bbe44b1dd05e5aef1183)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/metrics2/impl/JmxCacheBuster.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/test/java/org/apache/hadoop/hbase/regionserver/TestMetricsRegionSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionAggregateSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionServerSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14791556" author="hudson" created="Thu, 17 Sep 2015 04:18:00 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3 #182 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/182/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/182/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14278&quot; title=&quot;Fix NPE that is showing up since HBASE-14274 went in&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14278&quot;&gt;&lt;del&gt;HBASE-14278&lt;/del&gt;&lt;/a&gt; Fix NPE that is showing up since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; went in (eclark: rev 2029e851827fa1bf59436c7baa1971b52ac5833e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/metrics2/impl/JmxCacheBuster.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/test/java/org/apache/hadoop/hbase/regionserver/TestMetricsRegionSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionServerSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionAggregateSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14791563" author="hudson" created="Thu, 17 Sep 2015 04:23:09 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.2 #180 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/180/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/180/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14278&quot; title=&quot;Fix NPE that is showing up since HBASE-14274 went in&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14278&quot;&gt;&lt;del&gt;HBASE-14278&lt;/del&gt;&lt;/a&gt; Fix NPE that is showing up since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; went in (eclark: rev a229ac91fbab2608ae89bbe44b1dd05e5aef1183)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/metrics2/impl/JmxCacheBuster.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/test/java/org/apache/hadoop/hbase/regionserver/TestMetricsRegionSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionServerSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionAggregateSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14791630" author="hudson" created="Thu, 17 Sep 2015 06:14:24 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6817 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6817/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6817/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14278&quot; title=&quot;Fix NPE that is showing up since HBASE-14274 went in&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14278&quot;&gt;&lt;del&gt;HBASE-14278&lt;/del&gt;&lt;/a&gt; Fix NPE that is showing up since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-14274&quot; title=&quot;Deadlock in region metrics on shutdown: MetricsRegionSourceImpl vs MetricsRegionAggregateSourceImpl&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-14274&quot;&gt;&lt;del&gt;HBASE-14274&lt;/del&gt;&lt;/a&gt; went in (eclark: rev c1ac4bb8601f88eb3fe246eb62c3f40e95faf93d)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/test/java/org/apache/hadoop/hbase/regionserver/TestMetricsRegionSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionAggregateSourceImpl.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/metrics2/impl/JmxCacheBuster.java&lt;/li&gt;
	&lt;li&gt;hbase-hadoop2-compat/src/main/java/org/apache/hadoop/hbase/regionserver/MetricsRegionServerSourceImpl.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12850070">HBASE-14166</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12751788" name="14274-addendum.txt" size="767" author="yuzhihong@gmail.com" created="Fri, 21 Aug 2015 20:16:26 +0000"/>
                            <attachment id="12751559" name="23612.stack" size="531988" author="stack" created="Thu, 20 Aug 2015 19:18:42 +0000"/>
                            <attachment id="12751598" name="HBASE-14274-v1.patch" size="8159" author="eclark" created="Thu, 20 Aug 2015 21:49:45 +0000"/>
                            <attachment id="12751578" name="HBASE-14274.patch" size="4174" author="eclark" created="Thu, 20 Aug 2015 20:32:55 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 20 Aug 2015 19:35:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j68v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>