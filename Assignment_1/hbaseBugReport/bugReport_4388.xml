<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:18:29 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4388/HBASE-4388.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4388] Second start after migration from 90 to trunk crashes</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4388</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I started a trunk cluster to upgrade from 90, inserted a ton of data, then did a clean shutdown. When I started again, I got the following exception:&lt;/p&gt;

&lt;p&gt;11/09/13 12:29:09 INFO master.HMaster: Meta has HRI with HTDs. Updating meta now.&lt;br/&gt;
11/09/13 12:29:09 FATAL master.HMaster: Unhandled exception. Starting shutdown.&lt;br/&gt;
java.lang.NegativeArraySizeException: -102&lt;br/&gt;
        at org.apache.hadoop.hbase.util.Bytes.readByteArray(Bytes.java:147)&lt;br/&gt;
        at org.apache.hadoop.hbase.HTableDescriptor.readFields(HTableDescriptor.java:606)&lt;br/&gt;
        at org.apache.hadoop.hbase.migration.HRegionInfo090x.readFields(HRegionInfo090x.java:641)&lt;br/&gt;
        at org.apache.hadoop.hbase.util.Writables.getWritable(Writables.java:133)&lt;br/&gt;
        at org.apache.hadoop.hbase.util.Writables.getWritable(Writables.java:103)&lt;br/&gt;
        at org.apache.hadoop.hbase.util.Writables.getHRegionInfoForMigration(Writables.java:228)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.MetaEditor.getHRegionInfoForMigration(MetaEditor.java:350)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.MetaEditor$1.visit(MetaEditor.java:273)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.MetaReader.fullScan(MetaReader.java:633)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.MetaReader.fullScan(MetaReader.java:255)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.MetaReader.fullScan(MetaReader.java:235)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.MetaEditor.updateMetaWithNewRegionInfo(MetaEditor.java:284)&lt;br/&gt;
        at org.apache.hadoop.hbase.catalog.MetaEditor.migrateRootAndMeta(MetaEditor.java:298)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.HMaster.updateMetaWithNewHRI(HMaster.java:529)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.HMaster.finishInitialization(HMaster.java:472)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:309)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12522935">HBASE-4388</key>
            <summary>Second start after migration from 90 to trunk crashes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Sep 2011 19:30:55 +0000</created>
                <updated>Fri, 20 Nov 2015 11:55:56 +0000</updated>
                            <resolved>Thu, 27 Oct 2011 21:07:14 +0000</resolved>
                                    <version>0.92.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>master</component>
                    <component>migration</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13103928" author="tlipcon" created="Tue, 13 Sep 2011 19:41:13 +0000"  >&lt;p&gt;Attached the META table directory&lt;/p&gt;</comment>
                            <comment id="13103932" author="tlipcon" created="Tue, 13 Sep 2011 19:49:18 +0000"  >&lt;p&gt;The migration code introduced by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3970&quot; title=&quot;Address HMaster crash/failure half way through meta migration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3970&quot;&gt;&lt;del&gt;HBASE-3970&lt;/del&gt;&lt;/a&gt; is highly suspect. It relies on catching exceptions, passing around null, etc, to deal with partial migration.&lt;/p&gt;

&lt;p&gt;We have a VERSION field in HRegionInfo for a region. But, for some reason it didn&apos;t get incremented with the move to the new format. So it relies on ugly exception catching to deal with it...&lt;/p&gt;</comment>
                            <comment id="13104120" author="tlipcon" created="Wed, 14 Sep 2011 00:52:14 +0000"  >&lt;p&gt;I think the issue is actually with ROOT:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;K: -ROOT-,,0/info:metamigrated/1315897917149/Put/vlen=1 V: \xFF
K: .META.,,1/info:regioninfo/1315897893486/Put/vlen=34 V: \x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x09.META.,,1\x00\x00\x06.META.K\xCC\x17\xA9
K: .META.,,1/info:regioninfo/1314587843400/Put/vlen=272 V: \x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x09.META.,,1\x00\x00\x00\x00\x00\x05\x06.META.\x00\x01\x00\x00\x00\x02\x00\x00\x00\x07IS_ROOT\x00\x00\x00\x05false\x00\x00\x00\x07IS_META\x00\x00\x00\x04true\x00\x00\x00\x01\x08\x04info\x00\x00\x00\x08\x00\x00\x00\x0BBLOOMFILTER\x00\x00\x00\x04NONE\x00\x00\x00\x11REPLICATION_SCOPE\x00\x00\x00\x010\x00\x00\x00\x0BCOMPRESSION\x00\x00\x00\x04NONE\x00\x00\x00\x08VERSIONS\x00\x00\x00\x0210\x00\x00\x00\x03TTL\x00\x00\x00\x0A2147483647\x00\x00\x00\x09BLOCKSIZE\x00\x00\x00\x048192\x00\x00\x00\x09IN_MEMORY\x00\x00\x00\x04true\x00\x00\x00\x0ABLOCKCACHE\x00\x00\x00\x04trueK\xCC\x17\xA9
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Perhaps it&apos;s seeing the old version of the row in ROOT?&lt;/p&gt;</comment>
                            <comment id="13104127" author="tlipcon" created="Wed, 14 Sep 2011 00:57:36 +0000"  >&lt;p&gt;Wasn&apos;t with ROOT either. I completely deleted ROOT and META, and it &lt;em&gt;still&lt;/em&gt; had the same exception trace. I ended up having to stop all the region servers, clear ZK, start it all again.&lt;/p&gt;</comment>
                            <comment id="13104226" author="yuzhihong@gmail.com" created="Wed, 14 Sep 2011 04:00:50 +0000"  >&lt;p&gt;The root cause is that there&apos;re two addMetaUpdateStatus() methods in MetaEditor:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Put addMetaUpdateStatus(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Put p) {
    p.add(HConstants.CATALOG_FAMILY, HConstants.META_MIGRATION_QUALIFIER,
      Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;));
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; p;
  }

  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Put addMetaUpdateStatus(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Put p, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; metaUpdated) {
    p.add(HConstants.CATALOG_FAMILY, HConstants.META_MIGRATION_QUALIFIER,
      Bytes.toBytes(metaUpdated));
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; p;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;isMetaHRIUpdated() understands what the first addMetaUpdateStatus() writes but updateRootWithMetaMigrationStatus() calls the second addMetaUpdateStatus() above. Hence the inconsistency.&lt;/p&gt;</comment>
                            <comment id="13104228" author="yuzhihong@gmail.com" created="Wed, 14 Sep 2011 04:08:56 +0000"  >&lt;p&gt;This patch removes the unused addMetaUpdateStatus() and makes the remaining addMetaUpdateStatus() consistent with isMetaHRIUpdated()&lt;/p&gt;</comment>
                            <comment id="13104259" author="tlipcon" created="Wed, 14 Sep 2011 05:26:15 +0000"  >&lt;p&gt;Any chance we can improve the test coverage for migration? This is a critical feature that impacts metadata integrity, and doesn&apos;t get a lot of &quot;implicit coverage&quot; from people using it, since most of us test with fresh clusters on trunk. It concerns me that of the two times I&apos;ve done an actual migration from 90 to trunk, I&apos;ve run into nasty bugs.&lt;/p&gt;

&lt;p&gt;If this isn&apos;t easy to test for, I&apos;ll try to add tests in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4389&quot; title=&quot;Address lots of issues with migration from 90 to trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4389&quot;&gt;&lt;del&gt;HBASE-4389&lt;/del&gt;&lt;/a&gt; as well.&lt;/p&gt;</comment>
                            <comment id="13104518" author="yuzhihong@gmail.com" created="Wed, 14 Sep 2011 14:23:04 +0000"  >&lt;p&gt;We should decide what would be the proper value for metamigrated column in preparation for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4389&quot; title=&quot;Address lots of issues with migration from 90 to trunk&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4389&quot;&gt;&lt;del&gt;HBASE-4389&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
I propose &apos;0.92&apos;&lt;/p&gt;</comment>
                            <comment id="13105005" author="yuzhihong@gmail.com" created="Wed, 14 Sep 2011 23:44:25 +0000"  >&lt;p&gt;This is what I did to verify my patch:&lt;br/&gt;
1. stop HBase&lt;br/&gt;
2. hadoop -rmr /hbase&lt;br/&gt;
3. distcp the saved hbase-90 tree as /hbase&lt;br/&gt;
4. start HBase with patch&lt;br/&gt;
5. verify that I can access the tables&lt;br/&gt;
6. stop HBase&lt;br/&gt;
7. restart HBase&lt;br/&gt;
8. verify that I can access the tables&lt;/p&gt;

&lt;p&gt;I preformed the above procedure twice. No problem.&lt;/p&gt;

&lt;p&gt;Looking at writing unit test next.&lt;/p&gt;</comment>
                            <comment id="13105033" author="tlipcon" created="Thu, 15 Sep 2011 00:28:57 +0000"  >&lt;p&gt;In HDFS, the way we do these tests is to actually have a small tarball of an old layout filesystem in a test/data tree. Then the test untars that tarball, and makes sure it can properly upgrade. Maybe we can consider the same? One or two tables each with a few regions each with a few rows should only be tens of KB - easy enough to include in the source.&lt;/p&gt;</comment>
                            <comment id="13105036" author="stack" created="Thu, 15 Sep 2011 00:38:20 +0000"  >&lt;p&gt;We used to do similar for migration tests going between earlier versions of hbase.&lt;/p&gt;</comment>
                            <comment id="13105653" author="yuzhihong@gmail.com" created="Thu, 15 Sep 2011 20:10:45 +0000"  >&lt;p&gt;Chatting with Todd, he suggested storing an internal version number into metaMigrated column.&lt;/p&gt;</comment>
                            <comment id="13106855" author="yuzhihong@gmail.com" created="Fri, 16 Sep 2011 22:10:14 +0000"  >&lt;p&gt;I am thinking of using three bytes for the internal version number.&lt;br/&gt;
So 0.92.0 would be stored as &lt;/p&gt;
{0x00, 0x5C, 0x00}
&lt;p&gt;.&lt;br/&gt;
In isMetaHRIUpdated(), the check would be modified accordingly.&lt;/p&gt;</comment>
                            <comment id="13106925" author="stack" created="Fri, 16 Sep 2011 23:56:51 +0000"  >&lt;p&gt;Why not just store a byte.  Let its presence indicate successful update.  Set it to 0x00.  Setting it to 0.92.0 doesn&apos;t really help.  Versions of .META. might evolve orthogonally to hbase version.&lt;/p&gt;</comment>
                            <comment id="13106986" author="tlipcon" created="Sat, 17 Sep 2011 01:18:59 +0000"  >&lt;p&gt;Right, &quot;internal version number&quot; was meant to be something where we start with 0x0001, then increment each time we need a migration. Define constants for each new feature:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; NO_HTD_IN_HRI_VERSION = 1;
&lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; NEXT_TIME_WE_CHANGE_SOMETHING_VERSION = 2;
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13107002" author="yuzhihong@gmail.com" created="Sat, 17 Sep 2011 02:41:56 +0000"  >&lt;p&gt;Michael said one byte, Todd used two.&lt;br/&gt;
Maybe one byte is enough ?&lt;/p&gt;</comment>
                            <comment id="13107009" author="tlipcon" created="Sat, 17 Sep 2011 03:50:41 +0000"  >&lt;p&gt;The advantage of using more than one byte is that we can easily distinguish between the first byte being part of a version string between the first byte being the first character of a hostname. Otherwise as soon as we got to version 61, it would be equivalent to &apos;1&apos;, and it might be the start of &quot;10.0.0.1&quot; rather than a version number.&lt;/p&gt;

&lt;p&gt;And space is hardly a concern for this... so let&apos;s use more bytes rather than fewer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13107010" author="tlipcon" created="Sat, 17 Sep 2011 03:51:12 +0000"  >&lt;p&gt;er, I meant version 49 is equivalent to &apos;1&apos;. But you get my point &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13107099" author="yuzhihong@gmail.com" created="Sat, 17 Sep 2011 11:51:30 +0000"  >&lt;p&gt;metaMigrated column is a new column. I wonder if hostname would ever get into this column.&lt;/p&gt;</comment>
                            <comment id="13107172" author="stack" created="Sat, 17 Sep 2011 17:30:54 +0000"  >&lt;p&gt;@Ted true... but two bytes seems fine here.&lt;/p&gt;</comment>
                            <comment id="13107238" author="yuzhihong@gmail.com" created="Sat, 17 Sep 2011 20:16:24 +0000"  >&lt;p&gt;Patch version 2 adopts Todd&apos;s suggestion.&lt;/p&gt;</comment>
                            <comment id="13107261" author="tlipcon" created="Sat, 17 Sep 2011 21:04:11 +0000"  >&lt;p&gt;Oh, sorry, got my wires crossed between tickets. It&apos;s the &lt;em&gt;other&lt;/em&gt; ticket where we were talking about a version number for something that used to just be hostname &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; My bad.&lt;/p&gt;</comment>
                            <comment id="13114811" author="yuzhihong@gmail.com" created="Mon, 26 Sep 2011 17:22:44 +0000"  >&lt;p&gt;Forgot to update HRegion.addRegionToMETA() in patch v2.&lt;/p&gt;</comment>
                            <comment id="13121614" author="tlipcon" created="Wed, 5 Oct 2011 23:57:56 +0000"  >&lt;p&gt;A few small comments:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;we should have a constant like META_MIGRATION_CURRENT_VERSION which maps to the most recent - we can use this when we have completed migration&lt;/li&gt;
	&lt;li&gt;it seems to make more sense to have the constants just be ints, and then convert the cell contents to an int where we do the comparison, rather than have the constants be byte arrays and use byte array comparison.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13123819" author="svarma" created="Mon, 10 Oct 2011 00:41:48 +0000"  >&lt;p&gt;I applied the 4288-v3 patch locally but still got the same exception. (0.92.0-SNAPSHOT + 4288-v3 patch pointed to a 0.90.x hbase root dir.&lt;/p&gt;

&lt;p&gt;2011-10-09 17:36:47,062 FATAL org.apache.hadoop.hbase.master.HMaster: Unhandled&lt;br/&gt;
exception. Starting shutdown.&lt;br/&gt;
java.lang.NegativeArraySizeException: -108&lt;br/&gt;
        at org.apache.hadoop.hbase.util.Bytes.readByteArray(Bytes.java:147)&lt;br/&gt;
        at org.apache.hadoop.hbase.HTableDescriptor.readFields(HTableDescriptor.&lt;br/&gt;
java:621)&lt;br/&gt;
        at org.apache.hadoop.hbase.migration.HRegionInfo090x.readFields(HRegionI&lt;br/&gt;
nfo090x.java:641)&lt;br/&gt;
        at org.apache.hadoop.hbase.util.Writables.getWritable(Writables.java:133&lt;br/&gt;
)&lt;/p&gt;

&lt;p&gt;Just wanted to give this feedback ... &lt;br/&gt;
Does this need to pull in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3970&quot; title=&quot;Address HMaster crash/failure half way through meta migration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3970&quot;&gt;&lt;del&gt;HBASE-3970&lt;/del&gt;&lt;/a&gt; as well to 0.92?&lt;/p&gt;</comment>
                            <comment id="13123820" author="svarma" created="Mon, 10 Oct 2011 00:42:55 +0000"  >&lt;p&gt;Sorry - I meant 4388-v3 not 4288-v3 ...&lt;/p&gt;</comment>
                            <comment id="13123825" author="svarma" created="Mon, 10 Oct 2011 00:49:35 +0000"  >&lt;p&gt;So - looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3970&quot; title=&quot;Address HMaster crash/failure half way through meta migration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3970&quot;&gt;&lt;del&gt;HBASE-3970&lt;/del&gt;&lt;/a&gt; changes are already in 0.92 (though it is marked as trunk in the jira ticket).&lt;/p&gt;

&lt;p&gt;So - this issue still exists, it appears.&lt;/p&gt;</comment>
                            <comment id="13123827" author="yuzhihong@gmail.com" created="Mon, 10 Oct 2011 00:56:58 +0000"  >&lt;p&gt;@Suraj:&lt;br/&gt;
Can you give more details (including master log) ?&lt;br/&gt;
Was your procedure different from mine described @ 14/Sep/11 23:44 ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13124204" author="svarma" created="Mon, 10 Oct 2011 15:59:08 +0000"  >&lt;p&gt;@Ted Yu:&lt;br/&gt;
This was a standalone install on cygwin. I had a 0.90.x hbase root dir which i was pointing to from 0.92.0-SNAPSHOT plus the patch. Procedure was to simply do start-hbase.sh on the 0.92 install, the master died each time with the NegativeArraySizeException. &lt;br/&gt;
By explicitly catching this exception in HRegionInfo090x#readFields(DataInput) method &amp;amp; rethrowing as IOException (similar to EOFException), I was able to get past this and complete the migration successfully.&lt;br/&gt;
I&apos;m attaching the master log from when it threw the error during migration.&lt;/p&gt;</comment>
                            <comment id="13124206" author="svarma" created="Mon, 10 Oct 2011 16:01:18 +0000"  >&lt;p&gt;Attaching master log snippet captured during the NegativeArraySizeException run. &lt;/p&gt;</comment>
                            <comment id="13129156" author="yuzhihong@gmail.com" created="Mon, 17 Oct 2011 20:38:55 +0000"  >&lt;p&gt;The new test would be similar to TestDFSUpgradeFromImage which uses hadoop-14-dfs-dir.tgz as a source for the old image.&lt;br/&gt;
We should create some HBase table using hbase-0.90 and tar the entire dataset.&lt;br/&gt;
Then write a unit test which untars the old dataset, and starts hbase-0.92. This should successfully read&lt;br/&gt;
the old image and upgrade it.&lt;/p&gt;</comment>
                            <comment id="13130337" author="stack" created="Wed, 19 Oct 2011 03:55:47 +0000"  >&lt;p&gt;Not done yet.&lt;/p&gt;</comment>
                            <comment id="13132153" author="jdcryans" created="Thu, 20 Oct 2011 22:49:38 +0000"  >&lt;p&gt;I was playing with 0.92 for a while, upgrading it from 0.90, and it took me a couple of restarts to get this (not sure if related to this issue tho, but looks like it):&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2011-10-20 22:35:34,078 FATAL org.apache.hadoop.hbase.master.HMaster: Master server abort: loaded coprocessors are: []&lt;br/&gt;
2011-10-20 22:35:34,078 FATAL org.apache.hadoop.hbase.master.HMaster: Unhandled exception. Starting shutdown.&lt;br/&gt;
java.lang.IllegalArgumentException: Array has wrong size: 4&lt;br/&gt;
	at org.apache.hadoop.hbase.util.Bytes.toBoolean(Bytes.java:450)&lt;br/&gt;
	at org.apache.hadoop.hbase.catalog.MetaMigrationRemovingHTD.isMetaHRIUpdated(MetaMigrationRemovingHTD.java:216)&lt;br/&gt;
	at org.apache.hadoop.hbase.catalog.MetaMigrationRemovingHTD.updateMetaWithNewHRI(MetaMigrationRemovingHTD.java:228)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.HMaster.finishInitialization(HMaster.java:467)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:303)&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13132155" author="jdcryans" created="Thu, 20 Oct 2011 22:51:38 +0000"  >&lt;p&gt;Oh yeah and my master can&apos;t start since I got that.&lt;/p&gt;</comment>
                            <comment id="13132159" author="yuzhihong@gmail.com" created="Thu, 20 Oct 2011 22:54:38 +0000"  >&lt;p&gt;I think this was due to the 4-byte array carrying &apos;true&apos;.&lt;br/&gt;
See the following before &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3446&quot; title=&quot;ProcessServerShutdown fails if META moves, orphaning lots of regions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3446&quot;&gt;&lt;del&gt;HBASE-3446&lt;/del&gt;&lt;/a&gt; went in:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; Put addMetaUpdateStatus(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Put p) {
-    p.add(HConstants.CATALOG_FAMILY, HConstants.META_MIGRATION_QUALIFIER,
-      Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&quot;&lt;/span&gt;));
-    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; p;
-  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13133291" author="stack" created="Sat, 22 Oct 2011 07:41:16 +0000"  >&lt;p&gt;A 0.90 hbase.rootdir with a table named TestTable that has 100 regions w/ a few rows in each region.&lt;/p&gt;

&lt;p&gt;Place under src/test/data on commit.&lt;/p&gt;</comment>
                            <comment id="13133296" author="jiraposter@reviews.apache.org" created="Sat, 22 Oct 2011 07:58:32 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2539/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2539/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Changes name of column in root that holds current version of the meta table from info:metamigrated to info:v.&lt;/p&gt;

&lt;p&gt;Current version of meta table is 0 (short).  The absence of the column means table has not been migrated.&lt;/p&gt;

&lt;p&gt;Upped version on HRegionInfo and made its readFields able to deserialze the older pre-0.92 HRegionInfo.&lt;/p&gt;

&lt;p&gt;Change MetaReader#putToCatalogTable so it no longer takes a region name.  Was redundant (needed this method for migration).&lt;/p&gt;

&lt;p&gt;Removed a bunch of MetaMigrationRemovingHTD.  Not needed any more or was duplicated code and I axed it.&lt;/p&gt;

&lt;p&gt;Found a bug in that we didn&apos;t migrate info:splitA or info:splitB if present &amp;#8211; i.e. if we had offlined parent from split going on when migration was happening, we&apos;d fail.&lt;/p&gt;

&lt;p&gt;Migration is more idempotenty now.  We look at the HRI bytes and if older version, we&apos;ll update (Removed the try to deserialize and catch exception stuff).&lt;/p&gt;

&lt;p&gt;Moved methods from HBaseTestingUtility and from Writables that had to do w/ migration exclusively, out and into MetaMigrationRemoveHTD migrating class (or into migration tests) so migration code all in one place rather than spread about (more to do)&lt;/p&gt;

&lt;p&gt;Changed MetaReader#isMetaTable to MetaReader#isRootTableRow.  Makes more sense now (needed migrating).&lt;/p&gt;

&lt;p&gt;Renamed TestMetaMigration as TestMetaMigrationRemovingHTD.  Also, made this test startup on top of a 0.90 hbase.rootdir to test it can migrate.&lt;/p&gt;

&lt;p&gt;Added TestMigrationFrom090To092&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-4388.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/hbase-4388&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hbase-4388&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HConstants.java 144f526 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HRegionInfo.java e950df3 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java 6387df9 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/catalog/MetaMigrationRemovingHTD.java 0c1d221 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java f7f4d60 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java 91abb00 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 12dfbcd &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/Writables.java f595af5 &lt;br/&gt;
  src/test/data/hbase-4388-root.dir.tgz PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 6af3d35 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/client/TestMetaMigration.java 6cbf88c &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/client/TestMetaMigrationRemovingHTD.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/migration/TestMigrationFrom090To092.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2539/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2539/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Migration tests pass.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Michael&lt;/p&gt;
</comment>
                            <comment id="13133301" author="stack" created="Sat, 22 Oct 2011 08:03:22 +0000"  >&lt;p&gt;Patch should cover issues raised above.&lt;/p&gt;

&lt;p&gt;Regards NegativeArraySizeException, we test version byte before we try deserialize so should avoid these going forward.&lt;/p&gt;

&lt;p&gt;For J-D&apos;s issue, we may try reading the new short and get something similar but a bunch of checks have been added around the version check so maybe less likely.&lt;/p&gt;

&lt;p&gt;The patch adds a test that migrates a table with a little substance.&lt;/p&gt;

&lt;p&gt;Could add more tests.  Let me look at hbase-4389.  Could add them there.&lt;/p&gt;</comment>
                            <comment id="13133416" author="yuzhihong@gmail.com" created="Sat, 22 Oct 2011 15:29:28 +0000"  >&lt;p&gt;I think the following in the patch prevents review board from displaying changes in HBaseTestingUtility.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/src/test/data/hbase-4388-root.dir.tgz b/src/test/data/hbase-4388-root.dir.tgz
diff --git a/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java b/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13133428" author="yuzhihong@gmail.com" created="Sat, 22 Oct 2011 16:03:55 +0000"  >&lt;p&gt;In MetaMigrationRemovingHTD.isMigrated():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// Should &apos;never&apos; happen.
&lt;/span&gt;    LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unhandled version=&quot;&lt;/span&gt; + hriBytes[0]);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Since the above would never happen, we should ASSERT.&lt;/p&gt;

&lt;p&gt;MigratingVisitor.visit() has:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      HRegionInfo090x hri090 = getHRegionInfo090x(hriBytes);
      HTableDescriptor htd = hri090.getTableDesc();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.htds.contains(htd)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should we guard against IOE from getHRegionInfo090x() ? visit() is declared to throw IOE, but we shouldn&apos;t let one particular row ruin the migration process.&lt;br/&gt;
HashSet permits null element. I think we should check for null htd above (line 101).&lt;/p&gt;

&lt;p&gt;In MetaMigrationRemovingHTD.isMetaHRIUpdated():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; migrated = version &amp;gt;= HConstants.META_VERSION;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think we should introduce another constant in HConstants which signifies Meta HRI update status because META_VERSION represents the current version of the meta table and may be incremented in the future.&lt;/p&gt;</comment>
                            <comment id="13133475" author="stack" created="Sat, 22 Oct 2011 20:41:46 +0000"  >&lt;blockquote&gt;&lt;p&gt;Since the above would never happen, we should ASSERT.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agree.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;should we guard against IOE from getHRegionInfo090x() ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I thought about that.  We check beforehand byte array make some sense before going in here.  Let me do it.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think we should introduce another constant in HConstants which signifies Meta HRI update status because META_VERSION represents the current version of the meta table and may be incremented in the future.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Not sure I follow.  MetaMigrationRemovingHTD is deprecated already.  Its going away before we release 0.94.  So check will be elsewhere when META_VERSION changes.  Thats one aspect.  Also, when META_VERSION is incremented the same logic should hold; i.e. if the version of meta is that of the current META_VERSION, then the table has been migrated &amp;#8211; else no.&lt;/p&gt;

&lt;p&gt;Thanks for review Ted.  Will post new patch addressing your comments (minus the tgz this time).&lt;/p&gt;</comment>
                            <comment id="13133478" author="jiraposter@reviews.apache.org" created="Sat, 22 Oct 2011 20:58:32 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2539/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2539/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-10-22 20:59:14.138541)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Address Ted feedback (I don&apos;t include tgz file in this diff)&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Changes name of column in root that holds current version of the meta table from info:metamigrated to info:v.&lt;/p&gt;

&lt;p&gt;Current version of meta table is 0 (short).  The absence of the column means table has not been migrated.&lt;/p&gt;

&lt;p&gt;Upped version on HRegionInfo and made its readFields able to deserialze the older pre-0.92 HRegionInfo.&lt;/p&gt;

&lt;p&gt;Change MetaReader#putToCatalogTable so it no longer takes a region name.  Was redundant (needed this method for migration).&lt;/p&gt;

&lt;p&gt;Removed a bunch of MetaMigrationRemovingHTD.  Not needed any more or was duplicated code and I axed it.&lt;/p&gt;

&lt;p&gt;Found a bug in that we didn&apos;t migrate info:splitA or info:splitB if present &amp;#8211; i.e. if we had offlined parent from split going on when migration was happening, we&apos;d fail.&lt;/p&gt;

&lt;p&gt;Migration is more idempotenty now.  We look at the HRI bytes and if older version, we&apos;ll update (Removed the try to deserialize and catch exception stuff).&lt;/p&gt;

&lt;p&gt;Moved methods from HBaseTestingUtility and from Writables that had to do w/ migration exclusively, out and into MetaMigrationRemoveHTD migrating class (or into migration tests) so migration code all in one place rather than spread about (more to do)&lt;/p&gt;

&lt;p&gt;Changed MetaReader#isMetaTable to MetaReader#isRootTableRow.  Makes more sense now (needed migrating).&lt;/p&gt;

&lt;p&gt;Renamed TestMetaMigration as TestMetaMigrationRemovingHTD.  Also, made this test startup on top of a 0.90 hbase.rootdir to test it can migrate.&lt;/p&gt;

&lt;p&gt;Added TestMigrationFrom090To092&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-4388.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/hbase-4388&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/hbase-4388&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/HConstants.java 144f526 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/HRegionInfo.java e950df3 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java 6387df9 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/catalog/MetaMigrationRemovingHTD.java 0c1d221 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java f7f4d60 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java 91abb00 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java 12dfbcd &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/util/Writables.java f595af5 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java 6af3d35 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/client/TestMetaMigration.java 6cbf88c &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/client/TestMetaMigrationRemovingHTD.java PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/migration/TestMigrationFrom090To092.java PRE-CREATION &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2539/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2539/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Migration tests pass.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Michael&lt;/p&gt;
</comment>
                            <comment id="13133489" author="yuzhihong@gmail.com" created="Sat, 22 Oct 2011 21:29:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;MetaMigrationRemovingHTD is deprecated already. Its going away before we release 0.94&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think the assumption in the above statement is that users (of 0.20.6 and 0.89) would upgrade through 0.92 before upgrading to 0.94 (when 0.94 is released).&lt;br/&gt;
Not carrying the burden of migration logic is good for development. On the other hand, it is not convenient for users.&lt;br/&gt;
I am fine with the above assumption. We just need to explicitly state it somewhere.&lt;/p&gt;

&lt;p&gt;Minor comment:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.htds.add(htd);
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getMasterFileSystem().createTableDescriptor(htd);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think the order of the above two statements should be reverted because the second call may throw IOException.&lt;/p&gt;</comment>
                            <comment id="13133492" author="stack" created="Sat, 22 Oct 2011 21:37:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think the order of the above two statements should be reverted because the second call may throw IOException.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sounds good.  Will do in next patch.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think the assumption in the above statement is that users (of 0.20.6 and 0.89) would upgrade through 0.92 before upgrading to 0.94 (when 0.94 is released).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Its first sentence in &apos;General Migration Notes&apos; on our migration page: &lt;a href=&quot;http://wiki.apache.org/hadoop/Hbase/HowToMigrate&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/hadoop/Hbase/HowToMigrate&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13134610" author="stack" created="Mon, 24 Oct 2011 23:07:56 +0000"  >&lt;p&gt;All unit tests passed for me.&lt;/p&gt;</comment>
                            <comment id="13135743" author="stack" created="Wed, 26 Oct 2011 06:20:48 +0000"  >&lt;p&gt;I just started 0.92 over a crashed out 0.90 cluster that had 700 regions in it.  Migration looks like it went off fine (Excepting &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4681&quot; title=&quot;StringIndexOutOfBoundsException parsing Hostname&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4681&quot;&gt;&lt;del&gt;HBASE-4681&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;I&apos;m going to commit this in next day or so so reviews appreciated (I&apos;ll address Ted&apos;s last comment on commit).&lt;/p&gt;</comment>
                            <comment id="13137555" author="stack" created="Thu, 27 Oct 2011 21:07:14 +0000"  >&lt;p&gt;Committed to TRUNK and 0.92 branch.  Made Ted&apos;s last suggested change changing order of two lines on commit.&lt;/p&gt;</comment>
                            <comment id="13137696" author="hudson" created="Thu, 27 Oct 2011 23:00:32 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #86 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/86/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/86/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4388&quot; title=&quot;Second start after migration from 90 to trunk crashes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4388&quot;&gt;&lt;del&gt;HBASE-4388&lt;/del&gt;&lt;/a&gt; Second start after migration from 90 to trunk crashes&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/HRegionInfo.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/catalog/MetaMigrationRemovingHTD.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/util/Writables.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/data&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/data/hbase-4388-root.dir.tgz&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/client/TestMetaMigration.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/client/TestMetaMigrationRemovingHTD.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/migration&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/migration/TestMigrationFrom090To092.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13137892" author="hudson" created="Fri, 28 Oct 2011 02:17:05 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2375 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2375/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2375/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4388&quot; title=&quot;Second start after migration from 90 to trunk crashes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4388&quot;&gt;&lt;del&gt;HBASE-4388&lt;/del&gt;&lt;/a&gt; Second start after migration from 90 to trunk crashes&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HRegionInfo.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/catalog/MetaEditor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/catalog/MetaMigrationRemovingHTD.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/Writables.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/data&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/data/hbase-4388-root.dir.tgz&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestMetaMigration.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestMetaMigrationRemovingHTD.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/migration&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/migration/TestMigrationFrom090To092.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13443496" author="hudson" created="Tue, 28 Aug 2012 20:24:22 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3290 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3290/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3290/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6052&quot; title=&quot;Convert .META. and -ROOT- content to pb&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6052&quot;&gt;&lt;del&gt;HBASE-6052&lt;/del&gt;&lt;/a&gt; Convert .META. and &lt;del&gt;ROOT&lt;/del&gt; content to pb; ADDENDUM REMOVE UNUSED hbase-4388-root.dir.tgz (Revision 1378256)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;/p&gt;</comment>
                            <comment id="13443662" author="hudson" created="Tue, 28 Aug 2012 23:41:25 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #153 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/153/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/153/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6052&quot; title=&quot;Convert .META. and -ROOT- content to pb&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6052&quot;&gt;&lt;del&gt;HBASE-6052&lt;/del&gt;&lt;/a&gt; Convert .META. and &lt;del&gt;ROOT&lt;/del&gt; content to pb; ADDENDUM REMOVE UNUSED hbase-4388-root.dir.tgz (Revision 1378256)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;/p&gt;</comment>
                            <comment id="15016617" author="lars_francke" created="Fri, 20 Nov 2015 11:55:56 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                                                <inwardlinks description="is broken by">
                                        <issuelink>
            <issuekey id="12509741">HBASE-3970</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12494941" name="4388-v2.txt" size="2418" author="yuzhihong@gmail.com" created="Sat, 17 Sep 2011 20:16:24 +0000"/>
                            <attachment id="12496509" name="4388-v3.txt" size="3067" author="yuzhihong@gmail.com" created="Mon, 26 Sep 2011 17:22:44 +0000"/>
                            <attachment id="12499629" name="4388-v4.txt" size="34094" author="stack" created="Wed, 19 Oct 2011 03:55:47 +0000"/>
                            <attachment id="12494376" name="4388.txt" size="808" author="yuzhihong@gmail.com" created="Wed, 14 Sep 2011 04:08:56 +0000"/>
                            <attachment id="12500311" name="hbase-4388-root.dir.tgz" size="245058" author="stack" created="Sat, 22 Oct 2011 07:41:15 +0000"/>
                            <attachment id="12498433" name="hbase-master-nase.log" size="116664" author="svarma" created="Mon, 10 Oct 2011 16:01:18 +0000"/>
                            <attachment id="12494297" name="meta.tgz" size="29869" author="tlipcon" created="Tue, 13 Sep 2011 19:41:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 14 Sep 2011 04:00:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3213</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hqov:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101586</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>