<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:28:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5516/HBASE-5516.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5516] GZip leading to memory leak in 0.90.  Fix similar to HBASE-5387 needed for 0.90.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5516</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Usage of GZip is leading to resident memory leak in 0.90.&lt;br/&gt;
We need to have something similar to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5387&quot; title=&quot;Reuse compression streams in HFileBlock.Writer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5387&quot;&gt;&lt;del&gt;HBASE-5387&lt;/del&gt;&lt;/a&gt; in 0.90. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12545055">HBASE-5516</key>
            <summary>GZip leading to memory leak in 0.90.  Fix similar to HBASE-5387 needed for 0.90.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="ram_krish">ramkrishna.s.vasudevan</reporter>
                        <labels>
                    </labels>
                <created>Sat, 3 Mar 2012 17:08:18 +0000</created>
                <updated>Mon, 22 Feb 2016 09:52:40 +0000</updated>
                            <resolved>Tue, 30 Dec 2014 04:33:44 +0000</resolved>
                                    <version>0.90.5</version>
                                    <fixVersion>0.90.7</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13221647" author="ram_krish" created="Sat, 3 Mar 2012 17:11:40 +0000"  >&lt;p&gt;We have an internal patch.  But it requires some more formatting while writing the header.  Will upload once done and tested.&lt;/p&gt;</comment>
                            <comment id="13222411" author="ram_krish" created="Mon, 5 Mar 2012 15:48:54 +0000"  >&lt;p&gt;Test cases are running. Will upload the patch after that.&lt;/p&gt;</comment>
                            <comment id="13223288" author="lakshman" created="Tue, 6 Mar 2012 14:43:04 +0000"  >&lt;p&gt;Please review the patch and share your comments.&lt;/p&gt;</comment>
                            <comment id="13223522" author="zhihyu@ebaysf.com" created="Tue, 6 Mar 2012 18:37:35 +0000"  >&lt;p&gt;Can test results be described here ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.compressAlgo.equals(Compression.Algorithm.GZ) &amp;amp;&amp;amp; blockBegin &amp;gt; 0) {
+        blockBegin -= HEADER_SIZE;
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;What if blockBegin is &amp;gt; 0 but less than HEADER_SIZE ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (compressionBos == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.compressAlgo.equals(Compression.Algorithm.GZ)) {
+          createCompressionStream();
+        }
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The nested if statements can be condensed into one if statement.&lt;/p&gt;</comment>
                            <comment id="13224263" author="ram_krish" created="Wed, 7 Mar 2012 13:01:07 +0000"  >&lt;p&gt;We are facing the same problem in the 0.90 also when using GZIP. Below is a snapshot of the &apos;top&apos; command&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
13236 root      20   0 21.9g  21g  12m S    1 68.4 450:56.37 /opt/nn/jdk1.6.0_22
13236 root      20   0 21.9g  21g  12m S    1 68.4 450:56.71 /opt/nn/jdk1.6.0_22
13236 root      20   0 21.9g  21g  12m S    1 68.4 450:57.06 /opt/nn/jdk1.6.0_22
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This value we got before the patch was created.  After the patch no leak was found. Anyway precise reports will update tomorrow as today our test clusters are busy with other task.&lt;br/&gt;
Configured heap is 4G for RS.&lt;/p&gt;</comment>
                            <comment id="13225202" author="ram_krish" created="Thu, 8 Mar 2012 13:41:13 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
top - 08:41:24 up 28 days, 17:46,  4 users,  load average: 3.23, 2.73, 2.52
Tasks: 308 total,   1 running, 307 sleeping,   0 stopped,   0 zombie
Cpu(s): 10.3%us,  2.4%sy,  0.0%ni, 78.8%id,  7.8%wa,  0.0%hi,  0.7%si,  0.0%st
Mem:     48264M total,    48125M used,      139M free,     4370M buffers
Swap:    51199M total,       53M used,    51146M free,    20926M cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                                                                              
30934 root      20   0 23.2g  20g  12m S  144 42.6 314:25.74 java                                                                                                                  
30717 root      20   0 4859m 200m  10m S   50  0.4  66:09.54 java                                                                                                                  
 7351 root      20   0     0    0    0 D    2  0.0  14:30.49 kjournald                                                                                                             
   38 root      20   0     0    0    0 S    1  0.0   0:36.31 events/3                                                                                                              
  127 root      20   0     0    0    0 S    1  0.0  48:30.54 kswapd0                                                                                                               
  128 root      20   0     0    0    0 S    1  0.0  47:48.75 kswapd1                                                                                                               
 4877 root      20   0  8968  400  260 S    1  0.0   8:48.69 irqbalance                                                                                                            
12644 root      20   0  8900 1356  852 R    1  0.0   0:00.91 top                  

====================================================

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above reports are before patch.  You can see the native memory going beyond 20g.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
top - 13:41:13 up 28 days, 22:46,  4 users,  load average: 0.00, 0.02, 0.00
Tasks: 298 total,   1 running, 297 sleeping,   0 stopped,   0 zombie
Cpu(s):  0.0%us,  0.0%sy,  0.0%ni, 99.9%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st
Mem:     48264M total,    27960M used,    20304M free,     4861M buffers
Swap:    51199M total,       53M used,    51146M free,    12556M cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                                                                              
 6822 root      20   0  382m 7916 4116 S    0  0.0  31:22.40 nautilus                                                                                                              
13197 root      20   0 4828m 189m  10m S    0  0.4  60:49.90 java                                                                                                                  
13424 root      20   0 8901m 8.1g  12m S    0 17.2 407:56.80 java                                                                                                                  
27929 root      20   0  3620 1072  600 S    0  0.0   0:05.99 nmon                                                                                                                  
28225 root      20   0  8900 1344  856 R    0  0.0   0:00.04 top                                                                                                                   
    1 root      20   0 10376  340  304 S    0  0.0   0:13.82 init                                                                                                                  
    2 root      20   0     0    0    0 S    0  0.0   0:00.25 kthreadd                                                                                                              
    3 root      RT   0     0    0    0 S    0  0.0   0:01.22 migration/0                                                                                                           
    4 root      20   0     0    0    0 S    0  0.0   2:45.12 ksoftirqd/0                                                                                                           
    5 root      RT   0     0    0    0 S    0  0.0   0:00.66 migration/1                                                                                                           
    6 root      20   0     0    0    0 S    0  0.0   0:22.16 ksoftirqd/1 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In the above the process with 8.1 g is the RS process and we can see there is no increase.&lt;/p&gt;

&lt;p&gt;The test was done over a period of 3 hours with write load.&lt;/p&gt;</comment>
                            <comment id="13225257" author="ram_krish" created="Thu, 8 Mar 2012 15:19:40 +0000"  >&lt;p&gt;Updated patch addressing comments.&lt;/p&gt;</comment>
                            <comment id="13225267" author="ram_krish" created="Thu, 8 Mar 2012 15:49:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;What if blockBegin is &amp;gt; 0 but less than HEADER_SIZE ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This will not happen Ted. The new block will be created only after one block is completed.  So the blcok begin should be &amp;gt; 0 and not less than header size.  Correct me if am wrong.  &lt;/p&gt;</comment>
                            <comment id="13225304" author="zhihyu@ebaysf.com" created="Thu, 8 Mar 2012 16:56:13 +0000"  >&lt;p&gt;+1 on patch v3.&lt;/p&gt;</comment>
                            <comment id="13232759" author="ram_krish" created="Mon, 19 Mar 2012 17:44:43 +0000"  >&lt;p&gt;Pls review this patch.  Will commit it tomorrow if it is fine.&lt;/p&gt;</comment>
                            <comment id="13412389" author="jmhsieh" created="Thu, 12 Jul 2012 00:10:20 +0000"  >&lt;p&gt;Hm.. no tests, going to bump to 0.90.8 unless action taken. &lt;/p&gt;</comment>
                            <comment id="13412500" author="ram_krish" created="Thu, 12 Jul 2012 04:14:46 +0000"  >&lt;p&gt;@Jon&lt;br/&gt;
Currently am not working on 0.90.  So i may not find time on that.  But i would say that you can take a look at the patch? Actually in our 0.90 cluster while using GZIp compression we found memory leak frequently and that occured due to GZip Streams.&lt;br/&gt;
Thanks Jon.&lt;/p&gt;</comment>
                            <comment id="14260775" author="ram_krish" created="Tue, 30 Dec 2014 04:33:44 +0000"  >&lt;p&gt;0.90.x versions are obsolete. Resolving as &apos;won&apos;t fix&apos;.&lt;/p&gt;</comment>
                            <comment id="15156704" author="karthikshva123" created="Mon, 22 Feb 2016 09:52:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zhihyu%40ebaysf.com&quot; class=&quot;user-hover&quot; rel=&quot;zhihyu@ebaysf.com&quot;&gt;Ted Yu&lt;/a&gt;&lt;br/&gt;
  I&apos;d similar memory leak issue in regionserver process, VM and RSS memory continiously increasing 64MB.&lt;br/&gt;
  I&apos;m using CDH4-hbase 0.94.6 , Above fix are avialable the same and MALLOC_ARENA_MAX=4 was set in hbase-env.sh&lt;br/&gt;
  I&apos;ve huge write load and frequent minor compaction, We&apos;ve used GZip hfile compression.&lt;br/&gt;
  Max java regionserver heap size is 32GB.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;top - 14:28:30 up 201 days, 21:06,  3 users,  load average: 5.67, 3.72, 3.31
Tasks: 803 total,   1 running, 802 sleeping,   0 stopped,   0 zombie
Cpu(s):  8.3%us,  2.1%sy,  0.0%ni, 85.9%id,  3.5%wa,  0.0%hi,  0.1%si,  0.0%st
Mem:  65932340k total, 63961912k used,  1970428k free,  2394528k buffers
Swap: 29659132k total,    63532k used, 29595600k free,  1095268k cached

 PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
 57335 hbase     20   0 46.4g  44g 9296 S 98.2 70.9  13319:10 java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; [hbase@pb1hsl5-hslave ~]$  pmap -x 57335 | sort -k 3 -nr | more
total kB        48695984 46765792 46756512
00007ff312460000 33171072 33169464 33169464 rwx--    [ anon ]
000000004010a000 1448552 1448552 1448552 rwx--    [ anon ]
00007ff2d1810000  612120  603124  603124 rwx--    [ anon ]
00007ff2fadff000  383364  383364  383364 rwx--    [ anon ]
00007ff0e8000000  131072  131072  131072 rwx--    [ anon ]
00007ff218000000  131048  131048  131048 rwx--    [ anon ]
00007ff128000000  131068  131048  131048 rwx--    [ anon ]
00007ff230000000  131044  131044  131044 rwx--    [ anon ]
00007ff000000000  131036  131036  131036 rwx--    [ anon ]
00007fefe0000000  131060  131036  131036 rwx--    [ anon ]
00007ff23c000000   65536   65536   65536 rwx--    [ anon ]
00007ff0a4000000   65536   65536   65536 rwx--    [ anon ]
00007ff054000000   65536   65536   65536 rwx--    [ anon ]
00007ff01c000000   65536   65536   65536 rwx--    [ anon ]
00007fefb4000000   65536   65536   65536 rwx--    [ anon ]
00007ff22c000000   65532   65532   65532 rwx--    [ anon ]
00007ff110000000   65532   65532   65532 rwx--    [ anon ]
00007ff10c000000   65532   65532   65532 rwx--    [ anon ]
00007ff0b8000000   65532   65532   65532 rwx--    [ anon ]
00007ff09c000000   65532   65532   65532 rwx--    [ anon ]
00007feff8000000   65532   65532   65532 rwx--    [ anon ]
00007ff250000000   65528   65528   65528 rwx--    [ anon ]
--More--
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;$pmap -x 57335 | awk &apos;{print $3}&apos; | awk &apos;{ if($i&amp;lt;65536 &amp;amp;&amp;amp; $i&amp;gt;64000) print $i}&apos; | wc -l
146
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Will MALLOC_AREANA create exactly 65536KB? &lt;br/&gt;
Regionserver process has many anon pages, size varying from 64000 to 65536 KB that shown above.&lt;/p&gt;

&lt;p&gt;Appreciate any help you can provide!!&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12517242" name="HBASE-5516_2_0.90.patch" size="12223" author="lakshman" created="Tue, 6 Mar 2012 14:43:04 +0000"/>
                            <attachment id="12517568" name="HBASE-5516_3_0.90.patch" size="12208" author="ram_krish" created="Thu, 8 Mar 2012 15:19:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 6 Mar 2012 14:43:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230241</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            42 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02d67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11735</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>