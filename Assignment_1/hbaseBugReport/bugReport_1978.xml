<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:57:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1978/HBASE-1978.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1978] Change the range/block index scheme from [start,end) to (start, end], and index range/block by endKey, specially in HFile</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1978</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From the code review of HFile (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1818&quot; title=&quot;HFile code review and refinement&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1818&quot;&gt;&lt;del&gt;HBASE-1818&lt;/del&gt;&lt;/a&gt;), we found the HFile allows duplicated key. But the old implementation would lead to missing of duplicated key when seek and scan, when the duplicated key span multiple blocks.&lt;/p&gt;

&lt;p&gt;We provide a patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1841&quot; title=&quot;If multiple of same key in an hfile and they span blocks, may miss the earlier keys on a lookup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1841&quot;&gt;&lt;del&gt;HBASE-1841&lt;/del&gt;&lt;/a&gt; is&apos;t step1) to resolve above issue. This patch modified HFile.Writer to avoid generating a problem hfile with above cross-block duplicated key. It only start a new block when current appending key is different from the last appended key. But it still has a rish when the user of HFile.Writer append many same duplicated key which lead to a very large block and need much memory or Out-of-memory.&lt;/p&gt;

&lt;p&gt;The current HFile&apos;s block-index use startKey to index a block, i.e. the range/block index scheme is [startKey,endKey).&lt;/p&gt;

&lt;p&gt;As refering to the section 5.1 of the Google Bigtable paper.&lt;/p&gt;

&lt;p&gt;&quot;The METADATA table stores the location of a tablet under a row key that is an encoding of the tablet&apos;s table identifer and its end row.&quot;&lt;/p&gt;

&lt;p&gt;The theory of Bigtable&apos;s METADATA is same as the BlockIndex in a SSTable or HFile, so we should use EndKey in HFile&apos;s BlockIndex. In my experiences of Hypertable, the METADATA is also &quot;tableID:endRow&quot;.&lt;/p&gt;

&lt;p&gt;We would change the index scheme in HFile, from &lt;span class=&quot;error&quot;&gt;&amp;#91;startKey,endKey) to (startKey,endKey&amp;#93;&lt;/span&gt;. And change the binary search method to meet this index scheme.&lt;/p&gt;

&lt;p&gt;This change can resolve above duplicated-key issue. &lt;/p&gt;

&lt;p&gt;Note:&lt;br/&gt;
The totally fix need to modify many modules in HBase, seems include HFile, META schema, some internal code, etc.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12440605">HBASE-1978</key>
            <summary>Change the range/block index scheme from [start,end) to (start, end], and index range/block by endKey, specially in HFile</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="schubertzhang">Schubert Zhang</assignee>
                                    <reporter username="schubertzhang">Schubert Zhang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 13 Nov 2009 10:35:02 +0000</created>
                <updated>Tue, 12 Mar 2013 09:19:43 +0000</updated>
                                                                            <component>io</component>
                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12777442" author="schubertzhang" created="Fri, 13 Nov 2009 10:46:24 +0000"  >&lt;p&gt;This patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1978&quot; title=&quot;Change the range/block index scheme from [start,end) to (start, end], and index range/block by endKey, specially in HFile&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1978&quot;&gt;HBASE-1978&lt;/a&gt;-HFile-v1.patch) is only for HFile.java.  The HBase does not work with only this patch, it need other modules coordination.&lt;/p&gt;

&lt;p&gt;If you use HFile to do something else, you can use this patch.&lt;/p&gt;</comment>
                            <comment id="13233094" author="schubertzhang" created="Tue, 20 Mar 2012 01:27:48 +0000"  >&lt;p&gt;refers to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2600&quot; title=&quot;Change how we do meta tables; from tablename+STARTROW+randomid to instead, tablename+ENDROW+randomid&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2600&quot;&gt;HBASE-2600&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13599855" author="schubertzhang" created="Tue, 12 Mar 2013 09:19:43 +0000"  >&lt;p&gt;We talk some about this issue there.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12435761">HBASE-1841</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12465201">HBASE-2600</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12424829" name="HBASE-1978-HFile-v1.patch" size="14176" author="schubertzhang" created="Fri, 13 Nov 2009 10:46:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32342</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 40 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hg2n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99866</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>HFile, METADATA, INDEX</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>