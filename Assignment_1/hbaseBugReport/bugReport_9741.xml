<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:07:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9741/HBASE-9741.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9741] Remove hbase.regions.slop from hbase-default.xml</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9741</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Different balancers have different slop default values.  We should remove hbase.regions.slop from hbase-default.xml&lt;/p&gt;</description>
                <environment></environment>
        <key id="12673177">HBASE-9741</key>
            <summary>Remove hbase.regions.slop from hbase-default.xml</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="eclark">Elliott Clark</reporter>
                        <labels>
                            <label>beginner</label>
                    </labels>
                <created>Thu, 10 Oct 2013 05:32:53 +0000</created>
                <updated>Sun, 28 Sep 2014 05:19:08 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13791438" author="jmspaggi" created="Thu, 10 Oct 2013 12:32:47 +0000"  >&lt;p&gt;If we remove it from the hbase-default.xml then we need, at least, to add it into the documentation because I think it&apos;s not there today.&lt;/p&gt;</comment>
                            <comment id="14077021" author="ranjana_rajendran" created="Mon, 28 Jul 2014 22:24:11 +0000"  >&lt;p&gt;Basic patch to remove hbase.regions.slop from hbase-default.xml&lt;/p&gt;</comment>
                            <comment id="14077105" author="ranjana_rajendran" created="Mon, 28 Jul 2014 23:13:04 +0000"  >&lt;p&gt;We are examining the different tests and the codebase at large for uses of this property.&lt;br/&gt;
One notable example we found was: TestRegionRebalancing.java, and there is a note suggesting that we rewrite the test to not incorporate slop.&lt;br/&gt;
We will continue looking through the code for other places where this may impact things.&lt;/p&gt;</comment>
                            <comment id="14077234" author="ranjana_rajendran" created="Tue, 29 Jul 2014 01:04:03 +0000"  >&lt;p&gt;TestRegionsRebalancing.java seem to set the default value of hadoop.regions.slop as 0.1f which does not work. The default value for testing need to be 0.2f. &lt;/p&gt;</comment>
                            <comment id="14077263" author="eclark" created="Tue, 29 Jul 2014 01:46:46 +0000"  >&lt;p&gt;Why does TestRegionRebalancing not work ? The set config in TestRegionRebalancing should override what&apos;s in the xml.&lt;/p&gt;</comment>
                            <comment id="14078049" author="esteban" created="Tue, 29 Jul 2014 17:37:40 +0000"  >&lt;p&gt;Why not rename the &lt;tt&gt;hbase.regions.slop&lt;/tt&gt; initially to &lt;tt&gt;hbase.regions.balancer.base.slop&lt;/tt&gt; and add a new property for the StochasticLoadBalancer &lt;tt&gt;hbase.regions.balancer.stochastic.slop&lt;/tt&gt;. Then we can deprecate gracefully &lt;tt&gt;hbase.regions.slop&lt;/tt&gt; with a warning and still support the property for a while.&lt;/p&gt;</comment>
                            <comment id="14078153" author="eclark" created="Tue, 29 Jul 2014 18:42:39 +0000"  >&lt;p&gt;Because the stochastic balancer doesn&apos;t really use the slop in the same way.  It computes costs, so slop isn&apos;t really used to determine when a balance plan is good.&lt;/p&gt;</comment>
                            <comment id="14078156" author="esteban" created="Tue, 29 Jul 2014 18:45:19 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt; then it might be better to rename &lt;tt&gt;hbase.regions.slop&lt;/tt&gt; the the StochasticLoadBalancer to &lt;tt&gt;hbase.regions.stochastic.load.balancer.cost&lt;/tt&gt; and do not rename &lt;tt&gt;hbase.regions.slop&lt;/tt&gt; does it sounds good?&lt;/p&gt;</comment>
                            <comment id="14083251" author="ranjana_rajendran" created="Sat, 2 Aug 2014 00:38:49 +0000"  >&lt;p&gt;The parameter hbase.regions.slop is being used in several places. If the  default value of this parameter is not set, it is set to a specific value in those functions. Removing the default value for this parameter however does not seem meaningful. &lt;/p&gt;

&lt;p&gt;HConstants.java sets the string LOAD_BALANCER_SLOP_KEY to  &quot;hbase.regions.slop&quot; as a final value. This patch modifies all the calls  to get the value of hbase.regions.slop  to use HConstants. LOAD_BALANCER_SLOP_KEY.&lt;/p&gt;</comment>
                            <comment id="14083665" author="eclark" created="Sat, 2 Aug 2014 18:59:32 +0000"  >&lt;p&gt;Still need to remove it from the defaults xml.  Otherwise it&apos;s confusing to users on what the default actually it. The default will look to be whatever is in the xml but will actually be dependent on what balancer is being used.&lt;/p&gt;</comment>
                            <comment id="14091431" author="ranjana_rajendran" created="Fri, 8 Aug 2014 23:13:07 +0000"  >&lt;p&gt;With the default of 0.2f removed, the function TestRegionReBalancing.java,  sets the slop to 0.1f which makes this test fail. &lt;/p&gt;</comment>
                            <comment id="14091473" author="ranjana_rajendran" created="Sat, 9 Aug 2014 00:00:44 +0000"  >&lt;p&gt;I changed TestRegionReBalancing.java to use 0.2f as the default value and this passes the test.&lt;/p&gt;

&lt;p&gt;TestRegionReBalancing.java need to be rewritten for the new balancers which do not use the slop. Will appreciate any input how to rewrite this function for the new balancers.&lt;/p&gt;</comment>
                            <comment id="14109441" author="jmhsieh" created="Mon, 25 Aug 2014 18:18:03 +0000"  >&lt;p&gt;Something doesn&apos;t make sense, why does TestRegionRebalancing break with the values is removed from the conf?   Do you have an explanation &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=eclark&quot; class=&quot;user-hover&quot; rel=&quot;eclark&quot;&gt;Elliott Clark&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ranjana_rajendran&quot; class=&quot;user-hover&quot; rel=&quot;ranjana_rajendran&quot;&gt;Ranjana Rajendran&lt;/a&gt;?  (is this the expect thing that makes this confusing or was this unexpected?)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/hbase-server/src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java b/hbase-server/src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java
index fdcb00c..9252da9 100644
--- a/hbase-server/src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java
+++ b/hbase-server/src/test/java/org/apache/hadoop/hbase/TestRegionRebalancing.java
@@ -165,7 +165,8 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class TestRegionRebalancing {
     &lt;span class=&quot;code-comment&quot;&gt;// TODO: Fix &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; test.  Old balancer used to run with &apos;slop&apos;.  New
&lt;/span&gt;     &lt;span class=&quot;code-comment&quot;&gt;// balancer does not.
&lt;/span&gt;     &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; success = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
-    &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; slop = (&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)UTIL.getConfiguration().getFloat(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.regions.slop&quot;&lt;/span&gt;, 0.1f);
+    &lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt; slop = (&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)UTIL.getConfiguration().getFloat(HConstants.LOAD_BALANCER_SLOP_KEY, 0.2f);
+    
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (slop &amp;lt;= 0) slop = 1;
 
     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; 5; i++) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14109771" author="eclark" created="Mon, 25 Aug 2014 21:28:38 +0000"  >&lt;p&gt;This is part of what makes this confusing.  The stochastic balancer would work better with a smaller slop, however the test was written using the default slop value for the old balancer.&lt;/p&gt;</comment>
                            <comment id="14110079" author="jmhsieh" created="Tue, 26 Aug 2014 00:45:23 +0000"  >&lt;p&gt;I&apos;m still missing something &amp;#8211; we don&apos;t change the default balancer with this patch so I&apos;d assume the test would be the same still.  Does the test&apos;s have a problem where the value isn&apos;t passed in (unlikely) or the value is gathered by the balancers out of band? &lt;/p&gt;

&lt;p&gt;Is this a case where that configuration setting should be named differently for the two balancers but is conflated and causes very different behaviors?&lt;/p&gt;</comment>
                            <comment id="14110278" author="eclark" created="Tue, 26 Aug 2014 05:02:00 +0000"  >&lt;p&gt;The stochastic balancer should be using the smaller slop value. Removing the value from the defaults.xml just allows the smaller value that is specified as the default for the stochastic balancer to be used. However this test was not written with the smaller value in mind.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;we don&apos;t change the default balancer with this patch so I&apos;d assume the test would be the same still.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The test asserts that nothing should move; when in reality there might actually be a better fit. The larger slop stops the stochastic balancer from searching for the better fit. Removing the slop from the defaults just means that the test, which was previously written with the old balancer in mind, needs to be tweaked to pass with the new effective default.&lt;/p&gt;</comment>
                            <comment id="14150977" author="ranjana_rajendran" created="Sun, 28 Sep 2014 05:19:08 +0000"  >&lt;p&gt;The test was written for the old balancer and took the default value in defaults.xml which was 0.2f to prevent the stochastic balancer from searching for a new base. With this value of 0.2f removed from defaults.xml, was then taking the default value of 0.1f specified in the line (&quot;float slop = (float)UTIL.getConfiguration().getFloat(&quot;hbase.regions.slop&quot;, 0.1f);&quot;) which made the test fail as this made the balancer search for a better fit which was not the intention of this test.&lt;/p&gt;

&lt;p&gt;I would like to understand why this test is required, i.e. why is this test required to assert that regions are balanced using the function assertRegionsAreBalanced() ? If this test need to be rewritten, I would like to take up this task. Highly appreciate any input how to rewrite it different from the patch above. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12658277" name="HBASE-9741-v0.patch" size="804" author="ranjana_rajendran" created="Mon, 28 Jul 2014 22:24:11 +0000"/>
                            <attachment id="12658318" name="HBASE-9741-v1.patch" size="1601" author="ranjana_rajendran" created="Tue, 29 Jul 2014 01:04:03 +0000"/>
                            <attachment id="12659293" name="HBASE-9741-v3.patch" size="4286" author="ranjana_rajendran" created="Sat, 2 Aug 2014 00:38:49 +0000"/>
                            <attachment id="12660764" name="HBASE-9741-v4.patch" size="5090" author="ranjana_rajendran" created="Sat, 9 Aug 2014 00:06:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 10 Oct 2013 12:32:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352800</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 11 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1otr3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>353087</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>