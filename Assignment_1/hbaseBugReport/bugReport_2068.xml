<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:58:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2068/HBASE-2068.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2068] MetricsRate is missing &quot;registry&quot; parameter</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2068</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I am trying to get the graphing going using Edward Capriolo&apos;s great JMX to Cacti &lt;a href=&quot;http://www.jointhegrid.com/hadoop/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;guide&lt;/a&gt;. I checked and I am missing the request rate in the JMX MBean:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# sh 0_20/regionserver/RegionServerStatistics.sh service:jmx:rmi:///jndi/rmi://foobar:10102/jmxrmi controlRole mypass hadoop:name=RegionServerStatistics,service=RegionServer
storefiles:493 blockCacheFree:139771296 storefileIndexSizeMB:102 memstoreSizeMB:0 stores:658 blockCacheCount:8400 
regions:83 blockCacheHitRatio:0 blockCacheSize:717478944 atomicIncrementTimeNumOps:0 atomicIncrementTimeAvgTime:0 
atomicIncrementTimeMinTime:-1 atomicIncrementTimeMaxTime:0 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;I checked the code and the difference between requests and the other attributes is that MetricsRate does not register itself in the MetricsRegistry used by the dynamic MBean like for example the MetricsLongValue does.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12444010">HBASE-2068</key>
            <summary>MetricsRate is missing &quot;registry&quot; parameter</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="larsgeorge">Lars George</assignee>
                                    <reporter username="larsgeorge">Lars George</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Dec 2009 13:46:58 +0000</created>
                <updated>Fri, 12 Oct 2012 06:14:13 +0000</updated>
                            <resolved>Mon, 4 Jan 2010 21:02:15 +0000</resolved>
                                    <version>0.20.2</version>
                                    <fixVersion>0.20.3</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12793630" author="larsgeorge" created="Tue, 22 Dec 2009 14:52:44 +0000"  >&lt;p&gt;For this to work MetricsRate has to implement MetricsBase, just like MetricsLongValue etc. does. During creation of the MBean the MetricsDynamicMBeanBase iterates over the MetricsRegistry and declares the attributes dynamically. That is where the &quot;request&quot; falls off the plate. This only concerns JMX btw. as using the file or Ganglia  based context employs the MetricsRecord directly.&lt;/p&gt;</comment>
                            <comment id="12793774" author="stack" created="Tue, 22 Dec 2009 20:33:10 +0000"  >&lt;p&gt;@Gary Any comment on above?  Is it an oversight in the jmx hookup work?&lt;/p&gt;</comment>
                            <comment id="12795032" author="larsgeorge" created="Tue, 29 Dec 2009 09:45:35 +0000"  >&lt;p&gt;Another inconsistency is that MasterMetrics uses a MetricsIntValue &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /*
   * Count of requests to the cluster since last call to metrics update
   */
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; MetricsIntValue cluster_requests =
    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MetricsIntValue(&lt;span class=&quot;code-quote&quot;&gt;&quot;cluster_requests&quot;&lt;/span&gt;, registry);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the RegionsServerMetrics uses a MetricsRate class&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /*
   * Count of requests to the regionservers since last call to metrics update
   */
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; MetricsRate requests = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MetricsRate(&lt;span class=&quot;code-quote&quot;&gt;&quot;requests&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I suggest after fixing MetricsRate to replace the MasterMetrics one with it as well.&lt;/p&gt;

&lt;p&gt;I am also wondering if it would have been better to call it MetricsIntRate to indicate the size of the internal counter.&lt;/p&gt;</comment>
                            <comment id="12795364" author="larsgeorge" created="Wed, 30 Dec 2009 17:47:44 +0000"  >&lt;p&gt;Patch adds MetricsRate support for adding itself to the MetricsRegistry and also exchanged the MetricsIntValue in MasterMetrics for the MetricsRate class.&lt;/p&gt;</comment>
                            <comment id="12795376" author="jdcryans" created="Wed, 30 Dec 2009 18:29:14 +0000"  >&lt;p&gt;Looks good, committed to trunk and branch.&lt;/p&gt;</comment>
                            <comment id="12795446" author="ghelmling" created="Wed, 30 Dec 2009 20:56:18 +0000"  >&lt;p&gt;It looks like MetricsRate is not going to work with the Hadoop dynamic MBean support for JMX&lt;/p&gt;

&lt;p&gt;Trying out this patch, I get this message in logs:&lt;br/&gt;
2009-12-30 14:43:45,010 ERROR org.apache.hadoop.metrics.MetricsUtil: unknown metrics type: org.apache.hadoop.hbase.metrics.MetricsRate&lt;/p&gt;

&lt;p&gt;and the requests attributes do not show up in JConsole for the RS or master stats.  Traced the log message back to org.apache.hadoop.metrics.util.MetricsDynamicMBeanBase:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (MetricsBase o : metricsRegistry.getMetricsList()) {

      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (MetricsTimeVaryingRate.class.isInstance(o)) {
      ...
      }  &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( MetricsIntValue.class.isInstance(o) || MetricsTimeVaryingInt.class.isInstance(o) ) {
      ...
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ( MetricsLongValue.class.isInstance(o) || MetricsTimeVaryingLong.class.isInstance(o) ) {
      ...
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        MetricsUtil.LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;unknown metrics type: &quot;&lt;/span&gt; + o.getClass().getName());
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So for this to work with JMX, we&apos;ll need to extend MetricsDynamicMBeanBase with another class that understands MetricsRate.  I&apos;ll pull together a patch for that.&lt;/p&gt;</comment>
                            <comment id="12795457" author="larsgeorge" created="Wed, 30 Dec 2009 21:42:11 +0000"  >&lt;p&gt;Thanks Gary! Another option would be to simply use the same MetricsIntValue plus reset to zero as the MasterMetrics employed. That does work with what Hadoop has now.&lt;/p&gt;</comment>
                            <comment id="12795458" author="larsgeorge" created="Wed, 30 Dec 2009 21:43:14 +0000"  >&lt;p&gt;Reopened to address issue found by Gary. As this can be fixed quite quickly one way or the other I reopened this issue.&lt;/p&gt;</comment>
                            <comment id="12795877" author="ghelmling" created="Sat, 2 Jan 2010 17:55:48 +0000"  >&lt;p&gt;This patch adds JMX support for MetricsRate instances, by adding a MetricsMBeanBase class which understands HBase metrics classes.&lt;/p&gt;</comment>
                            <comment id="12795879" author="ghelmling" created="Sat, 2 Jan 2010 17:57:18 +0000"  >&lt;p&gt;Patch adding MetricsMBeanBase to support exporting MetricsRate under JMX.&lt;/p&gt;</comment>
                            <comment id="12795884" author="ghelmling" created="Sat, 2 Jan 2010 18:25:00 +0000"  >&lt;p&gt;Previous patch was missing the new MetricsMBeanBase class and unit test&lt;/p&gt;</comment>
                            <comment id="12795886" author="ghelmling" created="Sat, 2 Jan 2010 18:28:54 +0000"  >&lt;p&gt;Patch against trunk adding MetricsMBeanBase and unit test&lt;/p&gt;</comment>
                            <comment id="12795926" author="larsgeorge" created="Sat, 2 Jan 2010 23:12:57 +0000"  >&lt;p&gt;Fantastic Gary, I give that a shot asap and report back. &lt;/p&gt;</comment>
                            <comment id="12796319" author="larsgeorge" created="Mon, 4 Jan 2010 19:41:27 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Works great! There are few now obsolete imports, like&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.metrics.util.MetricsDynamicMBeanBase;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;in the changed Statistics classes. Could remove on commit.&lt;/p&gt;

&lt;p&gt;Otherwise please commit.&lt;/p&gt;</comment>
                            <comment id="12796355" author="stack" created="Mon, 4 Jan 2010 21:02:15 +0000"  >&lt;p&gt;Committed.  Thanks for the patches lads.   I removed the unused import.  Added a couple of licenses too.   Excellent.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12429145" name="HBASE-2068-0.20.patch" size="4986" author="larsgeorge" created="Wed, 30 Dec 2009 17:47:44 +0000"/>
                            <attachment id="12429278" name="HBASE-2068-2.patch" size="10920" author="ghelmling" created="Sat, 2 Jan 2010 18:28:54 +0000"/>
                            <attachment id="12429277" name="HBASE-2068-2_0.20.patch" size="10920" author="ghelmling" created="Sat, 2 Jan 2010 18:25:00 +0000"/>
                            <attachment id="12429144" name="HBASE-2068.patch" size="5003" author="larsgeorge" created="Wed, 30 Dec 2009 17:47:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 22 Dec 2009 20:33:10 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26128</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 50 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08tgv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49374</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Converts MasterStatistics &amp;quot;cluster_requests&amp;quot; attribute to a MetricsRate value (computed as requests / sec).  Also adds a &amp;quot;requests&amp;quot; attribute to RegionServerStatistics MBean, also as a MetricsRate value.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>