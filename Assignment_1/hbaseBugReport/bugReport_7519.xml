<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:46:32 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7519/HBASE-7519.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7519] Support level compaction</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7519</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The level compaction algorithm may help HBase for some use cases, for example, read heavy loads (especially, just one version is used), relative small key space updated frequently.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12626643">HBASE-7519</key>
            <summary>Support level compaction</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jxiang">Jimmy Xiang</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Jan 2013 20:25:31 +0000</created>
                <updated>Tue, 1 Sep 2015 17:48:47 +0000</updated>
                                                                            <component>Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>20</watches>
                                                                                                            <comments>
                            <comment id="13547245" author="jmhsieh" created="Tue, 8 Jan 2013 20:48:45 +0000"  >&lt;p&gt;Do you have some links that explain what level compaction means? &lt;/p&gt;</comment>
                            <comment id="13547265" author="jxiang" created="Tue, 8 Jan 2013 21:06:50 +0000"  >&lt;p&gt;Here is some details about the leveldb level compaction:&lt;br/&gt;
&lt;a href=&quot;http://leveldb.googlecode.com/svn/trunk/doc/impl.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://leveldb.googlecode.com/svn/trunk/doc/impl.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Cassandra supports level compaction too:&lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;http://www.datastax.com/dev/blog/leveled-compaction-in-apache-cassandra&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.datastax.com/dev/blog/leveled-compaction-in-apache-cassandra&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.datastax.com/dev/blog/when-to-use-leveled-compaction&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.datastax.com/dev/blog/when-to-use-leveled-compaction&lt;/a&gt;&lt;/p&gt;
</comment>
                            <comment id="13547270" author="jxiang" created="Tue, 8 Jan 2013 21:10:31 +0000"  >&lt;p&gt;Added is some notes I did in looking into level compaction performance.  It could be very rough.&lt;/p&gt;</comment>
                            <comment id="13547468" author="enis" created="Wed, 9 Jan 2013 00:31:30 +0000"  >&lt;p&gt;Linking relavant &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7055&quot; title=&quot;port HBASE-6371 tier-based compaction from 0.89-fb to trunk (with changes)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7055&quot;&gt;&lt;del&gt;HBASE-7055&lt;/del&gt;&lt;/a&gt;. LevelDB compactions were discussed there to some extend.&lt;/p&gt;

&lt;p&gt;In general, I like the idea, and for some use cases, guaranteeing an upper bound on the number of store files touched on the read side will definitely help.&lt;/p&gt;</comment>
                            <comment id="13547505" author="jxiang" created="Wed, 9 Jan 2013 01:14:50 +0000"  >&lt;p&gt;Assign to me for now since I am thinking how to implement it.  Please let me know if someone is interested to do it too.&lt;/p&gt;</comment>
                            <comment id="13547508" author="jxiang" created="Wed, 9 Jan 2013 01:18:31 +0000"  >&lt;p&gt;Yes, it relates to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7055&quot; title=&quot;port HBASE-6371 tier-based compaction from 0.89-fb to trunk (with changes)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7055&quot;&gt;&lt;del&gt;HBASE-7055&lt;/del&gt;&lt;/a&gt;.  We need to support pluggable compaction policy/algorithm (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7516&quot; title=&quot;Make compaction policy pluggable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7516&quot;&gt;&lt;del&gt;HBASE-7516&lt;/del&gt;&lt;/a&gt;) so that we can play with each one and choose the right one per the load.&lt;/p&gt;

&lt;p&gt;It will be even great if we can dynamically tune/choose a proper one.&lt;/p&gt;</comment>
                            <comment id="13547539" author="enis" created="Wed, 9 Jan 2013 02:13:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;It will be even great if we can dynamically tune/choose a proper one.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sergey is doing the basic blocks of managing global/per-table/per-cf configuration in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7236&quot; title=&quot;add per-table/per-cf configuration via metadata&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7236&quot;&gt;&lt;del&gt;HBASE-7236&lt;/del&gt;&lt;/a&gt;. After that, we can start to think about &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5678&quot; title=&quot;Dynamic configuration capability for Hbase.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5678&quot;&gt;&lt;del&gt;HBASE-5678&lt;/del&gt;&lt;/a&gt;. However, even without the dynamic config, we should be able to tune the parameters by rolling reopen for the regions. &lt;/p&gt;</comment>
                            <comment id="13547558" author="sershe" created="Wed, 9 Jan 2013 02:35:30 +0000"  >&lt;p&gt;From the discussion today; from my understanding leveldb key ranges in different files may overlap between levels; that means that compaction for a range must do something with the leftover bits of the files, or keep old files for other ranges.&lt;br/&gt;
E.g. if I have two levels somewhere (in no particular order) - lN with [1,5), &lt;span class=&quot;error&quot;&gt;&amp;#91;6, 10&amp;#93;&lt;/span&gt; files and lM with [1, 4), [4, 7), &lt;span class=&quot;error&quot;&gt;&amp;#91;8, 10&amp;#93;&lt;/span&gt; files, compaction for &lt;span class=&quot;error&quot;&gt;&amp;#91;4, 7&amp;#93;&lt;/span&gt; must include both of the lN files, and produce some parts of them, or keep them, for the reads from other ranges. If instead it uses the largest overlapping range to avoid only using parts of the files, all ranges would eventually merge.&lt;br/&gt;
That would mean Compactor and other things also needs to change significantly (and become pluggable?) afaisee.&lt;/p&gt;</comment>
                            <comment id="13547559" author="sershe" created="Wed, 9 Jan 2013 02:35:57 +0000"  >&lt;p&gt;[4, 7)&lt;/p&gt;</comment>
                            <comment id="13548940" author="jxiang" created="Wed, 9 Jan 2013 20:10:00 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;, you are right.  As I mentioned in the RB for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7516&quot; title=&quot;Make compaction policy pluggable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7516&quot;&gt;&lt;del&gt;HBASE-7516&lt;/del&gt;&lt;/a&gt;, it&apos;s not just a file selection issue. We also need to consider how to generate the new file(s).  We do need some refactory, which can be done in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7516&quot; title=&quot;Make compaction policy pluggable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7516&quot;&gt;&lt;del&gt;HBASE-7516&lt;/del&gt;&lt;/a&gt;, so that other compaction algorithm including file selection is pluggable.&lt;/p&gt;</comment>
                            <comment id="13549274" author="sershe" created="Thu, 10 Jan 2013 01:35:47 +0000"  >&lt;p&gt;I&apos;ll take a look at it there this week...&lt;/p&gt;</comment>
                            <comment id="13556932" author="sershe" created="Fri, 18 Jan 2013 03:36:31 +0000"  >&lt;p&gt;Attaching some design/implementation notes. I haven&apos;t yet filled in the notes about migration and about Scan, will do tomorrow.&lt;/p&gt;</comment>
                            <comment id="13556939" author="mbertozzi" created="Fri, 18 Jan 2013 03:46:30 +0000"  >&lt;p&gt;Why you need a different file structure? you just need a meta field associated with the file that says &quot;I&apos;m in level X&quot;. All the files are already in memory with trailer and other metadata information.&lt;/p&gt;

&lt;p&gt;One &quot;problem&quot; with the LevelDB algorithm is that if the set of keys are monotonically increasing (no overlaps between files) you end up with lots and lots of files, and at region server startup the RS can run out of fds&lt;/p&gt;</comment>
                            <comment id="13556943" author="jxiang" created="Fri, 18 Jan 2013 03:58:23 +0000"  >&lt;p&gt;Agree with Matteo.  Not sure what Sergey wants to do in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7603&quot; title=&quot;refactor storefile management in HStore in order to support things like LevelDB-style compactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7603&quot;&gt;&lt;del&gt;HBASE-7603&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13556945" author="jxiang" created="Fri, 18 Jan 2013 04:01:04 +0000"  >&lt;p&gt;All store files are already open.  Their information are already in memory.  A different file structure will break lots of things since the file structure is assumed in many places.&lt;/p&gt;</comment>
                            <comment id="13557418" author="sershe" created="Fri, 18 Jan 2013 18:11:56 +0000"  >&lt;p&gt;The tl;dr in the section about metadata explains it, the strict ordering of files by seqnum is no longer possible; so if the default HBase store picks up the files and sorts them by max seqnum, it will have incorrect results for gets, and potentially other issues.&lt;/p&gt;</comment>
                            <comment id="13557419" author="sershe" created="Fri, 18 Jan 2013 18:12:32 +0000"  >&lt;p&gt;Btw, files never move from level to level so specifying level can be done inside file metadata.&lt;/p&gt;</comment>
                            <comment id="13557443" author="sershe" created="Fri, 18 Jan 2013 18:26:36 +0000"  >&lt;p&gt;...note also the logic changes described (key-before, split point, and other minor ones). Existing code will be invalid on those. It seems like it&apos;s easiest to achieve by encapsulating file management into a class. &lt;/p&gt;</comment>
                            <comment id="13557544" author="sershe" created="Fri, 18 Jan 2013 19:57:18 +0000"  >&lt;p&gt;Updating the document on scan and migrations. The more I update the document the more I think we may actually benefit from the manifest file too, as it makes certain recovery and migration scenarios simpler by providing a sort of a &quot;transactional&quot; mechanism for updating file sets.&lt;/p&gt;</comment>
                            <comment id="13557546" author="enis" created="Fri, 18 Jan 2013 19:58:23 +0000"  >&lt;p&gt;It seems like most of the Store, not just compaction, should become pluggable, because of the scanner changes as Sergey mentions in the notes. &lt;/p&gt;</comment>
                            <comment id="14725304" author="liushaohui" created="Tue, 1 Sep 2015 12:22:33 +0000"  >&lt;p&gt;Any progress about this feature? &lt;br/&gt;
I would like to contribute some time on this issue if needed.&lt;/p&gt;</comment>
                            <comment id="14725764" author="sershe" created="Tue, 1 Sep 2015 17:48:16 +0000"  >&lt;p&gt;It appears that this has been abandoned. Stripe compaction (which are supposed to be better for most HBase scenarios than level) never became very popular (possibly because they are difficult to configure), although some people use them. There are some subtle difficulties about doing level compactions correctly in HBase (some discussed above in comments and in the attached files), but the infrastructure for custom compactions is in place now, so if you want to contribute, feel free.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12547898">HBASE-5626</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12613574">HBASE-7055</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12629201">HBASE-7667</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12626448">HBASE-7516</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12563825" name="level-compaction.pdf" size="75781" author="jxiang" created="Tue, 8 Jan 2013 21:10:31 +0000"/>
                            <attachment id="12565545" name="level-compactions-notes.txt" size="10653" author="sershe" created="Fri, 18 Jan 2013 19:57:18 +0000"/>
                            <attachment id="12565427" name="level-compactions-notes.txt" size="7331" author="sershe" created="Fri, 18 Jan 2013 03:36:31 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12627982">HBASE-7603</subtask>
                            <subtask id="12626448">HBASE-7516</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Jan 2013 20:48:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>303250</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 15 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i178xb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250414</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>