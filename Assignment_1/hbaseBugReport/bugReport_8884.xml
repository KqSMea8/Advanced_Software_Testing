<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:59:24 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8884/HBASE-8884.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8884] Pluggable RpcScheduler</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8884</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Today, the RPC scheduling mechanism is pretty simple: it execute requests in isolated thread-pools based on their priority. In the current implementation, all normal get/put requests are using the same pool. We&apos;d like to add some per-user or per-region level isolation, so that a misbehaved user/region will not saturate the thread-pool and cause DoS to others easily. The idea is similar to FairScheduler in MR. The current scheduling code is not standalone and is mixed with others (Connection#processRequest). The issue is the first step to extract it to an interface, so that people are free to write and test their own implementations.&lt;/p&gt;

&lt;p&gt;This patch doesn&apos;t make it completely pluggable yet, as some parameters are pass from constructor. This is because HMaster and HRegionServer both use RpcServer and they have different thread-pool size config. Let me know if you have a solution to this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12656487">HBASE-8884</key>
            <summary>Pluggable RpcScheduler</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stepinto">Chao Shi</assignee>
                                    <reporter username="stepinto">Chao Shi</reporter>
                        <labels>
                    </labels>
                <created>Sat, 6 Jul 2013 15:32:34 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:21 +0000</updated>
                            <resolved>Fri, 19 Jul 2013 21:49:21 +0000</resolved>
                                                    <fixVersion>0.98.0</fixVersion>
                                    <component>IPC/RPC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>22</watches>
                                                                <comments>
                            <comment id="13701381" author="yuzhihong@gmail.com" created="Sat, 6 Jul 2013 17:40:44 +0000"  >&lt;p&gt;Why is SimpleRpcScheduler embedded in RpcServer ?&lt;br/&gt;
I would expect RpcScheduler and SimpleRpcScheduler to have their own classes.&lt;/p&gt;

&lt;p&gt;In trunk, there is already RpcServerInterface. Can you utilize this interface to accommodate  different thread-pool size config ?&lt;/p&gt;</comment>
                            <comment id="13701433" author="stack" created="Sat, 6 Jul 2013 22:19:57 +0000"  >&lt;p&gt;Thank you for digging in on this issue.&lt;/p&gt;

&lt;p&gt;Related, our Elliott has suggested that client&apos;s just pass over in the request the priority they think a call should have.  Server-side, a simple implementation would just do what the client asks.  Later the server could respect or not dependent on context at time of request.&lt;/p&gt;

&lt;p&gt;Regards RpcServerInterface, that is a mess &amp;#8211; a vestige left over how rpc used to work so would suggest you keep away from it (See TODO at top of the class).&lt;/p&gt;

&lt;p&gt;Maybe get a Scheduler implementation from Server rather than do this kind of stuff:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; server.callQueue.size();
+    RpcServer.SimpleRpcScheduler scheduler = (RpcServer.SimpleRpcScheduler) server.scheduler;
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; scheduler.callQueue.size();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is kinda ugly: MONITORED_RPC &amp;#8211; it being static final in the class.  Won&apos;t it be shared by master and regionserver when we run standalone w/ all threads in the one jvm?&lt;/p&gt;

&lt;p&gt;I am not clear why we are passing in Header here:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Call(int id, final BlockingService service, final MethodDescriptor md, Message param,&lt;br/&gt;
+    Call(int id, final BlockingService service, final MethodDescriptor md, RequestHeader header, Message param,&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;d think we would be done w/ header when running Calls?  (Doesn&apos;t Connection object have what you need?)&lt;/p&gt;

&lt;p&gt;Maybe write up a one pager on what your plan is.  It&apos;d be easier to decipher your intent and be able to help instead of reading a patch.&lt;/p&gt;

&lt;p&gt;Why we need a CallTask?  Isn&apos;t a Call a Task?  Would CallRunner be a better name?  Or what is it doing?  It is executing/running the call?&lt;/p&gt;

&lt;p&gt;Can Scheduler be an Interface that has implementations that the RpcServer makes use of?  Hmm.... I see you do this already:&lt;/p&gt;

&lt;p&gt;+   * An interface for RPC request scheduling algorithm.&lt;br/&gt;
+   */&lt;br/&gt;
+  public interface RpcScheduler &lt;/p&gt;
{
+
+    void start();
+    void stop();
+
+    /** Dispatches an RPC request asynchronously. */
+    void dispatch(CallTask task) throws IOException, InterruptedException;
+  }

&lt;p&gt;Yeah, just have a protected interface called Scheduler in the RPC package.  What can&apos;t we dispatch a Call?  Why we have to take a CallTask?  What is missing from Call that you need?  Just add it?&lt;/p&gt;

&lt;p&gt;Yeah, move out the Scheduler implemetation into its own class (protected) in the rpc package&lt;/p&gt;

&lt;p&gt;Patch is good.&lt;/p&gt;

&lt;p&gt;The difference between master and regionserver RpcServer are scheduler parameters &amp;#8211; the pool sizes?  Could you make a SchedulerConfiguration object that needs to be filled out and passed to RpcServer constructor?  Or just have a masterschedulerconfiguration and a regionserverschedulerconfiguration that you pass to the RpcServer on construction?&lt;/p&gt;
</comment>
                            <comment id="13701488" author="stepinto" created="Sun, 7 Jul 2013 02:58:59 +0000"  >&lt;p&gt;Thanks for reviewing this patch so quickly.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Why is SimpleRpcScheduler embedded in RpcServer ?&lt;br/&gt;
I would expect RpcScheduler and SimpleRpcScheduler to have their own classes.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;Yeah, move out the Scheduler implemetation into its own class (protected) in the rpc package&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It has to access some member of RpcServer (for now, getQosLevel and highPriorityLevel). It would be nice to have it a separate class when we have a approach to pass configuration to a scheduler. I&apos;m trying to work on that.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I&apos;d think we would be done w/ header when running Calls? (Doesn&apos;t Connection object have what you need?)&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;header is used by SimpleRpcScheduler to determine qos level. How to get it from connection?&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;This is kinda ugly: MONITORED_RPC &#8211; it being static final in the class. Won&apos;t it be shared by master and regionserver when we run standalone w/ all threads in the one jvm?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I agree. Yes, it is shared. It is only used for holder a thread-local MonitoredRpcHandler per handler thread. Any better ideas?&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Why we need a CallTask? Isn&apos;t a Call a Task? Would CallRunner be a better name? Or what is it doing? It is executing/running the call?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;CallRunner is OK for me. It is a Call plus the processing logic (a runnable), thus a scheduler can simply put it into a thread pool for execution. In addition, I would prefer adding a interface for Call (which exposes getters that a scheduler needs), so we can simply mock it up in testing.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The difference between master and regionserver RpcServer are scheduler parameters &#8211; the pool sizes? Could you make a SchedulerConfiguration object that needs to be filled out and passed to RpcServer constructor? Or just have a masterschedulerconfiguration and a regionserverschedulerconfiguration that you pass to the RpcServer on construction?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Good. Please note that besides pool size, a scheduler may have its own things configurable (implementation dependent), which may e between master and regionserver. In master, we can rename all &quot;hbase.master.rpc.scheduler.&amp;#42;&quot; to &quot;hbase.rpc.scheduler.&amp;#42;&quot;, so the scheduler can read it.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Maybe write up a one pager on what your plan is. It&apos;d be easier to decipher your intent and be able to help instead of reading a patch.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In fact, I haven&apos;t got idea what a fair scheduler exactly is. It is hard to have a algorithm fit all people/scenario. This patch is the very first step. With it, so we are able to test our implementation without modifying code inside RpcServer. I&apos;m glad to discuss with you about the scheduler implementation in another jira issue (we&apos;re getting some testing data from the prototype scheduler).&lt;/p&gt;

&lt;p&gt;I don&apos;t have access to my devbox during weekend. I will submit a new patch in Mon or Tue. Thanks!&lt;/p&gt;</comment>
                            <comment id="13702851" author="stepinto" created="Tue, 9 Jul 2013 03:44:45 +0000"  >&lt;p&gt;New updates:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Move SimpleRpcScheduler out.&lt;/li&gt;
	&lt;li&gt;Pass RpcScheduler as a constructor parameter of RpcServer, because the only scenario that we may need to specify a customized scheduler is HRegionServer. So simply let others (e.g. HMaster) construct a SimpleRpcScheduler with some basic configuration (no qos level, no replication thread pool..).&lt;/li&gt;
	&lt;li&gt;Rename CallTask to CallRunner&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13702855" author="stepinto" created="Tue, 9 Jul 2013 03:46:20 +0000"  >&lt;p&gt;Oops. The previous patch contains some debugging print. Please see v3, thanks!&lt;/p&gt;</comment>
                            <comment id="13702975" author="hadoopqa" created="Tue, 9 Jul 2013 06:23:43 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12591369/hbase-8884-v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12591369/hbase-8884-v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 4 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 release audit&lt;/font&gt;.  The applied patch generated 1 release audit warnings (more than the trunk&apos;s current 0 warnings).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//testReport/&lt;/a&gt;&lt;br/&gt;
Release audit warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6264//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13703038" author="stepinto" created="Tue, 9 Jul 2013 08:01:03 +0000"  >&lt;p&gt;Fix hadoop QA issues&lt;/p&gt;</comment>
                            <comment id="13703119" author="hadoopqa" created="Tue, 9 Jul 2013 10:15:49 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12591393/hbase-8884-v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12591393/hbase-8884-v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.zookeeper.lock.TestZKInterProcessReadWriteLock&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6269//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13703413" author="hadoopqa" created="Tue, 9 Jul 2013 15:53:33 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12591441/hbase-8884-v5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12591441/hbase-8884-v5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6271//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13704011" author="yuzhihong@gmail.com" created="Tue, 9 Jul 2013 23:40:58 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class SimpleRpcScheduler &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; RpcServer.RpcScheduler {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please add annotation for stability and audience&lt;/p&gt;

&lt;p&gt;RpcScheduler can be extracted out of RpcServer, right ?&lt;/p&gt;

&lt;p&gt;For MetricsHBaseServerWrapperImpl.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        || !(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.getScheduler() &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; SimpleRpcScheduler)) {
       &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0;
     }
-    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; server.callQueue.size();
+    SimpleRpcScheduler scheduler = (SimpleRpcScheduler) server.getScheduler();
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; scheduler.callQueue.size();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can retrieval of callQueue be declared in RpcScheduler so that we don&apos;t use the casting above ?&lt;/p&gt;</comment>
                            <comment id="13704157" author="stepinto" created="Wed, 10 Jul 2013 03:30:57 +0000"  >&lt;p&gt;Thanks for your review. Here are fixes for the review comments.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Please add annotation for stability and audience&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fixed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;RpcScheduler can be extracted out of RpcServer, right ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fixed. Extracted RpcScheduler into top-level and make RpcSchedulerContext a inner class of RpcScheduler.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;For MetricsHBaseServerWrapperImpl.java:&lt;br/&gt;
Can retrieval of callQueue be declared in RpcScheduler so that we don&apos;t use the casting above ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think a scheduler implementation may have different metrics than others. It would be nice to let each scheduler implementation exposes whatever metrics it wants. I&apos;m not familiar with the metrics system, anyone knows a solution?&lt;/p&gt;</comment>
                            <comment id="13704203" author="hadoopqa" created="Wed, 10 Jul 2013 04:42:42 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12591589/hbase-8884-v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12591589/hbase-8884-v6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6286//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13706603" author="stepinto" created="Fri, 12 Jul 2013 03:04:21 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yuzhihong%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;yuzhihong@gmail.com&quot;&gt;Ted Yu&lt;/a&gt;, any comments on this patch v6?&lt;/p&gt;</comment>
                            <comment id="13707871" author="yuzhihong@gmail.com" created="Sat, 13 Jul 2013 23:47:46 +0000"  >&lt;p&gt;Patch v6 looks good. Minor comments below.&lt;/p&gt;

&lt;p&gt;For RpcScheduler interface, please add javadoc for the method parameters.&lt;/p&gt;

&lt;p&gt;For SimpleRpcScheduler:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ * A scheduler that maintains isolated handler pools &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; high-priority and replication
+ * requests.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There are actually 3 queues. Better make the above comment clearer.&lt;/p&gt;

&lt;p&gt;RpcServer.CallRunner can be package private.&lt;/p&gt;</comment>
                            <comment id="13707936" author="stepinto" created="Sun, 14 Jul 2013 03:32:39 +0000"  >&lt;p&gt;Thanks for review. Here is v7 patch.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;make RpcServer.CallRunner and RpcScheduler package private&lt;/li&gt;
	&lt;li&gt;fix comments in RpcScheduler and SimpleRpcScheduler&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13707951" author="hadoopqa" created="Sun, 14 Jul 2013 04:52:27 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592181/hbase-8884-v7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592181/hbase-8884-v7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6328//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13707954" author="yuzhihong@gmail.com" created="Sun, 14 Jul 2013 05:06:49 +0000"  >&lt;p&gt;I don&apos;t have other comments.&lt;/p&gt;</comment>
                            <comment id="13708814" author="jesse_yates" created="Mon, 15 Jul 2013 18:53:57 +0000"  >&lt;p&gt;this is kind of a big patch... mind putting it up on RB? It would be good to get some other eyes on it (maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andrew.purtell%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;andrew.purtell@gmail.com&quot;&gt;Andrew Purtell&lt;/a&gt;?). Good stuff so far from my first pass though &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13709371" author="stepinto" created="Tue, 16 Jul 2013 02:15:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;this is kind of a big patch... mind putting it up on RB? It would be good to get some other eyes on it (maybe Andrew Purtell?). Good stuff so far from my first pass though &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Done. Please have a look at &lt;a href=&quot;https://reviews.apache.org/r/12572/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/12572/&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13710851" author="stepinto" created="Wed, 17 Jul 2013 08:27:45 +0000"  >&lt;p&gt;Try QA for patch v8&lt;br/&gt;
Changes:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;rebase to trunk (and resolve some conflicts)&lt;/li&gt;
	&lt;li&gt;fix issues mentioned by Jesse Yates on RB&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13710907" author="hadoopqa" created="Wed, 17 Jul 2013 09:50:48 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12592739/hbase-8884-v8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12592739/hbase-8884-v8.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6374//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13711210" author="jesse_yates" created="Wed, 17 Jul 2013 16:06:16 +0000"  >&lt;p&gt;+1 LGTM&lt;/p&gt;</comment>
                            <comment id="13711266" author="yuzhihong@gmail.com" created="Wed, 17 Jul 2013 16:51:31 +0000"  >&lt;p&gt;Will wait for one more day for additional comments before integration.&lt;/p&gt;</comment>
                            <comment id="13712606" author="yuzhihong@gmail.com" created="Thu, 18 Jul 2013 18:27:24 +0000"  >&lt;p&gt;Integrated to trunk.&lt;/p&gt;

&lt;p&gt;Thanks for the patch, Chao.&lt;/p&gt;

&lt;p&gt;Thanks for the reviews.&lt;/p&gt;</comment>
                            <comment id="13712867" author="hudson" created="Thu, 18 Jul 2013 21:18:17 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #4269 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4269/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4269/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8884&quot; title=&quot;Pluggable RpcScheduler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8884&quot;&gt;&lt;del&gt;HBASE-8884&lt;/del&gt;&lt;/a&gt; Pluggable RpcScheduler (Chao Shi) (tedyu: rev 1504584)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-common/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/MetricsHBaseServerWrapperImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/RpcScheduler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/RpcServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/RpcServerInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/SimpleRpcScheduler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/ipc/TestDelayedRpc.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/ipc/TestIPC.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/ipc/TestProtoBufRpc.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13713201" author="hudson" created="Fri, 19 Jul 2013 00:42:34 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #623 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/623/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/623/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8884&quot; title=&quot;Pluggable RpcScheduler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8884&quot;&gt;&lt;del&gt;HBASE-8884&lt;/del&gt;&lt;/a&gt; Pluggable RpcScheduler (Chao Shi) (tedyu: rev 1504584)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-common/src/main/java/org/apache/hadoop/hbase/HConstants.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/MetricsHBaseServerWrapperImpl.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/RpcScheduler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/RpcServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/RpcServerInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/ipc/SimpleRpcScheduler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/ipc/TestDelayedRpc.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/ipc/TestIPC.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/ipc/TestProtoBufRpc.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/security/token/TestTokenAuthentication.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13713257" author="stepinto" created="Fri, 19 Jul 2013 01:58:31 +0000"  >&lt;p&gt;Good! Thanks all reviewers.&lt;/p&gt;</comment>
                            <comment id="13721833" author="stack" created="Sun, 28 Jul 2013 03:44:29 +0000"  >&lt;p&gt;The commit needs a release note.&lt;/p&gt;</comment>
                            <comment id="13721839" author="stack" created="Sun, 28 Jul 2013 03:59:39 +0000"  >&lt;p&gt;I added a few comments up on rb.&lt;/p&gt;</comment>
                            <comment id="13725073" author="stepinto" created="Wed, 31 Jul 2013 10:05:19 +0000"  >&lt;p&gt;Hi stack,&lt;/p&gt;

&lt;p&gt;I opened another issue (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9101&quot; title=&quot;Addendum to pluggable RpcScheduler&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9101&quot;&gt;&lt;del&gt;HBASE-9101&lt;/del&gt;&lt;/a&gt;) and posted a patch to fix the issue you mentioned. Please have a look. Thanks!&lt;/p&gt;</comment>
                            <comment id="13752828" author="stack" created="Wed, 28 Aug 2013 20:46:01 +0000"  >&lt;p&gt;I commented over in hbase-9101 &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stepinto&quot; class=&quot;user-hover&quot; rel=&quot;stepinto&quot;&gt;Chao Shi&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13761070" author="stack" created="Sat, 7 Sep 2013 16:52:33 +0000"  >&lt;p&gt;Looking more at this patch, we effectively double the number of threads we have running a Call.  A handler, which is a thread does nothing but start the CallRunner thread added in this patch.  And if I read this patch right, we actually have lost control of the bounding on the number of threads we had running at any one time.  The handler does takes from the queue, starts a thread, then loops and there is nothing to prevent it taking another CallRunner from the queue and starting it, and so on.&lt;/p&gt;

&lt;p&gt;I would suggest that CallRunner NOT be a thread (before this patch Handler did the work, now it creates a new thread to do the work).&lt;/p&gt;

&lt;p&gt;Could we fix it so RpcScheduler does not have to reach back into RpcServer to get the CallRunner type?  Maybe CallRunner should be outside of RpcServer.  RpcServer has too many inner classes as it is.&lt;/p&gt;

&lt;p&gt;Its a pity this stuff is in the Interface:&lt;/p&gt;

&lt;p&gt;+  /** Retrieves length of the general queue for metrics. */&lt;br/&gt;
+  int getGeneralQueueLength();&lt;br/&gt;
+&lt;br/&gt;
+  /** Retrieves length of the priority queue for metrics. */&lt;br/&gt;
+  int getPriorityQueueLength();&lt;br/&gt;
+&lt;br/&gt;
+  /** Retrieves length of the replication queue for metrics. */&lt;br/&gt;
+  int getReplicationQueueLength();&lt;/p&gt;

&lt;p&gt;It hardcodes three queue types thereby constraining the types of scheduler that can be implemented.&lt;/p&gt;

&lt;p&gt;The gymnastics w/ MONITORED_RPC, the thread local, and how we get it in CallRunner to set state is &apos;interesting&apos;.  It says that we are setting the state on the handler but that is not so, right, if the handler is running the CallRunner...we are setting state of a CallRunner... and it looks like a Handler could be running multiple of them.  What is this doing?  Making it so handler state in the UI shows properly?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;


</comment>
                            <comment id="13761073" author="stack" created="Sat, 7 Sep 2013 17:08:57 +0000"  >&lt;p&gt;I took a looksee and my claim above this patch doubling the count of threads seems wrong. CallRunner is a Runnable.  Handler#run calls CallRunner#run so the body of CallRunner#run becomes the body of Handler#run.  So we should be fine.&lt;/p&gt;</comment>
                            <comment id="13761074" author="stack" created="Sat, 7 Sep 2013 17:14:41 +0000"  >&lt;p&gt;Yeah, so why is CallRunner a Runnable at all?&lt;/p&gt;

&lt;p&gt;As you can tell, I am having a little trouble following what is going on here.  Thanks.&lt;/p&gt;</comment>
                            <comment id="13761078" author="stack" created="Sat, 7 Sep 2013 17:26:17 +0000"  >&lt;p&gt;Shouldn&apos;t MONITORED_RPC be in Handler rather than kept as a thread local in RpcServer?  Handler could give it to the CallRunner rather than have it jump hoops to get at its stashed instance?&lt;/p&gt;

&lt;p&gt;I do not see what benefit CallRunner adds?   It only seems to complicate for no apparent benefit (it confuses with its CallRunner name though it is not a Runnable even though it implements the Interface).&lt;/p&gt;
</comment>
                            <comment id="13762706" author="stepinto" created="Tue, 10 Sep 2013 04:03:27 +0000"  >&lt;p&gt;Hi stack,&lt;/p&gt;

&lt;p&gt;Thanks for your review comments.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Shouldn&apos;t MONITORED_RPC be in Handler rather than kept as a thread local in RpcServer? Handler could give it to the CallRunner rather than have it jump hoops to get at its stashed instance?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The reason is to isolate logic of a RpcScheduler (implementation-specific) and RpcServer provides (common logic shared by all RpcScheduler implementations). Putting it into Handler is OK, but because that it has its own thread, it may not be convenient to incorporate with, for example ThreadPoolExecutor. I&apos;m open for any better suggestions if you have.&lt;/p&gt;

&lt;p&gt;I think we can continue to do some refactor work to get it clean and easy for understeanding.&lt;/p&gt;</comment>
                            <comment id="13762717" author="stack" created="Tue, 10 Sep 2013 04:43:41 +0000"  >&lt;p&gt;As is, it is hard to follow what is going on.&lt;/p&gt;

&lt;p&gt;+ Do we have to have a thread local up in the parent server class as the means of keeping context across the calls; can this not be in handler?  A context it gives each Call?&lt;br/&gt;
+ Does CallRunner have to be a Runnable?  You see how elsewhere in hbase we the notion of Callable?  It seems to have much what you introduce here with the CallRunner?  Would be good to have it all align.&lt;/p&gt;

&lt;p&gt;Agree more refactor would help.  Thanks Chao Shi.  I want to be able to add pooling of buffers across requests.  At the moment it is difficult figuring how/where to insert.  Thanks.&lt;/p&gt;</comment>
                            <comment id="13762774" author="stepinto" created="Tue, 10 Sep 2013 06:22:48 +0000"  >&lt;p&gt;stack, could you please explain a little bit more on &quot;pooling of buffers across requests&quot;. I don&apos;t quite understand. In fact, the very first rationale for us to introduce pluggable RpcScheduler, is that we want to isolate read and write ops. So we can simply write a RpcScheduler with two thread-pools. My case is pretty easy, and I&apos;m interested to listen about your case.&lt;/p&gt;</comment>
                            <comment id="13762979" author="stack" created="Tue, 10 Sep 2013 11:43:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stepinto&quot; class=&quot;user-hover&quot; rel=&quot;stepinto&quot;&gt;Chao Shi&lt;/a&gt; I was reading rpc code so I could better review an incoming rpc patch and because I have notions I will likely never get to (see below).  While reading, I was trying to write up documentation of how it all worked.  This is where I ran into how opaque and convoluted its operation what w/ unused thread locals used passing messages and then the stuff added by this patch &amp;#8211; complications we can hopefully clean up in subsequent refactorings as you suggest.  Do you have any pushback on my review comments?&lt;/p&gt;

&lt;p&gt;&apos;Pooling of buffers across requests&apos; is a notion that rather than do&lt;/p&gt;

&lt;p&gt;          data = ByteBuffer.allocate(dataLength);&lt;/p&gt;

&lt;p&gt;inside in a rpc Reader thread every time we get a new request, since we have read the total rpc size and we know its size, that instead we could go to a pool of buffers and ask it for a buffer that is of appropriate size.  We&apos;d check it out for the length of the request.  We&apos;d need to check it back in when done (likely good spot is at the tail of the Handler when it adds the response to the Responder queue).  This could save us a bunch of allocations (and GC load, etc.).  I think we could get away w/ this given how KeyValues are copied into the MSLAB when we add them to the MemStore (we&apos;d have to figure what to do about those that are not copied; i.e. KeyValues that are large).&lt;/p&gt;

&lt;p&gt;If the above worked, we could then entertain making the pool be a pool of direct byte buffers (Downsides on DBBs are they take a while to allocate and their cleanup is unpreditable &amp;#8211; having them in a pool that we set up on server start w/ skirt some of these downsides; the copy from the socket channel to the DBB would be offheap making for more savings.&lt;/p&gt;

&lt;p&gt;If the memstore implementation was itself offheap.... but now I am into fantasy so will stop. &lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13763140" author="stepinto" created="Tue, 10 Sep 2013 15:49:41 +0000"  >&lt;p&gt;I haven&apos;t thought on the interface clearly. You idea sounds similar to using per-request memory pool in the old C days. I will try to do some refactor as you suggested (callable + remove thread local).&lt;/p&gt;</comment>
                            <comment id="13767357" author="stack" created="Sat, 14 Sep 2013 03:58:52 +0000"  >&lt;p&gt;Continuation over in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9461&quot; title=&quot;Some doc and cleanup in RPCServer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9461&quot;&gt;&lt;del&gt;HBASE-9461&lt;/del&gt;&lt;/a&gt;.  Changes CallRunner so not Runnable.  Other &apos;cleaning&apos; so easier to make sense of what is going on (does other stuff like make the CallRunner do all call size accounting, makes it so Scheduler does less reaching into RpcServer instance, takes rpc server Interface instead, etc.).&lt;/p&gt;</comment>
                            <comment id="15016202" author="lars_francke" created="Fri, 20 Nov 2015 11:54:21 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12655426">HBASE-8836</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12591368" name="hbase-8884-v2.patch" size="44085" author="stepinto" created="Tue, 9 Jul 2013 03:44:45 +0000"/>
                            <attachment id="12591369" name="hbase-8884-v3.patch" size="43426" author="stepinto" created="Tue, 9 Jul 2013 03:46:20 +0000"/>
                            <attachment id="12591393" name="hbase-8884-v4.patch" size="45122" author="stepinto" created="Tue, 9 Jul 2013 08:01:03 +0000"/>
                            <attachment id="12591441" name="hbase-8884-v5.patch" size="45247" author="stepinto" created="Tue, 9 Jul 2013 14:38:49 +0000"/>
                            <attachment id="12591589" name="hbase-8884-v6.patch" size="46584" author="stepinto" created="Wed, 10 Jul 2013 03:30:57 +0000"/>
                            <attachment id="12592181" name="hbase-8884-v7.patch" size="46827" author="stepinto" created="Sun, 14 Jul 2013 03:32:39 +0000"/>
                            <attachment id="12592739" name="hbase-8884-v8.patch" size="49879" author="stepinto" created="Wed, 17 Jul 2013 08:27:45 +0000"/>
                            <attachment id="12591085" name="hbase-8884.patch" size="27731" author="stepinto" created="Sat, 6 Jul 2013 15:34:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 6 Jul 2013 17:40:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336710</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1m2un:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>337033</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>