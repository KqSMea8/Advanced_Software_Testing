<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:16:54 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4213/HBASE-4213.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4213] Support for fault tolerant, instant schema updates with out master&apos;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4213</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This Jira is a slight variation in approach to what is being done as part of &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-1730&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Support instant schema updates such as Modify Table, Add Column, Modify Column operations:&lt;br/&gt;
1. With out enable/disabling the table.&lt;br/&gt;
2. With out bulk unassign/assign of regions.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12519116">HBASE-4213</key>
            <summary>Support for fault tolerant, instant schema updates with out master&apos;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="iamknome">Subbu M Iyer</assignee>
                                    <reporter username="iamknome">Subbu M Iyer</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Aug 2011 14:06:10 +0000</created>
                <updated>Thu, 2 May 2013 02:29:48 +0000</updated>
                            <resolved>Tue, 22 Nov 2011 03:17:14 +0000</resolved>
                                                    <fixVersion>0.94.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13086326" author="iamknome" created="Wed, 17 Aug 2011 14:08:35 +0000"  >&lt;p&gt;Attached patch is based on the following pattern.&lt;/p&gt;

&lt;p&gt;On Startup:&lt;br/&gt;
1. On startup, create a new ZK node called &quot;schema&quot; if it doesn&apos;t exisit already. (Master and RS)&lt;br/&gt;
2. Master starts a MasterSchemaChangeTracker and sets a watch for childerns of /hbase/schema.&lt;br/&gt;
3. Each RS will start SchemaChangeTracker and set a watch childrens of /hbase/schema. &lt;/p&gt;

&lt;p&gt;On Alter DDL: (modify table, add family, modify family)&lt;/p&gt;

&lt;p&gt;1. Master will bypass the table disabled check for alter DDL requests.&lt;br/&gt;
2. On successful HTD change, master will create a new ZK node /hbase/schema/&amp;lt;table name&amp;gt;.&lt;br/&gt;
3. Each RS will get notified of the schema change through the new ZK node /hbase/schema/&amp;lt;table name&amp;gt;. &lt;br/&gt;
   a. If the RS currently has online regions for the table, refresh the regions as follows:&lt;br/&gt;
   		a.1: Close the region.&lt;br/&gt;
   		a.2: Remove from online regions.&lt;br/&gt;
   		a.3: Get the latest HTD descriptor.&lt;br/&gt;
   		a.4: Reopen the region with new HTD.&lt;br/&gt;
   		a.5: Add the region to list of online regions.&lt;br/&gt;
   b.RS will signal that it has successfully processed the schema change by &lt;br/&gt;
     creating a new ZK node /hbase/schema/&amp;lt;table name&amp;gt;/&amp;lt;RS server name&amp;gt;  		&lt;br/&gt;
     This will happen either if currently the RS does not have any online regions for the table, &lt;br/&gt;
     or if has successfully completed the region refresh with new schema changes.&lt;br/&gt;
4. Master will get notified of the list of region servers who have successfully carried out the &lt;br/&gt;
   schema change operation based on childrens of zknode /hbase/schema/&amp;lt;table name&amp;gt;.&lt;br/&gt;
5. Master will recursively delete the node /hbase/schema/&amp;lt;table name&amp;gt;, if the number of childrens&lt;br/&gt;
   of /hbase/schema/&amp;lt;table name&amp;gt; is greater than or equal to current number of active region servers.&lt;/p&gt;</comment>
                            <comment id="13086328" author="iamknome" created="Wed, 17 Aug 2011 14:11:09 +0000"  >&lt;p&gt;As earlier, for some reasons I am not able to attach my patch to the review board.&lt;/p&gt;

&lt;p&gt;Ted/Stack: Can one of you help me with this?&lt;/p&gt;

&lt;p&gt;thanks&lt;/p&gt;</comment>
                            <comment id="13086356" author="yuzhihong@gmail.com" created="Wed, 17 Aug 2011 14:47:06 +0000"  >&lt;p&gt;I haven&apos;t gone through the patch yet.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;5. Master will recursively delete the node /hbase/schema/&amp;lt;table name&amp;gt;, if the number of childrens of /hbase/schema/&amp;lt;table name&amp;gt; is greater than or equal to current number of active region servers.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You meant recursively deleting the children of node /hbase/schema/&amp;lt;table name&amp;gt;, right ?&lt;/p&gt;

&lt;p&gt;For region server which joins the cluster after the creation of /hbase/schema/&amp;lt;table name&amp;gt;, it should be able to find out that it already reads the most recent HTD. Does it create a child node under /hbase/schema/&amp;lt;table name&amp;gt; ?&lt;/p&gt;</comment>
                            <comment id="13086466" author="apurtell" created="Wed, 17 Aug 2011 17:29:08 +0000"  >&lt;p&gt;Whatever the resolution this should have the same fix version as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13086626" author="yuzhihong@gmail.com" created="Wed, 17 Aug 2011 21:59:16 +0000"  >&lt;p&gt;In TableEventHandler.java, Exception handling should be enhanced:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (KeeperException e) {
+        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Instant schema change failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; table &quot;&lt;/span&gt; + tableName );
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13086645" author="yuzhihong@gmail.com" created="Wed, 17 Aug 2011 22:22:44 +0000"  >&lt;p&gt;In HRegionServer.java, the following method would always return true if there is no intervening IOException:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; refreshSchema(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] tableName) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I wonder if the return type should be void.&lt;/p&gt;</comment>
                            <comment id="13086651" author="yuzhihong@gmail.com" created="Wed, 17 Aug 2011 22:31:18 +0000"  >&lt;p&gt;In EventHandler.java, should isSchemaChangeEvent() include C_M_DELETE_FAMILY as well ?&lt;/p&gt;</comment>
                            <comment id="13086745" author="iamknome" created="Thu, 18 Aug 2011 02:24:28 +0000"  >&lt;p&gt;Ted,&lt;/p&gt;

&lt;p&gt;Yes. DELETE_FAMILY also needs to be added. Will take care of that.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; You meant recursively deleting the children of node /hbase/schema/&amp;lt;table name&amp;gt;, right ?&lt;/p&gt;

&lt;p&gt;Yes.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; For region server which joins the cluster after the creation of /hbase/schema/&amp;lt;table name&amp;gt;, it should be able to find out that it already reads the most recent HTD. Does it create a child node under /hbase/schema/&amp;lt;table name&amp;gt; ?&lt;/p&gt;

&lt;p&gt;The newly joined RS will not create a child under /hbase/schema/&amp;lt;table name&amp;gt; as it will not be processing the schema change event. &lt;/p&gt;

</comment>
                            <comment id="13086751" author="iamknome" created="Thu, 18 Aug 2011 02:32:00 +0000"  >&lt;p&gt;Regarding: &lt;/p&gt;

&lt;p&gt;  public boolean refreshSchema(byte[] tableName) throws IOException {&lt;/p&gt;

&lt;p&gt;I agree that it could be a void instead of a boolean. Will change that as well.&lt;/p&gt;
</comment>
                            <comment id="13087012" author="yuzhihong@gmail.com" created="Thu, 18 Aug 2011 13:45:13 +0000"  >&lt;p&gt;I wonder if the following check is accurate because servers and rsCount are both returned from ZKUtil methods:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; rsCount = ZKUtil.getNumberOfChildren(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.watcher, path);
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (servers != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; servers.size() &amp;gt;= rsCount) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In TestInstantSchemaChange:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    miniHBaseCluster = TEST_UTIL.startMiniCluster(3);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I added rsCount in your log statement.&lt;br/&gt;
Then I saw the following in org.apache.hadoop.hbase.client.TestInstantSchemaChange-output.txt:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
tyumac:trunk tyu$ grep &apos; region servers have successfully &apos; target/surefire-reports/org.apache.hadoop.hbase.client.TestInstantSchemaChange-output.txt
2011-08-17 21:54:54,995 DEBUG [main-EventThread] zookeeper.MasterSchemaChangeTracker(69): All 2 region servers have successfully processed the schema changes &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; table = testSchemachange . Deleting the schema change node = /hbase/schema/testSchemachange
2011-08-17 21:54:57,459 DEBUG [main-EventThread] zookeeper.MasterSchemaChangeTracker(69): All 2 region servers have successfully processed the schema changes &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; table = testSchemachangeForAddColumn . Deleting the schema change node = /hbase/schema/testSchemachangeForAddColumn
2011-08-17 21:54:58,120 DEBUG [main-EventThread] zookeeper.MasterSchemaChangeTracker(69): All 2 region servers have successfully processed the schema changes &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; table = testSchemachangeForModifyColumn . Deleting the schema change node = /hbase/schema/testSchemachangeForModifyColumn
2011-08-17 21:54:58,330 DEBUG [main-EventThread] zookeeper.MasterSchemaChangeTracker(69): All 3 region servers have successfully processed the schema changes &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; table = testSchemachangeNode . Deleting the schema change node = /hbase/schema/testSchemachangeNode
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Looks like master might delete schema change node prematurely.&lt;/p&gt;</comment>
                            <comment id="13087110" author="iamknome" created="Thu, 18 Aug 2011 16:54:27 +0000"  >
&lt;p&gt;They both are checking different counts. One counts the number of&lt;br/&gt;
active RS at this moment (based on number of childrens of /hbase/rs)&lt;br/&gt;
and other counts the number of RS successfully processed the schema&lt;br/&gt;
change (based on number of childrens of /hbase/schema/&amp;lt;table name&amp;gt; ).&lt;/p&gt;

&lt;p&gt;If number of RS who have processed the schema change is &amp;gt;= number of&lt;br/&gt;
active RS at this moment then master presumes that all RS have&lt;br/&gt;
acknowledged the schema change and hence goes ahead with delete&lt;br/&gt;
operation.&lt;/p&gt;



&lt;p&gt;On Thu, Aug 18, 2011 at 6:45 AM, Ted Yu (JIRA) &amp;lt;jira@apache.org&amp;gt; wrote:&lt;/p&gt;</comment>
                            <comment id="13087112" author="yuzhihong@gmail.com" created="Thu, 18 Aug 2011 16:58:49 +0000"  >&lt;p&gt;Thanks for the explanation.&lt;br/&gt;
Tracing where path variable&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; rsCount = ZKUtil.getNumberOfChildren(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.watcher, path);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;comes from:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (path.startsWith(watcher.schemaZNode)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It doesn&apos;t align with your description.&lt;/p&gt;</comment>
                            <comment id="13087369" author="stack" created="Thu, 18 Aug 2011 22:56:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;If number of RS who have processed the schema change is &amp;gt;= number of active RS at this moment then master presumes that all RS have acknowledged the schema change and hence goes ahead with delete operation.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If I add ten regionservers to a cluster in between start of a schema change and before it completes, could &apos;if (servers != null &amp;amp;&amp;amp; servers.size() &amp;gt;= rsCount)&apos; never trigger?&lt;/p&gt;

&lt;p&gt;Just remove this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       # Table should be disabled
-      raise(ArgumentError, &lt;span class=&quot;code-quote&quot;&gt;&quot;Table #{table_name} is enabled. Disable it first before altering.&quot;&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; enabled?(table_name)
+      # raise(ArgumentError, &lt;span class=&quot;code-quote&quot;&gt;&quot;Table #{table_name} is enabled. Disable it first before altering.&quot;&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; enabled?(table_name)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... including the comment.&lt;/p&gt;

&lt;p&gt;You should log the exception... add it as arg to below:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (KeeperException e) {
+        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Instant schema change failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; table &quot;&lt;/span&gt; + tableName );
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You do this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.schemaChangeTracker = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MasterSchemaChangeTracker(getZooKeeper(),
+            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.zooKeeper.schemaZNode, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do you have to pass schema znode?  Can you not ask the object returned by getZooKeeper for schemaZNode so only need to have two args in this method?&lt;/p&gt;

&lt;p&gt;Whats this?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void checkTableModifiable(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] tableName,
+                                   EventHandler.EventType eventType)
   &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
+    preCheckTableModifiable(tableName);
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!eventType.isSchemaChangeEvent()) {
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!getAssignmentManager().getZKTable().
+          isDisabledTable(Bytes.toString(tableName))) {
+        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TableNotDisabledException(tableName);
+      }
+    }
+  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Whats the is disabled check for?  We need this any more?  Oh, I see... its needed if its NOT a schema change event.&lt;/p&gt;

&lt;p&gt;Javadoc says &apos;+   * @return true if region is opened successfully with new schema changes.&apos; but method returns void.&lt;/p&gt;

&lt;p&gt;Does this need to be synchronized (you syncrhonize on it later in a different method):&lt;/p&gt;

&lt;p&gt;+      for (HRegion hRegion : onlineRegionsOfTable) {&lt;/p&gt;

&lt;p&gt;If a new region for this table comes in meantime, it&apos;ll be ok?  It&apos;ll find new schema?&lt;/p&gt;

&lt;p&gt;What happens if master decides to balance a region at this time?  Or disable it?  While reopenRegions is running?&lt;/p&gt;

&lt;p&gt;What Ted says on delete cf.&lt;/p&gt;

&lt;p&gt;Can you look in zk or something rather than wait on a timer before moving on?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// Take a mini nap &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; changes to take effect.
&lt;/span&gt;+    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(200);
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Remove the &apos;*&apos; from log messages.  You&apos;ll start an arms race where every log message will try and add a new type of flashing glyph so it can stand out from the crowd.&lt;/p&gt;

&lt;p&gt;This patch looks great.&lt;/p&gt;

</comment>
                            <comment id="13087383" author="iamknome" created="Thu, 18 Aug 2011 23:06:26 +0000"  >&lt;p&gt;Ted,&lt;/p&gt;

&lt;p&gt;Yes, you are absolutely right and very good catch.&lt;/p&gt;

&lt;p&gt;The second check should be like:&lt;/p&gt;

&lt;p&gt;int rsCount = ZKUtil.getNumberOfChildren(this.watcher, watcher.rsZNode);&lt;br/&gt;
instead of&lt;/p&gt;

&lt;p&gt;int rsCount = ZKUtil.getNumberOfChildren(this.watcher, path);&lt;/p&gt;

&lt;p&gt;I have taken care of this.&lt;/p&gt;

&lt;p&gt;thanks&lt;br/&gt;
Subbu&lt;/p&gt;
</comment>
                            <comment id="13087393" author="yuzhihong@gmail.com" created="Thu, 18 Aug 2011 23:25:19 +0000"  >&lt;p&gt;@Subbu:&lt;br/&gt;
Glad I was able to help.&lt;br/&gt;
I think nothing is absolute. I believe in relativity &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13087406" author="yuzhihong@gmail.com" created="Thu, 18 Aug 2011 23:38:52 +0000"  >&lt;p&gt;One important decision we need to make about this feature is whether we support simultaneous schema changes for more than one table.&lt;br/&gt;
If it is supported, master needs to maintain a set of region servers per table at the time schema change for that table starts. This way, master knows when the change can be deemed completed.&lt;/p&gt;</comment>
                            <comment id="13087503" author="iamknome" created="Fri, 19 Aug 2011 04:00:41 +0000"  >&lt;p&gt;Attached version 1 with most of call outs addressed.&lt;/p&gt;</comment>
                            <comment id="13087507" author="iamknome" created="Fri, 19 Aug 2011 04:05:27 +0000"  >&lt;p&gt;&amp;gt;&amp;gt; If a new region for this table comes in meantime, it&apos;ll be ok? It&apos;ll find new schema?&lt;/p&gt;

&lt;p&gt;Yes. New regions are perfectly fine as they will see new HTD.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; What happens if master decides to balance a region at this time? Or disable it? While reopenRegions is &lt;br/&gt;
&amp;gt;&amp;gt; running?&lt;/p&gt;

&lt;p&gt;Hmm. This one is interesting. Let me take a closer look at how to address it. Any suggestions?&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; What Ted says on delete cf.&lt;/p&gt;

&lt;p&gt;TBD. I am on it. &lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;Can you look in zk or something rather than wait on a timer before moving on?&lt;/p&gt;

&lt;p&gt;Yup. Will do.&lt;/p&gt;</comment>
                            <comment id="13087514" author="iamknome" created="Fri, 19 Aug 2011 04:14:51 +0000"  >&lt;p&gt;I did test delete family from shell and it worked with out any additional support. I just found that TableDeleteFamilyHandler is using event type &quot;EventType.C_M_ADD_FAMILY&quot; instead of EventType.C_M_DELETE_FAMILY.&lt;/p&gt;

&lt;p&gt;So, delete family is already taken care but i will fix the DeleteHandler to use the correct event type as well as well as incorporate the required changes to reflect the same during instant schema change.  &lt;/p&gt;</comment>
                            <comment id="13087521" author="yuzhihong@gmail.com" created="Fri, 19 Aug 2011 04:25:20 +0000"  >&lt;p&gt;I think load balancer should be temporarily disabled at the beginning of instant schema change. &lt;br/&gt;
At the end, balancer should be enabled. &lt;br/&gt;
We should perform some testing on a table which has over 400 regions to see how long it takes for a cluster under normal load. &lt;br/&gt;
If it is not too long, disabling balancer should be fine. &lt;/p&gt;</comment>
                            <comment id="13087523" author="iamknome" created="Fri, 19 Aug 2011 04:30:26 +0000"  >&lt;p&gt;Yup. sure that makes perfect sense.&lt;/p&gt;


</comment>
                            <comment id="13088126" author="yuzhihong@gmail.com" created="Sat, 20 Aug 2011 04:34:34 +0000"  >&lt;p&gt;@Subbu:&lt;br/&gt;
You are going to upload another patch with load balancer related code, right ?&lt;/p&gt;</comment>
                            <comment id="13088224" author="iamknome" created="Sat, 20 Aug 2011 17:05:27 +0000"  >&lt;p&gt;Yes. I will.. I am  on it.&lt;/p&gt;

</comment>
                            <comment id="13088461" author="iamknome" created="Sun, 21 Aug 2011 21:13:17 +0000"  >&lt;p&gt;Latest version attached.&lt;/p&gt;
</comment>
                            <comment id="13088462" author="iamknome" created="Sun, 21 Aug 2011 21:18:20 +0000"  >&lt;p&gt;Latest patch includes the following changes:&lt;/p&gt;

&lt;p&gt;1. Load balancer will be turned off (if already enabled) before an instant schema change operation.&lt;br/&gt;
2. Load balancer will be turned on (if was on before the instant schema change).&lt;br/&gt;
3. Added a ZK based check instead of sleep timer for couple of tests. &lt;br/&gt;
4. Master stores the number of online RS while creating the schema change node. On completion the master compares against this count (rather than current number of active RS which might have changed during the schema change operation) with number of active RS to determine if all the RS have completed the schema change operation. &lt;/p&gt;</comment>
                            <comment id="13088691" author="yuzhihong@gmail.com" created="Mon, 22 Aug 2011 13:40:42 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; currentBalanceSwitch = master.isBalancerEnabaled();
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.isBalancerEnabaled()) {
+          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Load Balancer enabled. Disabling load balancer &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; +
+              &lt;span class=&quot;code-quote&quot;&gt;&quot;instant schema change&quot;&lt;/span&gt;);
+          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.balanceSwitch(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think there is no need to introduce a new method. master.balanceSwitch() returns the old value which can be stored in currentBalanceSwitch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!masterSchemaChangeTracker.isSchemaChangeNodeExists(
+              Bytes.toString(tableName))) {
+            &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
+          }
+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should we introduce fault tolerance logic in the above loop ? E.g. if a region server goes down and thus would not acknowledge completion of the schema change.&lt;/p&gt;</comment>
                            <comment id="13088733" author="yuzhihong@gmail.com" created="Mon, 22 Aug 2011 14:33:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;4. Master stores the number of online RS while creating the schema change node.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Suppose RS1 was included in this count. Later it crashes and is brought up (either manually or by automated script). We should be able to tell that RS1 has completed schema change (by loading updated HTD).&lt;br/&gt;
My suggestion is to record the names of region servers in the above step.&lt;/p&gt;</comment>
                            <comment id="13089001" author="yuzhihong@gmail.com" created="Mon, 22 Aug 2011 20:55:31 +0000"  >&lt;p&gt;Discussed this feature with Nileema, Stack, Karthick.&lt;br/&gt;
Desired characteristics include:&lt;br/&gt;
1. Accommodating master failover.&lt;br/&gt;
2. Ability for displaying progress information. This would be useful for Ops.&lt;br/&gt;
3. Throttling. &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt; provides the ability to ensure that only a configurable number of regions are closed per region server at a time.&lt;/p&gt;</comment>
                            <comment id="13089188" author="iamknome" created="Tue, 23 Aug 2011 00:41:29 +0000"  >&lt;p&gt;Sure. We have two approaches.&lt;/p&gt;

&lt;p&gt;1730 + master failover&lt;br/&gt;
Or&lt;br/&gt;
4213 + throttling + progress status.&lt;/p&gt;

&lt;p&gt;Let me know which one we want and I can address it accordingly.&lt;/p&gt;

&lt;p&gt;One question I have is:&lt;/p&gt;

&lt;p&gt;Do we really need to go through bulk unassign/assign(through ZK) for schema changes ?&lt;/p&gt;

&lt;p&gt;What is the real drawback of simply signaling the RS cloud to refresh their regions on schema changes?&lt;/p&gt;


&lt;p&gt;Sent from my iPhone&lt;/p&gt;

</comment>
                            <comment id="13089934" author="yuzhihong@gmail.com" created="Wed, 24 Aug 2011 01:20:23 +0000"  >&lt;p&gt;Implementing progress report is not difficult.&lt;br/&gt;
ZK node /hbase/schema/&amp;lt;table name&amp;gt;/&amp;lt;RS server name&amp;gt; would be created when region server receives schema change notification and carry value in the form of &amp;lt;completed regions&amp;gt;/&amp;lt;total regions&amp;gt;.&lt;br/&gt;
MasterSchemaChangeTracker would be able to compute overall progress.&lt;/p&gt;</comment>
                            <comment id="13102229" author="iamknome" created="Sun, 11 Sep 2011 05:41:08 +0000"  >&lt;p&gt;Ted/Stack,&lt;/p&gt;

&lt;p&gt;As we discussed here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;

&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;

&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS. &lt;/p&gt;

&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;
</comment>
                            <comment id="13102281" author="yuzhihong@gmail.com" created="Sun, 11 Sep 2011 14:18:08 +0000"  >&lt;p&gt;I got the following when applying patch v4:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
patching file src/test/java/org/apache/hadoop/hbase/regionserver/handler/TestOpenRegionHandler.java
Hunk #1 FAILED at 135.
1 out of 1 hunk FAILED -- saving rejects to file src/test/java/org/apache/hadoop/hbase/regionserver/handler/TestOpenRegionHandler.java.rej
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;When I tried to compile the code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/Users/tyu/top-hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java:[1179,2] method does not override or implement a method from a supertype

/Users/tyu/top-hbase/trunk/src/main/java/org/apache/hadoop/hbase/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;/SchemaResource.java:[127,13] modifyTable(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[],org.apache.hadoop.hbase.HTableDescriptor,&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;) in org.apache.hadoop.hbase.client.HBaseAdmin cannot be applied to (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[],org.apache.hadoop.hbase.HTableDescriptor)

/Users/tyu/top-hbase/trunk/src/main/java/org/apache/hadoop/hbase/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;/SchemaResource.java:[157,17] cannot find symbol
symbol  : method modifyColumn(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[],org.apache.hadoop.hbase.HColumnDescriptor)
location: class org.apache.hadoop.hbase.client.HBaseAdmin

/Users/tyu/top-hbase/trunk/src/main/java/org/apache/hadoop/hbase/&lt;span class=&quot;code-keyword&quot;&gt;rest&lt;/span&gt;/SchemaResource.java:[159,17] cannot find symbol
symbol  : method addColumn(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[],org.apache.hadoop.hbase.HColumnDescriptor)
location: class org.apache.hadoop.hbase.client.HBaseAdmin

/Users/tyu/top-hbase/trunk/src/main/java/org/apache/hadoop/hbase/avro/AvroServer.java:[285,6] modifyTable(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[],org.apache.hadoop.hbase.HTableDescriptor,&lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;) in org.apache.hadoop.hbase.client.HBaseAdmin cannot be applied to (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[],org.apache.hadoop.hbase.HTableDescriptor)

/Users/tyu/top-hbase/trunk/src/main/java/org/apache/hadoop/hbase/avro/AvroServer.java:[355,6] cannot find symbol
symbol  : method addColumn(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[],org.apache.hadoop.hbase.HColumnDescriptor)
location: class org.apache.hadoop.hbase.client.HBaseAdmin

/Users/tyu/top-hbase/trunk/src/main/java/org/apache/hadoop/hbase/avro/AvroServer.java:[368,6] cannot find symbol
symbol  : method deleteColumn(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[],&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[])
location: class org.apache.hadoop.hbase.client.HBaseAdmin

/Users/tyu/top-hbase/trunk/src/main/java/org/apache/hadoop/hbase/avro/AvroServer.java:[380,6] cannot find symbol
symbol  : method modifyColumn(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[],org.apache.hadoop.hbase.HColumnDescriptor)
location: class org.apache.hadoop.hbase.client.HBaseAdmin
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, was progress reporting implemented in v4 ?&lt;br/&gt;
It can be done in the separate JIRA.&lt;/p&gt;</comment>
                            <comment id="13102335" author="iamknome" created="Sun, 11 Sep 2011 20:01:16 +0000"  >&lt;p&gt;Ted,&lt;/p&gt;

&lt;p&gt;I addressed all the issues + a merge conflict and also ran all the tests on my local. All tests pass except the following which has nothing to do with this effort.&lt;/p&gt;


&lt;p&gt;Results :&lt;/p&gt;

&lt;p&gt;Failed tests:   testWorkerAbort(org.apache.hadoop.hbase.master.TestDistributedLogSplitting): expected:&amp;lt;1&amp;gt; but was:&amp;lt;0&amp;gt;&lt;br/&gt;
  testMultipleResubmits(org.apache.hadoop.hbase.master.TestSplitLogManager): expected:&amp;lt;2&amp;gt; but was:&amp;lt;3&amp;gt;&lt;br/&gt;
  testMergeTool(org.apache.hadoop.hbase.util.TestMergeTool): &apos;merging regions 0 and 1&apos; failed with errCode -1&lt;/p&gt;

&lt;p&gt;Tests in error: &lt;br/&gt;
  testScanMultipleVersions(org.apache.hadoop.hbase.TestScanMultipleVersions): Cannot lock storage /work/HBase0909/hbase/build/hbase/test/dfs/name1. The directory is already locked.&lt;br/&gt;
  testAll(org.apache.hadoop.hbase.thrift.TestThriftServer): Cannot lock storage /work/HBase0909/hbase/build/hbase/test/dfs/name2. The directory is already locked.&lt;/p&gt;

&lt;p&gt;Tests run: 970, Failures: 3, Errors: 2, Skipped: 9&lt;/p&gt;</comment>
                            <comment id="13102336" author="iamknome" created="Sun, 11 Sep 2011 20:04:08 +0000"  >&lt;p&gt;Yes, I agree with you that we shall address 1) progress reporting and 2) secondary master take over through separate JIRA&apos;s.&lt;/p&gt;

&lt;p&gt;Let me know if you have any comments. The changes are same except new additions to address the 1730 merge.&lt;/p&gt;</comment>
                            <comment id="13102342" author="yuzhihong@gmail.com" created="Sun, 11 Sep 2011 20:43:24 +0000"  >&lt;p&gt;I created &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4370&quot; title=&quot;Support progress reporting and master failover for instant schema updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4370&quot;&gt;&lt;del&gt;HBASE-4370&lt;/del&gt;&lt;/a&gt; for the follow-on work.&lt;br/&gt;
I think publishing patch version 5 on review board should make it easier for other developers to comment.&lt;/p&gt;</comment>
                            <comment id="13102344" author="iamknome" created="Sun, 11 Sep 2011 20:54:08 +0000"  >&lt;p&gt;Ted,&lt;/p&gt;

&lt;p&gt;Can you help me post it to RB? I have problems posting the same.&lt;/p&gt;

&lt;p&gt;thanks&lt;br/&gt;
Subbu&lt;/p&gt;

</comment>
                            <comment id="13102348" author="yuzhihong@gmail.com" created="Sun, 11 Sep 2011 21:06:49 +0000"  >&lt;p&gt;Patch version 6 is same as version 5.&lt;br/&gt;
It is accepted by review board.&lt;/p&gt;

&lt;p&gt;I think the original author of the patch should be the person sending out review request.&lt;/p&gt;</comment>
                            <comment id="13102353" author="yuzhihong@gmail.com" created="Sun, 11 Sep 2011 21:29:06 +0000"  >&lt;p&gt;In HBaseAdmin.java, javadoc should be added for instantAdd parameter:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    * @param column column descriptor of column to be added
    * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a remote or network exception occurs
    */
-  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void addColumn(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tableName, HColumnDescriptor column)
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void addColumn(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tableName, HColumnDescriptor column, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; instantAdd)
   &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Personally I prefer creating an enum, possibly called SCHEMA_OP_TYPE, which should contain NORMAL and INSTANT. There are two benefits:&lt;br/&gt;
1. the enum is more meaningful for readers&lt;br/&gt;
2. SCHEMA_OP_TYPE.INSTANT covers add/delete. This may provide benefit for related code.&lt;br/&gt;
This is minor, though.&lt;/p&gt;</comment>
                            <comment id="13102897" author="jiraposter@reviews.apache.org" created="Mon, 12 Sep 2011 18:37:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;

&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;

&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;

&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4213&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/avro/AvroServer.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/rest/SchemaResource.java 1169522 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1169522 &lt;br/&gt;
  /src/main/ruby/hbase/admin.rb 1169522 &lt;br/&gt;
  /src/main/ruby/shell.rb 1169522 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java 1169522 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java 1169522 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1169522 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1169522 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/regionserver/handler/MockRegionServerServices.java 1169522 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit tests pass.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Ted&lt;/p&gt;
</comment>
                            <comment id="13103104" author="jiraposter@reviews.apache.org" created="Mon, 12 Sep 2011 21:59:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/#review1862&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#review1862&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4254&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4254&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please add javadoc for instantAdd.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4255&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4255&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Add javadoc for instantAdd.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4256&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4256&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Javadoc.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4257&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4257&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Please wrap long lines.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4258&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4258&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Javadoc for new param.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4260&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4260&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    @Override should be kept.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-12 18:36:02, Ted Yu wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-12 18:36:02)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4213&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/avro/AvroServer.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/rest/SchemaResource.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/shell.rb 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/regionserver/handler/MockRegionServerServices.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Unit tests pass.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ted&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13103198" author="jiraposter@reviews.apache.org" created="Mon, 12 Sep 2011 23:59:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/#review1863&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#review1863&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4261&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4261&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Javadoc should explain the role of this class.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4262&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4262&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I think this should be: ... SchemaChangeTracker&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-12 18:36:02, Ted Yu wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-12 18:36:02)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4213&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/avro/AvroServer.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/rest/SchemaResource.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/shell.rb 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/regionserver/handler/MockRegionServerServices.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Unit tests pass.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ted&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13103925" author="iamknome" created="Tue, 13 Sep 2011 19:35:59 +0000"  >&lt;p&gt;Based on further discussions, here are some call outs:&lt;/p&gt;

&lt;p&gt;1. Provide separate public API&apos;s for alter instant operations so as to not break existing public API&apos;s with out deprecation or prior notice.&lt;/p&gt;

&lt;p&gt;2. Provide a config level setting to enable instant schema update feature. (defaults to false). This will also enable us to release this feature in a more controlled and transparent manner.&lt;/p&gt;

&lt;p&gt;3. We don&apos;t want to intimidate developers with scary boolean flags&lt;br/&gt;
that does things in a such a way that they may not completely&lt;br/&gt;
understand or care about.&lt;/p&gt;

&lt;p&gt;4.&lt;br/&gt;
Providing a developer level API to use instant-alter is good in the&lt;br/&gt;
sense they can fully capitalize a scalable/fault tolerant variants. At&lt;br/&gt;
the same time it might be confusing to some in the sense that why we&lt;br/&gt;
are even providing a &quot;not scalable/fault tolerant&quot; variant in the&lt;br/&gt;
first place.&lt;/p&gt;

&lt;p&gt;5. We don&apos;t want to expose implementation details such as &quot;this flag&lt;br/&gt;
uses ZK to track schema changes and so on&quot;&lt;/p&gt;

&lt;p&gt;So, long story short:&lt;/p&gt;

&lt;p&gt;In addition to review comments, V7 will include the following:&lt;/p&gt;

&lt;p&gt;1. Add new config parameter &quot;hbase.instant.schema.change.enabled&quot;&lt;br/&gt;
(exact name of flag is open) and default to &quot;false&quot; so that all&lt;br/&gt;
existing API&apos;s will go over the current path untouched.&lt;/p&gt;

&lt;p&gt;2. Separate public API&apos;s for all alter operations which supports the&lt;br/&gt;
new pattern in addition to existing public API&apos;s. New API&apos;s will take&lt;br/&gt;
in a boolean parameter that overrides the config setting on a per&lt;br/&gt;
request basis.&lt;/p&gt;

&lt;p&gt;3. Internally both the API&apos;s will go through the same pipeline to&lt;br/&gt;
promote reuse as well as maintainability.&lt;/p&gt;

&lt;p&gt;Please let me know your thoughts/comments.&lt;/p&gt;</comment>
                            <comment id="13104010" author="iamknome" created="Tue, 13 Sep 2011 21:33:11 +0000"  >&lt;p&gt;Attached V7 with all the review comments + above mentioned additions.&lt;/p&gt;</comment>
                            <comment id="13104053" author="jiraposter@reviews.apache.org" created="Tue, 13 Sep 2011 22:41:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/#review1883&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#review1883&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4335&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4335&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    How many times is this expected to spin? Should there be a sleep here?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Andrew&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-12 18:36:02, Ted Yu wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-12 18:36:02)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4213&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/avro/AvroServer.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/rest/SchemaResource.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/shell.rb 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/regionserver/handler/MockRegionServerServices.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Unit tests pass.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ted&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13104054" author="apurtell" created="Tue, 13 Sep 2011 22:42:01 +0000"  >&lt;p&gt;I don&apos;t see the V7 patch attached?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;We don&apos;t want to intimidate developers with scary boolean flags that does things in a such a way that they may not completely understand or care about.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, this jumped out almost immediately. Should not have the boolean flags on the admin methods. If &apos;hbase.instant.schema.change.enabled&apos; is true, then just do it? Is another set of admin APIs necessary? &lt;/p&gt;

&lt;p&gt;Shell shouldn&apos;t need a new command, just do it &quot;instant&quot; if config var is enabled?&lt;/p&gt;

&lt;p&gt;The unit test looks ok but it might be useful to include a case where a RS is killed while in the middle of a schema change. Confirm that the updates are all applied successfully when recovery is complete.&lt;/p&gt;

&lt;p&gt;Other comment on the V6 patch up on RB.&lt;/p&gt;</comment>
                            <comment id="13104142" author="yuzhihong@gmail.com" created="Wed, 14 Sep 2011 01:25:10 +0000"  >&lt;p&gt;@Andy:&lt;br/&gt;
4213-V7-Support_instant_schema_changes_through_ZK.patch is the version 7 patch.&lt;br/&gt;
The new methods in HBaseAdmin allow overriding &apos;hbase.instant.schema.change.enabled&apos; config parameter. Is this Okay ?&lt;/p&gt;</comment>
                            <comment id="13104152" author="apurtell" created="Wed, 14 Sep 2011 01:36:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;The new methods in HBaseAdmin allow overriding &apos;hbase.instant.schema.change.enabled&apos; config parameter. Is this Okay ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Isn&apos;t the configuration variable there to support a transition, if people are not comfortable using ZK for schema updates in the beginning? Surely we will not have two ways of updating schema coexisting for a long time. There would not be a need to toggle between them. Adding new APIs that we&apos;d have to quickly deprecate does not make sense to me.&lt;/p&gt;</comment>
                            <comment id="13104255" author="iamknome" created="Wed, 14 Sep 2011 05:11:10 +0000"  >&lt;p&gt;Andrew, thanks for your comments.&lt;/p&gt;

&lt;p&gt;In V8.&lt;/p&gt;

&lt;p&gt;1. Axed all boolean based public API&apos;s from HBaseAdmin and HMAster. &lt;br/&gt;
2. Schema changes will now drive off the config param. &lt;br/&gt;
3. alter_instant removed.&lt;br/&gt;
4. We have new JIRA 4370 where we plan to address the Master/RS failover scenarios in depth. So, we will probably address your new test case scenario there. The current JIRA is to put a basic framework to support schema changes through ZK in place. &lt;/p&gt;

&lt;p&gt;Currently, when a RS dies halfway through the change the ZK node might stay on for ever, although the schema changes would have been completed when the RS comes back alive. This will be addressed intelligently in 4370 by stamping the RS hostname in ZK and so on. (more details in 4370)&lt;/p&gt;

&lt;p&gt;Hope this helps and let me know for any thing else.&lt;/p&gt;

&lt;p&gt;thanks&lt;br/&gt;
Subbu &lt;/p&gt;</comment>
                            <comment id="13104266" author="apurtell" created="Wed, 14 Sep 2011 05:38:48 +0000"  >&lt;p&gt;+1 Thanks Subbu&lt;/p&gt;</comment>
                            <comment id="13104280" author="jiraposter@reviews.apache.org" created="Wed, 14 Sep 2011 06:12:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/#review1885&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#review1885&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4337&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4337&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    coming late to the game on the review here...&lt;/p&gt;

&lt;p&gt;    but why do we need a separate &quot;instantAdd&quot; boolean. If this feature works, we should always use it. Otherwise we have to maintain multiple code paths, and the API is more complicated. Plus, this breaks a public API.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4338&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4338&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    the fact that these two constructors differ only by number of arguments is quite suspect. Same with the two functions below.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4339&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4339&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    we need to somehow expose this to the user in a way aside from just the logs. For example, we could make a MonitoredTask for the table operation, and mark it as failed here.&lt;/p&gt;

&lt;p&gt;    Ideally it would actually be a response to the original RPC that the user called in HTableAdmin.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4340&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4340&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    we need some kind of try/finally here. Plus, this can easily race against other things enabling/disabling the balancer. We need a kind of &quot;balancer disable stack&quot; so that if multiple operations need to disable the balancer for a period, they can all work together. Plus, if the balancer is mid-balance, does balanceSwitch(false) wait for the balance to finish?&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4341&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4341&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    definitely need a sleep or yield. Seems like a code smell as well&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4342&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4342&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    why not just make this the while condition?&lt;/p&gt;

&lt;p&gt;    Since ZK is notification-based, can&apos;t we wait on this occuring rather than polling in a loop?&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4343&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4343&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    !isEmpty() instead of size() comparison&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4344&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4344&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    what happens if on the reopen, an exception is thrown? does the region get orphaned? we need some kind of recovery path here.&lt;/p&gt;

&lt;p&gt;    Example case: what if you alter a table and change compression to a codec that this RS doesn&apos;t have?&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4345&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4345&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    seems like DEBUG level.&lt;/p&gt;

&lt;p&gt;    This whole process should be TaskMonitored.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4351&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4351&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    this function never returns null. So at call sites, don&apos;t check for null - just adds cruft.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4346&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4346&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    thread safety properties here? I&apos;m surprised we don&apos;t need any locking. For example, what happens to regions that are in the process of opening?&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4348&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4348&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    !isEmpty()&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4349&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4349&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    DEBUG level&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4350&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4350&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    DEBUG&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4347&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4347&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    should be ERROR or at least WARN level.&lt;br/&gt;
    Need to include the exception traceback.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4352&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4352&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    empty javadoc, plus it doesn&apos;t @return anything, it&apos;s void&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4353&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4353&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    this should be registered &lt;em&gt;before&lt;/em&gt; the above line, right?&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4354&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4354&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    if this fails, shouldn&apos;t we abort the server or something? We don&apos;t want a half-functional RS running that doesn&apos;t respond to schema changes.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4355&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4355&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    empty javadoc&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4356&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4356&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    debug&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4358&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4358&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    debug&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4359&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4359&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    why is this the right behavior? could use a comment here, because it seems wrong.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4360&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4360&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    why create and then set data, instead of just creating with the correct data?&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4357&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4357&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    rename to &quot;schemaChangeNodeExists&quot; or &quot;doesSchemaChangeNodeExist&quot;&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4361&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4361&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    dead code&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4362&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4362&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    would servers ever be null?&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4363&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4363&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    what would cause this and what are the ramifications?&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4364&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4364&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    this would be on &lt;b&gt;any&lt;/b&gt; ZK change anywhere, right? Maybe better to invert this whole condition and just &quot;return;&quot; if it&apos;s for a path you&apos;re not interested in, reducing the nesting level of the function&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4365&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4365&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    this order seems wrong, again&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4366&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4366&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    debug&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4367&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4367&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    again error paths seem suspect&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4368&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4368&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    again: when would these error paths get hit, and what state would we be left in? needs comments describing why it&apos;s safe to ignore the errors&lt;/p&gt;



&lt;p&gt;/src/main/ruby/hbase/admin.rb&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4369&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4369&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    similar to above, I see no reason to duplicate APIs here... having multiple alter commands is just going to confuse users and mean we have more code paths to test&lt;/p&gt;



&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4371&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4371&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    need test cases covering failure cases. EG modify a column to change the codec to a random string, or some other modification that will cause an error on open.&lt;/p&gt;

&lt;p&gt;    another test case: what if you use the &quot;instant&quot; API while the table is disabled?&lt;/p&gt;

&lt;p&gt;    what about while the table is in the process of opening?&lt;/p&gt;



&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4370&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4370&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    these while conditions should at least yield if not sleep. Plus why not just put the condition in the while, rather than if/break?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Todd&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-12 18:36:02, Ted Yu wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-12 18:36:02)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4213&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/avro/AvroServer.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/rest/SchemaResource.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/shell.rb 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/regionserver/handler/MockRegionServerServices.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Unit tests pass.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ted&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13104288" author="apurtell" created="Wed, 14 Sep 2011 06:22:07 +0000"  >&lt;p&gt;Just want to clarify that my +1 is conditional on having the config option that selects between the schema update options, with the old one the default; and an expectation that &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4370&quot; title=&quot;Support progress reporting and master failover for instant schema updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4370&quot;&gt;&lt;del&gt;HBASE-4370&lt;/del&gt;&lt;/a&gt; will be developed and go in soon after, along with many tests for failures at different points in the update processing.&lt;/p&gt;</comment>
                            <comment id="13104295" author="apurtell" created="Wed, 14 Sep 2011 06:30:09 +0000"  >&lt;p&gt;In fact I&apos;m wondering now why &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4370&quot; title=&quot;Support progress reporting and master failover for instant schema updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4370&quot;&gt;&lt;del&gt;HBASE-4370&lt;/del&gt;&lt;/a&gt; is separate. &lt;/p&gt;

</comment>
                            <comment id="13104372" author="jiraposter@reviews.apache.org" created="Wed, 14 Sep 2011 09:20:08 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/#review1886&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#review1886&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4372&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4372&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Master checks balanceSwitch at the beginning of balance(). Meaning, the toggle of balanceSwitch would take effect in the next round of balancing.&lt;br/&gt;
    We have two options in order to make balanceSwitch() call synchronous with balance():&lt;br/&gt;
    1. Change balanceSwitch() to be synchronous directly. This breaks the API compatibility&lt;br/&gt;
    2. Add new method, e.g. blockingBalanceSwitch(), to HMasterInterface()&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment4373&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment4373&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    From listChildrenAndWatchThem():&lt;br/&gt;
        if (children == null) &lt;/p&gt;
{
          return null;
        }
&lt;p&gt;    So I guess the answer is yes.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-09-12 18:36:02, Ted Yu wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-09-12 18:36:02)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4213&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/avro/AvroServer.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/rest/SchemaResource.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/hbase/admin.rb 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/ruby/shell.rb 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/regionserver/handler/MockRegionServerServices.java 1169522 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Unit tests pass.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ted&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13106776" author="iamknome" created="Fri, 16 Sep 2011 20:22:06 +0000"  >&lt;p&gt;In addition to most of the review comments, V9 adds:&lt;/p&gt;

&lt;p&gt;1. Handle cases when the table is not in enabled state.&lt;br/&gt;
2. Ensures that concurrent alter requests are not missed.&lt;br/&gt;
3. Validate that alter can survive cases when one of the RS goes down during alter, or multiple RS going down during alter or adding new RS servers to the cloud during an alter.&lt;br/&gt;
4. Handle cases when primary master is brought down during alter and secondary takes over.&lt;br/&gt;
5. Added new test cases for all of the above mentioned cases.&lt;/p&gt;

&lt;p&gt;To-Do:&lt;br/&gt;
1. Revisit the load balancer toggling. It doesn&apos;t seem right.&lt;br/&gt;
2. Add monitoring support for alter process.&lt;br/&gt;
3. Gracefully handle cases when ZooKeeper throws exceptions during an alter.&lt;br/&gt;
4. Add fine grained tests to validate master failover cases.&lt;br/&gt;
5. Address any other comments/suggestions.&lt;/p&gt;



</comment>
                            <comment id="13106802" author="yuzhihong@gmail.com" created="Fri, 16 Sep 2011 20:48:35 +0000"  >&lt;p&gt;Subbu&apos;s patch v9&lt;/p&gt;</comment>
                            <comment id="13107005" author="jiraposter@reviews.apache.org" created="Sat, 17 Sep 2011 03:18:09 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-09-17 03:16:42.534475)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In addition to most of the review comments, V9 adds:&lt;/p&gt;

&lt;p&gt;1. Handle cases when the table is not in enabled state.&lt;br/&gt;
2. Ensures that concurrent alter requests are not missed.&lt;br/&gt;
3. Validate that alter can survive cases when one of the RS goes down during alter, or multiple RS going down during alter or adding new RS servers to the cloud during an alter.&lt;br/&gt;
4. Handle cases when primary master is brought down during alter and secondary takes over.&lt;br/&gt;
5. Added new test cases for all of the above mentioned cases.&lt;/p&gt;

&lt;p&gt;To-Do:&lt;br/&gt;
1. Revisit the load balancer toggling. It doesn&apos;t seem right.&lt;br/&gt;
2. Add monitoring support for alter process.&lt;br/&gt;
3. Gracefully handle cases when ZooKeeper throws exceptions during an alter.&lt;br/&gt;
4. Add fine grained tests to validate master failover cases.&lt;br/&gt;
5. Address any other comments/suggestions.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;

&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;

&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;

&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4213&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1171786 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1171786 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1171786 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1171786 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1171786 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1171840 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1171786 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1171786 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1171786 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1171786 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1171786 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1171786 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1171786 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1171786 &lt;br/&gt;
  /src/main/resources/hbase-default.xml 1171786 &lt;br/&gt;
  /src/main/ruby/hbase/admin.rb 1171786 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1171786 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/regionserver/handler/MockRegionServerServices.java 1171786 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit tests pass.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Ted&lt;/p&gt;
</comment>
                            <comment id="13126326" author="iamknome" created="Thu, 13 Oct 2011 03:42:29 +0000"  >&lt;p&gt;Latest patch supports:&lt;/p&gt;

&lt;p&gt;1. LB aware schema change process.&lt;br/&gt;
2. Monitoring support to show the alter status/error etc.&lt;br/&gt;
3. Progress reporting.&lt;br/&gt;
4. Added extensive test scenarios to test various failover/failure scenarios. (17 test cases so far)&lt;/p&gt;</comment>
                            <comment id="13126331" author="yuzhihong@gmail.com" created="Thu, 13 Oct 2011 03:55:09 +0000"  >&lt;p&gt;Nice work, Subbu.&lt;br/&gt;
Please adjust your patch for TRUNK:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
patching file src/test/java/org/apache/hadoop/hbase/regionserver/handler/MockRegionServerServices.java
Hunk #1 FAILED at 18.
Hunk #2 succeeded at 52 (offset 1 line).
1 out of 2 hunks FAILED -- saving rejects to file src/test/java/org/apache/hadoop/hbase/regionserver/handler/MockRegionServerServices.java.rej
...
Hunk #4 succeeded at 241 (offset 14 lines).
1 out of 4 hunks FAILED -- saving rejects to file src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java.rej
...
2 out of 20 hunks FAILED -- saving rejects to file src/main/java/org/apache/hadoop/hbase/master/HMaster.java.rej
...
1 out of 2 hunks FAILED -- saving rejects to file src/main/java/org/apache/hadoop/hbase/master/MasterServices.java.rej
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13126333" author="iamknome" created="Thu, 13 Oct 2011 04:01:11 +0000"  >&lt;p&gt;Ted,&lt;/p&gt;

&lt;p&gt;Yes, I will. My trunk is from 09/12. I wanted to get some initial feedback.&lt;/p&gt;

&lt;p&gt;This time I could successfully request for a RB request. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Let me know how we handle this LB integration makes sense to you.&lt;/p&gt;


&lt;p&gt;thanks&lt;br/&gt;
Subbu&lt;/p&gt;


</comment>
                            <comment id="13126344" author="yuzhihong@gmail.com" created="Thu, 13 Oct 2011 04:43:49 +0000"  >&lt;p&gt;I only looked at part of the patch.&lt;/p&gt;

&lt;p&gt;For getAndStartSchemaJanitorChore(), javadoc should be corrected:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// Start up the load balancer chore
&lt;/span&gt;+    Chore chore = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Chore(name, schemaJanitorPeriod, master) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For getAndStartBalancerChore():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (doesLoadBalancerNodeExists()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The trailing s in the above name is unnecessary.&lt;br/&gt;
For doesLoadBalancerNodeExists():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; r = ZKUtil.checkExists(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.zooKeeper, zooKeeper.loadBalancerZNode);
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ZKUtil.checkExists(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.zooKeeper, zooKeeper.loadBalancerZNode) != -1;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The assignment above is for debugging, I guess. Please remove it.&lt;/p&gt;

&lt;p&gt;I think a better name for waitForCurrentSchemaChange() would be waitForCurrentSchemaChangeToComplete().&lt;br/&gt;
But the following debug should be removed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+         LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Schema change operation is in progress. Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; +
+             &lt;span class=&quot;code-quote&quot;&gt;&quot;it to complete before running the load balancer.&quot;&lt;/span&gt;);
+         &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In balance():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-comment&quot;&gt;// I don&apos;t think we need the following check because we already have
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// acquired the lock on balancer ??&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So the following isLoadBalancerRunning() call can be removed &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;For TableEventHandler.waitForLoadBalancerToComplete(), since master.isLoadBalancerRunning() checks zk node, should isLoadBalancerRunning() be moved to ZKUtil ? This would save RPC call.&lt;/p&gt;

&lt;p&gt;MasterSchemaChangeTracker.handleFailedExpiredSchemaChanges() should be called handleFailedOrExpiredSchemaChanges()&lt;/p&gt;

&lt;p&gt;So latest patch doesn&apos;t use the new synchronous switchBalancer(). Interesting.&lt;/p&gt;

&lt;p&gt;There&apos;re pending questions in the patch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-comment&quot;&gt;// Should we block here until we successfully create a LB node in ZK?
&lt;/span&gt;+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (createLoadBalancerNode()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;createLoadBalancerNode() should distinguish KeeperException&apos;s that may arise and inform Master so that Master can make better decision.&lt;/p&gt;

&lt;p&gt;For getAlterStatusFromSchemaChangeTracker():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;MasterAlterStatus is NULL &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; table = &quot;&lt;/span&gt;
+          + Bytes.toString(tableName));
+      &lt;span class=&quot;code-comment&quot;&gt;// should we &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; IOException here as it makes more sense?
&lt;/span&gt;+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Pair&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Integer&lt;/span&gt;&amp;gt;(0,0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think IOE makes more sense in the above case.&lt;/p&gt;

&lt;p&gt;After the modified patch is posted to review board, comments would have better context.&lt;/p&gt;

&lt;p&gt;Thanks for your perseverance, Subbu.&lt;br/&gt;
This feature has been requested by many customers.&lt;/p&gt;</comment>
                            <comment id="13126348" author="iamknome" created="Thu, 13 Oct 2011 05:09:11 +0000"  >&lt;p&gt;Thanks for your support on this Ted.&lt;/p&gt;

&lt;p&gt;Also, on my local (with only one RS), for a 70 region test table I see a more than 100+% improvement in alter performance. &lt;/p&gt;

&lt;p&gt;For a table in a bigger cluster with large number of regions, we should see drastic difference in performance. &lt;/p&gt;

&lt;p&gt;thanks&lt;br/&gt;
Subbu &lt;/p&gt;

</comment>
                            <comment id="13135707" author="iamknome" created="Wed, 26 Oct 2011 04:55:21 +0000"  >&lt;p&gt;Attached latest patch with trunk merge.&lt;/p&gt;</comment>
                            <comment id="13142414" author="yuzhihong@gmail.com" created="Wed, 2 Nov 2011 18:58:46 +0000"  >&lt;p&gt;Patch from Subbu for TRUNK.&lt;/p&gt;</comment>
                            <comment id="13142639" author="hadoopqa" created="Wed, 2 Nov 2011 22:44:11 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12502012/4213-Nov-2-2011_patch_.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12502012/4213-Nov-2-2011_patch_.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -161 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 52 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.thrift2.TestThriftHBaseServiceHandler&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestDistributedLogSplitting&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestServerCustomProtocol&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestInstantSchemaChange&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestMasterFailover&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/144//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/144//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/144//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/144//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/144//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/144//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13142666" author="yuzhihong@gmail.com" created="Wed, 2 Nov 2011 23:14:51 +0000"  >&lt;p&gt;TestInstantSchemaChange failures were due to &apos;Too many open files&apos;&lt;/p&gt;

&lt;p&gt;TestThriftHBaseServiceHandler failures were due to another hanging minicluster.&lt;/p&gt;</comment>
                            <comment id="13143401" author="jdcryans" created="Thu, 3 Nov 2011 18:13:19 +0000"  >&lt;p&gt;The latest patch doesn&apos;t apply to 0.92, would it be possible to have another version for it? Thanks.&lt;/p&gt;

&lt;p&gt;Also looking over the patch names, it would sure be nice if they followed some sort of convention.&lt;/p&gt;</comment>
                            <comment id="13143472" author="yuzhihong@gmail.com" created="Thu, 3 Nov 2011 19:30:39 +0000"  >&lt;p&gt;Patch 4213-0.92.txt is rebased for 0.92 branch.&lt;/p&gt;

&lt;p&gt;HMaster.waitForCurrentSchemaChange() has been removed.&lt;/p&gt;

&lt;p&gt;TestInstantSchemaChangeFailover and TestInstantSchemaChange passed.&lt;/p&gt;</comment>
                            <comment id="13143605" author="jdcryans" created="Thu, 3 Nov 2011 23:27:23 +0000"  >&lt;p&gt;First time I tried it on my cluster, all 15 region servers died with this just after calling the alter (which returned successfully):&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2011-11-03 23:17:49,996 ERROR org.apache.hadoop.hbase.master.HMaster: Region server sv4r27s44,62023,1320362227032 reported a fatal error:&lt;br/&gt;
ABORTING region server sv4r27s44,62023,1320362227032: Unhandled exception: null&lt;br/&gt;
Cause:&lt;br/&gt;
java.lang.NullPointerException&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HRegionServer.createRegionLoad(HRegionServer.java:1001)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HRegionServer.buildServerLoad(HRegionServer.java:800)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HRegionServer.tryRegionServerReport(HRegionServer.java:776)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:678)&lt;br/&gt;
	at java.lang.Thread.run(Thread.java:662)&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13144773" author="iamknome" created="Sat, 5 Nov 2011 18:16:36 +0000"  >&lt;p&gt;JD,&lt;/p&gt;

&lt;p&gt;Fixed the NPE that is causing the RS to die. All tests pass and don&apos;t see this exception.&lt;/p&gt;

&lt;p&gt;Would be great if you can give it one more try with your concurrent alter + split scenario. I am also adding a test case for the concurrent split + alter scenario and I am validating the same.&lt;/p&gt;</comment>
                            <comment id="13144776" author="iamknome" created="Sat, 5 Nov 2011 18:18:07 +0000"  >&lt;p&gt;This patch goes on top of previous commit.&lt;/p&gt;</comment>
                            <comment id="13145961" author="iamknome" created="Mon, 7 Nov 2011 23:55:59 +0000"  >&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;New patch to address concurrent schema alter and region splits.&lt;/li&gt;
	&lt;li&gt;Added two new tests to test the concurrent split + alter scenarios.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13145963" author="iamknome" created="Mon, 7 Nov 2011 23:56:50 +0000"  >&lt;p&gt;This is a delta patch and goes on top of the latest 0.90.2 patch that is already uploaded.&lt;/p&gt;</comment>
                            <comment id="13145973" author="hadoopqa" created="Tue, 8 Nov 2011 00:02:20 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12502847/4213-Nov072011-Patch_to_support_concurrent_split_and_alter__.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12502847/4213-Nov072011-Patch_to_support_concurrent_split_and_alter__.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/215//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/215//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13150729" author="yuzhihong@gmail.com" created="Tue, 15 Nov 2011 20:05:52 +0000"  >&lt;p&gt;Version 2 of patch for 0.92 branch.&lt;/p&gt;</comment>
                            <comment id="13150820" author="hadoopqa" created="Tue, 15 Nov 2011 22:01:22 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12503785/4213-0.92.v2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12503785/4213-0.92.v2&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 58 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.io.hfile.TestHFileBlock&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestDistributedLogSplitting&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestInstantSchemaChange&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.wal.TestLogRolling&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/258//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/258//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/258//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/258//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/258//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/258//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13150854" author="yuzhihong@gmail.com" created="Tue, 15 Nov 2011 22:42:07 +0000"  >&lt;p&gt;It turns out that 4213-0.92.v2 can be cleanly applied to TRUNK as well.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  635  mt -Dtest=TestInstantSchemaChange#testConcurrentInstantSchemaChangeAndSplit 
  636  mt -Dtest=TestInstantSchemaChange#testInstantSchemaJanitor 
  637  mt -Dtest=TestInstantSchemaChange#testInstantSchemaChangeExclusions 
  638  mt -Dtest=TestInstantSchemaChange#testInstantSchemaChangeWhileRSOpenRegionFailure
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above tests passed individually on MacBook.&lt;/p&gt;</comment>
                            <comment id="13150886" author="yuzhihong@gmail.com" created="Tue, 15 Nov 2011 23:29:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt; has been updated with 4213-0.92.v2&lt;/p&gt;</comment>
                            <comment id="13150887" author="jiraposter@reviews.apache.org" created="Tue, 15 Nov 2011 23:29:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-15 23:28:55.604278)&lt;/p&gt;


&lt;p&gt;Review request for Todd Lipcon, Andrew Purtell and Subbu Iyer.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated with 4213-0.92.v2&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;

&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;

&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;

&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4213&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1202381 &lt;br/&gt;
  /src/main/resources/hbase-default.xml 1202381 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1202381 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 1202381 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit tests pass.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Ted&lt;/p&gt;
</comment>
                            <comment id="13150921" author="yuzhihong@gmail.com" created="Wed, 16 Nov 2011 00:26:08 +0000"  >&lt;p&gt;I tried the following commands for table t1 which had one column f1 and they worked:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
alter &apos;t1&apos;, { NAME =&amp;gt; &apos;f1&apos;, VERSIONS =&amp;gt; 1 }
alter &apos;t1&apos;, { NAME =&amp;gt; &apos;f2&apos;, VERSIONS =&amp;gt; 1 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13151012" author="jiraposter@reviews.apache.org" created="Wed, 16 Nov 2011 04:24:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/#review3293&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#review3293&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Late to this review...&lt;br/&gt;
Awesome feature. Thanks for doing this Subbu!&lt;/p&gt;

&lt;p&gt;Looks good to me in general.&lt;/p&gt;

&lt;p&gt;Minor comments inline.&lt;/p&gt;

&lt;p&gt;As a general comment, I think it would be better if we could drive from the ZK notifications, rather than doing all this sleeping in a loop waiting for some other action to complete by rechecking the ZK node; would probably require a lot of refactoring to make the code event based.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment7373&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment7373&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    whitespace&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment7372&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment7372&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    whitespace... here and below&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment7366&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment7366&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    How do you know for sure that while we waited for inflightSplits no new round of load balancing has started?&lt;br/&gt;
    Or maybe that is not a problem?&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment7369&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment7369&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Maybe put this method on schema tracker?&lt;br/&gt;
    Similar code is found CompactSplitThread.java.&lt;/p&gt;

&lt;p&gt;    Also, can we use the ZK notifications here instead of waiting in a loop?&lt;/p&gt;




&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment7368&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment7368&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    We&apos;re not added the &quot;year&quot; line anymore.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment7371&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment7371&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    year line...&lt;/p&gt;



&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment7370&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment7370&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Year line ...&lt;/p&gt;



&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment7367&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment7367&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I think we&apos;re not putting this line anymore.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Lars&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-11-15 23:28:55, Ted Yu wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-15 23:28:55)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for Todd Lipcon, Andrew Purtell and Subbu Iyer.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4213&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/resources/hbase-default.xml 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Unit tests pass.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ted&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13151018" author="yuzhihong@gmail.com" created="Wed, 16 Nov 2011 04:43:59 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
Master would check whether schema change is in progress before running balancer:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (schemaChangeTracker.isSchemaChangeInProgress()) {
+        LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Schema change operation is in progress. Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; +
+        &lt;span class=&quot;code-quote&quot;&gt;&quot;it to complete before running the load balancer.&quot;&lt;/span&gt;);
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+      }
+      loadBalancerRunning = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In handleInstantSchemaChanges() where you asked the question:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        waitForLoadBalancerToComplete(status);
        waitForInflightSplit(regions, status);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;See also testLoadBalancerBlocksDuringSchemaChangeRequests()&lt;/p&gt;</comment>
                            <comment id="13151020" author="lhofhansl" created="Wed, 16 Nov 2011 04:50:34 +0000"  >&lt;p&gt;@Ted: Hmm... But we haven&apos;t started the schema change at that point, right? So the master would not know about the intention.&lt;/p&gt;</comment>
                            <comment id="13151026" author="yuzhihong@gmail.com" created="Wed, 16 Nov 2011 05:12:44 +0000"  >&lt;p&gt;I wasn&apos;t able to find switchBalancer() or synchronousBalanceSwitch(created for instant schema change) in the patch.&lt;br/&gt;
I think synchronousBalanceSwitch(false) should be called at line 258.&lt;br/&gt;
synchronousBalanceSwitch(true) should be called in a finally block at line 285.&lt;/p&gt;

&lt;p&gt;Thanks for the finding, Lars.&lt;/p&gt;</comment>
                            <comment id="13151042" author="jiraposter@reviews.apache.org" created="Wed, 16 Nov 2011 06:06:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-16 06:05:02.324776)&lt;/p&gt;


&lt;p&gt;Review request for hbase, Todd Lipcon, Andrew Purtell, and Subbu Iyer.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;New patch uses master.synchronousBalanceSwitch() to ensure that balancer is switched off during instant schema change&lt;/p&gt;

&lt;p&gt;TestInstantSchemaChange#testLoadBalancerBlocksDuringSchemaChangeRequests passed.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;

&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;

&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;

&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1202523 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1202381 &lt;br/&gt;
  /src/main/resources/hbase-default.xml 1202381 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1202381 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 1202381 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit tests pass.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Ted&lt;/p&gt;
</comment>
                            <comment id="13151049" author="jiraposter@reviews.apache.org" created="Wed, 16 Nov 2011 06:12:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-16 06:12:33.670038)&lt;/p&gt;


&lt;p&gt;Review request for Todd Lipcon, Andrew Purtell and Subbu Iyer.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;New patch remembers prevBalanceSwitch and uses it to restore load balancer switch.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;

&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;

&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;

&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1202523 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1202381 &lt;br/&gt;
  /src/main/resources/hbase-default.xml 1202381 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1202381 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 1202381 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit tests pass.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Ted&lt;/p&gt;
</comment>
                            <comment id="13151051" author="lhofhansl" created="Wed, 16 Nov 2011 06:25:04 +0000"  >&lt;p&gt;Thanks Ted.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void handleInstantSchemaChanges(List&amp;lt;HRegionInfo&amp;gt; regions) {
  ...
  &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
    ...
    master.synchronousBalanceSwitch(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
    waitForInflightSplit(regions, status);
    ...
  } &lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
    master.synchronousBalanceSwitch(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;); 
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since balancing might be disabled for other reasons, should probably remember the old balancer state and restore that in the finally block.&lt;/p&gt;</comment>
                            <comment id="13151433" author="jiraposter@reviews.apache.org" created="Wed, 16 Nov 2011 19:12:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-16 19:12:03.308667)&lt;/p&gt;


&lt;p&gt;Review request for Todd Lipcon, Andrew Purtell and Subbu Iyer.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Patch addresses Lars&apos; comments&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;

&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;

&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;

&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1202523 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1202381 &lt;br/&gt;
  /src/main/resources/hbase-default.xml 1202381 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1202381 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 1202381 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit tests pass.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Ted&lt;/p&gt;
</comment>
                            <comment id="13151554" author="hadoopqa" created="Wed, 16 Nov 2011 21:52:55 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12503931/4213-0.92.v4&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12503931/4213-0.92.v4&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 58 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestDistributedLogSplitting&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/267//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/267//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/267//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/267//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/267//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/267//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13151579" author="yuzhihong@gmail.com" created="Wed, 16 Nov 2011 22:27:00 +0000"  >&lt;p&gt;Latest patch adds test category.&lt;/p&gt;</comment>
                            <comment id="13151581" author="yuzhihong@gmail.com" created="Wed, 16 Nov 2011 22:31:19 +0000"  >&lt;p&gt;TestDistributedLogSplitting#testWorkerAbort passed on my MacBook.&lt;/p&gt;</comment>
                            <comment id="13151583" author="yuzhihong@gmail.com" created="Wed, 16 Nov 2011 22:33:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4370&quot; title=&quot;Support progress reporting and master failover for instant schema updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4370&quot;&gt;&lt;del&gt;HBASE-4370&lt;/del&gt;&lt;/a&gt; has mostly been covered by latest patch.&lt;/p&gt;</comment>
                            <comment id="13151654" author="jiraposter@reviews.apache.org" created="Wed, 16 Nov 2011 23:57:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/#review3307&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#review3307&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Looks good to me now (I admit, I only browsed over the new tracker code).&lt;/p&gt;


&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment7392&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment7392&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This is no longer the case.&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment7394&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment7394&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    It also might not return the current list of all online regions, as onlineRegions is changed by other callers (like the one above) without a lock. Is that a problem here?&lt;/p&gt;



&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1786/#comment7395&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/#comment7395&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Super minor nit: Make this string just once?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Lars&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-11-16 19:12:03, Ted Yu wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-11-16 19:12:03)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for Todd Lipcon, Andrew Purtell and Subbu Iyer.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1202523 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/main/resources/hbase-default.xml 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;/src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 1202381 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Unit tests pass.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Ted&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13151681" author="jiraposter@reviews.apache.org" created="Thu, 17 Nov 2011 00:29:51 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-17 00:28:04.519410)&lt;/p&gt;


&lt;p&gt;Review request for Todd Lipcon, Andrew Purtell and Subbu Iyer.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Patch addresses Lars&apos; latest comments (except for the last comment about String where table changes in each iteration)&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;

&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;

&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;

&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1202941 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1202523 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1202941 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1202381 &lt;br/&gt;
  /src/main/resources/hbase-default.xml 1202381 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1202381 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 1202381 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit tests pass.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Ted&lt;/p&gt;
</comment>
                            <comment id="13151707" author="hadoopqa" created="Thu, 17 Nov 2011 01:11:13 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12503966/4213-trunk.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12503966/4213-trunk.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 58 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestInstantSchemaChange&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestDistributedLogSplitting&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/271//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/271//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/271//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/271//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/271//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/271//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13151727" author="yuzhihong@gmail.com" created="Thu, 17 Nov 2011 01:48:01 +0000"  >&lt;p&gt;I saw some &apos;Too many open files&apos; error:&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/271//testReport/org.apache.hadoop.hbase.client/TestInstantSchemaChange/testInstantSchemaChangeExclusions/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/271//testReport/org.apache.hadoop.hbase.client/TestInstantSchemaChange/testInstantSchemaChangeExclusions/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13151728" author="yuzhihong@gmail.com" created="Thu, 17 Nov 2011 01:48:36 +0000"  >&lt;p&gt;Patch after addressing Lars&apos; comments&lt;/p&gt;</comment>
                            <comment id="13151774" author="hadoopqa" created="Thu, 17 Nov 2011 03:40:17 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12504009/4213-trunk-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12504009/4213-trunk-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 59 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestLogRolling&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestInstantSchemaChange&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/275//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/275//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/275//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/275//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/275//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/275//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13151858" author="lhofhansl" created="Thu, 17 Nov 2011 06:34:57 +0000"  >&lt;p&gt;Failure in TestInstantSchemaChange is suspicious. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13151864" author="yuzhihong@gmail.com" created="Thu, 17 Nov 2011 06:41:18 +0000"  >&lt;p&gt;From &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/275//testReport/org.apache.hadoop.hbase.client/TestInstantSchemaChange/testInstantSchemaJanitor/:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/275//testReport/org.apache.hadoop.hbase.client/TestInstantSchemaChange/testInstantSchemaJanitor/:&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.net.SocketException: Too many open files
	at sun.nio.ch.Net.socket0(Native Method)
	at sun.nio.ch.Net.socket(Net.java:97)
	at sun.nio.ch.SocketChannelImpl.&amp;lt;init&amp;gt;(SocketChannelImpl.java:84)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The resource usage for tests in TestInstantSchemaChange is high.&lt;/p&gt;

&lt;p&gt;I was able to run TestInstantSchemaChange successfully for several times on MacBook.&lt;/p&gt;</comment>
                            <comment id="13152550" author="yuzhihong@gmail.com" created="Fri, 18 Nov 2011 01:10:52 +0000"  >&lt;p&gt;Move waitForInflightSchemaChange() to the right place.&lt;/p&gt;</comment>
                            <comment id="13152551" author="yuzhihong@gmail.com" created="Fri, 18 Nov 2011 01:11:14 +0000"  >&lt;p&gt;Patch testing v3.&lt;/p&gt;</comment>
                            <comment id="13152606" author="hadoopqa" created="Fri, 18 Nov 2011 03:02:38 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12504154/4213-trunk-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12504154/4213-trunk-v3.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 60 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestCoprocessorEndpoint&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.wal.TestLogRolling&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestShell&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestInstantSchemaChange&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/287//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/287//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/287//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/287//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/287//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/287//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13152671" author="yuzhihong@gmail.com" created="Fri, 18 Nov 2011 05:48:11 +0000"  >&lt;p&gt;Updated usage of MonitoredTask.&lt;/p&gt;</comment>
                            <comment id="13153057" author="yuzhihong@gmail.com" created="Fri, 18 Nov 2011 19:12:05 +0000"  >&lt;p&gt;Created InstantSchemaChangeTestBase and &lt;br/&gt;
separated some tests into TestInstantSchemaChangeSplit&lt;/p&gt;</comment>
                            <comment id="13153061" author="yuzhihong@gmail.com" created="Fri, 18 Nov 2011 19:13:46 +0000"  >&lt;p&gt;Patch testing v5.&lt;/p&gt;</comment>
                            <comment id="13153132" author="hadoopqa" created="Fri, 18 Nov 2011 21:15:40 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12504247/4213-trunk-v5.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12504247/4213-trunk-v5.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 18 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 68 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestDistributedLogSplitting&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestAdmin&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestInstantSchemaChange&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/296//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/296//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/296//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/296//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/296//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/296//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13153140" author="yuzhihong@gmail.com" created="Fri, 18 Nov 2011 21:23:10 +0000"  >&lt;p&gt;The test failures were caused by &apos;Too many open files&apos;.&lt;/p&gt;</comment>
                            <comment id="13153203" author="lhofhansl" created="Fri, 18 Nov 2011 22:56:27 +0000"  >&lt;p&gt;Seems like this is getting ready for check-in. The most important part to have confidence in is whether this change will impact stability even when the feature is switched off.&lt;br/&gt;
What do you think Ted?&lt;/p&gt;</comment>
                            <comment id="13153220" author="yuzhihong@gmail.com" created="Fri, 18 Nov 2011 23:19:16 +0000"  >&lt;p&gt;I have tested this feature on dev cluster and observed satisfactory behavior.&lt;br/&gt;
For a 75 region table with 280K rows, instant schema update took 2.2 seconds.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4815&quot; title=&quot;Disable online altering by default, create a config for it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4815&quot;&gt;&lt;del&gt;HBASE-4815&lt;/del&gt;&lt;/a&gt; is introducing a config parameter which would govern online (current) and instant schema changes.&lt;/p&gt;

&lt;p&gt;If schema change is totally disabled, impact on stability is minimal.&lt;/p&gt;</comment>
                            <comment id="13153230" author="yuzhihong@gmail.com" created="Fri, 18 Nov 2011 23:32:34 +0000"  >&lt;p&gt;Task status showing the completion of instant schema change&lt;/p&gt;</comment>
                            <comment id="13153233" author="yuzhihong@gmail.com" created="Fri, 18 Nov 2011 23:35:11 +0000"  >&lt;p&gt;See schema-update.png for screen snapshot.&lt;/p&gt;

&lt;p&gt;Note, since the schema change completed so fast, I wasn&apos;t able to try to trigger region splitting.&lt;br/&gt;
Also, in CompactSplitThread.requestSplit(final HRegion r, byte[] midKey), call to waitForInflightSchemaChange() has been added.&lt;/p&gt;</comment>
                            <comment id="13153235" author="jiraposter@reviews.apache.org" created="Fri, 18 Nov 2011 23:40:52 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1786/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-11-18 23:39:40.651341)&lt;/p&gt;


&lt;p&gt;Review request for Todd Lipcon, Andrew Purtell and Subbu Iyer.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Latest patch with updated tests.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;From Subbu:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;here is the latest patch that support alter_instant, an instant schema change command that supports (Add, Modify, Delete column and Modify table) actions through ZK.&lt;/p&gt;

&lt;p&gt;1. This pattern capitalizes on the fact that HRI&apos;s are now in HDFS and need not be sent over again from Master to RS cloud on every schema change event.&lt;/p&gt;

&lt;p&gt;2. Offers real time instant schema change as we bypass the explicit bulk reassign (unassign + assign) of regions from master to RS.&lt;/p&gt;

&lt;p&gt;3. Offers fault tolerant schema change support as schema changes now go through ZK. Secondary master taking over a failed schema change will be addressed through a separate JIRA.&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  /pom.xml 1203789 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1202941 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/MasterServices.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 1202523 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java 1203441 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java 1202941 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java 1202381 &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java PRE-CREATION &lt;br/&gt;
  /src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java 1202381 &lt;br/&gt;
  /src/main/resources/hbase-default.xml 1202381 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/InstantSchemaChangeTestBase.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeSplit.java PRE-CREATION &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java 1202381 &lt;br/&gt;
  /src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java 1202381 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1786/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1786/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit tests pass.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Ted&lt;/p&gt;
</comment>
                            <comment id="13153287" author="yuzhihong@gmail.com" created="Sat, 19 Nov 2011 00:56:50 +0000"  >&lt;p&gt;Rebased after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4815&quot; title=&quot;Disable online altering by default, create a config for it&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4815&quot;&gt;&lt;del&gt;HBASE-4815&lt;/del&gt;&lt;/a&gt; went in.&lt;/p&gt;</comment>
                            <comment id="13153315" author="hadoopqa" created="Sat, 19 Nov 2011 01:34:30 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12504296/4213-trunk-v6.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12504296/4213-trunk-v6.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 18 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 66 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestInstantSchemaChange&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestAdmin&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestDistributedLogSplitting&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/297//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/297//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/297//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/297//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/297//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/297//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13153380" author="yuzhihong@gmail.com" created="Sat, 19 Nov 2011 04:42:49 +0000"  >&lt;p&gt;Forgot to set hbase.online.schema.update.enable to true for the unit tests.&lt;/p&gt;</comment>
                            <comment id="13153413" author="hadoopqa" created="Sat, 19 Nov 2011 06:52:26 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12504332/4213-trunk-v7.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12504332/4213-trunk-v7.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 18 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 66 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestInstantSchemaChange&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestAdmin&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestShell&lt;br/&gt;
                  org.apache.hadoop.hbase.TestDrainingServer&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/306//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/306//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/306//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/306//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/306//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/306//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13153451" author="yuzhihong@gmail.com" created="Sat, 19 Nov 2011 10:42:58 +0000"  >&lt;p&gt;TestInstantSchemaChange failures were due to &apos;Too many open files&apos;.&lt;/p&gt;</comment>
                            <comment id="13154297" author="hadoopqa" created="Mon, 21 Nov 2011 17:10:57 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12504508/4213-trunk-v7.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12504508/4213-trunk-v7.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 18 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -162 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 66 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestInstantSchemaChange&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestAdmin&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestCoprocessorEndpoint&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/318//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/318//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/318//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/318//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/318//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/318//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13154300" author="yuzhihong@gmail.com" created="Mon, 21 Nov 2011 17:19:12 +0000"  >&lt;p&gt;3 out of the 4 test failures were due to &apos;Too many open files&apos;.&lt;/p&gt;</comment>
                            <comment id="13154306" author="yuzhihong@gmail.com" created="Mon, 21 Nov 2011 17:30:51 +0000"  >&lt;p&gt;Integrated to TRUNK.&lt;/p&gt;

&lt;p&gt;Thanks for the patch Subbu.&lt;/p&gt;

&lt;p&gt;Thanks for the review, Lars, Todd and Andy.&lt;/p&gt;</comment>
                            <comment id="13154328" author="lhofhansl" created="Mon, 21 Nov 2011 18:09:51 +0000"  >&lt;p&gt;Awesome. Thanks for all the work on this Subbu and Ted. This will be incredibly useful! (Once online schema changes stabilize in general)&lt;/p&gt;</comment>
                            <comment id="13154333" author="yuzhihong@gmail.com" created="Mon, 21 Nov 2011 18:14:08 +0000"  >&lt;p&gt;Compared to the implementation from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt;, Subbu&apos;s code would take less amount of effort to stabilize.&lt;br/&gt;
Thanks for the support, Lars.&lt;/p&gt;</comment>
                            <comment id="13154396" author="hudson" created="Mon, 21 Nov 2011 19:30:38 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2468 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2468/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2468/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt; Support for fault tolerant, instant schema updates with out master&apos;s intervention through ZK&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/pom.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/resources/hbase-default.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/InstantSchemaChangeTestBase.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeSplit.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13154407" author="yuzhihong@gmail.com" created="Mon, 21 Nov 2011 19:42:55 +0000"  >&lt;p&gt;Addendum to temporarily disable testInstantSchemaOperationsInZKForMasterFailover which relies on predetermined sleep interval for schema janitor to clean up schema change request&lt;/p&gt;

&lt;p&gt;Subbu will come up with better test.&lt;/p&gt;</comment>
                            <comment id="13154417" author="hadoopqa" created="Mon, 21 Nov 2011 19:52:17 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12504535/4213.addendum&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12504535/4213.addendum&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/320//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/320//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13154503" author="stack" created="Mon, 21 Nov 2011 21:04:29 +0000"  >&lt;p&gt;Want to do the test fix in another issue Ted and Subbu?&lt;/p&gt;</comment>
                            <comment id="13154839" author="yuzhihong@gmail.com" created="Tue, 22 Nov 2011 03:17:14 +0000"  >&lt;p&gt;TRUNK build passed.&lt;/p&gt;</comment>
                            <comment id="13154882" author="ram_krish" created="Tue, 22 Nov 2011 05:08:53 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
One very small comment.  Javadoc for MasterSchemaChangeTracker is not found. Can be added as part of some related fix. &lt;/p&gt;</comment>
                            <comment id="13246782" author="stack" created="Wed, 4 Apr 2012 22:08:31 +0000"  >&lt;p&gt;Reverted over in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5715&quot; title=&quot;Revert &amp;#39;Instant schema alter&amp;#39; for now, HBASE-4213&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5715&quot;&gt;&lt;del&gt;HBASE-5715&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13247572" author="hudson" created="Thu, 5 Apr 2012 19:44:30 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #89 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/89/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/89/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5715&quot; title=&quot;Revert &amp;#39;Instant schema alter&amp;#39; for now, HBASE-4213&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5715&quot;&gt;&lt;del&gt;HBASE-5715&lt;/del&gt;&lt;/a&gt; Revert &apos;Instant schema alter&apos; for now, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt; (Revision 1310017)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/resources/hbase-default.xml&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/InstantSchemaChangeTestBase.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeSplit.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13247582" author="hudson" created="Thu, 5 Apr 2012 19:52:37 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2714 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2714/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2714/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5715&quot; title=&quot;Revert &amp;#39;Instant schema alter&amp;#39; for now, HBASE-4213&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5715&quot;&gt;&lt;del&gt;HBASE-5715&lt;/del&gt;&lt;/a&gt; Revert &apos;Instant schema alter&apos; for now, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt; (Revision 1310012)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/resources/hbase-default.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/InstantSchemaChangeTestBase.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeSplit.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13247671" author="hudson" created="Thu, 5 Apr 2012 21:04:26 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #158 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/158/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/158/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5715&quot; title=&quot;Revert &amp;#39;Instant schema alter&amp;#39; for now, HBASE-4213&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5715&quot;&gt;&lt;del&gt;HBASE-5715&lt;/del&gt;&lt;/a&gt; Revert &apos;Instant schema alter&apos; for now, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt; (Revision 1310012)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/resources/hbase-default.xml&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/InstantSchemaChangeTestBase.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeSplit.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13249195" author="hudson" created="Sat, 7 Apr 2012 06:19:08 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #8 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/8/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/8/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5715&quot; title=&quot;Revert &amp;#39;Instant schema alter&amp;#39; for now, HBASE-4213&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5715&quot;&gt;&lt;del&gt;HBASE-5715&lt;/del&gt;&lt;/a&gt; Revert &apos;Instant schema alter&apos; for now, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt; (Revision 1310017)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/LocalHBaseCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/MasterServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/DeleteTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/ModifyTableHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/TableDeleteFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/TableModifyFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/CompactSplitThread.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/MasterSchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/SchemaChangeTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/resources/hbase-default.xml&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/InstantSchemaChangeTestBase.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChange.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/client/TestInstantSchemaChangeSplit.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12431925">HBASE-1730</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12532217">HBASE-4839</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                            <outwardlinks description="depends upon">
                                        <issuelink>
            <issuekey id="12523466">HBASE-4429</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12537691">HBASE-5146</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12522687">HBASE-4370</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12502207" name="4213-0.92.txt" size="141409" author="yuzhihong@gmail.com" created="Thu, 3 Nov 2011 19:30:39 +0000"/>
                            <attachment id="12503785" name="4213-0.92.v2" size="147512" author="yuzhihong@gmail.com" created="Tue, 15 Nov 2011 20:05:52 +0000"/>
                            <attachment id="12503931" name="4213-0.92.v4" size="145848" author="yuzhihong@gmail.com" created="Wed, 16 Nov 2011 19:43:32 +0000"/>
                            <attachment id="12498848" name="4213-101211-Support_instant_schema_changes_through_ZK.patch" size="148735" author="iamknome" created="Thu, 13 Oct 2011 03:38:45 +0000"/>
                            <attachment id="12500821" name="4213-102511.patch" size="150802" author="iamknome" created="Wed, 26 Oct 2011 04:54:50 +0000"/>
                            <attachment id="12502604" name="4213-Fixed_NPE_in_RS_during_alter_.patch" size="731" author="iamknome" created="Sat, 5 Nov 2011 18:18:07 +0000"/>
                            <attachment id="12493947" name="4213-Instant_Schema_change_through_ZK.patch" size="72250" author="iamknome" created="Sun, 11 Sep 2011 05:34:15 +0000"/>
                            <attachment id="12502012" name="4213-Nov-2-2011_patch_.patch" size="145003" author="yuzhihong@gmail.com" created="Wed, 2 Nov 2011 18:58:46 +0000"/>
                            <attachment id="12502847" name="4213-Nov072011-Patch_to_support_concurrent_split_and_alter__.patch" size="12841" author="iamknome" created="Mon, 7 Nov 2011 23:56:50 +0000"/>
                            <attachment id="12494929" name="4213-V10-Support_instant_schema_changes_through_ZK.patch" size="65217" author="iamknome" created="Sat, 17 Sep 2011 17:25:12 +0000"/>
                            <attachment id="12493966" name="4213-V5-Support_instant_schema_changes_through_ZK.patch" size="76838" author="iamknome" created="Sun, 11 Sep 2011 20:01:41 +0000"/>
                            <attachment id="12494326" name="4213-V7-Support_instant_schema_changes_through_ZK.patch" size="82595" author="iamknome" created="Tue, 13 Sep 2011 21:33:39 +0000"/>
                            <attachment id="12494380" name="4213-V8-Support_instant_schema_changes_through_ZK.patch" size="58101" author="iamknome" created="Wed, 14 Sep 2011 05:11:42 +0000"/>
                            <attachment id="12494855" name="4213-V9-Support_instant_schema_changes_through_ZK.patch" size="65657" author="iamknome" created="Fri, 16 Sep 2011 20:11:45 +0000"/>
                            <attachment id="12504009" name="4213-trunk-v2.txt" size="146021" author="yuzhihong@gmail.com" created="Thu, 17 Nov 2011 01:48:36 +0000"/>
                            <attachment id="12504508" name="4213-trunk-v7.txt" size="151264" author="yuzhihong@gmail.com" created="Mon, 21 Nov 2011 15:10:27 +0000"/>
                            <attachment id="12503966" name="4213-trunk.txt" size="145435" author="yuzhihong@gmail.com" created="Wed, 16 Nov 2011 22:27:00 +0000"/>
                            <attachment id="12494891" name="4213-v9.txt" size="64744" author="yuzhihong@gmail.com" created="Sat, 17 Sep 2011 00:05:11 +0000"/>
                            <attachment id="12504535" name="4213.addendum" size="827" author="yuzhihong@gmail.com" created="Mon, 21 Nov 2011 19:42:55 +0000"/>
                            <attachment id="12493968" name="4213.v6" size="75828" author="yuzhihong@gmail.com" created="Sun, 11 Sep 2011 21:06:49 +0000"/>
                            <attachment id="12490654" name="HBASE-4213-Instant_schema_change.patch" size="36627" author="iamknome" created="Wed, 17 Aug 2011 14:08:01 +0000"/>
                            <attachment id="12490913" name="HBASE-4213_Instant_schema_change_-Version_2_.patch" size="36106" author="iamknome" created="Fri, 19 Aug 2011 04:01:01 +0000"/>
                            <attachment id="12491118" name="HBASE_Instant_schema_change-version_3_.patch" size="48818" author="iamknome" created="Sun, 21 Aug 2011 21:13:33 +0000"/>
                            <attachment id="12504294" name="schema-update.png" size="602326" author="yuzhihong@gmail.com" created="Fri, 18 Nov 2011 23:32:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>24.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 17 Aug 2011 14:47:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33426</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 36 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08qk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48903</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>instant schema update, Alter table</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>