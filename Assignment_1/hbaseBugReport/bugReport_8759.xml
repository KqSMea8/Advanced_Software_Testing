<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:58:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8759/HBASE-8759.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8759] Family Delete Markers not getting purged after major compaction</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8759</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;On table with VERSIONS =&amp;gt; &apos;1&apos;, KEEP_DELETED_CELLS =&amp;gt; &apos;true&apos;. Family Delete Markers does not get purged after put &amp;gt; delete &amp;gt; major compaction (they keep on incrementing after every put &amp;gt; delete &amp;gt; major compaction)&lt;/p&gt;

&lt;p&gt;Following is the raw scan output after 10 iterations of put &amp;gt; delete &amp;gt; major compaction.&lt;/p&gt;

&lt;p&gt;ROW                                       COLUMN+CELL                                                                                                             &lt;br/&gt;
A                                        column=CF:, timestamp=1371512706683, type=DeleteFamily                                                                  &lt;br/&gt;
A                                        column=CF:, timestamp=1371512706394, type=DeleteFamily                                                                  &lt;br/&gt;
A                                        column=CF:, timestamp=1371512706054, type=DeleteFamily                                                                  &lt;br/&gt;
A                                        column=CF:, timestamp=1371512705763, type=DeleteFamily                                                                  &lt;br/&gt;
A                                        column=CF:, timestamp=1371512705457, type=DeleteFamily                                                                  &lt;br/&gt;
A                                        column=CF:, timestamp=1371512705149, type=DeleteFamily                                                                  &lt;br/&gt;
A                                        column=CF:, timestamp=1371512704836, type=DeleteFamily                                                                  &lt;br/&gt;
A                                        column=CF:, timestamp=1371512704518, type=DeleteFamily                                                                  &lt;br/&gt;
A                                        column=CF:, timestamp=1371512704162, type=DeleteFamily                                                                  &lt;br/&gt;
A                                        column=CF:, timestamp=1371512703779, type=DeleteFamily                                                                  &lt;br/&gt;
A                                        column=CF:COL, timestamp=1371512706682, value=X &lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Code to repro this issue:&lt;br/&gt;
&lt;a href=&quot;http://phoenix-bin.github.io/client/code/delete.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://phoenix-bin.github.io/client/code/delete.java&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12653533">HBASE-8759</key>
            <summary>Family Delete Markers not getting purged after major compaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="mujtabachohan">Mujtaba Chohan</reporter>
                        <labels>
                    </labels>
                <created>Tue, 18 Jun 2013 17:44:29 +0000</created>
                <updated>Thu, 20 Jun 2013 18:49:04 +0000</updated>
                            <resolved>Thu, 20 Jun 2013 09:05:43 +0000</resolved>
                                    <version>0.94.7</version>
                                                    <component>Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13687280" author="lhofhansl" created="Tue, 18 Jun 2013 22:17:05 +0000"  >&lt;p&gt;That is correct. You need two major compactions and no newer Puts in order to remove family delete markers when KEEP_DELETED_CELLS is enabled. This only affects family delete markers.&lt;/p&gt;

&lt;p&gt;When I made that patch I could not find a good way around this. If you did a 2nd major-compaction before you added newer puts they&apos;d be removed. There is a (long) explanation in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4536&quot; title=&quot;Allow CF to retain deleted rows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4536&quot;&gt;&lt;del&gt;HBASE-4536&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13688197" author="mujtabachohan" created="Wed, 19 Jun 2013 17:40:10 +0000"  >&lt;p&gt;Even after multiple major compactions (with no new puts) family delete markers are not removed.&lt;/p&gt;</comment>
                            <comment id="13688445" author="lhofhansl" created="Wed, 19 Jun 2013 20:54:14 +0000"  >&lt;p&gt;Hmm... There&apos;s a test for that. Need to check.&lt;/p&gt;</comment>
                            <comment id="13688477" author="lhofhansl" created="Wed, 19 Jun 2013 21:23:12 +0000"  >&lt;p&gt;Can&apos;t test the code right now. But I notice it does not contain a flush.&lt;br/&gt;
A major compaction issued by HBaseAdmin does force a flush, and hence stuff that&apos;s in the memstore will not get compacted away until it is actually flushed to disk.&lt;/p&gt;</comment>
                            <comment id="13688555" author="mujtabachohan" created="Wed, 19 Jun 2013 22:23:40 +0000"  >&lt;p&gt;Thanks Lars! After flushing and major compacting twice, family delete markers are removed.&lt;/p&gt;</comment>
                            <comment id="13688988" author="lhofhansl" created="Thu, 20 Jun 2013 07:56:38 +0000"  >&lt;p&gt;NP. I should also be a bit more explicit how family delete markets are actually deleted. The logic is this:&lt;br/&gt;
Each compaction registers the timestamp of the oldest put in the created hfile.&lt;br/&gt;
The next (major) compaction then removes all family markers that are older than the oldest put. So as long as the client does not keep backdating puts, eventually all family markers drop out of the compacted files.&lt;/p&gt;</comment>
                            <comment id="13689513" author="giacomotaylor" created="Thu, 20 Jun 2013 18:49:04 +0000"  >&lt;p&gt;Thanks, @larsh. Now aren&apos;t you supposed to be on vacation! Go drink a liter or two of beer! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 18 Jun 2013 22:17:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>333810</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1ll1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334138</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>