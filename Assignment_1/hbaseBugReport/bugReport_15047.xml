<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:59:03 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-15047/HBASE-15047.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-15047] Try spin lock for MVCC completion</title>
                <link>https://issues.apache.org/jira/browse/HBASE-15047</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Waits/Notify is very very expensive since it can cost a thread scheduling. There should only ever be a few threads ( &amp;lt; Num Cores ) running. So it should be possible to spin and use compare and swap to update the read point.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12924608">HBASE-15047</key>
            <summary>Try spin lock for MVCC completion</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="eclark">Elliott Clark</assignee>
                                    <reporter username="eclark">Elliott Clark</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Dec 2015 04:21:01 +0000</created>
                <updated>Wed, 16 Mar 2016 17:54:48 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="15073462" author="eclark" created="Tue, 29 Dec 2015 04:21:53 +0000"  >&lt;p&gt;This would mean that there&apos;s no lock for queueing. There&apos;s no need to for a queue.&lt;/p&gt;</comment>
                            <comment id="15074402" author="eclark" created="Tue, 29 Dec 2015 23:06:01 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.facebook.net/D52407&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D52407&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15074403" author="eclark" created="Tue, 29 Dec 2015 23:07:01 +0000"  >&lt;p&gt;This will greatly change the way perf/flame graphs look. We will now be in user mode code a lot more.&lt;/p&gt;

&lt;p&gt;However that should result in much faster response times as there should be no scheduler overhead.&lt;/p&gt;</comment>
                            <comment id="15074434" author="stack" created="Tue, 29 Dec 2015 23:34:18 +0000"  >&lt;p&gt;Radical. At first blush, we will be waiting too long in mvcc to spin and who says the currently scheduled thread is next in line for mvcc and what is to prevent all CPUs being here spinning with no thread free to make forward progess? I&apos;ll try it though.&lt;/p&gt;</comment>
                            <comment id="15074440" author="eclark" created="Tue, 29 Dec 2015 23:43:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;Radical.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I&apos;m on a mission to remove locks. Every lock we have is a place for contention and long wait times. The jury is still out on this instance being worth it though.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;who says the currently scheduled thread is next in line&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That shouldn&apos;t matter as long as someone is next. They should all be waiting.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;what is to prevent all CPUs being here spinning with no thread free to make forward progess&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah that&apos;s the possible downside. That you have so many threads using cpu that you can&apos;t get any io done. If needed we can add a sleep if the spin has been going too long. However I want to try these things before adding more complexity.&lt;/p&gt;</comment>
                            <comment id="15074495" author="apache9" created="Wed, 30 Dec 2015 00:43:42 +0000"  >&lt;p&gt;I think this is just a spin, not a spin lock?&lt;/p&gt;

&lt;p&gt;And usually I do not think a simple spin can perform better than standard locking method. Let&apos;s see some perfs results first?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="15074582" author="eclark" created="Wed, 30 Dec 2015 03:06:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;And usually I do not think a simple spin can perform better than standard locking method. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&lt;a href=&quot;http://askldjd.com/2010/05/16/spin-wait-vs-condition-variable/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://askldjd.com/2010/05/16/spin-wait-vs-condition-variable/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://stackoverflow.com/questions/5869825/when-should-one-use-a-spinlock-instead-of-mutex/5870415#5870415&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://stackoverflow.com/questions/5869825/when-should-one-use-a-spinlock-instead-of-mutex/5870415#5870415&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://www.alexonlinux.com/pthread-mutex-vs-pthread-spinlock&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.alexonlinux.com/pthread-mutex-vs-pthread-spinlock&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Spin locking is much faster than requesting the operating system to de-schedule and re-schedule a thread. &lt;/p&gt;</comment>
                            <comment id="15074590" author="apache9" created="Wed, 30 Dec 2015 03:22:27 +0000"  >&lt;p&gt;OK, I should add a limitation &apos;in production&apos;. In micro benchmark, yes, it can be much faster. But in production environment, as &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; said above, thread scheduling is not controlled by us so we can hardly tell how long a spin will continue thus the spin may waste lots of CPU time.&lt;/p&gt;

&lt;p&gt;And see this paper&lt;br/&gt;
&quot;Ad Hoc Synchronization Considered Harmful&quot;&lt;br/&gt;
&lt;a href=&quot;https://www.usenix.org/legacy/event/osdi10/tech/full_papers/Xiong.pdf&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://www.usenix.org/legacy/event/osdi10/tech/full_papers/Xiong.pdf&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The key point here is &quot;Ad Hoc Synchronization&quot; is not easy to understand so people will easily break your initial assumption and cause a very bad performance impact.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="15094318" author="eclark" created="Tue, 12 Jan 2016 17:14:34 +0000"  >&lt;p&gt;I&apos;m going to hold off on more testing for this until &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15082&quot; title=&quot;Fix merge of MVCC and SequenceID performance regression&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15082&quot;&gt;&lt;del&gt;HBASE-15082&lt;/del&gt;&lt;/a&gt; that should really make this shine.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12779873" name="HBASE-15047.patch" size="7271" author="eclark" created="Tue, 29 Dec 2015 23:07:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 29 Dec 2015 23:34:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            48 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2qcyn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>