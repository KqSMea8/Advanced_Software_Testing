<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:13:16 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3801/HBASE-3801.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3801] Backup Master blocked when the HMaster Node Fail.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3801</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When the HMaster crash, the Backup HMaster blocked for waiting the ZK notify.&lt;br/&gt;
The Backup HMaster&apos;s thread stack is :&lt;br/&gt;
&quot;master-hp1:60000&quot; prio=10 tid=0x00000000484c6800 nid=0x4b56 waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x0000000040209000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: TIMED_WAITING (sleeping)&lt;br/&gt;
        at java.lang.Thread.sleep(Native Method)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.HMaster.stallIfBackupMaster(HMaster.java:251)&lt;br/&gt;
        at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:279)&lt;/p&gt;

&lt;p&gt;   Locked ownable synchronizers:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;None&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;1 HMaster&lt;br/&gt;
1 HMaster -backup&lt;br/&gt;
6 HResignServer&lt;/p&gt;</environment>
        <key id="12504765">HBASE-3801</key>
            <summary>Backup Master blocked when the HMaster Node Fail.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="gpcuster">Aaron Guo</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Apr 2011 08:01:28 +0000</created>
                <updated>Thu, 13 Sep 2012 22:00:37 +0000</updated>
                            <resolved>Thu, 13 Sep 2012 22:00:36 +0000</resolved>
                                    <version>0.90.2</version>
                    <version>0.90.3</version>
                                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13022281" author="stack" created="Wed, 20 Apr 2011 18:42:05 +0000"  >&lt;p&gt;That looks like &apos;normal&apos; behavior.  This is the condition the backup HMaster has and then on primary&apos;s failure, its watch on the primary is triggered and above wait wakes up.  Is it not happening for you?  What do you see?   The primary goes down and secondary does not assume its role?&lt;/p&gt;</comment>
                            <comment id="13022591" author="gpcuster" created="Thu, 21 Apr 2011 01:51:08 +0000"  >&lt;p&gt;When the primary master crash, the backup HMaster still wating to become the primary.&lt;br/&gt;
I looked at the source code: the backup HMaster didn&apos;t register the zk event&#65292; so the backup HMaster will sleep forever, even if the primary master crash.&lt;/p&gt;</comment>
                            <comment id="13022604" author="jeason" created="Thu, 21 Apr 2011 03:54:39 +0000"  >&lt;p&gt;The backup was just blocked at the process of becoming the active one,but it did register a listener to ZK at first.Generally,when the primary master crash, the event will notice to the backup master immediately. Maybe something seemed weird happened.&lt;/p&gt;</comment>
                            <comment id="13022617" author="gpcuster" created="Thu, 21 Apr 2011 05:26:44 +0000"  >&lt;p&gt;The backup didn&apos;t register a listener to ZK, until this code:&lt;br/&gt;
this.activeMasterManager.blockUntilBecomingActiveMaster();so it can&apos;t get a notify when the primary master crash.&lt;/p&gt;</comment>
                            <comment id="13029141" author="stack" created="Thu, 5 May 2011 05:46:45 +0000"  >&lt;p&gt;I see that we register a listener before we go to wait on becoming master:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; becomeActiveMaster(MonitoredTask startupStatus)
  &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException {
    &lt;span class=&quot;code-comment&quot;&gt;// TODO: This is wrong!!!! Should have &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; servername &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we restart ourselves,
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we come back to life.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.activeMasterManager = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ActiveMasterManager(zooKeeper, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.serverName,
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.zooKeeper.registerListener(activeMasterManager);
    stallIfBackupMaster(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.activeMasterManager);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.activeMasterManager.blockUntilBecomingActiveMaster(startupStatus);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So what is wrong in the above code?  Do you have fellas have a patch?&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="13069607" author="yuzhihong@gmail.com" created="Fri, 22 Jul 2011 16:35:48 +0000"  >&lt;p&gt;Normally patch should carry the JIRA number in its filename.&lt;/p&gt;

&lt;p&gt;The patch changes the semantics of how ActiveMasterManager handles watcher.masterAddressZNode&lt;br/&gt;
Consequently the following assertion from TestActiveMasterManager would fail:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    assertFalse(activeMasterManager.clusterHasActiveMaster.get());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please produce a complete patch, run through the following unit tests and document the experience of testing failover in a real cluster:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
src/test/java/org/apache/hadoop/hbase/regionserver/TestMasterAddressManager.java
src/test/java/org/apache/hadoop/hbase/coprocessor/TestMasterObserver.java
src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java
src/test/java/org/apache/hadoop/hbase/master/TestMaster.java
src/test/java/org/apache/hadoop/hbase/master/TestActiveMasterManager.java
src/test/java/org/apache/hadoop/hbase/master/TestMasterStatusServlet.java
src/test/java/org/apache/hadoop/hbase/master/TestMasterTransitions.java
src/test/java/org/apache/hadoop/hbase/master/TestMasterRestartAfterDisablingTable.java
src/test/java/org/apache/hadoop/hbase/master/TestHMasterRPCException.java
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13455351" author="lhofhansl" created="Thu, 13 Sep 2012 22:00:37 +0000"  >&lt;p&gt;I think the consensus here is that this works correctly (and nobody else reported the problem in a year)... Resolving. Reopen if you disagree.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12487410" name="patch.txt" size="1766" author="sunhengxin" created="Fri, 22 Jul 2011 08:54:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 20 Apr 2011 18:42:05 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27029</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 14 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hnyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101143</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>