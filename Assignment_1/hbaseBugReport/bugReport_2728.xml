<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:04:16 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2728/HBASE-2728.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2728] Support for HADOOP-4829</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2728</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Users who have a &lt;a href=&quot;https://issues.apache.org/jira/browse/HADOOP-4829&quot; title=&quot;Allow FileSystem shutdown hook to be disabled&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HADOOP-4829&quot;&gt;&lt;del&gt;HADOOP-4829&lt;/del&gt;&lt;/a&gt; patched hadoop will run into the issue that closing a RS cleanly result into data loss because the FileSystem will be closed before the regions are. Cloudera is an example. We need to support those users.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12466946">HBASE-2728</key>
            <summary>Support for HADOOP-4829</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Jun 2010 00:37:43 +0000</created>
                <updated>Fri, 12 Oct 2012 06:15:38 +0000</updated>
                            <resolved>Fri, 18 Jun 2010 20:32:46 +0000</resolved>
                                                    <fixVersion>0.20.5</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12878811" author="jdcryans" created="Tue, 15 Jun 2010 00:39:56 +0000"  >&lt;p&gt;Patch that supports both cases.&lt;/p&gt;</comment>
                            <comment id="12878813" author="tlipcon" created="Tue, 15 Jun 2010 00:51:25 +0000"  >&lt;p&gt;Only question: are we sure that that Filesystem.get is the first instantiation of the filesystem? If the filesystem is already in the Cache, then setting the conf var at this point won&apos;t do anything.&lt;/p&gt;</comment>
                            <comment id="12878815" author="jdcryans" created="Tue, 15 Jun 2010 00:54:01 +0000"  >&lt;p&gt;I did look around and this is currently the case. This is in the very first steps of RS instantiation.&lt;/p&gt;</comment>
                            <comment id="12878819" author="tlipcon" created="Tue, 15 Jun 2010 01:03:47 +0000"  >&lt;p&gt;Here&apos;s a thought. What if we did something like:&lt;br/&gt;
FileSystem fs = FileSystem.get(conf);&lt;br/&gt;
fs.close();&lt;br/&gt;
fs = FileSystem.get(conf); // now we know we have a fresh instance?&lt;/p&gt;

&lt;p&gt;Or, if we&apos;re certain we always get the filesystem instance from this var, we could use FileSystem.newInstance?&lt;/p&gt;

&lt;p&gt;My only nervousness is that this might break again and we wouldn&apos;t notice (since we don&apos;t seem to have any good unit tests for it)&lt;/p&gt;</comment>
                            <comment id="12879165" author="stack" created="Tue, 15 Jun 2010 23:01:18 +0000"  >&lt;p&gt;An issue I have is that RS needs to make it so tests can override shutdown of FS else when we kill or stop RSs during tests, they&apos;ll pull the FS out from under everything else that is currently running in a minihbasecluster.&lt;/p&gt;</comment>
                            <comment id="12879168" author="tlipcon" created="Tue, 15 Jun 2010 23:09:15 +0000"  >&lt;p&gt;For tests, can&apos;t we use FileSystem.newInstance so each one gets their own?&lt;/p&gt;</comment>
                            <comment id="12879185" author="stack" created="Tue, 15 Jun 2010 23:36:27 +0000"  >&lt;p&gt;We could but it&apos;d be a lot of work to do on branch.  In trunk we do this for the newer tests.&lt;/p&gt;

&lt;p&gt;In fact my comment is a little confused on revisit.  This is for branch, not for trunk so reviewing j-ds&apos; patch in that light, I don&apos;t think it so bad.  The Todd suggestion of closing the fs then reopening to be sure we have a good FS instance will for sure mangle tests.  Did you test it against apache and cloudera hadoop j-d?&lt;/p&gt;
</comment>
                            <comment id="12879187" author="jdcryans" created="Tue, 15 Jun 2010 23:39:13 +0000"  >&lt;p&gt;I tested my patch against both on a fully distributed 1 node setup, not with unit tests.&lt;/p&gt;</comment>
                            <comment id="12879252" author="stack" created="Wed, 16 Jun 2010 05:35:41 +0000"  >&lt;p&gt;I looked at this patch again:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.getRuntime().removeShutdownHook(hdfsClientFinalizer);
+      &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; registered =
+          &lt;span class=&quot;code-object&quot;&gt;Runtime&lt;/span&gt;.getRuntime().removeShutdownHook(hdfsClientFinalizer);
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!registered) {
+        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;The HDFS shutdown hook isn&apos;t where we expect it, &quot;&lt;/span&gt; +
+            &lt;span class=&quot;code-quote&quot;&gt;&quot;will call close during shutdown&quot;&lt;/span&gt;);
+        hdfsSupportsAutoCloseDisabling = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In above, I&apos;d say you should do better explaination in log message.. mention that you are going to presume fs.automatic.close is in place.&lt;/p&gt;

&lt;p&gt;Do you think it would pay to do better introspection up earlier in this method looking for hdfsClientFinalizer explicitly in Cache &amp;#8211; then you&apos;d know you have an hdfs w/ hadoop-4829 in place?  Maybe not . Maybe thats what I should do on trunk and this is good enough for branch, presuming all tests pass on both apache and cloudera?&lt;/p&gt;</comment>
                            <comment id="12879491" author="jdcryans" created="Wed, 16 Jun 2010 20:59:53 +0000"  >&lt;p&gt;Running against cloudera&apos;s release (that would also be the same with any patched hdfs), TestRegionRebalancing fails. The issue is that we do something very dirty in HRS for tests: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
  /** 
   * Set the hdfs shutdown thread to run on exit. Pass &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; to disable 
   * running of the shutdown test. Needed by tests. 
   * @param t &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; to run. Pass &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; to disable tests. 
   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Previous occupant of the shutdown thread position. 
   */ 
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; setHDFSShutdownThreadOnExit(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; t) { 
    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; old = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.hdfsShutdownThread; 
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.hdfsShutdownThread = t; 
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; old; 
  } 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;So the tests pass t=null. but if we don&apos;t use the thread then we still shutdown HDFS. The clean solution is to set shutdownHDFS.set(false) in that method and the check already in place will do the work.&lt;/p&gt;</comment>
                            <comment id="12879540" author="stack" created="Wed, 16 Jun 2010 22:10:11 +0000"  >&lt;p&gt;OK.  Sounds good.  I&apos;m +1 on applying this to the branch (after making above changes).&lt;/p&gt;</comment>
                            <comment id="12879551" author="jdcryans" created="Wed, 16 Jun 2010 22:28:59 +0000"  >&lt;p&gt;Patch that works on both releases that I will commit once 0.20.5 gets released (soon I hope).&lt;/p&gt;</comment>
                            <comment id="12879558" author="stack" created="Wed, 16 Jun 2010 22:33:55 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12880317" author="jdcryans" created="Fri, 18 Jun 2010 20:32:46 +0000"  >&lt;p&gt;Committed to branch, meaning it&apos;s in 0.20.5 since we&apos;re doing a RC4.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12447288" name="HBASE-2728-v2.patch" size="2361" author="jdcryans" created="Wed, 16 Jun 2010 22:28:59 +0000"/>
                            <attachment id="12447086" name="HBASE-2728.patch" size="2016" author="jdcryans" created="Tue, 15 Jun 2010 00:39:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Jun 2010 00:51:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26434</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08sjr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49225</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>