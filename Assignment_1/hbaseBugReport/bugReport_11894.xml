<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:27:40 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11894/HBASE-11894.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11894] MetaEntries from coprocessor hooks in split and merge are not getting added to hbase:meta after HBASE-11611</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11894</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;As part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9249&quot; title=&quot;Add cp hook before setting PONR in split&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9249&quot;&gt;&lt;del&gt;HBASE-9249&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9489&quot; title=&quot;Add cp hooks in online merge before and after setting PONR&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9489&quot;&gt;&lt;del&gt;HBASE-9489&lt;/del&gt;&lt;/a&gt;, added new hooks in split and merge which take meta entries from coprocessor hooks if any. These meta entries helps to ensure atomicity of split(merge) of regions by server and split(merge) of the regions handled in coprocessors(This is required in secondary indexing case).&lt;/p&gt;

&lt;p&gt;After &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11611&quot; title=&quot;Clean up ZK-based region assignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11611&quot;&gt;&lt;del&gt;HBASE-11611&lt;/del&gt;&lt;/a&gt; the meta entries are not getting added to meta both in split and merge.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @MetaMutationAnnotation
    List&amp;lt;Mutation&amp;gt; metaEntries = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;Mutation&amp;gt;();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rsCoprocessorHost != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rsCoprocessorHost.preMergeCommit(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.region_a, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.region_b, metaEntries)) {
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Coprocessor bypassing regions &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.region_a + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;
            + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.region_b + &lt;span class=&quot;code-quote&quot;&gt;&quot; merge.&quot;&lt;/span&gt;);
      }
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Mutation p : metaEntries) {
          HRegionInfo.parseRegionName(p.getRow());
        }
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
        LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Row key of mutation from coprocessor is not parsable as region name.&quot;&lt;/span&gt;
            + &lt;span class=&quot;code-quote&quot;&gt;&quot;Mutations from coprocessor should only be &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hbase:meta table.&quot;&lt;/span&gt;, e);
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
      }
    }

    &lt;span class=&quot;code-comment&quot;&gt;// This is the point of no &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;. Similar with SplitTransaction.
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// IF we reach the PONR then subsequent failures need to crash out &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// regionserver
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.journal.add(JournalEntry.PONR);

    &lt;span class=&quot;code-comment&quot;&gt;// Add merged region and delete region_a and region_b
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// as an atomic update. See HBASE-7721. This update to hbase:meta makes the region
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// will determine whether the region is merged or not in &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; of failures.
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// If it is successful, master will roll-forward, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not, master will
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// rollback
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (services != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !services.reportRegionStateTransition(TransitionCode.MERGE_PONR,
        mergedRegionInfo, region_a.getRegionInfo(), region_b.getRegionInfo())) {
      &lt;span class=&quot;code-comment&quot;&gt;// Passed PONR, let SSH clean it up
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to notify master that merge passed PONR: &quot;&lt;/span&gt;
        + region_a.getRegionInfo().getRegionNameAsString() + &lt;span class=&quot;code-quote&quot;&gt;&quot; and &quot;&lt;/span&gt;
        + region_b.getRegionInfo().getRegionNameAsString());
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think while reporting region state transition to master we need to pass meta entries also so that we can add them to meta along with split or merge updates.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12739079">HBASE-11894</key>
            <summary>MetaEntries from coprocessor hooks in split and merge are not getting added to hbase:meta after HBASE-11611</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="rajesh23">rajeshbabu</assignee>
                                    <reporter username="rajesh23">rajeshbabu</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Sep 2014 08:53:09 +0000</created>
                <updated>Mon, 8 Sep 2014 09:25:23 +0000</updated>
                                                            <fixVersion>2.0.0</fixVersion>
                                    <component>Region Assignment</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="14121139" author="rajesh23" created="Thu, 4 Sep 2014 08:54:54 +0000"  >&lt;p&gt;ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;, what do you say?&lt;/p&gt;</comment>
                            <comment id="14121394" author="anoop.hbase" created="Thu, 4 Sep 2014 14:16:09 +0000"  >&lt;p&gt;Region states for the CP handled regions also would have changed. These are not getting reported? Than handling meta entry by CP and passing that to Master, the CP handled region state change also can be passed to Master along with that of the user table regions&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14121478" author="rajesh23" created="Thu, 4 Sep 2014 15:47:44 +0000"  >&lt;p&gt;The region state changes need not pass &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;. They will be properly handled by core itself. We need to pass split or merge updates of the regions handled in CP(but it&apos;s completely depend on CP implementation).&lt;/p&gt;</comment>
                            <comment id="14123060" author="jxiang" created="Fri, 5 Sep 2014 15:41:06 +0000"  >&lt;p&gt;Can we invoke these coprocessor hooks in master(AM/RegionStateStore)?  We&apos;d like to make sure only master updates the meta.&lt;/p&gt;</comment>
                            <comment id="14123068" author="rajesh23" created="Fri, 5 Sep 2014 15:52:05 +0000"  >&lt;p&gt;Let me try moving the hooks to master &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;. Thanks.&lt;/p&gt;</comment>
                            <comment id="14123085" author="rajesh23" created="Fri, 5 Sep 2014 16:09:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;&lt;br/&gt;
Currently the hooks are region level but moving them to system level hooks make not be good.&lt;br/&gt;
instead what about having new interface to pass any meta mutations while reporting region transition&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  /**
   * Notify master that a handler requests to change a region state
   */
  &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; reportRegionStateTransition(TransitionCode code, HRegionInfo... hris,List&amp;lt;Mutation&amp;gt; mutations);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14123128" author="jxiang" created="Fri, 5 Sep 2014 16:40:09 +0000"  >&lt;p&gt;I see. Ok with me.  Do we need to handle similar requirements for other transition codes? I was wondering how to make the interface extendable. &lt;/p&gt;</comment>
                            <comment id="14123139" author="stack" created="Fri, 5 Sep 2014 16:44:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;....to pass any meta mutations while reporting region transition&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How to describe these transitions we report the master such that it can make sense of them?  Is master recording these ops critical or is it ok if they are dropped?&lt;/p&gt;</comment>
                            <comment id="14125339" author="rajesh23" created="Mon, 8 Sep 2014 09:17:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;Do we need to handle similar requirements for other transition codes? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Just we need to handle for SPLIT_PONR and MERGE_PONR only Jimmy.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;How to describe these transitions we report the master such that it can make sense of them? Is master recording these ops critical or is it ok if they are dropped?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The interface required for reporting existing transition(SPLIT_PONR and MERGE_PONR) only stack. These meta ops are important to ensure data region and index region split atomiticity in Phoenix local indexing(&lt;a href=&quot;https://github.com/apache/phoenix/blob/4.0/phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/LocalIndexSplitter.java&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/phoenix/blob/4.0/phoenix-core/src/main/java/org/apache/hadoop/hbase/regionserver/LocalIndexSplitter.java&lt;/a&gt;). &lt;br/&gt;
Thanks.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 4 Sep 2014 14:16:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 14 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zobj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>