<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:47:13 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13845/HBASE-13845.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13845] Expire of one region server carrying meta can bring down the master</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13845</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There seems to be a code bug that can cause expiration of one region server carrying meta to bring down the master under certain case.&lt;/p&gt;

&lt;p&gt;Here is the sequence of event.&lt;/p&gt;

&lt;p&gt;a) The master detects the expiration of a region server on ZK, and starts to expire the region server.&lt;br/&gt;
b) Since the failed region server carries meta, the shutdown handler will call verifyAndAssignMetaWithRetries() during processing the expired rs.&lt;br/&gt;
c)  In verifyAndAssignMeta(), there is a logic to verifyMetaRegionLocation&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
(!server.getMetaTableLocator().verifyMetaRegionLocation(server.getConnection(),
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.getZooKeeper(), timeout)) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getAssignmentManager().assignMeta
      (HRegionInfo.FIRST_META_REGIONINFO);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (serverName.equals(server.getMetaTableLocator().getMetaRegionLocation(
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.getZooKeeper()))) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase:meta is onlined on the dead server &quot;&lt;/span&gt;
          + serverName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If we see the meta region is still alive on the expired rs, we throw an exception.&lt;br/&gt;
We do some retries (default 10x1000ms) for verifyAndAssignMeta.&lt;br/&gt;
If we still get the exception after retries, we abort the master.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-05-27 06:58:30,156 FATAL [MASTER_META_SERVER_OPERATIONS-bdvs1163:60000-0] master.HMaster: Master server abort: loaded coprocessors are: []
2015-05-27 06:58:30,156 FATAL [MASTER_META_SERVER_OPERATIONS-bdvs1163:60000-0] master.HMaster: verifyAndAssignMeta failed after10 times retries, aborting
java.io.IOException: hbase:meta is onlined on the dead server bdvs1164.svl.ibm.com,16020,1432681743203
        at org.apache.hadoop.hbase.master.handler.MetaServerShutdownHandler.verifyAndAssignMeta(MetaServerShutdownHandler.java:162)
        at org.apache.hadoop.hbase.master.handler.MetaServerShutdownHandler.verifyAndAssignMetaWithRetries(MetaServerShutdownHandler.java:184)
        at org.apache.hadoop.hbase.master.handler.MetaServerShutdownHandler.process(MetaServerShutdownHandler.java:93)
        at org.apache.hadoop.hbase.executor.EventHandler.run(EventHandler.java:128)
        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
2015-05-27 06:58:30,156 INFO  [MASTER_META_SERVER_OPERATIONS-bdvs1163:60000-0] regionserver.HRegionServer: STOPPED: verifyAndAssignMeta failed after10 times retries, aborting
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem happens when the expired is slow processing its own expiration or has a slow death, and is still able to respond to master&apos;s meta verification in the meantime&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12835477">HBASE-13845</key>
            <summary>Expire of one region server carrying meta can bring down the master</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jinghe">Jerry He</assignee>
                                    <reporter username="jinghe">Jerry He</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Jun 2015 17:59:23 +0000</created>
                <updated>Tue, 9 Jun 2015 21:11:39 +0000</updated>
                            <resolved>Tue, 9 Jun 2015 19:07:34 +0000</resolved>
                                    <version>2.0.0</version>
                    <version>1.1.0</version>
                    <version>1.2.0</version>
                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.1.1</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="14573282" author="jinghe" created="Thu, 4 Jun 2015 18:06:55 +0000"  >&lt;p&gt;Can we go ahead with re-assigning the meta even when the expired/failed RS is going thru a slow death?&lt;/p&gt;</comment>
                            <comment id="14573401" author="stack" created="Thu, 4 Jun 2015 19:02:55 +0000"  >&lt;p&gt;What do the retries see as exception &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;Jerry He&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="14573756" author="jinghe" created="Thu, 4 Jun 2015 23:06:53 +0000"  >&lt;p&gt;The retries see the same &quot;IOException: hbase:meta is onlined on the dead server&quot;&lt;br/&gt;
It is simple retry logic.&lt;/p&gt;

&lt;p&gt;This is the call sequence:&lt;/p&gt;

&lt;p&gt;MetaServerShutdownHandler --&amp;gt; process() --&amp;gt; verifyAndAssignMetaWithRetries() --&amp;gt; verifyAndAssignMeta()&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void verifyAndAssignMetaWithRetries() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; iTimes = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.getConfiguration().getInt(
        &lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.catalog.verification.retries&quot;&lt;/span&gt;, 10);

    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; waitTime = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.getConfiguration().getLong(
        &lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.catalog.verification.timeout&quot;&lt;/span&gt;, 1000);

    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; iFlag = 0;
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        verifyAndAssignMeta();
        &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (KeeperException e) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.abort(&lt;span class=&quot;code-quote&quot;&gt;&quot;In server shutdown processing, assigning meta&quot;&lt;/span&gt;, e);
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Aborting&quot;&lt;/span&gt;, e);
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (iFlag &amp;gt;= iTimes) {
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.abort(&lt;span class=&quot;code-quote&quot;&gt;&quot;verifyAndAssignMeta failed after&quot;&lt;/span&gt; + iTimes
              + &lt;span class=&quot;code-quote&quot;&gt;&quot; times retries, aborting&quot;&lt;/span&gt;, e);
          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Aborting&quot;&lt;/span&gt;, e);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14573808" author="jinghe" created="Thu, 4 Jun 2015 23:37:27 +0000"  >&lt;p&gt;Looked at the master branch.  The SSH has been re-written to use Procedure v2.  But this code logic is carried over.&lt;/p&gt;</comment>
                            <comment id="14573868" author="stack" created="Fri, 5 Jun 2015 00:23:35 +0000"  >&lt;p&gt;Duh. Sorry &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;Jerry He&lt;/a&gt;... missed that from your code paste above.  We should change the below to change a particular exception?&lt;/p&gt;

&lt;p&gt;      throw new IOException(&quot;hbase:meta is onlined on the dead server &quot; + this.serverName);&lt;/p&gt;

&lt;p&gt;new MetaOnDeadServerReassignIOE?&lt;/p&gt;

&lt;p&gt;Then when the higher up gets it, do (re)assign. Yeah.&lt;/p&gt;</comment>
                            <comment id="14577678" author="jinghe" created="Mon, 8 Jun 2015 19:19:58 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; for looking into this.&lt;br/&gt;
I attached a branch 1.1 patch with a test case which can be used to re-create the problem.&lt;br/&gt;
I was thinking we probably don&apos;t need to pass the exception higher up and with multiple retries for this exception. We can start the re-assign of meta right away.&lt;/p&gt;

&lt;p&gt;I will work on a master patch ...&lt;/p&gt;</comment>
                            <comment id="14578034" author="stack" created="Mon, 8 Jun 2015 23:14:12 +0000"  >&lt;p&gt;Patch looks good to me &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;Jerry He&lt;/a&gt; +1&lt;/p&gt;

&lt;p&gt;Your test passes?  Would be good for a hadoopqa run to happen.... May be it&apos;ll show up soon. Nice one.&lt;/p&gt;</comment>
                            <comment id="14578045" author="hadoopqa" created="Mon, 8 Jun 2015 23:23:19 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12738416/HBASE-13845-branch-1.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12738416/HBASE-13845-branch-1.1.patch&lt;/a&gt;&lt;br/&gt;
  against branch-1.1 branch at commit c19bc6d6e0dee4b60f45350ab7561fd15cfead7d.&lt;br/&gt;
  ATTACHMENT ID: 12738416&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14337//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14337//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14337//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14337//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14337//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14337//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14337//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14337//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14578191" author="jinghe" created="Tue, 9 Jun 2015 02:06:18 +0000"  >&lt;p&gt;The problem was seen in HBase 1.1.0, and the patch was tested against HBase 1.1.0.&lt;/p&gt;

&lt;p&gt;The test case in the patch can be used to re-created the problem.&lt;br/&gt;
With the test case, I see the same problem in branch-1. &lt;br/&gt;
But strangely, it does not re-create on the master branch, meaning that without the fix the test case passes on the master branch. Something must have changed on 2.0. I will dig a little more.&lt;/p&gt;</comment>
                            <comment id="14578227" author="stack" created="Tue, 9 Jun 2015 02:54:51 +0000"  >&lt;p&gt;Thank you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;Jerry He&lt;/a&gt; If only you figure the why it is not needed in master, that&apos;d be sweet.  +1 on commit to branch-1 and branch-1.1 (but you might want to wait on your Master findings before commit so all goes in together). Nice one.&lt;/p&gt;</comment>
                            <comment id="14578298" author="jinghe" created="Tue, 9 Jun 2015 04:33:36 +0000"  >&lt;p&gt;ok. The master branch goes totally ZK-less region assignment.  The problem does not show up under ZK-less assignment.&lt;br/&gt;
We always call am.regionOffline(HRegionInfo.FIRST_META_REGIONINFO) before verifyAndAssignMetaWithRetries() when processing the meta server shutdown/crash:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-comment&quot;&gt;// Assign meta &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we were carrying it.
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// Check again: region may be assigned to other where because of RIT
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// timeout
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (am.isCarryingMeta(serverName)) {
        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Server &quot;&lt;/span&gt; + serverName + &lt;span class=&quot;code-quote&quot;&gt;&quot; was carrying META. Trying to assign.&quot;&lt;/span&gt;);
        am.regionOffline(HRegionInfo.FIRST_META_REGIONINFO);
        verifyAndAssignMetaWithRetries();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;When using ZK-less assignment,  am.regionOffline(HRegionInfo.FIRST_META_REGIONINFO) ==&amp;gt; RegionStateStore.updateRegionState() sets OFFLINE state on meta region server znode.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-comment&quot;&gt;// meta state stored in zk.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hri.isMetaRegion()) {
        &lt;span class=&quot;code-comment&quot;&gt;// persist meta state in MetaTableLocator (which in turn is zk storage currently)
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          MetaTableLocator.setMetaLocation(server.getZooKeeper(),
            newState.getServerName(), hri.getReplicaId(), newState.getState());
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;; &lt;span class=&quot;code-comment&quot;&gt;// Done
&lt;/span&gt;        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then MetaTableLocator.getMetaRegionLocation() will always return null.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ServerName getMetaRegionLocation(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ZooKeeperWatcher zkw, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; replicaId) {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      RegionState state = getMetaRegionState(zkw, replicaId);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; state.isOpened() ? state.getServerName() : &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (KeeperException ke) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So we will never try to re-use existing meta region server location on ZK. &lt;br/&gt;
In the master branch code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void verifyAndAssignMeta(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; MasterProcedureEnv env)
      &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException, IOException, KeeperException {
    MasterServices services = env.getMasterServices();
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isMetaAssignedQuickTest(env)) {
      services.getAssignmentManager().assignMeta(HRegionInfo.FIRST_META_REGIONINFO);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (serverName.equals(services.getMetaTableLocator().
        getMetaRegionLocation(services.getZooKeeper()))) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase:meta is onlined on the dead server &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.serverName);
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Skip assigning hbase:meta because it is online at &quot;&lt;/span&gt;
          + services.getMetaTableLocator().getMetaRegionLocation(services.getZooKeeper()));
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;isMetaAssignedQuickTest() will always return false.&lt;/p&gt;</comment>
                            <comment id="14578309" author="stack" created="Tue, 9 Jun 2015 04:41:09 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;Jerry He&lt;/a&gt; That&apos;d explain the difference. +1 on patch for branch-1 and branch-1.1 (&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; Nice bugfix by our &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;Jerry He&lt;/a&gt; here)&lt;/p&gt;</comment>
                            <comment id="14579219" author="jinghe" created="Tue, 9 Jun 2015 16:59:47 +0000"  >&lt;p&gt;Thanks for the review, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Committed to branch-1.1 and branch-1.&lt;/p&gt;

&lt;p&gt;I am thinking about putting only the test case into master branch, as a regression guide. What do you think, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;?  &lt;/p&gt;</comment>
                            <comment id="14579236" author="hadoopqa" created="Tue, 9 Jun 2015 17:08:56 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12738613/HBASE-13845-branch-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12738613/HBASE-13845-branch-1.patch&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit 6cc42c8cd16d01cded9936bf53bf35e6e2ff5b66.&lt;br/&gt;
  ATTACHMENT ID: 12738613&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14346//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14346//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14579253" author="ndimiduk" created="Tue, 9 Jun 2015 17:17:54 +0000"  >&lt;p&gt;Nice one &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;Jerry He&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14579266" author="stack" created="Tue, 9 Jun 2015 17:22:02 +0000"  >&lt;blockquote&gt;&lt;p&gt;I am thinking about putting only the test case into master branch, as a regression guide. What do you think, stack?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think it is a good idea. +1&lt;/p&gt;</comment>
                            <comment id="14579382" author="hudson" created="Tue, 9 Jun 2015 18:41:48 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2 #140 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/140/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/140/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13845&quot; title=&quot;Expire of one region server carrying meta can bring down the master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13845&quot;&gt;&lt;del&gt;HBASE-13845&lt;/del&gt;&lt;/a&gt; Expire of one region server carrying meta can bring down the master (jerryjch: rev d37d9c43de6c919a58ff34548a36af1e22e6cc2a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/procedure/ServerCrashProcedure.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestMetaShutdownHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14579412" author="jinghe" created="Tue, 9 Jun 2015 19:04:23 +0000"  >&lt;p&gt;it seems there was a glitch applying the branch-1 patch from Hadoop QA.&lt;br/&gt;
It was applied fine with &apos;git apply&apos; locally. There was mentioning on the hbase dev mailing list recently as I recall?&lt;/p&gt;

&lt;p&gt;Committed the test case to the master branch. &lt;/p&gt;</comment>
                            <comment id="14579432" author="hudson" created="Tue, 9 Jun 2015 19:20:24 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1 #532 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/532/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/532/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13845&quot; title=&quot;Expire of one region server carrying meta can bring down the master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13845&quot;&gt;&lt;del&gt;HBASE-13845&lt;/del&gt;&lt;/a&gt; Expire of one region server carrying meta can bring down the master (jerryjch: rev f95430a8428a5a3e9bfd7b9d38d434eb298133ae)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/handler/MetaServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestMetaShutdownHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14579569" author="hudson" created="Tue, 9 Jun 2015 21:11:39 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6556 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6556/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6556/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13845&quot; title=&quot;Expire of one region server carrying meta can bring down the master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13845&quot;&gt;&lt;del&gt;HBASE-13845&lt;/del&gt;&lt;/a&gt; Expire of one region server carrying meta can bring down the master: test case (jerryjch: rev 14fe23254a78c52bdaef0da819268c8b405059cb)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestMetaShutdownHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12738416" name="HBASE-13845-branch-1.1.patch" size="7752" author="jinghe" created="Mon, 8 Jun 2015 19:13:39 +0000"/>
                            <attachment id="12738613" name="HBASE-13845-branch-1.patch" size="7725" author="jinghe" created="Tue, 9 Jun 2015 16:56:31 +0000"/>
                            <attachment id="12738638" name="HBASE-13845-master-test-case-only.patch" size="6736" author="jinghe" created="Tue, 9 Jun 2015 19:04:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 4 Jun 2015 19:02:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 27 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2fnaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>