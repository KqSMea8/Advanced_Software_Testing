<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:25:19 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5161/HBASE-5161.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5161] Compaction algorithm should prioritize reference files</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5161</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I got myself into a state where my table was un-splittable as long as the insert load was coming in. Emergency flushes because of the low memory barrier don&apos;t check the number of store files so it never blocks, to a point where I had in one case 45 store files and the compactions were almost never done on the reference files (had 15 of them, went down by one in 20 minutes). Since you can&apos;t split regions with reference files, that region couldn&apos;t split and was doomed to just get more store files until the load stopped.&lt;/p&gt;

&lt;p&gt;Marking this as a minor issue, what we really need is a better pushback mechanism but not prioritizing reference files seems wrong.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12537837">HBASE-5161</key>
            <summary>Compaction algorithm should prioritize reference files</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="4">Incomplete</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 10 Jan 2012 00:23:04 +0000</created>
                <updated>Sat, 11 Apr 2015 01:33:06 +0000</updated>
                            <resolved>Sat, 11 Apr 2015 01:33:06 +0000</resolved>
                                    <version>0.92.0</version>
                                                        <due></due>
                            <votes>1</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="13206330" author="jdcryans" created="Sun, 12 Feb 2012 01:46:06 +0000"  >&lt;p&gt;Just got this again running a 5TB upload, started seeing regions of &amp;gt;50GB that couldn&apos;t split.&lt;/p&gt;</comment>
                            <comment id="13217933" author="stack" created="Tue, 28 Feb 2012 05:59:59 +0000"  >&lt;p&gt;This is not actually a problem, right J-D?  The actual problem is that it takes a long time to clear the reference files &amp;#8211; even though they are the first things scheduled on region open &amp;#8211; because sometimes we have such a backlog of compaction to catch up on (lots of big files).&lt;/p&gt;</comment>
                            <comment id="13217936" author="jdcryans" created="Tue, 28 Feb 2012 06:04:57 +0000"  >&lt;p&gt;Right, the real solution is that we need to slow down writes if we get in that sort of situation. We can only compact so fast.&lt;/p&gt;</comment>
                            <comment id="13262407" author="ram_krish" created="Thu, 26 Apr 2012 06:30:42 +0000"  >&lt;p&gt;@Stack and @J-D&lt;/p&gt;

&lt;p&gt;We seem to end up in the same problem.  We had some 32 reference files created out of which one was never selected in further compaction cycles.&lt;/p&gt;

&lt;p&gt;We even tried to stop the writes for 2 to 3 hours but still the compaction did not pick up the reference file. &lt;/p&gt;

&lt;p&gt;The region grew upto 400G.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./hbase-root-regionserver-HOST-192-168-47-205.log:2012-04-26 09:44:15,835 DEBUG org.apache.hadoop.hbase.regionserver.Store: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//10.18.40.217:9000/hbase/ufdr/ce5c144a1714df08db1132238a749116/value/cde90029ecb74ef791500ccd3a1e8908.755d1cf6b960c02cc72c1dd83551df82-hdfs://10.18.40.217:9000/hbase/ufdr/755d1cf6b960c02cc72c1dd83551df82/value/cde90029ecb74ef791500ccd3a1e8908-top is not splittable&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We get the above logs for almost 2 to 3 hours.  The pair of this reference file (its bottom) is also not compacted.&lt;/p&gt;

&lt;p&gt;Will dig in more to find any other reason for not getting picked up.&lt;/p&gt;</comment>
                            <comment id="13262537" author="ram_krish" created="Thu, 26 Apr 2012 11:52:37 +0000"  >&lt;p&gt;I did not want to open a new issue.  Thought i can reopen this issue.  Correct me if am wrong.&lt;/p&gt;

&lt;p&gt;I have a high load write operation going on.  Region split keeps happening.&lt;br/&gt;
When to one of my region the load becomes too heavy the split starts and creates lot of reference files which is greater than my maxfilestocompact.&lt;/p&gt;

&lt;p&gt;So suppose my &apos;hbase.hstore.compaction.max&apos; is 20 and the reference files that are created is 32*2 (64 files).&lt;br/&gt;
In compaction selection&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (compactSelection.getFilesToCompact().size() &amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.maxFilesToCompact) {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; pastMax =
          compactSelection.getFilesToCompact().size() - &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.maxFilesToCompact;
        compactSelection.clearSubList(0, pastMax);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The filesToCompact is ordered based on seq id.  In this case the set of files from 0 to pastMax (i.e) the reference files which has lesser seq id are not considered for compaction. By the time more store files are created and once again the earlier created ones are avoided. Those being reference files, the split never happens.  The region grew upto 400G.&lt;/p&gt;

&lt;p&gt;Note that - We even tried to stop the writes for 2 to 3 hours but still the compaction did not pick up the reference file. &lt;/p&gt;</comment>
                            <comment id="13262638" author="jeason" created="Thu, 26 Apr 2012 14:28:23 +0000"  >&lt;p&gt;It&apos;s a really special scenario. High input pressure and splitting run in parallel caused this vicious circle.&lt;br/&gt;
We should check whether the compaction is still running. Compact a 400G region will take long time. &lt;/p&gt;</comment>
                            <comment id="13284958" author="lhofhansl" created="Tue, 29 May 2012 17:46:16 +0000"  >&lt;p&gt;This is an old existing issue with no patch available. Unassigning from 0.94 for now.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 28 Feb 2012 05:59:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>223343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 29 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02cv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11685</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>