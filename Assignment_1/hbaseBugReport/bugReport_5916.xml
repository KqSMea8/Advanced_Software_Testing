<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:32:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5916/HBASE-5916.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5916] RS restart just before master intialization we make the cluster non operative</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5916</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Consider a case where my master is getting restarted.  RS that was alive when the master restart started, gets restarted before the master initializes the ServerShutDownHandler.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
serverShutdownHandlerEnabled = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case when the RS tries to register with the master, the master will try to expire the server but the server cannot be expired as still the serverShutdownHandler is not enabled.&lt;/p&gt;

&lt;p&gt;This case may happen when i have only one RS gets restarted or all the RS gets restarted at the same time.(before assignRootandMeta).&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LOG.info(message);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (existingServer.getStartcode() &amp;lt; serverName.getStartcode()) {
        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Triggering server recovery; existingServer &quot;&lt;/span&gt; +
          existingServer + &lt;span class=&quot;code-quote&quot;&gt;&quot; looks stale, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; server:&quot;&lt;/span&gt; + serverName);
        expireServer(existingServer);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If another RS is brought up then the cluster comes back to normalcy.&lt;/p&gt;

&lt;p&gt;May be a very corner case.&lt;/p&gt;


</description>
                <environment></environment>
        <key id="12553597">HBASE-5916</key>
            <summary>RS restart just before master intialization we make the cluster non operative</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="ram_krish">ramkrishna.s.vasudevan</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 May 2012 09:22:02 +0000</created>
                <updated>Wed, 18 Sep 2013 20:47:43 +0000</updated>
                            <resolved>Tue, 29 May 2012 16:35:50 +0000</resolved>
                                    <version>0.92.1</version>
                    <version>0.94.0</version>
                                    <fixVersion>0.92.2</fixVersion>
                    <fixVersion>0.94.1</fixVersion>
                    <fixVersion>0.95.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13266467" author="ram_krish" created="Wed, 2 May 2012 09:45:27 +0000"  >&lt;p&gt;RS restart here is using kill -9 and then starting it.&lt;/p&gt;</comment>
                            <comment id="13267180" author="ram_krish" created="Thu, 3 May 2012 05:00:47 +0000"  >&lt;p&gt;Upped the priority of this defect. While master is coming up&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1-&amp;gt;Wait &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region server to register
2-&amp;gt;Get the online server list
3-&amp;gt; Start splitting the logs
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Between step 2 and 3 if another new region server registers, we just split the logs of the new region server and in fact delete the HLog folder for that new region server. This seems critical. &lt;br/&gt;
While analysing the issue for  which this JIRA was created we ended up in this problem.&lt;/p&gt;</comment>
                            <comment id="13267198" author="stack" created="Thu, 3 May 2012 05:24:28 +0000"  >&lt;p&gt;Tell us more Ram.  If new regionserver comes in and we split its logs, so what?  It is not carrying any regions, right?  We&apos;ll assign it regions when done splitting?  Or are you talking about a case where a regionserver is just very slow about checking in?&lt;/p&gt;</comment>
                            <comment id="13267205" author="ram_krish" created="Thu, 3 May 2012 05:33:26 +0000"  >&lt;p&gt;Yes the RS is slow in checking in.&lt;br/&gt;
The problem here is the master will do the split of the newly checked in RS as he is the RS that is not there in the online list.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Set&amp;lt;ServerName&amp;gt; onlineServers = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;ServerName&amp;gt;(serverManager
        .getOnlineServers().keySet());
    &lt;span class=&quot;code-comment&quot;&gt;// TODO: Should &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; in background rather than block master startup
&lt;/span&gt;    status.setStatus(&lt;span class=&quot;code-quote&quot;&gt;&quot;Splitting logs after master startup&quot;&lt;/span&gt;);
    splitLogAfterStartup(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fileSystemManager, onlineServers);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;To split if i find any log folder which is not belonging to any of those in &apos;onlineServers&apos;(the online list is already got) we will call split log and finally delete the log folder.  So though the server is online i will not be able to use the hLog and i get filenotfoundException. Sorry if am not clear.&lt;/p&gt;</comment>
                            <comment id="13267214" author="stack" created="Thu, 3 May 2012 05:51:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;So though the server is online i will not be able to use the hLog and i get filenotfoundException. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Master should not take over hlogs that were created at about same time as master start and that have no content in them?&lt;/p&gt;

&lt;p&gt;Should we check for regionserver znodes and if present, wait a little longer?  Give them another chance?&lt;/p&gt;</comment>
                            <comment id="13267218" author="zjushch" created="Thu, 3 May 2012 06:01:10 +0000"  >&lt;p&gt;We have also encountered this issue.&lt;/p&gt;

&lt;p&gt;What about remove &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PleaseHoldException(message);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;in ServerManager#checkAlreadySameHostPort&lt;/p&gt;</comment>
                            <comment id="13267232" author="stack" created="Thu, 3 May 2012 06:06:33 +0000"  >&lt;p&gt;Well, thats useful, right?  Its useful in case where a regionserver crashes and a new one comes up fast, before the original regionserver&apos;s znode has expired in zk.  We shouldn&apos;t remove it.&lt;/p&gt;

&lt;p&gt;On startup, you should not get this exception unless you have a condition like that described above where there was a regionserver on same host and port registered previously in the master and then a new regionserver comes in w/ same host and port but with different startcode?&lt;/p&gt;</comment>
                            <comment id="13267253" author="ram_krish" created="Thu, 3 May 2012 06:46:44 +0000"  >&lt;p&gt;We should not remove PleaseHoldException(message) directly.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (services.isServerShutdownHandlerEnabled()) {
        &lt;span class=&quot;code-comment&quot;&gt;// master has completed the initialization
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PleaseHoldException(message);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This solved the actual problem.  But the problem due to filenotfoundException should be addressed in a different way.&lt;/p&gt;</comment>
                            <comment id="13268472" author="ram_krish" created="Fri, 4 May 2012 15:51:55 +0000"  >&lt;p&gt;Tried to address this problem using the system time.  The test case attached in the patch reproduces the issue of how the HLog gets deleted.&lt;br/&gt;
If the way of using time to avoid this issue seems bad pls don&apos;t Hate me. I think atleast the test case will be useful.&lt;br/&gt;
I tried to use the zk but the problem is we will not be sure if that server is about to be expired server or current new server. &lt;/p&gt;</comment>
                            <comment id="13268473" author="ram_krish" created="Fri, 4 May 2012 15:53:01 +0000"  >&lt;p&gt;Just a try, need to do some more testing on it. Uploaded to get some feedback.&lt;/p&gt;</comment>
                            <comment id="13268502" author="zhihyu@ebaysf.com" created="Fri, 4 May 2012 16:24:19 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * Verifies HBASE-5816. Here before the master splits the HLog &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; any &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RS checks in it should
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The JIRA should be &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5916&quot; title=&quot;RS restart just before master intialization we make the cluster non operative&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5916&quot;&gt;&lt;del&gt;HBASE-5916&lt;/del&gt;&lt;/a&gt;, right ?&lt;/p&gt;</comment>
                            <comment id="13268524" author="ram_krish" created="Fri, 4 May 2012 16:46:54 +0000"  >&lt;p&gt;Ooh.. Yes it is &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5916&quot; title=&quot;RS restart just before master intialization we make the cluster non operative&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5916&quot;&gt;&lt;del&gt;HBASE-5916&lt;/del&gt;&lt;/a&gt;.  &lt;/p&gt;</comment>
                            <comment id="13268529" author="hadoopqa" created="Fri, 4 May 2012 16:50:40 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525639/HBASE-5916_trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525639/HBASE-5916_trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestServerCustomProtocol&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestAssignmentManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1766//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1766//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1766//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1766//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1766//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1766//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13268539" author="ram_krish" created="Fri, 4 May 2012 17:00:37 +0000"  >&lt;p&gt;Failure in testcase &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.ClassCastException: org.apache.hadoop.hbase.Server$$EnhancerByMockitoWithCGLIB$$9bdf744 cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to org.apache.hadoop.hbase.master.HMaster
	at org.apache.hadoop.hbase.master.AssignmentManager.rebuildUserRegions(AssignmentManager.java:2480)
	at org.apache.hadoop.hbase.master.AssignmentManager.joinCluster(AssignmentManager.java:359)
	at org.apache.hadoop.hbase.master.AssignmentManager.joinCluster(AssignmentManager.java:379)
	at org.apache.hadoop.hbase.master.TestAssignmentManager$2.run(TestAssignmentManager.java:705)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above exception is due to the patch&lt;/p&gt;</comment>
                            <comment id="13268651" author="ram_krish" created="Fri, 4 May 2012 19:31:09 +0000"  >&lt;p&gt;Updated patch.&lt;/p&gt;</comment>
                            <comment id="13268652" author="ram_krish" created="Fri, 4 May 2012 19:31:39 +0000"  >&lt;p&gt;Will make use of hadoopqa to run the testcases, as am at home.&lt;/p&gt;</comment>
                            <comment id="13268971" author="ram_krish" created="Sat, 5 May 2012 14:14:05 +0000"  >&lt;p&gt;Reattaching for hadoopqa.&lt;/p&gt;</comment>
                            <comment id="13268973" author="hadoopqa" created="Sat, 5 May 2012 14:22:21 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525729/HBASE-5916_trunk_1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525729/HBASE-5916_trunk_1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1779//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1779//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13269750" author="ram_krish" created="Mon, 7 May 2012 16:27:05 +0000"  >&lt;p&gt;Reattaching.  Patch is getting applied cleanly.  May be because of same name the QA did not pick it up.&lt;br/&gt;
Please provide your comments on the latest patch.&lt;/p&gt;</comment>
                            <comment id="13269752" author="hadoopqa" created="Mon, 7 May 2012 16:32:23 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525870/HBASE-5916_trunk_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525870/HBASE-5916_trunk_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1788//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1788//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13269766" author="zhihyu@ebaysf.com" created="Mon, 7 May 2012 16:50:55 +0000"  >&lt;p&gt;There is some conflict in TestMasterFailover.java which patch command couldn&apos;t resolve:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
***************
*** 38,43 ****
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.*;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.executor.EventHandler.EventType;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.master.AssignmentManager.RegionState;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.regionserver.HRegion;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.regionserver.HRegionServer;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.util.Bytes;
--- 39,45 ----
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.*;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.executor.EventHandler.EventType;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.master.AssignmentManager.RegionState;
+ &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.master.metrics.MasterMetrics;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.regionserver.HRegion;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.regionserver.HRegionServer;
  &lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.util.Bytes;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13269793" author="ram_krish" created="Mon, 7 May 2012 17:25:57 +0000"  >&lt;p&gt;The patch still applies correctly in Windows thro SVN client.  But finally its because there is an empty line in the line number 33.&lt;br/&gt;
Tried out in the apache linux machine.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Patching file src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java using Plan A...
Hunk #1 succeeded at 23.
Hunk #2 succeeded at 37.
Hunk #3 succeeded at 52.
Hunk #4 succeeded at 137.
Hmm...  The next patch looks like a unified diff to me...
The text leading up to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; was:
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This time it should run.&lt;/p&gt;</comment>
                            <comment id="13269836" author="hadoopqa" created="Mon, 7 May 2012 18:17:22 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525878/HBASE-5916_trunk_3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525878/HBASE-5916_trunk_3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1789//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1789//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1789//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1789//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1789//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1789//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13270178" author="ram_krish" created="Tue, 8 May 2012 04:08:59 +0000"  >&lt;p&gt;The test cases are passing this time.&lt;br/&gt;
@Stack&lt;br/&gt;
Your comments on the patch?&lt;/p&gt;</comment>
                            <comment id="13270764" author="stack" created="Tue, 8 May 2012 19:46:25 +0000"  >&lt;p&gt;Why make this change?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Set&amp;lt;ServerName&amp;gt; onlineServers)
+       Set&amp;lt;ServerName&amp;gt; onlineServers)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Will alreadyOnlineSlowRS be a superset of onlineServers so you only need check it rather than both as in the below?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!onlineServers.contains(regionLocation)
+          &amp;amp;&amp;amp; !alreadyOnlineSlowRS.contains(regionLocation)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;m not sure master time is what you want.  What you want is the filesystem time, the time the namenode is using.  I&apos;m not sure but my guess would be that the modtime for files in hdfs would be set by the namenode; if a difference between master and namenode clocks, there could be a hole through which some WALs could slip if we use master time?  What you think Ram?&lt;/p&gt;

&lt;p&gt;Otherwise, the patch is great.  I love the test.&lt;/p&gt;
</comment>
                            <comment id="13271158" author="ram_krish" created="Wed, 9 May 2012 06:46:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;if a difference between master and namenode clocks&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I had similar doubts in using time factor.  Let me check if something better is available.&lt;/p&gt;</comment>
                            <comment id="13271160" author="ram_krish" created="Wed, 9 May 2012 06:47:54 +0000"  >&lt;p&gt;Atleast i can be sure of the RS and master time clocks right?&lt;/p&gt;</comment>
                            <comment id="13271646" author="ram_krish" created="Wed, 9 May 2012 18:11:06 +0000"  >&lt;p&gt;I have tried out someother way.  Will upload the patch tomorrow.  But the current testcase in this patch needs to be modified.&lt;/p&gt;</comment>
                            <comment id="13272590" author="ram_krish" created="Thu, 10 May 2012 18:17:06 +0000"  >&lt;p&gt;Attached latest patch.  Another way but this one would be simpler.  Did not write testcase  based on the current fix.&lt;/p&gt;</comment>
                            <comment id="13272620" author="zhihyu@ebaysf.com" created="Thu, 10 May 2012 18:39:07 +0000"  >&lt;p&gt;For MasterFileSystem.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!onlineServers.contains(serverName)) {
+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!((HMaster) master).getServerManager().getOnlineServers()
+              .keySet().contains(serverName)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above code is called inside a loop. Please store ((HMaster) master).getServerManager().getOnlineServers() in a variable outside the loop.&lt;/p&gt;</comment>
                            <comment id="13272673" author="hadoopqa" created="Thu, 10 May 2012 19:31:32 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12526389/HBASE-5916_trunk_4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12526389/HBASE-5916_trunk_4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestDrainingServer&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestRSKilledWhenMasterInitializing&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1836//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1836//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1836//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1836//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1836//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1836//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13277714" author="ram_krish" created="Thu, 17 May 2012 10:36:09 +0000"  >&lt;p&gt;Pls check the latest patch.  We have tested it on a cluster also.  The test case in the first patch will show what is the problem.  With this patch i have not attached any new test case.&lt;br/&gt;
Pls take a look at it.&lt;/p&gt;</comment>
                            <comment id="13277732" author="hadoopqa" created="Thu, 17 May 2012 11:22:09 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12527821/HBASE-5916_trunk_v5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12527821/HBASE-5916_trunk_v5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 33 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1910//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1910//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1910//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1910//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1910//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1910//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13277811" author="zhihyu@ebaysf.com" created="Thu, 17 May 2012 13:56:28 +0000"  >&lt;p&gt;+1 on patch v5.&lt;/p&gt;

&lt;p&gt;Minor comment:&lt;br/&gt;
Insert a space after if.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(actualDeadServers.contains(deadServer.getKey())){
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13281357" author="zjushch" created="Wed, 23 May 2012 02:06:25 +0000"  >&lt;p&gt;I have a doubt about patchV5&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    Set&amp;lt;ServerName&amp;gt; actualDeadServers = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.serverManager.getDeadServers();
     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;ServerName, List&amp;lt;Pair&amp;lt;HRegionInfo, Result&amp;gt;&amp;gt;&amp;gt; deadServer: deadServers.entrySet()) {
+      &lt;span class=&quot;code-comment&quot;&gt;// skip regions of dead servers because SSH will process regions during rs expiration. 
&lt;/span&gt;+      &lt;span class=&quot;code-comment&quot;&gt;// see HBASE-5916
&lt;/span&gt;+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(actualDeadServers.contains(deadServer.getKey())){
+        &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let&apos;s see the ServerManager#getDeadServers()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Set&amp;lt;ServerName&amp;gt; getDeadServers() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadservers.clone();
  }
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; Set&amp;lt;ServerName&amp;gt; clone() {
    Set&amp;lt;ServerName&amp;gt; clone = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;ServerName&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadServers.size());
    clone.addAll(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadServers);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; clone;
  }
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; cleanPreviousInstance(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ServerName newServerName) {
    ServerName sn =
      ServerName.findServerWithSameHostnamePort(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadServers, newServerName);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sn == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadServers.remove(sn);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;if Regionserver A with startcode 001 is restarted, and then Regionserver A with startcode 002 is in the onlineServers, but Regionserver A with startcode 001 is in the process by SSH, not in the deadServers&lt;/p&gt;

&lt;p&gt;So we will multi assign regions carried by the Regionserver A with startcode 001.&lt;/p&gt;

&lt;p&gt;BTW, to fix this issue, why doing the following is not enough?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PleaseHoldException(message);
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (services.isServerShutdownHandlerEnabled()) {
+        &lt;span class=&quot;code-comment&quot;&gt;// master has completed the initialization
&lt;/span&gt;+        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PleaseHoldException(message);
+      }&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Correct me if wrong, Thanks&lt;/p&gt;

</comment>
                            <comment id="13281645" author="ram_krish" created="Wed, 23 May 2012 14:53:17 +0000"  >&lt;p&gt;Am trying to check all your comments, but coming to this&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (services.isServerShutdownHandlerEnabled()) {
+        &lt;span class=&quot;code-comment&quot;&gt;// master has completed the initialization
&lt;/span&gt;+        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PleaseHoldException(message);
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Anyway as i mentioned there is a chance of HLog file getting deleted.  See my comments in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5916?focusedCommentId=13267205&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13267205&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-5916?focusedCommentId=13267205&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13267205&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;That is also one reason why i did not want to go with only that change.  Wanted to handle most of the cases.  But there are many scenarios here &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13282106" author="zjushch" created="Thu, 24 May 2012 01:34:58 +0000"  >&lt;p&gt;@ram&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;the RS is slow in checking in.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;First, we will do the following:Check zk for regionservers that are up but didn&apos;t register.&lt;/p&gt;

&lt;p&gt;Anyway, if the RS is check in when master splitting log, I think we could specify log dirs to split for splitLogAfterStartup.&lt;/p&gt;

&lt;p&gt;We could do it as the following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HMaster#finishInitialization{
...
Path logsDirPath = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootdir, HConstants.HREGION_LOGDIR_NAME);
FileStatus[] logFolders = FSUtils.listStatus(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs, logsDirPath, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
Set&amp;lt;ServerName&amp;gt; onlineServers = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;ServerName&amp;gt;(serverManager
        .getOnlineServers().keySet());

List&amp;lt;ServerName&amp;gt; needSplitServers= &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;ServerName&amp;gt;();
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (FileStatus status : logFolders){
&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sn = status.getPath().getName();
&lt;span class=&quot;code-comment&quot;&gt;// truncate splitting suffix &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; present (&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; ServerName parsing)
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sn.endsWith(HLog.SPLITTING_EXT)) {
          sn = sn.substring(0, sn.length() - HLog.SPLITTING_EXT.length());
}
ServerName serverName = ServerName.parseServerName(sn);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!onlineServers.contains(serverName)) {
needSplitServers.add(serverName)
}
}
...
splitLogAfterStartup(mfs,needSplitServers)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Could the above fix the case? &lt;br/&gt;
Correct me if wrong, Thanks&lt;/p&gt;</comment>
                            <comment id="13282160" author="zhihyu@ebaysf.com" created="Thu, 24 May 2012 03:40:48 +0000"  >&lt;p&gt;It would help readers understand better if the above code is formulated as a patch.&lt;/p&gt;</comment>
                            <comment id="13282580" author="ram_krish" created="Thu, 24 May 2012 15:52:18 +0000"  >&lt;p&gt;@Chunhui&lt;br/&gt;
The suggestion given above can simply be avoided by taking a the actual online servers list after getting the logFolders.  This will ensure that we donot split any new RS that has checked in.&lt;/p&gt;

&lt;p&gt;In joinCluster(), as per the existing code if any new server has checked in and the root/meta had got assigned to it in joincluster we may think that it is an dead server because we alerady have passed the online servers.  Hence we are trying to get the actual online list as per the patch.&lt;/p&gt;

&lt;p&gt;The problem that you have mentioned here&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;if Regionserver A with startcode 001 is restarted, and then Regionserver A with startcode 002 is in the onlineServers, but Regionserver A with startcode 001 is in the process by SSH, not in the deadServers&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This we are trying to avoid in our current v6 patch, by not remvoing from dead servers, any restarted server that is coming up during master initialization. Later after master initialization we try to clear the dead server which matches with the current online servers with same host name and port.&lt;/p&gt;

&lt;p&gt;There are other problems during SSH and master initialization that may lead to double assignment or concurrent modification exception.  These things we will address in a new JIRA.&lt;br/&gt;
Pls review the current patch and provide your suggestions.&lt;/p&gt;</comment>
                            <comment id="13282581" author="rajesh23" created="Thu, 24 May 2012 15:54:11 +0000"  >&lt;p&gt;Attached patch. Please review and provide suggestions/comments&lt;/p&gt;</comment>
                            <comment id="13282589" author="hadoopqa" created="Thu, 24 May 2012 16:10:48 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12529160/HBASE-5916_trunk_v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12529160/HBASE-5916_trunk_v6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 34 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestClockSkewDetection&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1986//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1986//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1986//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1986//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1986//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1986//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13282808" author="zhihyu@ebaysf.com" created="Thu, 24 May 2012 21:58:13 +0000"  >&lt;p&gt;The failure in TestClockSkewDetection was due to NPE.&lt;br/&gt;
The following change makes it pass:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || ((HMaster) &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services).isInitialized())
        &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadservers.cleanPreviousInstance(serverName)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * To clear any dead server with same host name and port of online server
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think &apos;any&apos; should be added in front of &apos;online server&apos;.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void clearDeadServersWithSameHostNameAndPortOfOnlineServer() {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above method can be package private, right ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((sn = ServerName.findServerWithSameHostnamePort(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadservers, serverName)) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above line exceeds 100 chars.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(actualDeadServers.contains(deadServer.getKey())){
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Add spaces after if and before {.&lt;/p&gt;</comment>
                            <comment id="13282882" author="zjushch" created="Fri, 25 May 2012 00:58:56 +0000"  >&lt;p&gt;@ram&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;In joinCluster(), as per the existing code if any new server has checked in and the root/meta had got assigned to it in joincluster we may think that it is an dead server because we alerady have passed the online servers.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If we consider it as a dead server, what error will be caused? &lt;br/&gt;
I think no error. Because, it must be a new regionserver (which is restarted right now), there is no regions carried by it. Of course, we won&apos;t assign region to it, but I think it is nothing.&lt;/p&gt;

&lt;p&gt;Correct me if wrong, thanks &lt;/p&gt;</comment>
                            <comment id="13282981" author="rajesh23" created="Fri, 25 May 2012 02:11:15 +0000"  >&lt;p&gt;@Zhihong Yu&lt;br/&gt;
Thanks for help.&lt;/p&gt;

&lt;p&gt;In latest patch addressed Zhihong Yu comments. &lt;/p&gt;</comment>
                            <comment id="13283081" author="zjushch" created="Fri, 25 May 2012 03:22:03 +0000"  >&lt;p&gt;I have make a simple patch(v8) with my above mentioned solution&lt;/p&gt;

&lt;p&gt;@ram&lt;br/&gt;
Could you test it with your test case.&lt;/p&gt;

&lt;p&gt;Maybe something wrong, thanks for the reivew.&lt;/p&gt;</comment>
                            <comment id="13283109" author="hadoopqa" created="Fri, 25 May 2012 04:16:57 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12529660/HBASE-5916v8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12529660/HBASE-5916v8.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 34 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestServerCustomProtocol&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1993//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1993//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1993//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1993//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1993//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1993//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13283110" author="ram_krish" created="Fri, 25 May 2012 04:26:05 +0000"  >&lt;p&gt;First of all thanks for your time in preparing a patch.&lt;br/&gt;
I think if we don&apos;t get the new online servers in joincluster there is one problem&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     STEP 1: &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.serverManager.expireDeadNotExpiredServers();

    &lt;span class=&quot;code-comment&quot;&gt;// Update meta with &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HRI &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; required. i.e migrate all HRI with HTD to
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// HRI with out HTD in meta and update the status in ROOT. This must happen
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// before we assign all user regions or &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; the assignment will fail.
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// TODO: Remove &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; when we &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; 0.94.
&lt;/span&gt;  STEP 2:    org.apache.hadoop.hbase.catalog.MetaMigrationRemovingHTD.
      updateMetaWithNewHRI(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;);

    &lt;span class=&quot;code-comment&quot;&gt;// Fixup assignment manager status
&lt;/span&gt;    status.setStatus(&lt;span class=&quot;code-quote&quot;&gt;&quot;Starting assignment manager&quot;&lt;/span&gt;);
  STEP 3:    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.assignmentManager.joinCluster(onlineServers);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I will tell you one scenario, may be its too rare but still possible&lt;br/&gt;
I have 3 RS at STEP 1.&lt;br/&gt;
one of them goes down and the SSH processes and tries to assign the regions.&lt;br/&gt;
Before the assignment is done one new RS comes up before STEP 3.&lt;br/&gt;
There is a small chance that the regions from dead RS are assigned to this new RS.  Now in step 3 as we have already got the online servers list we may end up in thinking the new RS as an offline server after scanning META.  Pls do correct me.  Its a corner case.&lt;/p&gt;</comment>
                            <comment id="13283130" author="zjushch" created="Fri, 25 May 2012 05:05:23 +0000"  >&lt;p&gt;@ram&lt;br/&gt;
The above you mentioned is a good case.&lt;/p&gt;

&lt;p&gt;However, I find the current master logic when startup is more and more complicated. &lt;br/&gt;
What about do the following in the process of SSH:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isCarryingRoot()){}
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isCarryingMeta()) {}
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isCarryingRoot() || isCarryingMeta()) {}
&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; waitedTimeForMasterInitialized = 0;
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!server.isStopped() &amp;amp;&amp;amp; !services.isInitialized()) {
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (waitedTimeForMasterInitialized == 0) {
          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Master is not initialized, waiting...&quot;&lt;/span&gt;);
        }
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(100);
        waitedTimeForMasterInitialized += 100;
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Interrupted&quot;&lt;/span&gt;, e);
      }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (waitedTimeForMasterInitialized &amp;gt; 0) {
      LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Recovery time calculation: waiting on master to be initialized took &quot;&lt;/span&gt;
          + waitedTimeForMasterInitialized + &lt;span class=&quot;code-quote&quot;&gt;&quot;ms&quot;&lt;/span&gt;);
    }

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think we could make SSH wait until master initialized after it assigned META region, thus we could skip considering many troublesome concurrent case .&lt;/p&gt;</comment>
                            <comment id="13283221" author="zhihyu@ebaysf.com" created="Fri, 25 May 2012 08:58:20 +0000"  >&lt;p&gt;@Chunhui:&lt;br/&gt;
Your suggestion is interesting. &lt;br/&gt;
We should implement that in a separate issue. &lt;/p&gt;</comment>
                            <comment id="13283241" author="zjushch" created="Fri, 25 May 2012 09:30:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;We should implement that in a separate issue. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think the above suggestion would fix this issue. &lt;/p&gt;

&lt;p&gt;@ram&lt;br/&gt;
Could you give some comments, correct me if anything I didn&apos;t consider.&lt;/p&gt;</comment>
                            <comment id="13283349" author="ram_krish" created="Fri, 25 May 2012 12:46:32 +0000"  >&lt;p&gt;@Chunhui&lt;br/&gt;
I like your idea too.  As i said we are planning to raise an improvement activity for master restart and SSH.&lt;br/&gt;
Because even with the above approach i will tell one more scenario which is problematic.  Pls note that the scenario can come even without your suggestion also.&lt;/p&gt;

&lt;p&gt;Two region servers are there.  Both went down when the flow is in AM.joinCluster(). Now as no RS is there at that time we will not make any assignment. And all will go into RIT mode waiting for timeout monitor. Now SSH is also waiting as the master initialization is not complete(this step is as per your suggestion).  Now suppose there are 100 regions all are waiting for getting assigned.&lt;br/&gt;
Now if a new RS comes up as there is a code in TimeoutMonitor&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (regionState.getStamp() + timeout &amp;lt;= now) {
           &lt;span class=&quot;code-comment&quot;&gt;//decide on action upon timeout
&lt;/span&gt;            actOnTimeOut(regionState);
          } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.allRegionServersOffline &amp;amp;&amp;amp; !allRSsOffline) {
            &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; some RSs just came back online, we can start the
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// the assignment right away
&lt;/span&gt;            actOnTimeOut(regionState);
          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It will immediately trigger assignment.  At the same time as master initialization has already been done and so we are able to carry on assignment with SSH also.  This will lead to double assignment.  Actually in defect HBASe-5816 Stack was suggesting to have one common queue where any assignment will be done so that SSH will not interfere with that or viceversa.  &lt;br/&gt;
I suggest we can get in the patch that addresses the current JIRa problem and work on a diff JIRA that will help me to address the master restart and SSH area which is troublesome.&lt;/p&gt;</comment>
                            <comment id="13283605" author="zjushch" created="Fri, 25 May 2012 17:12:55 +0000"  >&lt;p&gt;@ram&lt;br/&gt;
Thanks to write much for the case.&lt;br/&gt;
However, I don&apos;t think the above case will happen. Correct me if wrong.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;At the same time as master initialization has already been done and so we are able to carry on assignment with SSH also. This will lead to double assignment&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Why it will lead to double assignment? When we reassign regions in the process of SSH, we would skip regions as the folowing:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (processDeadRegion(e.getKey(), e.getValue(),
              &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getAssignmentManager(),
              &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.getCatalogTracker())) {
            ServerName addressFromAM = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getAssignmentManager()
                .getRegionServerOfRegion(e.getKey());
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rit != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !rit.isClosing() &amp;amp;&amp;amp; !rit.isPendingClose()) {
              &lt;span class=&quot;code-comment&quot;&gt;// Skip regions that were in transition unless CLOSING or
&lt;/span&gt;              &lt;span class=&quot;code-comment&quot;&gt;// PENDING_CLOSE
&lt;/span&gt;              LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Skip assigning region &quot;&lt;/span&gt; + rit.toString());
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (addressFromAM != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                &amp;amp;&amp;amp; !addressFromAM.equals(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.serverName)) {
              LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Skip assigning region &quot;&lt;/span&gt;
                    + e.getKey().getRegionNameAsString()
                    + &lt;span class=&quot;code-quote&quot;&gt;&quot; because it has been opened in &quot;&lt;/span&gt;
                    + addressFromAM.getServerName());
              } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
                toAssignRegions.add(e.getKey());
              }
          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In RIT?(not closing&amp;amp;&amp;amp;not pendingClose, it won&apos;t be these two state in the above case ) -&amp;gt; skip&lt;br/&gt;
Has onlined on other server-&amp;gt; skip&lt;/p&gt;

&lt;p&gt;At last, I think &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5916&quot; title=&quot;RS restart just before master intialization we make the cluster non operative&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5916&quot;&gt;&lt;del&gt;HBASE-5916&lt;/del&gt;&lt;/a&gt;_trunk_v7.patch is fine, and aggree we check in the patch for the current JIRA.&lt;br/&gt;
Thanks help for my doubt.&lt;/p&gt;</comment>
                            <comment id="13283612" author="ram_krish" created="Fri, 25 May 2012 17:25:59 +0000"  >&lt;p&gt;@Chunhui&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (addressFromAM != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                &amp;amp;&amp;amp; !addressFromAM.equals(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.serverName)) {
              LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Skip assigning region &quot;&lt;/span&gt;
                    + e.getKey().getRegionNameAsString()
                    + &lt;span class=&quot;code-quote&quot;&gt;&quot; because it has been opened in &quot;&lt;/span&gt;
                    + addressFromAM.getServerName());
              }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Just to clarify this, the assignment will not happen if the address mismatches but what if for few regions which are yet to be assigned the RIT is still not updated.  Chunhui, as you said all the cases discussed here are very corner case.  Also i really appreciate your help on this making us find out more cases.  Thank you very much.&lt;br/&gt;
Let me wait for Stack&apos;s comments also.&lt;/p&gt;</comment>
                            <comment id="13283617" author="zjushch" created="Fri, 25 May 2012 17:33:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;but what if for few regions which are yet to be assigned the RIT is still not updated&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;when master startup before initialized, the region will be in the RIT through AssignmentManager#processRegionsInTransition for the above case.&lt;/p&gt;</comment>
                            <comment id="13283621" author="ram_krish" created="Fri, 25 May 2012 17:41:02 +0000"  >&lt;p&gt;I meant RIT is with the original server name only and not yet updated with the new RS. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Good on you Chunhui.&lt;/p&gt;</comment>
                            <comment id="13284007" author="rajesh23" created="Sat, 26 May 2012 16:04:10 +0000"  >&lt;p&gt;Re-based patch as for latest trunk&lt;/p&gt;</comment>
                            <comment id="13284028" author="ram_krish" created="Sat, 26 May 2012 17:56:34 +0000"  >&lt;p&gt;Pls provide your comments/suggestions on this.&lt;br/&gt;
I will commit this patch tomorrow if there is no objection.&lt;/p&gt;</comment>
                            <comment id="13284165" author="rajesh23" created="Sun, 27 May 2012 14:45:17 +0000"  >&lt;p&gt;Patch for 94&lt;/p&gt;</comment>
                            <comment id="13284167" author="hadoopqa" created="Sun, 27 May 2012 14:52:33 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12529892/HBASE-5916_94.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12529892/HBASE-5916_94.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2014//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2014//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13284180" author="ram_krish" created="Sun, 27 May 2012 16:40:59 +0000"  >&lt;p&gt;Reattaching for hadoop QA.&lt;/p&gt;</comment>
                            <comment id="13284485" author="ram_krish" created="Mon, 28 May 2012 17:18:06 +0000"  >&lt;p&gt;Committed to trunk and 0.94.&lt;br/&gt;
Thanks for the review Chunhui, Ted and Stack.&lt;br/&gt;
Thanks to Rajesh for his patches also.&lt;/p&gt;</comment>
                            <comment id="13284512" author="hudson" created="Mon, 28 May 2012 18:47:55 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2940 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2940/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2940/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5916&quot; title=&quot;RS restart just before master intialization we make the cluster non operative&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5916&quot;&gt;&lt;del&gt;HBASE-5916&lt;/del&gt;&lt;/a&gt; RS restart just before master intialization we make the cluster non operative (Rajesh) (Revision 1343324)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13284517" author="hudson" created="Mon, 28 May 2012 19:00:48 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #222 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/222/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/222/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5916&quot; title=&quot;RS restart just before master intialization we make the cluster non operative&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5916&quot;&gt;&lt;del&gt;HBASE-5916&lt;/del&gt;&lt;/a&gt; RS restart just before master intialization we make the cluster non operative(RajeshBabu) (Revision 1343326)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13284585" author="hudson" created="Tue, 29 May 2012 00:00:53 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #30 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/30/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/30/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5916&quot; title=&quot;RS restart just before master intialization we make the cluster non operative&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5916&quot;&gt;&lt;del&gt;HBASE-5916&lt;/del&gt;&lt;/a&gt; RS restart just before master intialization we make the cluster non operative (Rajesh) (Revision 1343324)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13284661" author="rajesh23" created="Tue, 29 May 2012 08:29:54 +0000"  >&lt;p&gt;Patch for 92.&lt;/p&gt;</comment>
                            <comment id="13284662" author="hadoopqa" created="Tue, 29 May 2012 08:34:49 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12530015/HBASE-5916_92.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12530015/HBASE-5916_92.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2028//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2028//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13284919" author="ram_krish" created="Tue, 29 May 2012 16:35:50 +0000"  >&lt;p&gt;Committed to 0.92 also.&lt;br/&gt;
Hence resolving it.&lt;/p&gt;</comment>
                            <comment id="13285035" author="hudson" created="Tue, 29 May 2012 19:24:01 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #425 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/425/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/425/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5916&quot; title=&quot;RS restart just before master intialization we make the cluster non operative&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5916&quot;&gt;&lt;del&gt;HBASE-5916&lt;/del&gt;&lt;/a&gt; RS restart just before master intialization we make the cluster non operative (Rajesh) (Revision 1343824)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13287189" author="hudson" created="Fri, 1 Jun 2012 05:42:56 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #33 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/33/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/33/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5916&quot; title=&quot;RS restart just before master intialization we make the cluster non operative&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5916&quot;&gt;&lt;del&gt;HBASE-5916&lt;/del&gt;&lt;/a&gt; RS restart just before master intialization we make the cluster non operative(RajeshBabu) (Revision 1343326)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13287250" author="hudson" created="Fri, 1 Jun 2012 08:08:19 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #109 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/109/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/109/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5916&quot; title=&quot;RS restart just before master intialization we make the cluster non operative&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5916&quot;&gt;&lt;del&gt;HBASE-5916&lt;/del&gt;&lt;/a&gt; RS restart just before master intialization we make the cluster non operative (Rajesh) (Revision 1343824)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/MasterFileSystem.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestRSKilledWhenMasterInitializing.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12593995">HBASE-6227</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12530015" name="HBASE-5916_92.patch" size="10805" author="rajesh23" created="Tue, 29 May 2012 08:28:35 +0000"/>
                            <attachment id="12529892" name="HBASE-5916_94.patch" size="10086" author="rajesh23" created="Sun, 27 May 2012 14:45:17 +0000"/>
                            <attachment id="12525639" name="HBASE-5916_trunk.patch" size="10334" author="ram_krish" created="Fri, 4 May 2012 15:51:55 +0000"/>
                            <attachment id="12525729" name="HBASE-5916_trunk_1.patch" size="11692" author="ram_krish" created="Sat, 5 May 2012 14:14:05 +0000"/>
                            <attachment id="12525668" name="HBASE-5916_trunk_1.patch" size="11692" author="ram_krish" created="Fri, 4 May 2012 19:31:09 +0000"/>
                            <attachment id="12525870" name="HBASE-5916_trunk_2.patch" size="11692" author="ram_krish" created="Mon, 7 May 2012 16:27:05 +0000"/>
                            <attachment id="12525878" name="HBASE-5916_trunk_3.patch" size="11976" author="ram_krish" created="Mon, 7 May 2012 17:25:57 +0000"/>
                            <attachment id="12526389" name="HBASE-5916_trunk_4.patch" size="6852" author="ram_krish" created="Thu, 10 May 2012 18:17:06 +0000"/>
                            <attachment id="12527821" name="HBASE-5916_trunk_v5.patch" size="8442" author="rajesh23" created="Thu, 17 May 2012 10:28:46 +0000"/>
                            <attachment id="12529160" name="HBASE-5916_trunk_v6.patch" size="10158" author="rajesh23" created="Thu, 24 May 2012 15:54:11 +0000"/>
                            <attachment id="12529560" name="HBASE-5916_trunk_v7.patch" size="10153" author="rajesh23" created="Fri, 25 May 2012 02:08:24 +0000"/>
                            <attachment id="12529872" name="HBASE-5916_trunk_v8.patch" size="10348" author="rajesh23" created="Sat, 26 May 2012 15:59:58 +0000"/>
                            <attachment id="12529894" name="HBASE-5916_trunk_v9.patch" size="10348" author="ram_krish" created="Sun, 27 May 2012 16:40:59 +0000"/>
                            <attachment id="12529660" name="HBASE-5916v8.patch" size="5446" author="zjushch" created="Fri, 25 May 2012 03:22:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 May 2012 05:24:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>237783</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 29 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i068m7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34327</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>