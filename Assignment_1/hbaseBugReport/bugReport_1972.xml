<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:57:53 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1972/HBASE-1972.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1972] Failed split results in closed region and non-registration of daughters; fix the order in which things are run</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1972</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;As part of a split, we go to close the region.  The close fails because flush failed &amp;#8211; a DN was down and HDFS refuses to move past it &amp;#8211; so we jump up out of the close with an IOE.  But the region has been closed yet its still in the .META. as online.&lt;/p&gt;

&lt;p&gt;Here is where the hole is:&lt;/p&gt;

&lt;p&gt;1. CompactSplitThread calls split.&lt;br/&gt;
2. This calls HRegion splitRegion.&lt;br/&gt;
3. splitRegion calls close(false).&lt;br/&gt;
4. Down the end of the close, we get as far as the LOG.info(&quot;Closed &quot; + this)..... but a DFSClient running thread throws an exception because it can&apos;t allocate block for the flush made as part of the close (Ain&apos;t sure how... we should add more try/catch in here):&lt;/p&gt;


&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-11-12 00:47:17,865 [regionserver/208.76.44.142:60020.compactor] DEBUG org.apache.hadoop.hbase.regionserver.Store: Added hdfs:&lt;span class=&quot;code-comment&quot;&gt;//aa0-000-12.u.powerset.com:9002/hbase/TestTable/868626151/info/5071349140567656566, entries=46975, sequenceid=2350017, memsize=52.0m, filesize=46.5m to TestTable,,1257986664542
&lt;/span&gt;2009-11-12 00:47:17,866 [regionserver/208.76.44.142:60020.compactor] DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Finished memstore flush of ~52.0m &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region TestTable,,1257986664542 in 7985ms, sequence id=2350017, compaction requested=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2009-11-12 00:47:17,866 [regionserver/208.76.44.142:60020.compactor] DEBUG org.apache.hadoop.hbase.regionserver.Store: closed info
2009-11-12 00:47:17,866 [regionserver/208.76.44.142:60020.compactor] INFO org.apache.hadoop.hbase.regionserver.HRegion: Closed TestTable,,1257986664542
2009-11-12 00:47:17,906 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-315] INFO org.apache.hadoop.hdfs.DFSClient: Exception in createBlockOutputStream java.io.IOException: Bad connect ack with firstBadLink as 208.76.44.140:51010
2009-11-12 00:47:17,906 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-315] INFO org.apache.hadoop.hdfs.DFSClient: Abandoning block blk_1351692500502810095_1391
2009-11-12 00:47:23,918 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-315] INFO org.apache.hadoop.hdfs.DFSClient: Exception in createBlockOutputStream java.io.IOException: Bad connect ack with firstBadLink as 208.76.44.140:51010
2009-11-12 00:47:23,918 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-315] INFO org.apache.hadoop.hdfs.DFSClient: Abandoning block blk_-3310646336307339512_1391
2009-11-12 00:47:29,982 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-318] INFO org.apache.hadoop.hdfs.DFSClient: Exception in createBlockOutputStream java.io.IOException: Bad connect ack with firstBadLink as 208.76.44.140:51010
2009-11-12 00:47:29,982 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-318] INFO org.apache.hadoop.hdfs.DFSClient: Abandoning block blk_3070440586900692765_1393
2009-11-12 00:47:35,997 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-318] INFO org.apache.hadoop.hdfs.DFSClient: Exception in createBlockOutputStream java.io.IOException: Bad connect ack with firstBadLink as 208.76.44.140:51010
2009-11-12 00:47:35,997 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-318] INFO org.apache.hadoop.hdfs.DFSClient: Abandoning block blk_-5656011219762164043_1393
2009-11-12 00:47:42,007 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-318] INFO org.apache.hadoop.hdfs.DFSClient: Exception in createBlockOutputStream java.io.IOException: Bad connect ack with firstBadLink as 208.76.44.140:51010
2009-11-12 00:47:42,007 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-318] INFO org.apache.hadoop.hdfs.DFSClient: Abandoning block blk_-2359634393837722978_1393
2009-11-12 00:47:48,017 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-318] INFO org.apache.hadoop.hdfs.DFSClient: Exception in createBlockOutputStream java.io.IOException: Bad connect ack with firstBadLink as 208.76.44.140:51010
2009-11-12 00:47:48,017 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-318] INFO org.apache.hadoop.hdfs.DFSClient: Abandoning block blk_-1626727145091780831_1393
2009-11-12 00:47:54,022 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-318] WARN org.apache.hadoop.hdfs.DFSClient: DataStreamer Exception: java.io.IOException: Unable to create &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; block.
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$DataStreamer.nextBlockOutputStream(DFSClient.java:3100)
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:2681)

2009-11-12 00:47:54,022 [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-318] WARN org.apache.hadoop.hdfs.DFSClient: Could not get block locations. Source file &lt;span class=&quot;code-quote&quot;&gt;&quot;/hbase/TestTable/868626151/splits/1211221550/info/5071349140567656566.868626151&quot;&lt;/span&gt; - Aborting...
2009-11-12 00:47:54,029 [regionserver/208.76.44.142:60020.compactor] ERROR org.apache.hadoop.hbase.regionserver.CompactSplitThread: Compaction/Split failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region TestTable,,1257986664542
java.io.IOException: Bad connect ack with firstBadLink as 208.76.44.140:51010
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$DataStreamer.createBlockOutputStream(DFSClient.java:3160)
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$DataStreamer.nextBlockOutputStream(DFSClient.java:3080)
        at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:2681)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Marking this as blocker.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12440468">HBASE-1972</key>
            <summary>Failed split results in closed region and non-registration of daughters; fix the order in which things are run</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Nov 2009 01:37:02 +0000</created>
                <updated>Fri, 20 Nov 2015 13:01:41 +0000</updated>
                            <resolved>Sat, 12 Dec 2009 20:38:31 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12789729" author="clehene" created="Sat, 12 Dec 2009 12:31:28 +0000"  >&lt;p&gt;@Stack, this looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-630&quot; title=&quot;In DFSOutputStream.nextBlockOutputStream(), the client can exclude specific datanodes when locating the next block.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-630&quot;&gt;&lt;del&gt;HDFS-630&lt;/del&gt;&lt;/a&gt;. What version of HDFS were you running? I&apos;d like to reproduce it. However, even if this would work after &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-630&quot; title=&quot;In DFSOutputStream.nextBlockOutputStream(), the client can exclude specific datanodes when locating the next block.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-630&quot;&gt;&lt;del&gt;HDFS-630&lt;/del&gt;&lt;/a&gt;, it seems we need to fix the HBase logic around this as well.&lt;/p&gt;</comment>
                            <comment id="12789732" author="clehene" created="Sat, 12 Dec 2009 12:41:50 +0000"  >&lt;p&gt;Looking in DFSClient &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;DFSClient.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
3079          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!success) {
3080            LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Abandoning block &quot;&lt;/span&gt; + block);
3081            namenode.abandonBlock(block, src, clientName);
3082            block = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
3083
3084            LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Excluding datanode &quot;&lt;/span&gt; + nodes[errorIndex]);
3085            excludedNodes.add(nodes[errorIndex]);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Following 3080 line that logs &quot;Abandoning block...&quot;  a few lines later it will exclude the datanode and log that. So it looks like &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-630&quot; title=&quot;In DFSOutputStream.nextBlockOutputStream(), the client can exclude specific datanodes when locating the next block.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-630&quot;&gt;&lt;del&gt;HDFS-630&lt;/del&gt;&lt;/a&gt; is the culprit here. &lt;/p&gt;

&lt;p&gt;We should try to see if it&apos;s possible to include the patch in HDFS 0.21, else we&apos;ll get more people bumping into this. &lt;/p&gt;</comment>
                            <comment id="12789782" author="stack" created="Sat, 12 Dec 2009 20:38:31 +0000"  >&lt;p&gt;Marking as invalid addressed by hdfs-630. Thanks for looking at this cosmin.  Want to open an issue on getting 630 into 0.21.   There will be pushback I&apos;d imagine since not &quot;critical&quot; but might make 0.21.1&lt;/p&gt;</comment>
                            <comment id="12789785" author="stack" created="Sat, 12 Dec 2009 20:50:45 +0000"  >&lt;p&gt;Or maybe we can just move current hdfs630 to 0.21.1. Let&apos;s chat in email what to do. &lt;/p&gt;</comment>
                            <comment id="15017869" author="lars_francke" created="Fri, 20 Nov 2015 13:01:41 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 12 Dec 2009 12:31:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26087</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hg1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99861</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>