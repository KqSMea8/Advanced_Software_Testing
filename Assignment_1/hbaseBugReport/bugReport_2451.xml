<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:02:01 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2451/HBASE-2451.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2451] .META. by-passes cache; BLOCKCACHE=&gt;&apos;false&apos;</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2451</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In a new install, if I describe &apos;.META.&apos;, it says:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
DESCRIPTION                                                             ENABLED                               
 {NAME =&amp;gt; &apos;.META.&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, MEMSTORE_FLUSHSIZE =&amp;gt; &apos;16384&apos;, F &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;                                  
 AMILIES =&amp;gt; [{NAME =&amp;gt; &apos;historian&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;                                       
 2147483647&apos;, TTL =&amp;gt; &apos;604800&apos;, BLOCKSIZE =&amp;gt; &apos;8192&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;                                       
 &apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}, {NAME =&amp;gt; &apos;info&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VER                                       
 SIONS =&amp;gt; &apos;10&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;8192&apos;, IN_MEMORY =&amp;gt;                                        
 &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}]} 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;BLOCKCACHE is &apos;true&apos; for the &apos;info&apos; family (Yes historian is still in 0.20 branch).&lt;/p&gt;

&lt;p&gt;But, if I add logging to hfile and storefile and store, blockcache is &apos;false&apos; &amp;#8211; there is no cache constructed for use by the hfile.&lt;/p&gt;

&lt;p&gt;This is killing cluster performance.  &lt;/p&gt;

&lt;p&gt;It looks like a problem parsing the &apos;true&apos; value in columnfamily.  I&apos;ll put up a patch in the morning.  Meantime, marking as blocker on 0.20.4.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12462101">HBASE-2451</key>
            <summary>.META. by-passes cache; BLOCKCACHE=&gt;&apos;false&apos;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 15 Apr 2010 04:49:47 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:06 +0000</updated>
                            <resolved>Thu, 15 Apr 2010 23:45:03 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12857442" author="stack" created="Thu, 15 Apr 2010 17:57:24 +0000"  >&lt;p&gt;I&apos;m currently trying to figure why this is the case:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):001:0&amp;gt; scan &apos;-ROOT-&apos;
2010-04-15T10:54:17.901-0700: 8.334: [GC 8.334: [ParNew: 19136K-&amp;gt;2112K(19136K), 0.0270080 secs] 24761K-&amp;gt;10598K(83008K), 0.0270680 secs] [Times: user=0.13 sys=0.04, real=0.03 secs] 
ROW                          COLUMN+CELL                                                                      
 .META.,,1                   column=info:regioninfo, timestamp=1271352114030, value=REGION =&amp;gt; {NAME =&amp;gt; &apos;.META.
                             ,,1&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 1028785192, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;.M
                             ETA.&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, MEMSTORE_FLUSHSIZE =&amp;gt; &apos;16384&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;h
                             istorian&apos;, VERSIONS =&amp;gt; &apos;2147483647&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, TTL =&amp;gt; &apos;604800&apos;, BLOC
                             KSIZE =&amp;gt; &apos;8192&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}, {NAME =&amp;gt; &apos;info&apos;, V
                             ERSIONS =&amp;gt; &apos;10&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;8192&apos;,
                              IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}]}}                                 
 .META.,,1                   column=info:server, timestamp=1271352175741, value=10.20.20.189:60020            
 .META.,,1                   column=info:serverstartcode, timestamp=1271352175741, value=1271352174642        
1 row(s) in 0.0930 seconds
hbase(main):002:0&amp;gt; describe &apos;.META.&apos;
DESCRIPTION                                                             ENABLED                               
 {NAME =&amp;gt; &apos;.META.&apos;, IS_META =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;, MEMSTORE_FLUSHSIZE =&amp;gt; &apos;16384&apos;, F &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;                                  
 AMILIES =&amp;gt; [{NAME =&amp;gt; &apos;historian&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;                                       
 2147483647&apos;, TTL =&amp;gt; &apos;604800&apos;, BLOCKSIZE =&amp;gt; &apos;8192&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;                                       
 &apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}, {NAME =&amp;gt; &apos;info&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VER                                       
 SIONS =&amp;gt; &apos;10&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;8192&apos;, IN_MEMORY =&amp;gt;                                        
 &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;&apos;}]}    
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;i.e. if you scan &lt;del&gt;ROOT&lt;/del&gt;, it has BLOCKCACHE false for the .META. region but if I describe it, then its &apos;true&apos;.&lt;/p&gt;</comment>
                            <comment id="12857445" author="stack" created="Thu, 15 Apr 2010 18:01:49 +0000"  >&lt;p&gt;Problem is in our bootstrapping code:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void bootstrap() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;BOOTSTRAP: creating ROOT and first META regions&quot;&lt;/span&gt;);
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-comment&quot;&gt;// Bootstrapping, make sure blockcache is off.  Else, one will be
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// created here in bootstap and it&apos;ll need to be cleaned up.  Better to
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// not make it in first place.  Turn off block caching &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; bootstrap.
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// Enable after.
&lt;/span&gt;      setBlockCaching(HRegionInfo.ROOT_REGIONINFO, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
      setBlockCaching(HRegionInfo.FIRST_META_REGIONINFO, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);
      HRegion root = HRegion.createHRegion(HRegionInfo.ROOT_REGIONINFO,
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootdir, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf);
      HRegion meta = HRegion.createHRegion(HRegionInfo.FIRST_META_REGIONINFO,
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.rootdir, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf);
      &lt;span class=&quot;code-comment&quot;&gt;// Add first region from the META table to the ROOT region.
&lt;/span&gt;      HRegion.addRegionToMETA(root, meta);
      root.close();
      root.getLog().closeAndDelete();
      meta.close();
      meta.getLog().closeAndDelete();
      setBlockCaching(HRegionInfo.ROOT_REGIONINFO, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
      setBlockCaching(HRegionInfo.FIRST_META_REGIONINFO, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
      e = RemoteExceptionHandler.checkIOException(e);
      LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;bootstrap&quot;&lt;/span&gt;, e);
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; e;
    }
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Master has a descriptor where the blockcache is on but the regionserver hosting the .META. reads what was persisted.&lt;/p&gt;</comment>
                            <comment id="12857480" author="jdcryans" created="Thu, 15 Apr 2010 18:44:48 +0000"  >&lt;p&gt;This really explains a lot.&lt;/p&gt;</comment>
                            <comment id="12857503" author="stack" created="Thu, 15 Apr 2010 19:29:16 +0000"  >&lt;p&gt;Testing this patch  now.  I see LruCache actually doing something now on the HRS carrying .META.  Will let it run a while.&lt;/p&gt;</comment>
                            <comment id="12857504" author="stack" created="Thu, 15 Apr 2010 19:30:44 +0000"  >&lt;p&gt;I need to write a script to fix this for instances that are currently in place.&lt;/p&gt;</comment>
                            <comment id="12857591" author="stack" created="Thu, 15 Apr 2010 23:23:31 +0000"  >&lt;p&gt;Patch that enables IN_MEMORY and BLOCKCACHE on catalog tables on bootstrap.  Includes script that will fixup catalog tables when run (though subsequently requires cluster restart or redeploy of the .META. for the change to take effect).&lt;/p&gt;</comment>
                            <comment id="12857592" author="stack" created="Thu, 15 Apr 2010 23:27:07 +0000"  >&lt;p&gt;I&apos;ve been running this patch up on cluster.   Here is what I see now:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-04-15 16:23:47,892 DEBUG org.apache.hadoop.hbase.io.hfile.LruBlockCache: Cache Stats: Sizes: Total=6.0434265MB (6336992), Free=602.95654MB (632245792), Max=609.0MB (638582784), Counts: Blocks=177, Access=1022416, Hit=356196, Miss=666220, Evictions=0, Evicted=0, Ratios: Hit Ratio=34.83865559101105%, Miss Ratio=65.16134142875671%, Evicted/Run=NaN
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;First it takes a while for the ratios to build up... it start out at 100% misses.  The above is skewed some by the fact that the cache is so big relative to the amount of data that needs to caching (this is a big upload and only meta data is being cached).  Its also skewed because meta changing a lot durinng this upload.  This is better than what we had previous but looks like more work can be done in here (this table is pegged in_memory).  Will commit this after review for 0.20.4.  We can do other improvements elsewhere.&lt;/p&gt;</comment>
                            <comment id="12857594" author="ryanobjc" created="Thu, 15 Apr 2010 23:33:02 +0000"  >&lt;p&gt;+1 do it&lt;/p&gt;</comment>
                            <comment id="12857598" author="stack" created="Thu, 15 Apr 2010 23:45:03 +0000"  >&lt;p&gt;Committed to branches and trunk.  Thanks for review Ryan.&lt;/p&gt;</comment>
                            <comment id="12866889" author="stack" created="Wed, 12 May 2010 23:53:06 +0000"  >&lt;p&gt;Marking these as fixed against 0.21.0 rather than against 0.20.5.&lt;/p&gt;</comment>
                            <comment id="15017429" author="lars_francke" created="Fri, 20 Nov 2015 12:43:06 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12441865" name="ASF.LICENSE.NOT.GRANTED--meta.txt" size="1772" author="stack" created="Thu, 15 Apr 2010 19:29:16 +0000"/>
                            <attachment id="12441886" name="ASF.LICENSE.NOT.GRANTED--meta3.txt" size="7220" author="stack" created="Thu, 15 Apr 2010 23:23:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 15 Apr 2010 18:44:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26310</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hhrb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100139</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>