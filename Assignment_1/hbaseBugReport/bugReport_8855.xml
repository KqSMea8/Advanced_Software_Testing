<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:59:08 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8855/HBASE-8855.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8855] TestTableInputFormatScan1/2 fail semi-silently with the hadoop 2 profile</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8855</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;It looks like TestTableInputFormatScan1 and TestTableInputFormatScan2 never complete and surefire doesn&apos;t complain about it. Sure, you may see this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Tests run: 6, Failures: 5, Errors: 1, Skipped: 0, Time elapsed: 269.036 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!
org.apache.maven.surefire.util.SurefireReflectionException: ...
org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:74)
Caused by: java.lang.OutOfMemoryError: PermGen space
org.apache.maven.surefire.booter.SurefireBooterForkException: Error occurred in starting fork, check output in log
...
  testScanEmptyToBBA(org.apache.hadoop.hbase.mapreduce.TestTableInputFormatScan1)
  testScanEmptyToBBB(org.apache.hadoop.hbase.mapreduce.TestTableInputFormatScan1)
  testScanEmptyToOPP(org.apache.hadoop.hbase.mapreduce.TestTableInputFormatScan1)
  testScanEmptyToEmpty(org.apache.hadoop.hbase.mapreduce.TestTableInputFormatScan1)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But then:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[INFO] HBase - Server .................................... SUCCESS [10:59.929s]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is on my machine. On our local jenkins it&apos;s leaking and the processes never die. And this is only with Hadoop 2. It also looks like other tests are failing with PermGen space.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12655869">HBASE-8855</key>
            <summary>TestTableInputFormatScan1/2 fail semi-silently with the hadoop 2 profile</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Jul 2013 23:17:11 +0000</created>
                <updated>Fri, 19 Jul 2013 00:21:39 +0000</updated>
                            <resolved>Fri, 19 Jul 2013 00:21:39 +0000</resolved>
                                    <version>0.94.8</version>
                    <version>0.95.1</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13698417" author="yuzhihong@gmail.com" created="Tue, 2 Jul 2013 23:56:17 +0000"  >&lt;p&gt;With attach patch, I was able to get over PermGen space error on Mac and Linux.&lt;/p&gt;</comment>
                            <comment id="13698586" author="stack" created="Wed, 3 Jul 2013 04:28:53 +0000"  >&lt;p&gt;Patch does not fix root cause (I spent time trying to fix hadoop2 builds on ec2 build but no combo would work there and it is crazy that our code takes 1G of permgen.. something badly broke).&lt;/p&gt;</comment>
                            <comment id="13702120" author="stack" created="Mon, 8 Jul 2013 16:57:13 +0000"  >&lt;p&gt;On Apache, hadoop2 builds have actually passed on trunk and 0.95:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/view/H-L/view/HBase/job/HBase-TRUNK-on-Hadoop-2.0.0/599/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/H-L/view/HBase/job/HBase-TRUNK-on-Hadoop-2.0.0/599/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/H-L/view/HBase/job/HBase-TRUNK-on-Hadoop-2.0.0/595/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/H-L/view/HBase/job/HBase-TRUNK-on-Hadoop-2.0.0/595/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/H-L/view/HBase/job/hbase-0.95-on-hadoop2/168/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/H-L/view/HBase/job/hbase-0.95-on-hadoop2/168/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/H-L/view/HBase/job/hbase-0.95-on-hadoop2/166/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/H-L/view/HBase/job/hbase-0.95-on-hadoop2/166/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Apache does not seem to run into the issue we see here.&lt;/p&gt;

&lt;p&gt;Buids have never passed on ec2 build though but look here from this morning:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://54.241.6.143/job/HBase-0.95-Hadoop-2/581/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://54.241.6.143/job/HBase-0.95-Hadoop-2/581/&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://54.241.6.143/job/HBase-0.95-Hadoop-2/580/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://54.241.6.143/job/HBase-0.95-Hadoop-2/580/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We failed in integration tests which means we got through all the unit tests.  I&apos;m not sure that has happened in the past (We don&apos;t do integration tests up on apache build box).  So, we almost succeed (Failing integration tests are another issue being dealt w/ elsewhere &amp;#8211; it is retry and interval based)&lt;/p&gt;

&lt;p&gt;Here is what I what I have currently in ec2 build after messing some w/ permsizes:&lt;/p&gt;

&lt;p&gt;-Xmx4g -XX:+CMSClassUnloadingEnabled -XX:+CMSPermGenSweepingEnabled -XX:MaxPermSize=1g&lt;/p&gt;

&lt;p&gt;Apache build just has 3G heap set on MAVEN_OPTS.  Let me do same over on ec2 build and see if that helps.&lt;/p&gt;</comment>
                            <comment id="13702125" author="stack" created="Mon, 8 Jul 2013 17:03:33 +0000"  >&lt;p&gt;Let me do a version of Ted&apos;s patch where I allow  clearing of perm gen and set a higher max size on the child jvm.  See if this helps.&lt;/p&gt;</comment>
                            <comment id="13702179" author="stack" created="Mon, 8 Jul 2013 17:56:02 +0000"  >&lt;p&gt;The attached v2 patch makes these tests pass locally where they used fail.  Reading more, it is probably just safer allowing bigger permgen only rather than enabling unloading and sweep.  So, now I am back at Ted&apos;s original workaround patch (bigger permgen).&lt;/p&gt;

&lt;p&gt;Working theory is that these big tests w/ mapreduce, etc., all on new hadoop2 are causing us blow past default permgen size.  ec2 builds, the jvm args were passed to mvn on command line.  Apache build sets MAVEN_OPTS = -3g.   Perhaps the latter makes it so children inherit the 3g too.&lt;/p&gt;

&lt;p&gt;Let me play around some more.&lt;/p&gt;</comment>
                            <comment id="13702216" author="stack" created="Mon, 8 Jul 2013 18:16:49 +0000"  >&lt;p&gt;Hmm... yeah.  MAVEN_OPTS=&quot;-Xmx3g&quot; makes these tests pass locally where they fail if MAVEN_OPTS is smaller than this (which I think means they will start to pass on ec2 &amp;#8211; will see).  So, child jvms seem to be getting benefit of the MAVEN_OPTs environment setting.&lt;/p&gt;

&lt;p&gt;No harm upping the permgen then I&apos;d say so tests pass for those who don&apos;t do MAVEN_OPTs...&lt;/p&gt;
</comment>
                            <comment id="13702247" author="stack" created="Mon, 8 Jul 2013 18:31:24 +0000"  >&lt;p&gt;nvm.  Was forgetting to provide the hadoop2 profile in above so above on MAVEN_OPTs does not hold.  Providing the profile, we fail.  We fail if we up the permgen size too &amp;#8211; the patches attached to this issue (including Ted&apos;s).  So, back to square one.  I cannot explain why tests start to pass on ec2 as of this morning, have been passing on apache w/ a while and yet fail when run locally.&lt;/p&gt;
</comment>
                            <comment id="13702633" author="jdcryans" created="Mon, 8 Jul 2013 23:44:37 +0000"  >&lt;p&gt;I see a lot of PermGen space OOMEs in 581&apos;s log (same for 580):&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://54.241.6.143/job/HBase-0.95-Hadoop-2/org.apache.hbase$hbase-server/581/consoleText&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://54.241.6.143/job/HBase-0.95-Hadoop-2/org.apache.hbase$hbase-server/581/consoleText&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Also I don&apos;t see TestTableInputFormatScan1 or 2 passing. Like I was mentioning in this jira&apos;s description, surefire seems to be ignoring them, so it&apos;s green but it&apos;s not really?&lt;/p&gt;</comment>
                            <comment id="13702650" author="stack" created="Mon, 8 Jul 2013 23:55:47 +0000"  >&lt;blockquote&gt;&lt;p&gt;... surefire seems to be ignoring them, so it&apos;s green but it&apos;s not really?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Now I remember you saying this.  Yeah, that is ugly.  Weird they keep going and satisfy any test assertion (Are there any?).&lt;/p&gt;

&lt;p&gt;See above for my experiments messing w/ permgen sizing.  I could understand our blowing the relatively small default sizing on these big tests but trying to influence child jvm sizings doesn&apos;t seem to help.&lt;/p&gt;

&lt;p&gt;I can&apos;t explain why fine on apache build but not locally nor on ec2 build.  I added printing of jvm versions to both build boxes.&lt;/p&gt;</comment>
                            <comment id="13702651" author="stack" created="Mon, 8 Jul 2013 23:56:16 +0000"  >&lt;p&gt;I looked in apache surefire logs and doesn&apos;t have OOMEs in the one I looked at.&lt;/p&gt;</comment>
                            <comment id="13702657" author="jdcryans" created="Mon, 8 Jul 2013 23:59:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;I looked in apache surefire logs and doesn&apos;t have OOMEs in the one I looked at.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yeah I didn&apos;t see any either and the test results show TestTableInputFormatScan1/2.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Weird they keep going and satisfy any test assertion (Are there any?).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;They do but the thing that reports back might not be run. &lt;/p&gt;</comment>
                            <comment id="13704125" author="jdcryans" created="Wed, 10 Jul 2013 02:08:12 +0000"  >&lt;p&gt;I committed a new max perm gen on 0.95 and I can see the tests passing now: &lt;a href=&quot;http://54.241.6.143/job/HBase-0.95-Hadoop-2/594/org.apache.hbase$hbase-server/testReport/org.apache.hadoop.hbase.mapreduce/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://54.241.6.143/job/HBase-0.95-Hadoop-2/594/org.apache.hbase$hbase-server/testReport/org.apache.hadoop.hbase.mapreduce/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I don&apos;t know why it needs so much more heap for the perm gen with YARN.&lt;/p&gt;

&lt;p&gt;And on my laptop it still fails with containers exiting with status 127.&lt;/p&gt;</comment>
                            <comment id="13704169" author="hudson" created="Wed, 10 Jul 2013 04:00:04 +0000"  >&lt;p&gt;Integrated in hbase-0.95 #306 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/306/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/306/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8855&quot; title=&quot;TestTableInputFormatScan1/2 fail semi-silently with the hadoop 2 profile&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8855&quot;&gt;&lt;del&gt;HBASE-8855&lt;/del&gt;&lt;/a&gt; trying to see if EC2 will work with a perm gen of 100m (Revision 1501612)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/pom.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13704480" author="hudson" created="Wed, 10 Jul 2013 12:02:20 +0000"  >&lt;p&gt;Integrated in hbase-0.95-on-hadoop2 #173 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95-on-hadoop2/173/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95-on-hadoop2/173/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8855&quot; title=&quot;TestTableInputFormatScan1/2 fail semi-silently with the hadoop 2 profile&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8855&quot;&gt;&lt;del&gt;HBASE-8855&lt;/del&gt;&lt;/a&gt; trying to see if EC2 will work with a perm gen of 100m (Revision 1501612)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/pom.xml&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13713155" author="jdcryans" created="Fri, 19 Jul 2013 00:21:39 +0000"  >&lt;p&gt;I committed the patch to trunk too, as I&apos;m not the issues on 0.95 anymore but I&apos;m still seeing them on trunk.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12590544" name="8855.patch" size="1297" author="yuzhihong@gmail.com" created="Tue, 2 Jul 2013 23:56:17 +0000"/>
                            <attachment id="12591228" name="8855v2.txt" size="1410" author="stack" created="Mon, 8 Jul 2013 17:03:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 2 Jul 2013 23:56:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336144</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 22 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lzdb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336468</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Unit tests are now running with a 100MB PermGen</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>