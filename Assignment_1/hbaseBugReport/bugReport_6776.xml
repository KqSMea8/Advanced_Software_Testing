<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:39:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6776/HBASE-6776.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6776] Opened region of disabled table is not added to online region list</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6776</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;For opened region of disabled table, it should be added to online region list, and then closed.  We should not just ignore them.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12607523">HBASE-6776</key>
            <summary>Opened region of disabled table is not added to online region list</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="jxiang">Jimmy Xiang</assignee>
                                    <reporter username="jxiang">Jimmy Xiang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 13 Sep 2012 21:36:54 +0000</created>
                <updated>Sat, 26 Jan 2013 03:28:22 +0000</updated>
                            <resolved>Sat, 15 Sep 2012 20:28:26 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13455352" author="jxiang" created="Thu, 13 Sep 2012 22:02:21 +0000"  >&lt;p&gt;TestMaster* and TestAssign* are green.&lt;/p&gt;

&lt;p&gt;For disabled tables, if there are regions still open, changed it to disabling state so that disable handler can disable it again.&lt;/p&gt;</comment>
                            <comment id="13455451" author="stack" created="Thu, 13 Sep 2012 23:44:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;For opened region of disabled table, it should be added to online region list, and then closed. We should not just ignore them.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So, I see you add all to online regions in your patch.  If we do this inside in the rebuild of user regions, where do we do the close you suggest above?&lt;/p&gt;

&lt;p&gt;I see you do this: getZKTable().setDisablingTable(tableName);&lt;/p&gt;

&lt;p&gt;What is going on here?  The table was Disabled but you are setting the set back to Disabling because you came across a region that is still open?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;For opened region of enabling table, it should be added to online region list, so that we don&apos;t have to assign it again. Without adding it to online region list, it could be double assigned when assign it again later.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This seems right.&lt;/p&gt;</comment>
                            <comment id="13455464" author="hadoopqa" created="Thu, 13 Sep 2012 23:56:04 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12545063/trunk-6776.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12545063/trunk-6776.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The patch appears to cause mvn compile goal to fail.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to cause Findbugs (version 1.3.9) to fail.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2861//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2861//testReport/&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2861//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2861//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13455483" author="jxiang" created="Fri, 14 Sep 2012 00:23:10 +0000"  >&lt;p&gt;Right, the table is Disabled.  Somehow, there is still a region opened somewhere.&lt;/p&gt;</comment>
                            <comment id="13455690" author="ram_krish" created="Fri, 14 Sep 2012 09:43:22 +0000"  >&lt;p&gt;-&amp;gt; Adding all regions to online map?&lt;br/&gt;
How does enabletablehandler work then? &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
List&amp;lt;HRegionInfo&amp;gt; regionsInMeta;
    regionsInMeta = MetaReader.getTableRegions(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.ct, tableName, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; countOfRegionsInTable = regionsInMeta.size();
    List&amp;lt;HRegionInfo&amp;gt; regions = regionsToAssign(regionsInMeta);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This piece of code will not allow the assignment to happen right ?&lt;br/&gt;
-&amp;gt; Changing from DISABLED to DISABLING&lt;br/&gt;
In what condition this will happen? Because state is in DISABLED for sure we can know that the disabling is completed fully? &lt;/p&gt;



</comment>
                            <comment id="13455915" author="jxiang" created="Fri, 14 Sep 2012 16:29:38 +0000"  >&lt;p&gt;regionsToAssign will remove those already online regions from the regionsInMeta, then assign the rest of regions.  That&apos;s what we want.&lt;/p&gt;

&lt;p&gt;This could happen during unit test for sure, some man-made corruptions.  Another scenario could be because of racing between disabling&lt;br/&gt;
a table, and assigning the table without going through ZK.&lt;/p&gt;</comment>
                            <comment id="13455965" author="ram_krish" created="Fri, 14 Sep 2012 17:26:36 +0000"  >&lt;p&gt;@Jimmy&lt;br/&gt;
If i read the patch correctly we just add all the regions into the regiononline map.&lt;br/&gt;
Now if i have 4 regions for a table.&lt;br/&gt;
1 is assigned, 2 in the process of assigning and 1 is yet to be assigned so the table is in ENABLING.  Now if all the regions are added to online map then how will EnableTableHandler know that he has to assign the ones that are not assigned?&lt;br/&gt;
Actually HBASe-6317 tries to solve the problem that you mentioned - double assignment.&lt;br/&gt;
Pls correct me if am wrong Jimmy. May be am missing something in trunk after the refactorings?&lt;/p&gt;
</comment>
                            <comment id="13455973" author="jxiang" created="Fri, 14 Sep 2012 17:40:06 +0000"  >&lt;p&gt;That&apos;s a good question.  In rebuilding the user regions, only these regions are added to online region map: 1. there is a server info in Meta for the region, and 2. the server is online.&lt;/p&gt;

&lt;p&gt;Here is the assumption:&lt;/p&gt;

&lt;p&gt;For the regions not assigned yet or still in assigning, the meta entry should not have the server info (assume no region in transition znodes, if there is,&lt;br/&gt;
process region in transition will correct the assigning region&apos;s state).&lt;/p&gt;

&lt;p&gt;For tables not in ENABLING, this is our assumption too. So the question is whether the assumption correct, right?  I think it is correct.&lt;/p&gt;

</comment>
                            <comment id="13456379" author="rajesh23" created="Sat, 15 Sep 2012 12:07:27 +0000"  >&lt;p&gt;@Jimmy&lt;br/&gt;
If the scenario told by Ram happened after disable, with this patch assignment wont happen for the regions yet to be assigned because .META. has server info(server where the regions opened before disable) for the regions&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Now if i have 4 regions for a table. 1 is assigned, 2 in the process of assigning and 1 is yet to be assigned so the table is in ENABLING(Lets suppose master restarted now). Now if all the regions are added to online map then how will EnableTableHandler know that he has to assign the ones that are not assigned?&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="13456429" author="jxiang" created="Sat, 15 Sep 2012 15:28:25 +0000"  >&lt;p&gt;That&apos;s right.  Good point.  I will update the patch.&lt;/p&gt;</comment>
                            <comment id="13456463" author="jxiang" created="Sat, 15 Sep 2012 18:34:26 +0000"  >&lt;p&gt;New patch (v2) handles disabled tables only.  Let &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6317&quot; title=&quot;Master clean start up and Partially enabled tables make region assignment inconsistent.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6317&quot;&gt;&lt;del&gt;HBASE-6317&lt;/del&gt;&lt;/a&gt; handle enabling tables.&lt;/p&gt;</comment>
                            <comment id="13456481" author="rajesh23" created="Sat, 15 Sep 2012 19:42:54 +0000"  >&lt;p&gt;@Jimmy,&lt;br/&gt;
Lets suppose a table disabled successfully(no region is opened) and only master restarted, as for this patch we are making all regions online(because as for the META they are on online RS) and calling unassign(during recovery of disabling table) for all the regions,which will fail with NotServingRegionException because they already closed during disable. I think this will make master startup slow if we have any disabled tables?&lt;br/&gt;
Can we handle these scenarios in DisableTableHandler side only?&lt;/p&gt;

&lt;p&gt;Please correct me if I am wrong.&lt;/p&gt;</comment>
                            <comment id="13456487" author="jxiang" created="Sat, 15 Sep 2012 20:29:14 +0000"  >&lt;p&gt;@Rajesh, you are right. I closed it as Invalid.&lt;/p&gt;</comment>
                            <comment id="13456759" author="ram_krish" created="Mon, 17 Sep 2012 04:48:36 +0000"  >&lt;p&gt;@Jimmy&lt;br/&gt;
Pls take a look at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6317&quot; title=&quot;Master clean start up and Partially enabled tables make region assignment inconsistent.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6317&quot;&gt;&lt;del&gt;HBASE-6317&lt;/del&gt;&lt;/a&gt; patch.  May be it solves disabled and enabled (partially) cases.&lt;/p&gt;</comment>
                            <comment id="13457136" author="jxiang" created="Mon, 17 Sep 2012 16:43:04 +0000"  >&lt;p&gt;I knew Rajesh&apos;s idea how to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6317&quot; title=&quot;Master clean start up and Partially enabled tables make region assignment inconsistent.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6317&quot;&gt;&lt;del&gt;HBASE-6317&lt;/del&gt;&lt;/a&gt;.  I think it is great. I prefer to isolate the change in EnableTableHandler and don&apos;t touch AssignmentManager.&lt;br/&gt;
I will comment their as well.&lt;/p&gt;</comment>
                            <comment id="13459060" author="stack" created="Wed, 19 Sep 2012 20:31:56 +0000"  >&lt;p&gt;This dialog is excellent.  Good stuff.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12597250">HBASE-6317</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12545063" name="trunk-6776.patch" size="1117" author="jxiang" created="Thu, 13 Sep 2012 22:00:45 +0000"/>
                            <attachment id="12545285" name="trunk-6776_v2.patch" size="1436" author="jxiang" created="Sat, 15 Sep 2012 18:33:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 13 Sep 2012 23:44:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242534</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 13 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02vif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14706</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>