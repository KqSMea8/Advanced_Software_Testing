<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:09:58 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3412/HBASE-3412.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3412] HLogSplitter should handle missing HLogs</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3412</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In build #48 (&lt;a href=&quot;https://hudson.apache.org/hudson/job/hbase-0.90/48/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/hbase-0.90/48/&lt;/a&gt;), TestReplication failed because of missing rows on the slave cluster. The reason is that a region server that was killed was able to archive a log at the same time the master was trying to recover it:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[MASTER_META_SERVER_OPERATIONS-vesta.apache.org:47907-0] util.FSUtils(625):
 Recovering file hdfs://localhost:50121/user/hudson/.logs/vesta.apache.org,58598,1294117333857/vesta.apache.org%3A58598.1294117406909
...
[RegionServer:0;vesta.apache.org,58598,1294117333857.logRoller] wal.HLog(740):
 moving old hlog file /user/hudson/.logs/vesta.apache.org,58598,1294117333857/vesta.apache.org%3A58598.1294117406909
 whose highest sequenceid is 422 to /user/hudson/.oldlogs/vesta.apache.org%3A58598.1294117406909
...
[MASTER_META_SERVER_OPERATIONS-vesta.apache.org:47907-0] master.MasterFileSystem(204):
 Failed splitting hdfs://localhost:50121/user/hudson/.logs/vesta.apache.org,58598,1294117333857
 java.io.IOException: Failed to open hdfs://localhost:50121/user/hudson/.logs/vesta.apache.org,58598,1294117333857/vesta.apache.org%3A58598.1294117406909 for append
Caused by: org.apache.hadoop.hdfs.server.namenode.LeaseExpiredException:
 org.apache.hadoop.hdfs.server.namenode.LeaseExpiredException:
 No lease on /user/hudson/.logs/vesta.apache.org,58598,1294117333857/vesta.apache.org%3A58598.1294117406909
 File does not exist. [Lease.  Holder: DFSClient_-986975908, pendingcreates: 1]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We should probably just handle the fact that a file could have been archived (maybe even check in .oldlogs to be sure) and move on to the next log.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12494640">HBASE-3412</key>
            <summary>HLogSplitter should handle missing HLogs</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 4 Jan 2011 20:11:33 +0000</created>
                <updated>Fri, 20 Nov 2015 12:42:45 +0000</updated>
                            <resolved>Wed, 5 Jan 2011 18:07:12 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12977563" author="jdcryans" created="Wed, 5 Jan 2011 00:53:44 +0000"  >&lt;p&gt;Patch that converts the LEE into FNFE and handles it correctly. Also includes a little test.&lt;/p&gt;</comment>
                            <comment id="12977568" author="stack" created="Wed, 5 Jan 2011 01:01:34 +0000"  >&lt;p&gt;The test doesn&apos;t assert anything.  How do I know it successful?  Should you check the FS for anything?&lt;/p&gt;

&lt;p&gt;This seems dangerous.  Is it?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; LeaseExpiredException) {
+          &lt;span class=&quot;code-comment&quot;&gt;// This exception comes out instead of FNFE, fix it
&lt;/span&gt;+          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FileNotFoundException(
+              &lt;span class=&quot;code-quote&quot;&gt;&quot;The given HLog wasn&apos;t found at &quot;&lt;/span&gt; + p.toString());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Otherwise, looks good.&lt;/p&gt;</comment>
                            <comment id="12977570" author="jdcryans" created="Wed, 5 Jan 2011 01:10:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;The test doesn&apos;t assert anything. How do I know it successful? Should you check the FS for anything?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Since I mock the FS to get the LEE, nothing changes on the filesystem... so you think I should check if everything is still where it&apos;s supposed to be i.e. all the logs in the logs folder?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This seems dangerous. Is it?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Less dangerous than not handling it IMO, since currently it cancels the whole log replay process. If your concern is that we might miss other kinds of exceptions hidden in LEE, then I think we could grep the exception message for &quot;File does not exist&quot; and otherwise let the exception come out like it currently does... although it really bothers me to do that since it cancels log splitting and guarantees data loss even if other logs after the one that throws the exception were fine.&lt;/p&gt;</comment>
                            <comment id="12977578" author="jdcryans" created="Wed, 5 Jan 2011 01:34:01 +0000"  >&lt;p&gt;Patch that adds FS verifications and only throws a FNFE if the message contains the right string.&lt;/p&gt;</comment>
                            <comment id="12977610" author="stack" created="Wed, 5 Jan 2011 03:24:32 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Thanks for making improvements.&lt;/p&gt;</comment>
                            <comment id="12977887" author="jdcryans" created="Wed, 5 Jan 2011 18:07:12 +0000"  >&lt;p&gt;Committed to branch and trunk, thanks for the review Stack!&lt;/p&gt;</comment>
                            <comment id="12977978" author="hudson" created="Wed, 5 Jan 2011 21:41:09 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1703 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1703/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1703/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3412&quot; title=&quot;HLogSplitter should handle missing HLogs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3412&quot;&gt;&lt;del&gt;HBASE-3412&lt;/del&gt;&lt;/a&gt;  HLogSplitter should handle missing HLogs&lt;/p&gt;</comment>
                            <comment id="15017335" author="lars_francke" created="Fri, 20 Nov 2015 12:42:45 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12467503" name="HBASE-3412-2.patch" size="4610" author="jdcryans" created="Wed, 5 Jan 2011 01:34:01 +0000"/>
                            <attachment id="12467498" name="HBASE-3412.patch" size="4321" author="jdcryans" created="Wed, 5 Jan 2011 00:53:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 5 Jan 2011 01:01:34 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26844</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hm6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100856</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>