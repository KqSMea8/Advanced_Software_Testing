<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:53:05 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1386/HBASE-1386.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1386] NPE in housekeeping</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1386</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Two regionservers hosting thousands of regions.  One went down. Other was trying to open about 1000 regions and got this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-05-07 10:24:59,995 [regionserver/0:0:0:0:0:0:0:0:60021.worker] INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Worker: MSG_REGION_OPEN: REGION =&amp;gt; {NAME =&amp;gt; &apos;TestTable,1094797576,1241684896885&apos;, STARTKEY =&amp;gt; &apos;1094797576&apos;, ENDKEY =&amp;gt; &apos;1096819542&apos;, ENCOD
ED =&amp;gt; 1333893125, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;TestTable&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;info&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, VERSIONS =&amp;gt; &apos;3&apos;, LENGTH =&amp;gt; &apos;2147483647&apos;, TTL =&amp;gt; &apos;-1&apos;, BLOCKSIZE =&amp;gt; &apos;65536&apos;, IN_MEMORY =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;, BLOCKCACHE =&amp;gt; &apos;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&apos;}]}}
2009-05-07 10:24:59,996 [regionserver/0:0:0:0:0:0:0:0:60021] FATAL org.apache.hadoop.hbase.regionserver.HRegionServer: Unhandled exception. Aborting...
java.lang.NullPointerException
    at org.apache.hadoop.hbase.regionserver.HRegionServer.housekeeping(HRegionServer.java:1141)
    at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:518)
    at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12424826">HBASE-1386</key>
            <summary>NPE in housekeeping</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 7 May 2009 16:21:30 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:36 +0000</updated>
                            <resolved>Mon, 18 May 2009 20:00:48 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                    <fixVersion>0.19.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12706987" author="stack" created="Thu, 7 May 2009 16:48:34 +0000"  >&lt;p&gt;Commited test for null; why it was null is suspicious.  Could be another issue in here.  This patch makes its so we at least don&apos;t exit.&lt;/p&gt;</comment>
                            <comment id="12706989" author="stack" created="Thu, 7 May 2009 16:49:00 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java
===================================================================
--- src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java    (revision 772492)
+++ src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java    (working copy)
@@ -1124,6 +1124,7 @@
     }
     &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
   }
+
   /*
    * Run some housekeeping tasks before we go into &apos;hibernation&apos; sleeping at
    * the end of the main HRegionServer run loop.
@@ -1132,12 +1133,16 @@
     &lt;span class=&quot;code-comment&quot;&gt;// If the todo list has &amp;gt; 0 messages, iterate looking &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; open region
&lt;/span&gt;     &lt;span class=&quot;code-comment&quot;&gt;// messages. Send the master a message that we&apos;re working on its
&lt;/span&gt;     &lt;span class=&quot;code-comment&quot;&gt;// processing so it doesn&apos;t assign the region elsewhere.
&lt;/span&gt;-    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.toDo.size() &amp;lt;= 0) {
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.toDo.isEmpty()) {
       &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
     }
     &lt;span class=&quot;code-comment&quot;&gt;// This iterator is &apos;safe&apos;.  We are guaranteed a view on state of the
&lt;/span&gt;     &lt;span class=&quot;code-comment&quot;&gt;// queue at time iterator was taken out.  Apparently goes from oldest.
&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (ToDoEntry e: &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.toDo) {
+      HMsg msg = e.msg;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (msg == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Message is empty: &quot;&lt;/span&gt; + e);
+      }
       &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (e.msg.isType(HMsg.Type.MSG_REGION_OPEN)) {
         addProcessingMessage(e.msg.getRegionInfo());
       }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12710468" author="stack" created="Mon, 18 May 2009 19:55:56 +0000"  >&lt;p&gt;jgray just got this in 0.19.&lt;/p&gt;

&lt;p&gt;Reopening because I can tighten this up a little I think and because I want to backport to branch.&lt;/p&gt;</comment>
                            <comment id="12710470" author="stack" created="Mon, 18 May 2009 20:00:48 +0000"  >&lt;p&gt;Committed to branch and trunk following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java
===================================================================
--- src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java    (revision 776038)
+++ src/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java    (working copy)
@@ -1388,11 +1388,10 @@
    * Data structure to hold a HMsg and retries count.
    */
   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; class ToDoEntry {
-    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;volatile&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; tries;
+    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; AtomicInteger tries = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AtomicInteger(0);
     &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HMsg msg;
 
     ToDoEntry(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; HMsg msg) {
-      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.tries = 0;
       &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.msg = msg;
     }
   }
@@ -1487,9 +1486,9 @@
             &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ex &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; IOException) {
               ex = RemoteExceptionHandler.checkIOException((IOException) ex);
             }
-            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(e != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; e.tries &amp;lt; numRetries) {
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(e != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; e.tries.get() &amp;lt; numRetries) {
               LOG.warn(ex);
-              e.tries++;
+              e.tries.incrementAndGet();
               &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
                 toDo.put(e);
               } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException ie) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25729</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 31 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hcxr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99358</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>