<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:11:51 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10237/HBASE-10237.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10237] Master restart, then followed by the MetaRegionServer crashed will result that the .meta. table won&apos;t online forever</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10237</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The following logs record such  process:&lt;/p&gt;

&lt;p&gt;// &lt;b&gt;once allocate root and meta to node209&lt;/b&gt;&lt;br/&gt;
2013-12-23 10:45:34,130 INFO  [MASTER_OPEN_REGION-node201.vipcloud,60000,1386903739776-3] handler.OpenedRegionHandler (OpenedRegionHandler.ja&lt;br/&gt;
va:debugLog(145)) - Handling OPENED event for .META.,,1.1028785192 from node209.vipcloud,60020,1387272038024; deleting unassigned node&lt;br/&gt;
2013-12-23 14:53:36,268 INFO  [MASTER_OPEN_REGION-node201.vipcloud,60000,1386903739776-4] handler.OpenedRegionHandler (OpenedRegionHandler.java:debugLog(145)) - Handling OPENED event for &amp;#45;ROOT&amp;#45;,,0.70236052 from node209.vipcloud,60020,1387272038024; deleting unassigned node&lt;/p&gt;

&lt;p&gt;// &lt;b&gt;master restart&lt;/b&gt;&lt;br/&gt;
2013-12-23 16:30:19 CST Starting master on node201.vipcloud&lt;/p&gt;

&lt;p&gt;// &lt;b&gt;209 comming&lt;/b&gt;&lt;br/&gt;
2013-12-23 16:30:33,698 INFO  [master-node201.vipcloud,60000,1387787422616] master.ServerManager (ServerManager.java:recordNewServer(280)) -&lt;br/&gt;
Registering server=node209.vipcloud,60020,1387272038024&lt;/p&gt;

&lt;p&gt;// &lt;b&gt;209 out&lt;/b&gt;&lt;br/&gt;
2013-12-23 16:30:37,106 INFO  [main-EventThread] zookeeper.RegionServerTracker (RegionServerTracker.java:nodeDeleted(93)) - RegionServer ephe&lt;br/&gt;
meral node deleted, processing expiration [node209.vipcloud,60020,1387272038024]&lt;/p&gt;

&lt;p&gt;// &lt;b&gt;delay processing 209 for initialization&lt;/b&gt;&lt;br/&gt;
2013-12-23 16:30:37,107 INFO  [main-EventThread] master.ServerManager (ServerManager.java:expireServer(384)) - Master doesn&apos;t enable ServerSh&lt;br/&gt;
utdownHandler during initialization, delay expiring server node209.vipcloud,60020,1387272038024&lt;/p&gt;

&lt;p&gt;// &lt;b&gt;assign root to node209 for data in zk node&lt;/b&gt;&lt;br/&gt;
2013-12-23 16:30:42,120 INFO [master-node201.vipcloud,60000,1387787422616] master.HMaster (HMaster.java:assignRoot(756)) - &amp;#45;ROOT&amp;#45; assigned=0&lt;br/&gt;
, rit=false, location=node209.vipcloud,60020,1387272038024&lt;/p&gt;

&lt;p&gt;// &lt;b&gt;problem happened when assign META to node209, validation passed first but when check server available failed. Therefore not update the regions struct for META&lt;/b&gt;&lt;br/&gt;
s1&#65306;2013-12-23 16:30:42,322 INFO  [master-node201.vipcloud,60000,1387787422616] master.AssignmentManager (AssignmentManager.java:regionOnline(126&lt;br/&gt;
4)) - The server is not in online servers, ServerName=node209.vipcloud,60020,1387272038024, region=1028785192&lt;br/&gt;
s2&#65306;2013-12-23 16:30:42,323 INFO  [master-node201.vipcloud,60000,1387787422616] master.HMaster (HMaster.java:assignMeta(814)) - .META. assigned=0&lt;br/&gt;
, rit=false, location=node209.vipcloud,60020,1387272038024&lt;/p&gt;

&lt;p&gt;// &lt;b&gt;handle node209 shutdown, only do reassign for &amp;#45;ROOT&amp;#45; but not for .META. because it is NOT updated in memory&lt;/b&gt;&lt;br/&gt;
2013-12-23 16:31:35,978 INFO  [MASTER_META_SERVER_OPERATIONS-node201.vipcloud,60000,1387787422616-0] handler.MetaServerShutdownHandler (MetaS&lt;br/&gt;
erverShutdownHandler.java:process(78)) - Server node209.vipcloud,60020,1387272038024 was carrying ROOT. Trying to assign.&lt;/p&gt;

&lt;p&gt;// &lt;b&gt;verifaction for META failed (data in &amp;#45;ROOT&amp;#45; still stored as node209), but no reassign. for META. META won&apos;t be online forever&lt;/b&gt;&lt;br/&gt;
2013-12-23 16:31:40,048 INFO  [MASTER_SERVER_OPERATIONS-node201.vipcloud,60000,1387787422616-0] catalog.CatalogTracker (CatalogTracker.java:&lt;br/&gt;
verifyRegionLocation(582)) - Failed verification of .META.,,1 at address=node209.vipcloud,60020,1387272038024; org.apache.hadoop.hbase.ipc.HBa&lt;br/&gt;
seClient$FailedServerException: This server is in the failed servers list: node209.vipcloud/192.168.30.132:60020&lt;/p&gt;

&lt;p&gt;2013-12-23 16:35:46,764 INFO  [MASTER_SERVER_OPERATIONS-node201.vipcloud,60000,1387787422616-0] catalog.CatalogTracker (CatalogTracker.java:v&lt;br/&gt;
erifyRegionLocation(582)) - Failed verification of .META.,,1 at address=node209.vipcloud,60020,1387272038024; org.apache.hadoop.hbase.ipc.HBa&lt;br/&gt;
seClient$FailedServerException: This server is in the failed servers list: node209.vipcloud/192.168.30.132:60020&lt;/p&gt;</description>
                <environment></environment>
        <key id="12686338">HBASE-10237</key>
            <summary>Master restart, then followed by the MetaRegionServer crashed will result that the .meta. table won&apos;t online forever</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="yians">Han Xiao</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Dec 2013 07:41:38 +0000</created>
                <updated>Thu, 26 Dec 2013 01:17:35 +0000</updated>
                                            <version>0.94.12</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13856540" author="yians" created="Wed, 25 Dec 2013 07:53:52 +0000"  >&lt;p&gt;Problem happens in Release Version 0.94.10. I check the code in branch of 0.94. Problem still exists.&lt;br/&gt;
Code in  method &quot;void regionOnline(HRegionInfo regionInfo, ServerName sn)&quot; of &quot;AssignmentManager.java&quot; seems be the place where the problem comes from:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isServerOnline(sn)) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regions.put(regionInfo, sn);
        addToServers(sn, regionInfo);
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regions.notifyAll();
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;The server is not in online servers, ServerName=&quot;&lt;/span&gt; + 
          sn.getServerName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;, region=&quot;&lt;/span&gt; + regionInfo.getEncodedName());
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The judgement comes from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4033&quot; title=&quot;The shutdown RegionServer could be added to AssignmentManager.servers again&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4033&quot;&gt;&lt;del&gt;HBASE-4033&lt;/del&gt;&lt;/a&gt;, but it seems be useless now.&lt;br/&gt;
When we call regionOnline(), region should have open in the regionserver. So if the regionserver shutdowns when method is called, the info is still need to be recorded to ressign the region.&lt;br/&gt;
Discarding the judgement should resolve the problem.&lt;/p&gt;</comment>
                            <comment id="13856542" author="yians" created="Wed, 25 Dec 2013 07:58:56 +0000"  >&lt;p&gt;Usertable&apos;s region would not be affected, for the shutdown handler read the region data from .META. table which is already changed by the regionserver.&lt;br/&gt;
But .META. region itself won&apos;t work normally, beasue it relys on the data in memory. Just like the problem happened in description.&lt;/p&gt;</comment>
                            <comment id="13856659" author="lhofhansl" created="Wed, 25 Dec 2013 20:45:25 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=yians&quot; class=&quot;user-hover&quot; rel=&quot;yians&quot;&gt;Han Xiao&lt;/a&gt;. Any chance for a patch?&lt;/p&gt;</comment>
                            <comment id="13856701" author="yians" created="Thu, 26 Dec 2013 01:17:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;, it will take a few days for validating the proposed method and adding some unit test as possible. If the waiting is ok, you can assign it to me..&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 25 Dec 2013 20:45:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365321</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qyvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>365623</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>