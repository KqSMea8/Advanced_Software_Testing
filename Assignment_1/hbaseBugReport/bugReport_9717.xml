<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:06:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9717/HBASE-9717.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9717] Allow filterRowKey to return a next key hint</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9717</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The Filter interface has a filterRowKey method which returns a boolean set to true if the given row key should be filtered out.&lt;/p&gt;

&lt;p&gt;When a row key is filtered, it could be interesting to be able to provide the scanner a hint about the next row key which should be examined. This could tremendously speed up scanning in some cases.&lt;/p&gt;

&lt;p&gt;The logic could be similar to that of filterKeyValue with a helper method getNextRowKeyHint, or even simpler, filterRowKey could return a byte[] which would be set to null to mean keep the row, to the empty array to mean filter the row and there is not hint, and to a non empty byte array to mean filter the row and here is a hint about the next key that should be scanned.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12672491">HBASE-9717</key>
            <summary>Allow filterRowKey to return a next key hint</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="herberts">Mathias Herberts</reporter>
                        <labels>
                    </labels>
                <created>Sat, 5 Oct 2013 21:35:29 +0000</created>
                <updated>Fri, 11 Oct 2013 03:54:11 +0000</updated>
                            <resolved>Thu, 10 Oct 2013 21:53:02 +0000</resolved>
                                                                    <component>Filters</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13787409" author="stack" created="Sat, 5 Oct 2013 23:55:38 +0000"  >&lt;p&gt;Sounds good Mathias.  You have a sketch of what API might look like?  Could we do it in a way that is backward compatible?  Thanks.&lt;/p&gt;</comment>
                            <comment id="13787531" author="herberts" created="Sun, 6 Oct 2013 08:52:53 +0000"  >&lt;p&gt;I think the best way to be backward compatible would be to add two methods Filter, namely:&lt;/p&gt;

&lt;p&gt;abstract boolean hasRowKeyHint()&lt;br/&gt;
abstract byte[] getRowKeyHint(byte[] buffer, int offset, int length)&lt;/p&gt;

&lt;p&gt;if hasRowKeyHint returns true for the filter, then when filterRowKey returns true (filter the row), getRowKeyHint would be called and return a hint onto which key we should seek to, or null if no hint is available.&lt;/p&gt;

&lt;p&gt;Default implementation of hasRowKeyHint would return false.&lt;br/&gt;
Default implementation of getRowKeyHint would return null.&lt;/p&gt;

&lt;p&gt;This would allow for minimal changes, basically if I&apos;m not mistaken, Filter, FilterBase, HRegion, FilterList, and WhileMatchFilter would be the only classes needing changes, with a semantic to determine for FilterList in case MUST_PASS_ONE is used.&lt;/p&gt;</comment>
                            <comment id="13787802" author="stack" created="Sun, 6 Oct 2013 22:20:59 +0000"  >&lt;p&gt;LGTM&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=giacomotaylor&quot; class=&quot;user-hover&quot; rel=&quot;giacomotaylor&quot;&gt;James Taylor&lt;/a&gt; &amp;#8211; you seem fellas who&apos;d be interested in this kinda speed up.  Any opinion lads?&lt;/p&gt;</comment>
                            <comment id="13787896" author="lhofhansl" created="Mon, 7 Oct 2013 04:15:03 +0000"  >&lt;p&gt;The first question I have: Why can&apos;t FilterKeyValue not be used for this? The first KV on a given row can be used to set this hint.&lt;/p&gt;</comment>
                            <comment id="13787911" author="herberts" created="Mon, 7 Oct 2013 05:22:51 +0000"  >&lt;p&gt;If decision of skipping or including a whole row on the row key alone can be made, doesn&apos;t it imply a performance hit to implement the filter so the filtering is done in filterKeyValue instead of filterRowKey? In case of skipping a row the performance might be very similar, but when including a row doesn&apos;t this mean filterKeyValue will be called for each cell (since filterKeyValue does not have a INCLUDE_ALL_ROW return code).&lt;/p&gt;

&lt;p&gt;Also (I have not digged sufficiently in the code yet), doesn&apos;t filterRowKey imply that only the row key will be read in memory instead of an entire cell?&lt;/p&gt;</comment>
                            <comment id="13787948" author="lhofhansl" created="Mon, 7 Oct 2013 06:40:45 +0000"  >&lt;p&gt;Hmm... filterKeyValue is called for each KV, though (unless you filter the row and return a seek hint).&lt;br/&gt;
So if the row is included there is no penalty (provided you implement the filter correctly) since filterKeyValue is called for each KV in any event; if the row is not to be include filterKeyValue can decide so after seeing the first KV.&lt;/p&gt;

&lt;p&gt;Also - currently - we read whole KVs (key/ts/etc and value) at the server, although that will hopefully change in the future.&lt;/p&gt;

&lt;p&gt;If there&apos;s a case that cannot be efficiently be implemented with filterKeyValue and seek hints, I&apos;d like to see that.&lt;/p&gt;</comment>
                            <comment id="13787986" author="herberts" created="Mon, 7 Oct 2013 08:27:25 +0000"  >&lt;p&gt;OK, I&apos;ll try it this way then. I just have a question, is a single Filter instance used for all regions in a RegionServer or are there several instances created? This is to plan optimizations of row key checks which would be done for each KV instead of for each row.&lt;/p&gt;</comment>
                            <comment id="13792028" author="herberts" created="Thu, 10 Oct 2013 21:53:02 +0000"  >&lt;p&gt;Lars&apos; suggestion to use filterKeyValue is indeed the way to go, I was naively thinking that values were not loaded when calling filterRowKey which would have enabled better performance, but they are already in memory, so no use  to bother with my proposal.&lt;/p&gt;

&lt;p&gt;Sorry for the noise.&lt;/p&gt;</comment>
                            <comment id="13792312" author="lhofhansl" created="Fri, 11 Oct 2013 03:54:11 +0000"  >&lt;p&gt;Thanks Mathias. Please keep the ideas coming. It&apos;s better having one jira too many than one too few &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 5 Oct 2013 23:55:38 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352118</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 10 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1opk7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>352406</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>