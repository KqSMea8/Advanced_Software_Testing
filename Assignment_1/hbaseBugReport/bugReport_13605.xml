<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:44:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13605/HBASE-13605.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13605] RegionStates should not keep its list of dead servers</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13605</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;As mentioned in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9514?focusedCommentId=13769761&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13769761&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-9514?focusedCommentId=13769761&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13769761&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12844&quot; title=&quot;ServerManager.isServerReacable() should sleep between retries&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12844&quot;&gt;&lt;del&gt;HBASE-12844&lt;/del&gt;&lt;/a&gt; we should have only 1 source of cluster membership. &lt;/p&gt;

&lt;p&gt;The list of dead server and RegionStates doing it&apos;s own liveliness check (ServerManager.isServerReachable()) has caused an assignment problem again in a test cluster where the region states &quot;thinks&quot; that the server is dead and SSH will handle the region assignment. However the RS is not dead at all, living happily, and never gets zk expiry or YouAreDeadException or anything. This leaves the list of regions unassigned in OFFLINE state. &lt;/p&gt;

&lt;p&gt;master assigning the region:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
15-04-20 09:02:25,780 DEBUG [AM.ZK.Worker-pool3-t330] master.RegionStates: Onlined 77dddcd50c22e56bfff133c0e1f9165b on os-amb-r6-us-1429512014-hbase4-6.novalocal,16020,1429520535268 {ENCODED =&amp;gt; 77dddcd50c
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Master then disabled the table, and unassigned the region:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-04-20 09:02:27,158 WARN  [ProcedureExecutorThread-1] zookeeper.ZKTableStateManager: Moving table loadtest_d1 state from DISABLING to DISABLING
 Starting unassign of loadtest_d1,,1429520544378.77dddcd50c22e56bfff133c0e1f9165b. (offlining), current state: {77dddcd50c22e56bfff133c0e1f9165b state=OPEN, ts=1429520545780,   server=os-amb-r6-us-1429512014-hbase4-6.novalocal,16020,1429520535268}
bleProcedure$BulkDisabler-0] master.AssignmentManager: Sent CLOSE to os-amb-r6-us-1429512014-hbase4-6.novalocal,16020,1429520535268 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region loadtest_d1,,1429520544378.77dddcd50c22e56bfff133c0e1f9165b.
2015-04-20 09:02:27,414 INFO  [AM.ZK.Worker-pool3-t316] master.RegionStates: Offlined 77dddcd50c22e56bfff133c0e1f9165b from os-amb-r6-us-1429512014-hbase4-6.novalocal,16020,1429520535268
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On table re-enable, AM does not assign the region: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-04-20 09:02:30,415 INFO  [ProcedureExecutorThread-3] balancer.BaseLoadBalancer: Reassigned 25 regions. 25 retained the pre-restart assignment.&#183;
2015-04-20 09:02:30,415 INFO  [ProcedureExecutorThread-3] procedure.EnableTableProcedure: Bulk assigning 25 region(s) across 5 server(s), retainAssignment=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;

l,16000,1429515659726-GeneralBulkAssigner-4] master.RegionStates: Couldn&apos;t reach online server os-amb-r6-us-1429512014-hbase4-6.novalocal,16020,1429520535268

l,16000,1429515659726-GeneralBulkAssigner-4] master.AssignmentManager: Updating the state to OFFLINE to allow to be reassigned by SSH
nmentManager: Skip assigning loadtest_d1,,1429520544378.77dddcd50c22e56bfff133c0e1f9165b., it is on a dead but not processed yet server: os-amb-r6-us-1429512014-hbase4-6.novalocal,16020,1429520535268
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</description>
                <environment></environment>
        <key id="12826493">HBASE-13605</key>
            <summary>RegionStates should not keep its list of dead servers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="enis">Enis Soztutar</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 May 2015 03:16:34 +0000</created>
                <updated>Tue, 30 Aug 2016 22:29:10 +0000</updated>
                                                            <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>Region Assignment</component>
                        <due></due>
                            <votes>2</votes>
                                    <watches>13</watches>
                                                                                                            <comments>
                            <comment id="14522713" author="enis" created="Fri, 1 May 2015 03:21:15 +0000"  >&lt;p&gt;Here is a patch which undos some of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9514&quot; title=&quot;Prevent region from assigning before log splitting is done&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9514&quot;&gt;&lt;del&gt;HBASE-9514&lt;/del&gt;&lt;/a&gt;. Now we do not do an explicit RPC before assigning a region to a region server. That also seems costly. We are relying on the ClusterManager only to keep a list of dead servers. If a RS is dead, and we do not know about it, it is fine to try to assign regions I think. The assignment will fail, and retried elsewhere. &lt;/p&gt;</comment>
                            <comment id="14522809" author="stack" created="Fri, 1 May 2015 05:59:49 +0000"  >&lt;p&gt;You running chaos monkey big tests &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;? If not, I can try it over here.&lt;/p&gt;

&lt;p&gt;Patch looks fine. Would think we&apos;d run big test before we&apos;d think it worth committing (reasoning seems good to me too... one local for dead servers list).&lt;/p&gt;</comment>
                            <comment id="14522827" author="hadoopqa" created="Fri, 1 May 2015 06:29:17 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12729711/hbase-13605_v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12729711/hbase-13605_v1.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 235dc9734f032945331c5a4a03ff2d69d170669d.&lt;br/&gt;
  ATTACHMENT ID: 12729711&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.oozie.test.MiniHCatServer$1.run(MiniHCatServer.java:137)&lt;br/&gt;
	at org.apache.oozie.test.XTestCase$MiniClusterShutdownMonitor.run(XTestCase.java:1071)&lt;br/&gt;
	at org.apache.oozie.test.XTestCase.waitFor(XTestCase.java:692)&lt;br/&gt;
	at org.apache.oozie.action.hadoop.TestPigActionExecutor._testSubmit(TestPigActionExecutor.java:180)&lt;br/&gt;
	at org.apache.oozie.action.hadoop.TestPigActionExecutor.testPigError(TestPigActionExecutor.java:369)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13907//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13907//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13907//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13907//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13907//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13907//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13907//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13907//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14523273" author="devaraj" created="Fri, 1 May 2015 14:51:37 +0000"  >&lt;p&gt;Why do we explicitly check for startCode here?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// we are not acquiring the lock
&lt;/span&gt;+    ServerName onlineServer = findServerWithSameHostnamePortWithLock(serverName);
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (onlineServer != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; serverName.getStartcode() &amp;lt; onlineServer.getStartcode()) {
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also, I am curious to know why RegionStates made it&apos;s own notion of deadServers in the first place... &lt;/p&gt;</comment>
                            <comment id="14523514" author="enis" created="Fri, 1 May 2015 17:45:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;You running chaos monkey big tests Enis Soztutar? If not, I can try it over here.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I am not running the CM yet. I have seen this in an automated run. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Why do we explicitly check for startCode here?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;DeadServer class is weird. It tracks the list of dead servers, but when a new server comes online with the same hostname and port, we remove the previous dead server from the list (see DeadServer.cleanPreviousInstance()). So it means that if a new server is online, then the following checks will not find the old server in the dead list. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Also, I am curious to know why RegionStates made it&apos;s own notion of deadServers in the first place..&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The reasoning is mostly at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9514&quot; title=&quot;Prevent region from assigning before log splitting is done&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9514&quot;&gt;&lt;del&gt;HBASE-9514&lt;/del&gt;&lt;/a&gt;. I am also not sure why pinging the server was needed. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;? &lt;/p&gt;</comment>
                            <comment id="14523986" author="jxiang" created="Fri, 1 May 2015 21:25:24 +0000"  >&lt;p&gt;The dead server list in RegionStates is a list of servers that are dead and have been processed by SSH. It is used by AM to make sure regions are not assigned before SSH has finished log-splitting.  It is critical to make sure there is no data loss.&lt;/p&gt;

&lt;p&gt;RegionStates does not know if a server is dead unless SSH tells it. If the server is not dead, but it is on the dead server list in the RegionStates, this is possible only if your cluster has some time sync issue. I was wondering how this actually happened. There may be some clue in the log.&lt;/p&gt;</comment>
                            <comment id="14524397" author="enis" created="Sat, 2 May 2015 00:42:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;The dead server list in RegionStates is a list of servers that are dead and have been processed by SSH. It is used by AM to make sure regions are not assigned before SSH has finished log-splitting. It is critical to make sure there is no data loss.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Isn&apos;t DeadServer doing the same job? Did you check the patch. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;but it is on the dead server list in the RegionStates, this is possible only if your cluster has some time sync issue&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;this is not true. As mentioned and can be seen from RS.isServerDeadAndNotProcessed() it pings the server and puts it to its view of dead servers if ping is not successful. There is no guarantee that the server is actually dead. It can be a partition from master where the master cannot talk to the RS, but the RS still holds the zk session. &lt;/p&gt;</comment>
                            <comment id="14526944" author="jxiang" created="Mon, 4 May 2015 17:58:03 +0000"  >&lt;p&gt;I was confused the dead server list with the processed server list. In ZK-less region assignment,  we don&apos;t need to ping the sever any more, since the server could be restarted right after the ping returns, so we should not rely on the ping result, i.e. the ping result is as good as DeadServer.&lt;/p&gt;</comment>
                            <comment id="14527661" author="enis" created="Tue, 5 May 2015 00:44:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;In ZK-less region assignment, we don&apos;t need to ping the sever any more, since the server could be restarted right after the ping returns, so we should not rely on the ping result, i.e. the ping result is as good as DeadServer.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, the ping should not be needed. So you are fine with the patch? &lt;/p&gt;</comment>
                            <comment id="14527748" author="jxiang" created="Tue, 5 May 2015 01:45:10 +0000"  >&lt;p&gt;The patch is fine with me for the master branch. For branch 1, I am not sure.&lt;/p&gt;</comment>
                            <comment id="14576432" author="elserj" created="Sun, 7 Jun 2015 20:31:10 +0000"  >&lt;p&gt;I&apos;ve been looking at a similar failure for the past two days where AM thinks SSH is going to reassign hbase:meta and SSH thinks that AM is going to assign it. This results in hbase:meta never being assigned anywhere, hanging the system.&lt;/p&gt;

&lt;p&gt;I was able to repro this pretty easy using &lt;tt&gt;IntegrationTestIngest --monkey unbalance&lt;/tt&gt; on 1.1.1-SNAPSHOT within 3 runs of the test (6nodes). Been running all morning with Enis&apos; patch, and haven&apos;t gotten a single failure yet (5x so far, I think).&lt;/p&gt;

&lt;p&gt;Non-binding +1 from me for 1.x releases. This is a miserable bug to run into.&lt;/p&gt;</comment>
                            <comment id="14578087" author="enis" created="Mon, 8 Jun 2015 23:49:58 +0000"  >&lt;p&gt;Thanks Josh for verifying the patch. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; I think we should have this patch in 1.1.1 as well. To give an update, I was testing the v1 patch with ITBLL a cople of week ago to see whether the change will cause any problems in the assignment. I thought that failing ITBLL was due to this patch, but turns out the root case was actually &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;

&lt;p&gt;Now I am running another ITBLL of recent branch-1.1 code base with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13811&quot; title=&quot;Splitting WALs, we are filtering out too many edits -&amp;gt; DATALOSS&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13811&quot;&gt;&lt;del&gt;HBASE-13811&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13853&quot; title=&quot;ITBLL improvements after HBASE-13811&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13853&quot;&gt;&lt;del&gt;HBASE-13853&lt;/del&gt;&lt;/a&gt; and this patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13605&quot; title=&quot;RegionStates should not keep its list of dead servers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13605&quot;&gt;HBASE-13605&lt;/a&gt;). ITBLL with &lt;tt&gt;--slowDeterministic&lt;/tt&gt; is going strong with 50M keys * 5 mappers in the third iteration (750M keys so far). I&apos;ll commit this unless objection and if ITBLL eventually succeeds with 1.25B rows.  &lt;/p&gt;</comment>
                            <comment id="14578139" author="ndimiduk" created="Tue, 9 Jun 2015 00:51:04 +0000"  >&lt;p&gt;Fine by me &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14582812" author="enis" created="Fri, 12 Jun 2015 01:53:13 +0000"  >&lt;p&gt;We have discovered an issue with the v1 patch which gets surfaced after applying the patch. It is due to this logic: &lt;br/&gt;
In AM: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (ServerName serverName: deadServers) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!serverManager.isServerDead(serverName)) {
          serverManager.expireServer(serverName); &lt;span class=&quot;code-comment&quot;&gt;// Let SSH &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; region re-assign
&lt;/span&gt;        }
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Notice that we are expiring the server IF it is NOT dead. Seems weird, right? I assume this was added because to not trigger SSH twice. &lt;/p&gt;

&lt;p&gt;The v1 patch changes &lt;tt&gt;serverManager.isServerDead&lt;/tt&gt; so that if a new server is registered in the online servers, the old server IS considered dead: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isServerDead(ServerName serverName) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (serverName == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || deadservers.isDeadServer(serverName)
        || queuedDeadServers.contains(serverName)
        || requeuedDeadServers.containsKey(serverName)) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }

    &lt;span class=&quot;code-comment&quot;&gt;// we are not acquiring the lock
&lt;/span&gt;    ServerName onlineServer = findServerWithSameHostnamePortWithLock(serverName);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (onlineServer != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; serverName.getStartcode() &amp;lt; onlineServer.getStartcode()) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In one of our tests, that is exactly what happened. The RS is registered with a new identifier (thus onlineServers contains the new definition), and because of this SSH for the old guy was never called. &lt;/p&gt;

&lt;p&gt;v3 patch fixes this condition by breaking the isServerDead() into two parts. Old callers relies on isServerInDeadList() while the assignment caller will rely on the new semantics.&lt;/p&gt;

&lt;p&gt;We have been running tests including ITBLL, ITMTTR, etc with the v1 patch. Seems stable enough. v3 patch should fix the remaining issues. &lt;/p&gt;


</comment>
                            <comment id="14582910" author="hadoopqa" created="Fri, 12 Jun 2015 04:20:38 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12739154/hbase-13605_v3-branch-1.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12739154/hbase-13605_v3-branch-1.1.patch&lt;/a&gt;&lt;br/&gt;
  against branch-1.1 branch at commit 9d3422ed16004da1b0f9a874a98bd140b46b7a6f.&lt;br/&gt;
  ATTACHMENT ID: 12739154&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 3815 checkstyle errors (more than the master&apos;s current 3813 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14386//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14386//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14386//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14386//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14386//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14386//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14386//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14386//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14584948" author="enis" created="Sun, 14 Jun 2015 06:12:47 +0000"  >&lt;p&gt;v3 patch had a bug where is was not calling isServerDead() for the new semantics. v4 patch fixes that. &lt;/p&gt;</comment>
                            <comment id="14584995" author="hadoopqa" created="Sun, 14 Jun 2015 08:54:29 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12739472/hbase-13605_v4-branch-1.1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12739472/hbase-13605_v4-branch-1.1.patch&lt;/a&gt;&lt;br/&gt;
  against branch-1.1 branch at commit 682b8ab8a542a903e5807053282693e3a96bad2d.&lt;br/&gt;
  ATTACHMENT ID: 12739472&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 3814 checkstyle errors (more than the master&apos;s current 3813 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14401//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14401//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14401//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14401//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14401//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14401//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14401//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14401//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14590285" author="enis" created="Wed, 17 Jun 2015 18:35:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; maybe you can do a quick review for this. We have been running this patch with IT tests. Seems that it is not causing further issues. &lt;/p&gt;</comment>
                            <comment id="14590331" author="ndimiduk" created="Wed, 17 Jun 2015 18:53:47 +0000"  >&lt;p&gt;You and Josh have done the diligence, and the reasoning seems good to me. +1&lt;/p&gt;</comment>
                            <comment id="14590443" author="enis" created="Wed, 17 Jun 2015 19:53:46 +0000"  >&lt;p&gt;Lets try the master patch. &lt;/p&gt;</comment>
                            <comment id="14590696" author="enis" created="Wed, 17 Jun 2015 21:56:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; I am waiting for a test run from hadoopqa for the master patch. Feel free to commit the branch-1.1 patch for the RC if you want. &lt;/p&gt;</comment>
                            <comment id="14590754" author="ndimiduk" created="Wed, 17 Jun 2015 22:33:46 +0000"  >&lt;p&gt;Alright, in it goes.&lt;/p&gt;</comment>
                            <comment id="14590761" author="ndimiduk" created="Wed, 17 Jun 2015 22:37:56 +0000"  >&lt;p&gt;Pushed to branch-1.1.&lt;/p&gt;</comment>
                            <comment id="14591074" author="hadoopqa" created="Thu, 18 Jun 2015 01:10:48 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12740199/hbase-13605_v4-master.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12740199/hbase-13605_v4-master.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 623fd63827b2953c150597f24c7205737119bebe.&lt;br/&gt;
  ATTACHMENT ID: 12740199&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 1910 checkstyle errors (more than the master&apos;s current 1907 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestRegionRebalancing&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14450//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14450//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14450//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14450//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14450//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14450//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14450//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14450//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14450//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14450//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14591107" author="hudson" created="Thu, 18 Jun 2015 01:55:54 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1 #548 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/548/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/548/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13605&quot; title=&quot;RegionStates should not keep its list of dead servers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13605&quot;&gt;HBASE-13605&lt;/a&gt; RegionStates should not keep its list of dead servers (Enis Soztutar) (ndimiduk: rev 0706559581c388688f1b5f719bff20092632ffd1)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/RegionStates.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14592707" author="enis" created="Thu, 18 Jun 2015 23:16:58 +0000"  >&lt;p&gt;I have reverted the patch from branch-1.1 for now, and opened &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13937&quot; title=&quot;Partially revert HBASE-13172 &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13937&quot;&gt;&lt;del&gt;HBASE-13937&lt;/del&gt;&lt;/a&gt; for 1.1.1. The reason is that with the 13605 v4 patch, there is one more issue that is uncovered which was conveniently eclipsed by the current server ping mechanism in RS. &lt;/p&gt;

&lt;p&gt;The short story is that region is assigned before the WAL recovery finishes, a RS aborts and before the zk session expiry happens, we try to move the region from master. RPC to unassign fails with &lt;tt&gt;RegionServerNotRunningYetException&lt;/tt&gt; on a new instance of the server, and the AM thinks that I can put the region in OFFLINE state. Then the next assignment goes through without the actual RS session expiration even happened. Obviously the problem is not with the 13605_v4 patch (I think), but with the assumptions that AM can just OFFLINE the region and assign again if unassign RPC fails for some reason. We cannot blindly assume that if unassign RPC fails with RegionServerStoppedException, RegionServerNotRunningYetException, etc, the region can be assigned now and rely on dead servers list for recovery checking. &lt;/p&gt;

&lt;p&gt;Anyway, I don&apos;t think I will spend any more time on this issue without a proper re-design of AM / RS. My suggestion is to do &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13937&quot; title=&quot;Partially revert HBASE-13172 &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13937&quot;&gt;&lt;del&gt;HBASE-13937&lt;/del&gt;&lt;/a&gt; for 1.1.1. &lt;/p&gt;</comment>
                            <comment id="14592710" author="hudson" created="Thu, 18 Jun 2015 23:23:52 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.1 #550 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.1/550/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.1/550/&lt;/a&gt;)&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13605&quot; title=&quot;RegionStates should not keep its list of dead servers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13605&quot;&gt;HBASE-13605&lt;/a&gt; RegionStates should not keep its list of dead servers (Enis Soztutar)&quot; (enis: rev 54dc45b8fe114aa3e63a345717bea748c760e95a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/RegionStates.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14593791" author="ndimiduk" created="Fri, 19 Jun 2015 18:59:04 +0000"  >&lt;p&gt;Deferring from 1.1.1.&lt;/p&gt;</comment>
                            <comment id="14654532" author="ndimiduk" created="Tue, 4 Aug 2015 23:33:05 +0000"  >&lt;p&gt;Deferring from 1.1.2.&lt;/p&gt;</comment>
                            <comment id="14934812" author="ndimiduk" created="Tue, 29 Sep 2015 07:57:45 +0000"  >&lt;p&gt;No movement, out from 1.1.3.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; what are you thinking on this one?&lt;/p&gt;</comment>
                            <comment id="15060075" author="busbey" created="Wed, 16 Dec 2015 14:49:50 +0000"  >&lt;p&gt;Moving out of patch available status, based on Enis&apos; comment about things needing a redesign.&lt;/p&gt;

&lt;p&gt;For the same reason, unbooking from 1.1.z and 1.2.z. If folks expect such a redesign might happen in those versions, let&apos;s have the discussion on dev@.&lt;/p&gt;</comment>
                            <comment id="15060733" author="enis" created="Wed, 16 Dec 2015 20:06:11 +0000"  >&lt;p&gt;I don&apos;t think I will have the time to work on it given that this need a redesign for the cluster membership and assignment protocol in branch-1. It turned out that the fix in this area uncovers some previously hidden bugs. It is hard to cover all the bases with todays code base. &lt;/p&gt;

&lt;p&gt;I am inclined to wait for the proc based AM for the long term. I have not checked the patches yet there to see whether cluster membership is correctly handled there. &lt;/p&gt;</comment>
                            <comment id="15450327" author="phobos182" created="Tue, 30 Aug 2016 22:26:41 +0000"  >&lt;p&gt;Just ran into this on a production test cluster. HDFS outage followed by a RS crash across the board. Rendered the cluster inoperable, and unable to recover. Hit the 5 minute AssignmentManager timeout and master crashed. This was due to setting region states to OFFLINE slowed down startup so dramatically that it could not finish splitting the WALs, and other work before the timeout appeared.&lt;/p&gt;

&lt;p&gt;Solution was to remove the WALs, or increase the timeout. We chose to remove the WALs in this case since it was a test cluster.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12729711" name="hbase-13605_v1.patch" size="8575" author="enis" created="Fri, 1 May 2015 03:21:15 +0000"/>
                            <attachment id="12739154" name="hbase-13605_v3-branch-1.1.patch" size="14126" author="enis" created="Fri, 12 Jun 2015 01:53:13 +0000"/>
                            <attachment id="12739472" name="hbase-13605_v4-branch-1.1.patch" size="14547" author="enis" created="Sun, 14 Jun 2015 06:12:47 +0000"/>
                            <attachment id="12740199" name="hbase-13605_v4-master.patch" size="10374" author="enis" created="Wed, 17 Jun 2015 19:53:46 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12838977">HBASE-13937</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 1 May 2015 05:59:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            15 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2e67r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>