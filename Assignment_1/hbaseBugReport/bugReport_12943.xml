<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:37:58 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12943/HBASE-12943.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12943] Set sun.net.inetaddr.ttl in HBase</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12943</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The default value of config: sun.net.inetaddr.ttl is -1 and the java processes will cache the mapping of hostname to ip address  forever, See: &lt;a href=&quot;http://docs.oracle.com/javase/7/docs/technotes/guides/net/properties.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oracle.com/javase/7/docs/technotes/guides/net/properties.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But things go wrong when a regionserver with same hostname and different ip address rejoins the hbase cluster. The HMaster will get wrong ip address of the regionserver from this cache and every region assignment to this regionserver will be blocked for a time because the HMaster can&apos;t communicate with the regionserver.&lt;/p&gt;

&lt;p&gt;A tradeoff is to set the sun.net.inetaddr.ttl to 10m or 1h and make the wrong cache expired.&lt;/p&gt;

&lt;p&gt;Suggestions are welcomed. Thanks~&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12771010">HBASE-12943</key>
            <summary>Set sun.net.inetaddr.ttl in HBase</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="liushaohui">Liu Shaohui</assignee>
                                    <reporter username="liushaohui">Liu Shaohui</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Jan 2015 13:10:38 +0000</created>
                <updated>Sat, 18 Jun 2016 02:35:09 +0000</updated>
                                                            <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.3.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                                                            <comments>
                            <comment id="14297488" author="stack" created="Thu, 29 Jan 2015 20:16:27 +0000"  >&lt;p&gt;Agree. This is a classic.  10/20 minutes sounds good to me. &lt;/p&gt;</comment>
                            <comment id="14297668" author="enis" created="Thu, 29 Jan 2015 21:04:16 +0000"  >&lt;p&gt;We have also seen this causing problems in a cloud environment (azure). If a RS gets re-imaged and joins the cluster with the same hostname but with a different ip, the master can never connect to it again. &lt;/p&gt;

&lt;p&gt;We have tried setting the &lt;tt&gt;networkaddress.cache.ttl&lt;/tt&gt; in security configuration according to the InetSocketAddress / InetAddress javadoc, but it did not take affect. Documentation for &lt;tt&gt;sun.net.inetaddr.ttl&lt;/tt&gt; says that it can be set from command line. If we can get it working, I&apos;m all for it. &lt;/p&gt;</comment>
                            <comment id="14314745" author="devaraj" created="Tue, 10 Feb 2015 19:34:00 +0000"  >&lt;p&gt;We did some testing on Azure recently. We needed to do two things:&lt;br/&gt;
1. Set networkaddress.cache.ttl in the file &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;${JAVA_HOME}/jre/lib/security/java.security&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; to a certain number for the cache expiry.&lt;br/&gt;
2. Fix code to not use an invalid stubKey (patch attached). Without the patch, the master wouldn&apos;t be able to talk to the just-restarted RegionServer (same hostname but a different IP).&lt;/p&gt;</comment>
                            <comment id="14314750" author="devaraj" created="Tue, 10 Feb 2015 19:36:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=liushaohui&quot; class=&quot;user-hover&quot; rel=&quot;liushaohui&quot;&gt;Liu Shaohui&lt;/a&gt;, hope you don&apos;t mind me submitting a patch on your issue.&lt;/p&gt;</comment>
                            <comment id="14314831" author="hadoopqa" created="Tue, 10 Feb 2015 20:16:54 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12697848/12943-1-master.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12697848/12943-1-master.txt&lt;/a&gt;&lt;br/&gt;
  against master branch at commit ede20aa2880ce509e6d3df67818ad305ca9f4eb8.&lt;br/&gt;
  ATTACHMENT ID: 12697848&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestChoreService&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/12764//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14319482" author="enis" created="Fri, 13 Feb 2015 02:39:24 +0000"  >&lt;p&gt;1. We can use serverName.getHostname() and getPort() here (and above)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          Addressing.parseHostname(serverName.getHostAndPort()),
+          Addressing.parsePort(serverName.getHostAndPort()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2. Maybe we can create a subtask for this since the jira is focussed on setting the TTL setting for Oracle JVM with some default setting, but your patch actually fixes another related problem with Connection caching per hostname. We need that patch first, then maybe setting the TTL setting from hbase-env.sh later. &lt;/p&gt;

&lt;p&gt;I think caching the stub key with the ip address is right since BlockingRpcChannelImplementation already constructs &lt;tt&gt;new InetSocketAddress()&lt;/tt&gt;, and the connection from RpcClient will use the InetSocketAddress to talk. One thing we can consider is that, to be perfectly safe for changing either hostnames or ips, we can make the stub key cache like : {{ serviceName @ hostname / ip : port }}. InetAddress.toString() can be used for the middle part. &lt;/p&gt;</comment>
                            <comment id="14319491" author="liushaohui" created="Fri, 13 Feb 2015 02:48:57 +0000"  >&lt;p&gt;Never mind!&lt;br/&gt;
Thanks very much for your patch~&lt;/p&gt;</comment>
                            <comment id="14387549" author="enis" created="Mon, 30 Mar 2015 22:54:26 +0000"  >&lt;p&gt;Now that the subtask went in that fixes the stub management, we can set the TTL by default in this jira. &lt;/p&gt;</comment>
                            <comment id="14610499" author="busbey" created="Wed, 1 Jul 2015 15:46:40 +0000"  >&lt;p&gt;moving out of patch available status, since the patch is for the issue fixedi n the subtask and not the subject of this jira.&lt;/p&gt;</comment>
                            <comment id="15246374" author="ghelmling" created="Mon, 18 Apr 2016 19:21:28 +0000"  >&lt;p&gt;Recent versions of JDK 7 and 8 that I&apos;ve seen only set this to &quot;forever&quot; when a SecurityManager is in use.  Otherwise the default seems to be 30 seconds:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;#&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The Java-level namelookup cache policy for successful lookups:&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;any negative value: caching forever&lt;/li&gt;
	&lt;li&gt;any positive value: the number of seconds to cache an address for&lt;/li&gt;
	&lt;li&gt;zero: do not cache&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;default value is forever (FOREVER). For security reasons, this&lt;/li&gt;
	&lt;li&gt;caching is made forever when a security manager is set. When a security&lt;/li&gt;
	&lt;li&gt;manager is not set, the default behavior in this implementation&lt;/li&gt;
	&lt;li&gt;is to cache for 30 seconds.&lt;br/&gt;
#&lt;/li&gt;
	&lt;li&gt;NOTE: setting this to anything other than the default value can have&lt;/li&gt;
	&lt;li&gt;serious security implications. Do not set it unless&lt;/li&gt;
	&lt;li&gt;you are sure you are not exposed to DNS spoofing attack.&lt;br/&gt;
#&lt;br/&gt;
#networkaddress.cache.ttl=-1&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;

&lt;p&gt;Given this, the overhead in added lookups from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13067&quot; title=&quot;Fix caching of stubs to allow IP address changes of restarted remote servers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13067&quot;&gt;&lt;del&gt;HBASE-13067&lt;/del&gt;&lt;/a&gt; can be pretty severe.  Should we set &lt;tt&gt;networkadress.cache.ttl&lt;/tt&gt; to a longer value in HBase, or maybe consider changing the default setting for &lt;tt&gt;hbase.resolve.hostnames.on.failure&lt;/tt&gt;?  As far as I can see, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13067&quot; title=&quot;Fix caching of stubs to allow IP address changes of restarted remote servers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13067&quot;&gt;&lt;del&gt;HBASE-13067&lt;/del&gt;&lt;/a&gt; is otherwise triggering a hostname lookup on every call, not just on failure.&lt;/p&gt;</comment>
                            <comment id="15246566" author="apurtell" created="Mon, 18 Apr 2016 21:20:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;Recent versions of JDK 7 and 8 that I&apos;ve seen only set this to &quot;forever&quot; when a SecurityManager is in use. Otherwise the default seems to be 30 seconds&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;How about changing our default to one hour? That&apos;s pretty common convention I think. Should reduce our lookup load by 120x&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12697848" name="12943-1-master.txt" size="3683" author="devaraj" created="Tue, 10 Feb 2015 19:34:00 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12775957">HBASE-13067</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 29 Jan 2015 20:16:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            34 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i24ydb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>