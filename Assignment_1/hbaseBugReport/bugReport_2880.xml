<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:05:32 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2880/HBASE-2880.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2880] Hung cluster because master is hung because Get inside synchronize on RegionManager never returned</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2880</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I just ran into this testing 0.89 RC candidate.&lt;/p&gt;

&lt;p&gt;So, Master is hung up because all threads are locked out because one thread is stuck inside a block that is synchronized on RegionManager (0x00007fe1f94777d0 in the below):&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
3277 &lt;span class=&quot;code-quote&quot;&gt;&quot;IPC Server handler 9 on 60000&quot;&lt;/span&gt; daemon prio=10 tid=0x00007fe1dc00f000 nid=0x409d in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x00007fe1e9200000]
3278    java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
3279         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
3280         at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:485)
3281         at org.apache.hadoop.hbase.ipc.HBaseClient.call(HBaseClient.java:732)
3282         - locked &amp;lt;0x00007fe1f8672818&amp;gt; (a org.apache.hadoop.hbase.ipc.HBaseClient$Call)
3283         at org.apache.hadoop.hbase.ipc.HBaseRPC$Invoker.invoke(HBaseRPC.java:252)
3284         at $Proxy1.get(Unknown Source)
3285         at org.apache.hadoop.hbase.master.ServerManager.assignSplitDaughter(ServerManager.java:550)
3286         at org.apache.hadoop.hbase.master.ServerManager.processSplitRegion(ServerManager.java:525)
3287         - locked &amp;lt;0x00007fe1f94777d0&amp;gt; (a org.apache.hadoop.hbase.master.RegionManager)
3288         at org.apache.hadoop.hbase.master.ServerManager.processMsgs(ServerManager.java:476)
3289         at org.apache.hadoop.hbase.master.ServerManager.processRegionServerAllsWell(ServerManager.java:425)
3290         at org.apache.hadoop.hbase.master.ServerManager.regionServerReport(ServerManager.java:335)
3291         at org.apache.hadoop.hbase.master.HMaster.regionServerReport(HMaster.java:738)
3292         at sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)
3293         at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
3294         at java.lang.reflect.Method.invoke(Method.java:597)
3295         at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:576)
3296         at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:919)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The above code is not returning because Call#callComplete is never going to be called on the outstanding Get.  The target RS OOME&apos;d.  Something in the way an OOME is being processed made it so this connection is not ever going to be cleaned up/notified.&lt;/p&gt;

&lt;p&gt;We&apos;re stuck here.&lt;/p&gt;

&lt;p&gt;I&apos;m trying to figure why the clean up is not happening.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12470218">HBASE-2880</key>
            <summary>Hung cluster because master is hung because Get inside synchronize on RegionManager never returned</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Jul 2010 23:45:43 +0000</created>
                <updated>Fri, 20 Nov 2015 12:41:14 +0000</updated>
                            <resolved>Wed, 1 Sep 2010 05:28:58 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12892549" author="stack" created="Mon, 26 Jul 2010 23:58:24 +0000"  >&lt;p&gt;Here is snippet of RS log around OOME:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-07-23 23:25:41,808 DEBUG org.apache.hadoop.hbase.io.hfile.LruBlockCache: LRU Stats: total=152.83 MB, free=44.67 MB, max=197.5 MB, blocks=2396, accesses=206030, hits=792, hitRatio=0.38%%, evictions=64, evicted=19956, evictedPerRun=311.8125
2010-07-23 23:25:43,286 WARN org.apache.hadoop.hbase.regionserver.wal.HLog: IPC Server handler 9 on 60020 took 3835ms appending an edit to hlog; editcount=3
2010-07-23 23:25:45,541 WARN org.apache.hadoop.hbase.regionserver.wal.HLog: IPC Server handler 18 on 60020 took 2255ms appending an edit to hlog; editcount=4
2010-07-23 23:25:59,431 FATAL org.apache.hadoop.hbase.regionserver.HRegionServer: Aborting region server serverName=sv2borg187,60020,1279951359807, load=(requests=32, regions=29, usedHeap=959, maxHeap=987): OutOfMemoryError, aborting
java.lang.OutOfMemoryError: Java heap space
        at java.nio.HeapByteBuffer.&amp;lt;init&amp;gt;(HeapByteBuffer.java:39)
        at java.nio.ByteBuffer.allocate(ByteBuffer.java:312)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Connection.readAndProcess(HBaseServer.java:829)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Listener.doRead(HBaseServer.java:423)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Listener.run(HBaseServer.java:323)
2010-07-23 23:25:59,432 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Dump of metrics: request=0.0, regions=29, stores=30, storefiles=52, storefileIndexSize=8, memstoreSize=505, compactionQueueSize=6, usedHeap=976, maxHeap=987, blockCacheSize=160252032, blockCacheFree=46841728, blockCacheCount=2396, blockCacheHitRatio=0
2010-07-23 23:25:59,432 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server listener on 60020: exiting on OOME
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Pity that the line &apos;2010-07-23 23:25:59,432 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server listener on 60020: exiting on OOME&apos; doesn&apos;t print out its handler name.&lt;/p&gt;

&lt;p&gt;For sure we are in this code from HBaseServer:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (OutOfMemoryError e) {
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (errorHandler != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (errorHandler.checkOOME(e)) {
              LOG.info(getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;: exiting on OOME&quot;&lt;/span&gt;);
              closeCurrentConnection(key);
              cleanupConnections(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
              &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
            }
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So its like closeCurrentConnection or cleanupConnects are not doing right thing.&lt;/p&gt;</comment>
                            <comment id="12892634" author="stack" created="Tue, 27 Jul 2010 03:56:25 +0000"  >&lt;p&gt;So, looking into closeCurrentConnection(key), it looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void closeCurrentConnection(SelectionKey key) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        Connection c = (Connection)key.attachment();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (c != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled())
            LOG.debug(getName() + &lt;span class=&quot;code-quote&quot;&gt;&quot;: disconnecting client &quot;&lt;/span&gt; + c.getHostAddress());
          closeConnection(c);
        }
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The key.attachment must be coming back null because I don&apos;t see the above &apos;disconnecting client&apos; message in logs... here&apos;s more context from the logs:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Error, aborting
java.lang.OutOfMemoryError: Java heap space
        at java.nio.HeapByteBuffer.&amp;lt;init&amp;gt;(HeapByteBuffer.java:39)
        at java.nio.ByteBuffer.allocate(ByteBuffer.java:312)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Connection.readAndProcess(HBaseServer.java:829)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Listener.doRead(HBaseServer.java:423)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Listener.run(HBaseServer.java:323)
2010-07-23 23:25:59,432 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Dump of metrics: request=0.0, regions=29, stores=30, storefiles=52, storefileIndexSize=8, memstoreSize=505, compactionQueueSize=6, usedHeap=976, maxHeap=987, blockCacheSize=160252032, blockCacheFree=46841728, blockCacheCount=2396, blockCacheHitRatio=0
2010-07-23 23:25:59,432 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server listener on 60020: exiting on OOME
2010-07-23 23:26:04,784 INFO org.apache.hadoop.hbase.regionserver.Store: Renaming flushed file at hdfs:&lt;span class=&quot;code-comment&quot;&gt;//sv2borg185:9000/hbase/TestTable/e75047f4cd69996d26eb2d88918e373d/.tmp/4502975447844372826 to hdfs://sv2borg185:9000/hbase/TestTable/e75047f4cd69996d26eb2d88918e373d/info/316784095266859147
&lt;/span&gt;2010-07-23 23:26:04,838 INFO org.apache.hadoop.hbase.regionserver.Store: Added hdfs:&lt;span class=&quot;code-comment&quot;&gt;//sv2borg185:9000/hbase/TestTable/e75047f4cd69996d26eb2d88918e373d/info/316784095266859147, entries=85950, sequenceid=1424, memsize=95.7m, filesize=85.1m to TestTable,0047408745,1279952663377.e75047f4cd69996d26eb2d88918e373d.
&lt;/span&gt;2010-07-23 23:26:04,838 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Caches flushed, doing commit now (which includes update scanners)
2010-07-23 23:26:04,839 INFO org.apache.hadoop.hbase.regionserver.HRegion: Finished memstore flush of ~97.7m &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region TestTable,0047408745,1279952663377.e75047f4cd69996d26eb2d88918e373d. in 29578ms, sequenceid=1424, compaction requested=&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2010-07-23 23:26:04,839 INFO org.apache.hadoop.hbase.regionserver.MemStoreFlusher: regionserver60020.cacheFlusher exiting
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If I grep &apos;disconnecting... &apos; I don&apos;t find it.&lt;/p&gt;</comment>
                            <comment id="12892647" author="stack" created="Tue, 27 Jul 2010 04:56:21 +0000"  >&lt;p&gt;I think i know what happened.&lt;/p&gt;

&lt;p&gt;1. Master receives a split message from a random RS out on cluster:&lt;/p&gt;

&lt;p&gt;2010-07-23 23:25:49,144 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_SPLIT_INCLUDES_DAUGHTERS: TestTable,0085903910,1279952620402.a7e855e8d2c40ad6ac3d2e22b386681c.: Daughters; TestTable,0085903910,1279952729578.13a32aa514a77cbbbe3af50afc4595a1., TestTable,0089244873,1279952729578.a09a030cf17f38c88a8294e05e98c2ae. from sv2borg184,60020,1279951359490; 1 of 1&lt;/p&gt;

&lt;p&gt;We process the above message.  Processing a region split, we synchronize on regionmanager.  Under the regionmanager lock, we go to assign the split daughters.  To be sure, for sure, before putting daughter on to assign queue, we check the daughter hasn&apos;t already been assigned by base scanner.  See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1784&quot; title=&quot;Missing rows after medium intensity insert&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1784&quot;&gt;&lt;del&gt;HBASE-1784&lt;/del&gt;&lt;/a&gt;.  Checking if region hasn&apos;t already been assigned, we do a Get on .META.&lt;/p&gt;

&lt;p&gt;2. At the time of the master Get to .META., the RS hosting .META. OOMEs.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-07-23 23:25:43,286 WARN org.apache.hadoop.hbase.regionserver.wal.HLog: IPC Server handler 9 on 60020 took 3835ms appending an edit to hlog; editcount=3
2010-07-23 23:25:45,541 WARN org.apache.hadoop.hbase.regionserver.wal.HLog: IPC Server handler 18 on 60020 took 2255ms appending an edit to hlog; editcount=4
2010-07-23 23:25:59,431 FATAL org.apache.hadoop.hbase.regionserver.HRegionServer: Aborting region server serverName=sv2borg187,60020,1279951359807, load=(requests=32, regions=29, usedHeap=959, maxHeap=987): OutOfMemoryError, aborting
java.lang.OutOfMemoryError: Java heap space
        at java.nio.HeapByteBuffer.&amp;lt;init&amp;gt;(HeapByteBuffer.java:39)
        at java.nio.ByteBuffer.allocate(ByteBuffer.java:312)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Connection.readAndProcess(HBaseServer.java:829)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Listener.doRead(HBaseServer.java:423)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Listener.run(HBaseServer.java:323)
2010-07-23 23:25:59,432 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Dump of metrics: request=0.0, regions=29, stores=30, storefiles=52, storefileIndexSize=8, memstoreSize=505, compactionQueueSize=6, usedHeap=976, maxHeap=987, blockCacheSize=160252032, blockCacheFree=46841728, blockCacheCount=2396, blockCacheHitRatio=0
2010-07-23 23:25:59,432 INFO org.apache.hadoop.ipc.HBaseServer: IPC Server listener on 60020: exiting on OOME
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This happens ~9 seconds after the master receives the split message.  I checked clocks on the machines and they are aligned.&lt;/p&gt;

&lt;p&gt;It looks like processing the daughter takes a second or so doing zk stuff.  Leading up to an OOME, we&apos;re going to be doing a bunch of GCs so RS is not going to be making progress on any work coming in. Looking in gc logs, indeed I see Ful GC after Full GC w/ some taking multiple seconds and then there is the heap dump in the middle of it all, all of which takes time: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-07-23T23:25:48.068-0700: 1388.920: [Full GC 1388.920: [CMS2010-07-23T23:25:48.157-0700: 1389.010: [CMS-concurrent-mark: 0.149/0.151 secs] [Times: user=0.76 sys=0.03, real=0.15 secs]
 (concurrent mode failure): 895999K-&amp;gt;895999K(896000K), 1.0361460 secs] 1011188K-&amp;gt;980450K(1011200K), [CMS Perm : 17666K-&amp;gt;17666K(29588K)] icms_dc=100 , 1.0362380 secs] [Times: user=1.28 sys=0.01, real=1.04 secs]
2010-07-23T23:25:49.105-0700: 1389.957: [GC [1 CMS-initial-mark: 895999K(896000K)] 980528K(1011200K), 0.0355820 secs] [Times: user=0.04 sys=0.00, real=0.03 secs]
2010-07-23T23:25:49.141-0700: 1389.993: [CMS-concurrent-mark-start]
2010-07-23T23:25:49.160-0700: 1390.012: [Full GC 1390.012: [CMS2010-07-23T23:25:49.281-0700: 1390.134: [CMS-concurrent-mark: 0.139/0.141 secs] [Times: user=0.62 sys=0.01, real=0.14 secs]
 (concurrent mode failure): 895999K-&amp;gt;895999K(896000K), 1.1084360 secs] 1007166K-&amp;gt;982021K(1011200K), [CMS Perm : 17666K-&amp;gt;17666K(29588K)] icms_dc=100 , 1.1085270 secs] [Times: user=1.46 sys=0.00, real=1.11 secs]
2010-07-23T23:25:50.271-0700: 1391.123: [GC [1 CMS-initial-mark: 895999K(896000K)] 991433K(1011200K), 0.0327910 secs] [Times: user=0.04 sys=0.00, real=0.03 secs]
2010-07-23T23:25:50.304-0700: 1391.156: [CMS-concurrent-mark-start]
2010-07-23T23:25:50.309-0700: 1391.161: [Full GC 1391.161: [CMS2010-07-23T23:25:50.430-0700: 1391.282: [CMS-concurrent-mark: 0.125/0.126 secs] [Times: user=0.48 sys=0.02, real=0.13 secs]
 (concurrent mode failure): 895999K-&amp;gt;895999K(896000K), 1.0769650 secs] 1001931K-&amp;gt;998796K(1011200K), [CMS Perm : 17666K-&amp;gt;17666K(29588K)] icms_dc=100 , 1.0770800 secs] [Times: user=1.39 sys=0.03, real=1.08 secs]
2010-07-23T23:25:51.386-0700: 1392.238: [Full GC 1392.238: [CMS[Unloading class sun.reflect.GeneratedMethodAccessor17]
[Unloading class sun.reflect.GeneratedMethodAccessor4]
[Unloading class sun.reflect.GeneratedMethodAccessor9]
[Unloading class sun.reflect.GeneratedMethodAccessor6]
[Unloading class sun.reflect.GeneratedMethodAccessor1]
[Unloading class sun.reflect.GeneratedMethodAccessor10]
[Unloading class sun.reflect.GeneratedMethodAccessor18]
[Unloading class sun.reflect.GeneratedConstructorAccessor22]
: 895999K-&amp;gt;895999K(896000K), 1.0589560 secs] 998796K-&amp;gt;998729K(1011200K), [CMS Perm : 17666K-&amp;gt;17636K(29588K)] icms_dc=100 , 1.0590530 secs] [Times: user=1.06 sys=0.00, real=1.06 secs]
java.lang.OutOfMemoryError: Java heap space
Dumping heap to java_pid1432.hprof ...
2010-07-23T23:25:52.457-0700: 1393.309: [GC [1 CMS-initial-mark: 895999K(896000K)] 998729K(1011200K), 0.0322630 secs] [Times: user=0.04 sys=0.00, real=0.03 secs]
2010-07-23T23:25:52.489-0700: 1393.342: [CMS-concurrent-mark-start]
Heap dump file created [1031291570 bytes in 6.973 secs]
2010-07-23T23:25:59.537-0700: 1400.389: [Full GC 1400.389: [CMS2010-07-23T23:25:59.556-0700: 1400.408: [CMS-concurrent-mark: 0.125/7.067 secs] [Times: user=3.85 sys=1.96, real=7.06 secs]
 (concurrent mode failure): 895999K-&amp;gt;895999K(896000K), 0.9934440 secs] 1011146K-&amp;gt;975171K(1011200K), [CMS Perm : 17638K-&amp;gt;17637K(29588K)] icms_dc=100 , 0.9935330 secs] [Times: user=1.04 sys=0.00, real=0.99 secs]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, the OOME sets the abort and stop flags and we some threads exiting but the weird thing is that the HRS is still up, now, days after the OOME.  The HRS did not go down.&lt;/p&gt;

&lt;p&gt;3. Looking at HRS thread dump, its stuck trying to regionServerReport the master.  It must have gone into reporting master at about the time of the OOME.  We&apos;re stuck here so have not noticed the shutdown flag so, have not shutdown the HRS.&lt;/p&gt;

&lt;p&gt;Here is from master thread dump:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;IPC Server handler 9 on 60000&quot;&lt;/span&gt; daemon prio=10 tid=0x00007fe1dc00f000 nid=0x409d in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x00007fe1e9200000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: WAITING (on object monitor)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.java:485)
        at org.apache.hadoop.hbase.ipc.HBaseClient.call(HBaseClient.java:732)
        - locked &amp;lt;0x00007fe1f8672818&amp;gt; (a org.apache.hadoop.hbase.ipc.HBaseClient$Call)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Invoker.invoke(HBaseRPC.java:252)
        at $Proxy1.get(Unknown Source)
        at org.apache.hadoop.hbase.master.ServerManager.assignSplitDaughter(ServerManager.java:550)
        at org.apache.hadoop.hbase.master.ServerManager.processSplitRegion(ServerManager.java:525)
        - locked &amp;lt;0x00007fe1f94777d0&amp;gt; (a org.apache.hadoop.hbase.master.RegionManager)
        at org.apache.hadoop.hbase.master.ServerManager.processMsgs(ServerManager.java:476)
        at org.apache.hadoop.hbase.master.ServerManager.processRegionServerAllsWell(ServerManager.java:425)
        at org.apache.hadoop.hbase.master.ServerManager.regionServerReport(ServerManager.java:335)
        at org.apache.hadoop.hbase.master.HMaster.regionServerReport(HMaster.java:738)
        at sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:576)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:919)
        
&lt;span class=&quot;code-quote&quot;&gt;&quot;IPC Server handler 8 on 60000&quot;&lt;/span&gt; daemon prio=10 tid=0x00007fe1dc00d000 nid=0x409c waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; monitor entry [0x00007fe1e9301000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: BLOCKED (on object monitor)
        at org.apache.hadoop.hbase.master.ServerManager.processMsgs(ServerManager.java:489)
        - waiting to lock &amp;lt;0x00007fe1f94777d0&amp;gt; (a org.apache.hadoop.hbase.master.RegionManager)
        at org.apache.hadoop.hbase.master.ServerManager.processRegionServerAllsWell(ServerManager.java:425)
        at org.apache.hadoop.hbase.master.ServerManager.regionServerReport(ServerManager.java:335)
        at org.apache.hadoop.hbase.master.HMaster.regionServerReport(HMaster.java:738)
        at sun.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:576) 
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:919)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Two threads are in processRegionServerAllsWell.  One is processing daughter split.  Other is waiting to lock RegionManager so can complete regionServerReport.&lt;/p&gt;

&lt;p&gt;I&apos;m not clear yet on why the HBaseServer is still up though it OOME&apos;d.  I can see Handler&apos;s all up and running still in the bad HRS.&lt;/p&gt;</comment>
                            <comment id="12892650" author="stack" created="Tue, 27 Jul 2010 05:15:15 +0000"  >&lt;p&gt;OK, I don&apos;t see &apos;&quot;: disconnecting client &quot;&apos; from HBaseServer#closeCurrentConnection because I don&apos;t have DEBUG for org.apache.hadoop.ipc.HBaseServer enabled ... and Listener just keeps running though an OOME which would explain handlers still in stack trace.&lt;/p&gt;

</comment>
                            <comment id="12892651" author="stack" created="Tue, 27 Jul 2010 05:17:55 +0000"  >&lt;p&gt;So, if the race condition were removed &amp;#8211; i.e. race between basescanner and master assigning daughters on receipt of the split message &amp;#8211; then this particular lockup would not have happened.&lt;/p&gt;

&lt;p&gt;TODO: Review all of the regionserver locks to see if we&apos;re doing scans or gets while the lock is up.&lt;/p&gt;</comment>
                            <comment id="12902197" author="jdcryans" created="Wed, 25 Aug 2010 00:22:47 +0000"  >&lt;p&gt;Stack, we reviewed the locks and did find a couple of deadlocks recently. Anything could have helped this issue? Can we close?&lt;/p&gt;</comment>
                            <comment id="12902294" author="stack" created="Wed, 25 Aug 2010 04:52:14 +0000"  >&lt;p&gt;This will be fixed by new master.  When new master goes in w/ its zk based assignments and zk triggered server shutdown handling, we shouldn&apos;t run into this cluster deadlock (We&apos;ll just have new types of cluster deadlocks!).  I&apos;ll close this then w/ a note explaining why new master makes it so this can&apos;t happen.&lt;/p&gt;</comment>
                            <comment id="12904920" author="stack" created="Wed, 1 Sep 2010 05:28:58 +0000"  >&lt;p&gt;Fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2692&quot; title=&quot;Master rewrite and cleanup for 0.90&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2692&quot;&gt;&lt;del&gt;HBASE-2692&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Master doesn&apos;t edit .META. any more.  RegionServers do exclusively.  The split message does not provoke assignment anymore either; regionservers handle it all themselves. &lt;/p&gt;

&lt;p&gt;This condition can&apos;t happen in the guise reported above because too much has changed after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2692&quot; title=&quot;Master rewrite and cleanup for 0.90&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2692&quot;&gt;&lt;del&gt;HBASE-2692&lt;/del&gt;&lt;/a&gt; went in.&lt;/p&gt;</comment>
                            <comment id="15016921" author="lars_francke" created="Fri, 20 Nov 2015 12:41:14 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 25 Aug 2010 00:22:47 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26513</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hjo7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100449</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>