<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:24:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5058/HBASE-5058.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5058] Allow HBaseAdmin to use an existing connection</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5058</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;What &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4805&quot; title=&quot;Allow better control of resource consumption in HTable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4805&quot;&gt;&lt;del&gt;HBASE-4805&lt;/del&gt;&lt;/a&gt; does for HTables, this should do for HBaseAdmin.&lt;br/&gt;
Along with this the shared error handling and retrying between HBaseAdmin and HConnectionManager can also be improved. I&apos;ll attach a first pass patch soon.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12535501">HBASE-5058</key>
            <summary>Allow HBaseAdmin to use an existing connection</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12531712">HBASE-4805</parent>
                                    <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Fri, 16 Dec 2011 20:06:47 +0000</created>
                <updated>Fri, 12 Oct 2012 05:35:10 +0000</updated>
                            <resolved>Mon, 19 Dec 2011 23:02:39 +0000</resolved>
                                    <version>0.94.0</version>
                                    <fixVersion>0.94.0</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13171225" author="lhofhansl" created="Fri, 16 Dec 2011 21:48:33 +0000"  >&lt;p&gt;This patch adds an option to use an externally managed HConnection, and also simplifies the retry logic in HBaseAdmin.&lt;/p&gt;

&lt;p&gt;This is a small change, but please review carefully.&lt;/p&gt;</comment>
                            <comment id="13171226" author="lhofhansl" created="Fri, 16 Dec 2011 21:48:51 +0000"  >&lt;p&gt;Test run&lt;/p&gt;</comment>
                            <comment id="13171323" author="hadoopqa" created="Sat, 17 Dec 2011 00:01:01 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12507730/5058.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12507730/5058.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -152 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 76 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestMasterRestartAfterDisablingTable&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/526//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/526//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/526//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/526//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/526//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/526//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13171387" author="lhofhansl" created="Sat, 17 Dec 2011 01:03:59 +0000"  >&lt;p&gt;Both TestMasterRestartAfterDisablingTable and TestReplication pass locally.&lt;/p&gt;</comment>
                            <comment id="13171460" author="stack" created="Sat, 17 Dec 2011 04:56:14 +0000"  >&lt;p&gt;Is this check too generic:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (UndeclaredThrowableException ute) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;For sure if above, you can deduce:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          &lt;span class=&quot;code-comment&quot;&gt;// RPC connection to the master is dead, &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; again&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Will this change behavior?  Or is it that what we have here is dumb?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (MasterNotRunningException mnre) {
-        HConnectionManager.deleteStaleConnection(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.connection);
-        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.connection = HConnectionManager.getConnection(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf);
-      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (UndeclaredThrowableException ute) {
-        HConnectionManager.deleteStaleConnection(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.connection);
-        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.connection = HConnectionManager.getConnection(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf);
+        &lt;span class=&quot;code-comment&quot;&gt;// ignore and &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; again&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If making new patch, fix this javadoc... missing &apos;in&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * The HConnection can be re-used again another attempt.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Otherwise, looks good.&lt;/p&gt;</comment>
                            <comment id="13171481" author="lhofhansl" created="Sat, 17 Dec 2011 07:03:52 +0000"  >&lt;p&gt;Thanks for reviewing stack.&lt;/p&gt;

&lt;p&gt;Re UndeclaredThrowableException. HBaseAdmin used to catch it, but it should have never leaked up to HBaseAdmin. According to the documentation it is &quot;Thrown by a method invocation on a proxy instance...&quot;. I verified experimentally that this exception is indeed thrown when I shutdown the cluster and try to reuse the HConnection (or before the HBaseAdmin) instance. Maybe that is another bug.&lt;/p&gt;

&lt;p&gt;The 2nd part, yeah I think that was just dumb before. There are two levels of retrying. HConnection already has a retry mechanism. That said, it seems that for unmanaged connections (i.e. created by HBaseAdmin itself) the HConnectionManager.HConnectionImplementation.masterChecked would not reset to false. I was thinking about just removing that flag, and that in fact might be a better option. Then every call to HConnection.getMaster would try again, which is as it should be. Let me make a new patch with this.&lt;/p&gt;
</comment>
                            <comment id="13171491" author="lhofhansl" created="Sat, 17 Dec 2011 07:27:06 +0000"  >&lt;p&gt;Seems I need to think about this a bit more. There are subtle threading issues here (the HConnectionImplementation&apos;s master can now suddenly be set to null).&lt;br/&gt;
What I need to ensure that is an unmanaged HConnection ever gets into a state where it just gives up and never retries in the expectation that it will be closed and re-created anyway.&lt;/p&gt;</comment>
                            <comment id="13171714" author="lhofhansl" created="Sun, 18 Dec 2011 00:22:43 +0000"  >&lt;p&gt;Marking this as invalid. HBaseAdmin is not used nearly as often as HTable, and a bit churn through HConnction is not so bad.&lt;/p&gt;

&lt;p&gt;There are layers of retrying (which is bad) and RPC runtime exceptions are passed to up to HBaseAdmin (also bad). But none of those are horrible.&lt;/p&gt;

&lt;p&gt;The entire client needs to be revisited, this is not the jira to do that.&lt;/p&gt;</comment>
                            <comment id="13171720" author="lhofhansl" created="Sun, 18 Dec 2011 00:52:44 +0000"  >&lt;p&gt;Actually, never mind. I have a simple patch now, that bandaids the problem.&lt;/p&gt;</comment>
                            <comment id="13171721" author="lhofhansl" created="Sun, 18 Dec 2011 00:53:37 +0000"  >&lt;p&gt;Simpler patch. Just avoid throwing RPC related runtime exceptions up to the client along with a simple new constructor for HBaseAdmin.&lt;/p&gt;</comment>
                            <comment id="13171783" author="hadoopqa" created="Sun, 18 Dec 2011 06:14:27 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12507817/5058-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12507817/5058-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -152 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 76 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestLogRolling&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestInstantSchemaChange&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/535//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/535//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/535//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/535//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/535//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/535//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13171932" author="lhofhansl" created="Sun, 18 Dec 2011 19:22:30 +0000"  >&lt;p&gt;@stack: are you OK with this patch? &lt;/p&gt;

</comment>
                            <comment id="13171941" author="lhofhansl" created="Sun, 18 Dec 2011 21:05:29 +0000"  >&lt;p&gt;Another option is to unwrap the UndeclaredThrowableException and rethrow the IOException (if any) that caused it. getMaster would then declare IOException rather than ZooKeeperException in its throws clause. That might be the cleanest approach.&lt;/p&gt;</comment>
                            <comment id="13171959" author="stack" created="Sun, 18 Dec 2011 23:24:02 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13171965" author="lhofhansl" created="Sun, 18 Dec 2011 23:41:50 +0000"  >&lt;p&gt;+1 for the patch, or the latest comment? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;(I did explore a patch for the last comment, but it turns out that this will either have API implications - user code now needs to deal with IOException, or it needs a lot of changes to map IOException back other exceptions.)&lt;/p&gt;</comment>
                            <comment id="13172042" author="zhihyu@ebaysf.com" created="Mon, 19 Dec 2011 06:18:11 +0000"  >&lt;p&gt;Since this JIRA is targeting TRUNK, I think change of API should be allowed if we agree it is on the right track.&lt;/p&gt;</comment>
                            <comment id="13172054" author="lhofhansl" created="Mon, 19 Dec 2011 06:52:20 +0000"  >&lt;p&gt;Hmm... Good point. Although I now think my current patch is the safest. I think I would just wrap UndeclaredThrowableException (rather than RuntimeException) into a MasterNotRunning exception, but that&apos;s it.&lt;br/&gt;
There&apos;s also the question what happens when the master moves (2nd master takes over for example). Since the HConnectionImplementation caches the HMasterInterface, it will probably never switch.&lt;/p&gt;

&lt;p&gt;In general this code is a bit messy, which is why I am flip-flopping here... No solution seems quite right.&lt;/p&gt;</comment>
                            <comment id="13172060" author="zhihyu@ebaysf.com" created="Mon, 19 Dec 2011 07:04:52 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-comment&quot;&gt;// If didn&apos;t get the master and &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a managed connection, give up.
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// Otherwise give subsequent calls a chance to &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; again.
&lt;/span&gt;+        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.masterChecked = managed || master != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Judging from the first sentence of the javadoc above, the assignment should be&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.masterChecked = !managed || master != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Basically the negation of RHS becomes: managed &amp;amp;&amp;amp; master == null&lt;/p&gt;</comment>
                            <comment id="13172061" author="lhofhansl" created="Mon, 19 Dec 2011 07:11:34 +0000"  >&lt;p&gt;Actually it is the other way round... &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;masterChecked is set to true to avoid trying to retrieve the master in the future. This is fine for the managed HConnection as it will just be removed and another is created when needed.&lt;br/&gt;
For an HConnection that is passed from the outside, it has to be possible to try again. So if the HConnection is managed we retain the old behavior (i.e. only try once, give up after that, even if that failed).&lt;br/&gt;
For an unmanaged connection we try again unless we actually found a master. So masterChecked is set to true if either the connection is managed (always avoid retrying), or we found a master.&lt;/p&gt;</comment>
                            <comment id="13172068" author="zhihyu@ebaysf.com" created="Mon, 19 Dec 2011 07:33:58 +0000"  >&lt;p&gt;The above description is clearer than the javadoc in the patch (esp. &apos;give up&apos;).&lt;/p&gt;</comment>
                            <comment id="13172071" author="lhofhansl" created="Mon, 19 Dec 2011 07:46:18 +0000"  >&lt;p&gt;Here&apos;s an attempt I can live with.&lt;br/&gt;
Notice how (1) the master null check is pulled into the synchronized block and (2) master is now set to null before the start of the loop (3) sets masterChecked to managed.&lt;/p&gt;

&lt;p&gt;The effect is that the current behavior is not changed. I.e. for a managed connection we try only once. Unmanaged connection get a chance to retry on subsequent calls, and since master is set to null, this would work even when the master has moved since the first attempt.&lt;/p&gt;</comment>
                            <comment id="13172085" author="hadoopqa" created="Mon, 19 Dec 2011 08:18:47 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12507875/5058-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12507875/5058-v3.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -152 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 76 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/541//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/541//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/541//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/541//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/541//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/541//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13172474" author="lhofhansl" created="Mon, 19 Dec 2011 18:32:27 +0000"  >&lt;p&gt;Anybody opposed to the last patch? This is what I would like to commit to trunk...&lt;/p&gt;</comment>
                            <comment id="13172476" author="zhihyu@ebaysf.com" created="Mon, 19 Dec 2011 18:36:06 +0000"  >&lt;p&gt;Hadoop QA didn&apos;t finish test suite:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Running org.apache.hadoop.hbase.replication.TestReplicationSource
Tests run: 1, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.617 sec

Results :

Tests run: 8, Failures: 0, Errors: 0, Skipped: 0

[INFO] ------------------------------------------------------------------------
[INFO] BUILD FAILURE
[INFO] -------------------------------------------------------------
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13172482" author="zhihyu@ebaysf.com" created="Mon, 19 Dec 2011 18:39:57 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Exception contacting master. Retrying...&quot;&lt;/span&gt;, ute.getCause());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Would WARN be better log level ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MasterNotRunningException(sn.toString());
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Looks like assignment to this.masterChecked is missing before returning (for unmanaged case).&lt;/p&gt;</comment>
                            <comment id="13172483" author="stack" created="Mon, 19 Dec 2011 18:40:08 +0000"  >&lt;p&gt;I was +1&apos;ing the patch.  Still +1 (you think it caused hang above?)&lt;/p&gt;</comment>
                            <comment id="13172488" author="lhofhansl" created="Mon, 19 Dec 2011 18:44:01 +0000"  >&lt;p&gt;@stack: I doubt this caused the hang, but I&apos;ll investigate.&lt;br/&gt;
@Ted: The patch just looks weird, the assignment to this.master and the return was pulled into the synchronized statement (because it is now set to null above to allow for retrying).&lt;/p&gt;</comment>
                            <comment id="13172506" author="lhofhansl" created="Mon, 19 Dec 2011 18:57:02 +0000"  >&lt;p&gt;@Ted: I had LOG.info here, because for all other cases below we also log at the info level. The master can come and go, and the clients should still work, so info seems right. Happy to change it to warn if you think that makes more sense.&lt;/p&gt;</comment>
                            <comment id="13172507" author="lhofhansl" created="Mon, 19 Dec 2011 18:57:19 +0000"  >&lt;p&gt;Getting another test run&lt;/p&gt;</comment>
                            <comment id="13172527" author="hadoopqa" created="Mon, 19 Dec 2011 19:15:15 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12507950/5058-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12507950/5058-v3.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -152 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 76 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/548//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/548//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/548//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/548//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/548//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/548//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13172529" author="stack" created="Mon, 19 Dec 2011 19:22:13 +0000"  >&lt;p&gt;My fault.  Compilation error now fixed.&lt;/p&gt;</comment>
                            <comment id="13172530" author="stack" created="Mon, 19 Dec 2011 19:22:55 +0000"  >&lt;p&gt;Resubmit.&lt;/p&gt;</comment>
                            <comment id="13172569" author="lhofhansl" created="Mon, 19 Dec 2011 20:09:04 +0000"  >&lt;p&gt;Thanks Stack!&lt;/p&gt;</comment>
                            <comment id="13172579" author="zhihyu@ebaysf.com" created="Mon, 19 Dec 2011 20:23:03 +0000"  >&lt;p&gt;Log level @ INFO is fine.&lt;/p&gt;</comment>
                            <comment id="13172633" author="hadoopqa" created="Mon, 19 Dec 2011 21:30:46 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12507956/5058-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12507956/5058-v3.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -152 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 76 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestInstantSchemaChange&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/549//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/549//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/549//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/549//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/549//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/549//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13172674" author="lhofhansl" created="Mon, 19 Dec 2011 22:12:58 +0000"  >&lt;p&gt;Ran the three failing tests locally with the patch... They all pass fine.&lt;/p&gt;

&lt;p&gt;@Ted: You OK with the change?&lt;/p&gt;</comment>
                            <comment id="13172683" author="zhihyu@ebaysf.com" created="Mon, 19 Dec 2011 22:28:10 +0000"  >&lt;p&gt;I am fine with the change.&lt;/p&gt;</comment>
                            <comment id="13172714" author="lhofhansl" created="Mon, 19 Dec 2011 23:02:39 +0000"  >&lt;p&gt;Committed to trunk. Also added a very simple test as part of the commit.&lt;/p&gt;</comment>
                            <comment id="13172779" author="lhofhansl" created="Tue, 20 Dec 2011 00:24:41 +0000"  >&lt;p&gt;Thanks for the review Stack and Ted.&lt;br/&gt;
Is it time to rewrite the client, yet? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13172805" author="stack" created="Tue, 20 Dec 2011 00:57:00 +0000"  >&lt;p&gt;Its time. Pull in asynchbase?&lt;/p&gt;</comment>
                            <comment id="13172810" author="zhihyu@ebaysf.com" created="Tue, 20 Dec 2011 01:01:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;Pull in asynchbase?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Why not.&lt;/p&gt;</comment>
                            <comment id="13172884" author="hudson" created="Tue, 20 Dec 2011 03:15:17 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2561 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2561/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2561/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5058&quot; title=&quot;Allow HBaseAdmin to use an existing connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5058&quot;&gt;&lt;del&gt;HBASE-5058&lt;/del&gt;&lt;/a&gt; Allow HBaseAmin to use an existing connection (Lars H)&lt;/p&gt;

&lt;p&gt;larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13172900" author="lhofhansl" created="Tue, 20 Dec 2011 04:10:02 +0000"  >&lt;p&gt;Re: asynchhbase. I could start by creating a jira &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Seriously, we&apos;d have change some things, add missing features, and then maintain it going forward.&lt;/p&gt;</comment>
                            <comment id="13172916" author="stack" created="Tue, 20 Dec 2011 04:42:43 +0000"  >&lt;p&gt;Whats the current state of the case against our current client?&lt;/p&gt;

&lt;p&gt;+ The Jonathan Payne accounting of unaccounted off-heap socket buffers per thread which makes our client OOME when lots of threads&lt;br/&gt;
+ Messy timeout story&lt;br/&gt;
+ &quot;complex&quot;, lots of layers, long-lived zk connection (not necessary on client?)&lt;/p&gt;

&lt;p&gt;What else?&lt;/p&gt;</comment>
                            <comment id="13173029" author="hudson" created="Tue, 20 Dec 2011 08:29:27 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #38 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/38/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/38/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5058&quot; title=&quot;Allow HBaseAdmin to use an existing connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5058&quot;&gt;&lt;del&gt;HBASE-5058&lt;/del&gt;&lt;/a&gt; Allow HBaseAmin to use an existing connection (Lars H)&lt;/p&gt;

&lt;p&gt;larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestFromClientSide.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13173364" author="lhofhansl" created="Tue, 20 Dec 2011 18:11:40 +0000"  >&lt;p&gt;@Stack: I think that about sums it up. The complexity of layers and timeout stories are alleviated somewhat by parent &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4805&quot; title=&quot;Allow better control of resource consumption in HTable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4805&quot;&gt;&lt;del&gt;HBASE-4805&lt;/del&gt;&lt;/a&gt; (no per HTable threadpool, HTablePool no longer needed).&lt;br/&gt;
I had a brief look at the first issue, unless I am missing something this would require a nontrivial amount of refactoring. The simplest would be to do all network IO from the Connection thread rather than the application thread (as described in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4956&quot; title=&quot;Control direct memory buffer consumption by HBaseClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4956&quot;&gt;&lt;del&gt;HBASE-4956&lt;/del&gt;&lt;/a&gt;). Would need allow for the client to synchronize and retrieve exceptions on/from a Future.&lt;/p&gt;

&lt;p&gt;Short term, should we take &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4805&quot; title=&quot;Allow better control of resource consumption in HTable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4805&quot;&gt;&lt;del&gt;HBASE-4805&lt;/del&gt;&lt;/a&gt; all the way and add a getTable(...) method to HConnection? (Or even further and add put/get/scan/etc methods that take a table name to HConnection?)&lt;/p&gt;

&lt;p&gt;Long term a design based on asynchhbase with a thin synchronous layer on top is probably the best option.&lt;/p&gt;</comment>
                            <comment id="13173908" author="stack" created="Wed, 21 Dec 2011 06:34:36 +0000"  >&lt;p&gt;@Lars We already have an issue, hbase-3523 &quot;Rewrite our client (client 2.0)&quot;&lt;/p&gt;</comment>
                            <comment id="13175602" author="lhofhansl" created="Fri, 23 Dec 2011 22:33:56 +0000"  >&lt;p&gt;Ah thanks... I cut and pasted the same into the SVN commit log &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12520646">HBASE-4283</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12507817" name="5058-v2.txt" size="3654" author="lhofhansl" created="Sun, 18 Dec 2011 00:53:37 +0000"/>
                            <attachment id="12507956" name="5058-v3.txt" size="4432" author="stack" created="Mon, 19 Dec 2011 19:22:55 +0000"/>
                            <attachment id="12507950" name="5058-v3.txt" size="4432" author="lhofhansl" created="Mon, 19 Dec 2011 19:00:49 +0000"/>
                            <attachment id="12507730" name="5058.txt" size="3890" author="lhofhansl" created="Fri, 16 Dec 2011 21:48:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 17 Dec 2011 00:01:01 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>221185</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 51 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02gxj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12344</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>