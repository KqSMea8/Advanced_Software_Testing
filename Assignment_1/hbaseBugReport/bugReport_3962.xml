<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:14:37 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3962/HBASE-3962.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3962] HConnectionManager.getConnection(HBaseConfiguration) returns new connection in default HTable constructor</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3962</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The HBase instance are currently indexed by Configuration, which since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1976&quot; title=&quot;HBaseConfiguration implements hashCode() without implementing equals()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1976&quot;&gt;&lt;del&gt;HBASE-1976&lt;/del&gt;&lt;/a&gt; does not have any other equivalence that the object equivalence.&lt;br/&gt;
So, everytime a new configuration is passed to the method a new connection is created.&lt;br/&gt;
If we create many HTable connections with the same configuration, there is no problem:&lt;/p&gt;

&lt;p&gt;HBaseConfiguration config = HBaseConfiguration.create();&lt;br/&gt;
HTable table 1 = new HTable(config, &quot;table1&quot;); // init connection&lt;br/&gt;
HTable table 2 = new HTable(config, &quot;table2&quot;); // re-use connection&lt;br/&gt;
HTable table 3 = new HTable(config, &quot;table3&quot;); // re-use connection&lt;/p&gt;


&lt;p&gt;However, if we call the default constructor, or re-call HBaseConfiguration.create();, we will pass a new instance of the configuration to the constructor. This will cause many connections to be created:&lt;br/&gt;
HTable table 1 = new HTable(&quot;table1&quot;); // init connection&lt;br/&gt;
HTable table 2 = new HTable(&quot;table2&quot;); // init new connection&lt;br/&gt;
HTable table 3 = new HTable(&quot;table3&quot;); // init new connection&lt;/p&gt;

&lt;p&gt;I know connection should be pooled, but sometimes we have to create a new connection, and without having access to a previously instanced configuration object.&lt;br/&gt;
Since zookeeper has a max client connection (default was 30, now is 10), after creating 30 instances of HTable, we can no longer access to the database.&lt;/p&gt;

&lt;p&gt;In addition to this, the HBASE_INSTANCES map does not close the connection when removing the eldest entry. So if we have a larger maxConnection value than the hard-coded MAX_CACHED_HBASE_INSTANCES variable, connections will remain but won&apos;t be closed. MAX_CACHED_HBASE_INSTANCES should actually be set from the hbase.zookeeper.property.maxClientCnxns parameter (value + 1).&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12509593">HBASE-3962</key>
            <summary>HConnectionManager.getConnection(HBaseConfiguration) returns new connection in default HTable constructor</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="guinotphil">Philippe</reporter>
                        <labels>
                    </labels>
                <created>Wed, 8 Jun 2011 14:44:58 +0000</created>
                <updated>Wed, 29 Aug 2012 18:20:49 +0000</updated>
                            <resolved>Wed, 29 Aug 2012 18:20:49 +0000</resolved>
                                    <version>0.90.1</version>
                                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13046138" author="yuzhihong@gmail.com" created="Wed, 8 Jun 2011 19:09:57 +0000"  >&lt;p&gt;In trunk, HConnectionManager.getConnection() constructs HConnectionKey from Configuration. Meaning, the identity of Configuration has been redefined.&lt;br/&gt;
Also, connection is closed in finalizer.&lt;/p&gt;</comment>
                            <comment id="13047262" author="guinotphil" created="Fri, 10 Jun 2011 15:58:09 +0000"  >&lt;p&gt;Hi,&lt;/p&gt;

&lt;p&gt;Thank you very much for your message. I did check the code source from the latest release, but not of the trunk actually. It seems you covered all the points I mentioned. Great !&lt;/p&gt;

&lt;p&gt;However, I&#8217;m not really sure about a couple of things:&lt;/p&gt;

&lt;p&gt;a) If I use the &#8216;same&#8217; configuration each time I create a table, I&#8217;ll use the same connection then. I have a server that connects to HBase. Isn&#8217;t there a performance issue if the server will use only one connection to the quorum? As the quorum allows me to MAX_CLIENT_CNXNS connections, should we use as many connections as possible instead of just one for the same configuration?&lt;/p&gt;

&lt;p&gt;b) The number of cached HConnection are now related to the number of connections allowed by the zookeeper ensemble. But if I pass different configuration, can&#8217;t they supposed to use different zookeeper quorum (I guess that may be an extremely rare case)? If so, is there really a point to limit the number of cached HConnections?&lt;/p&gt;

</comment>
                            <comment id="13047441" author="yuzhihong@gmail.com" created="Fri, 10 Jun 2011 20:44:47 +0000"  >&lt;p&gt;For a, I don&apos;t think there is performance impact. Once 0.92 branch is made, we can see some real performance numbers.&lt;br/&gt;
For b, you can use different zookeeper quorum.&lt;/p&gt;</comment>
                            <comment id="13444290" author="lhofhansl" created="Wed, 29 Aug 2012 18:20:49 +0000"  >&lt;p&gt;Since we have this solved in 0.92+ I am closing this.&lt;br/&gt;
Please reopen if you disagree.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 8 Jun 2011 19:09:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27108</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 16 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hoq7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101268</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>zookeeper, configuration, connection, connectionManager, instances</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>