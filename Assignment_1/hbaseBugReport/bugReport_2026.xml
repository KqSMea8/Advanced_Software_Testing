<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:58:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2026/HBASE-2026.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2026] NPE in StoreScanner on compaction</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2026</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From Zhenyu:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-12-01 00:35:05,321 INFO org.apache.hadoop.hbase.regionserver.HRegion: Starting compaction on region ip_info_238,41.214.148.221,1259132082707
2009-12-01 00:35:05,572 WARN org.apache.hadoop.hbase.regionserver.Store: Not in setorg.apache.hadoop.hbase.regionserver.StoreScanner@7f821a6c
2009-12-01 00:35:05,572 WARN org.apache.hadoop.hbase.regionserver.Store: Not in setorg.apache.hadoop.hbase.regionserver.StoreScanner@7f821a6c
2009-12-01 00:35:05,572 ERROR org.apache.hadoop.hbase.regionserver.CompactSplitThread: Compaction failed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region ip_info_238,41.214.148.221,1259132082707
java.lang.NullPointerException
	at org.apache.hadoop.hbase.regionserver.StoreScanner.updateReaders(StoreScanner.java:250)
	at org.apache.hadoop.hbase.regionserver.Store.notifyChangedReadersObservers(Store.java:628)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12442278">HBASE-2026</key>
            <summary>NPE in StoreScanner on compaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Dec 2009 22:53:55 +0000</created>
                <updated>Fri, 12 Oct 2012 06:14:15 +0000</updated>
                            <resolved>Mon, 28 Dec 2009 18:43:06 +0000</resolved>
                                    <version>0.20.2</version>
                                    <fixVersion>0.20.3</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12785189" author="stack" created="Thu, 3 Dec 2009 05:41:36 +0000"  >&lt;p&gt;Here is updateReaders with line numbers from 0.20:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
232   &lt;span class=&quot;code-comment&quot;&gt;// Implementation of ChangedReadersObserver
&lt;/span&gt;233   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void updateReaders() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
234     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.closing.get()) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
235     KeyValue topKey = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.peek();
236     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (topKey == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
237     List&amp;lt;KeyValueScanner&amp;gt; scanners = getScanners();
238 
239     &lt;span class=&quot;code-comment&quot;&gt;// Seek all scanners to the initial key
&lt;/span&gt;240     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;(KeyValueScanner scanner : scanners) {
241       scanner.seek(topKey);
242     }
243 
244     &lt;span class=&quot;code-comment&quot;&gt;// Combine all seeked scanners with a heap
&lt;/span&gt;245     heap = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KeyValueHeap(
246         scanners.toArray(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; KeyValueScanner[scanners.size()]), store.comparator);
247 
248     &lt;span class=&quot;code-comment&quot;&gt;// Reset the state of the Query Matcher and set to top row
&lt;/span&gt;249     matcher.reset();
250     matcher.setRow(heap.peek().getRow());
251   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;heap.peek is returning null?&lt;/p&gt;
</comment>
                            <comment id="12785190" author="stack" created="Thu, 3 Dec 2009 05:42:01 +0000"  >&lt;p&gt;I see two instances of this exception in the Zhenyu logs.&lt;/p&gt;</comment>
                            <comment id="12785450" author="jdcryans" created="Thu, 3 Dec 2009 19:00:13 +0000"  >&lt;p&gt;From the peek() javadoc:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Retrieves, but does not remove, the head of this queue, or returns null if this queue is empty. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So this is dangerous.&lt;/p&gt;</comment>
                            <comment id="12785475" author="stack" created="Thu, 3 Dec 2009 20:00:30 +0000"  >&lt;p&gt;So easy fix?  Weird it has taken this long to show.  Good stuff&lt;/p&gt;</comment>
                            <comment id="12785478" author="jdcryans" created="Thu, 3 Dec 2009 20:12:40 +0000"  >&lt;p&gt;Easy fix I&apos;m not sure... We could check for null and then not set the row but I&apos;m not sure what&apos;s going to be the resulting behavior. I&apos;m also not even sure how we can get into that state, I&apos;ll try to write a unit test.&lt;/p&gt;</comment>
                            <comment id="12785498" author="stack" created="Thu, 3 Dec 2009 20:31:22 +0000"  >&lt;p&gt;I see. If the heap has nothing in it, then matcher should be set to the end?  Or start?   There are no Readers?&lt;/p&gt;</comment>
                            <comment id="12786206" author="streamy" created="Fri, 4 Dec 2009 22:35:45 +0000"  >&lt;p&gt;If the KVHeap returns null that means the scanners are done.  They all get seeked to whichever the last key was before the reader update, which could be no more keys.&lt;/p&gt;

&lt;p&gt;Should check for null from the heap, and if null then can set the row to whatever is in topKey.  I think the scanner consumers will know what to do from there.  Definitely needs unit test.&lt;/p&gt;

&lt;p&gt;Can look at patches but don&apos;t have any time to write one.&lt;/p&gt;</comment>
                            <comment id="12788822" author="jdcryans" created="Thu, 10 Dec 2009 18:32:03 +0000"  >&lt;p&gt;You mean something like this Jon?&lt;/p&gt;</comment>
                            <comment id="12794864" author="jdcryans" created="Mon, 28 Dec 2009 18:43:06 +0000"  >&lt;p&gt;I&apos;m committing my patch to both branch and trunk as it at least won&apos;t throw an NPE. If someone is ever able to unit test it, that would be great, because I wasn&apos;t able to.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12427618" name="HBASE-2026.patch" size="585" author="jdcryans" created="Thu, 10 Dec 2009 18:32:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Dec 2009 05:41:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26107</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 51 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08tbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49349</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>