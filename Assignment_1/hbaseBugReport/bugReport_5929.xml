<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:32:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5929/HBASE-5929.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5929] HBaseAdmin.compact and flush are giving confusing errors for ROOT, META, and regions that don&apos;t exist</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5929</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I have been noticing that calls to HBaseAdmin.majorCompact throws exceptions randomly for some regions.  I could not find a pattern to these exception.  The code I have simply does this admin.majorCompact(region.getRegionNameAsString()).  admin is an instance of HBaseAdmin and region is an instance of HRegionInfo.  The exception I get is &lt;/p&gt;

&lt;p&gt;org.apache.hadoop.hbase.TableNotFoundException: &lt;del&gt;ROOT&lt;/del&gt;,,0&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HBaseAdmin.tableNameString(HBaseAdmin.java:1473) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;hbase-0.92.1.jar:0.92.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HBaseAdmin.compact(HBaseAdmin.java:1235) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;hbase-0.92.1.jar:0.92.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HBaseAdmin.majorCompact(HBaseAdmin.java:1209) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;hbase-0.92.1.jar:0.92.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at com.stumbleupon.hbaseadmin.HBaseCompact.compactAllServers(Unknown Source) &lt;span class=&quot;error&quot;&gt;&amp;#91;hbase_compact.jar:na&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;In this case it&apos;s the root region, but I get similar exceptions for other tables, like this.&lt;/p&gt;


&lt;p&gt;2012-05-03 19:03:42,994 WARN  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; HBaseCompact: Could not compact:&lt;br/&gt;
org.apache.hadoop.hbase.TableNotFoundException: ad_daily,49842:2009-07-10,1269763588508.1997607018&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HBaseAdmin.tableNameString(HBaseAdmin.java:1473) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;hbase-0.92.1.jar:0.92.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HBaseAdmin.compact(HBaseAdmin.java:1235) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;hbase-0.92.1.jar:0.92.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HBaseAdmin.majorCompact(HBaseAdmin.java:1209) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;hbase-0.92.1.jar:0.92.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at org.apache.hadoop.hbase.client.HBaseAdmin.majorCompact(HBaseAdmin.java:1196) ~&lt;span class=&quot;error&quot;&gt;&amp;#91;hbase-0.92.1.jar:0.92.1&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at com.stumbleupon.hbaseadmin.HBaseCompact.compactAllServers(Unknown Source) &lt;span class=&quot;error&quot;&gt;&amp;#91;hbase_compact.jar:na&amp;#93;&lt;/span&gt;&lt;br/&gt;
        at com.stumbleupon.hbaseadmin.HBaseCompact.main(Unknown Source) &lt;span class=&quot;error&quot;&gt;&amp;#91;hbase_compact.jar:na&amp;#93;&lt;/span&gt;&lt;/p&gt;


&lt;p&gt;I see this on hbase shell as well.  However, I don&apos;t see these exceptions if I use admin.majorCompact(region.getRegionName()), so it looks like something gets lost when I use getRegionNameAsString().&lt;/p&gt;

&lt;p&gt;Let me know if I can provide more information.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Linux Ubuntu Lucid 64bit&lt;/p&gt;</environment>
        <key id="12553811">HBASE-5929</key>
            <summary>HBaseAdmin.compact and flush are giving confusing errors for ROOT, META, and regions that don&apos;t exist</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="aravindg">Aravind Gottipati</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 May 2012 19:07:29 +0000</created>
                <updated>Sat, 11 Apr 2015 01:30:35 +0000</updated>
                            <resolved>Sat, 11 Apr 2015 01:30:35 +0000</resolved>
                                    <version>0.92.1</version>
                                                    <component>Client</component>
                    <component>shell</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13267753" author="stack" created="Thu, 3 May 2012 19:59:09 +0000"  >&lt;p&gt;This seems uninterpretable as table name or region name &apos;org.apache.hadoop.hbase.TableNotFoundException: ROOT,,0&apos;... I&apos;d have expected it to be &quot;&lt;del&gt;ROOT&lt;/del&gt;,,0&quot; if hbase was to have any chance?  Is this coming in via jruby mighty Aravind?  Does &apos;ad_daily,49842:2009-07-10,1269763588508.1997607018&apos; exist on the cluster? (I know I should look myself....).&lt;/p&gt;</comment>
                            <comment id="13267792" author="aravindg" created="Thu, 3 May 2012 20:55:38 +0000"  >&lt;p&gt;Here is the output from hbase shell for a similar table:&lt;/p&gt;

&lt;p&gt;hbase(main):004:0&amp;gt; major_compact &apos;ad_campaign_daily_stumbles,81738:2009-02-08,1269765634190.1290583321&apos;&lt;/p&gt;

&lt;p&gt;ERROR: Unknown table ad_campaign_daily_stumbles,81738:2009-02-08,1269765634190.1290583321!&lt;/p&gt;

&lt;p&gt;Here is some help for this command:&lt;br/&gt;
Run major compaction on passed table or pass a region row&lt;br/&gt;
to major compact an individual region&lt;/p&gt;


&lt;p&gt;hbase(main):005:0&amp;gt;&lt;/p&gt;

&lt;p&gt;I get these region names by querying the HRegionInterface of the server, and then proceed to compress them.  This is all on the dev cluster (if you want to replicate/test).&lt;/p&gt;</comment>
                            <comment id="13270943" author="jdcryans" created="Tue, 8 May 2012 23:58:38 +0000"  >&lt;p&gt;The reason it doesn&apos;t work with META is because we don&apos;t write the full meta row names in ROOT. The row key should be &quot;.META.,,1.1028785192&quot; but if I scan ROOT I see:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt; .META.,,1                                                       column=info:regioninfo, timestamp=1336512980545, value=....                                                        &lt;br/&gt;
 .META.,,1                                                       column=info:server, timestamp=1336512994161, value=h-25-183.sfo.stumble.net:50063                                                                                                          &lt;br/&gt;
 .META.,,1                                                       column=info:serverstartcode, timestamp=1336512994161, value=1336512979497                                                                                                                  &lt;br/&gt;
 .META.,,1                                                       column=info:v, timestamp=1336512980545, value=\x00\x00    &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;It&apos;s missing the encoded name. That won&apos;t work. Requesting the compaction of a root region won&apos;t work either because the code that figures out if a region or a table is passed depends on MetaReader.getCatalogHTable which doesn&apos;t take ROOT regions (which is normal since the ROOT address isn&apos;t contained in an HTable but in ZK).&lt;/p&gt;

&lt;p&gt;For the other regions that had that issue, it was a bad interaction in our code where the scan of .META. is done possible hours before the call for compaction is issued. I was able to confirm that all the regions that were affected had been recently split.&lt;/p&gt;

&lt;p&gt;The issues that remain:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;It&apos;s impossible to compact the root region directly, but calling compact on the table itself works.&lt;/li&gt;
	&lt;li&gt;It&apos;s possible to compact the meta region directly but the user needs to pass &quot;.META.,,1&quot; instead of the full region name.&lt;/li&gt;
	&lt;li&gt;Trying to compact a region that doesn&apos;t exist throws a TableNotFoundException, which confuses the user.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;d say that this is minor but we should probably fix for usability.&lt;/p&gt;</comment>
                            <comment id="13270944" author="jdcryans" created="Wed, 9 May 2012 00:00:31 +0000"  >&lt;p&gt;Fixing the title.&lt;/p&gt;</comment>
                            <comment id="13270946" author="jdcryans" created="Wed, 9 May 2012 00:01:07 +0000"  >&lt;p&gt;Fixing the title.&lt;/p&gt;</comment>
                            <comment id="13271054" author="jdcryans" created="Wed, 9 May 2012 03:57:56 +0000"  >&lt;p&gt;I spawed &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5969&quot; title=&quot;HRI.getRegionName/AsString are inconsistent for regions with the old encoding scheme&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5969&quot;&gt;HBASE-5969&lt;/a&gt; for the apparent randomness of the issue with the region that&apos;s pre 0.89&lt;/p&gt;</comment>
                            <comment id="14490691" author="apurtell" created="Sat, 11 Apr 2015 01:30:35 +0000"  >&lt;p&gt;Reopen if still an issue with current code&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 May 2012 19:59:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>238022</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02bj3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11469</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>