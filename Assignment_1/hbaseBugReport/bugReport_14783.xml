<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:56:25 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14783/HBASE-14783.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14783] Proc-V2: Master aborts when downgrading from 1.3 to 1.1</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14783</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I was running ITBLL with 1.3 deployed on a 6 node cluster.&lt;/p&gt;

&lt;p&gt;Then I stopped the cluster, deployed 1.1 release and tried to start cluster.&lt;br/&gt;
However, master failed to start due to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-11-06 00:58:40,351 FATAL [eval-test-2:20000.activeMasterManager] master.HMaster: Failed to become active master
java.io.IOException: The procedure class org.apache.hadoop.hbase.master.procedure.ServerCrashProcedure must be accessible and have an empty constructor
  at org.apache.hadoop.hbase.procedure2.Procedure.newInstance(Procedure.java:548)
  at org.apache.hadoop.hbase.procedure2.Procedure.convert(Procedure.java:640)
  at org.apache.hadoop.hbase.procedure2.store.wal.ProcedureWALFormatReader.read(ProcedureWALFormatReader.java:105)
  at org.apache.hadoop.hbase.procedure2.store.wal.ProcedureWALFormat.load(ProcedureWALFormat.java:82)
  at org.apache.hadoop.hbase.procedure2.store.wal.WALProcedureStore.load(WALProcedureStore.java:298)
  at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.load(ProcedureExecutor.java:275)
  at org.apache.hadoop.hbase.procedure2.ProcedureExecutor.start(ProcedureExecutor.java:434)
  at org.apache.hadoop.hbase.master.HMaster.startProcedureExecutor(HMaster.java:1208)
  at org.apache.hadoop.hbase.master.HMaster.startServiceThreads(HMaster.java:1107)
  at org.apache.hadoop.hbase.master.HMaster.finishActiveMasterInitialization(HMaster.java:694)
  at org.apache.hadoop.hbase.master.HMaster.access$500(HMaster.java:186)
  at org.apache.hadoop.hbase.master.HMaster$1.run(HMaster.java:1713)
  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:745)
Caused by: java.lang.ClassNotFoundException: org.apache.hadoop.hbase.master.procedure.ServerCrashProcedure
  at java.net.URLClassLoader$1.run(URLClassLoader.java:366)
  at java.net.URLClassLoader$1.run(URLClassLoader.java:355)
  at java.security.AccessController.doPrivileged(Native Method)
  at java.net.URLClassLoader.findClass(URLClassLoader.java:354)
  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:425)
  at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:308)
  at java.lang.&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.loadClass(&lt;span class=&quot;code-object&quot;&gt;ClassLoader&lt;/span&gt;.java:358)
  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName0(Native Method)
  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.forName(&lt;span class=&quot;code-object&quot;&gt;Class&lt;/span&gt;.java:191)
  at org.apache.hadoop.hbase.procedure2.Procedure.newInstance(Procedure.java:536)
  ... 12 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The cause was that ServerCrashProcedure, written in some WAL file under MasterProcWALs from first run, was absent in 1.1 release.&lt;/p&gt;

&lt;p&gt;After a brief discussion with Stephen, I am logging this JIRA to solicit discussion on how customer experience can be improved if downgrade of hbase is performed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12911231">HBASE-14783</key>
            <summary>Proc-V2: Master aborts when downgrading from 1.3 to 1.1</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="syuanjiang">Stephen Yuan Jiang</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Nov 2015 22:17:14 +0000</created>
                <updated>Wed, 24 Feb 2016 00:03:41 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14994568" author="syuanjiang" created="Fri, 6 Nov 2015 22:22:19 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt; for reporting this.  &lt;/p&gt;

&lt;p&gt;We are keeping adding new procedure types in new releases.  If a customer does not like the new release after upgrade; if they downgrade, they could hit this issue (newly introduced procedure type could not be replayed in older release.)  &lt;/p&gt;

&lt;p&gt;One solution is that during procedure load, ignore the ClassNotFoundException and log a warning or error in exception and continue.&lt;/p&gt;</comment>
                            <comment id="14994605" author="mbertozzi" created="Fri, 6 Nov 2015 22:41:29 +0000"  >&lt;p&gt;there are 3 problems here&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;on a not clean shutdown your cluster is in a non consistent state, starting the master and ignoring the exception is a bad idea. you have run hbck or you can restart the cluster and do a clean shutdown before the downgrade.&lt;/li&gt;
	&lt;li&gt;on a clean shutdown and restart with lower version you will not have procedure running. so nothing to load and you&apos;ll not hit this problem&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;the 3rd problem is related to how we load, completed procedures (but not yet deleted) are loaded using convert() which creates a Procedure instance, but we don&apos;t really need that. in fact we remove that instance later when we realize that we just need the result. so even in case of a clean shutdown we may get the exception because we are trying to call convert().&lt;/p&gt;</comment>
                            <comment id="14994808" author="stack" created="Sat, 7 Nov 2015 01:03:17 +0000"  >&lt;p&gt;We do not support downgrade. Never have. Its a bunch of work &amp;#8211; code-wise and testing-wise. Suggest we close this issue as invalid.&lt;/p&gt;</comment>
                            <comment id="14994816" author="mbertozzi" created="Sat, 7 Nov 2015 01:11:59 +0000"  >&lt;p&gt;we can change the title to change the load code, my step 3. which was something that I was going to do anyway just to save some ops on load&lt;/p&gt;</comment>
                            <comment id="14994884" author="stack" created="Sat, 7 Nov 2015 02:14:15 +0000"  >&lt;p&gt;If folks want to support downgrade, need to raise on the dev list. I went looking for where we explicitly state &lt;span class=&quot;error&quot;&gt;&amp;#91;that we do not support downgrade&amp;#93;&lt;/span&gt; in the refguide but all I found was the bit in our section on semver that says even between patch versions, downgrade may not be possible. See toward end of &lt;a href=&quot;http://hbase.apache.org/book.html#hbase.versioning.post10&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hbase.apache.org/book.html#hbase.versioning.post10&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12929950">HBASE-15100</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 Nov 2015 22:22:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 5 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2o353:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>