<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:54:08 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8325/HBASE-8325.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8325] ReplicationSource read a empty HLog throws EOFException</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8325</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I&apos;m using  the replication of Hbase in my test environment.&lt;/p&gt;

&lt;p&gt;When a replicationSource open a empty HLog, the EOFException throws. &lt;br/&gt;
It is because the Reader can&apos;t read the SequenceFile&apos;s meta data, but there&apos;s no data at all, so it throws the EOFException.&lt;br/&gt;
Should we detect the empty file and processed it, like we process the FileNotFoundException?&lt;/p&gt;

&lt;p&gt;here&apos;s the code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
   * Open a reader on the current path
   *
   * @param sleepMultiplier by how many times the &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; sleeping time is augmented
   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we should &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; with that file, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we are over with it
   */
  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; openReader(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; sleepMultiplier) {
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Opening log &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; replication &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.currentPath.getName() +
          &lt;span class=&quot;code-quote&quot;&gt;&quot; at &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.repLogReader.getPosition());
      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.reader = repLogReader.openReader(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.currentPath);
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (FileNotFoundException fnfe) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.queueRecovered) {
          &lt;span class=&quot;code-comment&quot;&gt;// We didn&apos;t find the log in the archive directory, look &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; it still
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// exists in the dead RS folder (there could be a chain of failures
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// to look at)
&lt;/span&gt;          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;NB dead servers : &quot;&lt;/span&gt; + deadRegionServers.length);
          &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadRegionServers.length - 1; i &amp;gt;= 0; i--) {

            Path deadRsDirectory =
                &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(manager.getLogDir().getParent(), &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadRegionServers[i]);
            Path[] locs = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path[] {
                &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(deadRsDirectory, currentPath.getName()),
                &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(deadRsDirectory.suffix(HLog.SPLITTING_EXT),
                                          currentPath.getName()),
            };
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Path possibleLogLocation : locs) {
              LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Possible location &quot;&lt;/span&gt; + possibleLogLocation.toUri().toString());
              &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.manager.getFs().exists(possibleLogLocation)) {
                &lt;span class=&quot;code-comment&quot;&gt;// We found the right &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; location
&lt;/span&gt;                LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Log &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.currentPath + &lt;span class=&quot;code-quote&quot;&gt;&quot; still exists at &quot;&lt;/span&gt; +
                    possibleLogLocation);
                &lt;span class=&quot;code-comment&quot;&gt;// Breaking here will make us sleep since reader is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
&lt;/span&gt;                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
              }
            }
          }
          &lt;span class=&quot;code-comment&quot;&gt;// TODO What happens &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the log was missing from every single location?
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// Although we need to check a couple of times as the log could have
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// been moved by the master between the checks
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// It can also happen &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a recovered queue wasn&apos;t properly cleaned,
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// such that the znode pointing to a log exists but the log was
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// deleted a &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; time ago.
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// For the moment, we&apos;ll &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; the IO and processEndOfFile
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;File from recovered queue is &quot;&lt;/span&gt; +
              &lt;span class=&quot;code-quote&quot;&gt;&quot;nowhere to be found&quot;&lt;/span&gt;, fnfe);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          &lt;span class=&quot;code-comment&quot;&gt;// If the log was archived, &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; reading from there
&lt;/span&gt;          Path archivedLogLocation =
              &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Path(manager.getOldLogDir(), currentPath.getName());
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.manager.getFs().exists(archivedLogLocation)) {
            currentPath = archivedLogLocation;
            LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Log &quot;&lt;/span&gt; + &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.currentPath + &lt;span class=&quot;code-quote&quot;&gt;&quot; was moved to &quot;&lt;/span&gt; +
                archivedLogLocation);
            &lt;span class=&quot;code-comment&quot;&gt;// Open the log at the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; location
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.openReader(sleepMultiplier);

          }
          &lt;span class=&quot;code-comment&quot;&gt;// TODO What happens the log is missing in both places?
&lt;/span&gt;        }
      }
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe) {
      LOG.warn(peerClusterZnode + &lt;span class=&quot;code-quote&quot;&gt;&quot; Got: &quot;&lt;/span&gt;, ioe);
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.reader = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
      &lt;span class=&quot;code-comment&quot;&gt;// TODO Need a better way to determinate &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; a file is really gone but
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// TODO without scanning all logs dir
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sleepMultiplier == &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.maxRetriesMultiplier) {
        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Waited too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file, considering dumping&quot;&lt;/span&gt;);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; !processEndOfFile();
      }
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;there&apos;s a method called &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;processEndOfFile()&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;should we add this case in it?&lt;/p&gt;</description>
                <environment>&lt;p&gt;replication enabled&lt;/p&gt;</environment>
        <key id="12642011">HBASE-8325</key>
            <summary>ReplicationSource read a empty HLog throws EOFException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="zavakid">zavakid</reporter>
                        <labels>
                    </labels>
                <created>Thu, 11 Apr 2013 10:19:16 +0000</created>
                <updated>Tue, 4 Jun 2013 00:06:56 +0000</updated>
                            <resolved>Tue, 28 May 2013 05:15:40 +0000</resolved>
                                    <version>0.94.5</version>
                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.94.8</fixVersion>
                    <fixVersion>0.95.1</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13628871" author="jmspaggi" created="Thu, 11 Apr 2013 12:17:09 +0000"  >&lt;p&gt;Makes sense. Also, there is many &quot;TODO&quot; here too... Might be good to see if there is a say to clear some of them?&lt;/p&gt;</comment>
                            <comment id="13629135" author="jeffreyz" created="Thu, 11 Apr 2013 17:21:55 +0000"  >&lt;p&gt;In some cases, the latest WAL could have empty size. While I think the situation is covered in catch block &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException ioe)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;. After the function, we have some sleep to wait for the wal to have some data. &lt;/p&gt;

&lt;p&gt;To me, it seems the excessive logging from &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;LOG.warn(peerClusterZnode + &lt;span class=&quot;code-quote&quot;&gt;&quot; Got: &quot;&lt;/span&gt;, ioe);&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; for EOF is not ideal as the situation could happen in normal cases.&lt;/p&gt;</comment>
                            <comment id="13629281" author="v.himanshu" created="Thu, 11 Apr 2013 19:58:27 +0000"  >&lt;p&gt;Yes, HBase-7122 takes care of that.&lt;/p&gt;</comment>
                            <comment id="13629652" author="jeason" created="Fri, 12 Apr 2013 01:02:23 +0000"  >&lt;p&gt;Aggree, the latest patch in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7122&quot; title=&quot;Proper warning message when opening a log file with no entries (idle cluster)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7122&quot;&gt;&lt;del&gt;HBASE-7122&lt;/del&gt;&lt;/a&gt; covers this issue, I suggest to resolve this issue as &quot;duplicate&quot;. &lt;/p&gt;</comment>
                            <comment id="13629685" author="zavakid" created="Fri, 12 Apr 2013 01:55:50 +0000"  >&lt;p&gt;It seems fixed in 0.95.1, and do we have any plan to patch it in the 0.94 ?&lt;/p&gt;</comment>
                            <comment id="13629759" author="xieliang007" created="Fri, 12 Apr 2013 04:00:36 +0000"  >&lt;p&gt;Hi &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zavakid&quot; class=&quot;user-hover&quot; rel=&quot;zavakid&quot;&gt;zavakid&lt;/a&gt;, the current status of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7122&quot; title=&quot;Proper warning message when opening a log file with no entries (idle cluster)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7122&quot;&gt;&lt;del&gt;HBASE-7122&lt;/del&gt;&lt;/a&gt; is still Patch Available, we can backport it to 0.94 once it&apos;s resolved. Hope it&apos;s helpful for you&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13668046" author="yuzhihong@gmail.com" created="Tue, 28 May 2013 03:32:07 +0000"  >&lt;p&gt;Now that &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7122&quot; title=&quot;Proper warning message when opening a log file with no entries (idle cluster)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7122&quot;&gt;&lt;del&gt;HBASE-7122&lt;/del&gt;&lt;/a&gt; has been integrated into 0.94, can we resolve this JIRA ?&lt;/p&gt;</comment>
                            <comment id="13668098" author="zavakid" created="Tue, 28 May 2013 05:17:45 +0000"  >&lt;p&gt;close it, thanks guys &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 11 Apr 2013 12:17:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322425</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 29 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jmon:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322770</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>