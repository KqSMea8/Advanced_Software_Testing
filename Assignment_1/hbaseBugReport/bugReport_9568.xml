<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:05:38 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9568/HBASE-9568.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9568] backport HBASE-6508 to 0.94</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9568</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6508&quot; title=&quot;[0.89-fb] Filter out edits at log split time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6508&quot;&gt;&lt;del&gt;HBASE-6508&lt;/del&gt;&lt;/a&gt;: Filter out edits at log split time to hbase 0.94&lt;/p&gt;</description>
                <environment></environment>
        <key id="12669177">HBASE-9568</key>
            <summary>backport HBASE-6508 to 0.94</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="liushaohui">Liu Shaohui</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Sep 2013 03:46:58 +0000</created>
                <updated>Thu, 16 Apr 2015 08:23:00 +0000</updated>
                                                                            <component>MTTR</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13777150" author="liushaohui" created="Wed, 25 Sep 2013 04:54:34 +0000"  >&lt;p&gt;Can anyone help to review this patch? And I will try backport this patch to hbase trunk.&lt;/p&gt;</comment>
                            <comment id="13777675" author="sershe" created="Wed, 25 Sep 2013 16:02:35 +0000"  >&lt;p&gt;can you post to RB or phabricator?&lt;br/&gt;
Also, to keep the rolling upgrade ability some backward compat may be necessary, at least in case the method is missing.&lt;/p&gt;</comment>
                            <comment id="13788930" author="liushaohui" created="Tue, 8 Oct 2013 05:33:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; sorry for late reply. I upload the patch to &lt;a href=&quot;https://reviews.facebook.net/D13341&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D13341&lt;/a&gt;. Could you help to review it ? thx.&lt;/p&gt;</comment>
                            <comment id="14489029" author="carp84" created="Fri, 10 Apr 2015 06:33:40 +0000"  >&lt;p&gt;We&apos;re using v94 in our product environment and decided to backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6508&quot; title=&quot;[0.89-fb] Filter out edits at log split time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6508&quot;&gt;&lt;del&gt;HBASE-6508&lt;/del&gt;&lt;/a&gt; to our code base as an improvement to the none-DistributedLogReplay way, and when referring to this patch, we found 2 issues:&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;in HRegion.java, DEEP_OVERHEAD shouldn&apos;t be updated (no additional AtomicLong introduced in the patch)&lt;/li&gt;
	&lt;li&gt;in HLogSplitter.java, HRegionServer instance is passed to the constructor but not assigned to the local variable, which  is a fatal issue&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I understand that this improvement is less necessary after DistributedLogReplay is introduced, but just in case anyone still want to backport it just like we do &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14497719" author="carp84" created="Thu, 16 Apr 2015 08:23:00 +0000"  >&lt;p&gt;Another issue found:&lt;/p&gt;

&lt;p&gt;In HRegionServer#createRegionLoad, it uses &lt;b&gt;regionName&lt;/b&gt; as RegionLoad name which later used as key of RegionLoad map, so the current HMaster.flushedSequenceIdByRegion actually is using regionName as the key. However, in current patch HLogSplitter is trying to get the lastFlushSeqId by &lt;b&gt;encodedRegionName&lt;/b&gt;, as shown below&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; ((entry = getNextLogLine(in,logPath, skipErrors)) != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
         &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] region = entry.getKey().getEncodedRegionName();
+        &lt;span class=&quot;code-object&quot;&gt;Long&lt;/span&gt; lastFlushedSequenceId = -1l;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (master != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+          lastFlushedSequenceId = lastFlushedSequenceIds.get(region);
+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (lastFlushedSequenceId == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+            lastFlushedSequenceId = -1l;
+            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+              lastFlushedSequenceId = master.getLastFlushedSequenceId(region);
+              lastFlushedSequenceIds.put(region, lastFlushedSequenceId);
+            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
+              LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to connect to the master to check &quot;&lt;/span&gt; +
+                  &lt;span class=&quot;code-quote&quot;&gt;&quot;the last flushed sequence id&quot;&lt;/span&gt;, e);
+              master = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+            }
+          }
+        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12601413">HBASE-6508</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12603751" name="HBASE-9568-0.94-v1.diff" size="30821" author="liushaohui" created="Wed, 18 Sep 2013 03:48:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 25 Sep 2013 16:02:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349109</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1o733:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>349407</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>