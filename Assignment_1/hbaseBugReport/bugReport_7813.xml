<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:49:18 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7813/HBASE-7813.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7813] Bug in BulkDeleteEndpoint kills entire rows on COLUMN/VERSION Deletes</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7813</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Try a BulkDeleteEndpoint using DeleteType.COLUMN or DeleteType.VERSION and give it a set of Columns which are not in the row.&lt;/p&gt;

&lt;p&gt;A Delete is constructed using just the row alone. No family/column/version is added and it is applied, thus deleting the entire row.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12631747">HBASE-7813</key>
            <summary>Bug in BulkDeleteEndpoint kills entire rows on COLUMN/VERSION Deletes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="varunsharma">Varun Sharma</assignee>
                                    <reporter username="varunsharma">Varun Sharma</reporter>
                        <labels>
                    </labels>
                <created>Mon, 11 Feb 2013 16:42:13 +0000</created>
                <updated>Fri, 20 Sep 2013 05:52:22 +0000</updated>
                            <resolved>Tue, 19 Feb 2013 06:56:09 +0000</resolved>
                                    <version>0.94.6</version>
                    <version>0.95.0</version>
                                                    <component>Coprocessors</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13575894" author="anoopsamjohn" created="Mon, 11 Feb 2013 16:56:09 +0000"  >&lt;p&gt;How is your Scan object looks like? You mean the Scan object contains some columns which are not at all present in row.  Still the region scan returns some KVs for that row?&lt;/p&gt;</comment>
                            <comment id="13575897" author="varunsharma" created="Mon, 11 Feb 2013 16:59:52 +0000"  >&lt;p&gt;Code follow for BulkDeleteEndpoint:&lt;/p&gt;

&lt;p&gt;1) Delete delete = new Delete(row);&lt;br/&gt;
2) Find stuff which is present and then do deleteColumn and deleteColumns and deleteFamily accordingly&lt;br/&gt;
3) Apply delete&lt;/p&gt;

&lt;p&gt;If only 1) and 3) execute, entire row is deleted. If this makes sense, I have a patch which should resolve this, I am seeing this in my setup.&lt;/p&gt;

&lt;p&gt;Thanks !&lt;/p&gt;</comment>
                            <comment id="13575908" author="yuzhihong@gmail.com" created="Mon, 11 Feb 2013 17:16:17 +0000"  >&lt;p&gt;I think before executing the deletion in step 3, we should check for row deletion.&lt;/p&gt;

&lt;p&gt;@Varun:&lt;br/&gt;
Can you upload your patch ?&lt;/p&gt;</comment>
                            <comment id="13575910" author="varunsharma" created="Mon, 11 Feb 2013 17:20:09 +0000"  >&lt;p&gt;Attaching for 0.94, can do trunk if this looks okay.&lt;/p&gt;</comment>
                            <comment id="13575912" author="hadoopqa" created="Mon, 11 Feb 2013 17:22:33 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12568849/7813-0.94.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12568849/7813-0.94.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4412//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4412//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13575929" author="yuzhihong@gmail.com" created="Mon, 11 Feb 2013 17:41:12 +0000"  >&lt;p&gt;When I ran unit test, I got:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testBulkDeleteEndpoint(org.apache.hadoop.hbase.coprocessor.example.TestBulkDeleteProtocol)  Time elapsed: 40.614 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.reflect.UndeclaredThrowableException
  at $Proxy22.delete(Unknown Source)
  at org.apache.hadoop.hbase.coprocessor.example.TestBulkDeleteProtocol$1.call(TestBulkDeleteProtocol.java:124)
  at org.apache.hadoop.hbase.coprocessor.example.TestBulkDeleteProtocol$1.call(TestBulkDeleteProtocol.java:122)
  at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation$4.call(HConnectionManager.java:1463)
  at java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:303)
  at java.util.concurrent.FutureTask.run(FutureTask.java:138)
  at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
  at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:680)
Caused by: org.apache.hadoop.hbase.client.RetriesExhaustedException: Failed after attempts=10, exceptions:
Mon Feb 11 09:33:35 PST 2013, org.apache.hadoop.hbase.ipc.ExecRPCInvoker$1@40f186b8, java.io.IOException: java.io.IOException: java.lang.ClassCastException: [Ljava.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;; cannot be &lt;span class=&quot;code-keyword&quot;&gt;cast&lt;/span&gt; to [Lorg.apache.hadoop.hbase.util.Pair;
...
  at org.apache.hadoop.hbase.client.ServerCallable.withRetries(ServerCallable.java:183)
  at org.apache.hadoop.hbase.ipc.ExecRPCInvoker.invoke(ExecRPCInvoker.java:79)
  ... 9 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Do you see similar failure ?&lt;/p&gt;</comment>
                            <comment id="13576207" author="lhofhansl" created="Mon, 11 Feb 2013 23:23:20 +0000"  >&lt;p&gt;Have you actually seen this fail? In createDeleteMutation I see this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; DeleteType.VERSION:
...
          &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (KeyValue kv : deleteRow) {
            delete.deleteColumn(kv.getFamily(), kv.getQualifier(), kv.getTimestamp());
            noOfVersionsToDelete++;
          }
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So that should be doing the right thing.&lt;/p&gt;</comment>
                            <comment id="13576211" author="varunsharma" created="Mon, 11 Feb 2013 23:29:44 +0000"  >&lt;p&gt;Yes, but I am using DeleteType.COLUMN since I want all versions of a column to be deleted. In this particular case, I didn&apos;t say where we check that noOfVersions &amp;gt; 0 before applying the delete. Applying a delete without deleteColumn or deleteColumns deletes the entire row.&lt;/p&gt;</comment>
                            <comment id="13576214" author="varunsharma" created="Mon, 11 Feb 2013 23:35:20 +0000"  >&lt;p&gt;Hey Ted,&lt;/p&gt;

&lt;p&gt;Is this the correct way to the run test, its running zero tests for me...&lt;/p&gt;

&lt;p&gt;mvn test -Dtest=org.apache.hadoop.hbase.coprocessor.example.TestBulkDeleteProtocol&lt;/p&gt;</comment>
                            <comment id="13576217" author="yuzhihong@gmail.com" created="Mon, 11 Feb 2013 23:41:03 +0000"  >&lt;p&gt;You need to specify &apos;-PlocalTests &apos; on the command line.&lt;/p&gt;</comment>
                            <comment id="13576229" author="varunsharma" created="Mon, 11 Feb 2013 23:55:02 +0000"  >&lt;p&gt;This maybe a red herring - lemme cross check this - we started losing rows after the BulkDeleteEndpoint but I now see the if (deleteRows.size() &amp;gt; 0) check, so I am still looking at why we are losing rows.&lt;/p&gt;</comment>
                            <comment id="13576257" author="anoopsamjohn" created="Tue, 12 Feb 2013 00:42:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunsharma&quot; class=&quot;user-hover&quot; rel=&quot;varunsharma&quot;&gt;Varun Sharma&lt;/a&gt; Can you add your scenario into unit test and attach here?&lt;/p&gt;</comment>
                            <comment id="13581061" author="anoopsamjohn" created="Tue, 19 Feb 2013 06:52:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=varunsharma&quot; class=&quot;user-hover&quot; rel=&quot;varunsharma&quot;&gt;Varun Sharma&lt;/a&gt;Any update on this? You found the actual issue?&lt;/p&gt;</comment>
                            <comment id="13581063" author="varunsharma" created="Tue, 19 Feb 2013 06:54:51 +0000"  >&lt;p&gt;Yeah, I don&apos;t think there was an issue here - we found a bug in the app logic instead, closing for now - may reopen if i see seomthing suspicious again&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12568849" name="7813-0.94.txt" size="4464" author="varunsharma" created="Mon, 11 Feb 2013 17:20:09 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 11 Feb 2013 16:56:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312243</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 43 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hvuv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>312589</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>