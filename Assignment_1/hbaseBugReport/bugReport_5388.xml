<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:27:18 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5388/HBASE-5388.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5388] Tune HConnectionManager#getCachedLocation method</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5388</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;About 75% improvement in execution time.&lt;br/&gt;
1. Add the following method in SoftValueSortedMap:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; &amp;lt;K, V&amp;gt; Entry&amp;lt;K, V&amp;gt; lowerEntry(K key) {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ((TreeMap) &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap).lowerEntry(key);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2. Modify getCachedLocation:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; 
Map.Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], HRegionLocation&amp;gt; tEntry = tableLocations.lowerEntry(row);
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tEntry != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  HRegionLocation possibleRegion = tEntry.getValue();
  &lt;span class=&quot;code-comment&quot;&gt;//other code
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12542288">HBASE-5388</key>
            <summary>Tune HConnectionManager#getCachedLocation method</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ronghai.ma">ronghai.ma</assignee>
                                    <reporter username="ronghai.ma">ronghai.ma</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Sun, 12 Feb 2012 13:48:29 +0000</created>
                <updated>Fri, 12 Oct 2012 05:34:55 +0000</updated>
                            <resolved>Tue, 14 Feb 2012 07:10:42 +0000</resolved>
                                    <version>0.90.5</version>
                                    <fixVersion>0.94.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13206417" author="zhihyu@ebaysf.com" created="Sun, 12 Feb 2012 13:55:59 +0000"  >&lt;p&gt;@Ronghai:&lt;br/&gt;
Can you upload a patch ?&lt;br/&gt;
The improvement is measured in execution time, right ?&lt;/p&gt;</comment>
                            <comment id="13206422" author="ronghai.ma" created="Sun, 12 Feb 2012 14:12:55 +0000"  >&lt;p&gt;My pleasure, and two questions:&lt;br/&gt;
1. the svn location&lt;br/&gt;
2. my account&lt;/p&gt;

&lt;p&gt;Yes, measeured in excution time.&lt;/p&gt;</comment>
                            <comment id="13206423" author="ronghai.ma" created="Sun, 12 Feb 2012 14:18:39 +0000"  >&lt;p&gt;About 75% improvement&#12290;&lt;/p&gt;</comment>
                            <comment id="13206431" author="zhihyu@ebaysf.com" created="Sun, 12 Feb 2012 15:29:17 +0000"  >&lt;p&gt;Here you can find source location:&lt;br/&gt;
&lt;a href=&quot;http://hbase.apache.org/source-repository.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hbase.apache.org/source-repository.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13206508" author="lhofhansl" created="Sun, 12 Feb 2012 20:23:52 +0000"  >&lt;p&gt;Wow, nice find. Should consider back porting at least to 0.92&lt;/p&gt;</comment>
                            <comment id="13206543" author="zhihyu@ebaysf.com" created="Sun, 12 Feb 2012 22:34:40 +0000"  >&lt;p&gt;@Ronghai:&lt;br/&gt;
I haven&apos;t seen your patch yet.&lt;br/&gt;
According to your description in the JIRA, I am guessing something similar to the following:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@@ -1067,9 +1067,12 @@
         &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
       }

-      HRegionLocation rl = tableLocations.get(row);
-      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rl != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
-        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; rl;
+      Map.Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], HRegionLocation&amp;gt; tEntry = tableLocations.lowerEntry(row);
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tEntry != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+        HRegionLocation rl = tEntry.getValue();
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rl != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; rl;
+        }
       }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There is more code in getCachedLocation() following the above lines, revolving around tableLocations.headMap(row)&lt;br/&gt;
I wonder how you measured the performance boost - by instrumenting getCachedLocation() I assume ?&lt;/p&gt;</comment>
                            <comment id="13206556" author="ronghai.ma" created="Sun, 12 Feb 2012 23:30:15 +0000"  >&lt;p&gt;I will upload the patch latter, many meetings,take a nap.&lt;br/&gt;
I reviewed the code, and changed some code.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//SoftValueSortedMap#lowerKey
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; K lowerKey(K key) {
  checkReferences();    
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ((TreeMap&amp;lt;K, SoftValue&amp;lt;K,V&amp;gt;&amp;gt;)&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap).lowerKey(key);
}
&lt;span class=&quot;code-comment&quot;&gt;//SoftValueSortedMap#getLower
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; V getLower(K key) {
  checkReferences(); 
  Map.Entry&amp;lt;K,SoftValue&amp;lt;K,V&amp;gt;&amp;gt; entry = ((TreeMap&amp;lt;K, SoftValue&amp;lt;K,V&amp;gt;&amp;gt;)&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap).lowerEntry(key);
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(entry==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
  }
  SoftValue&amp;lt;K,V&amp;gt; value=entry.getValue();
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(value==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
  } 
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value.get() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap.remove(key);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
  }
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value.get();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;//HConnectionManager#HConnectionImplementation#getCachedLocation
&lt;/span&gt;HRegionLocation rl = tableLocations.get(row);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rl != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; rl;
}
rl = tableLocations.getLower(row);
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(r1==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
}
&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] endKey = rl.getRegionInfo().getEndKey();
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(Bytes.equals(endKey,HConstants.EMPTY_END_ROW)||
  KeyValue.getRowComparator(tableName).compareRows(endKey, 0, endKey.length, row, 0, row.length) &amp;gt; 0){
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; rl;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13206559" author="zhihyu@ebaysf.com" created="Sun, 12 Feb 2012 23:46:21 +0000"  >&lt;p&gt;I see.&lt;/p&gt;

&lt;p&gt;Should this new method, getLower(), be called getLowerValue() ? It returns the value portion of the entry.&lt;/p&gt;</comment>
                            <comment id="13206561" author="zhihyu@ebaysf.com" created="Sun, 12 Feb 2012 23:47:08 +0000"  >&lt;p&gt;Please also publish performance numbers before and after the optimization.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13206563" author="lhofhansl" created="Sun, 12 Feb 2012 23:58:19 +0000"  >&lt;p&gt;NavigableMap has lowerKey and lowerEntry, we should use the same naming scheme.&lt;br/&gt;
(Ideally SoftValueSortedMap should implement NavigableMap. But that is a different story.)&lt;/p&gt;

&lt;p&gt;This whole block:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      SortedMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], HRegionLocation&amp;gt; matchingRegions =
        tableLocations.headMap(row);

      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; that portion of the map is empty, then we&apos;re done. otherwise,
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// we need to examine the cached location to verify that it is
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// a match by end key as well.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!matchingRegions.isEmpty()) {
        HRegionLocation possibleRegion = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          possibleRegion = matchingRegions.get(matchingRegions.lastKey());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is essentially equivalent to &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
possibleRegion = tableLocations.lowerEntry(row).getValue()
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;@ronghai: I&apos;m happy to make a patch.&lt;/p&gt;</comment>
                            <comment id="13206565" author="ronghai.ma" created="Mon, 13 Feb 2012 00:03:25 +0000"  >&lt;p&gt;patch files&lt;/p&gt;</comment>
                            <comment id="13206572" author="ronghai.ma" created="Mon, 13 Feb 2012 00:14:22 +0000"  >&lt;p&gt;rename the method SoftValueSortedMap#getLower to SoftValueSortedMap#getLowerValueByKey&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; V getLowerValueByKey(K key) {
	checkReferences();
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(!(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; java.util.NavigableMap)){
	  SortedMap&amp;lt;K,SoftValue&amp;lt;K,V&amp;gt;&amp;gt; sortedMap = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap.headMap(key);
	  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(sortedMap==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
	  }
	  SoftValue&amp;lt;K,V&amp;gt; value = sortedMap.get(sortedMap.lastKey());
	  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(value==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
	  }
	  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value.get() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
	    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap.remove(key);
	    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
	  }
	  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value.get();
	}
	
	Map.Entry&amp;lt;K,SoftValue&amp;lt;K,V&amp;gt;&amp;gt; entry = ((TreeMap&amp;lt;K, SoftValue&amp;lt;K,V&amp;gt;&amp;gt;)&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap).lowerEntry(key);
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(entry==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
	}
	SoftValue&amp;lt;K,V&amp;gt; value=entry.getValue();
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(value==&lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;){
		&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
	} 
	&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value.get() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap.remove(key);
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    }
	&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; value.get();
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13206573" author="lhofhansl" created="Mon, 13 Feb 2012 00:14:47 +0000"  >&lt;p&gt;Usually a diff is better: you can use &quot;svn diff&quot; to do that.&lt;br/&gt;
Let&apos;s have a more standard lowerEntry rather then getLower.&lt;/p&gt;</comment>
                            <comment id="13206579" author="ronghai.ma" created="Mon, 13 Feb 2012 00:25:04 +0000"  >&lt;p&gt;CPU:IA32&lt;br/&gt;
JVM OPTIONS:-server&lt;br/&gt;
cached regions:60000&lt;br/&gt;
region row: 50000th region&lt;br/&gt;
prewarm each method: 1,000,000 times&lt;br/&gt;
run each method: 1,000,000 times&lt;br/&gt;
Time Usage:&lt;br/&gt;
By headMap(),lastKey(),get():1000ms&lt;br/&gt;
By lowerEntry(K):600ms&lt;/p&gt;</comment>
                            <comment id="13206581" author="ronghai.ma" created="Mon, 13 Feb 2012 00:30:14 +0000"  >&lt;p&gt;@Lars hofhansl&lt;br/&gt;
thank you.&lt;/p&gt;</comment>
                            <comment id="13206582" author="ronghai.ma" created="Mon, 13 Feb 2012 00:32:08 +0000"  >&lt;p&gt;rename the method&apos;s name and change the TreeMap to NavigableMap of the if condition&lt;/p&gt;</comment>
                            <comment id="13206652" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 03:29:20 +0000"  >&lt;p&gt;Patch v2 is adapted from the files Ronghai attached.&lt;br/&gt;
I think the following check in SoftValueSortedMap.java isn&apos;t needed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; NavigableMap)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;because the two SoftValueSortedMap ctor&apos;s which don&apos;t instantiate TreeMap are private.&lt;/p&gt;

&lt;p&gt;I included the if block for completeness.&lt;/p&gt;</comment>
                            <comment id="13206653" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 03:32:47 +0000"  >&lt;p&gt;@Ronghai:&lt;br/&gt;
Since this is an improvement, we should start from HBase TRUNK first.&lt;/p&gt;

&lt;p&gt;Please generate patch from the root of your workspace by typing:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
svn diff
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also, refer to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3678&quot; title=&quot;Add Eclipse-based Apache Formatter to HBase Wiki&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3678&quot;&gt;&lt;del&gt;HBASE-3678&lt;/del&gt;&lt;/a&gt; for Eclipse formatter which takes care of formatting.&lt;/p&gt;

&lt;p&gt;Keep a space between if and left parenthesis, a space between right parenthesis and left curly brace.&lt;/p&gt;</comment>
                            <comment id="13206666" author="hadoopqa" created="Mon, 13 Feb 2012 04:23:51 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12514315/5388-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12514315/5388-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -136 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 157 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestForceCacheImportantBlocks&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/948//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/948//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/948//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/948//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/948//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/948//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13206674" author="lhofhansl" created="Mon, 13 Feb 2012 04:43:57 +0000"  >&lt;p&gt;Not too fond of this part:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      SortedMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [], HRegionLocation&amp;gt; tableLocations =
-        getTableLocations(tableName);
+      SoftValueSortedMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [], HRegionLocation&amp;gt; tableLocations =
+        (SoftValueSortedMap) getTableLocations(tableName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I did a patch earlier that removed all concrete references to SoftValueSortedMap, except for creation... This would be a step back.&lt;br/&gt;
Maybe SoftValueSortedMap should implement NavigableMap and just throw UnsupportedOperation on all other new methods, in that case SoftValueSortedMap could implement lowerEntry.&lt;/p&gt;

&lt;p&gt;... Or maybe this would be overkill.&lt;/p&gt;</comment>
                            <comment id="13206686" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 05:19:56 +0000"  >&lt;p&gt;It wouldn&apos;t be an overkill if you have strong belief.&lt;/p&gt;</comment>
                            <comment id="13206691" author="ronghai.ma" created="Mon, 13 Feb 2012 05:36:28 +0000"  >&lt;p&gt;@Lars Hofhansl&lt;br/&gt;
I prefer to make code short, and let the instance thin.&lt;br/&gt;
If SoftValueSortedMap implements NavigableMap, there will be more infomation in method_info and interfaces, and the interface method reference.&lt;/p&gt;

&lt;p&gt;@Zhihong Yu&lt;br/&gt;
Thank you.&lt;br/&gt;
Kill the code which is not usefull.&lt;/p&gt;</comment>
                            <comment id="13207031" author="stack" created="Mon, 13 Feb 2012 18:18:52 +0000"  >&lt;p&gt;I agree w/ Zhihong, that &apos;+    if (!(this.internalMap instanceof NavigableMap)) {&apos; block seems unnecessary.&lt;/p&gt;

&lt;p&gt;Is the &apos;greatest&apos; in this right?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * retrieves the value associated with the greatest key strictly less than
+   *  the given key, or &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there is no such key
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Its unfortunate that SoftValueSortedMap sneaks back into HCM but I can live with it if no alternative (Lars&apos; suggestion having SVSM implement NM didn&apos;t seem to bad but understand if it adds a bunch of boiler plate)&lt;/p&gt;
</comment>
                            <comment id="13207036" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 18:24:23 +0000"  >&lt;p&gt;The javadoc involving &apos;greatest&apos; comes from javadoc for lowerEntry().&lt;/p&gt;

&lt;p&gt;I will attach a new patch without the instanceof block.&lt;/p&gt;</comment>
                            <comment id="13207044" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 18:32:44 +0000"  >&lt;p&gt;Patch v3 aligns lowerValueByKey() with the rest of methods in SoftValueSortedMap.java&lt;/p&gt;</comment>
                            <comment id="13207051" author="stack" created="Mon, 13 Feb 2012 18:37:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;The javadoc involving &apos;greatest&apos; comes from javadoc for lowerEntry().&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Ok&lt;/p&gt;

&lt;p&gt;v3 is good by me except for the HCM pollution w/ SoftValueSortedMap.  I looked at making it implement NavigableMap and its 18 extra methods.  They could all throw unsupported as per Lars.  I&apos;m fine w/ this patch though.&lt;/p&gt;</comment>
                            <comment id="13207101" author="hadoopqa" created="Mon, 13 Feb 2012 19:26:05 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12514383/5388-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12514383/5388-v3.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -136 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 157 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.io.hfile.TestHFileBlock&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/952//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/952//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/952//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/952//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/952//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/952//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13207106" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 19:27:49 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
What do you think ?&lt;/p&gt;</comment>
                            <comment id="13207226" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 21:28:49 +0000"  >&lt;p&gt;The new method, lowerValueByKey(), isn&apos;t in NavigableMap.&lt;br/&gt;
If we restrict SoftValueSortedMap to only implementing NavigableMap, where should we place lowerValueByKey() ?&lt;br/&gt;
I assume we may find other place(s) in our code which can reuse lowerValueByKey().&lt;/p&gt;</comment>
                            <comment id="13207257" author="ronghai.ma" created="Mon, 13 Feb 2012 21:59:08 +0000"  >&lt;p&gt;rename it lower()&lt;/p&gt;</comment>
                            <comment id="13207258" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 22:05:48 +0000"  >&lt;p&gt;lower() isn&apos;t in NavigableMap or TreeMap.&lt;br/&gt;
And the name is not informative.&lt;/p&gt;</comment>
                            <comment id="13207264" author="ronghai.ma" created="Mon, 13 Feb 2012 22:09:41 +0000"  >&lt;p&gt;As the class is called SoftValueSortedMap, how about SoftValueTreeMap or SoftValueNavigableMap&lt;/p&gt;</comment>
                            <comment id="13207309" author="lhofhansl" created="Mon, 13 Feb 2012 22:59:51 +0000"  >&lt;p&gt;I had a look. Having SoftValueSortedMap implement NavigableMap just opens up a new can of worms.&lt;br/&gt;
NavigableMap has lowerEntry, but what should that return? A SoftValue? That means the value of the returned entry can become null at any point.&lt;/p&gt;

&lt;p&gt;Let&apos;s go with the original patch and just add the reference to the concrete SoftValueSortedMap type.&lt;/p&gt;</comment>
                            <comment id="13207310" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 23:04:05 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
Can you clarify which patch you favor: v2 or v3 ?&lt;/p&gt;</comment>
                            <comment id="13207325" author="ronghai.ma" created="Mon, 13 Feb 2012 23:15:54 +0000"  >&lt;p&gt;@Lars,Zhihong Yu&lt;br/&gt;
What about a new Class for the cache, there are too many synchronized and checkReferences in SoftValueSortedMap.&lt;/p&gt;</comment>
                            <comment id="13207338" author="lhofhansl" created="Mon, 13 Feb 2012 23:32:06 +0000"  >&lt;p&gt;@Ted: v3&lt;br/&gt;
I&apos;d probably keep the name of possibleRegion (rather than rl), also keep this comment&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-          &lt;span class=&quot;code-comment&quot;&gt;// make sure that the end key is greater than the row we&apos;re looking
&lt;/span&gt;-          &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;, otherwise the row actually belongs in the next region, not
&lt;/span&gt;-          &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; one. the exception &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; is when the endkey is
&lt;/span&gt;-          &lt;span class=&quot;code-comment&quot;&gt;// HConstants.EMPTY_START_ROW, signifying that the region we&apos;re
&lt;/span&gt;-          &lt;span class=&quot;code-comment&quot;&gt;// checking is actually the last region in the table.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;which is still valid.&lt;br/&gt;
Also is this needed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value.get() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap.remove(key);
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;? That is what checkReferences will do on the next access anyway, right?&lt;/p&gt;</comment>
                            <comment id="13207348" author="lhofhansl" created="Mon, 13 Feb 2012 23:39:36 +0000"  >&lt;p&gt;How about this one? This has still type-safety everywhere.&lt;/p&gt;</comment>
                            <comment id="13207352" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 23:45:16 +0000"  >&lt;p&gt;Addressed Lars&apos; comments earlier.&lt;br/&gt;
Also fixed HConstants.EMPTY_END_ROW in the comment which Lars suggested keeping.&lt;/p&gt;

&lt;p&gt;I didn&apos;t know Lars was working another patch.&lt;/p&gt;</comment>
                            <comment id="13207355" author="ronghai.ma" created="Mon, 13 Feb 2012 23:46:33 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value.get() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap.remove(key);
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is needed for splited regions.&lt;/p&gt;</comment>
                            <comment id="13207360" author="lhofhansl" created="Mon, 13 Feb 2012 23:51:10 +0000"  >&lt;p&gt;@rongmai: How&apos;s that? This has nothing to do with split regions.&lt;/p&gt;</comment>
                            <comment id="13207361" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 23:53:26 +0000"  >&lt;p&gt;Patch v6 adopts type-safety changes from Lars&apos; patch.&lt;/p&gt;</comment>
                            <comment id="13207363" author="lhofhansl" created="Mon, 13 Feb 2012 23:53:35 +0000"  >&lt;p&gt;@Ted: patch crossing &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13207364" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 23:54:15 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
What do you think of patch v6 ?&lt;/p&gt;</comment>
                            <comment id="13207365" author="lhofhansl" created="Mon, 13 Feb 2012 23:54:36 +0000"  >&lt;p&gt;+1 on v6&lt;br/&gt;
Although I still think that &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (value.get() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.internalMap.remove(key);
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;is not needed.&lt;/p&gt;</comment>
                            <comment id="13207367" author="ronghai.ma" created="Mon, 13 Feb 2012 23:56:35 +0000"  >&lt;p&gt;yes, splited region will be deleted in locateRegionInMeta.&lt;/p&gt;</comment>
                            <comment id="13207373" author="ronghai.ma" created="Tue, 14 Feb 2012 00:01:37 +0000"  >&lt;p&gt;Without remove operation,&lt;br/&gt;
are synchronized and checkRefrences() needed here?&lt;/p&gt;</comment>
                            <comment id="13207375" author="zhihyu@ebaysf.com" created="Tue, 14 Feb 2012 00:05:09 +0000"  >&lt;p&gt;I prefer keeping the remove() call.&lt;br/&gt;
Isn&apos;t it nice that stale reference gets cleared early ?&lt;/p&gt;</comment>
                            <comment id="13207382" author="lhofhansl" created="Tue, 14 Feb 2012 00:17:02 +0000"  >&lt;p&gt;@ronghai: Null is returned either way, whether we remove it or not.&lt;/p&gt;

&lt;p&gt;Anyway, I guess we do the same in get(key), so let&apos;s leave it in.&lt;/p&gt;</comment>
                            <comment id="13207401" author="hadoopqa" created="Tue, 14 Feb 2012 00:42:02 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12514420/5388-v6.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12514420/5388-v6.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -136 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 157 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestSplitLogManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/956//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/956//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/956//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/956//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/956//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/956//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13207409" author="zhihyu@ebaysf.com" created="Tue, 14 Feb 2012 00:52:49 +0000"  >&lt;p&gt;TestSplitLogManager passed locally on MacBook with patch v6.&lt;/p&gt;

&lt;p&gt;My script didn&apos;t find hanging test in build 956.&lt;/p&gt;

&lt;p&gt;Will integrate patch v6 tomorrow if there is no further review.&lt;/p&gt;</comment>
                            <comment id="13207412" author="ronghai.ma" created="Tue, 14 Feb 2012 00:56:50 +0000"  >&lt;p&gt;@Lars&lt;br/&gt;
If we change(put,remove) internalMap, we use synchronized for thread safe.&lt;/p&gt;

&lt;p&gt;@Zhihong Yu&lt;br/&gt;
Scenario: There is a large scale of regions cached(more than 120,000), and using HConnectionImplementation#processBatch with a list(more than 20) concurrently.&lt;/p&gt;</comment>
                            <comment id="13207413" author="zhihyu@ebaysf.com" created="Tue, 14 Feb 2012 00:59:50 +0000"  >&lt;p&gt;@Ronghai:&lt;br/&gt;
Do you think patch v6 is good to go ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13207417" author="ronghai.ma" created="Tue, 14 Feb 2012 01:05:50 +0000"  >&lt;p&gt;Excellent for this patch.&lt;br/&gt;
Make another thread for the synchronized and checkReferences.&lt;/p&gt;</comment>
                            <comment id="13207773" author="zhihyu@ebaysf.com" created="Tue, 14 Feb 2012 15:30:25 +0000"  >&lt;p&gt;Integrated to TRUNK.&lt;/p&gt;

&lt;p&gt;Thanks for the patch Ronghai.&lt;/p&gt;

&lt;p&gt;Thanks for the review, Lars.&lt;/p&gt;

&lt;p&gt;@Ronghai:&lt;br/&gt;
Please resolve after committer integrates patch to source repository &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13208160" author="ronghai.ma" created="Wed, 15 Feb 2012 00:45:26 +0000"  >&lt;p&gt;@Zhihong&lt;br/&gt;
Thanks for the guide.&lt;/p&gt;

&lt;p&gt;@Lars&lt;br/&gt;
Thanks for the review.&lt;/p&gt;</comment>
                            <comment id="13208920" author="hudson" created="Wed, 15 Feb 2012 22:57:04 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #112 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/112/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/112/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5388&quot; title=&quot;Tune HConnectionManager#getCachedLocation method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5388&quot;&gt;&lt;del&gt;HBASE-5388&lt;/del&gt;&lt;/a&gt; Tune HConnectionManager#getCachedLocation method (Ronghai Ma) (Revision 1243994)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/SoftValueSortedMap.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13209412" author="hudson" created="Thu, 16 Feb 2012 14:46:22 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2663 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2663/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2663/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5388&quot; title=&quot;Tune HConnectionManager#getCachedLocation method&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5388&quot;&gt;&lt;del&gt;HBASE-5388&lt;/del&gt;&lt;/a&gt; Tune HConnectionManager#getCachedLocation method (Ronghai Ma) (Revision 1243994)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/SoftValueSortedMap.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12514315" name="5388-v2.txt" size="4658" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 03:29:18 +0000"/>
                            <attachment id="12514383" name="5388-v3.txt" size="4265" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 18:32:44 +0000"/>
                            <attachment id="12514418" name="5388-v4.txt" size="5804" author="lhofhansl" created="Mon, 13 Feb 2012 23:39:36 +0000"/>
                            <attachment id="12514419" name="5388-v5.txt" size="4836" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 23:45:16 +0000"/>
                            <attachment id="12514420" name="5388-v6.txt" size="6152" author="zhihyu@ebaysf.com" created="Mon, 13 Feb 2012 23:53:26 +0000"/>
                            <attachment id="12514295" name="HConnectionManager.java" size="59637" author="ronghai.ma" created="Mon, 13 Feb 2012 00:03:25 +0000"/>
                            <attachment id="12514303" name="SoftValueSortedMap.java" size="6433" author="ronghai.ma" created="Mon, 13 Feb 2012 00:32:08 +0000"/>
                            <attachment id="12514296" name="SoftValueSortedMap.java" size="6554" author="ronghai.ma" created="Mon, 13 Feb 2012 00:03:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 12 Feb 2012 13:55:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>227575</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 44 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08rdz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49037</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>tunning getCachedLocation  method</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>