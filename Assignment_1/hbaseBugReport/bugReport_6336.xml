<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:35:52 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6336/HBASE-6336.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6336] Split point should not be equal to start row or end row</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6336</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Should we allow split point equal with region&apos;s start row or end row?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the midkey is the same as the first and last keys, then we cannot
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// (ever) split &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; region.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.comparator.compareRows(mk, firstKey) == 0 &amp;amp;&amp;amp;
            &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.comparator.compareRows(mk, lastKey) == 0) {
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled()) {
            LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;cannot split because midkey is the same as first or &quot;&lt;/span&gt; +
              &lt;span class=&quot;code-quote&quot;&gt;&quot;last row&quot;&lt;/span&gt;);
          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here, I think it is a mistake.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12597696">HBASE-6336</key>
            <summary>Split point should not be equal to start row or end row</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zjushch">chunhui shen</assignee>
                                    <reporter username="zjushch">chunhui shen</reporter>
                        <labels>
                    </labels>
                <created>Fri, 6 Jul 2012 05:58:26 +0000</created>
                <updated>Mon, 23 Sep 2013 18:30:57 +0000</updated>
                            <resolved>Wed, 18 Jul 2012 16:04:14 +0000</resolved>
                                                    <fixVersion>0.95.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13407787" author="zhihyu@ebaysf.com" created="Fri, 6 Jul 2012 08:13:20 +0000"  >&lt;p&gt;Good catch.&lt;br/&gt;
It is a bug.&lt;/p&gt;</comment>
                            <comment id="13408176" author="ram_krish" created="Fri, 6 Jul 2012 17:44:14 +0000"  >&lt;p&gt;I think this is fine.&lt;br/&gt;
One more thing we noticed here is Suppose&lt;br/&gt;
I have a table with no split keys.  And i have very few data in that.  Now if i try to split we split from &lt;br/&gt;
[] to &lt;span class=&quot;error&quot;&gt;&amp;#91;firstrow&amp;#93;&lt;/span&gt;&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;firstrow&amp;#93;&lt;/span&gt; to []&lt;br/&gt;
Why we get first row as 1st region&apos;s end key is i have only one root index and it will select the first row as the midkey.  &lt;br/&gt;
But here in the first region there are no kvs at all and hence we flush an empty file.  Now when we again call split passing the table name for the first region we get an ioexception from&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rootCount == 0)
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;HFile empty&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It may not be a bug but just found this.&lt;/p&gt;</comment>
                            <comment id="13408530" author="hadoopqa" created="Sat, 7 Jul 2012 01:48:44 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12535332/HBASE-6336.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12535332/HBASE-6336.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 hadoop2.0.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    -1 javac.  The applied patch generated 5 javac compiler warnings (more than the trunk&apos;s current 4 warnings).&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 7 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.coprocessor.TestClassLoading&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2339//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2339//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2339//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2339//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2339//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2339//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/2339//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/2339//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13409121" author="zjushch" created="Mon, 9 Jul 2012 01:56:34 +0000"  >&lt;p&gt;@ram&lt;br/&gt;
In current logic, if no kvs in one region, we will failed getting split point because following code when call StoreFile.Reader.midkey()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rootCount == 0)
        &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;HFile empty&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do you mean allow to get split point for the above case? Or other?&lt;/p&gt;

&lt;p&gt;We will catch above IOException and return null for getSplitPoint, I think it is ok...&lt;/p&gt;</comment>
                            <comment id="13409178" author="ram_krish" created="Mon, 9 Jul 2012 04:47:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;We will catch above IOException and return null for getSplitPoint, I think it is ok...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes.. this is better i felt.  Because getting an IOException in logs makes someone think its a problem.&lt;/p&gt;</comment>
                            <comment id="13409185" author="zjushch" created="Mon, 9 Jul 2012 05:15:17 +0000"  >&lt;p&gt;@ram&lt;br/&gt;
Sorry, I&apos;m not clear about your mean.&lt;/p&gt;

&lt;p&gt;In current logic, we will getting an IOException in logs and return null for getSplitPoint.&lt;/p&gt;

&lt;p&gt;Do you mean we directly return null for HFileBlockIndex#midkey() if (rootCount == 0) rather than throws an IOException?&lt;/p&gt;</comment>
                            <comment id="13412069" author="stack" created="Wed, 11 Jul 2012 22:22:57 +0000"  >&lt;p&gt;+1 on the patch.&lt;/p&gt;

&lt;p&gt;@Ram when you say &apos;But here in the first region there are no kvs at all and hence we flush an empty file.&apos;&lt;/p&gt;

&lt;p&gt;What flush are you talking of?  The close of the region on split?  If so, why we write a flush file if no KVs?  Do we?  That don&apos;t seem right.&lt;/p&gt;</comment>
                            <comment id="13412504" author="ram_krish" created="Thu, 12 Jul 2012 04:20:48 +0000"  >&lt;p&gt;@Stack&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;If so, why we write a flush file if no KVs?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes we are writing an emtpy now.  Incase of compaction we are creating an empty file.  So once the region is split we compact, so there an empty file is created for an empty region.&lt;br/&gt;
See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6059&quot; title=&quot;Replaying recovered edits would make deleted data exist again&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6059&quot;&gt;&lt;del&gt;HBASE-6059&lt;/del&gt;&lt;/a&gt; - Replaying recovered edits would make deleted data exist again&lt;br/&gt;
There i had a concern on creating an empty store file, but it was needed.  So you feel any problem there Stack?&lt;/p&gt;</comment>
                            <comment id="13412795" author="stack" created="Thu, 12 Jul 2012 13:53:29 +0000"  >&lt;p&gt;@Ram Thanks.  So, hbase-6059 added our writing of empty store files it seems.  I remember that now.  So, if we throw an exception because its empty but higher up we are returning split point of null &amp;#8211; that the empty region is not splittable &amp;#8211; it doesn&apos;t seem like an issue (its just ugly).&lt;/p&gt;

&lt;p&gt;For sure we should commit Chunhui&apos;s patch on this issue.&lt;/p&gt;

&lt;p&gt;Good stuff lads.&lt;/p&gt;</comment>
                            <comment id="13415868" author="zjushch" created="Tue, 17 Jul 2012 03:41:33 +0000"  >&lt;p&gt;Is there any problem for this issue?&lt;br/&gt;
I think we could commit it ...&lt;/p&gt;</comment>
                            <comment id="13415873" author="ram_krish" created="Tue, 17 Jul 2012 03:57:49 +0000"  >&lt;p&gt;I can commit this today Chunhui.  We already have +1 on this.&lt;/p&gt;</comment>
                            <comment id="13415874" author="zhihyu@ebaysf.com" created="Tue, 17 Jul 2012 04:00:30 +0000"  >&lt;p&gt;Integrated to trunk.&lt;/p&gt;

&lt;p&gt;Thanks for the patch, Chunhui.&lt;/p&gt;

&lt;p&gt;Thanks for the review, Stack and Ram.&lt;/p&gt;</comment>
                            <comment id="13415875" author="ram_krish" created="Tue, 17 Jul 2012 04:00:33 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
If you are going to commit, carry on Ted.&lt;/p&gt;</comment>
                            <comment id="13415887" author="hudson" created="Tue, 17 Jul 2012 04:17:52 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3139 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3139/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3139/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6336&quot; title=&quot;Split point should not be equal to start row or end row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6336&quot;&gt;&lt;del&gt;HBASE-6336&lt;/del&gt;&lt;/a&gt; Split point should not be equal to start row or end row (Chunhui) (Revision 1362340)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13416097" author="hudson" created="Tue, 17 Jul 2012 11:39:29 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #96 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/96/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/96/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6336&quot; title=&quot;Split point should not be equal to start row or end row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6336&quot;&gt;&lt;del&gt;HBASE-6336&lt;/del&gt;&lt;/a&gt; Split point should not be equal to start row or end row (Chunhui) (Revision 1362340)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13417199" author="stack" created="Wed, 18 Jul 2012 16:04:14 +0000"  >&lt;p&gt;Resolving.  Was committed to trunk.  Could be backported.  Lets open new issue to do that if wanted.&lt;/p&gt;</comment>
                            <comment id="13480646" author="hudson" created="Sat, 20 Oct 2012 05:00:32 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #543 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/543/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/543/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7020&quot; title=&quot;Backport HBASE-6336 Split point should not be equal to start row or end row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7020&quot;&gt;&lt;del&gt;HBASE-7020&lt;/del&gt;&lt;/a&gt; Backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6336&quot; title=&quot;Split point should not be equal to start row or end row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6336&quot;&gt;&lt;del&gt;HBASE-6336&lt;/del&gt;&lt;/a&gt; Split point should not be equal to start row or end row (Sergey Shelukhin) (Revision 1400359)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13490384" author="hudson" created="Mon, 5 Nov 2012 01:35:35 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #9 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/9/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/9/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7020&quot; title=&quot;Backport HBASE-6336 Split point should not be equal to start row or end row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7020&quot;&gt;&lt;del&gt;HBASE-7020&lt;/del&gt;&lt;/a&gt; Backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6336&quot; title=&quot;Split point should not be equal to start row or end row&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6336&quot;&gt;&lt;del&gt;HBASE-6336&lt;/del&gt;&lt;/a&gt; Split point should not be equal to start row or end row (Sergey Shelukhin) (Revision 1400359)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13775193" author="stack" created="Mon, 23 Sep 2013 18:30:57 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12612806">HBASE-7020</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12535332" name="HBASE-6336.patch" size="1065" author="zjushch" created="Fri, 6 Jul 2012 09:34:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 Jul 2012 08:13:20 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245338</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i067wn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34212</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>