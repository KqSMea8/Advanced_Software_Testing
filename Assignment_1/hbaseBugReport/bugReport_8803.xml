<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:58:41 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8803/HBASE-8803.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8803] region_mover.rb should move multiple regions at a time</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8803</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When there is many regions in a cluster, rolling_restart can take hours because region_mover is moving the regions one by one.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12654722">HBASE-8803</key>
            <summary>region_mover.rb should move multiple regions at a time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jmspaggi">Jean-Marc Spaggiari</assignee>
                                    <reporter username="jmspaggi">Jean-Marc Spaggiari</reporter>
                        <labels>
                    </labels>
                <created>Tue, 25 Jun 2013 13:04:25 +0000</created>
                <updated>Sat, 21 Feb 2015 23:29:11 +0000</updated>
                            <resolved>Thu, 27 Feb 2014 18:47:44 +0000</resolved>
                                    <version>0.94.16</version>
                    <version>0.98.1</version>
                    <version>0.96.1.1</version>
                                    <fixVersion>0.96.2</fixVersion>
                    <fixVersion>0.98.1</fixVersion>
                    <fixVersion>0.99.0</fixVersion>
                                    <component>Usability</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>15</watches>
                                    <timeoriginalestimate seconds="172800">48h</timeoriginalestimate>
                            <timeestimate seconds="172800">48h</timeestimate>
                                        <comments>
                            <comment id="13692999" author="jmspaggi" created="Tue, 25 Jun 2013 13:05:40 +0000"  >&lt;p&gt;Also, today region_mover assigns the regions randomly. Should we go round-robbin instead?&lt;/p&gt;

&lt;p&gt;Working on a fix for 0.94. Will most probably do the job for trunk too. More to come.&lt;/p&gt;</comment>
                            <comment id="13693645" author="stack" created="Wed, 26 Jun 2013 05:11:55 +0000"  >&lt;p&gt;See &quot;15.3.1.1. Decommissioning several Regions Servers concurrently&quot; in &lt;a href=&quot;http://hbase.apache.org/book.html#node.management&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hbase.apache.org/book.html#node.management&lt;/a&gt;  Would the draining services stuff help &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13694031" author="jmspaggi" created="Wed, 26 Jun 2013 15:28:25 +0000"  >&lt;p&gt;So here is what I did.&lt;/p&gt;

&lt;p&gt;First, when regions are unloaded from the server to be moved to other servers. Instead of doing that region by region and randomly, it&apos;s now doing that in round dobin mode, assigning one region per RS. So if there is 20 RS in the cluster, one beeing unloaded, it will move the regions 19 by 19!&lt;/p&gt;

&lt;p&gt;Then to restore the regions, instead of doing that one by one, it&apos;s now going that 10 by 10.&lt;/p&gt;

&lt;p&gt;As a result, the rolling-restart now takes 16 minutes in my cluster instead of 74 minutes. And the bigger the cluster is, the faster it will be.&lt;/p&gt;

&lt;p&gt;This version is for review only. Open to comments. I have tested it on 0.94, but I don&apos;t have a cluster running with Trunk, so I&apos;m not able to test it...&lt;/p&gt;</comment>
                            <comment id="13694044" author="stack" created="Wed, 26 Jun 2013 16:03:38 +0000"  >&lt;p&gt;Can you make this new behavior optional?  Or at least how many to do at a time a parameter (max concurrent threads moving and restoring)?&lt;/p&gt;

&lt;p&gt;Folks want the fast rolling restart for sure &amp;#8211; I know for a fact that a few of your customers need it (smile) &amp;#8211; but the good thing about the old behavior is that it was minimally disruptive (though slow) so is good for a cluster that is doing hard serving.&lt;/p&gt;

&lt;p&gt;Thanks for working on this important operational issue &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13694070" author="hadoopqa" created="Wed, 26 Jun 2013 16:43:03 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12589763/HBASE-8803-v0-trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12589763/HBASE-8803-v0-trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.security.access.TestAccessController&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6146//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13694180" author="jmspaggi" created="Wed, 26 Jun 2013 19:22:29 +0000"  >&lt;p&gt;Sure!&lt;/p&gt;

&lt;p&gt;I will add a parameter like &quot;maxthreads&quot; with a default value to 1 so with no parameters that will act as before, but with this parameters we will be able to speedup the process.&lt;/p&gt;</comment>
                            <comment id="13694198" author="jmspaggi" created="Wed, 26 Jun 2013 19:54:47 +0000"  >&lt;p&gt;Here we go.&lt;/p&gt;

&lt;p&gt;Updated version:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added maxthreads parameter to region_mover.rb and graceful_stop.sh.&lt;/li&gt;
	&lt;li&gt;If maxthreads is &amp;lt; RS then go random, else go roundrobin.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Tested on 0.94, don&apos;t have a way to test it on trunk &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13694244" author="hadoopqa" created="Wed, 26 Jun 2013 21:13:10 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12589789/HBASE-8803-v1-trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12589789/HBASE-8803-v1-trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.security.access.TestAccessController&lt;br/&gt;
                  org.apache.hadoop.hbase.TestIOFencing&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6150//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13698191" author="hadoopqa" created="Tue, 2 Jul 2013 20:32:52 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12590498/HBASE-8803-v1-0.94.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12590498/HBASE-8803-v1-0.94.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6194//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6194//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13698596" author="stack" created="Wed, 3 Jul 2013 04:46:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; Patch looks good.  Let me try it on a cluster before committing...&lt;/p&gt;</comment>
                            <comment id="13699262" author="jmspaggi" created="Wed, 3 Jul 2013 18:01:44 +0000"  >&lt;p&gt;Thanks. Nick also proposed to test it. Let me know if there is anything wrong so I can fix that.&lt;/p&gt;</comment>
                            <comment id="13704037" author="ndimiduk" created="Wed, 10 Jul 2013 00:19:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; I&apos;m testing it now, so far so good. Do you have some recommendations about number of suggested values of &lt;tt&gt;maxthreads&lt;/tt&gt; for the release notes?&lt;/p&gt;</comment>
                            <comment id="13704051" author="ndimiduk" created="Wed, 10 Jul 2013 00:44:01 +0000"  >&lt;p&gt;Here&apos;s an updated patch vs 0.94 that also exposes this functionality in &lt;tt&gt;rolling-restart.sh&lt;/tt&gt;. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; would you mind verifying that it works as expected on your test cluster?&lt;/p&gt;</comment>
                            <comment id="13704504" author="jmspaggi" created="Wed, 10 Jul 2013 12:34:25 +0000"  >&lt;p&gt;Hi Nick, I will for sure give it a try! Most probably this evening. So you can expect a feedback tomorrow morning. For the recommendations, I think the default value is a good start. You can go higher if you node is able to handle it. I tried with 20 and 30 and it worked, but it was not twice or 3 times faster than 10. Only got an extra +20%. Also, it will depend on the region size. For small regions, more threads will be better. For big regions, you will be limited by the network anyway....&lt;/p&gt;</comment>
                            <comment id="13704960" author="jmspaggi" created="Wed, 10 Jul 2013 19:41:34 +0000"  >&lt;p&gt;I think this line:&lt;br/&gt;
+        &quot;$bin&quot;/graceful_stop.sh --config &quot;$&lt;/p&gt;
{HBASE_CONF_DIR}&quot; --restart --reload --debug --maxthreads &quot;${RR_MAXTHREADS} &quot;$hostname&quot;&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
Should be:&lt;br/&gt;
+        &quot;$bin&quot;/graceful_stop.sh --config &quot;${HBASE_CONF_DIR}
&lt;p&gt;&quot; --restart --reload --debug --maxthreads &quot;$&lt;/p&gt;
{RR_MAXTHREADS}
&lt;p&gt;&quot; &quot;$hostname&quot;&lt;/p&gt;


&lt;p&gt;Because I&apos;m getting (which basically says that it&apos;s missing a &quot; somewhere...):&lt;br/&gt;
hbase@node3:~/hbase-0.94.3$ time bin/rolling-restart.sh --graceful&lt;br/&gt;
bin/rolling-restart.sh: ligne171: Caract&#232;re de fin de fichier (EOF) pr&#233;matur&#233; lors de la recherche du &#171; &quot; &#187; correspondant&lt;br/&gt;
bin/rolling-restart.sh: ligne176: Erreur de syntaxe : fin de fichier pr&#233;matur&#233;e&lt;/p&gt;</comment>
                            <comment id="13705218" author="ndimiduk" created="Wed, 10 Jul 2013 23:16:45 +0000"  >&lt;p&gt;Yes, I jumped the gun on posting the patch.&lt;/p&gt;</comment>
                            <comment id="13705377" author="jmspaggi" created="Thu, 11 Jul 2013 01:40:18 +0000"  >&lt;p&gt;I tried with the &quot; added.&lt;/p&gt;

&lt;p&gt;Rolling Restart script without --maxthreads param:&lt;br/&gt;
real    71m12.348s&lt;br/&gt;
user    2m44.578s&lt;br/&gt;
sys     0m9.301s&lt;/p&gt;

&lt;p&gt;Rolling Restart script with --maxthreads 10:&lt;br/&gt;
real    48m18.191s&lt;br/&gt;
user    3m3.479s&lt;br/&gt;
sys     0m11.925s&lt;/p&gt;

&lt;p&gt;Rolling Restart script with --maxthreads 30:&lt;br/&gt;
real    39m58.674s&lt;br/&gt;
user    2m47.802s&lt;br/&gt;
sys     0m9.805s&lt;/p&gt;


&lt;p&gt;Please note that one of ny RS died 2 days ago so I&apos;m down to 7. But with more than 10RS, I really think --maxthreads 30 should show better improvements.&lt;/p&gt;

&lt;p&gt;Conclusion, it&apos;s all working fine.&lt;/p&gt;</comment>
                            <comment id="13706313" author="ndimiduk" created="Thu, 11 Jul 2013 22:08:38 +0000"  >&lt;p&gt;My testing has been pained, in part because I&apos;m learning how to use the cluster resources available to me. Also because I&apos;m frequently hitting troubles where one of the ROOT or META regions become stuck and unmovable. Perhaps 1/3 runs of the rolling-restart.sh script experience this issue. I&apos;m not sure if this is a known issue or something funny about my cluster.&lt;/p&gt;

&lt;p&gt;Excluding the times when that happens, my results aren&apos;t particularly encouraging:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# 9 region servers, 12 regions total:

## 0.94.6.1

real    2m58.097s
user    3m22.527s
sys     0m10.687s

real    3m48.006s
user    3m26.695s
sys     0m11.141s

real    2m27.157s
user    3m15.894s
sys     0m9.895s

real    2m24.395s
user    3m12.016s
sys     0m9.766s

## 0.94.6.1 + 8803, maxthreads 1 (default)

real    7m50.688s
user    3m33.115s
sys     0m11.260s

real    4m13.964s
user    3m24.539s
sys     0m10.290s

real    2m57.423s
user    3m22.539s
sys     0m10.143s

## 0.94.6.1 + 8803, maxthreads 10

real    3m30.100s
user    3m23.651s
sys     0m10.185s

real    3m16.714s
user    3m19.534s
sys     0m10.002s
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll continue to run it in the background. I expect the performance improvement will be more apparent with more regions.&lt;/p&gt;</comment>
                            <comment id="13706329" author="ndimiduk" created="Thu, 11 Jul 2013 22:13:45 +0000"  >&lt;p&gt;Updating attached patch to what I&apos;m running on this cluster.&lt;/p&gt;</comment>
                            <comment id="13706345" author="hadoopqa" created="Thu, 11 Jul 2013 22:22:52 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12591922/HBASE-8803-v2-0.94.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12591922/HBASE-8803-v2-0.94.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6311//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6311//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13706349" author="ndimiduk" created="Thu, 11 Jul 2013 22:26:31 +0000"  >&lt;p&gt;For instance, here&apos;s a recent run of &lt;tt&gt;time /usr/lib/hbase/bin/rolling-restart.sh --rs-only --graceful&lt;/tt&gt; on this cluster of 9 RS&apos;s that took 30+ minutes.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;13/07/10 23:49:33 INFO region_mover: Moving region 1028785192 (1 of 1) to server=XXXXXX,60020,1373499860198
NativeException: org.apache.hadoop.hbase.NotServingRegionException: org.apache.hadoop.hbase.NotServingRegionException: Region is not online: -ROOT-,,0
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:3491)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getClosestRowBefore(HRegionServer.java:2186)
        at sun.reflect.GeneratedMethodAccessor29.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.WritableRpcEngine$Server.call(WritableRpcEngine.java:340)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1426)

          getTable at /usr/lib/hbase/bin/region_mover.rb:74
  isSuccessfulScan at /usr/lib/hbase/bin/region_mover.rb:133
     unloadRegions at /usr/lib/hbase/bin/region_mover.rb:350
              call at org/jruby/RubyProc.java:270
              call at org/jruby/RubyProc.java:224
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As far as I can tell, the ROOT region was never unavailable; I think it&apos;s a race condition in AM.&lt;/p&gt;</comment>
                            <comment id="13706529" author="jmspaggi" created="Fri, 12 Jul 2013 00:52:01 +0000"  >&lt;p&gt;Strange. I tried multiple times and did not received any error. Are you getting that on the logs? Or on the console? I will try to run than in loop over a day to see if I get anything. I&apos;m also restarting the master... Might be the difference. I will try with --rs-only too.&lt;/p&gt;</comment>
                            <comment id="13707086" author="ndimiduk" created="Fri, 12 Jul 2013 17:00:45 +0000"  >&lt;p&gt;This is on the console side, where I&apos;m seeing one of two errors reported:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;13/07/12 04:54:59 INFO region_mover: Moving 301 regions to hor17n39.gq1.ygridcore.net,60020,1373604896136
13/07/12 04:55:05 INFO region_mover: Moving region 70236052 (1 of 301) to server=hor17n39.gq1.ygridcore.net,60020,1373604896136
13/07/12 04:56:05 INFO region_mover: Retry 1 of maximum 5
13/07/12 04:57:05 INFO region_mover: Retry 2 of maximum 5
13/07/12 04:58:05 INFO region_mover: Retry 3 of maximum 5
13/07/12 04:59:05 INFO region_mover: Retry 4 of maximum 5
RuntimeError: Region stuck on hor17n37.gq1.ygridcore.net,60020,1373604896127,, newserver=hor17n39.gq1.ygridcore.net,60020,1373604896136
         move at /usr/lib/hbase/bin/region_mover.rb:175
  loadRegions at /usr/lib/hbase/bin/region_mover.rb:418
         call at org/jruby/RubyProc.java:270
         call at org/jruby/RubyProc.java:224
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;13/07/12 05:00:14 INFO region_mover: Moving 1 region(s) from hor18n39.gq1.ygridcore.net,60020,1373604896155with 1 threads during this cycle
13/07/12 05:00:14 INFO region_mover: Moving region 1028785192 (1 of 1) to server=hor18n37.gq1.ygridcore.net,60020,1373604896136
NativeException: org.apache.hadoop.hbase.NotServingRegionException: org.apache.hadoop.hbase.NotServingRegionException: Region is not online: -ROOT-,,0
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:3491)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getClosestRowBefore(HRegionServer.java:2186)
        at sun.reflect.GeneratedMethodAccessor19.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.WritableRpcEngine$Server.call(WritableRpcEngine.java:340)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1426)

          getTable at /usr/lib/hbase/bin/region_mover.rb:74
  isSuccessfulScan at /usr/lib/hbase/bin/region_mover.rb:133
     unloadRegions at /usr/lib/hbase/bin/region_mover.rb:350
              call at org/jruby/RubyProc.java:270
              call at org/jruby/RubyProc.java:224
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the Master log, I see this on occasion, though it doesn&apos;t appear to happen at the same time as client errors. Here&apos;s an example.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2013-07-09 23:31:40,611 INFO org.apache.hadoop.hbase.catalog.RootLocationEditor: Unsetting ROOT region location in ZooKeeper
2013-07-09 23:31:40,630 WARN org.apache.hadoop.hbase.master.AssignmentManager: Failed assignment of -ROOT-,,0.70236052 to hor18n38.gq1.ygridcore.net,60020,1373412384299, trying to assign elsewhere instead; retry=0
java.io.IOException: Call to hor18n38.gq1.ygridcore.net/206.190.52.121:60020 failed on local exception: java.io.EOFException
        at org.apache.hadoop.hbase.ipc.HBaseClient.wrapException(HBaseClient.java:1030)
        at org.apache.hadoop.hbase.ipc.HBaseClient.call(HBaseClient.java:999)
        at org.apache.hadoop.hbase.ipc.WritableRpcEngine$Invoker.invoke(WritableRpcEngine.java:84)
        at $Proxy11.openRegion(Unknown Source)
        at org.apache.hadoop.hbase.master.ServerManager.sendRegionOpen(ServerManager.java:543)
        at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:1697)
        at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:1424)
        at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:1399)
        at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:1394)
        at org.apache.hadoop.hbase.master.AssignmentManager.assignRoot(AssignmentManager.java:2282)
        at org.apache.hadoop.hbase.master.handler.MetaServerShutdownHandler.verifyAndAssignRoot(MetaServerShutdownHandler.java:129)
        at org.apache.hadoop.hbase.master.handler.MetaServerShutdownHandler.verifyAndAssignRootWithRetries(MetaServerShutdownHandler.java:153)
        at org.apache.hadoop.hbase.master.handler.MetaServerShutdownHandler.process(MetaServerShutdownHandler.java:82)
        at org.apache.hadoop.hbase.executor.EventHandler.run(EventHandler.java:175)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.Thread.run(Thread.java:662)
Caused by: java.io.EOFException
        at java.io.DataInputStream.readInt(DataInputStream.java:375)
        at org.apache.hadoop.hbase.ipc.HBaseClient$Connection.receiveResponse(HBaseClient.java:646)
        at org.apache.hadoop.hbase.ipc.HBaseClient$Connection.run(HBaseClient.java:580)
2013-07-09 23:31:40,632 WARN org.apache.hadoop.hbase.master.AssignmentManager: Unable to find a viable location to assign region -ROOT-,,0.70236052
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I haven&apos;t had time to dedicate to investigating yet. I&apos;ll try to correlate some log entries across the different machines. I don&apos;t think any of it is related to your patch though &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13707504" author="ndimiduk" created="Fri, 12 Jul 2013 22:58:29 +0000"  >&lt;p&gt;Watching the client logs generated, no matter how many threads are specified in --maxthreads, it looks like it&apos;s operating in batches of 8 threads at a time. This is based on the timestamps of log messages. Do you see this behavior too?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;13/07/12 22:55:22 INFO region_mover: Moving 333 region(s) from hor18n37.gq1.ygridcore.net,60020,1373665969266with 10 threads during this cycle
13/07/12 22:55:22 INFO region_mover: Moving region 412f4a174005c1002c09b67caf7ca0c1 (1 of 333) to server=hor18n35.gq1.ygridcore.net,60020,1373665969233
13/07/12 22:55:22 INFO region_mover: Moving region 189b6a8b5081efbbcba869f1d078a757 (2 of 333) to server=hor18n39.gq1.ygridcore.net,60020,1373665969204
13/07/12 22:55:22 INFO region_mover: Moving region 6fe402d9bd16b596cd47454e9a628bea (3 of 333) to server=hor18n38.gq1.ygridcore.net,60020,1373665969217
13/07/12 22:55:22 INFO region_mover: Moving region a98083e87e6c41f89e5ad56607cd3418 (4 of 333) to server=hor17n39.gq1.ygridcore.net,60020,1373665969276
13/07/12 22:55:22 INFO region_mover: Moving region 29eb3d1f13ec65866fd786a1e1257999 (5 of 333) to server=hor18n36.gq1.ygridcore.net,60020,1373665969232
13/07/12 22:55:22 INFO region_mover: Moving region aa43bc2422886d8121c9875d34d520ea (6 of 333) to server=hor17n34.gq1.ygridcore.net,60020,1373665969195
13/07/12 22:55:22 INFO region_mover: Moving region 7dc1554b6c4d983b3252528549bb83fa (7 of 333) to server=hor17n36.gq1.ygridcore.net,60020,1373665969198
13/07/12 22:55:22 INFO region_mover: Moving region 2e7703c6986455f90aaf8e7106d9a657 (8 of 333) to server=hor17n37.gq1.ygridcore.net,60020,1373665969202
13/07/12 22:56:18 INFO region_mover: Moving region 353a09c07053144a598be04a53afa82e (9 of 333) to server=hor18n35.gq1.ygridcore.net,60020,1373665969233
13/07/12 22:56:18 INFO region_mover: Moving region 52ace70b213075d9ed2186bce0438838 (10 of 333) to server=hor18n39.gq1.ygridcore.net,60020,1373665969204
13/07/12 22:56:18 INFO region_mover: Moving region 234265b7ec4e535cecafcdd83f09dab7 (11 of 333) to server=hor18n38.gq1.ygridcore.net,60020,1373665969217
13/07/12 22:56:18 INFO region_mover: Moving region 9f54ff65021922f7c13f4372dbcb8f98 (12 of 333) to server=hor17n39.gq1.ygridcore.net,60020,1373665969276
13/07/12 22:56:18 INFO region_mover: Moving region 49944df5c94ce4b5d3e216588ae3e294 (13 of 333) to server=hor18n36.gq1.ygridcore.net,60020,1373665969232
13/07/12 22:56:18 INFO region_mover: Moving region a41c8422ab47823730b1392d01b2d6f6 (14 of 333) to server=hor17n34.gq1.ygridcore.net,60020,1373665969195
13/07/12 22:56:18 INFO region_mover: Moving region 99d0de33f4c2e87a3aff62bb8b8c81f9 (15 of 333) to server=hor17n36.gq1.ygridcore.net,60020,1373665969198
13/07/12 22:56:18 INFO region_mover: Moving region 2ecb4b37b2be9414396c02ba09920126 (16 of 333) to server=hor17n37.gq1.ygridcore.net,60020,1373665969202
13/07/12 22:56:44 INFO region_mover: Moving region 53f253f820f3dc646fd5ede04280f6dd (17 of 333) to server=hor18n35.gq1.ygridcore.net,60020,1373665969233
13/07/12 22:56:44 INFO region_mover: Moving region bd2bc1dfd5c29188b95a284da9e692e5 (18 of 333) to server=hor18n39.gq1.ygridcore.net,60020,1373665969204
13/07/12 22:56:44 INFO region_mover: Moving region 09163ba03de8e97090247f6c0670faab (19 of 333) to server=hor18n38.gq1.ygridcore.net,60020,1373665969217
13/07/12 22:56:44 INFO region_mover: Moving region 3202636c17aca56fcfd94da3f428d7c1 (20 of 333) to server=hor17n39.gq1.ygridcore.net,60020,1373665969276
13/07/12 22:56:44 INFO region_mover: Moving region 1864cae5e65688bcd6ddf6ae9b16d4e1 (21 of 333) to server=hor18n36.gq1.ygridcore.net,60020,1373665969232
13/07/12 22:56:44 INFO region_mover: Moving region acdff3c0752a93b7d22e878105bc84ff (22 of 333) to server=hor17n34.gq1.ygridcore.net,60020,1373665969195
13/07/12 22:56:44 INFO region_mover: Moving region ff364a6ef2154b28614b5afe12b342d6 (23 of 333) to server=hor17n36.gq1.ygridcore.net,60020,1373665969198
13/07/12 22:56:44 INFO region_mover: Moving region a27b0a6429ccc9907d8b688912920219 (24 of 333) to server=hor17n37.gq1.ygridcore.net,60020,1373665969202
13/07/12 22:57:08 INFO region_mover: Moving region eadcddfac520bae8dbf094c161314791 (25 of 333) to server=hor18n35.gq1.ygridcore.net,60020,1373665969233
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13707891" author="jmspaggi" created="Sun, 14 Jul 2013 00:32:21 +0000"  >&lt;p&gt;That&apos;s weird. This &quot;8&quot; is not coming from anywhere. Not the default, not the parameter...&lt;/p&gt;

&lt;p&gt;I stopped my cluster because we have a heatwave and it&apos;s not more an house that I have, it&apos;s a sauna &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I will restart that tomorrow morning and retry. I will keep you posted.&lt;/p&gt;</comment>
                            <comment id="13708498" author="jmspaggi" created="Mon, 15 Jul 2013 14:28:25 +0000"  >&lt;p&gt;(Sorry, long comment because of all those logs)&lt;/p&gt;

&lt;p&gt;When regions are unload from the server to be assigned somewhere else, threads are limited to the number of servers. So if you have only 9 nodes on your cluster, then your server can send only to 8 other nodes, and that&apos;S why you have a 8 limitation.&lt;/p&gt;

&lt;p&gt;When regions are re-loaded from the other nodes to the server, then the only limitation is the thread parameter. Below are some tests for this scenario.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
13/07/15 09:38:39 INFO region_mover: Moving region 83a139f0629f2afbccc16f28c1fc5b07 (1 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:39 INFO region_mover: Moving region 20a2b8e4d5346d05fc5659a04d5ccc2d (2 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:39 INFO region_mover: Moving region 7b4dabe9857fdec833791bf70a6446a0 (3 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:39 INFO region_mover: Moving region 7e1feaaff3c1be8e413072b4671245bf (4 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:39 INFO region_mover: Moving region e6d0569bd931317429cb5a130ea6a7f4 (5 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:39 INFO region_mover: Moving region d2190b8d656d6a813096b8d7b85f124c (6 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:39 INFO region_mover: Moving region 1c024b8cabfea6dd735c6444cc7237a0 (7 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:39 INFO region_mover: Moving region 0dfe044b3625984954505cfdf7adb32d (8 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:39 INFO region_mover: Moving region 71c9d0ba64b16fb18fa7907227cb866a (9 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:39 INFO region_mover: Moving region 1ccf69eb2e53c0decaf2dfa7aca86257 (10 of 116) to server=node2,60020,1373895516200

13/07/15 09:38:45 INFO region_mover: Moving region 8f5afbea06948fd57014bab1e9e07ea3 (11 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:45 INFO region_mover: Moving region 0f08b0a2377ec8633259a84668ee98ea (12 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:45 INFO region_mover: Moving region e7b5a672b8d600e5d2b3021d6e1804eb (13 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:45 INFO region_mover: Moving region 753afdbeae4cdd39032285ca635ea51a (14 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:45 INFO region_mover: Moving region 4ea46ce099c17587b064c003280e130a (15 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:45 INFO region_mover: Moving region 90cb0fc165da7cf677b8bfc4ec1850d4 (16 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:45 INFO region_mover: Moving region 9b5e03d5d38166f9be2a8ecc9d393780 (17 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:45 INFO region_mover: Moving region e9638c105de9dab6a7f889ca0da80227 (18 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:45 INFO region_mover: Moving region 60bfa08feb8d82ceed03b4dc56979d3f (19 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:45 INFO region_mover: Moving region a37988e554deff2b1a8c7477639f3872 (20 of 116) to server=node2,60020,1373895516200

13/07/15 09:38:49 INFO region_mover: Moving region 135966bd36f58329f532fdd8aa4b0bc7 (21 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:49 INFO region_mover: Moving region 6d2ba19a71695ed8b97eac6f772c37b6 (22 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:49 INFO region_mover: Moving region 8b8804d988d60da967fe5fd1cea44f96 (23 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:49 INFO region_mover: Moving region a133c11bc0b5e22d30e4d92e40e8adf8 (24 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:49 INFO region_mover: Moving region 18c67cefc95a0484242b74df70160d3d (25 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:49 INFO region_mover: Moving region 9ea96fe31480fededf978d59a9ae148d (26 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:49 INFO region_mover: Moving region af85ba099ccb1f51630ae4a806918150 (27 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:49 INFO region_mover: Moving region 57a5bbe2c33b13ec6dc4e28c21324b45 (28 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:49 INFO region_mover: Moving region 3a28d3a027385a65bcd001516bc8da5f (29 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:49 INFO region_mover: Moving region 00fd5546feaeb573e7232825d4b2af88 (30 of 116) to server=node2,60020,1373895516200

13/07/15 09:38:52 INFO region_mover: Moving region 9988b51ab86393b007fec59cccb6cfec (31 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:52 INFO region_mover: Moving region 06d051f424d2ac80fc896bad1fc70a37 (32 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:52 INFO region_mover: Moving region 686a74d0e16586abbc6414af79ebbc45 (33 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:52 INFO region_mover: Moving region b139540fa33e3460375f913550a00403 (34 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:52 INFO region_mover: Moving region 9639ffcd59bfe255313bb504cf3c5c26 (35 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:52 INFO region_mover: Moving region e9965f1194f422276ed36de3b57fbb7d (36 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:52 INFO region_mover: Moving region 6f4a67e9e8863dbcc3225977bb2b50a3 (37 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:52 INFO region_mover: Moving region e212ebcaa40162bda4f113e9103dd317 (38 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:52 INFO region_mover: Moving region 0b76c187b57322876972a6a4d33df156 (39 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:52 INFO region_mover: Moving region c9307492fda9f61f9b1e07b3dfbff137 (40 of 116) to server=node2,60020,1373895516200

13/07/15 09:38:55 INFO region_mover: Moving region b080758e6ab4bc1c15cec8a7dabeb9bf (41 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:55 INFO region_mover: Moving region f2d4375225e6d4b0ff95aeb34f2ea952 (42 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:55 INFO region_mover: Moving region d87ab7c5aa51da57428a3461a7ca8094 (43 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:55 INFO region_mover: Moving region b07032e2330ecda3716b2ce5b335ac72 (44 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:55 INFO region_mover: Moving region fa6bddd81e34e641e9303444ee7470b9 (45 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:55 INFO region_mover: Moving region 2ea1a87a76863aca50fe84af7a50253c (46 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:55 INFO region_mover: Moving region e3e466191856ff9fed3ddad62a77a1e8 (47 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:55 INFO region_mover: Moving region aa373efd5677f1eeb4ef42a96910fcf8 (48 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:55 INFO region_mover: Moving region 08c3f9bf3af9ecd1bb24d95152f6c9b6 (49 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:55 INFO region_mover: Moving region 164d33459ccf79c42290e126f284f9c6 (50 of 116) to server=node2,60020,1373895516200

13/07/15 09:38:58 INFO region_mover: Moving region df71b41ab76993b32ba2abbb5ba4d37f (51 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:58 INFO region_mover: Moving region 25b6b7bd6ec050d702ece3b0d819742a (52 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:58 INFO region_mover: Moving region ebf3475952e14bc60f159a2eaae9a9d6 (53 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:58 INFO region_mover: Moving region 59249ea50e8a8c97fdf9779a05d8388a (54 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:58 INFO region_mover: Moving region 3c89480e1b73cf11c8dc8d23858eea0e (55 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:58 INFO region_mover: Moving region d0148b1da1c81eda0ff48be4906478a2 (56 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:58 INFO region_mover: Moving region 6f0c16ce6f8c8692f5c3524716d94ecd (57 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:58 INFO region_mover: Moving region 1a2dc3904d34b8300933c9e342e859c3 (58 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:58 INFO region_mover: Moving region 801ef112377eeac002d1bdc9e5f7ee0f (59 of 116) to server=node2,60020,1373895516200
13/07/15 09:38:58 INFO region_mover: Moving region 8a9a80356ff77328109a5ebf0b934afd (60 of 116) to server=node2,60020,1373895516200
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I called with --maxthreads 15 but transfers are done 10 by 10... Which is strange, because default value is 1.&lt;/p&gt;

&lt;p&gt;So I tried to directly called graceful_stop:&lt;br/&gt;
time ./bin/graceful_stop.sh --restart --reload --debug --maxthreads 50 buldo&lt;/p&gt;

&lt;p&gt;And I also got strange results.&lt;/p&gt;

&lt;p&gt;So, I have added some traces on the files and here is the result now:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
13/07/15 10:03:56 INFO region_mover: Moving 86 region(s) from node6,60020,1373896882598 during &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; cycle
13/07/15 10:03:56 INFO region_mover: Moving region 7e1feaaff3c1be8e413072b4671245bf (1 of 86) to server=buldo,60020,1373896150259 in thread 0
13/07/15 10:03:56 INFO region_mover: Moving region 8abde383e3636318bb7601625b40163c (2 of 86) to server=node4,60020,1373895267449 in thread 1
13/07/15 10:03:56 INFO region_mover: Moving region 5e04334d7f27ffdbfa4e8f052792b110 (3 of 86) to server=node1,60020,1373895391970 in thread 2
13/07/15 10:03:56 INFO region_mover: Moving region 67512d9f22845ba8ee6de91faa186903 (4 of 86) to server=node2,60020,1373895516200 in thread 3
13/07/15 10:03:56 INFO region_mover: Moving region c1f031019fd580ce00aba7fe7981829a (5 of 86) to server=node3,60020,1373894767796 in thread 4
13/07/15 10:03:56 INFO region_mover: Moving region dc88edfc0713ca546c635ac7d4cfbe15 (6 of 86) to server=node5,60020,1373894990003 in thread 5
13/07/15 10:03:59 INFO region_mover: Moving region c06093c3c8cbcace8fd237de3f961f08 (7 of 86) to server=buldo,60020,1373896150259 in thread 0
13/07/15 10:03:59 INFO region_mover: Moving region 76523c4b4850bf7d17db914ccee13301 (8 of 86) to server=node4,60020,1373895267449 in thread 1
13/07/15 10:03:59 INFO region_mover: Moving region 336df9ec1e4aeeda611c284bc981ac55 (9 of 86) to server=node1,60020,1373895391970 in thread 2
13/07/15 10:03:59 INFO region_mover: Moving region b2a5614b21802154b86ddc52e9e70c33 (10 of 86) to server=node2,60020,1373895516200 in thread 3
13/07/15 10:03:59 INFO region_mover: Moving region a4d57785c95465bb19a76a4e545c6f61 (11 of 86) to server=node3,60020,1373894767796 in thread 4
13/07/15 10:03:59 INFO region_mover: Moving region 4de77fcc4e8e87402db9177bff06dae1 (12 of 86) to server=node5,60020,1373894990003 in thread 5
13/07/15 10:04:00 INFO region_mover: Moving region af39a4ad71dc04b1423d8fd490aa9d81 (13 of 86) to server=buldo,60020,1373896150259 in thread 0
13/07/15 10:04:00 INFO region_mover: Moving region 083f20d0ad282e70dbfddfb4e8c62acd (14 of 86) to server=node4,60020,1373895267449 in thread 1
13/07/15 10:04:00 INFO region_mover: Moving region 90343db01d7723b7a60e875bb67bddb9 (15 of 86) to server=node1,60020,1373895391970 in thread 2
13/07/15 10:04:00 INFO region_mover: Moving region fab38f5728767a158803b6a1b66ce769 (16 of 86) to server=node2,60020,1373895516200 in thread 3
13/07/15 10:04:00 INFO region_mover: Moving region ef52da3e8352fbed3c2e5602407fd72e (17 of 86) to server=node3,60020,1373894767796 in thread 4
13/07/15 10:04:00 INFO region_mover: Moving region a6f4afc58fc58a454dde201d09353418 (18 of 86) to server=node5,60020,1373894990003 in thread 5
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is correct. I have 7 nodes, one which is going down so I have 1 source and 6 targets, 0 to 5.&lt;/p&gt;

&lt;p&gt;And this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
13/07/15 10:04:36 INFO region_mover: Moving region c1f031019fd580ce00aba7fe7981829a (1 of 86) to server=node6,60020,1373897072968 in thread 0
13/07/15 10:04:36 INFO region_mover: Moving region 8abde383e3636318bb7601625b40163c (2 of 86) to server=node6,60020,1373897072968 in thread 1
13/07/15 10:04:36 INFO region_mover: Moving region dc88edfc0713ca546c635ac7d4cfbe15 (3 of 86) to server=node6,60020,1373897072968 in thread 2
13/07/15 10:04:36 INFO region_mover: Moving region 5e04334d7f27ffdbfa4e8f052792b110 (4 of 86) to server=node6,60020,1373897072968 in thread 3
13/07/15 10:04:36 INFO region_mover: Moving region 67512d9f22845ba8ee6de91faa186903 (5 of 86) to server=node6,60020,1373897072968 in thread 4
13/07/15 10:04:36 INFO region_mover: Moving region 7e1feaaff3c1be8e413072b4671245bf (6 of 86) to server=node6,60020,1373897072968 in thread 5
13/07/15 10:04:36 INFO region_mover: Moving region c06093c3c8cbcace8fd237de3f961f08 (7 of 86) to server=node6,60020,1373897072968 in thread 6
13/07/15 10:04:36 INFO region_mover: Moving region 4de77fcc4e8e87402db9177bff06dae1 (8 of 86) to server=node6,60020,1373897072968 in thread 7
13/07/15 10:04:36 INFO region_mover: Moving region 336df9ec1e4aeeda611c284bc981ac55 (9 of 86) to server=node6,60020,1373897072968 in thread 8
13/07/15 10:04:36 INFO region_mover: Moving region b2a5614b21802154b86ddc52e9e70c33 (10 of 86) to server=node6,60020,1373897072968 in thread 9
13/07/15 10:04:42 INFO region_mover: Moving region a4d57785c95465bb19a76a4e545c6f61 (11 of 86) to server=node6,60020,1373897072968 in thread 0
13/07/15 10:04:42 INFO region_mover: Moving region 76523c4b4850bf7d17db914ccee13301 (12 of 86) to server=node6,60020,1373897072968 in thread 1
13/07/15 10:04:42 INFO region_mover: Moving region af39a4ad71dc04b1423d8fd490aa9d81 (13 of 86) to server=node6,60020,1373897072968 in thread 2
13/07/15 10:04:42 INFO region_mover: Moving region a6f4afc58fc58a454dde201d09353418 (14 of 86) to server=node6,60020,1373897072968 in thread 3
13/07/15 10:04:42 INFO region_mover: Moving region 083f20d0ad282e70dbfddfb4e8c62acd (15 of 86) to server=node6,60020,1373897072968 in thread 4
13/07/15 10:04:42 INFO region_mover: Moving region fab38f5728767a158803b6a1b66ce769 (16 of 86) to server=node6,60020,1373897072968 in thread 5
13/07/15 10:04:42 INFO region_mover: Moving region ef52da3e8352fbed3c2e5602407fd72e (17 of 86) to server=node6,60020,1373897072968 in thread 6
13/07/15 10:04:42 INFO region_mover: Moving region 90343db01d7723b7a60e875bb67bddb9 (18 of 86) to server=node6,60020,1373897072968 in thread 7
13/07/15 10:04:42 INFO region_mover: Moving region b139540fa33e3460375f913550a00403 (19 of 86) to server=node6,60020,1373897072968 in thread 8
13/07/15 10:04:42 INFO region_mover: Moving region cc87da68186cfe25cdf7395be9d12f96 (20 of 86) to server=node6,60020,1373897072968 in thread 9
13/07/15 10:04:43 INFO region_mover: Moving region 9639ffcd59bfe255313bb504cf3c5c26 (21 of 86) to server=node6,60020,1373897072968 in thread 0
13/07/15 10:04:43 INFO region_mover: Moving region d43b99bdb63a0629d9722b491518f684 (22 of 86) to server=node6,60020,1373897072968 in thread 1
13/07/15 10:04:43 INFO region_mover: Moving region 704a1653c2e983f40a2746d1cb7e5c7d (23 of 86) to server=node6,60020,1373897072968 in thread 2
13/07/15 10:04:43 INFO region_mover: Moving region 19d8530b5d619dc88d6ac3a40e13ebc5 (24 of 86) to server=node6,60020,1373897072968 in thread 3
13/07/15 10:04:43 INFO region_mover: Moving region 06d051f424d2ac80fc896bad1fc70a37 (25 of 86) to server=node6,60020,1373897072968 in thread 4
13/07/15 10:04:43 INFO region_mover: Moving region b080758e6ab4bc1c15cec8a7dabeb9bf (26 of 86) to server=node6,60020,1373897072968 in thread 5
13/07/15 10:04:43 INFO region_mover: Moving region c9307492fda9f61f9b1e07b3dfbff137 (27 of 86) to server=node6,60020,1373897072968 in thread 6
13/07/15 10:04:43 INFO region_mover: Moving region 686a74d0e16586abbc6414af79ebbc45 (28 of 86) to server=node6,60020,1373897072968 in thread 7
13/07/15 10:04:43 INFO region_mover: Moving region e212ebcaa40162bda4f113e9103dd317 (29 of 86) to server=node6,60020,1373897072968 in thread 8
13/07/15 10:04:44 INFO region_mover: Moving region dfcd750be0e2b546d76c752d522c52af (30 of 86) to server=node6,60020,1373897072968 in thread 9
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which is NOT correct! Threads always stop after 10, however, I called with 50! &lt;/p&gt;

&lt;p&gt;Parameter is received correctly:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase@node3:~/hbase-0.94.3$ time ./bin/graceful_stop.sh --restart --reload --debug --maxthreads 50 node6
Doing rolling with maxthreads=50
Disabling balancer! (&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; required)
Previous balancer state was &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So I looked at the code, and the issue is here:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; thread_index &amp;lt; 10 &amp;amp;&amp;amp; counter &amp;lt; regions.length &amp;amp;&amp;amp; thread_index &amp;lt; options[:maxthreads] &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which should be &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; counter &amp;lt; regions.length &amp;amp;&amp;amp; thread_index &amp;lt; options[:maxthreads] &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;Which this change, regions are assigned back faster:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
node6: starting regionserver, logging to /home/hbase/hbase-0.94.3/bin/../logs/hbase-hbase-regionserver-node6.out
Reloading node6 region(s)
13/07/15 10:08:41 INFO region_mover: hostname=node6 is not up yet, waiting
13/07/15 10:08:42 INFO region_mover: hostname=node6 is not up yet, waiting
13/07/15 10:08:42 INFO region_mover: Moving 86 regions to node6,60020,1373897320069
13/07/15 10:08:42 INFO region_mover: Moving region 8abde383e3636318bb7601625b40163c (1 of 86) to server=node6,60020,1373897320069 in thread 0
13/07/15 10:08:42 INFO region_mover: Moving region 5e04334d7f27ffdbfa4e8f052792b110 (2 of 86) to server=node6,60020,1373897320069 in thread 1
13/07/15 10:08:42 INFO region_mover: Moving region c1f031019fd580ce00aba7fe7981829a (3 of 86) to server=node6,60020,1373897320069 in thread 2
13/07/15 10:08:46 INFO region_mover: Moving region 7e1feaaff3c1be8e413072b4671245bf (4 of 86) to server=node6,60020,1373897320069 in thread 3
13/07/15 10:08:46 INFO region_mover: Moving region 67512d9f22845ba8ee6de91faa186903 (5 of 86) to server=node6,60020,1373897320069 in thread 4
13/07/15 10:08:46 INFO region_mover: Moving region dc88edfc0713ca546c635ac7d4cfbe15 (6 of 86) to server=node6,60020,1373897320069 in thread 5
13/07/15 10:08:46 INFO region_mover: Moving region a4d57785c95465bb19a76a4e545c6f61 (7 of 86) to server=node6,60020,1373897320069 in thread 6
13/07/15 10:08:46 INFO region_mover: Moving region b2a5614b21802154b86ddc52e9e70c33 (8 of 86) to server=node6,60020,1373897320069 in thread 7
13/07/15 10:08:46 INFO region_mover: Moving region 4de77fcc4e8e87402db9177bff06dae1 (9 of 86) to server=node6,60020,1373897320069 in thread 8
13/07/15 10:08:46 INFO region_mover: Moving region c06093c3c8cbcace8fd237de3f961f08 (10 of 86) to server=node6,60020,1373897320069 in thread 9
13/07/15 10:08:46 INFO region_mover: Moving region 76523c4b4850bf7d17db914ccee13301 (11 of 86) to server=node6,60020,1373897320069 in thread 10
13/07/15 10:08:46 INFO region_mover: Moving region 336df9ec1e4aeeda611c284bc981ac55 (12 of 86) to server=node6,60020,1373897320069 in thread 11
13/07/15 10:08:46 INFO region_mover: Moving region af39a4ad71dc04b1423d8fd490aa9d81 (13 of 86) to server=node6,60020,1373897320069 in thread 12
13/07/15 10:08:46 INFO region_mover: Moving region fab38f5728767a158803b6a1b66ce769 (14 of 86) to server=node6,60020,1373897320069 in thread 13
13/07/15 10:08:46 INFO region_mover: Moving region ef52da3e8352fbed3c2e5602407fd72e (15 of 86) to server=node6,60020,1373897320069 in thread 14
13/07/15 10:08:46 INFO region_mover: Moving region a6f4afc58fc58a454dde201d09353418 (16 of 86) to server=node6,60020,1373897320069 in thread 15
13/07/15 10:08:46 INFO region_mover: Moving region 083f20d0ad282e70dbfddfb4e8c62acd (17 of 86) to server=node6,60020,1373897320069 in thread 16
13/07/15 10:08:46 INFO region_mover: Moving region 90343db01d7723b7a60e875bb67bddb9 (18 of 86) to server=node6,60020,1373897320069 in thread 17
13/07/15 10:08:46 INFO region_mover: Moving region b139540fa33e3460375f913550a00403 (19 of 86) to server=node6,60020,1373897320069 in thread 18
13/07/15 10:08:46 INFO region_mover: Moving region d43b99bdb63a0629d9722b491518f684 (20 of 86) to server=node6,60020,1373897320069 in thread 19
13/07/15 10:08:46 INFO region_mover: Moving region 9639ffcd59bfe255313bb504cf3c5c26 (21 of 86) to server=node6,60020,1373897320069 in thread 20
13/07/15 10:08:46 INFO region_mover: Moving region cc87da68186cfe25cdf7395be9d12f96 (22 of 86) to server=node6,60020,1373897320069 in thread 21
13/07/15 10:08:46 INFO region_mover: Moving region 704a1653c2e983f40a2746d1cb7e5c7d (23 of 86) to server=node6,60020,1373897320069 in thread 22
13/07/15 10:08:46 INFO region_mover: Moving region 19d8530b5d619dc88d6ac3a40e13ebc5 (24 of 86) to server=node6,60020,1373897320069 in thread 23
13/07/15 10:08:47 INFO region_mover: Moving region b080758e6ab4bc1c15cec8a7dabeb9bf (25 of 86) to server=node6,60020,1373897320069 in thread 24
13/07/15 10:08:47 INFO region_mover: Moving region 06d051f424d2ac80fc896bad1fc70a37 (26 of 86) to server=node6,60020,1373897320069 in thread 25
13/07/15 10:08:47 INFO region_mover: Moving region c9307492fda9f61f9b1e07b3dfbff137 (27 of 86) to server=node6,60020,1373897320069 in thread 26
13/07/15 10:08:47 INFO region_mover: Moving region 686a74d0e16586abbc6414af79ebbc45 (28 of 86) to server=node6,60020,1373897320069 in thread 27
13/07/15 10:08:47 INFO region_mover: Moving region dfcd750be0e2b546d76c752d522c52af (29 of 86) to server=node6,60020,1373897320069 in thread 28
13/07/15 10:08:47 INFO region_mover: Moving region e212ebcaa40162bda4f113e9103dd317 (30 of 86) to server=node6,60020,1373897320069 in thread 29
13/07/15 10:08:47 INFO region_mover: Moving region 850b52020a3c58465348bc7019cb18d5 (31 of 86) to server=node6,60020,1373897320069 in thread 30
13/07/15 10:08:47 INFO region_mover: Moving region d87ab7c5aa51da57428a3461a7ca8094 (32 of 86) to server=node6,60020,1373897320069 in thread 31
13/07/15 10:08:47 INFO region_mover: Moving region 84fb7155803a865a0cfd667aebb1319e (33 of 86) to server=node6,60020,1373897320069 in thread 32
13/07/15 10:08:47 INFO region_mover: Moving region 93f92112f0a7f0d710cfa4f3bb3969f2 (34 of 86) to server=node6,60020,1373897320069 in thread 33
13/07/15 10:08:47 INFO region_mover: Moving region 1b1dbb16623f848f864039c835cc762c (35 of 86) to server=node6,60020,1373897320069 in thread 34
13/07/15 10:08:47 INFO region_mover: Moving region a545b4c68c34b113a7aaa6adaffdd6a7 (36 of 86) to server=node6,60020,1373897320069 in thread 35
13/07/15 10:08:47 INFO region_mover: Moving region 35d4440e947a9fad6afb185db7e2c5f8 (37 of 86) to server=node6,60020,1373897320069 in thread 36
13/07/15 10:08:47 INFO region_mover: Moving region 328f2c345f1c68cf231c564c81fb7602 (38 of 86) to server=node6,60020,1373897320069 in thread 37
13/07/15 10:08:47 INFO region_mover: Moving region 1a561226889cc4a1d022b9055c86ac88 (39 of 86) to server=node6,60020,1373897320069 in thread 38
13/07/15 10:08:47 INFO region_mover: Moving region 995a13fc260782460eda330ab905c1ae (40 of 86) to server=node6,60020,1373897320069 in thread 39
13/07/15 10:08:47 INFO region_mover: Moving region be63b5b8804e62e15fb484426892dc2a (41 of 86) to server=node6,60020,1373897320069 in thread 40
13/07/15 10:08:47 INFO region_mover: Moving region 33d846ea97d89df08c06fed5315f1a4e (42 of 86) to server=node6,60020,1373897320069 in thread 41
13/07/15 10:08:47 INFO region_mover: Moving region b42df270d6b1c81ec0f464b38d554caa (43 of 86) to server=node6,60020,1373897320069 in thread 42
13/07/15 10:08:47 INFO region_mover: Moving region 27516238bf5c278bef833f9f8ab578a4 (44 of 86) to server=node6,60020,1373897320069 in thread 43
13/07/15 10:08:47 INFO region_mover: Moving region 390e346b871aae673a5771118da3e218 (45 of 86) to server=node6,60020,1373897320069 in thread 44
13/07/15 10:08:47 INFO region_mover: Moving region 12ad4888d6a6c5b706ad31eef7075522 (46 of 86) to server=node6,60020,1373897320069 in thread 45
13/07/15 10:08:47 INFO region_mover: Moving region b97a8f3dc029ad6f7a074663ebcb20ae (47 of 86) to server=node6,60020,1373897320069 in thread 46
13/07/15 10:08:47 INFO region_mover: Moving region 87c2a872fd747934bfadc2d8baf23cc1 (48 of 86) to server=node6,60020,1373897320069 in thread 47
13/07/15 10:08:47 INFO region_mover: Moving region f6c158948af66e84b6ac50bb2d06328b (49 of 86) to server=node6,60020,1373897320069 in thread 48
13/07/15 10:08:47 INFO region_mover: Moving region 3a43e4cce05e390c5c2a0a3c7de27609 (50 of 86) to server=node6,60020,1373897320069 in thread 49
13/07/15 10:08:53 INFO region_mover: Moving region 97fea8530a248e90dd1fc702cf9f5615 (51 of 86) to server=node6,60020,1373897320069 in thread 0
13/07/15 10:08:53 INFO region_mover: Moving region e1db3e40fca7b65d21f89ea299b7a6ab (52 of 86) to server=node6,60020,1373897320069 in thread 1
13/07/15 10:08:53 INFO region_mover: Moving region 080bbb7863d7ea557518349f4aaec6f2 (53 of 86) to server=node6,60020,1373897320069 in thread 2
13/07/15 10:08:53 INFO region_mover: Moving region 9aae66c0345ab31600dd19b3846953af (54 of 86) to server=node6,60020,1373897320069 in thread 3
13/07/15 10:08:53 INFO region_mover: Moving region 7560d31b45659d6428aea45341fb50a0 (55 of 86) to server=node6,60020,1373897320069 in thread 4
13/07/15 10:08:53 INFO region_mover: Moving region 479226a40a0eb5917a3022a26b8433f2 (56 of 86) to server=node6,60020,1373897320069 in thread 5
13/07/15 10:08:53 INFO region_mover: Moving region 67b53c3f300459588ada5a03708ddd6a (57 of 86) to server=node6,60020,1373897320069 in thread 6
13/07/15 10:08:53 INFO region_mover: Moving region dd51d21b7393a9e55058b637a127e972 (58 of 86) to server=node6,60020,1373897320069 in thread 7
13/07/15 10:08:53 INFO region_mover: Moving region e0d9a50c271e20ea198b651ba6a51506 (59 of 86) to server=node6,60020,1373897320069 in thread 8
13/07/15 10:08:53 INFO region_mover: Moving region 5efeb8e3c9c1b9c36871f8a01546d37f (60 of 86) to server=node6,60020,1373897320069 in thread 9
13/07/15 10:08:53 INFO region_mover: Moving region 6c1bd871810fd82112fa1b6d59e54f20 (61 of 86) to server=node6,60020,1373897320069 in thread 10
13/07/15 10:08:53 INFO region_mover: Moving region a65a5d0b011b16d6bfb9c255b660488c (62 of 86) to server=node6,60020,1373897320069 in thread 11
13/07/15 10:08:53 INFO region_mover: Moving region d4353fe99c08edb8afd99f678370f25c (63 of 86) to server=node6,60020,1373897320069 in thread 12
13/07/15 10:08:53 INFO region_mover: Moving region 8b77e785125f6266d5e85d5e6dffc7b6 (64 of 86) to server=node6,60020,1373897320069 in thread 13
13/07/15 10:08:56 INFO region_mover: Moving region fe8ae36515c4ff12d7c789dec5561255 (65 of 86) to server=node6,60020,1373897320069 in thread 14
13/07/15 10:08:56 INFO region_mover: Moving region 3fda0f5c7a845ea17c69d0c0a798011c (66 of 86) to server=node6,60020,1373897320069 in thread 15
13/07/15 10:08:56 INFO region_mover: Moving region 2d96d34b345147bb2a1f4ce9093e8ac1 (67 of 86) to server=node6,60020,1373897320069 in thread 16
13/07/15 10:08:56 INFO region_mover: Moving region 90d6c08774576abaec3769402084dcd1 (68 of 86) to server=node6,60020,1373897320069 in thread 17
13/07/15 10:08:56 INFO region_mover: Moving region 6fb8972955a0ef3d7aa3b92eaedc6e7e (69 of 86) to server=node6,60020,1373897320069 in thread 18
13/07/15 10:08:56 INFO region_mover: Moving region 2f7d30310466c1933263f03fda043dea (70 of 86) to server=node6,60020,1373897320069 in thread 19
13/07/15 10:08:56 INFO region_mover: Moving region ea4f03a2c30f28f0ea00c40a1255d26a (71 of 86) to server=node6,60020,1373897320069 in thread 20
13/07/15 10:08:56 INFO region_mover: Moving region b6aa2ce729d983cba4cb4032d6844340 (72 of 86) to server=node6,60020,1373897320069 in thread 21
13/07/15 10:08:56 INFO region_mover: Moving region 9913a2995938209dd92bd88c26896bf5 (73 of 86) to server=node6,60020,1373897320069 in thread 22
13/07/15 10:08:56 INFO region_mover: Moving region d397d88e1382b423e10d1e8f6fa7373c (74 of 86) to server=node6,60020,1373897320069 in thread 23
13/07/15 10:08:56 INFO region_mover: Moving region c73742d4ee051408f4ba046f2a0d8d91 (75 of 86) to server=node6,60020,1373897320069 in thread 24
13/07/15 10:08:56 INFO region_mover: Moving region 5907da5fd675f4b37a536a8e6c4fe707 (76 of 86) to server=node6,60020,1373897320069 in thread 25
13/07/15 10:08:56 INFO region_mover: Moving region 1557dbe459c1fb8aefd5a20cab3ff48c (77 of 86) to server=node6,60020,1373897320069 in thread 26
13/07/15 10:08:56 INFO region_mover: Moving region 87e54006d207cab2b4e2e4eca6d28970 (78 of 86) to server=node6,60020,1373897320069 in thread 27
13/07/15 10:08:56 INFO region_mover: Moving region d78195fe223c3e66a5ac88b20dc44171 (79 of 86) to server=node6,60020,1373897320069 in thread 28
13/07/15 10:08:56 INFO region_mover: Moving region 6c8774f2998956a65eadb6a60a53e989 (80 of 86) to server=node6,60020,1373897320069 in thread 29
13/07/15 10:08:56 INFO region_mover: Moving region 96eb5def7988120bce6276f4d77565db (81 of 86) to server=node6,60020,1373897320069 in thread 30
13/07/15 10:08:56 INFO region_mover: Moving region 5e7ecf6fc95285551038bfe6e9b8f1f7 (82 of 86) to server=node6,60020,1373897320069 in thread 31
13/07/15 10:08:56 INFO region_mover: Moving region 39417a882f11daf537d0060cb7a21317 (83 of 86) to server=node6,60020,1373897320069 in thread 32
13/07/15 10:08:56 INFO region_mover: Moving region 8703330d16c09882c5d0729257e2c2a8 (84 of 86) to server=node6,60020,1373897320069 in thread 33
13/07/15 10:08:56 INFO region_mover: Moving region bbc7c34c89527ae1a15e4ce763ec93e3 (85 of 86) to server=node6,60020,1373897320069 in thread 34
13/07/15 10:08:56 INFO region_mover: Moving region 1d047071a5b9074e0d25de9e71872ed6 (86 of 86) to server=node6,60020,1373897320069 in thread 35
Reloaded node6 region(s)
Restoring balancer state to &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And it&apos;s now WAY faster! With maxthreads 50 it takes 16 minutes now instead of about 40 minutes before &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Can you apply this modification in your last patch?&lt;/p&gt;</comment>
                            <comment id="13710555" author="jmspaggi" created="Wed, 17 Jul 2013 00:51:25 +0000"  >&lt;p&gt;Updated patch attached.&lt;br/&gt;
Last patch was not properly generated. Also removed the hardcoded limit of 10 threads. Patch is the same for trunk.&lt;/p&gt;</comment>
                            <comment id="13711462" author="ndimiduk" created="Wed, 17 Jul 2013 18:49:29 +0000"  >&lt;p&gt;I&apos;m running patch v3 on my 9-RS cluster. I&apos;ve launched with &lt;tt&gt;--maxthreads 30&lt;/tt&gt; but I don&apos;t see the large patches in my client log that you describe.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;13/07/17 18:47:31 INFO region_mover: Moving region 00bbc3cd355651554df48d3948119bab (43 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:47:35 INFO region_mover: Moving region f3a8c38a7dacb48917f848f37e8e670d (44 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:47:38 INFO region_mover: Moving region ff4defad3aef5417971339ab37214daf (45 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:47:42 INFO region_mover: Moving region 9253edb099d550f2786eecf5c39709f3 (46 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:47:45 INFO region_mover: Moving region 09fc40629d08626ff3d36ed15dbe1705 (47 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:47:48 INFO region_mover: Moving region 432473d414f126231224dc6429234f25 (48 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:47:51 INFO region_mover: Moving region 0156d9fe5e0e62222249661886872dcc (49 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:47:55 INFO region_mover: Moving region 2a5dc1637da251b877c8090aabb9dc58 (50 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:47:58 INFO region_mover: Moving region 27742b401ac21bcf8962b763b793132a (51 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:48:02 INFO region_mover: Moving region ea947dfb592caaee4935a9a6a9fe3834 (52 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:48:05 INFO region_mover: Moving region 41e8c343619b8721f903d3d2d4916f1b (53 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:48:09 INFO region_mover: Moving region 3fcbe56cad80be6f9a35e3597aaadd65 (54 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:48:12 INFO region_mover: Moving region 65836a90ec7807e71cbca0bbf5d9c396 (55 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:48:15 INFO region_mover: Moving region 1e062baf480f4793f4c12599c266ebca (56 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:48:18 INFO region_mover: Moving region bfcc2d5b463df8ecb685f9b4acb5afed (57 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:48:21 INFO region_mover: Moving region 05fa8744f0afdf2d8a06941dc93c1211 (58 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:48:24 INFO region_mover: Moving region 37a640842bd85a97b1d4afb4d02f2a6e (59 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:48:28 INFO region_mover: Moving region f87a5965fbb1bb548ff51e45a17342b4 (60 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:48:32 INFO region_mover: Moving region 2f6bf66b2cff2eb4957159c79ef39665 (61 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
13/07/17 18:48:35 INFO region_mover: Moving region 069cfa828ec75a0824b9ead0af2948e8 (62 of 318) to server=hor17n36.gq1.ygridcore.net,60020,1374086528857
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Am I missing something?&lt;/p&gt;</comment>
                            <comment id="13711481" author="jmspaggi" created="Wed, 17 Jul 2013 19:05:23 +0000"  >&lt;p&gt;Can you try the attached version? I have added a &quot;in thread&quot; trace on each line, so we will see if it&apos;s working or not.&lt;/p&gt;</comment>
                            <comment id="13711508" author="ndimiduk" created="Wed, 17 Jul 2013 19:27:55 +0000"  >&lt;p&gt;It appears to have stabilized into something that looks more like what we saw before: groups of 8 simultaneous moves. Still not what I was expecting to see.&lt;/p&gt;

&lt;p&gt;I&apos;ll restart with your latest patch.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;13/07/17 19:25:45 INFO region_mover: Moving region 15810754e506c5ae14f806d6664667a9 (152 of 285) to server=hor17n39.gq1.ygridcore.net,60020,1374087909759
13/07/17 19:25:57 INFO region_mover: Moving region 9e42429864ab7248a9a9a1f698e89f3c (153 of 285) to server=hor18n36.gq1.ygridcore.net,60020,1374087909760
13/07/17 19:25:57 INFO region_mover: Moving region 8df6e3c5a93487fb30fff0432b108ec5 (154 of 285) to server=hor17n34.gq1.ygridcore.net,60020,1374087909750
13/07/17 19:25:57 INFO region_mover: Moving region 93ffbb5996ab235af47b95c014eea209 (155 of 285) to server=hor18n35.gq1.ygridcore.net,60020,1374087909742
13/07/17 19:25:57 INFO region_mover: Moving region 58bec5ff45e1851d1548a2c8734988a0 (156 of 285) to server=hor18n39.gq1.ygridcore.net,60020,1374087909751
13/07/17 19:25:57 INFO region_mover: Moving region 975b7b08dbf7100ca641e265e0e0ba2d (157 of 285) to server=hor18n37.gq1.ygridcore.net,60020,1374087909743
13/07/17 19:25:57 INFO region_mover: Moving region ab49337410a1daa5d24f0136294fbb8f (158 of 285) to server=hor17n37.gq1.ygridcore.net,60020,1374087909745
13/07/17 19:25:57 INFO region_mover: Moving region 3a075ff42d4b5e77ba31b16054f67884 (159 of 285) to server=hor17n36.gq1.ygridcore.net,60020,1374087909749
13/07/17 19:25:57 INFO region_mover: Moving region 5e590ce91b47884d123dc9474251d2b9 (160 of 285) to server=hor17n39.gq1.ygridcore.net,60020,1374087909759
13/07/17 19:26:09 INFO region_mover: Moving region 7ab8bb890cee3b93ffb70777067d8314 (161 of 285) to server=hor18n36.gq1.ygridcore.net,60020,1374087909760
13/07/17 19:26:09 INFO region_mover: Moving region 6114a35923fbd321005016e414bec277 (162 of 285) to server=hor17n34.gq1.ygridcore.net,60020,1374087909750
13/07/17 19:26:09 INFO region_mover: Moving region abbf1c6c23c805a7be34f88ec1a74523 (163 of 285) to server=hor18n35.gq1.ygridcore.net,60020,1374087909742
13/07/17 19:26:09 INFO region_mover: Moving region 4f8e7b6262ad454acd5a7f029a9b0a0b (164 of 285) to server=hor18n39.gq1.ygridcore.net,60020,1374087909751
13/07/17 19:26:09 INFO region_mover: Moving region 3ec1662ce03598ae228390d3482af3e3 (165 of 285) to server=hor18n37.gq1.ygridcore.net,60020,1374087909743
13/07/17 19:26:09 INFO region_mover: Moving region c250c2aa04cf24472ea44d3fe866121d (166 of 285) to server=hor17n37.gq1.ygridcore.net,60020,1374087909745
13/07/17 19:26:09 INFO region_mover: Moving region 5e1378614cdbc6811b026b1936f633a0 (167 of 285) to server=hor17n36.gq1.ygridcore.net,60020,1374087909749
13/07/17 19:26:09 INFO region_mover: Moving region 930397091fdb6e022c637925d9352c7a (168 of 285) to server=hor17n39.gq1.ygridcore.net,60020,1374087909759
13/07/17 19:26:20 INFO region_mover: Moving region ac6134e085d9fa03577ade47fd9ab507 (169 of 285) to server=hor18n36.gq1.ygridcore.net,60020,1374087909760
13/07/17 19:26:20 INFO region_mover: Moving region 8063d2a521d4061b8b838ba2b3240096 (170 of 285) to server=hor17n34.gq1.ygridcore.net,60020,1374087909750
13/07/17 19:26:20 INFO region_mover: Moving region 3b57a2b5345a8143b09584cec6be3c28 (171 of 285) to server=hor18n35.gq1.ygridcore.net,60020,1374087909742
13/07/17 19:26:20 INFO region_mover: Moving region 2c8be6caa307d3bc2bcdbf6677f5dff0 (172 of 285) to server=hor18n39.gq1.ygridcore.net,60020,1374087909751
13/07/17 19:26:20 INFO region_mover: Moving region 9213f6df9d50f8f195cadeb8d403b429 (173 of 285) to server=hor18n37.gq1.ygridcore.net,60020,1374087909743
13/07/17 19:26:20 INFO region_mover: Moving region 1eb2598530e6b2ea1d936ec7549f4779 (174 of 285) to server=hor17n37.gq1.ygridcore.net,60020,1374087909745
13/07/17 19:26:20 INFO region_mover: Moving region facdcc6294d40a3fa3e8db52e6c2dab5 (175 of 285) to server=hor17n36.gq1.ygridcore.net,60020,1374087909749
13/07/17 19:26:20 INFO region_mover: Moving region 869c4baa534ac511ff9aab65b36dd67e (176 of 285) to server=hor17n39.gq1.ygridcore.net,60020,1374087909759
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13711528" author="jmspaggi" created="Wed, 17 Jul 2013 19:40:33 +0000"  >&lt;p&gt;Are you sure you are using the patched version?&lt;/p&gt;

&lt;p&gt;This is what I have added in the patch:&lt;br/&gt;
+      $LOG.info(&quot;Moving region &quot; + r.getEncodedName() + &quot; (&quot; + count.to_s +&lt;br/&gt;
+        &quot; of &quot; + regions.length.to_s + &quot;) to server=&quot; + servername + &quot; in thread &quot; + thread_index.to_s);&lt;/p&gt;

&lt;p&gt;So you should see &quot;In tread XXX&quot; at the end of each line when regions are moving back to the server. Ar eou able to see that?&lt;/p&gt;

&lt;p&gt;also, how many active nodes do you have in you HBase cluster?&lt;/p&gt;</comment>
                            <comment id="13711694" author="ndimiduk" created="Wed, 17 Jul 2013 22:02:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;Are you sure you are using the patched version?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Definitely running v4. Looks like this patch includes the thread count in the load command, but not in unload.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;also, how many active nodes do you have in you HBase cluster?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This cluster has 9 RS&apos;s, so your logic makes sense. It looks like unloading regions is still operating 8 at a time for me.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Unloading hor18n39.gq1.ygridcore.net region(s)
...
Valid region move targets:                                                                                                                                                                       [392/465]
hor18n37.gq1.ygridcore.net,60020,1374094975268
hor17n37.gq1.ygridcore.net,60020,1374094975264
hor18n35.gq1.ygridcore.net,60020,1374094975327
hor17n39.gq1.ygridcore.net,60020,1374094975281
hor18n36.gq1.ygridcore.net,60020,1374094975254
hor17n36.gq1.ygridcore.net,60020,1374094975277
hor17n34.gq1.ygridcore.net,60020,1374094975291
hor18n38.gq1.ygridcore.net,60020,1374094975259
13/07/17 21:44:38 INFO region_mover: Moving 330 region(s) from hor18n39.gq1.ygridcore.net,60020,1374094975326 during this cycle
13/07/17 21:44:38 INFO region_mover: Moving region b59050cf97aabcef838e3c50e93e6d13 (1 of 330) to server=hor18n37.gq1.ygridcore.net,60020,1374094975268
13/07/17 21:44:38 INFO region_mover: Moving region 1f1a21f370963529326e1e8647c77977 (2 of 330) to server=hor17n37.gq1.ygridcore.net,60020,1374094975264
13/07/17 21:44:38 INFO region_mover: Moving region 214a5b6dd53cb94e5fe549712df10918 (3 of 330) to server=hor18n35.gq1.ygridcore.net,60020,1374094975327
13/07/17 21:44:38 INFO region_mover: Moving region 157d5afaffe570ef1d5535162ee61a73 (4 of 330) to server=hor17n39.gq1.ygridcore.net,60020,1374094975281
13/07/17 21:44:38 INFO region_mover: Moving region af5448c90e78a8f0d935efb0b380502e (5 of 330) to server=hor18n36.gq1.ygridcore.net,60020,1374094975254
13/07/17 21:44:38 INFO region_mover: Moving region bbe7e56f1e895379bfb6bbc2ef3ebec7 (6 of 330) to server=hor17n36.gq1.ygridcore.net,60020,1374094975277
13/07/17 21:44:38 INFO region_mover: Moving region cdf96aa8d79255991c82267052cf9870 (7 of 330) to server=hor17n34.gq1.ygridcore.net,60020,1374094975291
13/07/17 21:44:38 INFO region_mover: Moving region 7d0a02f452c334a12026b45346a87d36 (8 of 330) to server=hor18n38.gq1.ygridcore.net,60020,1374094975259
13/07/17 21:45:41 INFO region_mover: Moving region 01408a1987f7a0cb7fb657a19bddc2d5 (9 of 330) to server=hor18n37.gq1.ygridcore.net,60020,1374094975268
13/07/17 21:45:41 INFO region_mover: Moving region 45d7cf6b5997310b022f315e52f64da2 (10 of 330) to server=hor17n37.gq1.ygridcore.net,60020,1374094975264
13/07/17 21:45:41 INFO region_mover: Moving region 353a09c07053144a598be04a53afa82e (11 of 330) to server=hor18n35.gq1.ygridcore.net,60020,1374094975327
13/07/17 21:45:41 INFO region_mover: Moving region 5f4e8165d58c0672c8c6e58ddbff486c (12 of 330) to server=hor17n39.gq1.ygridcore.net,60020,1374094975281
13/07/17 21:45:41 INFO region_mover: Moving region 234265b7ec4e535cecafcdd83f09dab7 (13 of 330) to server=hor18n36.gq1.ygridcore.net,60020,1374094975254
13/07/17 21:45:41 INFO region_mover: Moving region 9f54ff65021922f7c13f4372dbcb8f98 (14 of 330) to server=hor17n36.gq1.ygridcore.net,60020,1374094975277
13/07/17 21:45:41 INFO region_mover: Moving region 0db22200ccea02196dfea00b33811413 (15 of 330) to server=hor17n34.gq1.ygridcore.net,60020,1374094975291
13/07/17 21:45:41 INFO region_mover: Moving region 905210e29ef683ecf78f01050c4b1148 (16 of 330) to server=hor18n38.gq1.ygridcore.net,60020,1374094975259
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Loading regions is launching threads, at least according to your new log messages. Here I would expect 30 threads to spin up all at once. Instead, I see one at a time:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Reloading hor18n39.gq1.ygridcore.net region(s)
...
13/07/17 21:54:27 INFO region_mover: Moving 330 regions to hor18n39.gq1.ygridcore.net,60020,1374098064602
13/07/17 21:56:47 INFO region_mover: Moving region 7d0a02f452c334a12026b45346a87d36 (1 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 0
13/07/17 21:56:54 INFO region_mover: Moving region af5448c90e78a8f0d935efb0b380502e (2 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 1
13/07/17 21:57:01 INFO region_mover: Moving region 157d5afaffe570ef1d5535162ee61a73 (3 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 2
13/07/17 21:57:06 INFO region_mover: Moving region cdf96aa8d79255991c82267052cf9870 (4 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 3
13/07/17 21:57:12 INFO region_mover: Moving region 214a5b6dd53cb94e5fe549712df10918 (5 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 4
13/07/17 21:57:18 INFO region_mover: Moving region b59050cf97aabcef838e3c50e93e6d13 (6 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 5
13/07/17 21:57:23 INFO region_mover: Moving region bbe7e56f1e895379bfb6bbc2ef3ebec7 (7 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 6
13/07/17 21:57:28 INFO region_mover: Moving region 1f1a21f370963529326e1e8647c77977 (8 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 7
13/07/17 21:57:33 INFO region_mover: Moving region 9f54ff65021922f7c13f4372dbcb8f98 (9 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 8
13/07/17 21:57:37 INFO region_mover: Moving region 905210e29ef683ecf78f01050c4b1148 (10 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 9
13/07/17 21:57:42 INFO region_mover: Moving region 234265b7ec4e535cecafcdd83f09dab7 (11 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 10
...
13/07/17 21:59:17 INFO region_mover: Moving region da0f100db394d18e5b6311938097ec3e (35 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 28
13/07/17 21:59:20 INFO region_mover: Moving region 900effc2e95064173fc0a3fab047b119 (36 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 29
13/07/17 21:59:28 INFO region_mover: Moving region 1b78694f962d7c315e4f6b64f07af4aa (37 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 0
13/07/17 21:59:32 INFO region_mover: Moving region 3e47c04afce79818e5ead7d8f46e7128 (38 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 1
13/07/17 21:59:36 INFO region_mover: Moving region 7cce3224f05e438f0e011d6f26b738c0 (39 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 2
13/07/17 21:59:39 INFO region_mover: Region t1,1735ed70,1373581705674.ef04ef42d7eb7d7e472671661cc48ee0. (40 of 330) already on target server=hor18n39.gq1.ygridcore.net,60020,1374098064602
13/07/17 21:59:43 INFO region_mover: Region t1,2888871d,1373581705680.483e522559ecd6b0fdd96dbd6b593c7d. (41 of 330) already on target server=hor18n39.gq1.ygridcore.net,60020,1374098064602
13/07/17 21:59:46 INFO region_mover: Moving region 6337b0857ccc6d995082582841e467d7 (42 of 330) to server=hor18n39.gq1.ygridcore.net,60020,1374098064602 in thread 3
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13711751" author="jmspaggi" created="Wed, 17 Jul 2013 22:45:56 +0000"  >&lt;p&gt;So the unload is working as expected. For the unload, that&apos;s weird. Maybe it&apos;s &quot;simply&quot; very slow because network is overwhelmed by all hose move? Are you running on real servers? Or on VMs?&lt;/p&gt;</comment>
                            <comment id="13711778" author="ndimiduk" created="Wed, 17 Jul 2013 23:07:36 +0000"  >&lt;p&gt;Perhaps. These are real servers, spread ~50/50 between two racks.&lt;/p&gt;</comment>
                            <comment id="13722546" author="jmspaggi" created="Mon, 29 Jul 2013 15:36:37 +0000"  >&lt;p&gt;Hi Nick,&lt;/p&gt;

&lt;p&gt;Can you add the thread trace in the unload log and retry? I tried again on my side and it&apos;s still correct.&lt;/p&gt;

&lt;p&gt;Also, I verified that regions are moved only once:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase@node3:~/hbase-0.94$ cat logs/hbase-hbase-master-node3.log | grep dd86a04810f2839ee7842733b7a6ec78
2013-07-29 07:59:33,238 INFO org.apache.hadoop.hbase.master.HMaster: Added move plan hri=crc,\x00\x00\x00\x00+\xB1\x108seattle.cbsradio.stats.com,1365475884535.dd86a04810f2839ee7842733b7a6ec78., src=node3,60020,1375017424052, dest=node6,60020,1375016625878, running balancer
2013-07-29 08:01:40,131 INFO org.apache.hadoop.hbase.master.HMaster: Added move plan hricrc,\x00\x00\x00\x00+\xB1\x108seattle.cbsradio.stats.com,1365475884535.dd86a04810f2839ee7842733b7a6ec78., src=node6,60020,1375016625878, dest=node3,60020,1375099217169, running balancer
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let me know if you need an updated patch for the unload output. What you should see is something like that:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Gracefully restarting: node1
Doing rolling with maxthreads=30
Disabling balancer! (&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; required)
Previous balancer state was &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
Unloading node1 region(s)
Valid region move targets: 
node4,60020,1375016907951
buldo,60020,1375016770574
node5,60020,1375017021737
node7,60020,1375017151389
node2,60020,1375015919731
node3,60020,1375015482026
node6,60020,1375016625878
13/07/28 09:13:31 INFO region_mover: Moving 88 region(s) from node1,60020,1375015859230 during &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; cycle
13/07/28 09:13:31 INFO region_mover: Moving region 0543a51c262cf78561e4d2d07867385b (1 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:31 INFO region_mover: Moving region 86fe96d85203f15ec769a1ab84ea652e (2 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:31 INFO region_mover: Moving region 323b9de45db8b4bc8b200a33550bf339 (3 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:31 INFO region_mover: Moving region 796665161dc582ac0beb37fdcdd82db8 (4 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:31 INFO region_mover: Moving region a5d61d600d21fb05253e8afa2489d7ef (5 of 88) to server=node2,60020,1375015919731 in thread 4
13/07/28 09:13:31 INFO region_mover: Moving region 3d326f914d8c3eb40db8d48e945bd618 (6 of 88) to server=node3,60020,1375015482026 in thread 5
13/07/28 09:13:31 INFO region_mover: Moving region 1c65891f0a76bc26b45364cf2311841e (7 of 88) to server=node6,60020,1375016625878 in thread 6
13/07/28 09:13:32 INFO region_mover: Moving region bd4bbdcc078742d0d9474bcfc91cbb3b (8 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:32 INFO region_mover: Moving region 5613e945414d1be0e0eaff89891554f1 (9 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:32 INFO region_mover: Moving region fe44b401dfe7e4924601ef909032ad28 (10 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:32 INFO region_mover: Moving region 0d4762ae7f855f3ff14abdf4c7e1acec (11 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:32 INFO region_mover: Moving region 86e0f44b1ca082fada429ed2ee798806 (12 of 88) to server=node2,60020,1375015919731 in thread 4
13/07/28 09:13:32 INFO region_mover: Moving region 8d295e0ceb2bd62952d9e47dd81699c6 (13 of 88) to server=node3,60020,1375015482026 in thread 5
13/07/28 09:13:32 INFO region_mover: Moving region ae0b4649917574b82f7d8f2779800cd0 (14 of 88) to server=node6,60020,1375016625878 in thread 6
13/07/28 09:13:34 INFO region_mover: Moving region 73a6401006f8e7e1a7c2d5e7d9e4436d (15 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:34 INFO region_mover: Moving region 8beeb42f41b04aa38c020e2173e4ed5e (16 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:34 INFO region_mover: Moving region 47ef6f201b2b96558dafd50f6062c1f3 (17 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:34 INFO region_mover: Moving region 4c6e30b8d0d320be240d4edeffbfff17 (18 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:34 INFO region_mover: Moving region 09d98ca982d2c36f616ec568deafc954 (19 of 88) to server=node2,60020,1375015919731 in thread 4
13/07/28 09:13:34 INFO region_mover: Moving region 39bcc1fc090c8a939dca5b45e2119122 (20 of 88) to server=node3,60020,1375015482026 in thread 5
13/07/28 09:13:34 INFO region_mover: Moving region 3ded89d9383bdd518a5d24d7c478ed50 (21 of 88) to server=node6,60020,1375016625878 in thread 6
13/07/28 09:13:36 INFO region_mover: Moving region 05a6717f7a01222017c5328cc6cf3401 (22 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:36 INFO region_mover: Moving region 08cfbeed57512350323e9172b28157b2 (23 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:36 INFO region_mover: Moving region 2be8650e51a90f6b95d354a6387654d8 (24 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:36 INFO region_mover: Moving region d4f68fb6560cd1ca0c89c931128eeb60 (25 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:36 INFO region_mover: Moving region c36c0f3f5dc8081ce23cb446cc6bada4 (26 of 88) to server=node2,60020,1375015919731 in thread 4
13/07/28 09:13:36 INFO region_mover: Moving region 75221b26d619649af5b195dbeabb5703 (27 of 88) to server=node3,60020,1375015482026 in thread 5
13/07/28 09:13:36 INFO region_mover: Moving region f324f85f12b9669c662ed48d204ee05f (28 of 88) to server=node6,60020,1375016625878 in thread 6
13/07/28 09:13:37 INFO region_mover: Moving region 4e4ccef8c54ff1753153eaa3ba09a2f5 (29 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:37 INFO region_mover: Moving region 5158d360baa4bf264f153ee641591444 (30 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:37 INFO region_mover: Moving region 3598b8e6ff505a0b73dbbcdd92fbfe05 (31 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:37 INFO region_mover: Moving region 15f2c0a63c2f4263d872e993044216bd (32 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:37 INFO region_mover: Moving region 1b0582151f5535dd575ff081576a72ec (33 of 88) to server=node2,60020,1375015919731 in thread 4
13/07/28 09:13:37 INFO region_mover: Moving region f4ca37fd05fe8beb67295290ad3cec49 (34 of 88) to server=node3,60020,1375015482026 in thread 5
13/07/28 09:13:37 INFO region_mover: Moving region a8f1ab17de0d112eebd1555f5d830d7a (35 of 88) to server=node6,60020,1375016625878 in thread 6
13/07/28 09:13:39 INFO region_mover: Moving region 83f9e939d38a056769bbc6549ad4f5e3 (36 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:39 INFO region_mover: Moving region ae4d3e8377165ea98018ed6f6bbcaa52 (37 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:39 INFO region_mover: Moving region 6561c0877b1c3b47d40f6e1095e70f50 (38 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:39 INFO region_mover: Moving region 8c4ef570843987cfcf87a9a0ff07cdf0 (39 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:39 INFO region_mover: Moving region cff814ae590359d23272e971770a7b87 (40 of 88) to server=node2,60020,1375015919731 in thread 4
13/07/28 09:13:39 INFO region_mover: Moving region 00c619b5b1833be9078b40f759fca9aa (41 of 88) to server=node3,60020,1375015482026 in thread 5
13/07/28 09:13:39 INFO region_mover: Moving region 7e5f13d4041fbc762dd45dc38c497220 (42 of 88) to server=node6,60020,1375016625878 in thread 6
13/07/28 09:13:40 INFO region_mover: Moving region 38531199c8bea5091e52daf52ec5e18d (43 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:40 INFO region_mover: Moving region 85b42c278834ea4720840e44a8b001fc (44 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:40 INFO region_mover: Moving region c82d62ff4be237568bcf26a3c76ea895 (45 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:40 INFO region_mover: Moving region 044ab9af47b5b4ba4e59ed60a571d0ec (46 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:40 INFO region_mover: Moving region b2886bc7c5bf915e992fa35a5dc1307c (47 of 88) to server=node2,60020,1375015919731 in thread 4
13/07/28 09:13:40 INFO region_mover: Moving region 13be3a6a55570fc32eab44edadcd4bf0 (48 of 88) to server=node3,60020,1375015482026 in thread 5
13/07/28 09:13:40 INFO region_mover: Moving region 1addfaadcb399b78c5912e40e78f39d7 (49 of 88) to server=node6,60020,1375016625878 in thread 6
13/07/28 09:13:41 INFO region_mover: Moving region 562366f4a5385fb2dc8eb82970da580e (50 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:41 INFO region_mover: Moving region acd89f0ccd337bc5a6314b1b5bebf258 (51 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:41 INFO region_mover: Moving region 0e3a885b55ea00132e661fa8d12703c9 (52 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:41 INFO region_mover: Moving region a304b794f0778e74dd577756070ba162 (53 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:41 INFO region_mover: Moving region 98b4b71f9cc3818b9755006e2c04712e (54 of 88) to server=node2,60020,1375015919731 in thread 4
13/07/28 09:13:41 INFO region_mover: Moving region f57616d308d9b3a9e28b99bf09f746e1 (55 of 88) to server=node3,60020,1375015482026 in thread 5
13/07/28 09:13:41 INFO region_mover: Moving region 8708b53a9455da07ea347ed2720ca7e9 (56 of 88) to server=node6,60020,1375016625878 in thread 6
13/07/28 09:13:42 INFO region_mover: Moving region fec6841875480f334341f12d91fa55c7 (57 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:42 INFO region_mover: Moving region 700f6ed359b973c2e9f66bc01fa8b00f (58 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:42 INFO region_mover: Moving region e534663fcd52e358ed389d7a0b186377 (59 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:42 INFO region_mover: Moving region 7ca941fd1996e5b440fb567c88201573 (60 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:42 INFO region_mover: Moving region a5d3b2f7ce836839d75a8b6263071742 (61 of 88) to server=node2,60020,1375015919731 in thread 4
13/07/28 09:13:42 INFO region_mover: Moving region 8c1b0331c61c14a3d91fe01edf4a22b2 (62 of 88) to server=node3,60020,1375015482026 in thread 5
13/07/28 09:13:42 INFO region_mover: Moving region de53006a0b87a2a4aefa02780b7d148a (63 of 88) to server=node6,60020,1375016625878 in thread 6
13/07/28 09:13:43 INFO region_mover: Moving region 3304e33f985424141181d9bb56a14457 (64 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:43 INFO region_mover: Moving region ed0d8d398ed37ff5de73daff21c49c6e (65 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:43 INFO region_mover: Moving region fff3c06d30c769092d7b287fa0677675 (66 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:43 INFO region_mover: Moving region e1a32594f393216c7686ec7d1566b3b3 (67 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:43 INFO region_mover: Moving region 8e05d2c6a02bfa43d9a3e18c21da14b6 (68 of 88) to server=node2,60020,1375015919731 in thread 4
13/07/28 09:13:43 INFO region_mover: Moving region 44732a5e862c3a92c6e0f6da4f3caedc (69 of 88) to server=node3,60020,1375015482026 in thread 5
13/07/28 09:13:43 INFO region_mover: Moving region 77ea3447e83a5d60ad944f59606fa1fb (70 of 88) to server=node6,60020,1375016625878 in thread 6
13/07/28 09:13:45 INFO region_mover: Moving region 24a27a676428e16475952232129589a8 (71 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:45 INFO region_mover: Moving region f4a0228b97983d81fb53a75b14ff87eb (72 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:45 INFO region_mover: Moving region 66f07ed9a93d7b1701f4dbcf1eb96e93 (73 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:45 INFO region_mover: Moving region 80e1f501dc29a0e2efc78e9ebb55d159 (74 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:45 INFO region_mover: Moving region 14bbc4273058426ffc6bcd741e0961bc (75 of 88) to server=node2,60020,1375015919731 in thread 4
13/07/28 09:13:45 INFO region_mover: Moving region 53dfd1db4af6b7f9e2ba30fa9665aa94 (76 of 88) to server=node3,60020,1375015482026 in thread 5
13/07/28 09:13:45 INFO region_mover: Moving region 56629b3eedc81e5d66a2da9c0c388227 (77 of 88) to server=node6,60020,1375016625878 in thread 6
13/07/28 09:13:46 INFO region_mover: Moving region e26fd44dfbd9b71e98ef40e16bc88cf5 (78 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:46 INFO region_mover: Moving region 3378921a54749b9d952239b0b11953b9 (79 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:46 INFO region_mover: Moving region a87d5dbe2a67aba7fb6504e416b4c2d5 (80 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:46 INFO region_mover: Moving region c8b6de6c951a076d0bdb131f342435f7 (81 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:46 INFO region_mover: Moving region 8963fa279eff47da3f49ba1c332444c0 (82 of 88) to server=node2,60020,1375015919731 in thread 4
13/07/28 09:13:46 INFO region_mover: Moving region dc87f6b873bfa071396175623a23ff6c (83 of 88) to server=node3,60020,1375015482026 in thread 5
13/07/28 09:13:46 INFO region_mover: Moving region 180421ace2ec1b7d7d244403bd76031d (84 of 88) to server=node6,60020,1375016625878 in thread 6
13/07/28 09:13:48 INFO region_mover: Moving region 678b9028651a84c27c4ecebad4819bc9 (85 of 88) to server=node4,60020,1375016907951 in thread 0
13/07/28 09:13:48 INFO region_mover: Moving region 9ff9cfdd527a273309763f0c62e6807c (86 of 88) to server=buldo,60020,1375016770574 in thread 1
13/07/28 09:13:48 INFO region_mover: Moving region 0e01b4178ec53500bc1af096db8bb8bc (87 of 88) to server=node5,60020,1375017021737 in thread 2
13/07/28 09:13:48 INFO region_mover: Moving region d3483133858ec6c12989f160cf861b9e (88 of 88) to server=node7,60020,1375017151389 in thread 3
13/07/28 09:13:48 INFO region_mover: Wrote list of moved regions to /tmp/node1
Unloaded node1 region(s)
node1: stopping regionserver..
node1: starting regionserver, logging to /home/hbase/hbase-0.94.3/bin/../logs/hbase-hbase-regionserver-node1.out
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13724713" author="ndimiduk" created="Wed, 31 Jul 2013 01:19:00 +0000"  >&lt;p&gt;Here&apos;s some run numbers. The summary is that the patch makes a huge difference, but there&apos;s a sweets-spot re: the number of threads. That spot appears to hover somewhere close to the number of RegionServers in the cluster, as you implied earlier in the conversation.&lt;/p&gt;

&lt;p&gt;At least for 0.94, I say clean up the extra logging and ship it. I haven&apos;t tested vs trunk yet.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;# 9 region servers, 3000 regions total:

## 0.94.6.1 + 8803v4, maxthreads 1 (default)

real    425m10.306s
user    102m30.018s
sys     86m17.567s

real    324m21.502s
user    78m41.326s
sys     64m28.686s

real    430m2.716s
user    103m11.999s
sys     87m8.496s

## 0.94.6.1 + 8803v4, maxthreads 10

real    205m36.658s
user    92m56.465s
sys     75m18.526s

real    205m9.664s
user    87m53.164s
sys     70m0.675s

real    208m52.563s
user    96m7.719s
sys     79m25.761s

## 0.94.6.1 + 8803v4, maxthreads 30

real    250m38.159s
user    95m19.163s
sys     77m18.219s

real    205m15.578s
user    97m10.359s
sys     79m23.973s

real    242m33.605s
user    92m17.179s
sys     74m23.087s
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13727206" author="lhofhansl" created="Fri, 2 Aug 2013 01:43:13 +0000"  >&lt;p&gt;Pushing to 0.94.12. If you clean up the patch in time for 0.94.11, JM, we can pull it back in.&lt;/p&gt;</comment>
                            <comment id="13727811" author="stack" created="Fri, 2 Aug 2013 17:07:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; So you are +1?  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; Were you going to try this out again?&lt;/p&gt;</comment>
                            <comment id="13727828" author="ndimiduk" created="Fri, 2 Aug 2013 17:22:17 +0000"  >&lt;p&gt;Yes, I am +1 based on testing on my 0.94 cluster.&lt;/p&gt;

&lt;p&gt;I&apos;d love to see a follow-on that implements a heuristic that calculates an idea maxthreads value for the user so that this happens transparently and by default.&lt;/p&gt;</comment>
                            <comment id="13730051" author="lhofhansl" created="Mon, 5 Aug 2013 22:25:36 +0000"  >&lt;p&gt;Could we just instantiate an ExecutorService with N max threads and an unbounded waiting queue, and then submit all move jobs onto that service, and lastly shutdown and awaitTermination?&lt;/p&gt;</comment>
                            <comment id="13730132" author="jmspaggi" created="Mon, 5 Aug 2013 23:33:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; I tried this script many times. I already deployed it on my own cluster, and used it to test 0.94.10. I will use it too for 0.94.11 which is coming. Always worked well for me.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; that&apos;s also an option. For the &quot;unload&quot; part, we only do a thread per RS, so it&apos;s not really required, and so I just used the same for the load part. I don&apos;t think it&apos;s going to really reduce the move time.&lt;/p&gt;</comment>
                            <comment id="13730144" author="stack" created="Mon, 5 Aug 2013 23:40:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; Is the v1 for trunk the same as the v4 for 0.94?  Thanks boss.&lt;/p&gt;</comment>
                            <comment id="13732220" author="lhofhansl" created="Wed, 7 Aug 2013 17:52:20 +0000"  >&lt;p&gt;Using a threadpool would make for simpler, easier to understand code.&lt;/p&gt;</comment>
                            <comment id="13732740" author="ndimiduk" created="Wed, 7 Aug 2013 21:03:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;Using a threadpool would make for simpler, easier to understand code.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1, Lars, and &lt;b&gt;derp&lt;/b&gt; for not making that comment in the first place :/&lt;/p&gt;</comment>
                            <comment id="13741229" author="stack" created="Thu, 15 Aug 2013 17:29:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; is v1 for trunk the same as v4 for 0.94?&lt;/p&gt;</comment>
                            <comment id="13741232" author="stack" created="Thu, 15 Aug 2013 17:30:43 +0000"  >&lt;p&gt;There are changes in rolling_restart in 0.94 not in the trunk patch.  Is that intentional?&lt;/p&gt;</comment>
                            <comment id="13741256" author="jmspaggi" created="Thu, 15 Aug 2013 17:48:06 +0000"  >&lt;p&gt;Looking at that right now. will keep you posted shortly.&lt;/p&gt;</comment>
                            <comment id="13741305" author="jmspaggi" created="Thu, 15 Aug 2013 18:28:25 +0000"  >&lt;p&gt;Rebased trunk patch. &quot;failfast&quot; was added by another patch in the meantime. So I remerged the modifications. I compared with he patch or 0.94 and it&apos;s the same now. &lt;/p&gt;</comment>
                            <comment id="13741344" author="stack" created="Thu, 15 Aug 2013 18:54:49 +0000"  >&lt;p&gt;I saw this when testing against trunk:&lt;/p&gt;

&lt;p&gt;2013-08-15 11:52:49,257 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; region_mover: Moving 12 region(s) from a2436.halxg.cloudera.com,60020,1376590362978 during this cycle&lt;br/&gt;
2013-08-15 11:52:49,258 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;main&amp;#93;&lt;/span&gt; region_mover: Moving region 5999eb4e59af7711ea82ea37a9cc9d44 (1 of 12) to server=10.20.212.36,60020,1376590920619&lt;br/&gt;
NameError: no method &apos;toString&apos; for arguments (org.apache.hadoop.hbase.TableName) on Java::OrgApacheHadoopHbaseUtil::Bytes&lt;br/&gt;
          getTable at /home/stack/hbase-0.95.2-SNAPSHOT/bin/region_mover.rb:63&lt;br/&gt;
  isSuccessfulScan at /home/stack/hbase-0.95.2-SNAPSHOT/bin/region_mover.rb:120&lt;br/&gt;
     unloadRegions at /home/stack/hbase-0.95.2-SNAPSHOT/bin/region_mover.rb:334&lt;br/&gt;
              call at org/jruby/RubyProc.java:270&lt;br/&gt;
              call at org/jruby/RubyProc.java:224&lt;/p&gt;

&lt;p&gt;which seems to have broke its ability to reload.&lt;/p&gt;

&lt;p&gt;Let me move this out of 0.95.2 and put it against 0.96.0.  It is not a blocker but really important addition so it should not hold up release &amp;#8211; it can go in anytime.&lt;/p&gt;

&lt;p&gt;Thanks for working on this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13741368" author="jmspaggi" created="Thu, 15 Aug 2013 19:08:19 +0000"  >&lt;p&gt;Strange. It&apos;s not something which has been changed by this patch.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# Get table instance.
# Maintains cache of table instances.
def getTable(config, name)
  # Keep dictionary of tables in ruby global
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not $TABLES
    $TABLES = {}
  end
  key = Bytes.toString(name)  &amp;lt;================== HERE
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; not $TABLES[key]
    $TABLES[key] = HTable.&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;(config, name)
  end
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; $TABLES[key]
end
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Can you try to run it without this patch applied? I don&apos;t have trunk running instance yet.&lt;/p&gt;</comment>
                            <comment id="13741567" author="stack" created="Thu, 15 Aug 2013 22:15:22 +0000"  >&lt;p&gt;That makes sense &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; I will try it next week... am out for a few days as of NOW (smile).&lt;/p&gt;</comment>
                            <comment id="13744553" author="lhofhansl" created="Tue, 20 Aug 2013 00:22:38 +0000"  >&lt;p&gt;Lowering priority, since it&apos;s not in 0.95.*, it seems.&lt;/p&gt;</comment>
                            <comment id="13748304" author="stack" created="Fri, 23 Aug 2013 05:37:37 +0000"  >&lt;p&gt;I did some testing this evening.  Had to change how HBaseAdmin is created to make it work (it was erroring out w/ a reflection error &amp;#8211; it looks like can&apos;t pass in a Configuration anymore, needs a Connection... a recent addition).  I first create connection, pass it to HBA, then make sure I close it w/ begin/ensure:&lt;/p&gt;

&lt;p&gt;&amp;gt; +  connection = HConnectionManager.createConnection(config)&lt;br/&gt;
&amp;gt; +  begin&lt;br/&gt;
&amp;gt; +    admin = HBaseAdmin.new(config)&lt;br/&gt;
....&lt;/p&gt;


&lt;p&gt;So, JMS, why does it not move regions back exactly as it found them?  Do you know?  Each time I ran the test, the new layout was different from the original.  It use to restore to original state IIRC.&lt;/p&gt;

&lt;p&gt;I tried w/ two threads and it indeed ran faster (sweet).&lt;/p&gt;</comment>
                            <comment id="13748468" author="jmspaggi" created="Fri, 23 Aug 2013 11:29:02 +0000"  >&lt;p&gt;Hi Stack,&lt;/p&gt;

&lt;p&gt;Do we need to move those modifications to 0.94 too? &lt;/p&gt;

&lt;p&gt;Like&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;TableName::META_TABLE_NAME.getName()&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;etc.?&lt;/p&gt;

&lt;p&gt;Regions names are stored locally into movedRegions and a file when removed from one server, and then the same list is used to restore the regions. So you should have exactly the same lost before and after the restart... I will re-try that over the week-end and check the regions, not just the count...&lt;/p&gt;</comment>
                            <comment id="13748680" author="stack" created="Fri, 23 Aug 2013 16:25:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; The TableName stuff is not in 0.94.  The change to how you construct an HBaseAdmin may be needed in 0.94.  I&apos;m thinking that it probably time to move this stuff into java.  It is too important and seems easy enough to break.  What you think?  Would be ok to have your improvements in trunk, etc., in the meantime though (I did not study closely why the regions were not restored exactly as they had been pre-restart).  Thanks boss.&lt;/p&gt;</comment>
                            <comment id="13749149" author="lhofhansl" created="Fri, 23 Aug 2013 23:31:48 +0000"  >&lt;p&gt;Should still it with a Threadpool, though. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13758558" author="lhofhansl" created="Thu, 5 Sep 2013 00:18:06 +0000"  >&lt;p&gt;&amp;lt;ping&amp;gt;&lt;/p&gt;</comment>
                            <comment id="13758580" author="stack" created="Thu, 5 Sep 2013 00:42:12 +0000"  >&lt;p&gt;This is an excellent improvement.  There is the issue above that needs looking into where we seemingly do not restore node to its former state.  Should also redo these scripts as pure java since they are critical functionality now but that could be done in another issue.  Reading elsewhere &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt; is resource constrained which probably explains why no progress here.&lt;/p&gt;</comment>
                            <comment id="13759643" author="lhofhansl" created="Thu, 5 Sep 2013 23:55:29 +0000"  >&lt;p&gt;Moving to 0.94.13 for now, can always pull back.&lt;/p&gt;</comment>
                            <comment id="13800230" author="lhofhansl" created="Sun, 20 Oct 2013 21:07:09 +0000"  >&lt;p&gt;Where are we with this? Should I remove this from 0.94?&lt;/p&gt;</comment>
                            <comment id="13800291" author="jmspaggi" created="Mon, 21 Oct 2013 00:40:27 +0000"  >&lt;p&gt;It&apos;s definitively on my todo. Just lacking some time. I will have time to work on all pending JIRAs (8803, 9694, 9695, etc.) I have the week of November 4rd... Sorry for the delay &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13805010" author="lhofhansl" created="Fri, 25 Oct 2013 04:24:33 +0000"  >&lt;p&gt;Lemme move to 0.94.14 so that we do not have to rush this.&lt;/p&gt;</comment>
                            <comment id="13834316" author="apurtell" created="Wed, 27 Nov 2013 23:19:36 +0000"  >&lt;p&gt;Moving out of 0.98. Put back if it can be ready in the next couple of weeks or so.&lt;/p&gt;</comment>
                            <comment id="13847876" author="jmspaggi" created="Fri, 13 Dec 2013 20:19:40 +0000"  >&lt;p&gt;I will try to get those modification done in the next few days so we can close those one... I&apos;m talking about the Threadpool. I&apos;m very bad at Ruby, that will be the chance to get better at it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13849968" author="lhofhansl" created="Tue, 17 Dec 2013 01:13:24 +0000"  >&lt;p&gt;Removing from 0.94 for now. Can re-add later if we want.&lt;/p&gt;</comment>
                            <comment id="13852044" author="jmspaggi" created="Wed, 18 Dec 2013 19:18:54 +0000"  >&lt;p&gt;Here we go!!!&lt;/p&gt;

&lt;p&gt;Patch for 0.94 attached with, as asked, a Ruby thread pool.&lt;/p&gt;

&lt;p&gt;Still working like the previous one. Tested on a 7 nodes cluster.&lt;/p&gt;

&lt;p&gt;Regular script takes 17 minutes. This one with 12 threads took 6 minutes. Almost a third!&lt;/p&gt;

&lt;p&gt;I used (RS - 1) * 2 threads. This might be a pretty good sizing rule.&lt;/p&gt;

&lt;p&gt;Feel free to comment. If it&apos;s fine I will apply to trunk and provide the related patch too.&lt;/p&gt;

&lt;p&gt;Sorry for the delay to get it done.&lt;/p&gt;</comment>
                            <comment id="13852090" author="lhofhansl" created="Wed, 18 Dec 2013 19:54:19 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt;!&lt;br/&gt;
Would probably feel better if it was one thread per RegionServer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; i.e. just RS-1.&lt;/p&gt;</comment>
                            <comment id="13852098" author="jmspaggi" created="Wed, 18 Dec 2013 20:05:32 +0000"  >&lt;p&gt;Default value is just 1.  So you might feel even safer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; That way, It also keeps the default existing behavior&lt;/p&gt;</comment>
                            <comment id="13852520" author="jmspaggi" created="Thu, 19 Dec 2013 02:41:49 +0000"  >&lt;p&gt;Ping to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;  and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; if you want this for your branches.&lt;/p&gt;

&lt;p&gt;I tried without the 20s delays and with another RS startup check and went from 17 minutes to 4 minutes &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;We definitively want this!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; we might be correct to with in 0.98.0, right?&lt;/p&gt;</comment>
                            <comment id="13852562" author="jmspaggi" created="Thu, 19 Dec 2013 03:29:51 +0000"  >&lt;p&gt;Hold on &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Small path issue regarding the threadpool rb file when not running from the bin folder... Looking at it now.&lt;/p&gt;</comment>
                            <comment id="13852572" author="jmspaggi" created="Thu, 19 Dec 2013 03:48:41 +0000"  >&lt;p&gt;Relative path issue fixed. Tested from in and out of the bin directory.&lt;br/&gt;
Tested with 12 threads: 4 minutes 30&lt;br/&gt;
Tested with 30 threads: 4 minutes 12&lt;br/&gt;
Tested with 6 threads: 5 minutes 37&lt;/p&gt;

&lt;p&gt;Without this patch: 17 minutes.&lt;/p&gt;

&lt;p&gt;Please note that numbers above are with a version where the 20s delay has been replaced by a 5s delay to speedup the testing... &lt;/p&gt;</comment>
                            <comment id="13852584" author="lhofhansl" created="Thu, 19 Dec 2013 04:04:04 +0000"  >&lt;p&gt;+1 from my side&lt;/p&gt;</comment>
                            <comment id="13857623" author="stack" created="Fri, 27 Dec 2013 18:37:58 +0000"  >&lt;p&gt;This will work for trunk mighty &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13857626" author="jmspaggi" created="Fri, 27 Dec 2013 18:41:27 +0000"  >&lt;p&gt;Most probably. Let me refresh my trunk branch and take a look. I will you know shortly.&lt;/p&gt;</comment>
                            <comment id="13857638" author="jmspaggi" created="Fri, 27 Dec 2013 18:56:25 +0000"  >&lt;p&gt;Trunk version attached. I&apos;m not able to start trunk locally so can not test it but it&apos;s almost the same patch as for 0.94.x. Only graceful_stop.sh required some manual merge. The rest has been applied automatically from the 0.94 patch.&lt;/p&gt;</comment>
                            <comment id="13857642" author="stack" created="Fri, 27 Dec 2013 18:59:25 +0000"  >&lt;p&gt;Let me test over next few days.&lt;/p&gt;</comment>
                            <comment id="13857706" author="hadoopqa" created="Fri, 27 Dec 2013 20:25:52 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12620629/HBASE-8803-v6-trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12620629/HBASE-8803-v6-trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12620629&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.1&lt;/font&gt;.  The patch compiles against the hadoop 1.1 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 release audit&lt;/font&gt;.  The applied patch generated 1 release audit warnings (more than the trunk&apos;s current 0 warnings).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//testReport/&lt;/a&gt;&lt;br/&gt;
Release audit warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8291//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13909616" author="jmspaggi" created="Sun, 23 Feb 2014 00:57:18 +0000"  >&lt;p&gt;Really want to get this committed folks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I have to re-apply it locally each time there is a new release to test.&lt;/p&gt;

&lt;p&gt;Any chance?&lt;/p&gt;</comment>
                            <comment id="13909646" author="lhofhansl" created="Sun, 23 Feb 2014 02:30:41 +0000"  >&lt;p&gt;Let&apos;s get it in.&lt;/p&gt;</comment>
                            <comment id="13910276" author="jmspaggi" created="Mon, 24 Feb 2014 13:11:45 +0000"  >&lt;p&gt;Thanks. But you (or any other commiter) will have to do it, since I can not (yet). I have been able to apply current patch without any modification in 0.94. I can rebase if required.&lt;/p&gt;</comment>
                            <comment id="13911295" author="stack" created="Tue, 25 Feb 2014 06:19:54 +0000"  >&lt;p&gt;I tried the patch and it fails w/ this:&lt;/p&gt;

&lt;p&gt;$ ./bin/rolling-restart.sh --config /home/stack/conf_hbase --rs-only --graceful&lt;/p&gt;

&lt;p&gt;....because we are doing this:&lt;/p&gt;

&lt;p&gt;distMode=`$bin/hbase org.apache.hadoop.hbase.util.HBaseConfTool hbase.cluster.distributed | head -n 1`&lt;/p&gt;

&lt;p&gt;... i.e. we do not carry forward the --config arg.  Would that be hard to fix JMS?&lt;/p&gt;</comment>
                            <comment id="13911544" author="jmspaggi" created="Tue, 25 Feb 2014 13:05:22 +0000"  >&lt;p&gt;Sure I will look at that.&lt;/p&gt;</comment>
                            <comment id="13911745" author="jmspaggi" created="Tue, 25 Feb 2014 17:23:01 +0000"  >&lt;p&gt;Thanks for testing it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;. Can you give this version a try? I can not but it should be fine.&lt;/p&gt;</comment>
                            <comment id="13912046" author="hadoopqa" created="Tue, 25 Feb 2014 20:54:21 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12630982/HBASE-8803-v7-trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12630982/HBASE-8803-v7-trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12630982&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.1&lt;/font&gt;.  The patch compiles against the hadoop 1.1 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 release audit&lt;/font&gt;.  The applied patch generated 1 release audit warnings (more than the trunk&apos;s current 0 warnings).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +  opts.on(&apos;&lt;del&gt;m&apos;, &apos;&lt;/del&gt;-maxthreads=XX&apos;, &apos;Define the maximum number of threads to use to unload and reload the regions&apos;) do |number|&lt;br/&gt;
+HBASE_NOEXEC=true &quot;$bin&quot;/hbase --config $&lt;/p&gt;
{HBASE_CONF_DIR} org.jruby.Main &quot;$bin&quot;/region_mover.rb --file=$filename $debug --maxthreads=$maxthreads unload $hostname&lt;br/&gt;
+    HBASE_NOEXEC=true &quot;$bin&quot;/hbase --config ${HBASE_CONF_DIR}
&lt;p&gt; org.jruby.Main &quot;$bin&quot;/region_mover.rb --file=$filename $debug --maxthreads=$maxthreads load $hostname&lt;br/&gt;
+usage=&quot;Usage: $0 &lt;span class=&quot;error&quot;&gt;&amp;#91;--config &amp;lt;hbase-confdir&amp;gt;&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;--rs-only&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;--master-only&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;--graceful&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;--maxthreads xx&amp;#93;&lt;/span&gt;&quot;&lt;br/&gt;
+distMode=`$bin/hbase org.apache.hadoop.hbase.util.HBaseConfTool --config &quot;$&lt;/p&gt;
{HBASE_CONF_DIR} hbase.cluster.distributed | head -n 1`&lt;br/&gt;
+        &quot;$bin&quot;/graceful_stop.sh --config &quot;${HBASE_CONF_DIR}
&lt;p&gt;&quot; --restart --reload --debug --maxthreads &quot;$&lt;/p&gt;
{RR_MAXTHREADS}
&lt;p&gt;&quot; &quot;$hostname&quot;&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//testReport/&lt;/a&gt;&lt;br/&gt;
Release audit warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8801//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13912077" author="stack" created="Tue, 25 Feb 2014 21:15:50 +0000"  >&lt;p&gt;I tried it boss.  After fixing the below.....&lt;/p&gt;

&lt;p&gt;-distMode=`$bin/hbase org.apache.hadoop.hbase.util.HBaseConfTool hbase.cluster.distributed | head -n 1`&lt;br/&gt;
+distMode=`$bin/hbase org.apache.hadoop.hbase.util.HBaseConfTool --config &quot;$&lt;/p&gt;
{HBASE_CONF_DIR} hbase.cluster.distributed | head -n 1`&lt;br/&gt;
&lt;br/&gt;
(there is a &apos;&quot;&apos; missing after the HBASE_CONF_DIR).... it worked very nicely. &lt;br/&gt;
&lt;br/&gt;
The change in HBaseConfTool.java doesn&apos;t look right.  You are doing the parse yourself and presuming I want the hbase-site.xml file only.&lt;br/&gt;
&lt;br/&gt;
What if you change this:&lt;br/&gt;
&lt;br/&gt;
.... $bin/hbase org.apache.hadoop.hbase.util.HBaseConfTool --config &quot;${HBASE_CONF_DIR}
&lt;p&gt;  &lt;/p&gt;

&lt;p&gt;to be:&lt;/p&gt;

&lt;p&gt;HBASE_CONF_DIR=$&lt;/p&gt;
{HBASE_CONF_DIR}
&lt;p&gt; $bin/hbase org.apache.hadoop.hbase.util.HBaseConfTool ....&lt;/p&gt;

&lt;p&gt;?&lt;/p&gt;

&lt;p&gt;Might have to check for an empty HBASE_CONF_DIR and set it if not set?   As is done in the shell scripts.&lt;/p&gt;

&lt;p&gt;Thanks JMS.&lt;/p&gt;</comment>
                            <comment id="13912900" author="jmspaggi" created="Wed, 26 Feb 2014 13:46:26 +0000"  >&lt;p&gt;I see. Thanks again for looking at it.&lt;/p&gt;

&lt;p&gt;Modified accordingly&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Might have to check for an empty HBASE_CONF_DIR&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;rolling_restart calls hbase-config.sh at the beginning, and from hbase-config.sh we have&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HBASE_CONF_DIR=&lt;span class=&quot;code-quote&quot;&gt;&quot;${HBASE_CONF_DIR:-$HBASE_HOME/conf}&quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And HBASE_HOME can not be empty since few lines before we have this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; [ -z &lt;span class=&quot;code-quote&quot;&gt;&quot;$HBASE_HOME&quot;&lt;/span&gt; ]; then
  export HBASE_HOME=`dirname &lt;span class=&quot;code-quote&quot;&gt;&quot;$&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;&quot;&lt;/span&gt;`/..
fi
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So I don&apos;t think we need to add any test since HBASE_CONF_DIR can not be empty.&lt;/p&gt;</comment>
                            <comment id="13913101" author="hadoopqa" created="Wed, 26 Feb 2014 16:23:59 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12631221/HBASE-8803-v9-trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12631221/HBASE-8803-v9-trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12631221&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.1&lt;/font&gt;.  The patch compiles against the hadoop 1.1 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 release audit&lt;/font&gt;.  The applied patch generated 1 release audit warnings (more than the trunk&apos;s current 0 warnings).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +  opts.on(&apos;&lt;del&gt;m&apos;, &apos;&lt;/del&gt;-maxthreads=XX&apos;, &apos;Define the maximum number of threads to use to unload and reload the regions&apos;) do |number|&lt;br/&gt;
+HBASE_NOEXEC=true &quot;$bin&quot;/hbase --config $&lt;/p&gt;
{HBASE_CONF_DIR} org.jruby.Main &quot;$bin&quot;/region_mover.rb --file=$filename $debug --maxthreads=$maxthreads unload $hostname&lt;br/&gt;
+    HBASE_NOEXEC=true &quot;$bin&quot;/hbase --config ${HBASE_CONF_DIR}
&lt;p&gt; org.jruby.Main &quot;$bin&quot;/region_mover.rb --file=$filename $debug --maxthreads=$maxthreads load $hostname&lt;br/&gt;
+usage=&quot;Usage: $0 &lt;span class=&quot;error&quot;&gt;&amp;#91;--config &amp;lt;hbase-confdir&amp;gt;&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;--rs-only&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;--master-only&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;--graceful&amp;#93;&lt;/span&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;--maxthreads xx&amp;#93;&lt;/span&gt;&quot;&lt;br/&gt;
+distMode=`HBASE_CONF_DIR=$&lt;/p&gt;
{HBASE_CONF_DIR} $bin/hbase org.apache.hadoop.hbase.util.HBaseConfTool hbase.cluster.distributed | head -n 1`&lt;br/&gt;
+        &quot;$bin&quot;/graceful_stop.sh --config &quot;${HBASE_CONF_DIR}
&lt;p&gt;&quot; --restart --reload --debug --maxthreads &quot;$&lt;/p&gt;
{RR_MAXTHREADS}
&lt;p&gt;&quot; &quot;$hostname&quot;&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//testReport/&lt;/a&gt;&lt;br/&gt;
Release audit warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/patchReleaseAuditProblems.txt&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8814//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13913689" author="stack" created="Wed, 26 Feb 2014 23:08:10 +0000"  >&lt;p&gt;What I applied to 0.96-0.99.  Adds license to thread-pool.rb.&lt;/p&gt;

&lt;p&gt;i tried this patch up on a cluster.  Seems to do the right thing.  Studied output.  Looks good.&lt;/p&gt;

&lt;p&gt;Is the 0.94 patch up to date &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt;?  If so, I&apos;ll apply there too....&lt;/p&gt;</comment>
                            <comment id="13913860" author="hadoopqa" created="Thu, 27 Feb 2014 01:18:28 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12631380/HBASE-8803-v10-trunk.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12631380/HBASE-8803-v10-trunk.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12631380&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8827//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8827//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13913930" author="hudson" created="Thu, 27 Feb 2014 02:08:13 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.96-hadoop2 #218 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96-hadoop2/218/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96-hadoop2/218/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8803&quot; title=&quot;region_mover.rb should move multiple regions at a time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8803&quot;&gt;&lt;del&gt;HBASE-8803&lt;/del&gt;&lt;/a&gt; region_mover.rb should move multiple regions at a time (stack: rev 1572329)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/bin/graceful_stop.sh&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/bin/region_mover.rb&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/bin/rolling-restart.sh&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/bin/thread-pool.rb&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13914032" author="hudson" created="Thu, 27 Feb 2014 04:05:09 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #188 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/188/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/188/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8803&quot; title=&quot;region_mover.rb should move multiple regions at a time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8803&quot;&gt;&lt;del&gt;HBASE-8803&lt;/del&gt;&lt;/a&gt; region_mover.rb should move multiple regions at a time (stack: rev 1572328)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/bin/graceful_stop.sh&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/bin/region_mover.rb&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/bin/rolling-restart.sh&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/bin/thread-pool.rb&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13914087" author="hudson" created="Thu, 27 Feb 2014 05:11:56 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #176 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/176/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/176/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8803&quot; title=&quot;region_mover.rb should move multiple regions at a time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8803&quot;&gt;&lt;del&gt;HBASE-8803&lt;/del&gt;&lt;/a&gt; region_mover.rb should move multiple regions at a time (stack: rev 1572328)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/bin/graceful_stop.sh&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/bin/region_mover.rb&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/bin/rolling-restart.sh&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/bin/thread-pool.rb&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13914100" author="hudson" created="Thu, 27 Feb 2014 05:34:13 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96 #318 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/318/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/318/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8803&quot; title=&quot;region_mover.rb should move multiple regions at a time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8803&quot;&gt;&lt;del&gt;HBASE-8803&lt;/del&gt;&lt;/a&gt; region_mover.rb should move multiple regions at a time (stack: rev 1572329)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/bin/graceful_stop.sh&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/bin/region_mover.rb&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/bin/rolling-restart.sh&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/bin/thread-pool.rb&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13914113" author="hudson" created="Thu, 27 Feb 2014 05:49:52 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #4961 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4961/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4961/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8803&quot; title=&quot;region_mover.rb should move multiple regions at a time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8803&quot;&gt;&lt;del&gt;HBASE-8803&lt;/del&gt;&lt;/a&gt; region_mover.rb should move multiple regions at a time (stack: rev 1572327)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/bin/graceful_stop.sh&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/bin/region_mover.rb&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/bin/rolling-restart.sh&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/bin/thread-pool.rb&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13914864" author="stack" created="Thu, 27 Feb 2014 18:47:44 +0000"  >&lt;p&gt;Resolving.   Committed to 0.96-0.99.  Thanks for the patch &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt;  We can make a new issue to backport.&lt;/p&gt;</comment>
                            <comment id="13914881" author="jmspaggi" created="Thu, 27 Feb 2014 18:55:36 +0000"  >&lt;p&gt;0.94 need some small modifications. the same you did yesterday.  License and HBASE_CONF_DIR. I will open a new issue for the backport.&lt;/p&gt;

&lt;p&gt;Thanks for the commit.&lt;/p&gt;</comment>
                            <comment id="13915314" author="hudson" created="Fri, 28 Feb 2014 01:14:27 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK-on-Hadoop-1.1 #101 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-1.1/101/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-1.1/101/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8803&quot; title=&quot;region_mover.rb should move multiple regions at a time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8803&quot;&gt;&lt;del&gt;HBASE-8803&lt;/del&gt;&lt;/a&gt; region_mover.rb should move multiple regions at a time (stack: rev 1572327)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/bin/graceful_stop.sh&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/bin/region_mover.rb&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/bin/rolling-restart.sh&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/bin/thread-pool.rb&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13969832" author="lhofhansl" created="Tue, 15 Apr 2014 18:04:00 +0000"  >&lt;p&gt;Should we have this in 0.94 as well? I think so.&lt;/p&gt;</comment>
                            <comment id="13969835" author="lhofhansl" created="Tue, 15 Apr 2014 18:09:08 +0000"  >&lt;p&gt;Rebased patch for 0.94.&lt;/p&gt;</comment>
                            <comment id="13970165" author="lhofhansl" created="Tue, 15 Apr 2014 22:56:05 +0000"  >&lt;p&gt;Arrgghh... Missed the new file.&lt;br/&gt;
We&apos;re currently trying this (along with some other changes - patch coming soon on different jira) on a real cluster.&lt;/p&gt;</comment>
                            <comment id="13970308" author="jmspaggi" created="Wed, 16 Apr 2014 01:20:12 +0000"  >&lt;p&gt;The new file is because you asked for the thread pool &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Hehe &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;I tried this on 2 &quot;real&quot; clusters. 8RS and 3RS. They are not as real as yours, but I already tested that a lot. Keep us posted on your testing...&lt;/p&gt;</comment>
                            <comment id="14330533" author="enis" created="Sat, 21 Feb 2015 23:29:11 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12769364">HBASE-12904</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12640353" name="8803-0.94-rebased.txt" size="10161" author="lhofhansl" created="Tue, 15 Apr 2014 22:56:05 +0000"/>
                            <attachment id="12599579" name="8803v5.txt" size="13274" author="stack" created="Fri, 23 Aug 2013 05:38:09 +0000"/>
                            <attachment id="12589763" name="HBASE-8803-v0-trunk.patch" size="3618" author="jmspaggi" created="Wed, 26 Jun 2013 15:25:45 +0000"/>
                            <attachment id="12590498" name="HBASE-8803-v1-0.94.patch" size="8260" author="jmspaggi" created="Tue, 2 Jul 2013 20:23:24 +0000"/>
                            <attachment id="12589789" name="HBASE-8803-v1-trunk.patch" size="7929" author="jmspaggi" created="Wed, 26 Jun 2013 19:53:31 +0000"/>
                            <attachment id="12631380" name="HBASE-8803-v10-trunk.patch" size="11589" author="stack" created="Wed, 26 Feb 2014 23:08:10 +0000"/>
                            <attachment id="12591922" name="HBASE-8803-v2-0.94.patch" size="10226" author="ndimiduk" created="Thu, 11 Jul 2013 22:13:45 +0000"/>
                            <attachment id="12591564" name="HBASE-8803-v2-0.94.patch" size="9782" author="ndimiduk" created="Wed, 10 Jul 2013 00:44:01 +0000"/>
                            <attachment id="12592693" name="HBASE-8803-v3-0.94.patch" size="9696" author="jmspaggi" created="Wed, 17 Jul 2013 00:51:25 +0000"/>
                            <attachment id="12592826" name="HBASE-8803-v4-0.94.patch" size="9732" author="jmspaggi" created="Wed, 17 Jul 2013 19:04:29 +0000"/>
                            <attachment id="12598260" name="HBASE-8803-v4-trunk.patch" size="9508" author="jmspaggi" created="Thu, 15 Aug 2013 18:28:25 +0000"/>
                            <attachment id="12619388" name="HBASE-8803-v5-0.94.patch" size="10103" author="jmspaggi" created="Wed, 18 Dec 2013 19:18:54 +0000"/>
                            <attachment id="12619481" name="HBASE-8803-v6-0.94.patch" size="10138" author="jmspaggi" created="Thu, 19 Dec 2013 03:48:41 +0000"/>
                            <attachment id="12620629" name="HBASE-8803-v6-trunk.patch" size="9983" author="jmspaggi" created="Fri, 27 Dec 2013 18:54:15 +0000"/>
                            <attachment id="12630982" name="HBASE-8803-v7-trunk.patch" size="11966" author="jmspaggi" created="Tue, 25 Feb 2014 17:21:04 +0000"/>
                            <attachment id="12631221" name="HBASE-8803-v9-trunk.patch" size="10545" author="jmspaggi" created="Wed, 26 Feb 2014 13:41:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>16.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 26 Jun 2013 05:11:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>334999</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1lsbb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>335323</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Multithread the region mover so can run more than one region move at a time.  Specify how many threads on the command line.  Feature will make rolling restart complete the sooner (if with a little more disruption as more regions are in flight at a time).</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>