<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:51:12 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1155/HBASE-1155.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1155] Verify that FSDataoutputStream.sync() works</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1155</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In order to guarantee that an HLog sync() flushes the data to the HDFS, we will need to invoke FSDataOutputStream.sync() per &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-200&quot; title=&quot;In HDFS, sync() not yet guarantees data available to the new readers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-200&quot;&gt;&lt;del&gt;HADOOP-4379&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Currently, there is no access to the underlying FSDataOutputStream from SequenceFile.Writer, as it is a package private member.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12413298">HBASE-1155</key>
            <summary>Verify that FSDataoutputStream.sync() works</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="jimk">Jim Kellerman</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Jan 2009 19:03:01 +0000</created>
                <updated>Fri, 20 Nov 2015 13:01:55 +0000</updated>
                            <resolved>Tue, 9 Jun 2009 04:57:53 +0000</resolved>
                                    <version>0.19.0</version>
                                    <fixVersion>0.90.0</fixVersion>
                                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12667888" author="jimk" created="Wed, 28 Jan 2009 00:39:05 +0000"  >&lt;p&gt;The latest patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-200&quot; title=&quot;In HDFS, sync() not yet guarantees data available to the new readers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-200&quot;&gt;&lt;del&gt;HADOOP-4379&lt;/del&gt;&lt;/a&gt; combined with &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-168&quot; title=&quot;Block report processing should compare gneration stamp&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-168&quot;&gt;&lt;del&gt;HADOOP-5027&lt;/del&gt;&lt;/a&gt;seems to solve the problems that we have seen. As for Doug Judd&apos;s problem with getting the length of the file, that is not an issue for HBase, as we do not look at the length of the file.&lt;/p&gt;

&lt;p&gt;We need more testing to confirm.&lt;/p&gt;</comment>
                            <comment id="12670657" author="jimk" created="Thu, 5 Feb 2009 08:05:28 +0000"  >&lt;p&gt;Simple testing using the test programs that I attached to &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-200&quot; title=&quot;In HDFS, sync() not yet guarantees data available to the new readers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-200&quot;&gt;&lt;del&gt;HADOOP-4379&lt;/del&gt;&lt;/a&gt;,  would seem to indicate that the patch for 4379 works. However we need more testing in the HBase environment to verify that the patch is sufficient.&lt;/p&gt;</comment>
                            <comment id="12671039" author="stack" created="Fri, 6 Feb 2009 08:06:09 +0000"  >&lt;p&gt;We have a sequence file local to hbase.  We can just change our copy?&lt;/p&gt;</comment>
                            <comment id="12671179" author="jimk" created="Fri, 6 Feb 2009 16:13:05 +0000"  >&lt;p&gt;@Stack&lt;/p&gt;

&lt;p&gt;Yes, there are not many changes. Will work on this as soon as I finish up what I am currently working on.&lt;/p&gt;</comment>
                            <comment id="12672478" author="jimk" created="Wed, 11 Feb 2009 01:18:27 +0000"  >&lt;p&gt;each record is approximately 1024 bytes.&lt;br/&gt;
one block is either 1,048,576 (1MB) or 67,108,864 (64 MB)&lt;/p&gt;

&lt;p&gt;A 1MB block holds 1,002 records&lt;br/&gt;
1026048 bytes written, overhead is 22.48 bytes/record&lt;/p&gt;

&lt;p&gt;expected overhead for 64MB is 1,441,792&lt;br/&gt;
expected number of records for 64MB is 64,128&lt;/p&gt;

&lt;p&gt;A 64MB block holds 64,157 records&lt;br/&gt;
65,696,768 bytes written, overhead is 1,412,096&lt;br/&gt;
overhead is 22.01 bytes/record&lt;/p&gt;

&lt;p&gt;So overhead is ~ 22-23 bytes/record.&lt;/p&gt;

&lt;p&gt;========================================&lt;/p&gt;

&lt;p&gt;Without the patch the best we can do is read up to the end of the last&lt;br/&gt;
full block. If we write 1024 records into 1MB blocks we can read 1002&lt;br/&gt;
records (~ number of records in block)&lt;/p&gt;

&lt;p&gt;If we write write 70,000 records into 64MB blocks we can read 64157&lt;br/&gt;
records back.&lt;/p&gt;

&lt;p&gt;If less than a block is written, we get back nothing. We only get up&lt;br/&gt;
to the last full block.&lt;/p&gt;

&lt;p&gt;========================================&lt;/p&gt;

&lt;p&gt;With the patch, 1MB block size and no syncs:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Writing 1024 records, none are recovered&lt;/li&gt;
	&lt;li&gt;Writing 1200 records, 1188 are recovered&lt;/li&gt;
	&lt;li&gt;Writing 1500 records, 1499 are recovered&lt;/li&gt;
	&lt;li&gt;Writing 1000 records,  994 are recovered&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;There seems to be a problem with writing about 1024 records to a 1MB&lt;br/&gt;
block size file if there are no syncs. Writing more than 1024 records&lt;br/&gt;
ia recoverable (e.g., 1500) works, as does writing less (e.g., 1000&lt;br/&gt;
records - 994 are recoverable, writing 900 records - 870&lt;br/&gt;
are recoverable). So there appears to be a problem with writing&lt;br/&gt;
close to 1MB of data into a 1MB block size with no syncs. Adding more&lt;br/&gt;
than or some less than 1024 records seems to work.&lt;/p&gt;

&lt;p&gt;========================================&lt;/p&gt;

&lt;p&gt;With the patch, it appears that the block size is irrelevant and it is&lt;br/&gt;
possible to read up to the last sync for 64MB blocks.&lt;/p&gt;

&lt;p&gt;With a 64MB block size:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;If the sync rate is 1, it is possible to read every record written.&lt;/li&gt;
	&lt;li&gt;With a sync rate of 100, it is possible to read up to the last multiple of 100.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;With a 1MB block size:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Cancelling the writer&apos;s lease seems to take a lot longer.&lt;/li&gt;
	&lt;li&gt;Sometimes it seems to never recover the lease. (e.g., write 1024 records, sync every 100 writes, 1MB block size)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;More testing to do: try writing close to 64MB with a 64MB block size and see if it experiences the non-recoverability that writing ~1MB with 1MB block size does.&lt;/p&gt;</comment>
                            <comment id="12672525" author="stack" created="Wed, 11 Feb 2009 06:51:05 +0000"  >&lt;p&gt;Looks great.  You think it works when lots of concurrent edits written?&lt;/p&gt;</comment>
                            <comment id="12672768" author="jimk" created="Wed, 11 Feb 2009 20:52:47 +0000"  >&lt;p&gt;To clarify Stack&apos;s question, he said:&lt;/p&gt;

&lt;p&gt;&amp;gt; ----&lt;del&gt;Original Message&lt;/del&gt;----&lt;br/&gt;
&amp;gt; From: Michael Stack&lt;br/&gt;
&amp;gt; Sent: Wednesday, February 11, 2009 12:42 PM&lt;br/&gt;
&amp;gt; To: Jim Kellerman (POWERSET)&lt;br/&gt;
&amp;gt; Subject: RE: &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Commented: (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1155&quot; title=&quot;Verify that FSDataoutputStream.sync() works&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1155&quot;&gt;&lt;del&gt;HBASE-1155&lt;/del&gt;&lt;/a&gt;) Verify that&lt;br/&gt;
&amp;gt; FSDataoutputStream.sync() works&lt;br/&gt;
&amp;gt; &lt;br/&gt;
&amp;gt; On a loaded cluster do appends persist or get their knickers in a twist?&lt;br/&gt;
&amp;gt; St.Ack&lt;/p&gt;

&lt;p&gt;The answer to this question is TBD. I have yet to test how it works in a loaded cluster. To this point, I have just verified that in&lt;br/&gt;
a simple test that it works. More to come soon...&lt;/p&gt;</comment>
                            <comment id="12676819" author="jimk" created="Wed, 25 Feb 2009 23:47:22 +0000"  >&lt;p&gt;Patch that uses new API&apos;s to recover file lease and read from last log file being written by region server.&lt;/p&gt;

&lt;p&gt;It does work, but slowly. As noted in &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-200&quot; title=&quot;In HDFS, sync() not yet guarantees data available to the new readers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-200&quot;&gt;&lt;del&gt;HADOOP-4379&lt;/del&gt;&lt;/a&gt;, it takes almost an hour to recover the file lease when the clusters are loaded.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-02-25 21:39:16,843 DEBUG org.apache.hadoop.hbase.regionserver.HLog: Splitting 3 of 3: hdfs:/x.y.com:8100/hbase/log_10.76.44.139_1235597506284_8020/hlog.dat.1235597820662
2009-02-25 21:39:16,847 DEBUG org.apache.hadoop.hbase.regionserver.HLog: Triggering lease recovery.
...
2009-02-25 22:37:12,755 INFO org.apache.hadoop.hbase.regionserver.HLog: log file splitting completed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hdfs:&lt;span class=&quot;code-comment&quot;&gt;//x.y.com:8100/hbase/log_10.76.44.139_1235597506284_8020&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12676871" author="stack" created="Thu, 26 Feb 2009 05:01:14 +0000"  >&lt;p&gt;An hour is unacceptable, don&apos;t you think?  Regions can&apos;t be off-line an hour.  Is there a timeout we can adjust in hadoop?&lt;/p&gt;</comment>
                            <comment id="12677088" author="jimk" created="Thu, 26 Feb 2009 18:30:15 +0000"  >&lt;p&gt;Yes an hour is way too long. I asked in &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-200&quot; title=&quot;In HDFS, sync() not yet guarantees data available to the new readers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-200&quot;&gt;&lt;del&gt;HADOOP-4379&lt;/del&gt;&lt;/a&gt; if there is a way to speed it up.&lt;/p&gt;</comment>
                            <comment id="12679688" author="jimk" created="Fri, 6 Mar 2009 18:51:29 +0000"  >&lt;p&gt;Moving out of 0.19.1 because it is unlikely we will a patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-200&quot; title=&quot;In HDFS, sync() not yet guarantees data available to the new readers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-200&quot;&gt;&lt;del&gt;HADOOP-4379&lt;/del&gt;&lt;/a&gt; soon enough.&lt;/p&gt;</comment>
                            <comment id="12703718" author="stack" created="Tue, 28 Apr 2009 16:47:26 +0000"  >&lt;p&gt;Moving out of 0.20.0.  It doesn&apos;t work in hadoop 0.20.0.  Hopefully 0.21.0.&lt;/p&gt;</comment>
                            <comment id="12711279" author="stack" created="Wed, 20 May 2009 18:28:11 +0000"  >&lt;p&gt;Have been testing latest patches in &lt;a href=&quot;https://issues.apache.org/jira/browse/HDFS-200&quot; title=&quot;In HDFS, sync() not yet guarantees data available to the new readers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HDFS-200&quot;&gt;&lt;del&gt;HADOOP-4379&lt;/del&gt;&lt;/a&gt;.  See notes there on current state.&lt;/p&gt;</comment>
                            <comment id="12717556" author="stack" created="Tue, 9 Jun 2009 04:57:53 +0000"  >&lt;p&gt;Resolving this issue as won&apos;t fix.  Being dealt with over in hbase-1470&lt;/p&gt;</comment>
                            <comment id="15017930" author="lars_francke" created="Fri, 20 Nov 2015 13:01:55 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12406057">HDFS-200</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12400976" name="patch.txt" size="6788" author="jimk" created="Wed, 25 Feb 2009 23:47:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 Feb 2009 08:06:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25604</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hbnj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99150</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>