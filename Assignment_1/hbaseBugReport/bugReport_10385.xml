<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:13:17 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10385/HBASE-10385.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10385] ImportTsv to parse date time from typical loader formats</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10385</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Simple patch to enable parsing of standard date time fields from TSV files into Hbase.&lt;/p&gt;

&lt;p&gt;***************&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;57,62 ****&lt;/li&gt;
		&lt;/ul&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;57,70 ----&lt;br/&gt;
  import com.google.common.base.Splitter;&lt;br/&gt;
  import com.google.common.collect.Lists;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;+ //2013-08-19T04:39:07&lt;br/&gt;
+ import java.text.DateFormat;&lt;br/&gt;
+ import java.util.*;&lt;br/&gt;
+ import java.text.SimpleDateFormat;&lt;br/&gt;
+ import java.text.ParseException;&lt;br/&gt;
+ &lt;br/&gt;
+ &lt;br/&gt;
+ &lt;br/&gt;
  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Tool to import data from a TSV file.&lt;br/&gt;
   *&lt;br/&gt;
***************
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;220,229 ****&lt;br/&gt;
              getColumnOffset(timestampKeyColumnIndex),&lt;br/&gt;
              getColumnLength(timestampKeyColumnIndex));&lt;br/&gt;
          try 
{
!           return Long.parseLong(timeStampStr);
          }
&lt;p&gt; catch (NumberFormatException nfe) &lt;/p&gt;
{
            // treat this record as bad record
!           throw new BadTsvLineException(&quot;Invalid timestamp &quot; + timeStampStr);
          }
&lt;p&gt;        }&lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;&amp;#8212; 228,239 ----&lt;br/&gt;
              getColumnOffset(timestampKeyColumnIndex),&lt;br/&gt;
              getColumnLength(timestampKeyColumnIndex));&lt;br/&gt;
          try &lt;/p&gt;
{
! 	    return Long.parseLong(timeStampStr);
          }
&lt;p&gt; catch (NumberFormatException nfe) &lt;/p&gt;
{
+ 	    // Try this record with string to date in mseconds long
+ 	    return extractTimestampInput(timeStampStr);
            // treat this record as bad record
!           //throw new BadTsvLineException(&quot;Invalid timestamp &quot; + timeStampStr);
          }
&lt;p&gt;        }&lt;/p&gt;

&lt;p&gt;***************&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;
	&lt;ul&gt;
		&lt;li&gt;
		&lt;ul&gt;
			&lt;li&gt;243,248 ****&lt;/li&gt;
		&lt;/ul&gt;
		&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
			&lt;li&gt;253,274 ----&lt;br/&gt;
          return lineBytes;&lt;br/&gt;
        }&lt;br/&gt;
      }&lt;br/&gt;
+  public static long extractTimestampInput(String strDate) throws BadTsvLineException{&lt;br/&gt;
+     final List&amp;lt;String&amp;gt; dateFormats = Arrays.asList(&quot;yyyy-MM-dd HH:mm:ss.SSS&quot;, &quot;yyyy-MM-dd&apos;T&apos;HH:mm:ss&quot;);    &lt;br/&gt;
+ &lt;br/&gt;
+     for(String format: dateFormats)
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {+         SimpleDateFormat sdf = new SimpleDateFormat(format);+         try{
+             Date d= sdf.parse(strDate);
+ 	    long msecs = d.getTime();
+ 	    return msecs;
+         } catch (ParseException e) {
+ 	    //intentionally empty
+         }+     }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;+     // If we come here we have a problem with converting timestamps for this row.&lt;br/&gt;
+     throw new BadTsvLineException(&quot;Invalid timestamp &quot; + strDate); &lt;br/&gt;
+  } &lt;/p&gt;&lt;/li&gt;
		&lt;/ul&gt;
		&lt;/li&gt;
	&lt;/ul&gt;
	&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;      public static class BadTsvLineException extends Exception {&lt;br/&gt;
        public BadTsvLineException(String err) {&lt;/p&gt;</description>
                <environment></environment>
        <key id="12689859">HBASE-10385</key>
            <summary>ImportTsv to parse date time from typical loader formats</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ericavijay">Vijay Sarvepali</reporter>
                        <labels>
                            <label>importtsv</label>
                    </labels>
                <created>Mon, 20 Jan 2014 19:22:26 +0000</created>
                <updated>Tue, 4 Feb 2014 01:03:53 +0000</updated>
                            <resolved>Tue, 4 Feb 2014 01:03:53 +0000</resolved>
                                    <version>0.96.1.1</version>
                                                    <component>mapreduce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                    <timeoriginalestimate seconds="7200">2h</timeoriginalestimate>
                            <timeestimate seconds="7200">2h</timeestimate>
                                        <comments>
                            <comment id="13876885" author="stack" created="Mon, 20 Jan 2014 21:51:46 +0000"  >&lt;p&gt;Thank you for the contrib &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ericavijay&quot; class=&quot;user-hover&quot; rel=&quot;ericavijay&quot;&gt;Vijay Sarvepali&lt;/a&gt;.  Would you mind formatting it as a patch file attached to the issue and having the code follow the convention of the rest of the code base (see the reference guide on how to contribute if you need more).  Also, this looks like a behavior that should be optional?&lt;/p&gt;</comment>
                            <comment id="13877024" author="ndimiduk" created="Tue, 21 Jan 2014 00:25:27 +0000"  >&lt;p&gt;The design of ImportTsv makes is customary to add &quot;business logic&quot; by way of specifying a custom mapper. Field conversion strikes me as a feature implemented through precisely such means. Have a look at &lt;tt&gt;-Dimporttsv.mapper.class&lt;/tt&gt; as &lt;a href=&quot;http://hbase.apache.org/book/ops_mgt.html#importtsv&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;documented&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;If we had loads of folks banging down the door demanding this feature, I&apos;d be inclined to reconsider, but this is the first request I&apos;m aware of.&lt;/p&gt;</comment>
                            <comment id="13877048" author="ericavijay" created="Tue, 21 Jan 2014 00:59:45 +0000"  >&lt;p&gt;Hi Nick,&lt;/p&gt;

&lt;p&gt;Got it.  I will just wait to see how this can help.  I found the change handy to import a bunch of text files, may be I will just write a simple custom mapper class.&lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
Vijay&lt;/p&gt;</comment>
                            <comment id="13877061" author="ericavijay" created="Tue, 21 Jan 2014 01:10:40 +0000"  >&lt;p&gt;My first heroic attempt to patch.&lt;/p&gt;</comment>
                            <comment id="13889942" author="ericavijay" created="Mon, 3 Feb 2014 21:34:14 +0000"  >&lt;p&gt;Hello Nick,&lt;/p&gt;

&lt;p&gt;As I walked through writing my own class and still taking advantage of the ImportTsv command itself, there is one issue I found when reusing the code, the class Parsedline is not exposed as a public class.  If we can do this, it will simplify development of custom mappers&lt;/p&gt;

&lt;p&gt;diff ImportTsv.java.orig ImportTsv.java&lt;br/&gt;
205c205&lt;br/&gt;
&amp;lt;     class ParsedLine {&lt;br/&gt;
&amp;#8212;&lt;br/&gt;
&amp;gt;     public class ParsedLine {&lt;/p&gt;

&lt;p&gt;I can submit this as a patch if you prefer.  &lt;/p&gt;

&lt;p&gt;Thanks&lt;br/&gt;
vijay &lt;/p&gt;</comment>
                            <comment id="13889961" author="ndimiduk" created="Mon, 3 Feb 2014 21:49:32 +0000"  >&lt;p&gt;Sorry &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ericavijay&quot; class=&quot;user-hover&quot; rel=&quot;ericavijay&quot;&gt;Vijay Sarvepali&lt;/a&gt;, it looks like your heroic patch slipped through the cracks. After attaching a patch file vs trunk, the next step is to click the &quot;submit patch&quot; button. This will queue it up for our QABot to do the due diligence. Patches are generally not accepted unless they pass the precommit verification that bot performs. I&apos;ve clicked the button, we&apos;ll see if your patch still applies cleanly.&lt;/p&gt;

&lt;p&gt;As for exposing ParsedLine, I vaguely remember running into something similar in a previous life. My workaround was to place my custom mapper in the org.apache.hadoop.hbase namespace. I think this is tedious and should not be necessary, so I&apos;m fine with exposing it as a public class. I think that&apos;ll facilitate general reuse. I think that&apos;s a separate issue, right?&lt;/p&gt;</comment>
                            <comment id="13890006" author="hadoopqa" created="Mon, 3 Feb 2014 22:25:02 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12624051/HBASE-10385.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12624051/HBASE-10385.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12624051&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8582//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8582//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13890064" author="ericavijay" created="Mon, 3 Feb 2014 23:01:12 +0000"  >&lt;p&gt;Hi Nick,&lt;/p&gt;

&lt;p&gt;I am just going to drop this patch and provide a simpler patch for the exposing the ParsedLine as a public class.  I generally like the idea of having an independent business logic that way one can reverse a string, convert IP address to integer, etc. using the business logic.  My patch will also need to include many possible datetime string formats etc.. &lt;/p&gt;

&lt;p&gt;So you can ignore this patch, I will just start this as a new issue for being able to publicly expose the ParsedLine method. &lt;/p&gt;

&lt;p&gt;Regards&lt;br/&gt;
Vijay&lt;/p&gt;</comment>
                            <comment id="13890065" author="ericavijay" created="Mon, 3 Feb 2014 23:02:59 +0000"  >&lt;p&gt;Removed this patch to use Nick&apos;s idea of using custom mapper classes to address these types of issues.&lt;/p&gt;

&lt;p&gt;Vijay&lt;/p&gt;</comment>
                            <comment id="13890228" author="ndimiduk" created="Tue, 4 Feb 2014 01:03:44 +0000"  >&lt;p&gt;Sounds good &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ericavijay&quot; class=&quot;user-hover&quot; rel=&quot;ericavijay&quot;&gt;Vijay Sarvepali&lt;/a&gt;. I&apos;ll close this issue as won&apos;t fix. Please file a new ticket with necessary changes to make ImportTsv more extensible.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12624051" name="HBASE-10385.patch" size="1875" author="ericavijay" created="Tue, 21 Jan 2014 01:10:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 20 Jan 2014 21:51:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>368826</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 45 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1rkjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>369130</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>mapreduce importtsv</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>