<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:33:13 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12457/HBASE-12457.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12457] Regions in transition for a long time when CLOSE interleaves with a slow compaction</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12457</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Under heave load we have observed regions remaining in transition for 20 minutes when the master requests a close while a slow compaction is running.&lt;/p&gt;

&lt;p&gt;The pattern is always something like this:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;RS starts a compaction&lt;/li&gt;
	&lt;li&gt;HM request the region to be closed on this RS&lt;/li&gt;
	&lt;li&gt;Compaction is not aborted for another 20 minutes&lt;/li&gt;
	&lt;li&gt;The region is in transition and not usable.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;In every case I tracked down so far the time between the requested CLOSE and abort of the compaction is almost exactly 20 minutes, which is suspicious.&lt;/p&gt;

&lt;p&gt;Of course part of the issue is having compactions that take over 20 minutes, but maybe we can do better here.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12754386">HBASE-12457</key>
            <summary>Regions in transition for a long time when CLOSE interleaves with a slow compaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="10002" iconUrl="https://issues.apache.org/jira/images/icons/statuses/document.png" description="A patch for this issue has been uploaded to JIRA by a contributor.">Patch Available</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Nov 2014 06:14:57 +0000</created>
                <updated>Tue, 9 Dec 2014 22:58:34 +0000</updated>
                                            <version>0.98.7</version>
                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>12</watches>
                                                                <comments>
                            <comment id="14206010" author="lhofhansl" created="Tue, 11 Nov 2014 06:18:16 +0000"  >&lt;p&gt;Sometime (but not always) we Splits interspersed with this.&lt;/p&gt;

&lt;p&gt;While l scoured over the code I noticed the following:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;SplitTransaction write CREATE_SPLIT_DIR after it created the daugther dirs and CLOSED_PARENT_REGION after the parent region is closed&lt;/li&gt;
	&lt;li&gt;Upon rollback writestate.writesEnabled is set back to true unconditionally at the CREATE_SPLIT_DIR stage.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It seems that should only be done when we journaled CLOSED_PARENT_REGION.&lt;/p&gt;</comment>
                            <comment id="14206011" author="lhofhansl" created="Tue, 11 Nov 2014 06:19:41 +0000"  >&lt;p&gt;Here&apos;s a minifix for this issue.&lt;br/&gt;
Note: This is &lt;b&gt;not&lt;/b&gt; the core of the problem, just something I noticed.&lt;/p&gt;</comment>
                            <comment id="14206059" author="lhofhansl" created="Tue, 11 Nov 2014 07:10:44 +0000"  >&lt;p&gt;That all said, in the end I have observed that only on a single region server (so far) so might be an environmental issue.&lt;/p&gt;</comment>
                            <comment id="14206880" author="stack" created="Tue, 11 Nov 2014 19:27:28 +0000"  >&lt;p&gt;We are aborting the compaction because we want to close. The compaction abort is not noticed for 20minutes?  We shouldn&apos;t close if an ongoing compaction (that has not yet aborted)?&lt;/p&gt;</comment>
                            <comment id="14206941" author="lhofhansl" created="Tue, 11 Nov 2014 19:53:07 +0000"  >&lt;p&gt;Right. The timing is hard though. It seems the master considers the region closed once it sent the CLOSE.&lt;/p&gt;

&lt;p&gt;One option I though about is for the HRegion.doClose() to interrupt any compactions running (i.e. interrupt the CompactSplitThread). Then upon receiving an interrupted exception the compactor would recheck writestate.writesEnabled rather than waiting for the next 10mb chunk to finish writing.&lt;br/&gt;
The symptom here looks like the compactor just hanging in some IO (either scanner.next or writer.append - my bet is on the latter). An interrupt can break out of that and allow the compactor to recheck the condition.&lt;br/&gt;
Might be easiest to explain with a patch. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14206957" author="lhofhansl" created="Tue, 11 Nov 2014 20:02:07 +0000"  >&lt;p&gt;Unfortunately there is not API to interrupt all threads in a Threadpool without shutting down the pool.&lt;/p&gt;</comment>
                            <comment id="14207117" author="lhofhansl" created="Tue, 11 Nov 2014 21:34:30 +0000"  >&lt;p&gt;Like this...? (Pretty, needs to be cleaned up with APIs, etc, but shows what I mean).&lt;br/&gt;
This should cause any IO in the Compactor to throw an InterruptedIOException, which will (should, need to verify) abort the compaction immediately. That is OK, as we are abandoning the compaction anyway.&lt;/p&gt;</comment>
                            <comment id="14207211" author="apurtell" created="Tue, 11 Nov 2014 22:33:00 +0000"  >&lt;p&gt;Patch looks ok to me, modulo those cleanups you mention, getting rid of the casting.&lt;/p&gt;</comment>
                            <comment id="14207214" author="apurtell" created="Tue, 11 Nov 2014 22:33:29 +0000"  >&lt;p&gt;I guess the question is .. does it work ? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; We should also have a test in TestCompaction&lt;/p&gt;</comment>
                            <comment id="14207320" author="lhofhansl" created="Tue, 11 Nov 2014 23:29:03 +0000"  >&lt;p&gt;Thinking about how to express this in a test without cut-and-pasting all of Compactor into a test class. I need to be able to block the writer during append.&lt;/p&gt;</comment>
                            <comment id="14207346" author="lhofhansl" created="Tue, 11 Nov 2014 23:41:13 +0000"  >&lt;p&gt;Test upcoming soon.&lt;/p&gt;</comment>
                            <comment id="14207365" author="apurtell" created="Tue, 11 Nov 2014 23:53:24 +0000"  >&lt;p&gt;If you just want to test if interrupting compaction is possible, you might be able to use Mockito, something like:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Get a reference to the DefaultCompactor instance as defaultCompactor somehow
&lt;/span&gt;compactor = spy(defaultCompactor);
&lt;span class=&quot;code-comment&quot;&gt;// This should first call compactor.compact() and then execute the code in the answer() callback
&lt;/span&gt;when(compactor.compact(anyObject())).thenAnswer(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Answer() {
    &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; answer(InvocationOnMock invocation) {
        &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(60000); &lt;span class=&quot;code-comment&quot;&gt;// or whatever
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ...; &lt;span class=&quot;code-comment&quot;&gt;// need to &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; a List&amp;lt;Path&amp;gt;
&lt;/span&gt;    }
});
&lt;span class=&quot;code-comment&quot;&gt;// ...
&lt;/span&gt;&lt;span class=&quot;code-comment&quot;&gt;// Trigger compaction&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;?&lt;/p&gt;</comment>
                            <comment id="14207381" author="apurtell" created="Wed, 12 Nov 2014 00:06:06 +0000"  >&lt;p&gt;Set fix versions&lt;/p&gt;</comment>
                            <comment id="14207388" author="lhofhansl" created="Wed, 12 Nov 2014 00:11:48 +0000"  >&lt;p&gt;With a test (still not cleaned up, trying to vet the idea).&lt;br/&gt;
Now, what I cannot prove this way is that writer.append actually behaves this way... I.e. that it is interruptable and will throw InterruptedIOException.&lt;/p&gt;</comment>
                            <comment id="14207678" author="lhofhansl" created="Wed, 12 Nov 2014 04:52:23 +0000"  >&lt;p&gt;Combined patch.&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Also adds the split transaction fix&lt;/li&gt;
	&lt;li&gt;Adds a clean API to Store and HRegion to report on current transactions&lt;/li&gt;
	&lt;li&gt;Gives compactions a chance to abort themselves as before. After 30s they are interrupted and then we continue waiting.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please let me know what you think.&lt;/p&gt;</comment>
                            <comment id="14207693" author="jinghe" created="Wed, 12 Nov 2014 05:09:41 +0000"  >&lt;p&gt;Is this somehow similar or related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10492&quot; title=&quot;open daughter regions can unpredictably take long time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10492&quot;&gt;HBASE-10492&lt;/a&gt;? &lt;br/&gt;
For that JIRA, I thought in the end it was probably the env I had at one point.&lt;br/&gt;
I was running on IBM GPFS FileSystem..&lt;/p&gt;</comment>
                            <comment id="14207696" author="lhofhansl" created="Wed, 12 Nov 2014 05:23:17 +0000"  >&lt;p&gt;That looks differently to me. Here we cannot finish a compaction and we fail to abort it when the master wants to close the region.&lt;/p&gt;</comment>
                            <comment id="14208293" author="apurtell" created="Wed, 12 Nov 2014 17:34:34 +0000"  >&lt;p&gt;I looked at the 0.98 combined patch. Changes lgtm, except:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In HRegion#waitForFlushesAndCompactions, add debug level logging when issuing thread interrupts so we can determine if we are trying to interrupt but nothing subsequently happens.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Use EnvironmentEdgeManager#currentTime (EEM#currentTimeMillis on 0.98) instead of System.currentTimeMillis&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Nice test.&lt;/p&gt;</comment>
                            <comment id="14208494" author="lhofhansl" created="Wed, 12 Nov 2014 19:17:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;add debug level logging when issuing thread interrupts&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Was &lt;b&gt;just&lt;/b&gt; thinking that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; Will. The new Test also needs a license header.&lt;/p&gt;

&lt;p&gt;You think 30s is good. Internally we found all compactions that do not have this issue are aborted within 8s. Could make it a minute - although it&apos;s not really hurting anything. The only part it (when interrupting the compaction) doesn&apos;t do it cleaning up the files in tmp. Maybe it should do that...? (might be a bit heard to distinguish this from other exception for which we presumably do not want to clean up the tmp file... Or do we?)&lt;/p&gt;</comment>
                            <comment id="14208502" author="apurtell" created="Wed, 12 Nov 2014 19:22:31 +0000"  >&lt;p&gt;30s is ok. We&apos;re trying to limit the time clients will see NSRE for a parent region going offline in a split transaction so we shouldn&apos;t be too conservative with waiting here. &lt;/p&gt;

&lt;p&gt;Under what circumstances would we not want to clean up files in tmp from a failed or aborted compaction? They&apos;re  broken or redundant or both.&lt;/p&gt;</comment>
                            <comment id="14208542" author="lhofhansl" created="Wed, 12 Nov 2014 19:45:07 +0000"  >&lt;p&gt;Seeing an assertion failure now in the test... Checking.&lt;/p&gt;</comment>
                            <comment id="14208574" author="lhofhansl" created="Wed, 12 Nov 2014 19:56:40 +0000"  >&lt;p&gt;Turns out that&apos;s because of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12454&quot; title=&quot;Setting didPerformCompaction early in HRegion#compact&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12454&quot;&gt;&lt;del&gt;HBASE-12454&lt;/del&gt;&lt;/a&gt; (which I think was committed due to a misunderstanding)&lt;/p&gt;</comment>
                            <comment id="14208637" author="apurtell" created="Wed, 12 Nov 2014 20:33:29 +0000"  >&lt;p&gt;I pushed reverts for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12454&quot; title=&quot;Setting didPerformCompaction early in HRegion#compact&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12454&quot;&gt;&lt;del&gt;HBASE-12454&lt;/del&gt;&lt;/a&gt; so that should be good now. &lt;/p&gt;</comment>
                            <comment id="14208701" author="lhofhansl" created="Wed, 12 Nov 2014 21:12:46 +0000"  >&lt;p&gt;New patch:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;addressing Andrews comments&lt;/li&gt;
	&lt;li&gt;add license header to new test&lt;/li&gt;
	&lt;li&gt;remove Test dependency on deprecated HBaseTestCase class&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;If good, I&apos;ll make a trunk patch for HadoopQA&lt;/p&gt;</comment>
                            <comment id="14208708" author="lhofhansl" created="Wed, 12 Nov 2014 21:14:51 +0000"  >&lt;p&gt;We&apos;ve seen this on two machines now. The wait on the other machine was also close to 20m (18m to be precise).&lt;/p&gt;

&lt;p&gt;Last question: Is 30s wait time before we interrupt good enough? The compactions should cancel themselves (in our case we find that unless they hang in the described way, they cancel themselves after no more than 8s). Could maybe wait a minute too. Not sure.&lt;/p&gt;</comment>
                            <comment id="14208769" author="apurtell" created="Wed, 12 Nov 2014 21:54:41 +0000"  >&lt;p&gt;v2 patch lgtm&lt;/p&gt;</comment>
                            <comment id="14209142" author="apurtell" created="Thu, 13 Nov 2014 02:45:37 +0000"  >&lt;p&gt;Let&apos;s commit this if you feel comfortable with it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; so the next 0.98.8 RC can get out the door. (Or we can try again later for .9)&lt;/p&gt;</comment>
                            <comment id="14209271" author="lhofhansl" created="Thu, 13 Nov 2014 04:51:37 +0000"  >&lt;p&gt;Lemme make a quick trunk patch. I think this is quite safe. If compaction manage to cancel themselves within 30s it is functionally unchanged. And the change in SplitTransaction seems correct to me as well.&lt;/p&gt;</comment>
                            <comment id="14209282" author="apurtell" created="Thu, 13 Nov 2014 05:06:03 +0000"  >&lt;p&gt;Thanks Lars, appreciate it.&lt;/p&gt;</comment>
                            <comment id="14209287" author="lhofhansl" created="Thu, 13 Nov 2014 05:11:12 +0000"  >&lt;p&gt;Trunk patch.&lt;/p&gt;</comment>
                            <comment id="14209288" author="lhofhansl" created="Thu, 13 Nov 2014 05:11:27 +0000"  >&lt;p&gt;Let&apos;s a HadoopQA run in.&lt;/p&gt;</comment>
                            <comment id="14209338" author="hadoopqa" created="Thu, 13 Nov 2014 06:07:57 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12681251/12457-combined-trunk.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12681251/12457-combined-trunk.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12681251&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 3787 checkstyle errors (more than the trunk&apos;s current 3786 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.io.TestHeapSize&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11658//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14209348" author="apurtell" created="Thu, 13 Nov 2014 06:18:28 +0000"  >&lt;p&gt;New patch adjusting HRegion heap size estimate coming right up.&lt;/p&gt;</comment>
                            <comment id="14209351" author="apurtell" created="Thu, 13 Nov 2014 06:21:55 +0000"  >&lt;p&gt;Updated patch.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Running org.apache.hadoop.hbase.io.TestHeapSize
Tests run: 3, Failures: 0, Errors: 0, Skipped: 0, Time elapsed: 0.689 sec - in org.apache.hadoop.hbase.io.TestHeapSize

Results :

Tests run: 3, Failures: 0, Errors: 0, Skipped: 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Resubmitting to Jenkins&lt;/p&gt;</comment>
                            <comment id="14209354" author="lhofhansl" created="Thu, 13 Nov 2014 06:26:20 +0000"  >&lt;p&gt;Cool. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;. So this is good to go.&lt;/p&gt;

&lt;p&gt;Unless there are objections I&apos;ll commit this now.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;, if you guys have some time maybe put some extra sets of eyes on this (good even when done after commit).&lt;/p&gt;</comment>
                            <comment id="14209394" author="lhofhansl" created="Thu, 13 Nov 2014 06:56:16 +0000"  >&lt;p&gt;Pushed to 0.98+.&lt;/p&gt;</comment>
                            <comment id="14209443" author="hudson" created="Thu, 13 Nov 2014 07:43:03 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #462 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/462/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/462/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12457&quot; title=&quot;Regions in transition for a long time when CLOSE interleaves with a slow compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12457&quot;&gt;HBASE-12457&lt;/a&gt; Regions in transition for a long time when CLOSE interleaves with a slow compaction. (larsh: rev 0e795c1cf8621df2d33600f4b33a00344fe5de5a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/DefaultCompactor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionIO.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14209470" author="hadoopqa" created="Thu, 13 Nov 2014 08:11:37 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12681269/HBASE-12457.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12681269/HBASE-12457.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12681269&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 4 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 3787 checkstyle errors (more than the trunk&apos;s current 3786 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestRegionReplicas&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.regionserver.TestRegionReplicas.testVerifySecondaryAbilityToReadWithOnFiles(TestRegionReplicas.java:421)&lt;br/&gt;
	at org.apache.hadoop.hbase.ResourceCheckerJUnitListener.testFinished(ResourceCheckerJUnitListener.java:183)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11659//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14209485" author="hudson" created="Thu, 13 Nov 2014 08:23:37 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5772 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5772/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5772/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12457&quot; title=&quot;Regions in transition for a long time when CLOSE interleaves with a slow compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12457&quot;&gt;HBASE-12457&lt;/a&gt; Regions in transition for a long time when CLOSE interleaves with a slow compaction. (larsh: rev 231d3ee2adbfc32dfe4f7d7cd7a96ac33968520e)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionIO.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/DefaultCompactor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14209520" author="hudson" created="Thu, 13 Nov 2014 09:11:37 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #674 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/674/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/674/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12457&quot; title=&quot;Regions in transition for a long time when CLOSE interleaves with a slow compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12457&quot;&gt;HBASE-12457&lt;/a&gt; Regions in transition for a long time when CLOSE interleaves with a slow compaction. (larsh: rev 56af34831fc854c177697aefaf80d535996f87e8)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/DefaultCompactor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionIO.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14209531" author="hudson" created="Thu, 13 Nov 2014 09:30:31 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #642 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/642/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/642/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12457&quot; title=&quot;Regions in transition for a long time when CLOSE interleaves with a slow compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12457&quot;&gt;HBASE-12457&lt;/a&gt; Regions in transition for a long time when CLOSE interleaves with a slow compaction. (larsh: rev 56af34831fc854c177697aefaf80d535996f87e8)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionIO.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/DefaultCompactor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14209660" author="dimaspivak" created="Thu, 13 Nov 2014 12:00:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;, this commit looks to be &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/462/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;breaking test-compile on branch-1&lt;/a&gt; and is &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5772/testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;causing 5 tests from TestRegionReplicas to fail on master&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. FWIW, I reran on my local build machines and got the same errors.&lt;/p&gt;</comment>
                            <comment id="14209704" author="ram_krish" created="Thu, 13 Nov 2014 12:47:21 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=larsh&quot; class=&quot;user-hover&quot; rel=&quot;larsh&quot;&gt;larsh&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
writestate.wait(millis);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (millis &amp;gt; 0 &amp;amp;&amp;amp; EnvironmentEdgeManager.currentTime() - start &amp;gt;= millis) {
              &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we waited once &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; compactions to finish, interrupt them, and &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; again
&lt;/span&gt;              &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isDebugEnabled()) {
                LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Waited &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; + millis
                  + &lt;span class=&quot;code-quote&quot;&gt;&quot; ms &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; compactions to finish on close. Interrupting &quot;&lt;/span&gt;
                  + currentCompactions.size() + &lt;span class=&quot;code-quote&quot;&gt;&quot; compactions.&quot;&lt;/span&gt;);
              }
              &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt; t : currentCompactions.keySet()) {
                &lt;span class=&quot;code-comment&quot;&gt;// interrupt any current IO in the currently running compactions.
&lt;/span&gt;                t.interrupt();
              }
              millis = 0;
            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In this code we interrupt all the threads and set the millis = 0.  So again the code goes to the outerloop and will once again wait for writeState.wait(0), expecting notify will happen. But what if by this time all the threads were interrupted and the notifyAll was also called.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;finally&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (wasStateSet) {
          &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (writestate) {
            --writestate.compacting;
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (writestate.compacting &amp;lt;= 0) {
              writestate.notifyAll();
            }
          }
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We will end up in infinite waiting?&lt;br/&gt;
I may be wrong here pls correct me.&lt;/p&gt;</comment>
                            <comment id="14209710" author="ram_krish" created="Thu, 13 Nov 2014 12:52:04 +0000"  >&lt;p&gt;This would solve the compilation issue if am right.&lt;/p&gt;</comment>
                            <comment id="14209924" author="apurtell" created="Thu, 13 Nov 2014 15:46:46 +0000"  >&lt;p&gt;+1 on the addendum for fixing test annotation import paths &lt;/p&gt;</comment>
                            <comment id="14209952" author="apurtell" created="Thu, 13 Nov 2014 16:11:37 +0000"  >&lt;p&gt;I pushed the addendum to branch-1 and master.&lt;/p&gt;</comment>
                            <comment id="14209985" author="apurtell" created="Thu, 13 Nov 2014 16:30:01 +0000"  >&lt;p&gt;I can see a TestRegionReplicas hang. It looks like a minicluster shutdown sequencing problem.&lt;/p&gt;

&lt;p&gt;We are getting hung up on waiting for a HTable thread pool to terminate:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;Thread-2297&quot; prio=10 tid=0x00007feee0d1c800 nid=0x6173 waiting on condition [0x00007fee508c6000]
   java.lang.Thread.State: TIMED_WAITING (parking)
	at sun.misc.Unsafe.park(Native Method)
	- parking to wait for  &amp;lt;0x000000078e04d4c8&amp;gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject)
	at java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:226)
	at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.awaitNanos(AbstractQueuedSynchronizer.java:2082)
	at java.util.concurrent.ThreadPoolExecutor.awaitTermination(ThreadPoolExecutor.java:1468)
	at org.apache.hadoop.hbase.client.HTable.close(HTable.java:1490)
	at org.apache.hadoop.hbase.regionserver.TestRegionReplicas.afterClass(TestRegionReplicas.java:107)
	at org.apache.hadoop.hbase.regionserver.TestRegionReplicas.restartRegionServer(TestRegionReplicas.java:220)
	at org.apache.hadoop.hbase.regionserver.TestRegionReplicas.testVerifySecondaryAbilityToReadWithOnFiles(TestRegionReplicas.java:421)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A worker thread in the HTable thread pool is hung up trying to get table state:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;htable-pool53-t2&quot; daemon prio=10 tid=0x00007feea454c000 nid=0x566e waiting on condition [0x00007feec0365000]
   java.lang.Thread.State: TIMED_WAITING (sleeping)
	at java.lang.Thread.sleep(Native Method)
	at org.apache.hadoop.hbase.client.ConnectionManager$HConnectionImplementation$StubMaker.makeStub(ConnectionManager.java:1487)
	- locked &amp;lt;0x000000078cc03140&amp;gt; (a java.lang.Object)
	at org.apache.hadoop.hbase.client.ConnectionManager$HConnectionImplementation$MasterServiceStubMaker.makeStub(ConnectionManager.java:1522)
	at org.apache.hadoop.hbase.client.ConnectionManager$HConnectionImplementation.getKeepAliveMasterService(ConnectionManager.java:1727)
	- locked &amp;lt;0x000000078cc03140&amp;gt; (a java.lang.Object)
	at org.apache.hadoop.hbase.client.ConnectionManager$HConnectionImplementation.getTableState(ConnectionManager.java:2504)
	at org.apache.hadoop.hbase.client.ConnectionManager$HConnectionImplementation.isTableDisabled(ConnectionManager.java:894)
	at org.apache.hadoop.hbase.client.ConnectionManager$HConnectionImplementation.relocateRegion(ConnectionManager.java:1064)
	at org.apache.hadoop.hbase.client.RpcRetryingCallerWithReadReplicas.getRegionLocations(RpcRetryingCallerWithReadReplicas.java:289)
	at org.apache.hadoop.hbase.client.ScannerCallable.prepare(ScannerCallable.java:135)
	at org.apache.hadoop.hbase.client.RpcRetryingCaller.callWithRetries(RpcRetryingCaller.java:124)
	at org.apache.hadoop.hbase.client.ScannerCallableWithReplicas$RetryingRPC.call(ScannerCallableWithReplicas.java:294)
	at org.apache.hadoop.hbase.client.ScannerCallableWithReplicas$RetryingRPC.call(ScannerCallableWithReplicas.java:275)
	at java.util.concurrent.FutureTask.run(FutureTask.java:262)
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)
	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Not sure how this relates to any compaction changes. At first glance it doesn&apos;t seem to.&lt;/p&gt;

&lt;p&gt;I also see a regionserver trying to send a status report to the master. See below. What these have in common is there is no longer a running master. There are no master threads in the stack dump.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;&quot;RS:0;localhost:54421&quot; prio=10 tid=0x00007feea4549000 nid=0x55a9 waiting on condition [0x00007fee605c3000]
   java.lang.Thread.State: TIMED_WAITING (sleeping)
	at java.lang.Thread.sleep(Native Method)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.sleep(HRegionServer.java:1186)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.createRegionServerStatusStub(HRegionServer.java:2081)
	- locked &amp;lt;0x000000078c6768a8&amp;gt; (a org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.tryRegionServerReport(HRegionServer.java:1074)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:866)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.runRegionServer(MiniHBaseCluster.java:156)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.access$000(MiniHBaseCluster.java:108)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer$1.run(MiniHBaseCluster.java:140)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:356)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1594)
	at org.apache.hadoop.hbase.security.User$SecureHadoopUser.runAs(User.java:277)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.run(MiniHBaseCluster.java:138)
	at java.lang.Thread.run(Thread.java:745)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14210020" author="hudson" created="Thu, 13 Nov 2014 17:09:19 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5773 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5773/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5773/&lt;/a&gt;)&lt;br/&gt;
Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12457&quot; title=&quot;Regions in transition for a long time when CLOSE interleaves with a slow compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12457&quot;&gt;HBASE-12457&lt;/a&gt; Regions in transition for a long time when CLOSE interleaves with a slow compaction; Test import fix (apurtell: rev f6d8cde1e4f67390a936e7bc9f8c70b65a808450)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionIO.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14210036" author="lhofhansl" created="Thu, 13 Nov 2014 17:16:40 +0000"  >&lt;p&gt;Sorry about the build break on branch-1. I cherry-picked the patch. Usually I do a compile and run the relevant tests, but I spaced it this time.&lt;/p&gt;

&lt;p&gt;The hang will not happen since we only notify &lt;b&gt;after&lt;/b&gt; we set writestate.compacting (or writestate.flushing) back to false, so there is no race. I looked at that part &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;In the face of the test failures I am going to roll this back anyway, though.&lt;/p&gt;</comment>
                            <comment id="14210037" author="apurtell" created="Thu, 13 Nov 2014 17:17:24 +0000"  >&lt;p&gt;Well for whatever reason this change does trigger the above condition, due to some kind of timing change, because if I go back two commits, before this patch and the addendum, the test makes progress and completes.&lt;/p&gt;</comment>
                            <comment id="14210038" author="apurtell" created="Thu, 13 Nov 2014 17:18:46 +0000"  >&lt;p&gt;Moving out of .8. Sigh&lt;/p&gt;</comment>
                            <comment id="14210044" author="lhofhansl" created="Thu, 13 Nov 2014 17:22:55 +0000"  >&lt;p&gt;reverted from all branches... sorry about the noise&lt;/p&gt;</comment>
                            <comment id="14210046" author="lhofhansl" created="Thu, 13 Nov 2014 17:24:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;, you mean the test condition, right? Or did you see it hanging specifically on that writestate.wait(...)?&lt;/p&gt;</comment>
                            <comment id="14210054" author="apurtell" created="Thu, 13 Nov 2014 17:28:43 +0000"  >&lt;p&gt;I meant the minicluster shutdown sequencing issue.  Thanks for trying to get this in for .8 Lars.&lt;/p&gt;</comment>
                            <comment id="14210070" author="hudson" created="Thu, 13 Nov 2014 17:46:21 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #463 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/463/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/463/&lt;/a&gt;)&lt;br/&gt;
Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12457&quot; title=&quot;Regions in transition for a long time when CLOSE interleaves with a slow compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12457&quot;&gt;HBASE-12457&lt;/a&gt; Regions in transition for a long time when CLOSE interleaves with a slow compaction; Test import fix (apurtell: rev 9d2ad55cfa6108718d785b5e71ab10e9fb75a988)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionIO.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14210073" author="stack" created="Thu, 13 Nov 2014 17:47:20 +0000"  >&lt;p&gt;Thanks for backing out breaking change promptly.  Feel free to retry given you are watching the build results.&lt;/p&gt;</comment>
                            <comment id="14210159" author="hudson" created="Thu, 13 Nov 2014 19:02:21 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.0 #464 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/464/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/464/&lt;/a&gt;)&lt;br/&gt;
Revert &quot;Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12457&quot; title=&quot;Regions in transition for a long time when CLOSE interleaves with a slow compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12457&quot;&gt;HBASE-12457&lt;/a&gt; Regions in transition for a long time when CLOSE interleaves with a slow compaction; Test import fix&quot; (larsh: rev 880c7c35fc50f28ec3e072a4c62a348fc964e9e0)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionIO.java&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12457&quot; title=&quot;Regions in transition for a long time when CLOSE interleaves with a slow compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12457&quot;&gt;HBASE-12457&lt;/a&gt; Regions in transition for a long time when CLOSE interleaves with a slow compaction.&quot; (larsh: rev 1861f9ce25bc8609629928a670fdf3566486ca25)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionIO.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/DefaultCompactor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14210160" author="hudson" created="Thu, 13 Nov 2014 19:02:54 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98 #675 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/675/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/675/&lt;/a&gt;)&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12457&quot; title=&quot;Regions in transition for a long time when CLOSE interleaves with a slow compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12457&quot;&gt;HBASE-12457&lt;/a&gt; Regions in transition for a long time when CLOSE interleaves with a slow compaction.&quot; (larsh: rev 7f5f1570ce83c62ce9408701677994415b127b36)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionIO.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/DefaultCompactor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14210184" author="hudson" created="Thu, 13 Nov 2014 19:18:52 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #5774 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5774/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5774/&lt;/a&gt;)&lt;br/&gt;
Revert &quot;Amend &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12457&quot; title=&quot;Regions in transition for a long time when CLOSE interleaves with a slow compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12457&quot;&gt;HBASE-12457&lt;/a&gt; Regions in transition for a long time when CLOSE interleaves with a slow compaction; Test import fix&quot; (larsh: rev 9d634772fa12e16b86b0218802b2e38cacdfd528)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionIO.java&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12457&quot; title=&quot;Regions in transition for a long time when CLOSE interleaves with a slow compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12457&quot;&gt;HBASE-12457&lt;/a&gt; Regions in transition for a long time when CLOSE interleaves with a slow compaction.&quot; (larsh: rev c29318c038f0f310562dc8194506b504eae72c1b)&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/DefaultCompactor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionIO.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14211269" author="hudson" created="Thu, 13 Nov 2014 20:42:19 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98-on-Hadoop-1.1 #643 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/643/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/643/&lt;/a&gt;)&lt;br/&gt;
Revert &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12457&quot; title=&quot;Regions in transition for a long time when CLOSE interleaves with a slow compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12457&quot;&gt;HBASE-12457&lt;/a&gt; Regions in transition for a long time when CLOSE interleaves with a slow compaction.&quot; (larsh: rev 7f5f1570ce83c62ce9408701677994415b127b36)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/DefaultCompactor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactionIO.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14211809" author="lhofhansl" created="Fri, 14 Nov 2014 04:25:32 +0000"  >&lt;p&gt;OK... What caused TestRegionReplicas to hang was the change that moved &lt;tt&gt;this.parent.writestate.writesEnabled = true;&lt;/tt&gt; from SplitTransaction to HRegion.initializeRegionInternals.&lt;/p&gt;

&lt;p&gt;That part is not needed anyway, it just looked like it would be more correct. Here&apos;s a patch for trunk that does passes TestRegionReplicas.&lt;/p&gt;</comment>
                            <comment id="14211906" author="hadoopqa" created="Fri, 14 Nov 2014 06:12:17 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12681485/12457-trunk-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12681485/12457-trunk-v3.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12681485&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 3787 checkstyle errors (more than the trunk&apos;s current 3786 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.coprocessor.TestMasterObserver.testRegionTransitionOperations(TestMasterObserver.java:1488)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-rest.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/newPatchFindbugsWarningshbase-annotations.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/11673//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14232329" author="lhofhansl" created="Wed, 3 Dec 2014 00:08:04 +0000"  >&lt;p&gt;In order for this to work we actually need the DFS write side to be interruptable, which is currently it is not.&lt;/p&gt;</comment>
                            <comment id="14240232" author="apurtell" created="Tue, 9 Dec 2014 22:58:34 +0000"  >&lt;p&gt;Unscheduling from all but trunk. We might someday have an interruptible DFS version available for use there.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12681141" name="12457-combined-0.98-v2.txt" size="12747" author="lhofhansl" created="Wed, 12 Nov 2014 21:12:46 +0000"/>
                            <attachment id="12680997" name="12457-combined-0.98.txt" size="11677" author="lhofhansl" created="Wed, 12 Nov 2014 04:52:23 +0000"/>
                            <attachment id="12681251" name="12457-combined-trunk.txt" size="13031" author="lhofhansl" created="Thu, 13 Nov 2014 05:11:12 +0000"/>
                            <attachment id="12680749" name="12457-minifix.txt" size="1347" author="lhofhansl" created="Tue, 11 Nov 2014 06:19:41 +0000"/>
                            <attachment id="12681485" name="12457-trunk-v3.txt" size="12426" author="lhofhansl" created="Fri, 14 Nov 2014 04:26:41 +0000"/>
                            <attachment id="12680949" name="12457.interrupt-v2.txt" size="7292" author="lhofhansl" created="Wed, 12 Nov 2014 00:11:48 +0000"/>
                            <attachment id="12680885" name="12457.interrupt.txt" size="2725" author="lhofhansl" created="Tue, 11 Nov 2014 21:34:30 +0000"/>
                            <attachment id="12681269" name="HBASE-12457.patch" size="14293" author="apurtell" created="Thu, 13 Nov 2014 06:21:55 +0000"/>
                            <attachment id="12681327" name="HBASE-12457_addendum.patch" size="989" author="ram_krish" created="Thu, 13 Nov 2014 12:52:04 +0000"/>
                            <attachment id="12681356" name="TestRegionReplicas-jstack.txt" size="124754" author="apurtell" created="Thu, 13 Nov 2014 16:40:27 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Nov 2014 19:27:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 1 week, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i227yn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>