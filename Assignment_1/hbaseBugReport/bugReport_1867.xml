<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:57:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1867/HBASE-1867.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1867] Tool to regenerate an hbase table from the data files</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1867</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The purpose of this JIRA is provide a place to coordinate the development of a utility that will regenerate an hbase table from the data files.&lt;/p&gt;

&lt;p&gt;Here are some comments from stack on this subject from the hbase-user mailing list:&lt;/p&gt;

&lt;p&gt;Well, in the bin directory, there are scripts that do various things with&lt;br/&gt;
the .META. (copy a table, move a table, load a table whose source is hfiles&lt;br/&gt;
written by a mapreduce job; i.e. hbase-48).&lt;/p&gt;

&lt;p&gt;So, to &apos;regenerate an hbase table from the data files&apos;, you&apos;d need to do&lt;br/&gt;
something like the following:&lt;/p&gt;

&lt;p&gt;+ delete all exisiting table references from .META.&lt;br/&gt;
+ move the backuped up table into position under hbase.rootdir&lt;br/&gt;
+ per region under hbase.rootdir, add an entry to .META.  Do this by opening&lt;br/&gt;
the .regioninfo file.  Its content is needed to generate the rowid for&lt;br/&gt;
.META. and its value becomes the info:regioninfo cell value.&lt;/p&gt;

&lt;p&gt;HBase does not need to be down.  On next .META. scan, the newly added&lt;br/&gt;
regions will be noticed. They won&apos;t have associated info:server and&lt;br/&gt;
info:startcode entries so master will go ahead and assign them and  you&lt;br/&gt;
should be up and running.&lt;/p&gt;

&lt;p&gt;Code-wise, a study of copy_table.rb (this uses old api ... needs updating&lt;br/&gt;
but the concepts are the same) and loadtable.rb would probably be fruitful.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12436554">HBASE-1867</key>
            <summary>Tool to regenerate an hbase table from the data files</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="elsif">elsif </reporter>
                        <labels>
                    </labels>
                <created>Thu, 24 Sep 2009 23:49:42 +0000</created>
                <updated>Fri, 12 Oct 2012 06:13:24 +0000</updated>
                            <resolved>Mon, 9 Nov 2009 15:47:06 +0000</resolved>
                                    <version>0.20.0</version>
                                    <fixVersion>0.20.2</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                    <component>util</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="12759329" author="sjcloud22" created="Thu, 24 Sep 2009 23:52:35 +0000"  >&lt;p&gt;Thanks Elsif for creating this JIRA&lt;/p&gt;</comment>
                            <comment id="12759338" author="stack" created="Fri, 25 Sep 2009 00:21:35 +0000"  >&lt;p&gt;So, for this script... what will we pass it?  The location of a table in hdfs?  This table could be under hbase.rootdir or elsewhere.  If elsewhere, the script would also do the move into place?&lt;/p&gt;

&lt;p&gt;If there is already a table under /hbase of same name... script could move it aside.&lt;/p&gt;</comment>
                            <comment id="12759354" author="elsif" created="Fri, 25 Sep 2009 01:31:16 +0000"  >&lt;p&gt;The input arguments would be the hdfs path and optionally a new name for the table:&lt;/p&gt;

&lt;p&gt;    regenerate_table.rb HDFS_URL &lt;span class=&quot;error&quot;&gt;&amp;#91;TABLE_NAME&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;If the table already exists the user would be prompted for instructions to move the table aside, remove it, or cancel the operation.  &lt;/p&gt;</comment>
                            <comment id="12759376" author="stack" created="Fri, 25 Sep 2009 05:05:17 +0000"  >&lt;p&gt;Above is fine except the bit about users being prompted for instructions to move the table aside.. .how about we just move it aside and tell user we did it rather than do user interaction messing in script&lt;/p&gt;</comment>
                            <comment id="12759397" author="stack" created="Fri, 25 Sep 2009 06:10:26 +0000"  >&lt;p&gt;Here&apos;s a start.  Reads in args., sets up filesystem, moves aside extant table directory, moves into place pointed to directory.   Untested.  Still a bunch to do.  (If someone wants to take over, be my guest).&lt;/p&gt;</comment>
                            <comment id="12760418" author="stack" created="Mon, 28 Sep 2009 22:26:23 +0000"  >&lt;p&gt;Here&apos;s a first cut.  Needs a bit of testing.  Seems to work fine on small table of ten regions IFF the passed directory is a copied-aside table.  Does not yet work with the passing of arbitrary table name (Needs a bit of messy reconstructing of HTableDescriptor with new name then renaming of region directory with recalcuation of region encoded name).&lt;/p&gt;</comment>
                            <comment id="12761478" author="pipoket" created="Fri, 2 Oct 2009 05:36:22 +0000"  >&lt;p&gt;Your script worked perfectly with the HBase cluster with 4 running machines having 1011 regions.&lt;br/&gt;
I used your script because our .META. region evaporated for some unknown reason.&lt;br/&gt;
FYI, each server has 5GB memory and intel quad core CPU.&lt;/p&gt;

&lt;p&gt;But sometimes I was not able to run the script because the errors happened.&lt;br/&gt;
So I`m going to give you all the process that I took to make the script work.&lt;/p&gt;

&lt;p&gt;1. Our table had the structure on HDFS like this.&lt;br/&gt;
/hbase/TABLENAME&lt;/p&gt;

&lt;p&gt;2. So I moved hbase to hbase_backup&lt;br/&gt;
/hbase_backup/TABLENAME&lt;/p&gt;

&lt;p&gt;3. And then started hbase so the broken .META. table would regenerate cleanly. After starting hbase,&lt;br/&gt;
/hbase/&lt;br/&gt;
/hbase_backup/TABLENAME&lt;/p&gt;

&lt;p&gt;4. And then I ran the script like this&lt;br/&gt;
bin/hbase org.jruby.Main add_table.rb hdfs://our.server.addr:port/hbase_backup/TABLENAME&lt;br/&gt;
Then I got the error from line 105, statuses were &quot;nil&quot; objects. Unable to iterate nil objects.&lt;/p&gt;

&lt;p&gt;5. I`m not familiar to ruby but python, so I think it was impossible to iterate through None objects.&lt;br/&gt;
I printed the tableDir with LOG.info(tableDir.toString()) and I got following.&lt;br/&gt;
our.server.addr:port/hbase_backup/TABLENAME&lt;/p&gt;

&lt;p&gt;6. So, I tried to copy the hbase_backup/TABLENAME to hbase/TABLENAME like following&lt;br/&gt;
bin/hadoop dfs -cp hbase_backup/TABLENAME hbase/TABLENAME&lt;/p&gt;

&lt;p&gt;7. After a long time, copy process finished. And I tried to run the script again with following command.&lt;br/&gt;
bin/hbase org.jruby.Main add_table.rb hdfs://our.server.addr:port/hbase/TABLENAME&lt;br/&gt;
And it worked without any error or problem and all the regions were restored!&lt;/p&gt;

&lt;p&gt;I hope this usage information helps your code improved.&lt;br/&gt;
Thanks for fabulous script!&lt;/p&gt;</comment>
                            <comment id="12761549" author="stack" created="Fri, 2 Oct 2009 11:34:58 +0000"  >&lt;p&gt;@wooksuh Thanks for the report.  Let me try with table in a different location.  It must be something to do w/ qualified names in hdfs.  Let me figure it.  Also, can we figure what happened to your .META. table?  This is 0.20.0 hbase?  Enable DEBUG log level in case it happens again.&lt;/p&gt;</comment>
                            <comment id="12761551" author="stack" created="Fri, 2 Oct 2009 11:36:03 +0000"  >&lt;p&gt;Fix the wooksuh issue for 0.20.1&lt;/p&gt;</comment>
                            <comment id="12761567" author="pipoket" created="Fri, 2 Oct 2009 13:05:08 +0000"  >&lt;p&gt;@stack&lt;br/&gt;
Yes, I`m using the 0.20.0 version of HBase with 0.20.0 version of Hadoop.&lt;br/&gt;
I`m going to enable the DEBUG log level as I witnessed the .META. table problem several times.&lt;br/&gt;
I`ll give my feedback when the problem happens to the mailing-list with the log attached.&lt;br/&gt;
Thanks!&lt;/p&gt;</comment>
                            <comment id="12761614" author="stack" created="Fri, 2 Oct 2009 15:14:54 +0000"  >&lt;p&gt;This should fix the issue you were seeing... &lt;/p&gt;</comment>
                            <comment id="12762433" author="stack" created="Mon, 5 Oct 2009 22:43:31 +0000"  >&lt;p&gt;This doesn&apos;t have to be in 0.20.1.  We can point anyone who needs this script to this issue.  Moving it out.&lt;/p&gt;</comment>
                            <comment id="12762670" author="pipoket" created="Tue, 6 Oct 2009 15:57:00 +0000"  >&lt;p&gt;Cool! You are definitely thrilling me! &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I will test your fixed version when it`s possible and give here a feedback.&lt;/p&gt;

&lt;p&gt;I also trying to catch the .META. table problem, but that error no more happens for since last problem.&lt;br/&gt;
What a very typical characteristic of bug.. When you need it happen, it never happens. When you don`t, it happens &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12775004" author="stack" created="Mon, 9 Nov 2009 15:47:06 +0000"  >&lt;p&gt;Added this script.  Its of general utility.&lt;/p&gt;</comment>
                            <comment id="12866459" author="jcuzens" created="Wed, 12 May 2010 04:09:48 +0000"  >&lt;p&gt;Just wanted to comment. I had run an alter on my HBase table and I think that this doesn&apos;t modify the .regioninfo files in each HRegion.&lt;/p&gt;

&lt;p&gt;The add_table.rb uses the .regioninfo files in order to try to rebuild the .META. table and if these aren&apos;t modified by an alter (even with a major_compact) it won&apos;t restore as you would expect.&lt;/p&gt;</comment>
                            <comment id="12866462" author="jcuzens" created="Wed, 12 May 2010 04:17:24 +0000"  >&lt;p&gt;Attaching this issue which describes the problem with altering a table and using add_table.rb.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12384791">HBASE-7</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12459997">HBASE-2366</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12421114" name="add_table.rb" size="4253" author="stack" created="Fri, 2 Oct 2009 15:14:54 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Sep 2009 23:52:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32296</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 32 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08s3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49154</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>