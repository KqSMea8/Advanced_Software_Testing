<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:46:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7521/HBASE-7521.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7521] fix HBASE-6060 (regions stuck in opening state) in 0.94</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7521</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt; implies that the fix there does not work on 0.94. Still, we may want to fix the issue in 0.94 (via some different fix) because the regions stuck in opening for ridiculous amounts of time is not a good thing to have.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12626695">HBASE-7521</key>
            <summary>fix HBASE-6060 (regions stuck in opening state) in 0.94</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sershe">Sergey Shelukhin</assignee>
                                    <reporter username="sershe">Sergey Shelukhin</reporter>
                        <labels>
                    </labels>
                <created>Wed, 9 Jan 2013 01:51:01 +0000</created>
                <updated>Fri, 5 Apr 2013 01:00:52 +0000</updated>
                            <resolved>Tue, 12 Feb 2013 21:33:54 +0000</resolved>
                                                    <fixVersion>0.94.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="13547564" author="sershe" created="Wed, 9 Jan 2013 02:45:28 +0000"  >&lt;p&gt;I have a patch, let me run it on cluster and post if it works...&lt;/p&gt;</comment>
                            <comment id="13549095" author="sershe" created="Wed, 9 Jan 2013 22:20:46 +0000"  >&lt;p&gt;Here&apos;s the patch. In artifically created scenario (move region to server and kill it) it recovers the region successfully.&lt;/p&gt;</comment>
                            <comment id="13549097" author="sershe" created="Wed, 9 Jan 2013 22:21:58 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkeywal&quot; class=&quot;user-hover&quot; rel=&quot;nkeywal&quot;&gt;Nicolas Liochon&lt;/a&gt; Hi. Do I understand correctly that you are the AssignmentManager expert? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13549099" author="hadoopqa" created="Wed, 9 Jan 2013 22:22:48 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12564045/HBASE-7521-v0.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12564045/HBASE-7521-v0.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3954//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3954//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13549117" author="yuzhihong@gmail.com" created="Wed, 9 Jan 2013 22:32:00 +0000"  >&lt;p&gt;Can you add tests ?&lt;br/&gt;
Take a look at testAssignThroughBalancerOrFailedOpenAndSSHInParallel and testSSHWhenSourceRSandDestRSInRegionPlanGoneDown in &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12530962/6060-trunk_3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12530962/6060-trunk_3.patch&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13549266" author="sershe" created="Thu, 10 Jan 2013 01:19:52 +0000"  >&lt;p&gt;Copied one of the tests in modified form.&lt;br/&gt;
The other test seems to be for a different bug specific to 0.94 (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5816&quot; title=&quot;Balancer and ServerShutdownHandler concurrently reassign the same region&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5816&quot;&gt;&lt;del&gt;HBASE-5816&lt;/del&gt;&lt;/a&gt;) that I do not address here.&lt;br/&gt;
The patch only hijacks regions in pending-open/opening, so as far as I see it should be no less safe than having the timeout callback hijack them (because balancer will not balance these regions as they are not assigned to any server, there&apos;s no potential for conflict with it).&lt;/p&gt;</comment>
                            <comment id="13549273" author="hadoopqa" created="Thu, 10 Jan 2013 01:32:49 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12564078/HBASE-7521-v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12564078/HBASE-7521-v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3955//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3955//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13549343" author="ram_krish" created="Thu, 10 Jan 2013 03:52:22 +0000"  >&lt;p&gt;@Sergey&lt;br/&gt;
Before going thro the patch, just wanted to tell one thing that, the initial patches in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt; was something which could be directly applied on 0.94.  But due to discussions about the usage of RegionPlans and RITs, decided to go with some new approach for the trunk version.  Anyway i will go thro this patch today and let you know. Thanks Sergey.&lt;br/&gt;
And surely this needs to  be fixed in 0.94 and 0.92.  Otherwise this is a major open area in AM in these branches.&lt;/p&gt;</comment>
                            <comment id="13549809" author="ram_krish" created="Thu, 10 Jan 2013 17:23:05 +0000"  >&lt;p&gt;@Sergey&lt;br/&gt;
I had a glance at the patch.  I think the SSH and the retry logic in assign on seeing an RS is down will lead to race conditions which is handled in the patches in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;~rajesh32&amp;#93;&lt;/span&gt;&lt;br/&gt;
Wanna take a look at this?  I know you have a version of this running in your cluster for 0.94.&lt;/p&gt;</comment>
                            <comment id="13549925" author="sershe" created="Thu, 10 Jan 2013 18:56:33 +0000"  >&lt;p&gt;Can you please elaborate on race conditions? Do you mean &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5816&quot; title=&quot;Balancer and ServerShutdownHandler concurrently reassign the same region&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5816&quot;&gt;&lt;del&gt;HBASE-5816&lt;/del&gt;&lt;/a&gt;?&lt;br/&gt;
As far as I can see this patch preserves existing race conditions but doesn&apos;t add new ones &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Although, my experience with AM is limited, even more so in 94.&lt;/p&gt;

&lt;p&gt;We can try to rebase latest 094 patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt; instead...&lt;/p&gt;</comment>
                            <comment id="13550902" author="rajesh23" created="Fri, 11 Jan 2013 07:02:10 +0000"  >&lt;p&gt;Patch works fine for OPENING(&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt; patches also works fine in this case) but there are issues with PENDING_OPEN.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (RegionState rit : ritsNotYetOnServer) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rit.isPendingOpen() || rit.isOpening()) {
          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Hijacking and reassigning &quot;&lt;/span&gt; + rit.getRegion().getRegionNameAsString() +
            &lt;span class=&quot;code-quote&quot;&gt;&quot; that was on &quot;&lt;/span&gt; + serverName + &lt;span class=&quot;code-quote&quot;&gt;&quot; in &quot;&lt;/span&gt; + rit.getState() + &lt;span class=&quot;code-quote&quot;&gt;&quot; state.&quot;&lt;/span&gt;);
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getAssignmentManager().assign(rit.getRegion(), &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        }
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here if we see region in PENDING_OPEN on dead server we are assigning the region.&lt;br/&gt;
In case of single region assign if we see a server is dead we will retry assign to some other region server.&lt;br/&gt;
Main race condition can happen below as in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5816&quot; title=&quot;Balancer and ServerShutdownHandler concurrently reassign the same region&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5816&quot;&gt;&lt;del&gt;HBASE-5816&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!hijack &amp;amp;&amp;amp; !state.isClosed() &amp;amp;&amp;amp; !state.isOffline()) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!regionAlreadyInTransitionException ) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg = &lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected state : &quot;&lt;/span&gt; + state + &lt;span class=&quot;code-quote&quot;&gt;&quot; .. Cannot transit it to OFFLINE.&quot;&lt;/span&gt;;
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.abort(msg, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalStateException(msg));
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
      } 
      LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected state : &quot;&lt;/span&gt; + state
          + &lt;span class=&quot;code-quote&quot;&gt;&quot; but retrying to assign because RegionAlreadyInTransitionException.&quot;&lt;/span&gt;);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;One more thing is there is a possibility of double assignment also.&lt;/p&gt;

&lt;p&gt;In case of PENDING_OPEN we are not able to decide whether to retry or skip retry(as thinking SSH can handle) becuase there are multiple cases&lt;br/&gt;
-&amp;gt; If RS went down after setting state to PENDING_OPEN, then SSH can assign the region(as for the patch)&lt;br/&gt;
at the same time single assign also retry to assign because send open RPC will fail with connection refused exception&lt;br/&gt;
Lets suppose if we skip the assign retry in case of connection refused exception then there is one problem with this approach.&lt;br/&gt;
scenario is :&lt;br/&gt;
1) got region plan &lt;br/&gt;
2) destination server went down - ssh also processed (here we will see the region in offline state and skip assignment).&lt;br/&gt;
3) change state to PENDING_OPEN&lt;br/&gt;
4) then send open RPC fail with the connection refused exception and we will skip assign.&lt;/p&gt;

&lt;p&gt;-&amp;gt; If we skip the assign in SSH also problem only&lt;br/&gt;
scenario is :&lt;br/&gt;
1) got region plan and region in PENDING_OPEN&lt;br/&gt;
2) just spawned OpenRegionHandler but didnt transition to OPENING&lt;br/&gt;
3) single assign came out as thinking RS is up and it will take care&lt;br/&gt;
4) RS went down&lt;br/&gt;
5) now SSH also will skip the region assignment&lt;/p&gt;
</comment>
                            <comment id="13550914" author="ram_krish" created="Fri, 11 Jan 2013 07:19:28 +0000"  >&lt;p&gt;Thanks Rajesh.&lt;br/&gt;
@Sergey,&lt;br/&gt;
The above condition of assign retry and SSH also trying to assign is what i was mentioning.  Anyway Rajesh has explained with more details.&lt;/p&gt;</comment>
                            <comment id="13551350" author="sershe" created="Fri, 11 Jan 2013 18:24:38 +0000"  >&lt;p&gt;Hmm, I see. For the former, it seems like hijack flag should take care of that as in case with timeout. I&apos;ll look into the 2nd one.&lt;/p&gt;</comment>
                            <comment id="13553255" author="sershe" created="Mon, 14 Jan 2013 23:20:21 +0000"  >&lt;p&gt;Hi. I&apos;ve read the discussion on 6060... can participants please comment if it makes sense to backport final patch (from August) to 0.94?&lt;br/&gt;
The discussion is very long and covers many scenarios, and patch was not committed.&lt;br/&gt;
Does it fix the original issue/is it still relevant?&lt;/p&gt;</comment>
                            <comment id="13553259" author="sershe" created="Mon, 14 Jan 2013 23:21:05 +0000"  >&lt;p&gt;Alternatively I can add multi-assign prevention to cover the 2nd case/similar race conditions.&lt;/p&gt;</comment>
                            <comment id="13554304" author="sershe" created="Tue, 15 Jan 2013 20:43:05 +0000"  >&lt;p&gt;Ping?&lt;/p&gt;</comment>
                            <comment id="13554437" author="devaraj" created="Tue, 15 Jan 2013 22:10:57 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;, can you please post the relevant patch from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt; here to start the discussion from (and make sure it applies, etc.). Thanks!&lt;/p&gt;</comment>
                            <comment id="13554695" author="sershe" created="Wed, 16 Jan 2013 03:09:11 +0000"  >&lt;p&gt;Will try to rebase latest trunk patch from August. I got it around halfway done, looks like a lot changed around AM at that time, will see if it&apos;s viable.&lt;/p&gt;</comment>
                            <comment id="13557868" author="sershe" created="Sat, 19 Jan 2013 02:09:53 +0000"  >&lt;p&gt;Ported the original patch. Some parts needed to be changed but mostly mechanical. Small and some medium (assignment manager, open/close) tests that I tried appear to pass. I will run all tests and report results here&lt;/p&gt;</comment>
                            <comment id="13557875" author="hadoopqa" created="Sat, 19 Jan 2013 02:13:06 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12565619/HBASE-7521-original-patch-ported-v0.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12565619/HBASE-7521-original-patch-ported-v0.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 18 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4097//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4097//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13559233" author="sershe" created="Tue, 22 Jan 2013 00:33:34 +0000"  >&lt;p&gt;mvn tests pass... I&apos;ll try to verify the fix using integration test.&lt;/p&gt;</comment>
                            <comment id="13559265" author="sershe" created="Tue, 22 Jan 2013 01:21:58 +0000"  >&lt;p&gt;Integration test that I tweaked for the purpose appears to pass and picks up the stuck regions, judging by refreshing the master page repeatedly. Code review anyone? Thanks.&lt;/p&gt;</comment>
                            <comment id="13560898" author="ram_krish" created="Wed, 23 Jan 2013 18:16:27 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh23&quot; class=&quot;user-hover&quot; rel=&quot;rajesh23&quot;&gt;rajeshbabu&lt;/a&gt;&lt;br/&gt;
Could you take a look at this patch with the code base that you have.  It will be easy to see if anything is missed out because Sergey has rebased the earlier patches that we had posted that time.&lt;br/&gt;
I wil also have a look at this tomorrow during day time.&lt;/p&gt;</comment>
                            <comment id="13563406" author="ram_krish" created="Sat, 26 Jan 2013 08:48:12 +0000"  >&lt;p&gt;@Sergey&lt;br/&gt;
Went thro the patch.  It seems fine wrt to the changes taken up from the old patch.&lt;br/&gt;
Just after looking into the patch now i feel may be we can rename some variables like regionsFromRIT, regionsIntersection. Is it possible to rename so that the name suggests what they are?&lt;br/&gt;
Overall looks fine.  &lt;br/&gt;
One question is did you see what is the impact on now making the RS to transition the node to OPENING? Thanks Sergey&lt;/p&gt;</comment>
                            <comment id="13564561" author="sershe" created="Mon, 28 Jan 2013 19:13:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;rename some variables like regionsFromRIT, regionsIntersection.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;sure.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;what is the impact on now making the RS to transition the node to OPENING? Thanks Sergey&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can you please clarify?&lt;/p&gt;</comment>
                            <comment id="13564771" author="hadoopqa" created="Mon, 28 Jan 2013 22:32:02 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12566837/HBASE-7521-original-patch-ported-v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12566837/HBASE-7521-original-patch-ported-v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 18 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4219//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4219//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13564860" author="yuzhihong@gmail.com" created="Mon, 28 Jan 2013 23:57:53 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; Pair that has all regionplans that pertain to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; dead server and a list that has
...
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Pair&amp;lt;Set&amp;lt;HRegionInfo&amp;gt;, List&amp;lt;RegionState&amp;gt;&amp;gt; processServerShutdown(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ServerName sn) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Better use term other than regionplan because the Set contains HRegionInfo&apos;s.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @param deadServerRITs Regions that were in transition against the dead server
+   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; List of regions to assign or &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; aborting.
+   * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException
+   */
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; List&amp;lt;HRegionInfo&amp;gt; getRegionsToAssign(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; NavigableMap&amp;lt;HRegionInfo, Result&amp;gt; metaHRIs,
+      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; List&amp;lt;RegionState&amp;gt; deadServerRITs, Set&amp;lt;HRegionInfo&amp;gt; regionsFromRIT) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please add javadoc for the new param - regionsFromRIT.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-comment&quot;&gt;// Collect regions to bulk assign here.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The regions identified by getRegionsToAssign() are not bulk assigned - see line 298.&lt;br/&gt;
The comments below the above should be modified as well.&lt;/p&gt;</comment>
                            <comment id="13565114" author="ram_krish" created="Tue, 29 Jan 2013 06:15:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;what is the impact on now making the RS to transition the node to OPENING? Thanks Sergey&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Now the main RPC thread for asking the RS to open the region is doing an additional work of transitioning then node to OPENING and then calling the OpenRegionHandlerThread.&lt;br/&gt;
This should have an impact right?  &lt;br/&gt;
But the above change is needed if the RS goes down before changing the state to PENDING_OPEN as said in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13565663" author="sershe" created="Tue, 29 Jan 2013 19:10:46 +0000"  >&lt;p&gt;Sorry, what I don&apos;t understand is what you mean by impact? I changes the logic... you mean in a sense of racing with some other code?&lt;/p&gt;</comment>
                            <comment id="13566147" author="ram_krish" created="Wed, 30 Jan 2013 04:11:20 +0000"  >&lt;p&gt;Impact in the sense&lt;br/&gt;
Performance wise if any.&lt;br/&gt;
Any possibility of race conditions.  I remember we were able to cover all.  But did not do intense testing with this code change as we had a slightly modified internal version which is there in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt; as earlier patches.&lt;/p&gt;</comment>
                            <comment id="13566176" author="lhofhansl" created="Wed, 30 Jan 2013 05:26:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt; So you&apos;re proposing the &lt;b&gt;ported&lt;/b&gt; patches?&lt;/p&gt;</comment>
                            <comment id="13566183" author="lhofhansl" created="Wed, 30 Jan 2013 05:34:52 +0000"  >&lt;p&gt;That looks like a hard to verify change (in terms of correctness).&lt;br/&gt;
How are we making sure that this not introducing new problems?&lt;/p&gt;

&lt;p&gt;Seems to me this is a better candidate for the next train (0.94.6)&lt;br/&gt;
But I&apos;m not the decider... If you guys want this in 0.94.5 I think we need to build some confidence that this change is correct.&lt;br/&gt;
At the very least someone should run the entire test suite a few times over night with this patch.&lt;/p&gt;</comment>
                            <comment id="13566187" author="ram_krish" created="Wed, 30 Jan 2013 05:40:30 +0000"  >&lt;p&gt;@Lars&lt;br/&gt;
Personally i feel this fix should go as soon as possible.  Infact this itself is quite a delay knowing that we have a whole in AM in this case.&lt;br/&gt;
So i feel we can get this in this version.&lt;br/&gt;
As suggested surely good testing is needed.  Also i need to add that am not in a situation to do it also.&lt;br/&gt;
Just saying what i feel.&lt;/p&gt;</comment>
                            <comment id="13566203" author="lhofhansl" created="Wed, 30 Jan 2013 06:02:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;, do you guys have some bandwidth to run this through your grindmill?&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; You guys have run a version similar to this (earlier version of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt;) in production?&lt;/p&gt;</comment>
                            <comment id="13566204" author="enis" created="Wed, 30 Jan 2013 06:06:07 +0000"  >&lt;p&gt;Since this original issue &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt; was caught with the integration tests, it is easily reproducible. I think we can at least run those to see that it fixes the problem. Apart from that, I think we can spare some time on running the full tests, and the whole integration test suite tomorrow. &lt;/p&gt;

</comment>
                            <comment id="13566209" author="lhofhansl" created="Wed, 30 Jan 2013 06:14:00 +0000"  >&lt;p&gt;Cool. Maybe I shoot for pulling this in tomorrow evening and cutting the first RC then. Thanks!&lt;/p&gt;</comment>
                            <comment id="13566724" author="sershe" created="Wed, 30 Jan 2013 18:24:21 +0000"  >&lt;p&gt;I&apos;ve run the integration tests to verify... I can run more &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13566948" author="sershe" created="Wed, 30 Jan 2013 21:59:58 +0000"  >&lt;p&gt;Addressed Ted&apos;s feedback, renamed more variables&lt;/p&gt;</comment>
                            <comment id="13566989" author="hadoopqa" created="Wed, 30 Jan 2013 22:21:20 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12567220/HBASE-7521-original-patch-ported-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12567220/HBASE-7521-original-patch-ported-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 18 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4261//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4261//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13567366" author="ram_krish" created="Thu, 31 Jan 2013 05:01:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;You guys have run a version similar to this (earlier version of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt;) in production?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes but i should say it was my previous employer.  It should be still running. &lt;/p&gt;</comment>
                            <comment id="13567403" author="enis" created="Thu, 31 Jan 2013 06:33:21 +0000"  >&lt;p&gt;I have tested 0.94-tip with and without the patch while running IntegrationTestDataIngestWithChaosMonkey, which is CM + LoadTestTool. The cluster was a 3 node EC2 running Hadoop1.0 from HDP. Without the patch, test succeeds in a 5 min run, however with the patch, my 2 attempts failed, with lots of ServerNotRunningYetException, plus Failed to write key: 3282. Also noticed that it took way too long to run the ingest (7500 inserts took ~15 min vs ~1:30 with the patch). &lt;/p&gt;

&lt;p&gt;Overall, the patch looks good from my limited understanding of the AM+SSH code base. Everytime I try to study it, I am running away horrified &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;/p&gt;

&lt;p&gt;One question about the patch is:&lt;br/&gt;
why don&apos;t we do the same thing in HRegionServer.closeRegion() and set the znode in the RPC handler?&lt;/p&gt;

&lt;p&gt;So, if we want to cut 0.94.5 tomorrow, I guess we can&apos;t include this without further testing. &lt;/p&gt;</comment>
                            <comment id="13567435" author="lhofhansl" created="Thu, 31 Jan 2013 07:51:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also noticed that it took way too long to run the ingest (7500 inserts took ~15 min vs ~1:30 with the patch).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;You mean it took 1:30 without the patch?&lt;/p&gt;</comment>
                            <comment id="13567436" author="lhofhansl" created="Thu, 31 Jan 2013 07:51:48 +0000"  >&lt;p&gt;Moving to 0.94.6, we can always pull it back.&lt;/p&gt;</comment>
                            <comment id="13567437" author="lhofhansl" created="Thu, 31 Jan 2013 07:52:09 +0000"  >&lt;p&gt;And thanks for the testing, Enis!&lt;/p&gt;</comment>
                            <comment id="13567888" author="sershe" created="Thu, 31 Jan 2013 18:10:27 +0000"  >&lt;p&gt;What were the CM actions? Given the range of possibilities I wonder if it could be worse things done by CM on 2 last runs.&lt;br/&gt;
When I was running a &quot;consistent&quot; test (...Targeted) I didn&apos;t observe this behavior&lt;/p&gt;</comment>
                            <comment id="13570686" author="sershe" created="Mon, 4 Feb 2013 22:21:30 +0000"  >&lt;p&gt;I am looking into this today btw. I think I may have found a bug.&lt;/p&gt;</comment>
                            <comment id="13570824" author="sershe" created="Tue, 5 Feb 2013 01:11:18 +0000"  >&lt;p&gt;The test passes for me with this small change (NPE in SSH).&lt;/p&gt;</comment>
                            <comment id="13570834" author="hadoopqa" created="Tue, 5 Feb 2013 01:22:11 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12567921/HBASE-7521-original-patch-ported-v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12567921/HBASE-7521-original-patch-ported-v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 18 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4325//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4325//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13570839" author="enis" created="Tue, 5 Feb 2013 01:27:20 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=sershe&quot; class=&quot;user-hover&quot; rel=&quot;sershe&quot;&gt;Sergey Shelukhin&lt;/a&gt;, which test? You mean the unit tests or the integration test on the actual cluster? &lt;/p&gt;</comment>
                            <comment id="13571478" author="sershe" created="Tue, 5 Feb 2013 17:17:52 +0000"  >&lt;p&gt;Integration test on EC2&lt;/p&gt;</comment>
                            <comment id="13572567" author="rajesh23" created="Wed, 6 Feb 2013 16:59:23 +0000"  >&lt;p&gt;Patch looks good.&lt;/p&gt;</comment>
                            <comment id="13572694" author="enis" created="Wed, 6 Feb 2013 19:15:09 +0000"  >&lt;p&gt;Let me test this one more time, then we can commit. &lt;/p&gt;</comment>
                            <comment id="13574693" author="sershe" created="Fri, 8 Feb 2013 18:24:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt; Any update? Thanks!&lt;/p&gt;</comment>
                            <comment id="13574857" author="jxiang" created="Fri, 8 Feb 2013 21:51:30 +0000"  >&lt;p&gt;The patch depends on the region states in the master memory (AM). The issue is that in 0.94, the region states in memory are not reliable, i.e., it could be wrong sometimes due to lack of proper synchronization.  That&apos;s why we didn&apos;t try to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt; in 0.94. However, if the community is ok with the patch, it is fine with me too.&lt;/p&gt;

&lt;p&gt;@Ram, could you take a look at the patch?&lt;/p&gt;</comment>
                            <comment id="13575919" author="ram_krish" created="Mon, 11 Feb 2013 17:31:28 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((state.getServerName() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &amp;amp;&amp;amp; state.getServerName().equals(sn)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This new change has been added because when in OFFLINE state we don&apos;t populate the servername right?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ &lt;span class=&quot;code-quote&quot;&gt;&quot;, which we are already trying to &quot;&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot; ,which we are already trying to &quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This msg is coming twice.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      addRegionsInTransition(region, CLOSE);
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (RegionAlreadyInTransitionException rate) {
      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Received close &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region we are already opening or closing; &quot;&lt;/span&gt;
          + region.getEncodedName());
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can we throw the exception instead of catching it as in openRegion()?&lt;/p&gt;

&lt;p&gt;Rest looks the same.&lt;br/&gt;
@Jimmy&lt;br/&gt;
Prior to your changes in Trunk wrt to AM things were messy.  But i feel that if we get it in atleast the problem addressed by this JIRA is solved.  There may be some issues hiding some where but the issue addressed here is pretty much big.&lt;br/&gt;
Sergey&apos;s integration suite is a good one that tries to catch up many corner cases.  I am +1 on getting this to 0.94.&lt;/p&gt;</comment>
                            <comment id="13575960" author="sershe" created="Mon, 11 Feb 2013 18:52:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;This new change has been added because when in OFFLINE state we don&apos;t populate the servername right?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Can we throw the exception instead of catching it as in openRegion()?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Seems like a normal case (multiple close-s, or close during open)?&lt;/p&gt;</comment>
                            <comment id="13575967" author="yuzhihong@gmail.com" created="Mon, 11 Feb 2013 18:56:47 +0000"  >&lt;p&gt;Patch v4 rebases on latest 0.94&lt;/p&gt;

&lt;p&gt;Addresses Ram&apos;s comment about duplicate message.&lt;/p&gt;</comment>
                            <comment id="13576056" author="sershe" created="Mon, 11 Feb 2013 19:55:00 +0000"  >&lt;p&gt;fixed test issue&lt;/p&gt;</comment>
                            <comment id="13576083" author="jxiang" created="Mon, 11 Feb 2013 20:18:51 +0000"  >&lt;p&gt;@Ram, sure. I am ok with getting this to 0.94. I was just in doubt this will fix all racing issues.  For example, the following code (in #assign) is synchronized on the regionstate.  However, AM#handleRegion is synchronized on regionsInTransition.  Suppose serverManager.sendRegionOpen returns RegionOpeningState.OPENED, but OpenRegionHandler fails to open it and transitions the ZK node to RS_ZK_REGION_FAILED_OPEN, then handleRegion will transition the region state to Closed, right after that, this thread transitions the state back to PENDING_OPEN, which may cause some confusion further down the road.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        RegionOpeningState regionOpenState = serverManager.sendRegionOpen(plan.getDestination(),
+            state.getRegion(), versionOfOfflineNode);
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (regionOpenState == RegionOpeningState.OPENED) {
+          &lt;span class=&quot;code-comment&quot;&gt;// Transition RegionState to PENDING_OPEN
&lt;/span&gt;+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (state.isOffline() &amp;amp;&amp;amp; !state.isOpening()) {
+            state.update(RegionState.State.PENDING_OPEN,
+                &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis(), plan.getDestination());
+          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13576133" author="yuzhihong@gmail.com" created="Mon, 11 Feb 2013 21:17:02 +0000"  >&lt;p&gt;Ran through 0.94 test suite:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Tests run: 1272, Failures: 0, Errors: 0, Skipped: 13

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 46:17.736s
[INFO] Finished at: Mon Feb 11 21:08:22 UTC 2013
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Plan to get the patch in by Friday.&lt;/p&gt;</comment>
                            <comment id="13576326" author="enis" created="Tue, 12 Feb 2013 03:02:32 +0000"  >&lt;p&gt;+1. I&apos;ve been testing this patch for the last half hour or so with IntegrationTestDataIngestWithChaosMonkey, and hbck. It passes the tests most of the time, without running into the previous RIT&apos;s in OPENING state. &lt;/p&gt;</comment>
                            <comment id="13576336" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 03:11:27 +0000"  >&lt;p&gt;So far Ram, Rajesh, Enis and I gave +1 on this issue.&lt;/p&gt;

&lt;p&gt;Plan to integrate tomorrow if there is no objection.&lt;/p&gt;</comment>
                            <comment id="13576352" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 03:54:18 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;:&lt;br/&gt;
It would be nice to get your endorsement.&lt;/p&gt;</comment>
                            <comment id="13576386" author="lhofhansl" created="Tue, 12 Feb 2013 05:11:54 +0000"  >&lt;p&gt;I&apos;m -0 on this change. To me this looks like a pretty hairy change for 0.94.&lt;br/&gt;
That said, if you guys are convinced this is right thing to do, please go ahead and integrate into 0.94.&lt;/p&gt;

&lt;p&gt;I assume this will not prevent a rolling upgrade from 0.94.5 to 0.94.6 (or from 0.92.x to 0.94.6).&lt;/p&gt;</comment>
                            <comment id="13576782" author="ram_krish" created="Tue, 12 Feb 2013 17:05:57 +0000"  >&lt;p&gt;@Sergey&lt;br/&gt;
Do you think any problem with rolling restart with this?  &lt;br/&gt;
I don&apos;t have experience with rolling restart.  Also seeing the changes it does not introduce new states nor changes the order of the states.&lt;br/&gt;
@Jimmy&lt;br/&gt;
I agree that there may be some cases hidden.  We still see in user mail list people saying Regions are in transition and they are not sure how to get around it.&lt;br/&gt;
Atleast this patch solves the obvious cases if region in OPENING state.  &lt;br/&gt;
Jimmy, do you think this will affect rolling restart?  &lt;br/&gt;
@Stack&lt;br/&gt;
What do you think before we integrate to 0.94?&lt;/p&gt;</comment>
                            <comment id="13576819" author="stack" created="Tue, 12 Feb 2013 17:45:57 +0000"  >&lt;p&gt;What do I think?  This is a big change in AM internals.  I see Enis has tested it above but it only passes &quot;most of the time&quot;.  Any chance of some more testing before it gets committed?&lt;/p&gt;</comment>
                            <comment id="13576857" author="sershe" created="Tue, 12 Feb 2013 18:22:19 +0000"  >&lt;p&gt;Why should there be problem with rolling restart in particular, as opposed to regular restart?&lt;br/&gt;
I tested with regular restart and it appeared to be normal, although integration tests on 94 are not very stable to begin with.&lt;/p&gt;

&lt;p&gt;Alternatively, we can consider improving on the simpler patch I submitted (it fixes only specific issue in this JIRA, not the other one; but it&apos;s straightforward and as far as I was told there&apos;s only one (existing) race to fix to make it work, between retry and immediate reassignment).&lt;/p&gt;</comment>
                            <comment id="13576888" author="jxiang" created="Tue, 12 Feb 2013 18:56:48 +0000"  >&lt;p&gt;This patch removed a method from RegionServerServices.  If some coprocessor happens to use it, it will be broken. It also added two new methods to this class.  Other than that, I don&apos;t see other rolling restart/compatibility issue.  However, the chance for a coprocessor to use these methods are very low.&lt;/p&gt;</comment>
                            <comment id="13576890" author="enis" created="Tue, 12 Feb 2013 18:57:29 +0000"  >&lt;blockquote&gt;&lt;p&gt;but it only passes &quot;most of the time&quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sorry I should have been more clear. The integration test actually does not pass all the time, because of other problems, not directly related to region assignment. We are running out of retries and giving up on write&apos;s. I should inspect more and create issues for that. Without the patch, the integration test does not even complete half the time because of the RITs in OPENING state. &lt;/p&gt;</comment>
                            <comment id="13576896" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 19:03:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;This patch removed a method from RegionServerServices.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I noticed this too.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Map&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[], &lt;span class=&quot;code-object&quot;&gt;Boolean&lt;/span&gt;&amp;gt; getRegionsInTransitionInRS();
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; removeFromRegionsInTransition(HRegionInfo hri);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;getRegionsInTransitionInRS() is supposed to be internal (from trunk):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@InterfaceAudience.Private
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; RegionServerServices &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; OnlineRegions {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13576902" author="lhofhansl" created="Tue, 12 Feb 2013 19:10:56 +0000"  >&lt;p&gt;I specifically meant a rolling upgrade where some servers might still run 0.94.x (or even 0.92.x) and some will run 0.94.6.&lt;br/&gt;
The coprocessor bit is fine I think (we didn&apos;t say we&apos;ll keep the internal APIs stable).&lt;/p&gt;

&lt;p&gt;Again, I&apos;m not the decider. If you think this is an important fix and there reasonable confidence that this won&apos;t introduce any bad side-effects then please integrate.&lt;/p&gt;</comment>
                            <comment id="13576914" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 19:24:24 +0000"  >&lt;p&gt;I would vote for this patch to go in.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt; was opened about 9 months ago. We should address this issue.&lt;/p&gt;</comment>
                            <comment id="13576955" author="lhofhansl" created="Tue, 12 Feb 2013 19:58:48 +0000"  >&lt;p&gt;There are already enough +1&apos;s to commit.&lt;/p&gt;</comment>
                            <comment id="13576995" author="yuzhihong@gmail.com" created="Tue, 12 Feb 2013 20:47:24 +0000"  >&lt;p&gt;Integrated to 0.94&lt;/p&gt;

&lt;p&gt;Thanks for the patch, Sergey.&lt;/p&gt;

&lt;p&gt;Thanks for the reviews, Stack, Lars, Ram, Rajesh and Enis.&lt;/p&gt;</comment>
                            <comment id="13577005" author="hudson" created="Tue, 12 Feb 2013 20:57:30 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #839 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/839/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/839/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7521&quot; title=&quot;fix HBASE-6060 (regions stuck in opening state) in 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7521&quot;&gt;&lt;del&gt;HBASE-7521&lt;/del&gt;&lt;/a&gt; fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt; (regions stuck in opening state) in 0.94 (Sergey and Rajeshbabu) (Revision 1445350)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/Mocking.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedOpenCloseRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/handler/TestCloseRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/handler/TestOpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13577167" author="hudson" created="Tue, 12 Feb 2013 23:32:27 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #110 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/110/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/110/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7521&quot; title=&quot;fix HBASE-6060 (regions stuck in opening state) in 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7521&quot;&gt;&lt;del&gt;HBASE-7521&lt;/del&gt;&lt;/a&gt; fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt; (regions stuck in opening state) in 0.94 (Sergey and Rajeshbabu) (Revision 1445350)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/Mocking.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedOpenCloseRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/handler/TestCloseRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/handler/TestOpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13593164" author="hudson" created="Tue, 5 Mar 2013 07:52:10 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #12 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/12/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/12/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7521&quot; title=&quot;fix HBASE-6060 (regions stuck in opening state) in 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7521&quot;&gt;&lt;del&gt;HBASE-7521&lt;/del&gt;&lt;/a&gt; fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6060&quot; title=&quot;Regions&amp;#39;s in OPENING state from failed regionservers takes a long time to recover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6060&quot;&gt;&lt;del&gt;HBASE-6060&lt;/del&gt;&lt;/a&gt; (regions stuck in opening state) in 0.94 (Sergey and Rajeshbabu) (Revision 1445350)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/Mocking.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestZKBasedOpenCloseRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/handler/TestCloseRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/handler/TestOpenRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13602060" author="hudson" created="Thu, 14 Mar 2013 05:51:55 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #898 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/898/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/898/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8040&quot; title=&quot;Race condition in AM after HBASE-7521 (only 0.94)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8040&quot;&gt;&lt;del&gt;HBASE-8040&lt;/del&gt;&lt;/a&gt; - Race condition in AM after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7521&quot; title=&quot;fix HBASE-6060 (regions stuck in opening state) in 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7521&quot;&gt;&lt;del&gt;HBASE-7521&lt;/del&gt;&lt;/a&gt; (only 0.94) (Ram) (Revision 1456310)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13603035" author="sershe" created="Fri, 15 Mar 2013 02:37:22 +0000"  >&lt;p&gt;Hi. Quick check: what (if anything at all) prevents a race condition in this patch as is, if some server A dies, we start assigning the region from it to other server Band that server also dies (or, worse yet, it died before and now restarted, and we process the SSH just now).&lt;br/&gt;
Wouldn&apos;t it cause double assign - first time assign of &quot;resident&quot; region from A, then &quot;incoming&quot; region of B?&lt;/p&gt;</comment>
                            <comment id="13603094" author="hudson" created="Fri, 15 Mar 2013 03:52:03 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #124 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/124/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/124/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8040&quot; title=&quot;Race condition in AM after HBASE-7521 (only 0.94)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8040&quot;&gt;&lt;del&gt;HBASE-8040&lt;/del&gt;&lt;/a&gt; - Race condition in AM after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7521&quot; title=&quot;fix HBASE-6060 (regions stuck in opening state) in 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7521&quot;&gt;&lt;del&gt;HBASE-7521&lt;/del&gt;&lt;/a&gt; (only 0.94) (Ram) (Revision 1456310)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13623169" author="hudson" created="Fri, 5 Apr 2013 01:00:52 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #13 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/13/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/13/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8040&quot; title=&quot;Race condition in AM after HBASE-7521 (only 0.94)&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8040&quot;&gt;&lt;del&gt;HBASE-8040&lt;/del&gt;&lt;/a&gt; - Race condition in AM after &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7521&quot; title=&quot;fix HBASE-6060 (regions stuck in opening state) in 0.94&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7521&quot;&gt;&lt;del&gt;HBASE-7521&lt;/del&gt;&lt;/a&gt; (only 0.94) (Ram) (Revision 1456310)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/handler/OpenRegionHandler.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12568862" name="7521-original-patch-ported-v4.patch" size="60465" author="yuzhihong@gmail.com" created="Mon, 11 Feb 2013 18:56:47 +0000"/>
                            <attachment id="12565619" name="HBASE-7521-original-patch-ported-v0.patch" size="59493" author="sershe" created="Sat, 19 Jan 2013 02:09:53 +0000"/>
                            <attachment id="12566837" name="HBASE-7521-original-patch-ported-v1.patch" size="59482" author="sershe" created="Mon, 28 Jan 2013 22:27:58 +0000"/>
                            <attachment id="12567220" name="HBASE-7521-original-patch-ported-v2.patch" size="59492" author="sershe" created="Wed, 30 Jan 2013 21:59:58 +0000"/>
                            <attachment id="12567921" name="HBASE-7521-original-patch-ported-v3.patch" size="59527" author="sershe" created="Tue, 5 Feb 2013 01:11:18 +0000"/>
                            <attachment id="12564045" name="HBASE-7521-v0.patch" size="6558" author="sershe" created="Wed, 9 Jan 2013 22:20:46 +0000"/>
                            <attachment id="12564078" name="HBASE-7521-v1.patch" size="12114" author="sershe" created="Thu, 10 Jan 2013 01:21:53 +0000"/>
                            <attachment id="12568875" name="HBASE-7521-v5.patch" size="63458" author="sershe" created="Mon, 11 Feb 2013 19:55:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>8.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 9 Jan 2013 22:22:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>303303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i179bb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>250477</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>