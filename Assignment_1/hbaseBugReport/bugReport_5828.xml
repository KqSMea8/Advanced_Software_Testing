<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:31:18 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5828/HBASE-5828.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5828] TestLogRolling fails in 0.90 branch killing the test suite up on jenkins</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5828</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;See recent 0.90 builds up on jenkins: &lt;a href=&quot;https://builds.apache.org/view/G-L/view/HBase/job/hbase-0.90/471/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/G-L/view/HBase/job/hbase-0.90/471/console&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12551575">HBASE-5828</key>
            <summary>TestLogRolling fails in 0.90 branch killing the test suite up on jenkins</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="xufeng">xufeng</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 19 Apr 2012 04:52:15 +0000</created>
                <updated>Wed, 7 Jan 2015 14:53:42 +0000</updated>
                            <resolved>Wed, 7 Jan 2015 14:53:42 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13269543" author="xufeng" created="Mon, 7 May 2012 11:43:50 +0000"  >&lt;p&gt;I just review the code and have a speculation about this issue:&lt;br/&gt;
If the region of META table assigned on regionserver_A.&lt;br/&gt;
The region of user table assigned on regionserver_B.&lt;/p&gt;

&lt;p&gt;At first,the pipeline of regionserver_A and regionserver_B have the same datanodes.&lt;br/&gt;
The testcase testLogRollOnDatanodeDeath will kill the all datanodes in pipeline which belongs to the hlog writer of regionserver_B.&lt;/p&gt;

&lt;p&gt;When the testcase testLogRollOnPipelineRestart to deleteTale,it will update the META data.&lt;br/&gt;
Because the datanodes in pipeline of regionserver_A have been stoped,So it will fail.&lt;/p&gt;

&lt;p&gt;Test will wait in HBaseAdmin#deletaTable() until retries exhausted.&lt;br/&gt;
After long time this test will be killed.&lt;/p&gt;</comment>
                            <comment id="13270158" author="xufeng" created="Tue, 8 May 2012 03:34:18 +0000"  >&lt;p&gt;I added some debug log and reproduce it in my test env,I got the error that the TestLogRolling be killed.&lt;br/&gt;
1.The region assignment info:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;	Line 227: 2012-05-08 10:33:46,705 INFO  [MASTER_OPEN_REGION-HADOOP-CI-AGENT-A:56223-0] handler.OpenedRegionHandler(137): The master has opened the region -ROOT-,,0.70236052 that was online on serverName=HADOOP-CI-AGENT-A,36476,1336444420154, load=(requests=0, regions=0, usedHeap=49, maxHeap=1348)
	Line 288: 2012-05-08 10:33:46,797 INFO  [MASTER_OPEN_REGION-HADOOP-CI-AGENT-A:56223-1] handler.OpenedRegionHandler(137): The master has opened the region .META.,,1.1028785192 that was online on serverName=HADOOP-CI-AGENT-A,36476,1336444420154, load=(requests=0, regions=0, usedHeap=49, maxHeap=1348)
	Line 505: 2012-05-08 10:33:57,224 DEBUG [MASTER_OPEN_REGION-HADOOP-CI-AGENT-A:56223-2] handler.OpenedRegionHandler(139): The master has opened the region TestLogRolling,,1336444436745.7365edcbf8a8a078ce2c04f08a08e021. that was online on serverName=HADOOP-CI-AGENT-A,59995,1336444420124, load=(requests=0, regions=0, usedHeap=50, maxHeap=1348)
	Line 8497: 2012-05-08 10:34:47,678 DEBUG [MASTER_OPEN_REGION-HADOOP-CI-AGENT-A:56223-3] handler.OpenedRegionHandler(139): The master has opened the region TestLogRolling,,1336444487331.d0ba082226efdac56a16272b51d1147d. that was online on serverName=HADOOP-CI-AGENT-A,59995,1336444420124, load=(requests=0, regions=0, usedHeap=51, maxHeap=1348)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.The piple line info,ensure the datanodes in pipeline of the rs that holding the meta region did not change,it will cause the problem. &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;	Line 8528: 2012-05-08 10:34:57,648 INFO  [main] wal.TestLogRolling(339): xufeng1--------&amp;gt;cluster.getRegionServer(0)serverName=HADOOP-CI-AGENT-A,59995,1336444420124, load=(requests=0, regions=1, usedHeap=50, maxHeap=1348)
	Line 8529: 2012-05-08 10:34:57,648 INFO  [main] wal.TestLogRolling(344): xufeng1--------&amp;gt;127.0.0.1:47107
	Line 8530: 2012-05-08 10:34:57,648 INFO  [main] wal.TestLogRolling(345): xufeng1--------&amp;gt;127.0.0.1:33211
	Line 8531: 2012-05-08 10:34:57,648 INFO  [main] wal.TestLogRolling(351): xufeng2--------&amp;gt;cluster.getRegionServer(1)serverName=HADOOP-CI-AGENT-A,36476,1336444420154, load=(requests=0, regions=2, usedHeap=50, maxHeap=1348)
	Line 8532: 2012-05-08 10:34:57,648 INFO  [main] wal.TestLogRolling(356): xufeng2--------&amp;gt;127.0.0.1:33211
	Line 8533: 2012-05-08 10:34:57,649 INFO  [main] wal.TestLogRolling(357): xufeng2--------&amp;gt;127.0.0.1:47107
	Line 9536: 2012-05-08 10:35:35,470 INFO  [main] wal.TestLogRolling(420): xufeng3--------&amp;gt;cluster.getRegionServer(0)serverName=HADOOP-CI-AGENT-A,59995,1336444420124, load=(requests=9, regions=1, usedHeap=49, maxHeap=1348)
	Line 9537: 2012-05-08 10:35:35,470 INFO  [main] wal.TestLogRolling(425): xufeng3--------&amp;gt;127.0.0.1:43393
	Line 9538: 2012-05-08 10:35:35,471 INFO  [main] wal.TestLogRolling(426): xufeng3--------&amp;gt;127.0.0.1:41380
	Line 9723: 2012-05-08 10:35:36,440 INFO  [main] wal.TestLogRolling(432): xufeng4--------&amp;gt;cluster.getRegionServer(1)serverName=HADOOP-CI-AGENT-A,36476,1336444420154, load=(requests=0, regions=2, usedHeap=52, maxHeap=1348)
	Line 9724: 2012-05-08 10:35:36,440 INFO  [main] wal.TestLogRolling(437): xufeng4--------&amp;gt;127.0.0.1:33211
	Line 9725: 2012-05-08 10:35:36,440 INFO  [main] wal.TestLogRolling(438): xufeng4--------&amp;gt;127.0.0.1:47107
	Line 9729: 2012-05-08 10:35:36,442 INFO  [main] wal.TestLogRolling(468): xufeng5--------&amp;gt;cluster.getRegionServer(0)serverName=HADOOP-CI-AGENT-A,59995,1336444420124, load=(requests=9, regions=1, usedHeap=49, maxHeap=1348)
	Line 9730: 2012-05-08 10:35:36,442 INFO  [main] wal.TestLogRolling(473): xufeng5--------&amp;gt;127.0.0.1:43393
	Line 9731: 2012-05-08 10:35:36,442 INFO  [main] wal.TestLogRolling(474): xufeng5--------&amp;gt;127.0.0.1:41380
	Line 9732: 2012-05-08 10:35:36,443 INFO  [main] wal.TestLogRolling(480): xufeng6--------&amp;gt;cluster.getRegionServer(1)serverName=HADOOP-CI-AGENT-A,36476,1336444420154, load=(requests=0, regions=2, usedHeap=52, maxHeap=1348)
	Line 9733: 2012-05-08 10:35:36,443 INFO  [main] wal.TestLogRolling(485): xufeng6--------&amp;gt;127.0.0.1:33211
	Line 9734: 2012-05-08 10:35:36,443 INFO  [main] wal.TestLogRolling(486): xufeng6--------&amp;gt;127.0.0.1:47107
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13270160" author="xufeng" created="Tue, 8 May 2012 03:38:13 +0000"  >&lt;p&gt;Q:Why the oter versions have not this problem?&lt;br/&gt;
A:Because by @before and @after tag,every case will have the absolute test cluster.&lt;/p&gt;</comment>
                            <comment id="13270163" author="xufeng" created="Tue, 8 May 2012 03:41:17 +0000"  >&lt;p&gt;I can not access &lt;a href=&quot;https://builds.apache.org/view/G-L/view/HBase/job/hbase-0.90/471/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/G-L/view/HBase/job/hbase-0.90/471/console&lt;/a&gt;&lt;br/&gt;
Is the problem same to what I meeted?&lt;/p&gt;</comment>
                            <comment id="13270174" author="zhihyu@ebaysf.com" created="Tue, 8 May 2012 04:00:45 +0000"  >&lt;p&gt;That build is no longer on Jenkins.&lt;br/&gt;
You can look at:&lt;br/&gt;
&lt;a href=&quot;https://builds.apache.org/view/G-L/view/HBase/job/hbase-0.90/472/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/G-L/view/HBase/job/hbase-0.90/472/console&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13270177" author="xufeng" created="Tue, 8 May 2012 04:06:07 +0000"  >&lt;p&gt;@Ted&lt;br/&gt;
Where the log file I can get?&lt;/p&gt;</comment>
                            <comment id="13270183" author="zhihyu@ebaysf.com" created="Tue, 8 May 2012 04:12:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://builds.apache.org/view/G-L/view/HBase/job/hbase-0.90/472/artifact/trunk/target/surefire-reports/org.apache.hadoop.hbase.regionserver.wal.TestLogRolling-output.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/G-L/view/HBase/job/hbase-0.90/472/artifact/trunk/target/surefire-reports/org.apache.hadoop.hbase.regionserver.wal.TestLogRolling-output.txt&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13270192" author="stack" created="Tue, 8 May 2012 04:40:14 +0000"  >&lt;p&gt;Xufeng:  If you want to experiment, add logging or whatever, just make a patch and I&apos;ll apply it to 0.90 for you.  Its hard figuring this stuff out.  You need all the clues you can get.  If you want me to run a bunch of 0.90 builds up on jenkins, just ask for it and I&apos;ll do it for you too.  Thanks (Looks like there are moves to make a 0.90.7 coming so would be cool nailing this flapping test soon).  Thanks Xufeng.&lt;/p&gt;</comment>
                            <comment id="13271013" author="xufeng" created="Wed, 9 May 2012 02:15:37 +0000"  >&lt;p&gt;My Conclusion:&lt;br/&gt;
The the log writer pipeline of meta regionserver has been destroyed by testLogRollOnDatanodeDeath().&lt;br/&gt;
when operate the Hlog on meta regionserver it will failed.&lt;/p&gt;

&lt;p&gt;I think this is not a bug just a test problem.Like the other versions,We scan segregate the test cluster by @before and @after tag.&lt;/p&gt;


&lt;p&gt;My My Analysis::&lt;br/&gt;
1.I check the log from &lt;a href=&quot;https://builds.apache.org/view/G-L/view/HBase/job/hbase-0.90/472/artifact/trunk/target/surefire-reports/org.apache.hadoop.hbase.regionserver.wal.TestLogRolling-output.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/G-L/view/HBase/job/hbase-0.90/472/artifact/trunk/target/surefire-reports/org.apache.hadoop.hbase.regionserver.wal.TestLogRolling-output.txt&lt;/a&gt;&lt;br/&gt;
Found the meta region and user region be deployed on different RS.It may cause the problem.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;	Line 226: 2012-04-15 09:19:11,325 INFO  [MASTER_OPEN_REGION-hemera.apache.org:45266-0] handler.OpenedRegionHandler(137): The master has opened the region -ROOT-,,0.70236052 that was online on serverName=hemera.apache.org,46368,1334481545408, load=(requests=0, regions=0, usedHeap=71, maxHeap=1244)
	Line 288: 2012-04-15 09:19:11,379 INFO  [MASTER_OPEN_REGION-hemera.apache.org:45266-1] handler.OpenedRegionHandler(137): The master has opened the region .META.,,1.1028785192 that was online on serverName=hemera.apache.org,46368,1334481545408, load=(requests=0, regions=0, usedHeap=71, maxHeap=1244)
	Line 504: 2012-04-15 09:19:21,513 DEBUG [MASTER_OPEN_REGION-hemera.apache.org:45266-2] handler.OpenedRegionHandler(139): The master has opened the region TestLogRolling,,1334481561377.369bae2d9411e5836a17df5e31b07b5e. that was online on serverName=hemera.apache.org,46368,1334481545408, load=(requests=0, regions=2, usedHeap=76, maxHeap=1244)
	Line 8652: 2012-04-15 09:20:09,099 DEBUG [MASTER_OPEN_REGION-hemera.apache.org:45266-3] handler.OpenedRegionHandler(139): The master has opened the region TestLogRolling,,1334481609001.198321df4a9c90eebcf670a2218d29f0. that was online on serverName=hemera.apache.org,34725,1334481545432, load=(requests=0, regions=0, usedHeap=129, maxHeap=1244)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;2.In this issue we should find in case where the problem happened. &lt;br/&gt;
I reproduce this issue again&#65292;this time I added the debug code in testLogRollOnPipelineRestart().&lt;br/&gt;
    if (admin.tableExists(tableName)) &lt;/p&gt;
{
      admin.disableTable(tableName);
      +LOG.info(&quot;xufeng7--------&amp;gt;before delete table!&quot;);
      admin.deleteTable(tableName);
      +LOG.info(&quot;xufeng7--------&amp;gt;after delete table!&quot;);
    }

&lt;p&gt;3.The test be killed And I just found the &quot;before delete table!&quot; no &quot;after delete table!&quot; string in log.&lt;br/&gt;
It can ensure that the prroblem happened in admin.deleteTable(tableName).&lt;br/&gt;
This is the region assigned info &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;	Line 226: 2012-05-08 16:45:17,603 INFO  [MASTER_OPEN_REGION-HADOOP-CI-AGENT-A:42383-0] handler.OpenedRegionHandler(137): The master has opened the region -ROOT-,,0.70236052 that was online on serverName=HADOOP-CI-AGENT-A,49991,1336466711048, load=(requests=0, regions=0, usedHeap=49, maxHeap=1348)
	Line 288: 2012-05-08 16:45:17,696 INFO  [MASTER_OPEN_REGION-HADOOP-CI-AGENT-A:42383-1] handler.OpenedRegionHandler(137): The master has opened the region .META.,,1.1028785192 that was online on serverName=HADOOP-CI-AGENT-A,49991,1336466711048, load=(requests=0, regions=0, usedHeap=49, maxHeap=1348)
	Line 505: 2012-05-08 16:45:28,099 DEBUG [MASTER_OPEN_REGION-HADOOP-CI-AGENT-A:42383-2] handler.OpenedRegionHandler(139): The master has opened the region TestLogRolling,,1336466727648.b119d8cad80bc39cdd38b04421a67280. that was online on serverName=HADOOP-CI-AGENT-A,57227,1336466711078, load=(requests=0, regions=0, usedHeap=54, maxHeap=1348)
	Line 8495: 2012-05-08 16:46:18,169 DEBUG [MASTER_OPEN_REGION-HADOOP-CI-AGENT-A:42383-3] handler.OpenedRegionHandler(139): The master has opened the region TestLogRolling,,1336466777847.0117c81b3e59fdad15c4a4390156a558. that was online on serverName=HADOOP-CI-AGENT-A,57227,1336466711078, load=(requests=0, regions=0, usedHeap=68, maxHeap=1348)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is my debug info:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;	Line 8526: 2012-05-08 16:46:28,138 INFO  [main] wal.TestLogRolling(339): xufeng1--------&amp;gt;cluster.getRegionServer(0)serverName=HADOOP-CI-AGENT-A,49991,1336466711048, load=(requests=0, regions=2, usedHeap=72, maxHeap=1348)
	Line 8527: 2012-05-08 16:46:28,138 INFO  [main] wal.TestLogRolling(344): xufeng1--------&amp;gt;127.0.0.1:36932
	Line 8528: 2012-05-08 16:46:28,138 INFO  [main] wal.TestLogRolling(345): xufeng1--------&amp;gt;127.0.0.1:42887
	Line 8529: 2012-05-08 16:46:28,138 INFO  [main] wal.TestLogRolling(351): xufeng2--------&amp;gt;cluster.getRegionServer(1)serverName=HADOOP-CI-AGENT-A,57227,1336466711078, load=(requests=0, regions=1, usedHeap=72, maxHeap=1348)
	Line 8530: 2012-05-08 16:46:28,138 INFO  [main] wal.TestLogRolling(356): xufeng2--------&amp;gt;127.0.0.1:42887
	Line 8531: 2012-05-08 16:46:28,138 INFO  [main] wal.TestLogRolling(357): xufeng2--------&amp;gt;127.0.0.1:36932
	Line 9795: 2012-05-08 16:47:06,982 INFO  [main] wal.TestLogRolling(420): xufeng3--------&amp;gt;cluster.getRegionServer(0)serverName=HADOOP-CI-AGENT-A,49991,1336466711048, load=(requests=0, regions=2, usedHeap=73, maxHeap=1348)
	Line 9796: 2012-05-08 16:47:06,982 INFO  [main] wal.TestLogRolling(425): xufeng3--------&amp;gt;127.0.0.1:36932
	Line 9797: 2012-05-08 16:47:06,982 INFO  [main] wal.TestLogRolling(426): xufeng3--------&amp;gt;127.0.0.1:42887
	Line 9798: 2012-05-08 16:47:06,983 INFO  [main] wal.TestLogRolling(432): xufeng4--------&amp;gt;cluster.getRegionServer(1)serverName=HADOOP-CI-AGENT-A,57227,1336466711078, load=(requests=0, regions=1, usedHeap=73, maxHeap=1348)
	Line 9799: 2012-05-08 16:47:06,983 INFO  [main] wal.TestLogRolling(437): xufeng4--------&amp;gt;127.0.0.1:45998
	Line 9800: 2012-05-08 16:47:06,983 INFO  [main] wal.TestLogRolling(438): xufeng4--------&amp;gt;127.0.0.1:54936
	Line 9803: 2012-05-08 16:47:06,985 INFO  [main] wal.TestLogRolling(468): xufeng5--------&amp;gt;cluster.getRegionServer(0)serverName=HADOOP-CI-AGENT-A,49991,1336466711048, load=(requests=0, regions=2, usedHeap=73, maxHeap=1348)
	Line 9804: 2012-05-08 16:47:06,985 INFO  [main] wal.TestLogRolling(473): xufeng5--------&amp;gt;127.0.0.1:36932
	Line 9805: 2012-05-08 16:47:06,985 INFO  [main] wal.TestLogRolling(474): xufeng5--------&amp;gt;127.0.0.1:42887
	Line 9806: 2012-05-08 16:47:06,985 INFO  [main] wal.TestLogRolling(480): xufeng6--------&amp;gt;cluster.getRegionServer(1)serverName=HADOOP-CI-AGENT-A,57227,1336466711078, load=(requests=0, regions=1, usedHeap=73, maxHeap=1348)
	Line 9807: 2012-05-08 16:47:06,985 INFO  [main] wal.TestLogRolling(485): xufeng6--------&amp;gt;127.0.0.1:45998
	Line 9808: 2012-05-08 16:47:06,985 INFO  [main] wal.TestLogRolling(486): xufeng6--------&amp;gt;127.0.0.1:54936
	Line 9956: 2012-05-08 16:47:17,032 INFO  [main] wal.TestLogRolling(494): xufeng7--------&amp;gt;before delete table!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;4.What happened in admin.deleteTable(tableName),I checked the log,and found that &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-08 16:46:55,975 WARN  [DataStreamer for file /user/root/.logs/HADOOP-CI-AGENT-A,49991,1336466711048/HADOOP-CI-AGENT-A%3A49991.1336466712229 block blk_2409401836437026689_1008] hdfs.DFSClient$DFSOutputStream(2707): Failed recovery attempt #0 from primary datanode 127.0.0.1:42887
2012-05-08 16:47:06,981 WARN  [DataStreamer for file /user/root/.logs/HADOOP-CI-AGENT-A,49991,1336466711048/HADOOP-CI-AGENT-A%3A49991.1336466712229 block blk_2409401836437026689_1008] hdfs.DFSClient$DFSOutputStream(2707): Failed recovery attempt #1 from primary datanode 127.0.0.1:42887
2012-05-08 16:47:17,986 WARN  [DataStreamer for file /user/root/.logs/HADOOP-CI-AGENT-A,49991,1336466711048/HADOOP-CI-AGENT-A%3A49991.1336466712229 block blk_2409401836437026689_1008] hdfs.DFSClient$DFSOutputStream(2707): Failed recovery attempt #2 from primary datanode 127.0.0.1:42887
2012-05-08 16:47:27,990 WARN  [DataStreamer for file /user/root/.logs/HADOOP-CI-AGENT-A,49991,1336466711048/HADOOP-CI-AGENT-A%3A49991.1336466712229 block blk_2409401836437026689_1008] hdfs.DFSClient$DFSOutputStream(2707): Failed recovery attempt #3 from primary datanode 127.0.0.1:42887
2012-05-08 16:47:38,995 WARN  [DataStreamer for file /user/root/.logs/HADOOP-CI-AGENT-A,49991,1336466711048/HADOOP-CI-AGENT-A%3A49991.1336466712229 block blk_2409401836437026689_1008] hdfs.DFSClient$DFSOutputStream(2707): Failed recovery attempt #4 from primary datanode 127.0.0.1:42887
2012-05-08 16:47:49,999 WARN  [DataStreamer for file /user/root/.logs/HADOOP-CI-AGENT-A,49991,1336466711048/HADOOP-CI-AGENT-A%3A49991.1336466712229 block blk_2409401836437026689_1008] hdfs.DFSClient$DFSOutputStream(2707): Failed recovery attempt #5 from primary datanode 127.0.0.1:42887
2012-05-08 16:48:01,003 WARN  [DataStreamer for file /user/root/.logs/HADOOP-CI-AGENT-A,49991,1336466711048/HADOOP-CI-AGENT-A%3A49991.1336466712229 block blk_2409401836437026689_1008] hdfs.DFSClient$DFSOutputStream(2707): Failed recovery attempt #0 from primary datanode 127.0.0.1:36932
2012-05-08 16:48:12,007 WARN  [DataStreamer for file /user/root/.logs/HADOOP-CI-AGENT-A,49991,1336466711048/HADOOP-CI-AGENT-A%3A49991.1336466712229 block blk_2409401836437026689_1008] hdfs.DFSClient$DFSOutputStream(2707): Failed recovery attempt #1 from primary datanode 127.0.0.1:36932
2012-05-08 16:48:23,011 WARN  [DataStreamer for file /user/root/.logs/HADOOP-CI-AGENT-A,49991,1336466711048/HADOOP-CI-AGENT-A%3A49991.1336466712229 block blk_2409401836437026689_1008] hdfs.DFSClient$DFSOutputStream(2707): Failed recovery attempt #2 from primary datanode 127.0.0.1:36932
2012-05-08 16:48:34,015 WARN  [DataStreamer for file /user/root/.logs/HADOOP-CI-AGENT-A,49991,1336466711048/HADOOP-CI-AGENT-A%3A49991.1336466712229 block blk_2409401836437026689_1008] hdfs.DFSClient$DFSOutputStream(2707): Failed recovery attempt #3 from primary datanode 127.0.0.1:36932
2012-05-08 16:48:45,019 WARN  [DataStreamer for file /user/root/.logs/HADOOP-CI-AGENT-A,49991,1336466711048/HADOOP-CI-AGENT-A%3A49991.1336466712229 block blk_2409401836437026689_1008] hdfs.DFSClient$DFSOutputStream(2707): Failed recovery attempt #4 from primary datanode 127.0.0.1:36932
2012-05-08 16:48:56,023 WARN  [DataStreamer for file /user/root/.logs/HADOOP-CI-AGENT-A,49991,1336466711048/HADOOP-CI-AGENT-A%3A49991.1336466712229 block blk_2409401836437026689_1008] hdfs.DFSClient$DFSOutputStream(2707): Failed recovery attempt #5 from primary datanode 127.0.0.1:36932
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;5.It will cause the Hlog writer to roll,and if deleta table failed,the HBaseAdmin#deleteTable will cost long time in loop until Retries exhausted.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-05-08 16:48:56,025 DEBUG [RegionServer:0;HADOOP-CI-AGENT-A,49991,1336466711048.logRoller] regionserver.LogRoller(90): HLog roll manually triggered
2012-05-08 16:48:56,027 ERROR [PRI IPC Server handler 8 on 49991] regionserver.HRegionServer(970): 
java.io.IOException: Reflection
	at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogWriter.sync(SequenceFileLogWriter.java:147)
	at org.apache.hadoop.hbase.regionserver.wal.HLog.sync(HLog.java:1088)
	at org.apache.hadoop.hbase.regionserver.wal.HLog.append(HLog.java:1023)
	at org.apache.hadoop.hbase.regionserver.HRegion.delete(HRegion.java:1265)
	at org.apache.hadoop.hbase.regionserver.HRegion.delete(HRegion.java:1185)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.delete(HRegionServer.java:1950)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:602)
	at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1039)
Caused by: java.lang.reflect.InvocationTargetException
	at sun.reflect.GeneratedMethodAccessor12.invoke(Unknown Source)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.hadoop.hbase.regionserver.wal.SequenceFileLogWriter.sync(SequenceFileLogWriter.java:145)
	... 11 more
Caused by: java.io.IOException: DFSOutputStream is closed
	at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.sync(DFSClient.java:3238)
	at org.apache.hadoop.fs.FSDataOutputStream.sync(FSDataOutputStream.java:97)
	at org.apache.hadoop.io.SequenceFile$Writer.syncFs(SequenceFile.java:944)
	... 15 more

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13271016" author="xufeng" created="Wed, 9 May 2012 02:26:13 +0000"  >&lt;p&gt;1.The reproduce result.&lt;br/&gt;
2.The test file thar be added some debug code.&lt;/p&gt;</comment>
                            <comment id="13271091" author="ram_krish" created="Wed, 9 May 2012 04:46:04 +0000"  >&lt;p&gt;Xufeng, i can understand the problem here to some extent.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;A:Because by @before and @after tag,every case will have the absolute test cluster.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Do you think doing as in trunk adding @before and @after will solve this problem?&lt;br/&gt;
Because the way the pipeline is formed may not be in our control right?&lt;/p&gt;</comment>
                            <comment id="13271146" author="xufeng" created="Wed, 9 May 2012 06:24:38 +0000"  >&lt;p&gt;@Rama&lt;br/&gt;
&amp;gt;&amp;gt;Do you think doing as in trunk adding @before and @after will solve this problem?&lt;br/&gt;
I think yes.In @Before,It will create a new cluster,new datanodes,new pipeline.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;Because the way the pipeline is formed may not be in our control right?&lt;br/&gt;
Yes, but in this problem testLogRollOnPipelineRestart kill the datanodes in pipeline,So I think that this is a testcase problem.&lt;/p&gt;</comment>
                            <comment id="13271162" author="ram_krish" created="Wed, 9 May 2012 06:53:14 +0000"  >&lt;blockquote&gt;&lt;p&gt;Found the meta region and user region be deployed on different RS.It may cause the problem.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can we always ensure the meta and user regions are always in the same server? &lt;/p&gt;</comment>
                            <comment id="13271175" author="xufeng" created="Wed, 9 May 2012 07:19:48 +0000"  >&lt;p&gt;@Rama&lt;br/&gt;
In fact,I run this case many times.&lt;br/&gt;
if the meta and user regions are in the same server, it will ok.&lt;/p&gt;</comment>
                            <comment id="13271404" author="xufeng" created="Wed, 9 May 2012 13:30:53 +0000"  >&lt;p&gt;If anyone have no doubts on &quot;this is a test case problem.&quot;&lt;br/&gt;
I think we have two choice to fix this problem:&lt;br/&gt;
1.roll the log writer belongs to the RS that holding the meta region before testLogRollOnPipelineRestart#deleteTable() executed.&lt;br/&gt;
2.By @Before and @After tag to start the cluster for every @test.&lt;/p&gt;

&lt;p&gt;plz give me suggestion,thanks.&lt;/p&gt;</comment>
                            <comment id="13272046" author="xufeng" created="Thu, 10 May 2012 02:58:40 +0000"  >&lt;p&gt;Hi&lt;br/&gt;
Anyone can give me suggestion?&lt;/p&gt;</comment>
                            <comment id="13273022" author="xufeng" created="Fri, 11 May 2012 04:04:26 +0000"  >&lt;p&gt;I create a patch and run this patch 100 times by shell.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;for((i=1;i&amp;lt;=100;i++));
do
   mvn clean -Dtest=TestLogRolling test &amp;gt;&amp;gt; HBASE-5828_90_v1_100times_test_result.txt
   mv target target_${i}
done
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;2 times&#65288;64th 75th&#65289;failed,I do not why happened now.&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------------------------------
Test set: org.apache.hadoop.hbase.regionserver.wal.TestLogRolling
-------------------------------------------------------------------------------
Tests run: 3, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 1,219.296 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!
testLogRollOnPipelineRestart(org.apache.hadoop.hbase.regionserver.wal.TestLogRolling)  Time elapsed: 952.159 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
org.apache.hadoop.hbase.regionserver.wal.FailedLogCloseException: #1336683442040
	at org.apache.hadoop.hbase.regionserver.wal.HLog.cleanupCurrentWriter(HLog.java:802)
	at org.apache.hadoop.hbase.regionserver.wal.HLog.rollWriter(HLog.java:560)
	at org.apache.hadoop.hbase.regionserver.wal.TestLogRolling.testLogRollOnPipelineRestart(TestLogRolling.java:476)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
	at org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:62)
	at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:140)
	at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:165)
	at org.apache.maven.surefire.Surefire.run(Surefire.java:107)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:289)
	at org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:1005)
Caused by: java.io.IOException: Error Recovery for block blk_1933341499089292179_1016 failed  because recovery from primary datanode 127.0.0.1:50920 failed 6 times.  Pipeline was 127.0.0.1:50920. Aborting...
	at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.processDatanodeError(DFSClient.java:2741)
	at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream.access$1500(DFSClient.java:2172)
	at org.apache.hadoop.hdfs.DFSClient$DFSOutputStream$DataStreamer.run(DFSClient.java:2371)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-------------------------------------------------------------------------------
Test set: org.apache.hadoop.hbase.regionserver.wal.TestLogRolling
-------------------------------------------------------------------------------
Tests run: 3, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 1,065.652 sec &amp;lt;&amp;lt;&amp;lt; FAILURE!
testLogRollOnPipelineRestart(org.apache.hadoop.hbase.regionserver.wal.TestLogRolling)  Time elapsed: 830.246 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
org.apache.hadoop.hbase.DroppedSnapshotException: region: TestLogRolling,,1336675047757.bfce863e5843952e14649dc6fc8a53dd.
	at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:1003)
	at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:905)
	at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:857)
	at org.apache.hadoop.hbase.regionserver.wal.TestLogRolling.testLogRollOnPipelineRestart(TestLogRolling.java:509)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:44)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:15)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:41)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:20)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:31)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:76)
	at org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:50)
	at org.junit.runners.ParentRunner$3.run(ParentRunner.java:193)
	at org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:52)
	at org.junit.runners.ParentRunner.runChildren(ParentRunner.java:191)
	at org.junit.runners.ParentRunner.access$000(ParentRunner.java:42)
	at org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:184)
	at org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:28)
	at org.junit.runners.ParentRunner.run(ParentRunner.java:236)
	at org.apache.maven.surefire.junit4.JUnit4TestSet.execute(JUnit4TestSet.java:62)
	at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.executeTestSet(AbstractDirectoryTestSuite.java:140)
	at org.apache.maven.surefire.suite.AbstractDirectoryTestSuite.execute(AbstractDirectoryTestSuite.java:165)
	at org.apache.maven.surefire.Surefire.run(Surefire.java:107)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.apache.maven.surefire.booter.SurefireBooter.runSuitesInProcess(SurefireBooter.java:289)
	at org.apache.maven.surefire.booter.SurefireBooter.main(SurefireBooter.java:1005)
Caused by: org.apache.hadoop.ipc.RemoteException: java.io.IOException: File /user/root/TestLogRolling/bfce863e5843952e14649dc6fc8a53dd/.tmp/8292661038971118318 could only be replicated to 0 nodes, instead of 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12526473" name="HBASE-5828_90_v1.patch" size="2250" author="xufeng" created="Fri, 11 May 2012 04:04:25 +0000"/>
                            <attachment id="12526474" name="HBASE-5828_90_v1_100times_test_result.txt" size="333568" author="xufeng" created="Fri, 11 May 2012 04:04:25 +0000"/>
                            <attachment id="12526092" name="TestLogRolling.java" size="22654" author="xufeng" created="Wed, 9 May 2012 02:26:13 +0000"/>
                            <attachment id="12526091" name="org.apache.hadoop.hbase.regionserver.wal.TestLogRolling-output.rar" size="111554" author="xufeng" created="Wed, 9 May 2012 02:26:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 7 May 2012 11:43:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>236383</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 32 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02cyf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11700</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>