<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:21:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11263/HBASE-11263.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11263] Share the open/close store file thread pool for all store in a region</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11263</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently, the open/close store file thread pool is divided equally to all stores of a region. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; ThreadPoolExecutor getStoreFileOpenAndCloseThreadPool(
      &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; threadNamePrefix) {
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; numStores = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(1, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.htableDescriptor.getFamilies().size());
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; maxThreads = &lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.max(1,
        conf.getInt(HConstants.HSTORE_OPEN_AND_CLOSE_THREADS_MAX,
            HConstants.DEFAULT_HSTORE_OPEN_AND_CLOSE_THREADS_MAX)
            / numStores);
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; getOpenAndCloseThreadPool(maxThreads, threadNamePrefix);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is not very optimal in following scenarios:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;The data of some column families are very large and there are many hfiles in those stores, and others may be very small and in-memory column families.&lt;/li&gt;
	&lt;li&gt;Usually we preserve some column families for later needs. The thread pool for these column families are wasted&#12290;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;The simple way is to share a big thread pool for all stores to open/close hfiles.  &lt;/p&gt;

&lt;p&gt;Suggestions are welcomed. &lt;br/&gt;
Thanks. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12717047">HBASE-11263</key>
            <summary>Share the open/close store file thread pool for all store in a region</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="10002" iconUrl="https://issues.apache.org/jira/images/icons/statuses/document.png" description="A patch for this issue has been uploaded to JIRA by a contributor.">Patch Available</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="liushaohui">Liu Shaohui</assignee>
                                    <reporter username="liushaohui">Liu Shaohui</reporter>
                        <labels>
                    </labels>
                <created>Wed, 28 May 2014 13:53:36 +0000</created>
                <updated>Wed, 4 Jun 2014 17:46:40 +0000</updated>
                                            <version>0.99.0</version>
                                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="14011977" author="fenghh" created="Thu, 29 May 2014 02:16:56 +0000"  >&lt;p&gt;A small improvement but sounds reasonable, you can provide a patch accordingly for review &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14013588" author="liushaohui" created="Fri, 30 May 2014 12:11:35 +0000"  >&lt;p&gt;Patch for the trunk&lt;/p&gt;</comment>
                            <comment id="14013673" author="hadoopqa" created="Fri, 30 May 2014 14:23:57 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12647586/HBASE-11263-trunk-v1.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12647586/HBASE-11263-trunk-v1.diff&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12647586&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9649//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14013948" author="apurtell" created="Fri, 30 May 2014 17:07:21 +0000"  >&lt;p&gt;Do we need storeFileThreadPoolCounter? Looks like this is being used effectively as a boolean flag when you could achieve the same by testing if storeFileThreadPool is null or not in an exclusive section? Save some heap per HRegion.&lt;/p&gt;

&lt;p&gt;What happens if you use one thread pool for opening and closing store files per RegionServer? If we have thousands of HRegions and they all have thread pools, surely we are not able to fully schedule that degree of parallelism?&lt;/p&gt;</comment>
                            <comment id="14013960" author="stack" created="Fri, 30 May 2014 17:14:28 +0000"  >&lt;p&gt;Naming the thread pool for the first region that passes by seems a bit odd:&lt;/p&gt;

&lt;p&gt;+        String threadNamePrefix =&lt;br/&gt;
+            &quot;StoreFileOpenerThread-&quot; + getRegionNameAsString();&lt;/p&gt;
</comment>
                            <comment id="14016463" author="liushaohui" created="Tue, 3 Jun 2014 12:54:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=andrew.purtell%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;andrew.purtell@gmail.com&quot;&gt;Andrew Purtell&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Do we need storeFileThreadPoolCounter?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Each store of the region will try to get and close the thread pool when opening and closing store files. StoreFileThreadPoolCounter represent the number of stores which are using this thread pool now. When StoreFileThreadPoolCounter is zero, we can shut down the thread pool actually.&lt;/p&gt;

&lt;p&gt;If we only use a boolean flag, we must put the code of closing the thread pool in region level. It&apos;s a little odd because the thread pool is used in the construction of store and closed in region.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;What happens if you use one thread pool for opening and closing store files per RegionServer? If we have thousands of HRegions and they all have thread pools, surely we are not able to fully schedule that degree of parallelism?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agree! Per regionserver thread pool for for opening and closing store files will be better.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Naming the thread pool for the first region that passes by seems a bit odd:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In the patch, the thread pool opening and closing store files is per region, so we name the thread pool with region name.&lt;/p&gt;</comment>
                            <comment id="14016935" author="apurtell" created="Tue, 3 Jun 2014 18:04:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;Agree! Per regionserver thread pool for for opening and closing store files will be better.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Great!&lt;/p&gt;</comment>
                            <comment id="14017827" author="stack" created="Wed, 4 Jun 2014 16:31:50 +0000"  >&lt;p&gt;Ok.  +1 then.  Work for a thread pool at server level would be in a different JIRA I presume.&lt;/p&gt;</comment>
                            <comment id="14017925" author="apurtell" created="Wed, 4 Jun 2014 17:46:40 +0000"  >&lt;blockquote&gt;&lt;p&gt;Ok.  +1 then.  Work for a thread pool at server level would be in a different JIRA I presume.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I&apos;d argue not much point for this change if thread pool at server level is being worked on now or next.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12647586" name="HBASE-11263-trunk-v1.diff" size="6124" author="liushaohui" created="Fri, 30 May 2014 12:11:35 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 29 May 2014 02:16:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>395255</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 28 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1w1w7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>395386</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>