<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:13:20 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3809/HBASE-3809.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3809] .META. may not come back online if &gt; number of executors servers crash and one of those &gt; number of executors was carrying meta</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3809</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This is a duplicate of another issue but at the moment I cannot find the original.&lt;/p&gt;

&lt;p&gt;If you had a 700 node cluster and then you ran something on the cluster which killed 100 nodes, and .META. had been running on one of those downed nodes, well, you&apos;ll have all of your master executors processing ServerShutdowns and more than likely non of the currently processing executors will be servicing the shutdown of the server that was carrying .META.&lt;/p&gt;

&lt;p&gt;Well, for server shutdown to complete at the moment, an online .META. is required.  So, in the above case, we&apos;ll be stuck. The current executors will not be able to clear to make space for the processing of the server carrying .META. because they need .META. to complete.&lt;/p&gt;

&lt;p&gt;We can make the master handlers have no bound so it will expand to accomodate all crashed servers &amp;#8211; so it&apos;ll have the one .META. in its queue &amp;#8211; or we can change it so shutdown handling doesn&apos;t require .META. to be on-line (its used to figure the regions the server was carrying); we could use the master&apos;s in-memory picture of the cluster (But IIRC, there may be holes ....TBD)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12504853">HBASE-3809</key>
            <summary>.META. may not come back online if &gt; number of executors servers crash and one of those &gt; number of executors was carrying meta</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="zjushch">chunhui shen</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 21 Apr 2011 06:44:58 +0000</created>
                <updated>Tue, 8 Jan 2013 23:44:27 +0000</updated>
                            <resolved>Tue, 8 Jan 2013 07:59:35 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13023392" author="jdcryans" created="Fri, 22 Apr 2011 20:48:06 +0000"  >&lt;p&gt;In the same vein (having to rely on .META. for region server shutdown), we saw an issue yesterday where the balancer started just before a region server was cleanly shutdown. In sequence:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Balancer starts unassigning regions&lt;/li&gt;
	&lt;li&gt;RS starts closing a few regions for balancing&lt;/li&gt;
	&lt;li&gt;RS is told to stop&lt;/li&gt;
	&lt;li&gt;Master initiates the region server shutdown handler which scans .META. for regions that are on that region server&lt;/li&gt;
	&lt;li&gt;Regions are being unassigned and moved while the master force unassigns regions that (he thinks) are on the RS&lt;/li&gt;
	&lt;li&gt;At the end, 25 out of 500 regions are double assigned because they were already reassigned when the server shutdown reassigns them.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;This happens because the master relies on potentially stale information when forcing the unassign. According to the comments in the code, we still have to scan to check against splits. The workaround is to disable the balancer before shutting down a region server (like rolling restart does).&lt;/p&gt;

&lt;p&gt;hbck fixed the double assignment without any trouble.&lt;/p&gt;</comment>
                            <comment id="13023495" author="yuzhihong@gmail.com" created="Sat, 23 Apr 2011 04:03:50 +0000"  >&lt;p&gt;One potential issue is that it takes some time for region server to shut down.&lt;br/&gt;
If other region servers are overloaded during this period of time, balancer wouldn&apos;t be able to help.&lt;/p&gt;

&lt;p&gt;The first step of region server shutdown would be to inform load balancer not to unassign regions off the server. &lt;/p&gt;</comment>
                            <comment id="13234508" author="lhofhansl" created="Wed, 21 Mar 2012 17:04:53 +0000"  >&lt;p&gt;Moving out of 0.94.&lt;/p&gt;</comment>
                            <comment id="13546633" author="zjushch" created="Tue, 8 Jan 2013 05:46:28 +0000"  >&lt;p&gt;I think it won&apos;t happen in trunk now.Because:&lt;br/&gt;
1.We use different ExecutorService to execute ServerShutdownHandler and MetaServerShutdownHandler&lt;br/&gt;
2.In the process of MetaServerShutdownHandler&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isCarryingRoot() || isCarryingMeta() &lt;span class=&quot;code-comment&quot;&gt;// -ROOT- or .META.
&lt;/span&gt;          || !services.getAssignmentManager().isFailoverCleanupDone()) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getServerManager().processDeadServer(serverName);
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It means MetaServerShutdownHandler could always be executed, so this stuck scenario won&apos;t happen again &lt;/p&gt;</comment>
                            <comment id="13546635" author="yuzhihong@gmail.com" created="Tue, 8 Jan 2013 05:49:45 +0000"  >&lt;p&gt;What about the scenario J-D described @ 22/Apr/11 21:48 ?&lt;/p&gt;</comment>
                            <comment id="13546642" author="zjushch" created="Tue, 8 Jan 2013 06:07:42 +0000"  >&lt;p&gt;It is a common multi-assign scenario J-D described @ 22/Apr/11 21:48  in early version.&lt;/p&gt;

&lt;p&gt;We have done many works to fix multi-assign cases,&lt;br/&gt;
So it won&apos;t be a problem now.&lt;/p&gt;

</comment>
                            <comment id="13546684" author="stack" created="Tue, 8 Jan 2013 07:59:35 +0000"  >&lt;p&gt;Resolving as no longer valid based off Chunhui&apos;s argument above.  Thanks Chunhui.&lt;/p&gt;</comment>
                            <comment id="13547348" author="yuzhihong@gmail.com" created="Tue, 8 Jan 2013 22:24:28 +0000"  >&lt;p&gt;Here is code snippet from ServerManager.expireServer():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getExecutorService().submit(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; MetaServerShutdownHandler(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master,
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.deadservers, serverName, carryingRoot, carryingMeta));
    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getExecutorService().submit(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ServerShutdownHandler(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13547360" author="stack" created="Tue, 8 Jan 2013 22:40:57 +0000"  >&lt;p&gt;What is the point that you are trying to make @Ted Yu?&lt;/p&gt;</comment>
                            <comment id="13547378" author="yuzhihong@gmail.com" created="Tue, 8 Jan 2013 23:04:06 +0000"  >&lt;p&gt;I was trying to find out which other ExecutorService is used to execute MetaServerShutdownHandler.&lt;br/&gt;
In MasterServices, there is only one method returning ExecutorService:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; ExecutorService getExecutorService();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In HMaster, I only found one ExecutorService member variable:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-comment&quot;&gt;// Instance of the hbase executor service.
&lt;/span&gt;  ExecutorService executorService;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13547394" author="stack" created="Tue, 8 Jan 2013 23:18:47 +0000"  >&lt;p&gt;and... &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ted_yu&quot; class=&quot;user-hover&quot; rel=&quot;ted_yu&quot;&gt;Ted Yu&lt;/a&gt; your point is?&lt;/p&gt;</comment>
                            <comment id="13547400" author="yuzhihong@gmail.com" created="Tue, 8 Jan 2013 23:26:12 +0000"  >&lt;p&gt;If I read the code correctly, there is only one ExecutorService running both MetaServerShutdownHandler and ServerShutdownHandler.&lt;br/&gt;
Point #1 from the comment @ 08/Jan/13 05:46 may not be true.&lt;/p&gt;</comment>
                            <comment id="13547404" author="jxiang" created="Tue, 8 Jan 2013 23:30:04 +0000"  >&lt;p&gt;@Ted, check ExecutorService#getExecutor(final ExecutorType type).  Chunhui is right.&lt;/p&gt;</comment>
                            <comment id="13547405" author="stack" created="Tue, 8 Jan 2013 23:30:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;Point #1 from the comment @ 08/Jan/13 05:46 may not be true.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ted_yu&quot; class=&quot;user-hover&quot; rel=&quot;ted_yu&quot;&gt;Ted Yu&lt;/a&gt; There is no comment at the above noted time.&lt;/p&gt;</comment>
                            <comment id="13547424" author="yuzhihong@gmail.com" created="Tue, 8 Jan 2013 23:44:27 +0000"  >&lt;p&gt;@Jimmy:&lt;br/&gt;
Thanks for the reminder.&lt;br/&gt;
Reading into HMaster.startServiceThreads(), I found the answer.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12551766">HBASE-5843</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 22 Apr 2011 20:48:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27035</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 49 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02cvr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11688</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>