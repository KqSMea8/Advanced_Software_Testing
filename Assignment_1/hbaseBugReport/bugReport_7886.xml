<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:49:59 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7886/HBASE-7886.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7886] [replication] hlog zk node will not be deleted if client roll hlog</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7886</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;if we use the hbase shell command &quot;hlog_roll&quot; on a regionserver which is configured replication. the Hlog zk node under /hbase/replication/rs/1 can not be deleted.&lt;/p&gt;

&lt;p&gt;this issue is caused by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6758&quot; title=&quot;[replication] The replication-executor should make sure the file that it is replicating is closed before declaring success on that file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6758&quot;&gt;&lt;del&gt;HBASE-6758&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12633144">HBASE-7886</key>
            <summary>[replication] hlog zk node will not be deleted if client roll hlog</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="terry_zhang">terry zhang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Feb 2013 06:24:01 +0000</created>
                <updated>Mon, 30 Dec 2013 04:11:28 +0000</updated>
                            <resolved>Tue, 17 Dec 2013 05:56:19 +0000</resolved>
                                    <version>0.94.4</version>
                                    <fixVersion>0.94.15</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13581990" author="terry_zhang" created="Wed, 20 Feb 2013 06:28:09 +0000"  >&lt;p&gt;hlog zk node is deleted in  shipEdits() or &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ReplicationSource.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isActive() &amp;amp;&amp;amp; (gotIOE || currentNbEntries == 0)) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.lastLoggedPosition != &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.position) {
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.manager.logPositionAndCleanOldLogs(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.currentPath,
              &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.peerClusterZnode, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.position, queueRecovered, currentWALisBeingWrittenTo);
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.lastLoggedPosition = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.position;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sleepForRetries(&lt;span class=&quot;code-quote&quot;&gt;&quot;Nothing to replicate&quot;&lt;/span&gt;, sleepMultiplier)) {
          sleepMultiplier++;
        }
        &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;but after patch &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6758&quot; title=&quot;[replication] The replication-executor should make sure the file that it is replicating is closed before declaring success on that file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6758&quot;&gt;&lt;del&gt;HBASE-6758&lt;/del&gt;&lt;/a&gt;. logPositionAndCleanOldLogs can not delete hlog zk node when currentWALisBeingWrittenTo is true. When log switched and we can see &lt;/p&gt;

&lt;p&gt;    // If we didn&apos;t get anything and the queue has an object, it means we&lt;br/&gt;
    // hit the end of the file for sure&lt;br/&gt;
    return seenEntries == 0 &amp;amp;&amp;amp; processEndOfFile(); // seenEntries is 0 when run &apos;hlog_roll&apos; in shell&lt;/p&gt;

&lt;p&gt;So replicationsource will continue and hlog zk node can not deleted.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ReplicationSource.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(readAllEntriesToReplicateOrNextFile(currentWALisBeingWrittenTo)) {        
          &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="13581993" author="terry_zhang" created="Wed, 20 Feb 2013 06:29:52 +0000"  >&lt;p&gt;this issue will be also reproduced when no data write to cluster which is same as run &apos;hlog_roll&apos; in shell.&lt;/p&gt;</comment>
                            <comment id="13766026" author="jdcryans" created="Thu, 12 Sep 2013 23:40:36 +0000"  >&lt;p&gt;So this issue was fixed upstream via &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8599&quot; title=&quot;HLogs in ZK are not cleaned up when replication lag is minimal&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8599&quot;&gt;&lt;del&gt;HBASE-8599&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9033&quot; title=&quot;Add tracing to ReplicationSource and enable it in tests&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9033&quot;&gt;&lt;del&gt;HBASE-9033&lt;/del&gt;&lt;/a&gt;, the latter I forgot to backport to 0.94. The patch I&apos;m attaching has the missing bit to make everything right.&lt;/p&gt;</comment>
                            <comment id="13766390" author="stack" created="Fri, 13 Sep 2013 10:40:48 +0000"  >&lt;p&gt;Seems good to me.&lt;/p&gt;</comment>
                            <comment id="13766687" author="jdcryans" created="Fri, 13 Sep 2013 17:29:31 +0000"  >&lt;p&gt;Actually the TRACE shouldn&apos;t be in there, that&apos;s only in trunk. Attaching what I&apos;m going to commit.&lt;/p&gt;</comment>
                            <comment id="13767101" author="v.himanshu" created="Fri, 13 Sep 2013 22:49:46 +0000"  >&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="13841459" author="jdcryans" created="Fri, 6 Dec 2013 17:38:31 +0000"  >&lt;p&gt;I forgot to commit this, will do for 0.94.15&lt;/p&gt;</comment>
                            <comment id="13842911" author="lhofhansl" created="Mon, 9 Dec 2013 05:10:37 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13849967" author="lhofhansl" created="Tue, 17 Dec 2013 01:12:10 +0000"  >&lt;p&gt;I&apos;ll commit tomorrow unless I hear objections. Unless you want to &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdcryans&quot; class=&quot;user-hover&quot; rel=&quot;jdcryans&quot;&gt;Jean-Daniel Cryans&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13850142" author="lhofhansl" created="Tue, 17 Dec 2013 05:56:19 +0000"  >&lt;p&gt;Committed to 0.94.&lt;br/&gt;
Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdcryans&quot; class=&quot;user-hover&quot; rel=&quot;jdcryans&quot;&gt;Jean-Daniel Cryans&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13850283" author="hudson" created="Tue, 17 Dec 2013 09:28:57 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94-security #362 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/362/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/362/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7886&quot; title=&quot;[replication] hlog zk node will not be deleted if client roll hlog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7886&quot;&gt;&lt;del&gt;HBASE-7886&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;replication&amp;#93;&lt;/span&gt; hlog zk node will not be deleted if client roll hlog (JD) (larsh: rev 1551466)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13850296" author="hudson" created="Tue, 17 Dec 2013 09:39:08 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94 #1229 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1229/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1229/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7886&quot; title=&quot;[replication] hlog zk node will not be deleted if client roll hlog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7886&quot;&gt;&lt;del&gt;HBASE-7886&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;replication&amp;#93;&lt;/span&gt; hlog zk node will not be deleted if client roll hlog (JD) (larsh: rev 1551466)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12602908" name="HBASE-7886-0.94-v2.patch" size="1388" author="jdcryans" created="Thu, 12 Sep 2013 23:40:36 +0000"/>
                            <attachment id="12603050" name="HBASE-7886-0.94-v3.patch" size="1280" author="jdcryans" created="Fri, 13 Sep 2013 17:29:31 +0000"/>
                            <attachment id="12570093" name="HBASE-7886.patch" size="941" author="terry_zhang" created="Wed, 20 Feb 2013 07:05:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 12 Sep 2013 23:40:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313640</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1i4hb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>313985</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>