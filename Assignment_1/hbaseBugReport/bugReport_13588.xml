<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:44:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13588/HBASE-13588.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13588] ExportSnapshot should checksum data transferred</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13588</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We sent quite a bit of data using ExportSnapshot and noticed some corruption.  We use checksums to verify if we have transferred a particular file but never do any verification after the file has been transferred.  I propose that we do a checksum upon completing file transfer and if the checksums do not match up, I propose we fail by throwing an IOException.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12825682">HBASE-13588</key>
            <summary>ExportSnapshot should checksum data transferred</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="10002" iconUrl="https://issues.apache.org/jira/images/icons/statuses/document.png" description="A patch for this issue has been uploaded to JIRA by a contributor.">Patch Available</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="mubeenafzal">Mubeen Afzal</assignee>
                                    <reporter username="mubeenafzal">Mubeen Afzal</reporter>
                        <labels>
                    </labels>
                <created>Tue, 28 Apr 2015 21:23:26 +0000</created>
                <updated>Wed, 6 May 2015 00:09:06 +0000</updated>
                                            <version>2.0.0</version>
                    <version>1.0.1</version>
                    <version>0.98.13</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="14524516" author="hadoopqa" created="Sat, 2 May 2015 03:35:09 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12729892/HBASE-13588.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12729892/HBASE-13588.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit a6027aedb3d3e8b6d3019f7547730b0c1f595c45.&lt;br/&gt;
  ATTACHMENT ID: 12729892&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.snapshot.TestSecureExportSnapshot&lt;br/&gt;
                  org.apache.hadoop.hbase.snapshot.TestExportSnapshot&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.activemq.transport.mqtt.MQTTTest.testMQTTPathPatterns(MQTTTest.java:403)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13925//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13925//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13925//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13925//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13925//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13925//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13925//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13925//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14525257" author="yuzhihong@gmail.com" created="Sat, 2 May 2015 14:19:59 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
284	          &lt;span class=&quot;code-comment&quot;&gt;// Verify that the written size matches
&lt;/span&gt;285	          FileStatus outputStat = outputFs.getFileStatus(outputPath);
286	          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!sameFile(inputStat, outputStat)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Method call doesn&apos;t seem to match comment.&lt;/p&gt;</comment>
                            <comment id="14525638" author="yuzhihong@gmail.com" created="Sun, 3 May 2015 04:12:55 +0000"  >&lt;p&gt;TestExportSnapshot#testExportRetry fails with patch locally.&lt;br/&gt;
In test output, I saw:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2015-05-02 21:06:37,106 WARN  [ContainersLauncher #0] nodemanager.DefaultContainerExecutor(207): Exit code from container container_1430625969815_0001_01_000003 is : 143
Error: java.io.IOException: checksums don&apos;t match &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; input: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:60254/user/tyu/test-data/98603dee-5efc-43d1-a51e-cd70354870a9/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/testtb-1430625973413/            5373881af77da1f7f8463f160a317c15/cf/381595c4c327402fab3f3780b59f121b and output: file:/Users/tyu/1-hbase/hbase-server/target/test-data/7a27b9b5-48e4-4b27-b29d-16ecd441778e/local-export- 1430625977202/archive/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/testtb-1430625973413/5373881af77da1f7f8463f160a317c15/cf/381595c4c327402fab3f3780b59f121b
&lt;/span&gt;  at org.apache.hadoop.hbase.snapshot.ExportSnapshot$ExportMapper.copyFile(ExportSnapshot.java:299)
  at org.apache.hadoop.hbase.snapshot.ExportSnapshot$ExportMapper.map(ExportSnapshot.java:193)
  at org.apache.hadoop.hbase.snapshot.ExportSnapshot$ExportMapper.map(ExportSnapshot.java:119)
  at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)
  at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14525681" author="mbertozzi" created="Sun, 3 May 2015 06:02:05 +0000"  >&lt;p&gt;the problem with this patch, as you may see from the test failure, &lt;br/&gt;
is that if we release it with the checksum on, it will always fail when exporting to a different filesystem&lt;br/&gt;
e.g. hdfs to local (as in the test), hdfs to s3, hdfs to an hdfs with a different checksum conf and so on. each fs implementation/configuration will have a different checksum. &lt;/p&gt;</comment>
                            <comment id="14525850" author="yuzhihong@gmail.com" created="Sun, 3 May 2015 14:08:15 +0000"  >&lt;p&gt;We have FSHDFSUtils#isSameHdfs().&lt;br/&gt;
Maybe a similar utility method can be added without the last check in FSHDFSUtils#isSameHdfs() which is specific to DistributedFileSystem.&lt;/p&gt;

&lt;p&gt;Checksums can be compared for FileSystem&apos;s of the same type.&lt;/p&gt;</comment>
                            <comment id="14527038" author="mubeenafzal" created="Mon, 4 May 2015 18:43:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt; I see a similar filechecksum compare prior to exporting snapshot without any checks on file system. So there is no test where snapshot already exists on target prior to exporting snapshot. I&apos;m proposing making checksum compare optional with default &amp;lt;false&amp;gt;. And just logging a warn if those are different when enabled. what do you think?&lt;/p&gt;</comment>
                            <comment id="14527648" author="mbertozzi" created="Tue, 5 May 2015 00:42:58 +0000"  >&lt;blockquote&gt;&lt;p&gt;I see a similar filechecksum compare prior to exporting snapshot without any checks on file system. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;correct, we rewrite the file if the checksums are different. which is not ideal but at least you end up with the correct result.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I&apos;m proposing making checksum compare optional with default &amp;lt;false&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;that sounds good, we need the default false to avoid breaking existing scripts running export &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;And just logging a warn if those are different when enabled. what do you think?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;not sure about this one, an exception will be fine with me since the default is false. if you are asking for the checksum post copy you probably want a failure. but I don&apos;t have a strong opinion on this. maybe another flag? &quot;fail.if.checksum.failed&quot; and in case false just log. just to provide the user both options? again, no strong opinion. your call.&lt;/p&gt;</comment>
                            <comment id="14529319" author="mubeenafzal" created="Tue, 5 May 2015 21:29:14 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;. I&apos;ve attached a new patch for this, with the proposed changes. I&apos;ve added a 2nd flag for post-export checksum check with default false. And have left the pre-export checksum verify default to true.&lt;/p&gt;</comment>
                            <comment id="14529605" author="hadoopqa" created="Wed, 6 May 2015 00:09:06 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12730616/HBASE-13588.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12730616/HBASE-13588.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 977f867439e960c668ee6311e47c904efc40f219.&lt;br/&gt;
  ATTACHMENT ID: 12730616&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.1 2.5.2 2.6.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13948//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13948//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13948//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13948//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13948//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13948//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/13948//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/13948//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12730616" name="HBASE-13588.patch" size="15140" author="mubeenafzal" created="Tue, 5 May 2015 21:26:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 2 May 2015 03:35:09 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 32 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2e1c7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>