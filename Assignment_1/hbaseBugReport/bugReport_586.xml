<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:45:40 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-586/HBASE-586.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-586] HRegion runs HStore memcache snapshotting -- fix it so only HStore knows about workings of memcache</title>
                <link>https://issues.apache.org/jira/browse/HBASE-586</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;HRegion needs to keep count of memcache sizes.  Currently its trying to run the  memcaches snapshots so it can keep up this number.  HRegion should know nothing about no memcache snapshotting &amp;#8211; should be internal to flushing ... especially since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-532&quot; title=&quot;Odd interaction between HRegion.get, HRegion.deleteAll and compactions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-532&quot;&gt;&lt;del&gt;HBASE-532&lt;/del&gt;&lt;/a&gt; fix.   HRegion can ask for store sizes....  Add that.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12394160">HBASE-586</key>
            <summary>HRegion runs HStore memcache snapshotting -- fix it so only HStore knows about workings of memcache</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Apr 2008 00:11:01 +0000</created>
                <updated>Fri, 22 Aug 2008 21:13:13 +0000</updated>
                            <resolved>Mon, 21 Apr 2008 23:52:41 +0000</resolved>
                                                    <fixVersion>0.1.2</fixVersion>
                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12589829" author="stack" created="Thu, 17 Apr 2008 05:07:49 +0000"  >&lt;p&gt;Here is first cut.  Merge is failing for some odd reason so need to fix that.  Also want to run this on cluster because its there where will figure if new technique actually works.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HBASE-586 HRegion runs HStore memcache snapshotting -- fix it so HRegion only knows about flushing
Make it so region does not know about store memcaches any more.  It
just knows about flushes.  Runs flushes, not flushes and memcache snapshots
individually.  Makes things a tad less complicated.

M  src/test/org/apache/hadoop/hbase/util/TestMergeTool.java
    Catch and report error &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; one running merge.
M  src/java/org/apache/hadoop/hbase/regionserver/HStore.java
    (snapshotMemcache): Removed.
    (flushCache): Added &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; of size flushed.
M  src/java/org/apache/hadoop/hbase/regionserver/HRegion.java
    (flushCache): Just call internalFlushcache.
    (snapshotMemcaches): Removed.
    (internalFlushcache): No longer take a &apos;starttime&apos;.
    In here &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; things too like set the flushRequested flag and
    last flush time rather than over in the removed
    snapshotMemcaches.  Also, decrement memcacheSize by the
    amount of data flushed.
    (getEntrySize): Utility method.
M ndex: src/java/org/apache/hadoop/hbase/util/Merge.java
    Catch problems earlier.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12590649" author="stack" created="Fri, 18 Apr 2008 23:52:21 +0000"  >&lt;p&gt;Updated patch and updated commit message.  Need to run on cluster first to make sure new memcache sizing works under load.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HBASE-586 HRegion runs HStore memcache snapshotting -- fix it so only
HStore knows about workings of memcache

This patch moves the running of mecache snapshots out of the control
of HRegion and hides the memcache details in HStore.   This patch also
does a bunch of work on the merge tool fixing a bug in the metautils along
the way.  The merge tool test was failing.  We weren&apos;t setting into the
HLog the maximum sequence id after we&apos;d opened a region -- as HRS does --
so were losing edits. On the way, refactored the merge tool test to get
rid of duplicated code.  Finally, cleans up logging in HStore to aid
debugging; e.g. we always refer to the sequence id as the &apos;sequence id&apos;
in log messages rather than as seqId or &apos;sequence record&apos; so can sort
log as see state of sequence id transitions.

Version 2 changes the order in which things are run in memcache.  532
made it so flushing did snapshot and then cleared the snapshot.  Now,
we snapshot before we flush a store, then inside in the store flush,
we call getSnapshot and then clearSnapshot.

M  src/test/org/apache/hadoop/hbase/regionserver/TestHMemcache.java
  How snapshotting changed.  Change test in accordance.
M  src/test/org/apache/hadoop/hbase/regionserver/TestHLog.java
  Use accessor to get file number.
M  src/test/org/apache/hadoop/hbase/util/TestMergeTool.java
  Refactored to remove duplicated code so could tell what was going on.
  (mergeAndVerify, verifyMerge): Addd.
M  src/java/org/apache/hadoop/hbase/regionserver/Memcache.java
  (snapshot): Changed so it no longer returns snapshot.
M  src/java/org/apache/hadoop/hbase/regionserver/HStore.java
  Changed log messages removing the useless and adding info to others.
  (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.maxSeqId): We used to add 1 to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; in here in HStore.  Let
  HRegion &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; it.  Its the one that does the machinations w/ sequenceids
  anyways.  Make flushes &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; the amount flushed.  Use &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; updating
  the regions memcacheSize accounting.
  (snapshot): Added method &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the region to call.
M  src/java/org/apache/hadoop/hbase/regionserver/HLog.java
  Made data members &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt;.
  (getFileNum): Added accessor &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; tests.
M  src/java/org/apache/hadoop/hbase/regionserver/HRegion.java
  Added info to logs..
  (snapshotMemcaches): removed.
  (internalFlushcache): No longer takes startime.  Internally now does
  some of what used happen in snapshotMemcaches including sending of
  message to stores to snapshot.
  (getEntrySize): Added method &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; calculating size of an update. Used
  by HRegion and flushing so both come up w/ same answer.
M  src/java/org/apache/hadoop/hbase/util/Merge.java
  Add logging of whats happening during merges and fail earlier than we
  used &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; stuff is not right.
  Renamed local variables from region1 to r1, etc., so didn&apos;t clash
  with data members of same name.
M  src/java/org/apache/hadoop/hbase/util/MetaUtils.java
  Added a TODO
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12591035" author="stack" created="Mon, 21 Apr 2008 20:38:05 +0000"  >&lt;p&gt;This version is like v2 but I did more clean up of logging messages adding method to FSUtils that will return a path minus the Filesystem instance qualifier.&lt;/p&gt;</comment>
                            <comment id="12591036" author="stack" created="Mon, 21 Apr 2008 20:38:54 +0000"  >&lt;p&gt;Submitting so I get some review action. &lt;/p&gt;

&lt;p&gt;Please pardon it&apos;s being a bit of an omnibus.&lt;/p&gt;</comment>
                            <comment id="12591038" author="stack" created="Mon, 21 Apr 2008 20:40:12 +0000"  >&lt;p&gt;Oh, I ran this on cluster to prove that new way of doing region-level memstore size calculation is not going haywire.&lt;/p&gt;</comment>
                            <comment id="12591079" author="jimk" created="Mon, 21 Apr 2008 21:54:42 +0000"  >&lt;p&gt;Don&apos;t understand this part of javadoc for Memcache.getSnapshot:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   * Called by flusher when it wants to clean up snapshot made by a previous
   * call to {@link snapshot}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Otherwise +1&lt;/p&gt;</comment>
                            <comment id="12591123" author="stack" created="Mon, 21 Apr 2008 23:52:41 +0000"  >&lt;p&gt;Applied to TRUNK. Applied version without rewrite of TestMergeTool to branch after testing on cluster to make sure nothing broke.  Thanks for the review Jim.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12380550" name="586-v2.patch" size="41243" author="stack" created="Fri, 18 Apr 2008 23:52:21 +0000"/>
                            <attachment id="12380639" name="586-v3.patch" size="47690" author="stack" created="Mon, 21 Apr 2008 20:38:05 +0000"/>
                            <attachment id="12380365" name="586.patch" size="11291" author="stack" created="Thu, 17 Apr 2008 05:07:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 21 Apr 2008 21:54:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25277</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 35 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h87r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98593</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>