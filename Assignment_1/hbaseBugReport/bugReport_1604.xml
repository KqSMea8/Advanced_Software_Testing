<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:54:52 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1604/HBASE-1604.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1604] HBaseClient.getConnection() may return a broken connection without throwing an exception</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1604</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Consider the code of HBaseClient.getConnection():&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    connection.setupIOstreams();
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; connection;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now consider the setupIOstreams() method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IOException e) {
        markClosed(e);
        close(); &lt;span class=&quot;code-comment&quot;&gt;// Removes the connection from pool
&lt;/span&gt;      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, if something goes wrong inside of setupIOstreams, then after its invocation the connection will be broken (will have its .in and .out streams nulls, for example) and will not be in pool, but will still be returned from the getConnection method and cause further harm (for example, cause a NullPointerException in further calls such as sendCall, which use the in and out streams).&lt;/p&gt;

&lt;p&gt;Suggested fix: make the setupIOstreams method rethrow the IOException inside that catch block.&lt;/p&gt;

&lt;p&gt;Reproduction: Restart the hbase master and/or regionserver while a client program is running, and put a breakpoint into that catch block.&lt;/p&gt;

&lt;p&gt;I actually observed a situation where the broken connection stayed in the pool, but I don&apos;t yet know how to reproduce it or what is the reason. I am investigating the issue, but for now at least the aforementioned bug should be fixed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12429383">HBASE-1604</key>
            <summary>HBaseClient.getConnection() may return a broken connection without throwing an exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jkff">Eugene Kirpichov</reporter>
                        <labels>
                    </labels>
                <created>Thu, 2 Jul 2009 12:02:21 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:48 +0000</updated>
                            <resolved>Sun, 2 Aug 2009 23:30:41 +0000</resolved>
                                    <version>0.19.2</version>
                                    <fixVersion>0.20.0</fixVersion>
                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12731415" author="jkff" created="Wed, 15 Jul 2009 12:38:18 +0000"  >&lt;p&gt;2 weeks passed without reaction. Hey, developers!&lt;/p&gt;

&lt;p&gt;I&apos;ve implemented the suggested fix and it improved things somewhat; the described bug is fixed, and now the situation where a broken connection stays in pool occurs extremely rarely, but it still occurs. I still don&apos;t know why.&lt;/p&gt;</comment>
                            <comment id="12731506" author="streamy" created="Wed, 15 Jul 2009 15:21:53 +0000"  >&lt;p&gt;Eugene, can you provide a patch?&lt;/p&gt;</comment>
                            <comment id="12731515" author="jkff" created="Wed, 15 Jul 2009 15:41:34 +0000"  >&lt;p&gt;Attaching a patch against trunk.&lt;/p&gt;</comment>
                            <comment id="12731539" author="stack" created="Wed, 15 Jul 2009 16:14:22 +0000"  >&lt;p&gt;Your patch seems to be reversed.  Is that possible Eugene?  You want to throw the exception, is that right?&lt;/p&gt;

&lt;p&gt;Have you run into this issue or is this from reading code?&lt;/p&gt;

&lt;p&gt;This code is actually from Hadoop.  Its the Hadoop RPC code with small amendments to suit hbase case.&lt;/p&gt;</comment>
                            <comment id="12731601" author="jkff" created="Wed, 15 Jul 2009 18:14:45 +0000"  >&lt;p&gt;Oops. Sorry, the patch is indeed reversed; I want to throw the exception. Should I re-upload a correct version?&lt;/p&gt;

&lt;p&gt;I have run into this issue and traced it in a debugger: indeed, broken connections were being returned after a regionserver restart, and this issue disappeared when I rethrew the exception.&lt;/p&gt;</comment>
                            <comment id="12738145" author="stack" created="Sun, 2 Aug 2009 23:30:41 +0000"  >&lt;p&gt;Committed to 0.20 branch and TRUNK.  Thanks for the patch Eugene.  I just experienced something similar; there should be more info on busted connection.  Hopefully this helps (I reversed your reversed patch).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12413568" name="hbase-1604.patch" size="588" author="jkff" created="Wed, 15 Jul 2009 15:41:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 15 Jul 2009 15:21:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25858</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 20 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0he8n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99569</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>