<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:48:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13984/HBASE-13984.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13984] Add option to allow caller to know the heartbeat and scanner position when scanner timeout</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13984</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13090&quot; title=&quot;Progress heartbeats for long running scanners&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13090&quot;&gt;&lt;del&gt;HBASE-13090&lt;/del&gt;&lt;/a&gt; introduced scanner heartbeat. However, there are still some limitations (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13215&quot; title=&quot;A limit on the raw key values is needed for each next call of a scanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13215&quot;&gt;&lt;del&gt;HBASE-13215&lt;/del&gt;&lt;/a&gt;). In some application, for example, an operation access hbase to scan table data, and there is strict limit that this call must return in a fixed interval. At the same time, this call is stateless, so the call must return the next position to continue the scan. This is typical use case for online applications.&lt;/p&gt;

&lt;p&gt;Based on this requirement, some improvements are proposed:&lt;br/&gt;
1. Allow client set a flag whether pass the heartbeat (a result contains the scanner position) to the caller (via ResultScanner next)&lt;br/&gt;
2. Allow the client pass a timeout to the server, which can override the server side default value&lt;br/&gt;
3. When requested by the client, the server peek the next cell and return to the client in the heartbeat message&lt;/p&gt;</description>
                <environment></environment>
        <key id="12841228">HBASE-13984</key>
            <summary>Add option to allow caller to know the heartbeat and scanner position when scanner timeout</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="10002" iconUrl="https://issues.apache.org/jira/images/icons/statuses/document.png" description="A patch for this issue has been uploaded to JIRA by a contributor.">Patch Available</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="heliangliang">He Liangliang</assignee>
                                    <reporter username="heliangliang">He Liangliang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 29 Jun 2015 03:01:26 +0000</created>
                <updated>Fri, 20 Nov 2015 16:51:37 +0000</updated>
                                                                            <component>Scanners</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="14608367" author="hadoopqa" created="Tue, 30 Jun 2015 14:23:59 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12742809/HBASE-13984-V1.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12742809/HBASE-13984-V1.diff&lt;/a&gt;&lt;br/&gt;
  against master branch at commit f8bd578b80b4e656d799c82ca1b6191e35bb0ae4.&lt;br/&gt;
  ATTACHMENT ID: 12742809&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 12 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 1901 checkstyle errors (more than the master&apos;s current 1899 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +              new java.lang.String[] &lt;/p&gt;
{ &quot;Region&quot;, &quot;Scan&quot;, &quot;ScannerId&quot;, &quot;NumberOfRows&quot;, &quot;CloseScanner&quot;, &quot;NextCallSeq&quot;, &quot;ClientHandlesPartials&quot;, &quot;ClientHandlesHeartbeats&quot;, &quot;TrackScanMetrics&quot;, &quot;Timeout&quot;, }
&lt;p&gt;);&lt;br/&gt;
+              new java.lang.String[] &lt;/p&gt;
{ &quot;CellsPerResult&quot;, &quot;ScannerId&quot;, &quot;MoreResults&quot;, &quot;Ttl&quot;, &quot;Results&quot;, &quot;Stale&quot;, &quot;PartialFlagPerResult&quot;, &quot;MoreResultsInRegion&quot;, &quot;HeartbeatMessage&quot;, &quot;ScanMetrics&quot;, &quot;Next&quot;, }
&lt;p&gt;);&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14620//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14620//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14620//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14620//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14620//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14620//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14620//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14620//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14610796" author="stack" created="Wed, 1 Jul 2015 18:36:51 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jonathan.lawlor&quot; class=&quot;user-hover&quot; rel=&quot;jonathan.lawlor&quot;&gt;Jonathan Lawlor&lt;/a&gt; FYI&lt;/p&gt;

&lt;p&gt;So, idea is to pass back in the heartbeat, the &apos;next&apos; row that would be encountered so the Scan can be picked up later at this point?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;1. Allow client set a flag whether pass the heartbeat (a fake row) to the caller (via ResultScanner next)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Rather than a global config in hbase Configuration, why is this not an option you&apos;d specify on Scan? (What is an &apos;explicit&apos; heartbeat vs a heartbeat?)&lt;/p&gt;

&lt;p&gt;It seems entangled with client not taking partial results? Does it have to be? Could someone want the next row AND want partial results?&lt;/p&gt;

&lt;p&gt;These &apos;general&apos; additions made just for the exotic case of an heartbeat carrying the next Cell from which to carry on the Scan seems like too much exposure on a pivotal class like ScannerCallable&lt;/p&gt;

&lt;p&gt;+  /**&lt;br/&gt;
+   * @return Return the next cell when the most recent RPC response was a heartbeat message and&lt;br/&gt;
+   *         the server is only allowed break at row boundary. If the next cell is beyond the&lt;br/&gt;
+   *         scan range, null will be returned.&lt;br/&gt;
+   */&lt;br/&gt;
+  protected Cell getNextCell() &lt;/p&gt;
{
+    return nextCell;
+  }
&lt;p&gt;+&lt;br/&gt;
+  protected void setNextCell(Cell nextCell) &lt;/p&gt;
{
+    this.nextCell = nextCell;
+  }

&lt;p&gt;I think it important we get the flagging clean and clear so folks can easily discover the existence of this new facility. Would also like to make it so we can implement it w/o tarnishing meaning of current flags.&lt;/p&gt;

&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=heliangliang&quot; class=&quot;user-hover&quot; rel=&quot;heliangliang&quot;&gt;He Liangliang&lt;/a&gt;&lt;/p&gt;


</comment>
                            <comment id="14613045" author="heliangliang" created="Fri, 3 Jul 2015 09:17:43 +0000"  >&lt;p&gt;&amp;gt;&amp;gt; why is this not an option you&apos;d specify on Scan?&lt;br/&gt;
It&apos;s flexible to put into scan, includes the timeout limit. Explicit means the heartbeat is visible to the caller instead of transparent.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; It seems entangled with client not taking partial results?&lt;br/&gt;
It makes sense, I&apos;ll update this.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt; These &apos;general&apos; additions made just for the exotic case of an heartbeat carrying the next Cell from which to carry on the Scan seems like too much exposure on a pivotal class like ScannerCallable&lt;br/&gt;
We need to read this &apos;next&apos; in ClientScanner, similar to heartbeatMessage filed in ScannerCallable. Or in another word, it&apos;s piggybacked data in a heartbeat message, so we can wrap heartbeatMessage flag and next together into an object and put it in ScannerCallable?&lt;/p&gt;</comment>
                            <comment id="14613193" author="heliangliang" created="Fri, 3 Jul 2015 13:40:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jonathan.lawlor&quot; class=&quot;user-hover&quot; rel=&quot;jonathan.lawlor&quot;&gt;Jonathan Lawlor&lt;/a&gt; Hold on before I make the update&lt;/p&gt;</comment>
                            <comment id="14613207" author="heliangliang" created="Fri, 3 Jul 2015 14:02:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; What is the expected behavior if the user want peek next and also accept partial? Since the kvs in the store heap and the joint heap are not in sort order, so what should the next be if the time limit is reached between scanning two heaps? Looks like next cell is applicable only for non-partial results.&lt;/p&gt;</comment>
                            <comment id="14734805" author="heliangliang" created="Tue, 8 Sep 2015 13:41:14 +0000"  >&lt;p&gt;added allowHeartbeatResults option in scan and isHeartbeat flag in Result&lt;/p&gt;</comment>
                            <comment id="14735137" author="hadoopqa" created="Tue, 8 Sep 2015 16:50:30 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12754630/HBASE-13984-V2.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12754630/HBASE-13984-V2.diff&lt;/a&gt;&lt;br/&gt;
  against master branch at commit e95358a7fc3f554dcbb351c8b7295cafc01e8c23.&lt;br/&gt;
  ATTACHMENT ID: 12754630&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 1837 checkstyle errors (more than the master&apos;s current 1834 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +      if (allowHeartbeatResults &amp;amp;&amp;amp; callable.isHeartbeatMessage() &amp;amp;&amp;amp; callable.getNextCell() != null) {&lt;br/&gt;
+     * This cell is not necessarily belongs to the valid scan results, i.e. it can be a delete marker&lt;br/&gt;
+     * This cell is not necessarily belongs to the valid scan results, i.e. it can be a delete marker&lt;br/&gt;
+     * This cell is not necessarily belongs to the valid scan results, i.e. it can be a delete marker&lt;br/&gt;
+     * This cell is not necessarily belongs to the valid scan results, i.e. it can be a delete marker&lt;br/&gt;
+     * This cell is not necessarily belongs to the valid scan results, i.e. it can be a delete marker&lt;br/&gt;
+     * This cell is not necessarily belongs to the valid scan results, i.e. it can be a delete marker&lt;br/&gt;
+       * This field is filled with the next cell (the first cell of the next row) of the scanner when&lt;br/&gt;
+       * server send heartbeat message after timeout. The cell can be used as start row of a new scan.&lt;br/&gt;
+       * This cell is not necessarily belongs to the valid scan results, i.e. it can be a delete marker&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn post-site goal to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15461//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15461//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15461//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15461//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15461//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15461//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15461//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15461//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14736013" author="heliangliang" created="Wed, 9 Sep 2015 02:27:06 +0000"  >&lt;p&gt;fix checkstyle and retry&lt;/p&gt;</comment>
                            <comment id="14736159" author="stack" created="Wed, 9 Sep 2015 04:43:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;What is the expected behavior if the user want peek next and also accept partial? Since the kvs in the store heap and the joint heap are not in sort order, so what should the next be if the time limit is reached between scanning two heaps? Looks like next cell is applicable only for non-partial results.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Pardon. Missed this. I don&apos;t follow... &apos;not in sort order&apos;.... why when we pull the Cells off are we not in sort order. When you say two heaps, you mean two Stores?&lt;/p&gt;

&lt;p&gt;I think you need to change the names of these methods:&lt;/p&gt;

&lt;p&gt;+  /**&lt;br/&gt;
+   * @return Return the next cell when the most recent RPC response was a heartbeat message and&lt;br/&gt;
+   *         the server is only allowed break at row boundary. If the next cell is beyond the&lt;br/&gt;
+   *         scan range, null will be returned.&lt;br/&gt;
+   */&lt;br/&gt;
+  protected Cell getNextCell() &lt;/p&gt;
{
+    return nextCell;
+  }
&lt;p&gt;+&lt;br/&gt;
+  protected void setNextCell(Cell nextCell) &lt;/p&gt;
{
+    this.nextCell = nextCell;
+  }

&lt;p&gt;They are only in effect when heartbeating is going on... so getHeartbeatNextCell ...&lt;/p&gt;

&lt;p&gt;and ditto here:&lt;/p&gt;

&lt;p&gt;+  optional Cell next = 11;&lt;/p&gt;

&lt;p&gt;should be hearbeatNext.... so stuff is tied together.&lt;/p&gt;

&lt;p&gt;Is this peeking going to mess up the Scan in HRegion or I suppose it will be expensive... will slow scan (but only when this feature is enabled)?&lt;/p&gt;

&lt;p&gt;+          Cell nextKv = this.storeHeap.peek();&lt;/p&gt;

&lt;p&gt;Otherwise patch is good. Needs a nice release note so folks know how to use it.&lt;/p&gt;

&lt;p&gt;Let me rerun the patch build. Was hung....(infra, not your patch)&lt;/p&gt;</comment>
                            <comment id="14736326" author="hadoopqa" created="Wed, 9 Sep 2015 07:04:03 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12754818/HBASE-13984-V3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12754818/HBASE-13984-V3.patch&lt;/a&gt;&lt;br/&gt;
  against master branch at commit e95358a7fc3f554dcbb351c8b7295cafc01e8c23.&lt;br/&gt;
  ATTACHMENT ID: 12754818&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +              new java.lang.String[] &lt;/p&gt;
{ &quot;Region&quot;, &quot;Scan&quot;, &quot;ScannerId&quot;, &quot;NumberOfRows&quot;, &quot;CloseScanner&quot;, &quot;NextCallSeq&quot;, &quot;ClientHandlesPartials&quot;, &quot;ClientHandlesHeartbeats&quot;, &quot;TrackScanMetrics&quot;, &quot;Timeout&quot;, }
&lt;p&gt;);&lt;br/&gt;
+              new java.lang.String[] &lt;/p&gt;
{ &quot;CellsPerResult&quot;, &quot;ScannerId&quot;, &quot;MoreResults&quot;, &quot;Ttl&quot;, &quot;Results&quot;, &quot;Stale&quot;, &quot;PartialFlagPerResult&quot;, &quot;MoreResultsInRegion&quot;, &quot;HeartbeatMessage&quot;, &quot;ScanMetrics&quot;, &quot;Next&quot;, }
&lt;p&gt;);&lt;br/&gt;
+      &quot;name\030\005 \001(\t\&quot;\032\n\004Type\022\t\n\005HFILE\020\001\022\007\n\003WAL\020\002\&quot;\323&quot; +&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn post-site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportExport&lt;br/&gt;
                  org.apache.hadoop.hbase.util.TestProcessBasedCluster&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15489//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15489//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15489//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15489//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15489//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15489//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15489//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15489//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14902488" author="heliangliang" created="Tue, 22 Sep 2015 12:27:11 +0000"  >&lt;p&gt;&quot;not in sort order&quot; means for each row the scanner first fetch from storeHeap, then from joinedHeap, but the kvs in joinedHeap may less than kvs from storeHeap so there is a final sort before returning to client. This feature require break between rows just because the current implementation does not support seek in the middle of a row for a new scanner.&lt;/p&gt;

&lt;p&gt;Renamed nextCell.&lt;/p&gt;

&lt;p&gt;Added a flag which controls the peek call.&lt;/p&gt;</comment>
                            <comment id="14902729" author="hadoopqa" created="Tue, 22 Sep 2015 14:39:28 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12761626/HBASE-13984-V4.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12761626/HBASE-13984-V4.diff&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 45d67435adc9195325bfccc78b7e1a0202a446e5.&lt;br/&gt;
  ATTACHMENT ID: 12761626&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 5 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +              new java.lang.String[] &lt;/p&gt;
{ &quot;Region&quot;, &quot;Scan&quot;, &quot;ScannerId&quot;, &quot;NumberOfRows&quot;, &quot;CloseScanner&quot;, &quot;NextCallSeq&quot;, &quot;ClientHandlesPartials&quot;, &quot;ClientHandlesHeartbeats&quot;, &quot;TrackScanMetrics&quot;, &quot;Timeout&quot;, &quot;HeartbeatReturnNext&quot;, }
&lt;p&gt;);&lt;br/&gt;
+              new java.lang.String[] &lt;/p&gt;
{ &quot;CellsPerResult&quot;, &quot;ScannerId&quot;, &quot;MoreResults&quot;, &quot;Ttl&quot;, &quot;Results&quot;, &quot;Stale&quot;, &quot;PartialFlagPerResult&quot;, &quot;MoreResultsInRegion&quot;, &quot;HeartbeatMessage&quot;, &quot;ScanMetrics&quot;, &quot;HeartbeatNext&quot;, }
&lt;p&gt;);&lt;br/&gt;
+      &quot;name\030\005 \001(\t\&quot;\032\n\004Type\022\t\n\005HFILE\020\001\022\007\n\003WAL\020\002\&quot;\323&quot; +&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15669//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15669//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15669//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15669//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15669//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15669//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15669//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15669//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15669//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15669//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14909352" author="apurtell" created="Sat, 26 Sep 2015 17:13:23 +0000"  >&lt;p&gt;This looks like an unrelated fix, let&apos;s use a separate issue for it:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/hbase-protocol/pom.xml b/hbase-protocol/pom.xml
index 20ea50c..274e185 100644
--- a/hbase-protocol/pom.xml
+++ b/hbase-protocol/pom.xml
@@ -193,6 +193,7 @@
                           &amp;lt;include&amp;gt;RowProcessor.proto&amp;lt;/include&amp;gt;
                           &amp;lt;include&amp;gt;RPC.proto&amp;lt;/include&amp;gt;
                           &amp;lt;include&amp;gt;SecureBulkLoad.proto&amp;lt;/include&amp;gt;
+                          &amp;lt;include&amp;gt;Snapshot.proto&amp;lt;/include&amp;gt;
                           &amp;lt;include&amp;gt;Tracing.proto&amp;lt;/include&amp;gt;
                           &amp;lt;include&amp;gt;VisibilityLabels.proto&amp;lt;/include&amp;gt;
                           &amp;lt;include&amp;gt;WAL.proto&amp;lt;/include&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I don&apos;t see in the unit test changes where the new feature is tested. Where do we get the &quot;heartbeat cell&quot; from a Result and use it to make a new scan? Did I miss it? Edit: To clarify, I was looking for something where we set up some test data, run a scan without using the new feature (I guess not using heartbeats at all), count the results, then do it again with &apos;heartbeat cells&apos; and timeouts and creating a new scan with startRow set appropriately, count the accumulated results again, finally confirm everything matches up. &lt;/p&gt;</comment>
                            <comment id="15018024" author="heliangliang" created="Fri, 20 Nov 2015 13:37:03 +0000"  >&lt;p&gt;Add tests for all cases in TestFromClientSide&lt;/p&gt;</comment>
                            <comment id="15018030" author="heliangliang" created="Fri, 20 Nov 2015 13:39:00 +0000"  >&lt;p&gt;There is one case in TestScannerHeartbeatMessages but added more in the new patch.&lt;/p&gt;</comment>
                            <comment id="15018315" author="hadoopqa" created="Fri, 20 Nov 2015 16:51:37 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12773509/HBASE-13984-V5.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12773509/HBASE-13984-V5.diff&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 86be690b0723e814a655ad0ae8a6577d7111c1f2.&lt;br/&gt;
  ATTACHMENT ID: 12773509&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 20 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 18699 checkstyle errors (more than the master&apos;s current 18690 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 lineLengths&lt;/font&gt;.  The patch introduces the following lines longer than 100:&lt;br/&gt;
    +      &quot;\002 \001(\004\022\024\n\014more_results\030\003 \001(\010\022\013\n\003ttl\030\004 \001(\r&quot; +&lt;br/&gt;
+              new java.lang.String[] &lt;/p&gt;
{ &quot;Region&quot;, &quot;Scan&quot;, &quot;ScannerId&quot;, &quot;NumberOfRows&quot;, &quot;CloseScanner&quot;, &quot;NextCallSeq&quot;, &quot;ClientHandlesPartials&quot;, &quot;ClientHandlesHeartbeats&quot;, &quot;TrackScanMetrics&quot;, &quot;Timeout&quot;, &quot;HeartbeatReturnNext&quot;, }
&lt;p&gt;);&lt;br/&gt;
+              new java.lang.String[] &lt;/p&gt;
{ &quot;CellsPerResult&quot;, &quot;ScannerId&quot;, &quot;MoreResults&quot;, &quot;Ttl&quot;, &quot;Results&quot;, &quot;Stale&quot;, &quot;PartialFlagPerResult&quot;, &quot;MoreResultsInRegion&quot;, &quot;HeartbeatMessage&quot;, &quot;ScanMetrics&quot;, &quot;HeartbeatNext&quot;, }
&lt;p&gt;);&lt;br/&gt;
+      &quot;name\030\005 \001(\t\&quot;\032\n\004Type\022\t\n\005HFILE\020\001\022\007\n\003WAL\020\002\&quot;\323&quot; +&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16615//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16615//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16615//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16615//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16615//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16615//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/16615//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/16615//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                            <outwardlinks description="duplicates">
                                        <issuelink>
            <issuekey id="12781388">HBASE-13215</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12742809" name="HBASE-13984-V1.diff" size="78466" author="heliangliang" created="Tue, 30 Jun 2015 11:30:40 +0000"/>
                            <attachment id="12754630" name="HBASE-13984-V2.diff" size="163774" author="heliangliang" created="Tue, 8 Sep 2015 13:41:14 +0000"/>
                            <attachment id="12754801" name="HBASE-13984-V3.diff" size="163526" author="heliangliang" created="Wed, 9 Sep 2015 02:38:05 +0000"/>
                            <attachment id="12754818" name="HBASE-13984-V3.patch" size="163526" author="stack" created="Wed, 9 Sep 2015 04:43:37 +0000"/>
                            <attachment id="12761626" name="HBASE-13984-V4.diff" size="178077" author="heliangliang" created="Tue, 22 Sep 2015 12:14:49 +0000"/>
                            <attachment id="12773509" name="HBASE-13984-V5.diff" size="198378" author="heliangliang" created="Fri, 20 Nov 2015 13:37:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 30 Jun 2015 14:23:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2glw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Added a scan option to allow the heartbeat visiable to the caller. &lt;br/&gt;
When this option is set true, the client scanner iterator will yield a heartbeat result which contains the next cell when time limit is reached in the server side. In this case, the scanner will only break in the boundary of rows, so the heartbeat result rowkey can be used as the start row in the new scanner to continue the scan.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                        </customfields>
    </item>
</channel>
</rss>