<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:36:01 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6354/HBASE-6354.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6354] Wait till hard fail in case of erratic zookeeper session expiry</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6354</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There are number of tests that depends on zookeeper expire session (HBaseTestingUtility#expireSession). The current approach is to create handles on the existing sessions and call a close() on one of the handle. It closes all the handles associated with this session. This should work in theory but sometimes, it just doesn&apos;t work (don&apos;t know the root cause yet).&lt;br/&gt;
We need to do some hacks ( such as in TestZookeeper#testClientSessionExpired).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12597923">HBASE-6354</key>
            <summary>Wait till hard fail in case of erratic zookeeper session expiry</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="v.himanshu">Himanshu Vashishtha</reporter>
                        <labels>
                    </labels>
                <created>Sun, 8 Jul 2012 01:32:51 +0000</created>
                <updated>Sun, 8 Jul 2012 23:48:57 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13408828" author="v.himanshu" created="Sun, 8 Jul 2012 01:34:16 +0000"  >&lt;p&gt;There is some more context in the last few comments of HBase-5549&lt;/p&gt;</comment>
                            <comment id="13408830" author="v.himanshu" created="Sun, 8 Jul 2012 01:37:49 +0000"  >&lt;p&gt;Attached is a patch with that approach. I tested it by running some TestReplicationPeer class, which use the changed method.&lt;/p&gt;</comment>
                            <comment id="13409018" author="stack" created="Sun, 8 Jul 2012 18:31:30 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;[] isClosed = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;[] { &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; };
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;isClosed is name of a method that would check the closed boolean.  Suggest changing name of variable above to closed.&lt;/p&gt;

&lt;p&gt;Are you using above because you want to change setting of a a final?  Use AtomicBoolean instead?&lt;/p&gt;

&lt;p&gt;Maybe change this to be 100ms rather than 1000ms:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        isClosed.wait(1000);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;...because of the recommendation in &quot;15.5.2.5.2. Sleeps in tests&quot; in the reference guide.&lt;/p&gt;

&lt;p&gt;I&apos;d be game for trying this approach Himanshu.  Would be good to know &quot;root cause&quot; why current approach does not work.&lt;/p&gt;

</comment>
                            <comment id="13409104" author="v.himanshu" created="Sun, 8 Jul 2012 23:42:34 +0000"  >&lt;p&gt;Changes done in the second patch. It always passes when ran in junit in eclipse, but it failed (and timed out) when running as mvn test. jstack shows the thread running the test suite (Surefire) waits (TIMED_WAITING) on the atomic boolean object (which makes sense as zookeeper didn&apos;t invoke the process method on the watcher); the only other thread that waits (timed_waiting) was SessionTracker (instance of SessionTrackerImpl) at the following code, &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nextExpirationTime &amp;gt; currentTime) {
                    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.wait(nextExpirationTime - currentTime);
                    &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
                }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This does a timed wait, so, it shouldn&apos;t cause the test to timed out (i.e., block this thread for 5 minutes when the default tick time is 5 seconds). I find the thread blocking on the same condition even after 2 minutes. Still looking into it. &lt;br/&gt;
What is the difference between mvn environment and eclipse environment (when we run the junit test). I am using 3.4.3 jar in eclipse environment.&lt;/p&gt;</comment>
                            <comment id="13409105" author="v.himanshu" created="Sun, 8 Jul 2012 23:44:04 +0000"  >&lt;p&gt;And by failed in mvn, I mean it failed like 1 in 10 ran); but on eclipse, it always pass (ran 15+ times)&lt;/p&gt;</comment>
                            <comment id="13409108" author="v.himanshu" created="Sun, 8 Jul 2012 23:46:40 +0000"  >&lt;p&gt;jstack of the failed test (TestReplicationPeer timed out after 5 minutes)&lt;/p&gt;</comment>
                            <comment id="13409109" author="v.himanshu" created="Sun, 8 Jul 2012 23:48:57 +0000"  >&lt;p&gt;Thanks for the comments Stack.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12535553" name="HBase6354-v1.patch" size="3068" author="v.himanshu" created="Sun, 8 Jul 2012 01:37:49 +0000"/>
                            <attachment id="12535603" name="HBase6354-v2.patch" size="3370" author="v.himanshu" created="Sun, 8 Jul 2012 23:48:57 +0000"/>
                            <attachment id="12535602" name="jstack#failedTest1" size="10266" author="v.himanshu" created="Sun, 8 Jul 2012 23:46:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 8 Jul 2012 18:31:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241889</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 23 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02g93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12234</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>