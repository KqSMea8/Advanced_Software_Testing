<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:51:20 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14262/HBASE-14262.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14262] Big Trunk unit tests failing with &quot;OutOfMemoryError: unable to create new native thread&quot;</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14262</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The bit unit tests are coming in with OOME, can&apos;t create native threads.&lt;/p&gt;

&lt;p&gt;I was also getting the OOME locally running on MBP. git bisect got me to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13065&quot; title=&quot;Increasing -Xmx when running TestDistributedLogSplitting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13065&quot;&gt;&lt;del&gt;HBASE-13065&lt;/del&gt;&lt;/a&gt;, where we upped the test heap for TestDistributedLogSplitting back in feb. Around the time that this went in, we had similar OOME issues but then it was because we were doing 32bit JVMs. It does not seem to be the case here.&lt;/p&gt;

&lt;p&gt;A recent run failed all the below and most are OOME:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     {color:red}-1 core tests{color}.  The patch failed these unit tests:
                       org.apache.hadoop.hbase.replication.TestReplicationEndpoint
                  org.apache.hadoop.hbase.replication.TestPerTableCFReplication
                  org.apache.hadoop.hbase.wal.TestBoundedRegionGroupingProvider
                  org.apache.hadoop.hbase.replication.TestReplicationKillMasterRSCompressed
                  org.apache.hadoop.hbase.replication.regionserver.TestRegionReplicaReplicationEndpointNoMaster
                  org.apache.hadoop.hbase.replication.TestReplicationKillSlaveRS
                  org.apache.hadoop.hbase.replication.regionserver.TestRegionReplicaReplicationEndpoint
                  org.apache.hadoop.hbase.replication.TestMasterReplication
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce
                  org.apache.hadoop.hbase.regionserver.TestRegionMergeTransactionOnCluster
                  org.apache.hadoop.hbase.regionserver.TestRegionFavoredNodes
                  org.apache.hadoop.hbase.replication.TestMultiSlaveReplication
                  org.apache.hadoop.hbase.zookeeper.TestZKLeaderManager
                  org.apache.hadoop.hbase.master.TestMasterRestartAfterDisablingTable
                  org.apache.hadoop.hbase.TestGlobalMemStoreSize
                  org.apache.hadoop.hbase.wal.TestWALFiltering
                  org.apache.hadoop.hbase.replication.TestReplicationSmallTests
                  org.apache.hadoop.hbase.replication.TestReplicationSyncUpTool
                  org.apache.hadoop.hbase.replication.TestReplicationWithTags
                  org.apache.hadoop.hbase.master.procedure.TestTruncateTableProcedure
                  org.apache.hadoop.hbase.replication.TestReplicationChangingPeerRegionservers
                  org.apache.hadoop.hbase.wal.TestDefaultWALProviderWithHLogKey
                  org.apache.hadoop.hbase.regionserver.TestPerColumnFamilyFlush
                  org.apache.hadoop.hbase.snapshot.TestMobRestoreFlushSnapshotFromClient
                  org.apache.hadoop.hbase.master.procedure.TestCreateTableProcedure
                  org.apache.hadoop.hbase.wal.TestWALFactory
                  org.apache.hadoop.hbase.master.procedure.TestServerCrashProcedure
                  org.apache.hadoop.hbase.replication.TestReplicationDisableInactivePeer
                  org.apache.hadoop.hbase.master.procedure.TestAddColumnFamilyProcedure
                  org.apache.hadoop.hbase.mapred.TestMultiTableSnapshotInputFormat
                  org.apache.hadoop.hbase.master.procedure.TestEnableTableProcedure
                  org.apache.hadoop.hbase.master.TestMasterFailoverBalancerPersistence
                  org.apache.hadoop.hbase.TestStochasticBalancerJmxMetrics

     {color:red}-1 core zombie tests{color}.  There are 16 zombie test(s):      at org.apache.hadoop.hbase.security.visibility.TestVisibilityLabels.testVisibilityLabelsWithComplexLabels(TestVisibilityLabels.java:216)
        at org.apache.hadoop.hbase.mapred.TestTableInputFormat.testTableRecordReaderScannerFail(TestTableInputFormat.java:281)
        at org.apache.hadoop.hbase.replication.TestMultiSlaveReplication.testMultiSlaveReplication(TestMultiSlaveReplication.java:129)
        at org.apache.hadoop.hbase.regionserver.TestHRegion.testWritesWhileScanning(TestHRegion.java:3799)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12857363">HBASE-14262</key>
            <summary>Big Trunk unit tests failing with &quot;OutOfMemoryError: unable to create new native thread&quot;</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Aug 2015 23:44:20 +0000</created>
                <updated>Thu, 20 Aug 2015 18:39:17 +0000</updated>
                                                                            <component>test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                            <comments>
                            <comment id="14703993" author="stack" created="Wed, 19 Aug 2015 23:51:57 +0000"  >&lt;p&gt;Above happened when we ran on:&lt;/p&gt;

&lt;p&gt;&quot;Building remotely on H9 (Mapreduce Falcon Hadoop Pig Zookeeper Tez Hdfs) in workspace /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build&quot;&lt;br/&gt;
...&lt;br/&gt;
/home/jenkins/jenkins-slave/tools/hudson.model.JDK/jdk-1.7u51/bin/java&lt;br/&gt;
java version &quot;1.7.0_51&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.7.0_51-b13)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 24.51-b03, mixed mode)&lt;br/&gt;
/home/jenkins/jenkins-slave/tools/hudson.model.JDK/jdk-1.7u51&lt;br/&gt;
java version &quot;1.7.0_51&quot;&lt;br/&gt;
Java(TM) SE Runtime Environment (build 1.7.0_51-b13)&lt;br/&gt;
Java HotSpot(TM) 64-Bit Server VM (build 24.51-b03, mixed mode)&lt;br/&gt;
...&lt;br/&gt;
Here is the link: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15169//consoleFull&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15169//consoleFull&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Also here on H1: &lt;a href=&quot;https://builds.apache.org/view/H-L/view/HBase/job/PreCommit-HBASE-Build/15167/consoleFull&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/H-L/view/HBase/job/PreCommit-HBASE-Build/15167/consoleFull&lt;/a&gt;&lt;br/&gt;
... and on H6: &lt;a href=&quot;https://builds.apache.org/view/H-L/view/HBase/job/PreCommit-HBASE-Build/15164/consoleFull&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/H-L/view/HBase/job/PreCommit-HBASE-Build/15164/consoleFull&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Something has changed.&lt;/p&gt;</comment>
                            <comment id="14704067" author="stack" created="Thu, 20 Aug 2015 00:50:53 +0000"  >&lt;p&gt;H9 ran all tests w/o OOME here: &lt;a href=&quot;https://builds.apache.org/view/H-L/view/HBase/job/PreCommit-HBASE-Build/15125/console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/H-L/view/HBase/job/PreCommit-HBASE-Build/15125/console&lt;/a&gt; Aug 17, 2015 7:14:53 AM&lt;/p&gt;

&lt;p&gt;Here is where the OOMEs start after going back a ways.&lt;/p&gt;

&lt;p&gt;Failed &amp;gt; Console Output  #15134	Aug 18, 2015 5:10:02 AM&lt;/p&gt;

&lt;p&gt;Seems to be precommit only. Not seeing it in trunk builds but haven&apos;t seen a machine overlap between precommit and trunk just yet (and trunk build not running often enough).&lt;/p&gt;

&lt;p&gt;If I revert &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13065&quot; title=&quot;Increasing -Xmx when running TestDistributedLogSplitting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13065&quot;&gt;&lt;del&gt;HBASE-13065&lt;/del&gt;&lt;/a&gt;, TestAcidGuarantees passes on my local mac...&lt;/p&gt;

</comment>
                            <comment id="14704233" author="apache9" created="Thu, 20 Aug 2015 03:20:37 +0000"  >&lt;blockquote&gt;
&lt;p&gt;If I revert &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13065&quot; title=&quot;Increasing -Xmx when running TestDistributedLogSplitting&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13065&quot;&gt;&lt;del&gt;HBASE-13065&lt;/del&gt;&lt;/a&gt;, TestAcidGuarantees passes on my local mac...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This could happen since reduce heap size also means increase native memory size we could use so we can create more threads...&lt;/p&gt;

&lt;p&gt;And I used to deal with TestAcidGuarantees when the new AsyncRpcClient is introduced. I remember that finally I create a static EventLoopGroup and make all AsyncRpcClient share it to reduce thread number...&lt;/p&gt;

&lt;p&gt;So I suggest we verify the jstack result first to see if we really create too many threads? Maybe we are reaching the precipice, so sometimes it fails and sometimes not...&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="14704287" author="chenheng" created="Thu, 20 Aug 2015 04:53:44 +0000"  >&lt;p&gt;Agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=Apache9&quot; class=&quot;user-hover&quot; rel=&quot;Apache9&quot;&gt;Duo Zhang&lt;/a&gt;,  we can use BlockingQueue in &lt;tt&gt;TestContext&lt;/tt&gt; instead of &lt;tt&gt;Set&amp;lt;TestThread&amp;gt; testThreads&lt;/tt&gt;,  then we use a threads pool with less thread number, which pick task from BlockingQueue to run.&lt;/p&gt;</comment>
                            <comment id="14705530" author="stack" created="Thu, 20 Aug 2015 18:39:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;So I suggest we verify the jstack result first to see if we really create too many threads? Maybe we are reaching the precipice, so sometimes it fails and sometimes not...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Looking. In TestDistributedLogReplay (I am looking at this test first because &lt;a href=&quot;https://issues.apache.org/jira/browse/INFRA-10150&quot; title=&quot;HBase Jenkins builds fail due to &amp;#39;unable to create new native thread&amp;#39; error&quot; class=&quot;issue-link&quot; data-issue-key=&quot;INFRA-10150&quot;&gt;&lt;del&gt;INFRA-10150&lt;/del&gt;&lt;/a&gt; flags it as a zombie), we start 6 servers so unit test is running with 450+ threads. Let me dig in more (seems to be a shutdown issue here too).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12857380">INFRA-10315</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12857625">HBASE-14274</subtask>
                            <subtask id="12857733">HBASE-14278</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 20 Aug 2015 03:20:37 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 17 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j4nb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>