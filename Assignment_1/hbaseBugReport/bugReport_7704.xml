<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:48:17 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7704/HBASE-7704.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7704] migration tool that checks presence of HFile V1 files</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7704</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Below was Stack&apos;s comment from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7660&quot; title=&quot;Remove HFileV1 code&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7660&quot;&gt;&lt;del&gt;HBASE-7660&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;Regards the migration &apos;tool&apos;, or &apos;tool&apos; to check for presence of v1 files, I imagine it as an addition to the hfile tool &lt;a href=&quot;http://hbase.apache.org/book.html#hfile_tool2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hbase.apache.org/book.html#hfile_tool2&lt;/a&gt; The hfile tool already takes a bunch of args including printing out meta. We could add an option to print out version only &#8211; or return 1 if version 1 or some such &#8211; and then do a bit of code to just list all hfiles and run this script against each. Could MR it if too many files.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12629640">HBASE-7704</key>
            <summary>migration tool that checks presence of HFile V1 files</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="v.himanshu">Himanshu Vashishtha</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Tue, 29 Jan 2013 05:53:31 +0000</created>
                <updated>Mon, 23 Sep 2013 19:08:28 +0000</updated>
                            <resolved>Tue, 23 Apr 2013 05:51:02 +0000</resolved>
                                                    <fixVersion>0.95.1</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13621166" author="stack" created="Wed, 3 Apr 2013 18:45:16 +0000"  >&lt;p&gt;Here is more on how I think this would work (if anyone is listening).&lt;/p&gt;

&lt;p&gt;We want a script that we can run that goes through all the hfiles in an hbase install and returns code 0 if no v1 files found and non-zero if any v1 files are found (It should fail out as soon as it finds a v1 file).&lt;/p&gt;

&lt;p&gt;This script can be run while an hbase cluster is up.&lt;/p&gt;

&lt;p&gt;Script should be called something like v1Free or noV1HFiles&lt;/p&gt;

&lt;p&gt;Script can be in java or jruby since a one-off just needed to check an hbase install BEFORE we do an upgrade.&lt;/p&gt;

&lt;p&gt;Script should implement &lt;a href=&quot;http://hadoop.apache.org/docs/r2.0.3-alpha/api/org/apache/hadoop/util/Tool.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hadoop.apache.org/docs/r2.0.3-alpha/api/org/apache/hadoop/util/Tool.html&lt;/a&gt; so it can pick up configuration to find hbase to run against (I suppose this means it is a java script).&lt;/p&gt;

&lt;p&gt;Ideally, script should be done in a manner such that if we need to use it in a mapreduce job, it&apos;d be easy to do (we do not need the mapreduce job as part of this JIRA I would say).  I think this means that in the script there is a method which takes fully qualified hfile Path and returns true/false.&lt;/p&gt;

&lt;p&gt;Would suggest that script have an executor service and take on the command line how many concurrent threads to run w/ a reasonable default so that the checking is done in parallel.&lt;/p&gt;

&lt;p&gt;So, the script would walk the hbase.rootdir looking for hfiles.  Look at hbase file utils because will need to skip over special files and directories.  Per file found, it would read in its metadata and check for v1.  See hfile for how it finds metadata at end of file.&lt;/p&gt;</comment>
                            <comment id="13621187" author="v.himanshu" created="Wed, 3 Apr 2013 18:59:31 +0000"  >&lt;p&gt;I have started working on this. I am using the approach of a java standalone program (aka tool), which has an executor service. It takes in a hbase directory path, and look for table directories (checking the presence of .tableinfo file). Then, it dives in to the table directory and look for any v1 file, and list it out. I was not thinking to make it a failfast one, as it is good to see all such files in one go (they may be in different region/tables)?&lt;/p&gt;

&lt;p&gt;Yes, this should be done before user actually migrate. As we have removed all v1 related code from 0.95, it can&apos;t compact on its own. Therefore, user will run this script and check for the presence of any v1 file, and run compaction on it.?&lt;/p&gt;</comment>
                            <comment id="13621212" author="stack" created="Wed, 3 Apr 2013 19:12:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=himanshu%40cloudera.com&quot; class=&quot;user-hover&quot; rel=&quot;himanshu@cloudera.com&quot;&gt;Himanshu Vashishtha&lt;/a&gt; Thanks.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It takes in a hbase directory path, and look for table directories (checking the presence of .tableinfo file). &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If it is a &apos;Tool&apos;, then, it will read Configurations off the CLASSPATH.  If so, it will have access to the hbase-default hbase.rootdir configuration. Given this, does it need to take a directory as input?  Also, since a Tool, you could override the property with -Dhbase.rootdir.&lt;/p&gt;

&lt;p&gt;Or are you thinking that you should be able to point the tool at a subset of the hbase.rootdir content, say the a table directory?&lt;/p&gt;

&lt;p&gt;That could be good to have (if not directory specified, use hbase.rootdir from the Configuration, else use what is passed).&lt;/p&gt;

&lt;p&gt;Would suggest you Options parser that is in the HFilePRettyPrint.&lt;/p&gt;

&lt;p&gt;Ok on NOT failing fast.  Lets go your route.  Going your route, seeing the paths to the v1 files will let operator know what tables need compacting.&lt;/p&gt;

&lt;p&gt;Thanks boss.&lt;/p&gt;</comment>
                            <comment id="13621908" author="v.himanshu" created="Thu, 4 Apr 2013 08:04:32 +0000"  >&lt;p&gt;A tool that detects any HFile V1 in a given directory. If no argument is given, it takes the hbase.rootdir directory.&lt;/p&gt;

&lt;p&gt;It prints the help with --h option.&lt;br/&gt;
java -cp `hbase classpath` org.apache.hadoop.hbase.util.HFileV1Detector --h&lt;/p&gt;</comment>
                            <comment id="13622462" author="stack" created="Thu, 4 Apr 2013 16:09:20 +0000"  >&lt;p&gt;license&lt;/p&gt;

&lt;p&gt;Extra &apos;a&apos; in &quot;in the a given directory&quot;&lt;/p&gt;

&lt;p&gt;Would suggest you add to the class comment how to run it.&lt;/p&gt;

&lt;p&gt;Does &quot;./bin/hbase org.apache.hadoop.hbase.util.HFileV1Detector --h&quot; work?&lt;/p&gt;

&lt;p&gt;&apos;-&lt;del&gt;h&apos; is not right.  gnu long form would be &apos;&lt;/del&gt;&lt;del&gt;help&apos;.  Java usual is &apos;-h&apos;.  Pick one or the other (preferably support both) but not &apos;&lt;/del&gt;-h&apos;... no one will guess that as way to get help.&lt;/p&gt;

&lt;p&gt;Suggest you show us what &apos;-h&apos; output looks like here in this issue:&lt;/p&gt;

&lt;p&gt;Suggest it return -1 if hfilev1 files found: +    return 0;&lt;/p&gt;

&lt;p&gt;It is odd that you create the executor in the run and do not then pass it to the methods that use it &amp;#8211; rather they presume it set as a data member.&lt;/p&gt;

&lt;p&gt;Use GnuParser rather than PosixParser&lt;/p&gt;

&lt;p&gt;This is good:&lt;/p&gt;

&lt;p&gt;+      System.out&lt;br/&gt;
+          .println(&quot;In case no option is provided, it process hbase.rootdir with 10 threads.&quot;);&lt;/p&gt;

&lt;p&gt;But &apos;processes&apos; rather tha &apos;process&apos; and &apos;using&apos; rather than &apos;with&apos;&lt;/p&gt;

&lt;p&gt;What will you ignore?&lt;/p&gt;

&lt;p&gt;+        LOG.info(&quot;Ignoring path: &quot; + fsStat.getPath());&lt;/p&gt;

&lt;p&gt;.logs etc?&lt;/p&gt;

&lt;p&gt;Shouldn&apos;t be info level.&lt;/p&gt;

&lt;p&gt;You keep saying you are going to print regions that have v1 files but you seem to be printing out full path&lt;/p&gt;

&lt;p&gt;+          System.out.println(&quot;Region has a hfile v1: &quot; + f.get());&lt;/p&gt;

&lt;p&gt;Don&apos;t need that &apos;Region has a hfile v1&apos; prefix&lt;/p&gt;

&lt;p&gt;Suggest you list what the output looks like here in this issue.  Will help give you feedback.&lt;/p&gt;

&lt;p&gt;Suggest an option that will fast fail... fail as soon as it finds the first v1.  This is probably not important so if it takes a while, just punt.&lt;/p&gt;

&lt;p&gt;Don&apos;t need this&lt;/p&gt;

&lt;p&gt;+      System.out.println(&quot;Table &quot; + p + &quot; has no HFileV1.&quot;);&lt;/p&gt;

&lt;p&gt;and probably not this...&lt;/p&gt;

&lt;p&gt;+      System.out.println(&quot;Table &quot; + p + &quot; has &quot;&lt;ins&gt;hfileV1Set.size()&lt;/ins&gt;&quot; number of HFileV1.&quot;);&lt;/p&gt;


&lt;p&gt;What is this about?&lt;/p&gt;

&lt;p&gt;+                LOG.warn(&quot;Found a v1 hfile, &quot; + storeFilePath);&lt;br/&gt;
+                System.out.println(&quot;Found a v1 hfile, &quot; + storeFilePath);&lt;/p&gt;

&lt;p&gt;A warn and a print?  And don&apos;t you print out v1 files found at a higher level?&lt;/p&gt;

&lt;p&gt;Why not include original exception here: +              throw new IOException(&quot;Unknown version for hfile: &quot; + storeFilePath);?&lt;/p&gt;

&lt;p&gt;It looks like you do fail fast &amp;#8211; you stop scanning a family as soon as you find a v1 file?&lt;/p&gt;

&lt;p&gt;Drop this kind of stuff:&lt;/p&gt;

&lt;p&gt;+    System.out.println(&quot;==================Regions to Major Compact==============&quot;);&lt;/p&gt;






</comment>
                            <comment id="13622594" author="sershe" created="Thu, 4 Apr 2013 18:08:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;Please use a positive number less than 100 for number of threads&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;nit: Actually the check allows 100; the default value could be logged from constant.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;does not exists:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;exist&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;if (isRegionDir(fs, fsStat.getPath())) {
Others will be skipped silently, intended?

bq. List&amp;lt;Future&amp;lt;Path&amp;gt;&amp;gt; l
Is it possible to name it differently?

bq.  a hfile v1
&quot;an&quot;? not certain actually, I am not a native speaker either :)
Also, it seems like it would only return the first file, might make sense to qualify (&quot;at least one HFile ...&quot;)?

bq. number of HFileV1.
It&apos;s actually the number of regions with such files.

bq.  Path p;
Why does p have to be a field? It&apos;s only used in call().

bq. } catch (IllegalArgumentException iae) {&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;why IllegalArgumentException in particular?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;throw new IOException(&quot;Unknown version for hfile: &quot; + storeFilePath);&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Does this exception have to be thrown? It seems that corrupted files will be added regardless, and caller will just catch and print it.&lt;/p&gt;

</comment>
                            <comment id="13622596" author="sershe" created="Thu, 4 Apr 2013 18:08:23 +0000"  >&lt;p&gt;can someone please delete the above comment?&lt;/p&gt;</comment>
                            <comment id="13622599" author="sershe" created="Thu, 4 Apr 2013 18:09:31 +0000"  >&lt;blockquote&gt;&lt;p&gt;Please use a positive number less than 100 for number of threads&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;nit: Actually the check allows 100; the default value could be logged from constant.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;does not exists:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;exist&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isRegionDir(fs, fsStat.getPath())) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Others will be skipped silently, intended?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  List&amp;lt;Future&amp;lt;Path&amp;gt;&amp;gt; l &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;Is it possible to name it differently?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;a hfile v1&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;&quot;an&quot;? not certain actually, I am not a native speaker either &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Also, it seems like it would only return the first file, might make sense to qualify (&quot;at least one HFile ...&quot;)?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;number of HFileV1.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It&apos;s actually the number of regions with such files.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Path p;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Why does p have to be a field? It&apos;s only used in call().&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (IllegalArgumentException iae) &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;why IllegalArgumentException in particular?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unknown version &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hfile: &quot;&lt;/span&gt; + storeFilePath); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 
&lt;p&gt;Does this exception have to be thrown? It seems that corrupted files will be added regardless, and caller will just catch and print it.&lt;/p&gt;

</comment>
                            <comment id="13622660" author="v.himanshu" created="Thu, 4 Apr 2013 18:56:15 +0000"  >&lt;p&gt;Thanks for the reviews guys:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Would suggest you add to the class comment how to run it.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Will do.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Does &quot;./bin/hbase org.apache.hadoop.hbase.util.HFileV1Detector --h&quot; work?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Suggest you show us what &apos;-h&apos; output looks like here in this issue:&lt;/p&gt;&lt;/blockquote&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/hbase org.apache.hadoop.hbase.util.HFileV1Detector -help
usage: HFileV1Detector [-h] [-n &amp;lt;arg&amp;gt;] [-p &amp;lt;arg&amp;gt;]
 -h,--help                    Help
 -n,--numberOfThreads &amp;lt;arg&amp;gt;   &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of threads
 -p,--path &amp;lt;arg&amp;gt;              Path to table
In &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; no option is provided, it process hbase.rootdir with 10 threads.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The help section is printed with -h, --h, -help, and --help&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Suggest it return -1 if hfilev1 files found: + return 0;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The goal of this tool is to tell the user which regions have hfilev1 in them. It prints out those regions (currently, it prints full path to print the table name).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;What will you ignore?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, .logs, etc. Basically, all the non-table directories.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;You keep saying you are going to print regions that have v1 files but you seem to be printing out full path&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, its intentional as to let the user know which table this region belongs. IMO, it is good to know.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Suggest an option that will fast fail... fail as soon as it finds the first v1. This is probably not important so if it takes a while, just punt.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;It looks like you do fail fast &#8211; you stop scanning a family as soon as you find a v1 file?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yea, I designed it with the following behavior in mind:&lt;br/&gt;
1) Scan a table one at a time. This way we can give a table clean chit if no hfilev1 is found inside it.&lt;br/&gt;
2) Scan regions in parallel. Here, the executor comes in. Basically, scanning a region is a task. If a hfile is found in any of the CF, then there is no need to scan other families as we would like the user to compact that region anyway.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why not include original exception here: + throw new IOException(&quot;Unknown version for hfile: &quot; + storeFilePath);?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Will do what sergey said.&lt;/p&gt;

&lt;p&gt;The current output is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Table hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/hbase-0.94/-ROOT- has no HFileV1.
&lt;/span&gt;Found a v1 hfile, hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/hbase-0.94/t/c6b79b9f1ca4a37921355ddbfb521761/f/2811264815153459761
&lt;/span&gt;Region has a hfile v1: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/hbase-0.94/t/c6b79b9f1ca4a37921355ddbfb521761
&lt;/span&gt;Table hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/hbase-0.94/t has 1 number of HFileV1.
&lt;/span&gt;
==================Regions to Major Compact==============

hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/hbase-0.94/t/c6b79b9f1ca4a37921355ddbfb521761
&lt;/span&gt;
===========End of Regions to Major Compact==============

Total  number of HFile V1 is: 1
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I will add a section to print out all the hfile v1, and remove extra messaging and fixed nits suggested by Sergey and paste the output.&lt;/p&gt;</comment>
                            <comment id="13622751" author="v.himanshu" created="Thu, 4 Apr 2013 20:33:10 +0000"  >&lt;p&gt;Did the nits. Made the executor a local parameter and passed it along.&lt;br/&gt;
Output:&lt;br/&gt;
a) When there is no hfile v1, or corrupted file in the root.dir:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/hbase org.apache.hadoop.hbase.util.HFileV1Detector
No HFile V1 Found
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;b) When there is a hfile v1 and a corrupted file in the target directory&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
./bin/hbase org.apache.hadoop.hbase.util.HFileV1Detector -p /hbase

Following regions has HFileV1 and needs to be Major Compacted:

hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/hbase/usertable/fa02dac1f38d03577bd0f7e666f12812
&lt;/span&gt;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/hbase/usertable/ecdd3eaee2d2fcf8184ac025555bb2af
&lt;/span&gt;

Following HFileV1 are found:

hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/hbase/usertable/fa02dac1f38d03577bd0f7e666f12812/family/249450144068442524
&lt;/span&gt;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/hbase/usertable/ecdd3eaee2d2fcf8184ac025555bb2af/family/249450144068442524
&lt;/span&gt;

Following HFiles are corrupted as their version is unknown:

hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/hbase/usertable/fa02dac1f38d03577bd0f7e666f12812/family/1
&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Help section usage is in the previous comment. Added Class level docs on how to use it.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;List&amp;lt;Future&amp;lt;Path&amp;gt;&amp;gt; l &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yea, it can be better. Can you please suggest some. Thanks.&lt;/p&gt;</comment>
                            <comment id="13625700" author="v.himanshu" created="Mon, 8 Apr 2013 19:24:31 +0000"  >&lt;p&gt;Replaced Posixparser with GNUparse and renamed the variable as suggested. Please review.&lt;/p&gt;</comment>
                            <comment id="13626055" author="sershe" created="Tue, 9 Apr 2013 01:11:44 +0000"  >&lt;p&gt;The patch attached today appears to be from a different JIRA&lt;/p&gt;</comment>
                            <comment id="13628273" author="yuzhihong@gmail.com" created="Wed, 10 Apr 2013 21:24:57 +0000"  >&lt;p&gt;Yeah. It was for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8288&quot; title=&quot;HBaseFileSystem: Refactoring and correct semantics for createPath methods&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8288&quot;&gt;&lt;del&gt;HBASE-8288&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13628286" author="v.himanshu" created="Wed, 10 Apr 2013 21:34:12 +0000"  >&lt;p&gt;Oops... unrelated patch. Just saw your comments. Uploaded the right one now.&lt;/p&gt;</comment>
                            <comment id="13628437" author="yuzhihong@gmail.com" created="Wed, 10 Apr 2013 23:33:40 +0000"  >&lt;p&gt;In processRegion():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+                hFileV1Set.add(storeFilePath);
+                &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; region path, as it needs to be compacted.
&lt;/span&gt;+                &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; path;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There may be more than one V1 HFile in the region, right ? Why do we return early ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ * Tool to detect presence of any HFileV1 in the given directory. It prints all such regions which
+ * has such files.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;has such files&apos; -&amp;gt; &apos;have such files&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+ * It also support -h, --help, -help options.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;support&apos; -&amp;gt; &apos;supports&apos;&lt;/p&gt;</comment>
                            <comment id="13628442" author="yuzhihong@gmail.com" created="Wed, 10 Apr 2013 23:37:45 +0000"  >&lt;p&gt;Compaction would be initiated per region.&lt;/p&gt;

&lt;p&gt;Discard my first comment above.&lt;/p&gt;</comment>
                            <comment id="13628506" author="hadoopqa" created="Thu, 11 Apr 2013 00:38:36 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12578086/HBase-7704-v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12578086/HBase-7704-v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5252//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13628515" author="sershe" created="Thu, 11 Apr 2013 00:50:50 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13628655" author="yuzhihong@gmail.com" created="Thu, 11 Apr 2013 04:25:20 +0000"  >&lt;p&gt;In processTable():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Future&amp;lt;Path&amp;gt; f : regionLevelResults) {
+      &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (f.get() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+          regionsWithHFileV1.add(f.get());
+        }
+      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
+        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(e);
+      } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ExecutionException e) {
+        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.err.println(e); &lt;span class=&quot;code-comment&quot;&gt;// might be a bad hfile. We print it at the end.
&lt;/span&gt;+      }
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For ExecutionException, the print may be eclipsed by successive logs. I think we should store such error and print warning at the end.&lt;/p&gt;

&lt;p&gt;Please also fix grammatical errors mentioned above.&lt;/p&gt;</comment>
                            <comment id="13628666" author="v.himanshu" created="Thu, 11 Apr 2013 04:56:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;For ExecutionException, the print may be eclipsed by successive logs. I think we should store such error and print warning at the end.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The exception is caught in the processRegion method, and the file is added to the corrupt files data structure, which is printed at the end of the method call. I think that should suffice.&lt;/p&gt;

&lt;p&gt;Will correct the grammatical errors in the next patch.&lt;/p&gt;</comment>
                            <comment id="13628672" author="v.himanshu" created="Thu, 11 Apr 2013 05:08:19 +0000"  >&lt;p&gt;Incorporated Ted&apos;s comments. Please review.&lt;/p&gt;</comment>
                            <comment id="13628749" author="hadoopqa" created="Thu, 11 Apr 2013 07:40:31 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12578162/HBase-7704-v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12578162/HBase-7704-v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5258//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13628955" author="yuzhihong@gmail.com" created="Thu, 11 Apr 2013 14:10:41 +0000"  >&lt;p&gt;Which release should this tool be packaged with ?&lt;br/&gt;
For users running 0.94, they would expect this tool in the same release so that proper action can be taken before upgrade.&lt;/p&gt;</comment>
                            <comment id="13629076" author="v.himanshu" created="Thu, 11 Apr 2013 16:27:58 +0000"  >&lt;p&gt;One can point a hbase installation directory path to find any hfile v1. I think 0.95.x should be sufficient.&lt;/p&gt;</comment>
                            <comment id="13629095" author="yuzhihong@gmail.com" created="Thu, 11 Apr 2013 16:41:18 +0000"  >&lt;p&gt;Can you add release notes, illustrating how this tool should be used ?&lt;/p&gt;</comment>
                            <comment id="13629288" author="mbertozzi" created="Thu, 11 Apr 2013 20:07:55 +0000"  >&lt;p&gt;the patch looks good to me, &lt;br/&gt;
The .archive, .snapshot doesn&apos;t contain any .tableinfo so they are not considered in the processTable().&lt;br/&gt;
but if the file is a link you don&apos;t check if is v1, this means that if you&apos;ve cloned a table and removed the original one the cloned can have all v1 files (not sure if this case exists, since snapshots are in 94 and 94 writes with v2, but maybe there is the case that the source table of the clone was not converted).&lt;/p&gt;

&lt;p&gt;some other minor notes:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Add an Example section at the end of the help, like the other tools to demonstrate how to use it.&lt;/li&gt;
	&lt;li&gt;could you replace the &quot;Path p&quot; with the different &quot;Path tableDir&quot;, &quot;Path regionDir&quot; just to make the code a little bit more readable.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13629308" author="v.himanshu" created="Thu, 11 Apr 2013 20:20:18 +0000"  >&lt;p&gt;Glad I asked you to review it Matteo... Thanks. &lt;br/&gt;
Will take care of snapshot stuff in the next patch.&lt;/p&gt;</comment>
                            <comment id="13629597" author="v.himanshu" created="Thu, 11 Apr 2013 23:59:18 +0000"  >&lt;p&gt;Handling of HFileLinks, and changes as per Matteo&apos;s comments are added. Tested the script against a hbase installation which has snapshots in it. It works good. Please comment.&lt;/p&gt;</comment>
                            <comment id="13629618" author="v.himanshu" created="Fri, 12 Apr 2013 00:13:44 +0000"  >&lt;p&gt;removed a unused import.&lt;/p&gt;</comment>
                            <comment id="13629639" author="stack" created="Fri, 12 Apr 2013 00:33:51 +0000"  >&lt;p&gt;Looks good Himanshu.  Can you paste the output this tool makes when you do -h and then when you actually run it?  Thanks.&lt;/p&gt;</comment>
                            <comment id="13629657" author="hadoopqa" created="Fri, 12 Apr 2013 01:10:12 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12578322/HBASE-7704-v5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12578322/HBASE-7704-v5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5278//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13629664" author="hadoopqa" created="Fri, 12 Apr 2013 01:26:59 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12578326/HBASE-7704-v5.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12578326/HBASE-7704-v5.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestFullLogReconstruction&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5279//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13629720" author="yuzhihong@gmail.com" created="Fri, 12 Apr 2013 03:05:09 +0000"  >&lt;p&gt;+1 on patch v5&lt;/p&gt;</comment>
                            <comment id="13629955" author="mbertozzi" created="Fri, 12 Apr 2013 10:01:35 +0000"  >&lt;p&gt;v5 looks good but you should use fileLink.open(fs) instead of fs.open(fsStat.getPath())&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (HFileLink.isHFileLink(storeFilePath)) {
  HFileLink fileLink = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HFileLink(getConf(), storeFilePath);
  FileStatus fsStat = fileLink.getFileStatus(fs); 
  fsdis = fileLink.open(fs);  &amp;lt;--- Use the open from file link
  lenToRead = fsStat.getLen();
}             
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13630070" author="v.himanshu" created="Fri, 12 Apr 2013 14:05:02 +0000"  >&lt;p&gt;changed the fs.open to filelink.open(); was not that familiar with hfilelinks &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13630086" author="v.himanshu" created="Fri, 12 Apr 2013 14:09:26 +0000"  >&lt;p&gt;Stack: this is how it looks like now:&lt;br/&gt;
Help section: (one can also use --h, -help, --help)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/home/himanshu/Work/Cloudera/hbase-92/hbase/hbase-assembly/target/hbase-0.95.0-SNAPSHOT/bin/hbase org.apache.hadoop.hbase.util.HFileV1Detector -h
usage: HFileV1Detector [-h] [-n &amp;lt;arg&amp;gt;] [-p &amp;lt;arg&amp;gt;]
 -h,--help                    Help
 -n,--numberOfThreads &amp;lt;arg&amp;gt;   &lt;span class=&quot;code-object&quot;&gt;Number&lt;/span&gt; of threads to use &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; processing
                              HFiles.
 -p,--path &amp;lt;arg&amp;gt;              Path to a table, or hbase installation
In &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; no option is provided, it processes hbase.rootdir using 10 threads.
Example:
 To detect any HFileV1 in a given hbase installation &apos;/myhbase&apos;:
 $ $HBASE_HOME/bin/hbase org.apache.hadoop.hbase.util.HFileV1Detector -p /myhbase
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Directory with no hfilev1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 /home/himanshu/Work/Cloudera/hbase-92/hbase/hbase-assembly/target/hbase-0.95.0-SNAPSHOT/bin/hbase org.apache.hadoop.hbase.util.HFileV1Detector -p /hbase1
No HFile V1 Found
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Directory with a corrupt file (neither v1, nor v2), and 2 hfilev1:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/home/himanshu/Work/Cloudera/hbase-92/hbase/hbase-assembly/target/hbase-0.95.0-SNAPSHOT/bin/hbase org.apache.hadoop.hbase.util.HFileV1Detector -p /cdh4-2

Following regions has HFileV1 and needs to be Major Compacted:

hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/cdh4-2/usertable/fa02dac1f38d03577bd0f7e666f12812
&lt;/span&gt;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/cdh4-2/usertable/ecdd3eaee2d2fcf8184ac025555bb2af
&lt;/span&gt;

Following HFileV1 are found:

hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/cdh4-2/usertable/fa02dac1f38d03577bd0f7e666f12812/family/249450144068442524
&lt;/span&gt;hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/cdh4-2/usertable/ecdd3eaee2d2fcf8184ac025555bb2af/family/249450144068442524
&lt;/span&gt;

Following HFiles are corrupted as their version is unknown:

hdfs:&lt;span class=&quot;code-comment&quot;&gt;//localhost:41020/cdh4-2/usertable/fa02dac1f38d03577bd0f7e666f12812/family/1&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Please review.&lt;/p&gt;</comment>
                            <comment id="13630088" author="mbertozzi" created="Fri, 12 Apr 2013 14:12:32 +0000"  >&lt;p&gt;+1 on v6&lt;/p&gt;</comment>
                            <comment id="13630170" author="hadoopqa" created="Fri, 12 Apr 2013 15:20:41 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12578416/HBASE-7704-v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12578416/HBASE-7704-v6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5288//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13630244" author="stack" created="Fri, 12 Apr 2013 16:14:24 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;Nice.&lt;/p&gt;

&lt;p&gt;The javadoc warnings do not look to be yours.&lt;/p&gt;

&lt;p&gt;I will commit soon unless objection.&lt;/p&gt;</comment>
                            <comment id="13630282" author="v.himanshu" created="Fri, 12 Apr 2013 16:34:41 +0000"  >&lt;p&gt;Yeah, I don&apos;t see any javadoc warning in my eclipse setup. Thanks.&lt;/p&gt;</comment>
                            <comment id="13638810" author="stack" created="Tue, 23 Apr 2013 05:51:02 +0000"  >&lt;p&gt;Committed to 0.95 and trunk.  Thanks for the patch Himanshu&lt;/p&gt;</comment>
                            <comment id="13638993" author="hudson" created="Tue, 23 Apr 2013 12:33:04 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #4075 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4075/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4075/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7704&quot; title=&quot;migration tool that checks presence of HFile V1 files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7704&quot;&gt;&lt;del&gt;HBASE-7704&lt;/del&gt;&lt;/a&gt; migration tool that checks presence of HFile V1 files (Revision 1470818)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HFileV1Detector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13638999" author="hudson" created="Tue, 23 Apr 2013 12:46:16 +0000"  >&lt;p&gt;Integrated in hbase-0.95 #158 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/158/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/158/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7704&quot; title=&quot;migration tool that checks presence of HFile V1 files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7704&quot;&gt;&lt;del&gt;HBASE-7704&lt;/del&gt;&lt;/a&gt; migration tool that checks presence of HFile V1 files (Revision 1470819)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HFileV1Detector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13639401" author="hudson" created="Tue, 23 Apr 2013 18:55:43 +0000"  >&lt;p&gt;Integrated in hbase-0.95-on-hadoop2 #77 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95-on-hadoop2/77/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95-on-hadoop2/77/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7704&quot; title=&quot;migration tool that checks presence of HFile V1 files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7704&quot;&gt;&lt;del&gt;HBASE-7704&lt;/del&gt;&lt;/a&gt; migration tool that checks presence of HFile V1 files (Revision 1470819)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HFileV1Detector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13639534" author="hudson" created="Tue, 23 Apr 2013 20:06:36 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #507 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/507/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/507/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7704&quot; title=&quot;migration tool that checks presence of HFile V1 files&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7704&quot;&gt;&lt;del&gt;HBASE-7704&lt;/del&gt;&lt;/a&gt; migration tool that checks presence of HFile V1 files (Revision 1470818)&lt;/p&gt;

&lt;p&gt;     Result = ABORTED&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/HFileV1Detector.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12629163">HBASE-7660</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12578326" name="HBASE-7704-v5.patch" size="12570" author="v.himanshu" created="Fri, 12 Apr 2013 00:13:44 +0000"/>
                            <attachment id="12578416" name="HBASE-7704-v6.patch" size="12516" author="v.himanshu" created="Fri, 12 Apr 2013 14:05:02 +0000"/>
                            <attachment id="12576941" name="HBase-7704-v1.patch" size="10130" author="v.himanshu" created="Thu, 4 Apr 2013 08:04:32 +0000"/>
                            <attachment id="12577049" name="HBase-7704-v2.patch" size="11551" author="v.himanshu" created="Thu, 4 Apr 2013 20:28:25 +0000"/>
                            <attachment id="12578086" name="HBase-7704-v3.patch" size="11561" author="v.himanshu" created="Wed, 10 Apr 2013 21:34:12 +0000"/>
                            <attachment id="12578162" name="HBase-7704-v4.patch" size="11563" author="v.himanshu" created="Thu, 11 Apr 2013 05:08:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 3 Apr 2013 18:45:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310136</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 34 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hiv3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310481</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Adds tool to check if any v1 hfiles present under hbase.rootdir.  Run this tool before you move to hbase 0.95/0.96 because hfile v1 files are no longer supported in the newer versions of hbase (If an hfile v1 is found, run a major compaction on the offending, containing region and that should purge the v1 file).&lt;br/&gt;
&lt;br/&gt;
Here is what the usage for the tool looks like:&lt;br/&gt;
&lt;br/&gt;
&lt;br/&gt;
{code}&lt;br/&gt;
bin/hbase org.apache.hadoop.hbase.util.HFileV1Detector -h&lt;br/&gt;
usage: HFileV1Detector [-h] [-n &amp;lt;arg&amp;gt;] [-p &amp;lt;arg&amp;gt;]&lt;br/&gt;
&amp;nbsp;-h,--help                    Help&lt;br/&gt;
&amp;nbsp;-n,--numberOfThreads &amp;lt;arg&amp;gt;   Number of threads to use while processing&lt;br/&gt;
&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;HFiles.&lt;br/&gt;
&amp;nbsp;-p,--path &amp;lt;arg&amp;gt;              Path to a table, or hbase installation&lt;br/&gt;
In case no option is provided, it processes hbase.rootdir using 10 threads.&lt;br/&gt;
Example:&lt;br/&gt;
&amp;nbsp;To detect any HFileV1 in a given hbase installation &amp;#39;/myhbase&amp;#39;:&lt;br/&gt;
&amp;nbsp;$ $HBASE_HOME/bin/hbase org.apache.hadoop.hbase.util.HFileV1Detector -p /myhbase&lt;br/&gt;
{code}</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>