<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:07:05 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3068/HBASE-3068.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3068] IllegalStateException when new server comes online, is given 200 regions to open and 200th region gets timed out of regions in transition</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3068</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Yesterday we committed a change that makes it so the master will crash is a zk transition that is unexpected.   Its extreme but good for highlighting bad state changes (we also started marking these as illegalstateexceptions yesterday too).&lt;/p&gt;

&lt;p&gt;So, testing new master I brought up a new server.  Balancer tried to give new server 256 regions.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-10-01 16:01:42,972 INFO org.apache.hadoop.hbase.master.LoadBalancer: Calculated a load balance in 0ms. Moving 256 regions off of 7 overloaded servers onto 1 less loaded servers
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Turns out we failed complete open of all 256 servers within the regions-in-transition timeout period so we tried to reassign.  The master aborted because region was in the PENDING_OPEN state when we went about assigning.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-10-01 16:02:28,809 INFO org.apache.hadoop.hbase.master.AssignmentManager: Regions in transition timed out:  usertable,user1128734802,1285701924906.006696a9bf346f8593df66728e18e029. state=PENDING_OPEN, ts=1285948921051
2010-10-01 16:02:28,809 INFO org.apache.hadoop.hbase.master.AssignmentManager: Region has been PENDING_OPEN or OPENING &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, reassigning region=usertable,user1128734802,1285701924906.006696a9bf346f8593df66728e18e029.
2010-10-01 16:02:28,811 FATAL org.apache.hadoop.hbase.master.HMaster: Unexpected state trying to OFFLINE; usertable,user1128734802,1285701924906.006696a9bf346f8593df66728e18e029. state=PENDING_OPEN, ts=1285948921051
java.lang.IllegalStateException
    at org.apache.hadoop.hbase.master.AssignmentManager.setOfflineInZooKeeper(AssignmentManager.java:662)
    at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:632)
    at org.apache.hadoop.hbase.master.AssignmentManager.assign(AssignmentManager.java:560)
    at org.apache.hadoop.hbase.master.AssignmentManager$TimeoutMonitor.chore(AssignmentManager.java:1102)
    at org.apache.hadoop.hbase.Chore.run(Chore.java:66)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12475663">HBASE-3068</key>
            <summary>IllegalStateException when new server comes online, is given 200 regions to open and 200th region gets timed out of regions in transition</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Oct 2010 20:51:33 +0000</created>
                <updated>Fri, 20 Nov 2015 12:41:12 +0000</updated>
                            <resolved>Fri, 1 Oct 2010 23:02:14 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12917042" author="hbasereviewboard" created="Fri, 1 Oct 2010 21:27:18 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/930/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/930/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-10-01 14:05:45.726776)&lt;/p&gt;


&lt;p&gt;Review request for hbase and Jonathan Gray.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Update to javadoc and comments&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Fix is two-fold.&lt;/p&gt;

&lt;p&gt;First, added new facility where on successful open, we go and update the timers on all regions in transition that were on the same server.&lt;/p&gt;

&lt;p&gt;Secondly, in the timeout monitor, we&apos;ll do necessary cleanup and state transitions so that when we go into re-assign, we have the proper state&lt;/p&gt;

&lt;p&gt;M src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
  Changed regionPlans to be a concurrentskiplist.  Makes life easier&lt;br/&gt;
  and in no place do we need lock on regionPlans to span other than&lt;br/&gt;
  regionPlans changes.&lt;br/&gt;
  Added to the processing of successful region open, the cleanup&lt;br/&gt;
  of its regionPlan and a run of updateTimers.&lt;br/&gt;
  Put setOffline in place of some code that duplicated what it did.&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-3068.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/hbase-3068&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/hbase-3068&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1003330 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/930/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/930/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Basic unit tests seem to be passing.  Testing now up on cluster.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;stack&lt;/p&gt;

</comment>
                            <comment id="12917043" author="hbasereviewboard" created="Fri, 1 Oct 2010 21:27:31 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/930/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/930/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase and Jonathan Gray.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Fix is two-fold.&lt;/p&gt;

&lt;p&gt;First, added new facility where on successful open, we go and update the timers on all regions in transition that were on the same server.&lt;/p&gt;

&lt;p&gt;Secondly, in the timeout monitor, we&apos;ll do necessary cleanup and state transitions so that when we go into re-assign, we have the proper state&lt;/p&gt;

&lt;p&gt;M src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
  Changed regionPlans to be a concurrentskiplist.  Makes life easier&lt;br/&gt;
  and in no place do we need lock on regionPlans to span other than&lt;br/&gt;
  regionPlans changes.&lt;br/&gt;
  Added to the processing of successful region open, the cleanup&lt;br/&gt;
  of its regionPlan and a run of updateTimers.&lt;br/&gt;
  Put setOffline in place of some code that duplicated what it did.&lt;/p&gt;


&lt;p&gt;This addresses bug hbase-3068.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/hbase-3068&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/hbase-3068&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1003330 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/930/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/930/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Basic unit tests seem to be passing.  Testing now up on cluster.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;stack&lt;/p&gt;

</comment>
                            <comment id="12917085" author="stack" created="Fri, 1 Oct 2010 23:02:14 +0000"  >&lt;p&gt;Committing.  Tested it a couple of ways up on loaded cluster and no longer see the illegalstateexception nor does master crash&lt;/p&gt;</comment>
                            <comment id="15016909" author="lars_francke" created="Fri, 20 Nov 2015 12:41:12 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 1 Oct 2010 21:27:18 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26626</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hklz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100601</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>