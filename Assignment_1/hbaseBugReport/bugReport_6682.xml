<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:38:55 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6682/HBASE-6682.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6682] Bad characters in logs for server names: SplitLogManager: task following PBUF </title>
                <link>https://issues.apache.org/jira/browse/HBASE-6682</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;See how the server name is printed:&lt;/p&gt;

&lt;p&gt;2012-08-29 14:28:53,567 INFO org.apache.hadoop.hbase.master.SplitLogManager: task /hbase/splitlog/hdfs%3A%2F%2Flocalhost%3A9000%2Fhbase%2F.logs%2Flocalhost%2C60202%2C1346241077569-splitting%2Flocalhost%252C60202%252C1346241077569.1346241967431 entered state PBUF����&lt;br/&gt;
	localhost�&#65533;&#65533;��&#65533;&#65533;&#1937;&#65533;&apos;&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12605370">HBASE-6682</key>
            <summary>Bad characters in logs for server names: SplitLogManager: task following PBUF </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="aleksshulman">Aleksandr Shulman</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Aug 2012 13:15:21 +0000</created>
                <updated>Mon, 23 Sep 2013 18:30:15 +0000</updated>
                            <resolved>Fri, 31 Aug 2012 21:20:53 +0000</resolved>
                                    <version>0.95.2</version>
                                    <fixVersion>0.95.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13445141" author="aleksshulman" created="Thu, 30 Aug 2012 17:57:00 +0000"  >&lt;p&gt;Hi N,&lt;/p&gt;

&lt;p&gt;I&apos;m Aleks over at Cloudera. Can you provide me a little more info on how you came upon this message and the most direct way to reproduce it?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Aleks S.&lt;/p&gt;</comment>
                            <comment id="13445145" author="aleksshulman" created="Thu, 30 Aug 2012 18:04:20 +0000"  >&lt;p&gt;From the looks of it, it just appears that the log line is URL-encoded (perhaps multiple times). The first round of URL-decoding produces this:&lt;br/&gt;
hdfs://localhost:9000/hbase/.logs/localhost,60202,1346241077569-splitting/localhost%2C60202%2C1346241077569.1346241967431&lt;/p&gt;

&lt;p&gt;One more round of decoding produces this:&lt;br/&gt;
hdfs://localhost:9000/hbase/.logs/localhost,60202,1346241077569-splitting/localhost,60202,1346241077569.1346241967431&lt;/p&gt;

&lt;p&gt;So the issue would appear to be that we not decoding properly before logging. &lt;/p&gt;</comment>
                            <comment id="13445146" author="aleksshulman" created="Thu, 30 Aug 2012 18:07:41 +0000"  >&lt;p&gt;The other issue is the binary data the appears at the end. I&apos;m going to look into why that might occur.&lt;/p&gt;</comment>
                            <comment id="13445149" author="nkeywal" created="Thu, 30 Aug 2012 18:10:55 +0000"  >&lt;p&gt;Hi Aleks,&lt;/p&gt;

&lt;p&gt;Thanks for looking at this.&lt;br/&gt;
It&apos;s on a distributed split on a pseudo distributed cluster with multiple region servers.&lt;br/&gt;
So:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;start a few region servers&lt;/li&gt;
	&lt;li&gt;create a table with multiple regions&lt;/li&gt;
	&lt;li&gt;puts some data to ensure there is something to split&lt;/li&gt;
	&lt;li&gt;kill -9 one&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;It&apos;s on master logs. Still there, I&apos;ve just checked. Appears just after&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-08-30 20:02:08,930 DEBUG org.apache.hadoop.hbase.master.SplitLogManager: total tasks = 8 unassigned = 4
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
</comment>
                            <comment id="13445151" author="nkeywal" created="Thu, 30 Aug 2012 18:14:06 +0000"  >&lt;p&gt;I replied to you initial before seeing your last one. Yep, I agree with your analysis.&lt;/p&gt;</comment>
                            <comment id="13445158" author="aleksshulman" created="Thu, 30 Aug 2012 18:20:06 +0000"  >&lt;p&gt;To trigger the split, are you inserting data until it occurs automatically, or are you explicitly requesting a split be done from the client (e.g. splitLogDistributed(path))?&lt;/p&gt;

&lt;p&gt;Also, does the offending binary text appear when you don&apos;t kill one of the processes?&lt;/p&gt;</comment>
                            <comment id="13445167" author="nkeywal" created="Thu, 30 Aug 2012 18:28:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;To trigger the split, are you inserting data until it occurs automatically, or are you explicitly requesting a split be done from the client (e.g. splitLogDistributed(path))?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I do a kill -9 on the region server, so it&apos;s triggered by the master. There is no client anymore at this point actually, just unflushed data in the region server.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Also, does the offending binary text appear when you don&apos;t kill one of the processes?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Well if I don&apos;t kill the region server, the log won&apos;t have to be split.&lt;/p&gt;</comment>
                            <comment id="13445196" author="aleksshulman" created="Thu, 30 Aug 2012 18:58:31 +0000"  >&lt;p&gt;Thanks for the response.&lt;/p&gt;

&lt;p&gt;I took a dive into the binary that is produced in order to glean some information:&lt;/p&gt;

&lt;p&gt;The binary representation of everything after &apos;localhost&apos; is: 10 EF BF BD EF BF BD 03 18 EF BF BD EF BF BD DE 91 EF BF BD 27 0A&lt;br/&gt;
The 10 is the &apos;Data Link Escape&apos; character according the Ascii table.&lt;br/&gt;
The sequence &apos;EF BF BD&apos; the UTF-8 encoding for U+FFFC which is &quot;object replacement character&quot;.&lt;br/&gt;
The &apos;3&apos; is the &apos;end of text&apos; character and &apos;18&apos; is &apos;cancel&apos;.&lt;br/&gt;
The &apos;91&apos; is ascii 145, which is the opening single quote (&apos;).&lt;br/&gt;
&apos;27&apos; is &apos;escape&apos; and &apos;0A&apos; is a newline.&lt;/p&gt;

&lt;p&gt;I&apos;m going to look into this further, but I wanted to at least mark my observations/deductions.&lt;/p&gt;</comment>
                            <comment id="13445416" author="aleksshulman" created="Thu, 30 Aug 2012 23:15:31 +0000"  >&lt;p&gt;The issue appears that the raw byte array of the protocol buffer is being written out to the logs. My guess so far is that the protocol buffer is of type ServerName (holding the name, port, and startCode), but I not sure how this maps to the byte array. &lt;/p&gt;

&lt;p&gt;It seems as though it will just print whatever ZooKeeper provides it. I&apos;ve contacted other team members about this bug and will follow up as I learn more.&lt;/p&gt;</comment>
                            <comment id="13445444" author="aleksshulman" created="Thu, 30 Aug 2012 23:39:47 +0000"  >&lt;p&gt;This object is actually a SplitLogTask object. If we deserialize the proto buffer and then do a toString, then we get useful information.&lt;/p&gt;

&lt;p&gt;The only risk I can think of is that data might actually not be of type SplitLogTask. However, we&apos;re already taking that risk and error handling for this checked exception is done by the calling function.&lt;/p&gt;

&lt;p&gt;My fix then is to deserialize the object and print out its toString(), which is actually informative and formatted.&lt;/p&gt;</comment>
                            <comment id="13445523" author="aleksshulman" created="Fri, 31 Aug 2012 00:44:34 +0000"  >&lt;p&gt;This is the code diff.&lt;/p&gt;</comment>
                            <comment id="13445525" author="aleksshulman" created="Fri, 31 Aug 2012 00:46:07 +0000"  >&lt;p&gt;Before and after log lines.&lt;/p&gt;</comment>
                            <comment id="13445530" author="dsw" created="Fri, 31 Aug 2012 00:56:49 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13445571" author="yuzhihong@gmail.com" created="Fri, 31 Aug 2012 01:55:01 +0000"  >&lt;p&gt;Nice investigation, Alex.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; sltString = slt.toString();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now the above is always evaluated while there&apos;re at least two cases where sltString isn&apos;t used.&lt;br/&gt;
Can you embed slt.toString() in the log statements ?&lt;/p&gt;</comment>
                            <comment id="13445575" author="aleksshulman" created="Fri, 31 Aug 2012 02:11:05 +0000"  >&lt;p&gt;Hi Ted,&lt;/p&gt;

&lt;p&gt;That sounds good. Please see new diff.&lt;/p&gt;</comment>
                            <comment id="13445816" author="nkeywal" created="Fri, 31 Aug 2012 10:11:42 +0000"  >&lt;p&gt;With the patch diff_2.diff applied , I now have the real state:&lt;/p&gt;


&lt;p&gt;2012-08-31 11:56:02,858 INFO org.apache.hadoop.hbase.master.SplitLogManager: task /hbase/splitlog/hdfs%3A%2F%2Flocalhost%3A9000%2Fhbase%2F.logs%2Flocalhost%2C60202%2C1346406260943-splitting%2Flocalhost%252C60202%252C1346406260943.1346406710119 entered state: DONE localhost,60020,1346406222732&lt;/p&gt;


&lt;p&gt;Reading the code, it seems ok to me as well. I&apos;m +1. Thanks Aleks.&lt;/p&gt;</comment>
                            <comment id="13446365" author="aleksshulman" created="Fri, 31 Aug 2012 20:56:06 +0000"  >&lt;p&gt;Since it looks like there are no objections to the patch, is there anything else we need to do to get this fix committed? If not, could we commit this and I&apos;ll close it out?&lt;/p&gt;</comment>
                            <comment id="13446371" author="yuzhihong@gmail.com" created="Fri, 31 Aug 2012 21:00:18 +0000"  >&lt;p&gt;Integrated to trunk.&lt;/p&gt;

&lt;p&gt;Thanks for the patch, Alex.&lt;/p&gt;

&lt;p&gt;Thanks for the review, N.&lt;/p&gt;</comment>
                            <comment id="13774870" author="stack" created="Mon, 23 Sep 2013 18:30:15 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12543212" name="before_after_logs" size="475" author="aleksshulman" created="Fri, 31 Aug 2012 00:46:07 +0000"/>
                            <attachment id="12543220" name="diff_2.diff" size="1734" author="aleksshulman" created="Fri, 31 Aug 2012 02:11:21 +0000"/>
                            <attachment id="12543211" name="diff_splitLogManager.diff" size="2033" author="aleksshulman" created="Fri, 31 Aug 2012 00:44:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 30 Aug 2012 17:57:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>242553</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02vmn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>14725</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>