<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:10:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3445/HBASE-3445.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3445] Master crashes on data that was moved from different host</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3445</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;While testing an upgrade to 0.90.0 RC3 I noticed that if I seeded our test data on one machine and transferred to another machine the HMaster on the new machine dies on startup.&lt;/p&gt;

&lt;p&gt;Based on the following stack trace it looks as though it is attempting to find the .meta region with the ip address of the original machine.  Instead of waiting around for RegionServer&apos;s to register with new location data, HMaster throws it&apos;s hands up with a FATAL exception.&lt;/p&gt;

&lt;p&gt;Note that deleting the zookeeper dir makes no difference.&lt;/p&gt;

&lt;p&gt;Also note that so far I have only reproduced this in my own environment using the hbase-trx extension of HBase and an ApplicationStarter that starts the Master and RegionServer together in the same JVM.  While the issue seems likely isolated from those factors it is far from a vanilla HBase environment.&lt;/p&gt;

&lt;p&gt;I will spend some time trying to reproduce the issue in a proper hbase test.  But perhaps someone can beat me to it?  How do I simulate the IP switch? May require a data.tar upload. &lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;14/01/11 10:45:20&amp;#93;&lt;/span&gt; 6396   [     Thread-298] ERROR server.quorum.QuorumPeerConfig  - Invalid configuration, only one server specified (ignoring)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;14/01/11 10:45:21&amp;#93;&lt;/span&gt; 7178   [           main] INFO  ion.service.HBaseRegionService  - troove&amp;gt; region port:       60010&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;14/01/11 10:45:21&amp;#93;&lt;/span&gt; 7180   [           main] INFO  ion.service.HBaseRegionService  - troove&amp;gt; region interface:  org.apache.hadoop.hbase.ipc.IndexedRegionInterface&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;14/01/11 10:45:21&amp;#93;&lt;/span&gt; 7180   [           main] INFO  ion.service.HBaseRegionService  - troove&amp;gt; root dir: hdfs://localhost:8701/hbase&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;14/01/11 10:45:21&amp;#93;&lt;/span&gt; 7180   [           main] INFO  ion.service.HBaseRegionService  - troove&amp;gt; Initializing region server.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;14/01/11 10:45:21&amp;#93;&lt;/span&gt; 7631   [           main] INFO  ion.service.HBaseRegionService  - troove&amp;gt; Starting region server thread.&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;14/01/11 10:46:54&amp;#93;&lt;/span&gt; 100764 [        HMaster] FATAL he.hadoop.hbase.master.HMaster  - Unhandled exception. Starting shutdown.&lt;br/&gt;
java.net.SocketTimeoutException: 20000 millis timeout while waiting for channel to be ready for connect. ch : java.nio.channels.SocketChannel&lt;span class=&quot;error&quot;&gt;&amp;#91;connection-pending remote=192.168.1.102/192.168.1.102:60020&amp;#93;&lt;/span&gt;&lt;br/&gt;
	at org.apache.hadoop.net.SocketIOWithTimeout.connect(SocketIOWithTimeout.java:213)&lt;br/&gt;
	at org.apache.hadoop.net.NetUtils.connect(NetUtils.java:404)&lt;br/&gt;
	at org.apache.hadoop.hbase.ipc.HBaseClient$Connection.setupIOstreams(HBaseClient.java:311)&lt;br/&gt;
	at org.apache.hadoop.hbase.ipc.HBaseClient.getConnection(HBaseClient.java:865)&lt;br/&gt;
	at org.apache.hadoop.hbase.ipc.HBaseClient.call(HBaseClient.java:732)&lt;br/&gt;
	at org.apache.hadoop.hbase.ipc.HBaseRPC$Invoker.invoke(HBaseRPC.java:258)&lt;br/&gt;
	at $Proxy14.getProtocolVersion(Unknown Source)&lt;br/&gt;
	at org.apache.hadoop.hbase.ipc.HBaseRPC.getProxy(HBaseRPC.java:419)&lt;br/&gt;
	at org.apache.hadoop.hbase.ipc.HBaseRPC.getProxy(HBaseRPC.java:393)&lt;br/&gt;
	at org.apache.hadoop.hbase.ipc.HBaseRPC.getProxy(HBaseRPC.java:444)&lt;br/&gt;
	at org.apache.hadoop.hbase.ipc.HBaseRPC.waitForProxy(HBaseRPC.java:349)&lt;br/&gt;
	at org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation.getHRegionConnection(HConnectionManager.java:954)&lt;br/&gt;
	at org.apache.hadoop.hbase.catalog.CatalogTracker.getCachedConnection(CatalogTracker.java:384)&lt;br/&gt;
	at org.apache.hadoop.hbase.catalog.CatalogTracker.getMetaServerConnection(CatalogTracker.java:283)&lt;br/&gt;
	at org.apache.hadoop.hbase.catalog.CatalogTracker.verifyMetaRegionLocation(CatalogTracker.java:478)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.HMaster.assignRootAndMeta(HMaster.java:435)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.HMaster.finishInitialization(HMaster.java:382)&lt;br/&gt;
	at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:277)&lt;/p&gt;</description>
                <environment></environment>
        <key id="12495617">HBASE-3445</key>
            <summary>Master crashes on data that was moved from different host</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="jk-public@troove.net">James Kennedy</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Jan 2011 19:14:38 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:46 +0000</updated>
                            <resolved>Thu, 20 Jan 2011 23:15:22 +0000</resolved>
                                    <version>0.90.0</version>
                                    <fixVersion>0.90.1</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12981937" author="jk-public@troove.net" created="Fri, 14 Jan 2011 21:52:04 +0000"  >&lt;p&gt;Instead of wrestling with a test I did some debugging.  I can fix this issue with the attached patch.&lt;br/&gt;
I&apos;ll leave it up to you guys to decide if that&apos;s the right fix or if there are more exceptions to be considered, etc.&lt;/p&gt;

&lt;p&gt;But from my narrow scope of understanding it just seems that the CatalogTracker SHOULD swallow exceptions like SocketTimeoutException instead of throwing them up.&lt;/p&gt;</comment>
                            <comment id="12981940" author="ryanobjc" created="Fri, 14 Jan 2011 21:57:39 +0000"  >&lt;p&gt;thanks for the good debugging work. I&apos;m going to place this in 0.90.1, and someone will review it soon.&lt;/p&gt;
</comment>
                            <comment id="12981942" author="jk-public@troove.net" created="Fri, 14 Jan 2011 22:01:05 +0000"  >&lt;p&gt;Actually, let me qualify that last statement.  By &quot;swallow&quot; i didn&apos;t mean to imply that the exceptions should be completely silent. In fact some WARN output in that CatalogTracker exception handling would make sense. &lt;/p&gt;

&lt;p&gt;Something like:&lt;/p&gt;

&lt;p&gt;&quot;Unable to connect to .meta region at 192.168.1.2:60020. Waiting for RegionServers to update location data.&quot;&lt;/p&gt;</comment>
                            <comment id="12982420" author="stack" created="Sun, 16 Jan 2011 23:20:42 +0000"  >&lt;p&gt;James:&lt;/p&gt;

&lt;p&gt;In the AssignmentManager, where we go to RPC to a remote regionserver, we do following:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ConnectException e) {
      LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed connect to &quot;&lt;/span&gt; + server + &lt;span class=&quot;code-quote&quot;&gt;&quot;, message=&quot;&lt;/span&gt; + e.getMessage() +
        &lt;span class=&quot;code-quote&quot;&gt;&quot;, region=&quot;&lt;/span&gt; + region.getEncodedName());
      &lt;span class=&quot;code-comment&quot;&gt;// Presume that regionserver just failed and we haven&apos;t got expired
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// server from zk yet.  Let expired server deal with clean up.
&lt;/span&gt;    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (java.net.SocketTimeoutException e) {
      LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Server &quot;&lt;/span&gt; + server + &lt;span class=&quot;code-quote&quot;&gt;&quot; returned &quot;&lt;/span&gt; + e.getMessage() + &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; +
        region.getEncodedName());
      &lt;span class=&quot;code-comment&quot;&gt;// Presume retry or server will expire.
&lt;/span&gt;    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (EOFException e) {
      LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Server &quot;&lt;/span&gt; + server + &lt;span class=&quot;code-quote&quot;&gt;&quot; returned &quot;&lt;/span&gt; + e.getMessage() + &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; +
        region.getEncodedName());
      &lt;span class=&quot;code-comment&quot;&gt;// Presume retry or server will expire.
&lt;/span&gt;    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (RemoteException re) {
      IOException ioe = re.unwrapRemoteException();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ioe &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; NotServingRegionException) {
        &lt;span class=&quot;code-comment&quot;&gt;// Failed to close, so pass through and reassign
&lt;/span&gt;        LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Server &quot;&lt;/span&gt; + server + &lt;span class=&quot;code-quote&quot;&gt;&quot; returned &quot;&lt;/span&gt; + ioe + &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; +
          region.getEncodedName());
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (ioe &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; EOFException) {
        &lt;span class=&quot;code-comment&quot;&gt;// Failed to close, so pass through and reassign
&lt;/span&gt;        LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Server &quot;&lt;/span&gt; + server + &lt;span class=&quot;code-quote&quot;&gt;&quot; returned &quot;&lt;/span&gt; + ioe + &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; +
          region.getEncodedName());
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.abort(&lt;span class=&quot;code-quote&quot;&gt;&quot;Remote unexpected exception&quot;&lt;/span&gt;, ioe);
      }
    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable t) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think your adding of timeout to the try/catch in the getCachedConnection is right.  Maybe we should add the ConnectException too? Unless you object, I&apos;ll add it when I commit your patch.&lt;/p&gt;</comment>
                            <comment id="12982421" author="stack" created="Sun, 16 Jan 2011 23:21:22 +0000"  >&lt;p&gt;Moved to 0.90.1&lt;/p&gt;</comment>
                            <comment id="12982422" author="stack" created="Sun, 16 Jan 2011 23:23:57 +0000"  >&lt;p&gt;Made James a contributor and assigned him this issue&lt;/p&gt;</comment>
                            <comment id="12982753" author="jk-public@troove.net" created="Mon, 17 Jan 2011 17:33:30 +0000"  >&lt;p&gt;Yeah probably.  I wonder if a better question is &quot;what exceptions do we NOT want to catch so that master dies with a FATAL?&quot;&lt;/p&gt;</comment>
                            <comment id="12982756" author="stack" created="Mon, 17 Jan 2011 17:39:27 +0000"  >&lt;p&gt;Yeah.  It starts to tend that direction James.  I think the set that is over in AM is pretty good &amp;#8211; its more prone to failures that the bit of code you&apos;ve been massaging.  Let me commit your patch.&lt;/p&gt;</comment>
                            <comment id="12984418" author="stack" created="Thu, 20 Jan 2011 21:35:32 +0000"  >&lt;p&gt;I started in on a refactor of AM#unassign to move all of the try/catch out to a Class that could be reused in such as the CatalogTracker around this getCachedConnection where James ran into his issue.  Turns out, this is wrong direction; the two locations have different exception throwing character.  I&apos;m abandoning this tack.  Attaching patch anyway.  Let me write a unit test to repro the James case to go along w/ his patch and see if I can gen other exceptions at the getCachedConnection juncture.&lt;/p&gt;</comment>
                            <comment id="12984457" author="stack" created="Thu, 20 Jan 2011 23:11:22 +0000"  >&lt;p&gt;Here is test that manufactures condition James sees.  His patch fixes it (I just added DEBUG logging to his patch).  I&apos;m going to commit though I&apos;m not going to include my test because of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3456&quot; title=&quot;Fix hardcoding of 20 second socket timeout down in HBaseClient&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3456&quot;&gt;&lt;del&gt;HBASE-3456&lt;/del&gt;&lt;/a&gt; &quot;Fix hardcoding of 20 second socket timeout down in HBaseClient 						&lt;br/&gt;
hbase-issues&quot;.  I don&apos;t want to add gratuitous 20 second wait to our test suite (not that anyone would notice the extra 20 seconds on top of an hour-plus suite).			 &lt;/p&gt;</comment>
                            <comment id="12984459" author="stack" created="Thu, 20 Jan 2011 23:15:22 +0000"  >&lt;p&gt;Committed to branch and trunk.  Thanks for the patch James.&lt;/p&gt;</comment>
                            <comment id="12985464" author="hudson" created="Sun, 23 Jan 2011 23:44:55 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1719 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1719/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1719/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="15017614" author="lars_francke" created="Fri, 20 Nov 2015 12:43:46 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12468897" name="3445-refactor.txt" size="13019" author="stack" created="Thu, 20 Jan 2011 21:35:31 +0000"/>
                            <attachment id="12468916" name="3445-v2.txt" size="6073" author="stack" created="Thu, 20 Jan 2011 23:11:22 +0000"/>
                            <attachment id="12468415" name="3445_0.90.0.patch" size="1146" author="jk-public@troove.net" created="Fri, 14 Jan 2011 21:54:06 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 14 Jan 2011 21:57:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26866</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hmav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100875</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>master</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>