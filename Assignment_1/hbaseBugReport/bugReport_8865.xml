<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:59:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8865/HBASE-8865.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8865] HBase shell split command acts incorrectly with hex split keys.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8865</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When I tried to do a manual region split from HBase shell, I found that split command acts incorrectly with hex split keys. &lt;/p&gt;

&lt;p&gt;Here is an example.&lt;/p&gt;

&lt;p&gt;I execute hbase(main):003:0&amp;gt; split &apos;tsdb&apos;, &quot;\x00\x00\xC3&quot; .&lt;/p&gt;

&lt;p&gt;While I expect it to split at the 3-byte key &quot;\x00\x00\xC3&quot; , it actually split at a 5-byte key &quot;\x00\x00\xEF\xBF\xBD&quot;. &lt;/p&gt;

&lt;p&gt;I test with more split keys and find some patterns:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;If the all bytes in the split key represented in hexadecimal are between &quot;\x00&quot; and &quot;\x7F&quot; , it works as expected and split at exactly the key specified.&lt;/li&gt;
	&lt;li&gt;If there are any bytes between &quot;\x80&quot; and &quot;xFF&quot;, it works incorrectly. No matter the byte is, it is interpreted as &quot;\xEF\xBF\xBD&quot;. Here is another example. Specifying split key &quot;\x00\xA0\x00\xB0&quot; actually splits at &quot;\x00\xEF\xBF\xBD\x00\xEF\xBF\xBD&quot;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m running Hbase 0.94.8, r1485407, both server-side and client-side. &lt;/p&gt;
</description>
                <environment>&lt;p&gt;Linux&lt;/p&gt;</environment>
        <key id="12656156">HBASE-8865</key>
            <summary>HBase shell split command acts incorrectly with hex split keys.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="dinghaifeng">Ding Haifeng</reporter>
                        <labels>
                    </labels>
                <created>Thu, 4 Jul 2013 07:51:47 +0000</created>
                <updated>Tue, 15 Nov 2016 00:04:17 +0000</updated>
                                            <version>0.94.8</version>
                                                    <component>shell</component>
                    <component>Usability</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13700417" author="dinghaifeng" created="Fri, 5 Jul 2013 01:26:09 +0000"  >&lt;p&gt;It looks like that converting a ASCII-8bit bytes array to a UTF-8 string will result such an decoding error.&lt;/p&gt;

&lt;p&gt;see: &lt;a href=&quot;http://stackoverflow.com/a/11162470&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://stackoverflow.com/a/11162470&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I found a work-around solution by explicitly converting string to bytes array in HBase shell. For example, executing the following command&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;split &apos;tsdb-test&apos;.to_java_bytes, &quot;\x00\x00\xC0&quot;.to_java_bytes&lt;br/&gt;
which will call the method:&lt;/li&gt;
	&lt;li&gt;void HBaseAdmin.split(String tableNameOrRegionName, String splitPoint)&lt;br/&gt;
rather than&lt;/li&gt;
	&lt;li&gt;void HBaseAdmin.split(byte[] tableNameOrRegionName, byte[] splitPoint)&lt;br/&gt;
works correctly.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;m wondering if it is more reasonable to take this as default behavior. It will be working for both plain strings and arbitrary bytes arrays. &lt;/p&gt;</comment>
                            <comment id="13700418" author="dinghaifeng" created="Fri, 5 Jul 2013 01:31:51 +0000"  >&lt;p&gt;Sorry for mistake in comments above. It will be calling&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;void HBaseAdmin.split(byte[] tableNameOrRegionName, byte[] splitPoint)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;rather than&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;void HBaseAdmin.split(String tableNameOrRegionName, String splitPoint)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;which works correctly.&lt;/p&gt;
</comment>
                            <comment id="13700420" author="yuzhihong@gmail.com" created="Fri, 5 Jul 2013 01:45:41 +0000"  >&lt;p&gt;How about this patch ?&lt;/p&gt;</comment>
                            <comment id="13700428" author="dinghaifeng" created="Fri, 5 Jul 2013 02:59:58 +0000"  >&lt;p&gt;Hi, Ted. Sorry that I do not have a HBase developing environment right now. But I think it can be easily reproduced and verified following the above procedures.&lt;/p&gt;

&lt;p&gt;Since there is &apos;startKey&apos; in Region Name which is consisted of &apos;tableName,startKey,id&apos;, I think the patch should also treat the argument &apos;tableNameOrRegionName&apos; in the same way as the argument &apos;splitPoint&apos;.&lt;/p&gt;
</comment>
                            <comment id="13700438" author="hadoopqa" created="Fri, 5 Jul 2013 03:42:17 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12590951/8865.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12590951/8865.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6220//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13700439" author="yuzhihong@gmail.com" created="Fri, 5 Jul 2013 03:42:39 +0000"  >&lt;p&gt;That is not needed - see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6643&quot; title=&quot;Accept encoded region name in compacting/spliting region from shell&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6643&quot;&gt;&lt;del&gt;HBASE-6643&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13706337" author="ndimiduk" created="Thu, 11 Jul 2013 22:17:47 +0000"  >&lt;p&gt;This patch is okay for binary rowkeys but will break string rowkeys. The shell operations generally assume they&apos;re working with friendly strings, not binary, so I&apos;m -1 on this change. What you&apos;re experiencing here is &quot;de facto by design,&quot; though I doubt that design was intentional.&lt;/p&gt;</comment>
                            <comment id="13706356" author="yuzhihong@gmail.com" created="Thu, 11 Jul 2013 22:29:36 +0000"  >&lt;p&gt;How about introducing a new command, splitBinary, that calls Bytes.toBytesBinary() ?&lt;br/&gt;
This would be a client side change.&lt;/p&gt;</comment>
                            <comment id="13706409" author="ndimiduk" created="Thu, 11 Jul 2013 23:07:58 +0000"  >&lt;p&gt;That&apos;s a little clunky but should expose the feature &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dinghaifeng&quot; class=&quot;user-hover&quot; rel=&quot;dinghaifeng&quot;&gt;Ding Haifeng&lt;/a&gt; is looking for. I wonder if the shell could use a heuristic, look for strings that &quot;look like&quot; binary strings and act accordingly. I hesitate to put too much effort into making the shell &quot;smart&quot; though. I think your listed workaround is actually the most correct solution, because neither you nor the shell are confused regarding your intention to use a &lt;tt&gt;byte[]&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;What if we patch the help message on shell&apos;s &lt;tt&gt;split&lt;/tt&gt; command to explicitly advise the user about this scenario?&lt;/p&gt;</comment>
                            <comment id="13706573" author="zjushch" created="Fri, 12 Jul 2013 02:13:55 +0000"  >&lt;p&gt;I think the patch should be ok, &lt;br/&gt;
it won&apos;t break string rowkeys unless considering &apos;\x&apos; as a string rather than tag of hex digits.&lt;/p&gt;

&lt;p&gt;In the real application, &apos;\x&apos; is more able to be considered as a tag of hex digits&lt;/p&gt;

&lt;p&gt;if only choose one, I prefere to use &apos;toBytesBinary&apos;.&lt;/p&gt;

&lt;p&gt;Making two methods to support two scenarios should also be ok.&lt;/p&gt;</comment>
                            <comment id="13707149" author="ndimiduk" created="Fri, 12 Jul 2013 17:50:21 +0000"  >&lt;p&gt;After reading through this issue more carefully and also looking at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6643&quot; title=&quot;Accept encoded region name in compacting/spliting region from shell&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6643&quot;&gt;&lt;del&gt;HBASE-6643&lt;/del&gt;&lt;/a&gt;, I think users of the shell would expect all commands that interact with byte[]&apos;s to be processed through &lt;tt&gt;Bytes.toBytesBinary&lt;/tt&gt; and results printed using &lt;tt&gt;Bytes.toStringBinary&lt;/tt&gt;. The trouble with &lt;tt&gt;toBytesBinary&lt;/tt&gt; is that it doesn&apos;t take the extra step of performing UTF-8 encoding on non-escaped characters.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        b[size++] = (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) ch;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That cast to &lt;tt&gt;byte&lt;/tt&gt; from &lt;tt&gt;ch&lt;/tt&gt; should instead be the equivalent of:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;String.valueOf(ch).getBytes(&quot;UTF-8&quot;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think using this patch as is will break splits for split points containing non-escaped unicode characters (ie, &#252;), because they&apos;re cast to a single &lt;tt&gt;byte&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="15665447" author="jinghe" created="Tue, 15 Nov 2016 00:04:17 +0000"  >&lt;p&gt;Any update on this JIRA?&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12945333">HBASE-15357</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12590951" name="8865.txt" size="667" author="yuzhihong@gmail.com" created="Fri, 5 Jul 2013 01:45:41 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 5 Jul 2013 01:45:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336431</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1m14v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>336755</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>