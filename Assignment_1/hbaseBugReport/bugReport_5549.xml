<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:28:48 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5549/HBASE-5549.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5549] Master can fail if ZooKeeper session expires</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5549</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There is a retry mechanism in RecoverableZooKeeper, but when the session expires, the whole ZooKeeperWatcher is recreated, hence the retry mechanism does not work in this case. This is why a sleep is needed in TestZooKeeper#testMasterSessionExpired: we need to wait for ZooKeeperWatcher to be recreated before using the connection.&lt;/p&gt;

&lt;p&gt;This can happen in real life, it can happen when:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;master &amp;amp; zookeeper starts&lt;/li&gt;
	&lt;li&gt;zookeeper connection is cut&lt;/li&gt;
	&lt;li&gt;master enters the retry loop&lt;/li&gt;
	&lt;li&gt;in the meantime the session expires&lt;/li&gt;
	&lt;li&gt;the network comes back, the session is recreated&lt;/li&gt;
	&lt;li&gt;the retries continues, but on the wrong object, hence fails.&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment>&lt;p&gt;all&lt;/p&gt;</environment>
        <key id="12545833">HBASE-5549</key>
            <summary>Master can fail if ZooKeeper session expires</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkeywal">Nicolas Liochon</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Mar 2012 12:19:52 +0000</created>
                <updated>Sun, 7 Apr 2013 04:34:02 +0000</updated>
                            <resolved>Fri, 16 Mar 2012 21:40:03 +0000</resolved>
                                    <version>0.95.2</version>
                                    <fixVersion>0.94.2</fixVersion>
                                    <component>master</component>
                    <component>Zookeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13230392" author="nkeywal" created="Thu, 15 Mar 2012 18:25:31 +0000"  >&lt;p&gt;Contains the patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5572&quot; title=&quot;KeeperException.SessionExpiredException management could be improved in Master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5572&quot;&gt;&lt;del&gt;HBASE-5572&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13230457" author="hadoopqa" created="Thu, 15 Mar 2012 19:37:28 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518500/5549.v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518500/5549.v6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 20 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 161 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestMultiParallel&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1193//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1193//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1193//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1193//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1193//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1193//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13231029" author="hadoopqa" created="Fri, 16 Mar 2012 10:27:18 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518639/nochange.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518639/nochange.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 161 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1199//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1199//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1199//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1199//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1199//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1199//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13231159" author="hadoopqa" created="Fri, 16 Mar 2012 13:23:29 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518660/5549.v7.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518660/5549.v7.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 20 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 161 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestMultiParallel&lt;br/&gt;
                  org.apache.hadoop.hbase.TestDrainingServer&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestSplitLogManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1200//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1200//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1200//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1200//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1200//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1200//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13231217" author="hadoopqa" created="Fri, 16 Mar 2012 14:18:24 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518664/5549.v8.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518664/5549.v8.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 20 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 161 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.TestReplication&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.TestZooKeeper&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1201//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1201//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1201//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1201//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1201//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1201//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13231242" author="hadoopqa" created="Fri, 16 Mar 2012 14:41:16 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518665/5549.v9.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518665/5549.v9.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 20 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 161 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.TestZooKeeper&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1202//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1202//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1202//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1202//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1202//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1202//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13231299" author="hadoopqa" created="Fri, 16 Mar 2012 15:36:46 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518676/5549.v10.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518676/5549.v10.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 20 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 161 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1204//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1204//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1204//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1204//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1204//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1204//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13231305" author="nkeywal" created="Fri, 16 Mar 2012 15:44:18 +0000"  >&lt;p&gt;Can be committed. Hopefully this is the end of the &quot;ZooKeeper expiry&quot; flakiness.&lt;/p&gt;</comment>
                            <comment id="13231405" author="zhihyu@ebaysf.com" created="Fri, 16 Mar 2012 17:23:46 +0000"  >&lt;p&gt;Minor comments:&lt;br/&gt;
For ActiveMasterManager.java, the second line should be indented to the left.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; backupZNode = ZKUtil.joinZNode(
+                               ClusterStatusTracker clusterStatusTracker) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I tried to create a review request on review board but got error 500.&lt;/p&gt;

&lt;p&gt;The patch is of decent size so review board usage is desirable. Please leave out Bugs field so that this JIRA is not flooded.&lt;/p&gt;

&lt;p&gt;Nice work.&lt;/p&gt;</comment>
                            <comment id="13231418" author="zhihyu@ebaysf.com" created="Fri, 16 Mar 2012 17:40:22 +0000"  >&lt;p&gt;TestMasterZKSessionRecovery is removed. Is it covered in other tests now ?&lt;/p&gt;</comment>
                            <comment id="13231441" author="nkeywal" created="Fri, 16 Mar 2012 17:51:37 +0000"  >&lt;p&gt;Yes, see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5572&quot; title=&quot;KeeperException.SessionExpiredException management could be improved in Master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5572&quot;&gt;&lt;del&gt;HBASE-5572&lt;/del&gt;&lt;/a&gt; for the reasons...&lt;/p&gt;

&lt;p&gt;On Fri, Mar 16, 2012 at 6:41 PM, Zhihong Yu (Commented) (JIRA) &amp;lt;&lt;/p&gt;
</comment>
                            <comment id="13231444" author="nkeywal" created="Fri, 16 Mar 2012 17:52:25 +0000"  >&lt;p&gt;Can&apos;t create a review, I got error 500 as well...&lt;/p&gt;</comment>
                            <comment id="13231453" author="nkeywal" created="Fri, 16 Mar 2012 17:57:33 +0000"  >&lt;p&gt;Now it works: &lt;a href=&quot;https://reviews.apache.org/r/4391/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/4391/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13231478" author="zhihyu@ebaysf.com" created="Fri, 16 Mar 2012 18:20:28 +0000"  >&lt;p&gt;Commented on review board.&lt;/p&gt;</comment>
                            <comment id="13231491" author="stack" created="Fri, 16 Mar 2012 18:29:02 +0000"  >&lt;p&gt;@N LGTM.  Change reconnectAfterExpiry to reconnectAfterExpiration and post patch here.   Will run it through hadoopqa then commit if all good.&lt;/p&gt;</comment>
                            <comment id="13231598" author="nkeywal" created="Fri, 16 Mar 2012 20:35:32 +0000"  >&lt;p&gt;v11 with the comments taken into account... Thank you for the review.&lt;/p&gt;</comment>
                            <comment id="13231646" author="hadoopqa" created="Fri, 16 Mar 2012 21:26:19 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12518730/5549.v11.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12518730/5549.v11.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 20 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 161 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportTsv&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1210//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1210//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1210//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1210//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1210//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1210//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13231651" author="zhihyu@ebaysf.com" created="Fri, 16 Mar 2012 21:31:36 +0000"  >&lt;p&gt;Integrated to TRUNK.&lt;/p&gt;

&lt;p&gt;Thanks for the patch, N.&lt;/p&gt;

&lt;p&gt;Thanks for the review, Stack.&lt;/p&gt;</comment>
                            <comment id="13231676" author="lhofhansl" created="Fri, 16 Mar 2012 22:09:46 +0000"  >&lt;p&gt;Hey N., is this dependent on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5399&quot; title=&quot;Cut the link between the client and the zookeeper ensemble&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5399&quot;&gt;&lt;del&gt;HBASE-5399&lt;/del&gt;&lt;/a&gt;. If not, it might be a good candidate for 0.94.&lt;/p&gt;</comment>
                            <comment id="13231695" author="hudson" created="Fri, 16 Mar 2012 22:32:13 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2686 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2686/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2686/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5549&quot; title=&quot;Master can fail if ZooKeeper session expires&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5549&quot;&gt;&lt;del&gt;HBASE-5549&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5572&quot; title=&quot;KeeperException.SessionExpiredException management could be improved in Master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5572&quot;&gt;&lt;del&gt;HBASE-5572&lt;/del&gt;&lt;/a&gt; Master can fail if ZooKeeper session expires (N Keywal) (Revision 1301775)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/TestZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterZKSessionRecovery.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransactionOnCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationPeer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13231858" author="hudson" created="Sat, 17 Mar 2012 05:56:25 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #140 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/140/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/140/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5549&quot; title=&quot;Master can fail if ZooKeeper session expires&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5549&quot;&gt;&lt;del&gt;HBASE-5549&lt;/del&gt;&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5572&quot; title=&quot;KeeperException.SessionExpiredException management could be improved in Master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5572&quot;&gt;&lt;del&gt;HBASE-5572&lt;/del&gt;&lt;/a&gt; Master can fail if ZooKeeper session expires (N Keywal) (Revision 1301775)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/TestZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterZKSessionRecovery.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransactionOnCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationPeer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13232005" author="nkeywal" created="Sat, 17 Mar 2012 16:39:43 +0000"  >&lt;p&gt;@lars: there is no theoretical dependency. In practice, I think that both impacted some same tests so it may require some minor changes when applying the patch.&lt;/p&gt;</comment>
                            <comment id="13406763" author="v.himanshu" created="Wed, 4 Jul 2012 21:41:13 +0000"  >&lt;p&gt;This seems to fix the HBaseTestingUtility#expiresession method as it introduced a new logic of creating a monitor and then expiring the session. But it seems this fix needs some more work? For example, TestReplicationPeer occasionally fails even with this change on the trunk, citing improper session termination.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testResetZooKeeperSession(org.apache.hadoop.hbase.replication.TestReplicationPeer): ReplicationPeer ZooKeeper session was not properly expired.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On another note, I wonder whether this patch can be backported to 0.92/0.94?&lt;/p&gt;</comment>
                            <comment id="13406977" author="nkeywal" created="Thu, 5 Jul 2012 10:58:34 +0000"  >&lt;p&gt;It should be portable to previous branches. As it impacts multiple files there could be some conflict but this jira is quite self contained.&lt;/p&gt;

&lt;p&gt;For the test part, reading the code you mentioned, yeah it could be &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. I don&apos;t see why it&apos;s failing however. Making zookeeper session expire is a kind of black art...&lt;/p&gt;</comment>
                            <comment id="13408770" author="v.himanshu" created="Sat, 7 Jul 2012 20:52:36 +0000"  >&lt;p&gt;From the code (and javadoc), it seems we are not 100% sure of the zookeeper close session event. &lt;br/&gt;
And, we avoid test failures based on that (either by re-creating zkw as in TestZookeeper#testClientSessionExpired, or remove asserts altogether, TestReplicationPeer.&lt;br/&gt;
Is it ok to impose a hard wait on the session timeout (basic idea is to have this in HBaseTestingUtility#expireSession):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;[] isClosed = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt;[]{&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;} ;
+    ZooKeeper monitorWatcher = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZooKeeper(quorumServers, sessionTimeout, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Watcher() {
+      @Override
+      &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(WatchedEvent event) {
+        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Closed in the monitor.&quot;&lt;/span&gt;);
+        isClosed[0] = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; ;
+      }
+    }, sessionID, password);
     monitorWatcher.close();
+    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt;(!isClosed[0]){
+      &lt;span class=&quot;code-comment&quot;&gt;// sleep;
&lt;/span&gt;+      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(sessionTimeout);
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And, remove the two handler approach.&lt;/p&gt;

&lt;p&gt;This way, we are sure that the session has indeed expired, and clean up the tests. The downside is we sleep, until we actually have expired the session (or we can have some increasing sleep time duration and then fail the process after a hard limit). &lt;br/&gt;
Good to know what others think.&lt;/p&gt;</comment>
                            <comment id="13408772" author="nkeywal" created="Sat, 7 Jul 2012 21:03:59 +0000"  >&lt;p&gt;It seems to be a good idea. For the implementation, you should replace the sleep by a notify, plus &apos;isClosed&apos; should be also be a simple boolean instead of an array, tagged as volatile as it&apos;s used between thread.&lt;/p&gt;</comment>
                            <comment id="13408782" author="v.himanshu" created="Sat, 7 Jul 2012 21:30:38 +0000"  >&lt;p&gt;Thanks for looking into this. &lt;br/&gt;
Since the update is happening inside an inner class, it should be final (volatile is not possible). I will wait/notify on isClosed array object, and upload the patch in a new jira.&lt;/p&gt;</comment>
                            <comment id="13439753" author="stack" created="Wed, 22 Aug 2012 18:46:35 +0000"  >&lt;p&gt;@Himanshu What JIRA did you upload your fix too?&lt;/p&gt;</comment>
                            <comment id="13439951" author="stack" created="Wed, 22 Aug 2012 23:46:00 +0000"  >&lt;p&gt;Backport of the trunk patch to 0.92&lt;/p&gt;</comment>
                            <comment id="13439992" author="v.himanshu" created="Thu, 23 Aug 2012 01:29:41 +0000"  >&lt;p&gt;@Stack: The patch is at HBase-6354. It is based on the approach as mentioned in the above comment. It works as per current approach, but when I tried to catch explicitly the &quot;Expired&quot; event in the process method of the watcher, it hangs as if it never received that event. In that case, the only event it received is SynConnected, which is when you create a new zk instance. &lt;br/&gt;
Basically, this:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    ZooKeeper monitorWatcher = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ZooKeeper(quorumServers, 1000,
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Watcher() {
          @Override
          &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void process(WatchedEvent event) {
            KeeperState state = event.getState();
            &lt;span class=&quot;code-keyword&quot;&gt;switch&lt;/span&gt; (state) {
            &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt; Expired:
              LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;processing SessionExpired event&quot;&lt;/span&gt;);
              sessionClosed.set(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
              &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (sessionClosed) {
                sessionClosed.notifyAll();
              }
              &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;:
                LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;processing &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; event&quot;&lt;/span&gt; +state);

             }
          }
        }, sessionID, password);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Sorry for the late  reply.&lt;/p&gt;</comment>
                            <comment id="13439993" author="v.himanshu" created="Thu, 23 Aug 2012 01:31:21 +0000"  >&lt;p&gt;by &quot;hang&quot;, I mean &quot;hangs occasionally&quot;. &lt;/p&gt;</comment>
                            <comment id="13440044" author="lhofhansl" created="Thu, 23 Aug 2012 04:29:37 +0000"  >&lt;p&gt;@Stack: are you planning to integrate the patch into 0.92? If so, let&apos;s mark this issue with fix version of 0.92 (and 0.94)... Should have a 0.94 patch as well.&lt;/p&gt;</comment>
                            <comment id="13440067" author="stack" created="Thu, 23 Aug 2012 05:41:27 +0000"  >&lt;p&gt;Applied to 0.92 branch.  Working on patch for 0.94 now.&lt;/p&gt;</comment>
                            <comment id="13440069" author="stack" created="Thu, 23 Aug 2012 05:55:04 +0000"  >&lt;p&gt;I tested the 0.92 patch on two machines and it didn&apos;t seem to break anything.  I got a fail though it ran 1142 tests.   A repeat ran all tests but it failed TestMasterReplication.  Will keep an eye on it.&lt;/p&gt;</comment>
                            <comment id="13440070" author="stack" created="Thu, 23 Aug 2012 05:56:39 +0000"  >&lt;p&gt;Patch for 0.94.  Doesn&apos;t seem to have broken anything obvious.  Will apply and keep an eye out.&lt;/p&gt;</comment>
                            <comment id="13440071" author="stack" created="Thu, 23 Aug 2012 05:57:19 +0000"  >&lt;p&gt;Applied to 0.94 branch.&lt;/p&gt;</comment>
                            <comment id="13440074" author="stack" created="Thu, 23 Aug 2012 06:10:06 +0000"  >&lt;p&gt;@Himanshu A thread dump when its hung?  Might tell us something?&lt;br/&gt;
@Lars Done  I&apos;m triggering and watching 0.94 builds... will make sure I&apos;ve not added a regression.&lt;/p&gt;</comment>
                            <comment id="13440081" author="lhofhansl" created="Thu, 23 Aug 2012 06:21:16 +0000"  >&lt;p&gt;Thanks Stack! I was going to do the 0.94 patch tomorrow... But this is better &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13440097" author="hudson" created="Thu, 23 Aug 2012 07:25:30 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #417 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/417/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/417/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5549&quot; title=&quot;Master can fail if ZooKeeper session expires&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5549&quot;&gt;&lt;del&gt;HBASE-5549&lt;/del&gt;&lt;/a&gt; Master can fail if ZooKeeper session expires (Revision 1376374)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/TestZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestMasterZKSessionRecovery.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransactionOnCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13440153" author="hudson" created="Thu, 23 Aug 2012 08:55:23 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #116 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/116/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/116/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5549&quot; title=&quot;Master can fail if ZooKeeper session expires&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5549&quot;&gt;&lt;del&gt;HBASE-5549&lt;/del&gt;&lt;/a&gt; Master can fail if ZooKeeper session expires (Revision 1376369)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/TestZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/master/TestMasterZKSessionRecovery.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransactionOnCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationPeer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13440214" author="hudson" created="Thu, 23 Aug 2012 11:12:42 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #49 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/49/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/49/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5549&quot; title=&quot;Master can fail if ZooKeeper session expires&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5549&quot;&gt;&lt;del&gt;HBASE-5549&lt;/del&gt;&lt;/a&gt; Master can fail if ZooKeeper session expires (Revision 1376374)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/TestZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestMasterZKSessionRecovery.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransactionOnCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13440351" author="v.himanshu" created="Thu, 23 Aug 2012 14:52:35 +0000"  >&lt;p&gt;@Stack: So, currently (in this patch also), we don&apos;t wait for the Expired event, which is not correct.&lt;br/&gt;
In 6354, v2 patch also doesn&apos;t look for it.&lt;/p&gt;

&lt;p&gt;I added this check (as mentioned earlier) but sometimes, the only event received is synConnected, and not the Expired event. So, it waits on the AtomicBoolean sessionClosed,  to become true, which will happen only when the watcher received the Expired event. Thinking today, it looks like we should invoke the close method only &lt;b&gt;after&lt;/b&gt; the monitorwatcher is properly initialized. Hmmm, I will look at this today again.&lt;/p&gt;</comment>
                            <comment id="13440378" author="stack" created="Thu, 23 Aug 2012 15:26:33 +0000"  >&lt;p&gt;@Himanshu Where is the issue which adds waiting on expire if its not being done over in hbase-6354?&lt;/p&gt;

&lt;p&gt;I backported this patch because it removed a test purportedly &apos;useless&apos; that was messing up a subsequent test.  I also backported it to get the other cleanups around zk interaction that this patch adds and to make it so there is parity here from 0.92 through to trunk.  If there is an issue w/ fix for wait on expire, I can backport that too.&lt;/p&gt;

&lt;p&gt;Suggest you look at Alex&apos;s countdown latch over in his watcher in the this patch &lt;a href=&quot;https://reviews.facebook.net/D4605&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D4605&lt;/a&gt; It does something like what you paste above for the expiration monitor.&lt;/p&gt;</comment>
                            <comment id="13448300" author="hudson" created="Wed, 5 Sep 2012 00:57:14 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #7 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/7/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/7/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5549&quot; title=&quot;Master can fail if ZooKeeper session expires&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5549&quot;&gt;&lt;del&gt;HBASE-5549&lt;/del&gt;&lt;/a&gt; Master can fail if ZooKeeper session expires (Revision 1376374)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/ActiveMasterManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/HBaseTestingUtility.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/TestZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/master/TestMasterZKSessionRecovery.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestSplitTransactionOnCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13624637" author="stack" created="Sun, 7 Apr 2013 04:34:02 +0000"  >&lt;p&gt;Fix up after bulk move overwrote some 0.94.2 fix versions w/ 0.95.0 (Noticed by Lars Hofhansl)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12542599">HBASE-5399</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12546241">HBASE-5572</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="12546241">HBASE-5572</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12518676" name="5549.v10.patch" size="35161" author="nkeywal" created="Fri, 16 Mar 2012 14:41:40 +0000"/>
                            <attachment id="12518730" name="5549.v11.patch" size="35742" author="nkeywal" created="Fri, 16 Mar 2012 20:34:08 +0000"/>
                            <attachment id="12518500" name="5549.v6.patch" size="32920" author="nkeywal" created="Thu, 15 Mar 2012 18:25:31 +0000"/>
                            <attachment id="12518660" name="5549.v7.patch" size="35957" author="nkeywal" created="Fri, 16 Mar 2012 12:31:54 +0000"/>
                            <attachment id="12518664" name="5549.v8.patch" size="35537" author="nkeywal" created="Fri, 16 Mar 2012 13:30:34 +0000"/>
                            <attachment id="12518665" name="5549.v9.patch" size="35181" author="nkeywal" created="Fri, 16 Mar 2012 13:32:07 +0000"/>
                            <attachment id="12542058" name="5549_092.txt" size="35132" author="stack" created="Wed, 22 Aug 2012 23:46:00 +0000"/>
                            <attachment id="12542090" name="5549_094.txt" size="28643" author="stack" created="Thu, 23 Aug 2012 05:56:39 +0000"/>
                            <attachment id="12518639" name="nochange.patch" size="338" author="nkeywal" created="Fri, 16 Mar 2012 09:23:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 15 Mar 2012 19:37:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231016</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 36 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0695j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34414</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>