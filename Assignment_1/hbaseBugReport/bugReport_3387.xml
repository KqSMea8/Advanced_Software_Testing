<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:09:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3387/HBASE-3387.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3387] Pair does not deep check arrays for equality. </title>
                <link>https://issues.apache.org/jira/browse/HBASE-3387</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Pair does not deep check arrays for equality. It merely does x.equals&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/thumbs_up.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; for the sent Object. However, with any type of array this is merely going to compare the array pointers, rather than the underlying data structure.&lt;/p&gt;

&lt;p&gt;It requires a rewriting of the private equals method in Pair to check for elements being an array, then checking the underlying elements.&lt;/p&gt;</description>
                <environment>&lt;p&gt;Any (discovered in Ubuntu 10.10 using TRUNK). &lt;/p&gt;</environment>
        <key id="12493917">HBASE-3387</key>
            <summary>Pair does not deep check arrays for equality. </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jesse_yates">Jesse Yates</assignee>
                                    <reporter username="jesse_yates">Jesse Yates</reporter>
                        <labels>
                    </labels>
                <created>Wed, 22 Dec 2010 19:26:40 +0000</created>
                <updated>Wed, 12 Oct 2011 21:39:16 +0000</updated>
                            <resolved>Wed, 29 Dec 2010 00:10:38 +0000</resolved>
                                    <version>0.90.1</version>
                                                    <component>util</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                    <timeoriginalestimate seconds="0">0h</timeoriginalestimate>
                            <timeestimate seconds="0">0h</timeestimate>
                                        <comments>
                            <comment id="12974345" author="jesse_yates" created="Wed, 22 Dec 2010 19:29:04 +0000"  >&lt;p&gt;Fix (and tests) for the issue. Does deep check on an array, if it is an array.&lt;/p&gt;</comment>
                            <comment id="12974357" author="stack" created="Wed, 22 Dec 2010 19:51:30 +0000"  >&lt;p&gt;Patch looks good Jesse.  Thanks for making it.   Minor comments are that you changed a bunch of formatting &amp;#8211; 90% of it is improvement over what was there previous &amp;#8211; but you messed up the license formatting on the top of the file.  Also, minor stylistic comment is that you wrote the equals with a load of indentation when you could have done without by doing the &apos;other&apos; test first.  For example:&lt;/p&gt;

&lt;p&gt;If instead of a #133 that looks like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (x != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; y != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;.. you instead did:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (x == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || y == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... you&apos;d save an indent and IMO the code is easier to read?&lt;/p&gt;

&lt;p&gt;What you think?  If you&apos;d like to fix the above, go for it... otherwise, i&apos;ll fix the license myself and commit as is.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="12974373" author="jesse_yates" created="Wed, 22 Dec 2010 20:26:14 +0000"  >&lt;p&gt;Stack, I see what you are saying about the &amp;amp;&amp;amp; vs ||. I think the original way involves and extra line (was shooting or concise), but I prefer your way; I&apos;ll switch it up.&lt;/p&gt;

&lt;p&gt;Sorry about the reformatting- old eclipse autoformat habits die hard- though I was using trying to use the hbase std format. Do you want me to switch it back to the old version or just keep it?&lt;/p&gt;</comment>
                            <comment id="12974383" author="stack" created="Wed, 22 Dec 2010 20:55:10 +0000"  >&lt;p&gt;Your formatting improvements were near all moving the file closer to the hbase &apos;standard&apos; format so they are all good.  The only mess was the way it did license at head of the file.  Fix if you can.  Don&apos;t worry if you can&apos;t.  If&apos;ll fix on commit.  Thanks.&lt;/p&gt;</comment>
                            <comment id="12974825" author="jesse_yates" created="Fri, 24 Dec 2010 02:37:06 +0000"  >&lt;p&gt;Updated patch based on stack&apos;s comment&apos;s for || vs. &amp;amp;&amp;amp; and (hopefully) license. &lt;/p&gt;

&lt;p&gt;Sorry about the late update - hotel internet was crapping out &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="12975634" author="stack" created="Tue, 28 Dec 2010 21:30:19 +0000"  >&lt;p&gt;@Jesse When I try to apply this patch I get this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
stack:trunk Stack$ patch -p1 &amp;lt; HBASE-3387.patch 
patching file src/main/java/org/apache/hadoop/hbase/util/Pair.java
patch: **** malformed patch at line 34:   * @param &amp;lt;T1&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Does it apply for you?&lt;/p&gt;</comment>
                            <comment id="12975658" author="jesse_yates" created="Tue, 28 Dec 2010 22:18:51 +0000"  >&lt;p&gt;Sorry about the non-working patch - turns out it was b/c git diff (at least in my setup) appends a/ and b/ to the directories of the original and new versions. This means that the patch will necessarily fail. Went back through, edited by hand and double checked that it works this time. Sorry again!&lt;/p&gt;</comment>
                            <comment id="12975685" author="stack" created="Wed, 29 Dec 2010 00:05:25 +0000"  >&lt;p&gt;Committed to TRUNK.  Thanks for the patch Jesse.  Will leave it in 0.90.1 bucket so it gets committed there too.&lt;/p&gt;</comment>
                            <comment id="12975686" author="stack" created="Wed, 29 Dec 2010 00:05:41 +0000"  >&lt;p&gt;Reopening to commit 0.90.1&lt;/p&gt;</comment>
                            <comment id="12975687" author="stack" created="Wed, 29 Dec 2010 00:10:38 +0000"  >&lt;p&gt;Committed to branch after tagging RC2&lt;/p&gt;</comment>
                            <comment id="12975706" author="hudson" created="Wed, 29 Dec 2010 03:16:27 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1699 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1699/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1699/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3387&quot; title=&quot;Pair does not deep check arrays for equality. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3387&quot;&gt;&lt;del&gt;HBASE-3387&lt;/del&gt;&lt;/a&gt; Pair does not deep check arrays for equality&lt;/p&gt;</comment>
                            <comment id="12982489" author="nspiegelberg" created="Mon, 17 Jan 2011 06:02:49 +0000"  >&lt;p&gt;This JIRA patch is a big consistency problem and should be reverted!  &lt;a href=&quot;http://www.ibm.com/developerworks/java/library/j-jtp05273.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.ibm.com/developerworks/java/library/j-jtp05273.html&lt;/a&gt;  &lt;/p&gt;

&lt;p&gt;Basically, java containers assume a.equals(b) == false if a.hashcode() != b.hashcode().  Furthermore,&lt;/p&gt;

&lt;p&gt;byte[] a = &lt;/p&gt;
{0,1,2}, b = {0,1,2}
&lt;p&gt;;&lt;br/&gt;
false == a.equals(b)&lt;br/&gt;
true == Pair.newPair(a,a).equals(Pair.newPair(b,b))&lt;/p&gt;

&lt;p&gt;Was this patch introduced to fix any bug in the existing subsystem?&lt;/p&gt;</comment>
                            <comment id="12982671" author="jesse_yates" created="Mon, 17 Jan 2011 15:41:21 +0000"  >&lt;p&gt;This was introduced to correct behavior in software on my side (e.g. non-HBase core) that for all intents and purposes should have worked, but didn&apos;t because of the previous definition of Pair.equals().&lt;/p&gt;

&lt;p&gt;As far as the equals/hashCode issue, we could also overwrite the hashCode in Pair to ensure that the equals and hashCode methods work out to the same equality.&lt;/p&gt;

&lt;p&gt;This change was made because they underlying arrays really should check the underlying types in Pairs, to check if they really would be the same thing. If we fix the hashCode method, then I think we end up with a system that is really more flexible than just comparing the pointer addresses.&lt;/p&gt;

&lt;p&gt;. Is there somewhere in HBase where this breaks the current model and I just missed it?&lt;/p&gt;</comment>
                            <comment id="12982775" author="ekohlwey" created="Mon, 17 Jan 2011 18:01:49 +0000"  >&lt;p&gt;@Nicolas Spiegelberg&lt;br/&gt;
Is the issue just that the hashCode contract isn&apos;t kept here? I&apos;d suggest that thats a separate bug (missing hashCode), but not an issue such that the patch needs to be reverted.&lt;/p&gt;</comment>
                            <comment id="12982861" author="nspiegelberg" created="Mon, 17 Jan 2011 21:01:42 +0000"  >&lt;p&gt;Although the hasCode contract was the original issue that I noticed, a deeper issue that this is a fundamental violation of equivalence relationships (&lt;a href=&quot;http://en.wikipedia.org/wiki/Equivalence_relation&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://en.wikipedia.org/wiki/Equivalence_relation&lt;/a&gt; ).  In particular, overriding Java functionality for one special class is making Java&apos;s equality operations non-symmetric.  For example:&lt;/p&gt;

&lt;p&gt;byte[] a = &lt;/p&gt;
{0,1,2}, b = {0,1,2}
&lt;p&gt;;&lt;br/&gt;
System.out.println( a.equals(b) );  // false&lt;br/&gt;
Pair&amp;lt;byte[], byte[]&amp;gt; pa = Pair.newPair(a,a); pb = Pair.newPair(b,b);&lt;br/&gt;
System.out.println(pa.equals(pb); // true&lt;br/&gt;
System.out.println(pa.getFirst().equals(pb.getFirst()) &amp;amp;&amp;amp; pa.getSecond().equals(pb.getSecond())); // false&lt;/p&gt;

&lt;p&gt;The current equals override makes it such that a == c &amp;amp;&amp;amp; b == d is not symmetric with (a,b) == (c,d). &lt;/p&gt;

&lt;p&gt;I understand your problem with needing a deep comparison.  However, I think if you want deep comparisons, you need to take another action other than overriding a contracted Java API.  Example ideas:&lt;/p&gt;

&lt;p&gt;1. Use org.apache.hadoop.hbase.util.Bytes.ByteArrayComparator for your collection&apos;s comparator or hand-roll your own.&lt;br/&gt;
2. Create a DeepEqual template class that utilizes java.util.Arrays.deepEquals &amp;amp; deepHashCode.  Then create a Pair&amp;lt;DeepEqual&amp;lt;T&amp;gt;, DeepEqual&amp;lt;T&amp;gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;However, the Pair class must be refactored to restore its equivalence relations.  The Pair/Tuple class is a well-known idiom and should act the same here as it does in C++, Python , and other languages.&lt;/p&gt;</comment>
                            <comment id="12983034" author="stack" created="Tue, 18 Jan 2011 06:27:27 +0000"  >&lt;p&gt;Thanks for catching this Nicolas.  Jesse you want to have a go at it?  Otherwise I will.&lt;/p&gt;</comment>
                            <comment id="12983035" author="stack" created="Tue, 18 Jan 2011 06:28:13 +0000"  >&lt;p&gt;Upping priority some.&lt;/p&gt;</comment>
                            <comment id="12983178" author="jesse_yates" created="Tue, 18 Jan 2011 13:18:26 +0000"  >&lt;p&gt;Yeah, I got it- up by this afternoon.&lt;/p&gt;

&lt;p&gt;Does it make any sense to add in a DeepCheck class (as discussed above) or should I just keep something like that application side?&lt;/p&gt;</comment>
                            <comment id="12983437" author="jesse_yates" created="Tue, 18 Jan 2011 23:29:46 +0000"  >&lt;p&gt;Revert patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3387&quot; title=&quot;Pair does not deep check arrays for equality. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3387&quot;&gt;&lt;del&gt;HBASE-3387&lt;/del&gt;&lt;/a&gt; issue to roll back the changes as per discussion.&lt;/p&gt;</comment>
                            <comment id="12983959" author="stack" created="Thu, 20 Jan 2011 00:45:45 +0000"  >&lt;p&gt;I just applied your revert patch to trunk and 0.90 branch Jesse.  Thanks for providing it Jesse.   Thanks Nicolas for catching this.  I should have.&lt;/p&gt;</comment>
                            <comment id="12984006" author="hudson" created="Thu, 20 Jan 2011 03:03:14 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1714 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1714/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1714/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3387&quot; title=&quot;Pair does not deep check arrays for equality. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3387&quot;&gt;&lt;del&gt;HBASE-3387&lt;/del&gt;&lt;/a&gt; Pair does not deep check arrays for equality &amp;#8211; REVERTED&lt;/p&gt;</comment>
                            <comment id="12984867" author="stack" created="Fri, 21 Jan 2011 19:04:48 +0000"  >&lt;p&gt;Moving out of 0.90.1.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12501426">HBASE-3644</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12468699" name="HBASE-3387-revert.patch" size="4751" author="jesse_yates" created="Tue, 18 Jan 2011 23:29:46 +0000"/>
                            <attachment id="12467073" name="HBASE-3387.patch" size="4794" author="jesse_yates" created="Tue, 28 Dec 2010 22:18:51 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 22 Dec 2010 19:51:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26826</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 48 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hm2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100837</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Pair now does a deep equals on arrays, rather than a shallow, pointer compare.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>