<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:17:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10810/HBASE-10810.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10810] LoadTestTool should share the connection and connection pool</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10810</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;While running the IT test from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10572&quot; title=&quot;Create an IntegrationTest for region replicas&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10572&quot;&gt;&lt;del&gt;HBASE-10572&lt;/del&gt;&lt;/a&gt;, we&apos;ve noticed that the number of threads jumps to 4K&apos;s when CM actions are going on. &lt;/p&gt;

&lt;p&gt;Our &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; summarizes the problem quite good: &lt;/p&gt;

&lt;p&gt;MultiThreadedReader creates this pool for each HTable:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    ThreadPoolExecutor pool = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ThreadPoolExecutor(1, maxThreads, keepAliveTime, TimeUnit.SECONDS,
        &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SynchronousQueue&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt;&amp;gt;(), Threads.newDaemonThreadFactory(&lt;span class=&quot;code-quote&quot;&gt;&quot;htable&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This comes from the HTable creation&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;  
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; HTable(Configuration conf, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; TableName tableName)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;As well the javadoc says Recommended.&lt;br/&gt;
This is wrong.&lt;/p&gt;

&lt;p&gt;In this issue we can change the LTT sub classes to use the shared connection object and initialize their tables using HConnection.getTable() rather than new HTable(). &lt;/p&gt;

&lt;p&gt;This is relevant to trunk as well, but there since there is only one outstanding RPC per thread, it is not such a big problem. &lt;/p&gt;

</description>
                <environment></environment>
        <key id="12702998">HBASE-10810</key>
            <summary>LoadTestTool should share the connection and connection pool</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12682280">HBASE-10070</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="enis">Enis Soztutar</assignee>
                                    <reporter username="enis">Enis Soztutar</reporter>
                        <labels>
                    </labels>
                <created>Sat, 22 Mar 2014 00:03:24 +0000</created>
                <updated>Sat, 21 Feb 2015 23:29:15 +0000</updated>
                            <resolved>Thu, 15 May 2014 23:48:49 +0000</resolved>
                                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>hbase-10070</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13943764" author="ndimiduk" created="Sat, 22 Mar 2014 00:10:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkeywal&quot; class=&quot;user-hover&quot; rel=&quot;nkeywal&quot;&gt;Nicolas Liochon&lt;/a&gt; and I came to the same conclusion simultaneously. I think the test should be using a single pool for all tables it creates, instead of using this HTable constructor with it&apos;s managed pool. In general, I think the HTable constructor is dangerous for anything but a one-off and should be removed (see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9117&quot; title=&quot;Remove HTablePool and all HConnection pooling related APIs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9117&quot;&gt;&lt;del&gt;HBASE-9117&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="13943798" author="enis" created="Sat, 22 Mar 2014 00:50:48 +0000"  >&lt;p&gt;Here is a simple enough patch. It changes new HTable()&apos;s with HConnection.getTable() calls. &lt;/p&gt;

&lt;p&gt;I&apos;ve tested this with LTT and IntegrationTestTimeBoundedRequestsWithRegionReplicas with 100 writer / reader threads. &lt;/p&gt;

&lt;p&gt;The number of threads during execution with CM does not exceed 410 (100 threads for readers + 256 for pool + some other). &lt;/p&gt;</comment>
                            <comment id="13943810" author="ndimiduk" created="Sat, 22 Mar 2014 01:01:53 +0000"  >&lt;p&gt;+1 this should resolve the problem of creating so many pools with so many threads in total.&lt;/p&gt;

&lt;p&gt;What&apos;s unclear to me is how the 100 reader threads will contend for the (up to) 256 threads in the shared pool used by all HTables for the connection. I need a more thorough understanding of AsyncProcess...&lt;/p&gt;</comment>
                            <comment id="13986255" author="enis" created="Thu, 1 May 2014 00:41:19 +0000"  >&lt;p&gt;Thanks Nick for the review. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;What&apos;s unclear to me is how the 100 reader threads will contend for the (up to) 256 threads in the shared pool used by all HTables for the connection&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;In case this becomes a problem, we can increase the default pool side that the LTT connection is using.&lt;/p&gt;</comment>
                            <comment id="13998271" author="devaraj" created="Wed, 14 May 2014 23:35:57 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13999420" author="enis" created="Thu, 15 May 2014 23:48:49 +0000"  >&lt;p&gt;Committed this to branch. Thanks Nick and Devaraj for review. &lt;/p&gt;</comment>
                            <comment id="14046638" author="enis" created="Sat, 28 Jun 2014 01:48:18 +0000"  >&lt;p&gt;Attaching rebased patch for master that is committed&lt;/p&gt;</comment>
                            <comment id="14046686" author="enis" created="Sat, 28 Jun 2014 02:09:21 +0000"  >&lt;p&gt;Committed to master as part of hbase-10070 branch merge&lt;/p&gt;</comment>
                            <comment id="14046749" author="hudson" created="Sat, 28 Jun 2014 06:13:55 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5245 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5245/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5245/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10810&quot; title=&quot;LoadTestTool should share the connection and connection pool&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10810&quot;&gt;&lt;del&gt;HBASE-10810&lt;/del&gt;&lt;/a&gt; LoadTestTool should share the connection and connection pool (enis: rev 25baace0dec1fc4f3b5fb51292c8ec8a6da85ba0)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-it/src/test/java/org/apache/hadoop/hbase/test/IntegrationTestTimeBoundedRequestsWithRegionReplicas.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedReaderWithACL.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/TestMiniClusterLoadSequential.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedWriterWithACL.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedWriter.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedWriterBase.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedReader.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedAction.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedUpdaterWithACL.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/util/MultiThreadedUpdater.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14330541" author="enis" created="Sat, 21 Feb 2015 23:29:15 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12699502">HBASE-10701</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12661440">HBASE-9117</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12652976" name="0038-HBASE-10810-LoadTestTool-should-share-the-connection.patch" size="28365" author="enis" created="Sat, 28 Jun 2014 01:48:18 +0000"/>
                            <attachment id="12636159" name="hbase-10810_v1.patch" size="27411" author="enis" created="Sat, 22 Mar 2014 00:50:48 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 22 Mar 2014 00:10:11 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>381335</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tp8v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>381612</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>