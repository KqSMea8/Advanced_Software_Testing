<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:51:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14247/HBASE-14247.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14247] Separate the old WALs into different regionserver directories</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14247</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently all old WALs of regionservers are achieved into the single directory of oldWALs. In big clusters, because of long TTL of WAL or disabled replications, the number of files under oldWALs may reach the max-directory-items limit of HDFS, which will make the hbase cluster crashed.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;Caused by: org.apache.hadoop.ipc.RemoteException(org.apache.hadoop.hdfs.protocol.FSLimitException$MaxDirectoryItemsExceededException): The directory item limit of /hbase/lgprc-xiaomi/.oldlogs is exceeded: limit=1048576 items=1048576&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;A simple solution is to separate the old WALs into different  directories according to the server name of the WAL.&lt;/p&gt;

&lt;p&gt;Suggestions are welcomed~ Thanks&lt;/p&gt;</description>
                <environment></environment>
        <key id="12857103">HBASE-14247</key>
            <summary>Separate the old WALs into different regionserver directories</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="10002" iconUrl="https://issues.apache.org/jira/images/icons/statuses/document.png" description="A patch for this issue has been uploaded to JIRA by a contributor.">Patch Available</status>
                    <statusCategory id="4" key="indeterminate" colorName="yellow"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="liushaohui">Liu Shaohui</assignee>
                                    <reporter username="liushaohui">Liu Shaohui</reporter>
                        <labels>
                    </labels>
                <created>Wed, 19 Aug 2015 03:30:33 +0000</created>
                <updated>Mon, 24 Aug 2015 14:16:04 +0000</updated>
                                                            <fixVersion>2.0.0</fixVersion>
                                    <component>wal</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="14702555" author="vrodionov" created="Wed, 19 Aug 2015 06:09:30 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Suggestions are welcomed&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Increase &lt;b&gt;dfs.block.size&lt;/b&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Having separate dir for every server is a good idea.  &lt;/p&gt;</comment>
                            <comment id="14704525" author="liushaohui" created="Thu, 20 Aug 2015 08:50:18 +0000"  >&lt;p&gt;First patch to trigger large tests&lt;/p&gt;</comment>
                            <comment id="14704537" author="liushaohui" created="Thu, 20 Aug 2015 08:56:35 +0000"  >&lt;p&gt;Please help to review at &lt;a href=&quot;https://reviews.apache.org/r/37641/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/37641/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14706445" author="liushaohui" created="Fri, 21 Aug 2015 09:17:54 +0000"  >&lt;p&gt;Fix some failed tests&lt;/p&gt;</comment>
                            <comment id="14706449" author="liushaohui" created="Fri, 21 Aug 2015 09:20:23 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;&lt;br/&gt;
What&apos;s your suggestions about this change?&lt;/p&gt;</comment>
                            <comment id="14706853" author="davelatham" created="Fri, 21 Aug 2015 15:19:07 +0000"  >&lt;p&gt;One concern with this change is that the OldLogCleaner as it is implemented will now have to run through the cleaner checks for every region&apos;s subdirectory instead of doing them all in one batch.  It will likely make the cleaner chore much slower and may not be able to keep up for large clusters.&lt;/p&gt;</comment>
                            <comment id="14706859" author="davelatham" created="Fri, 21 Aug 2015 15:22:03 +0000"  >&lt;p&gt;Oops, I meant to say every &lt;b&gt;region server&apos;s&lt;/b&gt; subdirectory (instead of every &lt;b&gt;region&apos;s&lt;/b&gt; subdirectory).&lt;br/&gt;
This may be able to be mitigated by batching up cleaning checks across directories.&lt;/p&gt;</comment>
                            <comment id="14707384" author="hadoopqa" created="Fri, 21 Aug 2015 20:06:06 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12751688/HBASE-14247-v002.diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12751688/HBASE-14247-v002.diff&lt;/a&gt;&lt;br/&gt;
  against master branch at commit bcef28eefaf192b0ad48c8011f98b8e944340da5.&lt;br/&gt;
  ATTACHMENT ID: 12751688&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 30 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 1 warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 1859 checkstyle errors (more than the master&apos;s current 1857 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestSplitTransactionOnCluster&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hdfs.server.namenode.TestFileTruncate.testTruncateRecovery(TestFileTruncate.java:1059)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15198//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15198//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15198//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15198//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15198//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15198//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15198//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15198//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15198//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15198//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14708910" author="liushaohui" created="Mon, 24 Aug 2015 07:44:08 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=davelatham&quot; class=&quot;user-hover&quot; rel=&quot;davelatham&quot;&gt;Dave Latham&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;One concern with this change is that the OldLogCleaner as it is implemented will now have to run through the cleaner checks for every regionserver&apos;s subdirectory instead of doing them all in one batch. It will likely make the cleaner chore much slower and may not be able to keep up for large clusters.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t think this will be problem. Currenly the HFileCleaner have to run through the cleaner checks for every store&apos;s subdirectory of every region of every table and we didn&apos;t see the problem of efficiency. So I won&apos;t need to worry about the OldLogCleaner in new layout of old layout.&lt;/p&gt;

&lt;p&gt;What&apos;s more, we can turn up the cleaner period by config hbase.master.cleaner.interval.&lt;/p&gt;</comment>
                            <comment id="14708939" author="liushaohui" created="Mon, 24 Aug 2015 08:14:34 +0000"  >&lt;p&gt;Fix the checkstyle problems&lt;/p&gt;</comment>
                            <comment id="14709350" author="davelatham" created="Mon, 24 Aug 2015 14:16:04 +0000"  >&lt;blockquote&gt;
&lt;p&gt;I don&apos;t think this will be problem. Currenly the HFileCleaner have to run through the cleaner checks for every store&apos;s subdirectory of every region of every table and we didn&apos;t see the problem of efficiency. So I won&apos;t need to worry about the OldLogCleaner in new layout of old layout.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The HFileCleaner does not need to check anything that is O(regions) or O(servers).  It only cleans the archive directory which I believe only has a subdirectory for each column family.  But this issue would not affect the HFileCleaner - only the OldLogCleaner which currently only has to process a single batch.  It has a different set of cleaner checks - including the ReplicationLogCleaner.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;What&apos;s more, we can turn up the cleaner period by config hbase.master.cleaner.interval.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We&apos;ve had a problem before where the cleaner cannot clean old files as fast as the new ones are created.  (See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9208&quot; title=&quot;ReplicationLogCleaner slow at large scale&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9208&quot;&gt;&lt;del&gt;HBASE-9208&lt;/del&gt;&lt;/a&gt; for one example).  When that happens, it doesn&apos;t matter what the hbase.master.cleaner.interval is.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12751450" name="HBASE-14247-v001.diff" size="35938" author="liushaohui" created="Thu, 20 Aug 2015 08:50:18 +0000"/>
                            <attachment id="12751688" name="HBASE-14247-v002.diff" size="37876" author="liushaohui" created="Fri, 21 Aug 2015 09:17:54 +0000"/>
                            <attachment id="12751989" name="HBASE-14247-v003.diff" size="38759" author="liushaohui" created="Mon, 24 Aug 2015 08:14:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 19 Aug 2015 06:09:30 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2j333:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>