<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:35:38 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6310/HBASE-6310.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6310] -ROOT- corruption when .META. is using the old encoding scheme</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6310</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We&apos;re still working the on the root cause here, but after the leap second armageddon we had a hard time getting our 0.94 cluster back up. This is what we saw in the logs until the master died by itself:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;2012-07-01 23:01:52,149 DEBUG
org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation:
locateRegionInMeta parentTable=-ROOT-,
metaLocation={region=-ROOT-,,0.70236052, hostname=sfor3s28,
port=10304}, attempt=16 of 100 failed; retrying after sleep of 32000
because: HRegionInfo was null or empty in -ROOT-,
row=keyvalues={.META.,,1259448304806/info:server/1341124914705/Put/vlen=14/ts=0,
.META.,,1259448304806/info:serverstartcode/1341124914705/Put/vlen=8/ts=0}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;(it&apos;s strage that we retry this)&lt;/p&gt;

&lt;p&gt;This was really misleading because I could see the regioninfo in a scan:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hbase(main):002:0&amp;gt; scan &apos;-ROOT-&apos;
ROW                                           COLUMN+CELL
 .META.,,1                                    column=info:regioninfo,
timestamp=1331755381142, value={NAME =&amp;gt; &apos;.META.,,1&apos;, STARTKEY =&amp;gt; &apos;&apos;,
ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 1028785192,}
 .META.,,1                                    column=info:server,
timestamp=1341183448693, value=sfor3s40:10304
 .META.,,1
column=info:serverstartcode, timestamp=1341183448693,
value=1341183444689
 .META.,,1                                    column=info:v,
timestamp=1331755419291, value=\x00\x00
 .META.,,1259448304806                        column=info:server,
timestamp=1341124914705, value=sfor3s24:10304
 .META.,,1259448304806
column=info:serverstartcode, timestamp=1341124914705,
value=1341124455863
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Except that the devil is in the details, &quot;.META.,,1&quot; is not &quot;.META.,,1259448304806&quot;. Basically something writes to .META. by directly creating the row key without caring if the row is in the old format. I did a deleteall in the shell and it fixed the issue... until some time later it was stuck again because the edits reappeared (still not sure why). This time the PostOpenDeployTasksThread were stuck in the RS trying to update .META. but there was no logging (saw it with a jstack). I deleted the row again to make it work.&lt;/p&gt;

&lt;p&gt;I&apos;m marking this as a blocker against 0.94.2 since we&apos;re trying to get 0.94.1 out, but I wouldn&apos;t recommend upgrading to 0.94 if your cluster was created before 0.89&lt;/p&gt;</description>
                <environment></environment>
        <key id="12596851">HBASE-6310</key>
            <summary>-ROOT- corruption when .META. is using the old encoding scheme</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Jul 2012 00:07:59 +0000</created>
                <updated>Fri, 20 Jul 2012 23:17:16 +0000</updated>
                            <resolved>Fri, 20 Jul 2012 23:17:16 +0000</resolved>
                                    <version>0.94.0</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13410536" author="lhofhansl" created="Tue, 10 Jul 2012 16:57:48 +0000"  >&lt;p&gt;Is this problem not present in 0.92.x?&lt;/p&gt;</comment>
                            <comment id="13410539" author="jdcryans" created="Tue, 10 Jul 2012 17:01:13 +0000"  >&lt;p&gt;Maybe, I can&apos;t tell for sure until we find the code that has the issue, but we&apos;ve been running 0.92 for &amp;gt;6 months on multiple clusters and never had this issue whereas this one 0.94 cluster has it.&lt;/p&gt;</comment>
                            <comment id="13410593" author="lhofhansl" created="Tue, 10 Jul 2012 17:39:26 +0000"  >&lt;p&gt;Pulling back into 0.94.1&lt;/p&gt;</comment>
                            <comment id="13410652" author="lhofhansl" created="Tue, 10 Jul 2012 18:17:53 +0000"  >&lt;p&gt;With the risk of insulting you: Are you sure that no other cluster is crosspointed (via a configuration error) to the 0.94 dev cluster by accident?&lt;br/&gt;
(Just saying because it happened to us once and had let to hard to explain behavior)&lt;/p&gt;</comment>
                            <comment id="13410769" author="jdcryans" created="Tue, 10 Jul 2012 20:09:07 +0000"  >&lt;p&gt;I could see the master assigning the region correctly but then failing at reading .META. so I&apos;d say it&apos;s unlikely.&lt;/p&gt;</comment>
                            <comment id="13410918" author="zhihyu@ebaysf.com" created="Tue, 10 Jul 2012 21:14:52 +0000"  >&lt;blockquote&gt;&lt;p&gt;if your cluster was created before 0.89&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;May I ask which version of HBase was running prior to 0.94 being deployed ?&lt;/p&gt;</comment>
                            <comment id="13410927" author="jdcryans" created="Tue, 10 Jul 2012 21:18:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;May I ask which version of HBase was running prior to 0.94 being deployed ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;~0.92.1&lt;/p&gt;</comment>
                            <comment id="13410937" author="zhihyu@ebaysf.com" created="Tue, 10 Jul 2012 21:26:49 +0000"  >&lt;p&gt;Since the row was manually deleted twice, I guess there was some 0.92.1 client hanging around because 0.94 code base would be using only one format.&lt;/p&gt;</comment>
                            <comment id="13410948" author="jdcryans" created="Tue, 10 Jul 2012 21:31:40 +0000"  >&lt;p&gt;A client would write the .META. location to ROOT? Unless you use the shell to do it yourself, I can&apos;t see that happening.&lt;/p&gt;</comment>
                            <comment id="13410980" author="zhihyu@ebaysf.com" created="Tue, 10 Jul 2012 22:04:41 +0000"  >&lt;p&gt;Final question:&lt;br/&gt;
Did you install 0.94.0 into a new directory tree and create symlinks based on the tree ?&lt;/p&gt;

&lt;p&gt;Meaning 0.94.0 wasn&apos;t installed into an existing directory where 0.92.1 jar(s) might hang around.&lt;/p&gt;</comment>
                            <comment id="13412954" author="lhofhansl" created="Thu, 12 Jul 2012 17:13:42 +0000"  >&lt;p&gt;Talked to Stack offline. It&apos;s possibly (likely?) a SU specific issue. Going with J-D initial assessment and moving to 0.94.2&lt;/p&gt;</comment>
                            <comment id="13416760" author="jdcryans" created="Wed, 18 Jul 2012 00:25:25 +0000"  >&lt;p&gt;It could be an issue caused by hbck, I tried running it a few months ago and it didn&apos;t work for us and I&apos;m now thinking that it actually put that invalid .META. row in ROOT. My first try on recreating the problem ended up with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6417&quot; title=&quot;hbck merges .META. regions if there&amp;#39;s an old leftover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6417&quot;&gt;&lt;del&gt;HBASE-6417&lt;/del&gt;&lt;/a&gt; so it might no be -repair that I ran.&lt;/p&gt;</comment>
                            <comment id="13418777" author="jmhsieh" created="Thu, 19 Jul 2012 23:16:50 +0000"  >&lt;p&gt;hbck writes directly to .META. but I don&apos;t think it ever writes to root unless you put the -metaonly flag on.  &lt;/p&gt;

&lt;p&gt;It may be possible that if there were two .META. region dirs, hbck tried to pull in the old .META. dir.  This would probably write something goofy to .META though.  If you just used the -repair option, it would have first tried to merge regions before modifying meta. (but also would likely have not modified ROOT).&lt;/p&gt;</comment>
                            <comment id="13419675" author="jdcryans" created="Fri, 20 Jul 2012 23:17:16 +0000"  >&lt;p&gt;I&apos;m resolving this as invalid, I was thrown in the wrong direction by what I thought were old/new .META. rows (they in fact never changed) whereas it was a .META. region from almost 3 years ago that was brought back to life. It could have been something like &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6417&quot; title=&quot;hbck merges .META. regions if there&amp;#39;s an old leftover&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6417&quot;&gt;&lt;del&gt;HBASE-6417&lt;/del&gt;&lt;/a&gt; that happened, but since I don&apos;t have those logs anymore I can&apos;t be 100% sure until I reproduce the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 10 Jul 2012 16:57:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>256586</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 21 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hutz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>102257</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>