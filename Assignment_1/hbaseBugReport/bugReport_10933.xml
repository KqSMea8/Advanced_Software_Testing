<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:18:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10933/HBASE-10933.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10933] hbck -fixHdfsOrphans is not working properly it throws null pointer exception</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10933</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;if we regioninfo file is not existing in hbase region then if we run hbck repair or hbck -fixHdfsOrphans&lt;br/&gt;
then it is not able to resolve this problem it throws null pointer exception&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-04-08 20:11:49,750 INFO  [main] util.HBaseFsck (HBaseFsck.java:adoptHdfsOrphans(470)) - Attempting to handle orphan hdfs dir: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//10.18.40.28:54310/hbase/TestHdfsOrphans1/5a3de9ca65e587cb05c9384a3981c950
&lt;/span&gt;java.lang.NullPointerException
	at org.apache.hadoop.hbase.util.HBaseFsck$TableInfo.access$000(HBaseFsck.java:1939)
	at org.apache.hadoop.hbase.util.HBaseFsck.adoptHdfsOrphan(HBaseFsck.java:497)
	at org.apache.hadoop.hbase.util.HBaseFsck.adoptHdfsOrphans(HBaseFsck.java:471)
	at org.apache.hadoop.hbase.util.HBaseFsck.restoreHdfsIntegrity(HBaseFsck.java:591)
	at org.apache.hadoop.hbase.util.HBaseFsck.offlineHdfsIntegrityRepair(HBaseFsck.java:369)
	at org.apache.hadoop.hbase.util.HBaseFsck.onlineHbck(HBaseFsck.java:447)
	at org.apache.hadoop.hbase.util.HBaseFsck.exec(HBaseFsck.java:3769)
	at org.apache.hadoop.hbase.util.HBaseFsck.run(HBaseFsck.java:3587)
	at com.huawei.isap.test.smartump.hadoop.hbase.HbaseHbckRepair.repairToFixHdfsOrphans(HbaseHbckRepair.java:244)
	at com.huawei.isap.test.smartump.hadoop.hbase.HbaseHbckRepair.setUp(HbaseHbckRepair.java:84)
	at junit.framework.TestCase.runBare(TestCase.java:132)
	at junit.framework.TestResult$1.protect(TestResult.java:110)
	at junit.framework.TestResult.runProtected(TestResult.java:128)
	at junit.framework.TestResult.run(TestResult.java:113)
	at junit.framework.TestCase.run(TestCase.java:124)
	at junit.framework.TestSuite.runTest(TestSuite.java:243)
	at junit.framework.TestSuite.run(TestSuite.java:238)
	at org.junit.internal.runners.JUnit38ClassRunner.run(JUnit38ClassRunner.java:83)
	at org.eclipse.jdt.internal.junit4.runner.JUnit4TestReference.run(JUnit4TestReference.java:50)
	at org.eclipse.jdt.internal.junit.runner.TestExecution.run(TestExecution.java:38)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:467)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.runTests(RemoteTestRunner.java:683)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.run(RemoteTestRunner.java:390)
	at org.eclipse.jdt.internal.junit.runner.RemoteTestRunner.main(RemoteTestRunner.java:197)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;problem i got it is because since in HbaseFsck class &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void adoptHdfsOrphan(HbckInfo hi)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;we are intializing tableinfo using SortedMap&amp;lt;String, TableInfo&amp;gt; tablesInfo object&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
TableInfo tableInfo = tablesInfo.get(tableName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;but  in private SortedMap&amp;lt;String, TableInfo&amp;gt; loadHdfsRegionInfos()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (HbckInfo hbi: hbckInfos) {

      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hbi.getHdfsHRI() == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-comment&quot;&gt;// was an orphan
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;we have check if a region is orphan then that table will can not be added in SortedMap&amp;lt;String, TableInfo&amp;gt; tablesInfo&lt;/p&gt;

&lt;p&gt;so later while using this we get null pointer exception&lt;/p&gt;</description>
                <environment></environment>
        <key id="12707190">HBASE-10933</key>
            <summary>hbck -fixHdfsOrphans is not working properly it throws null pointer exception</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="kashifjs@huawei.com">Kashif</assignee>
                                    <reporter username="deepakhuawei">Deepak Sharma</reporter>
                        <labels>
                    </labels>
                <created>Tue, 8 Apr 2014 14:49:07 +0000</created>
                <updated>Mon, 27 Jul 2015 11:29:20 +0000</updated>
                            <resolved>Mon, 27 Jul 2015 11:22:30 +0000</resolved>
                                    <version>0.94.16</version>
                    <version>0.98.2</version>
                                    <fixVersion>2.0.0</fixVersion>
                                    <component>hbck</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13964003" author="deepakhuawei" created="Wed, 9 Apr 2014 10:31:06 +0000"  >&lt;p&gt;this issue we face only when there is 1 region corresponding to the table &lt;/p&gt;

&lt;p&gt;since if more than 1 regions are there then as per following code tablesInfo sortedmap will have (tableName, modTInfo) for the table that has HdfsOrphan dir , since this for loop will iterate for other normal regions ,&lt;/p&gt;

&lt;p&gt;for (HbckInfo hbi: hbckInfos) {&lt;/p&gt;

&lt;p&gt;      if (hbi.getHdfsHRI() == null) &lt;/p&gt;
{
        // was an orphan
        continue;
      }


&lt;p&gt;      // get table name from hdfs, populate various HBaseFsck tables.&lt;br/&gt;
      String tableName = Bytes.toString(hbi.getTableName());&lt;br/&gt;
      if (tableName == null) &lt;/p&gt;
{
        // There was an entry in META not in the HDFS?
        LOG.warn(&quot;tableName was null for: &quot; + hbi);
        continue;
      }

&lt;p&gt;      TableInfo modTInfo = tablesInfo.get(tableName);&lt;br/&gt;
      if (modTInfo == null) {&lt;br/&gt;
        // only executed once per table.&lt;br/&gt;
        modTInfo = new TableInfo(tableName);&lt;br/&gt;
        Path hbaseRoot = FSUtils.getRootDir(getConf());&lt;br/&gt;
        tablesInfo.put(tableName, modTInfo);&lt;br/&gt;
        try &lt;/p&gt;
{
          HTableDescriptor htd =
              FSTableDescriptors.getTableDescriptor(hbaseRoot.getFileSystem(getConf()),
              hbaseRoot, tableName);
          modTInfo.htds.add(htd);
        }
&lt;p&gt; catch (IOException ioe) {&lt;br/&gt;
          if (!orphanTableDirs.containsKey(tableName)) &lt;/p&gt;
{
            LOG.warn(&quot;Unable to read .tableinfo from &quot; + hbaseRoot, ioe);
            //should only report once for each table
            errors.reportError(ERROR_CODE.NO_TABLEINFO_FILE,
                &quot;Unable to read .tableinfo from &quot; + hbaseRoot + &quot;/&quot; + tableName);
            Set&amp;lt;String&amp;gt; columns = new HashSet&amp;lt;String&amp;gt;();
            orphanTableDirs.put(tableName, getColumnFamilyList(columns, hbi));
          }
&lt;p&gt;        }&lt;br/&gt;
      }&lt;br/&gt;
      if (!hbi.isSkipChecks()) &lt;/p&gt;
{
        modTInfo.addRegionInfo(hbi);
      }
&lt;p&gt;    }&lt;/p&gt;</comment>
                            <comment id="13989272" author="kashifjs@huawei.com" created="Mon, 5 May 2014 04:25:43 +0000"  >&lt;p&gt;I have the patch ready for 0.94.19 version.  Probably this problem of NUll Pointer Exception does not exist for 0.98.* versions and the trunk. Deepak Sharma :  Can you please confirm for 0.98.2.&lt;br/&gt;
Also, there is a problem with HBaseFsck when Table containing regions do not have data Or Data is in Mem, then HBaseFsck will fail to resolve the INCONSISTENCY.  I am working on the fix for that. I will update the patch for review soon.  &lt;/p&gt;</comment>
                            <comment id="14003327" author="kashifjs@huawei.com" created="Tue, 20 May 2014 14:12:08 +0000"  >&lt;p&gt;Patch for 0.94.20 version.&lt;/p&gt;</comment>
                            <comment id="14003329" author="kashifjs@huawei.com" created="Tue, 20 May 2014 14:12:43 +0000"  >&lt;p&gt;Test result for 0.94 version&lt;/p&gt;</comment>
                            <comment id="14003339" author="kashifjs@huawei.com" created="Tue, 20 May 2014 14:13:59 +0000"  >&lt;p&gt;Patch also for trunk version to solve the issue of Single region with single KV generating wrong .regioninfo file with same start and end key.  Also added JUnit TCs for test&lt;/p&gt;</comment>
                            <comment id="14003352" author="kashifjs@huawei.com" created="Tue, 20 May 2014 14:18:39 +0000"  >&lt;p&gt;Server Test results for trunk version.&lt;/p&gt;</comment>
                            <comment id="14003359" author="kashifjs@huawei.com" created="Tue, 20 May 2014 14:23:51 +0000"  >&lt;p&gt;For 0.94.* version the patch fixes 3 issues&lt;br/&gt;
1&amp;gt; NullPointerException as reported above&lt;br/&gt;
2&amp;gt; When table has 1 region and zero KV, then if regioninfo is deleted, running hbck will corrupt the table and TableNotFoundException will be thrown for any subsequent operation on table&lt;br/&gt;
3&amp;gt; When a table contains 1 region, and only 1 KV, then if regioninfo is missing and hbck repair is run, this will create invalid regioninfo with same start and end key. &lt;br/&gt;
4&amp;gt; Table with multiple regions, all the regions dir missing (check testNoHdfsTable modification)&lt;/p&gt;</comment>
                            <comment id="14003362" author="kashifjs@huawei.com" created="Tue, 20 May 2014 14:25:12 +0000"  >&lt;p&gt;For the TRUNK version the patch fixes the issue of &lt;br/&gt;
1&amp;gt; When table has 1 region and zero KV, then if regioninfo is deleted, running hbck will corrupt the table and TableNotFoundException will be thrown for any subsequent operation on table&lt;br/&gt;
3&amp;gt; JUnit TCs have been added for various scenarios&lt;/p&gt;</comment>
                            <comment id="14003365" author="kashifjs@huawei.com" created="Tue, 20 May 2014 14:26:12 +0000"  >&lt;p&gt;For the TRUNK version the patch fixes the issue of &lt;br/&gt;
1&amp;gt; When a table contains 1 region, and only 1 KV, then if regioninfo is missing and hbck repair is run, this will create invalid regioninfo with same start and end key. &lt;br/&gt;
2&amp;gt; JUnit TCs have been added for various scenarios&lt;/p&gt;</comment>
                            <comment id="14003367" author="kashifjs@huawei.com" created="Tue, 20 May 2014 14:27:24 +0000"  >&lt;p&gt;Please review the patch. The trunk patch may also be applicable for 0.96 version IMHO&lt;/p&gt;</comment>
                            <comment id="14003846" author="hadoopqa" created="Tue, 20 May 2014 19:10:55 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12645802/TestResults-trunk.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12645802/TestResults-trunk.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12645802&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9554//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9554//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14004655" author="kashifjs@huawei.com" created="Wed, 21 May 2014 13:29:18 +0000"  >&lt;p&gt;Modified Junit TCs for 0.94 version for TestOfflineMetaRebuildHole &amp;amp; TestOfflineMetaRebuildOverlap.  Please review the v2 patch for 0.94. &lt;/p&gt;</comment>
                            <comment id="14018472" author="kashifjs@huawei.com" created="Thu, 5 Jun 2014 04:51:09 +0000"  >&lt;p&gt;Kindly review the patch&lt;/p&gt;</comment>
                            <comment id="14018475" author="hadoopqa" created="Thu, 5 Jun 2014 04:53:13 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12646009/HBASE-10933-0.94-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12646009/HBASE-10933-0.94-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12646009&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9697//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9697//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14030598" author="kashifjs@huawei.com" created="Fri, 13 Jun 2014 13:04:02 +0000"  >&lt;p&gt;Upload trunk patch with proper formatting&lt;/p&gt;</comment>
                            <comment id="14030685" author="hadoopqa" created="Fri, 13 Jun 2014 14:50:39 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12650294/HBASE-10933-trunk-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12650294/HBASE-10933-trunk-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12650294&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9767//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14031474" author="lhofhansl" created="Sat, 14 Jun 2014 05:31:17 +0000"  >&lt;p&gt;Looks good upon coarse inspection. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmhsieh&quot; class=&quot;user-hover&quot; rel=&quot;jmhsieh&quot;&gt;Jonathan Hsieh&lt;/a&gt;, mind having a look?&lt;/p&gt;</comment>
                            <comment id="14032661" author="jmhsieh" created="Mon, 16 Jun 2014 17:25:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=kashifjs%40huawei.com&quot; class=&quot;user-hover&quot; rel=&quot;kashifjs@huawei.com&quot;&gt;Kashif&lt;/a&gt;, Here&apos;s a quick review:  Nice tests.  I have a few style suggestions/fixes.&lt;/p&gt;

&lt;p&gt;This specific method isn&apos;t correct.  if we have a key &quot;abc&quot;, the next key is actually &quot;abc\x0&quot;, not &quot;abd&quot;.  Rename the method or fix the code.  Please add unit test to demonstrate expected behavior.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; nextKey(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] key, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; offset, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length) {
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (length == 0) {
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+    }
+    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = offset + length - 1;
+    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (key[i] == -1) {
+      key[i] = 0;
+      i--;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i &amp;lt; offset) {
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+      }
+    }
+    key[i] = (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;) (key[i] + 1);
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
+  }
+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is added and only used once in the code.  Why make all the generic code when you only need the more specific code?  Please remove.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  /**
+   * Increment the key to the next key
+   * @param key the key to increment
+   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; array with the next key or &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the key could not be incremented because
+   *         it&apos;s already at its max value.
+   */
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] nextKey(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] key) {
+    &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] nextStartRow = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[key.length];
+    &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.arraycopy(key, 0, nextStartRow, 0, key.length);
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!nextKey(nextStartRow, nextStartRow.length)) {
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+    }
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nextStartRow;
+  }
+
+  /**
+   * Increment the key in-place to the next key
+   * @param key the key to increment
+   * @param length the length of the key
+   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the key can be incremented and &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt; otherwise &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the key is at its max value.
+   */
+  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; nextKey(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] key, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; length) {
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; nextKey(key, 0, length);
+  }
+{
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Nice catch!&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
===================================================================
--- src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java	(revision 1596187)
+++ src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java	(working copy)
@@ -597,14 +597,14 @@
     FileSystem fs = p.getFileSystem(getConf());
     FileStatus[] dirs = fs.listStatus(p);
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (dirs == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
-      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempt to adopt ophan hdfs region skipped becuase no files present in &quot;&lt;/span&gt; +
+      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Attempt to adopt orphan hdfs region skipped because no files present in &quot;&lt;/span&gt; +
           p + &lt;span class=&quot;code-quote&quot;&gt;&quot;. This dir could probably be deleted.&quot;&lt;/span&gt;);
       &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; ;
     }
 
     &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tableName = Bytes.toString(hi.getTableName());
     TableInfo tableInfo = tablesInfo.get(tableName);
-    Preconditions.checkNotNull(&lt;span class=&quot;code-quote&quot;&gt;&quot;Table &quot;&lt;/span&gt; + tableName + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos; not present!&quot;&lt;/span&gt;, tableInfo);
+    Preconditions.checkNotNull(tableInfo, &lt;span class=&quot;code-quote&quot;&gt;&quot;Table &quot;&lt;/span&gt; + tableName + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos; not present!&quot;&lt;/span&gt;);
     HTableDescriptor template = tableInfo.getHTD();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Style issue. Just pass in the list of split keys instead of having the boolean withSplits arg?  Then if the splits are null or empty list it is the base case with one region/withSplits=false.  Remove boolean wlthSpilts and add rowkeys null/empty list check instead.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; InterruptedException
    * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; KeeperException
    */
-  HTable setupTable(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tablename) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
+  HTable setupTable(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tablename, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; withSplits, &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[][] rowkeys) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
     HTableDescriptor desc = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTableDescriptor(tablename);
     HColumnDescriptor hcd = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HColumnDescriptor(Bytes.toString(FAM));
     desc.addFamily(hcd); &lt;span class=&quot;code-comment&quot;&gt;// If a table has no CF&apos;s it doesn&apos;t get checked
&lt;/span&gt;-    TEST_UTIL.getHBaseAdmin().createTable(desc, SPLITS);
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (withSplits) {
+      TEST_UTIL.getHBaseAdmin().createTable(desc, SPLITS);
+    } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
+      TEST_UTIL.getHBaseAdmin().createTable(desc);
+    }
     tbl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTable(TEST_UTIL.getConfiguration(), tablename);
 
     List&amp;lt;Put&amp;gt; puts = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;Put&amp;gt;();
-    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] row : ROWKEYS) {
+    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] row : rowkeys) {
       Put p = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Put(row);
       p.add(FAM, Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;val&quot;&lt;/span&gt;), row);
       puts.add(p);
@@ -871,7 +882,7 @@
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; </comment>
                            <comment id="14035109" author="kashifjs@huawei.com" created="Wed, 18 Jun 2014 08:13:44 +0000"  >&lt;p&gt;Thanks for the review &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmhsieh&quot; class=&quot;user-hover&quot; rel=&quot;jmhsieh&quot;&gt;Jonathan Hsieh&lt;/a&gt; .&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;This specific method isn&apos;t correct. if we have a key &quot;abc&quot;, the next key is actually &quot;abc\x0&quot;, not &quot;abd&quot;. Rename the method or fix the code. Please add unit test to demonstrate expected behavior.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;// In HBase the end key is always exclusive, hence the next key returns the next exclusive key. If you suggest, maybe we can rename to nextExclusiveKey or nextEndKey.... nextKey apparently seemed fine to me. Let me know your call&lt;/p&gt;

&lt;p&gt;This is added and only used once in the code. Why make all the generic code when you only need the more specific code? Please remove.&lt;br/&gt;
// I just thought this can be a generic code. You never know it could be required later in the development. If still not required, I will remove it now ?&lt;/p&gt;</comment>
                            <comment id="14042283" author="jmhsieh" created="Tue, 24 Jun 2014 15:59:49 +0000"  >&lt;p&gt;What do you mean by exclusive? &amp;#8211; in the [a, b), [b, c) sense  where b is in the second but not the first?   If we did next we&apos;d still be able to sneak &apos;abc\x0&apos; betwen &apos;abc&apos; and &apos;abd&apos;&lt;/p&gt;

&lt;p&gt;Taking a step back, my main concern is that this nextKey is a public method in Bytes &amp;#8211; a common util class used internally and by users.  If a call lives there, the api and its semantics must be clear and correct in all cases.   &lt;/p&gt;

&lt;p&gt;If you made this a private method in HbaseFsck, (thus only scoped to that tool), I wouldn&apos;t be concerned.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;// I just thought this can be a generic code. You never know it could be required later in the development. If still not required, I will remove it now ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Please remove and just keep the specific version.  Though &quot;you never know&quot;, it tends to be &quot;you never need&quot; and makes the code harder to read (or requires the reader to read more code).  Because this is in the public api, I&apos;m more concerned.&lt;/p&gt;


</comment>
                            <comment id="14044401" author="kashifjs@huawei.com" created="Thu, 26 Jun 2014 07:01:21 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmhsieh&quot; class=&quot;user-hover&quot; rel=&quot;jmhsieh&quot;&gt;Jonathan Hsieh&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  Alright I will modify as per your comments/concerns.  Maybe I will rename the nextkey method  to something as &quot;nextByte&quot;. Maybe more meaningful for the value it returns. And other methods I will hide by making private. &lt;br/&gt;
//What do you mean by exclusive? &#8211; in the [a, b), [b, c) sense where b is in the second but not the first? If we did next we&apos;d still be able to sneak &apos;abc\x0&apos; betwen &apos;abc&apos; and &apos;abd&apos;&lt;/p&gt;

&lt;p&gt;Yes... if region startkey and endkey is &apos;abc&apos; and &apos;abd&apos;, If we did next we will be able to sneak &apos;abc\x0&apos;. So nextKey maybe a wrong method name. I will rename method to nextByte&lt;br/&gt;
Also I will add Unit test cases for the same.&lt;/p&gt;</comment>
                            <comment id="14050817" author="jmhsieh" created="Wed, 2 Jul 2014 22:37:45 +0000"  >&lt;p&gt;Move that method out Bytes and making it private is sufficient for me.&lt;/p&gt;

&lt;p&gt;Unit test would be great.  Thanks!&lt;/p&gt;</comment>
                            <comment id="14075682" author="lhofhansl" created="Sun, 27 Jul 2014 18:44:12 +0000"  >&lt;p&gt;Where are we with this? Moving out to 0.94.23 for now, we can always pull it back in.&lt;/p&gt;</comment>
                            <comment id="14107829" author="lhofhansl" created="Sat, 23 Aug 2014 03:19:02 +0000"  >&lt;p&gt;Removing from 0.94 for now.&lt;/p&gt;</comment>
                            <comment id="14324467" author="apurtell" created="Tue, 17 Feb 2015 17:04:01 +0000"  >&lt;p&gt;Why was this reopened &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=deepakhuawei&quot; class=&quot;user-hover&quot; rel=&quot;deepakhuawei&quot;&gt;Deepak Sharma&lt;/a&gt; ? &lt;/p&gt;</comment>
                            <comment id="14642585" author="deepakhuawei" created="Mon, 27 Jul 2015 11:22:30 +0000"  >&lt;p&gt;reopened by mistake&lt;/p&gt;</comment>
                            <comment id="14642593" author="ashish singhi" created="Mon, 27 Jul 2015 11:29:20 +0000"  >&lt;p&gt;Was this issue really fixed ? I do not see any code change for this committed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12645799" name="HBASE-10933-0.94-v1.patch" size="14089" author="kashifjs@huawei.com" created="Tue, 20 May 2014 14:12:08 +0000"/>
                            <attachment id="12646009" name="HBASE-10933-0.94-v2.patch" size="15527" author="kashifjs@huawei.com" created="Wed, 21 May 2014 13:29:18 +0000"/>
                            <attachment id="12645801" name="HBASE-10933-trunk-v1.patch" size="11095" author="kashifjs@huawei.com" created="Tue, 20 May 2014 14:13:59 +0000"/>
                            <attachment id="12650294" name="HBASE-10933-trunk-v2.patch" size="11269" author="kashifjs@huawei.com" created="Fri, 13 Jun 2014 13:04:01 +0000"/>
                            <attachment id="12645800" name="TestResults-0.94.txt" size="6961" author="kashifjs@huawei.com" created="Tue, 20 May 2014 14:12:43 +0000"/>
                            <attachment id="12645802" name="TestResults-trunk.txt" size="10445" author="kashifjs@huawei.com" created="Tue, 20 May 2014 14:18:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>6.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 5 May 2014 04:25:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385513</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 20 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1uewf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>385780</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>