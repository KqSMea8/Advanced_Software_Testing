<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:07:44 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3147/HBASE-3147.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3147] Regions stuck in transition after rolling restart, perpetual timeout handling but nothing happens</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3147</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The rolling restart script is great for bringing on the weird stuff.  On my little loaded cluster if I run it, it horks the cluster and it doesn&apos;t recover.  I notice two issues that need fixing:&lt;/p&gt;

&lt;p&gt;1. We&apos;ll miss noticing that a server was carrying .META. and it never gets assigned &amp;#8211; the shutdown handlers get stuck in perpetual wait on a .META. assign that will never happen.&lt;br/&gt;
2. Perpetual cycling of the this sequence per region not succesfully assigned:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 2010-10-23 21:37:57,404 INFO org.apache.hadoop.hbase.master.AssignmentManager: Regions in transition timed out:  usertable,user510588360,1287547556587.7f2d92497d2d03917afd574ea2aca55b. state=PENDING_OPEN,                       ts=1287869814294  45154 2010-10-23 21:37:57,404 INFO org.apache.hadoop.hbase.master.AssignmentManager: Region has been PENDING_OPEN or OPENING &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; too &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;, reassigning region=usertable,user510588360,1287547556587.                                     7f2d92497d2d03917afd574ea2aca55b.  45155 2010-10-23 21:37:57,404 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x2bd57d1475046a Attempting to transition node 7f2d92497d2d03917afd574ea2aca55b from RS_ZK_REGION_OPENING to M_ZK_REGION_OFFLINE  45156 2010-10-23 21:37:57,404 WARN org.apache.hadoop.hbase.zookeeper.ZKAssign: master:60000-0x2bd57d1475046a Attempt to transition the unassigned node &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 7f2d92497d2d03917afd574ea2aca55b from RS_ZK_REGION_OPENING to                 M_ZK_REGION_OFFLINE failed, the node existed but was in the state M_ZK_REGION_OFFLINE  45157 2010-10-23 21:37:57,404 INFO org.apache.hadoop.hbase.master.AssignmentManager: Region transitioned OPENING to OFFLINE so skipping timeout, region=usertable,user510588360,1287547556587.7f2d92497d2d03917afd574ea2aca55b.  
,,,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Timeout period again elapses an then same sequence.&lt;/p&gt;

&lt;p&gt;This is what I&apos;ve been working on.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12478198">HBASE-3147</key>
            <summary>Regions stuck in transition after rolling restart, perpetual timeout handling but nothing happens</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Sun, 24 Oct 2010 22:22:48 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:12 +0000</updated>
                            <resolved>Tue, 26 Oct 2010 16:53:42 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12924396" author="streamy" created="Sun, 24 Oct 2010 22:41:50 +0000"  >&lt;p&gt;Seems that our in-memory RIT state is PENDING_OPEN but it&apos;s in OFFLINE in ZK.  Seems like a potentially common case.  Server being assigned to was just not there, never began opening it.&lt;/p&gt;

&lt;p&gt;We should probably differentiate between PENDING_OPEN timeout and OPENING timeout.  Let me see what I find in the code.&lt;/p&gt;

&lt;p&gt;(Your paste seems to lack line breaks so this jira is a mile wide)&lt;/p&gt;</comment>
                            <comment id="12924411" author="hbasereviewboard" created="Mon, 25 Oct 2010 01:14:09 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/1087/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1087/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase and stack.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Adds new handling of the timeouts for PENDING_OPEN and PENDING_CLOSE in-memory master RIT states.&lt;/p&gt;

&lt;p&gt;Adds some new broken RIT states into TestMasterFailover.&lt;/p&gt;

&lt;p&gt;Some of these broken states don&apos;t seem possible to me but as long as we aren&apos;t breaking the existing behaviors and tests I think it&apos;s okay if we handle odd cases that can be mocked.  Who knows what will happen in the real world.&lt;/p&gt;

&lt;p&gt;The reason TestMasterFailover didn&apos;t/doesn&apos;t really test for the issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3147&quot; title=&quot;Regions stuck in transition after rolling restart, perpetual timeout handling but nothing happens&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3147&quot;&gt;&lt;del&gt;HBASE-3147&lt;/del&gt;&lt;/a&gt; is this new broken condition happens when an RS dies / goes offline rather than a master failover concurrent w/ RS failure.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3147&quot; title=&quot;Regions stuck in transition after rolling restart, perpetual timeout handling but nothing happens&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3147&quot;&gt;&lt;del&gt;HBASE-3147&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-3147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-3147&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1026911 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1026911 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java 1026911 &lt;br/&gt;
  trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java 1026911 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/1087/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1087/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;TestMasterFailover passes.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12924602" author="stack" created="Mon, 25 Oct 2010 16:10:06 +0000"  >&lt;p&gt;I got this when I tried running patch....&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.IllegalAccessError: tried to access method org.apache.hadoop.hbase.zookeeper.ZKAssign.getNodeName(Lorg/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher;Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;;)Ljava/lang/&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;; from class org.apache.hadoop.hbase.master.AssignmentManager$TimeoutMonitor
    at org.apache.hadoop.hbase.master.AssignmentManager$TimeoutMonitor.chore(AssignmentManager.java:1457)
    at org.apache.hadoop.hbase.Chore.run(Chore.java:66)
2010-10-25 16:07:44,354 INFO org.apache.hadoop.hbase.master.AssignmentManager$TimeoutMonitor: sv2borg180:60000.timeoutMonitor exiting
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let me try fix.&lt;/p&gt;</comment>
                            <comment id="12924614" author="streamy" created="Mon, 25 Oct 2010 16:27:19 +0000"  >&lt;p&gt;Hmm... you should have:&lt;/p&gt;

&lt;p&gt;  public static String getNodeName(ZooKeeperWatcher zkw, String regionName) {&lt;/p&gt;

&lt;p&gt;as part of the diff up on RB&lt;/p&gt;</comment>
                            <comment id="12924782" author="hbasereviewboard" created="Mon, 25 Oct 2010 23:32:05 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/1087/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1087/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-10-25 16:29:36.379908)&lt;/p&gt;


&lt;p&gt;Review request for hbase and stack.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Added metaservershutdownhandler and rootservershutdownhandler&lt;/p&gt;


&lt;p&gt;Summary (updated)&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Adds new handling of the timeouts for PENDING_OPEN and PENDING_CLOSE in-memory master RIT states.&lt;/p&gt;

&lt;p&gt;Adds some new broken RIT states into TestMasterFailover.&lt;/p&gt;

&lt;p&gt;Some of these broken states don&apos;t seem possible to me but as long as we aren&apos;t breaking the existing behaviors and tests I think it&apos;s okay if we handle odd cases that can be mocked.  Who knows what will happen in the real world.&lt;/p&gt;

&lt;p&gt;The reason TestMasterFailover didn&apos;t/doesn&apos;t really test for the issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3147&quot; title=&quot;Regions stuck in transition after rolling restart, perpetual timeout handling but nothing happens&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3147&quot;&gt;&lt;del&gt;HBASE-3147&lt;/del&gt;&lt;/a&gt; is this new broken condition happens when an RS dies / goes offline rather than a master failover concurrent w/ RS failure.&lt;/p&gt;


&lt;p&gt;v4 of the patch adds to Jons&apos; fixes.  It adds a shutdown server handler for root and another for meta so the processing of servers hosting meta/root do not get frozen out.  I&apos;ve seen this in my testing.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3147&quot; title=&quot;Regions stuck in transition after rolling restart, perpetual timeout handling but nothing happens&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3147&quot;&gt;&lt;del&gt;HBASE-3147&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-3147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-3147&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java 1027291 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java 1027291 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1027291 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/executor/ExecutorService.java 1027291 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1027291 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1027291 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1027291 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/handler/MetaServerShutdownHandler.java PRE-CREATION &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/handler/RootServerShutdownHandler.java PRE-CREATION &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java 1027292 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java 1027291 &lt;br/&gt;
  trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java 1027291 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/1087/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1087/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;TestMasterFailover passes.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12924784" author="hbasereviewboard" created="Mon, 25 Oct 2010 23:40:10 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/1087/#review1662&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1087/#review1662&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;Looks good.  Not sure if I can +1 my patch but I think we should commit &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;


&lt;p&gt;trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/1087/#comment5542&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1087/#comment5542&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Should we remove this code from inside of ServerShutdownHandler now?  Not a big deal but being done twice.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jonathan&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12924786" author="stack" created="Mon, 25 Oct 2010 23:58:13 +0000"  >&lt;p&gt;Here is what I&apos;ll commit.  It does as Jon suggests removing check of root or  meta carrying inside in shutdown handler since we&apos;re doing the check on the outside now.  This patch also includes missing hookup that testing found.&lt;/p&gt;

&lt;p&gt;There is still work to do on this issue.  What seems to be happening is that a watcher is not being triggered.  Need to figure how that is happening.  I&apos;ll see a regionserver with all of its opener handlers stuck waiting on notification that meta  has been deployed.... Other servers will have gotten their watcher triggered but not one or two in the cluster....   Master is then stuck timing out this regionservers allocations and then reassigning... calling open on the rpc which adds region to queue but since all openers are stuck waiting on meta, the queues don&apos;t get processed.&lt;/p&gt;</comment>
                            <comment id="12924856" author="hbasereviewboard" created="Tue, 26 Oct 2010 06:27:05 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/1087/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1087/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-10-25 23:25:36.390570)&lt;/p&gt;


&lt;p&gt;Review request for hbase and stack.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;So, a few things extra after digging in w/ Jon.&lt;/p&gt;

&lt;p&gt;1. A watch was not being called on .META. move because it was not being set; in MetaNodeTracker we were not calling the super inside in nodeDeleted to reset the watch (in rolling restart, only a few servers would actually experience a moved .META. sensation and it was these that were hanging up..  Others when they came up would see .META. in its new location)&lt;br/&gt;
2. We were not assigning out .META. if master had trouble reaching meta before it saw server expired.  In the case where we&apos;d trouble contacting meta before we saw its server expire, we&apos;d reset in the catalog tracker its location.  We were using catalog tracker to determine which server was hosting meta.  We use a different technique now.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Adds new handling of the timeouts for PENDING_OPEN and PENDING_CLOSE in-memory master RIT states.&lt;/p&gt;

&lt;p&gt;Adds some new broken RIT states into TestMasterFailover.&lt;/p&gt;

&lt;p&gt;Some of these broken states don&apos;t seem possible to me but as long as we aren&apos;t breaking the existing behaviors and tests I think it&apos;s okay if we handle odd cases that can be mocked.  Who knows what will happen in the real world.&lt;/p&gt;

&lt;p&gt;The reason TestMasterFailover didn&apos;t/doesn&apos;t really test for the issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3147&quot; title=&quot;Regions stuck in transition after rolling restart, perpetual timeout handling but nothing happens&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3147&quot;&gt;&lt;del&gt;HBASE-3147&lt;/del&gt;&lt;/a&gt; is this new broken condition happens when an RS dies / goes offline rather than a master failover concurrent w/ RS failure.&lt;/p&gt;


&lt;p&gt;v4 of the patch adds to Jons&apos; fixes.  It adds a shutdown server handler for root and another for meta so the processing of servers hosting meta/root do not get frozen out.  I&apos;ve seen this in my testing.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3147&quot; title=&quot;Regions stuck in transition after rolling restart, perpetual timeout handling but nothing happens&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3147&quot;&gt;&lt;del&gt;HBASE-3147&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-3147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-3147&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/executor/ExecutorService.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/handler/MetaServerShutdownHandler.java PRE-CREATION &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MetaNodeTracker.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java 1027351 &lt;br/&gt;
  trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java 1027351 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/1087/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1087/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;TestMasterFailover passes.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12924859" author="hbasereviewboard" created="Tue, 26 Oct 2010 06:41:05 +0000"  >&lt;p&gt;Message from: &quot;Jonathan Gray&quot; &amp;lt;jgray@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/1087/#review1668&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1087/#review1668&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;There was a little whitespace but I am +1 to commit this.  I still have some weird failures on TestRollingRestart, need to test w/ this.&lt;/p&gt;


&lt;p&gt;trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MetaNodeTracker.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/1087/#comment5544&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1087/#comment5544&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    should be after the path check but just an efficiency thing&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jonathan&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12924883" author="hbasereviewboard" created="Tue, 26 Oct 2010 07:57:11 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/1087/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1087/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-10-26 00:55:02.299835)&lt;/p&gt;


&lt;p&gt;Review request for hbase and stack.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch is almost there.  Its much better.  Fixed testing for .META. server by looking in map of servers to regions; that won&apos;t work since its a map of user regions only.  Instead get from catalogtracker.&lt;/p&gt;

&lt;p&gt;Locally TestRegionRebalancing failed.  I need to look at that.&lt;/p&gt;

&lt;p&gt;On cluster, we turned up an unexpected state as server was opening a region it was also going down. Need to dig in on that too.&lt;/p&gt;

&lt;p&gt;Want to also add tests at least for moved .meta.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Adds new handling of the timeouts for PENDING_OPEN and PENDING_CLOSE in-memory master RIT states.&lt;/p&gt;

&lt;p&gt;Adds some new broken RIT states into TestMasterFailover.&lt;/p&gt;

&lt;p&gt;Some of these broken states don&apos;t seem possible to me but as long as we aren&apos;t breaking the existing behaviors and tests I think it&apos;s okay if we handle odd cases that can be mocked.  Who knows what will happen in the real world.&lt;/p&gt;

&lt;p&gt;The reason TestMasterFailover didn&apos;t/doesn&apos;t really test for the issue in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3147&quot; title=&quot;Regions stuck in transition after rolling restart, perpetual timeout handling but nothing happens&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3147&quot;&gt;&lt;del&gt;HBASE-3147&lt;/del&gt;&lt;/a&gt; is this new broken condition happens when an RS dies / goes offline rather than a master failover concurrent w/ RS failure.&lt;/p&gt;


&lt;p&gt;v4 of the patch adds to Jons&apos; fixes.  It adds a shutdown server handler for root and another for meta so the processing of servers hosting meta/root do not get frozen out.  I&apos;ve seen this in my testing.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3147&quot; title=&quot;Regions stuck in transition after rolling restart, perpetual timeout handling but nothing happens&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3147&quot;&gt;&lt;del&gt;HBASE-3147&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-3147&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-3147&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/executor/ExecutorService.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/handler/MetaServerShutdownHandler.java PRE-CREATION &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ServerShutdownHandler.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/MetaNodeTracker.java 1027351 &lt;br/&gt;
  trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java 1027351 &lt;br/&gt;
  trunk/src/test/java/org/apache/hadoop/hbase/catalog/TestCatalogTracker.java 1027351 &lt;br/&gt;
  trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java 1027351 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/1087/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1087/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;TestMasterFailover passes.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jonathan&lt;/p&gt;

</comment>
                            <comment id="12925031" author="stack" created="Tue, 26 Oct 2010 16:49:47 +0000"  >&lt;p&gt;This is the patch I&apos;m applying.  It fixes the two items raised at the top of this issue but now I&apos;m seeing other, lesser issues for which I&apos;ll open new JIRAs.&lt;/p&gt;</comment>
                            <comment id="12925033" author="stack" created="Tue, 26 Oct 2010 16:53:41 +0000"  >&lt;p&gt;Committed.  Thanks for writing half of the patch and for reviews Jon.&lt;/p&gt;</comment>
                            <comment id="15017460" author="lars_francke" created="Fri, 20 Nov 2015 12:43:12 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12458083" name="HBASE-3147-v11.patch" size="31151" author="stack" created="Tue, 26 Oct 2010 16:49:47 +0000"/>
                            <attachment id="12458024" name="HBASE-3147-v6.patch" size="27040" author="stack" created="Mon, 25 Oct 2010 23:58:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 24 Oct 2010 22:41:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26675</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hkxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100652</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>