<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:10:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10087/HBASE-10087.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10087] Store should be locked during a memstore snapshot</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10087</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;regression from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9963&quot; title=&quot;Remove the ReentrantReadWriteLock in the MemStore&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9963&quot;&gt;&lt;del&gt;HBASE-9963&lt;/del&gt;&lt;/a&gt;, found while looking at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10079&quot; title=&quot;Race in TableName cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10079&quot;&gt;&lt;del&gt;HBASE-10079&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12682866">HBASE-10087</key>
            <summary>Store should be locked during a memstore snapshot</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkeywal">Nicolas Liochon</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 Dec 2013 09:46:45 +0000</created>
                <updated>Sat, 21 Feb 2015 23:30:35 +0000</updated>
                            <resolved>Tue, 21 Jan 2014 14:11:14 +0000</resolved>
                                    <version>0.98.0</version>
                    <version>0.96.1</version>
                    <version>0.94.14</version>
                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.99.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>11</watches>
                                                                <comments>
                            <comment id="13840026" author="hadoopqa" created="Thu, 5 Dec 2013 11:19:59 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12617139/10079.v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12617139/10079.v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 2 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestLogRolling&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8062//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13840048" author="stack" created="Thu, 5 Dec 2013 12:28:34 +0000"  >&lt;p&gt;+1 as long as the test fail is not related.&lt;/p&gt;</comment>
                            <comment id="13840378" author="lhofhansl" created="Thu, 5 Dec 2013 18:31:20 +0000"  >&lt;p&gt;lgtm&lt;/p&gt;

&lt;p&gt;Are we sure we won&apos;t ever call this with the readlock held, would lead to an instance deadlock (rw lock does not support upgrading the lock).&lt;br/&gt;
Asking because I see a lot of tests in that run that either did not run or did not finish.&lt;/p&gt;</comment>
                            <comment id="13840379" author="lhofhansl" created="Thu, 5 Dec 2013 18:31:47 +0000"  >&lt;p&gt;Maybe in 0.94 it&apos;s best to restore the old behavior...?&lt;/p&gt;</comment>
                            <comment id="13840389" author="nkeywal" created="Thu, 5 Dec 2013 18:38:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;Are we sure we won&apos;t ever call this with the readlock held, would lead to an instance deadlock (rw lock does not support upgrading the lock).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Asking because I see a lot of tests in that run that either did not run or did not finish.&lt;br/&gt;
I will have a look. The tests ran ok in the &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10079&quot; title=&quot;Race in TableName cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10079&quot;&gt;&lt;del&gt;HBASE-10079&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Maybe in 0.94 it&apos;s best to restore the old behavior...?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think it&apos;s safer to have the same code on the two branches: the tests on one version benefit to the other...&lt;/p&gt;</comment>
                            <comment id="13840445" author="lhofhansl" created="Thu, 5 Dec 2013 19:20:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10079&quot; title=&quot;Race in TableName cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10079&quot;&gt;&lt;del&gt;HBASE-10079&lt;/del&gt;&lt;/a&gt; now looks like a race in the tablename caching. Not related to the locking here.&lt;/p&gt;</comment>
                            <comment id="13840455" author="nkeywal" created="Thu, 5 Dec 2013 19:27:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10079&quot; title=&quot;Race in TableName cache&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10079&quot;&gt;&lt;del&gt;HBASE-10079&lt;/del&gt;&lt;/a&gt; now looks like a race in the tablename caching. Not related to the locking here.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, but the patch here was first ran there &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="13840463" author="lhofhansl" created="Thu, 5 Dec 2013 19:34:12 +0000"  >&lt;p&gt;I meant: Can we close this? It does not appear to be an issue. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13840535" author="nkeywal" created="Thu, 5 Dec 2013 20:28:02 +0000"  >&lt;p&gt;We were locking before, so we&apos;re just adding back the lock. But I agree, we should be able to prove that we need this lock with a test... I will try.&lt;/p&gt;</comment>
                            <comment id="13847952" author="lhofhansl" created="Fri, 13 Dec 2013 21:58:53 +0000"  >&lt;p&gt;Any progress, by any chance? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Want to cut 0.94.15RC0 soon&apos;ish.&lt;/p&gt;

&lt;p&gt;We did lock before but on a different lock. So the only risk adding this here is a potential deadlock if we call this with the resp. readlock held.&lt;/p&gt;</comment>
                            <comment id="13849215" author="nkeywal" created="Mon, 16 Dec 2013 14:58:50 +0000"  >&lt;p&gt;Sorry for the delay.&lt;/p&gt;

&lt;p&gt;Theoretically, we have an issue:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void prepare() {
      memstore.snapshot();
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.snapshot = memstore.getSnapshot();
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.snapshotTimeRangeTracker = memstore.getSnapshotTimeRangeTracker(); 
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;w/o a lock, we could have an inconsistency between the snapshot and the snapshotTimeRangeTracker.&lt;br/&gt;
As well, we could have an inconsistency in memstore.snapshot();&lt;/p&gt;

&lt;p&gt;But it seems it cannot happen, because: &lt;br/&gt;
Store#snaphot is called only in the tests.&lt;br/&gt;
Store#prepare is called with the write lock on the HRegion.&lt;br/&gt;
The functions that will modify the store also have the read lock on HRegion, so we can&apos;t be inconsistent in practice.&lt;/p&gt;

&lt;p&gt;This said, adding the lock in prepare() would be more consistent imho. I would propose to add it on trunk.&lt;/p&gt;

</comment>
                            <comment id="13850145" author="lhofhansl" created="Tue, 17 Dec 2013 06:01:29 +0000"  >&lt;p&gt;Looking at the code, I agree, the only non-test code calling already holds the write-lock. Removing the 0.94 tag.&lt;/p&gt;</comment>
                            <comment id="13850286" author="nkeywal" created="Tue, 17 Dec 2013 09:31:27 +0000"  >&lt;p&gt;Thanks for the confirmation. Any opinion on adding the lock for consistency on trunk, or shall we close this jira? &lt;/p&gt;</comment>
                            <comment id="13852691" author="anoop.hbase" created="Thu, 19 Dec 2013 07:13:59 +0000"  >&lt;p&gt;We can close this issue just adding a code level comment saying we already have the lock and so not going for that. It will help others later.. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13853044" author="nkeywal" created="Thu, 19 Dec 2013 17:24:35 +0000"  >&lt;p&gt;Ok, I will do that &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13856482" author="apurtell" created="Tue, 24 Dec 2013 23:09:24 +0000"  >&lt;p&gt;Moving out of 0.98.0. Put back if ready before RC.&lt;/p&gt;</comment>
                            <comment id="13876559" author="stack" created="Mon, 20 Jan 2014 16:32:56 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13876621" author="hadoopqa" created="Mon, 20 Jan 2014 17:48:03 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12623961/10087.v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12623961/10087.v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12623961&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.1&lt;/font&gt;.  The patch compiles against the hadoop 1.1 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.util.TestHBaseFsck&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/8474//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13876631" author="nkeywal" created="Mon, 20 Jan 2014 17:57:34 +0000"  >&lt;p&gt;It&apos;s just a comment change, TestHBaseFsck is likely flakky...&lt;/p&gt;</comment>
                            <comment id="13876822" author="apurtell" created="Mon, 20 Jan 2014 20:15:33 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13877494" author="nkeywal" created="Tue, 21 Jan 2014 14:18:37 +0000"  >&lt;p&gt;Committed to trunk &amp;amp; 0.98, thanks for the review and the feedback, all.&lt;/p&gt;</comment>
                            <comment id="13877596" author="hudson" created="Tue, 21 Jan 2014 16:34:15 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #92 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/92/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/92/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10087&quot; title=&quot;Store should be locked during a memstore snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10087&quot;&gt;&lt;del&gt;HBASE-10087&lt;/del&gt;&lt;/a&gt; Store should be locked during a memstore snapshot (nkeywal: rev 1560028)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13877625" author="hudson" created="Tue, 21 Jan 2014 17:19:09 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #4843 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4843/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4843/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10087&quot; title=&quot;Store should be locked during a memstore snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10087&quot;&gt;&lt;del&gt;HBASE-10087&lt;/del&gt;&lt;/a&gt; Store should be locked during a memstore snapshot (nkeywal: rev 1560018)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13878098" author="hudson" created="Wed, 22 Jan 2014 01:03:06 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98 #100 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/100/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/100/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10087&quot; title=&quot;Store should be locked during a memstore snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10087&quot;&gt;&lt;del&gt;HBASE-10087&lt;/del&gt;&lt;/a&gt; Store should be locked during a memstore snapshot (nkeywal: rev 1560028)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13878127" author="hudson" created="Wed, 22 Jan 2014 01:32:20 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK-on-Hadoop-1.1 #61 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-1.1/61/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-1.1/61/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10087&quot; title=&quot;Store should be locked during a memstore snapshot&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10087&quot;&gt;&lt;del&gt;HBASE-10087&lt;/del&gt;&lt;/a&gt; Store should be locked during a memstore snapshot (nkeywal: rev 1560018)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14163290" author="apache9" created="Wed, 8 Oct 2014 10:10:22 +0000"  >&lt;p&gt;I think the lock here is not used to prevent concurrent snapshot of memstore, but to prevent create MemStoreScanner(holding the read lock) and snapshot running concurrently.&lt;/p&gt;

&lt;p&gt;If we do not hold write lock here, we can get an inconsistent view of kvsetAtCreation, snapshotAtCreation, allocator and snapshotAllocator when creating MemStoreScanner(kvsetAtCreation and snapshotAtCreation could be a same instance, snapshotAllocator is not the actual allocator of snapshotAtCreation and so on). This is OK for now because our implementation(very very tricky), but I do not think it is a good idea to leave a data racing bomb here...&lt;/p&gt;</comment>
                            <comment id="14167068" author="stack" created="Fri, 10 Oct 2014 16:25:41 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkeywal&quot; class=&quot;user-hover&quot; rel=&quot;nkeywal&quot;&gt;Nicolas Liochon&lt;/a&gt; See comment above&lt;/p&gt;</comment>
                            <comment id="14330710" author="enis" created="Sat, 21 Feb 2015 23:30:35 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12617139" name="10079.v1.patch" size="761" author="nkeywal" created="Thu, 5 Dec 2013 09:47:23 +0000"/>
                            <attachment id="12623961" name="10087.v2.patch" size="737" author="nkeywal" created="Mon, 20 Jan 2014 16:18:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 5 Dec 2013 11:19:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362123</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1qf6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>362418</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>