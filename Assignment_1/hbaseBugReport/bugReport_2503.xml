<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:02:27 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2503/HBASE-2503.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2503] PriorityQueue isn&apos;t thread safe, KeyValueHeap uses it that way</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2503</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In the same spirit as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2077&quot; title=&quot;NullPointerException with an open scanner that expired causing an immediate region server shutdown&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2077&quot;&gt;&lt;del&gt;HBASE-2077&lt;/del&gt;&lt;/a&gt;, but a bit different (at least to me). Dave Latham had the following NPE killing a RS:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Exception in thread &lt;span class=&quot;code-quote&quot;&gt;&quot;regionserver/192.168.41.2:60020.leaseChecker&quot;&lt;/span&gt; java.lang.NullPointerException
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap$KVScannerComparator.compare(KeyValueHeap.java:127)
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap$KVScannerComparator.compare(KeyValueHeap.java:117)
        at java.util.PriorityQueue.siftDownUsingComparator(PriorityQueue.java:644)
        at java.util.PriorityQueue.siftDown(PriorityQueue.java:612)
        at java.util.PriorityQueue.poll(PriorityQueue.java:523)
        at org.apache.hadoop.hbase.regionserver.KeyValueHeap.close(KeyValueHeap.java:151)
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScanner.close(HRegion.java:1862)
        at org.apache.hadoop.hbase.regionserver.HRegionServer$ScannerListener.leaseExpired(HRegionServer.java:1959)
        at org.apache.hadoop.hbase.Leases.run(Leases.java:98)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;He also has the same stack traces from 2077. The PQ javadoc says this class is not thread safe, but it is used by the leaseChecker thread and the client threads. We need to use something like the BlockingPriorityQueue instead.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12463371">HBASE-2503</key>
            <summary>PriorityQueue isn&apos;t thread safe, KeyValueHeap uses it that way</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Apr 2010 20:52:48 +0000</created>
                <updated>Fri, 12 Oct 2012 06:15:38 +0000</updated>
                            <resolved>Fri, 7 May 2010 20:59:39 +0000</resolved>
                                    <version>0.20.3</version>
                                    <fixVersion>0.20.5</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12862406" author="ryanobjc" created="Thu, 29 Apr 2010 21:02:52 +0000"  >&lt;p&gt;i think it makes sense to put the sync block at the HRegion.RegionScanner level - that is all public methods should have &apos;synchronized&apos; on them.&lt;/p&gt;</comment>
                            <comment id="12862419" author="jdcryans" created="Thu, 29 Apr 2010 21:20:55 +0000"  >&lt;p&gt;Yeah might as well... And it relates even more to 2077 than I thought. So here if a next is waiting on a close... the result is a bit unclear to me. The user would see this as the end of a scan as a null would be returned by this.storeHeap.peek()? So adding to the sync&apos;ed methods, I think we need a &quot;closed&apos; marker on RegionScanner that we would need to verify in next() and set in close().&lt;/p&gt;</comment>
                            <comment id="12864605" author="jdcryans" created="Thu, 6 May 2010 00:44:36 +0000"  >&lt;p&gt;This patch synchronizes RegionScanner&apos;s public methods, removes a close() that wasn&apos;t used, adds a new attribute to check it the scanner was closed and adds a new test to see if we get the exception. I cannot find an elegant way to test the NPE directly, so I cannot guarantee that the original issue is fixed but now only 1 thread can access RegionScanner.&lt;/p&gt;</comment>
                            <comment id="12865012" author="tlipcon" created="Fri, 7 May 2010 03:42:41 +0000"  >&lt;p&gt;Looks good to me.&lt;/p&gt;</comment>
                            <comment id="12865306" author="jdcryans" created="Fri, 7 May 2010 20:59:39 +0000"  >&lt;p&gt;Thanks for the reviewed Todd.&lt;/p&gt;

&lt;p&gt;It passes the test, committed to branch and trunk.&lt;/p&gt;</comment>
                            <comment id="12866905" author="stack" created="Wed, 12 May 2010 23:53:56 +0000"  >&lt;p&gt;Marking these as fixed against 0.21.0 rather than against 0.20.5.&lt;/p&gt;</comment>
                            <comment id="12866919" author="jdcryans" created="Wed, 12 May 2010 23:55:58 +0000"  >&lt;p&gt;Patch against 0.20.4 for those who get those NPEs. No commit needed.&lt;/p&gt;</comment>
                            <comment id="12867645" author="stack" created="Fri, 14 May 2010 19:35:22 +0000"  >&lt;p&gt;Applied to branch for 0.20.5 release.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12444359">HBASE-2077</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12443800" name="HBASE-2503.patch" size="4514" author="jdcryans" created="Thu, 6 May 2010 00:44:36 +0000"/>
                            <attachment id="12444363" name="HBASE-2503_0.20.4.patch" size="4447" author="jdcryans" created="Wed, 12 May 2010 23:55:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 29 Apr 2010 21:02:52 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26337</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 31 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08sdz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49199</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>