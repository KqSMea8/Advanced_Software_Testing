<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:08:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-15902/HBASE-15902.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-15902] Scan Object</title>
                <link>https://issues.apache.org/jira/browse/HBASE-15902</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Patch for creating Scan objects. Scan objects thus created can be used by Table implementation to fetch results for a given row.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12973407">HBASE-15902</key>
            <summary>Scan Object</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12914633">HBASE-14850</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="sudeeps">Sudeep Sunthankar</assignee>
                                    <reporter username="sudeeps">Sudeep Sunthankar</reporter>
                        <labels>
                    </labels>
                <created>Fri, 27 May 2016 12:44:35 +0000</created>
                <updated>Wed, 7 Dec 2016 22:52:57 +0000</updated>
                            <resolved>Wed, 7 Dec 2016 22:52:56 +0000</resolved>
                                                    <fixVersion>HBASE-14850</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="15690994" author="sudeeps" created="Wed, 23 Nov 2016 18:39:54 +0000"  >&lt;p&gt;Patch for Scan API&lt;/p&gt;</comment>
                            <comment id="15691972" author="enis" created="Thu, 24 Nov 2016 02:26:40 +0000"  >&lt;p&gt;Thanks Sudeep for the patch. This is a good start. &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The patch file seems it is only for the second part of two commits:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Subject: [PATCH 2/2] Adding sources &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; Scan object
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Did you mean to attach the first part as well. I don&apos;t see changes to BUCK files, so maybe they are there? &lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;This should be private:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  bool IsStartRowAndEqualsStopRow() &lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Seems that we did not do the Query interface in the get patch. In the Java-land that is how we do carry the filter, as well as some extra methods. I would suggest that we should leave those out for now, and do another issue for the Query interface + the Filter methods. Query has bunch of other methods that we do not need, so we can discuss what to include there.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We are trying to simplify the Scan API elsewhere in the java client. Some of these will be deprecated and removed in java as well. There are a few methods that are in the Scan API to deal with how to do paging for large rows containing thousands / millions of cells. In our first cut, we would not deal with the complexity of passing partial results within rows at all. Once the client / scanner is in better shape, we can add that as a feature with better APIs (hopefully by that time Scan&apos;s API in Java will also be simplified). See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15484?focusedCommentId=15325647&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15325647&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-15484?focusedCommentId=15325647&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-15325647&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;For now, let&apos;s remove these methods, and keep the API simple (again we can revisit in a later issue). &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+Scan&amp;amp; Scan::SetRowOffsetPerColumnFamily(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; store_offset) {
+&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; Scan::RowOffsetPerColumnFamily() &lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt; {
+  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; MaxResultsPerColumnFamily() &lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt;;
+  Scan &amp;amp;SetBatch(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; batch);
+  &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; Batch() &lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So basically, we should remove everything related to rowOffsetPerColumnFamily, MaxResultsPerColumnFamily,and Batch. We can keep AllowPartialResults for now since that is unlikely to change. The first implementation probably will not deal with partial results though. Sorry that we should have talked about this before. &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;We can remove this method as well, since it is relevant only on the server side (gets are internally processed as a Scan with start row = stop row, that is why there this method is used in some server side code paths).
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  bool IsGetScan() &lt;span class=&quot;code-keyword&quot;&gt;const&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In this patch, we are allocating TimeRange objects in heap via a pointer, versus in the Get object, we are embedding those objects:
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+Scan &amp;amp;Scan::SetTimeRange(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; min_stamp, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; max_stamp) {
+  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (nullptr != tr_) {
+    delete tr_;
+    tr_ = nullptr;
+  }
+  tr_ = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; TimeRange(min_stamp, max_stamp);
+  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; *&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;;
+}
Get&amp;amp; Get::SetTimeRange(&lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; min_timestamp, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; max_timestamp) {
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;-&amp;gt;tr_ = TimeRange(min_timestamp, max_timestamp);
  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; *&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;;
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We should stick with a single approach. Is the Get::SetTimeRange() ends up pointing to stack-allocated object (sorry my C++ memory model is rusty)? We should fix it if so.  &lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15696348" author="sudeeps" created="Fri, 25 Nov 2016 17:22:53 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;. Please find my responses below&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;The patch file seems it is only for the second part of two commits&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I had created this patch on top of Configuration and created both the patches together, which is why it shows part 2/2. &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;I don&apos;t see changes to BUCK files, so maybe they are there? &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I was getting some errors in patching BUCK with the patch created in the manner above, so I kept BUCK out of the patch and planned on creating a separate patch to hook up the tests. &lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;In this patch, we are allocating TimeRange objects in heap via a pointer, versus in the Get object, we are embedding those objects: &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The way it is done in Get creates temporary objects, which is not required. I should have allocated TimeRange objects in Get on heap as well. I will upload a patch for it as well.&lt;/p&gt;

&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="15710514" author="sudeeps" created="Thu, 1 Dec 2016 01:42:40 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
This patch consists of the foll:-&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Sources for Scan API.&lt;/li&gt;
	&lt;li&gt;Changing  raw pointers to smart pointers in Get API.&lt;/li&gt;
	&lt;li&gt;Removal of advanced API features from Get and Scan API&apos;s in the first cut.&lt;/li&gt;
&lt;/ol&gt;
</comment>
                            <comment id="15710534" author="sudeeps" created="Thu, 1 Dec 2016 01:53:08 +0000"  >&lt;p&gt;Hi,&lt;br/&gt;
This patch consists of the foll:-&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Sources for Scan API.&lt;/li&gt;
	&lt;li&gt;Changing  raw pointers to smart pointers in Get API.&lt;/li&gt;
	&lt;li&gt;Removal of advanced API features from Get and Scan API&apos;s.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Thanks.&lt;/p&gt;</comment>
                            <comment id="15713345" author="enis" created="Thu, 1 Dec 2016 22:59:27 +0000"  >&lt;p&gt;The patch looks pretty good. Just some last items: &lt;br/&gt;
In the Scan copy constructors (same thing in assignment), I think we need to do a deep-copy of the family vectors. In the Get copy-constructors we do not copy the FamilyMap, so we should do that there as well.  &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  family_map_.insert(scan.family_map_.begin(), scan.family_map_.end());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is what the java code does: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Map.Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[],NavigableSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt;&amp;gt; entry : fams.entrySet()) {
      &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] fam = entry.getKey();
      NavigableSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[]&amp;gt; cols = entry.getValue();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (cols != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; cols.size() &amp;gt; 0) {
        &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] col : cols) {
          addColumn(fam, col);
        }
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        addFamily(fam);
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Get has FamilyMap(), HasFamilies(), etc. Let&apos;s add those to the Scan as well to bring these on-par.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;In the cpplint scan (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-17220&quot; title=&quot;[C++] Address major issues from cpplint &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-17220&quot;&gt;HBASE-17220&lt;/a&gt;), one issue that came up was to converting all of the usages of &lt;tt&gt;long&lt;/tt&gt; which is not portable to using fixed-length values (int64, etc). But lets leave those as it is for this patch, since we will address them in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-17220&quot; title=&quot;[C++] Address major issues from cpplint &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-17220&quot;&gt;HBASE-17220&lt;/a&gt; patch.&lt;/li&gt;
&lt;/ul&gt;


</comment>
                            <comment id="15716828" author="sudeeps" created="Fri, 2 Dec 2016 23:15:47 +0000"  >&lt;p&gt;Thanks Enis,&lt;/p&gt;

&lt;p&gt;The below statement does a deep copy of the family map. I have added test cases to verify the same in the latest patch.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 family_map_.insert(scan.family_map_.begin(), scan.family_map_.end());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15717025" author="sudeeps" created="Sat, 3 Dec 2016 00:54:21 +0000"  >&lt;p&gt;This patch consits of the below fix based on the last feedback.&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Added Family() and HasFamilies() methods in Scan&lt;/li&gt;
	&lt;li&gt;Fixed bug of FamilyMap not being copied in Get copy constructor and assignment operator.&lt;/li&gt;
	&lt;li&gt;Added tests to verify copying (deep copy) of family map is proper using the below code
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 family_map_.insert(scan.family_map_.begin(), scan.family_map_.end());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="15730195" author="enis" created="Wed, 7 Dec 2016 22:52:57 +0000"  >&lt;p&gt;Committed this to the branch. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12806628" name="HBASE-15902.HBASE-14850.patch" size="152904" author="sudeeps" created="Fri, 27 May 2016 12:47:58 +0000"/>
                            <attachment id="12840296" name="HBASE-15902.HBASE-14850.v2.patch" size="24469" author="sudeeps" created="Wed, 23 Nov 2016 18:39:54 +0000"/>
                            <attachment id="12841198" name="HBASE-15902.HBASE-14850.v3.patch" size="37758" author="sudeeps" created="Thu, 1 Dec 2016 01:53:08 +0000"/>
                            <attachment id="12841600" name="HBASE-15902.HBASE-14850.v4.patch" size="43430" author="sudeeps" created="Sat, 3 Dec 2016 00:54:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 24 Nov 2016 02:26:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 week, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ylkn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>