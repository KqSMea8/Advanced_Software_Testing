<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:42:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7111/HBASE-7111.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7111] hbase zkcli will not start if the zookeeper server chosen to connect to is unavailable</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7111</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;there are 3 zookeeper servers in my cluster.&lt;br/&gt;
s1&lt;br/&gt;
s2&lt;br/&gt;
s3&lt;br/&gt;
after killing  s3, i found the hbase zkcli will not start again.&lt;br/&gt;
it will try to connect to s3 continuely. &lt;/p&gt;

&lt;p&gt;/11/07 11:01:01 INFO zookeeper.ClientCnxn: Opening socket connection to server s3&lt;br/&gt;
12/11/07 11:01:01 WARN zookeeper.ClientCnxn: Session 0x0 for server null, unexpected error, closing socket connection and attempting reconnect&lt;br/&gt;
java.net.ConnectException: Connection refused&lt;/p&gt;


&lt;p&gt;from the code &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; parse(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Configuration c) {
    &lt;span class=&quot;code-comment&quot;&gt;// Note that we &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not simply grab the property
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// HConstants.ZOOKEEPER_QUORUM from the HBaseConfiguration because the
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// user may be using a zoo.cfg file.
&lt;/span&gt;    Properties zkProps = ZKConfig.makeZKProps(c);
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; host = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; clientPort = &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Entry&amp;lt;&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;, &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;&amp;gt; entry: zkProps.entrySet()) {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; key = entry.getKey().toString().trim();
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; value = entry.getValue().toString().trim();
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key.startsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;server.&quot;&lt;/span&gt;) &amp;amp;&amp;amp; host == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] parts = value.split(&lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt;);
        host = parts[0];
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (key.endsWith(&lt;span class=&quot;code-quote&quot;&gt;&quot;clientPort&quot;&lt;/span&gt;)) {
        clientPort = value;
      }
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (host != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; clientPort != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; host != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; clientPort != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;? host + &lt;span class=&quot;code-quote&quot;&gt;&quot;:&quot;&lt;/span&gt; + clientPort: &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the code will choose the fixed zookeeper server (here is the unavailable s3), which leads to the script fails&lt;/p&gt;</description>
                <environment></environment>
        <key id="12615067">HBASE-7111</key>
            <summary>hbase zkcli will not start if the zookeeper server chosen to connect to is unavailable</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="zhou wen jian">Zhou wenjian</assignee>
                                    <reporter username="zhou wen jian">Zhou wenjian</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Nov 2012 03:08:46 +0000</created>
                <updated>Tue, 7 May 2013 03:51:35 +0000</updated>
                            <resolved>Mon, 4 Mar 2013 21:56:17 +0000</resolved>
                                    <version>0.94.2</version>
                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.94.6</fixVersion>
                    <fixVersion>0.95.0</fixVersion>
                                    <component>Zookeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13492089" author="zhou wen jian" created="Wed, 7 Nov 2012 03:11:02 +0000"  >&lt;p&gt;IMO, need to choose a random server to connect, rather than the fixed one which is depended on the properties reading from conf&lt;/p&gt;</comment>
                            <comment id="13492647" author="stack" created="Wed, 7 Nov 2012 19:52:23 +0000"  >&lt;p&gt;What did you have in your configuration?  Just z3?&lt;/p&gt;</comment>
                            <comment id="13492882" author="zhou wen jian" created="Thu, 8 Nov 2012 01:33:24 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;&lt;br/&gt;
i have s1,s2,s3 in my configuration&lt;/p&gt;

&lt;p&gt;but the script will always choose s3 which is unavailable &lt;/p&gt;</comment>
                            <comment id="13492889" author="stack" created="Thu, 8 Nov 2012 01:45:24 +0000"  >&lt;p&gt;Random seems fine but won&apos;t it just fail if we happen to choose the wrong one?  Why not a loop trying all ensemble members (as long as it times out fas).  You have a patch for us Zhou?  Thanks.&lt;/p&gt;</comment>
                            <comment id="13492898" author="zhou wen jian" created="Thu, 8 Nov 2012 02:12:28 +0000"  >&lt;p&gt;will give a patch later&lt;/p&gt;</comment>
                            <comment id="13492917" author="zhou wen jian" created="Thu, 8 Nov 2012 02:54:15 +0000"  >&lt;p&gt;patch for trunk&lt;/p&gt;</comment>
                            <comment id="13492956" author="stack" created="Thu, 8 Nov 2012 04:55:00 +0000"  >&lt;p&gt;Please follow coding style the rest of the file has.  Any chance of a unit test asserting your change does as you suggest?  Thanks.  &lt;/p&gt;</comment>
                            <comment id="13493030" author="zhou wen jian" created="Thu, 8 Nov 2012 08:03:12 +0000"  >&lt;p&gt;The testcase modified could assert my change.&lt;/p&gt;

&lt;p&gt;And i have tested it in my local test cluster, if one of the zookeeper server in conf works, the script will connect to zookeeper&lt;/p&gt;</comment>
                            <comment id="13586752" author="lhofhansl" created="Tue, 26 Feb 2013 04:53:08 +0000"  >&lt;p&gt;Patch looks good to me.&lt;br/&gt;
I&apos;ll insert braces upon commit.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt;, what do you guys think?&lt;/p&gt;</comment>
                            <comment id="13586767" author="yuzhihong@gmail.com" created="Tue, 26 Feb 2013 05:02:46 +0000"  >&lt;p&gt;Patch was for trunk.&lt;/p&gt;

&lt;p&gt;You would upload patch for 0.94, I assume.&lt;/p&gt;</comment>
                            <comment id="13586768" author="stack" created="Tue, 26 Feb 2013 05:03:32 +0000"  >&lt;p&gt;So rather than return a single server we return string with all servers w/ port tacked on the end.  +1  We&apos;ll soon find out if its broke post-commit.&lt;/p&gt;</comment>
                            <comment id="13592682" author="lhofhansl" created="Mon, 4 Mar 2013 21:53:17 +0000"  >&lt;p&gt;Patch applies with just some offset to 0.94. Going to commit.&lt;/p&gt;</comment>
                            <comment id="13592687" author="lhofhansl" created="Mon, 4 Mar 2013 21:56:17 +0000"  >&lt;p&gt;Committed to 0.94, 0.95, and 0.98.&lt;br/&gt;
(Also made sure that TestZooKeeperMainServerArg passes in each branch.&lt;/p&gt;</comment>
                            <comment id="13592870" author="hudson" created="Tue, 5 Mar 2013 00:55:13 +0000"  >&lt;p&gt;Integrated in hbase-0.95 #22 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/22/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/22/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7111&quot; title=&quot;hbase zkcli will not start if the zookeeper server chosen to connect to is unavailable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7111&quot;&gt;&lt;del&gt;HBASE-7111&lt;/del&gt;&lt;/a&gt; hbase zkcli will not start if the zookeeper server chosen to connect to is unavailable (Zhou wenjian) (Revision 1452553)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperMainServerArg.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperMainServerArg.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13592939" author="hudson" created="Tue, 5 Mar 2013 02:01:51 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #879 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/879/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/879/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7111&quot; title=&quot;hbase zkcli will not start if the zookeeper server chosen to connect to is unavailable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7111&quot;&gt;&lt;del&gt;HBASE-7111&lt;/del&gt;&lt;/a&gt; hbase zkcli will not start if the zookeeper server chosen to connect to is unavailable (Zhou wenjian) (Revision 1452552)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperMainServerArg.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperMainServerArg.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13593112" author="hudson" created="Tue, 5 Mar 2013 06:26:47 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #430 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/430/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/430/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7111&quot; title=&quot;hbase zkcli will not start if the zookeeper server chosen to connect to is unavailable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7111&quot;&gt;&lt;del&gt;HBASE-7111&lt;/del&gt;&lt;/a&gt; hbase zkcli will not start if the zookeeper server chosen to connect to is unavailable (Zhou wenjian) (Revision 1452554)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperMainServerArg.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperMainServerArg.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13593152" author="hudson" created="Tue, 5 Mar 2013 07:52:06 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #12 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/12/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/12/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7111&quot; title=&quot;hbase zkcli will not start if the zookeeper server chosen to connect to is unavailable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7111&quot;&gt;&lt;del&gt;HBASE-7111&lt;/del&gt;&lt;/a&gt; hbase zkcli will not start if the zookeeper server chosen to connect to is unavailable (Zhou wenjian) (Revision 1452552)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperMainServerArg.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperMainServerArg.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13593232" author="hudson" created="Tue, 5 Mar 2013 08:29:13 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #116 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/116/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/116/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7111&quot; title=&quot;hbase zkcli will not start if the zookeeper server chosen to connect to is unavailable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7111&quot;&gt;&lt;del&gt;HBASE-7111&lt;/del&gt;&lt;/a&gt; hbase zkcli will not start if the zookeeper server chosen to connect to is unavailable (Zhou wenjian) (Revision 1452552)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperMainServerArg.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperMainServerArg.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13650461" author="beneguo" created="Tue, 7 May 2013 03:32:33 +0000"  >&lt;p&gt;There are another problem: The return String like this:167.52.0.236,167.52.0.235,167.52.0.234:2181, but zookeeper client connection String shoud like this 167.52.0.236:2181,167.52.0.235:2181,167.52.0.234:2181, if changed the zookeeper client port, the zkcli can&apos;t connection the first and the second ip.&lt;/p&gt;</comment>
                            <comment id="13650465" author="stack" created="Tue, 7 May 2013 03:36:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=beneguo&quot; class=&quot;user-hover&quot; rel=&quot;beneguo&quot;&gt;Bene Guo&lt;/a&gt; Mind opening new issue please?  We should fix it.&lt;/p&gt;</comment>
                            <comment id="13650482" author="beneguo" created="Tue, 7 May 2013 03:51:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;&lt;br/&gt;
OK, the new issue : &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8501&quot; title=&quot;The hbase zkcli will connection failure the first and the second ip from ZooKeeperMainServerArg return connection string&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8501&quot;&gt;&lt;del&gt;HBASE-8501&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12552630" name="HBASE-7111-trunk-v2.patch" size="2628" author="zhou wen jian" created="Thu, 8 Nov 2012 07:56:36 +0000"/>
                            <attachment id="12552603" name="HBASE-7111-trunk.patch" size="2505" author="zhou wen jian" created="Thu, 8 Nov 2012 02:53:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 7 Nov 2012 19:52:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255621</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 32 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0fsun:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>90272</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>