<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:17:40 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4298/HBASE-4298.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4298] Support to drain RS nodes through ZK</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4298</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;HDFS currently has a way to exclude certain datanodes and prevent them from getting new blocks.  HDFS goes one step further and even drains these nodes for you.  This enhancement is a step in that direction.&lt;/p&gt;

&lt;p&gt;The idea is that we mark nodes in zookeeper as draining nodes.  This means that they don&apos;t get any more new regions.  These draining nodes look exactly the same as the corresponding nodes in /rs, except they live under /draining.&lt;/p&gt;

&lt;p&gt;Eventually, support for draining them can be added.  I am submitting two patches for review - one for the 0.90 branch and one for trunk (in git).&lt;/p&gt;

&lt;p&gt;Here are the two patches&lt;br/&gt;
0.90 - &lt;a href=&quot;https://github.com/aravind/hbase/commit/181041e72e7ffe6a4da6d82b431ef7f8c99e62d2&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/aravind/hbase/commit/181041e72e7ffe6a4da6d82b431ef7f8c99e62d2&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;trunk - &lt;a href=&quot;https://github.com/aravind/hbase/commit/e127b25ae3b4034103b185d8380f3b7267bc67d5&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/aravind/hbase/commit/e127b25ae3b4034103b185d8380f3b7267bc67d5&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I have tested both these patches and they work as advertised.&lt;/p&gt;</description>
                <environment>&lt;p&gt;all&lt;/p&gt;</environment>
        <key id="12520723">HBASE-4298</key>
            <summary>Support to drain RS nodes through ZK</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="aravindg">Aravind Gottipati</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Tue, 30 Aug 2011 11:58:33 +0000</created>
                <updated>Fri, 20 Nov 2015 11:52:15 +0000</updated>
                            <resolved>Tue, 1 May 2012 17:41:26 +0000</resolved>
                                    <version>0.90.4</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13107149" author="yuzhihong@gmail.com" created="Sat, 17 Sep 2011 14:29:51 +0000"  >&lt;p&gt;I reviewed the patch for trunk.&lt;/p&gt;

&lt;p&gt;For AssignmentManager.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-quote&quot;&gt;&quot;, exclude=&quot;&lt;/span&gt; + drainingServers + &lt;span class=&quot;code-quote&quot;&gt;&quot;) available servers&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think we only need to log the number of draining servers.&lt;/p&gt;

&lt;p&gt;For ServerManager.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  /** Map of region servers that should not get any more &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; regions */
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Map&amp;lt;ServerName, HServerLoad&amp;gt; drainingServers =
+    &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ConcurrentHashMap&amp;lt;ServerName, HServerLoad&amp;gt;();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The javadoc should state that keys of the map are region servers.&lt;/p&gt;

&lt;p&gt;I think removeServerFromDrainList() should return a boolean. ServerManager.isServerOnline(sn) should be used instead of checking HServerLoad. If sn isn&apos;t online, the method should return false. Otherwise true is returned.&lt;/p&gt;

&lt;p&gt;You may consider doing similar action in addServerToDrainList().&lt;/p&gt;

&lt;p&gt;I wonder if Map is needed for drainingServers because it is private and getDrainingServersList() only returns the keySet.&lt;/p&gt;

&lt;p&gt;For DrainingServerTracker.java, please remove year.&lt;br/&gt;
The handling of calling this.serverManager methods is different between add() and remove(): one inside synchronized block, one outside. Is there a reason ?&lt;/p&gt;

&lt;p&gt;More to follow.&lt;/p&gt;</comment>
                            <comment id="13107154" author="yuzhihong@gmail.com" created="Sat, 17 Sep 2011 15:21:19 +0000"  >&lt;p&gt;For nodeChildrenChanged(), please change the sentence for catch black of IOException, it mentioned zk exception.&lt;/p&gt;

&lt;p&gt;For ZooKeeperWatcher.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;zookeeper.znode.draining&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;draining&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think a better name maybe &quot;zookeeper.znode.draining.rs&quot;&lt;/p&gt;

&lt;p&gt;Can you write some unit tests for this feature ?&lt;br/&gt;
Please also share your experience from using this in your environment.&lt;/p&gt;</comment>
                            <comment id="13107194" author="stack" created="Sat, 17 Sep 2011 18:15:50 +0000"  >&lt;p&gt;@Aravind Should remove the createNode rather than just comment it out.  Nice feature.  Do nodes get poked into  /draining by external process?  Lets work on a unit test for this stuff (and address Ted&apos;s comment above).  When you get a chance, stick in some of your experience running this patch here.&lt;/p&gt;</comment>
                            <comment id="13114991" author="aravindg" created="Mon, 26 Sep 2011 22:39:25 +0000"  >&lt;p&gt;@Ted: Thank you for the review.  I made some changes and updated my patch (in github).  Notes in line.&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;I think we only need to log the number of draining servers.&lt;/li&gt;
	&lt;li&gt;The javadoc should state that keys of the map are region servers.&lt;/li&gt;
	&lt;li&gt;For DrainingServerTracker.java, please remove year.&lt;/li&gt;
	&lt;li&gt;For nodeChildrenChanged(), please change the sentence for catch black of IOException, it mentioned zk exception.&lt;/li&gt;
	&lt;li&gt;Should remove the createNode rather than just comment it out.&lt;/li&gt;
	&lt;li&gt;serverManager methods is different between add() and remove(): one inside synchronized block, one outside.&lt;/li&gt;
	&lt;li&gt;I think a better name maybe &quot;zookeeper.znode.draining.rs&quot;&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I agree with all of these and they are all fixed in my latest code push (on github).&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;I wonder if Map is needed for drainingServers because it is private and getDrainingServersList() only returns the keySet.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The map isn&apos;t required, but I followed the example of onlineServers and serverConnections.  For code in trunk, I have changed it to a ArrayList.  A similar change does not work (easily) in the 0.90 branch.  Code in AssignmentManager uses HServerInfo in 0.90, and changing drainingServers to an array list will mean key lookups etc.  I have left it as a Map in 0.90, but I changed it to a list in trunk.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;removeServerFromDrainList / addServerToDrainList should return a boolean.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The remove and add methods are called from DrainingServerTracker.  The context is a ZK callback, and the corresponding remove and add functions there simply return voids.  I changed the code to return booleans in trunk, but left it as void in the 0.90 branch. I figured they might actually be used in trunk, but I doubt they will be in 0.90.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Unit tests..&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I will work with Stack and get the tests to you.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul&gt;
	&lt;li&gt;Share your experience from using this in your environment.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;To reboot the cluster, we currently drain one server at a time (using the graceful stop shell script).  This process takes forever to go through all the servers.  The goal here is to enable us to drain multiple servers simultaneously.  Doing this by keeping track of servers externally makes the programming painful, and we&apos;d have to share state somehow between different scripts that all aim to drain different servers.  Leaving this list in ZK and having HBase keep them from getting new regions seems like the right way to go about it.  I have tested this in a test cluster of about 14 servers.  This code by itself only solves one part of our problem.  The rest of it will be solved by command line scripts that will create nodes to be shut down under /draining/rs in ZK, and then move regions out from them.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Please let me know if you have any other questions about this stuff.&lt;/p&gt;</comment>
                            <comment id="13114995" author="aravindg" created="Mon, 26 Sep 2011 22:43:45 +0000"  >&lt;p&gt;Well.. JIRA lost all my formatting in my last comment..  I hope it still makes sense.&lt;/p&gt;

&lt;p&gt;The latest changesets are &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/aravind/hbase/commit/46f3b58c60f4f1c81806fdad6e606badf84fc30c&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/aravind/hbase/commit/46f3b58c60f4f1c81806fdad6e606badf84fc30c&lt;/a&gt; for trunk.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/aravind/hbase/commit/e6cf9ecf78f8e0d6f46c2a77a524e6bccec45001&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/aravind/hbase/commit/e6cf9ecf78f8e0d6f46c2a77a524e6bccec45001&lt;/a&gt; for 0.90.&lt;/p&gt;</comment>
                            <comment id="13115032" author="yuzhihong@gmail.com" created="Mon, 26 Sep 2011 23:28:08 +0000"  >&lt;p&gt;@Aravind:&lt;br/&gt;
Reading plain text version in my mailbox isn&apos;t hard at all.&lt;/p&gt;

&lt;p&gt;Thanks for taking care of my review comments. Appreciate it.&lt;/p&gt;

&lt;p&gt;Can you attach the two patches to this JIRA or publish them on reviewboard ?&lt;br/&gt;
That way you can get more helpful comments and I can run test suite over them.&lt;/p&gt;

&lt;p&gt;Good job.&lt;/p&gt;</comment>
                            <comment id="13115072" author="aravindg" created="Tue, 27 Sep 2011 00:30:27 +0000"  >&lt;p&gt;Patch files for trunk and 0.90.&lt;/p&gt;</comment>
                            <comment id="13115112" author="yuzhihong@gmail.com" created="Tue, 27 Sep 2011 01:28:24 +0000"  >&lt;p&gt;@Aravind:&lt;br/&gt;
Is it possible to come up with some unit test for this feature ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13115141" author="yuzhihong@gmail.com" created="Tue, 27 Sep 2011 02:28:45 +0000"  >&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2063/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2063/&lt;/a&gt;  for trunk and&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2064/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2064/&lt;/a&gt; for 0.90&lt;/p&gt;</comment>
                            <comment id="13139485" author="stack" created="Sat, 29 Oct 2011 22:58:13 +0000"  >&lt;p&gt;Here are the minor items addressed on aravind&apos;s patch&lt;/p&gt;</comment>
                            <comment id="13139488" author="stack" created="Sat, 29 Oct 2011 22:59:26 +0000"  >&lt;p&gt;There&apos;s comments over in &lt;a href=&quot;https://reviews.apache.org/r/2063/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2063/&lt;/a&gt;.  In particular there is this one:&lt;/p&gt;

&lt;p&gt;&quot;What about balancing?  I see no consideration of draining servers in the balance algorithm.  I suppose you have it disabled when this is all running Aravind, is that so?&quot;&lt;/p&gt;</comment>
                            <comment id="13139515" author="hadoopqa" created="Sun, 30 Oct 2011 01:46:42 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12501479/4298-trunk-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12501479/4298-trunk-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -166 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestDistributedLogSplitting&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/102//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/102//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/102//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/102//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/102//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/102//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13139757" author="stack" created="Sun, 30 Oct 2011 20:45:29 +0000"  >&lt;p&gt;The TDLS failed because of:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2011-10-30 00:16:16,142 ERROR [org.apache.hadoop.hdfs.server.datanode.DataXceiver@15bc53] datanode.DataXceiver(131): DatanodeRegistration(127.0.0.1:50070, storageID=DS-1489265021-67.195.138.20-50070-1319933763131, infoPort=37761, ipcPort=47077):DataXceiver
java.net.SocketException: Too many open files
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13140233" author="mingma" created="Mon, 31 Oct 2011 15:47:24 +0000"  >&lt;p&gt;Just in case, there was another code review at &lt;a href=&quot;https://reviews.apache.org/r/2064&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2064&lt;/a&gt;. It seems some of the questions have been answered by Aravind.&lt;/p&gt;</comment>
                            <comment id="13140251" author="stack" created="Mon, 31 Oct 2011 16:07:07 +0000"  >&lt;p&gt;Thanks Ming.  Let me chase Aravind today.&lt;/p&gt;</comment>
                            <comment id="13140455" author="aravindg" created="Mon, 31 Oct 2011 19:05:50 +0000"  >&lt;p&gt;I haven&apos;t had the time to figure out how to write unit tests for this, but here are the test cases I ran through.&lt;/p&gt;

&lt;p&gt;Setup a cluster with 5 or more region servers and a bunch of regions.&lt;/p&gt;

&lt;p&gt;1.  Mark a server (server A) as draining (using zkCli) and then shutdown a different server (server B) - check to make sure that server A does not get any more new regions.&lt;br/&gt;
2.  Mark a server (server A) as draining (using zkCli) and then go through all the regions on that server and assign them (from the cli), they should all end up on different servers and by the end, server A should not have any regions left on it.&lt;br/&gt;
3.  Mark a server (server A) as draining (using zkCli), disable the balancer and drain server A (as in step 2).  Then enable the balancer again and verify that server A does not get any new regions.&lt;br/&gt;
4.  Remove the server (server A) from the draining list, and check that it gets regions when the balancer next runs.&lt;/p&gt;

&lt;p&gt;I ran through other scenarios/tests like this, but with multipls servers in the draining list.  We could probably repeat the above tests, but with two servers in the drain list..&lt;/p&gt;</comment>
                            <comment id="13141478" author="streamy" created="Tue, 1 Nov 2011 19:17:41 +0000"  >&lt;p&gt;I think this should be for 0.94 since it&apos;s a new feature.  I also think a pre-requisite to commit is a unit test.&lt;/p&gt;</comment>
                            <comment id="13142660" author="stack" created="Wed, 2 Nov 2011 23:03:29 +0000"  >&lt;p&gt;Sketch of a test; need to verify its actually properly testing.  Will make combined patch later today.&lt;/p&gt;</comment>
                            <comment id="13142671" author="stack" created="Wed, 2 Nov 2011 23:19:46 +0000"  >&lt;p&gt;Almost done.  Let me write another test.&lt;/p&gt;</comment>
                            <comment id="13142744" author="hadoopqa" created="Thu, 3 Nov 2011 01:06:55 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12502063/drainingservertest-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12502063/drainingservertest-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -164 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 46 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/147//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/147//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/147//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/147//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/147//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/147//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13142749" author="yuzhihong@gmail.com" created="Thu, 3 Nov 2011 01:11:00 +0000"  >&lt;p&gt;There was compilation error:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
[ERROR] Failed to execute goal org.apache.maven.plugins:maven-compiler-plugin:2.0.2:testCompile (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;-testCompile) on project hbase: Compilation failure: Compilation failure:
[ERROR] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/trunk/src/test/java/org/apache/hadoop/hbase/TestDrainingServer.java:[78,4] not a statement
[ERROR] 
[ERROR] /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/trunk/src/test/java/org/apache/hadoop/hbase/TestDrainingServer.java:[78,5] &apos;;&apos; expected
[ERROR] -&amp;gt; [Help 1]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13142798" author="stack" created="Thu, 3 Nov 2011 03:28:00 +0000"  >&lt;p&gt;Eh.. yeah.  I know what I attached.&lt;/p&gt;

&lt;p&gt;Interesting though how patch-build ran this anyways though I did not cancel the old patch only submitted a new.  Thats ok.   Just something unexpected.&lt;/p&gt;</comment>
                            <comment id="13142857" author="stack" created="Thu, 3 Nov 2011 05:54:08 +0000"  >&lt;p&gt;Combined patch &amp;#8211; Aravinds&apos; plus test.  Marked as not intended for inclusion because Aravind needs to do the granting.&lt;/p&gt;</comment>
                            <comment id="13142929" author="hadoopqa" created="Thu, 3 Nov 2011 07:49:52 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12502103/4298-trunk-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12502103/4298-trunk-v3.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -164 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 46 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestLogRolling&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestDistributedLogSplitting&lt;br/&gt;
                  org.apache.hadoop.hbase.TestGlobalMemStoreSize&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestMasterFailover&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/152//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/152//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/152//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/152//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/152//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/152//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13143331" author="stack" created="Thu, 3 Nov 2011 17:18:50 +0000"  >&lt;p&gt;I ran TestLogRolling locally and can&apos;t get it to fail.  It failed with &apos;Cannot lock storage /home/jenkins/jenkins-slave/workspace/PreCommit-HBASE-Build/trunk/target/test-data/7f164eb7-a297-40fb-89ff-6bd9a0e331db/dfscluster_e7b1f239-5bca-46c6-abfb-f8237c09a7ce/dfs/data/data3. The directory is already locked.&apos;&lt;/p&gt;

&lt;p&gt;TestDistributedLogSplitting fails with too many open files but ulimit for files says 32k?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
asf011.sp2.ygridcore.net
core file size          (blocks, -c) 0
data seg size           (kbytes, -d) unlimited
scheduling priority             (-e) 20
file size               (blocks, -f) unlimited
pending signals                 (-i) 16382
max locked memory       (kbytes, -l) 64
max memory size         (kbytes, -m) unlimited
open files                      (-n) 32768
pipe size            (512 bytes, -p) 8
POSIX message queues     (bytes, -q) 819200
real-time priority              (-r) 0
stack size              (kbytes, -s) 8192
cpu time               (seconds, -t) unlimited
max user processes              (-u) 2048
virtual memory          (kbytes, -v) unlimited
file locks                      (-x) unlimited
32768
Running in Jenkins mode
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is good to go I&apos;d say.&lt;/p&gt;</comment>
                            <comment id="13143386" author="aravindg" created="Thu, 3 Nov 2011 17:54:30 +0000"  >&lt;p&gt;Patch against trunk with Stack&apos;s test case.&lt;/p&gt;</comment>
                            <comment id="13143425" author="stack" created="Thu, 3 Nov 2011 18:37:41 +0000"  >&lt;p&gt;Committed to branch and trunk.  Thanks for the patch Aravind.&lt;/p&gt;

&lt;p&gt;This is a new feature that has been running for months now at my place of employ. Our ops like it (and dev&apos;d it).&lt;/p&gt;</comment>
                            <comment id="13143426" author="stack" created="Thu, 3 Nov 2011 18:38:09 +0000"  >&lt;p&gt;Reopening.  It was applied to 0.92 but we might want to apply to 0.90... moving it over there.&lt;/p&gt;</comment>
                            <comment id="13143479" author="hadoopqa" created="Thu, 3 Nov 2011 19:49:03 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12502184/trunk_with_test.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12502184/trunk_with_test.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 2 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -164 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 46 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestDistributedLogSplitting&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/160//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/160//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/160//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/160//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/160//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/160//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13143538" author="hudson" created="Thu, 3 Nov 2011 21:18:28 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2407 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2407/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2407/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4298&quot; title=&quot;Support to drain RS nodes through ZK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4298&quot;&gt;&lt;del&gt;HBASE-4298&lt;/del&gt;&lt;/a&gt; Support to drain RS nodes through ZK&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/DrainingServerTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/TestDrainingServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13143585" author="hudson" created="Thu, 3 Nov 2011 23:00:04 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #105 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/105/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/105/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4298&quot; title=&quot;Support to drain RS nodes through ZK&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4298&quot;&gt;&lt;del&gt;HBASE-4298&lt;/del&gt;&lt;/a&gt; Support to drain RS nodes through ZK&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/DrainingServerTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/test/java/org/apache/hadoop/hbase/TestDrainingServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13193630" author="ram_krish" created="Thu, 26 Jan 2012 07:42:51 +0000"  >&lt;p&gt;Moving into 0.90.7&lt;/p&gt;</comment>
                            <comment id="13193633" author="ram_krish" created="Thu, 26 Jan 2012 07:46:56 +0000"  >&lt;p&gt;@Stack&lt;br/&gt;
This issue has gone into 0.92 and trunk. As it is a new feature do you want to go into future 0.90 releases? if not can remove the fix versions as 0.90?&lt;/p&gt;</comment>
                            <comment id="13210494" author="stack" created="Fri, 17 Feb 2012 20:06:21 +0000"  >&lt;p&gt;Removed 0.90.7 as a fix version.&lt;/p&gt;</comment>
                            <comment id="13265924" author="davelatham" created="Tue, 1 May 2012 17:29:34 +0000"  >&lt;p&gt;Any reason this issue is still open?&lt;/p&gt;</comment>
                            <comment id="13265933" author="stack" created="Tue, 1 May 2012 17:41:26 +0000"  >&lt;p&gt;Committed to trunk and 0.92 long time ago.  Resolving.  Thanks for patch Aravind.&lt;/p&gt;</comment>
                            <comment id="13663313" author="jmhsieh" created="Tue, 21 May 2013 20:04:00 +0000"  >&lt;p&gt;Adding a link to the blog entry by aravind that explains how to use this: &lt;a href=&quot;http://inchoate-clatter.blogspot.com/2012/03/hbase-ops-automation.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://inchoate-clatter.blogspot.com/2012/03/hbase-ops-automation.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15015700" author="lars_francke" created="Fri, 20 Nov 2015 11:52:15 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12505835">HBASE-3833</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12597843">HBASE-6344</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12501479" name="4298-trunk-v2.txt" size="14662" author="stack" created="Sat, 29 Oct 2011 22:58:13 +0000"/>
                            <attachment id="12502103" name="4298-trunk-v3.txt" size="22950" author="stack" created="Thu, 3 Nov 2011 05:54:08 +0000"/>
                            <attachment id="12496595" name="90_hbase.patch" size="13462" author="aravindg" created="Tue, 27 Sep 2011 00:30:27 +0000"/>
                            <attachment id="12502063" name="drainingservertest-v2.txt" size="5461" author="stack" created="Wed, 2 Nov 2011 23:19:46 +0000"/>
                            <attachment id="12502060" name="drainingservertest.txt" size="5191" author="stack" created="Wed, 2 Nov 2011 23:03:29 +0000"/>
                            <attachment id="12496596" name="trunk_hbase.patch" size="14782" author="aravindg" created="Tue, 27 Sep 2011 00:30:27 +0000"/>
                            <attachment id="12502184" name="trunk_with_test.txt" size="22950" author="aravindg" created="Thu, 3 Nov 2011 17:54:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>7.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 17 Sep 2011 14:29:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3934</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hqav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101523</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Just as HDFS currently has a way to exclude certain datanodes and prevent them from getting new blocks, this feature adds marking regionservers so they will not get new regions if you add a regionserver to the draining nodes directory in zk.  These draining znodes look exactly the same as the corresponding nodes in /rs, except they live under /draining.  This patch adds watching of /draining and the blocking of region assignment to draining nodes; it does not provide means of writing the draining znode (use zkcli).</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>