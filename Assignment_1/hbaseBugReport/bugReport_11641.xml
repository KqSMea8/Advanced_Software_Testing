<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:25:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11641/HBASE-11641.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11641] TestDistributedLogSplitting.testMasterStartsUpWithLogSplittingWork fails frequently</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11641</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;3 out of last four run of my RC jenkins build failed in this test.&lt;br/&gt;
Might be related to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11041&quot; title=&quot;HBaseTestingUtil.createMultiRegions deals incorrectly with missing column family&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11041&quot;&gt;&lt;del&gt;HBASE-11041&lt;/del&gt;&lt;/a&gt; too.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12731270">HBASE-11641</key>
            <summary>TestDistributedLogSplitting.testMasterStartsUpWithLogSplittingWork fails frequently</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Aug 2014 05:46:22 +0000</created>
                <updated>Tue, 9 Sep 2014 04:19:28 +0000</updated>
                            <resolved>Tue, 5 Aug 2014 17:34:21 +0000</resolved>
                                                    <fixVersion>0.94.23</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14081957" author="lhofhansl" created="Fri, 1 Aug 2014 06:07:25 +0000"  >&lt;p&gt;Found this in the logs. Just recording it here for later.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.lang.NullPointerException
	at org.apache.hadoop.hbase.util.Bytes.toBytes(Bytes.java:441)
	at org.apache.hadoop.hbase.zookeeper.ClusterId.setClusterId(ClusterId.java:72)
	at org.apache.hadoop.hbase.master.HMaster.finishInitialization(HMaster.java:581)
	at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:433)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This causes the master to fail to start, which causes the test to fail.&lt;/p&gt;</comment>
                            <comment id="14081962" author="stack" created="Fri, 1 Aug 2014 06:11:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; Did you mean an issue other than  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11041&quot; title=&quot;HBaseTestingUtil.createMultiRegions deals incorrectly with missing column family&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11041&quot;&gt;&lt;del&gt;HBASE-11041&lt;/del&gt;&lt;/a&gt; ?  Thanks boss.&lt;/p&gt;</comment>
                            <comment id="14082005" author="lhofhansl" created="Fri, 1 Aug 2014 07:11:45 +0000"  >&lt;p&gt;No meant that one, as I mention this test in the description.&lt;/p&gt;</comment>
                            <comment id="14082008" author="lhofhansl" created="Fri, 1 Aug 2014 07:13:06 +0000"  >&lt;p&gt;The failure exception is always the same: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.io.IOException: Shutting down
	at org.apache.hadoop.hbase.MiniHBaseCluster.init(MiniHBaseCluster.java:224)
	at org.apache.hadoop.hbase.MiniHBaseCluster.&amp;lt;init&amp;gt;(MiniHBaseCluster.java:87)
	at org.apache.hadoop.hbase.MiniHBaseCluster.&amp;lt;init&amp;gt;(MiniHBaseCluster.java:78)
	at org.apache.hadoop.hbase.HBaseTestingUtility.startMiniHBaseCluster(HBaseTestingUtility.java:658)
	at org.apache.hadoop.hbase.master.TestDistributedLogSplitting.startCluster(TestDistributedLogSplitting.java:139)
	at org.apache.hadoop.hbase.master.TestDistributedLogSplitting.testMasterStartsUpWithLogSplittingWork(TestDistributedLogSplitting.java:272)
	at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
	at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
	at java.lang.reflect.Method.invoke(Method.java:597)
	at org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:47)
	at org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)
	at org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:44)
	at org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)
	at org.junit.internal.runners.statements.FailOnTimeout$StatementThread.run(FailOnTimeout.java:74)
Caused by: java.lang.RuntimeException: Master not initialized after 200 seconds
	at org.apache.hadoop.hbase.util.JVMClusterUtil.startup(JVMClusterUtil.java:206)
	at org.apache.hadoop.hbase.LocalHBaseCluster.startup(LocalHBaseCluster.java:422)
	at org.apache.hadoop.hbase.MiniHBaseCluster.init(MiniHBaseCluster.java:217)
	... 14 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That&apos;s a cause of the NPE I think.&lt;/p&gt;

&lt;p&gt;I think the two master starting up in the same JVM steo on each other&apos;s toes. Somehow.&lt;/p&gt;</comment>
                            <comment id="14082424" author="stack" created="Fri, 1 Aug 2014 16:21:45 +0000"  >&lt;p&gt;This you &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;? Thanks.&lt;/p&gt;</comment>
                            <comment id="14082428" author="jxiang" created="Fri, 1 Aug 2014 16:26:16 +0000"  >&lt;p&gt;Looking.&lt;/p&gt;</comment>
                            <comment id="14082548" author="lhofhansl" created="Fri, 1 Aug 2014 17:20:25 +0000"  >&lt;p&gt;And this is the cause for the NPE and causes the Masters to shut down.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-08-01 05:09:42,220 WARN  [Master:0;pomona.apache.org,51451,1406869780524] util.FSUtils(549): Cluster ID file file:/home/jenkins/hbase/hbase.id was empty
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is not a new failure, though. Happens at least since May.&lt;/p&gt;</comment>
                            <comment id="14082558" author="lhofhansl" created="Fri, 1 Aug 2014 17:22:56 +0000"  >&lt;p&gt;Also, this is in 0.94.&lt;/p&gt;

&lt;p&gt;Attaching the logs of a test run for reference (jenkins is slow, and the results go away at some point).&lt;/p&gt;</comment>
                            <comment id="14082591" author="lhofhansl" created="Fri, 1 Aug 2014 17:40:35 +0000"  >&lt;p&gt;I also believe this is an issue only with a local cluster (multiple Masters in the same JVM)&lt;/p&gt;</comment>
                            <comment id="14082637" author="jxiang" created="Fri, 1 Aug 2014 18:05:05 +0000"  >&lt;p&gt;Weird. Could it be some OS/hardware issue and we can&apos;t read the file just written?&lt;/p&gt;</comment>
                            <comment id="14082690" author="lhofhansl" created="Fri, 1 Aug 2014 18:29:59 +0000"  >&lt;p&gt;In a good run I see:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2014-08-01 11:12:55,764 DEBUG [Master:0;localhost,47103,1406916775344] util.FSUtils(577): Created cluster ID file at file:/home/lhofhans/hbase/hbase.id with ID: 767967ea-8b82-4c41-b3b2-a69095a0de58
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Instead of the file &quot;... was empty&quot; message. Since there are no other errors logged the file must preexist, and be empty (otherwise I&apos;d see either the creation success or an error log).&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Could it be some OS/hardware issue and we can&apos;t read the file just written?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Could be, especially with local fs...? Happening very frequently, though.&lt;/p&gt;</comment>
                            <comment id="14082709" author="apurtell" created="Fri, 1 Aug 2014 18:37:47 +0000"  >&lt;p&gt;I just committed the golden oldie &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3270&quot; title=&quot;When we create the .version file, we should create it in a tmp location and then move it into place&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3270&quot;&gt;&lt;del&gt;HBASE-3270&lt;/del&gt;&lt;/a&gt; for hbase.version, do we need a similar change for hbase.id also?&lt;/p&gt;</comment>
                            <comment id="14082742" author="lhofhansl" created="Fri, 1 Aug 2014 18:52:56 +0000"  >&lt;p&gt;In this case I think it&apos;s a race between the two masters (I think), where both are trying to write the file. So atomically moving the files into place would solve this (if my theory is correct).&lt;/p&gt;</comment>
                            <comment id="14082781" author="lhofhansl" created="Fri, 1 Aug 2014 19:14:09 +0000"  >&lt;p&gt;Nope... Nope the case (race between masters). Only the active master initializes the FS.&lt;/p&gt;</comment>
                            <comment id="14082899" author="lhofhansl" created="Fri, 1 Aug 2014 20:25:43 +0000"  >&lt;p&gt;Frankly I feel like just disabling this test. Looked through the commit history on this test, and there were all kinds of issues, all of which only problems with the test (not the code it is supposed to test). Will do that only for 0.94.&lt;/p&gt;</comment>
                            <comment id="14082957" author="stack" created="Fri, 1 Aug 2014 21:02:52 +0000"  >&lt;p&gt;+1 to disabling it though I think moving in cluserid same way we do hbase.version would be good to have.&lt;/p&gt;</comment>
                            <comment id="14082964" author="apurtell" created="Fri, 1 Aug 2014 21:08:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think moving in cluserid same way we do hbase.version would be good to have.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11650&quot; title=&quot;Write hbase.id to a temporary location and move into place&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11650&quot;&gt;&lt;del&gt;HBASE-11650&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;</comment>
                            <comment id="14083336" author="lhofhansl" created="Sat, 2 Aug 2014 04:03:35 +0000"  >&lt;p&gt;Let&apos;s see if &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11652&quot; title=&quot;Port HBASE-3270 and HBASE-11650 to 0.94 - create cluster id and version file in a tmp location and move it into place&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11652&quot;&gt;&lt;del&gt;HBASE-11652&lt;/del&gt;&lt;/a&gt; fixes this.&lt;/p&gt;</comment>
                            <comment id="14084193" author="lhofhansl" created="Mon, 4 Aug 2014 00:57:49 +0000"  >&lt;p&gt;Nope... Happened again. Same error. With the file moved into place atomically now, I am not sure how this can happen. Will continue to look.&lt;/p&gt;</comment>
                            <comment id="14084197" author="lhofhansl" created="Mon, 4 Aug 2014 01:15:50 +0000"  >&lt;p&gt;Here&apos;s at least something that&apos;s weird. In startCluster we call TEST_UTIL.shutdownMiniHBaseCluster() even though that happens on teardown of each test anyway. shutdownMiniHBaseCluster() happens to reset WAIT_ON_REGIONSERVERS_MINTOSTART, which testMasterStartsUpWithLogSplittingWork sets. I don&apos;t think that causes the issue, unless somehow leads to timing issues upon shutdown (i.e. the RSs haven&apos;t even started, yet).&lt;br/&gt;
I assume this was a leftover from when the test was changed to shutdown the cluster in the teardown method (and it is probably something I did).&lt;/p&gt;</comment>
                            <comment id="14084199" author="lhofhansl" created="Mon, 4 Aug 2014 01:17:10 +0000"  >&lt;p&gt;Simple change. (also fixes to use the actual passed num_master parameters, that part if just cosmetic)&lt;/p&gt;

&lt;p&gt;Test still passes when run many times locally.&lt;/p&gt;</comment>
                            <comment id="14084223" author="lhofhansl" created="Mon, 4 Aug 2014 02:09:22 +0000"  >&lt;p&gt;It also turns out that testMasterStartsUpWithLogSplittingWork is the first test run in TestDistributedLogSplitting, so it&apos;s not due to some stuff lying around from previous tests (at least not this test class itself).&lt;/p&gt;</comment>
                            <comment id="14085157" author="stack" created="Mon, 4 Aug 2014 19:29:02 +0000"  >&lt;p&gt;Go for it &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14086502" author="lhofhansl" created="Tue, 5 Aug 2014 17:18:42 +0000"  >&lt;p&gt;K... Lemme commit that. 0.94 only (this is already fixed in 0.98 and later)&lt;/p&gt;</comment>
                            <comment id="14086515" author="lhofhansl" created="Tue, 5 Aug 2014 17:34:21 +0000"  >&lt;p&gt;Committed. Crossing fingers.&lt;/p&gt;</comment>
                            <comment id="14086580" author="hudson" created="Tue, 5 Aug 2014 18:20:53 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94 #1396 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1396/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1396/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11641&quot; title=&quot;TestDistributedLogSplitting.testMasterStartsUpWithLogSplittingWork fails frequently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11641&quot;&gt;&lt;del&gt;HBASE-11641&lt;/del&gt;&lt;/a&gt; TestDistributedLogSplitting.testMasterStartsUpWithLogSplittingWork fails frequently. (larsh: rev e127626d3bfcf647910086f809cbdae2afacb1e5)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14086584" author="hudson" created="Tue, 5 Aug 2014 18:24:26 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-JDK7 #165 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-JDK7/165/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-JDK7/165/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11641&quot; title=&quot;TestDistributedLogSplitting.testMasterStartsUpWithLogSplittingWork fails frequently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11641&quot;&gt;&lt;del&gt;HBASE-11641&lt;/del&gt;&lt;/a&gt; TestDistributedLogSplitting.testMasterStartsUpWithLogSplittingWork fails frequently. (larsh: rev e127626d3bfcf647910086f809cbdae2afacb1e5)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14086813" author="hudson" created="Tue, 5 Aug 2014 21:31:58 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-security #508 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/508/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/508/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11641&quot; title=&quot;TestDistributedLogSplitting.testMasterStartsUpWithLogSplittingWork fails frequently&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11641&quot;&gt;&lt;del&gt;HBASE-11641&lt;/del&gt;&lt;/a&gt; TestDistributedLogSplitting.testMasterStartsUpWithLogSplittingWork fails frequently. (larsh: rev e127626d3bfcf647910086f809cbdae2afacb1e5)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12659204" name="11641-logs.txt" size="173710" author="lhofhansl" created="Fri, 1 Aug 2014 17:22:56 +0000"/>
                            <attachment id="12659593" name="11641.txt" size="1001" author="lhofhansl" created="Mon, 4 Aug 2014 01:17:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 1 Aug 2014 06:11:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409342</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 19 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yfin:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409338</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>