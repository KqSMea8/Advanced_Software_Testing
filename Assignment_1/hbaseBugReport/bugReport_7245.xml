<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:43:57 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7245/HBASE-7245.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7245] Recovery on failed snapshot restore</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7245</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Restore will do updates to the file system and to meta.  it seems that an inopportune failure before meta is completely updated could result in an inconsistent state that would require hbck to fix.&lt;/p&gt;

&lt;p&gt;We should define what the semantics are for recovering from this.  Some suggestions:&lt;/p&gt;

&lt;p&gt;1) Fail Forward (see some log saying restore&apos;s meta edits not completed, then gather information necessary to build it all from fs, and complete meta edits.).&lt;br/&gt;
2) Fail backwards (see some log saying restore&apos;s meta edits not completed, delete incomplete snapshot region entries from meta.)  &lt;/p&gt;

&lt;p&gt;I think I prefer 1 &amp;#8211; if two processes end somehow updating  (somehow the original master didn&apos;t die, and a new one started up) they would be idempotent.  If we used 2, we could still have a race and still be in a bad place.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12618340">HBASE-7245</key>
            <summary>Recovery on failed snapshot restore</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="mbertozzi">Matteo Bertozzi</assignee>
                                    <reporter username="jmhsieh">Jonathan Hsieh</reporter>
                        <labels>
                    </labels>
                <created>Fri, 30 Nov 2012 16:51:54 +0000</created>
                <updated>Sun, 12 Oct 2014 03:39:28 +0000</updated>
                                                            <fixVersion>2.0.0</fixVersion>
                                    <component>Client</component>
                    <component>master</component>
                    <component>regionserver</component>
                    <component>snapshots</component>
                    <component>Zookeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13507680" author="yuzhihong@gmail.com" created="Fri, 30 Nov 2012 21:47:15 +0000"  >&lt;p&gt;+1 on option 1.&lt;/p&gt;</comment>
                            <comment id="13508857" author="mbertozzi" created="Mon, 3 Dec 2012 17:04:05 +0000"  >&lt;p&gt;The set of operations that have this kind of problem are:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;create table: remove the table if failed (rollback) the user already received the failure&lt;/li&gt;
	&lt;li&gt;delete table: finish removing the table (rollforward) restoring the table is impossible&lt;/li&gt;
	&lt;li&gt;clone table: remove the table if failed (rollback) same as create table&lt;/li&gt;
	&lt;li&gt;restore table: finish restoring the table (rollforward) finish the restore&lt;/li&gt;
	&lt;li&gt;snapshot: removing the tmp folder (rollback)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;One simple solution is to drop a &quot;operation lock&quot; file in the table folder, and on master startup, if the file is present look at the operation enum serialized and execute the &quot;rollback/rollforward&quot;. (Note that if the master is not down, you can do the recovery catching the exception)&lt;/p&gt;</comment>
                            <comment id="13508872" author="yuzhihong@gmail.com" created="Mon, 3 Dec 2012 17:20:23 +0000"  >&lt;p&gt;The subject of this JIRA is w.r.t. snapshot restore. So the first two scenarios above can be handled in separate JIRA.&lt;/p&gt;

&lt;p&gt;The operation directive can be created in zookeeper.&lt;/p&gt;</comment>
                            <comment id="13509005" author="mbertozzi" created="Mon, 3 Dec 2012 20:19:52 +0000"  >&lt;p&gt;If we use ZooKeeper what happens when the user erase the zk content before starting the master? we still have the bad state on disk and meta but no hint on the unfinished operation.&lt;/p&gt;

&lt;p&gt;If I understood correctly we are using zookeeper as &quot;ephimeral&quot; only (except for replication) do we want to move to something that rely fully on zookeeper? &lt;/p&gt;</comment>
                            <comment id="13509013" author="yuzhihong@gmail.com" created="Mon, 3 Dec 2012 20:31:19 +0000"  >&lt;p&gt;The discussion from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6721&quot; title=&quot;RegionServer Group based Assignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6721&quot;&gt;&lt;del&gt;HBASE-6721&lt;/del&gt;&lt;/a&gt; is related in this regard.&lt;br/&gt;
Francis started with storing group information on hdfs. Later he switched to storage in table. Whether storing in zookeeper is under review.&lt;/p&gt;

&lt;p&gt;I am fine with storing operation directive on hdfs.&lt;/p&gt;</comment>
                            <comment id="13533356" author="mbertozzi" created="Sun, 16 Dec 2012 11:11:11 +0000"  >&lt;p&gt;posted a patch just for discussion &lt;a href=&quot;https://reviews.apache.org/r/8624/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/8624/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14168502" author="enis" created="Sun, 12 Oct 2014 03:39:28 +0000"  >&lt;p&gt;Old issue. Unscheduling from branch-1. Feel free to bring back if there is an updated patch.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 30 Nov 2012 21:47:15 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>293001</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0sra7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>165897</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>