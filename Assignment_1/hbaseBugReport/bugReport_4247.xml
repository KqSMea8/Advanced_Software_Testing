<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:17:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4247/HBASE-4247.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4247] Add isAborted method to the Abortable interface</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4247</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Add a new method isAborted() to the Abortable interface &lt;/p&gt;</description>
                <environment></environment>
        <key id="12519903">HBASE-4247</key>
            <summary>Add isAborted method to the Abortable interface</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="thehellmaker">Akash Ashok</assignee>
                                    <reporter username="thehellmaker">Akash Ashok</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Aug 2011 02:28:51 +0000</created>
                <updated>Fri, 20 Nov 2015 11:53:21 +0000</updated>
                            <resolved>Sat, 17 Sep 2011 18:26:27 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13090990" author="thehellmaker" created="Thu, 25 Aug 2011 13:16:16 +0000"  >&lt;p&gt;Firstly in the process of working on this. I have made the following assumptions&lt;/p&gt;

&lt;p&gt;1. if abort() has a null implementation, then &lt;br/&gt;
      a. isAborted() will have a null implementation ( returns false )&lt;/p&gt;

&lt;p&gt;2. if abort() throws a RuntimeException(), then &lt;br/&gt;
      a. create a boolean abort &lt;br/&gt;
      b.set this to true in  abort()&lt;br/&gt;
      c. return abort in isAbort()&lt;/p&gt;

&lt;p&gt;I hope this would be fine.&lt;/p&gt;


&lt;p&gt;Secondly there are Instances where in abort() implementation this.stopped and this.closed are manipulated. Shouldn&apos;t this be done in stop() and close() methods of Stoppable and Closable interfaces? This is a little misleading isn&apos;t it ? &lt;/p&gt;

&lt;p&gt;If it really has to be stopped when aborted then why not call stop() from abort(). I feel it makes it more meaningful&lt;/p&gt;
</comment>
                            <comment id="13092175" author="stack" created="Sat, 27 Aug 2011 03:11:08 +0000"  >&lt;p&gt;On 1., agree.  I agree on 2. too.&lt;/p&gt;

&lt;p&gt;On your &apos;Secondly&apos;, yes.  That seems dirty.&lt;/p&gt;

&lt;p&gt;Agree on calling stop from abort (Doesn&apos;t it do this in a few places?  IIRC).&lt;/p&gt;</comment>
                            <comment id="13092453" author="thehellmaker" created="Sun, 28 Aug 2011 10:48:45 +0000"  >&lt;p&gt;I just made the changes and ran tests. There&apos;s one issue. In HConnectionManagerImpl as I mentioned before this.closed is being set to true in the abort() method and I changed this to call close(stopProxy) method indeed instead of manipulating this.closed to true. But unfortunatly TestMergeTool started failing because of this change. So my question is that was this intended closed in the first place ??  &lt;/p&gt;</comment>
                            <comment id="13092482" author="yuzhihong@gmail.com" created="Sun, 28 Aug 2011 13:44:59 +0000"  >&lt;p&gt;TestMergeTool passed in build 2155.&lt;br/&gt;
Can you publish your patch along with the test failure ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13092492" author="thehellmaker" created="Sun, 28 Aug 2011 14:38:56 +0000"  >&lt;p&gt;TestMerge tool is failing because of the changes I made I am sure. &lt;/p&gt;

&lt;p&gt;The change is basically this:&lt;/p&gt;

&lt;p&gt;Original&lt;br/&gt;
&amp;lt;code&amp;gt;&lt;br/&gt;
   @Override&lt;br/&gt;
    public void abort(final String msg, Throwable t) {&lt;br/&gt;
      if (t instanceof KeeperException.SessionExpiredException) {&lt;br/&gt;
        try &lt;/p&gt;
{
          LOG.info(&quot;This client just lost it&apos;s session with ZooKeeper, trying&quot; +
              &quot; to reconnect.&quot;);
          resetZooKeeperTrackers();
          LOG.info(&quot;Reconnected successfully. This disconnect could have been&quot; +
              &quot; caused by a network partition or a long-running GC pause,&quot; +
              &quot; either way it&apos;s recommended that you verify your environment.&quot;);
          return;
        } catch (ZooKeeperConnectionException e) {
          LOG.error(&quot;Could not reconnect to ZooKeeper after session&quot; +
              &quot; expiration, aborting&quot;);
          t = e;
        }&lt;br/&gt;
      }&lt;br/&gt;
      if (t != null) LOG.fatal(msg, t);&lt;br/&gt;
      else LOG.fatal(msg);&lt;br/&gt;
      this.closed=true;&lt;br/&gt;
    }&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;br/&gt;
&lt;br/&gt;
Changed&lt;br/&gt;
&amp;lt;code&amp;gt;&lt;br/&gt;
   @Override&lt;br/&gt;
    public void abort(final String msg, Throwable t) {&lt;br/&gt;
      if (t instanceof KeeperException.SessionExpiredException) {&lt;br/&gt;
        try {
          LOG.info(&quot;This client just lost it&apos;s session with ZooKeeper, trying&quot; +
              &quot; to reconnect.&quot;);
          resetZooKeeperTrackers();
          LOG.info(&quot;Reconnected successfully. This disconnect could have been&quot; +
              &quot; caused by a network partition or a long-running GC pause,&quot; +
              &quot; either way it&apos;s recommended that you verify your environment.&quot;);
          return;
        }
&lt;p&gt; catch (ZooKeeperConnectionException e) &lt;/p&gt;
{
          LOG.error(&quot;Could not reconnect to ZooKeeper after session&quot; +
              &quot; expiration, aborting&quot;);
          t = e;
        }
&lt;p&gt;      }&lt;br/&gt;
      if (t != null) LOG.fatal(msg, t);&lt;br/&gt;
      else LOG.fatal(msg);&lt;br/&gt;
      close(false);&lt;br/&gt;
    }&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;My question is close is closing zookeeper session and other thing. But does changing this leads to other test cases like TestMergeTool failing. &lt;/p&gt;

&lt;p&gt;Does setting this.closed=true have any meaning at all in abort without actually closing ?&lt;/p&gt;</comment>
                            <comment id="13092493" author="thehellmaker" created="Sun, 28 Aug 2011 14:40:47 +0000"  >&lt;p&gt;Plz excuse me about the formatting. I didn&apos;t know the Markup tags the codes should be placed under &lt;/p&gt;</comment>
                            <comment id="13092494" author="yuzhihong@gmail.com" created="Sun, 28 Aug 2011 14:52:43 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://lists.secondlife.com/pipermail/jira-notify/2009-January/099415.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://lists.secondlife.com/pipermail/jira-notify/2009-January/099415.html&lt;/a&gt; for Code formatting tags for JIRA&lt;/p&gt;

&lt;p&gt;@Akash:&lt;br/&gt;
If you cannot edit your previous comment, I can format it for you.&lt;/p&gt;</comment>
                            <comment id="13092502" author="thehellmaker" created="Sun, 28 Aug 2011 15:35:16 +0000"  >&lt;p&gt;HConnectionImplementation implements HConnection which inturn implements Abortable&lt;/p&gt;</comment>
                            <comment id="13092506" author="yuzhihong@gmail.com" created="Sun, 28 Aug 2011 15:58:55 +0000"  >&lt;p&gt;According to the javadoc for Abortable:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; * This is used primarily for ZooKeeper usage when we could get an unexpected
 * and fatal exception, requiring an abort.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This means the first if block in the above abort() method is supposed to handle almost all calls to the method.&lt;/p&gt;

&lt;p&gt;To try to validate the above judgement, I issued the following two searches among all test output files:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
grep FATAL target/surefire-reports/* | grep ConnectionManager | grep -v TestMergeTool
grep &apos;Could not reconnect to ZooKeeper after session&apos; target/surefire-reports/*
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There was nothing returned.&lt;/p&gt;

&lt;p&gt;TestMergeTool is a special case where HBase cluster is supposed to be unavailable.&lt;/p&gt;

&lt;p&gt;Looking at getMaster() and locateRegion(), this.closed being true would make them return immediately.&lt;/p&gt;

&lt;p&gt;Hope this helps with your question.&lt;/p&gt;</comment>
                            <comment id="13093857" author="thehellmaker" created="Tue, 30 Aug 2011 16:11:37 +0000"  >&lt;p&gt;I agree with that. But on a more logical level doesn&apos;t setting this.closed = true mean that close() method was called on it and the zookeeper session itself was closed ? &lt;br/&gt;
setting this.closed = true without executing close() shouldn&apos;t be done even for special cases right ?&lt;/p&gt;

&lt;p&gt;If such is that case then this.aborted itself should be used instead of closed right ??&lt;/p&gt;</comment>
                            <comment id="13100012" author="stack" created="Thu, 8 Sep 2011 05:18:11 +0000"  >&lt;p&gt;I thought abort executed close?&lt;/p&gt;</comment>
                            <comment id="13100320" author="thehellmaker" created="Thu, 8 Sep 2011 13:52:46 +0000"  >&lt;p&gt;In HConnectionManager.java under the subclass HConnectionManagerImplementation&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 @Override
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void abort(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; msg, Throwable t) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (t &lt;span class=&quot;code-keyword&quot;&gt;instanceof&lt;/span&gt; KeeperException.SessionExpiredException) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;This client just lost it&apos;s session with ZooKeeper, trying&quot;&lt;/span&gt; +
              &lt;span class=&quot;code-quote&quot;&gt;&quot; to reconnect.&quot;&lt;/span&gt;);
          resetZooKeeperTrackers();
          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Reconnected successfully. This disconnect could have been&quot;&lt;/span&gt; +
              &lt;span class=&quot;code-quote&quot;&gt;&quot; caused by a network partition or a &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt;-running GC pause,&quot;&lt;/span&gt; +
              &lt;span class=&quot;code-quote&quot;&gt;&quot; either way it&apos;s recommended that you verify your environment.&quot;&lt;/span&gt;);
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ZooKeeperConnectionException e) {
          LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Could not reconnect to ZooKeeper after session&quot;&lt;/span&gt; +
              &lt;span class=&quot;code-quote&quot;&gt;&quot; expiration, aborting&quot;&lt;/span&gt;);
          t = e;
        }
      }
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (t != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) LOG.fatal(msg, t);
      &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; LOG.fatal(msg);
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.closed = &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If we call close() instead of this tests are failing( one of them being TestMergeTools ). I was wondering if some change should be made out here. Somehow I feel its not right set this.closed out here? Or if this is some special case and could be left untouched. &lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13100969" author="stack" created="Fri, 9 Sep 2011 04:44:24 +0000"  >&lt;p&gt;I think this is special.  This is client-side.  I thought you were talking server-side.  I misunderstood.  Do what you think makes most sense Akash.  This client-side stuff is tricky.&lt;/p&gt;</comment>
                            <comment id="13107048" author="thehellmaker" created="Sat, 17 Sep 2011 06:25:34 +0000"  >&lt;p&gt;Adding Javadoc to the isAbortable() method in Abortable Interface&lt;/p&gt;</comment>
                            <comment id="13107198" author="stack" created="Sat, 17 Sep 2011 18:26:27 +0000"  >&lt;p&gt;Committed to TRUNK.  Thank you for the patch Akash.&lt;/p&gt;</comment>
                            <comment id="13107276" author="hudson" created="Sat, 17 Sep 2011 22:13:30 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2227 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2227/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2227/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4247&quot; title=&quot;Add isAborted method to the Abortable interface&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4247&quot;&gt;&lt;del&gt;HBASE-4247&lt;/del&gt;&lt;/a&gt; Add isAborted method to the Abortable interface&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4247&quot; title=&quot;Add isAborted method to the Abortable interface&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4247&quot;&gt;&lt;del&gt;HBASE-4247&lt;/del&gt;&lt;/a&gt; Add isAborted method to the Abortable interface&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/Abortable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/replication/master/ReplicationLogCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/HBaseFsck.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWatcher.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/catalog/TestCatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/catalog/TestCatalogTrackerOnCluster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/catalog/TestMetaReaderEditor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestActiveMasterManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestCatalogJanitor.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestClockSkewDetection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestLogsCleaner.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/TestMasterFailover.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/handler/MockRegionServerServices.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/handler/MockServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZKTable.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/zookeeper/TestZooKeeperNodeTracker.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15015960" author="lars_francke" created="Fri, 20 Nov 2015 11:53:21 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12494903" name="HBase-4247-v2.patch" size="15107" author="thehellmaker" created="Sat, 17 Sep 2011 06:25:34 +0000"/>
                            <attachment id="12494902" name="HBase-4247.patch" size="14974" author="thehellmaker" created="Sat, 17 Sep 2011 06:19:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 27 Aug 2011 03:11:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33448</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10342"><![CDATA[Incompatible change]]></customfieldvalue>
    <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hq2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101487</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Add isAbortable to Abortable Interface.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>