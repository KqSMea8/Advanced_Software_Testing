<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:09:20 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3332/HBASE-3332.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3332] Regions stuck in transition after RS failure</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3332</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Testing 0.90rc2 I ran into this issue. The test scenario was to kill -9 the server hosting ROOT and META, and before it had been detected, run &quot;balancer&quot; from the shell. After logs were split and regions were reassigned, I ended up with some regions stuck in transition.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12492967">HBASE-3332</key>
            <summary>Regions stuck in transition after RS failure</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="streamy">Jonathan Gray</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Dec 2010 19:01:45 +0000</created>
                <updated>Fri, 20 Nov 2015 12:41:06 +0000</updated>
                            <resolved>Tue, 14 Dec 2010 23:34:14 +0000</resolved>
                                    <version>0.90.0</version>
                                    <fixVersion>0.90.0</fixVersion>
                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12970275" author="streamy" created="Fri, 10 Dec 2010 19:06:12 +0000"  >&lt;p&gt;Can you post the master log&lt;/p&gt;</comment>
                            <comment id="12970277" author="streamy" created="Fri, 10 Dec 2010 19:07:20 +0000"  >&lt;p&gt;I will try to add this test case into TestMasterFailover once I figure out exactly what happened because it doesn&apos;t currently test this triggering of the balancer before detection.&lt;/p&gt;</comment>
                            <comment id="12970279" author="tlipcon" created="Fri, 10 Dec 2010 19:08:49 +0000"  >&lt;p&gt;Here&apos;s a log excerpt showing one of the regions that got stuck&lt;/p&gt;</comment>
                            <comment id="12970284" author="streamy" created="Fri, 10 Dec 2010 19:19:36 +0000"  >&lt;p&gt;I think this is newly broken because we don&apos;t do anything with PENDING_CLOSE timeouts anymore.  We used to but in some other jira recently I think stack took it out and removed the unit test for it (I agreed at the time).  Thinking on this case now, it can certainly happen because of the logic in ServerShutdownHandler ignoring this region.&lt;/p&gt;

&lt;p&gt;Rather than putting that back, I think there&apos;s a better way to deal with PENDING_CLOSE/CLOSING timeouts which should only happen in something like what you saw here.&lt;/p&gt;

&lt;p&gt;Let me work on a patch.&lt;/p&gt;</comment>
                            <comment id="12970305" author="streamy" created="Fri, 10 Dec 2010 20:27:16 +0000"  >&lt;p&gt;Previously ServerShutdownHandler would not handle any regions on the dead server if they were already in transition.  However, in the TimeoutMonitor, we will never force a region off of a server when it&apos;s PENDING_CLOSE or CLOSING because the expectation was we would handle it in server expiration.  But again, over there, we did nothing to all RIT.&lt;/p&gt;

&lt;p&gt;Change makes it so we will force reassignment of RIT if PENDING_CLOSE or CLOSING.&lt;/p&gt;

&lt;p&gt;Patch is not done yet, I need to make sure master won&apos;t screw something up and I want to add a test.  &lt;/p&gt;</comment>
                            <comment id="12970309" author="tlipcon" created="Fri, 10 Dec 2010 21:00:53 +0000"  >&lt;p&gt;Also I think we need to have some tool (even if it&apos;s a super advanced one rather than automagic) that could fix this situation, should we have another bug like this. Should I open another JIRA for that?&lt;/p&gt;</comment>
                            <comment id="12970312" author="streamy" created="Fri, 10 Dec 2010 21:09:18 +0000"  >&lt;p&gt;I&apos;m working on HBCK fix which will fix this issue (as it happened on the first master and on the backups).&lt;/p&gt;</comment>
                            <comment id="12970680" author="streamy" created="Mon, 13 Dec 2010 01:41:57 +0000"  >&lt;p&gt;This patch is completely different from the other.  This is an HBCK fix for the issue.  It brings back the ability to fix unassignment/dupe-assignment (this is unassign obviously).&lt;/p&gt;</comment>
                            <comment id="12970938" author="tlipcon" created="Mon, 13 Dec 2010 18:21:20 +0000"  >&lt;p&gt;Didn&apos;t look at the new hbck patch code, but just tried it on my broken cluster and it worked to revive it.&lt;/p&gt;</comment>
                            <comment id="12971160" author="stack" created="Tue, 14 Dec 2010 04:26:58 +0000"  >&lt;p&gt;+1 Looks right.&lt;/p&gt;</comment>
                            <comment id="12971467" author="streamy" created="Tue, 14 Dec 2010 23:34:14 +0000"  >&lt;p&gt;Committed v1 patch.  HBCK fix was committed under &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3337&quot; title=&quot;Restore HBCK fix of unassignment and dupe assignment for new master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3337&quot;&gt;&lt;del&gt;HBASE-3337&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Based on testing done with this patch applied, there may be more work to do, but issue found here is fixed.&lt;/p&gt;</comment>
                            <comment id="12971468" author="streamy" created="Tue, 14 Dec 2010 23:34:30 +0000"  >&lt;p&gt;Committed on trunk and branch.&lt;/p&gt;</comment>
                            <comment id="12974500" author="hudson" created="Thu, 23 Dec 2010 04:31:44 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1697 (See &lt;a href=&quot;https://hudson.apache.org/hudson/job/HBase-TRUNK/1697/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://hudson.apache.org/hudson/job/HBase-TRUNK/1697/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="15016883" author="lars_francke" created="Fri, 20 Nov 2015 12:41:06 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12466110" name="HBASE-3332-HBCKfix-v1.patch" size="23362" author="streamy" created="Mon, 13 Dec 2010 01:41:57 +0000"/>
                            <attachment id="12466017" name="HBASE-3332-v1.patch" size="3678" author="streamy" created="Fri, 10 Dec 2010 20:27:16 +0000"/>
                            <attachment id="12466012" name="log.txt" size="6381" author="tlipcon" created="Fri, 10 Dec 2010 19:08:49 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 10 Dec 2010 19:06:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26789</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hlsf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100792</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>