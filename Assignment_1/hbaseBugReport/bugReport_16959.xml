<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:19:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-16959/HBASE-16959.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-16959] Export snapshot to local file system of a single node</title>
                <link>https://issues.apache.org/jira/browse/HBASE-16959</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;ExportSnapshot allows uses to specify &quot;file://&quot; in &quot;copy-to&quot;.&lt;br/&gt;
Based on the implementation (use Map jobs), it works as follow:&lt;br/&gt;
(1) The manifest of the snapshot(.hbase-snapshot) is exported to the local file system of the HBase client node where the command is issued&lt;br/&gt;
(2) The data of the snapshot(archive)  is exported to the local file system of the nodes where the map jobs run, so spread everywhere.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;That causes 2 problems we meet so far:&lt;/b&gt;&lt;br/&gt;
(1) The last step to verify the snapshot integrity fails, due to that not all the data can be found on the HBase client node where the command is issued. &quot;-no-target-verify&quot; can be of help here to suppress the verification, but it is not a good idea&lt;br/&gt;
(2) When the HBase client (where the command is issued) is also a NodeManager of Yarn, and it happens to have a map job (to write data of snapshot) running on it, the &quot;copy-to&quot; directory will be created firstly when writing the manifest by user=hbase and then user=yarn(if it is not controlled) will try to write data into it. If the directory permission is not set properly, let say, umask = 022, both hbase and yarn are in hadoop group, the &quot;copy-to&quot; is created with no write permission(777-022=755, so rwxr-xr-x) for the same group, user=yarn can not write data into the &quot;copy-to&quot; directory, as it is created by user=hbase. We have the following exception&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Error: java.io.IOException: Mkdirs failed to create file:/tmp/snap_export/archive/data/&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;/table_xxx/regionid_xxx/info (exists=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, cwd=file:/hadoop/yarn/local/usercache/hbase/appcache/application_1477577812726_0001/container_1477577812726_0001_01_000004)
	at org.apache.hadoop.fs.ChecksumFileSystem.create(ChecksumFileSystem.java:449)
	at org.apache.hadoop.fs.ChecksumFileSystem.create(ChecksumFileSystem.java:435)
	at org.apache.hadoop.fs.FileSystem.create(FileSystem.java:909)
	at org.apache.hadoop.fs.FileSystem.create(FileSystem.java:890)
	at org.apache.hadoop.fs.FileSystem.create(FileSystem.java:787)
	at org.apache.hadoop.hbase.snapshot.ExportSnapshot$ExportMapper.copyFile(ExportSnapshot.java:275)
	at org.apache.hadoop.hbase.snapshot.ExportSnapshot$ExportMapper.map(ExportSnapshot.java:193)
	at org.apache.hadoop.hbase.snapshot.ExportSnapshot$ExportMapper.map(ExportSnapshot.java:119)
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:146)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:787)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:341)
	at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:164)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:422)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1657)
	at org.apache.hadoop.mapred.YarnChild.main(YarnChild.java:158)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We can control the permission to resolve that, but it is not a good idea either.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;Proposal&lt;/b&gt;&lt;br/&gt;
If exporting to &quot;file://&quot;, add reduce to aggregate all &quot;distributed&quot; data of the snapshot to the HBase client node where the command is issued, to be together with the manifest of the snapshot. That can resolve the verification problem above in (1)&lt;br/&gt;
For problem (2), have no idea so far&lt;/p&gt;</description>
                <environment></environment>
        <key id="13016016">HBASE-16959</key>
            <summary>Export snapshot to local file system of a single node</summary>
                <type id="2" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/newfeature.png">New Feature</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="water">Xiang Li</reporter>
                        <labels>
                    </labels>
                <created>Fri, 28 Oct 2016 01:39:51 +0000</created>
                <updated>Tue, 1 Nov 2016 10:07:22 +0000</updated>
                                                                            <component>snapshots</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="15614191" author="mbertozzi" created="Fri, 28 Oct 2016 03:48:59 +0000"  >&lt;p&gt;why not just run with -Dmapreduce.jobtracker.address=local, so the ExportSnapshot will run on the same machine and export locally? &lt;/p&gt;</comment>
                            <comment id="15619937" author="water" created="Sun, 30 Oct 2016 13:12:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;, thanks for the comment!&lt;/p&gt;

&lt;p&gt;I am not sure if mapreduce.jobtracker.address still takes effect in Yarn. I tried it by &lt;br/&gt;
(1) adding it by -D in HBase ExportSnapshot command, like hbase -Dmapreduce.jobtracker.address=local org.apache.hadoop.hbase.snapshot.ExportSnapshot -snapshot snap1 -copy-to &lt;a href=&quot;file:///tmp/snap_export&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;file:///tmp/snap_export&lt;/a&gt;. (I think -D might not take effect here)&lt;br/&gt;
(2) modifying mapred-site.xml and then re-starting Yarn&lt;br/&gt;
Both do not work for me.&lt;/p&gt;

&lt;p&gt;I also tried with yarn.resourcemanager.address=local, but apparently, it is not correct, because Yarn client can not connect to the ResourceManager. &lt;/p&gt;

&lt;p&gt;I might not catch up with you, or my usage is not correct, could you please do us a favor to elaborate more?&lt;/p&gt;
</comment>
                            <comment id="15621633" author="mbertozzi" created="Mon, 31 Oct 2016 08:45:53 +0000"  >&lt;p&gt;the -D is an option of the tool not the jvm, so you should pass it as: hbase org.apache.hadoop.hbase.snapshot.ExportSnapshot -D... -snapshot...&lt;/p&gt;

&lt;p&gt;as alternative of mapreduce.jobtracker.address you can use &quot;-jt local&quot; which is interpreted by the tool. and always used as tool argument so hbase org...ExportSnapshot -jt local -snapshot...&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hadoop/blob/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/GenericOptionsParser.java#L102&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/hadoop/blob/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/GenericOptionsParser.java#L102&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://github.com/apache/hadoop/blob/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/GenericOptionsParser.java#L273&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/apache/hadoop/blob/trunk/hadoop-common-project/hadoop-common/src/main/java/org/apache/hadoop/util/GenericOptionsParser.java#L273&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="15624996" author="water" created="Tue, 1 Nov 2016 10:07:22 +0000"  >&lt;p&gt;Thanks! Matteo! &quot;-jt local&quot; works for me. It is great!&lt;br/&gt;
Regarding &quot;mapreduce.jobtracker.address=local&quot;, do you mean &quot;mapreduce.framework.name=local&quot;, right? I can make the export job run successfully by&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;hbase org.apache.hadoop.hbase.snapshot.ExportSnapshot -Dmapreduce.framework.name=local... -snapshot...&lt;/p&gt;&lt;/blockquote&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 28 Oct 2016 03:48:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i35isf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>