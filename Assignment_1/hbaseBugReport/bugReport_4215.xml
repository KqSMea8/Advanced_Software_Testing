<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:16:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4215/HBASE-4215.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4215] RS requestsPerSecond counter seems to be off</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4215</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In testing trunk, I had YCSB reporting some 40,000 requests/second, but the summary info on the master webpage was consistently indicating somewhere around 3x that. I&apos;m guessing that we may have a bug where we forgot to divide by time.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12519151">HBASE-4215</key>
            <summary>RS requestsPerSecond counter seems to be off</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="subramanian">subramanian raghunathan</assignee>
                                    <reporter username="tlipcon">Todd Lipcon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 17 Aug 2011 17:18:27 +0000</created>
                <updated>Fri, 20 Nov 2015 11:53:49 +0000</updated>
                            <resolved>Fri, 26 Aug 2011 18:30:24 +0000</resolved>
                                    <version>0.92.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>metrics</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13086928" author="ram_krish" created="Thu, 18 Aug 2011 10:11:23 +0000"  >&lt;p&gt;We have changed the requests to requestPerSecond both in RS and Master UI&lt;/p&gt;</comment>
                            <comment id="13086939" author="subramanian" created="Thu, 18 Aug 2011 10:38:26 +0000"  >&lt;p&gt;As part of the defect fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3807&quot; title=&quot;Fix units in RS UI metrics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3807&quot;&gt;&lt;del&gt;HBASE-3807&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;we proposed and modified the request attribute to&lt;br/&gt;
requestPersecond both in RegionServer&lt;/p&gt;
{RegionServerMetrics}
&lt;p&gt; and Master&lt;/p&gt;
{HServerLoad}

&lt;p&gt;RegionServerMetrics calcualtes from MetricsRate&lt;/p&gt;

&lt;p&gt;Following is the code doing the calcualtion:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; now = &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis();
    &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; diff = (now-ts)/1000;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (diff == 0) diff = 1; &lt;span class=&quot;code-comment&quot;&gt;// sigh &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is crap.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.prevRate = (&lt;span class=&quot;code-object&quot;&gt;float&lt;/span&gt;)value / diff;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;    
&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;this.prevRate = (float)value / diff;&lt;/font&gt;&lt;br/&gt;
prevRate is finally displayed as &quot;requestPersecond&quot; as per the change in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3807&quot; title=&quot;Fix units in RS UI metrics&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3807&quot;&gt;&lt;del&gt;HBASE-3807&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But in master the same is calculated from  HServerLoad&lt;/p&gt;

&lt;p&gt;HRegionServer.buildServerLoad()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HServerLoad(requestCount.get(),
      (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;)(memory.getUsed() / 1024 / 1024),
      (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt;) (memory.getMax() / 1024 / 1024), regionLoads)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Request counter is present in HregionServer &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;      
  &lt;span class=&quot;code-comment&quot;&gt;// Request counter.
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;// Do we need &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;?  Can&apos;t we just sum region counters?  St.Ack 20110412
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; AtomicInteger requestCount = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AtomicInteger();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;  
&lt;p&gt;Obtained form the request counter which is incremented in all the API&apos;s of HRegionServer   &lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;This is not calculated per second its representing the total request per second.&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;but still in the master page we claim &lt;font color=&quot;green&quot;&gt;&quot;Load is requests per second and count of regions loaded.&quot;&lt;/font&gt;&lt;br/&gt;
This promted me in changing the convention from request to resquestPerSecond&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;Ideally The fix should be calculating the requestpersecond at region server and &lt;br/&gt;
initializing the HServerLoad with that value and the same to be displayed in the master.&lt;/font&gt;&lt;/p&gt;



&lt;p&gt;Region Servers&lt;br/&gt;
 Address Start Code Load &lt;br/&gt;
linux-kxjl:60030 1313659887824linux-kxjl,60020,1313659887824 requestsPerSecond=0, numberOfOnlineRegions=2, usedHeapMB=26, maxHeapMB=995 &lt;br/&gt;
Total:  servers: 1   requests=0, regions=2 &lt;/p&gt;

&lt;p&gt;Load is requests per second and count of regions loaded&lt;/p&gt;

&lt;p&gt;Also its better to change the agregation details also into the new convention &lt;br/&gt;
&lt;font color=&quot;red&quot;&gt; requests=0, regions=2&lt;/font&gt;&lt;br/&gt;
to &lt;br/&gt;
&lt;font color=&quot;green&quot;&gt; requestsPerSecond=0, numberOfOnlineRegions=2&lt;/font&gt;    &lt;/p&gt;

&lt;p&gt;If this looks fine i can provide a patch for the same.&lt;/p&gt;</comment>
                            <comment id="13087014" author="subramanian" created="Thu, 18 Aug 2011 13:46:49 +0000"  >&lt;p&gt;In further to these understandindg , i was planning to unify the methodology of deriving the &quot;requestPerSecond&quot; , so that HRsgionServer uses the APi of RegionServerMetrics (i.e) RegionServerMetrics.getRequests() and initialise HServerLoad , but one desparity found was metricsState uses a float value whereas HServerLoad uses an integer value to represent the same,It would be better to unify the data type across them so that the master and region server UI are in sink.&lt;/p&gt;

&lt;p&gt;Please sugest me which of them can be used and unified,i personally feel float is better but the changes seem to be more.&lt;/p&gt;

&lt;p&gt;Based on that i will provide the patch tommorow.&lt;/p&gt;</comment>
                            <comment id="13087313" author="stack" created="Thu, 18 Aug 2011 21:36:31 +0000"  >&lt;p&gt;+1 on changing HSL to do float.&lt;/p&gt;</comment>
                            <comment id="13087314" author="stack" created="Thu, 18 Aug 2011 21:36:51 +0000"  >&lt;p&gt;There should be no migration issue since these are transient objects.&lt;/p&gt;</comment>
                            <comment id="13088577" author="subramanian" created="Mon, 22 Aug 2011 09:00:28 +0000"  >&lt;p&gt;1)  Modifying the requestPersecond value to integer rather than float since the value is used in several VO&apos;s&lt;br/&gt;
like: &lt;br/&gt;
1) MasterMetrics metrics &lt;br/&gt;
2) AClusterStatus&lt;br/&gt;
3) StorageClusterStatusModel&lt;br/&gt;
4) AServerLoad etc. &lt;/p&gt;

&lt;p&gt;Also to maintain consistensy the regionservermetrics and HServerLoad using integer values for requestPersecond.&lt;/p&gt;

&lt;p&gt;Advantages: Consitency throughout the system . Changes are minimal.&lt;br/&gt;
DisAdvantages: Percision loss, also integer can accomadate less value than the float.&lt;/p&gt;

&lt;p&gt;2)HServerLoad.getNumberOfRequests() is used in multiple places.&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;green&quot;&gt;StorageClusterStatusModel - Expects request per second &lt;br/&gt;
ClusterStatus - Expects request per second &lt;br/&gt;
MasterStatusTmplImpl - UI part also Expects request per second &lt;/font&gt;&lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;AvroUtil - Not sure &lt;/font&gt; &lt;/p&gt;

&lt;p&gt;&lt;font color=&quot;red&quot;&gt;&lt;br/&gt;
HMaster &lt;br/&gt;
public void regionServerReport(final byte [] sn, final HServerLoad hsl)&lt;br/&gt;
  throws IOException {&lt;br/&gt;
    this.serverManager.regionServerReport(new ServerName(sn), hsl);&lt;br/&gt;
    if (hsl != null &amp;amp;&amp;amp; this.metrics != null) {
      // Up our metrics.
      this.metrics.incrementRequests(hsl.getTotalNumberOfRequests());
    }&lt;br/&gt;
  }&lt;br/&gt;
The metric expects the total request in the all the region servers and the metric computes the per second value of the aggregation of all the region servers.&lt;/font&gt;&lt;/p&gt;

&lt;p&gt;So following change is sugested to keep the existing attribute as the requestPersecond.Also introduce additional attribute that reports the total request made in RS as totalNumberOfRequests This will be used by the Master Metrics.&lt;/p&gt;

&lt;p&gt;Will upload the patch ASAP &lt;/p&gt;</comment>
                            <comment id="13091934" author="stack" created="Fri, 26 Aug 2011 18:30:24 +0000"  >&lt;p&gt;Thank you for the patch Subramanian.  Nice work.  Thanks too for the trail through your thinking with color.  Took a while for me to snake through it but it for sure helped me when reviewing your patch.&lt;/p&gt;

&lt;p&gt;Committed to TRUNK.&lt;/p&gt;</comment>
                            <comment id="13092042" author="hudson" created="Fri, 26 Aug 2011 20:59:30 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2147 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2147/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2147/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4215&quot; title=&quot;RS requestsPerSecond counter seems to be off&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4215&quot;&gt;&lt;del&gt;HBASE-4215&lt;/del&gt;&lt;/a&gt; RS requestsPerSecond counter seems to be off&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4215&quot; title=&quot;RS requestsPerSecond counter seems to be off&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4215&quot;&gt;&lt;del&gt;HBASE-4215&lt;/del&gt;&lt;/a&gt; RS requestsPerSecond counter seems to be off&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/jamon/org/apache/hbase/tmpl/master/MasterStatusTmpl.jamon&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HServerLoad.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/metrics/RegionServerMetrics.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15016072" author="lars_francke" created="Fri, 20 Nov 2015 11:53:49 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12504849">HBASE-3807</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12491219" name="HBASE-4215_trunk.patch" size="5640" author="subramanian" created="Mon, 22 Aug 2011 15:56:37 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Aug 2011 10:11:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27224</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hpxb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101462</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>