<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:09:39 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10010/HBASE-10010.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10010] eliminate the put latency spike on the new log file beginning</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10010</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In deed, the original finding came from fb, see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6813&quot; title=&quot;Optimise the time spent holding the updateLock under log roll&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6813&quot;&gt;&lt;del&gt;HBASE-6813&lt;/del&gt;&lt;/a&gt; for detailed discussion.&lt;br/&gt;
Through this improvement doesn&apos;t expect obvious gain on 95th or 99th latency, it still could make the response time more stable to me.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12680131">HBASE-10010</key>
            <summary>eliminate the put latency spike on the new log file beginning</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="xieliang007">Liang Xie</assignee>
                                    <reporter username="xieliang007">Liang Xie</reporter>
                        <labels>
                    </labels>
                <created>Wed, 20 Nov 2013 08:26:40 +0000</created>
                <updated>Mon, 16 Dec 2013 18:47:00 +0000</updated>
                            <resolved>Mon, 9 Dec 2013 05:06:40 +0000</resolved>
                                    <version>0.94.13</version>
                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.96.1</fixVersion>
                    <fixVersion>0.94.15</fixVersion>
                    <fixVersion>0.99.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13827436" author="xieliang007" created="Wed, 20 Nov 2013 08:31:48 +0000"  >&lt;p&gt;I added some debug logs in syncer(long) before/after tempWriter.sync();&lt;/p&gt;

&lt;p&gt;before :&lt;br/&gt;
2013-11-19,15:42:41,580 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:196921us&lt;br/&gt;
2013-11-19,15:47:52,686 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:19665us&lt;br/&gt;
2013-11-19,15:48:16,270 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:21565us&lt;br/&gt;
2013-11-19,15:48:43,686 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:21860us&lt;br/&gt;
2013-11-19,15:49:07,050 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:27612us&lt;br/&gt;
2013-11-19,15:49:34,785 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:21311us&lt;br/&gt;
2013-11-19,15:50:04,077 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:20829us&lt;br/&gt;
2013-11-19,15:50:29,836 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:21424us&lt;br/&gt;
2013-11-19,15:50:59,168 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:21299us&lt;br/&gt;
2013-11-19,15:51:24,384 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:38065us&lt;br/&gt;
2013-11-19,15:51:51,250 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:22940us&lt;br/&gt;
2013-11-19,15:52:18,997 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:204917us&lt;br/&gt;
2013-11-19,15:53:00,256 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:29913us&lt;br/&gt;
2013-11-19,15:53:48,317 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:293027us&lt;br/&gt;
2013-11-19,15:54:39,473 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:279183us&lt;br/&gt;
2013-11-19,15:55:27,519 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:73038us&lt;br/&gt;
2013-11-19,15:56:10,762 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:23200us&lt;br/&gt;
2013-11-19,15:56:58,304 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:50298us&lt;br/&gt;
2013-11-19,15:57:48,976 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:30899us&lt;br/&gt;
2013-11-19,15:58:29,328 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:21863us&lt;br/&gt;
2013-11-19,15:59:09,681 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:32979us&lt;br/&gt;
2013-11-19,15:59:52,697 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:50621us&lt;br/&gt;
2013-11-19,16:00:39,956 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:365199us&lt;br/&gt;
2013-11-19,16:01:30,344 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:38628us&lt;br/&gt;
2013-11-19,16:02:16,520 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:105847us&lt;/p&gt;

&lt;p&gt;after applied this patch:&lt;/p&gt;

&lt;p&gt;2013-11-19,17:23:24,546 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:1819us&lt;br/&gt;
2013-11-19,17:27:11,566 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:1207us&lt;br/&gt;
2013-11-19,17:27:52,424 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:2017us&lt;br/&gt;
2013-11-19,17:28:42,973 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:1735us&lt;br/&gt;
2013-11-19,17:29:29,495 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:929us&lt;br/&gt;
2013-11-19,17:30:20,270 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:1220us&lt;br/&gt;
2013-11-19,17:31:17,437 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:2685us&lt;br/&gt;
2013-11-19,17:32:13,032 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:30865us&lt;br/&gt;
2013-11-19,17:33:05,483 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:1540us&lt;br/&gt;
2013-11-19,17:33:50,325 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:1448us&lt;br/&gt;
2013-11-19,17:34:30,508 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:1675us&lt;br/&gt;
2013-11-19,17:35:01,440 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:1279us&lt;br/&gt;
2013-11-19,17:35:29,878 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:1561us&lt;br/&gt;
2013-11-19,17:36:02,552 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:1253us&lt;br/&gt;
2013-11-19,17:36:30,942 INFO org.apache.hadoop.hbase.regionserver.wal.HLog: FirstSync cost:889us&lt;/p&gt;</comment>
                            <comment id="13827442" author="xieliang007" created="Wed, 20 Nov 2013 08:40:22 +0000"  >&lt;p&gt;attached is a patch against 0.94 branch, which i just port from a 0.94.3 version.&lt;br/&gt;
I haven&apos;t done a runAllTests against the latest 0.94 branch yet, but it pass the whole case set in a 0.94.3 branch.&lt;/p&gt;</comment>
                            <comment id="13827709" author="hadoopqa" created="Wed, 20 Nov 2013 14:36:45 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12614810/HBase-10010-0.94.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12614810/HBase-10010-0.94.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7950//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7950//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13827999" author="v.himanshu" created="Wed, 20 Nov 2013 19:13:15 +0000"  >&lt;p&gt;Any chance of a trunk version? Would be nice to see a hadoop qa run on it.&lt;/p&gt;</comment>
                            <comment id="13828003" author="yuzhihong@gmail.com" created="Wed, 20 Nov 2013 19:15:40 +0000"  >&lt;p&gt;Liang:&lt;br/&gt;
Can you post patch for trunk so that QA picks it up ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        HLogKey key = makeKey(DUMMY /* regionName */, DUMMY /* tableName */,
+            0, &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.currentTimeMillis(), HConstants.DEFAULT_CLUSTER_ID);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please use EnvironmentEdge#currentTimeMillis() above.&lt;/p&gt;</comment>
                            <comment id="13828606" author="xieliang007" created="Thu, 21 Nov 2013 08:46:43 +0000"  >&lt;p&gt;Attached 0.94-v2 addressed Ted&apos;s comment,  and it passed &quot;runAllTests&quot; on 0.94 branch on my box&lt;br/&gt;
It&apos;s a little terrible to make a trunk patch, to me, the hlog related code changed a lots from 0.94 to trunk e.g. wal compress, FSHLog, e.g.   I am afraid i need lots of time to fight with the new cases...&lt;/p&gt;</comment>
                            <comment id="13828648" author="xieliang007" created="Thu, 21 Nov 2013 09:50:22 +0000"  >&lt;p&gt;uploaded a patch against trunk. for simplicity, i didn&apos;t add the same ability for wal compression scenario right now.&lt;/p&gt;</comment>
                            <comment id="13828863" author="hadoopqa" created="Thu, 21 Nov 2013 11:59:52 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12615092/HBase-10010-trunk.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12615092/HBase-10010-trunk.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestAdmin&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7959//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13829437" author="yuzhihong@gmail.com" created="Thu, 21 Nov 2013 22:54:23 +0000"  >&lt;p&gt;What happens when WAL compression is enabled ?&lt;/p&gt;</comment>
                            <comment id="13829672" author="xieliang007" created="Fri, 22 Nov 2013 05:43:56 +0000"  >&lt;p&gt;Based on current patch, the behavior will be same as before, that means there will be a put latency spike for the first sync invoke.&lt;/p&gt;</comment>
                            <comment id="13829690" author="stack" created="Fri, 22 Nov 2013 06:13:38 +0000"  >&lt;p&gt;Patch looks good to me.  Add TODO for compressed writing case if you want and we can come back and do that later.  Suggest that &apos;Arrays.equals(key.getEncodedRegionName(), HLog.DUMMY_REGION)&apos; be put inside a static method in /HLogUtil.java since it is repeated in a few places.&lt;/p&gt;</comment>
                            <comment id="13829707" author="v.himanshu" created="Fri, 22 Nov 2013 06:38:27 +0000"  >&lt;p&gt;I have seen this latency in some experiments I did a while ago. &lt;br/&gt;
File creation (along with block allocation) is costly, takes about 300ms on average. And block allocation is done on first write. &lt;br/&gt;
I am good with this change in general (will take a look at the patch in detail tomorrow).&lt;/p&gt;</comment>
                            <comment id="13830062" author="v.himanshu" created="Fri, 22 Nov 2013 15:45:17 +0000"  >&lt;p&gt;I think post 0.94.x, we only need to sync the new writer outside of lock because we write a header on init(). No empty HLog entry.&lt;/p&gt;</comment>
                            <comment id="13831195" author="xieliang007" created="Mon, 25 Nov 2013 06:00:42 +0000"  >&lt;p&gt;Oh, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=himanshu%40cloudera.com&quot; class=&quot;user-hover&quot; rel=&quot;himanshu@cloudera.com&quot;&gt;Himanshu Vashishtha&lt;/a&gt;, very very thanks for pointing out this.&lt;br/&gt;
After a looking at deeper code, i think the key is SequenceFile Class under hadoop-common project, see (i extracted below code from cdh4.1.1 modified version)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /** Write and flush the file header. */
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void writeFileHeader() 
      &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
      out.write(VERSION);
      Text.writeString(out, keyClass.getName());
      Text.writeString(out, valClass.getName());
      
      out.writeBoolean(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isCompressed());
      out.writeBoolean(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isBlockCompressed());
      
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isCompressed()) {
        Text.writeString(out, (codec.getClass()).getName());
      }
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.metadata.write(out);
      out.write(sync);                       &lt;span class=&quot;code-comment&quot;&gt;// write the sync bytes
&lt;/span&gt;      out.flush();                           &lt;span class=&quot;code-comment&quot;&gt;// flush header
&lt;/span&gt;    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;yes, i agree with you now that we can just issue &quot;sync&quot; api, it should be enough, since i did a &quot;svn blame&quot; on SequenceFile.java, it shows this writeFileHeader() method was added long long time ago.&lt;/p&gt;

&lt;p&gt;I had uploaded the simplified patch against 0.94 branch and trunk, could you guys help to look again? thanks! &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=himanshu%40cloudera.com&quot; class=&quot;user-hover&quot; rel=&quot;himanshu@cloudera.com&quot;&gt;Himanshu Vashishtha&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13831205" author="lhofhansl" created="Mon, 25 Nov 2013 06:37:52 +0000"  >&lt;p&gt;Hmm... In 0.94 we sync (flush) outside of the update lock (see HLog.syncer(long txid)). Is this a different issue?&lt;/p&gt;</comment>
                            <comment id="13831209" author="xieliang007" created="Mon, 25 Nov 2013 06:48:09 +0000"  >&lt;p&gt;yes, it&apos;s absolutely a different issue. you can add some logging statement to record the first sync() invoke in syncer(long txid) with a flag variable, it&apos;s not difficult to observe the long latency, e.g. 20 or 30ms.&lt;/p&gt;</comment>
                            <comment id="13831222" author="hadoopqa" created="Mon, 25 Nov 2013 07:21:43 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12615537/HBase-10010-trunk-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12615537/HBase-10010-trunk-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.replication.regionserver.TestReplicationHLogReaderManager&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7981//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13831232" author="xieliang007" created="Mon, 25 Nov 2013 07:41:12 +0000"  >&lt;p&gt;the findbugs wanring and failed cases should not related with this jira&lt;/p&gt;</comment>
                            <comment id="13831324" author="hadoopqa" created="Mon, 25 Nov 2013 09:47:13 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12615553/HBase-10010-trunk-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12615553/HBase-10010-trunk-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 findbugs&lt;/font&gt;.  The patch appears to introduce 1 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/7982//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13831647" author="yuzhihong@gmail.com" created="Mon, 25 Nov 2013 17:25:41 +0000"  >&lt;p&gt;Looking at src/core/org/apache/hadoop/io/SequenceFile.java under branch-1, I don&apos;t see the flush call:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /** Write and flush the file header. */
    void writeFileHeader()
      &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
      Text.writeString(out, keyClass.getName());
      Text.writeString(out, valClass.getName());

      out.writeBoolean(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isCompressed());
      out.writeBoolean(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isBlockCompressed());

      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isCompressed()) {
        Text.writeString(out, (codec.getClass()).getName());
      }
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.metadata.write(out);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13832479" author="xieliang007" created="Tue, 26 Nov 2013 10:38:06 +0000"  >&lt;p&gt;so &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt; your idea is ?&lt;/p&gt;</comment>
                            <comment id="13841128" author="xieliang007" created="Fri, 6 Dec 2013 09:37:49 +0000"  >&lt;p&gt;seems no reponse from ted.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=himanshu%40cloudera.com&quot; class=&quot;user-hover&quot; rel=&quot;himanshu@cloudera.com&quot;&gt;Himanshu Vashishtha&lt;/a&gt;, what do you think of trunk-v2.txt patch ? IIRC, trunk now use hadoop2 by default, right?&lt;br/&gt;
Here is the code snippet from hadoop branch2:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    /** Write and flush the file header. */
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void writeFileHeader()
      &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
      out.write(VERSION);
      Text.writeString(out, keyClass.getName());
      Text.writeString(out, valClass.getName());

      out.writeBoolean(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isCompressed());
      out.writeBoolean(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isBlockCompressed());

      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.isCompressed()) {
        Text.writeString(out, (codec.getClass()).getName());
      }
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.metadata.write(out);
      out.write(sync);                       &lt;span class=&quot;code-comment&quot;&gt;// write the sync bytes
&lt;/span&gt;      out.flush();                           &lt;span class=&quot;code-comment&quot;&gt;// flush header
&lt;/span&gt;    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To me, i would like the trunk-v2&apos;s style againt v1&apos;s dummy record method&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  more cleaner and lower risk.&lt;/p&gt;</comment>
                            <comment id="13841507" author="v.himanshu" created="Fri, 6 Dec 2013 18:21:57 +0000"  >&lt;p&gt;Looked at trunk patch. FSHLog change is good. Why we need changes in TestReplicationHLogReaderManager.java?&lt;/p&gt;</comment>
                            <comment id="13841777" author="stack" created="Fri, 6 Dec 2013 22:06:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xieliang007&quot; class=&quot;user-hover&quot; rel=&quot;xieliang007&quot;&gt;Liang Xie&lt;/a&gt; What Himanshu said otherwise looks good to me.  If the test changes were mistakenly included, just say, and I&apos;ll exclude them from the commit.&lt;/p&gt;</comment>
                            <comment id="13842191" author="xieliang007" created="Sat, 7 Dec 2013 11:27:28 +0000"  >&lt;p&gt;It&apos;s not a mistake for test change. since after the sync, we could open an empty new file without failure, so we need remove the original assert statement.&lt;/p&gt;</comment>
                            <comment id="13842223" author="stack" created="Sat, 7 Dec 2013 14:07:39 +0000"  >&lt;p&gt;OK.  Thanks.  Will commit soon as trunk build restabilizes.&lt;/p&gt;</comment>
                            <comment id="13842317" author="v.himanshu" created="Sat, 7 Dec 2013 20:12:40 +0000"  >&lt;p&gt;Got it. +1.&lt;/p&gt;</comment>
                            <comment id="13842361" author="lhofhansl" created="Sun, 8 Dec 2013 00:49:02 +0000"  >&lt;p&gt;Seems that the new proposed change would have the exact same effect as the patch on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7216&quot; title=&quot;sync hlog writer just after create it, so trigger addBlock and establish write pipeline before the first hlog sync&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7216&quot;&gt;&lt;del&gt;HBASE-7216&lt;/del&gt;&lt;/a&gt;. The change on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7216&quot; title=&quot;sync hlog writer just after create it, so trigger addBlock and establish write pipeline before the first hlog sync&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7216&quot;&gt;&lt;del&gt;HBASE-7216&lt;/del&gt;&lt;/a&gt; seems cleaner.&lt;/p&gt;</comment>
                            <comment id="13842825" author="stack" created="Mon, 9 Dec 2013 00:43:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; This patch includes handling side-effect out in tests.  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7126&quot; title=&quot;Update website with info on how to report security bugs &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7126&quot;&gt;&lt;del&gt;HBASE-7126&lt;/del&gt;&lt;/a&gt; seems stale too... at least for trunk.  I resolved it for now as dup of this.  Let me know if you&apos;d like argue we invert.&lt;/p&gt;</comment>
                            <comment id="13842899" author="lhofhansl" created="Mon, 9 Dec 2013 04:21:12 +0000"  >&lt;p&gt;Was only looking at 0.94. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
Generally seems cleaner to handle SequenceFileLogWriter issues in SequenceFileLogWriter, rather than doing instanceof checks outside.&lt;br/&gt;
Either, this is a good fix for all branches.&lt;/p&gt;</comment>
                            <comment id="13842900" author="lhofhansl" created="Mon, 9 Dec 2013 04:22:27 +0000"  >&lt;p&gt;I suppose in trunk we&apos;d put that in ProtobufLogWriter. Would still argue that that would be a nicer fix (albeit functionally the same).&lt;/p&gt;</comment>
                            <comment id="13842910" author="stack" created="Mon, 9 Dec 2013 05:06:40 +0000"  >&lt;p&gt;Committed to all branches.&lt;/p&gt;</comment>
                            <comment id="13843013" author="hudson" created="Mon, 9 Dec 2013 09:40:52 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98 #5 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/5/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/5/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10010&quot; title=&quot;eliminate the put latency spike on the new log file beginning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10010&quot;&gt;&lt;del&gt;HBASE-10010&lt;/del&gt;&lt;/a&gt; eliminate the put latency spike on the new log file beginning (stack: rev 1549383)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationHLogReaderManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13843037" author="hudson" created="Mon, 9 Dec 2013 10:11:43 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #4 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/4/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/4/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10010&quot; title=&quot;eliminate the put latency spike on the new log file beginning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10010&quot;&gt;&lt;del&gt;HBASE-10010&lt;/del&gt;&lt;/a&gt; eliminate the put latency spike on the new log file beginning (stack: rev 1549383)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationHLogReaderManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13843050" author="hudson" created="Mon, 9 Dec 2013 10:35:52 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94-security #355 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/355/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/355/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10010&quot; title=&quot;eliminate the put latency spike on the new log file beginning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10010&quot;&gt;&lt;del&gt;HBASE-10010&lt;/del&gt;&lt;/a&gt; eliminate the put latency spike on the new log file beginning (stack: rev 1549385)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13843075" author="hudson" created="Mon, 9 Dec 2013 11:26:59 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #4717 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4717/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4717/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10010&quot; title=&quot;eliminate the put latency spike on the new log file beginning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10010&quot;&gt;&lt;del&gt;HBASE-10010&lt;/del&gt;&lt;/a&gt; eliminate the put latency spike on the new log file beginning (stack: rev 1549384)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationHLogReaderManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13843076" author="hudson" created="Mon, 9 Dec 2013 11:28:31 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94 #1221 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1221/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1221/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10010&quot; title=&quot;eliminate the put latency spike on the new log file beginning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10010&quot;&gt;&lt;del&gt;HBASE-10010&lt;/del&gt;&lt;/a&gt; eliminate the put latency spike on the new log file beginning (stack: rev 1549385)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13843128" author="hudson" created="Mon, 9 Dec 2013 13:00:46 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.96 #219 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/219/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/219/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10010&quot; title=&quot;eliminate the put latency spike on the new log file beginning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10010&quot;&gt;&lt;del&gt;HBASE-10010&lt;/del&gt;&lt;/a&gt; eliminate the put latency spike on the new log file beginning (stack: rev 1549382)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationHLogReaderManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13843346" author="hudson" created="Mon, 9 Dec 2013 17:43:16 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.98-hadoop2 #3 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.98-hadoop2/3/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.98-hadoop2/3/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10010&quot; title=&quot;eliminate the put latency spike on the new log file beginning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10010&quot;&gt;&lt;del&gt;HBASE-10010&lt;/del&gt;&lt;/a&gt; eliminate the put latency spike on the new log file beginning (stack: rev 1549383)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationHLogReaderManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13843366" author="hudson" created="Mon, 9 Dec 2013 18:07:53 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96-hadoop2 #145 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96-hadoop2/145/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96-hadoop2/145/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10010&quot; title=&quot;eliminate the put latency spike on the new log file beginning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10010&quot;&gt;&lt;del&gt;HBASE-10010&lt;/del&gt;&lt;/a&gt; eliminate the put latency spike on the new log file beginning (stack: rev 1549382)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationHLogReaderManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13844140" author="hudson" created="Tue, 10 Dec 2013 09:42:02 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK-on-Hadoop-1.1 #3 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-1.1/3/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-1.1/3/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10010&quot; title=&quot;eliminate the put latency spike on the new log file beginning&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10010&quot;&gt;&lt;del&gt;HBASE-10010&lt;/del&gt;&lt;/a&gt; eliminate the put latency spike on the new log file beginning (stack: rev 1549384)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/FSHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationHLogReaderManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13849569" author="stack" created="Mon, 16 Dec 2013 18:47:00 +0000"  >&lt;p&gt;Released in 0.96.1.  Issue closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12617562">HBASE-7216</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12615084" name="HBase-10010-0.94-v2.txt" size="9336" author="xieliang007" created="Thu, 21 Nov 2013 08:46:43 +0000"/>
                            <attachment id="12615536" name="HBase-10010-0.94-v3.txt" size="841" author="xieliang007" created="Mon, 25 Nov 2013 05:49:07 +0000"/>
                            <attachment id="12614810" name="HBase-10010-0.94.txt" size="8965" author="xieliang007" created="Wed, 20 Nov 2013 08:40:22 +0000"/>
                            <attachment id="12615553" name="HBase-10010-trunk-v2.txt" size="2096" author="xieliang007" created="Mon, 25 Nov 2013 08:05:42 +0000"/>
                            <attachment id="12615092" name="HBase-10010-trunk.txt" size="9206" author="xieliang007" created="Thu, 21 Nov 2013 09:50:22 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 20 Nov 2013 14:36:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359488</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1pz0f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>359787</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Forward port of a 0.89fb patch where we issue sync on WAL file construction to force immediate setup of write pipeline (and do it outside of locks so don&amp;#39;t hold up writes during setup).</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>