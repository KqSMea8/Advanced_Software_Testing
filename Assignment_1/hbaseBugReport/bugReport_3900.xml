<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:14:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3900/HBASE-3900.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3900] Expose progress of a major compaction in UI and/or in shell</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3900</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;A general recommendation is to turn off major compactions and run them externally only currently the only way to follow progress of a major compaction is by study of regionserver logs.  Add a feature that gives a percentage complete of major compaction up in the UI or in shell.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12507766">HBASE-3900</key>
            <summary>Expose progress of a major compaction in UI and/or in shell</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="boorad">Brad Anderson</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                            <label>patch</label>
                    </labels>
                <created>Thu, 19 May 2011 15:00:55 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:39 +0000</updated>
                            <resolved>Sat, 27 Aug 2011 04:27:54 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13064270" author="boorad" created="Wed, 13 Jul 2011 01:09:14 +0000"  >&lt;p&gt;I&apos;ve done a bit of work on this here: &lt;a href=&quot;https://github.com/boorad/hbase/commit/51cdcb14680275a74a949a79b5f9b27c844be11c&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/boorad/hbase/commit/51cdcb14680275a74a949a79b5f9b27c844be11c&lt;/a&gt;  It&apos;s my first patch for hbase, so feedback is welcome.&lt;/p&gt;

&lt;p&gt;Talking with stack in irc, and he expressed a desire to see the compaction queue (ordered) with an identifier &amp;amp; whether or not it is a major compaction.  I left this out of the above patch, as I am planning on reworking the existing web ui to be a bit friendlier to devs and ops folks.&lt;/p&gt;</comment>
                            <comment id="13072197" author="stack" created="Thu, 28 Jul 2011 06:15:10 +0000"  >&lt;p&gt;I added comments over on github repeated here:&lt;/p&gt;

&lt;p&gt;@brad Patch looks great. Missing license on CompactionProgress (I can add this on commit). Will we overflow the ints used keeping counts of KVs? Should this class and its methods be public since its only used in this package? Good stuff.&lt;/p&gt;</comment>
                            <comment id="13072463" author="boorad" created="Thu, 28 Jul 2011 18:21:17 +0000"  >&lt;p&gt;Updates from conversation at github:&lt;/p&gt;

&lt;p&gt;1.  Missing license on CompactionProgress was done in subsequent commits&lt;/p&gt;

&lt;p&gt;2.  Overflow of ints was addressed, changed to longs, tests pass&lt;/p&gt;

&lt;p&gt;3.  To be visible to regionserver package, the regionserver.compactions package class I&apos;ve added needs to be public&lt;/p&gt;

&lt;p&gt;4.  Do the counters ever get reset? - yes, because Store.compactStore/4 gets a new CompactionProgress instance.&lt;/p&gt;

&lt;p&gt;Patch is attached, and last svn commit was trunk@1145459&lt;/p&gt;</comment>
                            <comment id="13072467" author="boorad" created="Thu, 28 Jul 2011 18:24:00 +0000"  >&lt;p&gt;here&apos;s the proper file.&lt;/p&gt;</comment>
                            <comment id="13092192" author="stack" created="Sat, 27 Aug 2011 04:27:54 +0000"  >&lt;p&gt;Nice feature.  Thank you Brad (Sorry it took a while to add &amp;#8211; I added you as contributor and assigned you this issue).  Committed to TRUNK.&lt;/p&gt;</comment>
                            <comment id="13092218" author="hudson" created="Sat, 27 Aug 2011 07:58:22 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2151 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2151/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2151/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3900&quot; title=&quot;Expose progress of a major compaction in UI and/or in shell&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3900&quot;&gt;&lt;del&gt;HBASE-3900&lt;/del&gt;&lt;/a&gt; Expose progress of a major compaction in UI and/or in shell&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3900&quot; title=&quot;Expose progress of a major compaction in UI and/or in shell&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3900&quot;&gt;&lt;del&gt;HBASE-3900&lt;/del&gt;&lt;/a&gt; Expose progress of a major compaction in UI and/or in shell&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionProgress.java&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HServerLoad.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionRequest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompaction.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13092289" author="hudson" created="Sat, 27 Aug 2011 13:10:00 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2152 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2152/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2152/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3900&quot; title=&quot;Expose progress of a major compaction in UI and/or in shell&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3900&quot;&gt;&lt;del&gt;HBASE-3900&lt;/del&gt;&lt;/a&gt; Addendum, correct FIXED_OVERHEAD&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13092290" author="yuzhihong@gmail.com" created="Sat, 27 Aug 2011 13:26:35 +0000"  >&lt;p&gt;In build 2152, the following test failure is related to this JIRA (&lt;a href=&quot;https://builds.apache.org/view/G-L/view/HBase/job/HBase-TRUNK/lastCompletedBuild/testReport/org.apache.hadoop.hbase.master/TestMasterFailover/testMasterFailoverWithMockedRITOnDeadRS/):&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/view/G-L/view/HBase/job/HBase-TRUNK/lastCompletedBuild/testReport/org.apache.hadoop.hbase.master/TestMasterFailover/testMasterFailoverWithMockedRITOnDeadRS/):&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
java.io.IOException: Error in readFields
	at org.apache.hadoop.hbase.io.HbaseObjectWritable.readObject(HbaseObjectWritable.java:584)
	at org.apache.hadoop.hbase.ipc.Invocation.readFields(Invocation.java:64)
	at org.apache.hadoop.hbase.ipc.HBaseServer$Connection.processData(HBaseServer.java:1152)
	at org.apache.hadoop.hbase.ipc.HBaseServer$Connection.readAndProcess(HBaseServer.java:1112)
	at org.apache.hadoop.hbase.ipc.HBaseServer$Listener.doRead(HBaseServer.java:669)
	at org.apache.hadoop.hbase.ipc.HBaseServer$Listener$Reader.run(HBaseServer.java:463)
	at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
Caused by: A record version mismatch occured. Expecting v1, found v0
	at org.apache.hadoop.io.VersionedWritable.readFields(VersionedWritable.java:46)
	at org.apache.hadoop.hbase.HServerLoad$RegionLoad.readFields(HServerLoad.java:316)
	at org.apache.hadoop.hbase.HServerLoad.readFields(HServerLoad.java:606)
	at org.apache.hadoop.hbase.io.HbaseObjectWritable.readObject(HbaseObjectWritable.java:581)
	... 8 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13092294" author="yuzhihong@gmail.com" created="Sat, 27 Aug 2011 13:33:08 +0000"  >&lt;p&gt;Here is addendum I committed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/main/java/org/apache/hadoop/hbase/regionserver/Store.java
===================================================================
--- src/main/java/org/apache/hadoop/hbase/regionserver/Store.java       (revision 1162317)
+++ src/main/java/org/apache/hadoop/hbase/regionserver/Store.java       (working copy)
@@ -1765,7 +1765,7 @@
   }
 
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; FIXED_OVERHEAD = ClassSize.align(
-      ClassSize.OBJECT + (15 * ClassSize.REFERENCE) +
+      ClassSize.OBJECT + (16 * ClassSize.REFERENCE) +
       (8 * Bytes.SIZEOF_LONG) + (1 * Bytes.SIZEOF_DOUBLE) +
       (6 * Bytes.SIZEOF_INT) + (3 * Bytes.SIZEOF_BOOLEAN));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13092403" author="yuzhihong@gmail.com" created="Sun, 28 Aug 2011 01:04:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;2. Overflow of ints was addressed, changed to longs, tests pass&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Maybe due to the above change, I see inconsistent handling of the new fields. In readFields():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.totalCompactingKVs = in.readInt();
      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.currentCompactedKVs = in.readInt();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In write(),&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      out.writeLong(totalCompactingKVs);
      out.writeLong(currentCompactedKVs);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13092407" author="yuzhihong@gmail.com" created="Sun, 28 Aug 2011 01:29:25 +0000"  >&lt;p&gt;Here is attempt at fixing readFields&lt;/p&gt;</comment>
                            <comment id="13092423" author="stack" created="Sun, 28 Aug 2011 04:43:38 +0000"  >&lt;p&gt;+1 on patch Ted.&lt;/p&gt;</comment>
                            <comment id="13092424" author="hudson" created="Sun, 28 Aug 2011 04:46:31 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2154 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2154/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2154/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3900&quot; title=&quot;Expose progress of a major compaction in UI and/or in shell&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3900&quot;&gt;&lt;del&gt;HBASE-3900&lt;/del&gt;&lt;/a&gt; Addendum 2: try to fix error in readFields()&lt;/p&gt;

&lt;p&gt;tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/HServerLoad.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13092431" author="yuzhihong@gmail.com" created="Sun, 28 Aug 2011 06:58:09 +0000"  >&lt;p&gt;In build 2154, I didn&apos;t see exception related to HServerLoad deserialization.&lt;br/&gt;
The TestMergeTool.testMergeTool failure was due to the following check:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      HBaseAdmin.checkHBaseAvailable(getConf());
      LOG.fatal(&lt;span class=&quot;code-quote&quot;&gt;&quot;HBase cluster must be off-line.&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;HBase cluster from some other test(s) was hanging.&lt;/p&gt;</comment>
                            <comment id="15017581" author="lars_francke" created="Fri, 20 Nov 2015 12:43:39 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12491982" name="3900.addendum2" size="1349" author="yuzhihong@gmail.com" created="Sun, 28 Aug 2011 01:29:25 +0000"/>
                            <attachment id="12488122" name="HBASE-3900.patch" size="22319" author="boorad" created="Thu, 28 Jul 2011 18:24:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 13 Jul 2011 01:09:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33259</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hofb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101219</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Expose counts of KVs compacted to UI.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                            <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>compaction, ui</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>