<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:58:19 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2021/HBASE-2021.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2021] Add compaction details to master UI</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2021</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There are two issues with this, first to detect that there is a compaction needed. You can currently use the little helper util that checks if a table has at least one colfam with more than one store file. I though about scanning all tables and all colfams in each and then compute the &quot;fragmentation&quot; ratio as a percentage of colfams with more than one store to the total number of colfams. That gives a &quot;Table xyz is 33% fragmented&quot; output. While minor percentage are normal under insert operations it is still important to know how bad the fragmentation is overall.&lt;/p&gt;

&lt;p&gt;Another idea is to weigh the number of files per store too, so that if you have two per colfam it is considered &quot;low&quot; and if you have more, for example 6-8 it is considered &quot;high&quot;. Not sure how that can be done yet but noting the idea down here.&lt;/p&gt;

&lt;p&gt;Of course seeing the .META. fragmentation is useful to quickly debug performance issues (as JD told me on IRC).&lt;/p&gt;

&lt;p&gt;The other issue is that when you have started a compaction you have no idea how far it is and if it is still in progress. One indication of course is the above value. If it is 0% then all is done. But if you are at say 23%, is it still compacting? We could have a simple status that compactions are still in progress.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12442123">HBASE-2021</key>
            <summary>Add compaction details to master UI</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="larsgeorge">Lars George</assignee>
                                    <reporter username="larsgeorge">Lars George</reporter>
                        <labels>
                    </labels>
                <created>Tue, 1 Dec 2009 18:19:16 +0000</created>
                <updated>Fri, 12 Oct 2012 06:14:14 +0000</updated>
                            <resolved>Tue, 5 Jan 2010 06:01:14 +0000</resolved>
                                                    <fixVersion>0.20.3</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12784320" author="jdcryans" created="Tue, 1 Dec 2009 18:25:49 +0000"  >&lt;p&gt;I like the idea of the percentage, then when we would ask for a major compaction we would see that number going down?&lt;/p&gt;</comment>
                            <comment id="12784323" author="larsgeorge" created="Tue, 1 Dec 2009 18:29:42 +0000"  >&lt;p&gt;Exactly, I would build in a performance gauge to reload the /hbase to compute the fragmentation to run only every x seconds (I would default it to 60) so that a UI reload is quick. This also depends where this goes, into the master.jsp or table.jsp. &lt;/p&gt;</comment>
                            <comment id="12785385" author="larsgeorge" created="Thu, 3 Dec 2009 16:33:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2021&quot; title=&quot;Add compaction details to master UI&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2021&quot;&gt;&lt;del&gt;HBASE-2021&lt;/del&gt;&lt;/a&gt;.patch adds&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;compaction queue size to region server metrics, can be seen on regionserver.jsp&lt;/li&gt;
&lt;/ul&gt;


&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Metrics &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; request=0.0, regions=3, stores=6, storefiles=3, storefileIndexSize=0, memstoreSize=0, compactionQueueSize=0, usedHeap=35, maxHeap=994, blockCacheSize=1713760, blockCacheFree=206913552, blockCacheCount=1, blockCacheHitRatio=95 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; RegionServer Metrics; file and heap sizes are in megabytes &lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;The &quot;compactionQueueSize&quot; reflects the number of regions this regionserver has in the queue to be processed and allows to &quot;determine&quot; if compactions are in progress from the UI. &lt;/p&gt;

&lt;p&gt;I would have preferred to have a global indicator in the master UI but that value cannot be bubbled up unless I for example add it to HServerInfo - which I have been told is not a good idea to change. Right?&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added fragmentation details to UI&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Added a total fragmentation precentage to master.jsp in top table, for example:&lt;/p&gt;

&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Regions On FS &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 3 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Number of regions on FileSystem. Rough count. &lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Fragmentation &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; 17% &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Overall fragmentation of all tables, including .META. and &lt;del&gt;ROOT&lt;/del&gt;.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;Zookeeper Quorum &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; localhost:2181 &lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt; Addresses of all registered ZK servers. For more, see zk dump.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;Then in the tables below for .META., &lt;del&gt;ROOT&lt;/del&gt; and user table I added it as a column with an abbreviated title but added a pop-up explanation when you hover over it.&lt;/p&gt;
</comment>
                            <comment id="12785445" author="jdcryans" created="Thu, 3 Dec 2009 18:52:04 +0000"  >&lt;p&gt;That functionality looks very good to me, did you try it on a cluster with tons of regions?&lt;/p&gt;</comment>
                            <comment id="12785459" author="larsgeorge" created="Thu, 3 Dec 2009 19:17:11 +0000"  >&lt;p&gt;Not yet (have no cluster yet to test this on) but will asap. Also, please note that this is cached and reloads every 2 minutes only. So the slowest will be the filesystem scan which is meta data. Just when the DFS and master is heavily taxed I could see slower response times (every 2 minutes). &lt;/p&gt;</comment>
                            <comment id="12791316" author="apurtell" created="Wed, 16 Dec 2009 11:04:55 +0000"  >&lt;p&gt;Actually I would encourage you to consider adding information about regions being compacted to HServerInfo. For 0.21 we can change RPC formats and bump the versions. I would like to be able to see a list of regions pending compaction (or currently being compacted) when I type status &apos;detailed&apos; in the shell.&lt;/p&gt;</comment>
                            <comment id="12791656" author="larsgeorge" created="Wed, 16 Dec 2009 23:01:17 +0000"  >&lt;p&gt;I am sure all for it. Should we have an additional patch that adds the HServerInfo stuff on top of the above patch so we can apply the minor change to 0.20.3 and the additional RPC changes to 0.21.0?&lt;/p&gt;</comment>
                            <comment id="12791663" author="apurtell" created="Wed, 16 Dec 2009 23:06:07 +0000"  >&lt;blockquote&gt;&lt;p&gt;Should we have an additional patch that adds the HServerInfo stuff on top of the above patch so we can apply the minor change to 0.20.3 and the additional RPC changes to 0.21.0?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12792893" author="larsgeorge" created="Sat, 19 Dec 2009 20:19:02 +0000"  >&lt;p&gt;Would you agree to put this into HServerLoad? Seems a natural fit to add it there. &lt;/p&gt;</comment>
                            <comment id="12793028" author="apurtell" created="Sun, 20 Dec 2009 19:51:30 +0000"  >&lt;blockquote&gt;&lt;p&gt;Would you agree to put this into HServerLoad? Seems a natural fit to add it there. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="12793031" author="apurtell" created="Sun, 20 Dec 2009 19:55:58 +0000"  >&lt;p&gt;The attached patch is corrupt. Cancelling patch. Resubmit when ready.&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;[...]
patching file src/webapps/master/master.jsp
Hunk #1 FAILED at 3.
1 out of 1 hunk FAILED -- saving rejects to file src/webapps/master/master.jsp.rej
missing header for unified diff at line 263 of patch
can&apos;t find file to patch at input line 263
Perhaps you used the wrong -p or --strip option?
The text leading up to this was:
--------------------------
|
|   import=&quot;org.apache.hadoop.hbase.master.HMaster&quot;
|
|   import=&quot;org.apache.hadoop.hbase.HConstants&quot;
|
|   import=&quot;org.apache.hadoop.hbase.master.MetaRegion&quot;
|
--------------------------
[...]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12793035" author="larsgeorge" created="Sun, 20 Dec 2009 20:25:14 +0000"  >&lt;p&gt;Bugger! Patch was made on trunk. Did you try 0.20 branch or trunk? Will redo a clean 0.20 branch based patch and then a combined patch for trunk with the HServerLoad additions.&lt;/p&gt;</comment>
                            <comment id="12795588" author="larsgeorge" created="Thu, 31 Dec 2009 11:38:17 +0000"  >&lt;p&gt;Patch for 0.20 branch.&lt;/p&gt;</comment>
                            <comment id="12795595" author="larsgeorge" created="Thu, 31 Dec 2009 12:52:27 +0000"  >&lt;p&gt;2021-0.20-v2 patch is done again after the previous 0.20 patch failed on the master.jsp again.&lt;/p&gt;</comment>
                            <comment id="12795596" author="larsgeorge" created="Thu, 31 Dec 2009 12:55:16 +0000"  >&lt;p&gt;Added 0.20.3 again in an attempt to get that metric also included. Punt if you do not like it. Will add a new patch for 0.21 based on the above discussion, so we leave this issue open once the 0.20 patch is applied by moving it then to 0.21 only? &lt;/p&gt;</comment>
                            <comment id="12796053" author="stack" created="Mon, 4 Jan 2010 00:34:17 +0000"  >&lt;p&gt;Patch looks great Lars.   It applies cleanly and all builds.  I like that you only check FS every two minutes (Doing it on every metrics interval would be too much methinks).  I&apos;ll commit this tomorrow, but if you have a second between here and then, perhaps change the two minutes to be a configuration... it doesn&apos;t have to have an entry in hbase-default.xml.. just be something someone could discover configurable if they took the trouble to read the source.  Good stuff.&lt;/p&gt;</comment>
                            <comment id="12796135" author="larsgeorge" created="Mon, 4 Jan 2010 10:41:02 +0000"  >&lt;p&gt;Good idea with the hidden config! Didn&apos;t think of that. Will add today.&lt;/p&gt;</comment>
                            <comment id="12796169" author="larsgeorge" created="Mon, 4 Jan 2010 12:40:53 +0000"  >&lt;p&gt;BTW, the idea is that if this too much of a tool on the UI to simply move this into a thread and update every X msecs as per the config. That also would have the advantage of a delayed start where the UI loads as usual and shows &quot;n/a&quot; in the fragmentation spots and when the thread completes the first time it would show those values on a UI reload and from then on each set of last determined values. &lt;/p&gt;</comment>
                            <comment id="12796171" author="larsgeorge" created="Mon, 4 Jan 2010 12:43:49 +0000"  >&lt;p&gt;Patch v3 adds &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// only check every two minutes by &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
&lt;/span&gt;    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; check = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf.getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.master.fragmentation.check.frequency&quot;&lt;/span&gt;, 2 * 60 * 1000);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;so it can be configured if so desired.&lt;/p&gt;</comment>
                            <comment id="12796540" author="stack" created="Tue, 5 Jan 2010 06:01:14 +0000"  >&lt;p&gt;Applied branch and trunk.  Thanks for the patch Lars.&lt;/p&gt;</comment>
                            <comment id="12796541" author="stack" created="Tue, 5 Jan 2010 06:02:47 +0000"  >&lt;p&gt;... though I wonder if we don&apos;t need better explaination of what fragmentation means and how its addressed?&lt;/p&gt;</comment>
                            <comment id="12796693" author="larsgeorge" created="Tue, 5 Jan 2010 15:13:58 +0000"  >&lt;p&gt;I added those &quot;title&quot; attributes to the headers with some &quot;soothing&quot; explanation. Do you think that is not good enough?&lt;/p&gt;</comment>
                            <comment id="12797268" author="stack" created="Wed, 6 Jan 2010 19:39:48 +0000"  >&lt;p&gt;The UI just says &quot;fragmentation&quot;.  It doesn&apos;t explain what it means.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12429210" name="HBASE-2021-0.20-v2.patch" size="14053" author="larsgeorge" created="Thu, 31 Dec 2009 12:52:27 +0000"/>
                            <attachment id="12429336" name="HBASE-2021-0.20-v3.patch" size="14095" author="larsgeorge" created="Mon, 4 Jan 2010 12:43:49 +0000"/>
                            <attachment id="12429208" name="HBASE-2021-0.20.patch" size="14288" author="larsgeorge" created="Thu, 31 Dec 2009 11:38:17 +0000"/>
                            <attachment id="12426789" name="HBASE-2021.patch" size="14444" author="larsgeorge" created="Thu, 3 Dec 2009 16:33:02 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 1 Dec 2009 18:25:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32373</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 50 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08te7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49362</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>