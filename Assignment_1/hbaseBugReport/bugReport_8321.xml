<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:54:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8321/HBASE-8321.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8321] Log split worker should heartbeat to avoid timeout when the hlog is under recovery</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8321</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently, hlog splitter could spend quite sometime to split a log in case any HDFS issue and recoverLease/retry opening is needed.  If distributed log split manager times out the log worker, other log worker to take over will run into the same issue.&lt;/p&gt;

&lt;p&gt;Ideally, we should not need a timeout monitor.  Since we have a timeout monitor for DSL now, the worker should heartbeat to avoid wrong/unneeded timeouts.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12641922">HBASE-8321</key>
            <summary>Log split worker should heartbeat to avoid timeout when the hlog is under recovery</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jxiang">Jimmy Xiang</assignee>
                                    <reporter username="jxiang">Jimmy Xiang</reporter>
                        <labels>
                    </labels>
                <created>Wed, 10 Apr 2013 21:14:16 +0000</created>
                <updated>Mon, 23 Sep 2013 19:08:18 +0000</updated>
                            <resolved>Wed, 17 Apr 2013 15:57:24 +0000</resolved>
                                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.95.1</fixVersion>
                                    <component>wal</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>9</watches>
                                                                <comments>
                            <comment id="13628262" author="yuzhihong@gmail.com" created="Wed, 10 Apr 2013 21:18:42 +0000"  >&lt;p&gt;What is DSL ?&lt;/p&gt;</comment>
                            <comment id="13628266" author="jxiang" created="Wed, 10 Apr 2013 21:20:12 +0000"  >&lt;p&gt;Should be DLS, distributed log splitting.&lt;/p&gt;</comment>
                            <comment id="13628287" author="jeffreyz" created="Wed, 10 Apr 2013 21:36:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; I think we have heartbeat mechanism inside splitlogworker which is implemented by HLogSplitter#reportProgressIfIsDistributedLogSplitting. You can check the code inside SplitLogWorker#grabTask to see how the detailed heartbeat implementation.&lt;/p&gt;

&lt;p&gt;In addition, we had a fixed JIRA &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6738&quot; title=&quot;Too aggressive task resubmission from the distributed log manager&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6738&quot;&gt;&lt;del&gt;HBASE-6738&lt;/del&gt;&lt;/a&gt; which deal with the too short &quot;25&quot; secs wait by splitLogManager and in 0.94 we increased the default to 5 mins.     &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
status = splitTaskExecutor.exec(ZKSplitLog.getFileName(currentTask),
          &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CancelableProgressable() {

        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; progress() {
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!attemptToOwnTask(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)) {
            LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to heartbeat the task&quot;&lt;/span&gt; + currentTask);
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
          }
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;;
        }
      });
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

</comment>
                            <comment id="13628329" author="jxiang" created="Wed, 10 Apr 2013 22:01:09 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;, you are right: it is kind of heartbeat, but not exactly. It is not called during recoverLease/getReader, which could take up to 15/5 minutes. &lt;/p&gt;

&lt;p&gt;The issue is that the current status reporting is not time based. Some call can be quick sometimes, but take quite some time sometimes. But the timeout in log splitting manager is pure time based.&lt;/p&gt;</comment>
                            <comment id="13628338" author="nkeywal" created="Wed, 10 Apr 2013 22:07:23 +0000"  >&lt;p&gt;When it takes time, what are the options available? I mean, if we stop the recovery, the region will just be unavailable.?&lt;br/&gt;
The regionserver is already controlled by a heartbeat, so if the process dies we will know.&lt;/p&gt;</comment>
                            <comment id="13628359" author="jeffreyz" created="Wed, 10 Apr 2013 22:21:13 +0000"  >&lt;p&gt;The recoverLease/getReader underlying are single hdfs function calls. It&apos;s hard to heart beat inside them. Last week I talked about this with hdfs folks. It seems that recoverLease is NN operation so it take about 1 mins in most bad situations(rpc/socket time out) and getReader is about same if we directly go to a bad data node(still the rpc/socket timeout value). Two mins in most case should be good enough. &lt;/p&gt;

&lt;p&gt;In addition, hdfs has 30(default) secs timeout to mark a bad data node stale, therefore other workers(preempted the timeout task) has a good chance to spend much shorter time to proceed.&lt;/p&gt;

&lt;p&gt;IMHO, since we have hbase-6738, we can change the default value even longer like 15 mins(I set it to 5mins in 0.94) to cover normal cases. For extreme situations, people can adjust the config setting accordingly.&lt;/p&gt;</comment>
                            <comment id="13628363" author="jxiang" created="Wed, 10 Apr 2013 22:25:06 +0000"  >&lt;blockquote&gt;&lt;p&gt;The regionserver is already controlled by a heartbeat, so if the process dies we will know.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s a good point. That&apos;s why I considered to remove the timeout thing in the log split manager. However, it is not so intrusive to make the status reporting time-based.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;if we stop the recovery, the region will just be unavailable.?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;If a hlog can&apos;t be split, the region will be unavailable.  Sometimes, the cluster can&apos;t even start if the whole cluster is restarted and the master can&apos;t complete the log splitting.&lt;/p&gt;</comment>
                            <comment id="13629903" author="nkeywal" created="Fri, 12 Apr 2013 07:56:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;That&apos;s why I considered to remove the timeout thing in the log split manager.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I would +1 this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13631926" author="nkeywal" created="Mon, 15 Apr 2013 17:51:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; You don&apos;t want to remove the timeout as you proposed initially? That would help to delete a bunch of code actually.&lt;/p&gt;</comment>
                            <comment id="13631932" author="jxiang" created="Mon, 15 Apr 2013 17:56:29 +0000"  >&lt;p&gt;We can do that later. For now, I&apos;d like to make sure the heartbeat is done properly. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13631948" author="nkeywal" created="Mon, 15 Apr 2013 18:05:45 +0000"  >&lt;p&gt;For 0.95, we could remote it no? I can do that if you don&apos;t have the time but you&apos;re ok with the idea.&lt;/p&gt;</comment>
                            <comment id="13631959" author="jxiang" created="Mon, 15 Apr 2013 18:12:10 +0000"  >&lt;p&gt;Sure, go ahead. I am ok with the idea. However I&apos;d like the heartbeat is fixed at first since it is relatively simpler and safer. Removing the timeout thing may take some time to bake.&lt;/p&gt;</comment>
                            <comment id="13631980" author="jeffreyz" created="Mon, 15 Apr 2013 18:25:43 +0000"  >&lt;p&gt;The semantics of the existing heartbeat is progress heart beat, if we got a slow worker we can re-assigne the work to others. It also guards the scenario when a splitlogworker dies. After the patch, it seems to me we lose both functionalities. Even when splitworker dies, do still we get heart beats from the chore?&lt;/p&gt;

&lt;p&gt;Thanks,&lt;br/&gt;
-Jeffrey&lt;/p&gt;</comment>
                            <comment id="13631992" author="hadoopqa" created="Mon, 15 Apr 2013 18:34:26 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12578752/trunk-8321_v1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12578752/trunk-8321_v1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5313//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13632019" author="jxiang" created="Mon, 15 Apr 2013 18:49:36 +0000"  >&lt;p&gt;The heartbeat stops if the worker doesn&apos;t hold the task any more, or the task is completed.  So, of course, you won&apos;t get the heart beats if the worker is dead.&lt;/p&gt;

&lt;p&gt;As to re-assign to a different worker in case one is really slow, yes, this patch doesn&apos;t support it any more.  The idea is that it doesn&apos;t help to give the task to others if the file is under recovery, and it indeed takes time.&lt;/p&gt;</comment>
                            <comment id="13632142" author="jxiang" created="Mon, 15 Apr 2013 20:33:53 +0000"  >&lt;p&gt;Let me fix it in a different way.&lt;/p&gt;</comment>
                            <comment id="13632349" author="jxiang" created="Mon, 15 Apr 2013 23:19:33 +0000"  >&lt;p&gt;Attached patch v2 which addressed Jeffery&apos;s concern. This patch did some simple code moving-around, fixed the heartbeat issue in case hlog needs some time to recover.  It also fixed couple other issues: 1) status doesn&apos;t mark completed in case getReader() throws an exception; 2) in case recoverLease/getReader is interrupted, the file is marked corrupted and discarded which may cause data loss.&lt;/p&gt;</comment>
                            <comment id="13632418" author="hadoopqa" created="Tue, 16 Apr 2013 00:22:39 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12578835/trunk-8321_v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12578835/trunk-8321_v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/5321//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13633027" author="jxiang" created="Tue, 16 Apr 2013 17:19:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;, any comment on the second patch?&lt;/p&gt;</comment>
                            <comment id="13633070" author="jeffreyz" created="Tue, 16 Apr 2013 17:43:32 +0000"  >&lt;p&gt;The second patch looks good to me(+1) with one small comment:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    report_period = conf.getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.splitlog.report.period&quot;&lt;/span&gt;,
+      conf.getInt(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.splitlog.manager.timeout&quot;&lt;/span&gt;,
+        SplitLogManager.DEFAULT_TIMEOUT) / 2);

....

         &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; progress() {
-          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!attemptToOwnTask(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)) {
-            LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to heartbeat the task&quot;&lt;/span&gt; + currentTask);
-            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+          &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; t = EnvironmentEdgeManager.currentTimeMillis();
+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((t - last_report_at) &amp;gt; report_period) {
+            last_report_at = t;
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!attemptToOwnTask(&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;)) {
+              LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed to heartbeat the task&quot;&lt;/span&gt; + currentTask);
+              &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+            }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the latest patch, we heartbeat only after a report_period which by default is SplitLogManager.TIMEOUT/ 2. If splitLogWorker miss one(e.g. it tries to report right before a report_period) and next report take a little longer than one report_period then the work will be preempted by SplitLogManager. Therefore, I&apos;d suggest we change report_period default value to SplitLogManager.TIMEOUT/5 or something you think is more appropriate.&lt;/p&gt;</comment>
                            <comment id="13633132" author="jxiang" created="Tue, 16 Apr 2013 18:26:02 +0000"  >&lt;p&gt;Yes, that&apos;s also my concern. I reduced the period by 1 sec in the first patch. We can&apos;t make it too short. Otherwise, there may be too many ZK actions. How about SplitLogManager.TIMEOUT/2.5 or 3?&lt;/p&gt;</comment>
                            <comment id="13633145" author="jeffreyz" created="Tue, 16 Apr 2013 18:33:43 +0000"  >&lt;p&gt;Current SplitLogManager.DEFAULT_TIMEOUT = 2mins in trunk(5 mins in 0.94). So SplitLogManager.DEFAULT_TIMEOUT/5 = 40secs isn&apos;t bad. 3 is ok for me as well.&lt;/p&gt;</comment>
                            <comment id="13633163" author="jxiang" created="Tue, 16 Apr 2013 18:41:24 +0000"  >&lt;p&gt;Cool, I will use 3 then.&lt;/p&gt;</comment>
                            <comment id="13634160" author="jxiang" created="Wed, 17 Apr 2013 15:57:24 +0000"  >&lt;p&gt;Integrated into trunk and 0.95.  Thanks Jeffrey for the review.&lt;/p&gt;</comment>
                            <comment id="13634441" author="hudson" created="Wed, 17 Apr 2013 21:06:24 +0000"  >&lt;p&gt;Integrated in hbase-0.95 #151 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/151/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/151/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8321&quot; title=&quot;Log split worker should heartbeat to avoid timeout when the hlog is under recovery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8321&quot;&gt;&lt;del&gt;HBASE-8321&lt;/del&gt;&lt;/a&gt; Log split worker should heartbeat to avoid timeout when the hlog is under recovery (Revision 1468981)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
jxiang : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitLogWorker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogFactory.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogSplitter.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSHDFSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSMapRUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/RegionSplitter.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestHLogSplit.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13634493" author="hudson" created="Wed, 17 Apr 2013 21:58:23 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #4068 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4068/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4068/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8321&quot; title=&quot;Log split worker should heartbeat to avoid timeout when the hlog is under recovery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8321&quot;&gt;&lt;del&gt;HBASE-8321&lt;/del&gt;&lt;/a&gt; Log split worker should heartbeat to avoid timeout when the hlog is under recovery (Revision 1468974)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
jxiang : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitLogWorker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogFactory.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogSplitter.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSHDFSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSMapRUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/RegionSplitter.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestHLogSplit.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13634777" author="hudson" created="Thu, 18 Apr 2013 02:21:34 +0000"  >&lt;p&gt;Integrated in hbase-0.95-on-hadoop2 #72 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95-on-hadoop2/72/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95-on-hadoop2/72/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8321&quot; title=&quot;Log split worker should heartbeat to avoid timeout when the hlog is under recovery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8321&quot;&gt;&lt;del&gt;HBASE-8321&lt;/del&gt;&lt;/a&gt; Log split worker should heartbeat to avoid timeout when the hlog is under recovery (Revision 1468981)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
jxiang : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitLogWorker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogFactory.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogSplitter.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSHDFSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSMapRUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/util/RegionSplitter.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestHLogSplit.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13634817" author="hudson" created="Thu, 18 Apr 2013 04:24:45 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #502 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/502/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/502/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8321&quot; title=&quot;Log split worker should heartbeat to avoid timeout when the hlog is under recovery&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8321&quot;&gt;&lt;del&gt;HBASE-8321&lt;/del&gt;&lt;/a&gt; Log split worker should heartbeat to avoid timeout when the hlog is under recovery (Revision 1468974)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
jxiang : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/SplitLogWorker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogFactory.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogSplitter.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSHDFSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSMapRUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/FSUtils.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/util/RegionSplitter.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestDistributedLogSplitting.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestHLog.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestHLogSplit.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12632989">HBASE-7878</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12641748">HBASE-8314</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12578752" name="trunk-8321_v1.patch" size="10698" author="jxiang" created="Mon, 15 Apr 2013 17:17:06 +0000"/>
                            <attachment id="12578835" name="trunk-8321_v2.patch" size="27295" author="jxiang" created="Mon, 15 Apr 2013 23:14:10 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 10 Apr 2013 21:18:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322337</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jm53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>322682</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>