<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:34:41 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12609/HBASE-12609.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12609] Consider bandwidth throttling in ReplicationSource.readAllEntriesToReplicateOrNextFile</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12609</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The push size in ReplicationSource.shipEdits is controlled by &apos;replicationQueueSizeCapacity&apos; and &apos;replicationQueueNbCapacity&apos;. When the push size is much bigger than throttler&apos;s bandwidth(replication throttler is enabled), ReplicationSource will have a outgoing bandwidth peak followed by a period of sleep controlled by the throttler. How about considering bandwidth throttling in ReplicationSource.readAllEntriesToReplicateOrNextFile? such as the following code:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
       &lt;span class=&quot;code-comment&quot;&gt;// Stop &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; too many entries or too big
&lt;/span&gt;      &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; bandwidth = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf.getLong(&lt;span class=&quot;code-quote&quot;&gt;&quot;replication.source.per.peer.node.bandwidth&quot;&lt;/span&gt;, 0);
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((bandwidth &amp;gt; 0 &amp;amp;&amp;amp; currentSize &amp;gt; bandwidth) ||  &lt;span class=&quot;code-comment&quot;&gt;// ==&amp;gt; also consider bandwidth throttling
&lt;/span&gt;          currentSize &amp;gt;= &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.replicationQueueSizeCapacity ||
           entries.size() &amp;gt;= &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.replicationQueueNbCapacity) {
         &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
       }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Then, ReplicationSource will have more steady outgoing bandwidth.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12758826">HBASE-12609</key>
            <summary>Consider bandwidth throttling in ReplicationSource.readAllEntriesToReplicateOrNextFile</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cuijianwei">Jianwei Cui</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Dec 2014 04:49:03 +0000</created>
                <updated>Wed, 3 Dec 2014 18:10:24 +0000</updated>
                                            <version>0.98.8</version>
                                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14230985" author="lhofhansl" created="Tue, 2 Dec 2014 04:58:06 +0000"  >&lt;p&gt;Interesting. We had the reverse problem. Even with the throttler disabled, we could not fill replication pipe between our two data centers - i.e. we could not get HBase replication to make user of the available bandwidth.&lt;/p&gt;</comment>
                            <comment id="14231688" author="apurtell" created="Tue, 2 Dec 2014 16:13:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;long bandwidth = this.conf.getLong(&quot;replication.source.per.peer.node.bandwidth&quot;, 0);&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;This will be a dynamic function of the hosts and networks involved. We should determine available bandwidth using one of the established bandwidth estimation / flow control algorithms rather than rely on a statically configured value (which will usually be wrong, even if the operator is top of their game)&lt;/p&gt;</comment>
                            <comment id="14233004" author="cuijianwei" created="Wed, 3 Dec 2014 13:57:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;, the replication will wait the current ship returned to do next ship, which might consume hundreds of milliseconds, or even several seconds between two data centers, does this tend to make the available bandwidth couldn&apos;t be used fully?&lt;/p&gt;</comment>
                            <comment id="14233017" author="cuijianwei" created="Wed, 3 Dec 2014 14:10:54 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;, I agree that a statically configured value is not enough to control the replication bandwidth accurately. If we do replication from a big cluster (contains hundreds of region servers) to a small cluster(contains less than ten region servers), the regions of table need to be replicated may locate in different number of region servers(might locate in only one region server or all the region servers), it is hard to define a statically bandwidth throttling value for region server to control the whole bandwidth used by replication between cluster. I think we may need global control and more dedicate algorithm. &lt;/p&gt;</comment>
                            <comment id="14233263" author="lhofhansl" created="Wed, 3 Dec 2014 18:10:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;the replication will wait the current ship returned to do next ship&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yep. RPC in this way is notoriously bad in keeping the latency X bandwidth of the network utilized.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 2 Dec 2014 04:58:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 2 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i22ybr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>