<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:16:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4155/HBASE-4155.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4155] the problem in hbase thrift client when scan/get rows by timestamp</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4155</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I want to scan rows by specified timestamp. I use following hbase shell command :&lt;/p&gt;

&lt;p&gt;scan &apos;testcrawl&apos;,&lt;/p&gt;
{TIMESTAMP=&amp;gt;1312268202071}
&lt;p&gt; &lt;br/&gt;
ROW                                         COLUMN+CELL                                                                                                                   &lt;br/&gt;
 put1.com                                   column=crawl:data, timestamp=1312268202071, value=&amp;lt;html&amp;gt;put1&amp;lt;/html&amp;gt;                                                          &lt;br/&gt;
 put1.com                                   column=crawl:type, timestamp=1312268202071, value=html                                                                        &lt;br/&gt;
 put1.com                                   column=links:outlinks, timestamp=1312268202071, value=www.163.com;www.sina.com &lt;/p&gt;


&lt;p&gt;As I expected, I can get the rows which timestamp is 1312268202071.&lt;br/&gt;
But when I use thift client to do the same thing ,the return data is the rows which time before specified timestamp ,  not the same as hbase shell.following is timestamp of return data:&lt;/p&gt;

&lt;p&gt;1312179170000&lt;br/&gt;
1312268202059&lt;/p&gt;

&lt;p&gt;I look up the source in  hbase/src/main/java/org/apache/hadoop/hbase/thrift/ThriftServer.java, it use following code to set time parameter .&lt;/p&gt;

&lt;p&gt;scan.setTimeRange(Long.MIN_VALUE, timestamp);&lt;/p&gt;

&lt;p&gt;This cause thrift client return rows before specified row ,not the rows timestamp specified.&lt;br/&gt;
But in hbase client and avro client &#65292;it use following code to set time parameter.&lt;/p&gt;

&lt;p&gt;scan.setTimeStamp(timestamp);&lt;/p&gt;

&lt;p&gt;this will return rows timestamp specified.&lt;/p&gt;

&lt;p&gt;Is this a feature or a bug in thrift client ?&lt;br/&gt;
if this is a feature, which method in thrift client can get the rows by specified timestamp?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12516926">HBASE-4155</key>
            <summary>the problem in hbase thrift client when scan/get rows by timestamp</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="4">Incomplete</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="zezhou">zezhou</reporter>
                        <labels>
                            <label>thrift</label>
                    </labels>
                <created>Tue, 2 Aug 2011 13:20:44 +0000</created>
                <updated>Wed, 22 Apr 2015 00:34:29 +0000</updated>
                            <resolved>Wed, 22 Apr 2015 00:34:28 +0000</resolved>
                                    <version>0.90.0</version>
                                                    <component>Thrift</component>
                        <due></due>
                            <votes>1</votes>
                                    <watches>3</watches>
                                    <timeoriginalestimate seconds="60">1m</timeoriginalestimate>
                            <timeestimate seconds="60">1m</timeestimate>
                                        <comments>
                            <comment id="13078356" author="jdcryans" created="Tue, 2 Aug 2011 18:47:48 +0000"  >&lt;p&gt;I dug back in the commits to see when this was introduced, and it seems that this was done as part of the uber refactoring done in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1304&quot; title=&quot;New client server implementation of how gets and puts are handled. &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1304&quot;&gt;&lt;del&gt;HBASE-1304&lt;/del&gt;&lt;/a&gt; two years ago. The behavior does seem broken tho, it should set the timestamp and not a time range (that would be another method). How it works right seems counter-intuitive.&lt;/p&gt;

&lt;p&gt;So I would be +1 on fixing it, but the main issue would be that some users might already rely on the current behavior (I know that we don&apos;t here).&lt;/p&gt;

&lt;p&gt;Others using Thrift want to comment?&lt;/p&gt;</comment>
                            <comment id="13078365" author="yuzhihong@gmail.com" created="Tue, 2 Aug 2011 19:00:26 +0000"  >&lt;p&gt;I suggest we keep the current behavior.&lt;br/&gt;
ThriftServer.HBaseHandler has reference to Configuration object. We can introduce a new config option for setting exact timestamp instead of time range.&lt;/p&gt;</comment>
                            <comment id="13078442" author="jdcryans" created="Tue, 2 Aug 2011 21:20:52 +0000"  >&lt;p&gt;Yeah that&apos;s an option... and then we deprecate it for the next major version? That means we also have to print out in bold letters when people that function that it&apos;s going to be deprecated... although you might want to print that out only once. In any case we need to find a good way to communicate our intent to the users.&lt;/p&gt;

&lt;p&gt;But now looking the idl I&apos;m starting to think we should just change the behavior:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  /** 
   * Get the specified number of versions for the specified table,
   * row, and column.  Only versions less than or equal to the specified
   * timestamp will be returned.
   *
   * @return list of cells for specified row/column
   */
  list&amp;lt;TCell&amp;gt; getVerTs(
...
  /** 
   * Get all the data for the specified table and row at the specified
   * timestamp. Returns an empty list if the row does not exist.
   * 
   * @return TRowResult containing the row and map of columns to TCells
   */
  list&amp;lt;TRowResult&amp;gt; getRowTs(
...
  /** 
   * Get a scanner on the current table starting at the specified row and
   * ending at the last row in the table.  Return the specified columns.
   * Only values with the specified timestamp are returned.
   *
   * @return scanner id to be used with other scanner procedures
   */
  ScannerID scannerOpenTs(
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;getVerTs has the right documentation, but not scannerOpenTs and getRowTs since they also use the TimeRange (but the behavior we want is documented).&lt;/p&gt;</comment>
                            <comment id="13078446" author="yuzhihong@gmail.com" created="Tue, 2 Aug 2011 21:27:22 +0000"  >&lt;p&gt;We should correct the implementation of scannerOpenTs and getRowTs.&lt;/p&gt;</comment>
                            <comment id="13078626" author="zezhou" created="Wed, 3 Aug 2011 07:51:31 +0000"  >&lt;p&gt;this patch is based on hbase-0.90.1-cdh3u0 version&lt;/p&gt;</comment>
                            <comment id="13078663" author="yuzhihong@gmail.com" created="Wed, 3 Aug 2011 09:24:03 +0000"  >&lt;p&gt;@zezhou:&lt;br/&gt;
Except for getVerTs(), all the other getXX() methods should be changed.&lt;br/&gt;
Your patch was a diff which cannot be applied to Apache repository.&lt;br/&gt;
Please generate patch using subversion or git.&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13078701" author="zezhou" created="Wed, 3 Aug 2011 11:55:46 +0000"  >&lt;p&gt;@Ted ,sorry , this is my first time to submit a patch. I have re-generated the patch using svn.&lt;/p&gt;</comment>
                            <comment id="13078848" author="yuzhihong@gmail.com" created="Wed, 3 Aug 2011 17:03:17 +0000"  >&lt;p&gt;+1 on patch version 2.&lt;br/&gt;
Minor comment, the following line is called twice in scannerOpenWithStopTs():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        scan.setTimeStamp(timestamp);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But this was due to double call in the current class.&lt;/p&gt;</comment>
                            <comment id="13078850" author="yuzhihong@gmail.com" created="Wed, 3 Aug 2011 17:04:21 +0000"  >&lt;p&gt;This is the version I plan to commit.&lt;/p&gt;</comment>
                            <comment id="13078865" author="yuzhihong@gmail.com" created="Wed, 3 Aug 2011 17:24:11 +0000"  >&lt;p&gt;Looks like certain test depends on the current behavior of getRowTs():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testAll(org.apache.hadoop.hbase.thrift.TestThriftServer)  Time elapsed: 31.038 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.IndexOutOfBoundsException: Index: 0, Size: 0
        at java.util.ArrayList.RangeCheck(ArrayList.java:547)
        at java.util.ArrayList.get(ArrayList.java:322)
        at org.apache.hadoop.hbase.thrift.TestThriftServer.doTestTableTimestampsAndColumns(TestThriftServer.java:202)
        at org.apache.hadoop.hbase.thrift.TestThriftServer.testAll(TestThriftServer.java:67)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We need to decide whether modifying the test accordingly is the way to go.&lt;/p&gt;</comment>
                            <comment id="13440580" author="lhofhansl" created="Thu, 23 Aug 2012 19:29:28 +0000"  >&lt;p&gt;Where are we with this? Can we close?&lt;/p&gt;</comment>
                            <comment id="13440702" author="stack" created="Thu, 23 Aug 2012 21:52:16 +0000"  >&lt;p&gt;@Ted Modify the test to match the new behavior I&apos;d say.&lt;/p&gt;</comment>
                            <comment id="13584331" author="zeph" created="Fri, 22 Feb 2013 15:15:12 +0000"  >&lt;p&gt;similar issue...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):007:0&amp;gt; scan &lt;span class=&quot;code-quote&quot;&gt;&quot;AAA_customer&quot;&lt;/span&gt;, {TIMERANGE =&amp;gt; [0, 1360032970]}
ROW                                  COLUMN+CELL                                                                                              
0 row(s) in 1.5590 seconds

hbase(main):008:0&amp;gt; scan &lt;span class=&quot;code-quote&quot;&gt;&quot;AAA_customer&quot;&lt;/span&gt;
ROW                                  COLUMN+CELL                                                                                              
 1                                   column=mysql:birthday, timestamp=1360292144, value=1999-01-01  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13584334" author="zeph" created="Fri, 22 Feb 2013 15:17:11 +0000"  >&lt;p&gt;while, this other works&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):009:0&amp;gt; scan &lt;span class=&quot;code-quote&quot;&gt;&quot;AAA_customer&quot;&lt;/span&gt;, {TIMESTAMP =&amp;gt; 1360032970}
ROW                                  COLUMN+CELL                                                                                              
0 row(s) in 1.3960 seconds

hbase(main):010:0&amp;gt; scan &lt;span class=&quot;code-quote&quot;&gt;&quot;AAA_customer&quot;&lt;/span&gt;, {TIMESTAMP =&amp;gt; 1360292144}
ROW                                  COLUMN+CELL                                                                                              
 1                                   column=mysql:birthday, timestamp=1360292144, 1999-01-01 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12489215" name="4155.txt" size="2296" author="yuzhihong@gmail.com" created="Wed, 3 Aug 2011 17:04:21 +0000"/>
                            <attachment id="12489168" name="patch.txt" size="1823" author="zezhou" created="Wed, 3 Aug 2011 07:51:31 +0000"/>
                            <attachment id="12489182" name="patch.txt.svn" size="2335" author="zezhou" created="Wed, 3 Aug 2011 11:55:46 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 2 Aug 2011 18:47:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27196</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 43 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00sdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2529</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>