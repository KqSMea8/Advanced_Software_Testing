<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:01:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9087/HBASE-9087.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9087] Handlers being blocked during reads</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9087</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I&apos;m having a lot of handlers (90 - 300 aprox) being blocked when reading rows. They are blocked during changedReaderObserver registration.&lt;/p&gt;

&lt;p&gt;Lars Hofhansl suggests to change the implementation of changedReaderObserver from CopyOnWriteList to ConcurrentHashMap.&lt;/p&gt;

&lt;p&gt;Here is a stack trace: &lt;/p&gt;

&lt;p&gt;&quot;IPC Server handler 99 on 60020&quot; daemon prio=10 tid=0x0000000041c84000 nid=0x2244 waiting on condition &lt;span class=&quot;error&quot;&gt;&amp;#91;0x00007ff51fefd000&amp;#93;&lt;/span&gt;&lt;br/&gt;
   java.lang.Thread.State: WAITING (parking)&lt;br/&gt;
        at sun.misc.Unsafe.park(Native Method)&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;parking to wait for  &amp;lt;0x00000000c5c13ae8&amp;gt; (a java.util.concurrent.locks.ReentrantLock$NonfairSync)&lt;br/&gt;
        at java.util.concurrent.locks.LockSupport.park(LockSupport.java:156)&lt;br/&gt;
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(AbstractQueuedSynchronizer.java:811)&lt;br/&gt;
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(AbstractQueuedSynchronizer.java:842)&lt;br/&gt;
        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:1178)&lt;br/&gt;
        at java.util.concurrent.locks.ReentrantLock$NonfairSync.lock(ReentrantLock.java:186)&lt;br/&gt;
        at java.util.concurrent.locks.ReentrantLock.lock(ReentrantLock.java:262)&lt;br/&gt;
        at java.util.concurrent.CopyOnWriteArrayList.addIfAbsent(CopyOnWriteArrayList.java:553)&lt;br/&gt;
        at java.util.concurrent.CopyOnWriteArraySet.add(CopyOnWriteArraySet.java:221)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.Store.addChangedReaderObserver(Store.java:1085)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.StoreScanner.&amp;lt;init&amp;gt;(StoreScanner.java:138)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.Store.getScanner(Store.java:2077)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion$RegionScannerImpl.&amp;lt;init&amp;gt;(HRegion.java:3755)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.instantiateRegionScanner(HRegion.java:1804)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.getScanner(HRegion.java:1796)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.getScanner(HRegion.java:1771)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.get(HRegion.java:4776)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegion.get(HRegion.java:4750)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.get(HRegionServer.java:2152)&lt;br/&gt;
        at org.apache.hadoop.hbase.regionserver.HRegionServer.multi(HRegionServer.java:3700)&lt;br/&gt;
        at sun.reflect.GeneratedMethodAccessor26.invoke(Unknown Source)&lt;br/&gt;
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)&lt;br/&gt;
        at java.lang.reflect.Method.invoke(Method.java:597)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.WritableRpcEngine$Server.call(WritableRpcEngine.java:320)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1426)&lt;/li&gt;
&lt;/ul&gt;

</description>
                <environment></environment>
        <key id="12660668">HBASE-9087</key>
            <summary>Handlers being blocked during reads</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="eclark">Elliott Clark</assignee>
                                    <reporter username="pablomedina85">Pablo Medina</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Jul 2013 14:09:15 +0000</created>
                <updated>Wed, 21 Aug 2013 00:08:48 +0000</updated>
                            <resolved>Fri, 2 Aug 2013 22:07:40 +0000</resolved>
                                    <version>0.94.7</version>
                    <version>0.95.1</version>
                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.95.2</fixVersion>
                    <fixVersion>0.94.11</fixVersion>
                                    <component>Performance</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>15</watches>
                                                                <comments>
                            <comment id="13723902" author="dberjman" created="Tue, 30 Jul 2013 14:29:43 +0000"  >&lt;p&gt;From CopyOnWriteArraySet javadoc: &quot;Mutative operations (add, set, remove, etc.) are expensive since they usually entail copying the entire underlying array.&quot;&lt;/p&gt;</comment>
                            <comment id="13724217" author="eclark" created="Tue, 30 Jul 2013 18:21:25 +0000"  >&lt;p&gt;Pretty easy trunk patch.  Lets run it by jenkins to see how it does.&lt;/p&gt;</comment>
                            <comment id="13724256" author="lhofhansl" created="Tue, 30 Jul 2013 18:55:24 +0000"  >&lt;p&gt;Why ConcurrentSkipListMap vs ConcurrentHashMap?&lt;/p&gt;</comment>
                            <comment id="13724300" author="hadoopqa" created="Tue, 30 Jul 2013 19:33:00 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12595006/HBASE-9087-0.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12595006/HBASE-9087-0.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.io.hfile.TestScannerSelectionUsingKeyRange&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestBlocksScanned&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestResettingCounters&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestScanWithBloomError&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestColumnSeeking&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestSplitTransaction&lt;br/&gt;
                  org.apache.hadoop.hbase.filter.TestColumnPrefixFilter&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestIntraRowPagination&lt;br/&gt;
                  org.apache.hadoop.hbase.filter.TestDependentColumnFilter&lt;br/&gt;
                  org.apache.hadoop.hbase.filter.TestMultipleColumnPrefixFilter&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestKeepDeletes&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestMinVersions&lt;br/&gt;
                  org.apache.hadoop.hbase.filter.TestFilter&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestScanner&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestWideScanner&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestRegionObserverScannerOpenHook&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestRegionMergeTransaction&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestCoprocessorInterface&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6523//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13724464" author="eclark" created="Tue, 30 Jul 2013 21:34:56 +0000"  >&lt;p&gt;Well my initial thought was to keep from having a hashtable since that would be resized under a lock, causing latency spikes.  But since ConcurrentSkipList requires that everything is a Comparable (and the interface isn&apos;t).  Looks like Hashtable it is.&lt;/p&gt;</comment>
                            <comment id="13724552" author="hadoopqa" created="Tue, 30 Jul 2013 22:47:34 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12595049/HBASE-9087-1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12595049/HBASE-9087-1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6527//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13724564" author="stack" created="Tue, 30 Jul 2013 22:58:09 +0000"  >&lt;p&gt;I wonder if this fixes the performance probs the lads saw?&lt;/p&gt;</comment>
                            <comment id="13724574" author="eclark" created="Tue, 30 Jul 2013 23:09:09 +0000"  >&lt;p&gt;I would imagine so.  CopyOnWrite has an open java bug stating that it scales non-linearly, because the copy uses insertIfAbsent (or something similar).  But if the Integration cluster has some free time I can try a ycsb run.&lt;/p&gt;</comment>
                            <comment id="13725346" author="eclark" created="Wed, 31 Jul 2013 15:32:35 +0000"  >&lt;p&gt;Running a ycsb workload e benchmark on this right now.&lt;/p&gt;</comment>
                            <comment id="13725406" author="pablomedina85" created="Wed, 31 Jul 2013 16:43:53 +0000"  >&lt;p&gt;Elliot, did you run that benchmark ? did it improve the performance under concurrency?&lt;/p&gt;</comment>
                            <comment id="13725414" author="lhofhansl" created="Wed, 31 Jul 2013 16:55:36 +0000"  >&lt;p&gt;I&apos;m very curious as well &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13725422" author="pablomedina85" created="Wed, 31 Jul 2013 17:01:32 +0000"  >&lt;p&gt;btw. In the meanwhile... do you guys know what is a &apos;proper&apos; the number of handlers?. I know that &apos;proper&apos; means different things in different use cases but have you seen any region server serving requests using 1k handlers or more? It is that common scenario?&lt;/p&gt;</comment>
                            <comment id="13725428" author="eclark" created="Wed, 31 Jul 2013 17:04:37 +0000"  >&lt;p&gt;Running the benchmarks but they are tied in with integration tests so they will take 5 hours or so.  I hope to have results by the end of the day.&lt;/p&gt;</comment>
                            <comment id="13725436" author="lhofhansl" created="Wed, 31 Jul 2013 17:14:02 +0000"  >&lt;p&gt;You want to be able to keep both CPU and Disks busy. So one should have at least as many handlers as CPU threads and disk spindles. Beyond that it is trial and error.&lt;br/&gt;
We have 12 core CPU (24 HW threads) and 6 disk drives and have set the handler count to 50.&lt;/p&gt;</comment>
                            <comment id="13725449" author="pablomedina85" created="Wed, 31 Jul 2013 17:20:45 +0000"  >&lt;p&gt;So you can not handle more than 50 requests at a time?.&lt;/p&gt;</comment>
                            <comment id="13725455" author="eclark" created="Wed, 31 Jul 2013 17:26:11 +0000"  >&lt;p&gt;Requests are queued as they are decoded off the wire.  SO you can have lots of requests coming in, however only 50 will be actively worked on at a time.&lt;/p&gt;</comment>
                            <comment id="13725461" author="pablomedina85" created="Wed, 31 Jul 2013 17:30:52 +0000"  >&lt;p&gt;Right. But if you have free cpu cycles and let&apos;s say that you have a high block cache hit ratio (almost all the data is in memory) you should consider increasing the handlers so you can use those free cycles to increase your performance, right?. I guess that 50 handlers in Lars scenario consumes almost all its cpu / disk bandwith.&lt;/p&gt;</comment>
                            <comment id="13725531" author="lhofhansl" created="Wed, 31 Jul 2013 18:14:53 +0000"  >&lt;p&gt;That&apos;s why you make sure to have at least as many handlers as CPU threads, and few more to handle io waits.&lt;br/&gt;
Having way more threads than CPU threads and spindles is counter productive and you&apos;re better off queuing request.&lt;/p&gt;</comment>
                            <comment id="13725934" author="eclark" created="Thu, 1 Aug 2013 01:11:42 +0000"  >&lt;p&gt;So ycsb didn&apos;t show any change in time&lt;/p&gt;</comment>
                            <comment id="13726036" author="lhofhansl" created="Thu, 1 Aug 2013 04:18:53 +0000"  >&lt;p&gt;That&apos;s expected, no? YCSB is not running many long running scans, and I presume you didn&apos;t jack up the handler count.&lt;/p&gt;

&lt;p&gt;+1 from me.&lt;/p&gt;</comment>
                            <comment id="13726057" author="eclark" created="Thu, 1 Aug 2013 05:34:36 +0000"  >&lt;p&gt;I ran workload e which has some scanners, but you&apos;re probably correct about the length.&lt;/p&gt;</comment>
                            <comment id="13726416" author="pablomedina85" created="Thu, 1 Aug 2013 13:10:55 +0000"  >&lt;p&gt;I ran this issue when asking concurrently the same keys. Looking at the stack trace It turns out that the bottleneck is on the Store level. So I guess that you should run some kind of test that retrieve under concurrency some set of keys belonging to the same Store. Does that make sense?&lt;/p&gt;</comment>
                            <comment id="13726666" author="lhofhansl" created="Thu, 1 Aug 2013 17:54:22 +0000"  >&lt;p&gt;Yeah it&apos;s per store, so you&apos;d see this contention if you read a lot of KVs from the same Region and ColumnFamily.&lt;br/&gt;
Now thinking about how this is used a bit more... We&apos;re using this to notify the scanners that they have to reset their KVHeap stack. In that we absolutely have to make sure that all currently open scanners do this. ConcurrentHashMap does not actually guarantee this upon interating, but CopyOnWriteArraySet does. So maybe we&apos;re opening ourselves up to concurrency issues. An alternative would be a to use a HashSet and synchronize on it.&lt;/p&gt;</comment>
                            <comment id="13727123" author="lhofhansl" created="Fri, 2 Aug 2013 00:05:16 +0000"  >&lt;p&gt;Thinking more. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  What exactly do we have to guarantee about this? When we call notifyChangedReadersObservers(), all we have to ensure that we see all observers that were added prior to this. So the guarantees provided by ConcurrentHashMap should be good enough after all.&lt;/p&gt;</comment>
                            <comment id="13727189" author="lhofhansl" created="Fri, 2 Aug 2013 01:02:44 +0000"  >&lt;p&gt;I also tried a bunch of scenarios and could not find one where this improves performance.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=pablomedina85&quot; class=&quot;user-hover&quot; rel=&quot;pablomedina85&quot;&gt;Pablo Medina&lt;/a&gt;, any chance to run your scenario with this patch applied?&lt;/p&gt;</comment>
                            <comment id="13727218" author="pablomedina85" created="Fri, 2 Aug 2013 01:55:29 +0000"  >&lt;p&gt;I&apos;ll try to run it tomorrow. Where I can find the version with the patch applied?&lt;/p&gt;</comment>
                            <comment id="13727291" author="lhofhansl" created="Fri, 2 Aug 2013 03:56:24 +0000"  >&lt;p&gt;You&apos;ll have to build it yourself.&lt;br/&gt;
If that is an issue, I can build one for you.&lt;/p&gt;</comment>
                            <comment id="13727298" author="lhofhansl" created="Fri, 2 Aug 2013 04:05:06 +0000"  >&lt;p&gt;I know Elliott asked that on the mailing list, just to be sure, are you closing your scanners on the client?&lt;/p&gt;</comment>
                            <comment id="13727681" author="pablomedina85" created="Fri, 2 Aug 2013 13:40:06 +0000"  >&lt;p&gt;I&apos;m not opening scanners at the client side. My use case involves a multiGet with 500 keys aprox. I noticed that each of those keys is handled a get and a subsequent Scanner on the server side. May I be overloading the server with too many scanners by using that multiGet case?&lt;/p&gt;</comment>
                            <comment id="13727896" author="lhofhansl" created="Fri, 2 Aug 2013 18:01:24 +0000"  >&lt;p&gt;Hmm... I tried that; interesting. That server should definitely be able to handle this.&lt;/p&gt;

&lt;p&gt;Might be easiest if you tried with the patch, Pablo.&lt;/p&gt;

&lt;p&gt;You can build HBase like this:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;svn checkout &lt;a href=&quot;http://svn.apache.org/repos/asf/hbase/branches/0.94&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hbase/branches/0.94&lt;/a&gt; hbase-0.94&lt;/li&gt;
	&lt;li&gt;cd hbase-0.94&lt;/li&gt;
	&lt;li&gt;download the patch here. Then patch -p0 &amp;lt; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9087&quot; title=&quot;Handlers being blocked during reads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9087&quot;&gt;&lt;del&gt;HBASE-9087&lt;/del&gt;&lt;/a&gt;-1.patch&lt;/li&gt;
	&lt;li&gt;mvn clean install -DskipTests&lt;/li&gt;
	&lt;li&gt;once this is done you&apos;ll fine the tarball in the target directory.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I&apos;m happy to put up a tarball on my private apache area.&lt;/p&gt;</comment>
                            <comment id="13728119" author="eclark" created="Fri, 2 Aug 2013 21:07:13 +0000"  >&lt;p&gt;I&apos;ll check this into trunk/95 then so that we can run integration tests for a while on it.  Backporting should be pretty easy if needed &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13728146" author="stack" created="Fri, 2 Aug 2013 21:29:08 +0000"  >&lt;p&gt;+1 on commit to trunk and 0.95.  Chatting w/ Elliott we could not see how CHM would give a different view than COW.&lt;/p&gt;</comment>
                            <comment id="13728189" author="eclark" created="Fri, 2 Aug 2013 22:07:40 +0000"  >&lt;p&gt;In trunk and 95.  Thanks for the reviews and discussions.&lt;/p&gt;</comment>
                            <comment id="13728291" author="lhofhansl" created="Fri, 2 Aug 2013 23:59:21 +0000"  >&lt;p&gt;Meh... I&apos;m just gonna commit this to 0.94 as well.&lt;/p&gt;</comment>
                            <comment id="13728324" author="lhofhansl" created="Sat, 3 Aug 2013 00:41:02 +0000"  >&lt;p&gt;Please don&apos;t mark an issue fixed if it has not been committed to all branches. Can either leave it open or remove the (in this case) the 0.94.11 tag.&lt;/p&gt;</comment>
                            <comment id="13728331" author="lhofhansl" created="Sat, 3 Aug 2013 00:44:47 +0000"  >&lt;p&gt;Committed to 0.94 as well.&lt;/p&gt;</comment>
                            <comment id="13728340" author="hudson" created="Sat, 3 Aug 2013 00:47:11 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.95-on-hadoop2 #215 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95-on-hadoop2/215/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95-on-hadoop2/215/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9087&quot; title=&quot;Handlers being blocked during reads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9087&quot;&gt;&lt;del&gt;HBASE-9087&lt;/del&gt;&lt;/a&gt; Handlers being blocked during reads (eclark: rev 1509887)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13728359" author="hudson" created="Sat, 3 Aug 2013 01:08:34 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #650 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/650/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/650/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9087&quot; title=&quot;Handlers being blocked during reads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9087&quot;&gt;&lt;del&gt;HBASE-9087&lt;/del&gt;&lt;/a&gt; Handlers being blocked during reads (eclark: rev 1509886)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13728392" author="hudson" created="Sat, 3 Aug 2013 02:04:25 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94-security #243 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/243/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/243/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9087&quot; title=&quot;Handlers being blocked during reads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9087&quot;&gt;&lt;del&gt;HBASE-9087&lt;/del&gt;&lt;/a&gt; Handlers being blocked during reads (Elliott) (larsh: rev 1509922)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13728401" author="hudson" created="Sat, 3 Aug 2013 02:18:57 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94 #1092 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1092/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1092/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9087&quot; title=&quot;Handlers being blocked during reads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9087&quot;&gt;&lt;del&gt;HBASE-9087&lt;/del&gt;&lt;/a&gt; Handlers being blocked during reads (Elliott) (larsh: rev 1509922)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13728406" author="hudson" created="Sat, 3 Aug 2013 02:32:47 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.95 #398 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/398/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/398/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9087&quot; title=&quot;Handlers being blocked during reads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9087&quot;&gt;&lt;del&gt;HBASE-9087&lt;/del&gt;&lt;/a&gt; Handlers being blocked during reads (eclark: rev 1509887)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13728409" author="hudson" created="Sat, 3 Aug 2013 02:38:16 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #4336 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4336/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4336/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-9087&quot; title=&quot;Handlers being blocked during reads&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-9087&quot;&gt;&lt;del&gt;HBASE-9087&lt;/del&gt;&lt;/a&gt; Handlers being blocked during reads (eclark: rev 1509886)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13732288" author="pablomedina85" created="Wed, 7 Aug 2013 18:37:17 +0000"  >&lt;p&gt;I tested the patch with my workload and it improved my response times in 10%. I&apos;m not seeing the same rate of handlers blocked during my test as in 0.94.7. I&apos;m wondering why you guys didn&apos;t see any improvement in your test cases. My test case consists in read 1.5 million keys per minute over 3 tables (1 cf per table). So I think this scenario generates too much pressure in the Stores opening scanners at the server side with the consequence of generating contention on that CopyOnWriteSet in 0.94.7. What do you guys think about it?  &lt;/p&gt;</comment>
                            <comment id="13737230" author="pablomedina85" created="Mon, 12 Aug 2013 19:00:44 +0000"  >&lt;p&gt;When are you planning to release hbase 0.94.11 ?&lt;/p&gt;</comment>
                            <comment id="13737344" author="lhofhansl" created="Mon, 12 Aug 2013 21:01:10 +0000"  >&lt;p&gt;This week. 0.94.10RC0 was 7/19 and I am shooting for a monthly release.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12595006" name="HBASE-9087-0.patch" size="1731" author="eclark" created="Tue, 30 Jul 2013 18:21:25 +0000"/>
                            <attachment id="12595049" name="HBASE-9087-1.patch" size="1761" author="eclark" created="Tue, 30 Jul 2013 21:34:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 30 Jul 2013 14:29:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>340858</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 18 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1msdr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>341176</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>