<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:55:04 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8418/HBASE-8418.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8418] Caching KeyValue.getRowLength() to improve scan performance</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8418</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Looking at the profile seems that Bytes.toShort() is called a lot.&lt;br/&gt;
the calls are in ScanQueryMatcher.match() and KeyValue.KeyComparator.compare()&lt;/p&gt;

&lt;p&gt;getKeyLength() is already cached, but getRowLength() is not.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12644372">HBASE-8418</key>
            <summary>Caching KeyValue.getRowLength() to improve scan performance</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="mbertozzi">Matteo Bertozzi</assignee>
                                    <reporter username="mbertozzi">Matteo Bertozzi</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Apr 2013 15:08:10 +0000</created>
                <updated>Thu, 25 Apr 2013 11:01:12 +0000</updated>
                            <resolved>Thu, 25 Apr 2013 11:01:12 +0000</resolved>
                                                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13640524" author="mbertozzi" created="Wed, 24 Apr 2013 15:12:24 +0000"  >&lt;p&gt;attached a 94 version of the patch that caches the getRowLength() and uses that instead of toShort().&lt;/p&gt;

&lt;p&gt;I still have to see if it really improves the performance, I keep getting different results but my guess is because I&apos;m running on virtual machines...&lt;/p&gt;

&lt;p&gt;the profiler at least shows less calls to Bytes.toShort() that was the top function after StoreScanner.next()&lt;/p&gt;</comment>
                            <comment id="13640599" author="apurtell" created="Wed, 24 Apr 2013 16:21:02 +0000"  >&lt;p&gt;+1, patch seems reasonable. What does the top ~5 look like before and after? Just curious.&lt;/p&gt;</comment>
                            <comment id="13640618" author="mbertozzi" created="Wed, 24 Apr 2013 16:34:40 +0000"  >&lt;p&gt;it looks reasonable, but I want to verify if the performance improvement is worth the 2 extra bytes used.&lt;/p&gt;

&lt;p&gt;my initial notes says, from:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Bytes.toShort()&lt;/li&gt;
	&lt;li&gt;StoreScanner.next()&lt;/li&gt;
	&lt;li&gt;KeyValue.KeyComparator.compare()&lt;/li&gt;
	&lt;li&gt;HFileReaderv2.ScannerV2.blockSeek()&lt;/li&gt;
	&lt;li&gt;Bytes.LexicographicalCompareHolder.UnsafeComparer.compareTo()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;to:&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;StoreScanner.next()&lt;/li&gt;
	&lt;li&gt;HFileReaderv2.ScannerV2.blockSeek()&lt;/li&gt;
	&lt;li&gt;Bytes.LexicographicalCompareHolder.UnsafeComparer.compareTo()&lt;/li&gt;
	&lt;li&gt;Bytes.toShort()&lt;/li&gt;
	&lt;li&gt;KeyValue.KeyComparator.compare()&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I&apos;ll take again the results with the number of calls and percentage to be more accurate&lt;/p&gt;</comment>
                            <comment id="13641665" author="mbertozzi" created="Thu, 25 Apr 2013 11:01:12 +0000"  >&lt;p&gt;closing down, after longer tests this doesn&apos;t seems to give the expected results.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12580295" name="HBASE-8418-0.94-v0.patch" size="4205" author="mbertozzi" created="Wed, 24 Apr 2013 15:12:24 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 24 Apr 2013 16:21:02 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>324739</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 34 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1k0yf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>325085</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>