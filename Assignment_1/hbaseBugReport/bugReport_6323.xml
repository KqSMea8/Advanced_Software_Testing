<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:35:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6323/HBASE-6323.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6323] [replication] most of the source metrics are wrong when there&apos;s multiple slaves</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6323</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Most of the metrics in replication were written with 1 slave in mind but with multiple slaves the issue really shows. Most of the metrics are set directly:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void enqueueLog(Path log) {
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.queue.put(log);
  &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.metrics.sizeOfLogQueue.set(queue.size());
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So &lt;tt&gt;sizeOfLogQueue&lt;/tt&gt; is always showing the size of the queue that updated the metric last.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure what&apos;s the right way to fix this since we can&apos;t have dynamic metrics. Merging them would work here but it wouldn&apos;t work so well with &lt;tt&gt;ageOfLastShippedOp&lt;/tt&gt; since the age can be different and it definitely cannot be summed.&lt;/p&gt;

&lt;p&gt;Assigning to Elliott since he seems to dig metrics these days. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12597355">HBASE-6323</key>
            <summary>[replication] most of the source metrics are wrong when there&apos;s multiple slaves</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="eclark">Elliott Clark</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 3 Jul 2012 22:09:21 +0000</created>
                <updated>Mon, 23 Sep 2013 18:23:54 +0000</updated>
                            <resolved>Thu, 6 Sep 2012 22:30:05 +0000</resolved>
                                    <version>0.92.1</version>
                    <version>0.94.0</version>
                                                        <due></due>
                            <votes>1</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13406107" author="eclark" created="Tue, 3 Jul 2012 22:12:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;I&apos;m not sure what&apos;s the right way to fix this since we can&apos;t have dynamic metrics&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;We can.  They are just annoying to make.  But I think something like what we have with regions is probably the right thing. A dynamic set for every source and a rollup.&lt;/p&gt;</comment>
                            <comment id="13408345" author="eclark" created="Fri, 6 Jul 2012 21:23:42 +0000"  >&lt;p&gt;First try at it.  I&apos;m not 100% sure that I am using the metrics2 stuff correctly.  I&apos;m going to spin up a couple clusters to test, but I wanted jenkins to take a crack at it.&lt;/p&gt;</comment>
                            <comment id="13408447" author="jdcryans" created="Fri, 6 Jul 2012 23:26:38 +0000"  >&lt;p&gt;Looks like it&apos;s the right way to go.&lt;/p&gt;</comment>
                            <comment id="13409860" author="eclark" created="Mon, 9 Jul 2012 21:18:59 +0000"  >&lt;p&gt;Patch with documentation&lt;br/&gt;
This adds the hadoop-metrics2.properties config file.&lt;/p&gt;</comment>
                            <comment id="13409861" author="eclark" created="Mon, 9 Jul 2012 21:19:28 +0000"  >&lt;p&gt;0.96 version first.&lt;/p&gt;</comment>
                            <comment id="13409868" author="stack" created="Mon, 9 Jul 2012 21:28:10 +0000"  >&lt;p&gt;Looks good Mr. Elliott.  Will give J-D honor of blessing it.  I like your moving classes under metrics package.  Where is the bit where we deal w/ multiple slaves?  Thats in one of the moved classes?  Good stuff.&lt;/p&gt;</comment>
                            <comment id="13409875" author="eclark" created="Mon, 9 Jul 2012 21:33:09 +0000"  >&lt;p&gt;Yes.  The ReplicationSourceMetric class adds values to a global gauge and to a gauge for just that source.  When a source is stopped the values are subtracted from the global gauge and the gauge for just that source is removed.  Counters are not subtracted since they represent things like the total number of log edits shipped out and removing them doesn&apos;t really make sense.&lt;/p&gt;

&lt;p&gt;Since there&apos;s only one sink ReplicationSinkMetrics doesn&apos;t really have that.&lt;/p&gt;</comment>
                            <comment id="13409881" author="stack" created="Mon, 9 Jul 2012 21:38:11 +0000"  >&lt;p&gt;I&apos;m +1 then.&lt;/p&gt;</comment>
                            <comment id="13409953" author="jdcryans" created="Mon, 9 Jul 2012 23:41:35 +0000"  >&lt;p&gt;I did a review with Elliott, basically there&apos;s 3 &quot;Copyright 2010&quot; to remove and ReplicationMetricsSource needs some refactoring because right now there&apos;s 3 methods that are almost identical.&lt;/p&gt;</comment>
                            <comment id="13409966" author="eclark" created="Mon, 9 Jul 2012 23:58:34 +0000"  >&lt;p&gt;Removed copy right and refactored the similar code.&lt;/p&gt;</comment>
                            <comment id="13411021" author="eclark" created="Tue, 10 Jul 2012 22:50:47 +0000"  >&lt;p&gt;Hold off on committing this.  It looks like the metrics2 in hadoop2 is incompatible with the metrics2 in hadoop1.&lt;/p&gt;</comment>
                            <comment id="13412455" author="eclark" created="Thu, 12 Jul 2012 02:08:43 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4050&quot; title=&quot;Update HBase metrics framework to metrics2 framework&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4050&quot;&gt;&lt;del&gt;HBASE-4050&lt;/del&gt;&lt;/a&gt; has a newer version of this patch.&lt;/p&gt;</comment>
                            <comment id="13441659" author="lhofhansl" created="Sat, 25 Aug 2012 00:13:32 +0000"  >&lt;p&gt;Unassigning from 0.94 (we do not have metrics 2 there, right?)&lt;/p&gt;</comment>
                            <comment id="13441664" author="eclark" created="Sat, 25 Aug 2012 00:18:20 +0000"  >&lt;p&gt;Nope and we&apos;re not likely to.  When I get time I&apos;ll have to circle back around on this for a 0.94 version.&lt;/p&gt;</comment>
                            <comment id="13450113" author="eclark" created="Thu, 6 Sep 2012 22:30:05 +0000"  >&lt;p&gt;This was fixed in the metrics2 migration.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12512380">HBASE-4050</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12535433" name="HBASE-6323-0.patch" size="28982" author="eclark" created="Fri, 6 Jul 2012 21:23:42 +0000"/>
                            <attachment id="12535742" name="HBASE-6323-1.patch" size="31314" author="eclark" created="Mon, 9 Jul 2012 21:18:59 +0000"/>
                            <attachment id="12535769" name="HBASE-6323-2.patch" size="32220" author="eclark" created="Mon, 9 Jul 2012 23:58:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 3 Jul 2012 22:12:49 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245343</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 15 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i067xr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34217</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>