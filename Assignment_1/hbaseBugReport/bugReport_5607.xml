<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:29:18 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5607/HBASE-5607.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5607] Implement scanner caching throttling to prevent too big responses </title>
                <link>https://issues.apache.org/jira/browse/HBASE-5607</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When a misconfigured client retrieves fat rows with a scanner caching value set too high, there is a big chance the regionserver cannot handle the response buffers. (See log example below). Also see the mailing list thread: &lt;br/&gt;
&lt;a href=&quot;http://comments.gmane.org/gmane.comp.java.hadoop.hbase.user/24819&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://comments.gmane.org/gmane.comp.java.hadoop.hbase.user/24819&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This issue is for tracking a solution that throttles the scanner caching value in the case the response buffers are too big.&lt;/p&gt;

&lt;p&gt;A few possible solutions:&lt;br/&gt;
a) Is a response (repeatedly) over 100MB (configurable), then reduce the scanner-caching by half its size. (In either server or client).&lt;br/&gt;
b) Introduce a property that defines a fixed (target) response size, instead of defining the numbers of rows to cache.&lt;/p&gt;


&lt;p&gt;2012-03-20 07:57:40,092 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 5 on 60020, responseTooLarge for: next(4438820558358059204, 1000) from 172.23.122.15:50218: Size: 105.0m&lt;br/&gt;
2012-03-20 07:57:53,226 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 3 on 60020, responseTooLarge for: next(-7429189123174849941, 1000) from 172.23.122.15:50218: Size: 214.4m&lt;br/&gt;
2012-03-20 07:57:57,839 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 5 on 60020, responseTooLarge for: next(-7429189123174849941, 1000) from 172.23.122.15:50218: Size: 103.2m&lt;br/&gt;
2012-03-20 07:57:59,442 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 2 on 60020, responseTooLarge for: next(-7429189123174849941, 1000) from 172.23.122.15:50218: Size: 101.8m&lt;br/&gt;
2012-03-20 07:58:20,025 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 6 on 60020, responseTooLarge for: next(9033159548564260857, 1000) from 172.23.122.15:50218: Size: 107.2m&lt;br/&gt;
2012-03-20 07:58:27,273 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 3 on 60020, responseTooLarge for: next(9033159548564260857, 1000) from 172.23.122.15:50218: Size: 100.1m&lt;br/&gt;
2012-03-20 07:58:52,783 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 1 on 60020, responseTooLarge for: next(-8611621895979000997, 1000) from 172.23.122.15:50218: Size: 101.7m&lt;br/&gt;
2012-03-20 07:59:02,541 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 0 on 60020, responseTooLarge for: next(-511305750191148153, 1000) from 172.23.122.15:50218: Size: 120.9m&lt;br/&gt;
2012-03-20 07:59:25,346 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 6 on 60020, responseTooLarge for: next(1570572538285935733, 1000) from 172.23.122.15:50218: Size: 107.8m&lt;br/&gt;
2012-03-20 07:59:46,805 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 3 on 60020, responseTooLarge for: next(-727080724379055435, 1000) from 172.23.122.15:50218: Size: 102.7m&lt;br/&gt;
2012-03-20 08:00:00,138 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 3 on 60020, responseTooLarge for: next(-3701270248575643714, 1000) from 172.23.122.15:50218: Size: 122.1m&lt;br/&gt;
2012-03-20 08:00:21,232 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 6 on 60020, responseTooLarge for: next(5831907615409186602, 1000) from 172.23.122.15:50218: Size: 157.5m&lt;br/&gt;
2012-03-20 08:00:23,199 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 9 on 60020, responseTooLarge for: next(5831907615409186602, 1000) from 172.23.122.15:50218: Size: 160.7m&lt;br/&gt;
2012-03-20 08:00:28,174 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 2 on 60020, responseTooLarge for: next(5831907615409186602, 1000) from 172.23.122.15:50218: Size: 160.8m&lt;br/&gt;
2012-03-20 08:00:32,643 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 7 on 60020, responseTooLarge for: next(5831907615409186602, 1000) from 172.23.122.15:50218: Size: 182.4m&lt;br/&gt;
2012-03-20 08:00:36,826 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 9 on 60020, responseTooLarge for: next(5831907615409186602, 1000) from 172.23.122.15:50218: Size: 237.2m&lt;br/&gt;
2012-03-20 08:00:40,850 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 3 on 60020, responseTooLarge for: next(5831907615409186602, 1000) from 172.23.122.15:50218: Size: 212.7m&lt;br/&gt;
2012-03-20 08:00:44,736 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 1 on 60020, responseTooLarge for: next(5831907615409186602, 1000) from 172.23.122.15:50218: Size: 232.9m&lt;br/&gt;
2012-03-20 08:00:49,471 WARN org.apache.hadoop.ipc.HBaseServer: IPC Server handler 7 on 60020, responseTooLarge for: next(5831907615409186602, 1000) from 172.23.122.15:50218: Size: 227.2m&lt;br/&gt;
2012-03-20 08:00:57,566 FATAL org.apache.hadoop.hbase.regionserver.HRegionServer: ABORTING region server serverName=c15.kalooga.nl,60020,1331900161295, load=(requests=706, regions=166, usedHeap=1505, maxHeap=1995): OutOfMemoryError, aborting&lt;br/&gt;
java.lang.OutOfMemoryError: Java heap space&lt;br/&gt;
        at java.nio.HeapByteBuffer.&amp;lt;init&amp;gt;(HeapByteBuffer.java:39)&lt;br/&gt;
        at java.nio.ByteBuffer.allocate(ByteBuffer.java:312)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.ByteBufferOutputStream.&amp;lt;init&amp;gt;(ByteBufferOutputStream.java:44)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.ByteBufferOutputStream.&amp;lt;init&amp;gt;(ByteBufferOutputStream.java:37)&lt;br/&gt;
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1064)&lt;br/&gt;
2012-03-20 08:00:57,567 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Dump of metrics: requests=189, regions=166, stores=987, storefiles=1401, storefileIndexSize=222, memstoreSize=693, compactionQueueSize=0, flushQueueSize=0, usedHeap=1635, maxHeap=1995, blockCacheSize=315474864, blockCacheFree=103051152, blockCacheCount=4422, blockCacheHitCount=1152306, blockCacheMissCount=12464451, blockCacheEvictedCount=5585715, blockCacheHitRatio=8, blockCacheHitCachingRatio=16&lt;/p&gt;</description>
                <environment></environment>
        <key id="12547354">HBASE-5607</key>
            <summary>Implement scanner caching throttling to prevent too big responses </summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ferdy.g">Ferdy Galema</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Mar 2012 09:47:23 +0000</created>
                <updated>Wed, 8 Apr 2015 20:21:11 +0000</updated>
                            <resolved>Wed, 8 Apr 2015 20:21:11 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13234372" author="zhihyu@ebaysf.com" created="Wed, 21 Mar 2012 14:18:16 +0000"  >&lt;p&gt;Option b is desirable.&lt;/p&gt;</comment>
                            <comment id="13234385" author="stack" created="Wed, 21 Mar 2012 14:40:28 +0000"  >&lt;p&gt;b. exists.  See the property hbase.client.scanner.max.result.size.  Its sort of hidden.  Its an awkward implementation, not the fault of the author, but because no mechanism for passing extras rpc&apos;ing.  See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1996&quot; title=&quot;Configure scanner buffer in bytes instead of number of rows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1996&quot;&gt;&lt;del&gt;HBASE-1996&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;An option c would check in every so often composing a response and if over a general heap percent threshold, just return to the client.   Its easy to describe.  Hard to implement.&lt;/p&gt;</comment>
                            <comment id="13234407" author="ferdy.g" created="Wed, 21 Mar 2012 15:10:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2214&quot; title=&quot;Do HBASE-1996 -- setting size to return in scan rather than count of rows -- properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2214&quot;&gt;&lt;del&gt;HBASE-2214&lt;/del&gt;&lt;/a&gt; is a followup on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1996&quot; title=&quot;Configure scanner buffer in bytes instead of number of rows&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1996&quot;&gt;&lt;del&gt;HBASE-1996&lt;/del&gt;&lt;/a&gt;. Let&apos;s keep issue &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2214&quot; title=&quot;Do HBASE-1996 -- setting size to return in scan rather than count of rows -- properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2214&quot;&gt;&lt;del&gt;HBASE-2214&lt;/del&gt;&lt;/a&gt; for option b. &lt;/p&gt;

&lt;p&gt;This issue is for creating an option that throttles a scan regardless of how scanner caching is configured (either number of rows or bytes size).&lt;/p&gt;</comment>
                            <comment id="13239684" author="apurtell" created="Tue, 27 Mar 2012 17:37:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;This issue is for creating an option that throttles a scan regardless of how scanner caching is configured (either number of rows or bytes size).&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Wouldn&apos;t &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2214&quot; title=&quot;Do HBASE-1996 -- setting size to return in scan rather than count of rows -- properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2214&quot;&gt;&lt;del&gt;HBASE-2214&lt;/del&gt;&lt;/a&gt; be an effective throttle for when the scanner may cross a fat row? What is the rationale for doing more/otherwise? I don&apos;t see it clearly spelled out here.&lt;/p&gt;</comment>
                            <comment id="13239784" author="ferdy.g" created="Tue, 27 Mar 2012 18:19:28 +0000"  >&lt;p&gt;I agree that &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2214&quot; title=&quot;Do HBASE-1996 -- setting size to return in scan rather than count of rows -- properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2214&quot;&gt;&lt;del&gt;HBASE-2214&lt;/del&gt;&lt;/a&gt; makes this issue considerably less important, perhaps even obsolete. It depends on how 2214 will be implemented: If it becomes a default setting then this issue does not have to be fixed. A user disabling the response cap obviously has good reasons to do so. However if a user has to explicitly set it in order to be in effect, then they might not think about it and simply set a caching based on the number of rows, therefore possibly causing too big response. Throttling would help in this case. If you think the latter is not a real problem, then this issue can be closed.&lt;/p&gt;</comment>
                            <comment id="13240044" author="zhihyu@ebaysf.com" created="Tue, 27 Mar 2012 23:10:36 +0000"  >&lt;p&gt;@Ferdy:&lt;br/&gt;
Daniel isn&apos;t working on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2214&quot; title=&quot;Do HBASE-1996 -- setting size to return in scan rather than count of rows -- properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2214&quot;&gt;&lt;del&gt;HBASE-2214&lt;/del&gt;&lt;/a&gt;. Any chance you may want to work on it ?&lt;/p&gt;</comment>
                            <comment id="13240412" author="ferdy.g" created="Wed, 28 Mar 2012 13:48:38 +0000"  >&lt;p&gt;Ok sure. I&apos;m currently not into HBase development at all but I&apos;m willing to give it a shot.&lt;/p&gt;</comment>
                            <comment id="14485936" author="jonathan.lawlor" created="Wed, 8 Apr 2015 20:21:11 +0000"  >&lt;p&gt;Resolving this old one as fixed. With &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2214&quot; title=&quot;Do HBASE-1996 -- setting size to return in scan rather than count of rows -- properly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2214&quot;&gt;&lt;del&gt;HBASE-2214&lt;/del&gt;&lt;/a&gt; the throttling mechanism is available to the client to achieve the described behavior via Scan.setMaxResultSize. Furthermore, with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12976&quot; title=&quot;Set default value for hbase.client.scanner.max.result.size&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12976&quot;&gt;&lt;del&gt;HBASE-12976&lt;/del&gt;&lt;/a&gt; in branch-1+, the default value of max result size is set to a reasonable value that will prevent a client from unintentionally causing issues on the region server. Feel free to reopen if you feel there are additional concerns that I have missed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12456059">HBASE-2214</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 Mar 2012 14:18:16 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>232512</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0htpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>102076</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>