<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:08:41 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3254/HBASE-3254.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3254] Ability to specify the &quot;host&quot; published in zookeeper</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3254</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We are running HBase on EC2 and I&apos;m trying to get a client external from EC2 to connect to the cluster.  But, each of the nodes appears to be publishing its IP address into zookeeper.  The problem is that the nodes on EC2 see a 10. IP address that is only resolvable inside of EC2.&lt;/p&gt;

&lt;p&gt;Specifically for EC2, there is a DNS name that will resolve properly both externally and internally, so it would be nice if I could tell each of the processes what host to publish into zookeeper via a property.  As it stands, I have to do ssh tunnelling/muck with the hosts file in order to get my client to connect.&lt;/p&gt;

&lt;p&gt;This problem could occur anywhere that you have a different DNS entry for public vs. private access.  That might only ever happen on EC2, but it might happen elsewhere.  I don&apos;t really know &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12480468">HBASE-3254</key>
            <summary>Ability to specify the &quot;host&quot; published in zookeeper</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="cheddar">Eric Tschetter</reporter>
                        <labels>
                    </labels>
                <created>Sat, 20 Nov 2010 01:31:12 +0000</created>
                <updated>Wed, 16 Jul 2014 23:18:31 +0000</updated>
                            <resolved>Wed, 16 Jul 2014 23:18:31 +0000</resolved>
                                    <version>0.89.20100924</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12935040" author="stack" created="Tue, 23 Nov 2010 21:06:43 +0000"  >&lt;p&gt;Hey Cheddar.  You got a patch that would illustrate how you&apos;d fix this (We should be using hostnames rather than IPs I&apos;d say)?&lt;/p&gt;</comment>
                            <comment id="12935102" author="cheddar" created="Tue, 23 Nov 2010 22:54:15 +0000"  >&lt;p&gt;Not yet.  I worked around it by mucking with my hosts file and setting up an&lt;br/&gt;
SSH-based SOCKS proxy for now.  If I get some time, I&apos;ll take a stab at a&lt;br/&gt;
patch.&lt;/p&gt;

&lt;p&gt;I think that it should be reasonable to just have a System/hbase conf&lt;br/&gt;
property that the HRegionServer and HMaster look at to get the address that&lt;br/&gt;
they publish.  If that is not set, then just do what it does now.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3254?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=12935040#action_12935040&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-3254?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;amp;focusedCommentId=12935040#action_12935040&lt;/a&gt;]&lt;br/&gt;
should be using hostnames rather than IPs I&apos;d say)?&lt;br/&gt;
EC2 to connect to the cluster. But, each of the nodes appears to be&lt;br/&gt;
publishing its IP address into zookeeper. The problem is that the nodes on&lt;br/&gt;
EC2 see a 10. IP address that is only resolvable inside of EC2.&lt;br/&gt;
externally and internally, so it would be nice if I could tell each of the&lt;br/&gt;
processes what host to publish into zookeeper via a property. As it stands,&lt;br/&gt;
I have to do ssh tunnelling/muck with the hosts file in order to get my&lt;br/&gt;
client to connect.&lt;br/&gt;
public vs. private access. That might only ever happen on EC2, but it might&lt;br/&gt;
happen elsewhere. I don&apos;t really know &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;</comment>
                            <comment id="12935187" author="stack" created="Wed, 24 Nov 2010 03:42:53 +0000"  >&lt;p&gt;A patch whereby optionally servers would register themselves in zk using a suggested hostname seems reasonable (Only tricky part is that a RegionServer will use the &apos;name&apos; the master tells it use &amp;#8211; see the reportForDuty code in HRegionServer.  RegionServer on startup reads its &apos;address&apos; then volunteers this to the Master but the Master could change it on the RegionServer.  Subsequently after first reportForDuty, the regionserver will always checkin using the name the Master told it.  In fact, you might be able to exploit this behavior by patching the Master only?)&lt;/p&gt;</comment>
                            <comment id="12935585" author="cheddar" created="Thu, 25 Nov 2010 00:15:12 +0000"  >&lt;p&gt;Ok, so I looked into this some more as I ran into &lt;b&gt;another&lt;/b&gt; DNS issue when I went to deploy our client application in EC2.  It turns out the problem is somewhat confounded.  There are two places that IP addresses are taken from.&lt;/p&gt;

&lt;p&gt;#1, when the client tries to locate the Root region, it uses the IP address in zookeeper.  From what I can tell this is the &lt;b&gt;only&lt;/b&gt; time the addresses in zookeeper matter.  This IP address is determined by HServerInfo.getAddress()&lt;/p&gt;

&lt;p&gt;#2, when the client tries to load up data from a specific HRegionServer (i.e. tries to access a user-created table) it looks at the meta data for the table to find the region that has the key(s) it&apos;s looking for.  This gets the HRegionServer address from the meta data itself which is populated by the ProcessRegionOpen through a call to HServerInfo.getHostnamePort().  HServerInfo.getHostnamePort() is very close to HServerInfo.getServerName().&lt;/p&gt;

&lt;p&gt;So, it looks like the changes required are actually two fold, but would work:&lt;/p&gt;

&lt;p&gt;1) Adjust the address reported to ZK to be .getHostnamePort() instead of getAddress()&lt;br/&gt;
2) Adjust line 260 of HRegionServer (the constructor) from&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    machineName = DNS.getDefaultHost(
        conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.regionserver.dns.&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt;&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt;),
        conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.regionserver.dns.nameserver&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;to&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    machineName = DNS.getDefaultHost(
        conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.regionserver.dns.&lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt;&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt;),
        conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.regionserver.dns.nameserver&quot;&lt;/span&gt;,&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;&quot;&lt;/span&gt;));
    machineName = conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.regionserver.machineName.override&quot;&lt;/span&gt;, machineName);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;will have the intended effect.  Does this sound reasonable?  If so, I&apos;ll try to figure out how our guys did the CDH deployment to EC2, so that I can figure out how to test out a patched version...&lt;/p&gt;</comment>
                            <comment id="12935600" author="stack" created="Thu, 25 Nov 2010 00:53:34 +0000"  >&lt;p&gt;On #1, would be better if this were the host, yeah.&lt;/p&gt;

&lt;p&gt;On #2, yes, getServerName on HSI is getHostnamePort but with addition of startcode (as you&apos;ve figured).&lt;/p&gt;

&lt;p&gt;Yes, your override seems reasonable.&lt;/p&gt;

&lt;p&gt;Good on you Eric.&lt;/p&gt;</comment>
                            <comment id="14064324" author="apurtell" created="Wed, 16 Jul 2014 23:18:31 +0000"  >&lt;p&gt;No progress on issue&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 23 Nov 2010 21:06:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32962</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hlfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100734</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>