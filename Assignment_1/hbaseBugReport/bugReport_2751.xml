<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:04:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2751/HBASE-2751.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2751] Consider closing StoreFiles sometimes</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2751</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Having a lot of regions per region server could be considered harmless if most of them aren&apos;t used, but that&apos;s not really true at the moment. We keep all files opened all the time (except for rolled HLogs). I&apos;m thinking of 2 solutions&lt;/p&gt;

&lt;ol&gt;
	&lt;li&gt;Lazy open the store files, or at least close them down after we read the file info. Or we could do this for every file except the most recent one.&lt;/li&gt;
	&lt;li&gt;Close files when they&apos;re not in use. We need some heuristic to determine when is the best moment to declare that a file can be closed.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;Both solutions go hand in hand, and I think it would be a huge gain in order to lower the ulimit and xceivers-related issues.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12467373">HBASE-2751</key>
            <summary>Consider closing StoreFiles sometimes</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Jun 2010 20:04:10 +0000</created>
                <updated>Sun, 8 Jun 2014 21:58:22 +0000</updated>
                            <resolved>Sun, 8 Jun 2014 21:58:22 +0000</resolved>
                                                                        <due></due>
                            <votes>1</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="12880316" author="streamy" created="Fri, 18 Jun 2010 20:30:46 +0000"  >&lt;p&gt;I&apos;m not sure about #1 but like #2.  In general, when you open up a region or a new storefile, you may need to serve requests from it.  Maybe there are some special circumstances this makes sense (cluster startup?) but other than that it might be hard to figure when it would make sense.  We&apos;re doing work to try to keep the time a region is offline as short as possible and that would add to it in the case that requests are pending.&lt;/p&gt;

&lt;p&gt;Perhaps tracking at a StoreFile level the last access time and in a background thread you could iterate all regions/stores/storefiles to close file references older than a certain access time?  This would be more suggestive and if you touch all the data you&apos;d open everything at once.  If you are thinking more explicit like maxOpenFiles we&apos;d need some kind of LRU algo I guess.&lt;/p&gt;</comment>
                            <comment id="12880318" author="streamy" created="Fri, 18 Jun 2010 20:33:09 +0000"  >&lt;p&gt;Oh one note.  We&apos;re encapsulating filesystem interaction a bit more cleanly in the master over in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2695&quot; title=&quot;HMaster cleanup and refactor&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2695&quot;&gt;&lt;del&gt;HBASE-2695&lt;/del&gt;&lt;/a&gt;.  Could do something similar for RS that might make this easier to implement, especially if we went LRU direction.&lt;/p&gt;</comment>
                            <comment id="12914775" author="stack" created="Sat, 25 Sep 2010 06:52:30 +0000"  >&lt;p&gt;Not going to happen for 0.90.&lt;/p&gt;</comment>
                            <comment id="12922251" author="deinspanjer" created="Mon, 18 Oct 2010 20:51:37 +0000"  >&lt;p&gt;I don&apos;t believe this should be a minor issue.  It seems to be at the heart of Mozilla&apos;s recent cluster instability as over time, each server in our 19 node cluster opens more and more connections to all the others and eventually, when we get around 10k connections, we have to restart the cluster due to client lag.&lt;/p&gt;

&lt;p&gt;If there were configurations for the number of open connections to trigger cleanup and a threshold for how many to close on each cleanup, we could use an LRU to close the oldest connections. This would impose an access penalty on those unopened regions (which we currently have to pay already the first time they are accessed) but would prevent connection overload.&lt;/p&gt;</comment>
                            <comment id="12922258" author="ryanobjc" created="Mon, 18 Oct 2010 21:01:35 +0000"  >&lt;p&gt;We need to move to a DFSClient that doesn&apos;t keep sockets open when a file is opened.  We should only have 1 socket open against the current Block&apos;s datanode, and we open and close them for pread() calls as they happen.  &lt;/p&gt;

&lt;p&gt;jbooth&apos;s hdfs patch should probably be mentioned and revived at some point.&lt;/p&gt;</comment>
                            <comment id="14021428" author="apurtell" created="Sun, 8 Jun 2014 21:58:22 +0000"  >&lt;p&gt;Stale issue. Reopen if still relevant (if there&apos;s new activity)&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12386027">HBASE-24</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 18 Jun 2010 20:30:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32755</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 27 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hj2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100351</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>