<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:25:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11659/HBASE-11659.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11659] Region state RPC call is not idempotent</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11659</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Here is the scenario on 0.98 with zk-less assignment&lt;br/&gt;
The master gets an OPEN RPC call from region server.&lt;br/&gt;
So, it moves the region state from PENDING_OPEN to OPEN.&lt;br/&gt;
But, the call timeouts on the region server and region server retries sending the OPEN call. However, now the master throws an Exception saying the region is not PENDING_OPEN. So, the region servers aborts the region on receiving that exception and sends FAILED_OPEN to master. But the master cannot change its state from FAILED_OPEN to OPEN, so eventually the master keeps the state as OPEN while the actual region is no longer open on region server.&lt;/p&gt;

&lt;p&gt;The master should not throw an exception on receiving OPEN RPC calls multiple times.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12731772">HBASE-11659</key>
            <summary>Region state RPC call is not idempotent</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="virag">Virag Kothari</assignee>
                                    <reporter username="virag">Virag Kothari</reporter>
                        <labels>
                    </labels>
                <created>Mon, 4 Aug 2014 16:34:58 +0000</created>
                <updated>Sat, 21 Feb 2015 23:31:59 +0000</updated>
                            <resolved>Fri, 8 Aug 2014 22:13:18 +0000</resolved>
                                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.98.6</fixVersion>
                                    <component>Region Assignment</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="14084882" author="jxiang" created="Mon, 4 Aug 2014 16:57:55 +0000"  >&lt;p&gt;When the first OPEN call timed out on the regionserver side, was there any exception in the master side?&lt;br/&gt;
We can&apos;t just return if the current state is OPEN. We need to make sure the region is OPEN on the right server with the right open seq number to make sure it is a retry. Do we handle retries for other calls properly?&lt;/p&gt;</comment>
                            <comment id="14085050" author="virag" created="Mon, 4 Aug 2014 18:32:37 +0000"  >&lt;p&gt;I dont see any exception on master when the first OPEN call timed out. There was only socket timeout on regionserver.&lt;br/&gt;
I saw similar issue during CLOSE where master had already moved the region state to OFFLINE, but the call had timeout on region server. On next retry, the master complained that the region is not pending close, but it didn&apos;t lead in any inconsistency on the region server as the region was already closed.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;We need to make sure the region is OPEN on the right server with the right open seq number to make sure it is a retry.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Do we need to query meta to fetch the seq number?&lt;/p&gt;



</comment>
                            <comment id="14085079" author="jxiang" created="Mon, 4 Aug 2014 18:46:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;Do we need to query meta to fetch the seq number?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We don&apos;t have the seq num in mem. I see. Probably no need.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;On next retry, the master complained that the region is not pending close, but it didn&apos;t lead in any inconsistency on the region server as the region was already closed.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s good. The region server ignores the complain?&lt;/p&gt;</comment>
                            <comment id="14085184" author="virag" created="Mon, 4 Aug 2014 19:51:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;We don&apos;t have the seq num in mem. I see. Probably no need.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;So, checking if the region is opened on right region server is enough?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;That&apos;s good. The region server ignores the complain?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes. If the region is already closed, the region server doesn&apos;t do anything &lt;/p&gt;</comment>
                            <comment id="14085204" author="jxiang" created="Mon, 4 Aug 2014 20:07:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;checking if the region is opened on right region server is enough?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Good question. I am not sure. For now, I don&apos;t see any problem with that.&lt;/p&gt;</comment>
                            <comment id="14089654" author="stack" created="Thu, 7 Aug 2014 19:23:35 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt; Commit?&lt;/p&gt;</comment>
                            <comment id="14089707" author="virag" created="Thu, 7 Aug 2014 19:55:29 +0000"  >&lt;p&gt;Let me update based on Jimmy&apos;s comments and also will add a unit test.&lt;/p&gt;</comment>
                            <comment id="14089770" author="jxiang" created="Thu, 7 Aug 2014 20:27:33 +0000"  >&lt;p&gt;Cool, a unit test really helps. Thanks.&lt;/p&gt;</comment>
                            <comment id="14090985" author="virag" created="Fri, 8 Aug 2014 17:17:54 +0000"  >&lt;p&gt;Updated patch based on Jimmy&apos;s comments. A test case is also added&lt;/p&gt;</comment>
                            <comment id="14091054" author="jxiang" created="Fri, 8 Aug 2014 18:02:29 +0000"  >&lt;p&gt;+1. Will commit if test passes. At commit, may change current.getServerName().equals(serverName) to current.isOnServer(serverName).&lt;/p&gt;</comment>
                            <comment id="14091333" author="hadoopqa" created="Fri, 8 Aug 2014 21:42:54 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12660667/HBASE-11659.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12660667/HBASE-11659.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12660667&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10360//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14091368" author="jxiang" created="Fri, 8 Aug 2014 22:13:18 +0000"  >&lt;p&gt;Integrated into branch 1 and master. Thanks Virag a lot for the patch.&lt;/p&gt;</comment>
                            <comment id="14091494" author="hudson" created="Sat, 9 Aug 2014 00:21:07 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5387 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5387/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5387/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11659&quot; title=&quot;Region state RPC call is not idempotent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11659&quot;&gt;&lt;del&gt;HBASE-11659&lt;/del&gt;&lt;/a&gt; Region state RPC call is not idempotent (Virag Kothari) (jxiang: rev fa46724f363fc95c183a890b9cab06ed3d2b8dd2)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14091627" author="hudson" created="Sat, 9 Aug 2014 03:40:52 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #92 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/92/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/92/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11659&quot; title=&quot;Region state RPC call is not idempotent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11659&quot;&gt;&lt;del&gt;HBASE-11659&lt;/del&gt;&lt;/a&gt; Region state RPC call is not idempotent (Virag Kothari) (jxiang: rev 1669bc44c7e2739fc3dd742fc4acd1c7df7451dc)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestAssignmentManagerOnCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14110809" author="apurtell" created="Tue, 26 Aug 2014 15:18:48 +0000"  >&lt;p&gt;Pushed to 0.98 as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11546&quot; title=&quot;Backport ZK-less region assignment to 0.98&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11546&quot;&gt;&lt;del&gt;HBASE-11546&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14330896" author="enis" created="Sat, 21 Feb 2015 23:31:59 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12710152">HBASE-11059</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12728295">HBASE-11546</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12660667" name="HBASE-11659.patch" size="4911" author="virag" created="Fri, 8 Aug 2014 17:17:54 +0000"/>
                            <attachment id="12659668" name="HBASE-11659.patch" size="804" author="virag" created="Mon, 4 Aug 2014 16:36:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 4 Aug 2014 16:57:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409801</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yib3:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>409795</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>