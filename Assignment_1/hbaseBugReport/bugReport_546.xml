<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:45:18 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-546/HBASE-546.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-546] Use Zookeeper in HBase</title>
                <link>https://issues.apache.org/jira/browse/HBASE-546</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Zookeeper =~ Chubby. This means that we could take advantage of a distributed lock manager to coordinate things like failover masters, regionservers staying online when master is dead, atomic region-&amp;gt;regionserver assignments, etc. There are a lot of opportunities for improvements here. Please add discussions of particular features in comments or sub-tasks.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12392373">HBASE-546</key>
            <summary>Use Zookeeper in HBase</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="bryanduxbury">Bryan Duxbury</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Mar 2008 18:28:47 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:09 +0000</updated>
                            <resolved>Mon, 30 Mar 2009 02:35:38 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                                        <due></due>
                            <votes>1</votes>
                                    <watches>10</watches>
                                                                                                            <comments>
                            <comment id="12602447" author="jdcryans" created="Wed, 4 Jun 2008 20:29:06 +0000"  >&lt;p&gt;Some comments :&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;The integration of HBase and ZK will have to be really well done since many people already seems to find it hard to do. Best case scenario would be to not mess with ZK config at all, that it is somehow handled by HBase but difficulties will be to set the servers address, dataDir and leaderServes.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;To connect to ZK, you have to specify an address and a port. Since we will do some integration, it will be best to know internally all available servers and handle server failure.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Suppose we format HDFS to start with a clean system, for the moment it cleans everything that is linked to HBase. With ZK, files will be left there too so ROOT address will be there. We will have to do something really nice to make sure nobody has to do 2 cleanup (HDFS and /var/data/zookeeper) everytime. Maybe something like &quot;read ROOT address; if inexsistant, flush ZK data&quot;.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12604036" author="stack" created="Tue, 10 Jun 2008 20:54:15 +0000"  >&lt;p&gt;(after chatting w/ J-D on IRC), I wonder if we should just treat ZK as we currently treat HDFS &amp;#8211; its just an address in the hbase-*.xml?  Something like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&amp;lt;property&amp;gt;
&amp;lt;name&amp;gt;hbase.zookeeper&amp;lt;/name&amp;gt;
&amp;lt;/name&amp;gt;
&amp;lt;value&amp;gt;ZK_HOST:ZK_PORT/ZK_DATADIR
&amp;lt;/value&amp;gt;
&amp;lt;/property&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Would be grand if no zookeeper configured, we fell back on hbase-only implementation of ZK interface (Would we need to have master and regionservers listening on two ports to do this?)&lt;/p&gt;

&lt;p&gt;Would mean user would have to configure the ZK cluster independent of hbase.  Would have to also do the clean independently of hbase too, just as you do hdfs currently.&lt;/p&gt;

&lt;p&gt;Alternatively, we&apos;d have a zookeepers file which would have zookeeper configurations and a list of ZK cluster members with demarcation of leader.  On startup, we&apos;d parse ZK settings and write out a ZK configuration on all ZK members of ZK cluster &amp;#8211; probably in shell &amp;#8211;   and start up all members as part of bringing up ZK cluster.  Downside to latter is that it would take a bit more work and what to do if ZK cluster is for more than just hbase usage?  Upside, user wouldn&apos;t have to worry about ZK.&lt;/p&gt;</comment>
                            <comment id="12604310" author="jdcryans" created="Wed, 11 Jun 2008 19:03:39 +0000"  >&lt;p&gt;This is the kind of patch i was talking on IRC. Works on 2.2.1&lt;/p&gt;

&lt;p&gt;With this, we would have to distribute Zookeeper with HBase. The processes would be started using start-hbase.sh as any other process. In HBase, we read the ZK server config (which would be in hbase-site.xml) and there you go, you know where to connect.&lt;/p&gt;</comment>
                            <comment id="12604324" author="jdcryans" created="Wed, 11 Jun 2008 20:19:33 +0000"  >&lt;p&gt;Completely  overlooked something. This solution misses the fact that if we want to start the processes with start-hbase.sh we need a file with the zk servers in it (like st^ack was saying on IRC, I just woke up). So it means having to duplicate the information. But, if ZK cluster is for more than just HBase usage, leaving  the zkservers file blank would enable this really easily.&lt;/p&gt;</comment>
                            <comment id="12604536" author="jdcryans" created="Thu, 12 Jun 2008 15:15:41 +0000"  >&lt;p&gt;In Bigtable paper, page 4, it describes what Chubby is used for exactly :&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ensure there is at most 1 active master at any time&lt;/li&gt;
	&lt;li&gt;Store the bootstrap location&lt;/li&gt;
	&lt;li&gt;Discover tablet servers and finalize tabler server death&lt;/li&gt;
	&lt;li&gt;Store the schema information&lt;/li&gt;
	&lt;li&gt;Store access control lists (not sure what it is)&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Ze big question : do we want to implement all of these or just some parts? For example, what would be the benefit of storing all schema information in ZK instead of what we do right now? &lt;/p&gt;</comment>
                            <comment id="12604566" author="jdcryans" created="Thu, 12 Jun 2008 16:35:00 +0000"  >&lt;p&gt;As Jim said on the mailing list, storing the schema in ZK would solve &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-451&quot; title=&quot;Remove HTableDescriptor from HRegionInfo&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-451&quot;&gt;&lt;del&gt;HBASE-451&lt;/del&gt;&lt;/a&gt; instead of having another catalog table named TABLE&lt;/p&gt;</comment>
                            <comment id="12604720" author="apurtell" created="Fri, 13 Jun 2008 02:11:47 +0000"  >&lt;p&gt;Will ZK integration be targeted for 0.2, or beyond? What say ye? I have some work pending for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-42&quot; title=&quot;Set region split size on table creation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-42&quot;&gt;&lt;del&gt;HBASE-42&lt;/del&gt;&lt;/a&gt; that would not be that profitable to do if ZK will go into 0.2. Better to work on HTableDescriptor hosting on ZK now in that case.  &lt;/p&gt;</comment>
                            <comment id="12604727" author="jimk" created="Fri, 13 Jun 2008 03:20:23 +0000"  >&lt;p&gt;ZK integration is post 0.2. as we are trying to wrap up the enough of the nasty issues so we can release something that works with hadoop 0.17&lt;/p&gt;</comment>
                            <comment id="12604955" author="jdcryans" created="Fri, 13 Jun 2008 19:18:42 +0000"  >&lt;p&gt;First try at an Interface for the distributed lock system.&lt;/p&gt;</comment>
                            <comment id="12607712" author="jdcryans" created="Tue, 24 Jun 2008 18:13:58 +0000"  >&lt;p&gt;The ZK interface won&apos;t contain any method to store the schema for the moment. See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-451&quot; title=&quot;Remove HTableDescriptor from HRegionInfo&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-451&quot;&gt;&lt;del&gt;HBASE-451&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12646636" author="stack" created="Tue, 11 Nov 2008 19:20:51 +0000"  >&lt;p&gt;Bunch of us had chat on ZK integration for 0.20.0 up on IRC.  Below was result:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
19:01 &amp;lt; st^Ack_&amp;gt; So, let me &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; summarize.
19:01 &amp;lt; st^Ack_&amp;gt; 1. Zk all the time
19:01 &amp;lt; st^Ack_&amp;gt; 2. We manage a single instance as &lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt;
19:01 &amp;lt; st^Ack_&amp;gt; 3. Unless, user supplies URL to a ZK cluster, then we stop starting/stopping zk instance as part of cluster start/stop
19:02 &amp;lt; st^Ack_&amp;gt; 4. Look at having our single instance log to hdfs, can be done later
...
19:11 &amp;lt; jdcryans&amp;gt; 5. Look at managing a bigger ZK cluster later
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12646680" author="jdcryans" created="Tue, 11 Nov 2008 21:55:51 +0000"  >&lt;p&gt;Rough cut for the scripts. Doing bin/start-all.sh starts a ZK server on the server specified in conf/zookeepers. More work is obviously needed because ZK is very different from what we see in Hadoop/HBase.&lt;/p&gt;</comment>
                            <comment id="12649781" author="jdcryans" created="Fri, 21 Nov 2008 20:01:30 +0000"  >&lt;p&gt;Little cleanup, made that ZK starts first and ends last. Requires that zookeeper is in that libs.&lt;/p&gt;</comment>
                            <comment id="12650688" author="nitay" created="Tue, 25 Nov 2008 19:12:45 +0000"  >&lt;p&gt;Initial stab at using zookeeper to store root region location. Missing tests and probably has a few issues within the code that warrant some discussion.&lt;/p&gt;</comment>
                            <comment id="12650705" author="jdcryans" created="Tue, 25 Nov 2008 19:56:21 +0000"  >&lt;p&gt;Review of that patch:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&amp;lt;jdcryans&amp;gt; nitay: little reminder, lines must be &amp;lt; than 80 chars&lt;br/&gt;
&amp;lt;nitay&amp;gt; k&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; nitay: in ZookeeperWrapper (let&apos;s call it ZKW), at line 76 there&apos;s a weird char&lt;br/&gt;
&amp;lt;nitay&amp;gt; hehe ye u&apos;r eright, no idea how that got in there&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; yeah, was giving a javadoc warning&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; in RegionManager, should we initializeZookeeper before reassignRootRegion?&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; nitay: what do you think?&lt;br/&gt;
&amp;lt;nitay&amp;gt; looking&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; also in RegionManager, I think writeRootRegionLocationToZooKeeper begs to belong to ZKW&lt;br/&gt;
&amp;lt;nitay&amp;gt; ye i was gonna put it there only reason i didnt was cause i didnt want everyone to have access to it&lt;br/&gt;
&amp;lt;nitay&amp;gt; and yes it makes sense to me that it be before reassignRootRegion&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; yeah prevents race conditions IMO&lt;br/&gt;
&amp;lt;nitay&amp;gt; oh, explain please, im not seeing it&lt;br/&gt;
&amp;lt;nitay&amp;gt; what has a race condition&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; if for some reason it takes a long time to connect to ZK, the connection may not be ready when we assign the root region&lt;br/&gt;
&amp;lt;nitay&amp;gt; that&apos;s what waitForConnection is for&lt;br/&gt;
&amp;lt;nitay&amp;gt; ZooKeeper zooKeeper = zooKeeperWrapper.waitForZooKeeperConnection();&lt;br/&gt;
&amp;lt;nitay&amp;gt; now mind u, if we can&apos;t reach ZK, RM will block on this, inside its constructor, right now&lt;br/&gt;
&amp;lt;nitay&amp;gt; i was seeing cases where ZK wasn&apos;t ready yet&lt;br/&gt;
&amp;lt;nitay&amp;gt; (particulaly b/c im on your old set of patches which run it last)&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; hehe&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; ok, but I would still put it before as a safety&lt;br/&gt;
&amp;lt;nitay&amp;gt; sure sounds good&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; in the case we don&apos;t want to provide an access to writeRootRegionLocationToZooKeeper (but in a way even if you don&apos;t have the method, you can still do it the same way it is done in that method), I think you should provide a nicer method in ZKW to write into ZK&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; or we would have that same code everywhere in hbase soon&lt;br/&gt;
&amp;lt;nitay&amp;gt; jdcryans: ok, that&apos;s a good point that the clients have raw access to the ZK object, so yeah i&apos;ll move it into ZKW&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; also it&apos;s more coherent with readRootRegionLocation&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; but maybe we will still want a generic method to write into ZK.... we&apos;ll see later when we add other features&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; nitay: you will also be able to clean those imports&lt;br/&gt;
&amp;lt;nitay&amp;gt; right&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; nitay:  ah but there is still that initializeZookeeper with lots of ZK stuff in it...&lt;br/&gt;
&amp;lt;nitay&amp;gt; jdcryans: yeah i can make write do that stuff, its basically just making sure the parent node exists&lt;br/&gt;
&amp;lt;nitay&amp;gt; which really shouldn&apos;t need to be done till the first write&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; you mean adding a generic &quot;write&quot; method in ZKW?&lt;br/&gt;
&amp;lt;nitay&amp;gt; no i meant make writeRootRegionLocation create the parent node if it doesnt exist&lt;br/&gt;
&amp;lt;nitay&amp;gt; rather than having the RM constructor make it&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; ah ok good&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; nitay: my last nitpick, why lazy instantiating ZKW in HCM? (wondering)&lt;br/&gt;
&amp;lt;nitay&amp;gt; ah hehe&lt;br/&gt;
&amp;lt;nitay&amp;gt; constructor doesn&apos;t throw&lt;br/&gt;
&amp;lt;nitay&amp;gt; so i figured instead of making it throw something new that all the users of it would now have to handle, or making it do something sensible, i can just add on to the method that uses it which already throws IOException&lt;br/&gt;
 nitay gives really long explanation for laziness?&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; lol&lt;br/&gt;
&amp;lt;jdcryans&amp;gt; maybe just add that explanation in your code&lt;br/&gt;
&amp;lt;nitay&amp;gt; ok&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="12650786" author="nitay" created="Tue, 25 Nov 2008 23:20:35 +0000"  >&lt;p&gt;Version 2 attached with fixes from IRC conversation&lt;/p&gt;</comment>
                            <comment id="12651064" author="jdcryans" created="Wed, 26 Nov 2008 17:13:07 +0000"  >&lt;p&gt;Some comments on the patch. &lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Lines should be capped at 80 chars, ZKW is not very compliant.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Currently how readRootRegionLocation handles exception is OK since we do retries. How we handle writeRootRegionLocation is something else... either do retries or shutdown HBase since we can&apos;t run without ZK.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I tried the PE sequentialWrite on my laptop, went fine. It also restarted fine.&lt;/li&gt;
&lt;/ul&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Something important that this patch does is that it removes the check on HMaster&apos;s safe mode. Maybe we should verify if we are in safe mode when starting new clients? (client starts, verifies state of HMaster in HCM).&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12651206" author="jdcryans" created="Thu, 27 Nov 2008 01:04:44 +0000"  >&lt;p&gt;Had this chat with Nitay on IRC:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;19:42&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	got your updates, gonna make the write do some retries and then throw all the way up, which should shutdown the HMaster?&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:43&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	also, about the safe mode, so i saw that i removed that but i thought that was safe b/c the client will just keep trying to read the root region location?&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:43&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	the retries should be done in RegionManager&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:43&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	jdcryans: oh ok i can move them there&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:43&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	yeah but the root region will be assigned first, but that doesn&apos;t mean that the meta regions are all assigned&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:44&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	so the safe mode should really work like in hdfs&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:44&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	how does it work in hdfs?&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:44&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	you can&apos;t do anything until safe mode is off&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:45&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	ok, i can make that a direct rpc then instead of having it be injected through the getRootRegion&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:45&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	It&apos;s one way to do it&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:45&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	another one would be to store that value in ZK&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:45&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	better suggestions?&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:45&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	so that we don&apos;t rely on the master for that info&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:46&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	ah ok so just some empty ephemeral file?&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:46&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	for example, during normal operations the master fails and a new client tries to instantiate a HCM&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:46&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	when master comes back up its in safe mode again?&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:47&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	was thinking about exactly the same&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:47&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	but I don&apos;t know...&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:47&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	we should try it first in a busy cluster&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:47&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	for the mo, I would make it an ephemeral file&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:48&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	the less the client is coupled to HMaster the better&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:48&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	k&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:48&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	so the RM owned by HMaster would start up in safe mode&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:49&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	yep&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:50&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	ok, ephemeral it is, makes sense&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:50&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	I think it&apos;s a safe design&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:51&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	oh i also found another interesting thing&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:52&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	when we get a regionServerStartup&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:53&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	if the old data from that server tells us it was serving the root region we clear it out by calling setRootRegionLocation(null)&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:53&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	right now that would NPE in ZKW&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:54&amp;#93;&lt;/span&gt;	&amp;lt;jdcryans&amp;gt;	so that would be a delete?&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;19:54&amp;#93;&lt;/span&gt;	&amp;lt;nitay&amp;gt;	so im making it so that if u pass in null it deletes the file&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="12663199" author="nitay" created="Tue, 13 Jan 2009 02:50:45 +0000"  >&lt;p&gt;Fixes to the issues discussed above. Also added a test that ensures master writes root region location to ZooKeeper once scanning is complete.&lt;/p&gt;</comment>
                            <comment id="12663200" author="nitay" created="Tue, 13 Jan 2009 02:51:44 +0000"  >&lt;p&gt;The first version of the patch, renamed.&lt;/p&gt;</comment>
                            <comment id="12665539" author="nitay" created="Tue, 20 Jan 2009 20:14:09 +0000"  >&lt;p&gt;Added config option defaults in conf/hbase-default.xml &lt;/p&gt;</comment>
                            <comment id="12665863" author="jdcryans" created="Wed, 21 Jan 2009 15:33:43 +0000"  >&lt;p&gt;Nitay,&lt;/p&gt;

&lt;p&gt;The config in hbase-default.xml should be expressed as numbers and not operations like zookeeper.pause should be 2000 and not 2 * 1000.  Also, since zookeeper.servers requires to be set for a fully distributed HBase,so you should modify the src/java/overview.html file.&lt;/p&gt;</comment>
                            <comment id="12665994" author="stack" created="Wed, 21 Jan 2009 22:46:15 +0000"  >&lt;p&gt;For zookeeper.servers, you specify a quorum by listing the quorum members?&lt;/p&gt;

&lt;p&gt;When single-instance of zk that has been started by hbase runs, where does it write its logs.  Can that be configurable?&lt;/p&gt;

&lt;p&gt;What if I specify a full-path for zookeeper.znode.rootserver, will that write root region location outside of zookeeper.znode.parent?&lt;/p&gt;

&lt;p&gt;(Regards a question you asked on IRC a few days ago) If things like DEFAULT_ZOOKEEPER_SERVERS , are only used in one place, I&apos;d say don&apos;t need to be in HConstants... just do it in place used.  If used more than once, its good to define HConstants AND they are used by more than one class (otherwise, do the define inside that class)&lt;/p&gt;

&lt;p&gt;Should below be synchronized nitay?&lt;/p&gt;

&lt;p&gt;+    private ZooKeeperWrapper getZooKeeperWrapper() throws IOException {&lt;/p&gt;

&lt;p&gt;Is there danger that two threads could be asking for it at about same time?&lt;/p&gt;

&lt;p&gt;This is an interesting change Nitay: -  public HServerAddress findRootRegion();... removing it from the Master.  I like it.  ZK rules now!&lt;/p&gt;

&lt;p&gt;Below....&lt;br/&gt;
+ * Copyright 2008 The Apache Software Foundation&lt;br/&gt;
... should be 2009&lt;/p&gt;

&lt;p&gt;Below has trailing &apos;\&apos;&lt;/p&gt;

&lt;p&gt;+ * Wraps a ZooKeeper instance and adds HBase specific functionality.\&lt;/p&gt;

&lt;p&gt;Can these be final in ZKWrapper?&lt;/p&gt;

&lt;p&gt;+  private ZooKeeper zooKeeper;&lt;br/&gt;
+  private WatcherWrapper watcher;&lt;/p&gt;

&lt;p&gt;... same in HRS:&lt;/p&gt;

&lt;p&gt;+  private ZooKeeperWrapper zooKeeperWrapper;&lt;/p&gt;


&lt;p&gt;In below...&lt;/p&gt;

&lt;p&gt;+    rootRegionZNode = parentZNode + &quot;/&quot; + rootServerZNodeName;&lt;/p&gt;

&lt;p&gt;... does ZK have a define for path separator?&lt;/p&gt;

&lt;p&gt;We don&apos;t throw exception if we fail to get root:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+      data = zooKeeper.getData(rootRegionZNode, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (KeeperException e) {
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;;
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;... is that good?  Does caller handle null?&lt;/p&gt;

&lt;p&gt;Whats story w/ data in ZK?  Its byte arrays?  Should they be UTF-8?  If so, Bytes.toBytes over in hbase util might help.  E.g. rather than +    String addressString = new String(data); ...&lt;br/&gt;
which could give different answers if the client was in different local than original writer, be explicit its utf-8 and do Bytes.toBytes(....) when writing and Bytes.toString(...  when getting?&lt;/p&gt;





</comment>
                            <comment id="12666068" author="rafan" created="Thu, 22 Jan 2009 06:27:20 +0000"  >&lt;p&gt;For the sake of performance and reliability, HBase should start a small ZK cluster itself (not necessary every HRS, but could be a list of nodes in conf/hbase-zk).&lt;/p&gt;

&lt;p&gt;But I agree with what stack listed in Nov 11 above, esp, #5. We can start with a single-instance ZK then change it if necessary. For example, if people mainly deal with HBase, they shouldn&apos;t be bothered to get a ZK cluster up and running by themselves.&lt;/p&gt;</comment>
                            <comment id="12666141" author="jdcryans" created="Thu, 22 Jan 2009 13:34:33 +0000"  >&lt;blockquote&gt;&lt;p&gt;When single-instance of zk that has been started by hbase runs, where does it write its logs. Can that be configurable?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Look in the scripts-v2 patch, it writes the logs at the same place as all other HBase components.&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;For the sake of performance and reliability, HBase should start a small ZK cluster itself (not necessary every HRS, but could be a list of nodes in conf/hbase-zk).&lt;/p&gt;

&lt;p&gt;But I agree with what stack listed in Nov 11 above, esp, #5. We can start with a single-instance ZK then change it if necessary. For example, if people mainly deal with HBase, they shouldn&apos;t be bothered to get a ZK cluster up and running by themselves.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Stack&apos;s comment was in fact a group decision so we will mainly stick to it. The way the scripts are currently written (see my patch), HBase starts by default 1 ZK on the localhost. You can add other machines in conf/zookeepers so that a cluster of ZK is started BUT you still need to add a file yourself of each machine so that they know that they are in a quorum (see ZK doc). You can also disable the HBase managing of ZK by simply emptying the conf/zookeepers file.&lt;/p&gt;

&lt;p&gt;Regards the part where people shouldn&apos;t bother with ZK well... if you keep the default behavior this will create a not very available cluster so I&apos;d say that a new user won&apos;t be bothered by ZK, but someone who wants real availability needs to get his hands dirty.&lt;/p&gt;</comment>
                            <comment id="12667121" author="nitay" created="Sun, 25 Jan 2009 18:53:13 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1144&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-1144&lt;/a&gt; for replies to comments made by JD/Stack.&lt;/p&gt;</comment>
                            <comment id="12693636" author="nitay" created="Mon, 30 Mar 2009 02:35:37 +0000"  >&lt;p&gt;All of the subtasks have been fixed. Closing this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12398550">HBASE-698</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12400952">HBASE-773</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12388733">HBASE-451</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12413345">HBASE-1158</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12392212">HBASE-543</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12383989" name="DistributedLockInterface.java" size="2053" author="jdcryans" created="Fri, 13 Jun 2008 19:18:42 +0000"/>
                            <attachment id="12397741" name="HBASE-546-v2.patch" size="44803" author="nitay" created="Tue, 13 Jan 2009 02:50:45 +0000"/>
                            <attachment id="12397742" name="HBASE-546.patch" size="24884" author="nitay" created="Tue, 13 Jan 2009 02:51:43 +0000"/>
                            <attachment id="12398328" name="hbase-546-v3.patch" size="48416" author="nitay" created="Tue, 20 Jan 2009 20:14:09 +0000"/>
                            <attachment id="12383864" name="zookeeper-config.patch" size="11219" author="jdcryans" created="Wed, 11 Jun 2008 19:03:39 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12399030">HBASE-708</subtask>
                            <subtask id="12409362">HBASE-1031</subtask>
                            <subtask id="12412928">HBASE-1144</subtask>
                            <subtask id="12413678">HBASE-1165</subtask>
                            <subtask id="12412929">HBASE-1145</subtask>
                            <subtask id="12413397">HBASE-1159</subtask>
                            <subtask id="12412930">HBASE-1146</subtask>
                            <subtask id="12412931">HBASE-1147</subtask>
                            <subtask id="12413134">HBASE-1150</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 4 Jun 2008 20:29:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31752</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 38 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h7yn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98552</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>