<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:05:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-15584/HBASE-15584.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-15584] Revisit handling of BackupState#CANCELLED</title>
                <link>https://issues.apache.org/jira/browse/HBASE-15584</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;During review of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-15411&quot; title=&quot;Rewrite backup with Procedure V2 - phase 1&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-15411&quot;&gt;&lt;del&gt;HBASE-15411&lt;/del&gt;&lt;/a&gt;, Enis made the following point:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
nobody puts the backup in cancelled state. setCancelled() is not used. So &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; I abort a backup, who writes to the system table the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; state? 

Not sure whether &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is a phase 1 patch issue or due to &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; patch. We can open a &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; jira and address it there &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; you &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; not want to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; it in &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; patch. 

Also maybe &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; should be named ABORTED rather than CANCELLED.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This issue is to decide whether this state should be kept (e.g. through notification from procedure V2 framework in response to abortion).&lt;/p&gt;

&lt;p&gt;If it is to be kept, the state should be renamed ABORTED.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12955424">HBASE-15584</key>
            <summary>Revisit handling of BackupState#CANCELLED</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12846354">HBASE-14123</parent>
                                    <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Apr 2016 21:57:00 +0000</created>
                <updated>Mon, 13 Jun 2016 20:35:26 +0000</updated>
                            <resolved>Mon, 13 Jun 2016 17:42:39 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="15232483" author="yuzhihong@gmail.com" created="Fri, 8 Apr 2016 16:58:16 +0000"  >&lt;p&gt;Vlad made the following response on review board w.r.t. cancelBackup() command (&lt;a href=&quot;https://reviews.apache.org/r/45729/diff/1/?file=1325585#file1325585line80):&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/45729/diff/1/?file=1325585#file1325585line80):&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;How? Does procedure automatically shutdown M/R jobs in progress?&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="15294343" author="yuzhihong@gmail.com" created="Fri, 20 May 2016 22:02:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;:&lt;br/&gt;
Remember that we took out backup abort in my previous patch.&lt;br/&gt;
Our QE&apos;s feedback about using list_procedures followed by abort_procedure to cancel on-going backup is that the approach is not at all user-friendly.&lt;/p&gt;

&lt;p&gt;Can we rethink how to make cancellation more user friendly ?&lt;/p&gt;</comment>
                            <comment id="15294378" author="mbertozzi" created="Fri, 20 May 2016 22:19:04 +0000"  >&lt;p&gt;what does it mean not user friendly what were they trying to do?&lt;/p&gt;

&lt;p&gt;the current approach is the usual &quot;task manager approach&quot;&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;you start backup&lt;/li&gt;
	&lt;li&gt;your client crash&lt;/li&gt;
	&lt;li&gt;you list what was in progress&lt;/li&gt;
	&lt;li&gt;and you abort what you think you need to abort&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I don&apos;t think there is a much more user friendly way unless you want to add a wal on the client side. &lt;br/&gt;
to resume from where you where and give you back the instance of your object.&lt;/p&gt;

&lt;p&gt;if your client isn&apos;t crashed then you can just call future.abort(), so the problem is only when the client crash&lt;/p&gt;</comment>
                            <comment id="15310751" author="yuzhihong@gmail.com" created="Wed, 1 Jun 2016 17:53:29 +0000"  >&lt;p&gt;Recapping previous discussion from &lt;a href=&quot;https://reviews.apache.org/r/45149/#comment189160&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/45149/#comment189160&lt;/a&gt;&#8203; :&lt;/p&gt;

&lt;p&gt;From myself:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;HMaster#abortBackup() looks up the procedure Id by backup Id and aborts the procedure.&lt;/p&gt;

&lt;p&gt;Using Future#cancel() is geared towards Java client.&lt;/p&gt;

&lt;p&gt;After admin issues backup command (and receiving backupId), the backup process may be quite long. Another admin command (say through shell) would be used to cancel the backup. Since backupTables() API returns backupId to user, providing API to cancel by backupId is more user friendly.&lt;/p&gt;

&lt;p&gt;The user can still list procedures and cancel the selected backup procedure.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;From Enis:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;if we save the procId in the BackupContext and do persist that in the system table before returning back to the client with the backupId, then the client API can accept abort(backupId) then it will look up backupId -&amp;gt; procId and call abort(procId). Just a suggestion.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;From Matteo:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;I still don&apos;t understand why we need two system that do the same thing. &lt;br/&gt;
the procId does already what the backupId does. &lt;br/&gt;
with the difference that we have already a mechanism to list the procedures in progress and abort them. and I don&apos;t see that for backup yet.&lt;/p&gt;

&lt;p&gt;assume the case. your client dies before being able to recive the rpc response from the master or before being able to write the id. how do you look that up? with the procedure you can already do it. I don&apos;t see the point to write the same thing for backup and then have to do a reverse jump to abort the procedure when you ask to abort the backup&lt;/p&gt;&lt;/blockquote&gt;</comment>
                            <comment id="15310758" author="yuzhihong@gmail.com" created="Wed, 1 Jun 2016 17:56:10 +0000"  >&lt;p&gt;Suppose the procID / backupID mapping is written in the hbase:backup table first, after that RPC call returns to the client.&lt;br/&gt;
This would endure the loss of RPC, right ?&lt;/p&gt;</comment>
                            <comment id="15321763" author="yuzhihong@gmail.com" created="Thu, 9 Jun 2016 01:44:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;:&lt;br/&gt;
Can you provide your opinion ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="15321906" author="mbertozzi" created="Thu, 9 Jun 2016 05:15:21 +0000"  >&lt;p&gt;I don&apos;t see an answer to my question about why we need two system that do the same thing and what is the advantage of the backupId over the procId alone. &lt;/p&gt;

&lt;p&gt;if you just want to add an api that does abort(backupId) why the abort(procId) is not enough? how do you find your backupId to pass to the abort()? is there any information/helper that we can add to the listProcedures() that is currently missing? how the user will find which is the backupId that he wants to abort? I guess it will be similar to listProcedures().&lt;/p&gt;

&lt;p&gt;can you provide an example with step by step operations that the user will do to abort the backup? are they different from my comment above (20 may)? I still don&apos;t have clear picture of what is the advantage/difference of the backupId, so I can&apos;t help much at the moment.&lt;/p&gt;</comment>
                            <comment id="15323450" author="romil.choksi" created="Thu, 9 Jun 2016 21:57:22 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt;&lt;br/&gt;
I tried the list_procedures command while I had a couple of full backups in progress.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):008:0&amp;gt; list_procedures
 Id Name State Start_Time Last_Update
 1 CreateTableProcedure (table=hbase:backup) ROLLEDBACK Wed Jun 08 23:42:00 UTC 2016 Wed Jun 08 23:42:00 UTC 2016
 36 FullTableBackupProcedure (targetRootDir=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-test-secure-rc-7:8020/user/hbase) RUNNABLE Thu Jun 09 21:20:44 UTC 2016 Thu Jun 09 21:20:46 UTC 2016
&lt;/span&gt; 37 FullTableBackupProcedure (targetRootDir=hdfs:&lt;span class=&quot;code-comment&quot;&gt;//hbase-test-secure-rc-7:8020/user/hbase) RUNNABLE Thu Jun 09 21:20:46 UTC 2016 Thu Jun 09 21:20:46 UTC 2016
&lt;/span&gt;3 row(s) in 0.0240 seconds
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now just looking at the list_procedures output, I am not sure which procId belongs to which backup process. I can probably take a look at the hbase backup history, and compare the timestamps. Or go through the logs to get the necessary details. In such cases, I think it will be better for the user to have cancel option that takes in backupId and doesn&apos;t have to deal with figuring out the procId.&lt;/p&gt;</comment>
                            <comment id="15323520" author="yuzhihong@gmail.com" created="Thu, 9 Jun 2016 22:32:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt;:&lt;br/&gt;
What do you think of Romil&apos;s comment above ?&lt;/p&gt;</comment>
                            <comment id="15323932" author="mbertozzi" created="Fri, 10 Jun 2016 06:06:59 +0000"  >&lt;p&gt;that shows that FullTableBackupProcedure does not provide enough information to understand which backup is in progress. &lt;br/&gt;
If you look at CreateTableProcedure it tells you which table is working on. and more information can be added. &lt;br/&gt;
(&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=syuanjiang&quot; class=&quot;user-hover&quot; rel=&quot;syuanjiang&quot;&gt;Stephen Yuan Jiang&lt;/a&gt; can provide you more info about how to show more info in the list_procedures)&lt;/p&gt;

&lt;p&gt;so, to me this is just a matter of having the FullTableBackupProcedure providing more info for the list_procedure. there is no need for a backup id and another abort operation.&lt;/p&gt;</comment>
                            <comment id="15324802" author="syuanjiang" created="Fri, 10 Jun 2016 16:54:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt;, current code in &lt;tt&gt;FullTableBackupProcedure#toStringClassDetails&lt;/tt&gt; only contains backup root directory, you can add more information there (eg. such as backupId; or list of tables that backup is running).  &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  @Override
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void toStringClassDetails(StringBuilder sb) {
    sb.append(getClass().getSimpleName());
    sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot; (targetRootDir=&quot;&lt;/span&gt;);
    sb.append(targetRootDir);
    sb.append(&lt;span class=&quot;code-quote&quot;&gt;&quot;)&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Also, I agree with &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=mbertozzi&quot; class=&quot;user-hover&quot; rel=&quot;mbertozzi&quot;&gt;Matteo Bertozzi&lt;/a&gt; that we don&apos;t need backup ID for abort.  For in progress operation, proc Id should be sufficient.   The backup ID is more like meta data that stores in system table for future reference (eg. allows user to find history of backup; or the backup chain mixed with full and incremental).  &lt;/p&gt;</comment>
                            <comment id="15324855" author="yuzhihong@gmail.com" created="Fri, 10 Jun 2016 17:17:15 +0000"  >&lt;p&gt;Thanks for the feedback.&lt;/p&gt;

&lt;p&gt;See if the change to FullTableBackupProcedure is good.&lt;br/&gt;
If so, I will modify IncrementalTableBackupProcedure as well.&lt;/p&gt;</comment>
                            <comment id="15325274" author="syuanjiang" created="Fri, 10 Jun 2016 21:00:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt;, the following logic will leave a &apos;,&apos; at the end of list:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;   
+      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (TableName table : tableList) {
+	      sb.append(table).append(&lt;span class=&quot;code-quote&quot;&gt;&quot;,&quot;&lt;/span&gt;);
+	 }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15325299" author="yuzhihong@gmail.com" created="Fri, 10 Jun 2016 21:17:44 +0000"  >&lt;p&gt;Patch v2 addressed Stephen&apos;s comment.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=vrodionov&quot; class=&quot;user-hover&quot; rel=&quot;vrodionov&quot;&gt;Vladimir Rodionov&lt;/a&gt;:&lt;br/&gt;
Mind taking a look as well ?&lt;br/&gt;
BackupState#CANCELLED has been dropped.&lt;/p&gt;</comment>
                            <comment id="15325316" author="syuanjiang" created="Fri, 10 Jun 2016 21:29:15 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt;, looks good (with the assumption that &lt;tt&gt;tableList.size() &amp;gt; 0&lt;/tt&gt; is always true).&lt;/p&gt;</comment>
                            <comment id="15327784" author="vrodionov" created="Mon, 13 Jun 2016 17:21:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt;, what will happen to active backup session when cluster gets shut down? We need some abort/clean up functionality?&lt;/p&gt;

&lt;p&gt;I am OK with the patch as long as we have separate JIRAs for Cancel/Abort backup restore (and we have in Phase 3)&lt;/p&gt;</comment>
                            <comment id="15327795" author="yuzhihong@gmail.com" created="Mon, 13 Jun 2016 17:28:00 +0000"  >&lt;p&gt;When cluster gets back, the backup procedure would resume execution.&lt;br/&gt;
Cancelling the backup is up to the user / admin.&lt;/p&gt;</comment>
                            <comment id="15327816" author="yuzhihong@gmail.com" created="Mon, 13 Jun 2016 17:42:39 +0000"  >&lt;p&gt;Thanks for the reviews.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12809494" name="15584.v1.txt" size="797" author="yuzhihong@gmail.com" created="Fri, 10 Jun 2016 17:17:15 +0000"/>
                            <attachment id="12809553" name="15584.v2.txt" size="7304" author="yuzhihong@gmail.com" created="Fri, 10 Jun 2016 21:17:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 20 May 2016 22:19:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            26 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2vjdj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>