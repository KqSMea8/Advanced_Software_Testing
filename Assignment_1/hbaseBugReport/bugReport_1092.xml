<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:50:40 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1092/HBASE-1092.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1092] FileNotFoundException trying to get index file size for metrics</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1092</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This is an odd one.  We open a region and load up its store files.  Part of loading store files is confirming presence of MapFile index files (reconstituting them even if missing).  The below log is of region open and then seconds later, failing to find the index files when we go to look at them for sake of metrics:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2008-12-28 00:06:19,330 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Worker: MSG_REGION_OPEN: content,10a1c144cf729885001e71a5ff5108dc,1230416158498
2008-12-28 00:06:19,330 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Opening region content,10a1c144cf729885001e71a5ff5108dc,1230416158498/2030495720
2008-12-28 00:06:19,337 DEBUG org.apache.hadoop.hbase.regionserver.HStore: loaded /data/hbase/content/2030495720/url/info/4139998553412763261, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, sequence id=13310628, length=54275, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2008-12-28 00:06:19,368 DEBUG org.apache.hadoop.hbase.regionserver.HStore: loaded /data/hbase/content/2030495720/url/info/4467064002967944271, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, sequence id=9760762, length=432827, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2008-12-28 00:06:19,373 DEBUG org.apache.hadoop.hbase.regionserver.HStore: loaded /data/hbase/content/2030495720/url/info/5563124412728188459, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, sequence id=12406630, length=22596, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2008-12-28 00:06:19,379 DEBUG org.apache.hadoop.hbase.regionserver.HStore: loaded /data/hbase/content/2030495720/url/info/7040855870376599550, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, sequence id=12795530, length=4163, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2008-12-28 00:06:19,379 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Loaded 4 file(s) in hstore 2030495720/url, max sequence id 13310628
2008-12-28 00:06:19,496 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Applied 0, skipped 2078 because sequence id &amp;lt;= 13310628
2008-12-28 00:06:19,687 DEBUG org.apache.hadoop.hbase.regionserver.HStore: loaded /data/hbase/content/2030495720/info/info/4076087643455354411, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, sequence id=9760762, length=1491212, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2008-12-28 00:06:19,691 DEBUG org.apache.hadoop.hbase.regionserver.HStore: loaded /data/hbase/content/2030495720/info/info/4178444212265859440, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, sequence id=13310628, length=156148, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2008-12-28 00:06:19,697 DEBUG org.apache.hadoop.hbase.regionserver.HStore: loaded /data/hbase/content/2030495720/info/info/7223110203696352566, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, sequence id=12406630, length=84614, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2008-12-28 00:06:19,703 DEBUG org.apache.hadoop.hbase.regionserver.HStore: loaded /data/hbase/content/2030495720/info/info/8629305049543986640, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, sequence id=12795530, length=9293, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2008-12-28 00:06:19,704 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Loaded 4 file(s) in hstore 2030495720/info, max sequence id 13310628
2008-12-28 00:06:19,773 DEBUG org.apache.hadoop.hbase.regionserver.HStore: moving /data/hbase/content/compaction.dir/888098363/content/mapfiles/3159110292991346789 to /data/hbase/content/888098363/content/mapfiles/6086595812879433437
2008-12-28 00:06:19,787 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Completed  compaction of 888098363/content store size is 172.4m
2008-12-28 00:06:19,791 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Compaction size of 888098363/info: 1.4m; Skipped 2 file(s), size: 1221094
2008-12-28 00:06:19,801 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Started compaction of 2 file(s)  into /data/hbase/content/compaction.dir/888098363/info/mapfiles/2317624608256855622
2008-12-28 00:06:19,821 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Applied 0, skipped 2078 because sequence id &amp;lt;= 13310628
2008-12-28 00:06:19,879 DEBUG org.apache.hadoop.hbase.regionserver.HStore: moving /data/hbase/content/compaction.dir/888098363/info/mapfiles/2317624608256855622 to /data/hbase/content/888098363/info/mapfiles/2738033219360665217
2008-12-28 00:06:19,883 DEBUG org.apache.hadoop.hbase.regionserver.HStore: loaded /data/hbase/content/2030495720/content/info/2253403598042963153, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, sequence id=13310628, length=12491312, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2008-12-28 00:06:19,887 DEBUG org.apache.hadoop.hbase.regionserver.HStore: loaded /data/hbase/content/2030495720/content/info/4596284995168293361, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, sequence id=9760762, length=158138153, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2008-12-28 00:06:19,896 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Completed  compaction of 888098363/info store size is 1.4m
2008-12-28 00:06:19,898 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Compaction size of 888098363/url: 405.9k; Skipped 2 file(s), size: 339984
2008-12-28 00:06:19,904 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Started compaction of 2 file(s)  into /data/hbase/content/compaction.dir/888098363/url/mapfiles/1108952767537472093
2008-12-28 00:06:19,924 DEBUG org.apache.hadoop.hbase.regionserver.HStore: loaded /data/hbase/content/2030495720/content/info/7464468628166271570, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, sequence id=12406630, length=11058492, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2008-12-28 00:06:19,930 DEBUG org.apache.hadoop.hbase.regionserver.HStore: loaded /data/hbase/content/2030495720/content/info/7703689073557380324, isReference=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, sequence id=12795530, length=183695, majorCompaction=&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;
2008-12-28 00:06:19,931 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Loaded 4 file(s) in hstore 2030495720/content, max sequence id 13310628
2008-12-28 00:06:19,958 DEBUG org.apache.hadoop.hbase.regionserver.HStore: moving /data/hbase/content/compaction.dir/888098363/url/mapfiles/1108952767537472093 to /data/hbase/content/888098363/url/mapfiles/4113677425818108069
2008-12-28 00:06:19,976 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Completed  compaction of 888098363/url store size is 403.6k
2008-12-28 00:06:19,978 INFO org.apache.hadoop.hbase.regionserver.HRegion: compaction completed on region content,846510f382e9a0ae5655f03cb772830d,1230384248550 in 0sec
2008-12-28 00:06:19,979 INFO org.apache.hadoop.hbase.regionserver.HRegion: starting  compaction on region content,e2f10daf46269ad3cc25766aa3bf48c4,1230416165744
2008-12-28 00:06:19,981 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Compaction size of 2100409777/content: 170.2m; Skipped 1 file(s), size: 144757669
2008-12-28 00:06:19,996 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Started compaction of 2 file(s)  into /data/hbase/content/compaction.dir/2100409777/content/mapfiles/7166480659109830957
2008-12-28 00:06:20,033 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Applied 0, skipped 2078 because sequence id &amp;lt;= 13310628
2008-12-28 00:06:20,127 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Deleting old log file: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//sjdc-atr-dc-1.atr.trendmicro.com:50000/data/hbase/content/2030495720/oldlogfile.log
&lt;/span&gt;2008-12-28 00:06:20,137 DEBUG org.apache.hadoop.hbase.regionserver.HRegion: Next sequence id &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region content,10a1c144cf729885001e71a5ff5108dc,1230416158498 is 13310629
2008-12-28 00:06:20,138 INFO org.apache.hadoop.hbase.regionserver.HRegion: region content,10a1c144cf729885001e71a5ff5108dc,1230416158498/2030495720 available
....
2008-12-28 00:06:21,008 DEBUG org.apache.hadoop.hbase.regionserver.HStore: Started compaction of 2 file(s)  into /data/hbase/content/compaction.dir/2100409777/url/mapfiles/744229794307693860
2008-12-28 00:06:21,030 WARN org.apache.hadoop.hbase.regionserver.HRegionServer: error getting store file index size &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 2030495720/content: java.io.FileNotFoundException: File does not exist: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//sjdc-atr-dc-1.atr.trendmicro.com:50000/data/hbase/content/2030495720/content/mapfiles/7703689073557380324/index
&lt;/span&gt;        at org.apache.hadoop.dfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:394)
        at org.apache.hadoop.hbase.regionserver.HStoreFile.indexLength(HStoreFile.java:488)
        at org.apache.hadoop.hbase.regionserver.HStore.getStorefilesIndexSize(HStore.java:2174)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.doMetrics(HRegionServer.java:936)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:333)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)

2008-12-28 00:06:21,032 WARN org.apache.hadoop.hbase.regionserver.HRegionServer: error getting store file index size &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 2030495720/info: java.io.FileNotFoundException: File does not exist: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//sjdc-atr-dc-1.atr.trendmicro.com:50000/data/hbase/content/2030495720/info/mapfiles/8629305049543986640/index
&lt;/span&gt;        at org.apache.hadoop.dfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:394)
        at org.apache.hadoop.hbase.regionserver.HStoreFile.indexLength(HStoreFile.java:488)
        at org.apache.hadoop.hbase.regionserver.HStore.getStorefilesIndexSize(HStore.java:2174)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.doMetrics(HRegionServer.java:936)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:333) 
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)

2008-12-28 00:06:21,053 WARN org.apache.hadoop.hbase.regionserver.HRegionServer: error getting store file index size &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; 2030495720/url: java.io.FileNotFoundException: File does not exist: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//sjdc-atr-dc-1.atr.trendmicro.com:50000/data/hbase/content/2030495720/url/mapfiles/7040855870376599550/index
&lt;/span&gt;        at org.apache.hadoop.dfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:394)
        at org.apache.hadoop.hbase.regionserver.HStoreFile.indexLength(HStoreFile.java:488)
        at org.apache.hadoop.hbase.regionserver.HStore.getStorefilesIndexSize(HStore.java:2174)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.doMetrics(HRegionServer.java:936)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:333)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;apurtell cluster; trunk on hadoop 0.18.1.&lt;/p&gt;</environment>
        <key id="12411386">HBASE-1092</key>
            <summary>FileNotFoundException trying to get index file size for metrics</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="5">Cannot Reproduce</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Sun, 28 Dec 2008 23:05:05 +0000</created>
                <updated>Thu, 25 Jun 2009 22:50:47 +0000</updated>
                            <resolved>Thu, 25 Jun 2009 22:50:47 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12659487" author="stack" created="Sun, 28 Dec 2008 23:18:43 +0000"  >&lt;p&gt;This metrics exception goes on and on in the logs; at a minium, should just keep going w/o metric.  Not end of world if can&apos;t get a metric.&lt;/p&gt;

&lt;p&gt;Looking more, this is serious.  Getting metric is at head of the HRS#run loop.  Means that the HRS does nothing else but this exception.&lt;/p&gt;

&lt;p&gt;Bringing into 0.19.0.&lt;/p&gt;
</comment>
                            <comment id="12659763" author="stack" created="Tue, 30 Dec 2008 07:56:14 +0000"  >&lt;p&gt;Looking more, the log would seem to say the index file was present when we opened the Store but looking at the code, it might not have been; our check a file is empty says file is empty IF FILE EXISTS.  I&apos;m changing the check for empty file to say file is empty if doesn&apos;t exist (especially as if it comes back that the index file is not present, we can actually effect a repair).&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/java/org/apache/hadoop/hbase/regionserver/HStore.java
===================================================================
--- src/java/org/apache/hadoop/hbase/regionserver/HStore.java   (revision 730056)
+++ src/java/org/apache/hadoop/hbase/regionserver/HStore.java   (working copy)
@@ -558,8 +558,7 @@
    */
   &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isEmptyFile(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Path f)
   &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
-    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs.exists(f) &amp;amp;&amp;amp;
-      &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs.getFileStatus(f).getLen() == 0;
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; !&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs.exists(f) || &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.fs.getFileStatus(f).getLen() == 0;
   }

   /**
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Need to test the above doesn&apos;t break &apos;normal&apos; operation.&lt;/p&gt;

&lt;p&gt;I think that regards this issue, something had happened earlier in hdfs.  This stuck in metrics is just a symptom.  Regions should just not deploy if can&apos;t have an index on store file; i.e. fail earlier.&lt;/p&gt;</comment>
                            <comment id="12659828" author="apurtell" created="Tue, 30 Dec 2008 15:24:31 +0000"  >&lt;p&gt;I&apos;m getting FNF on indexes on my cluster. I deployed the above change locally. &lt;/p&gt;</comment>
                            <comment id="12659859" author="stack" created="Tue, 30 Dec 2008 17:38:08 +0000"  >&lt;p&gt;Can I see one of the stack traces Andrew?&lt;/p&gt;</comment>
                            <comment id="12659935" author="stack" created="Tue, 30 Dec 2008 20:42:09 +0000"  >&lt;p&gt;Committed the change in empty file symantecs.  Should flag missing files earlier.&lt;/p&gt;

&lt;p&gt;Moving this issue out of 0.19.0.  We should address fact that failure in metrics causes HRS to do nothing else but the root of this issue is an HDFS issue.  That we&apos;re addressing in other issues in 0.19.0 and elsewhere.&lt;/p&gt;</comment>
                            <comment id="12660003" author="stack" created="Wed, 31 Dec 2008 01:51:37 +0000"  >&lt;p&gt;The above commit broke the build.  I want to figure why before backing it out.  I&apos;d like to keep the patch in if I can.&lt;/p&gt;</comment>
                            <comment id="12660127" author="stack" created="Wed, 31 Dec 2008 19:06:30 +0000"  >&lt;p&gt;This is different but logging it here because &apos;weird&apos; FNFE issue:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2008-12-31 02:18:35,119 [regionserver/0:0:0:0:0:0:0:0:60020.worker] DEBUG org.apache.hadoop.hbase.regionserver.HRegion: waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; compaction to complete &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; region TestTable,0000515246,1230688952892
2008-12-31 02:18:35,119 [regionserver/0:0:0:0:0:0:0:0:60020.cacheFlusher] FATAL org.apache.hadoop.hbase.regionserver.MemcacheFlusher: Replay of hlog required. Forcing server shutdown
org.apache.hadoop.hbase.DroppedSnapshotException: region: TestTable,0000515246,1230688952892
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:880)
        at org.apache.hadoop.hbase.regionserver.HRegion.flushcache(HRegion.java:773)
        at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.flushRegion(MemcacheFlusher.java:227)
        at org.apache.hadoop.hbase.regionserver.MemcacheFlusher.run(MemcacheFlusher.java:137)
Caused by: java.io.FileNotFoundException: File does not exist: hdfs:&lt;span class=&quot;code-comment&quot;&gt;//aa0-000-12.u.powerset.com:9000/hbasetrunk2/TestTable/1485814348/info/mapfiles/7021491802461813204/data
&lt;/span&gt;        at org.apache.hadoop.hdfs.DistributedFileSystem.getFileStatus(DistributedFileSystem.java:394)
        at org.apache.hadoop.fs.FileSystem.getLength(FileSystem.java:679)
        at org.apache.hadoop.hbase.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1431)
        at org.apache.hadoop.hbase.io.SequenceFile$Reader.&amp;lt;init&amp;gt;(SequenceFile.java:1426)
        at org.apache.hadoop.hbase.io.HBaseMapFile$HBaseReader$1.&amp;lt;init&amp;gt;(HBaseMapFile.java:100)
        at org.apache.hadoop.hbase.io.HBaseMapFile$HBaseReader.createDataFileReader(HBaseMapFile.java:100)
        at org.apache.hadoop.hbase.io.MapFile$Reader.open(MapFile.java:292)
        at org.apache.hadoop.hbase.io.HBaseMapFile$HBaseReader.&amp;lt;init&amp;gt;(HBaseMapFile.java:79)
        at org.apache.hadoop.hbase.io.BloomFilterMapFile$Reader.&amp;lt;init&amp;gt;(BloomFilterMapFile.java:65)
        at org.apache.hadoop.hbase.regionserver.HStoreFile.getReader(HStoreFile.java:443)
        at org.apache.hadoop.hbase.regionserver.HStore.updateReaders(HStore.java:719)
        at org.apache.hadoop.hbase.regionserver.HStore.internalFlushCache(HStore.java:693)
        at org.apache.hadoop.hbase.regionserver.HStore.flushCache(HStore.java:629)
        at org.apache.hadoop.hbase.regionserver.HRegion.internalFlushcache(HRegion.java:865)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Above was trunk.  Didn&apos;t have the change to isEmptyFile in place.  Above is saying the file we just wrote flushing doesn&apos;t exist when we go to open a Reader on it.&lt;/p&gt;</comment>
                            <comment id="12660130" author="apurtell" created="Wed, 31 Dec 2008 19:29:43 +0000"  >&lt;p&gt;Are you seeing anything like this in the master log?&lt;/p&gt;

&lt;p&gt;2008-12-30 05:21:20,673 INFO org.apache.hadoop.fs.FSNamesystem: Recovering lease=&lt;span class=&quot;error&quot;&gt;&amp;#91;Lease.  Holder: DFSClient_85822244, pendingcreates: 2&amp;#93;&lt;/span&gt;, src=/data/hbase/content/1486100541/content/mapfiles/6488314919128681661/data&lt;br/&gt;
2008-12-30 05:21:20,673 WARN org.apache.hadoop.dfs.StateChange: BLOCK* internalReleaseLease: No blocks found, lease removed.&lt;/p&gt;</comment>
                            <comment id="12660131" author="stack" created="Wed, 31 Dec 2008 19:32:45 +0000"  >&lt;p&gt;No.  Not seeing that.  Still looking...&lt;/p&gt;</comment>
                            <comment id="12660157" author="stack" created="Wed, 31 Dec 2008 22:34:37 +0000"  >&lt;p&gt;Amended committed patch; don&apos;t check for empty file if reference:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: src/java/org/apache/hadoop/hbase/regionserver/HStore.java
===================================================================
--- src/java/org/apache/hadoop/hbase/regionserver/HStore.java   (revision 730325)
+++ src/java/org/apache/hadoop/hbase/regionserver/HStore.java   (working copy)
@@ -457,14 +457,15 @@
           &lt;span class=&quot;code-quote&quot;&gt;&quot;Cleaned up info file.  Continuing...Probable DATA LOSS!!!&quot;&lt;/span&gt;);
         &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
       }
-      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isEmptyDataFile(mapfile)) {
+      &lt;span class=&quot;code-comment&quot;&gt;// References don&apos;t have data or index components under mapfile.
&lt;/span&gt;+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isReference &amp;amp;&amp;amp; isEmptyDataFile(mapfile)) {
         curfile.delete();
         &lt;span class=&quot;code-comment&quot;&gt;// We can have empty data file &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; data loss in hdfs.
&lt;/span&gt;         LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Mapfile &quot;&lt;/span&gt; + mapfile.toString() + &lt;span class=&quot;code-quote&quot;&gt;&quot; has empty data. &quot;&lt;/span&gt; +
           &lt;span class=&quot;code-quote&quot;&gt;&quot;Deleting.  Continuing...Probable DATA LOSS!!!  See HBASE-646.&quot;&lt;/span&gt;);
         &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
       }
-      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isEmptyIndexFile(mapfile)) {
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!isReference &amp;amp;&amp;amp; isEmptyIndexFile(mapfile)) {
         &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
           &lt;span class=&quot;code-comment&quot;&gt;// Try fixing &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; file.. &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; we can.  Use the hbase version of fix.
&lt;/span&gt;           &lt;span class=&quot;code-comment&quot;&gt;// Need to remove the old index file first &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; fix won&apos;t go ahead.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12724332" author="stack" created="Thu, 25 Jun 2009 22:50:47 +0000"  >&lt;p&gt;Haven&apos;t seen since.  Resolving.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 30 Dec 2008 15:24:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25567</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 26 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hb9z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99089</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>