<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:12:11 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10273/HBASE-10273.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10273] AssignmentManager.regions and AssignmentManager.servers are not always updated in tandem</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10273</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;By definition, AssignmentManager.servers and AssignmentManager.regions are tied and should be updated in tandem with each other under a lock on AssignmentManager.regions, but there are two places where this protocol is broken.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12687105">HBASE-10273</key>
            <summary>AssignmentManager.regions and AssignmentManager.servers are not always updated in tandem</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="fenghh">Honghua Feng</assignee>
                                    <reporter username="fenghh">Honghua Feng</reporter>
                        <labels>
                    </labels>
                <created>Fri, 3 Jan 2014 01:58:50 +0000</created>
                <updated>Tue, 21 Jan 2014 01:31:40 +0000</updated>
                            <resolved>Mon, 6 Jan 2014 18:32:56 +0000</resolved>
                                    <version>0.94.16</version>
                                    <fixVersion>0.94.16</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13861095" author="fenghh" created="Fri, 3 Jan 2014 02:01:52 +0000"  >&lt;p&gt;patch for 0.94(&lt;a href=&quot;http://svn.apache.org/repos/asf/hbase/branches/0.94&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/repos/asf/hbase/branches/0.94&lt;/a&gt;) is attached. this bug exists for all 0.94 sub-branches. it needs more investigation if its existence for trunk since big difference between 0.94 and trunk for AssignmentManager&lt;/p&gt;</comment>
                            <comment id="13861172" author="lhofhansl" created="Fri, 3 Jan 2014 03:51:19 +0000"  >&lt;p&gt;Looks reasonable. Why have we not seen any issues from this, though?&lt;/p&gt;</comment>
                            <comment id="13861191" author="xieliang007" created="Fri, 3 Jan 2014 04:19:56 +0000"  >&lt;p&gt;0.95+ should be fine, see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6272&quot; title=&quot;In-memory region state is inconsistent&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6272&quot;&gt;&lt;del&gt;HBASE-6272&lt;/del&gt;&lt;/a&gt; if i am correct. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13861196" author="fenghh" created="Fri, 3 Jan 2014 04:30:18 +0000"  >&lt;p&gt;Two possibilities:&lt;br/&gt;
1. These buggy code has never been hit in production environment&lt;br/&gt;
2. Maybe some issues did arise due to these buggy code, but are ignored or worked around , or nobody ever successfully dig from the symptom to these real root cause. Actually &lt;b&gt;currently&lt;/b&gt; HMaster does have much inconsistency, besides the two places exposed by this jira, we don&apos;t have confidence that we have figured out the root causes of all of them and fixed them, right? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;It&apos;s not every bug, especially of a large-scale distributed system such as HBase, can be exposed by production running or covered by unit-test, until it does show itself someday.&lt;/p&gt;</comment>
                            <comment id="13861214" author="ram_krish" created="Fri, 3 Jan 2014 04:58:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fenghh&quot; class=&quot;user-hover&quot; rel=&quot;fenghh&quot;&gt;Honghua Feng&lt;/a&gt;&lt;br/&gt;
The fix seems reasonable.  I remember we had a JIRA raised some time back where we checked for all the places where the regions map and server map are updated in tandem&lt;/p&gt;</comment>
                            <comment id="13861226" author="fenghh" created="Fri, 3 Jan 2014 05:13:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; : Sounds great. I found this inconsistency and fixed it when reviewing our internal 0.94.3 code base several months ago, and opened jira together with other accumulated bug fixes in a batch mode these days, so do less home work to find if there is already jira for it except I found it&apos;s fixed when rebasing the fix against the latest code from HBase svn repository. At least this bug still exists in latest 0.94.16. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13861235" author="fenghh" created="Fri, 3 Jan 2014 05:38:10 +0000"  >&lt;p&gt;Yes, from 0.95+ on &lt;b&gt;regions and servers&lt;/b&gt; are encapsulated in RegionStates, same as trunk, at least from AssignmentManager it looks like these two inconsistency don&apos;t exist any longer &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=xieliang007&quot; class=&quot;user-hover&quot; rel=&quot;xieliang007&quot;&gt;Liang Xie&lt;/a&gt; / &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13861273" author="lhofhansl" created="Fri, 3 Jan 2014 06:55:33 +0000"  >&lt;p&gt;Checked the code. +1 on patch.&lt;br/&gt;
Will commit, unless I hear objections.&lt;/p&gt;</comment>
                            <comment id="13861676" author="jxiang" created="Fri, 3 Jan 2014 17:17:55 +0000"  >&lt;p&gt;+1.&lt;/p&gt;</comment>
                            <comment id="13861987" author="lhofhansl" created="Fri, 3 Jan 2014 22:57:07 +0000"  >&lt;p&gt;Do we need the warning here:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+              &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sn == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+                LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;No region server &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; + region);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Could serverRegions be null?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+                Set&amp;lt;HRegionInfo&amp;gt; serverRegions = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.servers.get(sn);
+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!serverRegions.remove(region)) {
+                  LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;No &quot;&lt;/span&gt; + region + &lt;span class=&quot;code-quote&quot;&gt;&quot; on &quot;&lt;/span&gt; + sn);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I guess, I&apos;d prefer:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-              &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regions.remove(region);
+              ServerName sn = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regions.remove(region);
+              &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sn != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+                Set&amp;lt;HRegionInfo&amp;gt; serverRegions = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.servers.get(sn);
+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (serverRegions == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || !serverRegions.remove(region)) {
+                  LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;No &quot;&lt;/span&gt; + region + &lt;span class=&quot;code-quote&quot;&gt;&quot; on &quot;&lt;/span&gt; + sn);
+                }
+              }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13862124" author="fenghh" created="Sat, 4 Jan 2014 01:29:47 +0000"  >&lt;p&gt;new patch per &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;&apos;s feedback is attached, thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13863205" author="lhofhansl" created="Mon, 6 Jan 2014 18:32:56 +0000"  >&lt;p&gt;Committed to 0.94. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=fenghh&quot; class=&quot;user-hover&quot; rel=&quot;fenghh&quot;&gt;Honghua Feng&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13863299" author="hudson" created="Mon, 6 Jan 2014 19:27:34 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.94-security #379 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/379/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/379/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10273&quot; title=&quot;AssignmentManager.regions and AssignmentManager.servers are not always updated in tandem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10273&quot;&gt;&lt;del&gt;HBASE-10273&lt;/del&gt;&lt;/a&gt; AssignmentManager.regions and AssignmentManager.servers are not always updated in tandem (Feng Honghua) (larsh: rev 1555966)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13863386" author="hudson" created="Mon, 6 Jan 2014 20:42:55 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94 #1252 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/1252/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/1252/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10273&quot; title=&quot;AssignmentManager.regions and AssignmentManager.servers are not always updated in tandem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10273&quot;&gt;&lt;del&gt;HBASE-10273&lt;/del&gt;&lt;/a&gt; AssignmentManager.regions and AssignmentManager.servers are not always updated in tandem (Feng Honghua) (larsh: rev 1555966)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13863404" author="hudson" created="Mon, 6 Jan 2014 20:55:58 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.94-JDK7 #19 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-JDK7/19/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-JDK7/19/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10273&quot; title=&quot;AssignmentManager.regions and AssignmentManager.servers are not always updated in tandem&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10273&quot;&gt;&lt;del&gt;HBASE-10273&lt;/del&gt;&lt;/a&gt; AssignmentManager.regions and AssignmentManager.servers are not always updated in tandem (Feng Honghua) (larsh: rev 1555966)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12621211" name="HBASE-10273-0.94_v0.patch" size="1228" author="fenghh" created="Fri, 3 Jan 2014 02:01:52 +0000"/>
                            <attachment id="12621441" name="HBASE-10273-0.94_v1.patch" size="1168" author="fenghh" created="Sat, 4 Jan 2014 01:29:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 3 Jan 2014 03:51:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366100</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 49 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1r3u7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>366411</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>