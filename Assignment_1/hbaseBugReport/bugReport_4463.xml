<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:19:09 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4463/HBASE-4463.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4463] Run more aggressive compactions during off peak hours</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4463</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;The number of iops on the disk and the top of the rack bandwidth utilization at off peak hours is much lower than at peak hours depending on the application usage pattern. We can utilize this knowledge to improve the performance of the HBase cluster by increasing the compact selection ratio to a much larger value during off-peak hours than otherwise - increasing hbase.hstore.compaction.ratio (1.2 default) to hbase.hstore.compaction.ratio.offpeak (5 default). This will help reduce the average number of files per store.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12524345">HBASE-4463</key>
            <summary>Run more aggressive compactions during off peak hours</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="karthik.ranga">Karthik Ranganathan</assignee>
                                    <reporter username="karthik.ranga">Karthik Ranganathan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 22 Sep 2011 21:54:52 +0000</created>
                <updated>Fri, 12 Oct 2012 05:35:04 +0000</updated>
                            <resolved>Wed, 30 Nov 2011 23:48:17 +0000</resolved>
                                                    <fixVersion>0.94.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13112949" author="yuzhihong@gmail.com" created="Thu, 22 Sep 2011 21:58:48 +0000"  >&lt;p&gt;This is a great idea.&lt;br/&gt;
How do we determine the off peak hours ?&lt;/p&gt;</comment>
                            <comment id="13113017" author="karthik.ranga" created="Thu, 22 Sep 2011 23:24:41 +0000"  >&lt;p&gt;Initially we are going to specify a start and stop for off peak hours... a more automatic detection based on response latencies and data read/transferred could be done, but is much harder to get right.&lt;/p&gt;</comment>
                            <comment id="13113040" author="dhruba" created="Thu, 22 Sep 2011 23:54:59 +0000"  >&lt;p&gt;Can we do something like ability to throttle the max bandwidth/server allowed for compaction? (A similar philosophy is used the HDFS to ensure that background replication does not swamp the network).&lt;/p&gt;</comment>
                            <comment id="13113665" author="stack" created="Fri, 23 Sep 2011 19:05:46 +0000"  >&lt;p&gt;@Dhruba We need this too.  How would we do it?&lt;/p&gt;</comment>
                            <comment id="13113847" author="karthik.ranga" created="Sat, 24 Sep 2011 00:45:25 +0000"  >&lt;p&gt;@Stack - we can find the exact amount of data we are writing to the dfs (only hfile blocks will contribute to this during compactions). So adding a threshold like this is not too hard... but there could be disk iops pressure (instead of network bandwidth) and detecting that would be hard. So we would still need to set off-peak time.&lt;/p&gt;

&lt;p&gt;I was trying to come up with a more generic solution but that involves setting up a feedback loop inside the regionserver - keep track of max, min and average latencies over the last k days (would have to store this in META or some other location as it needs to persist beyond restarts). Need to remove any spikes in the values. When we run an aggressive compaction, we need to make sure the latencies are still acceptable, otherwise dont run aggressive compactions. This is much harder to get right though.&lt;/p&gt;</comment>
                            <comment id="13114116" author="kannanm" created="Sun, 25 Sep 2011 01:43:02 +0000"  >&lt;p&gt;Dhruba: Just wanted to point out that one knob that exists today to throttle the number of concurrent compactions is the size of the compaction thread pools. We can drop it all the way down to 1 thread. If further throttling is needed, then it&apos;ll require some new scheme.&lt;/p&gt;</comment>
                            <comment id="13151703" author="phabricator@reviews.facebook.net" created="Thu, 17 Nov 2011 01:03:51 +0000"  >&lt;p&gt;Karthik requested code review of &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Run more aggressive compactions during off peak hours&quot;.&lt;br/&gt;
Reviewers: JIRA&lt;/p&gt;

&lt;p&gt;  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; Run more aggressive compactions during off peak hours&lt;/p&gt;

&lt;p&gt;  Increases the compact selection ratio from 1.3 to 5 at off-peak hours. This&lt;br/&gt;
  will help utilize the available iops and bandwidth to decrease average num of&lt;br/&gt;
  files per store. Only one such aggressive compaction is queued per store at any&lt;br/&gt;
  point.&lt;/p&gt;

&lt;p&gt;  The number of iops on the disk and the top of the rack bandwidth utilization at off peak hours is much lower than at peak hours depending on the application usage pattern. We can utilize this knowledge to improve the performance of the HBase cluster by increasing the compact selection ratio to a much larger value during off-peak hours than otherwise - increasing hbase.hstore.compaction.ratio (1.2 default) to hbase.hstore.compaction.ratio.offpeak (5 default). This will help reduce the average number of files per store.&lt;/p&gt;

&lt;p&gt;TEST PLAN&lt;br/&gt;
  Started running the unit tests.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D471&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactSelection.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionRequest.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactSelection.java&lt;/p&gt;

&lt;p&gt;MANAGE HERALD DIFFERENTIAL RULES&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/view/differential/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/view/differential/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;WHY DID I GET THIS EMAIL?&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/herald/transcript/993/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/herald/transcript/993/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Tip: use the X-Herald-Rules header to filter Herald messages in your client.&lt;/p&gt;</comment>
                            <comment id="13151710" author="phabricator@reviews.facebook.net" created="Thu, 17 Nov 2011 01:27:51 +0000"  >&lt;p&gt;nspiegelberg has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Run more aggressive compactions during off peak hours&quot;.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactSelection.java:248-250 need to +24 or else it will fail at night, correct?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D471&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13151829" author="phabricator@reviews.facebook.net" created="Thu, 17 Nov 2011 05:47:51 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Run more aggressive compactions during off peak hours&quot;.&lt;/p&gt;

&lt;p&gt;  This is a useful feature.&lt;br/&gt;
  Currently off-peak time is at hour level. It would be nice to support minute-level off-peak time.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:989 filesToCompact is overwritten here.&lt;br/&gt;
  What about the assignment at line 980 above ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:1074 compactSelection.getFilesToCompact() is repeatedly called.&lt;br/&gt;
  Shall we store the return value in a variable ?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactSelection.java:62 Should read &apos;Off-peak time&apos;&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactSelection.java:153 This method isn&apos;t used.&lt;br/&gt;
  Shall we remove it ?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D471&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13151846" author="lhofhansl" created="Thu, 17 Nov 2011 06:12:25 +0000"  >&lt;p&gt;re: previous discussions. Automatically detecting a good time to perform more aggressive compactions would be nice; my vote would be to let&apos;s get this simpler time-based scheme in first.&lt;/p&gt;

&lt;p&gt;@Ted: Isn&apos;t hour-granularity good enough?&lt;/p&gt;</comment>
                            <comment id="13151849" author="phabricator@reviews.facebook.net" created="Thu, 17 Nov 2011 06:18:51 +0000"  >&lt;p&gt;nspiegelberg has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Run more aggressive compactions during off peak hours&quot;.&lt;/p&gt;

&lt;p&gt;  @ted : I think allowing minute-level granularity might be little over optimizing.  It just means that aggressive compact selection ends then.  An agressive compaction can be sitting in the compaction queue and actually executing after the ending time.  Therefore, you want to disable aggressive compactions a decent bit of time before your traffic begins to pick up.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D471&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13151855" author="phabricator@reviews.facebook.net" created="Thu, 17 Nov 2011 06:30:52 +0000"  >&lt;p&gt;tedyu has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Run more aggressive compactions during off peak hours&quot;.&lt;/p&gt;

&lt;p&gt;  Hour-granularity is good for now.&lt;br/&gt;
  Nicolas&apos; comment makes sense.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java:1061 Shall we log the value for &quot;hbase.offpeak.end.hour&quot; so that we know the (possible) delay beyond end time ?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D471&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13151856" author="phabricator@reviews.facebook.net" created="Thu, 17 Nov 2011 06:30:53 +0000"  >&lt;p&gt;lhofhansl has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Run more aggressive compactions during off peak hours&quot;.&lt;/p&gt;

&lt;p&gt;  Great idea.&lt;/p&gt;

&lt;p&gt;INLINE COMMENTS&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:1074 Or use an iterator with a conditioned break?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:1106 Should we move functionality like this into CompactionSelection?&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:1120 Might be good to have a CompationSelection.numFiles() (or similar) method&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java:992 Add method to CompactionSelection so that we do not constantly &quot;leak&quot; filesToCompact?&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D471&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13160456" author="phabricator@reviews.facebook.net" created="Wed, 30 Nov 2011 23:35:39 +0000"  >&lt;p&gt;Karthik updated the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Run more aggressive compactions during off peak hours&quot;.&lt;br/&gt;
Reviewers: JIRA, Kannan, nspiegelberg, mbautin, stack&lt;/p&gt;

&lt;p&gt;  Fixed Nicolas&apos; comment about the time computation in the unit test.&lt;br/&gt;
  Fixed Ted&apos;s comment about repeated compact selection line.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D471&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;AFFECTED FILES&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactSelection.java&lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionRequest.java&lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactSelection.java&lt;/p&gt;</comment>
                            <comment id="13160458" author="phabricator@reviews.facebook.net" created="Wed, 30 Nov 2011 23:37:39 +0000"  >&lt;p&gt;Karthik has commented on the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Run more aggressive compactions during off peak hours&quot;.&lt;/p&gt;

&lt;p&gt;  Hey guys, skipping the cosmetic clean-ups for now - we can do those as a followup if needed, addressed the core issues that Nicolas and Ted pointed out.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D471&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13160459" author="phabricator@reviews.facebook.net" created="Wed, 30 Nov 2011 23:37:40 +0000"  >&lt;p&gt;nspiegelberg has accepted the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Run more aggressive compactions during off peak hours&quot;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D471&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13160481" author="phabricator@reviews.facebook.net" created="Wed, 30 Nov 2011 23:55:42 +0000"  >&lt;p&gt;Karthik has committed the revision &quot;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Run more aggressive compactions during off peak hours&quot;.&lt;/p&gt;

&lt;p&gt;REVISION DETAIL&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/D471&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/D471&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;COMMIT&lt;br/&gt;
  &lt;a href=&quot;https://reviews.facebook.net/rHBASE1208885&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.facebook.net/rHBASE1208885&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13160636" author="hudson" created="Thu, 1 Dec 2011 04:01:55 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2504 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2504/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2504/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Run more aggressive compactions during off peak hours&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; Run more aggressive compactions during off peak hours&lt;/p&gt;

&lt;p&gt;Increases the compact selection ratio from 1.3 to 5 at off-peak hours. This&lt;br/&gt;
will help utilize the available iops and bandwidth to decrease average num of&lt;br/&gt;
files per store. Only one such aggressive compaction is queued per store at any&lt;br/&gt;
point.&lt;/p&gt;

&lt;p&gt;The number of iops on the disk and the top of the rack bandwidth utilization at&lt;br/&gt;
off peak hours is much lower than at peak hours depending on the application&lt;br/&gt;
usage pattern. We can utilize this knowledge to improve the performance of the&lt;br/&gt;
HBase cluster by increasing the compact selection ratio to a much larger value&lt;br/&gt;
during off-peak hours than otherwise - increasing hbase.hstore.compaction.ratio&lt;br/&gt;
(1.2 default) to hbase.hstore.compaction.ratio.offpeak (5 default). This will&lt;br/&gt;
help reduce the average number of files per store.&lt;/p&gt;

&lt;p&gt;Test Plan: Started running the unit tests.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA, Kannan, nspiegelberg, mbautin, stack&lt;/p&gt;

&lt;p&gt;Reviewed By: nspiegelberg&lt;/p&gt;

&lt;p&gt;CC: nspiegelberg, tedyu, lhofhansl, Karthik&lt;/p&gt;

&lt;p&gt;Differential Revision: 471&lt;/p&gt;

&lt;p&gt;karthik : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactSelection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionRequest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactSelection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13160692" author="hudson" created="Thu, 1 Dec 2011 06:59:33 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #17 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/17/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/17/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;jira&amp;#93;&lt;/span&gt; Run more aggressive compactions during off peak hours&lt;/p&gt;

&lt;p&gt;Summary:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4463&quot; title=&quot;Run more aggressive compactions during off peak hours&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4463&quot;&gt;&lt;del&gt;HBASE-4463&lt;/del&gt;&lt;/a&gt; Run more aggressive compactions during off peak hours&lt;/p&gt;

&lt;p&gt;Increases the compact selection ratio from 1.3 to 5 at off-peak hours. This&lt;br/&gt;
will help utilize the available iops and bandwidth to decrease average num of&lt;br/&gt;
files per store. Only one such aggressive compaction is queued per store at any&lt;br/&gt;
point.&lt;/p&gt;

&lt;p&gt;The number of iops on the disk and the top of the rack bandwidth utilization at&lt;br/&gt;
off peak hours is much lower than at peak hours depending on the application&lt;br/&gt;
usage pattern. We can utilize this knowledge to improve the performance of the&lt;br/&gt;
HBase cluster by increasing the compact selection ratio to a much larger value&lt;br/&gt;
during off-peak hours than otherwise - increasing hbase.hstore.compaction.ratio&lt;br/&gt;
(1.2 default) to hbase.hstore.compaction.ratio.offpeak (5 default). This will&lt;br/&gt;
help reduce the average number of files per store.&lt;/p&gt;

&lt;p&gt;Test Plan: Started running the unit tests.&lt;/p&gt;

&lt;p&gt;Reviewers: JIRA, Kannan, nspiegelberg, mbautin, stack&lt;/p&gt;

&lt;p&gt;Reviewed By: nspiegelberg&lt;/p&gt;

&lt;p&gt;CC: nspiegelberg, tedyu, lhofhansl, Karthik&lt;/p&gt;

&lt;p&gt;Differential Revision: 471&lt;/p&gt;

&lt;p&gt;karthik : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactSelection.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/compactions/CompactionRequest.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/regionserver/TestCompactSelection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12504003" name="ASF.LICENSE.NOT.GRANTED--HBASE-4463.D471.1.patch" size="28276" author="phabricator@reviews.facebook.net" created="Thu, 17 Nov 2011 01:03:52 +0000"/>
                            <attachment id="12505681" name="ASF.LICENSE.NOT.GRANTED--HBASE-4463.D471.2.patch" size="24294" author="phabricator@reviews.facebook.net" created="Wed, 30 Nov 2011 23:35:40 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 22 Sep 2011 21:58:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3500</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 3 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08qvz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48956</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>