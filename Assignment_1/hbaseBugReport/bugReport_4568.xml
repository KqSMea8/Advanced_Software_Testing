<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:20:06 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4568/HBASE-4568.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4568] Make zk dump jsp response more quickly</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4568</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;1) For each zk dump, currently hbase will create a zk client instance every time. &lt;br/&gt;
This is quite slow when any machines in the quorum is dead. Because it will connect to each machine in the zk quorum again.&lt;/p&gt;

&lt;p&gt;&amp;lt;code&amp;gt;&lt;br/&gt;
HMaster master = (HMaster)getServletContext().getAttribute(HMaster.MASTER);&lt;br/&gt;
Configuration conf = master.getConfiguration();&lt;br/&gt;
HBaseAdmin hbadmin = new HBaseAdmin(conf);&lt;br/&gt;
HConnection connection = hbadmin.getConnection();&lt;br/&gt;
ZooKeeperWatcher watcher = connection.getZooKeeperWatcher();&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;So we can simplify this:&lt;br/&gt;
&amp;lt;code&amp;gt;&lt;br/&gt;
HMaster master = (HMaster)getServletContext().getAttribute(HMaster.MASTER);&lt;br/&gt;
ZooKeeperWatcher watcher = master.getZooKeeperWatcher();&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;2) Also when hbase call getServerStats() for each machine in the zk quorum, it hard coded the default time out as 1 min. &lt;br/&gt;
It would be nice to make this configurable and set it to a low time out.&lt;/p&gt;

&lt;p&gt;When hbase tries to connect to each machine in the zk quorum, it will create the socket, and then set the socket time out, and read it with this time out.&lt;br/&gt;
It means hbase will create a socket and connect to the zk server with 0 time out at first, which will take a long time. &lt;br/&gt;
Because a timeout of zero is interpreted as an infinite timeout. The connection will then block until established or an error occurs.&lt;/p&gt;

&lt;p&gt;3) The recoverable zookeeper should be real exponentially backoff when there is connection loss exception, which will give hbase much longer time window to recover from zk machine failures.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12526499">HBASE-4568</key>
            <summary>Make zk dump jsp response more quickly</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="liyin">Liyin Tang</assignee>
                                    <reporter username="liyin">Liyin Tang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 10 Oct 2011 19:50:50 +0000</created>
                <updated>Fri, 12 Oct 2012 05:35:00 +0000</updated>
                            <resolved>Thu, 13 Oct 2011 23:52:00 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                    <fixVersion>0.94.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="13126117" author="stack" created="Wed, 12 Oct 2011 20:24:50 +0000"  >&lt;p&gt;+1 Liyin.&lt;/p&gt;</comment>
                            <comment id="13127048" author="jiraposter@reviews.apache.org" created="Thu, 13 Oct 2011 22:28:12 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2385/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2385/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase, Dhruba Borthakur, Michael Stack, Jonathan Gray, Mikhail Bautin, Pritam Damania, Prakash Khemani, Amitanand Aiyer, Kannan Muthukkaruppan, Jerry Chen, Karthik Ranganathan, and Nicolas Spiegelberg.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;1) For each zk dump, currently hbase will create a zk client instance every time. &lt;br/&gt;
This is quite slow when any machines in the quorum is dead. Because it will connect to each machine in the zk quorum again.&lt;/p&gt;

&lt;p&gt;&amp;lt;code&amp;gt;&lt;br/&gt;
HMaster master = (HMaster)getServletContext().getAttribute(HMaster.MASTER);&lt;br/&gt;
Configuration conf = master.getConfiguration();&lt;br/&gt;
HBaseAdmin hbadmin = new HBaseAdmin(conf);&lt;br/&gt;
HConnection connection = hbadmin.getConnection();&lt;br/&gt;
ZooKeeperWatcher watcher = connection.getZooKeeperWatcher();&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;So we can simplify this:&lt;br/&gt;
&amp;lt;code&amp;gt;&lt;br/&gt;
HMaster master = (HMaster)getServletContext().getAttribute(HMaster.MASTER);&lt;br/&gt;
ZooKeeperWatcher watcher = master.getZooKeeperWatcher();&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;2) Also when hbase call getServerStats() for each machine in the zk quorum, it hard coded the default time out as 1 min. &lt;br/&gt;
It would be nice to make this configurable and set it to a low time out.&lt;/p&gt;

&lt;p&gt;When hbase tries to connect to each machine in the zk quorum, it will create the socket, and then set the socket time out, and read it with this time out.&lt;br/&gt;
It means hbase will create a socket and connect to the zk server with 0 time out at first, which will take a long time. &lt;br/&gt;
Because a timeout of zero is interpreted as an infinite timeout. The connection will then block until established or an error occurs.&lt;/p&gt;

&lt;p&gt;3) The recoverable zookeeper should be real exponentially backoff when there is connection loss exception, which will give hbase much longer time window to recover from zk machine failures.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4568&quot; title=&quot;Make zk dump jsp response more quickly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4568&quot;&gt;&lt;del&gt;HBASE-4568&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4568&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4568&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/util/RetryCounter.java 61ea552 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java b8c4f61 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 699a5f5 &lt;br/&gt;
  src/main/resources/hbase-webapps/master/zk.jsp b31d94c &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2385/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2385/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Running all the unit tests&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Liyin&lt;/p&gt;
</comment>
                            <comment id="13127058" author="jiraposter@reviews.apache.org" created="Thu, 13 Oct 2011 22:34:11 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2385/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2385/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-10-13 22:33:54.109200)&lt;/p&gt;


&lt;p&gt;Review request for hbase, Dhruba Borthakur, Michael Stack, Jonathan Gray, Mikhail Bautin, Pritam Damania, Prakash Khemani, Amitanand Aiyer, Kannan Muthukkaruppan, Jerry Chen, Karthik Ranganathan, and Nicolas Spiegelberg.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Remove trailing space.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;1) For each zk dump, currently hbase will create a zk client instance every time. &lt;br/&gt;
This is quite slow when any machines in the quorum is dead. Because it will connect to each machine in the zk quorum again.&lt;/p&gt;

&lt;p&gt;&amp;lt;code&amp;gt;&lt;br/&gt;
HMaster master = (HMaster)getServletContext().getAttribute(HMaster.MASTER);&lt;br/&gt;
Configuration conf = master.getConfiguration();&lt;br/&gt;
HBaseAdmin hbadmin = new HBaseAdmin(conf);&lt;br/&gt;
HConnection connection = hbadmin.getConnection();&lt;br/&gt;
ZooKeeperWatcher watcher = connection.getZooKeeperWatcher();&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;So we can simplify this:&lt;br/&gt;
&amp;lt;code&amp;gt;&lt;br/&gt;
HMaster master = (HMaster)getServletContext().getAttribute(HMaster.MASTER);&lt;br/&gt;
ZooKeeperWatcher watcher = master.getZooKeeperWatcher();&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;2) Also when hbase call getServerStats() for each machine in the zk quorum, it hard coded the default time out as 1 min. &lt;br/&gt;
It would be nice to make this configurable and set it to a low time out.&lt;/p&gt;

&lt;p&gt;When hbase tries to connect to each machine in the zk quorum, it will create the socket, and then set the socket time out, and read it with this time out.&lt;br/&gt;
It means hbase will create a socket and connect to the zk server with 0 time out at first, which will take a long time. &lt;br/&gt;
Because a timeout of zero is interpreted as an infinite timeout. The connection will then block until established or an error occurs.&lt;/p&gt;

&lt;p&gt;3) The recoverable zookeeper should be real exponentially backoff when there is connection loss exception, which will give hbase much longer time window to recover from zk machine failures.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4568&quot; title=&quot;Make zk dump jsp response more quickly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4568&quot;&gt;&lt;del&gt;HBASE-4568&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4568&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4568&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/util/RetryCounter.java 61ea552 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java b8c4f61 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 699a5f5 &lt;br/&gt;
  src/main/resources/hbase-webapps/master/zk.jsp b31d94c &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2385/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2385/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Running all the unit tests&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Liyin&lt;/p&gt;
</comment>
                            <comment id="13127060" author="jiraposter@reviews.apache.org" created="Thu, 13 Oct 2011 22:38:11 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2385/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2385/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-10-13 22:36:46.694728)&lt;/p&gt;


&lt;p&gt;Review request for hbase, Dhruba Borthakur, Michael Stack, Jonathan Gray, Mikhail Bautin, Pritam Damania, Prakash Khemani, Amitanand Aiyer, Kannan Muthukkaruppan, Jerry Chen, Karthik Ranganathan, and Nicolas Spiegelberg.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;1) For each zk dump, currently hbase will create a zk client instance every time. &lt;br/&gt;
This is quite slow when any machines in the quorum is dead. Because it will connect to each machine in the zk quorum again.&lt;/p&gt;

&lt;p&gt;&amp;lt;code&amp;gt;&lt;br/&gt;
HMaster master = (HMaster)getServletContext().getAttribute(HMaster.MASTER);&lt;br/&gt;
Configuration conf = master.getConfiguration();&lt;br/&gt;
HBaseAdmin hbadmin = new HBaseAdmin(conf);&lt;br/&gt;
HConnection connection = hbadmin.getConnection();&lt;br/&gt;
ZooKeeperWatcher watcher = connection.getZooKeeperWatcher();&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;So we can simplify this:&lt;br/&gt;
&amp;lt;code&amp;gt;&lt;br/&gt;
HMaster master = (HMaster)getServletContext().getAttribute(HMaster.MASTER);&lt;br/&gt;
ZooKeeperWatcher watcher = master.getZooKeeperWatcher();&lt;br/&gt;
&amp;lt;/code&amp;gt;&lt;/p&gt;

&lt;p&gt;2) Also when hbase call getServerStats() for each machine in the zk quorum, it hard coded the default time out as 1 min. &lt;br/&gt;
It would be nice to make this configurable and set it to a low time out.&lt;/p&gt;

&lt;p&gt;When hbase tries to connect to each machine in the zk quorum, it will create the socket, and then set the socket time out, and read it with this time out.&lt;br/&gt;
It means hbase will create a socket and connect to the zk server with 0 time out at first, which will take a long time. &lt;br/&gt;
Because a timeout of zero is interpreted as an infinite timeout. The connection will then block until established or an error occurs.&lt;/p&gt;

&lt;p&gt;3) The recoverable zookeeper should be real exponentially backoff when there is connection loss exception, which will give hbase much longer time window to recover from zk machine failures.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4568&quot; title=&quot;Make zk dump jsp response more quickly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4568&quot;&gt;&lt;del&gt;HBASE-4568&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4568&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4568&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/util/RetryCounter.java 61ea552 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java b8c4f61 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 699a5f5 &lt;br/&gt;
  src/main/resources/hbase-webapps/master/zk.jsp b31d94c &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2385/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2385/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Running all the unit tests&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Liyin&lt;/p&gt;
</comment>
                            <comment id="13127067" author="jiraposter@reviews.apache.org" created="Thu, 13 Oct 2011 22:42:12 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/2385/#review2574&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2385/#review2574&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;+1. Changes look good Liyin.&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Kannan&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-10-13 22:36:46, Liyin wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/2385/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2385/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-10-13 22:36:46)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Dhruba Borthakur, Michael Stack, Jonathan Gray, Mikhail Bautin, Pritam Damania, Prakash Khemani, Amitanand Aiyer, Kannan Muthukkaruppan, Jerry Chen, Karthik Ranganathan, and Nicolas Spiegelberg.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1) For each zk dump, currently hbase will create a zk client instance every time. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is quite slow when any machines in the quorum is dead. Because it will connect to each machine in the zk quorum again.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;code&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HMaster master = (HMaster)getServletContext().getAttribute(HMaster.MASTER);&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Configuration conf = master.getConfiguration();&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HBaseAdmin hbadmin = new HBaseAdmin(conf);&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HConnection connection = hbadmin.getConnection();&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ZooKeeperWatcher watcher = connection.getZooKeeperWatcher();&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/code&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;So we can simplify this:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;code&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;HMaster master = (HMaster)getServletContext().getAttribute(HMaster.MASTER);&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;ZooKeeperWatcher watcher = master.getZooKeeperWatcher();&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;lt;/code&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2) Also when hbase call getServerStats() for each machine in the zk quorum, it hard coded the default time out as 1 min. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;It would be nice to make this configurable and set it to a low time out.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;When hbase tries to connect to each machine in the zk quorum, it will create the socket, and then set the socket time out, and read it with this time out.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;It means hbase will create a socket and connect to the zk server with 0 time out at first, which will take a long time. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Because a timeout of zero is interpreted as an infinite timeout. The connection will then block until established or an error occurs.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3) The recoverable zookeeper should be real exponentially backoff when there is connection loss exception, which will give hbase much longer time window to recover from zk machine failures.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4568&quot; title=&quot;Make zk dump jsp response more quickly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4568&quot;&gt;&lt;del&gt;HBASE-4568&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4568&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4568&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/util/RetryCounter.java 61ea552 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java b8c4f61 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java 699a5f5 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/resources/hbase-webapps/master/zk.jsp b31d94c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/2385/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/2385/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Running all the unit tests&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Liyin&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13127150" author="nspiegelberg" created="Thu, 13 Oct 2011 23:41:30 +0000"  >&lt;p&gt;+1.  awesome job!&lt;/p&gt;</comment>
                            <comment id="13127156" author="nspiegelberg" created="Thu, 13 Oct 2011 23:43:56 +0000"  >&lt;p&gt;please remember to attach the patch to JIRA in addition to posting to Review Board.  Hopefully, we&apos;ll have RB or Phabricator automatically do this for us in the future.&lt;/p&gt;</comment>
                            <comment id="13127252" author="hudson" created="Fri, 14 Oct 2011 03:03:51 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #64 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/64/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/64/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4568&quot; title=&quot;Make zk dump jsp response more quickly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4568&quot;&gt;&lt;del&gt;HBASE-4568&lt;/del&gt;&lt;/a&gt;  Make zk dump jsp response faster&lt;/p&gt;

&lt;p&gt;nspiegelberg : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/util/RetryCounter.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/resources/hbase-webapps/master/zk.jsp&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13128377" author="hudson" created="Sun, 16 Oct 2011 11:43:45 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2325 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2325/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2325/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4568&quot; title=&quot;Make zk dump jsp response more quickly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4568&quot;&gt;&lt;del&gt;HBASE-4568&lt;/del&gt;&lt;/a&gt; Make zk dump jsp response faster&lt;/p&gt;

&lt;p&gt;nspiegelberg : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/util/RetryCounter.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/RecoverableZooKeeper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/resources/hbase-webapps/master/zk.jsp&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12498960" name="HBASE-4568.patch" size="11141" author="nspiegelberg" created="Thu, 13 Oct 2011 23:43:56 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 12 Oct 2011 20:24:50 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>56954</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 9 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08r53:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>48997</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>