<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:28:59 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5571/HBASE-5571.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5571] Table will be disabling forever</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5571</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;If we restart master when it is disabling one table, the table will be disabling forever.&lt;/p&gt;

&lt;p&gt;In current logic, Region CLOSE RPC will always returned NotServingRegionException because RS has already closed the region before we restart master. So table will be disabling forever because the region will in RIT all along.&lt;/p&gt;

&lt;p&gt;In another case, when AssignmentManager#rebuildUserRegions(), it will put parent regions to AssignmentManager.regions, so we can&apos;t close these parent regions until it is purged by CatalogJanitor if we execute disabling the table.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12546204">HBASE-5571</key>
            <summary>Table will be disabling forever</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="zjushch">chunhui shen</reporter>
                        <labels>
                    </labels>
                <created>Tue, 13 Mar 2012 09:15:34 +0000</created>
                <updated>Sat, 10 Jan 2015 01:52:18 +0000</updated>
                            <resolved>Sat, 10 Jan 2015 01:52:18 +0000</resolved>
                                                                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13228482" author="stack" created="Tue, 13 Mar 2012 16:16:23 +0000"  >&lt;p&gt;This patch has much merit.  Thanks for digging in on it.&lt;/p&gt;

&lt;p&gt;I like how you made a method cancelClosingRegionIfDisabling to hold a bunch of code that was inside in a catch block.&lt;/p&gt;

&lt;p&gt;I see why you want to know if a region is splitting &amp;#8211; it makes it so we can remove the comments where we speculate a region is splitting &amp;#8211; but I don&apos;t think keeping a list of outstaning regions in HRS the right place for it ... in particular I don&apos;t think we should keep this state in the OnlineRegions Interface (splitting regions are not online).  When we go to split a region, we put this fact up into zk.  Why not check there rather than trying to keep around a collection of splitting regions?&lt;/p&gt;


</comment>
                            <comment id="13228484" author="stack" created="Tue, 13 Mar 2012 16:16:36 +0000"  >&lt;p&gt;Oh, any chance of a test?&lt;/p&gt;</comment>
                            <comment id="13228942" author="zjushch" created="Wed, 14 Mar 2012 04:07:12 +0000"  >&lt;p&gt;patch v2, check region is splitting through AssignmentManager#RegionState,&lt;br/&gt;
Also I fix another a bug when region is disabling and split is rolled back, in current logic, if parent region is roll back and it will not be closed if the table is disabling.&lt;/p&gt;</comment>
                            <comment id="13229966" author="ram_krish" created="Thu, 15 Mar 2012 07:53:08 +0000"  >&lt;p&gt;Patch v2 does not include changes in v1? is it intended?&lt;/p&gt;</comment>
                            <comment id="13229968" author="zjushch" created="Thu, 15 Mar 2012 07:58:38 +0000"  >&lt;p&gt;As stack&apos;s comment, patch v2 use zk&apos;s split info to check whether region is splitting, needn&apos;t HRegionServer keeping splitting-region list.&lt;/p&gt;</comment>
                            <comment id="13229975" author="ram_krish" created="Thu, 15 Mar 2012 08:16:59 +0000"  >&lt;p&gt;Sorry Chunhui.. Did not see Stack&apos;s comments fully.  Will review and get back to this.&lt;br/&gt;
Thanks&lt;/p&gt;</comment>
                            <comment id="13229988" author="ram_krish" created="Thu, 15 Mar 2012 08:41:57 +0000"  >&lt;p&gt;Handling disabling when nodeDeleted is needed as we try doing in SplitRegionHandler.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (NotServingRegionException nsre) {
       LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Server &quot;&lt;/span&gt; + server + &lt;span class=&quot;code-quote&quot;&gt;&quot; returned &quot;&lt;/span&gt; + nsre + &lt;span class=&quot;code-quote&quot;&gt;&quot; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt; +
         region.getRegionNameAsString());
-      &lt;span class=&quot;code-comment&quot;&gt;// Presume that master has stale data.  Presume remote side just split.
&lt;/span&gt;-      &lt;span class=&quot;code-comment&quot;&gt;// Presume that the split message when it comes in will fix up the master&apos;s
&lt;/span&gt;-      &lt;span class=&quot;code-comment&quot;&gt;// in memory cluster state.
&lt;/span&gt;+      RegionState regionState = regionsInTransition.get(encodedName);
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (regionState != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
+          &amp;amp;&amp;amp; (regionState.isSplitting() || regionState.isSplit())) {
+        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Region &quot;&lt;/span&gt; + region.getRegionNameAsString()
+            + &lt;span class=&quot;code-quote&quot;&gt;&quot; is splitting, &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;&quot;&lt;/span&gt;);
+        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
+      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
+        cancelClosingRegionIfDisabling(region);
+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is this the correct place to add the code.  I feel NSRE will be a remote exception and this check should come in the below catch(Throwable) where we check for NSRE.&lt;br/&gt;
I remember happening lik that when i was working on some earlier issues.  Correct me if am wrong.  BTW, thanks for the patch.&lt;/p&gt;</comment>
                            <comment id="13230003" author="zjushch" created="Thu, 15 Mar 2012 09:05:37 +0000"  >&lt;p&gt;In our testing with 90 version, close region rpc return NSRE rather than a remote exception if region is already been closed, so that table will be diabling all the time.&lt;/p&gt;

&lt;p&gt;Maybe calling unassign(rs.getRegion()) in the nodeDeleted() will affect zk event. &lt;br/&gt;
What about define a new state for RegionState.state which will retry closing if return NSRE.&lt;/p&gt;</comment>
                            <comment id="13230016" author="zjushch" created="Thu, 15 Mar 2012 09:31:44 +0000"  >&lt;p&gt;patchv3 change unassign() in nodeDeleted() to invokeUnassign().&lt;/p&gt;</comment>
                            <comment id="13230057" author="ram_krish" created="Thu, 15 Mar 2012 10:47:07 +0000"  >&lt;p&gt;@Chunhui&lt;br/&gt;
+1 on making invokeUnassign().  But NSRE is my doubt. I will try out once if am able to reproduce it.  &lt;/p&gt;</comment>
                            <comment id="13230266" author="zhihyu@ebaysf.com" created="Thu, 15 Mar 2012 16:18:46 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Rs= &quot;&lt;/span&gt; + regionState + &lt;span class=&quot;code-quote&quot;&gt;&quot;, &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&quot;Rs&quot; may mean region server. &quot;region &quot; should be enough. I think we can also mention that NotServingRegionException is skipped.&lt;/p&gt;</comment>
                            <comment id="13230331" author="ram_krish" created="Thu, 15 Mar 2012 17:21:29 +0000"  >&lt;p&gt;@Chunhui&lt;br/&gt;
I did not reproduce it as i got lost in some other work. But if the remote exception is not thrown why all the logic related to NSRE is present there.&lt;br/&gt;
May be am wrong.  But i cannot tell surely also as i did not reproduce it now.&lt;/p&gt;</comment>
                            <comment id="13230899" author="zjushch" created="Fri, 16 Mar 2012 05:07:49 +0000"  >&lt;p&gt;If AssignmentManager#unassign() catchs RemoteException rather than NotServingRegionException, could we remove catching NotServingRegionException?&lt;/p&gt;

&lt;p&gt;I&apos;m not sure when catches RemoteException  and when catches NotServingRegionException directly, from our logs I see it catches NotServingRegionException directly. Anyway, for this issue, we could treat samely for the two exceptions. &lt;/p&gt;</comment>
                            <comment id="14267641" author="clehene" created="Wed, 7 Jan 2015 13:49:26 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=zjushch&quot; class=&quot;user-hover&quot; rel=&quot;zjushch&quot;&gt;chunhui shen&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; is this still valid?&lt;/p&gt;</comment>
                            <comment id="14272237" author="apurtell" created="Sat, 10 Jan 2015 01:52:18 +0000"  >&lt;p&gt;Thanks for looking at this &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=clehene&quot; class=&quot;user-hover&quot; rel=&quot;clehene&quot;&gt;Cosmin Lehene&lt;/a&gt;. Reported against now unsupported version 0.90, resolving as Wont Fix&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12518287" name="BASE-5571v2.patch" size="4333" author="zjushch" created="Wed, 14 Mar 2012 04:01:32 +0000"/>
                            <attachment id="12518166" name="HBASE-5571.patch" size="8671" author="zjushch" created="Tue, 13 Mar 2012 09:16:29 +0000"/>
                            <attachment id="12518437" name="HBASE-5571v3.patch" size="4291" author="zjushch" created="Thu, 15 Mar 2012 09:31:44 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 13 Mar 2012 16:16:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231362</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02c1z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11554</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>