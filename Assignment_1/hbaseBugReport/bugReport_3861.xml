<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:13:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3861/HBASE-3861.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3861] MiniZooKeeperCluster.startup() should refer to hbase.zookeeper.property.maxClientCnxns</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3861</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently the number of the client connections is hard-wired to 1000:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;        standaloneServerFactory = new NIOServerCnxnFactory();
        standaloneServerFactory.configure(new InetSocketAddress(clientPort),1000);
      } catch (BindException e) {
 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This should be set according to the test environment&apos;s hbase configuration. The property in &lt;br/&gt;
question is : hbase.zookeeper.property.maxClientCnxns.&lt;/p&gt;

&lt;p&gt;Currently some tests such as org.apache.hadoop.hbase.client.TestHCM fail because the number of connections used by the HBase client exceeds 1000. &lt;/p&gt;

&lt;p&gt;Recently MAX_CACHED_HBASE_INSTANCES increased from 31 to 2000 on 0.90 branch:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc/hbase/branches/0.90/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java?p2=%2Fhbase%2Fbranches%2F0.90%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhbase%2Fclient%2FHConnectionManager.java&amp;amp;p1=%2Fhbase%2Fbranches%2F0.90%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhbase%2Fclient%2FHConnectionManager.java&amp;amp;r1=1096818&amp;amp;r2=1096817&amp;amp;view=diff&amp;amp;pathrev=1096818&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/hbase/branches/0.90/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java?p2=%2Fhbase%2Fbranches%2F0.90%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhbase%2Fclient%2FHConnectionManager.java&amp;amp;p1=%2Fhbase%2Fbranches%2F0.90%2Fsrc%2Fmain%2Fjava%2Forg%2Fapache%2Fhadoop%2Fhbase%2Fclient%2FHConnectionManager.java&amp;amp;r1=1096818&amp;amp;r2=1096817&amp;amp;view=diff&amp;amp;pathrev=1096818&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;and correspondingly the hbase config on the Zookeeper server-side also increased in hbase-default.xml:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://svn.apache.org/viewvc/hbase/branches/0.90/src/main/resources/hbase-default.xml?p2=%2Fhbase%2Fbranches%2F0.90%2Fsrc%2Fmain%2Fresources%2Fhbase-default.xml&amp;amp;p1=%2Fhbase%2Fbranches%2F0.90%2Fsrc%2Fmain%2Fresources%2Fhbase-default.xml&amp;amp;r1=1091594&amp;amp;r2=1091593&amp;amp;view=diff&amp;amp;pathrev=1091594&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://svn.apache.org/viewvc/hbase/branches/0.90/src/main/resources/hbase-default.xml?p2=%2Fhbase%2Fbranches%2F0.90%2Fsrc%2Fmain%2Fresources%2Fhbase-default.xml&amp;amp;p1=%2Fhbase%2Fbranches%2F0.90%2Fsrc%2Fmain%2Fresources%2Fhbase-default.xml&amp;amp;r1=1091594&amp;amp;r2=1091593&amp;amp;view=diff&amp;amp;pathrev=1091594&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;So if MiniZKCluster looks at this setting, the test won&apos;t have this failure.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12506347">HBASE-3861</key>
            <summary>MiniZooKeeperCluster.startup() should refer to hbase.zookeeper.property.maxClientCnxns</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ekoontz">Eugene Koontz</assignee>
                                    <reporter username="ekoontz">Eugene Koontz</reporter>
                        <labels>
                    </labels>
                <created>Thu, 5 May 2011 23:01:18 +0000</created>
                <updated>Wed, 5 Sep 2012 17:58:14 +0000</updated>
                            <resolved>Wed, 5 Sep 2012 17:58:14 +0000</resolved>
                                    <version>0.90.3</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                    <timeoriginalestimate seconds="3600">1h</timeoriginalestimate>
                            <timeestimate seconds="3600">1h</timeestimate>
                                        <comments>
                            <comment id="13029682" author="ekoontz" created="Fri, 6 May 2011 01:01:24 +0000"  >&lt;p&gt;attaching &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3861&quot; title=&quot;MiniZooKeeperCluster.startup() should refer to hbase.zookeeper.property.maxClientCnxns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3861&quot;&gt;&lt;del&gt;HBASE-3861&lt;/del&gt;&lt;/a&gt;.patch&lt;/p&gt;</comment>
                            <comment id="13029700" author="ekoontz" created="Fri, 6 May 2011 02:39:12 +0000"  >&lt;p&gt;creating new patch with maxNumCnxns set sufficiently high for TestHCM to pass.&lt;/p&gt;</comment>
                            <comment id="13029727" author="stack" created="Fri, 6 May 2011 04:19:17 +0000"  >&lt;p&gt;Do you think the old constructor should call your new one Eugene?  Else some data members will not be set up right?  Otherwise the patch looks good to me.&lt;/p&gt;</comment>
                            <comment id="13030029" author="apurtell" created="Fri, 6 May 2011 17:09:12 +0000"  >&lt;p&gt;+1, I&apos;ll commit with Stack&apos;s comment addressed also.&lt;/p&gt;</comment>
                            <comment id="13030036" author="hbasebuild" created="Fri, 6 May 2011 17:18:03 +0000"  >&lt;p&gt;Sounds good&lt;/p&gt;
</comment>
                            <comment id="13030040" author="ekoontz" created="Fri, 6 May 2011 17:23:49 +0000"  >&lt;p&gt;Thank you for looking at this, stack!! You are right about the constructor-calling. Thank you Andrew for fixing it.&lt;/p&gt;

&lt;p&gt;One thing which I can&apos;t explain is that TestHCM passes currently &lt;b&gt;without&lt;/b&gt; this patch. It seems like it should fail because the maxNumCnxns is set too low at only 1000. &lt;/p&gt;

&lt;p&gt;So I think my patch is right but it doesn&apos;t fix a test that&apos;s not passing without it.&lt;/p&gt;</comment>
                            <comment id="13030052" author="apurtell" created="Fri, 6 May 2011 17:43:41 +0000"  >&lt;p&gt;Committed to trunk and 0.90 branch. Tests pass locally.&lt;/p&gt;</comment>
                            <comment id="13030153" author="ekoontz" created="Fri, 6 May 2011 21:40:34 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3861&quot; title=&quot;MiniZooKeeperCluster.startup() should refer to hbase.zookeeper.property.maxClientCnxns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3861&quot;&gt;&lt;del&gt;HBASE-3861&lt;/del&gt;&lt;/a&gt; patch causes TestHCM to fail on sometimes. TestHCM uses MAX_CACHED_HBASE_INSTANCES which is set to 2001 as part of fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3773&quot; title=&quot;Set ZK max connections much higher in 0.90&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3773&quot;&gt;&lt;del&gt;HBASE-3773&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13030154" author="stack" created="Fri, 6 May 2011 21:43:16 +0000"  >&lt;p&gt;I just backed this out of TRUNK because its OOME&apos;ing TestHCM up on hudson and locally on two different platforms (I can&apos;t see why it would do it though... must be some interaction w/ hbase-3777).  It runs fine for me on branch.&lt;/p&gt;</comment>
                            <comment id="13030156" author="apurtell" created="Fri, 6 May 2011 21:47:21 +0000"  >&lt;p&gt;Caused TestHCM to OOME on trunk up on Jenkins. Backed out for now. Reopening to investigate / fix.&lt;/p&gt;</comment>
                            <comment id="13030158" author="ekoontz" created="Fri, 6 May 2011 21:54:12 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3777&quot; title=&quot;Redefine Identity Of HBase Configuration&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3777&quot;&gt;&lt;del&gt;HBASE-3777&lt;/del&gt;&lt;/a&gt; may be related to this (has to do with relation between HConfiguration and HConnection).&lt;/p&gt;</comment>
                            <comment id="13030212" author="hudson" created="Sat, 7 May 2011 00:08:30 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1909 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/HBase-TRUNK/1909/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/HBase-TRUNK/1909/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3861&quot; title=&quot;MiniZooKeeperCluster.startup() should refer to hbase.zookeeper.property.maxClientCnxns&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3861&quot;&gt;&lt;del&gt;HBASE-3861&lt;/del&gt;&lt;/a&gt; MiniZooKeeperCluster.startup() should refer to hbase.zookeeper.property.maxClientCnxns; backing it out till figure the TestHCM OOME issue&lt;/p&gt;</comment>
                            <comment id="13036499" author="stack" created="Thu, 19 May 2011 21:37:06 +0000"  >&lt;p&gt;Moving this to 0.92.0.  It was committed for 0.90.3.&lt;/p&gt;</comment>
                            <comment id="13047573" author="stack" created="Fri, 10 Jun 2011 22:45:53 +0000"  >&lt;p&gt;Moving out of 0.92.0. Pull it back in if you think different.&lt;/p&gt;</comment>
                            <comment id="13448930" author="lhofhansl" created="Wed, 5 Sep 2012 17:58:00 +0000"  >&lt;p&gt;Looking at MiniZooKeeperCluster in trunk, this is already done:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      NIOServerCnxnFactory standaloneServerFactory;
      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) {
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
          standaloneServerFactory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; NIOServerCnxnFactory();
          standaloneServerFactory.configure(
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; InetSocketAddress(tentativePort),
            configuration.getInt(HConstants.ZOOKEEPER_MAX_CLIENT_CNXNS,
              1000));
        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (BindException e) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Closing.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12504101">HBASE-3773</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12504210">HBASE-3777</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12478359" name="HBASE-3861.patch" size="3148" author="ekoontz" created="Fri, 6 May 2011 02:50:43 +0000"/>
                            <attachment id="12478358" name="HBASE-3861.patch" size="3025" author="ekoontz" created="Fri, 6 May 2011 01:03:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 6 May 2011 04:19:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33241</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 15 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ho7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101185</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>