<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:11:55 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3643/HBASE-3643.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3643] Close the filesystem handle when HRS is aborting</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3643</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I thought of a way to fix &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3515&quot; title=&quot;[replication] ReplicationSource can miss a log after RS comes out of GC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3515&quot;&gt;&lt;del&gt;HBASE-3515&lt;/del&gt;&lt;/a&gt; that has a very broad impact, so I&apos;m creating this jira to &lt;b&gt;raise awareness&lt;/b&gt; and gather comments.&lt;/p&gt;

&lt;p&gt;Currently when we call HRS.abort, it&apos;s still possible to do HDFS operations like rolling logs and flushing files. It also has the impact that some threads cannot write to ZK (like the situation described in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3515&quot; title=&quot;[replication] ReplicationSource can miss a log after RS comes out of GC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3515&quot;&gt;&lt;del&gt;HBASE-3515&lt;/del&gt;&lt;/a&gt;) but then can still write to HDFS. Since that call is so central, I think we should &lt;font color=&quot;red&quot;&gt; add fs.close() inside the abort method&lt;/font&gt;.&lt;/p&gt;

&lt;p&gt;The impact of this is that everything else that happens after the close call, like closing files or appending, will fail in the most horrible ways. On the bright side, this means less disruptive changes on HDFS.&lt;/p&gt;

&lt;p&gt;Todd pointed at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2231&quot; title=&quot;Compaction events should be written to HLog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2231&quot;&gt;&lt;del&gt;HBASE-2231&lt;/del&gt;&lt;/a&gt; as related, but I think my solution is still too sloppy as we could still finish a compaction and immediately close the filesystem after that (damage&apos;s done).&lt;/p&gt;</description>
                <environment></environment>
        <key id="12501422">HBASE-3643</key>
            <summary>Close the filesystem handle when HRS is aborting</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                            <label>beginner</label>
                    </labels>
                <created>Tue, 15 Mar 2011 00:58:39 +0000</created>
                <updated>Tue, 5 Aug 2014 20:05:58 +0000</updated>
                                            <version>0.90.1</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13006800" author="stack" created="Tue, 15 Mar 2011 05:32:08 +0000"  >&lt;p&gt;Ohh... radical.  It might work.  I mean, when abort flag is set, we&apos;ll skip out closing regions.  Have you tried it?  Most tests should pass since a while back we made sure each RS and Master were their own user when using HDFS.&lt;/p&gt;</comment>
                            <comment id="13234525" author="lhofhansl" created="Wed, 21 Mar 2012 17:15:01 +0000"  >&lt;p&gt;I assume we don&apos;t want to do this in 0.94?&lt;/p&gt;</comment>
                            <comment id="13234941" author="lhofhansl" created="Wed, 21 Mar 2012 19:50:42 +0000"  >&lt;p&gt;Pushing to 0.96, pull back if you feel differntly.&lt;/p&gt;</comment>
                            <comment id="13549917" author="stack" created="Thu, 10 Jan 2013 18:55:06 +0000"  >&lt;p&gt;We should at least try this for 0.96...   Can punt if too much work.&lt;/p&gt;</comment>
                            <comment id="13619302" author="sershe" created="Mon, 1 Apr 2013 23:15:44 +0000"  >&lt;p&gt;I don&apos;t quite understand this JIRA... what kind of damage is done? I am assuming these are all the same operations that would have happened anyway on other threads if we didn&apos;t call abort... in which case they should be legitimate?&lt;/p&gt;</comment>
                            <comment id="13619323" author="jdcryans" created="Mon, 1 Apr 2013 23:32:46 +0000"  >&lt;p&gt;The damage done is the situation described in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2231&quot; title=&quot;Compaction events should be written to HLog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2231&quot;&gt;&lt;del&gt;HBASE-2231&lt;/del&gt;&lt;/a&gt; where a compaction would end after a RS comes out of GC and then it deletes the old files.&lt;/p&gt;</comment>
                            <comment id="13633300" author="devaraj" created="Tue, 16 Apr 2013 20:22:46 +0000"  >&lt;p&gt;I&apos;d vote for the ZK solution (where we record the intent) proposed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2231?focusedCommentId=12869386&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12869386&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-2231?focusedCommentId=12869386&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12869386&lt;/a&gt; .. If I understand JD&apos;s comment here correctly, the ZK-based approach would address the issue more completely.. Thoughts?&lt;/p&gt;</comment>
                            <comment id="13633304" author="sershe" created="Tue, 16 Apr 2013 20:27:29 +0000"  >&lt;p&gt;WAL solution should work (see last comments in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2231&quot; title=&quot;Compaction events should be written to HLog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2231&quot;&gt;&lt;del&gt;HBASE-2231&lt;/del&gt;&lt;/a&gt;) unless I&apos;m missing something.&lt;br/&gt;
If we wait for WAL IO fencing properly, than old server cannot write to WAL after new server sees it.&lt;br/&gt;
Which means if old server completes the compaction before fencing, it will indicate it in WAL and new server will not read/will attempt to delete the old files.&lt;br/&gt;
If it finishes compaction after fencing it will fail to write to WAL.&lt;br/&gt;
So ZK doesn&apos;t need to be involved.&lt;/p&gt;</comment>
                            <comment id="13633483" author="devaraj" created="Tue, 16 Apr 2013 22:18:16 +0000"  >&lt;p&gt;The ZK approach is a completely different approach that can be made to not require writing the COMPACTION marker to the WAL at all. Not sure whether the I/O fencing thing is working as per expectations yet or not (did I miss any comment that says it does). If it is working as expected, fine, and if not then the ZK approach is a plausible solution. The other option is to check on the HDFS side on I/O-fencing.&lt;/p&gt;</comment>
                            <comment id="13633645" author="stack" created="Wed, 17 Apr 2013 01:21:20 +0000"  >&lt;p&gt;We can do &apos;more complete&apos; solutions, yeah, but this seems like a simple thing to do that would narrow the gap significantly.&lt;/p&gt;</comment>
                            <comment id="13634215" author="sershe" created="Wed, 17 Apr 2013 17:21:53 +0000"  >&lt;p&gt;-0 from me... While it does narrow the gap it offends my engineering sensibilities &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &lt;br/&gt;
It can also introduce bugs, such as the one we saw not so long ago where FS closing while the region was closing caused some problem.&lt;br/&gt;
Perhaps we can do it and then back it off when we have proper solution? Proper solution is marked as critical so it could be soon...&lt;/p&gt;</comment>
                            <comment id="13635897" author="sershe" created="Fri, 19 Apr 2013 00:54:07 +0000"  >&lt;p&gt;clarification (due to some out of bounds discussion) -0 for the close FS approach&lt;/p&gt;</comment>
                            <comment id="13646744" author="devaraj" created="Wed, 1 May 2013 17:40:59 +0000"  >&lt;p&gt;Now that &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2231&quot; title=&quot;Compaction events should be written to HLog&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2231&quot;&gt;&lt;del&gt;HBASE-2231&lt;/del&gt;&lt;/a&gt; is committed, we could resolve this one (for now at least lowering the priority)? The &quot;damage&quot; described in this jira won&apos;t happen anymore.&lt;/p&gt;</comment>
                            <comment id="13648713" author="stack" created="Fri, 3 May 2013 19:41:38 +0000"  >&lt;p&gt;Moving out a nice-to-have issue that is not being worked on.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 15 Mar 2011 05:32:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33124</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 32 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02g67:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12221</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>beginner</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                </customfields>
    </item>
</channel>
</rss>