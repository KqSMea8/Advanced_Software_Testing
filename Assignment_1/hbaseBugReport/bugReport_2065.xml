<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:58:40 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2065/HBASE-2065.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2065] Cannot disable a table if any of its region is opening at the same time</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2065</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Also found with the test in the parent jira:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-12-21 18:31:44,411 INFO  [IPC Server handler 0 on 60000] master.RegionManager(331): Assigning region table113,,1261449026166 to 10.10.1.54,60853,1261448823301
2009-12-21 18:31:44,411 INFO  [IPC Server handler 0 on 60000] master.RegionManager(331): Assigning region table121,,1261449041385 to 10.10.1.54,60853,1261448823301
2009-12-21 18:31:44,411 INFO  [RegionServer:1] regionserver.HRegionServer(475): MSG_REGION_OPEN: table113,,1261449026166
2009-12-21 18:31:44,411 INFO  [RegionServer:1] regionserver.HRegionServer(475): MSG_REGION_OPEN: table121,,1261449041385
...
2009-12-21 18:31:44,418 INFO  [RegionServer:1.worker] regionserver.HRegion(343): region table113,,1261449026166/21044806 available; sequence id is 0
...
2009-12-21 18:31:44,445 DEBUG [IPC Server handler 4 on 60000] master.ChangeTableState(121): Adding region table113,,1261449026166 to setClosing list
2009-12-21 18:31:44,446 DEBUG [main] zookeeper.ZooKeeperWrapper(392): Read ZNode /hbase/root-region-server got 10.10.1.54:608532009-12-21 18:31:44,447 DEBUG [main] client.HConnectionManager$TableServers(990): Found ROOT at 10.10.1.54:60853
2009-12-21 18:31:44,447 DEBUG [main] client.HConnectionManager$TableServers(899): Cached location &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; .META.,,1 is 10.10.1.54:608552009-12-21 18:31:44,453 DEBUG [main] client.HConnectionManager$TableServers(554): Rowscanned=1, rowsOffline=0
2009-12-21 18:31:44,454 DEBUG [main] client.HBaseAdmin(397): Sleep. Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; all regions to be disabled from table1132009-12-21 18:31:44,554 DEBUG [main] client.HBaseAdmin(406): Wake. Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; all regions to be disabled from table113
...
2009-12-21 18:31:44,642 INFO  [RegionServer:0] regionserver.HRegionServer(475): MSG_REGION_CLOSE: table113,,1261449026166
...
2009-12-21 18:31:44,642 INFO  [RegionServer:0.worker] regionserver.HRegionServer$Worker(1332): Worker: MSG_REGION_CLOSE: table113,,1261449026166
...
2009-12-21 18:31:44,664 INFO  [IPC Server handler 0 on 60000] master.ServerManager(421): Processing MSG_REPORT_PROCESS_OPEN: table113,,1261449026166 from 10.10.1.54,60853,1261448823301; 1 of 4
...
2009-12-21 18:31:44,664 INFO  [IPC Server handler 0 on 60000] master.ServerManager(421): Processing MSG_REPORT_OPEN: table113,,1261449026166 from 10.10.1.54,60853,1261448823301; 3 of 4
2009-12-21 18:31:44,664 DEBUG [IPC Server handler 0 on 60000] master.ServerManager(562): region server 10.10.1.54:60853 should not have opened region table113,,1261449026166
2009-12-21 18:31:44,666 INFO  [RegionServer:1] regionserver.HRegionServer(475): MSG_REGION_CLOSE_WITHOUT_REPORT: table113,,1261449026166: Duplicate assignment
2009-12-21 18:31:44,666 INFO  [RegionServer:1.worker] regionserver.HRegionServer$Worker(1332): Worker: MSG_REGION_CLOSE_WITHOUT_REPORT: table113,,1261449026166: Duplicate assignment
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here the master reassigned table13 and told the old region server to close the region before the new one was able to report that it opened it. At the end the new region server (good one) is also told to close it  After that my test times out, table13 is not disabled neither it is deployed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12443960">HBASE-2065</key>
            <summary>Cannot disable a table if any of its region is opening at the same time</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12429981">HBASE-1636</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 22 Dec 2009 02:53:22 +0000</created>
                <updated>Fri, 12 Oct 2012 06:14:17 +0000</updated>
                            <resolved>Mon, 28 Dec 2009 18:20:36 +0000</resolved>
                                    <version>0.20.2</version>
                                    <fixVersion>0.20.3</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12793485" author="jdcryans" created="Tue, 22 Dec 2009 03:34:06 +0000"  >&lt;p&gt;Different instance of the bug:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2009-12-21 19:29:15,425 INFO  [IPC Server handler 4 on 60000] master.ServerManager(421): Processing MSG_REPORT_OPEN: table122,,1261452520421 from 10.10.1.54,49932,1261452340816; 2 of 2
2009-12-21 19:29:15,426 INFO  [main] client.HBaseAdmin(302): Deleted table121
2009-12-21 19:29:15,427 DEBUG [master] master.HMaster(479): Processing todo: PendingOpenOperation from 10.10.1.54,49932,1261452340816
2009-12-21 19:29:15,427 INFO  [master] master.ProcessRegionOpen(70): table122,,1261452520421 open on 10.10.1.54:49932
2009-12-21 19:29:15,427 DEBUG [IPC Server handler 2 on 60000] master.ChangeTableState(70): Processing unserved regions
2009-12-21 19:29:15,427 DEBUG [IPC Server handler 2 on 60000] master.ChangeTableState(107): Processing regions currently being served
2009-12-21 19:29:15,428 DEBUG [IPC Server handler 2 on 60000] master.ChangeTableState(121): Adding region table122,,1261452520421 to setClosing list
2009-12-21 19:29:15,428 INFO  [master] master.ProcessRegionOpen(80): Updated row table122,,1261452520421 in region .META.,,1 with startcode=1261452340816, server=10.10.1.54:49932
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Under 3 milliseconds the region was opening, it was disabled, and then the master removed it from regions in transition (after that last line). Table was hosed.&lt;/p&gt;</comment>
                            <comment id="12793582" author="jdcryans" created="Tue, 22 Dec 2009 10:41:57 +0000"  >&lt;p&gt;Path for both &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2064&quot; title=&quot;Cannot disable a table if at the same the Master is moving its regions around&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2064&quot;&gt;&lt;del&gt;HBASE-2064&lt;/del&gt;&lt;/a&gt; and &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2065&quot; title=&quot;Cannot disable a table if any of its region is opening at the same time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2065&quot;&gt;&lt;del&gt;HBASE-2065&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="12793777" author="stack" created="Tue, 22 Dec 2009 20:36:46 +0000"  >&lt;p&gt;+1 on patch. Would suggest running complete test suite before committing because jiggering the timings in src/test/hbase-site.xml can have unexpected repercussions out in other tests.  Thanks for removing my noisy log of edit number.&lt;/p&gt;</comment>
                            <comment id="12793789" author="jdcryans" created="Tue, 22 Dec 2009 21:08:14 +0000"  >&lt;p&gt;Yes I will make sure the tests passes and also I&apos;m currently testing disabling/enabling on a cluster.&lt;/p&gt;</comment>
                            <comment id="12793838" author="jdcryans" created="Tue, 22 Dec 2009 23:11:56 +0000"  >&lt;p&gt;Testing on the cluster worked on a freshly loaded 100 regions table that I disabled/enabled a couple of times.&lt;/p&gt;

&lt;p&gt;All tests are green.&lt;/p&gt;</comment>
                            <comment id="12793858" author="jdcryans" created="Wed, 23 Dec 2009 00:33:12 +0000"  >&lt;p&gt;Patch for branch.&lt;/p&gt;</comment>
                            <comment id="12793950" author="jdcryans" created="Wed, 23 Dec 2009 06:37:04 +0000"  >&lt;p&gt;This new patch attempts to fix the issue seen in Hudson (a region being opened while table is disabled was falling in a hole) as well as a new issue found with more testing: a region closed and set unassigned by the master is seen by TableOperation as an assigned region since the server info is still there so it&apos;s then switched from &quot;unassigned&quot; to &quot;closing&quot; by ChangeTableState. The rever is never reassigned nor seen as closed.&lt;/p&gt;

&lt;p&gt;More comments:&lt;/p&gt;

&lt;p&gt;TestAdmin:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I added a more difficult test where we enable and disable so root out more issues.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HRegion:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Refactored offlineRegionInMETA to add a new method called removeServerInfoInMETA which does pretty much that.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ProcessRegionClose:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Calls the new HRegion method in order to clean the .META. entry.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ChangeTableState:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Added that if we are disabling a table and we see a pending open region, that we do not attempt to mark it as &quot;closing&quot; since the master will be confused when the region server reports opening the region. We will rely now on the next modif in HBA...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;HBaseAdmin:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Changed that when enabling/disabling, instead of calling the Master&apos;s method and wait, we call it on every iteration to take into account regions that are moving like a pending open.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12794251" author="jdcryans" created="Wed, 23 Dec 2009 22:36:34 +0000"  >&lt;p&gt;I tested my new patch exclusively with TestAdmin 10-15 times in a row and it didn&apos;t fail.&lt;/p&gt;

&lt;p&gt;It passes all the unit tests.&lt;/p&gt;

&lt;p&gt;I tried it on a cluster during an import job that created 400 regions on 17 region servers and then played with disables and enables without any failure.&lt;/p&gt;</comment>
                            <comment id="12794269" author="jdcryans" created="Wed, 23 Dec 2009 23:24:46 +0000"  >&lt;p&gt;Patch for branch so that others can test.&lt;/p&gt;</comment>
                            <comment id="12794289" author="stack" created="Thu, 24 Dec 2009 01:19:52 +0000"  >&lt;p&gt;Patch looks good J-D.&lt;/p&gt;</comment>
                            <comment id="12794291" author="jdcryans" created="Thu, 24 Dec 2009 01:24:23 +0000"  >&lt;p&gt;I committed the new patch to trunk and branch, let&apos;s see what Hudson says.&lt;/p&gt;</comment>
                            <comment id="12794847" author="jdcryans" created="Mon, 28 Dec 2009 18:20:36 +0000"  >&lt;p&gt;The test passes now and others too. Closing.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12428880" name="HBASE-2065-2-branch.patch" size="5524" author="jdcryans" created="Wed, 23 Dec 2009 23:24:46 +0000"/>
                            <attachment id="12428795" name="HBASE-2065-2.patch" size="6951" author="jdcryans" created="Wed, 23 Dec 2009 06:37:03 +0000"/>
                            <attachment id="12428781" name="HBASE-2065-branch.patch" size="2844" author="jdcryans" created="Wed, 23 Dec 2009 00:33:12 +0000"/>
                            <attachment id="12428726" name="HBASE-2065.patch" size="8015" author="jdcryans" created="Tue, 22 Dec 2009 10:41:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 22 Dec 2009 20:36:46 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32393</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 51 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08t3b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49313</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>