<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:58:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2025/HBASE-2025.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2025] 0.20.2 accessed from older client throws UndeclaredThrowableException; frustrates rolling upgrade</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2025</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;From the list:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
After upgrading HBase from 0.20.0 to 0.20.2 I am getting following error
message:

java.lang.reflect.UndeclaredThrowableException
at $Proxy2.getRegionInfo(Unknown Source)
at
org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRootRegion(HConnectionManager.java:931)
at
org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegion(HConnectionManager.java:573)
at
org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegion(HConnectionManager.java:549)
at
org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegionInMeta(HConnectionManager.java:623)
at
org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegion(HConnectionManager.java:582)
at
org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegion(HConnectionManager.java:549)
at
org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegionInMeta(HConnectionManager.java:623)
at
org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegion(HConnectionManager.java:586)
at
org.apache.hadoop.hbase.client.HConnectionManager$TableServers.locateRegion(HConnectionManager.java:549)
at org.apache.hadoop.hbase.client.HTable.&amp;lt;init&amp;gt;(HTable.java:125)
at org.apache.hadoop.hbase.client.HTable.&amp;lt;init&amp;gt;(HTable.java:103)
at com.xxxx.OrderLoader$CustomerReducer.setup(OrderLoader.java:81)
at org.apache.hadoop.mapreduce.Reducer.run(Reducer.java:172)
at org.apache.hadoop.mapred.ReduceTask.runNewReducer(ReduceTask.java:563)
at org.apache.hadoop.mapred.ReduceTask.run(ReduceTask.java:408)
at org.apache.hadoop.mapred.Child.main(Child.java:170)
Caused by: org.apache.hadoop.ipc.RemoteException: java.io.IOException:
java.lang.NullPointerException

at org.apache.hadoop.hbase.ipc.HBaseClient.call(HBaseClient.java:723)
at org.apache.hadoop.hbase.ipc.HBaseRPC$Invoker.invoke(HBaseRPC.java:328)
... 17 more

This is happening &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the following line in my code:

&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.table = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HTable(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HBaseConfiguration(), tableName);

This used to work flawlessly before, so seems like something changed in
HBaseConfiguration, may be?  I am looking into &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, but any pointers would
be greatly appreciated.


&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We should figure what we broke.  Try fix for 0.20.3.  In future, as part of release, try accessing cluster with an older client to ensure we&apos;ve not done something that would frustrate rolling upgrade.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12442268">HBASE-2025</key>
            <summary>0.20.2 accessed from older client throws UndeclaredThrowableException; frustrates rolling upgrade</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Wed, 2 Dec 2009 21:11:42 +0000</created>
                <updated>Fri, 12 Oct 2012 06:14:17 +0000</updated>
                            <resolved>Thu, 31 Dec 2009 01:34:44 +0000</resolved>
                                                    <fixVersion>0.20.3</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12794937" author="apurtell" created="Mon, 28 Dec 2009 21:27:19 +0000"  >&lt;p&gt;Raising priority to blocker on branch. If there&apos;s a flaw that prevents rolling upgrade we should fix it here not propagate it to another minor release. &lt;/p&gt;</comment>
                            <comment id="12795224" author="jdcryans" created="Wed, 30 Dec 2009 02:58:51 +0000"  >&lt;p&gt;So every client works on every 0.20 minor revision except for 0.20.0 since &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1574&quot; title=&quot;Client and server APIs to do batch deletes.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1574&quot;&gt;&lt;del&gt;HBASE-1574&lt;/del&gt;&lt;/a&gt; changed HRegionInterface. We have to tell our users to not do a rolling upgrade from 0.20.0 &lt;/p&gt;

&lt;p&gt;I will also investigate why a new method in the interface generates NPE.&lt;/p&gt;</comment>
                            <comment id="12795392" author="jdcryans" created="Wed, 30 Dec 2009 19:03:11 +0000"  >&lt;p&gt;The reason why adding a method at the end of an interface doesn&apos;t work is actually in the code of HBaseRPC:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-comment&quot;&gt;// There are no guarantees about the order in which items are returned in
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// so &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; a sort (Was seeing that sort was one way on one server and then
&lt;/span&gt;    &lt;span class=&quot;code-comment&quot;&gt;// another on different server).
&lt;/span&gt;    Arrays.sort(methods, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Comparator&amp;lt;Method&amp;gt;() {
      &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compare(Method left, Method right) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; left.getName().compareTo(right.getName());
      }
    });
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12795401" author="jdcryans" created="Wed, 30 Dec 2009 19:23:56 +0000"  >&lt;p&gt;Further notes.&lt;/p&gt;

&lt;p&gt;When we add a new method in RPC we call this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void addToMap(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; name, &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; code) {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (METHODNAME_TO_CODE.containsKey(name)) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
      }
      METHODNAME_TO_CODE.put(name, &lt;span class=&quot;code-object&quot;&gt;Byte&lt;/span&gt;.valueOf(code));
      CODE_TO_METHODNAME.put(&lt;span class=&quot;code-object&quot;&gt;Byte&lt;/span&gt;.valueOf(code), name);
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This means that put(final byte [] regionName, final Put put) and put(final byte[] regionName, final Put [] puts) share the same code. The reason it works is that once we get the name of the method we build the full signature using the name of the classes passed by the client call:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Method method =
    implementation.getMethod(call.getMethodName(),
       call.getParameterClasses());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This means that the NPE we get is pure luck, we could also be in a situation where the code is valid but returns the wrong method name.&lt;/p&gt;</comment>
                            <comment id="12795409" author="jdcryans" created="Wed, 30 Dec 2009 19:43:32 +0000"  >&lt;p&gt;Patch that catches the null method name and throws a more comprehensive message.&lt;/p&gt;</comment>
                            <comment id="12795474" author="stack" created="Wed, 30 Dec 2009 22:35:39 +0000"  >&lt;p&gt;+1 on applying the patch.&lt;/p&gt;

&lt;p&gt;The sort makes it so we can&apos;t add a new method between versions because it will throw off the ids?  So it seems like we can only add a new method to an interface IFF it is an override of an already-existing method?&lt;/p&gt;</comment>
                            <comment id="12795477" author="jdcryans" created="Wed, 30 Dec 2009 22:43:12 +0000"  >&lt;p&gt;As long as new method has an already existing name in any ipc interface, you&apos;re good. The rest of the signature is then processed differently.&lt;/p&gt;</comment>
                            <comment id="12795485" author="stack" created="Wed, 30 Dec 2009 23:18:08 +0000"  >&lt;p&gt;Thanks for figuring this J-D.  Should we back out the batch deletes?&lt;/p&gt;</comment>
                            <comment id="12795489" author="jdcryans" created="Wed, 30 Dec 2009 23:22:06 +0000"  >&lt;p&gt;Wait I was wrong, you simply can&apos;t add a new method since it will change the codes.&lt;/p&gt;

&lt;p&gt;Not so sure about backing out... Could that screw installs?&lt;/p&gt;</comment>
                            <comment id="12795494" author="jdcryans" created="Wed, 30 Dec 2009 23:41:11 +0000"  >&lt;p&gt;I committed my patch to branch and trunk. I don&apos;t think we should remove the batch deletes, there&apos;s probably not that many people who are planning to do a rolling upgrade from 0.20.0 straight to 0.20.3 so I vote to close this issue.&lt;/p&gt;</comment>
                            <comment id="12795505" author="stack" created="Thu, 31 Dec 2009 00:41:40 +0000"  >&lt;p&gt;Well I suppose backing out deletes will throw off codes so yeah let&apos;s not do that.  But adding An override should work since it will not change codes?  Don&apos;t all overrides have same code?&lt;/p&gt;</comment>
                            <comment id="12795506" author="stack" created="Thu, 31 Dec 2009 00:43:15 +0000"  >&lt;p&gt;Batch deletes were added to 0.20.2?&lt;/p&gt;</comment>
                            <comment id="12795508" author="jdcryans" created="Thu, 31 Dec 2009 00:45:27 +0000"  >&lt;p&gt;Batch deletes were added in 0.20.1&lt;/p&gt;

&lt;p&gt;Override should be ok I guess.&lt;/p&gt;</comment>
                            <comment id="12795510" author="stack" created="Thu, 31 Dec 2009 01:24:25 +0000"  >&lt;p&gt;Thanks boss. I am good w closing this issue now &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12429159" name="HBASE-2025.patch" size="768" author="jdcryans" created="Wed, 30 Dec 2009 19:43:31 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 28 Dec 2009 21:27:19 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26106</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 51 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08t3r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49315</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>