<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:10:33 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3478/HBASE-3478.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3478] HBase fails to recover from failed DNS resolution of stale meta connection info</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3478</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This looks like a variant of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3445&quot; title=&quot;Master crashes on data that was moved from different host&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3445&quot;&gt;&lt;del&gt;HBASE-3445&lt;/del&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;p&gt;One of our developers ran a seed program with configuration A to generate some test data on his local machine. He then moved that data into a development environment on the same machine with a different hbase configuration B.&lt;/p&gt;

&lt;p&gt;On startup the HMaster waits for new regionserver to register itself:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;25/01/11 15:37:25&amp;#93;&lt;/span&gt; 162161 [  HRegionServer] INFO  ase.regionserver.HRegionServer  - Telling master at 10.0.1.4:7801 that we are up&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;25/01/11 15:37:25&amp;#93;&lt;/span&gt; 162165 &lt;span class=&quot;error&quot;&gt;&amp;#91;ice-EventThread&amp;#93;&lt;/span&gt; DEBUG .hadoop.hbase.zookeeper.ZKUtil  - master:7801-0x12dbf879abe0000 Retrieved 13 byte(s) of data from znode /hbase/rs/10.0.1.4,7802,1295998613814 and set watcher; 10.0.1.4:7802&lt;/p&gt;

&lt;p&gt;Then ROOT region comes online at the right place: 10.0.1.4,7802&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;25/01/11 15:37:31&amp;#93;&lt;/span&gt; 168369 &lt;span class=&quot;error&quot;&gt;&amp;#91;yTasks:70236052&amp;#93;&lt;/span&gt; INFO  ase.catalog.RootLocationEditor  - Setting ROOT region location in ZooKeeper as 10.0.1.4:7802&lt;br/&gt;
3:57 &lt;span class=&quot;error&quot;&gt;&amp;#91;25/01/11 15:37:31&amp;#93;&lt;/span&gt; 168408 &lt;span class=&quot;error&quot;&gt;&amp;#91;10.0.1.4:7801-0&amp;#93;&lt;/span&gt; DEBUG er.handler.OpenedRegionHandler  - Opened region &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 on 10.0.1.4,7802,1295998613814&lt;/p&gt;

&lt;p&gt;But then HMaster chokes on the stale META region location.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;25/01/11 15:37:31&amp;#93;&lt;/span&gt; 168448 [        HMaster] ERROR he.hadoop.hbase.HServerAddress  - Could not resolve the DNS name of warren:60020&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;25/01/11 15:37:31&amp;#93;&lt;/span&gt; 168448 [        HMaster] FATAL he.hadoop.hbase.master.HMaster  - Unhandled exception. Starting shutdown.&lt;br/&gt;
java.lang.IllegalArgumentException: Could not resolve the DNS name of warren:60020&lt;br/&gt;
   at org.apache.hadoop.hbase.HServerAddress.checkBindAddressCanBeResolved(HServerAddress.java:105)&lt;br/&gt;
   at org.apache.hadoop.hbase.HServerAddress.&amp;lt;init&amp;gt;(HServerAddress.java:66)&lt;br/&gt;
   at org.apache.hadoop.hbase.catalog.MetaReader.readLocation(MetaReader.java:344)&lt;br/&gt;
   at org.apache.hadoop.hbase.catalog.MetaReader.readMetaLocation(MetaReader.java:281)&lt;br/&gt;
   at org.apache.hadoop.hbase.catalog.CatalogTracker.getMetaServerConnection(CatalogTracker.java:280)&lt;br/&gt;
   at org.apache.hadoop.hbase.catalog.CatalogTracker.verifyMetaRegionLocation(CatalogTracker.java:482)&lt;br/&gt;
   at org.apache.hadoop.hbase.master.HMaster.assignRootAndMeta(HMaster.java:435)&lt;br/&gt;
   at org.apache.hadoop.hbase.master.HMaster.finishInitialization(HMaster.java:382)&lt;br/&gt;
   at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:277)&lt;br/&gt;
   at java.lang.Thread.run(Thread.java:680)&lt;/p&gt;

&lt;p&gt;First of all, we do not yet understand why in configuration A the RegionInfo resolved to &quot;warren:60020&quot; whereas in configuration B we get &quot;10.0.1.4:7802&quot;.  The port numbers make sense but not the &quot;warren&quot; hostname. It&apos;s probably specific to Warren&apos;s mac environment somehow because no other developer gets this problem when doing the same thing.  &quot;warren&quot; isn&apos;t in his hosts file so that remains a mystery.&lt;/p&gt;

&lt;p&gt;But irrespective of that, since the ports differ we expect the stale meta connection data to cause connection failure anyway.  Perhaps in the form of a SocketTimeoutException as in hbase-3445.&lt;/p&gt;

&lt;p&gt;But shouldn&apos;t the HMaster handle that by catching the exception and letting verifyMetaRegionLocation() fail so that meta regions get reassigned to the new region server?&lt;/p&gt;

&lt;p&gt;Probably the safeguards in CatalogTracker.getCachedConnection() should move up to getMetaServerConnection() so as to encompass MetaReader.readMetaLocation() also. Essentially if getMetaServerConnection() encounters ANY exception connection to meta RegionServer it should probably just return null to force meta region reassignment.&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12496750">HBASE-3478</key>
            <summary>HBase fails to recover from failed DNS resolution of stale meta connection info</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jk-public@troove.net">James Kennedy</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Jan 2011 00:34:45 +0000</created>
                <updated>Mon, 4 Mar 2013 05:14:44 +0000</updated>
                            <resolved>Fri, 17 Jun 2011 23:20:34 +0000</resolved>
                                    <version>0.90.1</version>
                                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12986792" author="jk-public@troove.net" created="Wed, 26 Jan 2011 00:41:27 +0000"  >&lt;p&gt;Configuration A:&lt;/p&gt;

&lt;p&gt;&amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;hbase.rootdir&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;hdfs://localhost:8701/hbase&amp;lt;/value&amp;gt;&lt;br/&gt;
    &amp;lt;/property&amp;gt;&lt;br/&gt;
    &amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;hbase.master.port&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;60010&amp;lt;/value&amp;gt;&lt;br/&gt;
    &amp;lt;/property&amp;gt;&lt;br/&gt;
    &amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;hbase.regionserver.port&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;60020&amp;lt;/value&amp;gt;&lt;br/&gt;
    &amp;lt;/property&amp;gt;&lt;br/&gt;
    &amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;hbase.zookeeper.property.clientPort&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;60030&amp;lt;/value&amp;gt;&lt;br/&gt;
    &amp;lt;/property&amp;gt;&lt;br/&gt;
&amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;hbase.regionserver.msginterval&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;100&amp;lt;/value&amp;gt;&lt;br/&gt;
        &amp;lt;description&amp;gt;Interval between messages from the RegionServer to HMaster&lt;br/&gt;
            in milliseconds.  Default is 15 sec. Set this value low if you want unit&lt;br/&gt;
            tests to be responsive.&lt;br/&gt;
        &amp;lt;/description&amp;gt;&lt;br/&gt;
    &amp;lt;/property&amp;gt;&lt;br/&gt;
    &amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;hbase.client.pause&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;100&amp;lt;/value&amp;gt;&lt;br/&gt;
    &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;Configuration B:&lt;br/&gt;
&amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;hbase.rootdir&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;hdfs://localhost:7701/hbase&amp;lt;/value&amp;gt;&lt;br/&gt;
    &amp;lt;/property&amp;gt;&lt;br/&gt;
    &amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;hbase.master.port&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;7801&amp;lt;/value&amp;gt;&lt;br/&gt;
    &amp;lt;/property&amp;gt;&lt;br/&gt;
    &amp;lt;property&amp;gt;&lt;br/&gt;
        &amp;lt;name&amp;gt;hbase.regionserver.port&amp;lt;/name&amp;gt;&lt;br/&gt;
        &amp;lt;value&amp;gt;7802&amp;lt;/value&amp;gt;&lt;br/&gt;
    &amp;lt;/property&amp;gt;&lt;/p&gt;</comment>
                            <comment id="12992067" author="stack" created="Tue, 8 Feb 2011 17:47:06 +0000"  >&lt;p&gt;This looks like something hbase-3446 would fix.  What you think James?  Rather than return raw Interface up out of readMetaLocation, we&apos;ll return an HTable.&lt;/p&gt;</comment>
                            <comment id="12992089" author="jk-public@troove.net" created="Tue, 8 Feb 2011 18:31:32 +0000"  >&lt;p&gt;I&apos;m not 100% convinced.  Even if readRegionLocation is well-proofed and retries as hard as it can it is still one of several possible exception throwers within getMetaServerConnection(). hbase-3445 is an example of that where we had to plug a hole in the exception handling of getCachedConnection(). &lt;/p&gt;

&lt;p&gt;I think the greater point i was trying to make above is that robust exception handling needs to move up into getMetaServerConnection(). Assume you want to catch and log ALL exceptions and then maybe handle the exceptional exceptions that we actually DO want to have terminate HMaster fatally when it can&apos;t connect to a meta server, if any. &lt;/p&gt;</comment>
                            <comment id="12992099" author="stack" created="Tue, 8 Feb 2011 18:50:10 +0000"  >&lt;p&gt;Your fix up in hbase-3445 was because the new class CatalogTracker was working with low-level HRegionInterface and for want of usage, it had not tripped all possible exceptions.  The hbase-3446 was about putting in place the wizened HTable; its seen it all so catches and retries the litany of possible exceptions.  I think &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3446&quot; title=&quot;ProcessServerShutdown fails if META moves, orphaning lots of regions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3446&quot;&gt;&lt;del&gt;HBASE-3446&lt;/del&gt;&lt;/a&gt; is about your greater point of more robust exception handling.&lt;/p&gt;

&lt;p&gt;Let me link this issue to that one and see if I can come up with a unit test that repros your exception above.&lt;/p&gt;

&lt;p&gt;Thanks James.&lt;/p&gt;</comment>
                            <comment id="13016198" author="jdcryans" created="Wed, 6 Apr 2011 00:28:12 +0000"  >&lt;p&gt;This situation happened to someone on the mailing list.&lt;/p&gt;</comment>
                            <comment id="13047547" author="stack" created="Fri, 10 Jun 2011 22:45:46 +0000"  >&lt;p&gt;Moving out of 0.92.0. Pull it back in if you think different.&lt;/p&gt;</comment>
                            <comment id="13051196" author="tlipcon" created="Fri, 17 Jun 2011 17:00:40 +0000"  >&lt;p&gt;This got fixed, right?&lt;/p&gt;</comment>
                            <comment id="13051396" author="stack" created="Fri, 17 Jun 2011 23:21:23 +0000"  >&lt;p&gt;I meant to say, resolving as fixed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3446&quot; title=&quot;ProcessServerShutdown fails if META moves, orphaning lots of regions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3446&quot;&gt;&lt;del&gt;HBASE-3446&lt;/del&gt;&lt;/a&gt; &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12495731">HBASE-3446</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 8 Feb 2011 17:47:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26877</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 26 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hmfj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100896</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>