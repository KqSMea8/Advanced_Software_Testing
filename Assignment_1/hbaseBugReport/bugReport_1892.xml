<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:57:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1892/HBASE-1892.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1892] [performance] make hbase splits run faster</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1892</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;hbase-1506 tried and failed making splits faster in 0.20 context.  This issue is about doing it in 0.21 where we&apos;ll have to tools to do.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12437541">HBASE-1892</key>
            <summary>[performance] make hbase splits run faster</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Wed, 7 Oct 2009 20:06:55 +0000</created>
                <updated>Fri, 12 Oct 2012 06:14:58 +0000</updated>
                            <resolved>Thu, 15 Apr 2010 04:13:04 +0000</resolved>
                                                    <fixVersion>0.20.4</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12791697" author="stack" created="Thu, 17 Dec 2009 00:34:22 +0000"  >&lt;p&gt;Here are some observations by J-D from a recent (offlist) mail:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
So, the way it currently works, you should expect pauses of 6 to 10
seconds every time there&apos;s a split. If the system has more load, it
can take a bit longer. This is &lt;span class=&quot;code-quote&quot;&gt;&quot;how it works&quot;&lt;/span&gt; in the current master
architecture... [to be changed in 0.21 hbase -- St.Ack]. This configuration:

 &amp;lt;property&amp;gt;
   &amp;lt;name&amp;gt;hbase.regionserver.msginterval&amp;lt;/name&amp;gt;
   &amp;lt;value&amp;gt;3000&amp;lt;/value&amp;gt;
   &amp;lt;description&amp;gt;Interval between messages from the RegionServer to HMaster
   in milliseconds.  Default is 3 seconds.
   &amp;lt;/description&amp;gt;
 &amp;lt;/property&amp;gt;

makes it that every split takes up to 3 second to report to master and then
3 more seconds &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the master to assign the &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; regions. Coupled with
that is the client retries backoff. In HConnectionManager we wait
hbase.client.pause (&lt;span class=&quot;code-keyword&quot;&gt;default&lt;/span&gt; 2 secs) times

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; RETRY_BACKOFF[] = { 1, 1, 1, 2, 2, 4, 4, 8, 16, 32 };

in order. So &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a split you wait 2 + 2 + 2 seconds in the client. If
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; some reason it took longer to split, you will wait 6+2*2=10
seconds (or more).

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A couple of notes on the above.&lt;/p&gt;

&lt;p&gt;Not so long ago I changed the regionserver so that as soon as it had a message, it&apos;d send the master and not wait on the hbase.regionserver.msginterval to elapse.&lt;/p&gt;

&lt;p&gt;My guess is that if more than one regionserver, rare would be the case when we would have to wait 3 seconds to send out the assignment of daughters &amp;#8211; my guess is that a regionserver would check in well before then.&lt;/p&gt;

&lt;p&gt;But then there is the open of the region and informing master.&lt;/p&gt;

&lt;p&gt;Maybe we should add to the RETRY_BACKOFF a bunch more 1s at the start... and maybe down the hbase.client.pause default from 2 seconds to 1.&lt;/p&gt;</comment>
                            <comment id="12791710" author="apurtell" created="Thu, 17 Dec 2009 00:57:27 +0000"  >&lt;blockquote&gt;&lt;p&gt;Maybe we should add to the RETRY_BACKOFF a bunch more 1s at the start... and maybe down the hbase.client.pause default from 2 seconds to 1.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;And up the default number of retries. &lt;/p&gt;

&lt;p&gt;Sounds good to me. &lt;/p&gt;</comment>
                            <comment id="12791719" author="stack" created="Thu, 17 Dec 2009 01:14:44 +0000"  >&lt;p&gt;And maybe change the default period to 1 second instead of 3 or 2 even?  On small clusters probably not a prob. having them check in alot?&lt;/p&gt;</comment>
                            <comment id="12791720" author="stack" created="Thu, 17 Dec 2009 01:15:34 +0000"  >&lt;p&gt;Sorry, above changes would be for 0.20.3.  In 0.21, should all be queues up in zk so should be more &apos;live&apos;.  If good, I&apos;ll make a new issue for 0.20.3 to make splits faster.&lt;/p&gt;</comment>
                            <comment id="12791721" author="jdcryans" created="Thu, 17 Dec 2009 01:19:18 +0000"  >&lt;p&gt;Been thinking about exactly that a lot. +1&lt;/p&gt;</comment>
                            <comment id="12793449" author="jdcryans" created="Tue, 22 Dec 2009 01:08:28 +0000"  >&lt;p&gt;Little experiment trying to even further improve the splitting process. Basically it opens the region right away and then tells the master. The HLog thing I removed is because the debug was filling my disk, sorry.&lt;/p&gt;

&lt;p&gt;Unfortunately, it&apos;s not faster. It takes a second to split, in the mean time the client first notices that the region (under split) isn&apos;t served, then refreshes once and the region server still didn&apos;t update .META., then it waits one second and finally finds the new region.&lt;/p&gt;</comment>
                            <comment id="12836901" author="stack" created="Mon, 22 Feb 2010 20:58:46 +0000"  >&lt;p&gt;Linking to related issues.&lt;/p&gt;</comment>
                            <comment id="12836903" author="stack" created="Mon, 22 Feb 2010 21:00:55 +0000"  >&lt;p&gt;One hump that is in the way of faster splitting is that we do a flush while the close flag is up.  On a loaded hdfs just now, I saw that this flush took 10 seconds to write out an hfile of 40M which ain&apos;t the worst but during this ten seconds, the close flag on the region was up and so any one trying to write this region &amp;#8211; and probably read was barred access and probably off wandering in the wilderness looking for where the region now resides.&lt;/p&gt;</comment>
                            <comment id="12851936" author="streamy" created="Wed, 31 Mar 2010 16:34:55 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2375&quot; title=&quot;Revisit compaction configuration parameters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2375&quot;&gt;&lt;del&gt;HBASE-2375&lt;/del&gt;&lt;/a&gt; will help with split performance&lt;/p&gt;</comment>
                            <comment id="12851943" author="streamy" created="Wed, 31 Mar 2010 16:39:21 +0000"  >&lt;p&gt;Related to stack&apos;s comment, we should be doing what they do in bigtable.  Notes about this in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2375&quot; title=&quot;Revisit compaction configuration parameters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2375&quot;&gt;&lt;del&gt;HBASE-2375&lt;/del&gt;&lt;/a&gt; as well.&lt;/p&gt;

&lt;p&gt;Rather than:  Decide to split, block updates, perform flush.&lt;/p&gt;

&lt;p&gt;We should:  Decide to split, perform flush, block updates, perform flush.&lt;/p&gt;

&lt;p&gt;In the former, we have to block while writing what could be a very large memstore.  In the latter, we flush and then block.  The final flush would only have to flush data that was written during the first flush which should be significantly less data in almost all cases.&lt;/p&gt;</comment>
                            <comment id="12852910" author="stack" created="Fri, 2 Apr 2010 18:49:05 +0000"  >&lt;p&gt;Putting in 0.20.4. Assigning to myself.&lt;/p&gt;</comment>
                            <comment id="12852921" author="streamy" created="Fri, 2 Apr 2010 19:06:28 +0000"  >&lt;p&gt;Should have a patch for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2375&quot; title=&quot;Revisit compaction configuration parameters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2375&quot;&gt;&lt;del&gt;HBASE-2375&lt;/del&gt;&lt;/a&gt; up soon.&lt;/p&gt;</comment>
                            <comment id="12857028" author="stack" created="Wed, 14 Apr 2010 19:05:16 +0000"  >&lt;p&gt;Just a note to say that claim that we always open daughters on the parents regionserver is not always correct. Here is evidence:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2010-04-13 22:08:24,789 INFO org.apache.hadoop.hbase.master.ServerManager: Processing MSG_REPORT_SPLIT_INCLUDES_DAUGHTERS: TestTable,0831629754,1271221664605: Daughters; TestTable,0831629754,1271221697383, TestTable,0963154468,1271221697383 from sv188,60020,1271221587612; 1 of 1
2010-04-13 22:08:24,792 INFO org.apache.hadoop.hbase.master.RegionManager: Assigning region TestTable,0963154468,1271221697383 to sv188,60020,1271221587612
2010-04-13 22:08:24,867 INFO org.apache.hadoop.hbase.master.RegionManager: Assigning region TestTable,0831629754,1271221697383 to sv189,60020,1271221587623
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12857086" author="stack" created="Wed, 14 Apr 2010 20:49:09 +0000"  >&lt;p&gt;Another thing that can hold up close is if when the close message comes in and we are working on a compaction, we&apos;ll wait until the compaction has finished BUT the close flag has already been put in place.&lt;/p&gt;</comment>
                            <comment id="12857090" author="stack" created="Wed, 14 Apr 2010 20:52:33 +0000"  >&lt;p&gt;Patch that will do a flush before we put up close flag if memstores &amp;gt; 10MB or so (configurable).  Also make it so if a running compaction, we don&apos;t put up the close flag till its done.  Going to test it.&lt;/p&gt;</comment>
                            <comment id="12857145" author="streamy" created="Wed, 14 Apr 2010 23:25:20 +0000"  >&lt;p&gt;Reviewed patch and it looks good.  Maybe lower the default threshold and add it into hbase-default.xml on commit.&lt;/p&gt;

&lt;p&gt;Have been running import tests here.  Will add this and rerun to see if we get any perf improvements (or bugs).&lt;/p&gt;</comment>
                            <comment id="12857160" author="stack" created="Thu, 15 Apr 2010 00:25:16 +0000"  >&lt;p&gt;Bringing into 0.20.4 because makes a big difference.&lt;/p&gt;

&lt;p&gt;But there is something else going on in that regionserver hosting .META. does not seem to be caching.   Looking into that first.&lt;/p&gt;</comment>
                            <comment id="12857192" author="stack" created="Thu, 15 Apr 2010 04:13:04 +0000"  >&lt;p&gt;Committed to two branches and to trunk.  Thanks for the review Jon.  This patch seems to help with getting regions on line faster for sure in my testing.  I did as you suggested lowering threshold to 5MB and adding to hbase-default.xml configuration.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12374848">HBASE-354</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12427469">HBASE-1506</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                            <outwardlinks description="incorporates">
                                        <issuelink>
            <issuekey id="12460243">HBASE-2375</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12463633">HBASE-2510</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12427469">HBASE-1506</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12441768" name="ASF.LICENSE.NOT.GRANTED--1892-preflush.patch" size="2137" author="stack" created="Wed, 14 Apr 2010 20:52:33 +0000"/>
                            <attachment id="12428679" name="HBASE-1892.patch" size="6664" author="jdcryans" created="Tue, 22 Dec 2009 01:08:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Dec 2009 00:57:27 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32303</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            6 years, 36 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08svj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49278</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>On region close, this change makes it so we don&amp;#39;t wait on compaction to complete with the close-region flag in place -- i.e. region is offline while we wait on the compaction close -- and secondly, if the region memstores are over a configurable limit, before closing, we&amp;#39;ll run a &amp;quot;pre-flush&amp;quot; to get the bulk of the memory flushed before we put the close flag up.</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>