<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:48:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-919/HBASE-919.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-919] Master and Region Server need to provide root region location if they are using HTable</title>
                <link>https://issues.apache.org/jira/browse/HBASE-919</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There needs to be a mechanism by which master and region servers can provide the HServerAddress for the root region to HConnectionManager so that they can use a HTable. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12406222">HBASE-919</key>
            <summary>Master and Region Server need to provide root region location if they are using HTable</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12397996">HBASE-678</parent>
                                    <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jimk">Jim Kellerman</assignee>
                                    <reporter username="jimk">Jim Kellerman</reporter>
                        <labels>
                    </labels>
                <created>Fri, 10 Oct 2008 23:37:57 +0000</created>
                <updated>Sun, 13 Sep 2009 22:26:28 +0000</updated>
                            <resolved>Mon, 20 Oct 2008 16:15:59 +0000</resolved>
                                    <version>0.18.0</version>
                                    <fixVersion>0.19.0</fixVersion>
                                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12638689" author="stack" created="Sat, 11 Oct 2008 00:06:24 +0000"  >&lt;p&gt;This issue was uncovered because of way HMaster now refuses to let out the root location till all regions deployed?  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-918&quot; title=&quot;Region balancing during startup makes cluster unstable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-918&quot;&gt;&lt;del&gt;HBASE-918&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;

&lt;p&gt;Would there ever be functionality in HTable that is not in HConnectionManager regards retries or table-level manipulations that an HMaster or an HRS might exploit?&lt;/p&gt;</comment>
                            <comment id="12639476" author="jimk" created="Tue, 14 Oct 2008 16:34:35 +0000"  >&lt;p&gt;Changing to fix 0.19. Not required for 0.18.x&lt;/p&gt;</comment>
                            <comment id="12639997" author="jimk" created="Wed, 15 Oct 2008 22:48:01 +0000"  >&lt;p&gt;I&apos;d like to get someone else to review this before I commit it. (It does work)&lt;/p&gt;</comment>
                            <comment id="12640257" author="stack" created="Thu, 16 Oct 2008 18:38:42 +0000"  >&lt;p&gt;o.a.h.h.client.server is going to confuse.  Maybe just put the subpackage members up in client? (Its messy that servers use content of client subpackage &amp;#8211; we could move the common classes up but then client subpackage would probably be empty?).  HCM constructor could then be package private.  &lt;/p&gt;

&lt;p&gt;HSCM is missing class javadoc.&lt;/p&gt;

&lt;p&gt;Should we drop the &apos;H&apos; prefix at least on your new additions?&lt;/p&gt;

&lt;p&gt;Otherwise, looks good to me.&lt;/p&gt;</comment>
                            <comment id="12640287" author="jimk" created="Thu, 16 Oct 2008 19:39:57 +0000"  >&lt;p&gt;Moved new classes to o.a.h.h.client&lt;br/&gt;
Added missing javadoc&lt;br/&gt;
Dropped H prefix on new classes.&lt;/p&gt;</comment>
                            <comment id="12640289" author="jimk" created="Thu, 16 Oct 2008 19:46:56 +0000"  >&lt;p&gt;Committed to trunk&lt;/p&gt;</comment>
                            <comment id="12640561" author="jimk" created="Fri, 17 Oct 2008 16:29:27 +0000"  >&lt;p&gt;It has been reported that finding the root region in HRegionServer.housekeeping is too late to get HRegionServer off the ground.&lt;/p&gt;</comment>
                            <comment id="12640573" author="jimk" created="Fri, 17 Oct 2008 16:48:26 +0000"  >&lt;p&gt;This patch moves finding the root region to the head of HRegionServer.run instead of waiting for HRegionServer.housekeeping&lt;/p&gt;</comment>
                            <comment id="12640584" author="stack" created="Fri, 17 Oct 2008 17:14:30 +0000"  >&lt;p&gt;Who reported it too late?&lt;/p&gt;</comment>
                            <comment id="12640678" author="stack" created="Fri, 17 Oct 2008 21:47:02 +0000"  >&lt;p&gt;This or 926 is causing hudson to fail.  THBC doesn&apos;t pass for me either (Doesn&apos;t work for J-D apparently).&lt;/p&gt;</comment>
                            <comment id="12640714" author="stack" created="Sat, 18 Oct 2008 00:39:28 +0000"  >&lt;p&gt;I tried the latest patch:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    [junit] 2008-10-17 17:33:58,072 DEBUG [main] client.HConnectionManager$TableServers(782): Wake. Retry finding root region.
    [junit] 2008-10-17 17:33:58,074 DEBUG [main] client.HConnectionManager$TableServers(778): Sleeping. Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; root region.
    [junit] 2008-10-17 17:34:13,074 DEBUG [main] client.HConnectionManager$TableServers(782): Wake. Retry finding root region.
    [junit] 2008-10-17 17:34:13,077 DEBUG [main] client.HConnectionManager$TableServers(778): Sleeping. Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; root region.
    [junit] 2008-10-17 17:34:28,078 DEBUG [main] client.HConnectionManager$TableServers(782): Wake. Retry finding root region.
    [junit] 2008-10-17 17:34:28,079 DEBUG [main] client.HConnectionManager$TableServers(778): Sleeping. Waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; root region.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I get a load of the above.... is that new?&lt;/p&gt;

&lt;p&gt;Its stuck for me here.&lt;/p&gt;</comment>
                            <comment id="12640887" author="jimk" created="Mon, 20 Oct 2008 00:03:12 +0000"  >&lt;p&gt;Yes, I can reproduce it running unit tests on linux although PerformanceEvaluation seems to run ok. Also unit tests work on&lt;br/&gt;
windows (probably due to thread scheduling differences).&lt;/p&gt;

&lt;p&gt;I&apos;d like to back it out, but that would be real hard with all the changes JD made for 748.&lt;/p&gt;

&lt;p&gt;I may have to back to not using HTable on the server side. The workaround I came up with the servers supplying the &lt;br/&gt;
root region location to HServerConnectionManager just doesn&apos;t seem to work. (again a timing problem)&lt;/p&gt;</comment>
                            <comment id="12640891" author="jdcryans" created="Mon, 20 Oct 2008 00:24:26 +0000"  >&lt;p&gt;Jim, look at this patch &lt;a href=&quot;https://issues.apache.org/jira/secure/attachment/12392377/hbase-748-v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/secure/attachment/12392377/hbase-748-v6.patch&lt;/a&gt;  in HBaseClusterTestCase, that fix (that did not get committed) did it for me. With that 5 sec sleep, every tests run fine. This is also why starting a cluster works and why PE works with current trunk.&lt;/p&gt;</comment>
                            <comment id="12640892" author="jimk" created="Mon, 20 Oct 2008 00:37:24 +0000"  >&lt;p&gt;JD: aside from the wait in HBaseClusterTestCase, I don&apos;t really see anything else relevant to this issue. At the&lt;br/&gt;
very least this should be transparent to the client and HTable should do the &quot;right thing&quot;&lt;/p&gt;

&lt;p&gt;Arbitrary sleep can come back to bite you if the cluster is slower than you anticipate.&lt;/p&gt;

&lt;p&gt;But thanks for the input, maybe I am not as far off as I think I am. What I have is a timing/synchronization problem&lt;br/&gt;
and those are often the nastiest to resolve given all the moving parts.&lt;/p&gt;</comment>
                            <comment id="12640895" author="jimk" created="Mon, 20 Oct 2008 00:48:38 +0000"  >&lt;p&gt;Or is it because test cases all run in the same jvm and one needs to yield (by sleeping) so that the other threads&lt;br/&gt;
can do their thing?&lt;/p&gt;</comment>
                            <comment id="12640898" author="jimk" created="Mon, 20 Oct 2008 02:24:52 +0000"  >&lt;p&gt;Ok, this problem is definately a timing issue. With the sleep in there it seems to always work, without, well you take&lt;br/&gt;
your chances against thread scheduling.&lt;/p&gt;</comment>
                            <comment id="12640900" author="jdcryans" created="Mon, 20 Oct 2008 02:46:54 +0000"  >&lt;p&gt;Friday I did a lot of debug to see what was going on and like I wrote on IRC, here&apos;s what&apos;s happening without the sleep for the unit tests :&lt;/p&gt;

&lt;p&gt;ROOT gets assigned&lt;br/&gt;
META reports it&apos;s opening but is still not processed&lt;br/&gt;
The HTable creation in HBaseClusterTestCase occurs&lt;br/&gt;
The creation requires the address of ROOT&lt;br/&gt;
The HMaster asks the RegionManager if all regions are assigned which calls the following code &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; allRegionsAssigned() {
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; isInitialMetaScanComplete() &amp;amp;&amp;amp; unassignedRegions.size() == 0 &amp;amp;&amp;amp;
      pendingRegions.size() == 0;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;My debug shows me that the pendingRegions.size() equals 1&lt;br/&gt;
So, the HTable creation hangs because this verification is retried&lt;br/&gt;
In the mean time, the META table is being processed (so it&apos;s a pending region)&lt;br/&gt;
During it&apos;s opening, it onlines the region historian which tries to create a HTable&lt;br/&gt;
First thing it does is trying to find the ROOT region and goes into :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (Bytes.equals(tableName, ROOT_TABLE_NAME)) {
        &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; (rootRegionLock) {
          &lt;span class=&quot;code-comment&quot;&gt;// This block guards against two threads trying to find the root
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// region at the same time. One will go &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; the find &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; the 
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// second waits. The second thread will not &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; find.
&lt;/span&gt;          
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!useCache || rootRegionLocation == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; locateRootRegion();
          }
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; rootRegionLocation;
        }        
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here the synchronized block is already taken by the first HTable I described (in HBaseClusterTestCase )&lt;/p&gt;

&lt;p&gt;deadlock&lt;/p&gt;</comment>
                            <comment id="12640903" author="jimk" created="Mon, 20 Oct 2008 03:18:35 +0000"  >&lt;p&gt;If this latest commit works, please give it a +1, and I&apos;ll resolve this issue. It appears to work for me.&lt;/p&gt;</comment>
                            <comment id="12641031" author="jdcryans" created="Mon, 20 Oct 2008 15:01:54 +0000"  >&lt;p&gt;Fine here, +1&lt;/p&gt;</comment>
                            <comment id="12641055" author="jimk" created="Mon, 20 Oct 2008 16:15:59 +0000"  >&lt;p&gt;WIth a +1 from J-D and a successful build on Hudson, resolving issue as fixed.&lt;/p&gt;</comment>
                            <comment id="12641061" author="stack" created="Mon, 20 Oct 2008 16:38:58 +0000"  >&lt;p&gt;The patch seems to skirt the problem rather than address it with a 5 second pause.  The implication seems to be that anyone who wants to use an HTable first must pause 5 seconds.  Is that so?&lt;/p&gt;</comment>
                            <comment id="12641065" author="stack" created="Mon, 20 Oct 2008 16:47:46 +0000"  >&lt;p&gt;(I should have read the whole issue before commenting, pardon me).&lt;/p&gt;

&lt;p&gt;Even still, what is to prevent the J-D story happening in a real cluster, not just in unit tests?&lt;/p&gt;</comment>
                            <comment id="12641066" author="jdcryans" created="Mon, 20 Oct 2008 16:48:48 +0000"  >&lt;p&gt;I think it&apos;s related to the fact that HBase should have a &quot;safe mode&quot;. Jim&apos;s first patch added this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; HServerAddress findRootRegion() {
-    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; regionManager.getRootRegionLocation();

+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (regionManager.allRegionsAssigned()) {
+      rootServer = regionManager.getRootRegionLocation();
+    }
+    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; rootServer;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is a kind of safe mode, but it has implications. To be very precise about your comment stack, I would say that anyone who wants to use an HTable right after HBase is started (and I do mean the second after) must wait a moment before creating a HTable in the same process (or JVM, not sure) or it will deadlock. Anyone outside is OK because they don&apos;t go inside the same synchronized block in HCM.&lt;/p&gt;</comment>
                            <comment id="12641068" author="stack" created="Mon, 20 Oct 2008 16:52:22 +0000"  >&lt;p&gt;Ok.  Thats good enough for me.  Thanks for explaination.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12392355" name="919.patch" size="2210" author="jimk" created="Fri, 17 Oct 2008 16:48:26 +0000"/>
                            <attachment id="12392210" name="919.patch" size="13208" author="jimk" created="Wed, 15 Oct 2008 22:47:20 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 11 Oct 2008 00:06:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>31904</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 9 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0ha93:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98923</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>