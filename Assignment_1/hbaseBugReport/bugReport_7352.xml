<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:44:56 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7352/HBASE-7352.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7352] clone operation from HBaseAdmin can hang forever.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7352</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Sometimes the clone operation from the hbase shell can hang.  The table has been created (it shows up in the web ui), but does not have any entries in META.&lt;/p&gt;

&lt;p&gt;There don&apos;t seem to be any clone, snapshot, enable or disable found in the master&apos;s jstack.&lt;/p&gt;

&lt;p&gt;Here&apos;s a trace from the HBaseAdmin:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;main&quot;&lt;/span&gt; prio=10 tid=0x00007f782800d000 nid=0x25c waiting on condition [0x00007f782f9bf000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (sleeping)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(Native Method)
        at org.apache.hadoop.hbase.client.HBaseAdmin.cloneSnapshot(HBaseAdmin.java:2413)
        at org.apache.hadoop.hbase.client.HBaseAdmin.cloneSnapshot(HBaseAdmin.java:2393)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.jruby.javasupport.JavaMethod.invokeDirectWithExceptionHandling(JavaMethod.java:465)
        at org.jruby.javasupport.JavaMethod.invokeDirect(JavaMethod.java:323)
        at org.jruby.java.invokers.InstanceMethodInvoker.call(InstanceMethodInvoker.java:69)
        at org.jruby.runtime.callsite.CachingCallSite.call(CachingCallSite.java:201)
        at org.jruby.ast.CallTwoArgNode.interpret(CallTwoArgNode.java:59)
        at org.jruby.ast.NewlineNode.interpret(NewlineNode.java:104)
... (more jruby stack) ... 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;  </description>
                <environment></environment>
        <key id="12623872">HBASE-7352</key>
            <summary>clone operation from HBaseAdmin can hang forever.</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12556488">HBASE-6055</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="mbertozzi">Matteo Bertozzi</assignee>
                                    <reporter username="jmhsieh">Jonathan Hsieh</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Dec 2012 00:26:13 +0000</created>
                <updated>Mon, 23 Sep 2013 18:30:28 +0000</updated>
                            <resolved>Sat, 29 Dec 2012 19:06:09 +0000</resolved>
                                                    <fixVersion>0.95.0</fixVersion>
                                    <component>Client</component>
                    <component>master</component>
                    <component>regionserver</component>
                    <component>snapshots</component>
                    <component>Zookeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13531857" author="jmhsieh" created="Fri, 14 Dec 2012 00:37:27 +0000"  >&lt;p&gt;The snapshot can be cloned from another shell instance but must write to a different name.&lt;/p&gt;

&lt;p&gt;If you attempt to clone the snapshot (pe-11) to the same target table (pe-11-table), you get:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):006:0&amp;gt; clone_snapshot &apos;pe-11&apos;, &apos;pe-11-table&apos;

ERROR: org.apache.hadoop.hbase.snapshot.exception.RestoreSnapshotException: org.apache.hadoop.hbase.snapshot.exception.RestoreSnapshotExcept
ion: Couldn&apos;t clone the snapshot=name: &lt;span class=&quot;code-quote&quot;&gt;&quot;pe-11&quot;&lt;/span&gt;
table: &lt;span class=&quot;code-quote&quot;&gt;&quot;TestTable&quot;&lt;/span&gt; 
creationTime: 1355441918484
type: FLUSH
version: 0
 on table=pe-11-table
        at org.apache.hadoop.hbase.master.snapshot.manage.SnapshotManager.cloneSnapshot(SnapshotManager.java:558)
        at org.apache.hadoop.hbase.master.snapshot.manage.SnapshotManager.restoreSnapshot(SnapshotManager.java:597)
        at org.apache.hadoop.hbase.master.HMaster.restoreSnapshot(HMaster.java:2528)
        at sun.reflect.GeneratedMethodAccessor59.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.ProtobufRpcEngine$Server.call(ProtobufRpcEngine.java:356)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1816)
Caused by: org.apache.hadoop.hbase.TableExistsException: pe-11-table
        at org.apache.hadoop.hbase.master.handler.CreateTableHandler.&amp;lt;init&amp;gt;(CreateTableHandler.java:96)
        at org.apache.hadoop.hbase.master.snapshot.CloneSnapshotHandler.&amp;lt;init&amp;gt;(CloneSnapshotHandler.java:65)
        at org.apache.hadoop.hbase.master.snapshot.manage.SnapshotManager.cloneSnapshot(SnapshotManager.java:551)

        at org.apache.hadoop.hbase.master.snapshot.manage.SnapshotManager.cloneSnapshot(SnapshotManager.java:558)
        at org.apache.hadoop.hbase.master.snapshot.manage.SnapshotManager.restoreSnapshot(SnapshotManager.java:597)
        at org.apache.hadoop.hbase.master.HMaster.restoreSnapshot(HMaster.java:2528)
        at sun.reflect.GeneratedMethodAccessor59.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.ProtobufRpcEngine$Server.call(ProtobufRpcEngine.java:356)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1816)
Caused by: org.apache.hadoop.hbase.TableExistsException: pe-11-table
        at org.apache.hadoop.hbase.master.handler.CreateTableHandler.&amp;lt;init&amp;gt;(CreateTableHandler.java:96)
        at org.apache.hadoop.hbase.master.snapshot.CloneSnapshotHandler.&amp;lt;init&amp;gt;(CloneSnapshotHandler.java:65)
        at org.apache.hadoop.hbase.master.snapshot.manage.SnapshotManager.cloneSnapshot(SnapshotManager.java:551)
        ... 7 more
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The dir for seems to be present for table pe-11, but there seems to be a large number of missing files.&lt;/p&gt;

&lt;p&gt;In this particular case, the snapshot has 16 regions, while the failed attempt to restore has 12 regions moved into real table position.  This suggests that something failed internally but was allowed to continue to do the dir rename at some point.&lt;/p&gt;

&lt;p&gt;If one removes the data bad data from the hdfs we still cannot clone to the same pe-11-table name because there is some in memory state that blocks this.&lt;/p&gt;

&lt;p&gt;(grammar fixes)&lt;/p&gt;</comment>
                            <comment id="13531871" author="yuzhihong@gmail.com" created="Fri, 14 Dec 2012 00:58:23 +0000"  >&lt;blockquote&gt;&lt;p&gt;something failed internally but was allowed to continue to do the dir rename at some point.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This is not desirable. Renaming directory should only take place after all regions are copied.&lt;/p&gt;</comment>
                            <comment id="13531894" author="jmhsieh" created="Fri, 14 Dec 2012 01:25:52 +0000"  >&lt;p&gt;I agree.  Hence I have filed this bug.&lt;/p&gt;</comment>
                            <comment id="13539408" author="mbertozzi" created="Tue, 25 Dec 2012 15:06:51 +0000"  >&lt;p&gt;I&apos;ve missed the exit condition on retries, so if the table fail during the enable you&apos;ll keep spinning in the loop.&lt;/p&gt;

&lt;p&gt;The .tmp stuff is here: &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7389&quot; title=&quot;HBASE-7365 Snapshot clone/restore followup&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7389&quot;&gt;&lt;del&gt;HBASE-7389&lt;/del&gt;&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7365&quot; title=&quot;Safer table creation and deletion using .tmp dir&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7365&quot;&gt;&lt;del&gt;HBASE-7365&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13539620" author="jmhsieh" created="Wed, 26 Dec 2012 18:01:14 +0000"  >&lt;p&gt;Thanks for the links.  &lt;/p&gt;

&lt;p&gt;Shouldn&apos;t we throw an exception of some sort if we fail after the max number of tries?&lt;/p&gt;</comment>
                            <comment id="13539772" author="mbertozzi" created="Thu, 27 Dec 2012 00:26:05 +0000"  >&lt;p&gt;What about extracting the wait loop from enableTable() and use that also for the clone?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to enable table &quot;&lt;/span&gt; +
  Bytes.toString(tableName));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The enable table code, after N retries says: &quot;Unable to enable table&quot;... but this looks like the wrong message... we don&apos;t know if the enable is failed or is just slow...&lt;/p&gt;

&lt;p&gt;change the message in &quot;table not yet enabled&quot;, change the exception type in RetriesExhaustedException()?&lt;/p&gt;</comment>
                            <comment id="13540695" author="jmhsieh" created="Sat, 29 Dec 2012 00:56:14 +0000"  >&lt;p&gt;I like it.&lt;/p&gt;

&lt;p&gt;Looking at v1, yeah I agree with the message in the exception being inaccurate.  Maybe something closer to what is in the comment to make it more accurate?&lt;/p&gt;

&lt;p&gt;Nit: missing &quot;for&quot;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  /**
+   * Wait the table to be enabled.
+   
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13540926" author="hadoopqa" created="Sat, 29 Dec 2012 15:43:26 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12562676/HBASE-7352-v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12562676/HBASE-7352-v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3757//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3757//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13540939" author="yuzhihong@gmail.com" created="Sat, 29 Dec 2012 17:19:53 +0000"  >&lt;p&gt;Another nit:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * If the table exceeded the retry period, an exception is thrown.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;table&apos; is not an action. You can say &apos;enabling table exceeds&apos;&lt;/p&gt;

&lt;p&gt;Looks like you should rebase your patch.&lt;/p&gt;</comment>
                            <comment id="13540949" author="jmhsieh" created="Sat, 29 Dec 2012 18:02:17 +0000"  >&lt;p&gt;I&apos;ve made ted&apos;s suggested fix.  v3 is what I will commit if after tests run.&lt;/p&gt;</comment>
                            <comment id="13540953" author="hadoopqa" created="Sat, 29 Dec 2012 18:23:33 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12562683/hbase-7352.v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12562683/hbase-7352.v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3759//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3759//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13540972" author="jmhsieh" created="Sat, 29 Dec 2012 19:05:29 +0000"  >&lt;p&gt;passed with failures on known flakys.  Thanks matteo and ted. Committing to online and offline snapshots branches.&lt;/p&gt;</comment>
                            <comment id="13774972" author="stack" created="Mon, 23 Sep 2013 18:30:28 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12562351" name="HBASE-7352-v0.patch" size="772" author="mbertozzi" created="Tue, 25 Dec 2012 15:06:51 +0000"/>
                            <attachment id="12562425" name="HBASE-7352-v1.patch" size="1860" author="mbertozzi" created="Thu, 27 Dec 2012 00:26:05 +0000"/>
                            <attachment id="12562676" name="HBASE-7352-v2.patch" size="2181" author="mbertozzi" created="Sat, 29 Dec 2012 15:41:24 +0000"/>
                            <attachment id="12562683" name="hbase-7352.v3.patch" size="2189" author="jmhsieh" created="Sat, 29 Dec 2012 18:02:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>4.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 14 Dec 2012 00:58:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>297596</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i14rm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>235939</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>