<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:58:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2029/HBASE-2029.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2029] Reduce shell exception dump on console</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2029</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;As discussed on IRC and seen over and over, the shell is too verbose when it prints Java related exceptions. The huge stack trace on the console is often causing more harm then actually helping.&lt;/p&gt;


&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;...
[11:31pm] larsgeorge:
the only concern is to keep it in sync with new changes and also reduce its stacktrace
[11:31pm] larsgeorge:
that can be quite nasty
[11:31pm] _dodger_:
I&apos;ve seen a prime example of that on the mailing list today
[11:32pm] larsgeorge:
yeah, those do repeat themselves
[11:32pm] larsgeorge:
also that DEBUG is on by default
[11:33pm] larsgeorge:
mind you, that is a good idea for the daemons
[11:33pm] larsgeorge:
but prolly not the shell
[11:33pm] jdcryans:
I was thinking
[11:33pm] larsgeorge:
maybe we can set ERROR logging level just for the shell when it is started?
[11:34pm] jdcryans:
we should stop printing the stack trace for NSRE
[11:34pm] larsgeorge:
there are a few others of that sort
[11:34pm] larsgeorge:
be it ZK reconnects etc.
[11:35pm] jdcryans:
yeah there&apos;s a lot of hbase-generated zk-related noise
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12442400">HBASE-2029</key>
            <summary>Reduce shell exception dump on console</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="larsgeorge">Lars George</reporter>
                        <labels>
                    </labels>
                <created>Thu, 3 Dec 2009 22:41:15 +0000</created>
                <updated>Fri, 12 Oct 2012 06:14:18 +0000</updated>
                            <resolved>Mon, 7 Dec 2009 21:01:03 +0000</resolved>
                                    <version>0.20.2</version>
                                    <fixVersion>0.20.3</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                    <component>scripts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12785635" author="jdcryans" created="Thu, 3 Dec 2009 23:34:48 +0000"  >&lt;p&gt;I will try something.&lt;/p&gt;</comment>
                            <comment id="12785651" author="jdcryans" created="Thu, 3 Dec 2009 23:52:39 +0000"  >&lt;p&gt;First cut.&lt;/p&gt;</comment>
                            <comment id="12785658" author="stack" created="Fri, 4 Dec 2009 00:06:23 +0000"  >&lt;p&gt;Close hbase-1612.  It dupes this.  Patch looks good.  There is also an irb env variable related to size of stack shown.  I was going to look into this for jirb. &lt;/p&gt;</comment>
                            <comment id="12785673" author="jdcryans" created="Fri, 4 Dec 2009 00:32:41 +0000"  >&lt;p&gt;I think it&apos;s something like&lt;/p&gt;

&lt;p&gt;irb --back-trace-limit 100&lt;/p&gt;

&lt;p&gt;But I&apos;m not sure how to set it in our shell.&lt;/p&gt;</comment>
                            <comment id="12785794" author="stack" created="Fri, 4 Dec 2009 07:08:26 +0000"  >&lt;p&gt;According to &lt;a href=&quot;http://ruby-doc.org/docs/ProgrammingRuby/html/irb.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://ruby-doc.org/docs/ProgrammingRuby/html/irb.html&lt;/a&gt;, should be able to do something like this in our subclass of Irb:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Index: bin/hirb.rb
===================================================================
--- bin/hirb.rb (revision 887084)
+++ bin/hirb.rb (working copy)
@@ -478,6 +478,7 @@
     IRB.setup(ap_path)
     @CONF[:IRB_NAME] = &apos;hbase&apos;
     @CONF[:AP_NAME] = &apos;hbase&apos;
+    @CONF[:BACK_TRACE_LIMIT] = 1
     
     &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; @CONF[:SCRIPT]
       hirb = HIRB.&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt;(nil, @CONF[:SCRIPT])
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I&apos;ll play w/ it and get back to you.&lt;/p&gt;</comment>
                            <comment id="12785862" author="larsgeorge" created="Fri, 4 Dec 2009 10:47:51 +0000"  >&lt;p&gt;Looks like that is it, haven&apos;t tried it but I grep&apos;ed the JRuby sources and that config option has been used quite a few times. So we now have to see if it has the desired effect. &lt;/p&gt;</comment>
                            <comment id="12785865" author="larsgeorge" created="Fri, 4 Dec 2009 10:53:17 +0000"  >&lt;p&gt;OK, tried it and I suggest we use&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@CONF[:BACK_TRACE_LIMIT] = 0
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Reason is that 1 gives&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hbase(main):001:0&amp;gt; scan &apos;e&apos;
NativeException: org.apache.hadoop.hbase.TableNotFoundException: e
        from org/apache/hadoop/hbase/client/HConnectionManager.java:650:in `locateRegionInMeta&apos;
... 166 levels...
        from (hbase):2hbase(main):002:0&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Using 0 gives&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;hbase(main):001:0&amp;gt; scan &apos;e&apos;
NativeException: org.apache.hadoop.hbase.TableNotFoundException: e

hbase(main):002:0&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;+1 for the latter.&lt;/p&gt;</comment>
                            <comment id="12785869" author="larsgeorge" created="Fri, 4 Dec 2009 11:02:17 +0000"  >&lt;p&gt;I also suggest we change the logging levels for ZK to ERROR and do the same for HBase. The reason is that having DEBUG now on for 0.20.2 and onwards which is good for the daemons doing it in the shell can easily deter users from the various details printed out. &lt;/p&gt;

&lt;p&gt;I have changed added this to hirb.rb&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
# Hack to turn down zk logging so it don&apos;t spew over the shell
# log4j.logger.org.apache.zookeeper=INFO
logger = org.apache.log4j.Logger.getLogger(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.zookeeper&quot;&lt;/span&gt;)
logger.setLevel(org.apache.log4j.Level::ERROR);

# Hack to turn down HBase logging so it don&apos;t spew over the shell
logger = org.apache.log4j.Logger.getLogger(&lt;span class=&quot;code-quote&quot;&gt;&quot;org.apache.hadoop.hbase&quot;&lt;/span&gt;)
logger.setLevel(org.apache.log4j.Level::ERROR);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That now yields no spurious warnings etc. &lt;/p&gt;

&lt;p&gt;What I could think of though is having a debug option at shell start up to set HBase debug level for the developers and advanced user. Saves from editing the hirb.rb - but which is still not the worst for an advanced user. Not sure if we could have something like this&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
$ hbase shell -debug
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Should be easy I would think to detect the flag and hand it into the org.jruy.Main call (or simply pass it on as is and let the hirb.rb handle it.&lt;/p&gt;

&lt;p&gt;Just suggesting. &lt;/p&gt;</comment>
                            <comment id="12785884" author="larsgeorge" created="Fri, 4 Dec 2009 11:26:55 +0000"  >&lt;p&gt;Add -d and --debug support. Help:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;LarsMacBookPro:hbase-trunk-ro larsgeorge$ bin/hbase shell -h
HBase Shell command-line options:
 format        Formatter for outputting results: console | html. Default: console
 format-width  Width of table outputs. Default: 110 characters.
 -d | --debug  Set DEBUG log levels.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Without DEBUG switch, nice and clean:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;LarsMacBookPro:hbase-trunk-ro larsgeorge$ bin/hbase shell   
HBase Shell; enter &apos;help&amp;lt;RETURN&amp;gt;&apos; for list of supported commands.
Version: 0.21.0-dev, r886052, Thu Dec  3 17:05:20 CET 2009
hbase(main):001:0&amp;gt; scan &apos;e&apos;
NativeException: org.apache.hadoop.hbase.TableNotFoundException: e

hbase(main):002:0&amp;gt; exit
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And with DEBUG switch, verbose as requested:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;LarsMacBookPro:hbase-trunk-ro larsgeorge$ bin/hbase shell -d
Setting DEBUG log level...
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:zookeeper.version=3.2.1-808558, built on 08/27/2009 18:48 GMT
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:host.name=192.168.2.107
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:java.version=1.6.0_15
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:java.vendor=Apple Inc.
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:java.home=/System/Library/Frameworks/JavaVM.framework/Versions/1.6.0/Home
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:java.class.path=/Development/eclipse/workspace/hbase-trunk-ro/bin/../conf:/System/Library/Frameworks/JavaVM.framework/Versions/1.6/Home//lib/tools.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../build/classes:/Development/eclipse/workspace/hbase-trunk-ro/bin/../build/test:/Development/eclipse/workspace/hbase-trunk-ro/bin/../build:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/avro-1.2.0.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/commons-cli-2.0-SNAPSHOT.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/commons-el-from-jetty-5.1.4.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/commons-httpclient-3.0.1.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/commons-logging-1.0.4.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/commons-logging-api-1.0.4.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/commons-math-1.1.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/hadoop-core-0.21.0-SNAPSHOT-r832250.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/hadoop-core-test-0.21.0-SNAPSHOT-r832250.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/hadoop-hdfs-0.21.0-dev-r836012.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/hadoop-hdfs-test-0.21.0-dev-r836012.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/hadoop-mapred-0.21.0-dev-r833993.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/hadoop-mapred-test-0.21.0-dev-r833993.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/jasper-compiler-5.5.12.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/jasper-runtime-5.5.12.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/jetty-6.1.14.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/jetty-util-6.1.14.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/jruby-complete-1.3.1.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/json.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/junit-4.7.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/libthrift-r771587.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/log4j-1.2.15.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/lucene-core-2.2.0.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/servlet-api-2.5-6.1.14.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/zookeeper-3.2.1.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/jsp-2.1/jsp-2.1.jar:/Development/eclipse/workspace/hbase-trunk-ro/bin/../lib/jsp-2.1/jsp-api-2.1.jar
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:java.library.path=.:/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:java.io.tmpdir=/var/folders/Ok/Ok45YK4DF8S5jZMXZptEek+++TI/-Tmp-/
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:java.compiler=&amp;lt;NA&amp;gt;
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:os.name=Mac OS X
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:os.arch=x86_64
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:os.version=10.6.2
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:user.name=larsgeorge
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:user.home=/Users/larsgeorge
09/12/04 12:20:36 INFO zookeeper.ZooKeeper: Client environment:user.dir=/Development/eclipse/workspace/hbase-trunk-ro
HBase Shell; enter &apos;help&amp;lt;RETURN&amp;gt;&apos; for list of supported commands.
Version: 0.21.0-dev, r886052, Thu Dec  3 17:05:20 CET 2009
hbase(main):001:0&amp;gt; scan &apos;e&apos;
09/12/04 12:20:40 INFO zookeeper.ZooKeeper: Initiating client connection, connectString=localhost:2181 sessionTimeout=60000 watcher=org.apache.hadoop.hbase.client.HConnectionManager$ClientZKWatcher@58f41393
09/12/04 12:20:40 INFO zookeeper.ClientCnxn: zookeeper.disableAutoWatchReset is false
09/12/04 12:20:40 INFO zookeeper.ClientCnxn: Attempting connection to server localhost/0:0:0:0:0:0:0:1:2181
09/12/04 12:20:40 INFO zookeeper.ClientCnxn: Priming connection to java.nio.channels.SocketChannel[connected local=/0:0:0:0:0:0:0:1%0:57219 remote=localhost/0:0:0:0:0:0:0:1:2181]
09/12/04 12:20:40 INFO zookeeper.ClientCnxn: Server connection successful
09/12/04 12:20:40 DEBUG client.HConnectionManager$ClientZKWatcher: Got ZooKeeper event, state: SyncConnected, type: None, path: null
09/12/04 12:20:40 DEBUG zookeeper.ClientCnxn: Reading reply sessionid:0x125554a4a9f000c, packet:: clientPath:null serverPath:null finished:false header:: -8,101  replyHeader:: -8,229,0  request:: 0,v{},v{},v{}  response:: null
09/12/04 12:20:40 DEBUG zookeeper.ClientCnxn: Reading reply sessionid:0x125554a4a9f000c, packet:: clientPath:null serverPath:null finished:false header:: 1,4  replyHeader:: 1,229,0  request:: &apos;/hbase/root-region-server,F  response:: #3139322e3136382e322e3130373a3532303437,s{11,209,1259840355831,1259856415401,9,0,0,0,19,0,11} 
09/12/04 12:20:40 DEBUG zookeeper.ZooKeeperWrapper: Read ZNode /hbase/root-region-server got 192.168.2.107:52047
09/12/04 12:20:41 DEBUG client.HConnectionManager$TableServers: Found ROOT at 192.168.2.107:52047
09/12/04 12:20:41 DEBUG client.HConnectionManager$TableServers: Cached location address: 192.168.2.107:52047, regioninfo: REGION =&amp;gt; {NAME =&amp;gt; &apos;.META.,,1&apos;, STARTKEY =&amp;gt; &apos;&apos;, ENDKEY =&amp;gt; &apos;&apos;, ENCODED =&amp;gt; 1028785192, TABLE =&amp;gt; {{NAME =&amp;gt; &apos;.META.&apos;, IS_META =&amp;gt; &apos;true&apos;, FAMILIES =&amp;gt; [{NAME =&amp;gt; &apos;historian&apos;, VERSIONS =&amp;gt; &apos;2147483647&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, TTL =&amp;gt; &apos;604800&apos;, BLOCKSIZE =&amp;gt; &apos;8192&apos;, IN_MEMORY =&amp;gt; &apos;false&apos;, BLOCKCACHE =&amp;gt; &apos;false&apos;}, {NAME =&amp;gt; &apos;info&apos;, VERSIONS =&amp;gt; &apos;10&apos;, COMPRESSION =&amp;gt; &apos;NONE&apos;, TTL =&amp;gt; &apos;2147483647&apos;, BLOCKSIZE =&amp;gt; &apos;8192&apos;, IN_MEMORY =&amp;gt; &apos;false&apos;, BLOCKCACHE =&amp;gt; &apos;false&apos;}]}}
NativeException: org.apache.hadoop.hbase.TableNotFoundException: e

hbase(main):002:0&amp;gt; exit
09/12/04 12:20:48 INFO zookeeper.ZooKeeper: Closing session: 0x125554a4a9f000c
09/12/04 12:20:48 INFO zookeeper.ClientCnxn: Closing ClientCnxn for session: 0x125554a4a9f000c
09/12/04 12:20:48 INFO zookeeper.ClientCnxn: Exception while closing send thread for session 0x125554a4a9f000c : Read error rc = -1 java.nio.DirectByteBuffer[pos=0 lim=4 cap=4]
09/12/04 12:20:48 WARN zookeeper.ClientCnxn: Ignoring exception during shutdown input
java.net.SocketException: Socket is not connected
        at sun.nio.ch.SocketChannelImpl.shutdown(Native Method)
        at sun.nio.ch.SocketChannelImpl.shutdownInput(SocketChannelImpl.java:640)
        at sun.nio.ch.SocketAdaptor.shutdownInput(SocketAdaptor.java:360)
        at org.apache.zookeeper.ClientCnxn$SendThread.cleanup(ClientCnxn.java:999)
        at org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:984)
09/12/04 12:20:48 INFO zookeeper.ClientCnxn: Disconnecting ClientCnxn for session: 0x125554a4a9f000c
09/12/04 12:20:48 INFO zookeeper.ZooKeeper: Session: 0x125554a4a9f000c closed
09/12/04 12:20:48 INFO zookeeper.ClientCnxn: EventThread shut down
09/12/04 12:20:48 DEBUG zookeeper.ZooKeeperWrapper: Closed connection with ZooKeeper
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;One last thing I could think of is to set the @CONF&lt;span class=&quot;error&quot;&gt;&amp;#91;:BACK_TRACE_LIMIT&amp;#93;&lt;/span&gt; = 0 according to that switch as well. So that with DEBUG enabled it also logs the full details from the ruby scripts.&lt;/p&gt;</comment>
                            <comment id="12785890" author="larsgeorge" created="Fri, 4 Dec 2009 11:45:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2029&quot; title=&quot;Reduce shell exception dump on console&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2029&quot;&gt;&lt;del&gt;HBASE-2029&lt;/del&gt;&lt;/a&gt;-hirb-v2.patch adds the discussed back trace limit configuration. If DEBUG is off the back trace is set to 0 as discussed above and if DEBUG is on it does the default (which it seems is set to 16, which should suffice but could easily changed to print all).&lt;/p&gt;</comment>
                            <comment id="12786119" author="stack" created="Fri, 4 Dec 2009 20:01:05 +0000"  >&lt;p&gt;I like the -d addtion.&lt;/p&gt;

&lt;p&gt;I tried the patch.  It makes big difference.&lt;/p&gt;

&lt;p&gt;When no cluster running instead of spewing zk stuff, it just does nothing printing out a master not running on end.&lt;/p&gt;

&lt;p&gt;Good (could be better) but way better than what was there before.&lt;/p&gt;

&lt;p&gt;When I do a create table for an already created table, it does:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):001:0&amp;gt; create &apos;y&apos;, &apos;y&apos;
0 row(s) in 6.2210 seconds
hbase(main):002:0&amp;gt; create &apos;y&apos;, &apos;y&apos;
NativeException: org.apache.hadoop.hbase.TableExistsException: org.apache.hadoop.hbase.TableExistsException: y
        at org.apache.hadoop.hbase.master.HMaster.createTable(HMaster.java:790)
        at org.apache.hadoop.hbase.master.HMaster.createTable(HMaster.java:755)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:648)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:915)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which is better than the big page of exceptions before.&lt;/p&gt;

&lt;p&gt;Enabling non-existent table does this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):007:0&amp;gt; enable &apos;xyz&apos;
NativeException: org.apache.hadoop.hbase.TableNotFoundException: org.apache.hadoop.hbase.TableNotFoundException: xyz
        at org.apache.hadoop.hbase.master.TableOperation$ProcessTableOperation.call(TableOperation.java:144)
        at org.apache.hadoop.hbase.master.TableOperation$ProcessTableOperation.call(TableOperation.java:73)
        at org.apache.hadoop.hbase.master.RetryableMetaOperation.doWithRetries(RetryableMetaOperation.java:67)
        at org.apache.hadoop.hbase.master.TableOperation.process(TableOperation.java:157)
        at org.apache.hadoop.hbase.master.HMaster.enableTable(HMaster.java:827)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:648)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:915)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With -d, its really profuse logging but its good in that its more than just DEBUG from before printing out environment.&lt;/p&gt;

&lt;p&gt;Will commit in a little while unless objection.&lt;/p&gt;

</comment>
                            <comment id="12786128" author="jdcryans" created="Fri, 4 Dec 2009 20:11:07 +0000"  >&lt;p&gt;Did you try both patches at the same time? (mine and Lars&apos;)&lt;/p&gt;</comment>
                            <comment id="12786147" author="larsgeorge" created="Fri, 4 Dec 2009 20:41:42 +0000"  >&lt;p&gt;Weird, without the -d option you get back trace? See my example with the non-existent table, same NativeException stanza but I only get a single line as expected. Hmmm.&lt;/p&gt;</comment>
                            <comment id="12786267" author="stack" created="Sat, 5 Dec 2009 00:34:28 +0000"  >&lt;p&gt;I have both patches in place.&lt;/p&gt;

&lt;p&gt;If i try to scan a non-existent table I get:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;

hbase(main):009:0&amp;gt; scan &apos;xyz&apos;
NativeException: org.apache.hadoop.hbase.TableNotFoundException: xyz

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;.. which is same as you Lars.&lt;/p&gt;

&lt;p&gt;What happens if you try to enable a non-existent table?  Do you see same ten lines of stack trace (10 lines is fine IMO... but will wait till get OK from you Lars before applying).&lt;/p&gt;
</comment>
                            <comment id="12786379" author="larsgeorge" created="Sat, 5 Dec 2009 12:21:16 +0000"  >&lt;p&gt;Yeah, I get those extra lines on creating an existing table too. Odd that they respond differently. Let me check into once more.&lt;/p&gt;</comment>
                            <comment id="12786444" author="larsgeorge" created="Sat, 5 Dec 2009 16:53:58 +0000"  >&lt;p&gt;Oh sweet, while looking into this issue I found that a &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    @CONF[:SAVE_HISTORY] = 10
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;enables command history saving. We should definitely add that!&lt;/p&gt;</comment>
                            <comment id="12786445" author="larsgeorge" created="Sat, 5 Dec 2009 17:07:27 +0000"  >&lt;p&gt;Apart from that I found the reason for the different output. The TableExistsException wraps a RemoteException. This is done so:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; IOException decodeRemoteException(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; RemoteException re)
  &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    IOException i = re;
...
      &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;[] arguments = { re.getMessage() };
      Throwable t = (Throwable) ctor.newInstance(arguments);
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The issue here is that re.getMessage() for a remote message is the stack trace! So in the case of my &quot;scan &apos;e&apos;&quot; test the exception message is &quot;e&quot; as in the table that does not exists. But for the &quot;create &apos;y&apos;, &apos;y&apos;&quot; it fails on the master and that is wrapped into a local exception and then the message is &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
y
        at org.apache.hadoop.hbase.master.HMaster.createTable(HMaster.java:793)
        at org.apache.hadoop.hbase.master.HMaster.createTable(HMaster.java:758)
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:39)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:648)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:915) 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So we can either live with this or change how the RemoteException is decoded. &lt;/p&gt;</comment>
                            <comment id="12786450" author="stack" created="Sat, 5 Dec 2009 17:19:57 +0000"  >&lt;p&gt;Making a stacktrace into an exception message is broken.  Change how RemoteException is done I&apos;d say.  Should be putting the exception that provoked the problem into initCause: &lt;a href=&quot;http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Throwable.html#initCause%28java.lang.Throwable%29&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://java.sun.com/j2se/1.4.2/docs/api/java/lang/Throwable.html#initCause%28java.lang.Throwable%29&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12786484" author="stack" created="Sat, 5 Dec 2009 20:28:57 +0000"  >&lt;p&gt;I took a look.  Issue is in the rpc client:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isError = in.readBoolean();     &lt;span class=&quot;code-comment&quot;&gt;// read &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; error
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isError) {
          call.setException(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; RemoteException( WritableUtils.readString(in),
              WritableUtils.readString(in)));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The second argument is the &apos;message&apos;.&lt;/p&gt;

&lt;p&gt;Here is server-side:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
          &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
            value = call(call.param, call.timestamp);             &lt;span class=&quot;code-comment&quot;&gt;// make the call
&lt;/span&gt;          } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Throwable e) {
            LOG.info(getName()+&lt;span class=&quot;code-quote&quot;&gt;&quot;, call &quot;&lt;/span&gt;+call+&lt;span class=&quot;code-quote&quot;&gt;&quot;: error: &quot;&lt;/span&gt; + e, e);
            errorClass = e.getClass().getName();
            error = StringUtils.stringifyException(e);
          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So, changing above so we passed exception class name then message and then cause would change the ipc.  Since we&apos;d like to get this fix back into 0.20, I&apos;d say lets apply what you fellas have done up to now &amp;#8211; its way better than what was there &amp;#8211; and then open new issue to make passing of exceptions cleaner.&lt;/p&gt;

&lt;p&gt;On command history, yeah... you can just add config to your .irbrc &amp;#8211; IIRC &amp;#8211; to enable history.  Should we turn it on as default?  How we tell the case where user doesn&apos;t want it?  Or case where they want more history than ten commands; i.e. we don&apos;t want case where they have made a setting in their irbrc but can&apos;t figure why it ain&apos;t working.  Maybe can do a if not defined, set it to history of 100 commands?&lt;/p&gt;</comment>
                            <comment id="12786485" author="larsgeorge" created="Sat, 5 Dec 2009 20:34:46 +0000"  >&lt;p&gt;I made the change that avoids sending the stacktrace over the wire as part of the message. Please verify in the new patch that this is indeed OK to do.&lt;/p&gt;

&lt;p&gt;Here is how it looks like:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
hbase(main):002:0&amp;gt; scan &apos;e&apos;
NativeException: org.apache.hadoop.hbase.TableNotFoundException: e

hbase(main):003:0&amp;gt; create &apos;y&apos;, &apos;y&apos;
NativeException: org.apache.hadoop.hbase.TableExistsException: y

hbase(main):004:0&amp;gt; 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12786488" author="larsgeorge" created="Sat, 5 Dec 2009 20:39:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2029&quot; title=&quot;Reduce shell exception dump on console&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2029&quot;&gt;&lt;del&gt;HBASE-2029&lt;/del&gt;&lt;/a&gt;-hirb-v3.patch adds the change to HBaseServer.java to avoid sending the stack trace as part of the message and also adds history saving for the last 50 commands. Otherwise it has the same content as the v2 patch.&lt;/p&gt;</comment>
                            <comment id="12786491" author="larsgeorge" created="Sat, 5 Dec 2009 20:45:58 +0000"  >&lt;p&gt;Oh sorry Michael, did not see your updates until after I upped the patch. I agree that adding it to the .irbrc is good enough to enable it, could be documented somewhere &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; I will remove it and up another path. What do you think of the small HBaseServer change I did? Does not break the IPC but the question is if anyone relied on the stack trace being in the message? I doubt it though.&lt;/p&gt;</comment>
                            <comment id="12786492" author="larsgeorge" created="Sat, 5 Dec 2009 20:47:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2029&quot; title=&quot;Reduce shell exception dump on console&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2029&quot;&gt;&lt;del&gt;HBASE-2029&lt;/del&gt;&lt;/a&gt;-hirb-v4.patch same as before but without the saving of commands option.&lt;/p&gt;</comment>
                            <comment id="12786511" author="stack" created="Sat, 5 Dec 2009 21:36:19 +0000"  >&lt;p&gt;On doc&apos;ing shell stuff, I did it a while ago: &lt;a href=&quot;http://wiki.apache.org/hadoop/Hbase/Shell&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/hadoop/Hbase/Shell&lt;/a&gt; (See Useful tricks on the end).  No one reads doc though so need to get it in closer to the shell help some how.   Perhaps when we refactor help so its help by command instead of a single-page dump.   On removing the stack-trace, I&apos;d say leave it.  All kinds of exception cross the ipc bridge.  For most cases, it&apos;ll be fine if no stack trace just the raw message but for the odd one that is just an IOE with a cryptic message, context would be important. Yours and J-D&apos;s improvements have brought us a long way already.  Its good enough I&apos;d say to commit leaving the patch in?  Do you have to make v5 or can I commit v2 and j-d&apos;s change?&lt;/p&gt;</comment>
                            <comment id="12786603" author="larsgeorge" created="Sun, 6 Dec 2009 11:34:27 +0000"  >&lt;p&gt;Ah see, I did not see that page either. Wiki is often too chaotic and unstructured. Hmm. &lt;/p&gt;

&lt;p&gt;Yes, use my v2 patch and JD&apos;s initial patch. Thanks!&lt;/p&gt;</comment>
                            <comment id="12786604" author="larsgeorge" created="Sun, 6 Dec 2009 11:39:09 +0000"  >&lt;p&gt;One final note, the error handling should have its own JIRA so that it is addressed one day?&lt;/p&gt;

&lt;p&gt;Oh, and that wiki page for the shell is slightly formatted wrong by the looks, it changes to cursive/italics and stays until the end. And the .irbrc sample output has no line breaks and makes it difficult to read it.&lt;/p&gt;</comment>
                            <comment id="12787106" author="stack" created="Mon, 7 Dec 2009 21:01:03 +0000"  >&lt;p&gt;Applied branch and trunk.  Thanks for patch J-D and Lars.&lt;/p&gt;</comment>
                            <comment id="12787108" author="stack" created="Mon, 7 Dec 2009 21:03:48 +0000"  >&lt;p&gt;I added hbase-2030 at Lars&apos;s suggestion to cover fixing rpc exception stack trace handling.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12426896" name="HBASE-2029-hirb-v2.patch" size="2750" author="larsgeorge" created="Fri, 4 Dec 2009 11:45:52 +0000"/>
                            <attachment id="12427064" name="HBASE-2029-hirb-v3.patch" size="3435" author="larsgeorge" created="Sat, 5 Dec 2009 20:39:25 +0000"/>
                            <attachment id="12427065" name="HBASE-2029-hirb-v4.patch" size="3404" author="larsgeorge" created="Sat, 5 Dec 2009 20:47:52 +0000"/>
                            <attachment id="12426895" name="HBASE-2029-hirb.patch" size="2700" author="larsgeorge" created="Fri, 4 Dec 2009 11:26:55 +0000"/>
                            <attachment id="12426848" name="HBASE-2029.patch" size="1667" author="jdcryans" created="Thu, 3 Dec 2009 23:52:39 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 3 Dec 2009 23:34:48 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32375</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 2 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08t1j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49305</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Added a -d and --debug to shell options</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>