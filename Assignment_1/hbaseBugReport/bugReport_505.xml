<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:44:53 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-505/HBASE-505.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-505] Region assignments should never time out so long as the region server reports that it is processing the open request</title>
                <link>https://issues.apache.org/jira/browse/HBASE-505</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently, when the master assigns a region to a region server, it extends the reassignment timeout when the region server reports that it is processing the open. This only happens once, and so if the region takes a long time to come on line due to a large set of transactions in the redo log or because the initial compaction takes a long time, the master will assign the region to another server when the reassignment timeout occurs.&lt;/p&gt;

&lt;p&gt;Assigning a region to multiple region servers can easily corrupt the region. For example:&lt;/p&gt;

&lt;p&gt;region server 1 is processing the redo log creating a new mapfile. It takes more than one interval to do so so the master assigns the region to region server 2. region server 2 starts processing the redo log creating essentially the same mapFile as region server 1, but with a different name. &lt;/p&gt;

&lt;p&gt;region server 2 can fail to open the region if region server 1 deletes the old log file or if it tries to open the new mapFile that region server 1 is creating.&lt;/p&gt;

&lt;p&gt;region server 1 can fail to open the region if it tries to open the mapFile that region server 2 is creating.&lt;/p&gt;

&lt;p&gt;Often region server 1 eventually succeeds and reports to the master that it has finished opening the region, but the master tells it to close that region because it has assigned it to another server. Region server 2 often fails to open the region, because the old log file has been deleted, or it fails to process the new map file created by region server 1.&lt;/p&gt;

&lt;p&gt;Proposed solution:&lt;/p&gt;

&lt;p&gt;During the open process the region server should send a MSG_PROCESS_OPEN with each heartbeat until the region is opened (when it sends MSG_REGION_OPEN). The master will extend the reassignment timeout with each MSG_PROCESS_OPEN it receives and will not assign the region to another server so long as it continues to receive heart beat messages from the region server processing the open.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12390793">HBASE-505</key>
            <summary>Region assignments should never time out so long as the region server reports that it is processing the open request</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="jimk">Jim Kellerman</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Mar 2008 21:52:58 +0000</created>
                <updated>Sat, 12 Apr 2008 16:12:05 +0000</updated>
                            <resolved>Tue, 1 Apr 2008 00:07:32 +0000</resolved>
                                    <version>0.1.0</version>
                    <version>0.2.0</version>
                                    <fixVersion>0.1.1</fixVersion>
                    <fixVersion>0.2.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12577624" author="stack" created="Tue, 11 Mar 2008 22:03:22 +0000"  >&lt;p&gt;Sounds fine as long as the regionserver doesn&apos;t just robotically send MSG_PROCESS_OPEN while a region is being opened.  If regionserver gets stuck replaying edits or is hung as we&apos;ve been seeing from time to time, etc., it shouldn&apos;t send MSG_PROCESS_OPEN&lt;/p&gt;</comment>
                            <comment id="12577625" author="bryanduxbury" created="Tue, 11 Mar 2008 22:07:04 +0000"  >&lt;p&gt;+1 to Stack&apos;s comment. Perhaps if it&apos;s making progress in opening the region, it can increment some progress counter that keeps the region server sure the open is still going on and not just screwed up.&lt;/p&gt;</comment>
                            <comment id="12577627" author="jimk" created="Tue, 11 Mar 2008 22:14:23 +0000"  >&lt;p&gt;Not a blocker.&lt;/p&gt;</comment>
                            <comment id="12582454" author="stack" created="Wed, 26 Mar 2008 22:29:11 +0000"  >&lt;p&gt;Just came across an instance of this.  Here is where we are doing the open:&lt;/p&gt;

&lt;p&gt;2008-03-25 19:16:43,720 INFO org.apache.hadoop.hbase.HRegionServer: MSG_REGION_OPEN : enwiki_080103,iLStZ0yTnfVUziYcNVVxWV==,1205393076482&lt;/p&gt;

&lt;p&gt;Here is where we failed the open because region was allocated elsewhere even though this is the server that replayed the edits:&lt;/p&gt;

&lt;p&gt;2008-03-25 19:19:56,472 ERROR org.apache.hadoop.hbase.HRegionServer: error opening region enwiki_080103,iLStZ0yTnfVUziYcNVVxWV==,1205393076482&lt;/p&gt;

&lt;p&gt;It took 3 minutes to replay 60k edits.&lt;/p&gt;

&lt;p&gt;RegionServer should send a ping back to the master every 10K edits applied.&lt;/p&gt;</comment>
                            <comment id="12582455" author="stack" created="Wed, 26 Mar 2008 22:29:52 +0000"  >&lt;p&gt;Marking this a blocker for 0.2.&lt;/p&gt;</comment>
                            <comment id="12582457" author="stack" created="Wed, 26 Mar 2008 22:31:28 +0000"  >&lt;p&gt;Maybe do this for 0.1.1 too.  Its bad when it happens.&lt;/p&gt;</comment>
                            <comment id="12582775" author="stack" created="Thu, 27 Mar 2008 20:24:16 +0000"  >&lt;p&gt;Here&apos;s a first cut.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-505&quot; title=&quot;Region assignments should never time out so long as the region server reports that it is processing the open request&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-505&quot;&gt;&lt;del&gt;HBASE-505&lt;/del&gt;&lt;/a&gt; Region assignments should never time out so long as the region&lt;br/&gt;
server reports that it is processing the open request&lt;/p&gt;

&lt;p&gt;Have the HRegionServer pass down a Progressable implementation down into&lt;br/&gt;
Region and then down int Store where edits are replayed.  Call progress&lt;br/&gt;
after every couple of thousand edits.&lt;/p&gt;

&lt;p&gt;M  src/java/org/apache/hadoop/hbase/HStore.java&lt;br/&gt;
    Take a Progessable in the constructor.  Call it when applying&lt;br/&gt;
    edits.&lt;br/&gt;
M  src/java/org/apache/hadoop/hbase/HMaster.java&lt;br/&gt;
    Update commment around MSG_REPORT_PROCESS_OPEN so its expected&lt;br/&gt;
    that we can get more than one of these messages during a region&lt;br/&gt;
    open.&lt;br/&gt;
M  src/java/org/apache/hadoop/hbase/HRegion.java&lt;br/&gt;
    New constructor that takes a Progressable.  Pass it to Stores on&lt;br/&gt;
    construction.&lt;br/&gt;
M  src/java/org/apache/hadoop/hbase/HRegionServer.java&lt;br/&gt;
    On open of a region, pass in a Progressable that adds a&lt;br/&gt;
    MSG_REPORT_PROCESS_OPEN every time its called.&lt;/p&gt;</comment>
                            <comment id="12582776" author="stack" created="Thu, 27 Mar 2008 20:24:51 +0000"  >&lt;p&gt;Making a blocker against 0.1.1.&lt;/p&gt;</comment>
                            <comment id="12583502" author="jimk" created="Sun, 30 Mar 2008 23:07:45 +0000"  >&lt;p&gt;Patch available for 0.1.1&lt;/p&gt;</comment>
                            <comment id="12583503" author="jimk" created="Sun, 30 Mar 2008 23:15:23 +0000"  >&lt;p&gt;Reviewed patch +1. I especially like the idea of using a progressable to indicate that something is really happening.&lt;/p&gt;</comment>
                            <comment id="12583946" author="stack" created="Tue, 1 Apr 2008 00:07:32 +0000"  >&lt;p&gt;Applied to branch and TRUNK&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12378740" name="505.patch" size="8282" author="stack" created="Thu, 27 Mar 2008 20:24:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Mar 2008 22:03:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25236</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 38 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h7pj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98511</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>