<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:58:07 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8747/HBASE-8747.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8747] Log when blocked longer than expected on a lock/synchronized block</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8747</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Recently, on an internal support thread, the support folks asked that HBase surface when it is blocked up internally or an internal resource is highly contended.  I replied in essence that this would be &apos;too hard&apos;.  Our Todd instead suggested:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;...straw man proposal:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;swap out all our use of sychronized (...) for ReentrantLock (probably most of our locking is already based on j.u.c locks anyway for rwlock purposes)&lt;/li&gt;
	&lt;li&gt;build a wrapper around ReentrantLock that looks something like:&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;class AwesomeLock implements Lock {&lt;br/&gt;
  AwesomeLock(Lock realLock, int expectedAcquisitionTime, String metricName) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
    this.realLock = realLock;
  }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;  public void lock() {&lt;br/&gt;
    if (realLock.tryLock(expectedAcquisitionTime, MILLIS)) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: { return; }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;    Stopwatch sw = new Stopwatch();&lt;br/&gt;
    // collect realLock.getOwner()&lt;br/&gt;
    realLock.lock();&lt;br/&gt;
    long elapsed = sw.elapsed() + expectedAcquisitionTime;&lt;br/&gt;
    if (elapsed &amp;gt; expected * 2) &lt;/p&gt;
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: { LOG.warn(&amp;quot;Waited too long for lock which was held by owner &amp;quot; + owner); }&lt;/span&gt; &lt;/div&gt;
&lt;p&gt;    collect metrics about how long the lock took, the lock name etc&lt;br/&gt;
  }&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;Basically the idea is that any possible point of contention should emit log messages and metrics when contended.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Let me do the above over the next week or so.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12653044">HBASE-8747</key>
            <summary>Log when blocked longer than expected on a lock/synchronized block</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Sat, 15 Jun 2013 20:45:55 +0000</created>
                <updated>Mon, 17 Jun 2013 17:54:36 +0000</updated>
                                            <version>0.95.2</version>
                    <version>0.94.9</version>
                                                    <component>Usability</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13685765" author="apurtell" created="Mon, 17 Jun 2013 17:54:36 +0000"  >&lt;p&gt;This is great. I volunteer to port back into 0.94. Please let me know how/if I can help in addition.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 17 Jun 2013 17:54:36 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>333367</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 26 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1liav:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>333695</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>