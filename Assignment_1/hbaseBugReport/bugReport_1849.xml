<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:56:54 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1849/HBASE-1849.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1849] HTable doesn&apos;t work well at the core of a multi-threaded server; e.g. webserver</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1849</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;HTable must do the following:&lt;/p&gt;

&lt;p&gt;+ Sit in a shell or simple client &amp;#8211; e.g. Map or Reduce task &amp;#8211; and feed and read from HBase single-threadedly.  It does this job OK.&lt;br/&gt;
+ Sit at core of a multithreaded server (100s of threads) &amp;#8211; a webserver or thrift gateway &amp;#8211; and keep the throughput high. Its currently not good at this job.&lt;/p&gt;

&lt;p&gt;In the way of our achieving the second in the list above are the following:&lt;/p&gt;

&lt;p&gt;+ HTable must seekout and cache region locations.  It keeps cache down in HConnectionManager.  One is shared by all HTable instances if the HTable instance was made with same HBaseConfiguration instance.   Lookups of regions is inside a synchronize block; if the region wanted is in the cache, the lock is held a short time.   Otherwise, must wait till trip to server completed (may require retries).  Meantime all other work is blocked even if we&apos;re using HTablePool.&lt;br/&gt;
+ Regardless of the identity of the HBaseConfiguration, Hadoop RPC has ONE Connection open to a server at a time; request and response are multiplexed over this single connection.&lt;/p&gt;

&lt;p&gt;Broken stuff:&lt;/p&gt;

&lt;p&gt;+ Puts are synchronized to protect the write buffer so only one thread at a time appends but flushcommit is open for any thread to call it.  Once the write buffer is full, all Puts block until its freed again. This looks like hang if hundreds of threads and each write is to a random region in a big table and each write has to have its region looked-up (There may be some other brokenness in here because this bottleneck seems to last longer than it should even if hundreds of threads).&lt;/p&gt;

&lt;p&gt;Ideas:&lt;/p&gt;

&lt;p&gt;+ Query of the cache does not block all access to the cache.  We only block access if wanted region is being looked up so other reads and writes to regions we know the location of can go ahead.&lt;br/&gt;
+ nio&apos;d client and server&lt;/p&gt;</description>
                <environment></environment>
        <key id="12435909">HBASE-1849</key>
            <summary>HTable doesn&apos;t work well at the core of a multi-threaded server; e.g. webserver</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="4">Incomplete</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Thu, 17 Sep 2009 05:44:41 +0000</created>
                <updated>Sat, 19 Jul 2014 00:46:24 +0000</updated>
                            <resolved>Sat, 19 Jul 2014 00:46:24 +0000</resolved>
                                                                    <component>Performance</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="12756602" author="streamy" created="Thu, 17 Sep 2009 15:57:28 +0000"  >&lt;p&gt;Great issue, stack.&lt;/p&gt;

&lt;p&gt;Also, we need to consider how to best add additional threading to HTable.  Specifically, for MultiGet/Put/Delete, which Erik and I are working on right now over in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1845&quot; title=&quot;MultiGet, MultiDelete, and MultiPut - batched to the appropriate region servers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1845&quot;&gt;&lt;del&gt;HBASE-1845&lt;/del&gt;&lt;/a&gt;.  We are not at all taking advantage of running batch puts in parallel right now, and it&apos;s especially important for MultiGet which could drastically improve performance by distributing the calls in parallel.&lt;/p&gt;

&lt;p&gt;Additional discussion of the specifics should happen in the other issue, just wanted to link these up.&lt;/p&gt;</comment>
                            <comment id="12756778" author="stack" created="Thu, 17 Sep 2009 20:51:32 +0000"  >&lt;p&gt;See the thread dump in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1753&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-1753&lt;/a&gt; for example of how client can get hung up on synchronized batch put in particular.&lt;/p&gt;</comment>
                            <comment id="12898495" author="tsuna" created="Sat, 14 Aug 2010 01:11:40 +0000"  >&lt;p&gt;I&apos;ve been working on this for the past 2 weeks, although I&apos;m guessing that my solution won&apos;t be really satisfactory for this issue.  I wrote another HBase client from scratch, and it&apos;s been written from the ground up to work well in a multi-threaded environment.   I&apos;ll open-source it in a few days, stay tuned.&lt;/p&gt;</comment>
                            <comment id="12898496" author="ryanobjc" created="Sat, 14 Aug 2010 01:15:58 +0000"  >&lt;p&gt;some of the original complaints have been fixed.  HTablePool does some things.  The advice has generally been dont share HTable between threads.&lt;/p&gt;

&lt;p&gt;The granularity of the locks in HCM were improved and while not all better there are substantial improvements since this issue was filed.&lt;/p&gt;</comment>
                            <comment id="12898508" author="stack" created="Sat, 14 Aug 2010 03:24:07 +0000"  >&lt;p&gt;@Ben&#244;it: Bring it on!&lt;/p&gt;</comment>
                            <comment id="14067298" author="apurtell" created="Sat, 19 Jul 2014 00:46:24 +0000"  >&lt;p&gt;It&apos;s not perfect, but the client has come a long way. No action on this issue for a long time, resolving as Incomplete&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12435843">HBASE-1845</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12472787">HBASE-2939</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12455264">HBASE-2182</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 17 Sep 2009 15:57:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32291</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 21 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02fen:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12097</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>