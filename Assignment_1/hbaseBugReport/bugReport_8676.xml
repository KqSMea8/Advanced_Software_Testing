<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:57:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8676/HBASE-8676.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8676] hbase.hstore.compaction.max.size parameter has no effect in minor compaction</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8676</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In hbase-site.xml,I set(10G)&lt;br/&gt;
  &amp;lt;property&amp;gt;&lt;br/&gt;
    &amp;lt;name&amp;gt;hbase.hstore.compaction.max.size&amp;lt;/name&amp;gt;&lt;br/&gt;
    &amp;lt;value&amp;gt;10737418240&amp;lt;/value&amp;gt;&lt;br/&gt;
  &amp;lt;/property&amp;gt;&lt;/p&gt;

&lt;p&gt;but in regionserver&apos;s log,a minor compaction deals with 10 Hfiles,include a 220G HFile larger than hbase.hstore.compaction.max.size=10G.&lt;/p&gt;

&lt;p&gt;2013-06-03 10:27:51,147 DEBUG org.apache.hadoop.hbase.regionserver.Store: 8b6a4d4aae3099730b353183cf754ec4 - t: Initiating minorcompaction&lt;br/&gt;
2013-06-03 10:27:51,149 INFO org.apache.hadoop.hbase.regionserver.HRegion: Starting compaction on t in region transdb,1651763699103243149223370692144515807,1369372490168.8b6a4d4aae3099730b353183cf754ec4.&lt;br/&gt;
2013-06-03 10:27:51,150 DEBUG org.apache.hadoop.hbase.regionserver.CompactSplitThread: Large Compaction requested: regionName=transdb,1651763699103243149223370692144515807,1369372490168.8b6a4d4aae3099730b353183cf754ec4., storeName=t, fileCount=10, fileSize=234.4g (106.0m, 2.0g, 2.1g, 10.7m, 1.7g, 2.1g, 1.9g, 2.0g, 932.8m, 221.5g), priority=-110, time=2671513455305347; Because: Opening Region; compaction_queue=(0:0), split_queue=0&lt;br/&gt;
2013-06-03 10:27:51,151 INFO org.apache.hadoop.hbase.regionserver.Store: Starting compaction of 10 file(s) in t of transdb,1651763699103243149223370692144515807,1369372490168.8b6a4d4aae3099730b353183cf754ec4. into tmpdir=hdfs://namenode01:9000/hbase/transdb/8b6a4d4aae3099730b353183cf754ec4/.tmp, seqid=0, totalSize=234.4g&lt;br/&gt;
2013-06-03 10:27:51,152 DEBUG org.apache.hadoop.hbase.regionserver.Compactor: Compacting hdfs://namenode01:9000/hbase/transdb/8b6a4d4aae3099730b353183cf754ec4/t/0a5fb3caf6be490ba739b77fcaa4b274.c7ce1266ef1f8696ede82f08fceb28ff-hdfs://namenode01:9000/hbase/transdb/c7ce1266ef1f8696ede82f08fceb28ff/t/0a5fb3caf6be490ba739b77fcaa4b274-top, keycount=7948080, bloomtype=NONE, size=106.0m, encoding=NONE&lt;br/&gt;
2013-06-03 10:27:51,153 DEBUG org.apache.hadoop.hbase.regionserver.Compactor: Compacting hdfs://namenode01:9000/hbase/transdb/8b6a4d4aae3099730b353183cf754ec4/t/6bd849c93e3a45d4a4c8a5ab691f9b22.c7ce1266ef1f8696ede82f08fceb28ff-hdfs://namenode01:9000/hbase/transdb/c7ce1266ef1f8696ede82f08fceb28ff/t/6bd849c93e3a45d4a4c8a5ab691f9b22-top, keycount=153911753, bloomtype=NONE, size=2.0g, encoding=NONE&lt;br/&gt;
2013-06-03 10:27:51,153 DEBUG org.apache.hadoop.hbase.regionserver.Compactor: Compacting hdfs://namenode01:9000/hbase/transdb/8b6a4d4aae3099730b353183cf754ec4/t/191ef6d1076341e1b7fb5c775d0f9fdb.c7ce1266ef1f8696ede82f08fceb28ff-hdfs://namenode01:9000/hbase/transdb/c7ce1266ef1f8696ede82f08fceb28ff/t/191ef6d1076341e1b7fb5c775d0f9fdb-top, keycount=159372725, bloomtype=NONE, size=2.1g, encoding=NONE&lt;br/&gt;
2013-06-03 10:27:51,154 DEBUG org.apache.hadoop.hbase.regionserver.Compactor: Compacting hdfs://namenode01:9000/hbase/transdb/8b6a4d4aae3099730b353183cf754ec4/t/d907a7dca7d8466f843f126429f05665.c7ce1266ef1f8696ede82f08fceb28ff-hdfs://namenode01:9000/hbase/transdb/c7ce1266ef1f8696ede82f08fceb28ff/t/d907a7dca7d8466f843f126429f05665-top, keycount=808800, bloomtype=NONE, size=10.7m, encoding=NONE&lt;br/&gt;
2013-06-03 10:27:51,154 DEBUG org.apache.hadoop.hbase.regionserver.Compactor: Compacting hdfs://namenode01:9000/hbase/transdb/8b6a4d4aae3099730b353183cf754ec4/t/35399e73e3764d0b88251c7285cf5406.c7ce1266ef1f8696ede82f08fceb28ff-hdfs://namenode01:9000/hbase/transdb/c7ce1266ef1f8696ede82f08fceb28ff/t/35399e73e3764d0b88251c7285cf5406-top, keycount=133146091, bloomtype=NONE, size=1.7g, encoding=NONE&lt;br/&gt;
2013-06-03 10:27:51,154 DEBUG org.apache.hadoop.hbase.regionserver.Compactor: Compacting hdfs://namenode01:9000/hbase/transdb/8b6a4d4aae3099730b353183cf754ec4/t/9d5583ffde334bc79a692d400af7bae0.c7ce1266ef1f8696ede82f08fceb28ff-hdfs://namenode01:9000/hbase/transdb/c7ce1266ef1f8696ede82f08fceb28ff/t/9d5583ffde334bc79a692d400af7bae0-top, keycount=159372708, bloomtype=NONE, size=2.1g, encoding=NONE&lt;br/&gt;
2013-06-03 10:27:51,155 DEBUG org.apache.hadoop.hbase.regionserver.Compactor: Compacting hdfs://namenode01:9000/hbase/transdb/8b6a4d4aae3099730b353183cf754ec4/t/506254eac1bb455283f578e71af23153.c7ce1266ef1f8696ede82f08fceb28ff-hdfs://namenode01:9000/hbase/transdb/c7ce1266ef1f8696ede82f08fceb28ff/t/506254eac1bb455283f578e71af23153-top, keycount=152578349, bloomtype=NONE, size=1.9g, encoding=NONE&lt;br/&gt;
2013-06-03 10:27:51,155 DEBUG org.apache.hadoop.hbase.regionserver.Compactor: Compacting hdfs://namenode01:9000/hbase/transdb/8b6a4d4aae3099730b353183cf754ec4/t/72db7a39a2694bf58782e95992b012ae.c7ce1266ef1f8696ede82f08fceb28ff-hdfs://namenode01:9000/hbase/transdb/c7ce1266ef1f8696ede82f08fceb28ff/t/72db7a39a2694bf58782e95992b012ae-top, keycount=159369079, bloomtype=NONE, size=2.0g, encoding=NONE&lt;br/&gt;
2013-06-03 10:27:51,155 DEBUG org.apache.hadoop.hbase.regionserver.Compactor: Compacting hdfs://namenode01:9000/hbase/transdb/8b6a4d4aae3099730b353183cf754ec4/t/128f5cebbf074129b7c59de3d436b57d.c7ce1266ef1f8696ede82f08fceb28ff-hdfs://namenode01:9000/hbase/transdb/c7ce1266ef1f8696ede82f08fceb28ff/t/128f5cebbf074129b7c59de3d436b57d-top, keycount=72366990, bloomtype=NONE, size=932.8m, encoding=NONE&lt;br/&gt;
2013-06-03 10:27:51,155 DEBUG org.apache.hadoop.hbase.regionserver.Compactor: Compacting hdfs://namenode01:9000/hbase/transdb/8b6a4d4aae3099730b353183cf754ec4/t/df7ac534daa645589e5e2a6fe1a1a871, keycount=17218754243, bloomtype=NONE, size=221.5g, encoding=NONE&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12650566">HBASE-8676</key>
            <summary>hbase.hstore.compaction.max.size parameter has no effect in minor compaction</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="illhan">Calvin Qu</reporter>
                        <labels>
                    </labels>
                <created>Mon, 3 Jun 2013 06:26:00 +0000</created>
                <updated>Sat, 23 Jan 2016 06:09:05 +0000</updated>
                                            <version>0.94.7</version>
                                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>7</watches>
                                                                <comments>
                            <comment id="13675648" author="illhan" created="Wed, 5 Jun 2013 07:03:48 +0000"  >&lt;p&gt;I reviewed hbase source code(0.94.7).In Store.java,the store file is sorted by FLUSH_TIME,so if the hfiles are&lt;br/&gt;
hfile1 t1 1G&lt;br/&gt;
hfile2 t2 1G&lt;br/&gt;
hfile3 t3 100G&lt;br/&gt;
t1-&lt;del&gt;&amp;gt;t2&lt;/del&gt;&lt;del&gt;&amp;gt;t3(older&lt;/del&gt;-&amp;gt;newer),the sortAndClone method returns &amp;lt;hfile1,hfile2,hfile3&amp;gt; list.&lt;/p&gt;

&lt;p&gt;while (pos &amp;lt; compactSelection.getFilesToCompact().size() &amp;amp;&amp;amp;&lt;br/&gt;
             compactSelection.getFilesToCompact().get(pos).getReader().length()&lt;br/&gt;
               &amp;gt; maxCompactSize &amp;amp;&amp;amp;&lt;br/&gt;
             !compactSelection.getFilesToCompact().get(pos).isReference()) ++pos;&lt;br/&gt;
      if (pos != 0) compactSelection.clearSubList(0, pos);&lt;br/&gt;
the code above,will not remove hfile3 from the list,even if the hfile size 100G is larger than hbase.hstore.compaction.max.size(10G).&lt;/p&gt;</comment>
                            <comment id="13675652" author="lhofhansl" created="Wed, 5 Jun 2013 07:15:53 +0000"  >&lt;p&gt;Hi Calvin, what would the expected behavior be? Do you expect the 100gb never be picked up for compaction?&lt;/p&gt;</comment>
                            <comment id="13675666" author="illhan" created="Wed, 5 Jun 2013 07:32:55 +0000"  >&lt;p&gt;hi Lars&lt;br/&gt;
the file 100G is larger than hbase.hstore.compaction.max.size(10G),the file should be excluded from compaction,isn&apos;t it?&lt;/p&gt;</comment>
                            <comment id="13676193" author="lhofhansl" created="Wed, 5 Jun 2013 18:17:29 +0000"  >&lt;p&gt;So the data in it should never (ever) get compacted? I don&apos;t think that is a desirable behavior.&lt;/p&gt;</comment>
                            <comment id="13676581" author="illhan" created="Thu, 6 Jun 2013 01:29:40 +0000"  >&lt;p&gt;Hi Lars,the data can be included in major compaction not in minor compaction.If not,what does hbase.hstore.compaction.max.size mean?&lt;br/&gt;
I hava tried to add conf hbase.hstore.compaction.max in hbase-site.xml with value 10 or 5,but the larger file also is included.&lt;br/&gt;
another example,&lt;br/&gt;
hfile1 t1 10G&lt;br/&gt;
hfile2 t2 100G&lt;br/&gt;
hfile3 t3 1G&lt;br/&gt;
hfile4 t4 100G&lt;br/&gt;
t1-&lt;del&gt;&amp;gt;t4(older&lt;/del&gt;-&amp;gt;newer),no big file will be excluded.&lt;/p&gt;</comment>
                            <comment id="13679759" author="sershe" created="Mon, 10 Jun 2013 18:41:18 +0000"  >&lt;p&gt;I think the original intent was to exclude based on the first file under the assumption that it will be the largest one. It&apos;s the same (or even worse given how selection is done) on trunk now&lt;/p&gt;</comment>
                            <comment id="15052144" author="wang_yongqiang" created="Fri, 11 Dec 2015 04:25:40 +0000"  >&lt;p&gt;can skip all large files in the file list, not just the first one&lt;/p&gt;




&lt;p&gt;On 2015-09-02 01:52 , Sergey Shelukhin (JIRA) Wrote:&lt;/p&gt;


&lt;p&gt;    [ &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8676?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-8676?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel&lt;/a&gt; ]&lt;/p&gt;

&lt;p&gt;Sergey Shelukhin updated &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8676&quot; title=&quot;hbase.hstore.compaction.max.size parameter has no effect in minor compaction&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8676&quot;&gt;HBASE-8676&lt;/a&gt;:&lt;br/&gt;
------------------------------------&lt;br/&gt;
   Assignee:     (was: Sergey Shelukhin)&lt;/p&gt;




&lt;p&gt;&amp;#8211;&lt;br/&gt;
This message was sent by Atlassian JIRA&lt;br/&gt;
(v6.3.4#6332)&lt;/p&gt;</comment>
                            <comment id="15113599" author="anoop.hbase" created="Sat, 23 Jan 2016 06:09:05 +0000"  >&lt;blockquote&gt;
&lt;p&gt;hfile3 t3 100G&lt;br/&gt;
t1-&amp;gt;t2&amp;gt;t3(older-&amp;gt;newer),&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;So hfile3, a newer one with bigger size, is a bulk loaded one?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 5 Jun 2013 07:15:53 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>330893</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            46 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1l33j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>331226</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>