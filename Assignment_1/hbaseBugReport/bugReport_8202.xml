<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:52:59 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8202/HBASE-8202.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8202] MultiTableOutputFormat should support writing to another HBase cluster</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8202</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This was brought up by David Koch in thread &apos;hbase.mapred.output.quorum ignored in Mapper job with HDFS source and HBase sink&apos; where he wanted to import a file on HDFS from one cluster A (source) into HBase&lt;br/&gt;
tables on a different cluster B (destination) using a Mapper job with an&lt;br/&gt;
HBase sink.&lt;/p&gt;

&lt;p&gt;Here is my analysis:&lt;/p&gt;

&lt;p&gt;MultiTableOutputFormat doesn&apos;t extend TableOutputFormat:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class MultiTableOutputFormat &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; OutputFormat&amp;lt;ImmutableBytesWritable, Mutation&amp;gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Relevant configuration w.r.t. output quorum is setup in TableOutputFormat#setConf():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setConf(Configuration otherConf) {
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf = HBaseConfiguration.create(otherConf);
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tableName = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf.get(OUTPUT_TABLE);
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(tableName == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || tableName.length() &amp;lt;= 0) {
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IllegalArgumentException(&lt;span class=&quot;code-quote&quot;&gt;&quot;Must specify table name&quot;&lt;/span&gt;);
    }
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; address = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf.get(QUORUM_ADDRESS);
    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; zkClientPort = conf.getInt(QUORUM_PORT, 0);
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; serverClass = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf.get(REGION_SERVER_CLASS);
    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; serverImpl = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf.get(REGION_SERVER_IMPL);
    &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (address != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        ZKUtil.applyClusterKeyToConf(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.conf, address);
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12639401">HBASE-8202</key>
            <summary>MultiTableOutputFormat should support writing to another HBase cluster</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 27 Mar 2013 17:39:58 +0000</created>
                <updated>Fri, 3 Jan 2014 05:46:07 +0000</updated>
                                                                            <component>mapreduce</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13616660" author="ndimiduk" created="Thu, 28 Mar 2013 21:13:42 +0000"  >&lt;p&gt;Thanks for opening the ticket.&lt;/p&gt;</comment>
                            <comment id="13618389" author="dkoch" created="Sun, 31 Mar 2013 17:07:46 +0000"  >&lt;p&gt;Hello,&lt;/p&gt;

&lt;p&gt;I asked the original question on the mailing list. Here is a minimalist example to illustrate the behavior. Run with $quorum != $output_quorum for maximum effect &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;p&gt;HBase version was 0.92.1-cdh4.1.1. &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;&quot;&gt;&lt;b&gt;Example.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;package&lt;/span&gt; org.hbase.example;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.conf.Configuration;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.conf.Configured;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.KeyValue;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.client.Put;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.client.Result;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.client.Scan;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.io.ImmutableBytesWritable;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.mapreduce.TableMapReduceUtil;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.hbase.mapreduce.TableMapper;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.mapreduce.Job;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.util.Tool;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.hadoop.util.ToolRunner;

/**
 * Test to show how hbase.mapred.output.quorum setting is ignored with {@link MultiTableOutputFormat}.
 * 
 * @author davidkoch
 * 
 * See: https:&lt;span class=&quot;code-comment&quot;&gt;//issues.apache.org/jira/browse/HBASE-8202
&lt;/span&gt; * 
 * Hadoop/HBase configurations are read from command line. Replace environment variables below.
 * 
 * 1. Test with {@link TableOutputFormat} (Ok):
 *    
 *      hadoop jar $jar_name org.hbase.example.Example \
 *      -D hbase.zookeeper.quorum=$quorum \
 *      -D hbase.zookeeper.property.clientPort=2181 \
 *      -D hbase.mapreduce.inputtable=$input_table \
 *      -D hbase.mapreduce.scan.column.family=$colfam \
 *      -D hbase.mapred.outputtable=$output_table \
 *      -D mapreduce.outputformat.class=org.apache.hadoop.hbase.mapreduce.TableOutputFormat \
 *      -D hbase.mapred.output.quorum=$output_quorum:2181:/hbase
 * 
 * 2. Test with {@link MultiTableOutputFormat} (Fails):
 * 
 *      hadoop jar $jar_name org.hbase.example.Example \
 *      -D hbase.zookeeper.quorum=$quorum \
 *      -D hbase.zookeeper.property.clientPort=2181 \
 *      -D hbase.mapreduce.inputtable=$input_table \
 *      -D hbase.mapreduce.scan.column.family=$colfam \
 *      -D hbase.mapred.outputtable=$output_table \
 *      -D mapreduce.outputformat.class=org.apache.hadoop.hbase.mapreduce.MultiTableOutputFormat \
 *      -D hbase.mapred.output.quorum=$output_quorum:2181:/hbase
 * 
 * In the second example, the job itself will not fail &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; $output_table exists on $quorum but $output_quorum will
 * be ignored.
 */
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class Example &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; Configured &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; Tool {

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; class ExampleMapper &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; TableMapper&amp;lt;ImmutableBytesWritable, Put&amp;gt; {
        ImmutableBytesWritable tableName;

        @Override
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void setup(Context context) {
            tableName = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ImmutableBytesWritable(context.getConfiguration().get(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.mapred.outputtable&quot;&lt;/span&gt;)
                .getBytes());
        }
        
        &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void map(ImmutableBytesWritable row, Result value, Context context)
            &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException, InterruptedException {
            Put put = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Put(row.get());
            &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (KeyValue kv : value.raw()) {
                    put.add(kv);
            }
            context.write(tableName, put);
        }
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; run(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        Configuration conf = getConf();
        
        Scan scan = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Scan();
        scan.addFamily(conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.mapreduce.scan.column.family&quot;&lt;/span&gt;).getBytes());
        &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; inTable =  conf.get(&lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.mapreduce.inputtable&quot;&lt;/span&gt;);
        
        Job job = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Job(conf);
        job.setJobName(&lt;span class=&quot;code-quote&quot;&gt;&quot;Example-HBASE-8202&quot;&lt;/span&gt;);
        TableMapReduceUtil.initTableMapperJob(inTable, scan, ExampleMapper.class, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, job);
        job.setJarByClass(Example.class);
        job.setNumReduceTasks(0);
        
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; job.waitForCompletion(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;) ? 0 : 1;
    }

    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; void main(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;[] args) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
        &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; res = ToolRunner.run(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Example(), args);
        &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.exit(res);
    }
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13657741" author="yuzhihong@gmail.com" created="Wed, 15 May 2013 00:28:47 +0000"  >&lt;p&gt;draft patch.&lt;/p&gt;

&lt;p&gt;Next step is to use David&apos;s sample code for verification.&lt;/p&gt;</comment>
                            <comment id="13861244" author="yuzhihong@gmail.com" created="Fri, 3 Jan 2014 05:46:07 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=dkoch&quot; class=&quot;user-hover&quot; rel=&quot;dkoch&quot;&gt;David Koch&lt;/a&gt;:&lt;br/&gt;
Any chance of trying the patch ?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12583253" name="8202-v1.txt" size="2135" author="yuzhihong@gmail.com" created="Wed, 15 May 2013 00:28:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 28 Mar 2013 21:13:42 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>319871</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 50 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1j6wn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>320212</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>