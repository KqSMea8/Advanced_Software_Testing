<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:00:36 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9012/HBASE-9012.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9012] TestBlockReorder.testBlockLocationReorder fails</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9012</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;&lt;a href=&quot;http://54.241.6.143/job/HBase-0.95/669/org.apache.hbase$hbase-server/testReport/junit/org.apache.hadoop.hbase.fs/TestBlockReorder/testBlockLocationReorder/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://54.241.6.143/job/HBase-0.95/669/org.apache.hbase$hbase-server/testReport/junit/org.apache.hadoop.hbase.fs/TestBlockReorder/testBlockLocationReorder/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;java.net.BindException: Address already in use&lt;br/&gt;
	at java.net.PlainSocketImpl.socketBind(Native Method)&lt;br/&gt;
	at java.net.PlainSocketImpl.bind(PlainSocketImpl.java:383)&lt;br/&gt;
	at java.net.ServerSocket.bind(ServerSocket.java:328)&lt;br/&gt;
	at java.net.ServerSocket.&amp;lt;init&amp;gt;(ServerSocket.java:194)&lt;br/&gt;
	at java.net.ServerSocket.&amp;lt;init&amp;gt;(ServerSocket.java:106)&lt;br/&gt;
	at org.apache.hadoop.hbase.fs.TestBlockReorder.testBlockLocationReorder(TestBlockReorder.java:182)&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12659131">HBASE-9012</key>
            <summary>TestBlockReorder.testBlockLocationReorder fails</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkeywal">Nicolas Liochon</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Mon, 22 Jul 2013 16:47:16 +0000</created>
                <updated>Mon, 23 Sep 2013 19:22:44 +0000</updated>
                            <resolved>Tue, 30 Jul 2013 09:13:15 +0000</resolved>
                                                    <fixVersion>0.95.2</fixVersion>
                                    <component>test</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13715371" author="stack" created="Mon, 22 Jul 2013 17:06:26 +0000"  >&lt;p&gt;Test was added by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6435&quot; title=&quot;Reading WAL files after a recovery leads to time lost in HDFS timeouts when using dead datanodes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6435&quot;&gt;&lt;del&gt;HBASE-6435&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkeywal&quot; class=&quot;user-hover&quot; rel=&quot;nkeywal&quot;&gt;Nicolas Liochon&lt;/a&gt; What you think?  The DN had not gone down by the time we call:&lt;/p&gt;

&lt;p&gt;    ServerSocket ss = new ServerSocket(port);// We&apos;re taking the port to have a timeout issue later.&lt;/p&gt;



</comment>
                            <comment id="13715372" author="stack" created="Mon, 22 Jul 2013 17:07:35 +0000"  >&lt;p&gt;Retry bindexceptions.  What you think &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkeywal&quot; class=&quot;user-hover&quot; rel=&quot;nkeywal&quot;&gt;Nicolas Liochon&lt;/a&gt;  If good, I&apos;ll commit (come to think of it, @nkeywal is on vacation this week...)&lt;/p&gt;</comment>
                            <comment id="13715480" author="hadoopqa" created="Mon, 22 Jul 2013 18:18:44 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12593551/9012.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12593551/9012.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop1.0&lt;/font&gt;.  The patch compiles against the hadoop 1.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6423//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13715649" author="stack" created="Mon, 22 Jul 2013 20:56:55 +0000"  >&lt;p&gt;Committed this patch to trunk and 0.95.  Lets see how it does going forward.&lt;/p&gt;</comment>
                            <comment id="13722539" author="stack" created="Mon, 29 Jul 2013 15:30:45 +0000"  >&lt;p&gt;It failed this morning: &lt;a href=&quot;http://54.241.6.143/job/HBase-TRUNK-Hadoop-2/org.apache.hbase$hbase-server/427/testReport/org.apache.hadoop.hbase.fs/TestBlockReorder/testBlockLocationReorder/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://54.241.6.143/job/HBase-TRUNK-Hadoop-2/org.apache.hbase$hbase-server/427/testReport/org.apache.hadoop.hbase.fs/TestBlockReorder/testBlockLocationReorder/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Looks like we tried to bind ten times and each time we failed:&lt;/p&gt;

&lt;p&gt;2013-07-29 09:18:28,414 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; fs.TestBlockReorder(191): Got bind exception trying to set up socket on 53699; waiting a while; retry=0&lt;br/&gt;
2013-07-29 09:18:29,416 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; fs.TestBlockReorder(191): Got bind exception trying to set up socket on 53699; waiting a while; retry=1&lt;br/&gt;
2013-07-29 09:18:30,416 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; fs.TestBlockReorder(191): Got bind exception trying to set up socket on 53699; waiting a while; retry=2&lt;br/&gt;
2013-07-29 09:18:31,417 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; fs.TestBlockReorder(191): Got bind exception trying to set up socket on 53699; waiting a while; retry=3&lt;br/&gt;
2013-07-29 09:18:32,418 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; fs.TestBlockReorder(191): Got bind exception trying to set up socket on 53699; waiting a while; retry=4&lt;br/&gt;
2013-07-29 09:18:33,419 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; fs.TestBlockReorder(191): Got bind exception trying to set up socket on 53699; waiting a while; retry=5&lt;br/&gt;
2013-07-29 09:18:34,419 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; fs.TestBlockReorder(191): Got bind exception trying to set up socket on 53699; waiting a while; retry=6&lt;br/&gt;
2013-07-29 09:18:35,420 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; fs.TestBlockReorder(191): Got bind exception trying to set up socket on 53699; waiting a while; retry=7&lt;br/&gt;
2013-07-29 09:18:36,421 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; fs.TestBlockReorder(191): Got bind exception trying to set up socket on 53699; waiting a while; retry=8&lt;br/&gt;
2013-07-29 09:18:37,422 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; fs.TestBlockReorder(191): Got bind exception trying to set up socket on 53699; waiting a while; retry=9&lt;/p&gt;

&lt;p&gt;I could have us retry until we get a good port?&lt;/p&gt;</comment>
                            <comment id="13722686" author="nkeywal" created="Mon, 29 Jul 2013 17:30:28 +0000"  >&lt;p&gt;I think it&apos;s because the datanode didn&apos;t die. The call to shutdown is supposed to be synchronous, so I&apos;m not sure it&apos;s gonna help. In the hdfs javadoc, there is this:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;org.apache.hadoop.hdfs.server.datanode.DataNode&lt;br/&gt;
public void shutdown()&lt;br/&gt;
Shut down this instance of the datanode. Returns only after shutdown is complete. This method can only be called by the offerService thread. Otherwise, deadlock might occur&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&quot;This method can only be called by the offerService thread&quot; is strange, but when I look at the code I don&apos;t see what it means (MiniDFSCluster#shutdownDataNodes) does not do anything special with threads.&lt;/p&gt;</comment>
                            <comment id="13722715" author="stack" created="Mon, 29 Jul 2013 17:45:35 +0000"  >&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;~liochon&amp;#93;&lt;/span&gt; (Welcome back) Now I see that we are just retrying same port over and over.  I thought port number was incrementing.  Yeah, why is the dn so obstreperous.  You looking in logs?  Does it go down eventually?&lt;/p&gt;</comment>
                            <comment id="13722735" author="nkeywal" created="Mon, 29 Jul 2013 17:55:28 +0000"  >&lt;p&gt;Hi Stack &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

&lt;p&gt;Actually there is another scenario: another process / test took the port between the time we killed and the time we try to take the port. I&apos;m not sure it&apos;s that scenario, because usually the OS is supposed to wait a little before allocating the same port. But who knows? So we could fix this by checking that we&apos;ve been able to take the port, and if not, skip the next step? This could work as well if the DN is still there, whatever the reason.&lt;/p&gt;

&lt;p&gt;If you&apos;re ok with the approach I will write a patch.&lt;/p&gt;</comment>
                            <comment id="13722769" author="stack" created="Mon, 29 Jul 2013 18:19:57 +0000"  >&lt;p&gt;Sounds good &lt;span class=&quot;error&quot;&gt;&amp;#91;~liochon&amp;#93;&lt;/span&gt;  Thanks.&lt;/p&gt;</comment>
                            <comment id="13723601" author="nkeywal" created="Tue, 30 Jul 2013 09:12:47 +0000"  >&lt;p&gt;I&apos;ve committed 9012.v1.patch on .95 &amp;amp; trunk. As we just skip the end of the test, this should fix the issue.&lt;/p&gt;</comment>
                            <comment id="13724111" author="stack" created="Tue, 30 Jul 2013 17:24:22 +0000"  >&lt;p&gt;Good.  Lets see how it goes.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12593551" name="9012.txt" size="2779" author="stack" created="Mon, 22 Jul 2013 17:07:35 +0000"/>
                            <attachment id="12594909" name="9012.v1.patch" size="1891" author="nkeywal" created="Tue, 30 Jul 2013 09:07:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 22 Jul 2013 18:18:44 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339324</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 20 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1miy7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>339644</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>