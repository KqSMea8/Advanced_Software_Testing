<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:14:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10535/HBASE-10535.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10535] Table trash to recover table deleted by mistake</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10535</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When table is deleted, only Hfiles are moved to archives dir, table and region infos are deleted immediately. So it&apos;s very difficult to recover tables which are deleted by mistakes.&lt;/p&gt;

&lt;p&gt;I think if we can introduce an table trash dir in HDFS. When the table is deleted, the entire table dir is moved to trash dir. And after an configurable ttl,  the dir is deleted actually. This can be done by HMaster.&lt;/p&gt;

&lt;p&gt;If we want to recover the deleted table, we can use a tool which moves table dir out of trash and recovery the meta data of the table. There are many problems the recover tool will encountered eg, parent  and daughter regions are all in the table dir. But I think this feature is useful to handle some special cases.&lt;/p&gt;

&lt;p&gt;Discussions are welcomed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12695192">HBASE-10535</key>
            <summary>Table trash to recover table deleted by mistake</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="liushaohui">Liu Shaohui</reporter>
                        <labels>
                    </labels>
                <created>Fri, 14 Feb 2014 11:52:52 +0000</created>
                <updated>Mon, 17 Feb 2014 01:53:58 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13901387" author="jmspaggi" created="Fri, 14 Feb 2014 12:38:58 +0000"  >&lt;p&gt;Another idea/option: Use cell tags in META to mark this table as deleted with the TTL, build a process to clear it when TTL expire. That way it&apos;s even easier to restore? And might be also a very fast operation.&lt;/p&gt;</comment>
                            <comment id="13901406" author="liushaohui" created="Fri, 14 Feb 2014 13:05:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt;&lt;br/&gt;
Will this method block or affect the table creation with  the same name?&lt;br/&gt;
If not, i think it is good.&lt;/p&gt;</comment>
                            <comment id="13901440" author="jmspaggi" created="Fri, 14 Feb 2014 13:31:29 +0000"  >&lt;p&gt;We can also use a specific system reserved namespace like &quot;trash:&quot;. If we do so we might not even have to use tags. We just move the META cells into this specific namespace, then you can create the table again in the user namespace. To restore, we &quot;simply&quot; move back the rows from the &quot;trash:&quot; namespace to the namespace their was in initially.&lt;/p&gt;

&lt;p&gt;2 options. For table &quot;myspace:mytable&quot; we can:&lt;br/&gt;
1) Move it under &quot;trash:myspace:mytable&quot;&lt;br/&gt;
2) Move it under &quot;trash:mytable&quot; and keep the namespace in a tag.&lt;/p&gt;

&lt;p&gt;I think option 1 is better.&lt;/p&gt;</comment>
                            <comment id="13901478" author="liushaohui" created="Fri, 14 Feb 2014 14:41:38 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jmspaggi&quot; class=&quot;user-hover&quot; rel=&quot;jmspaggi&quot;&gt;Jean-Marc Spaggiari&lt;/a&gt;&lt;br/&gt;
Agree with option 1. &lt;/p&gt;</comment>
                            <comment id="13901547" author="jmspaggi" created="Fri, 14 Feb 2014 15:28:23 +0000"  >&lt;p&gt;So you will have to modify:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;HBaseAdmin to add deleteTable(tableName, skipTrash);&lt;/li&gt;
	&lt;li&gt;HBCK to deal with this special namespace;&lt;/li&gt;
	&lt;li&gt;CatalogJanitor to clear deleted tables after TTL expired;&lt;/li&gt;
	&lt;li&gt;HBaseAdmin to add restoreTable(tableName);&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;And maybe some other too.&lt;/p&gt;</comment>
                            <comment id="13901768" author="yuzhihong@gmail.com" created="Fri, 14 Feb 2014 18:47:15 +0000"  >&lt;blockquote&gt;&lt;p&gt;Move it under &quot;trash:myspace:mytable&quot;&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Is nested namespace supported ?&lt;/p&gt;</comment>
                            <comment id="13901773" author="jmspaggi" created="Fri, 14 Feb 2014 18:51:09 +0000"  >&lt;p&gt;I see this as &quot;trash&quot; beeing the namespace and &quot;myspace:mytable&quot; being the table name. Not really a nested namespace.&lt;/p&gt;</comment>
                            <comment id="13901815" author="enis" created="Fri, 14 Feb 2014 19:20:08 +0000"  >&lt;p&gt;I think we should not have yet another directory for trash. Current .archive directory is for deleted files, and we already have the TTL mechanism, so we should build trash on top of this. A simple thing would be to move the table&apos;s HTD to the archive directory as well, and delete that based on the same TTL. We can have the &quot;untrash&quot; command to retrieve from this dir. &lt;br/&gt;
Trash&apos;ed table SHOULD NOT prevent creating tables of the same name. &lt;/p&gt;</comment>
                            <comment id="13902372" author="liushaohui" created="Sat, 15 Feb 2014 10:09:29 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=enis&quot; class=&quot;user-hover&quot; rel=&quot;enis&quot;&gt;Enis Soztutar&lt;/a&gt;&lt;br/&gt;
It&apos;s difficult to distinguish the Hfiles deleted by compaction or deleted by table delete in .archive directory , if using it for all deleted files.  And there may be extra region dir in .archive directory for region split. So it will make the table restore complex.&lt;/p&gt;

&lt;p&gt;If using a separate dir trash or a namespace trash, I think it&apos;s easy to keep integrity of table&apos;s data and restore table.&lt;/p&gt;</comment>
                            <comment id="13902821" author="apurtell" created="Sun, 16 Feb 2014 20:32:09 +0000"  >&lt;p&gt;Providing an option to, upon deletion command, disable the table and then move its metadata to a namespace from which tables are automatically dropped after some interval seems reasonable. The only wrinkle is finding somewhere to record the original namespace name to support a restore command, and introducing that restore command. &lt;/p&gt;

&lt;p&gt;This would address Enis&apos; point because there would not be any new directories introduced at the HDFS level. The table goes into an effective inactive state with all HFiles in place, and at some point the normal drop and HFile archival step happens as before. &lt;/p&gt;</comment>
                            <comment id="13902910" author="jmspaggi" created="Mon, 17 Feb 2014 01:53:58 +0000"  >&lt;p&gt;I also prefers to not use the .archive directory for this. When the TTL will expire, files are going to be moved into .archive like other deleted files, but before that, it&apos;s not the same usecase so I think it&apos;s correct to keep them aside.&lt;/p&gt;

&lt;p&gt;Also, if we use a specific namespace and store the previous namespace in the new table name, then we don&apos;t need to store that anywhere else.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 14 Feb 2014 12:38:58 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>373700</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 43 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1see7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>374000</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>