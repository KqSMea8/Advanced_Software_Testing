<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:14:14 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3914/HBASE-3914.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3914] ROOT region appeared in two regionserver&apos;s onlineRegions at the same time</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3914</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This could be happen under the following steps with little probability:&lt;br/&gt;
(I suppose the cluster nodes names are RS1/RS2/HM, and there&apos;s more than 10,000 regions in the cluster)&lt;/p&gt;

&lt;p&gt;1.Root region was opened in RS1.&lt;br/&gt;
2.Due to some reason(Maybe the hdfs process was got abnormal),RS1 aborted.&lt;br/&gt;
3.ServerShutdownHandler process start.&lt;br/&gt;
4.HMaster was restarted, during the finishInitialization&apos;s handling, ROOT region was unsetted, and assigned to RS2. &lt;br/&gt;
5.Root region was opened successfully in RS2.&lt;br/&gt;
6.But after while, ROOT region was unsetted again by RS1&apos;s ServerShutdownHandler. Then it was reassigned. Before that, the RS1 was restarted. So there&apos;s two possibilities:&lt;br/&gt;
 Case a:&lt;br/&gt;
   ROOT region was assigned to RS1. &lt;br/&gt;
   It seemed nothing would be affected. But the root region was still online in RS2.  &lt;/p&gt;

&lt;p&gt; Case b:&lt;br/&gt;
   ROOT region was assigned to RS2.    &lt;br/&gt;
   The ROOT Region couldn&apos;t be opened until it would be reassigned to other regionserver, because it was showed online in this regionserver.&lt;/p&gt;

&lt;p&gt;This could be proved from the logs:&lt;/p&gt;

&lt;p&gt;1. ROOT region was opened with two times:&lt;br/&gt;
2011-05-17 10:32:59,188 DEBUG org.apache.hadoop.hbase.master.handler.OpenedRegionHandler: Opened region &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 on 162-2-77-0,20020,1305598359031&lt;br/&gt;
2011-05-17 10:33:01,536 DEBUG org.apache.hadoop.hbase.master.handler.OpenedRegionHandler: Opened region &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 on 162-2-16-6,20020,1305597548212&lt;/p&gt;

&lt;p&gt;2.Regionserver 162-2-16-6 was aborted, so it was reassigned to 162-2-77-0, but already online on this server:&lt;br/&gt;
10:49:30,920 INFO org.apache.hadoop.hbase.regionserver.HRegionServer: Received request to open region: &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 10:49:30,920 DEBUG org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler: Processing open of &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 10:49:30,920 WARN org.apache.hadoop.hbase.regionserver.handler.OpenRegionHandler: Attempted open of &lt;del&gt;ROOT&lt;/del&gt;,,0.70236052 but already online on this server&lt;/p&gt;

&lt;p&gt;This could be cause a long break of ROOT region offline, though it happened under a special scenario. And I have checked the code, it seems a tiny bug here.&lt;/p&gt;

&lt;p&gt;There&apos;s 2 references about assignRoot():&lt;/p&gt;

&lt;p&gt;1.&lt;br/&gt;
HMaster# assignRootAndMeta:&lt;/p&gt;

&lt;p&gt;    if (!catalogTracker.verifyRootRegionLocation(timeout)) &lt;/p&gt;
{
      this.assignmentManager.assignRoot();
      this.catalogTracker.waitForRoot();
      assigned++;
    }

&lt;p&gt;2.&lt;br/&gt;
ServerShutdownHandler# process: &lt;/p&gt;

&lt;p&gt;      if (isCarryingRoot()) { // &lt;del&gt;ROOT&lt;/del&gt;      &lt;br/&gt;
        try &lt;/p&gt;
{        
           this.services.getAssignmentManager().assignRoot();
        }
&lt;p&gt; catch (KeeperException e) &lt;/p&gt;
{
           this.server.abort(&quot;In server shutdown processing, assigning root&quot;, e);
           throw new IOException(&quot;Aborting&quot;, e);
        }
&lt;p&gt;      }    &lt;/p&gt;

&lt;p&gt;I think each time call the method of assignRoot(), we should verify Root Region&apos;s Location first. Because before the assigning, the ROOT region could have been assigned by another place.&lt;/p&gt;


</description>
                <environment></environment>
        <key id="12508125">HBASE-3914</key>
            <summary>ROOT region appeared in two regionserver&apos;s onlineRegions at the same time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jeason">Jieshan Bean</assignee>
                                    <reporter username="jeason">Jieshan Bean</reporter>
                        <labels>
                    </labels>
                <created>Tue, 24 May 2011 01:51:12 +0000</created>
                <updated>Fri, 20 Nov 2015 12:43:34 +0000</updated>
                            <resolved>Tue, 24 May 2011 17:28:10 +0000</resolved>
                                    <version>0.90.3</version>
                                    <fixVersion>0.90.4</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13038377" author="jeason" created="Tue, 24 May 2011 04:05:23 +0000"  >&lt;p&gt;In ServerShutDownHandler# process, if this server carrying the ROOT region, before the assigning, verify the ROOT region&apos;s location first.&lt;/p&gt;</comment>
                            <comment id="13038395" author="stack" created="Tue, 24 May 2011 05:37:25 +0000"  >&lt;p&gt;Thanks for looking into this Jieshan.&lt;/p&gt;

&lt;p&gt;Why not keep the change local to ServerShutdownHandler?  If it is the only class that uses the new verifyAndAssignRoot, why not make it private to the ServerShutdownHandler class?&lt;/p&gt;

&lt;p&gt;base.catalog.verification.timeout is new?  And default is 1 second only?  Is that enough time?&lt;/p&gt;

&lt;p&gt;Good stuff&lt;/p&gt;</comment>
                            <comment id="13038411" author="jeason" created="Tue, 24 May 2011 06:26:38 +0000"  >&lt;p&gt;Thanks for your quickly comments about this patch,Stack.&lt;br/&gt;
1.&quot;hbase.catalog.verification.timeout&quot; is not new, about that, I referenced the original code(In method HMaster#assignRootAndMeta), any other place use it like this, so I just followed that.&lt;/p&gt;

&lt;p&gt;2.I have thought about add this method in ServerShutdownHandler, and indeed if it is an private method will be better.&lt;/p&gt;

&lt;p&gt;I will make the change immediately &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
</comment>
                            <comment id="13038430" author="jeason" created="Tue, 24 May 2011 07:37:44 +0000"  >&lt;p&gt;If possible, I hope this patch could be reviewed quickly, thanks&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13038678" author="stack" created="Tue, 24 May 2011 17:28:10 +0000"  >&lt;p&gt;Committed to trunk and branch.  Thanks for the patch Jieshan (I added you as a contributor and assigned you this issue).  FYI in future, please follow the coding convention of the code that surrounds your additions; e.g. two spaces for tabs, lines &amp;lt; 80 characters, and notice how curly braces are put at the end of the line rather than on a new line when adding an exception clause.&lt;/p&gt;

&lt;p&gt;Good stuff.&lt;/p&gt;</comment>
                            <comment id="13038887" author="jeason" created="Wed, 25 May 2011 00:02:27 +0000"  >&lt;p&gt;Thanks stack.&lt;br/&gt;
In future, I will notice what you remind me, and I also hope I can contribute more patches.&lt;br/&gt;
&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13038956" author="stack" created="Wed, 25 May 2011 04:51:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;In future, I will notice what you remind me, and I also hope I can contribute more patches.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No problem and keep the patches coming!&lt;/p&gt;</comment>
                            <comment id="13039403" author="hudson" created="Wed, 25 May 2011 23:00:42 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #1939 (See &lt;a href=&quot;https://builds.apache.org/hudson/job/HBase-TRUNK/1939/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/hudson/job/HBase-TRUNK/1939/&lt;/a&gt;)&lt;/p&gt;
</comment>
                            <comment id="13146062" author="koven2049" created="Tue, 8 Nov 2011 03:33:47 +0000"  >&lt;p&gt;It seemed like root region will never be assigned if verifyRootRegionLocation throws IOE.&lt;/p&gt;</comment>
                            <comment id="13146076" author="stack" created="Tue, 8 Nov 2011 04:41:01 +0000"  >&lt;p&gt;@mingjian Do you have a log?  Do you want to open new issue?&lt;/p&gt;</comment>
                            <comment id="13146111" author="koven2049" created="Tue, 8 Nov 2011 07:21:34 +0000"  >&lt;p&gt;@stack: The following is our master log:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 
2011-10-19 19:13:34,873 ERROR org.apache.hadoop.hbase.executor.EventHandler: Caught throwable while processing event M_META_SERVER_S
HUTDOWN
org.apache.hadoop.ipc.RemoteException: org.apache.hadoop.hbase.ipc.ServerNotRunningException: Server is not running yet
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1090)

        at org.apache.hadoop.hbase.ipc.HBaseClient.call(HBaseClient.java:771)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Invoker.invoke(HBaseRPC.java:256)
        at $Proxy7.getRegionInfo(Unknown Source)
        at org.apache.hadoop.hbase.catalog.CatalogTracker.verifyRegionLocation(CatalogTracker.java:424)
        at org.apache.hadoop.hbase.catalog.CatalogTracker.verifyRootRegionLocation(CatalogTracker.java:471)
        at org.apache.hadoop.hbase.master.handler.ServerShutdownHandler.verifyAndAssignRoot(ServerShutdownHandler.java:90)
        at org.apache.hadoop.hbase.master.handler.ServerShutdownHandler.process(ServerShutdownHandler.java:126)
        at org.apache.hadoop.hbase.executor.EventHandler.run(EventHandler.java:151)
        at java.util.concurrent.ThreadPoolExecutor$Worker.runTask(ThreadPoolExecutor.java:886)
        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:908)
        at java.lang.Thread.run(Thread.java:662)&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;After this, &lt;del&gt;ROOT&lt;/del&gt;&apos;s region won&apos;t be assigned, like this:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 
2011-10-19 19:18:40,000 DEBUG org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation: locateRegionInMeta parent
Table=-ROOT-, metaLocation=address: dw79.kgb.sqa.cm4:60020, regioninfo: -ROOT-,,0.70236052, attempt=0 of 10 failed; retrying after s
leep of 1000 because: org.apache.hadoop.hbase.NotServingRegionException: Region is not online: -ROOT-,,0
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getRegion(HRegionServer.java:2771)
        at org.apache.hadoop.hbase.regionserver.HRegionServer.getClosestRowBefore(HRegionServer.java:1802)
        at sun.reflect.GeneratedMethodAccessor7.invoke(Unknown Source)
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:25)
        at java.lang.reflect.Method.invoke(Method.java:597)
        at org.apache.hadoop.hbase.ipc.HBaseRPC$Server.call(HBaseRPC.java:569)
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1091)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So we should rewrite the verify method both in branch-0.90 and trunk&lt;/p&gt;</comment>
                            <comment id="13146330" author="stack" created="Tue, 8 Nov 2011 14:39:23 +0000"  >&lt;p&gt;Can we do this discussion in a new issue Mingjie?  Mind opening one?&lt;/p&gt;

&lt;p&gt;Is the above log from a 0.90 or a 0.92/trunk?  Thanks.&lt;/p&gt;</comment>
                            <comment id="13146748" author="koven2049" created="Wed, 9 Nov 2011 03:26:50 +0000"  >&lt;p&gt;@stack:&lt;br/&gt;
I created &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4762&quot; title=&quot;ROOT and META region never be assigned if IOE throws in verifyRootRegionLocation&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4762&quot;&gt;&lt;del&gt;HBASE-4762&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="15017559" author="lars_francke" created="Fri, 20 Nov 2015 12:43:34 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                                                <inwardlinks description="is blocked by">
                                        <issuelink>
            <issuekey id="12530814">HBASE-4762</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12480213" name="HBASE-3914-V2.patch" size="1874" author="jeason" created="Tue, 24 May 2011 07:37:44 +0000"/>
                            <attachment id="12480201" name="HBASE-3914.patch" size="2176" author="jeason" created="Tue, 24 May 2011 03:55:05 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 24 May 2011 05:37:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27088</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hohr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101230</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>