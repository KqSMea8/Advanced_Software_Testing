<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:31:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5844/HBASE-5844.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5844] Delete the region servers znode after a regions server crash</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5844</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;today, if the regions server crashes, its znode is not deleted in ZooKeeper. So the recovery process will stop only after a timeout, usually 30s.&lt;/p&gt;

&lt;p&gt;By deleting the znode in start script, we remove this delay and the recovery starts immediately.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12551767">HBASE-5844</key>
            <summary>Delete the region servers znode after a regions server crash</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkeywal">Nicolas Liochon</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Fri, 20 Apr 2012 10:37:59 +0000</created>
                <updated>Tue, 15 Oct 2013 04:46:38 +0000</updated>
                            <resolved>Fri, 4 May 2012 15:20:02 +0000</resolved>
                                    <version>0.95.2</version>
                                    <fixVersion>0.95.0</fixVersion>
                                    <component>regionserver</component>
                    <component>scripts</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13258137" author="nkeywal" created="Fri, 20 Apr 2012 10:46:10 +0000"  >&lt;p&gt;Patch v1. Tested on a local cluster &amp;amp; pseudo distributed, by stopping the server by kill -9. I will do some minor improvements on the java code and then test on a real cluster, but I&apos;m interested by a feedback on the script.&lt;/p&gt;</comment>
                            <comment id="13258422" author="jdcryans" created="Fri, 20 Apr 2012 17:58:00 +0000"  >&lt;p&gt;It is deleted automatically, it&apos;s an ephemeral znode so it takes zk.session.timeout time to see it disappear.&lt;/p&gt;</comment>
                            <comment id="13258788" author="nkeywal" created="Sat, 21 Apr 2012 06:42:53 +0000"  >&lt;p&gt;I didn&apos;t know this parameter. It&apos;s interesting, because with ZK the default timeout is 30 seconds, but with HBase it&apos;s now 180s (from hbase-default.xml). It was increased to 60s a first time in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1772&quot; title=&quot;Up the default ZK session timeout from 30seconds to 60seconds&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1772&quot;&gt;&lt;del&gt;HBASE-1772&lt;/del&gt;&lt;/a&gt;. It seems it was increased because of the GC.&lt;/p&gt;

&lt;p&gt;But it means that deleting immediately the ZK represents a huge mttr improvement for the regions server crash case.&lt;/p&gt;

</comment>
                            <comment id="13258796" author="stack" created="Sat, 21 Apr 2012 07:14:53 +0000"  >&lt;p&gt;If we go to a count &amp;gt; 100 we just continue the startup?  Is that what you want?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!tracker.checkIfBaseNodeAvailable() &amp;amp;&amp;amp; ++count&amp;lt;100) {
+      &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(100);
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Be like the rest of the code regards spaces; i.e. spaces around operators...&lt;/p&gt;


&lt;p&gt;+&lt;br/&gt;
+    if (fileName==null){&lt;/p&gt;


&lt;p&gt;Maybe you don&apos;t need deleteMyEphemeralNodeOnDisk if you instead use &lt;a href=&quot;http://docs.oracle.com/javase/6/docs/api/java/io/File.html#deleteOnExit(&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://docs.oracle.com/javase/6/docs/api/java/io/File.html#deleteOnExit(&lt;/a&gt;) inside in writeMyEphemeralNodeOnDisk?&lt;/p&gt;

&lt;p&gt;Patch looks good N.&lt;/p&gt;

&lt;p&gt;We upped the timeout because noobs would install hbase then run big mapreduce jobs w/o turning jvm and so big GCs.  We figured they&apos;d rather have their regionserver ride over the big pauses than have them be &apos;sensitive&apos; out of the box.&lt;/p&gt;</comment>
                            <comment id="13258803" author="nkeywal" created="Sat, 21 Apr 2012 07:59:49 +0000"  >&lt;p&gt;For the tracker, it&apos;s my private workaround for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5666&quot; title=&quot;RegionServer doesn&amp;#39;t retry to check if base node is available&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5666&quot;&gt;&lt;del&gt;HBASE-5666&lt;/del&gt;&lt;/a&gt;, it should not have been included in this patch. Sorry about this.&lt;/p&gt;

&lt;p&gt;I think it&apos;s better to delete the file explicitly, just after the znode deletion. HRegionServer#deleteMyEphemeralNode is called only once, and I added deleteMyEphemeralNodeOnDisk just after this call. If we rely on #deleteOnExit, I fear we could have the file deleted with a still alive znode. I&apos;m not sure and I have not tried it, but I think it&apos;s too easy to enter into the jvm-specific-behavior space here.&lt;/p&gt;

&lt;p&gt;I will fix the java code and try the whole fix on a real cluster for the v2.&lt;/p&gt;

&lt;p&gt;Thanks you for the review.&lt;/p&gt;


</comment>
                            <comment id="13258988" author="stack" created="Sun, 22 Apr 2012 03:47:21 +0000"  >&lt;p&gt;Ok on your reasoning for not using deleteOnExit.  Try and have the two methods share more code like getting the name of the file w/ the znode name in it.  Otherwise, sounds good.&lt;/p&gt;</comment>
                            <comment id="13259692" author="nkeywal" created="Mon, 23 Apr 2012 16:20:52 +0000"  >&lt;p&gt;v2 should be ok. It does not include anymore the fix for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5666&quot; title=&quot;RegionServer doesn&amp;#39;t retry to check if base node is available&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5666&quot;&gt;&lt;del&gt;HBASE-5666&lt;/del&gt;&lt;/a&gt;, so it cannot be tested locally but I tried it before removing the workaround. &lt;/p&gt;</comment>
                            <comment id="13259811" author="stack" created="Mon, 23 Apr 2012 18:29:37 +0000"  >&lt;p&gt;Should master write out its znode name too?  If it crashes this code could bring on the second master faster?&lt;/p&gt;</comment>
                            <comment id="13259904" author="nkeywal" created="Mon, 23 Apr 2012 20:03:49 +0000"  >&lt;p&gt;You&apos;re right. I propose to commit this patch, I will then generalize the solution to master in another jira.&lt;/p&gt;</comment>
                            <comment id="13259914" author="zhihyu@ebaysf.com" created="Mon, 23 Apr 2012 20:16:11 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-quote&quot;&gt;&quot;(Environment variable HBASE_ZNODE_FILE is no set).&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;is no set&apos; -&amp;gt; &apos;is not set&apos;&lt;/p&gt;</comment>
                            <comment id="13259921" author="stack" created="Mon, 23 Apr 2012 20:26:49 +0000"  >&lt;p&gt;@N Ok. I&apos;ll commit this then in a new JIRA move out the common code to util or some place.  I&apos;ll handle Ted&apos;s comment on commit.&lt;/p&gt;</comment>
                            <comment id="13259923" author="stack" created="Mon, 23 Apr 2012 20:30:36 +0000"  >&lt;p&gt;What I committed.  Its v2 + addressing Ted comment.&lt;/p&gt;</comment>
                            <comment id="13259924" author="stack" created="Mon, 23 Apr 2012 20:31:07 +0000"  >&lt;p&gt;Committed to trunk.  Thanks for the patch N.&lt;/p&gt;</comment>
                            <comment id="13260046" author="hudson" created="Mon, 23 Apr 2012 22:47:05 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2801 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2801/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2801/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5844&quot; title=&quot;Delete the region servers znode after a regions server crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5844&quot;&gt;&lt;del&gt;HBASE-5844&lt;/del&gt;&lt;/a&gt; Delete the region servers znode after a regions server crash (Revision 1329430)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/bin/hbase-daemon.sh&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13260258" author="hudson" created="Tue, 24 Apr 2012 06:03:25 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #182 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/182/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/182/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5844&quot; title=&quot;Delete the region servers znode after a regions server crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5844&quot;&gt;&lt;del&gt;HBASE-5844&lt;/del&gt;&lt;/a&gt; Delete the region servers znode after a regions server crash (Revision 1329430)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/bin/hbase-daemon.sh&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13262735" author="nkeywal" created="Thu, 26 Apr 2012 16:54:02 +0000"  >&lt;p&gt;There is a regression when the cluster is fully distributed: the start command hangs. I&apos;m on it. In the meantime, would it be possible to undo the commit?&lt;/p&gt;

&lt;p&gt;Sorry about this.&lt;/p&gt;</comment>
                            <comment id="13262773" author="stack" created="Thu, 26 Apr 2012 17:30:32 +0000"  >&lt;p&gt;I reverted the patch from trunk.&lt;/p&gt;</comment>
                            <comment id="13263369" author="hudson" created="Fri, 27 Apr 2012 05:49:33 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #186 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/186/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/186/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5844&quot; title=&quot;Delete the region servers znode after a regions server crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5844&quot;&gt;&lt;del&gt;HBASE-5844&lt;/del&gt;&lt;/a&gt; Delete the region servers znode after a regions server crash; REVERT (Revision 1330983)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/bin/hbase-daemon.sh&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13263778" author="nkeywal" created="Fri, 27 Apr 2012 16:34:30 +0000"  >&lt;p&gt;I found the issue, and (hopefully) a fix. I will have a new patch middle of next week, I will include the master znode in this one...&lt;/p&gt;</comment>
                            <comment id="13267332" author="nkeywal" created="Thu, 3 May 2012 09:35:16 +0000"  >&lt;p&gt;v4 should be ok.&lt;br/&gt;
I will do another jira for the master.&lt;/p&gt;</comment>
                            <comment id="13267352" author="hadoopqa" created="Thu, 3 May 2012 10:27:32 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525420/5844.v4.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525420/5844.v4.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1743//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1743//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1743//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1743//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1743//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1743//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13268224" author="nkeywal" created="Fri, 4 May 2012 09:37:13 +0000"  >&lt;p&gt;Ready to be committed imho.&lt;/p&gt;</comment>
                            <comment id="13268440" author="stack" created="Fri, 4 May 2012 15:20:02 +0000"  >&lt;p&gt;Committed to trunk.  Thanks for the patch N.&lt;/p&gt;</comment>
                            <comment id="13268530" author="hudson" created="Fri, 4 May 2012 16:50:43 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2848 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2848/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2848/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5844&quot; title=&quot;Delete the region servers znode after a regions server crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5844&quot;&gt;&lt;del&gt;HBASE-5844&lt;/del&gt;&lt;/a&gt; Delete the region servers znode after a regions server crash (Revision 1334028)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/bin/hbase-daemon.sh&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13268906" author="hudson" created="Sat, 5 May 2012 05:59:12 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #192 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/192/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/192/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5844&quot; title=&quot;Delete the region servers znode after a regions server crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5844&quot;&gt;&lt;del&gt;HBASE-5844&lt;/del&gt;&lt;/a&gt; Delete the region servers znode after a regions server crash (Revision 1334028)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/bin/hbase-daemon.sh&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13463401" author="jdcryans" created="Wed, 26 Sep 2012 00:36:44 +0000"  >&lt;p&gt;One thing that worries about this patch is the situation where the pid file is gone and someone tries to start the region server. It happened to me a bunch of times. I tried it with you patch and since it removes ephemeral znode it &lt;em&gt;kills&lt;/em&gt; the region server that&apos;s already running and doesn&apos;t start a new one because the ports are already occupied.&lt;/p&gt;

&lt;p&gt;I&apos;m not sure if this is related to this patch, but we&apos;re now missing info when using the scripts. We used to have:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;su-jdcryans-2:0.94 jdcryans$ ./bin/start-hbase.sh 
localhost: starting zookeeper, logging to /Users/jdcryans/Work/HBase/0.94/bin/../logs/hbase-jdcryans-zookeeper-h-25-185.sfo.stumble.net.out
starting master, logging to /Users/jdcryans/Work/HBase/0.94/bin/../logs/hbase-jdcryans-master-h-25-185.sfo.stumble.net.out
localhost: starting regionserver, logging to /Users/jdcryans/Work/HBase/0.94/bin/../logs/hbase-jdcryans-regionserver-h-25-185.sfo.stumble.net.out
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now we have:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;su-jdcryans-2:trunk-commit jdcryans$ ./bin/start-hbase.sh 

su-jdcryans-2:trunk-commit jdcryans$ 
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13463409" author="stack" created="Wed, 26 Sep 2012 00:46:50 +0000"  >&lt;p&gt;Looking at this w/ j-d, now we no longer do nohup so the parent process can stick around to watch out for the server crash. This make it so now there are two  hbase processes listed per launched daemon.  This is kinda ugly.&lt;/p&gt;

&lt;p&gt;When we have this bash script watching the running java process we verge into the territory normally occupied by babysitters like supervise.   Our parent bash script will always be less than a real babysitter &amp;#8211; supervise, god, etc. &amp;#8211; so maybe we should just have this kill znode as an optional script w/ prescription for how to set it up &amp;#8211; e.g. run znode remover on daemon crash before starting new one (if we want supervise to start a new one).&lt;/p&gt;

&lt;p&gt;I&apos;m thinking we should back this out since there are open questions still.&lt;/p&gt;</comment>
                            <comment id="13463591" author="nkeywal" created="Wed, 26 Sep 2012 07:41:27 +0000"  >&lt;p&gt;Humm.&lt;br/&gt;
The feature is important imho: waiting 30s (at best) before starting a recovery is really nice.&lt;br/&gt;
In a ideal world, ZooKeeper would make this less useful by detecting the dead process sooner, but still it can&apos;t be faster than this. &lt;/p&gt;

&lt;p&gt;Note that znode remover should occur when the process finishes, not before starting a new one. What JD describes seems a bug to me.&lt;/p&gt;




</comment>
                            <comment id="13463899" author="nkeywal" created="Wed, 26 Sep 2012 15:31:45 +0000"  >&lt;p&gt;btw: I&apos;m having a look at this to understand what&apos;s happening.&lt;/p&gt;</comment>
                            <comment id="13463951" author="jdcryans" created="Wed, 26 Sep 2012 16:54:40 +0000"  >&lt;p&gt;To repro: start a local distributed cluster (without hadoop), remove the RS&apos;s pid file in /tmp, try starting a region server again. My guess is that since the port is occupied then the second won&apos;t start but the znode deletion still runs after.&lt;/p&gt;</comment>
                            <comment id="13464093" author="nkeywal" created="Wed, 26 Sep 2012 19:28:33 +0000"  >&lt;p&gt;It&apos;s strange, I didn&apos;t reproduce it. I should, because it seems logical. Will look into it and create jiras.&lt;br/&gt;
Anyway, there are bugs around this scenario. For example, when it fails we now have a new pid file, but this pid does not match the process. This is true in 0.90 as well. If there is no process, the error for the stop (in 0.96) will be &lt;cite&gt;no regionserver to stop because kill -0 of pid 49938 failed with status 1&lt;/cite&gt;. If another process took this id (yes it should not happen often), the kill will succeed.&lt;/p&gt;</comment>
                            <comment id="13506832" author="jdcryans" created="Thu, 29 Nov 2012 21:36:40 +0000"  >&lt;p&gt;Encountered another problem that I think I can link to this jira, I was trying to run HBase from trunk without internet access and like in my Sept 25th comment, I get an empty line after start-hbase.sh but now nothing is running. The .log file doesn&apos;t show anything after logging ulimit and nothing&apos;s in the .out file. After running some bash -x, I was able to figure out that the nohup output was being suppressed. See:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;jdcryans-MBPr:hbase-github jdcryans$ ./bin/start-hbase.sh 
jdcryans-MBPr:hbase-github jdcryans$
jdcryans-MBPr:hbase-github jdcryans$ bash -x ./bin/start-hbase.sh 
... some stuff then
+ /Users/jdcryans/git/hbase-github/bin/hbase-daemon.sh start master
jdcryans-MBPr:hbase-github jdcryans$ bash -x /Users/jdcryans/git/hbase-github/bin/hbase-daemon.sh start master
... more stuff
+ nohup /Users/jdcryans/git/hbase-github/bin/hbase-daemon.sh --config /Users/jdcryans/git/hbase-github/bin/../conf internal_start master
jdcryans-MBPr:hbase-github jdcryans$ nohup /Users/jdcryans/git/hbase-github/bin/hbase-daemon.sh --config /Users/jdcryans/git/hbase-github/bin/../conf internal_start master
appending output to nohup.out
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So now I see that it&apos;s writing to nohup.out, which in turn tells me what really happened:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;Caused by: java.lang.ClassNotFoundException: org.apache.zookeeper.KeeperException
	at java.net.URLClassLoader$1.run(URLClassLoader.java:202)
	at java.security.AccessController.doPrivileged(Native Method)
	at java.net.URLClassLoader.findClass(URLClassLoader.java:190)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:306)
	at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:301)
	at java.lang.ClassLoader.loadClass(ClassLoader.java:247)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Reproing can be done by physically deleting any jar listed in target/cached_classpath.txt. In my case I think the jar wasn&apos;t available because I had no internet connection.&lt;/p&gt;

&lt;p&gt;I wonder what other errors it could hide like this.&lt;/p&gt;</comment>
                            <comment id="13661824" author="siyu_828" created="Mon, 20 May 2013 07:19:23 +0000"  >&lt;p&gt;Hi,stack ,Could you please provide some document about how to use this pach like &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7404&quot; title=&quot;Bucket Cache:A solution about CMS,Heap Fragment and Big Cache on HBASE&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7404&quot;&gt;&lt;del&gt;HBASE-7404&lt;/del&gt;&lt;/a&gt;?&lt;br/&gt;
Where does the core configution HBASE_ZNODE_FILE should be configured?&lt;br/&gt;
Thanks&lt;/p&gt;
</comment>
                            <comment id="13662615" author="siyu_828" created="Tue, 21 May 2013 03:00:11 +0000"  >&lt;p&gt;And I still have another question:in the hbase-daemon.sh file,in the cleanZNode() funtion ,which znode is deleted ?&lt;br/&gt;
Under the normal scenario,when RegionServer starts ,it will create temporary znode on Zookeeper in the path /habse/rs,and what we delete in the cleanZNode() funtion ?&lt;br/&gt;
Thank you!&lt;/p&gt;</comment>
                            <comment id="13775314" author="stack" created="Mon, 23 Sep 2013 18:31:14 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12535794">HBASE-5075</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12553765">HBASE-5926</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12624557">HBASE-7386</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12551766">HBASE-5843</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12523477" name="5844.v1.patch" size="4985" author="nkeywal" created="Fri, 20 Apr 2012 10:44:13 +0000"/>
                            <attachment id="12523811" name="5844.v2.patch" size="4775" author="nkeywal" created="Mon, 23 Apr 2012 16:19:22 +0000"/>
                            <attachment id="12525419" name="5844.v3.patch" size="5671" author="nkeywal" created="Thu, 3 May 2012 09:33:04 +0000"/>
                            <attachment id="12523863" name="5844.v3.patch" size="4776" author="stack" created="Mon, 23 Apr 2012 20:30:36 +0000"/>
                            <attachment id="12525420" name="5844.v4.patch" size="5671" author="nkeywal" created="Thu, 3 May 2012 09:34:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 20 Apr 2012 17:58:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>236574</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hu5z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>102149</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12310230" key="com.atlassian.jira.plugin.system.customfieldtypes:textfield">
                        <customfieldname>Tags</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.96notable</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>