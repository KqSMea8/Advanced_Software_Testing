<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:15:17 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4031/HBASE-4031.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4031] An imbalance result calculated by LoadBalancer</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4031</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;  I found the problem while the cluster couldn&apos;t balance(Around time of 2011-05-24 11:28).One node&apos;s regions count is the double of the other nodes. And it didn&apos;t move regions anymore:&lt;br/&gt;
   Address Start Code Load&lt;br/&gt;
158-1-101-202:20030 1306205409671 requests=0, regions=2593, usedHeap=114, maxHeap=8165 158-1-101-222:20030 1306205940117 requests=0, regions=5841, usedHeap=80, maxHeap=8165 158-1-101-52:20030 1306205417261 requests=0, regions=2622, usedHeap=76, maxHeap=8165 158-1-101-82:20030 1306205415714 requests=0, regions=2633, usedHeap=69, maxHeap=8165 &lt;br/&gt;
Total:  servers: 4   requests=0, regions=13689&lt;/p&gt;


&lt;p&gt;  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3985&quot; title=&quot;Same Region could be picked out twice in LoadBalancer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3985&quot;&gt;&lt;del&gt;HBASE-3985&lt;/del&gt;&lt;/a&gt;-&quot;Same Region could be picked out twice in LoadBalancer&quot; was found by my analysis on this problem.&lt;br/&gt;
  But I&apos;m afraid it&apos;s not the main cause of the problem.&lt;/p&gt;

&lt;p&gt;  There&apos;s one active master, one standby master, four regionservers in our cluster.&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;10:57:41, the standby hamster 222 becomes the active one.&lt;br/&gt;
2011-05-24 10:57:41,314 INFO org.apache.hadoop.hbase.master.HMaster: Master startup proceeding: master failover&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;4 regionservers was registered in 222 one by one. Only one regionserver seemed some time late.&lt;br/&gt;
2011-05-24 10:57:37,533 INFO : Registering server=158-1-101-82,20020,1306205415714, regionCount=3388, userLoad=true&lt;br/&gt;
2011-05-24 10:57:37,537 INFO : Registering server=158-1-101-202,20020,1306205409671, regionCount=3453, userLoad=true&lt;br/&gt;
2011-05-24 10:57:37,598 INFO : Registering server=158-1-101-52,20020,1306205417261, regionCount=3411, userLoad=true&lt;br/&gt;
2011-05-24 10:59:00,408 INFO : Registering server=158-1-101-222,20020,1306205940117, regionCount=0, userLoad=false&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;13134 regions needed to move after rebuildUserRegions(13689 regions in the cluster during the time).&lt;br/&gt;
2011-05-24 10:58:47,534 INFO org.apache.hadoop.hbase.master.AssignmentManager: Failed-over master needs to process 13134 regions in transition&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;All the 13134 regions were opened, regions opened count in each server:&lt;br/&gt;
158-1-101-222,20020,1306205940117    Count: 834&lt;br/&gt;
158-1-101-82,20020,1306205415714    Count: 4093&lt;br/&gt;
158-1-101-202,20020,1306205409671    Count: 4118&lt;br/&gt;
158-1-101-52,20020,1306205417261    Count: 4089&lt;/p&gt;

&lt;p&gt;&amp;gt;&amp;gt;The nearest balancer calculate results:&lt;br/&gt;
2011-05-24 11:12:11,076 INFO org.apache.hadoop.hbase.master.LoadBalancer: Calculated a load balance in 19ms. Moving 5012 regions off of 3 overloaded servers onto 1 less loaded servers&lt;/p&gt;

&lt;p&gt;&quot;5012&quot; is an unimaginable number here, for it is larger than the average number &quot;3424.5&quot;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12511514">HBASE-4031</key>
            <summary>An imbalance result calculated by LoadBalancer</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="jeason">Jieshan Bean</reporter>
                        <labels>
                    </labels>
                <created>Sat, 25 Jun 2011 00:54:29 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:55 +0000</updated>
                            <resolved>Thu, 7 Jul 2011 01:59:51 +0000</resolved>
                                    <version>0.90.3</version>
                                    <fixVersion>0.90.4</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13054797" author="jeason" created="Sat, 25 Jun 2011 01:55:10 +0000"  >&lt;p&gt;For the original log fils is too big, I just attached some fragments of the full logs.&lt;/p&gt;</comment>
                            <comment id="13055119" author="yuzhihong@gmail.com" created="Sun, 26 Jun 2011 17:01:39 +0000"  >&lt;p&gt;Registration of the 3 RS (including 158-1-101-82:20020) wasn&apos;t in HMaster222.log&lt;br/&gt;
I noticed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2011-05-24 10:59:01,213 DEBUG org.apache.hadoop.hbase.master.ServerManager: New connection to 158-1-101-222,20020,1306205940117
2011-05-24 10:59:11,067 WARN org.apache.hadoop.hbase.client.HConnectionManager$HConnectionImplementation: RemoteException connecting to RS
org.apache.hadoop.ipc.RemoteException: org.apache.hadoop.hbase.ipc.ServerNotRunningException: Server is not running yet
        at org.apache.hadoop.hbase.ipc.HBaseServer$Handler.run(HBaseServer.java:1038)
...
2011-05-24 10:59:11,070 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: No previous transition plan was found (or we are ignoring an existing plan) &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; hello,200040,1305944346902.2ce947cccbfe15b7210dd21d0cc2c515. so generated a random one; hri=hello,200040,1305944346902.2ce947cccbfe15b7210dd21d0cc2c515., src=, dest=158-1-101-82,20020,1306205415714; 4 (online=4, exclude=serverName=158-1-101-222,20020,1306205940117, load=(requests=0, regions=0, usedHeap=0, maxHeap=0)) available servers
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;There is only 1 line from LoadBalancer in master log. If this scenario can be reproduced, please add more DEBUG log before line 251 in balanceCluster()&lt;/p&gt;

&lt;p&gt;I guess some regions were doubly counted on 158-1-101-222,20020&lt;/p&gt;</comment>
                            <comment id="13055259" author="jeason" created="Mon, 27 Jun 2011 00:57:36 +0000"  >&lt;p&gt;This scenario cann&apos;t be reproduced easily. I have not reproduce it again.&lt;br/&gt;
About the Registration logs, I didn&apos;t put them into the attachment. &lt;br/&gt;
&amp;lt;noformat&amp;gt;&lt;br/&gt;
2011-05-24 10:57:37,533 INFO : Registering server=158-1-101-82,20020,1306205415714, regionCount=3388, userLoad=true&lt;br/&gt;
2011-05-24 10:57:37,537 INFO : Registering server=158-1-101-202,20020,1306205409671, regionCount=3453, userLoad=true&lt;br/&gt;
2011-05-24 10:57:37,598 INFO : Registering server=158-1-101-52,20020,1306205417261, regionCount=3411, userLoad=true&lt;br/&gt;
2011-05-24 10:59:00,408 INFO : Registering server=158-1-101-222,20020,1306205940117, regionCount=0, userLoad=false&lt;br/&gt;
&amp;lt;noformat&amp;gt;&lt;/p&gt;

&lt;p&gt;The registraction happened before the first line of the logs :&quot;2011-05-24 10:57:41,314 INFO org.apache.hadoop.hbase.master.HMaster: Master startup proceeding: master failover&quot;.&lt;/p&gt;

&lt;p&gt;Some regions were indeed doubly counted. For it has been mentioned in the related issue:&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3985&quot; title=&quot;Same Region could be picked out twice in LoadBalancer&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3985&quot;&gt;&lt;del&gt;HBASE-3985&lt;/del&gt;&lt;/a&gt;. But only s around 500 region.&lt;/p&gt;

&lt;p&gt;Sorry for bring you the confusion, and thanks for dig in this issue.&lt;/p&gt;
</comment>
                            <comment id="13055267" author="yuzhihong@gmail.com" created="Mon, 27 Jun 2011 01:07:07 +0000"  >&lt;p&gt;RS 222 failed over to new master @ 2011-05-24 10:59:10&lt;/p&gt;

&lt;p&gt;I traced region &apos;test4,011980,1306152907050.af05fe4e3f56932027c929917af664aa.&apos; in RS log. The region was opened, closed and opened again.&lt;/p&gt;</comment>
                            <comment id="13055271" author="yuzhihong@gmail.com" created="Mon, 27 Jun 2011 01:14:15 +0000"  >&lt;p&gt;Looks like namenode failed over as well:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2011-05-24 10:59:10,584 INFO org.apache.hadoop.hdfs.DFSClient: DFSClient has connected to the active namenode: /158.1.101.222:9000
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;If so, I think the backup master should use a node where region server isn&apos;t running. In case of master failover, the node wouldn&apos;t be able to handle namenode, failover Master and RS at the same time.&lt;/p&gt;</comment>
                            <comment id="13055282" author="jeason" created="Mon, 27 Jun 2011 01:44:26 +0000"  >&lt;p&gt;The master failover was due to killing the original hmaster manually. And during the time, RS222 had aborted(It restarted later)&lt;/p&gt;
</comment>
                            <comment id="13058555" author="yuzhihong@gmail.com" created="Fri, 1 Jul 2011 13:56:43 +0000"  >&lt;p&gt;I think &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4053&quot; title=&quot;Most of the regions were added into AssignmentManager#servers twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4053&quot;&gt;&lt;del&gt;HBASE-4053&lt;/del&gt;&lt;/a&gt; reveals the cause for this issue.&lt;/p&gt;</comment>
                            <comment id="13060993" author="jeason" created="Thu, 7 Jul 2011 01:58:50 +0000"  >&lt;p&gt;Yes, this is the same issue with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4053&quot; title=&quot;Most of the regions were added into AssignmentManager#servers twice&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4053&quot;&gt;&lt;del&gt;HBASE-4053&lt;/del&gt;&lt;/a&gt;, though the scenario is not the same.&lt;br/&gt;
So I think we can invalid this issue.&lt;/p&gt;</comment>
                            <comment id="15016353" author="lars_francke" created="Fri, 20 Nov 2015 11:54:55 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12483800" name="HMaster222.rar" size="1750707" author="jeason" created="Sat, 25 Jun 2011 01:42:51 +0000"/>
                            <attachment id="12483801" name="HRegionServer222.rar" size="813541" author="jeason" created="Sat, 25 Jun 2011 01:54:58 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 26 Jun 2011 17:01:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27138</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hp2v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101325</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>