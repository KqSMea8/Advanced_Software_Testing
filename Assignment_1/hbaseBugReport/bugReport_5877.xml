<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:31:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5877/HBASE-5877.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5877] When a query fails because the region has moved, let the regionserver return the new address to the client</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5877</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This is mainly useful when we do a rolling restart. This will decrease the load on the master and the network load.&lt;/p&gt;

&lt;p&gt;Note that a region is not immediately opened after a close. So:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;it seems preferable to wait before retrying on the other server. An optimisation would be to have an heuristic depending on when the region was closed.&lt;/li&gt;
	&lt;li&gt;during a rolling restart, the server moves the regions then stops. So we may have failures when the server is stopped, and this patch won&apos;t help.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;The implementation in the first patch does:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;on the region move, there is an added parameter on the regionserver#close to say where we are sending the region&lt;/li&gt;
	&lt;li&gt;the regionserver keeps a list of what was moved. Each entry is kept 100 seconds.&lt;/li&gt;
	&lt;li&gt;the regionserver sends a specific exception when it receives a query on a moved region. This exception contains the new address.&lt;/li&gt;
	&lt;li&gt;the client analyses the exeptions and update its cache accordingly...&lt;/li&gt;
&lt;/ul&gt;




</description>
                <environment></environment>
        <key id="12552710">HBASE-5877</key>
            <summary>When a query fails because the region has moved, let the regionserver return the new address to the client</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nkeywal">Nicolas Liochon</assignee>
                                    <reporter username="nkeywal">Nicolas Liochon</reporter>
                        <labels>
                    </labels>
                <created>Wed, 25 Apr 2012 19:12:39 +0000</created>
                <updated>Mon, 23 Sep 2013 18:45:07 +0000</updated>
                            <resolved>Fri, 11 May 2012 10:30:53 +0000</resolved>
                                    <version>0.95.2</version>
                                    <fixVersion>0.95.0</fixVersion>
                                    <component>Client</component>
                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="13261972" author="nkeywal" created="Wed, 25 Apr 2012 19:21:10 +0000"  >&lt;p&gt;v1. On an old trunk, so it&apos;s just to give an overview. Includes some bits of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5844&quot; title=&quot;Delete the region servers znode after a regions server crash&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5844&quot;&gt;&lt;del&gt;HBASE-5844&lt;/del&gt;&lt;/a&gt; as well.&lt;/p&gt;

&lt;p&gt;There are 3 workarounds in the implementation:&lt;br/&gt;
1) As a ServerName is not serializable we use the String dedicated to this kind of issue. Acceptable I think.&lt;br/&gt;
2) hadoop.ipc serialization of exception is based on the #getMessage. So we have to parse it internally. It&apos;s not visisble to the exception user. Still acceptable (? &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
3) The code to manage the error in the client package is quite complex. We have the exception at the very beginning, and then it&apos;s checked again, but we don&apos;t have the real exception anymore. I used a new &quot;updateList&quot; to make it works, I&apos;m looking for another solution here...&lt;/p&gt;</comment>
                            <comment id="13262199" author="zhihyu@ebaysf.com" created="Wed, 25 Apr 2012 22:23:24 +0000"  >&lt;p&gt;For RegionMovedException.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tmpHostname = &lt;span class=&quot;code-quote&quot;&gt;&quot;nohostname&quot;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think the above could potentially be a host name &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception ignored) {
+      LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Can&apos;t parse the hostname and the port from &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; string: &quot;&lt;/span&gt; + s + &lt;span class=&quot;code-quote&quot;&gt;&quot;, &quot;&lt;/span&gt;+
+        &lt;span class=&quot;code-quote&quot;&gt;&quot;Continuing&quot;&lt;/span&gt;);
+    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can we mark the failure and make this RegionMovedException behave the same as NotServingRegionException ?&lt;br/&gt;
For updateCachedLocations(), please put explanation for parameter on the same line as the parameter:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+     * @param row  - row and tableName can be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; id hrl is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+            LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed all from &quot;&lt;/span&gt; + loc, e);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;Failed all&apos; -&amp;gt; &apos;Failed call&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (resp == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
+            &lt;span class=&quot;code-comment&quot;&gt;// Entire server failed
&lt;/span&gt;+            LOG.fatal(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed all &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; server: &quot;&lt;/span&gt; + loc.getHostnamePort() +
+              &lt;span class=&quot;code-quote&quot;&gt;&quot;, removing from cache&quot;&lt;/span&gt;);
+            &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
+          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;How is the server removed from cache since I see &apos;continue&apos; above ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+              } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
+                &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (numRetries == 1)
+                  LOG.fatal(&lt;span class=&quot;code-quote&quot;&gt;&quot;step 4 got result &quot;&lt;/span&gt; + regionResult.getFirst() + &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt; + regionResult.getSecond());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Why is the above fatal (regionResult != null) ? Step 4 appears in a comment below the above code. Should the above say step 3 ?&lt;/p&gt;

&lt;p&gt;Please increase the VERSION of HRegionInterface&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * @param destServerName: server name on which the server will be moved
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;which the server&apos; -&amp;gt; &apos;which the region&apos;&lt;/p&gt;

&lt;p&gt;For ServerManager.sendRegionClose(), please add javadoc for destServerName param.&lt;br/&gt;
For HRegionServer.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Closing region &quot;&lt;/span&gt;+region.getRegionName()+&lt;span class=&quot;code-quote&quot;&gt;&quot;, moving to &quot;&lt;/span&gt;+sn.getServerName() );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Is it possible that destServerName is null ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; ServerName getMovedRegion(&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; encodedRegionName) {
+    LOG.fatal(&lt;span class=&quot;code-quote&quot;&gt;&quot;Called getMovedRegion &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &quot;&lt;/span&gt;+encodedRegionName+&lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;+ movedRegions.size()+ &lt;span class=&quot;code-quote&quot;&gt;&quot; &quot;&lt;/span&gt;+movedRegions);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please change the above to debug log.&lt;/p&gt;</comment>
                            <comment id="13262462" author="nkeywal" created="Thu, 26 Apr 2012 08:25:34 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can we mark the failure and make this RegionMovedException behave the same as NotServingRegionException ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;For updateCachedLocations(), please put explanation for parameter on the same line as the parameter:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&apos;Failed all&apos; -&amp;gt; &apos;Failed call&apos;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It&apos;s an existing comment that we can find again later in the code. It really means &quot;failed all&quot;: all the queries on this server failed. I don&apos;t mind changing it to something better, but I think we should keep the &quot;all&quot;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;&apos;which the server&apos; -&amp;gt; &apos;which the region&apos;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Please increase the VERSION of HRegionInterface&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;How is the server removed from cache since I see &apos;continue&apos; above ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;That&apos;s what makes this code complex and difficult to change: the error is actually managed later, when we don&apos;t have the real exception anymore.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;For ServerManager.sendRegionClose(), please add javadoc for destServerName param.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is it possible that destServerName is null ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Safety checks added.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Please change the above to debug log. &amp;amp;&amp;amp; Why is the above fatal (regionResult != null) ? Step 4 appears in a comment below the above code. Should the above say step 3 ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Bad logs fixed.&lt;/p&gt;</comment>
                            <comment id="13262714" author="zhihyu@ebaysf.com" created="Thu, 26 Apr 2012 16:26:46 +0000"  >&lt;p&gt;@N:&lt;br/&gt;
I think the following validation in real cluster would illustrate the benefit of this feature:&lt;br/&gt;
For given table, select a region server and note the row key ranges hosted by one region on the region server. Direct client load to this region.&lt;br/&gt;
Issue the following command in shell: &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  hbase&amp;gt; move &apos;ENCODED_REGIONNAME&apos;, &apos;SERVER_NAME&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;at time T.&lt;/p&gt;

&lt;p&gt;Difference in client response to region migration around time T with and without the patch would be interesting.&lt;/p&gt;</comment>
                            <comment id="13262717" author="nkeywal" created="Thu, 26 Apr 2012 16:32:22 +0000"  >&lt;p&gt;Note that I&apos;m currently rewriting the patch, as it conflicts with the protobuf stuff that was committed recently... But the logic hasn&apos;t changed.&lt;/p&gt;

&lt;p&gt;@ted What we&apos;re saving in the current implementation is a call to the master. It can be interesting in itself if the region moves is used by a lot of clients. We could do better by letting the client know that the region is now fully available somewhere else and that there is no need to wait before retrying. But right now the region server only knows that the region is closed and moved to another server. It doesn&apos;t know if the region is opened yet. We could have this by adding the info in zk, but it would increase the zk load...&lt;/p&gt;</comment>
                            <comment id="13262731" author="zhihyu@ebaysf.com" created="Thu, 26 Apr 2012 16:50:00 +0000"  >&lt;p&gt;@N:&lt;br/&gt;
If the testing result is favorable, I think Lars may want it in 0.94 as well.&lt;br/&gt;
I think making this feature functional in 0.94 cluster would be a good start.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;We could have this by adding the info in zk&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;A separate discussion should be started w.r.t. the above. This would shift load imposed by clients from master to zk quorum.&lt;/p&gt;</comment>
                            <comment id="13262820" author="stack" created="Thu, 26 Apr 2012 18:22:07 +0000"  >&lt;p&gt;@N This patch will benefit any move, not just rolling restart, right?&lt;/p&gt;

&lt;p&gt;Here are a quick couple of comments on the patch.&lt;/p&gt;

&lt;p&gt;I like addition of RegionMovedException.&lt;/p&gt;

&lt;p&gt;Convention is to capitalize static defines: &apos;+  private static final String hostField = &quot;hostname=&quot;;&apos; so it should be HOSTFIELD.&lt;/p&gt;

&lt;p&gt;Its super ugly that you have to parse exception message to get exception data member fields... but thats not your fault.&lt;/p&gt;

&lt;p&gt;Please keep the style of the surrounding code.  This kinda thing is unconventional:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void updateCachedLocations(
+      Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; updateHistory,
+      HRegionLocation hrl,
+      &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; t) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ugh on how ugly it is updating cache.  Again, not your fault.&lt;/p&gt;

&lt;p&gt;Ted suggests updating interface version.  Maybe don&apos;t.  If you do, you can&apos;t get this into a 0.94.1, etc.&lt;/p&gt;

&lt;p&gt;I don&apos;t see changes to make use of this new functionality?  I&apos;d expect the balancer in master to make use of it?&lt;/p&gt;</comment>
                            <comment id="13263140" author="nkeywal" created="Thu, 26 Apr 2012 20:59:32 +0000"  >&lt;blockquote&gt;&lt;p&gt;This patch will benefit any move, not just rolling restart, right?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, but as there is a wait time between two tries, I think the benefit will be minimal vs. the wait time for a single client. I could add an heuristic like if region was closed more than 2 seconds ago, consider that it&apos;s now available on the new server and don&apos;t sleep before the next retry. That could lead of having more network messages if the rule is wrong (and the rule will be wrong when the system is overloaded), and it will add some complexity to the client code. Having the real status of the region would solve this. &lt;/p&gt;

&lt;p&gt;Anyway, with the dev already done to cut the link between master &amp;amp; clients, it can help to save a reconnect to master. And during a rolling restart with regions moving everywhere, I think it will make a real difference.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;I don&apos;t see changes to make use of this new functionality? I&apos;d expect the balancer in master to make use of it?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, it&apos;s the changes in AssignmentManager: the changes are in the patch, but are quite small at the end: basically:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;-    unassign(plan.getRegionInfo());
+    unassign(plan.getRegionInfo(), false, plan.getDestination());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I still need to manage the case when the destination is not specified at the beginning.&lt;/p&gt;</comment>
                            <comment id="13266656" author="nkeywal" created="Wed, 2 May 2012 15:57:03 +0000"  >&lt;p&gt;Generated with protobuf 2.4.1&lt;/p&gt;

&lt;p&gt;Here are the things I&apos;m not a big fan, but for which I don&apos;t have a better solution:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;the move management in the client code: I think it&apos;s possible to change the way we manage error (don&apos;t wait for all results before retrying), but that would be for another JIRA&lt;/li&gt;
	&lt;li&gt;the destination is the closeRegion interface is a kind of interface hijacking. Other options would be:&lt;/li&gt;
	&lt;li&gt;sharing the region state in zookeeper&lt;/li&gt;
	&lt;li&gt;letting the regionserver calls the master to get the new server. On paper this would be more efficient than a client -&amp;gt; master call. In both cases we could consider that the client should not connect to the master except for cluster administration (create table, split regin; ...). That would increase global reliability. That&apos;s for another discussion as well I think.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;Here is what I plan to do in the final version&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;move the handler functional code into a function in HRegionServer: this would allow to have the function addToMovedRegion as private instead of public.&lt;/li&gt;
	&lt;li&gt;Change all the CloseRegionHandler to take a RegionServer instead of a server? I&apos;m not really keen on adding a class RegionServerServices, but may be I should?&lt;/li&gt;
	&lt;li&gt;Manage the case when the destination is not specified at the beginning of the move (may be in a different Jira if it&apos;s not simple)...&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All the previous comment should have been taken into account.&lt;/p&gt;</comment>
                            <comment id="13266785" author="hadoopqa" created="Wed, 2 May 2012 18:15:54 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525304/5877.v6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525304/5877.v6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 2 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.util.TestMergeTable&lt;br/&gt;
                  org.apache.hadoop.hbase.io.encoding.TestLoadAndSwitchEncodeOnDisk&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestMultiParallel&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestMasterFailover&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestSplitTransactionOnCluster&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestZKBasedOpenCloseRegion&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestRowProcessorEndpoint&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestFromClientSide3&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestRollingRestart&lt;br/&gt;
                  org.apache.hadoop.hbase.util.TestMiniClusterLoadEncoded&lt;br/&gt;
                  org.apache.hadoop.hbase.avro.TestAvroServer&lt;br/&gt;
                  org.apache.hadoop.hbase.thrift.TestThriftServerCmdLine&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1724//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1724//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1724//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1724//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1724//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1724//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13266827" author="nkeywal" created="Wed, 2 May 2012 19:08:16 +0000"  >&lt;p&gt;I have the same locally, so it&apos;s likely my patch...&lt;/p&gt;</comment>
                            <comment id="13267751" author="nkeywal" created="Thu, 3 May 2012 19:57:09 +0000"  >&lt;p&gt;v12, should be final.&lt;/p&gt;

&lt;p&gt;1) ServerName is used everywhere in the interface, thanks to protobuf&lt;br/&gt;
2) hadoop.ipc serialization of exception is based on the #getMessage. So we have to parse it internally. It&apos;s not visisble to the exception user.&lt;br/&gt;
3) The code to manage the error in the client package is quite complex. We have the exception at the very beginning, and then it&apos;s checked again, but we don&apos;t have the real exception anymore. I used a new &quot;historyList&quot; to make it works. There is another JIRA for other improvement, in which I could get rid of this (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5924&quot; title=&quot;In the client code, don&amp;#39;t wait for all the requests to be executed before resubmitting a request in error.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5924&quot;&gt;&lt;del&gt;HBASE-5924&lt;/del&gt;&lt;/a&gt;)&lt;br/&gt;
4) Generated with protobuf 2.4.1&lt;br/&gt;
5) The destination is the closeRegion interface is a kind of interface hijacking. Other options would be:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;sharing the region state in zookeeper&lt;/li&gt;
	&lt;li&gt;letting the regionserver calls the master to get the new server. On paper this would be more efficient than a client -&amp;gt; master call. In both cases we could consider that the client should not connect to the master except for cluster administration (create table, split regin; ...). That would increase global reliability. That&apos;s for another discussion as well I think.&lt;br/&gt;
6) RegionServerServices has been modified to set a destination when removing a region from the online regions.&lt;br/&gt;
7) In another JIRA I will manage the case when the destination is not specified when calling the move function.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13267787" author="stack" created="Thu, 3 May 2012 20:44:09 +0000"  >&lt;p&gt;You don&apos;t want to have RegionMovedException carry a ServerName#toString instead of host and port?  Or it doesn&apos;t make sense when our cached region exceptions are keyed by hostname+port only?&lt;/p&gt;

&lt;p&gt;Is this a bug fix?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@@ -1910,6 +1989,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class HConnectionManager {
             }
           } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (ExecutionException e) {
             LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Failed all from &quot;&lt;/span&gt; + loc, e);
+            updateCachedLocations(updateHistory, loc, e);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Put the history of moved regions out into its own class?&lt;/p&gt;

&lt;p&gt;Don&apos;t presize this I&apos;d say:&lt;/p&gt;

&lt;p&gt;+  private static final long TIMEOUT_REGION_MOVED = (2L * 60L * 1000L);&lt;/p&gt;

&lt;p&gt;Stuff is lazily cleared from movedRegions?  Should we have a cleaner come visit occasionally?&lt;/p&gt;

&lt;p&gt;Patch looks fine to me.  Nice fat test.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;5) The destination is the closeRegion interface is a kind of interface hijacking. Other options would be:&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Why you say the above?  When we protobuf it, it&apos;ll just be an option so it shouldn&apos;t be too bad?&lt;/p&gt;

&lt;p&gt;The HCM stuff is ugly but thats not your fault.&lt;/p&gt;
</comment>
                            <comment id="13267794" author="hadoopqa" created="Thu, 3 May 2012 21:01:51 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525508/5877.v12.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525508/5877.v12.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestMultiParallel&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1749//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1749//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1749//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1749//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1749//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1749//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13267841" author="zhihyu@ebaysf.com" created="Thu, 3 May 2012 21:47:04 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        HRegionLocation newHrl = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HRegionLocation(hrl.getRegionInfo(), hostname, port);
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (newHrl == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; ){
+          &lt;span class=&quot;code-comment&quot;&gt;// Should not happened. Just in &lt;span class=&quot;code-keyword&quot;&gt;case&lt;/span&gt;.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Under what condition would newHrl be null above ?&lt;br/&gt;
Please remove the space between newHrl and &apos;)&apos; below:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        cacheLocation(hrl.getRegionInfo().getTableName(), newHrl  );
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For updateCachedLocations():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        hrl : getCachedLocation(tableName, row.getRow()));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Would the above code result in NPE since I see the following in javadoc:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+     * @param row  - can be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; hrl is not &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;More review comments to follow.&lt;/p&gt;</comment>
                            <comment id="13267879" author="zhihyu@ebaysf.com" created="Thu, 3 May 2012 22:19:40 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Set&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt; updateHistory = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;(100);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Since updateCachedLocations() is used to handle exception, the presizing above may not be needed.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;(server, rsServices, regionInfo, abort, zk, versionOfClosingNode, eventType, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
+  }
+
+    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; CloseRegionHandler(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Server server,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The indentation of CloseRegionHandler() above is off.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-comment&quot;&gt;// This map will contains all the regions that we closed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; a move.
&lt;/span&gt;+  &lt;span class=&quot;code-comment&quot;&gt;//  We add the time it was moved as we don&apos;t want to keep a too old information&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;will contains&apos; -&amp;gt; &apos;will contain&apos;. &apos;keep a too old&apos; -&amp;gt; &apos;keep too old&apos;.&lt;/p&gt;

&lt;p&gt;This is a very useful feature. Good work, N.&lt;/p&gt;</comment>
                            <comment id="13268199" author="nkeywal" created="Fri, 4 May 2012 08:06:03 +0000"  >&lt;p&gt;@stack&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;You don&apos;t want to have RegionMovedException carry a ServerName#toString instead of host and port?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think it&apos;s safer this way, as I have to parse the string afterward. Otherwise, if someone modifies ServerName#toString he will break the parsing in RegionMovedException, a class he may never have heard of (yes, it will break the unit test &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;)&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is this a bug fix?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Unfortunately, it&apos;s a feature. The error management is duplicated, and I have to manage both cases, because we don&apos;t have the exception when we come back to the result later in the code.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Put the history of moved regions out into its own class?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You&apos;re right, it would be better. Wil do.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Don&apos;t presize this I&apos;d say: private static final long TIMEOUT_REGION_MOVED = (2L * 60L * 1000L);&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You would prefer a configurable value? &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;Stuff is lazily cleared from movedRegions? Should we have a cleaner come visit occasionally?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Aggreed, it would be better with a cleaner. Will do as well.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Why you say the above? When we protobuf it, it&apos;ll just be an option so it shouldn&apos;t be too bad?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah, if it was too bad I would not have proposed it &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;. It&apos;s an imperfection to accept I think. We would not have it if we share the regions state within the cluster with ZK.&lt;/p&gt;

&lt;p&gt;@ted&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Under what condition would newHrl be null above ?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Oops. Refactoring error. Removed.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Please remove the space between newHrl and &apos;)&apos; below:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Done.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Would the above code result in NPE since I see the following in javadoc:&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It should not happen because we test hrl value before. But I added a check on the arguments to make it safer.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Since updateCachedLocations() is used to handle exception, the presizing above may not be needed.&lt;/p&gt;&lt;/blockquote&gt;

&lt;blockquote&gt;&lt;p&gt;Since updateCachedLocations() is used to handle exception, the presizing above may not be needed.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yeah, I sized it thinking: if we&apos;re doing a rolling restart we may have 100 regions with a wrong location if we&apos;re really unlucky. As it small, any solution would work here, but I prefer to have the size explicitly set, as it says &quot;I though about it, that&apos;s a reasonable size&quot;. I added a comment however. &lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;The indentation of CloseRegionHandler() above is off.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fixed.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;&apos;will contains&apos; -&amp;gt; &apos;will contain&apos;. &apos;keep a too old&apos; -&amp;gt; &apos;keep too old&apos;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Fixed.&lt;/p&gt;
</comment>
                            <comment id="13268649" author="hadoopqa" created="Fri, 4 May 2012 19:29:22 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525660/5877.v15.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525660/5877.v15.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestMultiParallel&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1770//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1770//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1770//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1770//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1770//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1770//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13268678" author="zhihyu@ebaysf.com" created="Fri, 4 May 2012 20:21:41 +0000"  >&lt;p&gt;I can reproduce the TestMultiParallel failure:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
testFlushCommitsNoAbort(org.apache.hadoop.hbase.client.TestMultiParallel)  Time elapsed: 1.36 sec  &amp;lt;&amp;lt;&amp;lt; ERROR!
java.lang.StackOverflowError
  at org.apache.hadoop.hbase.RegionMovedException.find(RegionMovedException.java:91)
  at org.apache.hadoop.hbase.RegionMovedException.find(RegionMovedException.java:108)
  at org.apache.hadoop.hbase.RegionMovedException.find(RegionMovedException.java:108)
  at org.apache.hadoop.hbase.RegionMovedException.find(RegionMovedException.java:108)
  at org.apache.hadoop.hbase.RegionMovedException.find(RegionMovedException.java:108)
  at org.apache.hadoop.hbase.RegionMovedException.find(RegionMovedException.java:108)
  at org.apache.hadoop.hbase.RegionMovedException.find(RegionMovedException.java:108)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13268693" author="zhihyu@ebaysf.com" created="Fri, 4 May 2012 20:44:56 +0000"  >&lt;p&gt;Patch v16 is able to pass TestMultiParallel.&lt;/p&gt;

&lt;p&gt;See the following link for the reason of infinite recursion:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://grepcode.com/file/repository.cloudera.com/content/repositories/releases/com.cloudera.hadoop/hadoop-core/0.20.2-737/org/apache/hadoop/ipc/RemoteException.java#RemoteException.unwrapRemoteException%28%29&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://grepcode.com/file/repository.cloudera.com/content/repositories/releases/com.cloudera.hadoop/hadoop-core/0.20.2-737/org/apache/hadoop/ipc/RemoteException.java#RemoteException.unwrapRemoteException%28%29&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13268701" author="nkeywal" created="Fri, 4 May 2012 20:54:45 +0000"  >&lt;p&gt;thank you Ted. It&apos;s strange, it though it worked locally. May be this test&lt;br/&gt;
was hung and was not reported as an error. Thank you anyway.&lt;/p&gt;

</comment>
                            <comment id="13268734" author="hadoopqa" created="Fri, 4 May 2012 21:50:28 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525676/5877-v16.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525676/5877-v16.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestMultiParallel&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1773//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1773//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1773//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1773//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1773//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1773//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13268738" author="zhihyu@ebaysf.com" created="Fri, 4 May 2012 21:56:30 +0000"  >&lt;p&gt;I forgot to add the check in one place.&lt;/p&gt;

&lt;p&gt;Trying v17.&lt;/p&gt;</comment>
                            <comment id="13268778" author="hadoopqa" created="Fri, 4 May 2012 22:52:17 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525684/5877-v17.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525684/5877-v17.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1775//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1775//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1775//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1775//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1775//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1775//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13270212" author="nkeywal" created="Tue, 8 May 2012 05:13:43 +0000"  >&lt;p&gt;I didn&apos;t find the test in error. Could be committed imho.&lt;/p&gt;</comment>
                            <comment id="13270245" author="stack" created="Tue, 8 May 2012 06:16:54 +0000"  >&lt;p&gt;Retry&lt;/p&gt;</comment>
                            <comment id="13270250" author="hadoopqa" created="Tue, 8 May 2012 06:23:08 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525963/5877-v17.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525963/5877-v17.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1793//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1793//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13270263" author="nkeywal" created="Tue, 8 May 2012 06:38:22 +0000"  >&lt;p&gt;Ok... I will do the merge and provide another patch today...&lt;/p&gt;</comment>
                            <comment id="13270866" author="nkeywal" created="Tue, 8 May 2012 21:50:22 +0000"  >&lt;p&gt;Hopefully I didn&apos;t break anything while doing the merge. Local tests are ok. I included Ted&apos;s fix.&lt;/p&gt;</comment>
                            <comment id="13270913" author="hadoopqa" created="Tue, 8 May 2012 22:52:35 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12526047/5877.v18.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12526047/5877.v18.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestSplitTransactionOnCluster&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestReplication&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1801//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1801//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1801//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1801//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1801//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1801//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13271256" author="hadoopqa" created="Wed, 9 May 2012 09:50:58 +0000"  >&lt;p&gt;+1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12526123/5877.v18.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12526123/5877.v18.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    +1 hadoop23.  The patch compiles against the hadoop 0.23.x profile.&lt;/p&gt;

&lt;p&gt;    +1 javadoc.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    +1 findbugs.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    +1 core tests.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1812//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1812//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1812//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1812//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1812//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1812//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13271590" author="nkeywal" created="Wed, 9 May 2012 16:57:56 +0000"  >&lt;p&gt;Seems to be ready for a commit :-]&lt;/p&gt;</comment>
                            <comment id="13271603" author="zhihyu@ebaysf.com" created="Wed, 9 May 2012 17:08:15 +0000"  >&lt;p&gt;Integrated to trunk.&lt;/p&gt;

&lt;p&gt;Thanks for the patch, N.&lt;/p&gt;

&lt;p&gt;Thanks for the review, Stack.&lt;/p&gt;</comment>
                            <comment id="13271630" author="ram_krish" created="Wed, 9 May 2012 17:47:18 +0000"  >&lt;p&gt;Just saw the intent behind this JIRA. It is very important and a good feature.  You have done a lot in this but the JIRA says it is Minor &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;It doesn&apos;t know if the region is opened yet. We could have this by adding the info in zk, but it would increase the zk load...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Now how does the updateCachelocation help here.  If for some reason the opening of the region is not yet done and if the client gets RegionMovedException the client will try to contact the RS thinking the region got moved to it.  &lt;br/&gt;
Thanks N.&lt;/p&gt;</comment>
                            <comment id="13271651" author="nkeywal" created="Wed, 9 May 2012 18:13:59 +0000"  >&lt;blockquote&gt;&lt;p&gt;Now how does the updateCachelocation help here. If for some reason the opening of the region is not yet done and if the client gets RegionMovedException the client will try to contact the RS thinking the region got moved to it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, exactly. That&apos;s why I kept the sleep in the client code even for this RegionMoved. We could optimize this by adding a timestamps, with an heuristic like: &quot;we give two seconds for the region to move after it&apos;s closed on the origin server&quot;. Sharing the region state in ZK would be a simpler option, as we would know if the region has moved or not.&lt;/p&gt;</comment>
                            <comment id="13271656" author="hudson" created="Wed, 9 May 2012 18:17:32 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2858 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2858/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2858/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5877&quot; title=&quot;When a query fails because the region has moved, let the regionserver return the new address to the client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5877&quot;&gt;&lt;del&gt;HBASE-5877&lt;/del&gt;&lt;/a&gt; When a query fails because the region has moved, let the regionserver return the new address to the client (N Keywal) (Revision 1336301)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/RegionMovedException.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/protobuf/ProtobufUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/protobuf/RequestConverter.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/protobuf/generated/AdminProtos.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/protobuf/Admin.proto&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestHCM.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13272116" author="hudson" created="Thu, 10 May 2012 06:07:05 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #197 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/197/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/197/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5877&quot; title=&quot;When a query fails because the region has moved, let the regionserver return the new address to the client&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5877&quot;&gt;&lt;del&gt;HBASE-5877&lt;/del&gt;&lt;/a&gt; When a query fails because the region has moved, let the regionserver return the new address to the client (N Keywal) (Revision 1336301)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/RegionMovedException.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/ServerManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/protobuf/ProtobufUtil.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/protobuf/RequestConverter.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/protobuf/generated/AdminProtos.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/OnlineRegions.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/SplitTransaction.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/protobuf/Admin.proto&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestHCM.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/master/MockRegionServer.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/util/MockRegionServerServices.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13273137" author="hadoopqa" created="Fri, 11 May 2012 09:32:14 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12526501/5877.v18.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12526501/5877.v18.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1845//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1845//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13273151" author="nkeywal" created="Fri, 11 May 2012 10:09:42 +0000"  >&lt;p&gt;Strange, the status is &quot;failure&quot;, but actually the code is available in the trunk (which is good, it saves another merge)&lt;/p&gt;</comment>
                            <comment id="13273157" author="ram_krish" created="Fri, 11 May 2012 10:28:54 +0000"  >&lt;p&gt;The code is committed.  If the test failures are not related to this, you can resolve this issue N.&lt;/p&gt;</comment>
                            <comment id="13506935" author="jdcryans" created="Thu, 29 Nov 2012 23:29:41 +0000"  >&lt;p&gt;Nicolas,&lt;/p&gt;

&lt;p&gt;Do you think this log message could be removed?&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;12/11/29 15:17:36 INFO client.HConnectionManager$HConnectionImplementation: Region TestTable,0001966229,1354231005211.1bbba78dda968874d2981c322ed3319f. moved from 572ba57e-1cab-4f9c-a071-782e5a1a7184.cs1cloud.internal:60020, updating client location cache. New server: 20590793-0e19-4eb4-b2f6-05de8244f716.cs1cloud.internal:60020
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Right now I&apos;m running some loading tests and I&apos;m getting walls of text every time a split happens and it&apos;s basically the same message repeated hundreds of times. We used to have a similar message before but we removed it since it&apos;s pretty spammy (or we set it to DEBUG, can&apos;t remember).&lt;/p&gt;</comment>
                            <comment id="13507245" author="nkeywal" created="Fri, 30 Nov 2012 10:22:31 +0000"  >&lt;p&gt;@jd Yep, you&apos;re right.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12553730">HBASE-5924</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12554964">HBASE-5992</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310040">
                    <name>Required</name>
                                                                <inwardlinks description="is required by">
                                        <issuelink>
            <issuekey id="12551766">HBASE-5843</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12525676" name="5877-v16.txt" size="63433" author="zhihyu@ebaysf.com" created="Fri, 4 May 2012 20:44:56 +0000"/>
                            <attachment id="12525963" name="5877-v17.txt" size="63469" author="stack" created="Tue, 8 May 2012 06:16:53 +0000"/>
                            <attachment id="12525684" name="5877-v17.txt" size="63469" author="zhihyu@ebaysf.com" created="Fri, 4 May 2012 21:56:30 +0000"/>
                            <attachment id="12524327" name="5877.v1.patch" size="35777" author="nkeywal" created="Wed, 25 Apr 2012 19:15:42 +0000"/>
                            <attachment id="12525508" name="5877.v12.patch" size="62255" author="nkeywal" created="Thu, 3 May 2012 19:57:38 +0000"/>
                            <attachment id="12525660" name="5877.v15.patch" size="66144" author="nkeywal" created="Fri, 4 May 2012 18:36:38 +0000"/>
                            <attachment id="12526501" name="5877.v18.patch" size="66528" author="nkeywal" created="Fri, 11 May 2012 09:24:14 +0000"/>
                            <attachment id="12526123" name="5877.v18.patch" size="66528" author="nkeywal" created="Wed, 9 May 2012 08:58:45 +0000"/>
                            <attachment id="12526047" name="5877.v18.patch" size="66528" author="nkeywal" created="Tue, 8 May 2012 21:50:22 +0000"/>
                            <attachment id="12525304" name="5877.v6.patch" size="56884" author="nkeywal" created="Wed, 2 May 2012 15:50:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 25 Apr 2012 22:23:24 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>236702</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 3 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hu7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>102157</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>