<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:01:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-9140/HBASE-9140.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-9140] NPE in AsyncProcess</title>
                <link>https://issues.apache.org/jira/browse/HBASE-9140</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Running YCSB progress got stuck for quite a while and then a Null Pointer Exception was thrown:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt; 230 sec: 1266253 operations; 0 current ops/sec;  
 240 sec: 1266253 operations; 0 current ops/sec;  
 250 sec: 1266253 operations; 0 current ops/sec;  
 260 sec: 1266253 operations; 0 current ops/sec;  
 270 sec: 1266253 operations; 0 current ops/sec;  
 280 sec: 1266253 operations; 0 current ops/sec;  
 290 sec: 1266253 operations; 0 current ops/sec;  
 300 sec: 1266253 operations; 0 current ops/sec;  
 310 sec: 1266253 operations; 0 current ops/sec;  
 320 sec: 1266253 operations; 0 current ops/sec;  
 330 sec: 1266253 operations; 0 current ops/sec;  
 340 sec: 1266253 operations; 0 current ops/sec;  
 350 sec: 1266253 operations; 0 current ops/sec;  
 360 sec: 1266253 operations; 0 current ops/sec;  
 370 sec: 1266253 operations; 0 current ops/sec;  
 380 sec: 1266253 operations; 0 current ops/sec;  
 390 sec: 1266253 operations; 0 current ops/sec;  
Exception in thread &quot;Thread-26&quot; java.lang.NullPointerException
	at org.apache.hadoop.hbase.client.AsyncProcess.findDestLocation(AsyncProcess.java:288)
	at org.apache.hadoop.hbase.client.AsyncProcess.submit(AsyncProcess.java:233)
	at org.apache.hadoop.hbase.client.HTable.backgroundFlushCommits(HTable.java:811)
	at org.apache.hadoop.hbase.client.HTable.flushCommits(HTable.java:1192)
	at com.yahoo.ycsb.db.HBaseClient.cleanup(HBaseClient.java:106)
	at com.yahoo.ycsb.DBWrapper.cleanup(DBWrapper.java:73)
	at com.yahoo.ycsb.ClientThread.run(Client.java:307)
 400 sec: 1266253 operations; 0 current ops/sec; [UPDATE AverageLatency(us)=1341720] [INSERT AverageLatency(us)=197941421.07] [CLEANUP AverageLatency(us)=1342113] 
Exception in thread &quot;Thread-16&quot; java.lang.NullPointerException
	at org.apache.hadoop.hbase.client.AsyncProcess.findDestLocation(AsyncProcess.java:288)
	at org.apache.hadoop.hbase.client.AsyncProcess.submit(AsyncProcess.java:233)
	at org.apache.hadoop.hbase.client.HTable.backgroundFlushCommits(HTable.java:811)
	at org.apache.hadoop.hbase.client.HTable.flushCommits(HTable.java:1192)
	at com.yahoo.ycsb.db.HBaseClient.cleanup(HBaseClient.java:106)
	at com.yahoo.ycsb.DBWrapper.cleanup(DBWrapper.java:73)
	at com.yahoo.ycsb.ClientThread.run(Client.java:307)
 410 sec: 1266253 operations; 0 current ops/sec;  [INSERT AverageLatency(us)=208462580.75]  
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;0.95.2 + Hadoop 2.0.4&lt;/p&gt;</environment>
        <key id="12662150">HBASE-9140</key>
            <summary>NPE in AsyncProcess</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="eclark">Elliott Clark</reporter>
                        <labels>
                    </labels>
                <created>Tue, 6 Aug 2013 16:11:26 +0000</created>
                <updated>Tue, 6 Aug 2013 19:09:36 +0000</updated>
                                            <version>0.95.2</version>
                                                    <component>Client</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13730912" author="nkeywal" created="Tue, 6 Aug 2013 16:27:56 +0000"  >&lt;p&gt;That&apos;s this line, yes?&lt;br/&gt;
  loc = hConnection.locateRegion(this.tableName, row.getRow());&lt;/p&gt;

&lt;p&gt;hConnection is final, so it should come from &quot;row&quot;...&lt;/p&gt;</comment>
                            <comment id="13730930" author="nkeywal" created="Tue, 6 Aug 2013 16:42:52 +0000"  >&lt;p&gt;I looked at the code, I don&apos;t have a clear scenario. When we add to the list, it can&apos;t be null, we have&lt;/p&gt;

&lt;p&gt;    currentWriteBufferSize += put.heapSize();&lt;br/&gt;
    writeAsyncBuffer.add(put);&lt;/p&gt;

&lt;p&gt;so if &apos;put&apos; is null we NPE before adding it to the list.&lt;/p&gt;

&lt;p&gt;You&apos;re working on it Elliott? What&apos;s the ycsb setting you used?&lt;/p&gt;</comment>
                            <comment id="13730939" author="eclark" created="Tue, 6 Aug 2013 16:48:45 +0000"  >&lt;p&gt;HBase Git rev:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; f760bf88b67f609d3fcf18c317139361ff5ad1df&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Table setup:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;create &apos;usertable&apos;,{NAME =&amp;gt; &apos;d&apos;, VERSIONS =&amp;gt; 1,COMPRESSION =&amp;gt; &apos;snappy&apos;, BLOCKCACHE =&amp;gt; &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ycsb command:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;bin/ycsb load hbase -P workloads/workloada -p columnfamily=d -s -threads 32 -p recordcount=40000000&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;


&lt;p&gt;It was an automated YCSB run.  I didn&apos;t notice it until this morning that the run was less than half of the normal time.  Then looking though the logs I found the error.  It hasn&apos;t happened since and I can&apos;t get it to reproduce, but it&apos;s weird.&lt;/p&gt;
</comment>
                            <comment id="13730965" author="nkeywal" created="Tue, 6 Aug 2013 17:07:12 +0000"  >&lt;p&gt;I don&apos;t even see where it would be useful to add logs to help debugging. This code is called only by HTable, and HTable is not supposed to be used by multiple threads.&lt;/p&gt;

&lt;p&gt;May be the issue comes from here:&lt;br/&gt;
	at com.yahoo.ycsb.db.HBaseClient.cleanup(HBaseClient.java:106)&lt;br/&gt;
	at com.yahoo.ycsb.DBWrapper.cleanup(DBWrapper.java:73)&lt;/p&gt;

&lt;p&gt;I mean, the YCSB code doing the cleanup could be executed in parallel to the &apos;main&apos; one, or is passing a HTable object from a thread to another, with some nasty processor cache effects?&lt;/p&gt;</comment>
                            <comment id="13731069" author="eclark" created="Tue, 6 Aug 2013 18:38:29 +0000"  >&lt;p&gt;YCSB runs the clean up on the same thread as the HTable is created.  So I don&apos;t think that it&apos;s a threading issue when dealing with HTable. &lt;a href=&quot;https://github.com/brianfrankcooper/YCSB/blob/master/core/src/main/java/com/yahoo/ycsb/Client.java#L138&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/brianfrankcooper/YCSB/blob/master/core/src/main/java/com/yahoo/ycsb/Client.java#L138&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13731126" author="nkeywal" created="Tue, 6 Aug 2013 19:09:36 +0000"  >&lt;p&gt;you&apos;re right. It was too easy. I went through the YCSB code. Nothing fancy.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 6 Aug 2013 16:27:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>342154</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 19 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1n0av:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>342459</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>