<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:19:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4511/HBASE-4511.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4511] There is data loss when master failovers</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4511</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;It goes like this:&lt;/p&gt;

&lt;p&gt;Master crashed ,  at the same time RS with meta is crashing, but RS doesn&apos;t eixt.&lt;br/&gt;
Master startups again and finds all living RS. &lt;br/&gt;
Master verifies the meta failed,  because this RS is crashing.&lt;br/&gt;
Master reassigns the meta, but it doesn&apos;t split the Hlog. &lt;/p&gt;

&lt;p&gt;So some meta data is loss.&lt;/p&gt;

&lt;p&gt;About the logs of a failover test case fail. &lt;/p&gt;

&lt;p&gt;//It said that we want to kill a RS&lt;/p&gt;

&lt;p&gt;2011-09-28 19:54:45,694 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-988&amp;#93;&lt;/span&gt; regionserver.HRegionServer(1443): STOPPED: Killing for unit test&lt;br/&gt;
2011-09-28 19:54:45,694 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-988&amp;#93;&lt;/span&gt; master.TestMasterFailover(1007): &lt;/p&gt;

&lt;p&gt;RS 192.168.2.102,54385,1317264874629 killed &lt;/p&gt;

&lt;p&gt;//Rs didn&apos;t crash. &lt;br/&gt;
2011-09-28 19:54:51,763 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; master.HMaster(458): Registering server found up in zk: 192.168.2.102,54385,1317264874629&lt;br/&gt;
2011-09-28 19:54:51,763 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; master.ServerManager(232): Registering server=192.168.2.102,54385,1317264874629&lt;br/&gt;
2011-09-28 19:54:51,770 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(491): master:54557-0x132b31adbb30005 Unable to get data of znode /hbase/unassigned/1028785192 because node does not exist (not an error)&lt;br/&gt;
2011-09-28 19:54:51,771 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1003): master:54557-0x132b31adbb30005 Retrieved 33 byte(s) of data from znode /hbase/root-region-server and set watcher; 192.168.2.102,54383,131726487...&lt;/p&gt;

&lt;p&gt;//Meta verification failed and ressigned the meta. So all the regions in the meta is loss.&lt;/p&gt;

&lt;p&gt;2011-09-28 19:54:51,773 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; catalog.CatalogTracker(476): Failed verification of .META.,,1 at address=192.168.2.102,54385,1317264874629; org.apache.hadoop.hbase.regionserver.RegionServerStoppedException: org.apache.hadoop.hbase.regionserver.RegionServerStoppedException: Server 192.168.2.102,54385,1317264874629 not running, aborting&lt;br/&gt;
2011-09-28 19:54:51,773 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; catalog.CatalogTracker(316): new .META. server: 192.168.2.102,54385,1317264874629 isn&apos;t valid. Cached .META. server: null&lt;br/&gt;
2011-09-28 19:54:52,274 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1003): master:54557-0x132b31adbb30005 Retrieved 33 byte(s) of data from znode /hbase/root-region-server and set watcher; 192.168.2.102,54383,131726487...&lt;br/&gt;
2011-09-28 19:54:52,277 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; catalog.CatalogTracker(476): Failed verification of .META.,,1 at address=192.168.2.102,54385,1317264874629; org.apache.hadoop.hbase.regionserver.RegionServerStoppedException: org.apache.hadoop.hbase.regionserver.RegionServerStoppedException: Server 192.168.2.102,54385,1317264874629 not running, aborting&lt;br/&gt;
2011-09-28 19:54:52,277 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; catalog.CatalogTracker(316): new .META. server: 192.168.2.102,54385,1317264874629 isn&apos;t valid. Cached .META. server: null&lt;br/&gt;
2011-09-28 19:54:52,778 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1003): master:54557-0x132b31adbb30005 Retrieved 33 byte(s) of data from znode /hbase/root-region-server and set watcher; 192.168.2.102,54383,131726487...&lt;br/&gt;
2011-09-28 19:54:52,782 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; catalog.CatalogTracker(476): Failed verification of .META.,,1 at address=192.168.2.102,54385,1317264874629; org.apache.hadoop.hbase.regionserver.RegionServerStoppedException: org.apache.hadoop.hbase.regionserver.RegionServerStoppedException: Server 192.168.2.102,54385,1317264874629 not running, aborting&lt;br/&gt;
2011-09-28 19:54:52,782 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; catalog.CatalogTracker(316): new .META. server: 192.168.2.102,54385,1317264874629 isn&apos;t valid. Cached .META. server: null&lt;br/&gt;
2011-09-28 19:54:52,782 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(264): master:54557-0x132b31adbb30005 Creating (or updating) unassigned node for 1028785192 with OFFLINE state&lt;br/&gt;
2011-09-28 19:54:52,825 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Thread-988-EventThread&amp;#93;&lt;/span&gt; zookeeper.ZooKeeperWatcher(233): master:54557-0x132b31adbb30005 Received ZooKeeper Event, type=NodeCreated, state=SyncConnected, path=/hbase/unassigned/1028785192&lt;/p&gt;


&lt;p&gt;//It said that Master clean the cluster.&lt;br/&gt;
2011-09-28 19:54:52,889 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; master.AssignmentManager(383): Clean cluster startup. Assigning userregions&lt;br/&gt;
2011-09-28 19:54:52,889 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(494): master:54557-0x132b31adbb30005 Deleting any existing unassigned nodes&lt;/p&gt;</description>
                <environment></environment>
        <key id="12525152">HBASE-4511</key>
            <summary>There is data loss when master failovers</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="sunnygao">gaojinchao</reporter>
                        <labels>
                    </labels>
                <created>Thu, 29 Sep 2011 08:10:29 +0000</created>
                <updated>Fri, 20 Nov 2015 11:54:48 +0000</updated>
                            <resolved>Fri, 11 Nov 2011 23:37:09 +0000</resolved>
                                    <version>0.92.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                    <component>master</component>
                        <due>Thu, 29 Sep 2011 00:00:00 +0000</due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13117123" author="sunnygao" created="Thu, 29 Sep 2011 08:14:14 +0000"  >&lt;p&gt;Some logs are provided by Ted&lt;/p&gt;</comment>
                            <comment id="13117978" author="ram_krish" created="Fri, 30 Sep 2011 11:17:35 +0000"  >&lt;p&gt;@Gao&lt;br/&gt;
I think generally the split of log will happen only if the RS dies and the RS node gets deleted.&lt;br/&gt;
If that does not happen then the split logs of that crashing RS may not happen.&lt;br/&gt;
May be in actual scenario though the master does not process as dead server by splitting the logs it will any way wait for ServerShutDownHandler to process it.&lt;/p&gt;

&lt;p&gt;what do you feel Gao?&lt;/p&gt;</comment>
                            <comment id="13123372" author="sunnygao" created="Sat, 8 Oct 2011 04:23:59 +0000"  >&lt;p&gt;@RAM &lt;br/&gt;
For this case. We can process it:&lt;br/&gt;
1. why the Region server can&apos;t exit ?&lt;br/&gt;
2. If master verifies the meta/root failed. Does master need crash? or wait for ServerShutDownHandler.&lt;/p&gt;</comment>
                            <comment id="13123377" author="ram_krish" created="Sat, 8 Oct 2011 05:02:59 +0000"  >&lt;p&gt;@Gao&lt;br/&gt;
This problem occured in testcase.  Can we reproduce this in real time? It would be great if we can reproduce so that we are clear of the actual problem?&lt;/p&gt;</comment>
                            <comment id="13128554" author="sunnygao" created="Mon, 17 Oct 2011 01:19:37 +0000"  >&lt;p&gt;Ihis cannot be reproduced in real cluster and downgrade its priority.&lt;/p&gt;</comment>
                            <comment id="13144420" author="stack" created="Fri, 4 Nov 2011 22:36:54 +0000"  >&lt;p&gt;I think there is a hole here as identified by Gaojinchao.  Its probably of rare incidence but its easy to reason about.&lt;/p&gt;

&lt;p&gt;Say we fail verifying root region location when a new master joins an exisiting cluster, we will reassign it.  We may have failed though because the server has not yet expired in zk.  In this later case, the root will likely be assigned to a new server.  When the server that had been carrying the root eventually goes down, the shutdown handling code may treat it as a server that was carrying root (if root location has not yet been updated) or it may not (if root location has been updated).  In either case, its edits will likely be skipped when root opens in its new location.&lt;/p&gt;

&lt;p&gt;Ditto for meta region.&lt;/p&gt;

&lt;p&gt;Here is a sketch of a patch that does the following:&lt;/p&gt;

&lt;p&gt;+ If on master start, verification of the root location fails AND the server we were verifying is a member of the online set, expire the server &amp;#8211; do not reassign root (let shutdown handler do the reassigning).&lt;br/&gt;
+ Ditto for meta (only don&apos;t re-expire a server if we just did it on root check).&lt;/p&gt;

&lt;p&gt;Drastic but I think this &apos;correct&apos;.&lt;/p&gt;

&lt;p&gt;Patch is not working right though... need to check it out.... later.&lt;/p&gt;</comment>
                            <comment id="13144465" author="yuzhihong@gmail.com" created="Fri, 4 Nov 2011 23:58:37 +0000"  >&lt;p&gt;The proposed approach makes sense.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; expireIfOnline(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ServerName sn) {
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (sn != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.serverManager.isServerOnline(sn)) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think checking sn against null should be on its own. Otherwise we would get NPE at the first line of expireServer():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;synchronized&lt;/span&gt; void expireServer(&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; ServerName serverName) {
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.onlineServers.containsKey(serverName)) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;See &lt;a href=&quot;http://download.oracle.com/javase/1,5,0/docs/api/java/util/concurrent/ConcurrentHashMap.html:&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://download.oracle.com/javase/1,5,0/docs/api/java/util/concurrent/ConcurrentHashMap.html:&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Like Hashtable but unlike HashMap, this class does NOT allow null to be used as a key or value.&lt;/p&gt;</comment>
                            <comment id="13144523" author="sunnygao" created="Sat, 5 Nov 2011 02:24:18 +0000"  >&lt;p&gt;Meta table is different from Root table. When Meta RS is dying, we should not use getMetaLocation.&lt;br/&gt;
I think we should get the sn from root table. &lt;/p&gt;</comment>
                            <comment id="13144553" author="stack" created="Sat, 5 Nov 2011 03:55:58 +0000"  >&lt;p&gt;Let me address both of your criticisms.  Thanks for the review lads.&lt;/p&gt;</comment>
                            <comment id="13144584" author="stack" created="Sat, 5 Nov 2011 04:59:24 +0000"  >&lt;p&gt;Address Ted comment.&lt;/p&gt;</comment>
                            <comment id="13144585" author="hadoopqa" created="Sat, 5 Nov 2011 05:02:18 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12502576/4511.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12502576/4511.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/185//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/185//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13144587" author="stack" created="Sat, 5 Nov 2011 05:03:06 +0000"  >&lt;p&gt;@Gaojinchao I don&apos;t understand your comment.  When I call getMetaLocation on line 558, am I not using same address that failed above when we called verifyMetaRegionLocation on the line above at line 557?  Thanks.&lt;/p&gt;</comment>
                            <comment id="13144598" author="sunnygao" created="Sat, 5 Nov 2011 05:29:12 +0000"  >&lt;p&gt;@stack&lt;br/&gt;
Sorry , I am wrong. the patch makes sense.&lt;/p&gt;</comment>
                            <comment id="13144604" author="sunnygao" created="Sat, 5 Nov 2011 06:03:44 +0000"  >&lt;p&gt;I am still a little doubt, If Meta RS is dying RS, How to pass this his name to metaLocation?&lt;/p&gt;

&lt;p&gt;look this logs, it said that this.metaLocation is null .&lt;/p&gt;

&lt;p&gt;2011-09-28 19:54:51,773 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; catalog.CatalogTracker(476): Failed verification of .META.,,1 at address=192.168.2.102,54385,1317264874629; org.apache.hadoop.hbase.regionserver.RegionServerStoppedException: org.apache.hadoop.hbase.regionserver.RegionServerStoppedException: Server 192.168.2.102,54385,1317264874629 not running, aborting&lt;br/&gt;
2011-09-28 19:54:51,773 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; catalog.CatalogTracker(316): new .META. server: 192.168.2.102,54385,1317264874629 isn&apos;t valid. Cached .META. server: null&lt;br/&gt;
2011-09-28 19:54:52,274 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1003): master:54557-0x132b31adbb30005 Retrieved 33 byte(s) of data from znode /hbase/root-region-server and set watcher; 192.168.2.102,54383,131726487...&lt;br/&gt;
2011-09-28 19:54:52,277 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; catalog.CatalogTracker(476): Failed verification of .META.,,1 at address=192.168.2.102,54385,1317264874629; org.apache.hadoop.hbase.regionserver.RegionServerStoppedException: org.apache.hadoop.hbase.regionserver.RegionServerStoppedException: Server 192.168.2.102,54385,1317264874629 not running, aborting&lt;br/&gt;
2011-09-28 19:54:52,277 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; catalog.CatalogTracker(316): new .META. server: 192.168.2.102,54385,1317264874629 isn&apos;t valid. Cached .META. server: null&lt;br/&gt;
2011-09-28 19:54:52,778 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; zookeeper.ZKUtil(1003): master:54557-0x132b31adbb30005 Retrieved 33 byte(s) of data from znode /hbase/root-region-server and set watcher; 192.168.2.102,54383,131726487...&lt;br/&gt;
2011-09-28 19:54:52,782 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; catalog.CatalogTracker(476): Failed verification of .META.,,1 at address=192.168.2.102,54385,1317264874629; org.apache.hadoop.hbase.regionserver.RegionServerStoppedException: org.apache.hadoop.hbase.regionserver.RegionServerStoppedException: Server 192.168.2.102,54385,1317264874629 not running, aborting&lt;br/&gt;
2011-09-28 19:54:52,782 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; catalog.CatalogTracker(316): new .META. server: 192.168.2.102,54385,1317264874629 isn&apos;t valid. Cached .META. server: null&lt;br/&gt;
2011-09-28 19:54:52,782 DEBUG &lt;span class=&quot;error&quot;&gt;&amp;#91;Master:0;192.168.2.102,54557,1317264885720&amp;#93;&lt;/span&gt; zookeeper.ZKAssign(264): master:54557-0x132b31adbb30005 Creating (or updating) unassigned node for 1028785192 with OFFLINE state&lt;/p&gt;</comment>
                            <comment id="13144808" author="stack" created="Sat, 5 Nov 2011 19:39:29 +0000"  >&lt;p&gt;Thank you for the log Jinchao.  That helped.  So, yes, metaLocation can be null at this point.  It won&apos;t be set until its been &apos;verified&apos;.  So what we want if metaLocation is null is what is up in &lt;del&gt;ROOT&lt;/del&gt; (which is what I believe you were saying above in your first feedback).&lt;/p&gt;

&lt;p&gt;This patch adds a method to CatalogTracker that will return metaLocation if non-null else whatever the current content of &lt;del&gt;ROOT&lt;/del&gt;.&lt;/p&gt;</comment>
                            <comment id="13144839" author="hadoopqa" created="Sat, 5 Nov 2011 21:32:29 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12502613/4511-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12502613/4511-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -163 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 48 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestDistributedLogSplitting&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestRegionServerCoprocessorExceptionWithRemove&lt;br/&gt;
                  org.apache.hadoop.hbase.TestDrainingServer&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/189//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/189//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/189//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/189//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/189//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/189//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13144982" author="sunnygao" created="Sun, 6 Nov 2011 11:28:11 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13145227" author="ram_krish" created="Mon, 7 Nov 2011 05:03:22 +0000"  >&lt;p&gt;@Stack&lt;br/&gt;
Patch looks fine. I have one suggestion&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isExpiring(expiredServer, currentMetaServer) ||
+          expireIfOnline(currentMetaServer)) {
+        &lt;span class=&quot;code-comment&quot;&gt;// We are expiring the server that is carrying meta because unreachable
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// The expiration processing will take care of reassigning meta.
&lt;/span&gt;+      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you had clearly told if we are already expiring a server while assigning meta then we will not be expiring once again. &lt;br/&gt;
So can we rename isExpiring to isAlreadyExpiring()?  Also can we split the conition because currently the if block is empty.&lt;br/&gt;
So we can add isAlreadyExpiring() and if true we can go with expireIfOnline.  Just a thought.  You can decide Stack. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13145239" author="ram_krish" created="Mon, 7 Nov 2011 05:55:01 +0000"  >&lt;blockquote&gt;&lt;p&gt;So we can add isAlreadyExpiring() and if true&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Sorry it should be &lt;br/&gt;
So we can add isAlreadyExpiring() and if flase we can go with expireIfOnline&lt;/p&gt;</comment>
                            <comment id="13145242" author="stack" created="Mon, 7 Nov 2011 06:03:27 +0000"  >&lt;p&gt;I like your suggestion @Ram.  New patch to follow.&lt;/p&gt;</comment>
                            <comment id="13148837" author="stack" created="Fri, 11 Nov 2011 23:35:03 +0000"  >&lt;p&gt;Version I&apos;ll apply (Has Ram&apos;s input &amp;#8211; though I ended up just replacing isAlreadyExpired with a test for null and equals... thats all it was doing).&lt;/p&gt;</comment>
                            <comment id="13148842" author="stack" created="Fri, 11 Nov 2011 23:37:09 +0000"  >&lt;p&gt;Applied branch and trunk.  Thanks for the review lads.&lt;/p&gt;</comment>
                            <comment id="13148949" author="hudson" created="Sat, 12 Nov 2011 02:25:00 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #125 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/125/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/125/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4511&quot; title=&quot;There is data loss when master failovers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4511&quot;&gt;&lt;del&gt;HBASE-4511&lt;/del&gt;&lt;/a&gt; There is data loss when master failovers&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13148981" author="hudson" created="Sat, 12 Nov 2011 04:12:36 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2430 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2430/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2430/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4511&quot; title=&quot;There is data loss when master failovers&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4511&quot;&gt;&lt;del&gt;HBASE-4511&lt;/del&gt;&lt;/a&gt; There is data loss when master failovers&lt;/p&gt;

&lt;p&gt;stack : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/catalog/CatalogTracker.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/catalog/MetaReader.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="15016321" author="lars_francke" created="Fri, 20 Nov 2015 11:54:48 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12530265">HBASE-4749</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12502613" name="4511-v2.txt" size="9006" author="stack" created="Sat, 5 Nov 2011 19:39:29 +0000"/>
                            <attachment id="12503445" name="4511-v3.txt" size="8338" author="stack" created="Fri, 11 Nov 2011 23:35:03 +0000"/>
                            <attachment id="12502576" name="4511.txt" size="4080" author="stack" created="Sat, 5 Nov 2011 04:59:23 +0000"/>
                            <attachment id="12496982" name="org.apache.hadoop.hbase.master.TestMasterFailover-output.rar" size="51506" author="sunnygao" created="Thu, 29 Sep 2011 08:14:14 +0000"/>
                            <attachment id="12502542" name="sketch.txt" size="5388" author="stack" created="Fri, 4 Nov 2011 22:36:53 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 30 Sep 2011 11:17:35 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>39724</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hr6n:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101666</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>