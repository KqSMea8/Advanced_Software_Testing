<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:48:58 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7778/HBASE-7778.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7778] [snapshot 130201 merge] Tests with sleep after minicluster shutdown fail due to interrupt flag.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7778</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Something in the merge has set the interrupted flag on the main test threads of TestReplicationDisabledinactivePeer, TestRestartCluster, and TestCatalogTrackerOnCluster.  &lt;/p&gt;

&lt;p&gt;These unacceptable hacks make the tests run and pass: &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/hbase-server/src/test/java/org/apache/hadoop/hbase/catalog/TestCatalogTrackerOnCluster.java b/hbase-server/src/test/java/or
index f3e57d6..a8d2ef7 100644
--- a/hbase-server/src/test/java/org/apache/hadoop/hbase/catalog/TestCatalogTrackerOnCluster.java
+++ b/hbase-server/src/test/java/org/apache/hadoop/hbase/catalog/TestCatalogTrackerOnCluster.java
@@ -47,6 +47,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class TestCatalogTrackerOnCluster {
     &lt;span class=&quot;code-comment&quot;&gt;// Shutdown hbase.
&lt;/span&gt;     UTIL.shutdownMiniHBaseCluster();
     &lt;span class=&quot;code-comment&quot;&gt;// Give the various ZKWatchers some time to settle their affairs.
&lt;/span&gt;+    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.interrupted(); &lt;span class=&quot;code-comment&quot;&gt;// HACK clear interrupt state.
&lt;/span&gt;     &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(1000);
 
     &lt;span class=&quot;code-comment&quot;&gt;// Mess with the root location in the running zk.  Set it to be nonsense.
&lt;/span&gt;diff --git a/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestRestartCluster.java b/hbase-server/src/test/java/org/apache/h
index 15225e1..9f7f526 100644
--- a/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestRestartCluster.java
+++ b/hbase-server/src/test/java/org/apache/hadoop/hbase/master/TestRestartCluster.java
@@ -108,6 +108,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class TestRestartCluster {
     UTIL.shutdownMiniHBaseCluster();
 
     LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;\n\nSleeping a bit&quot;&lt;/span&gt;);
+    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.interrupted(); &lt;span class=&quot;code-comment&quot;&gt;// HACK clear interrupt state.
&lt;/span&gt;     &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(2000);
 
     LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;\n\nStarting cluster the second time&quot;&lt;/span&gt;);
diff --git a/hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationDisableInactivePeer.java b/hbase-server/src/t
index b089fbe..8162f4b 100644
--- a/hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationDisableInactivePeer.java
+++ b/hbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationDisableInactivePeer.java
@@ -50,6 +50,7 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class TestReplicationDisableInactivePeer &lt;span class=&quot;code-keyword&quot;&gt;extends&lt;/span&gt; TestReplicationBase {
     &lt;span class=&quot;code-comment&quot;&gt;// enabling and shutdown the peer
&lt;/span&gt;     admin.enablePeer(&lt;span class=&quot;code-quote&quot;&gt;&quot;2&quot;&lt;/span&gt;);
     utility2.shutdownMiniHBaseCluster();
+    &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.interrupted(); &lt;span class=&quot;code-comment&quot;&gt;// HACK clear interrupted flag.
&lt;/span&gt; 
     &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] rowkey = Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;disable inactive peer&quot;&lt;/span&gt;);
     Put put = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Put(rowkey);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;On the snapshot branch and on the trunk branch before the merge, these tests passed. Need to figure out how they combination caused this behavior change.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12631104">HBASE-7778</key>
            <summary>[snapshot 130201 merge] Tests with sleep after minicluster shutdown fail due to interrupt flag.</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12619005">HBASE-7290</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jmhsieh">Jonathan Hsieh</assignee>
                                    <reporter username="jmhsieh">Jonathan Hsieh</reporter>
                        <labels>
                    </labels>
                <created>Wed, 6 Feb 2013 17:45:36 +0000</created>
                <updated>Mon, 23 Sep 2013 18:31:37 +0000</updated>
                            <resolved>Fri, 8 Feb 2013 01:12:30 +0000</resolved>
                                    <version>hbase-7290</version>
                    <version>0.95.2</version>
                                    <fixVersion>0.95.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13572758" author="jmhsieh" created="Wed, 6 Feb 2013 20:00:42 +0000"  >&lt;p&gt;This was suggested by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt; over in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7290&quot; title=&quot;Online snapshots &quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7290&quot;&gt;&lt;del&gt;HBASE-7290&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;In RegionServerSnapshotManager#cancelTasks():&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!futures.isEmpty()) {
        &lt;span class=&quot;code-comment&quot;&gt;// block to remove cancelled futures;
&lt;/span&gt;        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Removing cancelled elements from taskPool&quot;&lt;/span&gt;);
        futures.remove(taskPool.take());
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I think the log should be outside while loop.&lt;br/&gt;
taskPool.take() may throw InterruptedException. I think the futures.remove() call should be wrapped in try block.&lt;/p&gt;</comment>
                            <comment id="13572766" author="jmhsieh" created="Wed, 6 Feb 2013 20:06:21 +0000"  >&lt;p&gt;I tried a quick and dirty version of the suggestion &lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
diff --git a/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/snapshot/RegionServerSnapshotManager.java b/hbase-server/sr
index 1282585..a5b003b 100644
--- a/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/snapshot/RegionServerSnapshotManager.java
+++ b/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/snapshot/RegionServerSnapshotManager.java
@@ -359,7 +359,11 @@ &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class RegionServerSnapshotManager {
       &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (!futures.isEmpty()) {
         &lt;span class=&quot;code-comment&quot;&gt;// block to remove cancelled futures;
&lt;/span&gt;         LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Removing cancelled elements from taskPool&quot;&lt;/span&gt;);
-        futures.remove(taskPool.take());
+        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
+          futures.remove(taskPool.take());
+        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
+          LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Catching and ignoring exception&quot;&lt;/span&gt;, e);
+        }
       }
       stop();
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and the three tests still fail.  &lt;/p&gt;</comment>
                            <comment id="13572820" author="jmhsieh" created="Wed, 6 Feb 2013 21:03:02 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7475&quot; title=&quot;TestUpgradeFromHFileV1ToEncoding.testUpgrade hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7475&quot;&gt;&lt;del&gt;HBASE-7475&lt;/del&gt;&lt;/a&gt; adds a Thread.currentThread().interrupt() to JVMClusterUtil#shutdown call which may be the culprit.  Not clear to my why it was added there, but I don&apos;t think just removing that is the correct solution either.  My guess is that it prevent the hang that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkeywal&quot; class=&quot;user-hover&quot; rel=&quot;nkeywal&quot;&gt;Nicolas Liochon&lt;/a&gt; encountered in that issue.&lt;/p&gt;

&lt;p&gt;This has to do with attempting to delete the rs&apos;s epheramal ZK node. (which times out and likely forces timeout/interrupt exit)&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-02-06 12:54:56,249 WARN  [RegionServer:0;localhost,57007,1360184089426] zookeeper.RecoverableZooKeeper(226): Possibly &lt;span class=&quot;code-keyword&quot;&gt;transient&lt;/span&gt; ZooKeeper exception: org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /hbase/rs/localhost,57007,1360184089426
2013-02-06 12:54:56,250 INFO  [RegionServer:0;localhost,57007,1360184089426] util.RetryCounter(54): Sleeping 2000ms before retry #1...
2013-02-06 12:54:58,251 WARN  [RegionServer:0;localhost,57007,1360184089426] zookeeper.RecoverableZooKeeper(226): Possibly &lt;span class=&quot;code-keyword&quot;&gt;transient&lt;/span&gt; ZooKeeper exception: org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /hbase/rs/localhost,57007,1360184089426
2013-02-06 12:54:58,251 INFO  [RegionServer:0;localhost,57007,1360184089426] util.RetryCounter(54): Sleeping 4000ms before retry #2...
2013-02-06 12:55:02,252 WARN  [RegionServer:0;localhost,57007,1360184089426] zookeeper.RecoverableZooKeeper(226): Possibly &lt;span class=&quot;code-keyword&quot;&gt;transient&lt;/span&gt; ZooKeeper exception: org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /hbase/rs/localhost,57007,1360184089426
2013-02-06 12:55:02,252 INFO  [RegionServer:0;localhost,57007,1360184089426] util.RetryCounter(54): Sleeping 8000ms before retry #3...
2013-02-06 12:55:10,253 WARN  [RegionServer:0;localhost,57007,1360184089426] zookeeper.RecoverableZooKeeper(226): Possibly &lt;span class=&quot;code-keyword&quot;&gt;transient&lt;/span&gt; ZooKeeper exception: org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /hbase/rs/localhost,57007,1360184089426
2013-02-06 12:55:10,253 ERROR [RegionServer:0;localhost,57007,1360184089426] zookeeper.RecoverableZooKeeper(228): ZooKeeper delete failed after 3 retries
2013-02-06 12:55:10,254 WARN  [RegionServer:0;localhost,57007,1360184089426] regionserver.HRegionServer(1012): Failed deleting my ephemeral node
org.apache.zookeeper.KeeperException$SessionExpiredException: KeeperErrorCode = Session expired &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; /hbase/rs/localhost,57007,1360184089426
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:127)
	at org.apache.zookeeper.KeeperException.create(KeeperException.java:51)
	at org.apache.zookeeper.ZooKeeper.delete(ZooKeeper.java:873)
	at org.apache.hadoop.hbase.zookeeper.RecoverableZooKeeper.delete(RecoverableZooKeeper.java:141)
	at org.apache.hadoop.hbase.zookeeper.ZKUtil.deleteNode(ZKUtil.java:1222)
	at org.apache.hadoop.hbase.zookeeper.ZKUtil.deleteNode(ZKUtil.java:1211)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.deleteMyEphemeralNode(HRegionServer.java:1263)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.run(HRegionServer.java:1010)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.runRegionServer(MiniHBaseCluster.java:151)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.access$0(MiniHBaseCluster.java:150)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer$1.run(MiniHBaseCluster.java:135)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:337)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1118)
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;digging more..&lt;/p&gt;</comment>
                            <comment id="13572826" author="yuzhihong@gmail.com" created="Wed, 6 Feb 2013 21:07:54 +0000"  >&lt;p&gt;I noticed similar things:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-02-06 12:58:53,980 INFO  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-252] master.TestRestartCluster(107):

Shutting down cluster
2013-02-06 12:58:53,980 DEBUG [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-252] util.JVMClusterUtil(226): Shutting down HBase Cluster
...
2013-02-06 12:59:09,254 INFO  [&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;-252] master.TestRestartCluster(110):

Sleeping a bit
2013-02-06 12:59:09,254 INFO  [main] hbase.HBaseTestingUtility(862): Shutting down minicluster
...
2013-02-06 12:59:12,694 WARN  [org.apache.hadoop.hdfs.server.namenode.FSNamesystem$ReplicationMonitor@29d22104] namenode.FSNamesystem$ReplicationMonitor(2868): ReplicationMonitor thread received InterruptedException.java.lang.InterruptedException: sleep interrupted
2013-02-06 12:59:12,716 INFO  [main] hbase.HBaseTestingUtility(871): Minicluster is down
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Note that the shutdown took over 18 seconds.&lt;/p&gt;</comment>
                            <comment id="13572844" author="jmhsieh" created="Wed, 6 Feb 2013 21:21:55 +0000"  >&lt;p&gt;I&apos;m looking at TestCatalogTrackerOnCluster currently &amp;#8211;  if I go pre-merge trunk branch, it passes if I run it but fails in the debugger due to the interrupt being triggered and subsequent sleep being bailing out.  This indicates that there is something racing going on and that something in the snapshot branch&apos;s zk stuff is like slowing it down so it fails more frequently (or all the time).  &lt;/p&gt;</comment>
                            <comment id="13572847" author="jmhsieh" created="Wed, 6 Feb 2013 21:25:13 +0000"  >&lt;p&gt;the 18 seconds looks like the zk backoffs &amp;#8211; 1 + 2 + 4 + 8s ~= 18s.&lt;/p&gt;</comment>
                            <comment id="13572890" author="yuzhihong@gmail.com" created="Wed, 6 Feb 2013 22:00:36 +0000"  >&lt;p&gt;After reverting the changes (locally) to JVMClusterUtil.java from &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7475&quot; title=&quot;TestUpgradeFromHFileV1ToEncoding.testUpgrade hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7475&quot;&gt;&lt;del&gt;HBASE-7475&lt;/del&gt;&lt;/a&gt;, I got the following tests pass:&lt;/p&gt;

&lt;p&gt;  904  mt -Dtest=TestReplicationDisabledinactivePeer,TestRestartCluster,TestCatalogTrackerOnCluster&lt;br/&gt;
  905  mt -Dtest=TestUpgradeFromHFileV1ToEncoding&lt;/p&gt;</comment>
                            <comment id="13572902" author="yuzhihong@gmail.com" created="Wed, 6 Feb 2013 22:09:16 +0000"  >&lt;p&gt;The following one line change allows the above tests to pass:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!noWait){
      &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
&lt;/span&gt;    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13572912" author="jmhsieh" created="Wed, 6 Feb 2013 22:16:36 +0000"  >&lt;p&gt;Yup, I&apos;ve essentially did that as well &amp;#8211; I concerned that if this will re-break &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7475&quot; title=&quot;TestUpgradeFromHFileV1ToEncoding.testUpgrade hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7475&quot;&gt;&lt;del&gt;HBASE-7475&lt;/del&gt;&lt;/a&gt;.  &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=nkeywal&quot; class=&quot;user-hover&quot; rel=&quot;nkeywal&quot;&gt;Nicolas Liochon&lt;/a&gt;  &amp;#8211; any comments on this?&lt;/p&gt;</comment>
                            <comment id="13572918" author="jmhsieh" created="Wed, 6 Feb 2013 22:20:12 +0000"  >&lt;p&gt;I&apos;m more concerned about these tests being racy and flakey due to the noWait variable in the JVMClusterUtil#shutdown method.  &lt;/p&gt;</comment>
                            <comment id="13572956" author="jmhsieh" created="Wed, 6 Feb 2013 22:44:13 +0000"  >&lt;p&gt;It looks like there are two threads that are waiting/joining on the minicluster threads.  It seems there is a race &amp;#8211; on one path, it seems that LocalHBaseCluster#join() gets and likely clears the interrupt flag by catching an interrupted exception near the call to Threads#threaddumpingIsAlive.  The other path, the interrupt state set in the link ted commented out triggers the exception on the following Thread#sleep call.&lt;/p&gt;</comment>
                            <comment id="13572999" author="yuzhihong@gmail.com" created="Wed, 6 Feb 2013 23:35:24 +0000"  >&lt;p&gt;I ran the addendum through trunk test suite and tests passed.&lt;/p&gt;</comment>
                            <comment id="13573003" author="jmhsieh" created="Wed, 6 Feb 2013 23:42:35 +0000"  >&lt;p&gt;While I care about the test passing, I care more about understanding why it passes and making it easier for future folks to understand why.  In this case, I think it was a bug &amp;#8211; the last test shouldn&apos;t be removed but instead the boolean was inverted.  I&apos;ve renamed the noWait variable and I think it makes it much more obvious that that was the problem.&lt;/p&gt;</comment>
                            <comment id="13573004" author="jmhsieh" created="Wed, 6 Feb 2013 23:43:16 +0000"  >&lt;p&gt;Let&apos;s give the robot a run on this &amp;#8211; this actually fixes a trunk problem.&lt;/p&gt;</comment>
                            <comment id="13573008" author="yuzhihong@gmail.com" created="Wed, 6 Feb 2013 23:49:17 +0000"  >&lt;p&gt;Is the following change needed ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (activeMaster != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) activeMaster.master.shutdown();
+      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (activeMaster != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;)
+        activeMaster.master.shutdown();
+
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13573012" author="jmhsieh" created="Wed, 6 Feb 2013 23:54:23 +0000"  >&lt;p&gt;I prefer it because you can more easily step through it with a debugger.  I probably should have put  {} around the shutdown call.&lt;/p&gt;</comment>
                            <comment id="13573049" author="hadoopqa" created="Thu, 7 Feb 2013 00:48:11 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12568329/hbase-7778.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12568329/hbase-7778.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop2.0&lt;/font&gt;.  The patch compiles against the hadoop 2.0 profile.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop1-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4361//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13573053" author="jmhsieh" created="Thu, 7 Feb 2013 01:03:59 +0000"  >&lt;p&gt;This modifies JVMClusterUtil which is used by all minicluster unit tests and they all passed.&lt;/p&gt;</comment>
                            <comment id="13573311" author="nkeywal" created="Thu, 7 Feb 2013 08:26:44 +0000"  >&lt;p&gt;Yes, I inverted the boolean test in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7475&quot; title=&quot;TestUpgradeFromHFileV1ToEncoding.testUpgrade hangs&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7475&quot;&gt;&lt;del&gt;HBASE-7475&lt;/del&gt;&lt;/a&gt;. Sorry about that, and thanks for fixing it.&lt;br/&gt;
I added the interrupt to prevent the cluster from staying up too long (i.e. surviving forever the surefire build) while we actually called for a shutdown. It does not solve all cases, because HBase sometimes messes-up with the interrupt exception, but it usually helps. &lt;/p&gt;</comment>
                            <comment id="13573897" author="jmhsieh" created="Thu, 7 Feb 2013 20:35:25 +0000"  >&lt;p&gt;I&apos;ll commit this today (with maybe an minor comment improvement) later today unless I here dissent.&lt;/p&gt;</comment>
                            <comment id="13574132" author="jmhsieh" created="Fri, 8 Feb 2013 01:12:30 +0000"  >&lt;p&gt;Thanks for look at this Ted and N.  Committed to snapshots branch.  We&apos;ll get this into trunk when we merge.&lt;/p&gt;</comment>
                            <comment id="13775490" author="stack" created="Mon, 23 Sep 2013 18:31:37 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12625712">HBASE-7475</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12568329" name="hbase-7778.patch" size="3325" author="jmhsieh" created="Wed, 6 Feb 2013 23:43:16 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 6 Feb 2013 21:07:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311600</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1hrw7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>311946</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>