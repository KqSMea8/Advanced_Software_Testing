<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:32:01 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5904/HBASE-5904.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5904] is_enabled from shell returns differently from pre- and post- HBASE-5155</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5904</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;If I launch an hbase shell that uses HBase and ZooKeeper without &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;, against HBase servers with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;, then is_enabled for a table always returns false even if the table is considered enabled by the servers from the logs.  If I then do the same thing but with an HBase shell and ZooKeeper with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;, then is_enabled returns as expected.&lt;/p&gt;

&lt;p&gt;If I launch an HBase shell that uses HBase and ZooKeeper without &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;, against HBase servers also without &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;, then is_enabled works as you&apos;d expect.  But if I then do the same thing but with an HBase shell and ZooKeeper with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;, then is_enabled returns false even though the table is considered enabled by the servers from the logs.&lt;/p&gt;

&lt;p&gt;Additionally, if I then try to enable the table from the &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;-containing shell, it hangs because the ZooKeeper code waits for the ZNode to be updated with &quot;ENABLED&quot; in the data field, but what actually happens is that the ZNode gets deleted since the servers are running without &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I think the culprit is that the indication of how a table is considered enabled inside ZooKeeper has changed with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;.  Before &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;, a table was considered enabled if the ZNode for it did not exist.  After &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;, a table is considered enabled if the ZNode for it exists and has &quot;ENABLED&quot; in its data.  I think the current code is incompatible when running clients and servers where one side has &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt; and the other side does not.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12553377">HBASE-5904</key>
            <summary>is_enabled from shell returns differently from pre- and post- HBASE-5155</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="dsw">David S. Wang</assignee>
                                    <reporter username="dsw">David S. Wang</reporter>
                        <labels>
                    </labels>
                <created>Mon, 30 Apr 2012 15:45:08 +0000</created>
                <updated>Wed, 27 Jun 2012 13:11:37 +0000</updated>
                            <resolved>Wed, 27 Jun 2012 13:11:37 +0000</resolved>
                                    <version>0.90.6</version>
                                    <fixVersion>0.90.7</fixVersion>
                                    <component>Zookeeper</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13264990" author="stack" created="Mon, 30 Apr 2012 15:50:56 +0000"  >&lt;p&gt;Then we should revert hbase-5155, would you agree David?&lt;/p&gt;

&lt;p&gt;IIRC, there was a reason for absence of znode meaning ENABLED but don&apos;t remember it off hand.&lt;/p&gt;</comment>
                            <comment id="13264992" author="dsw" created="Mon, 30 Apr 2012 15:54:59 +0000"  >&lt;p&gt;I think at least a partial revert of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt; is warranted here.  I don&apos;t know if we want to back it out entirely as it seems to solve a race condition that would be good to not have.  Perhaps most of the patch can remain, but the part that handles how a table is represented as enabled in ZK can be reverted or worked around.  But Ram can comment further on how best to handle this.&lt;/p&gt;</comment>
                            <comment id="13264994" author="dsw" created="Mon, 30 Apr 2012 15:56:09 +0000"  >&lt;p&gt;Also, I&apos;m not sure if it matters that 0.90.6 was already cut with this change.  That means that there is already an incompatible release out there.  I do not know what the precedent is here or if there is one.&lt;/p&gt;</comment>
                            <comment id="13264999" author="ram_krish" created="Mon, 30 Apr 2012 16:09:32 +0000"  >&lt;p&gt;@Stack&lt;br/&gt;
Yes, David discussed this with me too.  But i was also not sure as how to go about with this. Thanks David for bringing this up.  &lt;/p&gt;</comment>
                            <comment id="13265005" author="stack" created="Mon, 30 Apr 2012 16:19:24 +0000"  >&lt;p&gt;If 0.90.6 has this breakage, then the damage is done.  We should mark hbase-5155 an incompatible change and put in a fat release note w/ how it changes behavior (Steal some of David&apos;s notes above).  You up for doing this Ram?&lt;/p&gt;

&lt;p&gt;I&apos;m surprised that the change in semantic where no znode no longer means enabled has not caused other issues.&lt;/p&gt;

&lt;p&gt;Good digging David.&lt;/p&gt;</comment>
                            <comment id="13265022" author="ram_krish" created="Mon, 30 Apr 2012 16:49:43 +0000"  >&lt;p&gt;Added release note to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;.  &lt;br/&gt;
@David/@Stack &lt;br/&gt;
Please take a look at it.&lt;/p&gt;</comment>
                            <comment id="13265024" author="dsw" created="Mon, 30 Apr 2012 16:52:40 +0000"  >&lt;p&gt;Should we back out &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt; entirely for now?  I looked at it and just backing out the part that changes the znode behavior implies that we should also remove isTablePresent(), which seems to affect more of the patch&apos;s functionality and then it gets messy.&lt;/p&gt;

&lt;p&gt;Is there any later change that depends on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;?&lt;/p&gt;</comment>
                            <comment id="13265047" author="stack" created="Mon, 30 Apr 2012 17:46:05 +0000"  >&lt;p&gt;I suppose it would make sense backing it out.  We could roll a 0.90.7?&lt;/p&gt;</comment>
                            <comment id="13265079" author="dsw" created="Mon, 30 Apr 2012 18:18:35 +0000"  >&lt;p&gt;I have a patch to back it out and will post it once I have test it more.  The patch seems to make things compatible again but I want to make sure it doesn&apos;t break anything else.  Look for it in a day or two.&lt;/p&gt;</comment>
                            <comment id="13266120" author="stack" created="Tue, 1 May 2012 21:22:33 +0000"  >&lt;p&gt;@David Ignore my query over in hbase-5155.  I should probably run a 0.90.7 once it goes in...&lt;/p&gt;</comment>
                            <comment id="13269808" author="dsw" created="Mon, 7 May 2012 17:41:43 +0000"  >&lt;p&gt;Revert &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;.  Should apply only to 0.90 branch.&lt;/p&gt;</comment>
                            <comment id="13269811" author="dsw" created="Mon, 7 May 2012 17:43:25 +0000"  >&lt;p&gt;I added a patch off of 0.90 to revert &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;.  I&apos;ll throw this on RB as well, but wanted to kick off Hadoop QA bot now.  Note that all unit tests for me except for org.apache.hadoop.hbase.TestZooKeeper.testClientSessionExpired, which fails fairly consistently with or without this change.&lt;/p&gt;</comment>
                            <comment id="13269854" author="hadoopqa" created="Mon, 7 May 2012 18:32:20 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12525885/HBASE-5904.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12525885/HBASE-5904.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    +1 tests included.  The patch appears to include 15 new or modified tests.&lt;/p&gt;

&lt;p&gt;    -1 patch.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/1791//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/1791//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13271950" author="dsw" created="Wed, 9 May 2012 23:38:24 +0000"  >&lt;p&gt;The patch did not apply because it&apos;s against 0.90, which it seems always fails with the QA robot.&lt;/p&gt;

&lt;p&gt;Anyone care to take a stab at the review?  I thought it was a fairly straightforward revert.&lt;/p&gt;</comment>
                            <comment id="13272079" author="ram_krish" created="Thu, 10 May 2012 04:46:25 +0000"  >&lt;p&gt;@David&lt;br/&gt;
I saw your patch at a glance.  So this patch will not address &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;? &lt;/p&gt;</comment>
                            <comment id="13272084" author="dsw" created="Thu, 10 May 2012 04:59:27 +0000"  >&lt;p&gt;I thought that was what we agreed upon earlier.  At least that is the impression that I got from reading the earlier comments.&lt;/p&gt;

&lt;p&gt;Do you think there is a way to keep the part of the patch with the actual fix, without having the incompatible ZK behavior?&lt;/p&gt;</comment>
                            <comment id="13274084" author="stack" created="Sat, 12 May 2012 22:13:19 +0000"  >&lt;p&gt;@Ram As I read it above, we are about backing out hbase-5155   Thats what your patch does David?  If so, I&apos;m +1 on applying it to 0.90.&lt;/p&gt;</comment>
                            <comment id="13274085" author="stack" created="Sat, 12 May 2012 22:13:49 +0000"  >&lt;p&gt;Making this a blocker on 0.90.7 so we don&apos;t forget it.&lt;/p&gt;</comment>
                            <comment id="13274101" author="dsw" created="Sun, 13 May 2012 00:11:55 +0000"  >&lt;p&gt;Stack: That (backing out &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt; only) is what my patch does.&lt;/p&gt;</comment>
                            <comment id="13279279" author="stack" created="Fri, 18 May 2012 22:47:28 +0000"  >&lt;p&gt;@Ram I will apply David&apos;s patch that backs hbase-5155 out of 0.90 tomorrow.  Let us know if you have issue w/ that.&lt;/p&gt;</comment>
                            <comment id="13401019" author="jmhsieh" created="Mon, 25 Jun 2012 23:28:04 +0000"  >&lt;p&gt;I&apos;m testing this patch currently (which is a revert of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5155&quot; title=&quot;ServerShutDownHandler And Disable/Delete should not happen parallely leading to recreation of regions that were deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5155&quot;&gt;&lt;del&gt;HBASE-5155&lt;/del&gt;&lt;/a&gt;) and plan on committing for 0.90.7 if it is clean unless I hear any complaints.&lt;/p&gt;</comment>
                            <comment id="13401105" author="jmhsieh" created="Tue, 26 Jun 2012 01:55:10 +0000"  >&lt;p&gt;Tests pass.  Will commit tomorrow.&lt;/p&gt;</comment>
                            <comment id="13401173" author="ram_krish" created="Tue, 26 Jun 2012 05:08:52 +0000"  >&lt;p&gt;+1.  &lt;br/&gt;
@Stack&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Let us know if you have issue w/ that.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;No problem.&lt;/p&gt;</comment>
                            <comment id="13402209" author="jmhsieh" created="Wed, 27 Jun 2012 13:11:37 +0000"  >&lt;p&gt;Thanks for the patch Dave, Thanks for reviews Stack and Ram.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12525885" name="HBASE-5904.patch" size="27252" author="dsw" created="Mon, 7 May 2012 17:41:01 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 30 Apr 2012 15:50:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>237531</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 25 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i05i13:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>30018</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310192" key="com.atlassian.jira.plugin.system.customfieldtypes:textarea">
                        <customfieldname>Release Note</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>This reverts a patch included in 0.90.6 that broke compatibility.  </customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                    <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>