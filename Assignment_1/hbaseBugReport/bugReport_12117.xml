<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:29:53 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-12117/HBASE-12117.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-12117] Constructors that use Configuration may be harmful</title>
                <link>https://issues.apache.org/jira/browse/HBASE-12117</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There&apos;s a common pattern in HBase code where in the constructor, or in an initialization method also called once per instantiation, or both, we look up values from Hadoop Configuration and store them into fields. This can be expensive if the object is frequently created. Configuration is a heavyweight registry that does a lot of string operations and regex matching. See attached example. Method calls into Configuration account for 48.25% of CPU time when creating the HTable object in 0.98. (The remainder is spent instantiating the RPC controller via reflection, a separate issue that merits followup elsewhere.) Creation of HTable instances is expected to be a lightweight operation if a client is using unmanaged HConnections; however creating HTable instances takes up about 18% of the client&apos;s total on-CPU time. This is just one example where constructors that use Configuration may be harmful.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12744854">HBASE-12117</key>
            <summary>Constructors that use Configuration may be harmful</summary>
                <type id="14" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/genericissue.png">Umbrella</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Tue, 30 Sep 2014 02:25:36 +0000</created>
                <updated>Tue, 30 Sep 2014 23:00:51 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                            <aggregatetimeoriginalestimate seconds="432000">120h</aggregatetimeoriginalestimate>
                                        <aggregatetimeremainingestimate seconds="172800">48h</aggregatetimeremainingestimate>
                                        <aggregatetimespent seconds="259200">72h</aggregatetimespent>
                                    <comments>
                            <comment id="14152856" author="stack" created="Tue, 30 Sep 2014 06:34:56 +0000"  >&lt;p&gt;Nice graph &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;  How did you make the traces.client.c.svg graph, what loading produced it,  and how does it relate to traces.client.c.svg?  I see in the latter we spend most CPU reading and writing.  Is the former a portion of this latter graph or another loading?&lt;/p&gt;</comment>
                            <comment id="14152868" author="apurtell" created="Tue, 30 Sep 2014 06:48:04 +0000"  >&lt;p&gt;This was YCSB running against an all localhost 0.98 cluster. The old YCSB client. This is workload C. traces.client.getHTable.svg is traces.client.c.svg with all sampled call arcs filtered out except those that go through getHTable, in effect zooming in on a portion of the full trace. Workload C is an all read workload. This is a client trace.&lt;/p&gt;</comment>
                            <comment id="14152872" author="stack" created="Tue, 30 Sep 2014 06:54:04 +0000"  >&lt;p&gt;So the focus is on 17% of overall CPU &amp;#8211; the finishSetup of HTable &amp;#8211; and of this most is just getting Configuration.  Yuck.  This is our making an HTable instance per session?  We keep it around?  HTable ain&apos;t that lightweight then?  Any chance of caching some config in Connection for instance?&lt;/p&gt;</comment>
                            <comment id="14153312" author="apurtell" created="Tue, 30 Sep 2014 15:58:03 +0000"  >&lt;p&gt;Yeah I don&apos;t think HTable is as lightweight as we want because if an app manages its own HConnection and creates an HTable for each interaction - as we recommend - then it can pay this unexpected cost as much as ~20% of CPU time. This is one example where using Configuration to set up an object is expensive. Found this when looking at something else. &lt;/p&gt;

&lt;p&gt;Yes I think we could cache configuration in Connection. We are using it like a factory for HTable. Object factories would one way to address this (anti?)pattern wherever it&apos;s costly.&lt;/p&gt;

&lt;p&gt;Related, we should also create by reflection once and cache the desired RpcController object, and clone it for new HTables for the Connection.  &lt;/p&gt;</comment>
                            <comment id="14153960" author="apurtell" created="Tue, 30 Sep 2014 23:00:51 +0000"  >&lt;p&gt; I created &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12128&quot; title=&quot;Cache configuration and RpcController selection for Table in Connection&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12128&quot;&gt;&lt;del&gt;HBASE-12128&lt;/del&gt;&lt;/a&gt; for the specific case mentioned above and changed this to an umbrella to catch more instances of the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12671944" name="traces.client.c.svg" size="248885" author="apurtell" created="Tue, 30 Sep 2014 02:26:14 +0000"/>
                            <attachment id="12671945" name="traces.client.getHTable.svg" size="100799" author="apurtell" created="Tue, 30 Sep 2014 02:26:14 +0000"/>
                    </attachments>
                <subtasks>
                            <subtask id="12745106">HBASE-12128</subtask>
                            <subtask id="12758563">HBASE-12604</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 30 Sep 2014 06:34:56 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 11 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i20m9j:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>