<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:41:52 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7011/HBASE-7011.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7011] log rolling and cache flushing should be able to proceed in parallel</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7011</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Today, during a memstore flush (snapshot of memstore + flushing to disk), log rolling cannot happen. This seems like a bad design, and an unnecessary restriction. &lt;/p&gt;

&lt;p&gt;Possible reasons cited for this in code are:&lt;br/&gt;
&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; maintenance of the lastSeqWritten map.&lt;br/&gt;
(ii) writing a &quot;completed-cache-flush&quot; marker into the same log before the roll.&lt;/p&gt;

&lt;p&gt;It seems that we can implement a new design for &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; to avoid holding the lock for the entire duration of the flush. And the motivation for (ii) is not even clear. We should reason this out, and make sure we can relax the restriction. &lt;span class=&quot;error&quot;&gt;&amp;#91;See related discussion in HBASE-6980.&amp;#93;&lt;/span&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12612504">HBASE-7011</key>
            <summary>log rolling and cache flushing should be able to proceed in parallel</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="kannanm">Kannan Muthukkaruppan</assignee>
                                    <reporter username="kannanm">Kannan Muthukkaruppan</reporter>
                        <labels>
                    </labels>
                <created>Thu, 18 Oct 2012 22:22:39 +0000</created>
                <updated>Fri, 25 Jan 2013 20:23:28 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13479481" author="stack" created="Thu, 18 Oct 2012 23:36:00 +0000"  >&lt;p&gt;Is the special COMPLETE_CACHE_FLUSH edit even used anywhere?&lt;/p&gt;</comment>
                            <comment id="13479482" author="stack" created="Thu, 18 Oct 2012 23:36:30 +0000"  >&lt;p&gt;Pardon, I meant to say, I see us writing it but I do not see us taking special action when ever we come across it reading.&lt;/p&gt;</comment>
                            <comment id="13479545" author="kannanm" created="Fri, 19 Oct 2012 01:05:58 +0000"  >&lt;p&gt;Stack: Yes, that was one of the questions I posed in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6980&quot; title=&quot;Parallel Flushing Of Memstores [89-fb]&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6980&quot;&gt;&lt;del&gt;HBASE-6980&lt;/del&gt;&lt;/a&gt;, and decided to fork off the issue into this JIRA. Todd&apos;s theory is this flush marker is a write to the HLog just to ensure the RS has not been fenced off by master (because master thought this RS was dead).&lt;/p&gt;

&lt;p&gt;Todd wrote: &amp;lt;&amp;lt;&amp;lt; If I remember correctly, there is a reason for the flush marker: it ensures that the RS hasn&apos;t been fenced on HDFS &#8211; i.e that it hasn&apos;t lost its connection to ZK and already had its log splitting started. The reason this is important is that, otherwise, it could move on to delete old log segments, which would potentially break the log split process.&amp;gt;&amp;gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;My response: &amp;lt;&amp;lt;&amp;lt; If RS zk expires, and master initiates recovery/log splitting, then the first step is to rename the log directory from .logs/rs to .logs/rs-splitting. And then the lease recovery is done on the individual files within the directory. Because of the directory name, any attempt by the old RS to delete any old log files (in the old path) should fail. Therefore, still not seeing the value of writing the flush marker.&amp;gt;&amp;gt;&amp;gt;&lt;/p&gt;
</comment>
                            <comment id="13479612" author="stack" created="Fri, 19 Oct 2012 05:00:01 +0000"  >&lt;p&gt;I like Todd&apos;s reasoning.  Not sure that the original intent.  It looks like we&apos;ve been writing special bytes on flush completion to the WAL since first check in (See &apos;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-287&quot; title=&quot;Code for HBase&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-287&quot;&gt;&lt;del&gt;HADOOP-1045&lt;/del&gt;&lt;/a&gt;.  Add contrib/hbase, a BigTable-like online database.&apos;  Look in HLog#completeCacheFlush).  It looks like the intent was other than what Todd described going by comments at head of the class and the described intent as never implemented.  Grep CACHEFLUSH.&lt;/p&gt;

&lt;p&gt;Your recounting of how things works now sounds good.   You say the zombie RS &apos;should fail&apos; when the dir is renamed under it.  I haven&apos;t looked but if we don&apos;t already, sounds like we should add a test that proves it.&lt;/p&gt;

&lt;p&gt;Good on you Kannan.&lt;/p&gt;</comment>
                            <comment id="13536301" author="sershe" created="Wed, 19 Dec 2012 18:57:30 +0000"  >&lt;p&gt;Will do it as part of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7329&quot; title=&quot;remove flush-related records from WAL and make locking more granular&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7329&quot;&gt;&lt;del&gt;HBASE-7329&lt;/del&gt;&lt;/a&gt; on trunk&lt;/p&gt;</comment>
                            <comment id="13562993" author="sershe" created="Fri, 25 Jan 2013 20:23:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7329&quot; title=&quot;remove flush-related records from WAL and make locking more granular&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7329&quot;&gt;&lt;del&gt;HBASE-7329&lt;/del&gt;&lt;/a&gt; was committed. This is now probably a dup&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12623427">HBASE-7329</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 18 Oct 2012 23:36:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>249684</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 46 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0agdz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>58928</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>