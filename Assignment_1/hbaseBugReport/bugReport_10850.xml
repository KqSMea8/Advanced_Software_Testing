<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:17:46 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-10850/HBASE-10850.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-10850] essential column family optimization is broken</title>
                <link>https://issues.apache.org/jira/browse/HBASE-10850</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When using the filter SingleColumnValueFilter, and depending of the columns specified in the scan (filtering column always specified), the results can be different.&lt;/p&gt;

&lt;p&gt;Here is an example.&lt;br/&gt;
Suppose the following table:&lt;/p&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;key&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;a:foo&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;a:bar&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;b:foo&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;b:bar&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;false&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;em&gt;flag&lt;/em&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;em&gt;flag&lt;/em&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;em&gt;flag&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;true&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;em&gt;flag&lt;/em&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;em&gt;flag&lt;/em&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;em&gt;flag&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;em&gt;flag&lt;/em&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;em&gt;flag&lt;/em&gt;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&lt;em&gt;flag&lt;/em&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;


&lt;p&gt;With this filter:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
SingleColumnValueFilter filter = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SingleColumnValueFilter(Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;), CompareOp.EQUAL, &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; BinaryComparator(Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;&lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;&quot;&lt;/span&gt;)));
filter.setFilterIfMissing(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Depending of how I specify the list of columns to add in the scan, the result is different. Yet, all examples below should always return only the first row (key &apos;1&apos;):&lt;/p&gt;

&lt;p&gt;OK:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scan.addFamily(Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;KO (2 results returned, row &apos;3&apos; without &apos;a:foo&apos; qualifier is returned):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scan.addFamily(Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;));
scan.addFamily(Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;KO (2 results returned, row &apos;3&apos; without &apos;a:foo&apos; qualifier is returned):&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scan.addColumn(Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;));
scan.addColumn(Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;));
scan.addColumn(Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;OK:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scan.addColumn(Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;));
scan.addColumn(Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;b&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;OK:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
scan.addColumn(Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;foo&quot;&lt;/span&gt;));
scan.addColumn(Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;), Bytes.toBytes(&lt;span class=&quot;code-quote&quot;&gt;&quot;bar&quot;&lt;/span&gt;));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This is a regression as it was working properly on HBase 0.92.&lt;br/&gt;
You will find in attachement the unit tests reproducing the issue.&lt;/p&gt;

&lt;p&gt;&lt;ins&gt;The analysis of this issue lead us to 2 critical bugs induced in 96 and above versions&lt;/ins&gt;&lt;br/&gt;
1. The essential family optimization is broken in some cases.  In case of condition on some families, we 1st will read those KVs and apply condition on those, when the condition says to filter out that row, we will not go ahead and fetch data from remaining non essential CFs. But now in most of the cases we will do this unwanted data read which is fully against this optimization&lt;br/&gt;
2. We have a CP hook postFilterRow() which will be called when a row is getting filtered out by the Filter.  This gives the CP to do a reseek to the next known row which it thinks can evaluate the condition to true. But currently in 96+ code , this hook is not getting called.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12703955">HBASE-10850</key>
            <summary>essential column family optimization is broken</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="1" iconUrl="https://issues.apache.org/jira/images/icons/priorities/blocker.png">Blocker</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="flegallo">Fabien Le Gallo</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Mar 2014 11:13:56 +0000</created>
                <updated>Sat, 21 Feb 2015 23:28:49 +0000</updated>
                            <resolved>Thu, 3 Apr 2014 19:51:42 +0000</resolved>
                                    <version>0.96.1.1</version>
                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>0.98.2</fixVersion>
                    <fixVersion>0.96.3</fixVersion>
                                    <component>Coprocessors</component>
                    <component>Filters</component>
                    <component>Performance</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>13</watches>
                                                                <comments>
                            <comment id="13949230" author="haosdent@gmail.com" created="Thu, 27 Mar 2014 12:37:55 +0000"  >&lt;p&gt;Reproduce this issue on MiniCluster. &lt;/p&gt;</comment>
                            <comment id="13949292" author="haosdent@gmail.com" created="Thu, 27 Mar 2014 13:25:51 +0000"  >&lt;p&gt;It seems because the column family &quot;b&quot; has a same qualifier &quot;boo&quot; with &quot;a&quot;.&lt;/p&gt;</comment>
                            <comment id="13949365" author="flegallo" created="Thu, 27 Mar 2014 14:09:53 +0000"  >&lt;p&gt;No, I just tried with different qualifiers for families &apos;a&apos; and &apos;b&apos; and I got the same result.&lt;/p&gt;</comment>
                            <comment id="13949389" author="haosdent@gmail.com" created="Thu, 27 Mar 2014 14:33:31 +0000"  >&lt;p&gt;It seems because of this minor error. After I change&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The only CF this filter needs is given column family. So, it&apos;s the only essential&lt;/li&gt;
	&lt;li&gt;column in whole scan. If filterIfMissing == false, all families are essential,&lt;/li&gt;
	&lt;li&gt;because of possibility of skipping the rows without any data in filtered CF.&lt;br/&gt;
   */&lt;br/&gt;
  public boolean isFamilyEssential(byte[] name) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
    return !this.filterIfMissing || Bytes.equals(name, this.columnFamily);
  }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt;
&lt;p&gt;to &lt;br/&gt;
&lt;blockquote&gt;
&lt;p&gt;  /**&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;The only CF this filter needs is given column family. So, it&apos;s the only essential&lt;/li&gt;
	&lt;li&gt;column in whole scan. If filterIfMissing == true, all families are essential,&lt;/li&gt;
	&lt;li&gt;because of possibility of skipping the rows without any data in filtered CF.&lt;br/&gt;
   */&lt;br/&gt;
  public boolean isFamilyEssential(byte[] name) 
&lt;div class=&quot;error&quot;&gt;&lt;span class=&quot;error&quot;&gt;Unknown macro: {
    return this.filterIfMissing || Bytes.equals(name, this.columnFamily);
  }&lt;/span&gt; &lt;/div&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/blockquote&gt; in SingleColumnValueFilter, I pass your test cases.&lt;/p&gt;</comment>
                            <comment id="13949440" author="flegallo" created="Thu, 27 Mar 2014 15:22:33 +0000"  >&lt;p&gt;Great finding!&lt;br/&gt;
It works perfectly now.&lt;br/&gt;
I&apos;m suprised a bug like this existed for so long. I think unit tests should be improved to handle this case. &lt;/p&gt;

&lt;p&gt;I don&apos;t know about your workflow: am I the one supposed to change this issue as resolved ?&lt;/p&gt;</comment>
                            <comment id="13949453" author="haosdent@gmail.com" created="Thu, 27 Mar 2014 15:33:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=flegallo&quot; class=&quot;user-hover&quot; rel=&quot;flegallo&quot;&gt;Fabien Le Gallo&lt;/a&gt; Thank you for your report and test cases. It make me find this bug more quickly. I would add unit test later. After other committers review and advice, the status of this issue would change to fixed.&lt;/p&gt;</comment>
                            <comment id="13949512" author="hadoopqa" created="Thu, 27 Mar 2014 16:19:42 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12637152/HBASE-10850.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12637152/HBASE-10850.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12637152&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 6 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.TestAssignmentManagerOnCluster&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.mapreduce.TestTableMapReduceBase.testMultiRegionTable(TestTableMapReduceBase.java:96)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9111//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13949682" author="anoop.hbase" created="Thu, 27 Mar 2014 17:40:51 +0000"  >&lt;p&gt;In these tests, when filterIfMissing is set as false the assertion to be 2 right ie. key 1 and 3.    But with patch , this condition doesnot pass.&lt;/p&gt;</comment>
                            <comment id="13949946" author="yuzhihong@gmail.com" created="Thu, 27 Mar 2014 21:19:27 +0000"  >&lt;p&gt;@Fabien:&lt;br/&gt;
I slightly modified attached test so that it compiles in trunk.&lt;/p&gt;

&lt;p&gt;Since there is no cluster started, there was no progress when running the test.&lt;/p&gt;

&lt;p&gt;Can you look at tests in hbase-server/src/test/java/org/apache/hadoop/hbase/filter ?&lt;/p&gt;

&lt;p&gt;Thanks&lt;/p&gt;</comment>
                            <comment id="13950337" author="anoop.hbase" created="Fri, 28 Mar 2014 04:04:32 +0000"  >
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HRegion#nextInternal(List&amp;lt;Cell&amp;gt; results, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; limit)
  &lt;span class=&quot;code-comment&quot;&gt;// save that the row was empty before filters applied to it.
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isEmptyRow = results.isEmpty();

  &lt;span class=&quot;code-comment&quot;&gt;// We have the part of the row necessary &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; filtering (all of it, usually).
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;// First filter with the filterRow(List).
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (filter != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; filter.hasFilterRow()) {
	filter.filterRowCells(results);
  }
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isEmptyRow || filterRow()) {
  ...


&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; filterRow() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
  &lt;span class=&quot;code-comment&quot;&gt;// when hasFilterRow returns &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, filter.filterRow() will be called automatically inside
&lt;/span&gt;  &lt;span class=&quot;code-comment&quot;&gt;// filterRowCells(List&amp;lt;Cell&amp;gt; kvs) so we skip that scenario here.
&lt;/span&gt;  &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; filter != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; (!filter.hasFilterRow())
	  &amp;amp;&amp;amp; filter.filterRow();
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In 96+ version filterRowCells(List) is internally calling filterRow() also  and if that return true, just clears the passed cells list. (SCVF uses filterRow())  And u can see private boolean filterRow()  wont get executed because of this (!filter.hasFilterRow()).&lt;br/&gt;
results is no empty before applying the 1st filter op.  &lt;/p&gt;

&lt;p&gt;So here we have to make change as&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (results.isEmpty() || filterRow()) {
  ....
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Pls correct if I am wrong..&lt;/p&gt;</comment>
                            <comment id="13950339" author="anoop.hbase" created="Fri, 28 Mar 2014 04:05:43 +0000"  >&lt;p&gt;Ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13950416" author="lhofhansl" created="Fri, 28 Mar 2014 05:56:19 +0000"  >&lt;p&gt;Interesting. I&apos;d have to think about this a bit.&lt;/p&gt;</comment>
                            <comment id="13950619" author="anoop.hbase" created="Fri, 28 Mar 2014 12:13:42 +0000"  >&lt;p&gt;// save that the row was empty before filters applied to it.&lt;br/&gt;
  final boolean isEmptyRow = results.isEmpty();&lt;/p&gt;

&lt;p&gt;This is needed in this place only I guess.  When there were kvs in result and after apply filterRowCells(List), all got removed, still we have to go ahead with fetching kvs from non essential families..  Only when the filterRow() says to filter this row, we can avoid this reads.&lt;/p&gt;

&lt;p&gt;So this has become very tricky now!!&lt;/p&gt;

&lt;p&gt;Can we seperate out the filterRowCell(List) and filterRow() ?  Now both done in FilterWrapper.  Seems this is the only way!!&lt;/p&gt;</comment>
                            <comment id="13950623" author="anoop.hbase" created="Fri, 28 Mar 2014 12:20:22 +0000"  >&lt;p&gt;Attaching test patch to see what QA says.&lt;/p&gt;</comment>
                            <comment id="13950626" author="anoop.hbase" created="Fri, 28 Mar 2014 12:22:33 +0000"  >&lt;p&gt;With this change all the tests in the attached test class working correctly when filterIfMissing is true/false.&lt;/p&gt;</comment>
                            <comment id="13951024" author="hadoopqa" created="Fri, 28 Mar 2014 16:53:50 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12637380/HBASE-10850_V2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12637380/HBASE-10850_V2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12637380&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 6 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.filter.TestFilterWrapper&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9127//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13956061" author="anoop.hbase" created="Tue, 1 Apr 2014 03:23:45 +0000"  >&lt;p&gt;Attached is the same test class (But changed to use Mini cluster)&lt;/p&gt;</comment>
                            <comment id="13957090" author="yuzhihong@gmail.com" created="Tue, 1 Apr 2014 22:24:32 +0000"  >&lt;p&gt;I tried a few approaches but couldn&apos;t keep all tests pass.&lt;/p&gt;

&lt;p&gt;For Filter interface, there is no method that exposes the concept of filterIfMissing. This makes handling inside HRegion#RegionScannerImpl#nextInternal() tricky.&lt;/p&gt;

&lt;p&gt;For Fabien&apos;s case, filterIfMissing is set as true - client checks the returned rows one more time.&lt;/p&gt;</comment>
                            <comment id="13957186" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 00:25:03 +0000"  >&lt;p&gt;Here is an experimental patch.&lt;/p&gt;

&lt;p&gt;In HRegion, filterRow() would depend on filter.hasFilterRow() to be consistent with filter.filterRow().&lt;/p&gt;

&lt;p&gt;With this approach, TestFilter#tes94FilterRowCompatibility() would be broken. This should be acceptable in context of hbase 1.0&lt;/p&gt;

&lt;p&gt;There are two tests in TestFilterList which I need to fix - the tests use filterRow().&lt;/p&gt;

&lt;p&gt;Please comment.&lt;/p&gt;
</comment>
                            <comment id="13957285" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 03:06:37 +0000"  >&lt;p&gt;Patch v2 modifies FilterList#filterRow(List&amp;lt;KeyValue&amp;gt;)&lt;/p&gt;

&lt;p&gt;All Filter related tests pass except for TestFilter#tes94FilterRowCompatibility&lt;/p&gt;</comment>
                            <comment id="13957311" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 03:57:38 +0000"  >&lt;p&gt;With patch v2, the test Fabien provided passed.&lt;/p&gt;</comment>
                            <comment id="13957328" author="hadoopqa" created="Wed, 2 Apr 2014 04:32:22 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12638188/10850-hasFilterRow-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12638188/10850-hasFilterRow-v2.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12638188&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 6 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.filter.TestFilter&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9170//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13957342" author="anoop.hbase" created="Wed, 2 Apr 2014 05:05:22 +0000"  >&lt;p&gt;So Filter#filterRow() will get called twice? &lt;/p&gt;</comment>
                            <comment id="13957368" author="anoop.hbase" created="Wed, 2 Apr 2014 05:43:52 +0000"  >&lt;p&gt;I fear the optimization of essential CF is broken!&lt;br/&gt;
So this is not a case with SCVF filterIfMissing alone.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
         &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isEmptyRow = results.isEmpty();

          &lt;span class=&quot;code-comment&quot;&gt;// We have the part of the row necessary &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; filtering (all of it, usually).
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// First filter with the filterRow(List).
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (filter != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; filter.hasFilterRow()) {
            filter.filterRowCells(results);
          }
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isEmptyRow || filterRow()) {
            results.clear();
            &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; moreRows = nextRow(currentRow, offset, length);
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!moreRows) &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;

            &lt;span class=&quot;code-comment&quot;&gt;// This row was totally filtered out, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is NOT the last row,
&lt;/span&gt;            &lt;span class=&quot;code-comment&quot;&gt;// we should &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt; on. Otherwise, nothing &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt;.
&lt;/span&gt;            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!stopRow) &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
            &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
          }

          &lt;span class=&quot;code-comment&quot;&gt;// Ok, we are done with storeHeap &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; row.
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// Now we may need to fetch additional, non-essential data into row.
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// These values are not needed &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; filter to work, so we postpone their
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// fetch to (possibly) reduce amount of data loads from disk.
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.joinedHeap != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
            KeyValue nextJoinedKv = joinedHeap.peek();
.....
...
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; filterRow() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
      &lt;span class=&quot;code-comment&quot;&gt;// when hasFilterRow returns &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, filter.filterRow() will be called automatically inside
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// filterRowCells(List&amp;lt;Cell&amp;gt; kvs) so we skip that scenario here.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; filter != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !filter.hasFilterRow()
          &amp;amp;&amp;amp; filter.filterRow();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So here 1st we have scanned the essential CFs and filter is applied. isEmptyRow  is false initially but FilterWarpper#filterRowCells(List) cleared that results list. &lt;br/&gt;
isEmptyRow boolean is false only and a call to filterRow() will return false always.&lt;br/&gt;
Because of this we will continue with scan on the non essential CF.  This is against the optimization!!!&lt;br/&gt;
Also we added postScannerFilterRow CP hook in such a case where Filter is filtering out a row. I fear this call also wont happen now as we are not going inside the if (isEmptyRow || filterRow()) block.&lt;/p&gt;</comment>
                            <comment id="13957390" author="anoop.hbase" created="Wed, 2 Apr 2014 06:30:16 +0000"  >&lt;p&gt;Here the issue comes when u r selecting mutiple qualifiers from the essential family and the condition is not on the 1st column.  In the test the condition is on the second ie. a:foo and the tests which were selecting foo.bar also in the scan are getting failed..  In this same scenario the essential family optimization also broken if I am not wrong. &lt;/p&gt;

&lt;p&gt;Also HIndex from Huawei is based on the postScannerFilterRow CP hook.  I can see this is also not getting called in the above cases. Ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=rajesh23&quot; class=&quot;user-hover&quot; rel=&quot;rajesh23&quot;&gt;rajeshbabu&lt;/a&gt;.. Any chance you got to test the scan perf with HBase 98 or Trunk?&lt;/p&gt;</comment>
                            <comment id="13957452" author="ram_krish" created="Wed, 2 Apr 2014 08:19:57 +0000"  >&lt;blockquote&gt;&lt;p&gt;I fear the optimization of essential CF is broken!&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes, it is.  So with 0.94 it is not a problem but with 0.96+ it should be.&lt;br/&gt;
With SCVF as a filter and when there are some results, filterRow() will always return false. &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; filterRow() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
      &lt;span class=&quot;code-comment&quot;&gt;// when hasFilterRow returns &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, filter.filterRow() will be called automatically inside
&lt;/span&gt;      &lt;span class=&quot;code-comment&quot;&gt;// filterRowCells(List&amp;lt;Cell&amp;gt; kvs) so we skip that scenario here.
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; filter != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; 
          &amp;amp;&amp;amp; filter.filterRow();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should work or if isemptyRow is false and results.size() is empty then we know that the row has been filtered.  I don think we should again check with filter.filterRow(), but need to see if any other filter gets affected if hasFilterRow is false().&lt;/p&gt;</comment>
                            <comment id="13957459" author="rajesh23" created="Wed, 2 Apr 2014 08:30:37 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Any chance you got to test the scan perf with HBase 98 or Trunk?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Not done any performance tests with 0.98 or trunk. &lt;/p&gt;

&lt;p&gt;I too found this issue when I am porting secondary index patch to trunk. One of the test case with SCVFs is passing in 0.94 but not in trunk. &lt;br/&gt;
Some how I have missed to report it. &lt;/p&gt;
</comment>
                            <comment id="13957465" author="anoop.hbase" created="Wed, 2 Apr 2014 08:36:23 +0000"  >&lt;p&gt;In the existing code, whatever be the hasFilterRow() returns,  the boolean filterRow() method is getting called. &lt;br/&gt;
Inside FilterWrapper#filterRowCells(List)   if hasFilterRow() return true. Otherwise in HRegion#filterRow() &lt;br/&gt;
So I believe we can avoid the way FilterWrapper#filterRowCells(List) handling both the filter methods in one place.   (Just do how we used to handle these in 94)  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10850&quot; title=&quot;essential column family optimization is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10850&quot;&gt;&lt;del&gt;HBASE-10850&lt;/del&gt;&lt;/a&gt;_V2.patch is doing this.&lt;br/&gt;
Do we need changes in FilterList and some other filters Ted?&lt;/p&gt;
</comment>
                            <comment id="13957469" author="ram_krish" created="Wed, 2 Apr 2014 08:46:07 +0000"  >&lt;p&gt;Yes. Call filterRow() only once.   Need not be called twice.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;&apos;s patch does that. (by reverting to old way).&lt;br/&gt;
Still if we want to keep the code same may be we can check the results size after seeing ifEmptyRow as false.  This shows that filterRowCells() has cleared the result. &lt;/p&gt;</comment>
                            <comment id="13957531" author="hadoopqa" created="Wed, 2 Apr 2014 10:48:36 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12638194/10850-hasFilterRow-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12638194/10850-hasFilterRow-v3.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12638194&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 9 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestHCM&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9176//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13957820" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 15:59:10 +0000"  >&lt;p&gt;Patch v4 is much simpler.&lt;/p&gt;

&lt;p&gt;Following tests passed:&lt;br/&gt;
mt -Dtest=&amp;#42;Filter&amp;#42;&lt;/p&gt;

&lt;p&gt;Fabien&apos;s test also passed.&lt;/p&gt;</comment>
                            <comment id="13957856" author="anoop.hbase" created="Wed, 2 Apr 2014 16:35:21 +0000"  >&lt;p&gt;When results is cleared by a call to filterRowCells(List) then also we will treat it as a filter row . Is that correct?  Atleast it should not call the CP hook postScannerFilterRow in that case.&lt;br/&gt;
IMHO the best way is to go back to 94 way of handling filterRowCells(List) and filterRow() in diff places.&lt;br/&gt;
As per the essential CF idea also skip the scan of non essential CF data only when filterRow() says to filter out the entire row.&lt;/p&gt;</comment>
                            <comment id="13957875" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 16:48:36 +0000"  >&lt;blockquote&gt;&lt;p&gt;When results is cleared by a call to filterRowCells(List) then also we will treat it as a filter row&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes. FilterWrapper#filterRowCells() calls filter.filterRow()&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Atleast it should not call the CP hook postScannerFilterRow in that case.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can you elaborate why ?&lt;/p&gt;</comment>
                            <comment id="13957885" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 16:57:08 +0000"  >&lt;blockquote&gt;&lt;p&gt;back to 94 way of handling filterRowCells(List) and filterRow() in diff places.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I searched 0.94 codebase but didn&apos;t find filterRowCells method.&lt;/p&gt;</comment>
                            <comment id="13957897" author="anoop.hbase" created="Wed, 2 Apr 2014 17:07:45 +0000"  >&lt;p&gt;I mean this Ted&lt;br/&gt;
In HRegion#nextInternal(List&amp;lt;KeyValue&amp;gt; results, int limit, String metric)&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; isEmptyRow = results.isEmpty();

          &lt;span class=&quot;code-comment&quot;&gt;// We have the part of the row necessary &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; filtering (all of it, usually).
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// First filter with the filterRow(List).            
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (filter != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; filter.hasFilterRow()) {
            filter.filterRow(results);
          }

          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isEmptyRow || filterRow()) {
...

 &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; filterRow() {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; filter != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
          &amp;amp;&amp;amp; filter.filterRow();
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The same I was doing in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10850&quot; title=&quot;essential column family optimization is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10850&quot;&gt;&lt;del&gt;HBASE-10850&lt;/del&gt;&lt;/a&gt;_V2.patch&lt;/p&gt;

&lt;p&gt;That failed one test.. I am checking that failure&lt;/p&gt;</comment>
                            <comment id="13957901" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 17:14:27 +0000"  >&lt;p&gt;In your approach, when filter.hasFilterRow() returns true, filter.filterRow() would be called twice, right ?&lt;/p&gt;</comment>
                            <comment id="13957902" author="anoop.hbase" created="Wed, 2 Apr 2014 17:18:56 +0000"  >&lt;p&gt;No.. See the change in FilterWrapper&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void filterRowCells(List&amp;lt;Cell&amp;gt; kvs) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
-    &lt;span class=&quot;code-comment&quot;&gt;//To fix HBASE-6429,
&lt;/span&gt;-    &lt;span class=&quot;code-comment&quot;&gt;//Filter with filterRow() returning &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; is incompatible with scan with limit
&lt;/span&gt;-    &lt;span class=&quot;code-comment&quot;&gt;//1. hasFilterRow() returns &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; either filterRow() or filterRow(kvs) is implemented.
&lt;/span&gt;-    &lt;span class=&quot;code-comment&quot;&gt;//2. filterRow() is merged with filterRow(kvs),
&lt;/span&gt;-    &lt;span class=&quot;code-comment&quot;&gt;//so that to make all those row related filtering stuff in the same function.
&lt;/span&gt;     &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.filter.filterRowCells(kvs);
-    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!kvs.isEmpty() &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.filter.filterRow()) {
-      kvs.clear();
-    }
   }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13957918" author="anoop.hbase" created="Wed, 2 Apr 2014 17:31:54 +0000"  >&lt;p&gt;I was also initially thinking that we can move the results empty check down after calling the filterRowCells()&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10850?focusedCommentId=13950337&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13950337&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-10850?focusedCommentId=13950337&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13950337&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;But later relized there is an issue.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;When results is cleared by a call to filterRowCells(List) then also we will treat it as a filter row. Is that correct?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Actually this is not correct. Consider the below Scan with Filter&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Scan s = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Scan();
s.addColumn(F1, Q1);
s.addFamily(F2);
SingleColumnValueExcludeFilter f = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SingleColumnValueExcludeFilter(F1, Q1, CompareOp.EQUAL, V1);
s.setFilter(f);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here F1 is essential CF and F2 is not. From F1 we scan only Q1 column and we have a SingleColumnValueExcludeFilter on this.  &lt;br/&gt;
Now for a row for which the condition is satisfied we will get the List &apos;results&apos; with one entry before calling filterRowCells(List). But once we call this the results will get cleared by the filterRowCells in SCVEF. This doesn&apos;t mean that we have to filter out this row.  On calling the filterRow() it is going to return false.  So in this case we must go ahead and scan the non essential CF data also and include those in the returned result.  But of we treat filterRowCells(List) clearing the list as row being filtered out, we wont get this behaviour.&lt;/p&gt;

&lt;p&gt;I actually again forgot this point when I asked the Q on patch V4.Now only I remembered it. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13957922" author="anoop.hbase" created="Wed, 2 Apr 2014 17:35:11 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt;  The essential CF optimization in the current code base is broken as observed by me and Ram right?  I think we have to change the subject of the Jira and up the priority then.&lt;/p&gt;</comment>
                            <comment id="13957935" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 17:43:41 +0000"  >&lt;blockquote&gt;&lt;p&gt;On calling the filterRow() it is going to return false.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Can you elaborate a bit more ?&lt;br/&gt;
SingleColumnValueExcludeFilter uses filterRow() method from SingleColumnValueFilter which would return false if filterIfMissing is false.&lt;br/&gt;
But in your example, the row is not missing in F1.&lt;/p&gt;</comment>
                            <comment id="13957948" author="hadoopqa" created="Wed, 2 Apr 2014 17:53:09 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12638276/10850-v4.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12638276/10850-v4.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12638276&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.master.TestMasterNoCluster.testNotPullingDeadRegionServerFromZK(TestMasterNoCluster.java:298)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9177//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13957952" author="anoop.hbase" created="Wed, 2 Apr 2014 17:55:05 +0000"  >&lt;p&gt;Sorry Ted.&lt;br/&gt;
I am not worried abt filterIfMissing here at all..  Just consider there is no case of missing the conditioned column at all..&lt;br/&gt;
I am saying wrt the V4 patch&lt;br/&gt;
There we are treating filterRow() returning true   and filterRowCells(List) clearing the list as same.   Correct &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/help_16.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
What I am saying is this is wrong.&lt;br/&gt;
As u can see in my above example when a row is having  F1:Q1  with value as V1 we have to include this row. SingleColumnValueExcludeFilter uses filterRow() method from SingleColumnValueFilter  and it will return false in that case.  You can see SingleColumnValueExcludeFilter  is having filterRowCells(List) also.  This will remove the KVs of column F1:Q1.  So once we call this  the results list will be empty.  As per patch V4 it will be considered like the row is being filtered out and we will go with next row..  But this is wrong.  In this case we should have been going with non essential family data scan and include those KVs in the result..  Hope I am making it clear.&lt;/p&gt;

&lt;p&gt;Again  the bug is found with SCVF filterIfMissing case.  But this is a more serious issue.  Thanks for finding out this.  &lt;br/&gt;
-Now the essential CF optimization is broken. &lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Also a new hook added when filter is filtering out a row. This new hook is also not getting called now.  Huawei&apos;s HIndex solution, scan perf gain comes from this hook only.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13957973" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 18:14:24 +0000"  >&lt;p&gt;I would say if SingleColumnValueExcludeFilter#filterRowCells(List) removes the KeyValue, leading to empty List, but SingleColumnValueExcludeFilter#filterRow() returns false, that is inconsistent.&lt;/p&gt;

&lt;p&gt;The return value from SingleColumnValueExcludeFilter#filterRow() is not related to how many elements are left in the List which is processed by SingleColumnValueExcludeFilter#filterRowCells(List). To me, this is a design flaw.&lt;/p&gt;

&lt;p&gt;I agree this issue is critical.&lt;/p&gt;</comment>
                            <comment id="13957977" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 18:16:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;This new hook is also not getting called now.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If postScannerFilterRow hook is concerned, it is called in this method:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; nextRow(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] currentRow, &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; offset, &lt;span class=&quot;code-object&quot;&gt;short&lt;/span&gt; length) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Patch v4 would still allow this hook to be called.&lt;/p&gt;</comment>
                            <comment id="13957995" author="anoop.hbase" created="Wed, 2 Apr 2014 18:28:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;Patch v4 would still allow this hook to be called.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agree. It is calling&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I would say if SingleColumnValueExcludeFilter#filterRowCells(List) removes the KeyValue, leading to empty List, but SingleColumnValueExcludeFilter#filterRow() returns false, that is inconsistent.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Sorry I have to disagree.&lt;br/&gt;
As per my above scan example&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Scan s = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Scan();
s.addColumn(F1, Q1);
s.addFamily(F2);
SingleColumnValueExcludeFilter f = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; SingleColumnValueExcludeFilter(F1, Q1, CompareOp.EQUAL, V1);
s.setFilter(f);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Say for row r1 F1:Q1 = V1.   We select only this column from cf F1.  So the results will contain one KV in it. Now when calling filterRowCells(List) in SCVEF this will remove the cell.  We have to exclude the conditioned column from result.    But the condition was passing for this row.  So filterRow() must return false.     This is very much acceptable.    &lt;br/&gt;
Note : Here the filterRowCells() called not all all the column kvs.  Only we fetch essential CF 1st. &lt;/p&gt;</comment>
                            <comment id="13958008" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 18:37:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;So filterRow() must return false&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The return value of false depends on this.filterIfMissing being false. What if filter.setFilterIfMissing(true) was called on SingleColumnValueExcludeFilter ?&lt;/p&gt;</comment>
                            <comment id="13958034" author="anoop.hbase" created="Wed, 2 Apr 2014 18:55:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;The return value of false depends on this.filterIfMissing being false.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The return value considers this.filterIfMissing  when the condition cf:q is missing for this row..  But the example I was trying to tell as per that the column is not missing&lt;/p&gt;

&lt;p&gt;And suppose it was missing for a row and filterIfMissing  = true this will return true from filterRow() for that column.&lt;/p&gt;

&lt;p&gt;What  I am trying to say here is we can not treat filterRow() return true is equal to filterRowCells(List) clearing the list. I am considering the essential family feature here.  filterRow() returning true means no need to continue with KV read from non essential cfs for this row.  But filterRowCells(List) clearing the list (The list was containing cells from essential family only) does not mean that we can skip non essential family scan.&lt;/p&gt;

&lt;p&gt; And because of this reason we can not combine these 2 calls in FilterWrapper.  Correct me if I am wrong pls.&lt;/p&gt;</comment>
                            <comment id="13958092" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 19:46:57 +0000"  >&lt;p&gt;How about patch v5 which is slightly bigger than v4 ?&lt;/p&gt;

&lt;p&gt;v5 does respect the return value from filterRow().&lt;/p&gt;

&lt;p&gt;All &amp;#42;Filter&amp;#42; tests pass.&lt;/p&gt;</comment>
                            <comment id="13958223" author="hadoopqa" created="Wed, 2 Apr 2014 21:49:05 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12638322/10850-v5.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12638322/10850-v5.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12638322&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9179//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13958494" author="anoop.hbase" created="Thu, 3 Apr 2014 03:41:57 +0000"  >&lt;p&gt;if ((results.isEmpty() &amp;amp;&amp;amp; ret != FilterWrapper.FilterRowRetCode.INCLUDE) || filterRow())&lt;/p&gt;

&lt;p&gt;Instead we can have  like&lt;/p&gt;

&lt;p&gt;if (isEmptyRow || ret == FilterWrapper.FilterRowRetCode.EXCLUDE ||  filterRow()) &lt;/p&gt;

&lt;p&gt;This might look simpler and easy to understand.  Also pls add some comment when FilterRowRetCode.EXCLUDE will be returned.&lt;br/&gt;
May be we will include the tests which shows this bug also into the patch?&lt;/p&gt;</comment>
                            <comment id="13958499" author="yuzhihong@gmail.com" created="Thu, 3 Apr 2014 03:55:06 +0000"  >&lt;p&gt;Patch v6 adds the test provided by Fabien.&lt;/p&gt;

&lt;p&gt;w.r.t. checking return value of FilterWrapper.FilterRowRetCode, I prefer the current formation.&lt;/p&gt;</comment>
                            <comment id="13958532" author="anoop.hbase" created="Thu, 3 Apr 2014 05:29:49 +0000"  >&lt;p&gt;Dont think this way of checking is correct Ted.&lt;br/&gt;
Take the example of SCVEF which I was telling above&lt;br/&gt;
As per the above check results will be empty and ret will be FilterWrapper.FilterRowRetCode.NOT_CALLED  This will make the condition to be true and we will not continue to fetch the non essential cf cells.&lt;/p&gt;

&lt;p&gt;So pls change the check to &lt;br/&gt;
if (isEmptyRow || ret == FilterWrapper.FilterRowRetCode.EXCLUDE ||  filterRow()) &lt;br/&gt;
FilterWrapper.FilterRowRetCode.EXCLUDE means the filterRow() returned false.&lt;/p&gt;

&lt;p&gt;Also from test pls remove&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    util.getConfiguration().setInt(HConstants.HBASE_RPC_TIMEOUT_KEY, 240 * 1000);
+    util.getConfiguration().setInt(HConstants.HBASE_CLIENT_SCANNER_TIMEOUT_PERIOD, 240 * 1000);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Sorry I added this for debug.&lt;/p&gt;

&lt;p&gt;private static final String HBASE_TABLE_NAME = &quot;test&quot;;    -&amp;gt; Table name can be test class name ?&lt;/p&gt;</comment>
                            <comment id="13958542" author="hadoopqa" created="Thu, 3 Apr 2014 05:49:18 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12638407/10850-v6.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12638407/10850-v6.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12638407&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9184//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13958624" author="yuzhihong@gmail.com" created="Thu, 3 Apr 2014 08:30:16 +0000"  >&lt;p&gt;Patch v7 addresses Anoop&apos;s comment above.&lt;/p&gt;

&lt;p&gt;TestSCVFWithMiniCluster and &amp;#42;Filter&amp;#42; pass.&lt;/p&gt;</comment>
                            <comment id="13958643" author="anoop.hbase" created="Thu, 3 Apr 2014 08:49:43 +0000"  >&lt;p&gt;+1 for V7&lt;br/&gt;
nit : white spaces in HRegion line 266&lt;br/&gt;
Ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=larsh&quot; class=&quot;user-hover&quot; rel=&quot;larsh&quot;&gt;larsh&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt; for 98 and &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; for 96.&lt;/p&gt;</comment>
                            <comment id="13958651" author="anoop.hbase" created="Thu, 3 Apr 2014 09:11:54 +0000"  >&lt;p&gt;Better we can fix this in 98.1 itself.  We have a fix also now..&lt;/p&gt;</comment>
                            <comment id="13958668" author="anoop.hbase" created="Thu, 3 Apr 2014 09:39:57 +0000"  >&lt;p&gt;Essential family optimization is broken when Scan selects column(s) other than the condition column from essential family.  When only the conditioned column is selected the optimization still works.&lt;/p&gt;</comment>
                            <comment id="13958670" author="ram_krish" created="Thu, 3 Apr 2014 09:42:37 +0000"  >&lt;p&gt;SCVF and SCVEF are slightly different in what they try to achieve.  SCVEF will ignore that column if found from the result but does not do anything with the row.  Hence filterRow() does not have an implementation in SCVEF.&lt;br/&gt;
In the HRegion.nextInternal() if we are sure that SCVF is saying filterRow() as true by checking essentialCF then going to non essential CF is wrong. &lt;br/&gt;
Current patch looks good. +1&lt;/p&gt;
</comment>
                            <comment id="13958678" author="zjushch" created="Thu, 3 Apr 2014 10:04:43 +0000"  >&lt;p&gt;What error will occur if using &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((results.isEmpty()|| filterRow()) {&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;instead of&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; ((isEmptyRow || ret == FilterWrapper.FilterRowRetCode.EXCLUDE) || filterRow()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;Just a doubt since I&apos;m not very clear.&lt;/p&gt;

&lt;p&gt;Path is good.&lt;/p&gt;</comment>
                            <comment id="13958682" author="yuzhihong@gmail.com" created="Thu, 3 Apr 2014 10:08:32 +0000"  >&lt;p&gt;Chunhui:&lt;br/&gt;
As Anoop pointed out, using (results.isEmpty()|| filterRow()) wouldn&apos;t work for Filters whose filterRowCells() filters out all Cells but whose filterRow() returns false.&lt;/p&gt;</comment>
                            <comment id="13958683" author="anoop.hbase" created="Thu, 3 Apr 2014 10:10:01 +0000"  >&lt;p&gt;Chunhui&lt;br/&gt;
Pls see the example I have mentioned&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10850?focusedCommentId=13957918&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13957918&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-10850?focusedCommentId=13957918&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13957918&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13958687" author="yuzhihong@gmail.com" created="Thu, 3 Apr 2014 10:14:51 +0000"  >&lt;p&gt;Integrated to 0.98 and trunk.&lt;/p&gt;

&lt;p&gt;Waiting on Stack&apos;s ack before integrating to 0.96&lt;/p&gt;

&lt;p&gt;Thanks Fabien for reporting the problem.&lt;/p&gt;

&lt;p&gt;Thanks to Anoop, Ram and Chunhui for reviews.&lt;/p&gt;</comment>
                            <comment id="13958692" author="zjushch" created="Thu, 3 Apr 2014 10:19:27 +0000"  >&lt;p&gt;Thanks.  I see &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;

</comment>
                            <comment id="13958698" author="hadoopqa" created="Thu, 3 Apr 2014 10:29:43 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12638443/10850-v7.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12638443/10850-v7.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12638443&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.mapreduce.TestTableMapReduceBase.testMultiRegionTable(TestTableMapReduceBase.java:96)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9188//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13958707" author="hadoopqa" created="Thu, 3 Apr 2014 10:46:56 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12638443/10850-v7.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12638443/10850-v7.txt&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12638443&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//artifact/trunk/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/9189//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13958775" author="hudson" created="Thu, 3 Apr 2014 12:44:50 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-TRUNK #5060 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5060/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5060/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10850&quot; title=&quot;essential column family optimization is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10850&quot;&gt;&lt;del&gt;HBASE-10850&lt;/del&gt;&lt;/a&gt; essential column family optimization is broken (tedyu: rev 1584335)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-client/src/main/java/org/apache/hadoop/hbase/filter/FilterWrapper.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestSCVFWithMiniCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13958797" author="hudson" created="Thu, 3 Apr 2014 13:16:32 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-0.98 #262 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/262/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/262/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10850&quot; title=&quot;essential column family optimization is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10850&quot;&gt;&lt;del&gt;HBASE-10850&lt;/del&gt;&lt;/a&gt; essential column family optimization is broken (tedyu: rev 1584334)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-client/src/main/java/org/apache/hadoop/hbase/filter/FilterWrapper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestSCVFWithMiniCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13958829" author="hudson" created="Thu, 3 Apr 2014 13:52:02 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #246 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/246/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/246/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10850&quot; title=&quot;essential column family optimization is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10850&quot;&gt;&lt;del&gt;HBASE-10850&lt;/del&gt;&lt;/a&gt; essential column family optimization is broken (tedyu: rev 1584334)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-client/src/main/java/org/apache/hadoop/hbase/filter/FilterWrapper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.98/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestSCVFWithMiniCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13958884" author="stack" created="Thu, 3 Apr 2014 15:21:52 +0000"  >&lt;p&gt;+1 for 0.96&lt;/p&gt;</comment>
                            <comment id="13958939" author="yuzhihong@gmail.com" created="Thu, 3 Apr 2014 16:31:17 +0000"  >&lt;p&gt;I am having difficulty logging into people.apache.org&lt;/p&gt;

&lt;p&gt;Will try again soon.&lt;/p&gt;</comment>
                            <comment id="13958988" author="yuzhihong@gmail.com" created="Thu, 3 Apr 2014 17:13:41 +0000"  >&lt;p&gt;svn command hangs on MacBook &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="13959492" author="hudson" created="Fri, 4 Apr 2014 00:52:10 +0000"  >&lt;p&gt;FAILURE: Integrated in hbase-0.96 #376 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96/376/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96/376/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10850&quot; title=&quot;essential column family optimization is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10850&quot;&gt;&lt;del&gt;HBASE-10850&lt;/del&gt;&lt;/a&gt; essential column family optimization is broken (tedyu: rev 1584357)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-client/src/main/java/org/apache/hadoop/hbase/filter/FilterWrapper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestSCVFWithMiniCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13959923" author="hudson" created="Fri, 4 Apr 2014 13:06:07 +0000"  >&lt;p&gt;SUCCESS: Integrated in hbase-0.96-hadoop2 #259 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.96-hadoop2/259/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.96-hadoop2/259/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-10850&quot; title=&quot;essential column family optimization is broken&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-10850&quot;&gt;&lt;del&gt;HBASE-10850&lt;/del&gt;&lt;/a&gt; essential column family optimization is broken (tedyu: rev 1584357)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-client/src/main/java/org/apache/hadoop/hbase/filter/FilterWrapper.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.96/hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestSCVFWithMiniCluster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14330482" author="enis" created="Sat, 21 Feb 2015 23:28:49 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12638164" name="10850-hasFilterRow-v1.txt" size="7200" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 00:25:03 +0000"/>
                            <attachment id="12638188" name="10850-hasFilterRow-v2.txt" size="8367" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 03:06:37 +0000"/>
                            <attachment id="12638194" name="10850-hasFilterRow-v3.txt" size="9073" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 04:57:21 +0000"/>
                            <attachment id="12638276" name="10850-v4.txt" size="1105" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 15:59:10 +0000"/>
                            <attachment id="12638322" name="10850-v5.txt" size="3043" author="yuzhihong@gmail.com" created="Wed, 2 Apr 2014 20:07:45 +0000"/>
                            <attachment id="12638407" name="10850-v6.txt" size="12233" author="yuzhihong@gmail.com" created="Thu, 3 Apr 2014 03:55:06 +0000"/>
                            <attachment id="12638443" name="10850-v7.txt" size="12036" author="yuzhihong@gmail.com" created="Thu, 3 Apr 2014 08:42:59 +0000"/>
                            <attachment id="12637151" name="HBASE-10850-96.patch" size="1063" author="haosdent@gmail.com" created="Thu, 27 Mar 2014 14:19:20 +0000"/>
                            <attachment id="12637152" name="HBASE-10850.patch" size="1063" author="haosdent@gmail.com" created="Thu, 27 Mar 2014 14:30:11 +0000"/>
                            <attachment id="12637380" name="HBASE-10850_V2.patch" size="4060" author="anoop.hbase" created="Fri, 28 Mar 2014 12:20:22 +0000"/>
                            <attachment id="12637124" name="HBaseSingleColumnValueFilterTest.java" size="8501" author="flegallo" created="Thu, 27 Mar 2014 11:14:35 +0000"/>
                            <attachment id="12637992" name="TestWithMiniCluster.java" size="8324" author="anoop.hbase" created="Tue, 1 Apr 2014 03:23:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>12.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 27 Mar 2014 12:37:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382289</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1tv2f:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>382560</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>