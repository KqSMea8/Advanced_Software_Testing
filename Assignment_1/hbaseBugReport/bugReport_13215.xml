<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:40:57 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13215/HBASE-13215.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13215] A limit on the raw key values is needed for each next call of a scanner</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13215</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In the current scanner next, there are several limits: caching, batch and size. But there is no limit on raw data scanned, so the time consumed by a next call is unbounded. For example, many consecutive deleted or filtered out cells will leads to a socket timeout. This can make user code get stuck.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12781388">HBASE-13215</key>
            <summary>A limit on the raw key values is needed for each next call of a scanner</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="heliangliang">He Liangliang</assignee>
                                    <reporter username="heliangliang">He Liangliang</reporter>
                        <labels>
                    </labels>
                <created>Thu, 12 Mar 2015 02:25:50 +0000</created>
                <updated>Mon, 29 Jun 2015 06:53:54 +0000</updated>
                            <resolved>Mon, 29 Jun 2015 06:53:54 +0000</resolved>
                                                                    <component>Scanners</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="14358055" author="stack" created="Thu, 12 Mar 2015 03:47:31 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jonathan.lawlor&quot; class=&quot;user-hover&quot; rel=&quot;jonathan.lawlor&quot;&gt;Jonathan Lawlor&lt;/a&gt; One for your input&lt;/p&gt;</comment>
                            <comment id="14358897" author="jonathan.lawlor" created="Thu, 12 Mar 2015 16:19:47 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=heliangliang&quot; class=&quot;user-hover&quot; rel=&quot;heliangliang&quot;&gt;He Liangliang&lt;/a&gt;, this sounds like it may be related/solved by the solution for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13090&quot; title=&quot;Progress heartbeats for long running scanners&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13090&quot;&gt;&lt;del&gt;HBASE-13090&lt;/del&gt;&lt;/a&gt; that I am currently looking into. &lt;/p&gt;

&lt;p&gt;Over in that issue we have discussed bounding the execution time of scans on the server side. The idea is to set a time limit for the execution of the scan on the server and once that time limit is reached we send back a heartbeat/keep-alive message back to the client with whatever data we have accumulated thus far (potentially empty). This would prevent the scanner from timing out in the instance that you have described (where many cells have been deleted or filtered out). The client scanner would then issue future RPCs to the server if the data within the heartbeat/keep-alive message was not sufficient to service the applications request.&lt;/p&gt;

&lt;p&gt;This mechanism is also nice because it is somewhat invisible to the application layer. All time limit handling is handled server side and the limit on the execution is implied through the defined client side scanner timeout. Thus, the application layer won&apos;t need to specify any additional limits; the timeouts will be handled automatically. &lt;/p&gt;</comment>
                            <comment id="14359850" author="heliangliang" created="Fri, 13 Mar 2015 03:02:11 +0000"  >&lt;p&gt;Thanks, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jonathan.lawlor&quot; class=&quot;user-hover&quot; rel=&quot;jonathan.lawlor&quot;&gt;Jonathan Lawlor&lt;/a&gt;. The invisibility sometimes is undesirable, the application actually want to know what happens and need to response to their client, especially there is strict timeout in online services.&lt;br/&gt;
In other cases, there is one more requirement. The application want to know the (may be invisible if limit is reached) scanner position, and reopen the scanner later with this position (this does not have best performance but no state is needed for all backends includes RS). We had a patch for 0.94 for these two requirements.&lt;/p&gt;</comment>
                            <comment id="14363974" author="jonathan.lawlor" created="Mon, 16 Mar 2015 21:20:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=heliangliang&quot; class=&quot;user-hover&quot; rel=&quot;heliangliang&quot;&gt;He Liangliang&lt;/a&gt; I see, that makes sense to me. Certainly the approach outlined in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13090&quot; title=&quot;Progress heartbeats for long running scanners&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13090&quot;&gt;&lt;del&gt;HBASE-13090&lt;/del&gt;&lt;/a&gt; wouldn&apos;t be able to provide as fine grained control as a raw key value limit. &lt;/p&gt;

&lt;p&gt;I think that we would probably want to make some comment in the docs of this feature about how this limit should only be specified in specific circumstances (such as the use cases you have described above). This seems like a feature that would be nice to have to provide strict control over RPCs, but may cause performance degradation if used without full knowledge of the drawbacks of specifying such a limit. By default we would probably want this limit to be Long.Max_Value or Int.Max_Value so that the current behavior is followed.&lt;/p&gt;

&lt;p&gt;In terms of saving the scanner position to re-open later, is the position that is saved the row key? Does this handle the case where the raw key value limit is reached in the middle of a row? Or is the raw key value limit instead enforced only in between rows (i.e. after all the cells for a particular row have been retrieved then you check the limit and only continue if not reached)? &lt;/p&gt;

&lt;p&gt;Looking forward to this &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14364505" author="heliangliang" created="Tue, 17 Mar 2015 03:52:14 +0000"  >&lt;p&gt;The second approach.&lt;br/&gt;
In some of our application (actually most of online services), the number of values in a row is bounded (like a RDBMS row), so this limit can be a soft limit which can be exceeded without affect the time consumption much. Actually breaking the row in the middle is quite undesirable for these type of application (like the behavior of batch) which make the application logic clumsy.&lt;/p&gt;</comment>
                            <comment id="14485795" author="jonathan.lawlor" created="Wed, 8 Apr 2015 18:53:46 +0000"  >&lt;p&gt;Hey &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=heliangliang&quot; class=&quot;user-hover&quot; rel=&quot;heliangliang&quot;&gt;He Liangliang&lt;/a&gt;, have you had any time to work on this lately; any updates?&lt;/p&gt;</comment>
                            <comment id="14492226" author="heliangliang" created="Mon, 13 Apr 2015 10:10:52 +0000"  >&lt;p&gt;Yes, we had a patch based on 0.94. We&apos;ll port it to trunk if it&apos;s considered helpful.&lt;/p&gt;</comment>
                            <comment id="14605211" author="heliangliang" created="Mon, 29 Jun 2015 06:53:54 +0000"  >&lt;p&gt;Change solution to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13984&quot; title=&quot;Add option to allow caller to know the heartbeat and scanner position when scanner timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13984&quot;&gt;HBASE-13984&lt;/a&gt; based on the new code base.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="12310000">
                    <name>Duplicate</name>
                                                                <inwardlinks description="is duplicated by">
                                        <issuelink>
            <issuekey id="12841228">HBASE-13984</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 12 Mar 2015 03:47:31 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 24 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i26o3z:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>