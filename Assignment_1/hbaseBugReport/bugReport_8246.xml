<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:53:24 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8246/HBASE-8246.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8246] Backport HBASE-6318 to 0.94 where SplitLogWorker exits due to ConcurrentModificationException</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8246</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Today we found the following error in our tests. Later I found we already fixed the issue in trunk. I think we should backpor the fix because the consequence of the issue is high and the fix isn&apos;t complicated.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2013-04-01 21:23:21,864 INFO org.apache.hadoop.hbase.regionserver.SplitLogWorker: worker ip-10-143-160-121.ec2.internal,60020,1364849529986 done with task /hbase/splitlog/hdfs%3A%2F%2Fip-10-137-16-140.ec2.internal%3A8020%2Fapps%2Fhbase%2Fdata%2F.logs%2Fip-10-137-20-188.ec2.internal%2C60020%2C1364849530779-splitting%2Fip-10-137-20-188.ec2.internal%252C60020%252C1364849530779.1364865556657 in 67129ms
2013-04-01 21:23:21,864 ERROR org.apache.hadoop.hbase.regionserver.SplitLogWorker: unexpected error
java.util.ConcurrentModificationException
        at java.util.TreeMap$PrivateEntryIterator.nextEntry(TreeMap.java:1100)
        at java.util.TreeMap$ValueIterator.next(TreeMap.java:1145)
        at org.apache.hadoop.hbase.regionserver.wal.HLogSplitter$OutputSink.closeLogWriters(HLogSplitter.java:1279)
        at org.apache.hadoop.hbase.regionserver.wal.HLogSplitter$OutputSink.finishWritingAndClose(HLogSplitter.java:1170)
        at org.apache.hadoop.hbase.regionserver.wal.HLogSplitter.splitLogFile(HLogSplitter.java:475)
        at org.apache.hadoop.hbase.regionserver.wal.HLogSplitter.splitLogFile(HLogSplitter.java:403)
        at org.apache.hadoop.hbase.regionserver.SplitLogWorker$1.exec(SplitLogWorker.java:111)
        at org.apache.hadoop.hbase.regionserver.SplitLogWorker.grabTask(SplitLogWorker.java:264)
        at org.apache.hadoop.hbase.regionserver.SplitLogWorker.taskLoop(SplitLogWorker.java:195)
        at org.apache.hadoop.hbase.regionserver.SplitLogWorker.run(SplitLogWorker.java:163)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
2013-04-01 21:23:21,865 INFO org.apache.hadoop.hbase.regionserver.SplitLogWorker: SplitLogWorker ip-10-143-160-121.ec2.internal,60020,1364849529986 exiting
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The impact of this issue is that SplitLogWorker exits so does the region server recovering mechanism of HBase. If any RS failed after all SplitLogWorkers in te cluster exit due to the issue, you&apos;ll see a hang log splitting job and the failed RS won&apos;t be recovered.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12640379">HBASE-8246</key>
            <summary>Backport HBASE-6318 to 0.94 where SplitLogWorker exits due to ConcurrentModificationException</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="jeffreyz">Jeffrey Zhong</reporter>
                        <labels>
                    </labels>
                <created>Tue, 2 Apr 2013 21:03:16 +0000</created>
                <updated>Sat, 27 Apr 2013 15:55:18 +0000</updated>
                            <resolved>Wed, 3 Apr 2013 13:48:16 +0000</resolved>
                                    <version>0.94.6</version>
                                    <fixVersion>0.94.7</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13620351" author="yuzhihong@gmail.com" created="Tue, 2 Apr 2013 22:23:45 +0000"  >&lt;p&gt;The following tests passed:&lt;/p&gt;

&lt;p&gt;mt -Dtest=&amp;#42;HLog&amp;#42;&lt;/p&gt;</comment>
                            <comment id="13620356" author="yuzhihong@gmail.com" created="Tue, 2 Apr 2013 22:28:59 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;:&lt;br/&gt;
What do you think ?&lt;/p&gt;</comment>
                            <comment id="13620380" author="jeffreyz" created="Tue, 2 Apr 2013 22:49:51 +0000"  >&lt;p&gt;The patch looks good to me, +1. The test TestDistributedLogSplitting also runs fine after the patch.&lt;/p&gt;</comment>
                            <comment id="13620413" author="yuzhihong@gmail.com" created="Tue, 2 Apr 2013 23:39:38 +0000"  >&lt;p&gt;Test suite passed:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Tests run: 1333, Failures: 0, Errors: 0, Skipped: 13

[INFO] ------------------------------------------------------------------------
[INFO] BUILD SUCCESS
[INFO] ------------------------------------------------------------------------
[INFO] Total time: 1:01:54.014s
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13620420" author="apurtell" created="Tue, 2 Apr 2013 23:59:19 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ted_yu&quot; class=&quot;user-hover&quot; rel=&quot;ted_yu&quot;&gt;Ted Yu&lt;/a&gt; I get the sense that &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt; is pretty busy. If you don&apos;t hear back by tomorrow at your option IMHO it&apos;s ok to commit this.&lt;/p&gt;</comment>
                            <comment id="13620473" author="lhofhansl" created="Wed, 3 Apr 2013 01:07:24 +0000"  >&lt;p&gt;This patch does more than just fixing the issue in the description, right? It seems we only need the &lt;tt&gt;synchronized (logWriters)&lt;/tt&gt; part.&lt;br/&gt;
Is it enough to wait for 10ms to join a a writer thread? If that times out we won&apos;t interrupt the other threads.&lt;/p&gt;</comment>
                            <comment id="13620504" author="yuzhihong@gmail.com" created="Wed, 3 Apr 2013 01:51:13 +0000"  >&lt;p&gt;Patch v2 addresses Lars&apos; comment about inadequate wait time on the WriterThread&lt;/p&gt;</comment>
                            <comment id="13620545" author="enis" created="Wed, 3 Apr 2013 02:57:57 +0000"  >&lt;p&gt;Thread.join() on timeout won&apos;t throw an exception, right? But even so, I agree that we should just wait for the thread to exit without timeout. &lt;/p&gt;</comment>
                            <comment id="13620561" author="jxiang" created="Wed, 3 Apr 2013 03:28:03 +0000"  >&lt;p&gt;Actually, I think we do need to specify a timeout time.  Otherwise, it may wait forever, if the interrupt is swallowed somewhere.  After 10ms, if the thread is alive, we will interrupt it again, right?  We have to make sure all threads are gone before closing the writers. Otherwise, we may run into the ConcurrentModificationException.&lt;/p&gt;</comment>
                            <comment id="13620562" author="lhofhansl" created="Wed, 3 Apr 2013 03:28:52 +0000"  >&lt;p&gt;Thanks Ted. What about my first question? Is the join() part necessary, or do we just need the synchronized part to avoid the exception?&lt;/p&gt;</comment>
                            <comment id="13620567" author="lhofhansl" created="Wed, 3 Apr 2013 03:36:11 +0000"  >&lt;p&gt;Enis correct, join timing out does not throw an exception, so first version was correct (my bad). At least I&apos;d increase the wait to 100ms or so (and again ask, why we need to do this in the first place &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; )&lt;/p&gt;</comment>
                            <comment id="13620569" author="yuzhihong@gmail.com" created="Wed, 3 Apr 2013 03:38:41 +0000"  >&lt;p&gt;@Lars:&lt;br/&gt;
Does Jimmy&apos;s comment above answer your question ?&lt;/p&gt;</comment>
                            <comment id="13620593" author="lhofhansl" created="Wed, 3 Apr 2013 04:26:23 +0000"  >&lt;p&gt;It does. I actually checked the code now. (Sorry I&apos;ve been a bit busy the past few days)&lt;/p&gt;</comment>
                            <comment id="13620598" author="yuzhihong@gmail.com" created="Wed, 3 Apr 2013 04:34:21 +0000"  >&lt;p&gt;Integrated patch v1 to 0.94&lt;/p&gt;

&lt;p&gt;Thanks for the reviews, Andy, Lars and Jimmy.&lt;/p&gt;</comment>
                            <comment id="13622807" author="hudson" created="Thu, 4 Apr 2013 21:16:30 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #130 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/130/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/130/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8246&quot; title=&quot;Backport HBASE-6318 to 0.94 where SplitLogWorker exits due to ConcurrentModificationException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8246&quot;&gt;&lt;del&gt;HBASE-8246&lt;/del&gt;&lt;/a&gt; Backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6318&quot; title=&quot;SplitLogWorker exited due to ConcurrentModificationException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6318&quot;&gt;&lt;del&gt;HBASE-6318&lt;/del&gt;&lt;/a&gt; to 0.94 where SplitLogWorker exits due to ConcurrentModificationException (Revision 1463821)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogSplitter.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13623159" author="hudson" created="Fri, 5 Apr 2013 01:00:50 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #13 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/13/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/13/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8246&quot; title=&quot;Backport HBASE-6318 to 0.94 where SplitLogWorker exits due to ConcurrentModificationException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8246&quot;&gt;&lt;del&gt;HBASE-8246&lt;/del&gt;&lt;/a&gt; Backport &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6318&quot; title=&quot;SplitLogWorker exited due to ConcurrentModificationException&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6318&quot;&gt;&lt;del&gt;HBASE-6318&lt;/del&gt;&lt;/a&gt; to 0.94 where SplitLogWorker exits due to ConcurrentModificationException (Revision 1463821)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
tedyu : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLogSplitter.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12576701" name="8246-0.94-v2.txt" size="1951" author="yuzhihong@gmail.com" created="Wed, 3 Apr 2013 01:51:13 +0000"/>
                            <attachment id="12576665" name="8246-0.94.txt" size="1953" author="yuzhihong@gmail.com" created="Tue, 2 Apr 2013 21:47:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 2 Apr 2013 22:23:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>320842</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 37 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1jcwf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>321183</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>