<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:27:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11871/HBASE-11871.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11871] Avoid usage of KeyValueUtil#ensureKeyValue</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11871</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Now we try to use diff impls of Cells (other than KV) in server side for optimizations. (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11870&quot; title=&quot;Optimization : Avoid copy of key and value for tags addition in AC and VC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11870&quot;&gt;&lt;del&gt;HBASE-11870&lt;/del&gt;&lt;/a&gt;  is one like this) Having code  KeyValueUtil#ensureKeyValue can be dangerous as it recreate the Cell and do buffer copy. This is an umbrella issue.  Will raise small sub tasks in specific areas and tackle this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12738194">HBASE-11871</key>
            <summary>Avoid usage of KeyValueUtil#ensureKeyValue</summary>
                <type id="14" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/genericissue.png">Umbrella</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="anoop.hbase">Anoop Sam John</assignee>
                                    <reporter username="anoop.hbase">Anoop Sam John</reporter>
                        <labels>
                            <label>None</label>
                    </labels>
                <created>Mon, 1 Sep 2014 06:05:27 +0000</created>
                <updated>Wed, 14 Sep 2016 04:37:42 +0000</updated>
                            <resolved>Wed, 14 Sep 2016 04:37:29 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                            <comments>
                            <comment id="14117091" author="ram_krish" created="Mon, 1 Sep 2014 06:57:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7320&quot; title=&quot;Remove KeyValue.getBuffer()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7320&quot;&gt;HBASE-7320&lt;/a&gt; and its subtasks are aimed at this.  Few are left out in doing this and some where in the write path.  &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11870&quot; title=&quot;Optimization : Avoid copy of key and value for tags addition in AC and VC&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11870&quot;&gt;&lt;del&gt;HBASE-11870&lt;/del&gt;&lt;/a&gt; can be linked to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7320&quot; title=&quot;Remove KeyValue.getBuffer()&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7320&quot;&gt;HBASE-7320&lt;/a&gt; or may be move this under that. We have few places still left in doing that.  In certain filters we are not able to do where the exposed APIs are already KVs. Though they are deprecated for back ward compatability we need to expose them as KVs and there we will do KVUtil.ensureKeyValue().&lt;/p&gt;</comment>
                            <comment id="14117092" author="anoop.hbase" created="Mon, 1 Sep 2014 07:01:16 +0000"  >&lt;p&gt;Ya in exposed APIs we may have to? My aim here is to avoid the usage in core code.&lt;br/&gt;
One eg: is this one&lt;br/&gt;
Compactor#performCompaction()&lt;/p&gt;</comment>
                            <comment id="14117786" author="lhofhansl" created="Mon, 1 Sep 2014 23:39:34 +0000"  >&lt;p&gt;Agreed. This is the next step. KVUtil.ensureKeyValue() was a necessary crutch to get us here, now it&apos;s time to remove it.&lt;br/&gt;
I guess just like I deprecated the use of KeyValue.getBuffer() we should go through the uses and classify them into those that can easily removed and those that will need work. Then we remove the easy cases and deprecate KVUtil.ensureKeyValue(). Well... And then somebody has to deal with the hard cases &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14117858" author="anoop.hbase" created="Tue, 2 Sep 2014 03:24:51 +0000"  >&lt;p&gt;Exactly Lars.   As a first step I am trying to remove the use from Compactor and HFileWriter.   (Why it is was needed in Compactor is because Writer accepts KV only).  I will attach patch for that to &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11874&quot; title=&quot;Support Cell to be passed to StoreFile.Writer rather than KeyValue&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11874&quot;&gt;&lt;del&gt;HBASE-11874&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
Similar way will check each area one by one and try remove KVUtil#ensureKeyValue()&lt;br/&gt;
I think in 1.0 itself we should deprecate this. Even though KeyValueUtil is marker Private, Phoenix uses it. And we should get rid of the usage in Phoenix also.&lt;/p&gt;</comment>
                            <comment id="14146030" author="anoop.hbase" created="Wed, 24 Sep 2014 07:55:40 +0000"  >&lt;p&gt;This is part of the work towards &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11425&quot; title=&quot;Cell/DBB end-to-end on the read-path&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11425&quot;&gt;&lt;del&gt;HBASE-11425&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14151448" author="anoop.hbase" created="Mon, 29 Sep 2014 07:27:13 +0000"  >&lt;p&gt;We are almost there once &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-12112&quot; title=&quot;Avoid KeyValueUtil#ensureKeyValue some more simple cases&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-12112&quot;&gt;&lt;del&gt;HBASE-12112&lt;/del&gt;&lt;/a&gt; also goes in &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
The only left out will be in WALEdit#write  (I don&apos;t think this is getting used really)  and places in mapreduce package classes&lt;br/&gt;
mapreduce places actually we get KeyValues but because of API signature we have to do ensureKeyValue(Cell).  To change to Cell, we will have to change the mapred job map/reduce o/p value format. As these are public exposed we can not change directly. So I am not planing to work on this immediately.  &lt;/p&gt;

&lt;p&gt;Over all in read and write paths we don&apos;t anymore use KeyValueUtil#ensureKeyValue()  and all in Cell also now. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14151862" author="stack" created="Mon, 29 Sep 2014 16:21:54 +0000"  >&lt;blockquote&gt;&lt;p&gt;Over all in read and write paths we don&apos;t anymore use KeyValueUtil#ensureKeyValue() and all in Cell also now. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Wahooo!!!&lt;/p&gt;

&lt;p&gt;Test would be a Cell whose implementation was other than that of KVs.... say something from prefix key or something simple that just changes location of one of the fields &amp;#8211; e.g. inlined tags with key.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12743443">PHOENIX-1282</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12724166">HBASE-11425</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12738204">HBASE-11872</subtask>
                            <subtask id="12740076">HBASE-11919</subtask>
                            <subtask id="12743131">HBASE-12047</subtask>
                            <subtask id="12743142">HBASE-12048</subtask>
                            <subtask id="12743173">HBASE-12050</subtask>
                            <subtask id="12743176">HBASE-12051</subtask>
                            <subtask id="12743564">HBASE-12068</subtask>
                            <subtask id="12743734">HBASE-12079</subtask>
                            <subtask id="12743816">HBASE-12082</subtask>
                            <subtask id="12743821">HBASE-12084</subtask>
                            <subtask id="12744451">HBASE-12111</subtask>
                            <subtask id="12744453">HBASE-12112</subtask>
                            <subtask id="12746903">HBASE-12210</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 1 Sep 2014 06:57:57 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 11 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1zjfr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>