<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:08:17 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3209/HBASE-3209.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3209] New Compaction Heuristic</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3209</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We have a whole bunch of compaction awesome in our internal 0.89 branch.  Porting this to 0.90:&lt;/p&gt;

&lt;p&gt;1) don&apos;t unconditionally compact 4 files. have a min threshold&lt;br/&gt;
2) intelligently upgrade minors to majors&lt;br/&gt;
3) new compaction algo (derived in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2462&quot; title=&quot;Review compaction heuristic and move compaction code out so standalone and independently testable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2462&quot;&gt;&lt;del&gt;HBASE-2462&lt;/del&gt;&lt;/a&gt; )&lt;/p&gt;</description>
                <environment></environment>
        <key id="12479530">HBASE-3209</key>
            <summary>New Compaction Heuristic</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nspiegelberg">Nicolas Spiegelberg</assignee>
                                    <reporter username="nspiegelberg">Nicolas Spiegelberg</reporter>
                        <labels>
                    </labels>
                <created>Tue, 9 Nov 2010 22:41:59 +0000</created>
                <updated>Fri, 20 Nov 2015 12:41:35 +0000</updated>
                            <resolved>Wed, 10 Nov 2010 00:12:47 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12930332" author="nspiegelberg" created="Tue, 9 Nov 2010 22:43:01 +0000"  >&lt;p&gt;Results from our cluster:&lt;/p&gt;

&lt;p&gt;Multiput Latency: 25 ms =&amp;gt; 3 ms avg&lt;br/&gt;
Sync Latency:  12 ms =&amp;gt; 1.5 ms avg&lt;br/&gt;
Compaction Queue: 3 =&amp;gt; 0.08 avg&lt;br/&gt;
Compaction Time: now 1-30 sec  (note: our compaction time ods chart is off, looked manually at logs)&lt;/p&gt;

&lt;p&gt;Read Latency: 6 ms =&amp;gt; 9 ms&lt;br/&gt;
Files / Store: 2 =&amp;gt; 2.6&lt;/p&gt;

&lt;p&gt;Note that the minor Read drop can be fixed by setting compactionThreshold from 3 to 2.  We just didn&apos;t need the improvement&lt;/p&gt;</comment>
                            <comment id="12930347" author="hbasereviewboard" created="Tue, 9 Nov 2010 23:14:06 +0000"  >&lt;p&gt;Message from: &quot;Nicolas&quot; &amp;lt;nspiegelberg@facebook.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/1192/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1192/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;We have a whole bunch of compaction awesome in our internal 0.89 branch. Porting this to 0.90:&lt;/p&gt;

&lt;p&gt;1) don&apos;t unconditionally compact 4 files. have a min threshold&lt;br/&gt;
2) intelligently upgrade minors to majors&lt;br/&gt;
3) new compaction algo (derived in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2462&quot; title=&quot;Review compaction heuristic and move compaction code out so standalone and independently testable&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2462&quot;&gt;&lt;del&gt;HBASE-2462&lt;/del&gt;&lt;/a&gt; )&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3209&quot; title=&quot;New Compaction Heuristic&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3209&quot;&gt;&lt;del&gt;HBASE-3209&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-3209&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-3209&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java 1033278 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.cloudera.org/r/1192/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1192/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Has been running on our primary cluster for the past couple weeks.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Nicolas&lt;/p&gt;

</comment>
                            <comment id="12930352" author="hbasereviewboard" created="Tue, 9 Nov 2010 23:19:27 +0000"  >&lt;p&gt;Message from: &quot;Nicolas&quot; &amp;lt;nspiegelberg@facebook.com&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/1192/#review1878&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1192/#review1878&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;



&lt;p&gt;trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/1192/#comment6095&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1192/#comment6095&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    I know.  I&apos;m a whitespace ASBO.  sorry &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;



&lt;p&gt;trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/1192/#comment6092&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1192/#comment6092&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    we can work on fine-tuning this.  +50% was a safe cover for us and worked fine because we pre-split regions.  Really, you probably don&apos;t need the pad because the summation algorithm will operate on at least 3 storefiles, so (assuming roughly even flush sizes) you get +100% pad from that.&lt;/p&gt;



&lt;p&gt;trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/1192/#comment6091&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1192/#comment6091&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    s/are meet/have met/&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Nicolas&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12930363" author="nspiegelberg" created="Tue, 9 Nov 2010 23:45:17 +0000"  >&lt;p&gt;St^Ack_: nspiegelberg: what config. would I set so it favored less files and kept the old read performance?&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3:36pm&amp;#93;&lt;/span&gt; nspiegelberg: you have 2 options&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3:37pm&amp;#93;&lt;/span&gt; nspiegelberg: 1) set compactionThreshold == 2&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3:38pm&amp;#93;&lt;/span&gt; nspiegelberg: 2) make minCompactSize configurable and set it high&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3:39pm&amp;#93;&lt;/span&gt; nspiegelberg: basically, before this algo, we would unconditionally compact 4 files, but the compactionThreshold == 3&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3:40pm&amp;#93;&lt;/span&gt; nspiegelberg: this means that we would never use the compaction algorithm unless our cluster was stressed out&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3:41pm&amp;#93;&lt;/span&gt; jdcryans: it used to not be like that tho&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3:42pm&amp;#93;&lt;/span&gt; jdcryans: it&apos;s a hack that we compact everything&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3:42pm&amp;#93;&lt;/span&gt; nspiegelberg: the only downside to the current algorithm is that sum(storefiles) doesn&apos;t take into account dedupe can have a snowball effect of compacting too aggressively during load.  this can be migitated by lowering hbase.hstore.compaction.max&lt;br/&gt;
&lt;span class=&quot;error&quot;&gt;&amp;#91;3:43pm&amp;#93;&lt;/span&gt; nspiegelberg: in reality, this hasn&apos;t proved to be an issue for us.  lowering the max compact files will fix it.  we can also add on some simple dedupe heuristics to fix this issue&lt;/p&gt;</comment>
                            <comment id="12930376" author="hbasereviewboard" created="Wed, 10 Nov 2010 00:10:36 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.cloudera.org/r/1192/#review1881&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1192/#review1881&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;k... let me commit.&lt;/p&gt;


&lt;p&gt;trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/1192/#comment6110&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1192/#comment6110&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Whitespace here &amp;#8211; I can fix on commit.&lt;/p&gt;



&lt;p&gt;trunk/src/main/java/org/apache/hadoop/hbase/regionserver/Store.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.cloudera.org/r/1192/#comment6113&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.cloudera.org/r/1192/#comment6113&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Very cute&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12930377" author="stack" created="Wed, 10 Nov 2010 00:12:47 +0000"  >&lt;p&gt;Thanks for the patch Nicolas.  Committed.&lt;/p&gt;</comment>
                            <comment id="15017017" author="lars_francke" created="Fri, 20 Nov 2015 12:41:35 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12462305">HBASE-2462</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 9 Nov 2010 23:14:06 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32944</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hl7b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100697</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>