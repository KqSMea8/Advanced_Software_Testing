<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:10:34 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3480/HBASE-3480.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3480] Reduce the size of Result serialization</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3480</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;When faced with a gigabit ethernet network connection, things are pretty slow actually.  For example, let&apos;s take a 2 MB reply, using a 120MB/sec line rate, we are talking about about 16ms to transfer that data across a gige line.  This is a pretty significant amount of time.&lt;/p&gt;

&lt;p&gt;So this JIRA is about reducing the size of the Result[] serialization.  By exploiting family and qualifier and rowkey duplication, I created a simple encoding scheme to use a dictionary instead of literal strings.  &lt;/p&gt;

&lt;p&gt;in my testing, I am seeing some success with the sizes.  Average serialized size is about 1/2 of previous, but time to serialize on the regionserver side is way up, by a factor of 10x.  This might be due to the simplistic first implementation however.&lt;/p&gt;

&lt;p&gt;Here is the post change size:&lt;br/&gt;
grep &apos;Serialized size&apos; * | perl -ne &apos;/Serialized size: (\d+?) in (\d+?) ns/ ; print $1, &quot; &quot;, $2, &quot;\n&quot; if $1 &amp;gt; 10000;&apos; | cut -f1 -d&apos; &apos; | perl -ne &apos;$sum &lt;ins&gt;= $_; $count&lt;/ins&gt;+; END &lt;/p&gt;
{print $sum/$count, &quot;\n&quot;}&apos;&lt;br/&gt;
377047.1125&lt;br/&gt;
&lt;br/&gt;
Here is the pre change size:&lt;br/&gt;
grep &apos;Serialized size&apos; * | perl -ne &apos;/Serialized size: (\d+?) in (\d+?) ns/ ; print $1, &quot; &quot;, $2, &quot;\n&quot; if $1 &amp;gt; 10000;&apos; | cut -f1 -d&apos; &apos; | perl -ne &apos;$sum &lt;ins&gt;= $_; $count&lt;/ins&gt;+; END {print $sum/$count, &quot;n&quot;}
&lt;p&gt;&apos;&lt;br/&gt;
601078.505882353&lt;/p&gt;

&lt;p&gt;That is about a 60% improvement in size.&lt;/p&gt;

&lt;p&gt;But times are not so good, here are some samples of the old, in (size) (time in ns)&lt;br/&gt;
3874599 10685836&lt;br/&gt;
5582725 11525888&lt;/p&gt;

&lt;p&gt;so that is about 11ms to serialize 3-5mb of data.&lt;/p&gt;

&lt;p&gt;In the new implementation:&lt;br/&gt;
1898788 118504672&lt;br/&gt;
1630058 91133003&lt;/p&gt;

&lt;p&gt;this is 118-91ms for serialized sizes of 1.6-1.8 MB.&lt;/p&gt;
</description>
                <environment></environment>
        <key id="12496764">HBASE-3480</key>
            <summary>Reduce the size of Result serialization</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ryanobjc">ryan rawson</reporter>
                        <labels>
                    </labels>
                <created>Wed, 26 Jan 2011 06:55:04 +0000</created>
                <updated>Tue, 12 Aug 2014 19:15:07 +0000</updated>
                            <resolved>Tue, 12 Aug 2014 19:15:07 +0000</resolved>
                                    <version>0.90.0</version>
                                                        <due></due>
                            <votes>1</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="12987418" author="ryanobjc" created="Thu, 27 Jan 2011 07:40:39 +0000"  >&lt;p&gt;I changed the code to use LZF pure java compression from this library:  &lt;a href=&quot;https://github.com/ning/compress&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://github.com/ning/compress&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The result size is smaller now:&lt;br/&gt;
grep &apos;Serialized size&apos; * | perl -ne &apos;/Serialized size: (\d+?) in (\d+?) ns compressed: (true|false)/ ; print $1, &quot; &quot;, $2, , &quot; &quot;, $3, &quot;\n&quot; if $1 &amp;gt; 10000;&apos;   | cut -f1 -d&apos; &apos; | perl -ne &apos;$sum &lt;ins&gt;= $_; $count&lt;/ins&gt;+; END &lt;/p&gt;
{print $sum/$count, &quot;\n&quot;}
&lt;p&gt;&apos;&lt;br/&gt;
277735.361445783&lt;/p&gt;

&lt;p&gt;But the times still arent so great:&lt;br/&gt;
1775773 106297860 true&lt;br/&gt;
1620568 68043741 true&lt;br/&gt;
1334129 98508585 true&lt;br/&gt;
1408999 78860459 true&lt;br/&gt;
1264817 60595079 true&lt;br/&gt;
622714 28482354 true&lt;br/&gt;
511205 23480742 true&lt;/p&gt;

&lt;p&gt;The &apos;true&apos; means that this response was compressed.  The first column is response size from HRS -&amp;gt; client in bytes, the second column is time it took to serialize, including both the Result.write* code and the compression in nanoseconds.&lt;/p&gt;

&lt;p&gt;We may be better off with a C-based compression algorithm, which would be feasible via this mechanism:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;we will only compress responses we know the size for, and if the size &amp;gt; $THRESHOLD&lt;/li&gt;
	&lt;li&gt;we can serialize the Result/Result[] into a DirectByteBuffer&lt;/li&gt;
	&lt;li&gt;we can then compress the resulting DirectByteBuffer in to a new one&lt;/li&gt;
	&lt;li&gt;we can then use nio to directly reply from this DBB.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;I think we could dig up some benchmarks for the java vs C implementation of LZF and figure out if this might be worthwhile or not.&lt;/p&gt;</comment>
                            <comment id="13003192" author="kzk" created="Sun, 6 Mar 2011 17:36:25 +0000"  >&lt;p&gt;I really wanna this feature, because I store the the large amount of text data which the compression really matters.&lt;/p&gt;

&lt;p&gt;Currently, I use the LZ compression at the application layer. Happy to have this in the Hbase layer.&lt;/p&gt;

&lt;p&gt;Should be better to select the compression algorithm (If I store the images, then this optimization is just the overhead). &lt;/p&gt;

&lt;p&gt;And how about Put side?&lt;/p&gt;</comment>
                            <comment id="13003260" author="ryanobjc" created="Mon, 7 Mar 2011 04:54:59 +0000"  >&lt;p&gt;in my test the cost of serialization was larger than the time savings&lt;br/&gt;
of data transmission on the wire.&lt;/p&gt;

&lt;p&gt;I think we are going to put a freeze on RPC changes soon, we need to&lt;br/&gt;
be thinking next gen.&lt;/p&gt;</comment>
                            <comment id="14094536" author="apurtell" created="Tue, 12 Aug 2014 19:15:07 +0000"  >&lt;p&gt;Didn&apos;t pan out&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12469525" name="HBASE-3480-lzf.txt" size="6881" author="ryanobjc" created="Thu, 27 Jan 2011 07:41:42 +0000"/>
                            <attachment id="12469387" name="HBASE-3480.txt" size="8386" author="ryanobjc" created="Wed, 26 Jan 2011 06:56:17 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 6 Mar 2011 17:36:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26879</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            2 years, 18 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02e1b:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11875</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>