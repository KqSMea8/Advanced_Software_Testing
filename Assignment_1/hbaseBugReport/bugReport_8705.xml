<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:57:45 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-8705/HBASE-8705.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-8705] RS holding META when restarted in a single node setup may hang infinitely without META assignment</title>
                <link>https://issues.apache.org/jira/browse/HBASE-8705</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This bug may be minor as it likely to happen in a single node setup.&lt;br/&gt;
I restarted the RS holding META. The master tried assigning META using MetaSSH. But tried this before the new RS came up.&lt;br/&gt;
So as not region plan is found &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (plan == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to determine a plan to assign &quot;&lt;/span&gt; + region);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tomActivated){
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.timeoutMonitor.setAllRegionServersOffline(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          regionStates.updateRegionState(region, RegionState.State.FAILED_OPEN);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;we just return without assigment.  And this being the META the small cluster just hangs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12651638">HBASE-8705</key>
            <summary>RS holding META when restarted in a single node setup may hang infinitely without META assignment</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="ram_krish">ramkrishna.s.vasudevan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 7 Jun 2013 07:16:31 +0000</created>
                <updated>Mon, 23 Sep 2013 19:28:46 +0000</updated>
                            <resolved>Sat, 22 Jun 2013 11:45:44 +0000</resolved>
                                    <version>0.95.1</version>
                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.95.2</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>10</watches>
                                                                <comments>
                            <comment id="13680508" author="ram_krish" created="Tue, 11 Jun 2013 18:38:44 +0000"  >&lt;p&gt;A simple patch that just retries incase of META. What you guys think about it. &lt;br/&gt;
It is nothing but reintroducing the logic where the assignment was attempted for maxAttempts number of times.  This just does that for META incase of no region plan available but with a sleep.&lt;/p&gt;</comment>
                            <comment id="13680555" author="stack" created="Tue, 11 Jun 2013 19:03:40 +0000"  >&lt;p&gt;+1 Seems innocuous and could help...&lt;/p&gt;
</comment>
                            <comment id="13680901" author="ram_krish" created="Wed, 12 Jun 2013 02:16:33 +0000"  >&lt;p&gt;Thanks Stack.  Will wait for another day before committing this.&lt;/p&gt;</comment>
                            <comment id="13681397" author="jxiang" created="Wed, 12 Jun 2013 17:11:45 +0000"  >&lt;p&gt;+1, just one nit, should we reset the interruption flag in case an interrupted exception?&lt;/p&gt;</comment>
                            <comment id="13681779" author="ram_krish" created="Wed, 12 Jun 2013 23:59:46 +0000"  >&lt;p&gt;Updated patch that resets the interrupt flag.&lt;br/&gt;
Also removed the return stmt from InterruptedException catch block.  The stmt below that would be enough.&lt;br/&gt;
Thanks for the reviews.&lt;/p&gt;</comment>
                            <comment id="13684061" author="stack" created="Sat, 15 Jun 2013 04:25:37 +0000"  >&lt;p&gt;+1&lt;/p&gt;</comment>
                            <comment id="13684245" author="v.himanshu" created="Sat, 15 Jun 2013 17:27:09 +0000"  >&lt;p&gt;Thanks for the patch. Couple of comments:&lt;/p&gt;

&lt;p&gt;So, it suggests that one needs to run hbck when there is no regionserver? What if I restart the regionserver?&lt;/p&gt;

&lt;p&gt;nit: +              LOG.error(&quot;Unable to deteramine a plan to assign META even after repeated attempts. Run HBCK to fix this&quot;);&lt;br/&gt;
typo: &quot;determine&quot;&lt;/p&gt;</comment>
                            <comment id="13686416" author="ram_krish" created="Tue, 18 Jun 2013 05:48:42 +0000"  >&lt;p&gt;Will update the patch and upload it. Thanks for the reviews.&lt;/p&gt;</comment>
                            <comment id="13686902" author="ram_krish" created="Tue, 18 Jun 2013 16:36:50 +0000"  >&lt;p&gt;Updated patch.  Will confirm before committing if resetarting the RS would help.&lt;/p&gt;</comment>
                            <comment id="13689139" author="ram_krish" created="Thu, 20 Jun 2013 11:04:17 +0000"  >&lt;p&gt;Am not able to reproduce this scenario every time.  But after seeing the logs the restart of RS will not solve the problem because the META location is already unset in the ZK.&lt;br/&gt;
I can commit this patch unless objections.&lt;/p&gt;</comment>
                            <comment id="13691112" author="ram_krish" created="Sat, 22 Jun 2013 11:40:16 +0000"  >&lt;p&gt;Committed to trunk and 0.95.&lt;br/&gt;
Thanks all for the review.&lt;/p&gt;</comment>
                            <comment id="13691114" author="hadoopqa" created="Sat, 22 Jun 2013 11:42:48 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12588410/HBASE-8705_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12588410/HBASE-8705_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/6100//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/6100//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13691152" author="hudson" created="Sat, 22 Jun 2013 13:48:01 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #4196 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/4196/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/4196/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8705&quot; title=&quot;RS holding META when restarted in a single node setup may hang infinitely without META assignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8705&quot;&gt;&lt;del&gt;HBASE-8705&lt;/del&gt;&lt;/a&gt;-RS holding META when restarted in a single node setup may hang infinitely without META assignment (Ram) (Revision 1495705)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13691160" author="hudson" created="Sat, 22 Jun 2013 14:08:57 +0000"  >&lt;p&gt;Integrated in hbase-0.95 #259 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95/259/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95/259/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8705&quot; title=&quot;RS holding META when restarted in a single node setup may hang infinitely without META assignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8705&quot;&gt;&lt;del&gt;HBASE-8705&lt;/del&gt;&lt;/a&gt;-RS holding META when restarted in a single node setup may hang infinitely without META assignment (Ram) (Revision 1495707)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13691291" author="hudson" created="Sat, 22 Jun 2013 23:59:20 +0000"  >&lt;p&gt;Integrated in hbase-0.95-on-hadoop2 #143 (See &lt;a href=&quot;https://builds.apache.org/job/hbase-0.95-on-hadoop2/143/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/hbase-0.95-on-hadoop2/143/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8705&quot; title=&quot;RS holding META when restarted in a single node setup may hang infinitely without META assignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8705&quot;&gt;&lt;del&gt;HBASE-8705&lt;/del&gt;&lt;/a&gt;-RS holding META when restarted in a single node setup may hang infinitely without META assignment (Ram) (Revision 1495707)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.95/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13691307" author="hudson" created="Sun, 23 Jun 2013 00:59:18 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #578 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/578/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/578/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8705&quot; title=&quot;RS holding META when restarted in a single node setup may hang infinitely without META assignment&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8705&quot;&gt;&lt;del&gt;HBASE-8705&lt;/del&gt;&lt;/a&gt;-RS holding META when restarted in a single node setup may hang infinitely without META assignment (Ram) (Revision 1495705)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13714954" author="rajesh23" created="Mon, 22 Jul 2013 06:48:57 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jxiang&quot; class=&quot;user-hover&quot; rel=&quot;jxiang&quot;&gt;Jimmy Xiang&lt;/a&gt;&lt;br/&gt;
if we stop all region servers by hbase-deamon.sh stop command then .META. is never online with 10 seconds delay in starting a region server.&lt;br/&gt;
In single node cluster, many times .META. in transition after stopping the RS.&lt;br/&gt;
Can we retry meta assignment even after max attempts until we find some online region server. Otherwise we need to run hbck everytime in this common case.&lt;br/&gt;
What do you say?&lt;/p&gt;

</comment>
                            <comment id="13715064" author="ram_krish" created="Mon, 22 Jul 2013 09:53:46 +0000"  >&lt;p&gt;&amp;gt;&amp;gt;In single node cluster, many times .META. in transition after stopping the RS.&lt;br/&gt;
Is there any easy way to identify a single node cluster?  Or you mean to say if online servers are 0 keep waiting till it becomes atleast 1?&lt;/p&gt;</comment>
                            <comment id="13715076" author="rajesh23" created="Mon, 22 Jul 2013 10:20:10 +0000"  >&lt;p&gt;I mean we can retry until we find one online server to assign META.&lt;br/&gt;
After reaching max attempts if we reset i value to 0(only for META region), then we can check for online servers even after max attempts. If any one RS is online then META will be assinged.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (plan == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
        LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Unable to determine a plan to assign &quot;&lt;/span&gt; + region);
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (tomActivated){
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.timeoutMonitor.setAllRegionServersOffline(&lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (region.isMetaRegion()) {
            &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt; {
              &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i == maximumAttempts) {
                i = 0;
              }
              &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.sleepTimeBeforeRetryingMetaAssignment);
              &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;;
            } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
              LOG.error(&lt;span class=&quot;code-quote&quot;&gt;&quot;Got exception &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; waiting &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; META assignment&quot;&lt;/span&gt;);
              &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.currentThread().interrupt();
            }
          }
          regionStates.updateRegionState(region, RegionState.State.FAILED_OPEN);
        }
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13715094" author="ram_krish" created="Mon, 22 Jul 2013 10:37:35 +0000"  >&lt;p&gt;I got your point. If you are running a single cluster setup&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
sleepTimeBeforeRetryingMetaAssignment
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can you increase this config and if needed the maxTries also. Should a fix in the code needed here?&lt;/p&gt;</comment>
                            <comment id="13715100" author="rajesh23" created="Mon, 22 Jul 2013 10:46:51 +0000"  >&lt;blockquote&gt;&lt;p&gt;Can you increase this config and if needed the maxTries also. &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We can increase these values, but may not know the delay before starting new RS.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Should a fix in the code needed here?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;It will be better I feel. &lt;/p&gt;</comment>
                            <comment id="13715151" author="ram_krish" created="Mon, 22 Jul 2013 12:15:46 +0000"  >&lt;p&gt;Okie.. Come up with a patch.  If others agree we can commit it.  &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12653073">HBASE-8750</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12588409" name="HBASE-8705.patch" size="2295" author="ram_krish" created="Tue, 18 Jun 2013 16:35:58 +0000"/>
                            <attachment id="12587526" name="HBASE-8705_1.patch" size="2237" author="ram_krish" created="Wed, 12 Jun 2013 23:59:46 +0000"/>
                            <attachment id="12588410" name="HBASE-8705_2.patch" size="2236" author="ram_krish" created="Tue, 18 Jun 2013 16:36:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 11 Jun 2013 19:03:40 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>331964</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 21 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1l9of:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>332293</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>