<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:05:21 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-2858/HBASE-2858.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-2858] TestReplication.queueFailover fails half the time</title>
                <link>https://issues.apache.org/jira/browse/HBASE-2858</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;TestReplication.queueFailover fails 50% of the time, it&apos;s because ZooKeeperWrapper.listZnodes (introduced in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2694&quot; title=&quot;Move RS to Master region open/close messaging into ZooKeeper&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2694&quot;&gt;&lt;del&gt;HBASE-2694&lt;/del&gt;&lt;/a&gt; and missed by &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2735&quot; title=&quot;Make HBASE-2694 replication-friendly&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2735&quot;&gt;&lt;del&gt;HBASE-2735&lt;/del&gt;&lt;/a&gt;) doesn&apos;t use the Watcher it&apos;s passed so sometimes ReplicationSource misses hlogs to replicate for the region server we kill. Also it uncovered an issue (while I was fixing the first one) that RepSource ignores log files too quickly when the master is a bit too slow to split logs.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12469768">HBASE-2858</key>
            <summary>TestReplication.queueFailover fails half the time</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Wed, 21 Jul 2010 00:23:12 +0000</created>
                <updated>Fri, 20 Nov 2015 12:44:07 +0000</updated>
                            <resolved>Thu, 22 Jul 2010 00:17:15 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12890518" author="hbasereviewboard" created="Wed, 21 Jul 2010 00:54:41 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/349/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/349/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch fixes the ZKW.listZNodes issue and clears up a bit the path situation in ReplicationSource by removing a lock and adding wits to figure where the log is moved. The test now passes 100% of the time for me (up from 50%).&lt;/p&gt;

&lt;p&gt;There&apos;s one open issues as outlined by the two TODOS, what happens if a log is missing from HDFS? When the queue is recovered, it could mean that HDFS was cleared but not ZK, but during normal operations it would point to a bug? Report and continue?&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2858&quot; title=&quot;TestReplication.queueFailover fails half the time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2858&quot;&gt;&lt;del&gt;HBASE-2858&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2858&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2858&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java e6b365e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/Replication.java a037aae &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java 6b9dcb5 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java 2e13a0a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java e8dd268 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java 163671f &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java bb09bc3 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/349/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/349/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit testing.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jean-Daniel&lt;/p&gt;

</comment>
                            <comment id="12890548" author="hbasereviewboard" created="Wed, 21 Jul 2010 03:47:24 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/349/#review435&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/349/#review435&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Looks good.  I&apos;m not clear on some of below.  Can you clarify before I +1 it?&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/349/#comment1834&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/349/#comment1834&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Just remove this method altogether?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/349/#comment1835&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/349/#comment1835&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is this right?  You are getting a reader here.  If file is not in expected location, we fall into FNFE area.  These just seem to be testing existance, not getting a reader on the new location if it exists.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;http://review.hbase.org/r/349/#comment1836&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/349/#comment1836&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    See above comment on this same method.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12890817" author="hbasereviewboard" created="Wed, 21 Jul 2010 18:38:55 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-07-20 20:34:23, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java, line 221&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/349/diff/1/?file=2968#file2968line221&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/349/diff/1/?file=2968#file2968line221&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Just remove this method altogether?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I was thinking of keeping it around in the interface for other uses... but currently there&apos;s none. Deleting.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2010-07-20 20:34:23, stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java, line 437&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;http://review.hbase.org/r/349/diff/1/?file=2968#file2968line437&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/349/diff/1/?file=2968#file2968line437&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Is this right?  You are getting a reader here.  If file is not in expected location, we fall into FNFE area.  These just seem to be testing existance, not getting a reader on the new location if it exists.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;If the queue was recovered, we&apos;re waiting for the master to finish splitting it to start reading from it. Then it sleeps and retries.&lt;/p&gt;

&lt;p&gt;If it&apos;s a normal queue, the location is updated. Then it sleeps and retries with the new location. I guess it could get the reader right away.&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Jean-Daniel&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/349/#review435&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/349/#review435&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


</comment>
                            <comment id="12890878" author="hbasereviewboard" created="Wed, 21 Jul 2010 20:39:20 +0000"  >&lt;p&gt;Message from: &quot;Jean-Daniel Cryans&quot; &amp;lt;jdcryans@apache.org&amp;gt;&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/349/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/349/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2010-07-21 13:33:51.105842)&lt;/p&gt;


&lt;p&gt;Review request for hbase.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Updated diff, removed the logArchived method and, when a log is archived, we start reading from the new location right away.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;This patch fixes the ZKW.listZNodes issue and clears up a bit the path situation in ReplicationSource by removing a lock and adding wits to figure where the log is moved. The test now passes 100% of the time for me (up from 50%).&lt;/p&gt;

&lt;p&gt;There&apos;s one open issues as outlined by the two TODOS, what happens if a log is missing from HDFS? When the queue is recovered, it could mean that HDFS was cleared but not ZK, but during normal operations it would point to a bug? Report and continue?&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2858&quot; title=&quot;TestReplication.queueFailover fails half the time&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2858&quot;&gt;&lt;del&gt;HBASE-2858&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;http://issues.apache.org/jira/browse/HBASE-2858&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/browse/HBASE-2858&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java e6b365e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/HLog.java e1b4077 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/regionserver/wal/LogActionsListener.java 9b18992 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/Replication.java a037aae &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSource.java 6b9dcb5 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceInterface.java 1d7ae7e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSourceManager.java 2e13a0a &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/zookeeper/ZooKeeperWrapper.java e8dd268 &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/regionserver/wal/TestLogActionsListener.java d03809c &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/ReplicationSourceDummy.java ad9e8fb &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/TestReplication.java 163671f &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/replication/regionserver/TestReplicationSourceManager.java bb09bc3 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;http://review.hbase.org/r/349/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/349/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;Unit testing.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Jean-Daniel&lt;/p&gt;

</comment>
                            <comment id="12890955" author="hbasereviewboard" created="Wed, 21 Jul 2010 23:56:38 +0000"  >&lt;p&gt;Message from: stack@duboce.net&lt;/p&gt;

&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;http://review.hbase.org/r/349/#review444&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://review.hbase.org/r/349/#review444&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;+1&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;stack&lt;/li&gt;
&lt;/ul&gt;



</comment>
                            <comment id="12890966" author="jdcryans" created="Thu, 22 Jul 2010 00:17:14 +0000"  >&lt;p&gt;Committed to trunk, thanks for the review Stack!&lt;/p&gt;</comment>
                            <comment id="15017714" author="lars_francke" created="Fri, 20 Nov 2015 12:44:07 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 21 Jul 2010 00:54:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26501</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hjjz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100430</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>