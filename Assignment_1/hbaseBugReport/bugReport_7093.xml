<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:42:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7093/HBASE-7093.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7093] Couple Increments/Appends with Put/Delete(s)</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7093</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;See related issue - &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4583&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-4583&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Currently, we cannot bundle increment/append with put/delete operations. The above JIRA MVCC&apos;izes the increment/append operations.&lt;/p&gt;

&lt;p&gt;One issue is that increment(s)/append(s) are not idempotent and hence repeating the transaction has an associated issue of leading to incorrect value/append results. This could be solved by passing additional tokens as part of the append(s).&lt;/p&gt;

&lt;p&gt;One possible high level approach could be:&lt;br/&gt;
1) Class IncrementMutation which inherits from Increment and Mutation&lt;br/&gt;
2) In the mutateRow call, we add a case for &quot;IncrementMutation&quot; object&lt;br/&gt;
3) Factor out the code wrapped inside the &quot;lock and MVCC&quot; from increment() function to internalIncrement.&lt;br/&gt;
4) Call internalIncrement from mutateRow and increment()&lt;/p&gt;</description>
                <environment></environment>
        <key id="12614622">HBASE-7093</key>
            <summary>Couple Increments/Appends with Put/Delete(s)</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="varunsharma">Varun Sharma</assignee>
                                    <reporter username="varunsharma">Varun Sharma</reporter>
                        <labels>
                    </labels>
                <created>Sat, 3 Nov 2012 00:22:17 +0000</created>
                <updated>Thu, 15 Nov 2012 19:38:45 +0000</updated>
                                            <version>0.95.2</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13497770" author="varunsharma" created="Thu, 15 Nov 2012 05:21:56 +0000"  >&lt;p&gt;Hi, I have attached a sketch of a patch for supporting append operation (Increment seems more complicated) as part of Puts + Deletes. I am yet to add this to the miniBatch... function and also add tests. Needed to get any early input. Could someone please have a look ? Thanks !&lt;/p&gt;</comment>
                            <comment id="13497778" author="yuzhihong@gmail.com" created="Thu, 15 Nov 2012 05:39:21 +0000"  >&lt;p&gt;In javadoc, describe what the method does:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; prepareAppend(Append append, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; now, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; advanceMemstoreRead) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Also, add @return javadoc.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; advancedMemstoreRead = &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (advanceMemstoreRead) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Why introducing a local variable which is spelled almost exactly the same as method parameter ?&lt;br/&gt;
Looking at the method&apos;s return value, it would be the same as that of the input parameter, advanceMemstoreRead. Looks like you don&apos;t need advancedMemstoreRead.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        advancedMemstoreWrite = region.prepareAppend((Append)m, now, !advancedMemstoreWrite);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can you explain the role for advancedMemstoreWrite above (especially the assignment) ?&lt;/p&gt;</comment>
                            <comment id="13498205" author="apurtell" created="Thu, 15 Nov 2012 18:30:18 +0000"  >&lt;blockquote&gt;&lt;p&gt;Class IncrementMutation which inherits from Increment and Mutation&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think you will find some method signatures between them incompatible. &lt;/p&gt;</comment>
                            <comment id="13498210" author="varunsharma" created="Thu, 15 Nov 2012 18:31:24 +0000"  >&lt;p&gt;Hi Ted,&lt;/p&gt;

&lt;p&gt;Thanks for taking a look.&lt;/p&gt;

&lt;p&gt;HBASE 4583 forced appends and increments to wait for previous Memstore transactions to complete since otherwise we could have potential race conditions with puts into that same column.&lt;/p&gt;

&lt;p&gt;However, if we allow Append(s) as part of MutateRow - this variable essentially allows us to do this &quot;wait for previous memstore&quot; transaction thing exactly once. So, we pass to prepareAppend whether we have historically advanced the memstore, if not, then prepareAppend shall advance it for us. Maybe i should rename the argument and variable in the process() call to be - &quot;waitForPreviousMemstoreWrite&quot; and the local variable to be advancedMemstoreWrite...&lt;/p&gt;</comment>
                            <comment id="13498221" author="varunsharma" created="Thu, 15 Nov 2012 18:37:33 +0000"  >&lt;p&gt;Hi Andrew,&lt;/p&gt;

&lt;p&gt;I remember seeing your other JIRA which talks about the incompatibility b/w Increment and Mutation - I can&apos;t find it now but it looks like doing Increment would be harder so i might not cover that in this JIRA (only cover Append here).&lt;/p&gt;</comment>
                            <comment id="13498227" author="apurtell" created="Thu, 15 Nov 2012 18:38:56 +0000"  >&lt;p&gt;I think you mean &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7114&quot; title=&quot;Increment does not extend Mutation but probably should&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7114&quot;&gt;&lt;del&gt;HBASE-7114&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="13498229" author="yuzhihong@gmail.com" created="Thu, 15 Nov 2012 18:43:21 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
     &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (Mutation m : mutations) {
...
+        advancedMemstoreWrite = region.prepareAppend((Append)m, now, !advancedMemstoreWrite);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Since prepareAppend() is called in a loop, if there&apos;re multiple Append&apos;s in mutations, the value of waitForPreviousMemstoreWrite would toggle between calls to prepareAppend(), right ?&lt;br/&gt;
That doesn&apos;t seem to be what you wanted.&lt;/p&gt;</comment>
                            <comment id="13498264" author="varunsharma" created="Thu, 15 Nov 2012 19:29:35 +0000"  >&lt;p&gt;Good catch - I will fix that part - anything else that might seem structurally wrong with the patch (it somewhat changes the RowProcessor interface) - I can fix this and also add tests in a subsequent patch&lt;/p&gt;</comment>
                            <comment id="13498267" author="yuzhihong@gmail.com" created="Thu, 15 Nov 2012 19:35:17 +0000"  >&lt;blockquote&gt;&lt;p&gt;also add tests in a subsequent patch&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can you add test(s) in this JIRA ?&lt;/p&gt;</comment>
                            <comment id="13498271" author="varunsharma" created="Thu, 15 Nov 2012 19:38:45 +0000"  >&lt;p&gt;Yeah, thats what I meant, I will send out a v2 with the tests. THanks !&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12553620" name="7093-v1.txt" size="14055" author="varunsharma" created="Thu, 15 Nov 2012 05:20:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 15 Nov 2012 05:39:21 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>255038</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 5 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0eonj:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>83756</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>