<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:46:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7536/HBASE-7536.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7536] Add test that confirms that multiple concurrent snapshot requests are rejected.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7536</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently the rule is that we can only have online snapshot running at a time.  This test tries to prove this.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12627083">HBASE-7536</key>
            <summary>Add test that confirms that multiple concurrent snapshot requests are rejected.</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12619005">HBASE-7290</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jmhsieh">Jonathan Hsieh</assignee>
                                    <reporter username="jmhsieh">Jonathan Hsieh</reporter>
                        <labels>
                    </labels>
                <created>Thu, 10 Jan 2013 23:51:44 +0000</created>
                <updated>Mon, 23 Sep 2013 18:30:30 +0000</updated>
                            <resolved>Tue, 15 Jan 2013 00:32:47 +0000</resolved>
                                                    <fixVersion>0.95.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13550643" author="hadoopqa" created="Fri, 11 Jan 2013 00:54:51 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12564300/pre-hbase-7536.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12564300/pre-hbase-7536.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 329 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3971//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3971//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13550666" author="yuzhihong@gmail.com" created="Fri, 11 Jan 2013 01:14:41 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          + &lt;span class=&quot;code-quote&quot;&gt;&quot; because we are already have a restore in progress on the same snapshot &quot;&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Remove extra &apos;are&apos; above.&lt;/p&gt;

&lt;p&gt;I don&apos;t see new test in the patch, BTW&lt;/p&gt;</comment>
                            <comment id="13550670" author="jmhsieh" created="Fri, 11 Jan 2013 01:18:54 +0000"  >&lt;p&gt;Oops, generated patch from wrong hash.  Just replaced old version with the corrected new version.&lt;/p&gt;</comment>
                            <comment id="13550673" author="hadoopqa" created="Fri, 11 Jan 2013 01:26:42 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12564312/pre-hbase-7536.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12564312/pre-hbase-7536.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 329 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3973//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3973//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13550730" author="yuzhihong@gmail.com" created="Fri, 11 Jan 2013 02:43:45 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+   * Demonstrate that we rejected snapshot requests &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there snapshot currently running.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&apos;rejected&apos; -&amp;gt; &apos;reject&apos;&lt;br/&gt;
&apos;if there snapshot&apos; -&amp;gt; &apos;if there is snapshot&apos;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    assertTrue(&lt;span class=&quot;code-quote&quot;&gt;&quot;We expect at least 1 request to be rejected because of we concurrently&quot;&lt;/span&gt; +
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Can we put enough data in the table so that when ssNum is 2 or 3, the above assertion still holds ?&lt;/p&gt;</comment>
                            <comment id="13550783" author="jmhsieh" created="Fri, 11 Jan 2013 03:27:26 +0000"  >&lt;p&gt;When I ran it we ended up with 1, 2 or 3 snapshots &amp;#8211; but the debugging info showed that they happened serially (which is valid).  &lt;/p&gt;

&lt;p&gt;Th problem to make this even more robust, we&apos;d need to no add more data but add more regions.  To make this truly robust, we&apos;d need to either rewrite major portions so we can control everything.  &lt;/p&gt;</comment>
                            <comment id="13550788" author="yuzhihong@gmail.com" created="Fri, 11 Jan 2013 03:36:17 +0000"  >&lt;p&gt;Understood.&lt;br/&gt;
It is up to your discretion.&lt;/p&gt;</comment>
                            <comment id="13551300" author="mbertozzi" created="Fri, 11 Jan 2013 17:38:19 +0000"  >&lt;p&gt;why the test has a timeout? are you expecting things hanging?&lt;br/&gt;
are 60sec enough to fill a table and take 5 snapshot, when jenkins is busy with other large stuff?&lt;/p&gt;

&lt;p&gt;why are you using a thread instead of using the taskSnapshotAsync()? (no particular opinion on that, I like the thread)&lt;/p&gt;</comment>
                            <comment id="13551318" author="jmhsieh" created="Fri, 11 Jan 2013 17:48:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;why the test has a timeout? are you expecting things hanging? are 60sec enough to fill a table and take 5 snapshot, when jenkins is busy with other large stuff?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;In general if I have code that has a while(true) loop, I make it have a timeout.  The test finishes in about 10 seconds so giving a timeout of 5-10x seems reasonable.  If it isn&apos;t enough, we can bump it up.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;why are you using a thread instead of using the taskSnapshotAsync()? (no particular opinion on that, I like the thread)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No good reason, I&apos;ll change it to the async version on the next rev.&lt;/p&gt;


</comment>
                            <comment id="13552331" author="jmhsieh" created="Sun, 13 Jan 2013 21:59:11 +0000"  >&lt;p&gt;Updated to use the async method.  This exposed a race condition in the test and also the need for a tighter passing condition.  I&apos;ve fixed them &amp;#8211; we must submit before we start checking, and we need to have at least one snapshot complete for this to be interesting. &lt;/p&gt;


&lt;p&gt;This test passes:&lt;br/&gt;
mvn clean test -Dtest=Test*Snapshot*,snapshot/*,TestFSUtils -PlocalTests -Dmaven.test.redirectTestOutputToFile=true -Djava.net.preferIPv4Stack=true&lt;/p&gt;</comment>
                            <comment id="13552333" author="hadoopqa" created="Sun, 13 Jan 2013 22:03:07 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12564641/pre-hbase-7536.v2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12564641/pre-hbase-7536.v2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 337 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/3995//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/3995//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13552352" author="yuzhihong@gmail.com" created="Sun, 13 Jan 2013 23:22:40 +0000"  >&lt;p&gt;Looks like my comment from 11/Jan/13 02:43 is yet to be addressed.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; CountDownLatch submitted = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CountDownLatch(ssNum);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;nit: since the latch counts down, shall we name it toBeSubmitted ?&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    class SSThread &lt;span class=&quot;code-keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;Runnable&lt;/span&gt; {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Better name the class SSRunnable.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (Exception e) {
+          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Exception during snapshot request: &quot;&lt;/span&gt; + SnapshotDescriptionUtils.toString(ss), e);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;log should be at warn level.&lt;/p&gt;</comment>
                            <comment id="13553220" author="jmhsieh" created="Mon, 14 Jan 2013 22:47:00 +0000"  >&lt;p&gt;updated to address ted&apos;s comments.&lt;/p&gt;

&lt;p&gt;For the last one &amp;#8211; I didn&apos;t change to warn but added more description in the text &amp;#8211; these are expected since so isn&apos;t really a warning level log message.&lt;/p&gt;</comment>
                            <comment id="13553233" author="mbertozzi" created="Mon, 14 Jan 2013 22:58:21 +0000"  >&lt;p&gt;v3 looks good to me&lt;/p&gt;</comment>
                            <comment id="13553243" author="yuzhihong@gmail.com" created="Mon, 14 Jan 2013 23:09:15 +0000"  >&lt;p&gt;+1 from me.&lt;/p&gt;</comment>
                            <comment id="13553267" author="hadoopqa" created="Mon, 14 Jan 2013 23:31:58 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12564798/hbase-7536.v3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12564798/hbase-7536.v3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 3 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/4011//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/4011//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13553338" author="jmhsieh" created="Tue, 15 Jan 2013 00:32:30 +0000"  >&lt;p&gt;thanks for the reviews ted and matteo.  commited to hbase-7290 snapshots branch.&lt;/p&gt;</comment>
                            <comment id="13774990" author="stack" created="Mon, 23 Sep 2013 18:30:30 +0000"  >&lt;p&gt;Marking closed.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12564311" name="hbase-7536.patch" size="4449" author="jmhsieh" created="Fri, 11 Jan 2013 01:18:54 +0000"/>
                            <attachment id="12564640" name="hbase-7536.v2.patch" size="4794" author="jmhsieh" created="Sun, 13 Jan 2013 21:59:11 +0000"/>
                            <attachment id="12564798" name="hbase-7536.v3.patch" size="4864" author="jmhsieh" created="Mon, 14 Jan 2013 22:50:58 +0000"/>
                            <attachment id="12564312" name="pre-hbase-7536.patch" size="3696991" author="jmhsieh" created="Fri, 11 Jan 2013 01:18:54 +0000"/>
                            <attachment id="12564641" name="pre-hbase-7536.v2.patch" size="3728676" author="jmhsieh" created="Sun, 13 Jan 2013 21:59:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 11 Jan 2013 00:54:51 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>303776</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 12 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i17edr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>251299</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>