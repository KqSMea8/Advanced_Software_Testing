<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:07:03 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3064/HBASE-3064.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3064] Long sleeping in HConnectionManager after thread is interrupted</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3064</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We run sometimes into the problem that when a thread running HBase client code is interrupted, it hangs. The problem is it is sleeping in HConnectionManager, in the methods locateRegionInMeta and getRegionServerWithRetries, where there is code like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;{
  &lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(getPauseTime(tries));
} &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
  &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;continue&lt;/span&gt;
&lt;/span&gt;}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;which is located in a for-loop, so it will keep retrying even when someone requested the thread to stop its work.&lt;/p&gt;

&lt;p&gt;The attached patch proposes as fix to re-assert the interrupted status of the thread and to throw an IOException. Some other cases of InterruptedException-handling in the same class do a similar thing, though sometimes returning null or breaking. I found returning null causes NPE&apos;s in other locations so I think it is better to throw an informative exception.&lt;/p&gt;

&lt;p&gt;Side thought: I would not be against propagating the InterruptedException all the way up to the client APIs (HTable/HBaseAdmin), so that users who want to support interruptable threads do not have to check the interrupted flag. I&apos;d need to check some more but I have the impression that now sometimes methods like HTable.get() simply return null when a thread is interrupted.&lt;/p&gt;

&lt;p&gt;Some background on good ways of handling InterruptedExceptions can be found here:&lt;br/&gt;
&lt;a href=&quot;http://www.ibm.com/developerworks/java/library/j-jtp05236.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://www.ibm.com/developerworks/java/library/j-jtp05236.html&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="12475612">HBASE-3064</key>
            <summary>Long sleeping in HConnectionManager after thread is interrupted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="bruno">Bruno Dumon</assignee>
                                    <reporter username="bruno">Bruno Dumon</reporter>
                        <labels>
                    </labels>
                <created>Fri, 1 Oct 2010 13:32:09 +0000</created>
                <updated>Fri, 20 Nov 2015 12:41:51 +0000</updated>
                            <resolved>Fri, 1 Oct 2010 23:48:44 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                    <component>Client</component>
                    <component>IPC/RPC</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                <comments>
                            <comment id="12916886" author="bruno" created="Fri, 1 Oct 2010 13:33:13 +0000"  >&lt;p&gt;Patch against r1003508&lt;/p&gt;</comment>
                            <comment id="12916909" author="stack" created="Fri, 1 Oct 2010 15:16:25 +0000"  >&lt;p&gt;Over in the new master, we let out all InterruptedExceptions now.  As you suggest, we should do same in client.  The change will be disruptive though in that it&apos;ll change APIs since we&apos;ll have to add IE as thrown to all methods.  So, I think we should apply this patch for 0.90 and then make a new issue to add IE to client APIs for 0.92?  Hows that sound?  If agreeable I&apos;ll apply this patch (it looks good).&lt;/p&gt;</comment>
                            <comment id="12916911" author="bruno" created="Fri, 1 Oct 2010 15:22:37 +0000"  >&lt;p&gt;Sounds perfect. I did not expect the API to be changed overnight, just launching the idea.&lt;/p&gt;

&lt;p&gt;Thanks for the quick follow up.&lt;/p&gt;</comment>
                            <comment id="12917109" author="stack" created="Fri, 1 Oct 2010 23:48:44 +0000"  >&lt;p&gt;Committed.  Thanks for the patch Bruno.  I added &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3072&quot; title=&quot;Client should be interruptible; APIs should all change to let out Interrupted Exception&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3072&quot;&gt;&lt;del&gt;HBASE-3072&lt;/del&gt;&lt;/a&gt; to make the client generally interruptible.&lt;/p&gt;</comment>
                            <comment id="15017092" author="lars_francke" created="Fri, 20 Nov 2015 12:41:51 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12456114" name="connectionmgr-interruptedexc-patch.txt" size="1833" author="bruno" created="Fri, 1 Oct 2010 13:33:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 1 Oct 2010 15:16:25 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26623</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hklb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100598</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>