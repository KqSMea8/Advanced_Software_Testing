<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:23:26 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4951/HBASE-4951.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4951] master process can not be stopped when it is initializing</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4951</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;It is easy to reproduce by following step:&lt;br/&gt;
step1:start master process.(do not start regionserver process in the cluster).&lt;br/&gt;
the master will wait the regionserver to check in:&lt;br/&gt;
org.apache.hadoop.hbase.master.ServerManager: Waiting on regionserver(s) to checkin&lt;/p&gt;

&lt;p&gt;step2:stop the master by sh command bin/hbase master stop&lt;/p&gt;

&lt;p&gt;result:the master process will never die because catalogTracker.waitForRoot() method will block unitl the root region assigned.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12533841">HBASE-4951</key>
            <summary>master process can not be stopped when it is initializing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="xufeng">xufeng</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 Dec 2011 06:16:51 +0000</created>
                <updated>Tue, 30 Dec 2014 04:37:36 +0000</updated>
                            <resolved>Tue, 30 Dec 2014 04:37:36 +0000</resolved>
                                    <version>0.90.3</version>
                                    <fixVersion>0.90.7</fixVersion>
                                    <component>master</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13163980" author="stack" created="Tue, 6 Dec 2011 23:50:14 +0000"  >&lt;p&gt;I believe this fixed in 0.92.  Won&apos;t close till prove it.&lt;/p&gt;</comment>
                            <comment id="13164072" author="ram_krish" created="Wed, 7 Dec 2011 02:18:26 +0000"  >&lt;p&gt;The master is getting stopped in 0.92. I tried it. &lt;br/&gt;
Correct me if am wrong.&lt;/p&gt;

&lt;p&gt;If it is ok, Can we close this issue?&lt;/p&gt;</comment>
                            <comment id="13165903" author="ram_krish" created="Fri, 9 Dec 2011 07:25:44 +0000"  >&lt;p&gt;@Xufeng.&lt;/p&gt;

&lt;p&gt;I used ./hbase-daemon.sh stop master and it stopped.  My bad..&lt;/p&gt;

&lt;p&gt;if we use ./hbase master stop it doesnt stop.&lt;/p&gt;</comment>
                            <comment id="13165916" author="xufeng" created="Fri, 9 Dec 2011 07:51:06 +0000"  >&lt;p&gt;@ramkrishna&lt;br/&gt;
thanks.&lt;br/&gt;
do you think we should fix it in 0.90.&lt;br/&gt;
I try to create a path. &lt;/p&gt;</comment>
                            <comment id="13166091" author="ram_krish" created="Fri, 9 Dec 2011 11:22:42 +0000"  >&lt;p&gt;The problem is stopped variable is checked in HMaster.run()&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-comment&quot;&gt;// We are either the active master or we were asked to shutdown
&lt;/span&gt;      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.stopped) {
        finishInitialization(startupStatus);
        loop();
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;But in finishInitialization we wait for ROOT to assign and it is a timed wait in that.  So though the master is stopped we dont get the chance to check the status of the stopped variable in master.&lt;/p&gt;

&lt;p&gt;The same happens with splitLogAfterStartup also.&lt;/p&gt;

&lt;p&gt;Attaching the thread dumps&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;master-linux76,60000,1323444760834&quot;&lt;/span&gt; prio=10 tid=0x085cdc00 nid=0x593d in &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait() [0x6fa6f000..0x6fa6ff50]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (on object monitor)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt;.wait(Native Method)
	- waiting on &amp;lt;0x74112e28&amp;gt; (a org.apache.hadoop.hbase.zookeeper.RootRegionTracker)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.blockUntilAvailable(ZooKeeperNodeTracker.java:132)
	- locked &amp;lt;0x74112e28&amp;gt; (a org.apache.hadoop.hbase.zookeeper.RootRegionTracker)
	at org.apache.hadoop.hbase.zookeeper.ZooKeeperNodeTracker.blockUntilAvailable(ZooKeeperNodeTracker.java:104)
	- locked &amp;lt;0x74112e28&amp;gt; (a org.apache.hadoop.hbase.zookeeper.RootRegionTracker)
	at org.apache.hadoop.hbase.catalog.CatalogTracker.waitForRoot(CatalogTracker.java:292)
	at org.apache.hadoop.hbase.master.HMaster.assignRootAndMeta(HMaster.java:573)
	at org.apache.hadoop.hbase.master.HMaster.finishInitialization(HMaster.java:506)
	at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:336)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:619)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-quote&quot;&gt;&quot;master-C3S31,20000,1323415196055&quot;&lt;/span&gt; prio=10 tid=0x000000004036a000 nid=0x60dd waiting on condition [0x00007f708b6f5000]
   java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.State: TIMED_WAITING (sleeping)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.sleep(Native Method)
	at org.apache.hadoop.hbase.master.MasterFileSystem.splitLogAfterStartup(MasterFileSystem.java:226)
	at org.apache.hadoop.hbase.master.HMaster.finishInitialization(HMaster.java:474)
	at org.apache.hadoop.hbase.master.HMaster.run(HMaster.java:314)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:662)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13166099" author="ram_krish" created="Fri, 9 Dec 2011 11:34:15 +0000"  >&lt;p&gt;The thread dump in 09/Dec/11 11:26 is not for this issue.  Sorry.  Pls edit the comment.&lt;/p&gt;</comment>
                            <comment id="13166304" author="stack" created="Fri, 9 Dec 2011 16:52:25 +0000"  >&lt;p&gt;Ram, I made you an admin on JIRA.  You should be able to edit comments.  Resolve if you think appropriate.&lt;/p&gt;</comment>
                            <comment id="13167403" author="ram_krish" created="Mon, 12 Dec 2011 08:04:38 +0000"  >&lt;p&gt;This is for trunk.&lt;/p&gt;</comment>
                            <comment id="13167581" author="yuzhihong@gmail.com" created="Mon, 12 Dec 2011 16:36:53 +0000"  >&lt;p&gt;+1 on patch. &lt;/p&gt;</comment>
                            <comment id="13167647" author="stack" created="Mon, 12 Dec 2011 18:26:22 +0000"  >&lt;p&gt;Missing @return javadoc but its kinda strange I&apos;d say having waitForRegionServers return whether master is stopped or not.  Would suggest changing &apos;+    if (masterStopped) {&apos; into &apos;if (this.master.isStopped()) {&apos; instead.  Makes patch smaller too.&lt;/p&gt;</comment>
                            <comment id="13167668" author="hadoopqa" created="Mon, 12 Dec 2011 18:49:51 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12506976/HBASE-4951.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12506976/HBASE-4951.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -160 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 75 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.client.TestAdmin&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.TestReplication&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/488//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/488//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/488//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/488//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/488//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/488//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13168051" author="xufeng" created="Tue, 13 Dec 2011 01:51:16 +0000"  >&lt;p&gt;I tested this patch in 0.90.&lt;br/&gt;
It can not work in following scenarios:&lt;br/&gt;
1.master startup,one regionserver startup.&lt;br/&gt;
2.waitForRegionServers over and ok.&lt;br/&gt;
3.run the bin/hbase master stop before root region be assigned.&lt;/p&gt;

&lt;p&gt;the bin/hbase master stop will stop the cluster,the regionserver will  been killed first.&lt;br/&gt;
The root region has no chance to be assigned successfully,it will block in catalogTracker.waitForRoot().&lt;/p&gt;</comment>
                            <comment id="13168054" author="xufeng" created="Tue, 13 Dec 2011 01:52:41 +0000"  >&lt;p&gt;I think this problem is also exist in trunk by this patch.&lt;/p&gt;</comment>
                            <comment id="13168084" author="ram_krish" created="Tue, 13 Dec 2011 02:48:28 +0000"  >&lt;p&gt;@Xufeng&lt;br/&gt;
Yes you are right.. the patch address only one problem where the master alone is started.&lt;br/&gt;
We can check for the shutdown node while waiting for Root and if the shut down node does not exist we can come out of wait.  &lt;br/&gt;
Thanks for the finding.&lt;/p&gt;</comment>
                            <comment id="13174167" author="ram_krish" created="Wed, 21 Dec 2011 15:59:34 +0000"  >&lt;p&gt;Patch for branch0.90&lt;/p&gt;</comment>
                            <comment id="13174260" author="zhihyu@ebaysf.com" created="Wed, 21 Dec 2011 18:02:12 +0000"  >&lt;p&gt;Minor comments:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (LOG.isTraceEnabled()) {
+          LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;.META. still not available, sleeping and retrying.&quot;&lt;/span&gt; +
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should LOG.isInfoEnabled() be called above ?&lt;/p&gt;

&lt;p&gt;The following two comments apply to ZooKeeperNodeTracker.java and CatalogTracker.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-comment&quot;&gt;// chk &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the shutdown node is available. Because incase of cluster
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// shutdonw
&lt;/span&gt;+        &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; loop prevents the master from going down.&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The above should read: check if the shutdown node exists. In case of cluster shutdown, ...&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+              &lt;span class=&quot;code-quote&quot;&gt;&quot;Unexpected exception handling &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; checking &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; shutdown node exists.&quot;&lt;/span&gt;,
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Extra word above: handling&lt;/p&gt;</comment>
                            <comment id="13193624" author="ram_krish" created="Thu, 26 Jan 2012 07:36:01 +0000"  >&lt;p&gt;Updated the affected version to 0.90.7.&lt;/p&gt;</comment>
                            <comment id="13648891" author="jdcryans" created="Fri, 3 May 2013 23:18:04 +0000"  >&lt;p&gt;Unmarking patch available, more than a year old.&lt;/p&gt;</comment>
                            <comment id="14260783" author="ram_krish" created="Tue, 30 Dec 2014 04:37:36 +0000"  >&lt;p&gt;0.90.x is not active.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12506976" name="HBASE-4951.patch" size="1597" author="ram_krish" created="Mon, 12 Dec 2011 08:04:38 +0000"/>
                            <attachment id="12508251" name="HBASE-4951_branch.patch" size="5992" author="ram_krish" created="Wed, 21 Dec 2011 15:59:34 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 6 Dec 2011 23:50:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>219567</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 50 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i00skf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2560</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>