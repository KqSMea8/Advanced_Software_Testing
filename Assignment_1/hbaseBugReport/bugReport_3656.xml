<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:12:01 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3656/HBASE-3656.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3656] Merging flush; merge a flush with one of the existing store files (the smallest?) so we skip creating a new store file on each flush</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3656</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This behavior is described in the BT paper.  Years ago I had a go at it but at the time it slowed flushing significantly &amp;#8211; and IIRC we had no barriers on writes when the memory pressue was high &amp;#8211; so it brought on OOMEs... so punted on it.  Its time to consider this feature again.&lt;/p&gt;

&lt;p&gt;Would we always do it?  Maybe not if its a close?  If a close we want stuff to run quickly so we should skip the merge.  But any other time, we should do it?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12501602">HBASE-3656</key>
            <summary>Merging flush; merge a flush with one of the existing store files (the smallest?) so we skip creating a new store file on each flush</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="stack">stack</reporter>
                        <labels>
                    </labels>
                <created>Wed, 16 Mar 2011 17:01:37 +0000</created>
                <updated>Thu, 4 Oct 2012 21:06:19 +0000</updated>
                                                                                <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13007686" author="streamy" created="Wed, 16 Mar 2011 20:44:29 +0000"  >&lt;p&gt;I think we&apos;d need some pretty well-thought-out heuristics for when to do it and when not to do it.&lt;/p&gt;

&lt;p&gt;I also had a stab at this when I worked on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-2375&quot; title=&quot;Revisit compaction configuration parameters&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-2375&quot;&gt;&lt;del&gt;HBASE-2375&lt;/del&gt;&lt;/a&gt; way back when (yeah, need to get back on that one soon).&lt;/p&gt;

&lt;p&gt;When I looked at this back then, a much bigger win was to upgrade a &quot;flush then compaction&quot; to a &quot;merge flush with files that would have been selected for compaction&quot;.  (we only compact after a flush today, but before we do the flush, we can actually know whether a compaction will be requested afterwards).  In this case, I think it would be a clear win in this case.&lt;/p&gt;

&lt;p&gt;Otherwise, I think it would mostly make sense if the file it is merging with was relatively small and the amount being flushed is relatively small (the kind of stuff that happens when you have too many regions on each RS or not enough total HLog capacity --&amp;gt; small flushes).&lt;/p&gt;</comment>
                            <comment id="13018439" author="jdcryans" created="Mon, 11 Apr 2011 17:08:15 +0000"  >&lt;p&gt;Talking on IRC with aph__ (yeah that&apos;s his handle), he was running imports on a small 3 nodes cluster with heap set at 1.5GB and saw abysmal performance. While we told him to get some real hardware because tuning his current setup would be a massive waste of time, I was thinking that HBase could still do a much better job out of the box. One thing that would make it better is somehow automatically controlling regions size/number to not run into the situation where you basically are filling up 1000 regions at the same rate and flush tiny files (which then triggers compactions &lt;em&gt;ad vitam aeternam&lt;/em&gt;).&lt;/p&gt;

&lt;p&gt;The other thing that would help is this jira since you wouldn&apos;t be compacting so much in the first place.&lt;/p&gt;</comment>
                            <comment id="13469697" author="lhofhansl" created="Thu, 4 Oct 2012 21:06:19 +0000"  >&lt;p&gt;This would (potentially) make certain backup solution more difficult.&lt;/p&gt;

&lt;p&gt;Imagine a backup scheme that backs up each HFile resulting from a major compaction and each HFile resulting from a flush (HFiles from minor compactions are not needed and just complicate things).&lt;br/&gt;
This would no longer be possible since the flushed KVs would then be intermingled with other KVs, which may or may not be in an HFile that was copied already.&lt;/p&gt;

&lt;p&gt;Not saying this is a reason for not doing this.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Mar 2011 20:44:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>33133</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 11 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i028m7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>10997</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>