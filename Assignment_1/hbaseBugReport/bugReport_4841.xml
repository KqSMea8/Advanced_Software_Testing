<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:22:28 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4841/HBASE-4841.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4841] If I call split fast enough, while inserting, rows disappear. </title>
                <link>https://issues.apache.org/jira/browse/HBASE-4841</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I&apos;ll attach a unit test for this. Basically if you call split, while inserting data you can get to the point to where the cluster becomes unstable, or rows will  disappear. The unit test gives you some flexibility of:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;How many rows&lt;/li&gt;
	&lt;li&gt;How wide the rows are&lt;/li&gt;
	&lt;li&gt;The frequency of the split.&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;The default settings crash unit tests or cause the unit tests to fail on my laptop. On my macbook air, i could actually turn down the number of total rows, and the frequency of the splits which is surprising. I think this is because the macbook air has much better IO than my backup acer.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12532224">HBASE-4841</key>
            <summary>If I call split fast enough, while inserting, rows disappear. </summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="7">Later</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="posix4e">Alex Newman</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Nov 2011 22:06:34 +0000</created>
                <updated>Tue, 30 Dec 2014 04:30:30 +0000</updated>
                            <resolved>Tue, 30 Dec 2014 04:30:30 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                <comments>
                            <comment id="13154581" author="posix4e" created="Mon, 21 Nov 2011 22:07:26 +0000"  >&lt;p&gt;Since this can cause dataloss it may make sense to increase the priority.&lt;/p&gt;</comment>
                            <comment id="13154682" author="posix4e" created="Mon, 21 Nov 2011 22:28:20 +0000"  >&lt;p&gt;I realized it may be easier If I post the log for the unit test, rather than requiring you to run it. It&apos;s on the way.&lt;/p&gt;</comment>
                            <comment id="13154712" author="posix4e" created="Mon, 21 Nov 2011 23:07:07 +0000"  >&lt;p&gt;here is a log of the wrong number of rows being returned&lt;/p&gt;</comment>
                            <comment id="13154713" author="posix4e" created="Mon, 21 Nov 2011 23:07:28 +0000"  >&lt;p&gt;Here is a log of this script taking the HBase server out.&lt;/p&gt;</comment>
                            <comment id="13154903" author="stack" created="Tue, 22 Nov 2011 06:15:23 +0000"  >&lt;p&gt;Upped priority&lt;/p&gt;</comment>
                            <comment id="13155672" author="ram_krish" created="Wed, 23 Nov 2011 04:18:06 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
LOG.warn(&lt;span class=&quot;code-quote&quot;&gt;&quot;Why is there a raw encodedRegionName in lastSeqWritten? name=&quot;&lt;/span&gt; +
          Bytes.toString(encodedRegionName) + &lt;span class=&quot;code-quote&quot;&gt;&quot;, seqid=&quot;&lt;/span&gt; + l);

&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;is getting repeated in the logs. &lt;/p&gt;</comment>
                            <comment id="13155684" author="stack" created="Wed, 23 Nov 2011 05:03:09 +0000"  >&lt;p&gt;Yeah, thats being fixed over in hbase-4853&lt;/p&gt;</comment>
                            <comment id="13159771" author="jdcryans" created="Wed, 30 Nov 2011 03:03:24 +0000"  >&lt;p&gt;The test passes for me 100% of the time on both trunk and 0.92 when I wrap the admin.split in order to catch the region offline exception that it gets sometimes.&lt;/p&gt;</comment>
                            <comment id="13159824" author="stack" created="Wed, 30 Nov 2011 05:14:26 +0000"  >&lt;p&gt;How does that make it so we don&apos;t miss rows J-D? (I can see how it would make splits work but not sure how it keeps scanner finding all rows)&lt;/p&gt;</comment>
                            <comment id="13160242" author="jdcryans" created="Wed, 30 Nov 2011 19:09:14 +0000"  >&lt;p&gt;Sorry if I&apos;m not being clear.&lt;/p&gt;

&lt;p&gt;So the claim is that this test shows we can lose rows while splitting too fast. I tried the test myself on both 0.92 and trunk multiple times.&lt;/p&gt;

&lt;p&gt;The only times I got errors (not failures, which would mean it&apos;s failing an assertion), is when we call admin.split every so often in the test:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i != NUMBER_OF_ROWS; i++) {
      &lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt;[] rowName = Bytes.toBytes(i);
      Put put = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Put(rowName);
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; j = 0; j != NUMBER_OF_COLS; j++) {
        put.add(CF, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;.valueOf(j).getBytes(), Bytes.toBytes(j * i));
      }

      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i % NUM_ROWS_BEFORE_SPLIT == 0 &amp;amp;&amp;amp; i != 0) {
        admin.split(TABLE_NAME);
        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Splitting&quot;&lt;/span&gt;);
      }

      htable.put(put);

      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (i % NUM_ROWS_BEFORE_OUTPUT == 0 &amp;amp;&amp;amp; i!= 0 ) {
        LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Inserted Row:&quot;&lt;/span&gt; + i);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The problem is that if you call split on a table that has a region offline, the exception bubbles all the way up and, in this case, kills the test. That&apos;s why I needed to catch and move forward.&lt;/p&gt;

&lt;p&gt;After this change, the test passes 100% of the time for both 0.92 and trunk.&lt;/p&gt;

&lt;p&gt;Now what I&apos;m wondering is if the test in Alex&apos;s case was failing or &quot;erroring&quot;. If the former, it&apos;s either an unknown bug or &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4853&quot; title=&quot;HBASE-4789 does overzealous pruning of seqids&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4853&quot;&gt;&lt;del&gt;HBASE-4853&lt;/del&gt;&lt;/a&gt;. If the latter, then it&apos;s the issue I saw and there&apos;s no data loss.&lt;/p&gt;</comment>
                            <comment id="13160249" author="posix4e" created="Wed, 30 Nov 2011 19:15:35 +0000"  >&lt;p&gt;@JD if you look at the above posted logs you will see that it was failing with &lt;/p&gt;

&lt;p&gt;junit.framework.AssertionFailedError: We are missing some rows&lt;/p&gt;

&lt;p&gt;I&apos;m guessing it was &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4853&quot; title=&quot;HBASE-4789 does overzealous pruning of seqids&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4853&quot;&gt;&lt;del&gt;HBASE-4853&lt;/del&gt;&lt;/a&gt;. &lt;/p&gt;</comment>
                            <comment id="13160288" author="jdcryans" created="Wed, 30 Nov 2011 19:59:47 +0000"  >&lt;p&gt;Well the first log is the region offline issue I described, the second one has data loss indeed but as it was Nov. 21, and providing that it was a recent checkout, then it would be 4853 yeah.&lt;/p&gt;</comment>
                            <comment id="13160405" author="stack" created="Wed, 30 Nov 2011 22:28:54 +0000"  >&lt;p&gt;So we can close this as fixed by 4853?&lt;/p&gt;</comment>
                            <comment id="13160408" author="posix4e" created="Wed, 30 Nov 2011 22:32:10 +0000"  >&lt;p&gt;Agreed this test passes, although we might want have a test like this somewhere. On the other hand it is pretty high level.&lt;/p&gt;</comment>
                            <comment id="14260765" author="ram_krish" created="Tue, 30 Dec 2014 04:30:30 +0000"  >&lt;p&gt;There have been lot of changes in the split related and AM code. So will resolve this as &apos;Later&apos;&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12504579" name="1" size="4284" author="posix4e" created="Mon, 21 Nov 2011 22:07:11 +0000"/>
                            <attachment id="12504665" name="log" size="654153" author="posix4e" created="Mon, 21 Nov 2011 23:07:27 +0000"/>
                            <attachment id="12504664" name="log2" size="521804" author="posix4e" created="Mon, 21 Nov 2011 23:07:07 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 22 Nov 2011 06:15:23 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>217960</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 50 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02cvb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11686</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>