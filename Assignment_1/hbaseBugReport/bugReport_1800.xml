<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:56:29 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1800/HBASE-1800.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1800] Too many ZK connections</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1800</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Currently we open tons of new connections to Zookeeper, like every time we instantiate a new HTable. There is a maximum number of client connections as described here:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &amp;lt;property&amp;gt;
    &amp;lt;name&amp;gt;hbase.zookeeper.property.maxClientCnxns&amp;lt;/name&amp;gt;
    &amp;lt;value&amp;gt;30&amp;lt;/value&amp;gt;
    &amp;lt;description&amp;gt;Property from ZooKeeper&apos;s config zoo.cfg.
    Limit on number of concurrent connections (at the socket level) that a
    single client, identified by IP address, may make to a single member of
    the ZooKeeper ensemble. Set high to avoid zk connection issues running
    standalone and pseudo-distributed.
    &amp;lt;/description&amp;gt;
  &amp;lt;/property&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you hit that max number, ZK will just refuse your connections. Suppose you have 4 maps running on a server hosting a RS, you may actually lose your connection in the RS and eventually hit a session timeout. Maybe we should singleton ZKW?&lt;/p&gt;</description>
                <environment></environment>
        <key id="12434170">HBASE-1800</key>
            <summary>Too many ZK connections</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Thu, 27 Aug 2009 14:25:10 +0000</created>
                <updated>Sun, 13 Sep 2009 22:24:55 +0000</updated>
                            <resolved>Sun, 30 Aug 2009 20:45:56 +0000</resolved>
                                                    <fixVersion>0.20.0</fixVersion>
                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12748389" author="stack" created="Thu, 27 Aug 2009 14:39:08 +0000"  >&lt;p&gt;Even if you pass in same HBaseConfiguration each time?&lt;/p&gt;</comment>
                            <comment id="12748392" author="jdcryans" created="Thu, 27 Aug 2009 14:47:24 +0000"  >&lt;p&gt;Unless in the client you pass the real same HBC yes.&lt;/p&gt;</comment>
                            <comment id="12748467" author="jdcryans" created="Thu, 27 Aug 2009 17:32:16 +0000"  >&lt;p&gt;This patch adds a singleton for ZKW. Has the advantage that whatever happens outside of ZK we will only have 1 connection per JVM. Without it openplaces&apos; unit tests needed more than 100 client connections, now the default works just fine and there is less INFO log from ZK.&lt;/p&gt;</comment>
                            <comment id="12748515" author="nitay" created="Thu, 27 Aug 2009 19:17:01 +0000"  >&lt;p&gt;Overall this looks great JD. Only question I have is it looks like if you call it with two different HBC&apos;s you&apos;ll still get the same ZKW. Shouldn&apos;t it be a map similar to the HConnectionManager?&lt;/p&gt;</comment>
                            <comment id="12748517" author="jdcryans" created="Thu, 27 Aug 2009 19:21:50 +0000"  >&lt;p&gt;Yeah Ryan was asking the same since he uses 4 ZK quorums for his clients. I was thinking that instead we could use a multiton keyed by hbase.zookeeper.quorum.&lt;/p&gt;</comment>
                            <comment id="12748537" author="apurtell" created="Thu, 27 Aug 2009 19:50:21 +0000"  >&lt;p&gt;Let&apos;s pull this in to 0.20 also. New users who set up single node ZK installs will hit this.&lt;/p&gt;</comment>
                            <comment id="12748884" author="jdcryans" created="Fri, 28 Aug 2009 16:28:45 +0000"  >&lt;p&gt;Different approach, I found that playing in the lower levels could mess when a client would close a connection while sharing it with a region server and other stuff like that.&lt;/p&gt;

&lt;p&gt;In this patch:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;I created a new inner class called ClientZKWatcher in HCM that manages a connection to ZK.&lt;/li&gt;
	&lt;li&gt;I added a multiton of ClientZKWatcher keyed by hbase.zookeeper.quorum.&lt;/li&gt;
	&lt;li&gt;I added a way to clear all connections.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="12749276" author="jdcryans" created="Sun, 30 Aug 2009 15:37:28 +0000"  >&lt;p&gt;Adding a test for multiple ZK quorums. Would love to get a review.&lt;/p&gt;</comment>
                            <comment id="12749295" author="stack" created="Sun, 30 Aug 2009 17:53:21 +0000"  >&lt;p&gt;Just to say that I do not like static maps. Inevitably they cause grief because their initialization is effectively outside of your control done at class-loading time.  They become a problem when you want to reinit without a restart of the jvm (e.g. deploy, undeploy, then redeploy of a web app that has an HTable instance).&lt;/p&gt;

&lt;p&gt;That said, we already have a static map of HCMs so you are coming in under its cover.  Lets fix both later.  For 0.20.0, lets bring in this patch.&lt;/p&gt;

&lt;p&gt;We also need to do the idea (I think it a Ryan idea from a while back) where the hbase zk client is dumb doing read-only operations.  Is this possible?  Does the client need to have watches in zk?  (This again is for later).&lt;/p&gt;

&lt;p&gt;Otherwise the patch looks good J-D.   I&apos;m +1 to commit assuming all unit tests pass.&lt;/p&gt;
</comment>
                            <comment id="12749325" author="jdcryans" created="Sun, 30 Aug 2009 20:44:23 +0000"  >&lt;p&gt;For the moment we use watches to make sure that when our session expires we renew it, I don&apos;t think there&apos;s any other way to do that.&lt;/p&gt;

&lt;p&gt;All tests pass, I will commit.&lt;/p&gt;</comment>
                            <comment id="12749326" author="jdcryans" created="Sun, 30 Aug 2009 20:45:56 +0000"  >&lt;p&gt;Committed to branch and trunk, this should help fixing a lot of problems new users were getting and provide faster HTable instantiations. &lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12417902" name="HBASE-1800-v1.patch" size="6407" author="jdcryans" created="Thu, 27 Aug 2009 17:32:16 +0000"/>
                            <attachment id="12418000" name="HBASE-1800-v2.patch" size="7048" author="jdcryans" created="Fri, 28 Aug 2009 16:28:45 +0000"/>
                            <attachment id="12418094" name="HBASE-1800-v3.patch" size="7710" author="jdcryans" created="Sun, 30 Aug 2009 15:37:28 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Thu, 27 Aug 2009 14:39:08 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32267</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 16 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hfbr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99745</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>