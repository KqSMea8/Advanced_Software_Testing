<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:24:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-5094/HBASE-5094.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-5094] The META can hold an entry for a region with a different server name from the one actually in the AssignmentManager thus making the region inaccessible.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-5094</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RegionState rit = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getAssignmentManager().isRegionInTransition(e.getKey());
            ServerName addressFromAM = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.services.getAssignmentManager()
                .getRegionServerOfRegion(e.getKey());
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (rit != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; !rit.isClosing() &amp;amp;&amp;amp; !rit.isPendingClose()) {
              &lt;span class=&quot;code-comment&quot;&gt;// Skip regions that were in transition unless CLOSING or
&lt;/span&gt;              &lt;span class=&quot;code-comment&quot;&gt;// PENDING_CLOSE
&lt;/span&gt;              LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Skip assigning region &quot;&lt;/span&gt; + rit.toString());
            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (addressFromAM != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
                &amp;amp;&amp;amp; !addressFromAM.equals(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.serverName)) {
              LOG.debug(&lt;span class=&quot;code-quote&quot;&gt;&quot;Skip assigning region &quot;&lt;/span&gt;
                    + e.getKey().getRegionNameAsString()
                    + &lt;span class=&quot;code-quote&quot;&gt;&quot; because it has been opened in &quot;&lt;/span&gt;
                    + addressFromAM.getServerName());
              }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;In ServerShutDownHandler we try to get the address in the AM.  This address is initially null because it is not yet updated after the region was opened .i.e. the CAll back after node deletion is not yet done in the master side.&lt;br/&gt;
But removal from RIT is completed on the master side.  So this will trigger a new assignment.&lt;br/&gt;
So there is a small window between the online region is actually added in to the online list and the ServerShutdownHandler where we check the existing address in AM.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12536368">HBASE-5094</key>
            <summary>The META can hold an entry for a region with a different server name from the one actually in the AssignmentManager thus making the region inaccessible.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="ram_krish">ramkrishna.s.vasudevan</reporter>
                        <labels>
                    </labels>
                <created>Mon, 26 Dec 2011 06:43:40 +0000</created>
                <updated>Fri, 20 Nov 2015 11:55:26 +0000</updated>
                            <resolved>Tue, 3 Jan 2012 04:28:41 +0000</resolved>
                                    <version>0.92.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13175925" author="ram_krish" created="Mon, 26 Dec 2011 11:08:55 +0000"  >&lt;p&gt;RegionX is reassigned to RS_C during RS_A shutdown, although RegionX was just assigned to RS_B by load balancer. So .META. table indicates RegionX is on RS_C. Both RS_B and RS_C think they have RegionX.Later when RS_C shuts down, RegionX is reassigned to RS_B. RS_B will indicate ALREADY_OPENED. Thus the region is considered assigned to RS_B even though .META. indicates it is on RS_C.&lt;/p&gt;

&lt;p&gt;1) Region RegionX - Assigned from RS_A to RS_B.&lt;br/&gt;
2) RS_A goes down and ServerShutDownHandler.  ServerShutDwonHandler finds RegionX with RS_A from .META. as still .META. is not yet updated to RS_B.&lt;br/&gt;
3) As RS_A goes down RegionX is assigned from RS_A to RS_C.&lt;br/&gt;
4) RS_C goes down. ServerShutdownHandler processes RegionX and tries to assign it to RS_B.&lt;br/&gt;
5) RS_B says ALREADY_OPENED but .META. shows RS_C.&lt;/p&gt;</comment>
                            <comment id="13176401" author="ram_krish" created="Wed, 28 Dec 2011 01:24:31 +0000"  >&lt;p&gt;Patch for trunk&lt;/p&gt;</comment>
                            <comment id="13176435" author="hadoopqa" created="Wed, 28 Dec 2011 03:58:22 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12508715/5094.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12508715/5094.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 77 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/605//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/605//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/605//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/605//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/605//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/605//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13176712" author="zhihyu@ebaysf.com" created="Wed, 28 Dec 2011 17:28:16 +0000"  >&lt;p&gt;Ram is coming up with a new patch as the previous one didn&apos;t fix the problem.&lt;/p&gt;</comment>
                            <comment id="13177496" author="ram_krish" created="Fri, 30 Dec 2011 01:21:49 +0000"  >&lt;p&gt;Steps to reproduece the problem&lt;br/&gt;
-&amp;gt;1) Load balancer started moving region(R1) from RS1 to Rs2.&lt;br/&gt;
-&amp;gt;2)Rs2 has not yet updated in META table, before that RS1 goes down.&lt;br/&gt;
-&amp;gt;3) So Servershutdownhandler started,&lt;br/&gt;
        a) he first removes the region R1 from online list in master&lt;br/&gt;
       b)  and he sees R1 with RS1 as per META entry.&lt;br/&gt;
-&amp;gt;4) That point RS2 completes the opening and updates the META.&lt;br/&gt;
-&amp;gt; 5)Call back comes to master, removes the region from RIT and not yet added to onlineRegionlist in MAster.&lt;br/&gt;
-&amp;gt;6)The step 3 continues and he sees addressinAM is null and also RIT is null and so he goes with assignment.&lt;br/&gt;
-&amp;gt; 7) Now R1 is updated  as RS3 in META and the operation gets completed.  So master also stores in online list that R1 is with RS3.&lt;br/&gt;
-&amp;gt;8) Now RS3 goes down .&lt;br/&gt;
-&amp;gt; 9) Region R1 is getting assigned to RS2 from RS3 and RS2 says ALREADY_OPENED.&lt;/p&gt;</comment>
                            <comment id="13177497" author="ram_krish" created="Fri, 30 Dec 2011 01:23:39 +0000"  >&lt;p&gt;But i would like to mention one point is&lt;br/&gt;
If step 8 and 9 does not happen...&lt;br/&gt;
the region R1 will be opened both in RS2 and RS3. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/sad.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  META will indicate RS3 so any requests to this region will be routed to RS3.  But RS2 will think he has the region.&lt;br/&gt;
This patch does not solve this problem.&lt;/p&gt;</comment>
                            <comment id="13177500" author="zhihyu@ebaysf.com" created="Fri, 30 Dec 2011 01:31:00 +0000"  >&lt;p&gt;How about introducing check in region server&apos;s loop &lt;span class=&quot;error&quot;&gt;&amp;#91;tryRegionServerReport() ?&amp;#93;&lt;/span&gt;, similar to the one you added in the patch ?&lt;br/&gt;
This way region server can remove such &apos;doubly assigned&apos; regions ?&lt;/p&gt;</comment>
                            <comment id="13177535" author="hadoopqa" created="Fri, 30 Dec 2011 03:39:59 +0000"  >&lt;p&gt;-1 overall.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12508904/HBASE-5094_1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12508904/HBASE-5094_1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;/p&gt;

&lt;p&gt;    +1 @author.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    -1 tests included.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    -1 javadoc.  The javadoc tool appears to have generated -151 warning messages.&lt;/p&gt;

&lt;p&gt;    +1 javac.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    -1 findbugs.  The patch appears to introduce 76 new Findbugs (version 1.3.9) warnings.&lt;/p&gt;

&lt;p&gt;    +1 release audit.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;     -1 core tests.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapred.TestTableMapReduce&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestHFileOutputFormat&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/638//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/638//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/638//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/638//artifact/trunk/patchprocess/newPatchFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/638//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/638//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="13178051" author="zhihyu@ebaysf.com" created="Sat, 31 Dec 2011 17:31:01 +0000"  >&lt;p&gt;+1 on patch.&lt;/p&gt;

&lt;p&gt;After discussing with Ramkrishna, the task of handling doubly assigned regions would be done in another JIRA.&lt;/p&gt;</comment>
                            <comment id="13178063" author="ram_krish" created="Sat, 31 Dec 2011 18:45:20 +0000"  >&lt;p&gt;Committed to trunk and 0.92.&lt;/p&gt;

&lt;p&gt;Thanks for the review Ted.&lt;/p&gt;</comment>
                            <comment id="13178091" author="hudson" created="Sat, 31 Dec 2011 22:50:08 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-security #57 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-security/57/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-security/57/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5094&quot; title=&quot;The META can hold an entry for a region with a different server name from the one actually in the AssignmentManager thus making the region inaccessible.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5094&quot;&gt;&lt;del&gt;HBASE-5094&lt;/del&gt;&lt;/a&gt; The META can hold an entry for a region with a different server name from the one actually in the AssignmentManager thus making the region inaccessible. (Ram)&lt;/p&gt;

&lt;p&gt;ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13178101" author="hudson" created="Sun, 1 Jan 2012 02:51:30 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2600 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2600/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2600/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5094&quot; title=&quot;The META can hold an entry for a region with a different server name from the one actually in the AssignmentManager thus making the region inaccessible.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5094&quot;&gt;&lt;del&gt;HBASE-5094&lt;/del&gt;&lt;/a&gt; The META can hold an entry for a region with a different server name from the one actually in the AssignmentManager thus making the region inaccessible. (Ram)&lt;/p&gt;

&lt;p&gt;ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13178128" author="hudson" created="Sun, 1 Jan 2012 08:22:32 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #223 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/223/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/223/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5094&quot; title=&quot;The META can hold an entry for a region with a different server name from the one actually in the AssignmentManager thus making the region inaccessible.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5094&quot;&gt;&lt;del&gt;HBASE-5094&lt;/del&gt;&lt;/a&gt; The META can hold an entry for a region with a different server name from the one actually in the AssignmentManager thus making the region inaccessible. (Ram)&lt;/p&gt;

&lt;p&gt;ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13178318" author="hudson" created="Mon, 2 Jan 2012 08:06:38 +0000"  >&lt;p&gt;Integrated in HBase-0.92-security #57 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92-security/57/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92-security/57/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5094&quot; title=&quot;The META can hold an entry for a region with a different server name from the one actually in the AssignmentManager thus making the region inaccessible.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5094&quot;&gt;&lt;del&gt;HBASE-5094&lt;/del&gt;&lt;/a&gt; The META can hold an entry for a region with a different server name from the one actually in the AssignmentManager thus making the region inaccessible. (Ram)&lt;/p&gt;

&lt;p&gt;ramkrishna : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/regionserver/HRegionServer.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13178618" author="ram_krish" created="Tue, 3 Jan 2012 04:28:41 +0000"  >&lt;p&gt;Committed to 0.92 and trunk.&lt;/p&gt;</comment>
                            <comment id="13179164" author="stack" created="Wed, 4 Jan 2012 00:30:01 +0000"  >&lt;p&gt;Thanks for the fix Ram.  It does feel though like fix should have been done on the master-side rather than out on regionserver.   In master we have some hope of making sense of whats going on out on the cluster; this seems like an issue in master where the shutdown thread and balancer thread are fighting over a particular region&apos; state.  And this &apos;fix&apos; only addresses case where region reassign arrives at the server that already has it open.&lt;/p&gt;

&lt;p&gt;Could we make it such that only one thread can transition a region at a time?&lt;/p&gt;

&lt;p&gt;Could shutdown handler not have noticed this state?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-&amp;gt;6)The step 3 continues and he sees addressinAM is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; and also RIT is &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; and so he goes with assignment.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13179258" author="mingma" created="Wed, 4 Jan 2012 04:08:35 +0000"  >&lt;p&gt;It is a tricky bug. I tend to agree with Stack here. Perhaps we can enforce synchronization for region assignment. Here is some additional background info.&lt;/p&gt;

&lt;p&gt;1. How the bug was found. Rolling restart RSs with regular shutdown(not kill -9). After running for couple hours, one user region is missing. I then identified the event sequence based on the logs across machines.&lt;/p&gt;

&lt;p&gt;2. I put some quick fix couple weeks to AssignmentManager and ServerShutDownHandler(not submitted to open source). That reduces the chance of such error, but didn&apos;t completely address the synchronization issue. &lt;/p&gt;

&lt;p&gt;3. How we can verify if the fix works. Besides code review and unit test, I think it is better to run rolling restart RS script for a long period of time say couple days.&lt;/p&gt;</comment>
                            <comment id="13179738" author="ram_krish" created="Wed, 4 Jan 2012 18:46:04 +0000"  >&lt;p&gt;@Stack&lt;br/&gt;
I tried the option of applying the fix on the master side.  But i felt like the history of the region was not available.  (May be am wrong.)&lt;br/&gt;
Also the ServerShutdownhandler.processShutDown() removes the online server first and also the list of regions.&lt;/p&gt;

&lt;p&gt;Then it is after the region opening is done by the balancer flow the new server name is again added back.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (isServerOnline(sn)) {
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regions.put(regionInfo, sn);
        addToServers(sn, regionInfo);
        &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.regions.notifyAll();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;blockquote&gt;&lt;p&gt;Could we make it such that only one thread can transition a region at a time?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;This i did not think much on this.  &lt;/p&gt;

&lt;p&gt;@Ming Ma&lt;br/&gt;
If it is ok, do you mind sharing the patch that you had prepared ?&lt;/p&gt;</comment>
                            <comment id="13180214" author="mingma" created="Thu, 5 Jan 2012 06:11:50 +0000"  >&lt;p&gt;Ram, it turns out that my patch which is based on an earlier snapshot of 0.92 code base is quite similar to the fix in HBase-4899. In fact, how the bug is reproed is also similar. Still it seems like there is a really small time window where both my fix and HBase-4899 won&apos;t cover. Below code refers to the new code added in HBase-4899.&lt;/p&gt;

&lt;p&gt;T1. ServerShutdownHandler. the check for &quot;if (rit != null &amp;amp;&amp;amp; !rit.isClosing() &amp;amp;&amp;amp; !rit.isPendingClose()&quot; return false as the region is still in closing state. It is actually closed by the RS; Master&apos;s state is &quot;closing&quot; due to the delay in ZK notification.&lt;br/&gt;
T2. Right after the above check, ZK notification happens and Master starts the opening of the region as requested by load balancer.&lt;br/&gt;
T3. &quot;else &lt;/p&gt;
{ this.services.getAssignmentManager().assign(e.getKey(), true); }
&lt;p&gt;&quot; is called for another assignment.&lt;/p&gt;</comment>
                            <comment id="13180216" author="stack" created="Thu, 5 Jan 2012 06:16:47 +0000"  >&lt;p&gt;@Ming Open a new issue w/ above scenario?&lt;/p&gt;</comment>
                            <comment id="13182513" author="ram_krish" created="Mon, 9 Jan 2012 14:06:19 +0000"  >&lt;p&gt;Updated the fix versions.&lt;/p&gt;
</comment>
                            <comment id="13650560" author="stack" created="Tue, 7 May 2013 06:33:27 +0000"  >&lt;p&gt;I just noticed that this patch near doubles the load on meta for a region opening; it adds a read before we open (the other access is the edit we do on successful open).&lt;/p&gt;</comment>
                            <comment id="15016481" author="lars_francke" created="Fri, 20 Nov 2015 11:55:26 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12508904" name="HBASE-5094_1.patch" size="1835" author="ram_krish" created="Fri, 30 Dec 2011 00:57:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 28 Dec 2011 03:58:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>222051</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i069tr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34523</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>