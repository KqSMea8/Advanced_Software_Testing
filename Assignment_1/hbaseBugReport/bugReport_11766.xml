<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:26:24 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11766/HBASE-11766.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11766] Backdoor CoprocessorHConnection is no longer being used for local writes</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11766</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;There&apos;s a backdoor CoprocessorHConnection used to ensure that a batched mutation does not go over the wire and back, but executes immediately locally. This is leveraged by Phoenix during secondary index maintenance (for an ~20% perf improvement). It looks to me like it&apos;s no longer used, as the following function is never invoked:&lt;/p&gt;

&lt;p&gt;  public org.apache.hadoop.hbase.protobuf.generated.ClientProtos.ClientService.BlockingInterface&lt;br/&gt;
      getClient(ServerName serverName) throws IOException {&lt;/p&gt;

&lt;p&gt;It&apos;d be good if feasible to add an HBase unit test to prevent further regressions. For more info, see &lt;a href=&quot;https://issues.apache.org/jira/browse/PHOENIX-1166&quot; title=&quot;Avoid HTable creation in coprocessors to write into local index table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PHOENIX-1166&quot;&gt;&lt;del&gt;PHOENIX-1166&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12734570">HBASE-11766</key>
            <summary>Backdoor CoprocessorHConnection is no longer being used for local writes</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="apurtell">Andrew Purtell</assignee>
                                    <reporter username="jamestaylor">James Taylor</reporter>
                        <labels>
                            <label>Phoenix</label>
                    </labels>
                <created>Sat, 16 Aug 2014 03:22:52 +0000</created>
                <updated>Sat, 21 Feb 2015 23:32:07 +0000</updated>
                            <resolved>Mon, 25 Aug 2014 23:09:51 +0000</resolved>
                                    <version>0.98.4</version>
                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>0.98.6</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="14099511" author="jeffreyz" created="Sat, 16 Aug 2014 05:26:45 +0000"  >&lt;p&gt;In class CoprocessorHConnection, we have following: &lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;  public &amp;lt;R&amp;gt; void processBatchCallback(List&amp;lt;? extends Row&amp;gt; list, TableName tableName,
      ExecutorService pool, Object[] results, Callback&amp;lt;R&amp;gt; callback) throws IOException,
      InterruptedException {
    delegate.processBatchCallback(list, tableName, pool, results, callback);
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The delegate is HConnectionImplementation object. Inside processBatchCallback shown below, we call createAsyncProcess using &quot;this&quot;, which is a HConnectionImplementation instance, so the overridden getClient() behavior of CoprocessorHConnection is lost because the &quot;this&quot; is the delegate instance in type of HConnectionImplementation.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; &amp;lt;R&amp;gt; AsyncProcess createAsyncProcess(TableName tableName, ExecutorService pool,
           AsyncProcess.AsyncProcessCallback&amp;lt;R&amp;gt; callback, Configuration conf) {
      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; AsyncProcess&amp;lt;R&amp;gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, tableName, pool, callback, conf,
          RpcRetryingCallerFactory.instantiate(conf), RpcControllerFactory.instantiate(conf));
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We should extend CoprocessorHConnection from class HConnectionImplementation.&lt;/p&gt;</comment>
                            <comment id="14106124" author="apurtell" created="Thu, 21 Aug 2014 23:15:50 +0000"  >&lt;blockquote&gt;&lt;p&gt;We should extend CoprocessorHConnection from class HConnectionImplementation.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Like the attached?&lt;/p&gt;</comment>
                            <comment id="14106131" author="apurtell" created="Thu, 21 Aug 2014 23:19:43 +0000"  >&lt;p&gt;Ping &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;, something to watch&lt;/p&gt;</comment>
                            <comment id="14107779" author="jeffreyz" created="Sat, 23 Aug 2014 01:11:56 +0000"  >&lt;p&gt;Looks good to me with one minor comment:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;+  public CoprocessorHConnection(Configuration conf, HRegionServer server) {&lt;br/&gt;
+    super(conf);&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Could we use parent HConnectionImplementation constructor &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HConnectionImplementation(Configuration conf, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; managed,
        ExecutorService pool, User user);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt; like &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt; &lt;span class=&quot;code-keyword&quot;&gt;super&lt;/span&gt;(conf, &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;, user); &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14108050" author="apurtell" created="Sat, 23 Aug 2014 16:39:19 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Could we use parent HConnectionImplementation constructor&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HConnectionImplementation(Configuration conf, &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; managed,
        ExecutorService pool, User user);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;

&lt;p&gt;Sure. &lt;/p&gt;</comment>
                            <comment id="14108700" author="apurtell" created="Mon, 25 Aug 2014 03:26:30 +0000"  >&lt;blockquote&gt;
&lt;p&gt;It looks to me like it&apos;s no longer used, as the following function is never invoked:&lt;br/&gt;
public org.apache.hadoop.hbase.protobuf.generated.ClientProtos.ClientService.BlockingInterface&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jamestaylor&quot; class=&quot;user-hover&quot; rel=&quot;jamestaylor&quot;&gt;James Taylor&lt;/a&gt;, any chance of testing 0.98.6-SNAPSHOT with the patch on this issue to see if it is working properly for you now? Is there a Phoenix unit test we could run to verify the fix?&lt;/p&gt;</comment>
                            <comment id="14108702" author="jamestaylor" created="Mon, 25 Aug 2014 03:34:11 +0000"  >&lt;blockquote&gt;&lt;p&gt;James Taylor, any chance of testing 0.98.6-SNAPSHOT with the patch on this issue to see if it is working properly for you now? Is there a Phoenix unit test we could run to verify the fix?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;There&apos;s no Phoenix or HBase unit test that verifies this AFAIK (that&apos;s why it regressed). Is there one now in HBase as part of the fix? @Mujtaba caught this in a perf run.&lt;/p&gt;</comment>
                            <comment id="14108709" author="apurtell" created="Mon, 25 Aug 2014 04:00:56 +0000"  >&lt;p&gt;No there is no unit test. Looks like this was something rough committed by Jesse for Phoenix back in September of 2013 and has escaped noticed by anyone else hence. We could throw together a test coprocessor app to exercise this but that isn&apos;t verification of what Mujtaba observed necessarily (if probably). Anyway, I&apos;ll circle back to this at some point.&lt;/p&gt;</comment>
                            <comment id="14108775" author="ram_krish" created="Mon, 25 Aug 2014 05:57:04 +0000"  >&lt;p&gt;Seeing the reasoning given by &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;, the patch seems to be right.  Looks good to me. +1.&lt;/p&gt;</comment>
                            <comment id="14109882" author="apurtell" created="Mon, 25 Aug 2014 22:33:05 +0000"  >&lt;p&gt;Attaching patch for 0.98 backport.&lt;/p&gt;</comment>
                            <comment id="14109944" author="apurtell" created="Mon, 25 Aug 2014 23:09:51 +0000"  >&lt;p&gt;Thanks for the review Ram!&lt;/p&gt;</comment>
                            <comment id="14110089" author="hudson" created="Tue, 26 Aug 2014 00:53:40 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5428 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5428/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5428/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11766&quot; title=&quot;Backdoor CoprocessorHConnection is no longer being used for local writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11766&quot;&gt;&lt;del&gt;HBASE-11766&lt;/del&gt;&lt;/a&gt; Backdoor CoprocessorHConnection is no longer being used for local writes (apurtell: rev 5ed89df4bb784f21b5eaab4aed66f502d9c9c6d2)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/client/CoprocessorHConnection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14110114" author="hudson" created="Tue, 26 Aug 2014 01:19:06 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #123 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/123/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/123/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11766&quot; title=&quot;Backdoor CoprocessorHConnection is no longer being used for local writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11766&quot;&gt;&lt;del&gt;HBASE-11766&lt;/del&gt;&lt;/a&gt; Backdoor CoprocessorHConnection is no longer being used for local writes (apurtell: rev 706c5fcf56e98f90d60682432f0f4b33ca16135d)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/client/CoprocessorHConnection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14110162" author="hudson" created="Tue, 26 Aug 2014 01:56:21 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98 #471 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98/471/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98/471/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11766&quot; title=&quot;Backdoor CoprocessorHConnection is no longer being used for local writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11766&quot;&gt;&lt;del&gt;HBASE-11766&lt;/del&gt;&lt;/a&gt; Backdoor CoprocessorHConnection is no longer being used for local writes (apurtell: rev 7b04466dc8acc910df67b1cf9c3e74004ac51a05)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/client/CoprocessorHConnection.java&lt;/li&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14110266" author="hudson" created="Tue, 26 Aug 2014 04:44:33 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-0.98-on-Hadoop-1.1 #444 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/444/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.98-on-Hadoop-1.1/444/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11766&quot; title=&quot;Backdoor CoprocessorHConnection is no longer being used for local writes&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11766&quot;&gt;&lt;del&gt;HBASE-11766&lt;/del&gt;&lt;/a&gt; Backdoor CoprocessorHConnection is no longer being used for local writes (apurtell: rev 7b04466dc8acc910df67b1cf9c3e74004ac51a05)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-client/src/main/java/org/apache/hadoop/hbase/client/HConnectionManager.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/client/CoprocessorHConnection.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14111875" author="jamestaylor" created="Wed, 27 Aug 2014 05:18:27 +0000"  >&lt;p&gt;Are there unit tests around running a scan from a coprocessor through the env.getTable(TableName) API? We&apos;re seeing a case now where if we use RegionCoprocessorEnvironment.getTable(TableName) to get the HTableInterface we get no rows back from our ResultScanner. If we go through HTablePool, we get rows back. This is from a coprocessor end point call and all the data is local to the region.&lt;/p&gt;

&lt;p&gt;Would this fix have fixed that as well?&lt;/p&gt;</comment>
                            <comment id="14112758" author="apurtell" created="Wed, 27 Aug 2014 20:09:39 +0000"  >&lt;blockquote&gt;&lt;p&gt;Are there unit tests around running a scan from a coprocessor through the env.getTable(TableName) API?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I don&apos;t think so.&lt;/p&gt;

&lt;p&gt;Let&apos;s follow up on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11837&quot; title=&quot;Scanner from RegionCoprocessorEnvironment.getTable(TableName) returns no local data&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11837&quot;&gt;&lt;del&gt;HBASE-11837&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14330916" author="enis" created="Sat, 21 Feb 2015 23:32:07 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12736660">HBASE-11819</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12664247" name="HBASE-11766-0.98.patch" size="16720" author="apurtell" created="Mon, 25 Aug 2014 23:02:33 +0000"/>
                            <attachment id="12663854" name="HBASE-11766.patch" size="16823" author="apurtell" created="Sat, 23 Aug 2014 16:39:19 +0000"/>
                            <attachment id="12663546" name="HBASE-11766.patch" size="15669" author="apurtell" created="Thu, 21 Aug 2014 23:15:50 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 16 Aug 2014 05:26:45 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412510</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1yypz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>412497</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>