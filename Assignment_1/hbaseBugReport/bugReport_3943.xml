<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:14:29 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3943/HBASE-3943.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3943] Propagate compaction status from HRegion to HServerLoad.RegionLoad</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3943</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Load balancer works with HRegionInfo. However, compaction status is contained in HRegion.WriteState&lt;/p&gt;

&lt;p&gt;Users reported the following (Schubert Zhang):&lt;/p&gt;

&lt;p&gt;1. A region have many files, the compacting takes long time.&lt;br/&gt;
2. But the balancer (default 5 minutes) close and move this region to&lt;br/&gt;
another server.&lt;br/&gt;
3. Then, the compacting start again.&lt;br/&gt;
4. Then, then balancer close and move it to another server.&lt;/p&gt;

&lt;p&gt;Thus, the compacting cannot complete.&lt;br/&gt;
Now, we set the balancer interval to 30 minutes to remission this issue.&lt;/p&gt;

&lt;p&gt;We need to propagate compaction status to HServerLoad.RegionLoad so that load balancer doesn&apos;t move the region which is being compacted.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12508992">HBASE-3943</key>
            <summary>Propagate compaction status from HRegion to HServerLoad.RegionLoad</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="3">Duplicate</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="yuzhihong@gmail.com">Ted Yu</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Jun 2011 16:30:57 +0000</created>
                <updated>Wed, 29 Aug 2012 21:54:36 +0000</updated>
                            <resolved>Wed, 29 Aug 2012 21:54:36 +0000</resolved>
                                                                    <component>master</component>
                    <component>regionserver</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13042310" author="yuzhihong@gmail.com" created="Wed, 1 Jun 2011 17:32:17 +0000"  >&lt;p&gt;First attempt at solving this issue.&lt;/p&gt;</comment>
                            <comment id="13042379" author="stack" created="Wed, 1 Jun 2011 19:31:13 +0000"  >&lt;p&gt;Are we mixing region schema and region metrics when we add this to HRI Ted?  I&apos;m not a fan of it.  And do you think this the way to go?  By the time the balancer goes to act on the info, it&apos;ll be stale, don&apos;t you think?   It seems like the balancer issue that the boys were complaining off could be addressed by having the balancer not move regions it just moved in the previous balance run?  Thanks Ted.&lt;/p&gt;</comment>
                            <comment id="13042398" author="yuzhihong@gmail.com" created="Wed, 1 Jun 2011 20:17:39 +0000"  >&lt;p&gt;Thanks for the reminder, Stack.&lt;br/&gt;
HRI isn&apos;t a proper carrier for compaction status.&lt;br/&gt;
HRegionServer.buildServerLoad() has a chance to pass compaction status to Master. But in trunk, load balancer doesn&apos;t have access to HServerLoad (including RegionLoad).&lt;/p&gt;

&lt;p&gt;I agree that if a region was reassigned in round N, it shouldn&apos;t be reassigned again in round N+1, ideally.&lt;br/&gt;
I will log another issue for that. &lt;/p&gt;</comment>
                            <comment id="13043436" author="yuzhihong@gmail.com" created="Fri, 3 Jun 2011 16:08:08 +0000"  >&lt;p&gt;From Schubert:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;In my use case, the region-store size is aggresively set to be very large (such as 1GB, even 10GB), then, the time of compaction would take tens of minutes (e.g. 30 minutes).
 
hbase.regionserver.msginterval=3000, it is the default value.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The benefit of passing compaction status through RegionLoad is that load balancer wouldn&apos;t interrupt a half hour compaction 5 minutes after it starts (default value of hbase.balancer.period, some users make it longer to reduce impact of region reassignment).&lt;br/&gt;
There is still a chance that compaction is interrupted 3 seconds after it starts, but the cost is much lower than the above scenario.&lt;/p&gt;</comment>
                            <comment id="13043907" author="stack" created="Fri, 3 Jun 2011 17:51:50 +0000"  >&lt;p&gt;While passing general outline of compaction status on regionserver might make sense giving a feel for what a cluster is up to, I do not think that it should be used as a factor balancing.  For one the info the regionserver passes will likely be stale by the time the master goes to act on it (excepting the extreme case that Schubert outlines above).  Better I think is the suggestion above where we do not move recently balanced regions.  That should work for schubert&apos;s case.&lt;/p&gt;</comment>
                            <comment id="13444454" author="lhofhansl" created="Wed, 29 Aug 2012 21:54:36 +0000"  >&lt;p&gt;Closing as dup of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3945&quot; title=&quot;Load balancer shouldn&amp;#39;t move the same region in two consective balancing actions&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3945&quot;&gt;&lt;del&gt;HBASE-3945&lt;/del&gt;&lt;/a&gt;, since that was suggested as the right approach to fix this.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12501996">HBASE-3679</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 1 Jun 2011 19:31:13 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>27099</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 16 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0homn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>101252</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>