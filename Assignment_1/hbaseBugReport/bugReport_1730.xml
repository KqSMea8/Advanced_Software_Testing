<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:55:53 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-1730/HBASE-1730.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-1730] Near-instantaneous online schema and table state updates</title>
                <link>https://issues.apache.org/jira/browse/HBASE-1730</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;We should not need to take a table offline to update HCD or HTD. &lt;/p&gt;

&lt;p&gt;One option for that is putting HTDs and HCDs up into ZK, with mirror on disk catalog tables to be used only for cold init scenarios, as discussed on IRC. In this scheme, regionservers hosting regions of a table would watch permanent nodes in ZK associated with that table for schema updates and take appropriate actions out of the watcher. In effect, schema updates become another item in the ToDo list.&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;/hbase/tables/&amp;lt;table-name&amp;gt;/schema&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;Must be associated with a write locking scheme also handled with ZK primitives to avoid situations where one concurrent update clobbers another. &lt;/p&gt;</description>
                <environment></environment>
        <key id="12431925">HBASE-1730</key>
            <summary>Near-instantaneous online schema and table state updates</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="nspiegelberg">Nicolas Spiegelberg</assignee>
                                    <reporter username="apurtell">Andrew Purtell</reporter>
                        <labels>
                    </labels>
                <created>Fri, 31 Jul 2009 19:38:28 +0000</created>
                <updated>Fri, 20 Nov 2015 13:01:57 +0000</updated>
                            <resolved>Sat, 3 Sep 2011 05:29:04 +0000</resolved>
                                                    <fixVersion>0.92.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>16</watches>
                                                                <comments>
                            <comment id="12737688" author="ryanobjc" created="Fri, 31 Jul 2009 19:53:28 +0000"  >&lt;p&gt;lets decide on a serialization format to use within ZK, that is NOT hadoop writables.  I would vote for JSON since the data is small, and it would be nice for it to be human readable without programmatic intervention.&lt;/p&gt;</comment>
                            <comment id="12737689" author="apurtell" created="Fri, 31 Jul 2009 19:56:23 +0000"  >&lt;p&gt;+1 on all of Ryan&apos;s points.&lt;/p&gt;</comment>
                            <comment id="12738152" author="jimk" created="Mon, 3 Aug 2009 00:07:34 +0000"  >&lt;p&gt;+1 for putting descriptions both on disk for cold start and in ZK for on-line.&lt;/p&gt;

&lt;p&gt;As for format, how about Avro (which is json based)?&lt;/p&gt;</comment>
                            <comment id="12738155" author="apurtell" created="Mon, 3 Aug 2009 00:10:25 +0000"  >&lt;p&gt;@Jim: If AVRO is JSON based, then why not just use JSON? Pulls in less external dependencies...&lt;/p&gt;</comment>
                            <comment id="12771702" author="stack" created="Thu, 29 Oct 2009 23:50:25 +0000"  >&lt;p&gt;Assigned myself and added online state changes to title.&lt;/p&gt;</comment>
                            <comment id="12771703" author="ryanobjc" created="Thu, 29 Oct 2009 23:51:48 +0000"  >&lt;p&gt;while we are thinking about this, i&apos;d like to be able to do:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;add new CF&lt;/li&gt;
	&lt;li&gt;remove existing CF&lt;/li&gt;
	&lt;li&gt;change compression&lt;/li&gt;
	&lt;li&gt;change other things&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;without taking a table offline. that would be some killer features right there!&lt;/p&gt;</comment>
                            <comment id="12771705" author="stack" created="Thu, 29 Oct 2009 23:57:05 +0000"  >&lt;p&gt;Going to serialize HTD and HCD to zk as JSON; this seems easiest way to go for schema.  Will remove notion of state change from HTD and HCD though.  For instance if a region is offline, you won&apos;t know by reading the .META.; master will know because will have read state from zk.&lt;/p&gt;

&lt;p&gt;@apurtell I should use jackson for pojo 2 json because thats what you and avro are using.  One concern is versions.  Jackson is up to 1.2.  avro is jackson-core-asl-1.0.1.jar.  Stargate is 0.94.  Let me start with the version in stargate.  OK I pull it up to trunk/lib?  You can get it when its there?  Can I update to 1.0.1?&lt;/p&gt;</comment>
                            <comment id="12771706" author="stack" created="Thu, 29 Oct 2009 23:58:11 +0000"  >&lt;p&gt;For sure @ryan.  Thats what I&apos;m about: schema and state changes that are near-instantaneous.&lt;/p&gt;</comment>
                            <comment id="12771760" author="stack" created="Fri, 30 Oct 2009 03:57:56 +0000"  >&lt;p&gt;@apurtell I tried putting jackson 1.0.1 up in hbase/lib dir but doesn&apos;t look like stargate picks it up from there (though looking at stargate build.xml, it should &amp;#8211; maybe it dont like jackson-1.0.1).&lt;/p&gt;</comment>
                            <comment id="12771770" author="stack" created="Fri, 30 Oct 2009 04:26:08 +0000"  >&lt;p&gt;@apurtell nm... it seems like jackson is split in two in 1.0.1... if I have both jars in hbase/lib, then stargate tests all pass.&lt;/p&gt;</comment>
                            <comment id="12771827" author="stack" created="Fri, 30 Oct 2009 06:10:34 +0000"  >&lt;p&gt;Playing w/ Jackson, making it understand our HTD and HCD would take a bunch of ugly work.  I&apos;m thinking that we just make HTD and HCD be maps.  Then Jackson can do it w/o customization.  HTD and HCD don&apos;t need to be Writables anymore now they are to be serialized instead as JSON into znode.&lt;/p&gt;</comment>
                            <comment id="12772185" author="stack" created="Fri, 30 Oct 2009 23:56:45 +0000"  >&lt;p&gt;Started in on HCD.  Added test for new serialization.  Depends on jackson 1.0.1.  Long way from finished.&lt;/p&gt;

&lt;p&gt;This work might have us move from ruby map representations to JSON in UI, shell and in znode.  Will see.  Shouldn&apos;t be prob. really since HRegionInfo will no longer be shown in shell as much since it will no longer be in .META. when this work is done.&lt;/p&gt;</comment>
                            <comment id="12772364" author="stack" created="Sun, 1 Nov 2009 21:10:24 +0000"  >&lt;p&gt;More work on HCD.  Removes UnmodifyableHCD.  Since HCD now implements map, can just do a Collections.unmodifyableMap wrapper on delegate Map.  Jackson is sweet in that for new HCD.toString, I ask jackson to serialize to a StringReader.  It produces something like a ruby Map &amp;#8211; e..g. &lt;/p&gt;
{&quot;NAME&quot;: &quot;cf1&quot;, &quot;IN_MEMORY&quot;: true, &quot;COMPRESSION&quot;, &quot;LZO&quot;}
&lt;p&gt; &amp;#8211; only I can then take this &apos;String&apos; and deserialize to get me back the original HCD.  Nice for shell, UI, and content of a znode (I don&apos;t think we need to get toBinaryString in there since I don&apos;t think we have binary data in schema and table state).  Working on HTD next.&lt;/p&gt;</comment>
                            <comment id="12772368" author="jdcryans" created="Sun, 1 Nov 2009 21:24:40 +0000"  >&lt;p&gt;Looking good! I like how we get rid of all the doubled stuff because we had to maintain a string and a writable.&lt;/p&gt;</comment>
                            <comment id="12794317" author="stack" created="Thu, 24 Dec 2009 06:03:33 +0000"  >&lt;p&gt;Started a branch over in github for this work: &lt;a href=&quot;http://github.com/saintstack/hbase/tree/1730&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://github.com/saintstack/hbase/tree/1730&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="12848784" author="stack" created="Tue, 23 Mar 2010 16:20:13 +0000"  >&lt;p&gt;Here is latest state though a million miles from the finish.  Doesn&apos;t all compile yet.&lt;/p&gt;

&lt;p&gt;+ HCD becomes ColumnFamliyDefinition object.&lt;br/&gt;
+ HTD becomes TableDefinition&lt;br/&gt;
+ New TableState objection (offline, readonly, etc.)&lt;br/&gt;
+ HBaseAdmin now becomes nothing but moving stuff around in ZK, no need of a connection to cluster/master (Ryan noted that this means can do schema mods though hbase is not running).  All that evening stuff run by the master goes away.&lt;br/&gt;
+ There are a bunch of additions to ZKWatcher but I think J-D has done the same ones to make replication work.  I need to pick up his pattern of moving all of the master rewrite zk interactions to a class of their own rather than try and squeeze all into ZKWatcher.&lt;br/&gt;
+ Tests that play around with zk.  New TableData object is made of a TableDefinition and a TableState.  This is what we write out to a table znode.&lt;/p&gt;</comment>
                            <comment id="12867040" author="stack" created="Thu, 13 May 2010 04:42:58 +0000"  >&lt;p&gt;Moved from 0.21 to 0.22 just after merge of old 0.20 branch into TRUNK.&lt;/p&gt;</comment>
                            <comment id="12905159" author="stack" created="Wed, 1 Sep 2010 18:57:39 +0000"  >&lt;p&gt;Design for this is up in &lt;a href=&quot;http://wiki.apache.org/hadoop/Hbase/MasterRewrite&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://wiki.apache.org/hadoop/Hbase/MasterRewrite&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13005406" author="stack" created="Thu, 10 Mar 2011 23:49:48 +0000"  >&lt;p&gt;Ryan suggests that perhaps we not store the schema in ZK, but instead, in a schemas catalog table.  We&apos;d use zk though to notify all about schemas changes.&lt;/p&gt;</comment>
                            <comment id="13005415" author="ryanobjc" created="Thu, 10 Mar 2011 23:57:11 +0000"  >&lt;p&gt;this is because we dont have a lot of expertise in managing zk state. there are no dump tools, no restore tools, etc, etc. It would also make snapshotting a table harder, since there is now a secondary system to manage separately. By committing changes to WAL logs then having the regionservers execute those changes we have a better chance of doing snapshot &amp;amp; restore if, for example, &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-50&quot; title=&quot;Snapshot of table&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-50&quot;&gt;&lt;del&gt;HBASE-50&lt;/del&gt;&lt;/a&gt; came back.&lt;/p&gt;</comment>
                            <comment id="13009468" author="apurtell" created="Mon, 21 Mar 2011 23:24:25 +0000"  >&lt;p&gt;Discussed today on IRC in context of 0.92:&lt;/p&gt;

&lt;p&gt;&amp;lt;St^Ack&amp;gt; apurtell: so, altering table online part of 0.92? done by may 1st?&lt;br/&gt;
&amp;lt;St^Ack&amp;gt; apurtell: its pretty critical&lt;br/&gt;
&amp;lt;St^Ack&amp;gt; not only for cps&lt;br/&gt;
&amp;lt;apurtell&amp;gt; i would agree&lt;br/&gt;
&amp;lt;apurtell&amp;gt; just the attrs right?&lt;br/&gt;
&amp;lt;apurtell&amp;gt; we can overlay HTD and HCD attrs in ZK, update HRIs in meta write behind&lt;br/&gt;
&amp;lt;St^Ack&amp;gt; apurtell: yes&lt;br/&gt;
&amp;lt;apurtell&amp;gt; St^Ack: yes i think we need this, that would take care of the CP case (we can watch attr updates and trigger loads); having admin triggered online merge also highly desirable (after split threshold upward adjustment)&lt;/p&gt;

&lt;p&gt;&amp;lt;St^Ack&amp;gt; we can&apos;t put it up in zk as I used to think; dj_ryan points out that only transient data should be up in zk &apos;cos then we can just copy hdfs content to repro cluster elsewhere (otherwise have to copy out of zk too)&lt;br/&gt;
&amp;lt;apurtell&amp;gt; i want to mirror them up in zk&lt;br/&gt;
&amp;lt;apurtell&amp;gt; and change in zk first&lt;br/&gt;
&amp;lt;apurtell&amp;gt; and trigger actions via watches on the attr znodes&lt;br/&gt;
&amp;lt;apurtell&amp;gt; one action is write back to META of changes&lt;br/&gt;
&amp;lt;apurtell&amp;gt; other action could be to load a CP&lt;br/&gt;
&amp;lt;apurtell&amp;gt; other action would be to updated cached HRI or HRI-equivalent so we can e.g. change split threshold dynamically&lt;br/&gt;
&amp;lt;apurtell&amp;gt; so what is in zk is indeed transient&lt;br/&gt;
&amp;lt;apurtell&amp;gt; however we use it as a common point for online changes and use watches to replicate the changes cross cluster&lt;br/&gt;
&amp;lt;apurtell&amp;gt; ... well technically to trigger changes cross cluster &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
&amp;lt;St^Ack&amp;gt; apurtell: oh, there is hbase-1730&lt;br/&gt;
&amp;lt;St^Ack&amp;gt; apurtell: stick your desire above into 1730... bit about mirroring&lt;/p&gt;</comment>
                            <comment id="13062248" author="yuzhihong@gmail.com" created="Fri, 8 Jul 2011 23:16:09 +0000"  >&lt;p&gt;This feature would save the trouble Eran experienced (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4060&quot; title=&quot;Making region assignment more robust&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4060&quot;&gt;&lt;del&gt;HBASE-4060&lt;/del&gt;&lt;/a&gt;) because he wouldn&apos;t need to disable table in order to change TTL.&lt;/p&gt;</comment>
                            <comment id="13068733" author="dhruba" created="Thu, 21 Jul 2011 00:04:59 +0000"  >&lt;p&gt;Can somebody pl explain the current proposal? Is it as follows?&lt;/p&gt;

&lt;p&gt;&quot; The master receives a scheme-change command, updates META with the new schema and then issues a close/reopen (with some throttling) to all concerned regionservers. The master maintains current state of which region-servers have completed the close/reopen in a catalog file stored in HDFS&quot;.&lt;/p&gt;</comment>
                            <comment id="13069395" author="stack" created="Fri, 22 Jul 2011 05:44:08 +0000"  >&lt;p&gt;Dhruba:&lt;/p&gt;

&lt;p&gt;You can ignore the attached patches.  They and the design rotted.  A few things I learned back then were that &quot;complex&quot; objects to json is not so easy; if class is made of anything more complicated than a base types and primitives then you need to write helper code for ser/deser.  Because of this, I tried to dumb-down the schema classes making new versions of HTD and HCD.  I didn&apos;t finish it.&lt;/p&gt;

&lt;p&gt;Regards the proposal, it will no longer work; i.e the bit about &quot;updates .META.&apos; because recently HTD was moved out of HRI (so .META. no longer holds table meta in each row).  It is now to be found in a file named .tableinfo in the filesystem under each table directory.&lt;/p&gt;

&lt;p&gt;So, how this is implemented is pretty wide open.  I like Ryans&apos; dictum that we store transitory info in zk only, not permanent info like table schemas.  I&apos;d imagine then that a schema edit would change the .tableinfo content and then we&apos;d signal regionservers to reread the .tableinfo (via zk?).  What a RS did thereafter could be as dumb as close and reopen of all regions of the modified table or it could try and be smart about it and only do this if it really has to (otherwise, just update its inmemory copy of the .tableinfo with new settings).&lt;/p&gt;</comment>
                            <comment id="13069417" author="dhruba" created="Fri, 22 Jul 2011 07:02:23 +0000"  >&lt;p&gt;&amp;gt; I like Ryans&apos; dictum that we store transitory info in zk only, not permanent info like table schemas.&lt;/p&gt;

&lt;p&gt;Completely agree. All schema info resides in .tableinfo and it will continue to reside there. &lt;/p&gt;

&lt;p&gt;My current proposal for this jira is to make the alter-table command go to the master to update the .tableinfo file. Then the master will trigger the normal close/open sequence for each region-id to all relevant regionservers. There will be some throttling built in so that all regions of the table do not encounter a close/open sequence at the same time. &lt;/p&gt;

&lt;p&gt;The master will not maintain persistant state on which region-ids has been closed/opened; if the master dies before all regionids were closed/opened, then an admin has to issue a disable/enable command to propage the schema change to all region servers.&lt;/p&gt;

&lt;p&gt;Does this sound reasonable?&lt;/p&gt;

</comment>
                            <comment id="13069586" author="stack" created="Fri, 22 Jul 2011 15:38:13 +0000"  >&lt;p&gt;For a first cut, yes.  We can make it more smarty-pants later.&lt;/p&gt;</comment>
                            <comment id="13083875" author="nileema" created="Fri, 12 Aug 2011 02:03:23 +0000"  >&lt;p&gt;Here is a patch for Dhruba&apos;s proposal. &lt;/p&gt;</comment>
                            <comment id="13083886" author="nileema" created="Fri, 12 Aug 2011 03:12:30 +0000"  >&lt;p&gt;The attached patch (&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt;.patch) does the following: &lt;/p&gt;

&lt;p&gt;When the master receives an alter table call (addColumn, modifyColumn, deleteColumn, modifyTable), it updates the .tableinfo and then closes all the regions of that table. The patch includes: &lt;/p&gt;

&lt;p&gt;1. Changes to reopen the regions when any of the above operations are performed. &lt;br/&gt;
2. Best effort is made to preserve the locality of regions by assigning it a region plan before closing it. &lt;br/&gt;
3. Throttling logic that ensures that only a configurable number of regions are closed per region server at a time. &lt;br/&gt;
4. alter command in the hbase shell will block until all the regions are updated, providing a status &quot;x/y regions updated&quot; every second. &lt;br/&gt;
5. alter_async command that works exactly like alter, except that it does not block for completion or provide the status. &lt;br/&gt;
6. alter_status &amp;lt;table_name&amp;gt; which is a sync call and blocks to provide the &quot;x/y regions updated&quot; status per second until all regions are updated. &lt;br/&gt;
7. modification in the unit test for enabling alter without disabling the table. &lt;/p&gt;


&lt;p&gt;Number of regions that are closed at a time (per region server) is configurable. &lt;/p&gt;</comment>
                            <comment id="13083892" author="yuzhihong@gmail.com" created="Fri, 12 Aug 2011 03:23:33 +0000"  >&lt;p&gt;Nice work. In the future, please use &lt;a href=&quot;https://reviews.apache.org&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org&lt;/a&gt; for code review.&lt;br/&gt;
Is the following needed in HbaseObjectWritable.java where Serializable is handled already:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    addToMap(Pair.class, code++);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please remove log for debugging or change it to LOG.debug():&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;======== in assignment manager&quot;&lt;/span&gt;);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    RegionState regionState = regionsInTransition.get(hri.getEncodedName());
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!regionsToReopen.isEmpty()) {
+      regionsToReopen.remove(regionState.getRegion().getEncodedName());
+    }  
     &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ClosedRegionHandler(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master, &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;, hri).process();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Should regionsToReopen.remove() call be placed inside ClosedRegionHandler.process() (toward the end)?&lt;br/&gt;
And why use regionState.getRegion().getEncodedName() where hri.getEncodedName() gives the same value ?&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+    &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; waitTime = &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.master.getConfiguration().getInt(
+        &lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.bulk.reopen.waitafter.reopen&quot;&lt;/span&gt;, 0);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Do we need to retrieve the wait time every time in this method ? A better name for the knob is hbase.bulk.waitbetween.reopen&lt;/p&gt;</comment>
                            <comment id="13083901" author="yuzhihong@gmail.com" created="Fri, 12 Aug 2011 03:46:17 +0000"  >&lt;p&gt;Please finish this code in BulkReOpen.java:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          } &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException e) {
+            &lt;span class=&quot;code-comment&quot;&gt;// TODO Auto-generated &lt;span class=&quot;code-keyword&quot;&gt;catch&lt;/span&gt; block
&lt;/span&gt;+            e.printStackTrace();
+          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The method getThreadCount() can be simplified to:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+      &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.server.getConfiguration().getInt(
+        &lt;span class=&quot;code-quote&quot;&gt;&quot;hbase.bulk.reopen.threadpool.size&quot;&lt;/span&gt;, defaultThreadCount);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;For TableEventHandler, why is the loop needed in reOpenAllRegions() ? BulkReOpen.waitUntilDone() always returns true for bulkReopen.bulkReOpen().&lt;/p&gt;</comment>
                            <comment id="13083966" author="nileema" created="Fri, 12 Aug 2011 06:15:43 +0000"  >&lt;p&gt;Hi Ted, &lt;br/&gt;
Thank you for reviewing the code!&lt;br/&gt;
I have incorporated them and posted it on the review board here: &lt;a href=&quot;https://reviews.apache.org/r/1479/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13083967" author="jiraposter@reviews.apache.org" created="Fri, 12 Aug 2011 06:16:26 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1479/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Review request for Dhruba Borthakur, Ted Yu, Michael Stack, and Jonathan Gray.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;When the master receives an alter table call (addColumn, modifyColumn, deleteColumn, modifyTable), it updates the .tableinfo and then closes all the regions of that table. The patch includes:&lt;/p&gt;

&lt;p&gt;1. Changes to reopen the regions when any of the above operations are performed. &lt;br/&gt;
2. Best effort is made to preserve the locality of regions by assigning it a region plan before closing it. &lt;br/&gt;
3. Throttling logic that ensures that only a configurable number of regions are closed per region server at a time. &lt;br/&gt;
4. alter command in the hbase shell will block until all the regions are updated, providing a status &quot;x/y regions updated&quot; every second. &lt;br/&gt;
5. alter_async command that works exactly like alter, except that it does not block for completion or provide the status. &lt;br/&gt;
6. alter_status &amp;lt;table_name&amp;gt; which is a sync call and blocks to provide the &quot;x/y regions updated&quot; status per second until all regions are updated. &lt;br/&gt;
7. modification in the unit test for enabling alter without disabling the table.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-1730&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java f151c77 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/io/HbaseObjectWritable.java 13c8b8c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java c0aa024 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 49d1e7c &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/BulkReOpen.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 8beeb68 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 57c1140 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java ae43837 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 09891aa &lt;br/&gt;
  src/main/ruby/hbase/admin.rb 4460d6e &lt;br/&gt;
  src/main/ruby/shell.rb 1ec330f &lt;br/&gt;
  src/main/ruby/shell/commands/alter.rb 1dd43ad &lt;br/&gt;
  src/main/ruby/shell/commands/alter_async.rb PRE-CREATION &lt;br/&gt;
  src/main/ruby/shell/commands/alter_status.rb PRE-CREATION &lt;br/&gt;
  src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java a32dc99 &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1479/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;I am putting this up for initial review. I have tested  the functionality in a pseudo distributed mode. &lt;br/&gt;
Need to run unit tests.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Nileema&lt;/p&gt;
</comment>
                            <comment id="13083990" author="jiraposter@reviews.apache.org" created="Fri, 12 Aug 2011 08:04:27 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1479/#review1416&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#review1416&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;Please test this patch using a real cluster.&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/io/HbaseObjectWritable.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3273&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3273&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Pair implements Serializable which is handled specially by HbaseObjectWritable (see line 350 below). Why is this needed ?&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Ted&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-08-12 06:14:21, Nileema Shingte wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1479/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-08-12 06:14:21)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for Dhruba Borthakur, Ted Yu, Michael Stack, and Jonathan Gray.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;When the master receives an alter table call (addColumn, modifyColumn, deleteColumn, modifyTable), it updates the .tableinfo and then closes all the regions of that table. The patch includes:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. Changes to reopen the regions when any of the above operations are performed. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. Best effort is made to preserve the locality of regions by assigning it a region plan before closing it. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3. Throttling logic that ensures that only a configurable number of regions are closed per region server at a time. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;4. alter command in the hbase shell will block until all the regions are updated, providing a status &quot;x/y regions updated&quot; every second. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;5. alter_async command that works exactly like alter, except that it does not block for completion or provide the status. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;6. alter_status &amp;lt;table_name&amp;gt; which is a sync call and blocks to provide the &quot;x/y regions updated&quot; status per second until all regions are updated. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;7. modification in the unit test for enabling alter without disabling the table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-1730&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java f151c77 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/io/HbaseObjectWritable.java 13c8b8c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java c0aa024 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 49d1e7c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/BulkReOpen.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 8beeb68 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 57c1140 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java ae43837 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 09891aa &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/hbase/admin.rb 4460d6e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell.rb 1ec330f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell/commands/alter.rb 1dd43ad &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell/commands/alter_async.rb PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell/commands/alter_status.rb PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java a32dc99 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1479/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I am putting this up for initial review. I have tested  the functionality in a pseudo distributed mode. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Need to run unit tests.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Nileema&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13086329" author="iamknome" created="Wed, 17 Aug 2011 14:13:03 +0000"  >&lt;p&gt;Support instant schema updates with out master&apos;s intervention and bulk assign/unassign.&lt;/p&gt;</comment>
                            <comment id="13086333" author="iamknome" created="Wed, 17 Aug 2011 14:17:01 +0000"  >&lt;p&gt;In continuation of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-451&quot; title=&quot;Remove HTableDescriptor from HRegionInfo&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-451&quot;&gt;&lt;del&gt;HBASE-451&lt;/del&gt;&lt;/a&gt;, I was working on a patch for this issue and just realized that there is already a patch submitted for this Jira. I created a related patch &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt; that follows a slightly different approach to the same problem and thought will any way submit my patch as well.&lt;/p&gt;


</comment>
                            <comment id="13087387" author="jiraposter@reviews.apache.org" created="Thu, 18 Aug 2011 23:16:26 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1479/#review1535&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#review1535&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;I reviewed about half.  Nice patch.  Thank you.&lt;/p&gt;

&lt;p&gt;One feature that hbase-4213 has is that the state of the alter is tracked up in zk.  4213 doesn&apos;t do this but, going via zk would seem to make the transaction more robust against failure of master.  What happens in this patch if master is shot in the head mid-way threw the alter?  What you think Nileema?&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3489&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3489&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    White space.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3490&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3490&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why catch exception to just rethrow it?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/io/HbaseObjectWritable.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3491&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3491&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    White space&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/io/HbaseObjectWritable.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3492&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3492&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    You are adding white space. &lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3493&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3493&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Javadoc does not agree w/ what is being actually returned.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3494&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3494&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    HSI is deprecated.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3497&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3497&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    White space.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3499&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3499&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why are we waiting between unassigns?  To lessen load on cluster?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3500&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3500&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Is there anything in here to stop someone disabling a table or preventing the load balancer moving regions while this is all going on?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3501&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3501&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This looks like you are fixing a bug we have in hbase?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3502&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3502&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Missing curly braces&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-08-12 06:14:21, Nileema Shingte wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1479/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-08-12 06:14:21)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for Dhruba Borthakur, Ted Yu, Michael Stack, and Jonathan Gray.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;When the master receives an alter table call (addColumn, modifyColumn, deleteColumn, modifyTable), it updates the .tableinfo and then closes all the regions of that table. The patch includes:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. Changes to reopen the regions when any of the above operations are performed. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. Best effort is made to preserve the locality of regions by assigning it a region plan before closing it. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3. Throttling logic that ensures that only a configurable number of regions are closed per region server at a time. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;4. alter command in the hbase shell will block until all the regions are updated, providing a status &quot;x/y regions updated&quot; every second. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;5. alter_async command that works exactly like alter, except that it does not block for completion or provide the status. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;6. alter_status &amp;lt;table_name&amp;gt; which is a sync call and blocks to provide the &quot;x/y regions updated&quot; status per second until all regions are updated. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;7. modification in the unit test for enabling alter without disabling the table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-1730&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java f151c77 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/io/HbaseObjectWritable.java 13c8b8c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java c0aa024 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 49d1e7c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/BulkReOpen.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 8beeb68 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/ServerManager.java 57c1140 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java ae43837 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 09891aa &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/hbase/admin.rb 4460d6e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell.rb 1ec330f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell/commands/alter.rb 1dd43ad &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell/commands/alter_async.rb PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell/commands/alter_status.rb PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java a32dc99 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1479/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I am putting this up for initial review. I have tested  the functionality in a pseudo distributed mode. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Need to run unit tests.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Nileema&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13089829" author="nspiegelberg" created="Tue, 23 Aug 2011 22:34:53 +0000"  >&lt;p&gt;Stack, Ted, Nileema, Karthik, and I discussed the &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt; &amp;amp; &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4213&quot; title=&quot;Support for fault tolerant, instant schema updates with out master&amp;#39;s intervention (i.e with out enable/disable and bulk assign/unassign) through ZK.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4213&quot;&gt;&lt;del&gt;HBASE-4213&lt;/del&gt;&lt;/a&gt; methodologies at the HBase Hackathon yesterday.  Main Points:&lt;/p&gt;

&lt;p&gt;1. 1730 &amp;amp; 4213 are not the same feature.  1730 is implementing online schema changes, 4213 is adding persistence to online schema changes during master failover.  We should think of the two JIRAs as disjoint in this way.&lt;br/&gt;
2. 1730 meets it&apos;s looser requirements.  Karthik &amp;amp; other developers had a handful of design concerns about 4213.  We should make sure the design &amp;amp; failure analysis is solid before committing that feature.&lt;br/&gt;
3. In the 4213/1730 overlap, there is some useful non-persistent functionality and design that should be incorporated into 1730 before commit.&lt;br/&gt;
4. What is the testing/maturity of the 4213 patch?  We have done extensive dev/cluster testing on 1730 internally &amp;amp; communicated this to the other committers.  The persistence on 4213 requires even more edge case analysis testing than this feature to meet its requirements.  None of us currently have any visibility into the 4213 testing &amp;amp; support.  @Subbu: Could you please elaborate more in JIRA/IRC about the maturity of your patch?&lt;/p&gt;

&lt;p&gt;We would like to commit 1730 first since it is mature and iterate/solidify 4213 a little bit before committing.&lt;/p&gt;</comment>
                            <comment id="13089839" author="yuzhihong@gmail.com" created="Tue, 23 Aug 2011 22:48:37 +0000"  >&lt;p&gt;@Nicholas:&lt;br/&gt;
Pardon me for correcting the JIRA number.&lt;/p&gt;

&lt;p&gt;I am fine with 1730 going in at this moment.&lt;br/&gt;
Subbu/Nileema can use 4213 to continue with master failover support.&lt;/p&gt;

&lt;p&gt;Please also publish the test cases for 1730: cluster size, table size, types of online schema changes (family addition/deletion, etc), values for knobs used, time taken for online schema changes.&lt;/p&gt;</comment>
                            <comment id="13089862" author="iamknome" created="Tue, 23 Aug 2011 23:19:28 +0000"  >&lt;p&gt;Hi Nicolas,&lt;/p&gt;

&lt;p&gt;Couple of call outs:&lt;/p&gt;

&lt;p&gt;1. 4213, just like 1730, also implements the online schema change as&lt;br/&gt;
well. (but the pattern is slightly different, in that 4213 relies on&lt;br/&gt;
the RS cloud to refresh the online regions applicable for the table&lt;br/&gt;
with latest schema changes rather than master explicitly unassigning&lt;br/&gt;
and reassigning all the regions of the table). When we alter a table&lt;br/&gt;
with add/modify/delete CF the only thing that changes is the HTD for&lt;br/&gt;
the table, and since the RS has access to this new version of HTD&lt;br/&gt;
(after master completes the schema change) it can simply close/open a&lt;br/&gt;
region for the changes to take effect. This was the fundamental&lt;br/&gt;
assumption behind 4213&apos;s implementation.&lt;/p&gt;

&lt;p&gt;2. The testing and maturity for 4213 is TBD/Unknown, as I don&apos;t have&lt;br/&gt;
the required resources (a real cluster setup) to perform the necessary&lt;br/&gt;
acid tests to comment on that.&lt;/p&gt;

&lt;p&gt;3. &#160;Karthik &amp;amp; other developers had a handful of design concerns about 4123:&lt;br/&gt;
Could you please iterate those concerns so we can address them when we&lt;br/&gt;
add the persistent capability to 1730?&lt;/p&gt;

&lt;p&gt;thanks&lt;br/&gt;
Subbu&lt;/p&gt;



&lt;p&gt;On Tue, Aug 23, 2011 at 3:35 PM, Nicolas Spiegelberg (JIRA)&lt;/p&gt;</comment>
                            <comment id="13090010" author="stack" created="Wed, 24 Aug 2011 05:36:07 +0000"  >&lt;p&gt;@Ted Would suggest you just point out error in the Nicolas comment rather than edit the comments of someone else.  Its hard to grok why an edit (though in above you say why).&lt;/p&gt;

&lt;p&gt;@Subbu On 1., your soln. looks like it would be more &apos;scalable&apos;.  On 2., 1730, we learned yesterday, has been deployed in a production context and purportedly works (This true Nicolas?).  On 3., IIRC, Karthik&apos;s reasoning was that with 1730 you can tell if it failed or not since master is keeping running tab on state (If failure &amp;#8211; master dies or failed close/open of region &amp;#8211; then manual intervention to disable/enable table was fine he reasoned).  With 4213, the thought was that it was not as easy seeing whether operation succeeded or not.&lt;/p&gt;

&lt;p&gt;Another point bantered about was that 1730 has region granularity whereas 4213 goes by regionserver; it was thought that it&apos;d be easier to figure the problem region in 1730 case.&lt;/p&gt;</comment>
                            <comment id="13091886" author="jiraposter@reviews.apache.org" created="Fri, 26 Aug 2011 17:21:29 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1479/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-08-26 17:21:22.585689)&lt;/p&gt;


&lt;p&gt;Review request for Dhruba Borthakur, Ted Yu, Michael Stack, and Jonathan Gray.&lt;/p&gt;


&lt;p&gt;Changes&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;1. Removed the changes to HBaseObjectWritable as Pair is already serializable&lt;br/&gt;
2. fixed whitespaces &lt;br/&gt;
3. added debug statements &lt;/p&gt;

&lt;p&gt;I have not disabled the balancer because the logic for restoring the state of the balancer breaks for multiple concurrent alter commands.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;When the master receives an alter table call (addColumn, modifyColumn, deleteColumn, modifyTable), it updates the .tableinfo and then closes all the regions of that table. The patch includes:&lt;/p&gt;

&lt;p&gt;1. Changes to reopen the regions when any of the above operations are performed. &lt;br/&gt;
2. Best effort is made to preserve the locality of regions by assigning it a region plan before closing it. &lt;br/&gt;
3. Throttling logic that ensures that only a configurable number of regions are closed per region server at a time. &lt;br/&gt;
4. alter command in the hbase shell will block until all the regions are updated, providing a status &quot;x/y regions updated&quot; every second. &lt;br/&gt;
5. alter_async command that works exactly like alter, except that it does not block for completion or provide the status. &lt;br/&gt;
6. alter_status &amp;lt;table_name&amp;gt; which is a sync call and blocks to provide the &quot;x/y regions updated&quot; status per second until all regions are updated. &lt;br/&gt;
7. modification in the unit test for enabling alter without disabling the table.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-1730&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs (updated)&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java 5965919 &lt;br/&gt;
  src/main/ruby/shell.rb 1ec330f &lt;br/&gt;
  src/main/ruby/shell/commands/alter.rb 1dd43ad &lt;br/&gt;
  src/main/ruby/shell/commands/alter_async.rb PRE-CREATION &lt;br/&gt;
  src/main/ruby/shell/commands/alter_status.rb PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 09891aa &lt;br/&gt;
  src/main/ruby/hbase/admin.rb 4460d6e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 9784195 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java ae43837 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 6332953 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/BulkReOpen.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java b5d65ce &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 0c9ecce &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java c0aa024 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 49d1e7c &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1479/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;I am putting this up for initial review. I have tested  the functionality in a pseudo distributed mode. &lt;br/&gt;
Need to run unit tests.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Nileema&lt;/p&gt;
</comment>
                            <comment id="13091888" author="jiraposter@reviews.apache.org" created="Fri, 26 Aug 2011 17:25:29 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1479/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;(Updated 2011-08-26 17:25:21.197997)&lt;/p&gt;


&lt;p&gt;Review request for hbase, Dhruba Borthakur, Ted Yu, Michael Stack, and Jonathan Gray.&lt;/p&gt;


&lt;p&gt;Summary&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;When the master receives an alter table call (addColumn, modifyColumn, deleteColumn, modifyTable), it updates the .tableinfo and then closes all the regions of that table. The patch includes:&lt;/p&gt;

&lt;p&gt;1. Changes to reopen the regions when any of the above operations are performed. &lt;br/&gt;
2. Best effort is made to preserve the locality of regions by assigning it a region plan before closing it. &lt;br/&gt;
3. Throttling logic that ensures that only a configurable number of regions are closed per region server at a time. &lt;br/&gt;
4. alter command in the hbase shell will block until all the regions are updated, providing a status &quot;x/y regions updated&quot; every second. &lt;br/&gt;
5. alter_async command that works exactly like alter, except that it does not block for completion or provide the status. &lt;br/&gt;
6. alter_status &amp;lt;table_name&amp;gt; which is a sync call and blocks to provide the &quot;x/y regions updated&quot; status per second until all regions are updated. &lt;br/&gt;
7. modification in the unit test for enabling alter without disabling the table.&lt;/p&gt;


&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-1730&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Diffs&lt;/p&gt;
&lt;hr /&gt;

&lt;p&gt;  src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java 5965919 &lt;br/&gt;
  src/main/ruby/shell.rb 1ec330f &lt;br/&gt;
  src/main/ruby/shell/commands/alter.rb 1dd43ad &lt;br/&gt;
  src/main/ruby/shell/commands/alter_async.rb PRE-CREATION &lt;br/&gt;
  src/main/ruby/shell/commands/alter_status.rb PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 09891aa &lt;br/&gt;
  src/main/ruby/hbase/admin.rb 4460d6e &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/HMaster.java 9784195 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java ae43837 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 6332953 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/BulkReOpen.java PRE-CREATION &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java b5d65ce &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 0c9ecce &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java c0aa024 &lt;br/&gt;
  src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 49d1e7c &lt;/p&gt;

&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1479/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/diff&lt;/a&gt;&lt;/p&gt;


&lt;p&gt;Testing&lt;br/&gt;
-------&lt;/p&gt;

&lt;p&gt;I am putting this up for initial review. I have tested  the functionality in a pseudo distributed mode. &lt;br/&gt;
Need to run unit tests.&lt;/p&gt;


&lt;p&gt;Thanks,&lt;/p&gt;

&lt;p&gt;Nileema&lt;/p&gt;
</comment>
                            <comment id="13091895" author="jiraposter@reviews.apache.org" created="Fri, 26 Aug 2011 17:37:29 +0000"  >

&lt;blockquote&gt;&lt;p&gt;On 2011-08-18 23:15:10, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java, line 80&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/diff/1/?file=32327#file32327line80&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/diff/1/?file=32327#file32327line80&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Javadoc does not agree w/ what is being actually returned.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;fixed this.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-08-18 23:15:10, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java, line 1498&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/diff/1/?file=32328#file32328line1498&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/diff/1/?file=32328#file32328line1498&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Why are we waiting between unassigns?  To lessen load on cluster?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;yes.&lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-08-18 23:15:10, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/master/HMaster.java, line 1067&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/diff/1/?file=32330#file32330line1067&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/diff/1/?file=32330#file32330line1067&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     Is there anything in here to stop someone disabling a table or preventing the load balancer moving regions while this is all going on?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;the problem with this is, if you run more than one alter concurrently, we do not have a way to restore the state of the loadbalancer. &lt;/p&gt;


&lt;blockquote&gt;&lt;p&gt;On 2011-08-18 23:15:10, Michael Stack wrote:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java, line 101&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt; &amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/diff/1/?file=32332#file32332line101&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/diff/1/?file=32332#file32332line101&lt;/a&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&amp;gt;     This looks like you are fixing a bug we have in hbase?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;No. this is required for the bulk reopen operation and impacts only reopen datastructures. &lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Nileema&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1479/#review1535&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#review1535&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;


&lt;p&gt;On 2011-08-26 17:25:21, Nileema Shingte wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1479/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-08-26 17:25:21)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Dhruba Borthakur, Ted Yu, Michael Stack, and Jonathan Gray.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;When the master receives an alter table call (addColumn, modifyColumn, deleteColumn, modifyTable), it updates the .tableinfo and then closes all the regions of that table. The patch includes:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. Changes to reopen the regions when any of the above operations are performed. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. Best effort is made to preserve the locality of regions by assigning it a region plan before closing it. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3. Throttling logic that ensures that only a configurable number of regions are closed per region server at a time. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;4. alter command in the hbase shell will block until all the regions are updated, providing a status &quot;x/y regions updated&quot; every second. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;5. alter_async command that works exactly like alter, except that it does not block for completion or provide the status. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;6. alter_status &amp;lt;table_name&amp;gt; which is a sync call and blocks to provide the &quot;x/y regions updated&quot; status per second until all regions are updated. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;7. modification in the unit test for enabling alter without disabling the table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-1730&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java 5965919 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell.rb 1ec330f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell/commands/alter.rb 1dd43ad &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell/commands/alter_async.rb PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell/commands/alter_status.rb PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 09891aa &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/hbase/admin.rb 4460d6e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 9784195 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java ae43837 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 6332953 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/BulkReOpen.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java b5d65ce &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 0c9ecce &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java c0aa024 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 49d1e7c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1479/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I am putting this up for initial review. I have tested  the functionality in a pseudo distributed mode. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Need to run unit tests.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Nileema&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13092098" author="jiraposter@reviews.apache.org" created="Fri, 26 Aug 2011 22:29:29 +0000"  >
&lt;p&gt;-----------------------------------------------------------&lt;br/&gt;
This is an automatically generated e-mail. To reply, visit:&lt;br/&gt;
&lt;a href=&quot;https://reviews.apache.org/r/1479/#review1665&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#review1665&lt;/a&gt;&lt;br/&gt;
-----------------------------------------------------------&lt;/p&gt;

&lt;p&gt;Ship it!&lt;/p&gt;


&lt;p&gt;This is good to go.  Few questions in the below first though before commit.   Thanks Nileema.&lt;/p&gt;


&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3712&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3712&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Good.&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3713&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3713&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    nit: You don&apos;t need to say &apos;This function...&apos;  Its a given (smile).&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3714&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3714&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    This code dups the method above, removeClosedRegions?   Is that intentional?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3715&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3715&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    Why would we wait?  Don&apos;t we want schema change to come on fast?  Already, opening each region is series is going to run slow when table is 20k regions or 200k regions.   Or do you folks think different?&lt;/p&gt;



&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3716&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3716&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    nit: curly braces&lt;/p&gt;



&lt;p&gt;src/main/ruby/shell.rb&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3717&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3717&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    So, old style alter works too?&lt;/p&gt;



&lt;p&gt;src/main/ruby/shell/commands/alter_async.rb&lt;br/&gt;
&amp;lt;&lt;a href=&quot;https://reviews.apache.org/r/1479/#comment3718&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/#comment3718&lt;/a&gt;&amp;gt;&lt;/p&gt;

&lt;p&gt;    nice&lt;/p&gt;


&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Michael&lt;/li&gt;
&lt;/ul&gt;



&lt;p&gt;On 2011-08-26 17:25:21, Nileema Shingte wrote:&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This is an automatically generated e-mail. To reply, visit:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://reviews.apache.org/r/1479/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----------------------------------------------------------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;(Updated 2011-08-26 17:25:21)&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Review request for hbase, Dhruba Borthakur, Ted Yu, Michael Stack, and Jonathan Gray.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Summary&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;When the master receives an alter table call (addColumn, modifyColumn, deleteColumn, modifyTable), it updates the .tableinfo and then closes all the regions of that table. The patch includes:&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;1. Changes to reopen the regions when any of the above operations are performed. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;2. Best effort is made to preserve the locality of regions by assigning it a region plan before closing it. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;3. Throttling logic that ensures that only a configurable number of regions are closed per region server at a time. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;4. alter command in the hbase shell will block until all the regions are updated, providing a status &quot;x/y regions updated&quot; every second. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;5. alter_async command that works exactly like alter, except that it does not block for completion or provide the status. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;6. alter_status &amp;lt;table_name&amp;gt; which is a sync call and blocks to provide the &quot;x/y regions updated&quot; status per second until all regions are updated. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;7. modification in the unit test for enabling alter without disabling the table.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;This addresses bug &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-1730&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diffs&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-----&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java 5965919 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell.rb 1ec330f &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell/commands/alter.rb 1dd43ad &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell/commands/alter_async.rb PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/shell/commands/alter_status.rb PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java 09891aa &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/ruby/hbase/admin.rb 4460d6e &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/HMaster.java 9784195 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java ae43837 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java 6332953 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/BulkReOpen.java PRE-CREATION &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java b5d65ce &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java 0c9ecce &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java c0aa024 &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java 49d1e7c &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Diff: &lt;a href=&quot;https://reviews.apache.org/r/1479/diff&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://reviews.apache.org/r/1479/diff&lt;/a&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Testing&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;-------&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;I am putting this up for initial review. I have tested  the functionality in a pseudo distributed mode. &lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Need to run unit tests.&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Thanks,&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;Nileema&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;/p&gt;&lt;/blockquote&gt;
</comment>
                            <comment id="13092168" author="iamknome" created="Sat, 27 Aug 2011 02:27:02 +0000"  >&lt;p&gt;Nilemma/Nicholas,&lt;/p&gt;

&lt;p&gt;Are you (or some one) already working on incorporating the required changes from 4213 to trunk after your patch is applied?&lt;/p&gt;

&lt;p&gt;I would like to work on it as I already have most of the required changes, but would not want to step into your shoes if some one on your side is already working on it.&lt;/p&gt;

&lt;p&gt;Please let me know.&lt;/p&gt;</comment>
                            <comment id="13092169" author="nileema" created="Sat, 27 Aug 2011 02:30:16 +0000"  >&lt;p&gt;Subbu, &lt;/p&gt;

&lt;p&gt;I am not working on this. You can go ahead with this! :&lt;/p&gt;</comment>
                            <comment id="13092170" author="iamknome" created="Sat, 27 Aug 2011 02:33:25 +0000"  >&lt;p&gt;Thanks Nileema. I shall take it from here after your patch is commited to trunk.&lt;/p&gt;</comment>
                            <comment id="13092545" author="yuzhihong@gmail.com" created="Sun, 28 Aug 2011 20:55:52 +0000"  >&lt;p&gt;Please rebase patch on latest TRUNK:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
patching file src/main/ruby/shell.rb
Hunk #1 FAILED at 227.
1 out of 1 hunk FAILED -- saving rejects to file src/main/ruby/shell.rb.rej
patching file src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java
Hunk #1 FAILED at 26.
1 out of 2 hunks FAILED -- saving rejects to file src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java.rej
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13092547" author="yuzhihong@gmail.com" created="Sun, 28 Aug 2011 21:04:51 +0000"  >&lt;p&gt;RegionPlan has become a top level class:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/home/hadoop/hbase/src/main/java/org/apache/hadoop/hbase/master/BulkReOpen.java:[32,50] cannot find symbol
symbol  : class RegionPlan
location: &lt;span class=&quot;code-keyword&quot;&gt;interface&lt;/span&gt; org.apache.hadoop.hbase.master.LoadBalancer
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13094387" author="yuzhihong@gmail.com" created="Wed, 31 Aug 2011 08:49:38 +0000"  >&lt;p&gt;@Nicolas:&lt;br/&gt;
As Nileema indicated, she was no longer working on this issue.&lt;br/&gt;
Please assign this to the next person so that progress can be made.&lt;/p&gt;</comment>
                            <comment id="13096565" author="nspiegelberg" created="Sat, 3 Sep 2011 02:53:42 +0000"  >&lt;p&gt;Nileema sent me this patch to address the peer feedback (note, she volunteered this after her internship, +1).  Made minor modifications.  Passes TestAdmin&lt;/p&gt;</comment>
                            <comment id="13096582" author="hudson" created="Sat, 3 Sep 2011 05:16:38 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2175 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2175/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2175/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-1730&quot; title=&quot;Near-instantaneous online schema and table state updates&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-1730&quot;&gt;&lt;del&gt;HBASE-1730&lt;/del&gt;&lt;/a&gt; Online schema changes for HBase&lt;/p&gt;

&lt;p&gt;nspiegelberg : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/client/HBaseAdmin.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/executor/EventHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/ipc/HMasterInterface.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/AssignmentManager.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/BulkReOpen.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/ClosedRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableAddFamilyHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/TableEventHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/ruby/hbase/admin.rb&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/ruby/shell.rb&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/ruby/shell/commands/alter.rb&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/ruby/shell/commands/alter_async.rb&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/ruby/shell/commands/alter_status.rb&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/test/java/org/apache/hadoop/hbase/client/TestAdmin.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13096583" author="yuzhihong@gmail.com" created="Sat, 3 Sep 2011 05:29:04 +0000"  >&lt;p&gt;Latest patch has been integrated by Nicolas.&lt;/p&gt;</comment>
                            <comment id="15017939" author="lars_francke" created="Fri, 20 Nov 2015 13:01:57 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12429981">HBASE-1636</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310010">
                    <name>Incorporates</name>
                                                                <inwardlinks description="is part of">
                                        <issuelink>
            <issuekey id="12434794">HBASE-1816</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12431852">HBASE-1728</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12529908">HBASE-4729</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12519116">HBASE-4213</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="12310050">
                    <name>Regression</name>
                                            <outwardlinks description="breaks">
                                        <issuelink>
            <issuekey id="12541900">HBASE-5359</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12423785" name="1730-v2.patch" size="42607" author="stack" created="Sun, 1 Nov 2009 21:10:24 +0000"/>
                            <attachment id="12439584" name="1730-v3.patch" size="195954" author="stack" created="Tue, 23 Mar 2010 16:20:13 +0000"/>
                            <attachment id="12423736" name="1730.patch" size="30209" author="stack" created="Fri, 30 Oct 2009 23:56:44 +0000"/>
                            <attachment id="12492869" name="HBASE-1730-2.patch" size="35586" author="nspiegelberg" created="Sat, 3 Sep 2011 02:53:42 +0000"/>
                            <attachment id="12490206" name="HBASE-1730.patch" size="37805" author="nileema" created="Fri, 12 Aug 2011 02:03:23 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 31 Jul 2009 19:53:28 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>32242</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hey7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>99684</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>