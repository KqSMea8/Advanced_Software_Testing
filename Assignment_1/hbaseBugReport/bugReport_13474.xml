<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:43:42 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13474/HBASE-13474.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13474] stripe compaction selection is not working well when includeL0==true</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13474</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;during selecting Hfiles for the Stripe Compaction,&lt;br/&gt;
If includeL0==true, int minFiles set to the number of allFiles in the stripe.&lt;br/&gt;
It make compaction for All of files in the stripe &lt;br/&gt;
or No compaction at all (which is the problem). &lt;/p&gt;

&lt;p&gt;the Stripe compaction uses exploring compaction inside.&lt;br/&gt;
some of HFiles in the stripe is too big, these all files are gonna never pass the ratio check&lt;br/&gt;
and compaction will be cancelled &lt;br/&gt;
next time the compaction is occurred, includeL0 will be true again. &lt;br/&gt;
so compactions (even minor compactions) will not happen almost forever.&lt;br/&gt;
Flushing makes more small HFiles and no compaction happening,&lt;br/&gt;
so numerous tiny HFiles are gonna file up in the stripe, and it&#8217;s going to be a problem.&lt;/p&gt;

&lt;p&gt;there is no such thing as major compaction in the stripe compaction.&lt;br/&gt;
But we need to compact every file of the stripe to drop deletes at some point.&lt;/p&gt;

&lt;p&gt;IMHO  there is not one stripe in the region, there are many.&lt;br/&gt;
when includeL0==true, compact all HFiles in the stripe without selecting is reasonable.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12821066">HBASE-13474</key>
            <summary>stripe compaction selection is not working well when includeL0==true</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="eomiks">jeongmin kim</assignee>
                                    <reporter username="eomiks">jeongmin kim</reporter>
                        <labels>
                    </labels>
                <created>Wed, 15 Apr 2015 06:20:11 +0000</created>
                <updated>Thu, 16 Apr 2015 15:11:51 +0000</updated>
                            <resolved>Thu, 16 Apr 2015 15:11:51 +0000</resolved>
                                    <version>1.0.1</version>
                    <version>0.98.12</version>
                                                    <component>Compaction</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="14496486" author="ndimiduk" created="Wed, 15 Apr 2015 16:41:17 +0000"  >&lt;p&gt;Is this something you&apos;ve seen in production &amp;#8211; lots of HFiles building up and never compacting down again?&lt;/p&gt;</comment>
                            <comment id="14497623" author="eomiks" created="Thu, 16 Apr 2015 06:35:34 +0000"  >&lt;p&gt;No, I have not seen it.&lt;br/&gt;
just I read codes to solve another problem, and it caught my eyes.&lt;/p&gt;

&lt;p&gt;I didn&apos;t demonstrate it, but i think as the size of the region is getting bigger, it&apos;s going to be happened.&lt;br/&gt;
(of course I may be wrong &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;  )&lt;/p&gt;

&lt;p&gt;includeL0 is going to be true until the compaction.&lt;br/&gt;
And the compaction is going to be cancelled until the ratio of Hfiles is appropriate.&lt;br/&gt;
But if one region is big &lt;br/&gt;
so, if a HFile is big (like 1G or over)&lt;br/&gt;
includeL0 makes to try all files to compact and it&apos;ll cancel.&lt;br/&gt;
flushes make a tiny Files that they can&apos;t compacted until the sum of it is big.&lt;/p&gt;

&lt;p&gt;    FileSize&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; &amp;lt;= Sum(0,N,FileSize(_)) - FileSize&lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/information.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ) * ratio &lt;br/&gt;
    if the fileSize is IG and ratio is 1.2(default),&lt;br/&gt;
    the sum of other files size have to be 850Mb.&lt;br/&gt;
    until that, there&apos;s no compaction on this region.&lt;/p&gt;
</comment>
                            <comment id="14498137" author="eomiks" created="Thu, 16 Apr 2015 15:11:34 +0000"  >&lt;p&gt;I checked about it again. and All was my misunderstanding.&lt;br/&gt;
If there&apos;s no stripes to compact, only L0 is compacted, &lt;br/&gt;
nothing&apos;s problem.&lt;/p&gt;

&lt;p&gt;It was my bad. sorry for the fuss. please close the issue.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12725496" name="HBASE-13474.patch" size="1153" author="eomiks" created="Wed, 15 Apr 2015 06:21:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 15 Apr 2015 16:41:17 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 35 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2d9nb:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>