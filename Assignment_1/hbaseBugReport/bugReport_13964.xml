<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:48:23 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-13964/HBASE-13964.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-13964] Skip region normalization for tables under namespace quota</title>
                <link>https://issues.apache.org/jira/browse/HBASE-13964</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;As &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt; pointed out in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13103&quot; title=&quot;[ergonomics] add region size balancing as a feature of master&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13103&quot;&gt;&lt;del&gt;HBASE-13103&lt;/del&gt;&lt;/a&gt;, we need to discuss how to normalize regions of tables under namespace control. What was proposed is to disable normalization of such tables.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12840303">HBASE-13964</key>
            <summary>Skip region normalization for tables under namespace quota</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="yuzhihong@gmail.com">Ted Yu</assignee>
                                    <reporter username="mantonov">Mikhail Antonov</reporter>
                        <labels>
                    </labels>
                <created>Wed, 24 Jun 2015 19:20:17 +0000</created>
                <updated>Tue, 30 Jun 2015 00:11:15 +0000</updated>
                            <resolved>Thu, 25 Jun 2015 10:36:12 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.2.0</fixVersion>
                    <fixVersion>1.3.0</fixVersion>
                                    <component>Balancer</component>
                    <component>Usability</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="14599988" author="mantonov" created="Wed, 24 Jun 2015 19:25:20 +0000"  >&lt;p&gt;Currently, all tables aren&apos;t normalized unless explicitly opted in, so to avoid normalization of such tables it&apos;d be enough to add a note in user/administration guide? Or would you propose to add an additional guard for that?&lt;/p&gt;

&lt;p&gt;Thinking more, intuitively it would look more natural to me if we had quotes based on some storage-level metrics, like total region size in bytes on HDFS, rather than disabling normalization on tables which are under namespace quota. Quotes are supposed to restrict and control allocation of environment resources, whereas region layout is more of internal thing which is supposed to be optimizable by HBase itself.&lt;/p&gt;

&lt;p&gt;Thoughts?&lt;/p&gt;

&lt;p&gt;(btw should we create component for normalization or should it stay under balancer?)&lt;/p&gt;</comment>
                            <comment id="14600000" author="ndimiduk" created="Wed, 24 Jun 2015 19:32:22 +0000"  >&lt;blockquote&gt;&lt;p&gt;btw should we create component for normalization or should it stay under balancer?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think balancer is fine for now as these systems are pretty related. If this thing becomes a beast it can be promoted to it&apos;s own component.&lt;/p&gt;</comment>
                            <comment id="14600177" author="yuzhihong@gmail.com" created="Wed, 24 Jun 2015 21:25:49 +0000"  >&lt;blockquote&gt;&lt;p&gt;would you propose to add an additional guard for that?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;See attached patch for the guard.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;based on some storage-level metrics, like total region size in bytes on HDFS&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think this is outside the scope of this JIRA since big change in Quota manager is involved.&lt;/p&gt;</comment>
                            <comment id="14600305" author="mantonov" created="Wed, 24 Jun 2015 22:50:40 +0000"  >&lt;p&gt;I assume table.getNamespaceAsString() never returns null, so we don&apos;t need to check before this call? I&apos;d add debug logging if table was rejected for this reason. +1 for the patch with logging.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;I think this is outside the scope of this JIRA since big change in Quota manager is involved.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I agree. Just wanted to gather feedback on this idea as possible further step.&lt;/p&gt;</comment>
                            <comment id="14600307" author="hadoopqa" created="Wed, 24 Jun 2015 22:51:21 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12741702/13964-v1.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12741702/13964-v1.txt&lt;/a&gt;&lt;br/&gt;
  against master branch at commit 2df3236a4eee48bf723213a7c4ff3d29c832c8cf.&lt;br/&gt;
  ATTACHMENT ID: 12741702&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 patch&lt;/font&gt;.  The patch command could not apply the patch.&lt;/p&gt;

&lt;p&gt;Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14554//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14554//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14600336" author="yuzhihong@gmail.com" created="Wed, 24 Jun 2015 23:05:37 +0000"  >&lt;p&gt;The patch was generated against branch-1.&lt;/p&gt;

&lt;p&gt;The null check is on NamespaceTableAndRegionInfo returned from getState().&lt;/p&gt;</comment>
                            <comment id="14600348" author="mantonov" created="Wed, 24 Jun 2015 23:13:06 +0000"  >&lt;p&gt;I meant &quot;do we need to check param for null before we call #getState&quot;,  looks like we don&apos;t. Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt;, +1.&lt;/p&gt;</comment>
                            <comment id="14600497" author="hadoopqa" created="Thu, 25 Jun 2015 01:18:56 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12741724/13964-branch-1-v2.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12741724/13964-branch-1-v2.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit 2df3236a4eee48bf723213a7c4ff3d29c832c8cf.&lt;br/&gt;
  ATTACHMENT ID: 12741724&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;                &lt;font color=&quot;red&quot;&gt;-1 checkstyle&lt;/font&gt;.  The applied patch generated 3830 checkstyle errors (more than the master&apos;s current 3829 errors).&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.master.normalizer.TestSimpleRegionNormalizerOnCluster&lt;br/&gt;
                  org.apache.hadoop.hbase.TestRegionRebalancing&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 7 zombie test(s): 	at org.apache.hadoop.hbase.client.TestRestoreSnapshotFromClient.testRestoreSnapshot(TestRestoreSnapshotFromClient.java:161)&lt;br/&gt;
	at org.apache.hadoop.hbase.util.TestHBaseFsck.testQuarantineMissingRegionDir(TestHBaseFsck.java:2230)&lt;br/&gt;
	at org.apache.hadoop.hbase.client.TestFromClientSide.testListTables(TestFromClientSide.java:4109)&lt;br/&gt;
	at org.apache.hadoop.hbase.regionserver.TestAtomicOperation.testRowMutationMultiThreads(TestAtomicOperation.java:397)&lt;br/&gt;
	at org.apache.hadoop.hbase.client.TestAdmin1.testForceSplit(TestAdmin1.java:953)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14555//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14555//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14555//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14555//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14555//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14555//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;                Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14555//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14555//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14600787" author="hadoopqa" created="Thu, 25 Jun 2015 06:47:24 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12741780/13964-branch-1-v3.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12741780/13964-branch-1-v3.txt&lt;/a&gt;&lt;br/&gt;
  against branch-1 branch at commit 2df3236a4eee48bf723213a7c4ff3d29c832c8cf.&lt;br/&gt;
  ATTACHMENT ID: 12741780&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.7.0)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.mapreduce.TestImportExport&lt;br/&gt;
                  org.apache.hadoop.hbase.util.TestProcessBasedCluster&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14560//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14560//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14560//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14560//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14560//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14560//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/14560//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/14560//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14600955" author="ashish singhi" created="Thu, 25 Jun 2015 10:06:03 +0000"  >&lt;p&gt;+1(non-binding)&lt;br/&gt;
Minor nits (Your call whether to not fix or fix it on commit):&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&quot;Skipping normalizing &quot;&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can we explicitly tell in the log that we are skipping region normalizing ?&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;quotaManager.getNamespaceQuotaManager() &lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Can we extract it to a local variable ?&lt;/p&gt;</comment>
                            <comment id="14600969" author="yuzhihong@gmail.com" created="Thu, 25 Jun 2015 10:25:10 +0000"  >&lt;blockquote&gt;&lt;p&gt;that we are skipping region normalizing&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The log I added is consistent with existing log w.r.t. system table.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Can we extract it to a local variable ?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I thought about this. Even if we do that, the null check must be made. So there is not much saving.&lt;/p&gt;</comment>
                            <comment id="14600971" author="ashish singhi" created="Thu, 25 Jun 2015 10:31:12 +0000"  >&lt;blockquote&gt;&lt;p&gt;I thought about this. Even if we do that, the null check must be made. So there is not much saving.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes null check must be made, suppose if it is not null then we call again quotaManager.getNamespaceQuotaManager() which can be save one extra call for each enabled table in the cluster. But again as you said &quot;there is not much saving&quot;, so I am ok with as it is also.&lt;/p&gt;</comment>
                            <comment id="14600978" author="yuzhihong@gmail.com" created="Thu, 25 Jun 2015 10:36:12 +0000"  >&lt;p&gt;Thanks for the reviews, Mikhail and Ashish.&lt;/p&gt;</comment>
                            <comment id="14600979" author="mantonov" created="Thu, 25 Jun 2015 10:37:57 +0000"  >&lt;p&gt;Yeah, speaking of the savings.. I didn&apos;t do any profiling, but I&apos;m fairly certain that cost of extra calls here is negligible compared to time of actual split/merge for any real-world regions &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; so I wouldn&apos;t worry about it now.&lt;/p&gt;</comment>
                            <comment id="14600980" author="mantonov" created="Thu, 25 Jun 2015 10:38:41 +0000"  >&lt;p&gt;Thanks &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt;!&lt;/p&gt;</comment>
                            <comment id="14601076" author="hudson" created="Thu, 25 Jun 2015 11:51:47 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #6601 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/6601/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/6601/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13964&quot; title=&quot;Skip region normalization for tables under namespace quota&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13964&quot;&gt;&lt;del&gt;HBASE-13964&lt;/del&gt;&lt;/a&gt; Skip region normalization for tables under namespace quota (tedyu: rev edef3d64bce41fffbc5649ffa19b2cf80ce28d7a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/namespace/NamespaceAuditor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14601113" author="hudson" created="Thu, 25 Jun 2015 12:54:06 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2 #31 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2/31/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2/31/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13964&quot; title=&quot;Skip region normalization for tables under namespace quota&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13964&quot;&gt;&lt;del&gt;HBASE-13964&lt;/del&gt;&lt;/a&gt; Skip region normalization for tables under namespace quota (tedyu: rev c680e2f40927407a0699b0b1ce687867bc2bb398)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/namespace/NamespaceAuditor.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14601201" author="hudson" created="Thu, 25 Jun 2015 13:39:19 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.3 #17 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3/17/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3/17/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13964&quot; title=&quot;Skip region normalization for tables under namespace quota&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13964&quot;&gt;&lt;del&gt;HBASE-13964&lt;/del&gt;&lt;/a&gt; Skip region normalization for tables under namespace quota (tedyu: rev ed72fa212875814f7e44eebaf7789710ec670c6a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/namespace/NamespaceAuditor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14601212" author="hudson" created="Thu, 25 Jun 2015 13:45:10 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.2-IT #21 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.2-IT/21/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.2-IT/21/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13964&quot; title=&quot;Skip region normalization for tables under namespace quota&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13964&quot;&gt;&lt;del&gt;HBASE-13964&lt;/del&gt;&lt;/a&gt; Skip region normalization for tables under namespace quota (tedyu: rev c680e2f40927407a0699b0b1ce687867bc2bb398)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/namespace/NamespaceAuditor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14601239" author="hudson" created="Thu, 25 Jun 2015 14:00:16 +0000"  >&lt;p&gt;SUCCESS: Integrated in HBase-1.3-IT #6 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.3-IT/6/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.3-IT/6/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13964&quot; title=&quot;Skip region normalization for tables under namespace quota&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13964&quot;&gt;&lt;del&gt;HBASE-13964&lt;/del&gt;&lt;/a&gt; Skip region normalization for tables under namespace quota (tedyu: rev ed72fa212875814f7e44eebaf7789710ec670c6a)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/namespace/NamespaceAuditor.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14603191" author="yuzhihong@gmail.com" created="Fri, 26 Jun 2015 17:00:09 +0000"  >&lt;p&gt;Thinking more on this subject, region merge should be allowed even if namespace quota is enforced.&lt;br/&gt;
I have a patch which does the following:&lt;br/&gt;
1. introduce enum NormalizationPlan.PlanType for split and merge&lt;br/&gt;
1. in HMaster#normalizeRegions(), pass List of NormalizationPlan.PlanType&apos;s which are allowed for the table. When namespace quota is enforced, the List contains PlanType.MERGE&lt;br/&gt;
1. in SimpleRegionNormalizer#computePlanForTable(), adhere to the List of NormalizationPlan.PlanType&apos;s which are allowed.&lt;/p&gt;

&lt;p&gt;If the above sounds reasonable, I can open a new JIRA and attach my patch there.&lt;/p&gt;</comment>
                            <comment id="14603993" author="ashish singhi" created="Sat, 27 Jun 2015 05:39:45 +0000"  >&lt;blockquote&gt;&lt;p&gt;Thinking more on this subject, region merge should be allowed even if namespace quota is enforced.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We can do this but I feel better we avoid region normalization completely when regions quota is set on a namepsace rather than support it during region merge and not during region split.&lt;/p&gt;</comment>
                            <comment id="14604229" author="yuzhihong@gmail.com" created="Sat, 27 Jun 2015 16:23:16 +0000"  >&lt;p&gt;I see.&lt;br/&gt;
Let&apos;s wait till we hear some feedback from users who enable namespace quota on how normalization should be done.&lt;/p&gt;</comment>
                            <comment id="14604417" author="yuzhihong@gmail.com" created="Sat, 27 Jun 2015 23:13:23 +0000"  >&lt;p&gt;It seems metadata associated with split / merge requests would allow server side to distinguish between the ones initiated by normalizer vs. the ones triggered through other means.&lt;br/&gt;
As long as the net effect of splitting / merging initiated by normalizer doesn&apos;t increase the number of regions, normalization should be allowed when namespace quota is in effect.&lt;/p&gt;</comment>
                            <comment id="14605282" author="mantonov" created="Mon, 29 Jun 2015 08:33:51 +0000"  >&lt;p&gt;I think that we don&apos;t really have justification for not allowing merging of regions in quota-enabled namespaces, as merge never results in namespace quota violation, so this is a useful improvement to have. And merging of bunch of small regions was mentioned as a valid usecase before.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt; in earlier version of patch where we introduced region normalization I had the enum with &lt;/p&gt;
{merge,split}
&lt;p&gt; operation types, but then it was removed after reviews as perception was we don&apos;t really need this.. I&apos;m thinking we may not need this enum, as we already pass table name in region normalizer, and there&apos;s MasterServices field there. So we should be able to call MS#getMasterQuotaManager() inside normalizer and find out if there&apos;re quotas on the namespace the region belongs to, then we don&apos;t issue split plan if that&apos;s the case. What do you think (maybe I&apos;m missing something)? Also with this approach I assume we would pass all enabled tables to normalizer?&lt;/p&gt;

&lt;p&gt;Hm. I&apos;m not sure why do we need to distinguish between split/merge requests issues by normalizer vs. issued by end user?&lt;/p&gt;
</comment>
                            <comment id="14605294" author="mantonov" created="Mon, 29 Jun 2015 08:44:17 +0000"  >&lt;p&gt;While thinking more on that, I &apos;m back to name vs space based quotas (maybe we should move this to dev lists though?)&lt;/p&gt;

&lt;p&gt;Like in HDFS there&apos;s name (# of inodes) and space (# of bytes) quotas. Bytes are resources in terms of underlying storage, inodes are resources in terms of space in fsimage (I assume, please correct me if I&apos;m wrong). In HBase we have quotas on # of tables and regions, which are resources from assignment manager throughput viewpoint, and indirect limit of storage space used (can&apos;t eat up more than # of regions X max region size). &lt;/p&gt;

&lt;p&gt;On the other hand, we could just set quota in bytes directly, and allow any split/merges to happen, since it can be considered that user is limited in the amount of data he/she could store in HBase, but the layout of this data is (optionally) optimized and controlled by HBase itself, so we may not want direct limit of # of regions.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;tedyu@apache.org&quot;&gt;Ted Yu&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ndimiduk&quot; class=&quot;user-hover&quot; rel=&quot;ndimiduk&quot;&gt;Nick Dimiduk&lt;/a&gt; - thoughts?&lt;/p&gt;</comment>
                            <comment id="14606687" author="ndimiduk" created="Mon, 29 Jun 2015 23:58:40 +0000"  >&lt;p&gt;Quota support was apparently added with &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-8410&quot; title=&quot;Basic quota support for namespaces&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-8410&quot;&gt;&lt;del&gt;HBASE-8410&lt;/del&gt;&lt;/a&gt;. I don&apos;t know the reason for enforcing a number of regions, through I assume this is because a multi-tenent cluster with a single namespace per user/group would not was a single namespace consuming all available region count capacity. Maybe &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=toffer&quot; class=&quot;user-hover&quot; rel=&quot;toffer&quot;&gt;Francis Liu&lt;/a&gt; can fill us in on this?&lt;/p&gt;

&lt;p&gt;That said, I think we can leave normalization enabled even when quotas are in place. The normalizer will work toward the optimal physical partitioning of data until it reaches the limits enforced by the quota policies. After this point, it will not be able to make any further progress when that progress requires splitting regions. I think it&apos;s the job of the normalization strategy to take quota restrictions into account. IMHO, a well-behaved normalizer would remove the need for namespace region # quotas entirely.&lt;/p&gt;

&lt;p&gt;I don&apos;t really follow why this change is necessary.&lt;/p&gt;</comment>
                            <comment id="14606709" author="mantonov" created="Tue, 30 Jun 2015 00:11:15 +0000"  >&lt;p&gt;Hm. I think we may need more feedback from real users using quota-enabled namespaces.. Agree that ideally with proper tuned normalization strategy one shouldn&apos;t  need region #-based quotas.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12777641">HBASE-13103</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12741724" name="13964-branch-1-v2.txt" size="1928" author="yuzhihong@gmail.com" created="Wed, 24 Jun 2015 23:06:33 +0000"/>
                            <attachment id="12741780" name="13964-branch-1-v3.txt" size="2451" author="yuzhihong@gmail.com" created="Thu, 25 Jun 2015 03:53:43 +0000"/>
                            <attachment id="12741702" name="13964-v1.txt" size="1838" author="yuzhihong@gmail.com" created="Wed, 24 Jun 2015 21:24:12 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>3.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 24 Jun 2015 19:32:22 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 24 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2ggaf:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>