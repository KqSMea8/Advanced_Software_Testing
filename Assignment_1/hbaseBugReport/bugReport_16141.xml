<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:10:43 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-16141/HBASE-16141.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-16141] Unwind use of UserGroupInformation.doAs() to convey requester identity in coprocessor upcalls</title>
                <link>https://issues.apache.org/jira/browse/HBASE-16141</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;In discussion on &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-16115&quot; title=&quot;Missing security context in RegionObserver coprocessor when a compaction/split is triggered manually&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-16115&quot;&gt;&lt;del&gt;HBASE-16115&lt;/del&gt;&lt;/a&gt;, there is some discussion of whether UserGroupInformation.doAs() is the right mechanism for propagating the original requester&apos;s identify in certain system contexts (splits, compactions, some procedure calls).  It has the unfortunately of overriding the current user, which makes for very confusing semantics for coprocessor implementors.  We should instead find an alternate mechanism for conveying the caller identity, which does not override the current user context.&lt;/p&gt;

&lt;p&gt;I think we should instead look at passing this through as part of the ObserverContext passed to every coprocessor hook.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12984773">HBASE-16141</key>
            <summary>Unwind use of UserGroupInformation.doAs() to convey requester identity in coprocessor upcalls</summary>
                <type id="4" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/improvement.png">Improvement</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="ghelmling">Gary Helmling</assignee>
                                    <reporter username="ghelmling">Gary Helmling</reporter>
                        <labels>
                    </labels>
                <created>Wed, 29 Jun 2016 05:24:52 +0000</created>
                <updated>Sun, 10 Jul 2016 00:06:07 +0000</updated>
                                                            <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>Coprocessors</component>
                    <component>security</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                                                            <comments>
                            <comment id="15354738" author="anoop.hbase" created="Wed, 29 Jun 2016 07:39:14 +0000"  >&lt;p&gt;So all the CP hooks will run under system user&apos;s identity?  &lt;br/&gt;
Previous issue was that some of the CP hooks were called with system identity as those were calls from Master to RS.   But most of the hooks around read write etc are getting called under user identity only.&lt;br/&gt;
+1 for passing the end user identity via ObserverContext.&lt;/p&gt;</comment>
                            <comment id="15355677" author="lhofhansl" created="Wed, 29 Jun 2016 19:11:16 +0000"  >&lt;p&gt;I think it&apos;s fine to have &quot;system hooks&quot; run with the system user (compactions, flushes, splits, etc), whereas get/scan/etc hooks need to be run on behalf of the calling user. Seems saner that way - but I wonder if that would be more confusing.&lt;/p&gt;</comment>
                            <comment id="15355713" author="apurtell" created="Wed, 29 Jun 2016 19:29:55 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think it&apos;s fine to have &quot;system hooks&quot; run with the system user (compactions, flushes, splits, etc), whereas get/scan/etc hooks need to be run on behalf of the calling user. &lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think Gary is suggesting we make every hook run in the context of the system user (User.runAsLoginUser()), even the RPC upcalls, and pass the request user through in context or thread local. That&apos;s a significant departure from earlier semantics but is very easy to reason about. We wouldn&apos;t have to sprinkle doAs() blocks through the code as we refactor in an attempt to keep effective user consistent as we decouple actions, make them asynchronous, or procedures, or ... &lt;/p&gt;</comment>
                            <comment id="15355790" author="ghelmling" created="Wed, 29 Jun 2016 21:15:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;I think Gary is suggesting we make every hook run in the context of the system user (User.runAsLoginUser()), even the RPC upcalls, and pass the request user through in context or thread local.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, that&apos;s correct.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;That&apos;s a significant departure from earlier semantics but is very easy to reason about. We wouldn&apos;t have to sprinkle doAs() blocks through the code as we refactor in an attempt to keep effective user consistent as we decouple actions, make them asynchronous, or procedures, or ...&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Could you guys comment a little more about this?  I don&apos;t think we&apos;ve ever used doAs() in the context of the RPC upcalls.  There the user identity is passed through using the RpcServer.CurCall thread local.  User.getCurrent() should always be returning the system user in those contexts.&lt;/p&gt;

&lt;p&gt;So I don&apos;t see this as a departure from earlier semantics, but rather as a return to them and overall simplification from the doAs() approach.  Am I missing something here?&lt;/p&gt;</comment>
                            <comment id="15355834" author="apurtell" created="Wed, 29 Jun 2016 21:33:42 +0000"  >&lt;blockquote&gt;&lt;p&gt;I don&apos;t think we&apos;ve ever used doAs() in the context of the RPC upcalls. There the user identity is passed through using the RpcServer.CurCall thread local.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Yes, you&apos;re right. &lt;br/&gt;
Some cognitive bug in my case, I guess.&lt;/p&gt;</comment>
                            <comment id="15369215" author="apurtell" created="Sat, 9 Jul 2016 17:46:28 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ghelmling&quot; class=&quot;user-hover&quot; rel=&quot;ghelmling&quot;&gt;Gary Helmling&lt;/a&gt; I see you&apos;ve assigned this to yourself but I am motivated to do it after &lt;a href=&quot;https://issues.apache.org/jira/browse/PHOENIX-3037&quot; title=&quot;Setup proper security context in compaction/split coprocessor hooks&quot; class=&quot;issue-link&quot; data-issue-key=&quot;PHOENIX-3037&quot;&gt;&lt;del&gt;PHOENIX-3037&lt;/del&gt;&lt;/a&gt; FWIW&lt;/p&gt;</comment>
                            <comment id="15369358" author="ghelmling" created="Sun, 10 Jul 2016 00:06:07 +0000"  >&lt;p&gt;I have a patch already in the works. Will try to wrap it up and post for review on Monday.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12983200">HBASE-16115</issuekey>
        </issuelink>
            <issuelink>
            <issuekey id="12984752">PHOENIX-3037</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                            <subtask id="12988878">HBASE-16217</subtask>
                            <subtask id="12988879">HBASE-16218</subtask>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 29 Jun 2016 07:39:14 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            22 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i30amn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>