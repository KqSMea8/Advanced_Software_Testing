<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:54:10 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-14549/HBASE-14549.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-14549] Simplify scanner stack reset logic</title>
                <link>https://issues.apache.org/jira/browse/HBASE-14549</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Looking at the code, I find that the logic is unnecessarily complex.&lt;br/&gt;
We indicate in updateReaders that the scanner stack needs to be reset. Then almost all store scanner (and derived classes) methods need to check and actually reset the scanner stack.&lt;br/&gt;
Compaction are rare, we should reset the scanner stack in update readers, and hence avoid needing to check in all methods.&lt;/p&gt;

&lt;p&gt;Patch forthcoming.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12902292">HBASE-14549</key>
            <summary>Simplify scanner stack reset logic</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="lhofhansl">Lars Hofhansl</assignee>
                                    <reporter username="lhofhansl">Lars Hofhansl</reporter>
                        <labels>
                    </labels>
                <created>Sun, 4 Oct 2015 04:47:54 +0000</created>
                <updated>Mon, 18 Jul 2016 21:30:26 +0000</updated>
                            <resolved>Mon, 18 Jul 2016 09:18:52 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="14942555" author="lhofhansl" created="Sun, 4 Oct 2015 04:52:19 +0000"  >&lt;p&gt;Patch for 0.98.&lt;/p&gt;

&lt;p&gt;Simply does away with checkReseek and the requirement to call it in scanner methods, instead inlines the logic in updateReaders.&lt;br/&gt;
There&apos;s no performance benefit from this. It simply places the logic where it belong, improving readability and possibly making it easier to change the logic (for example &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-13082&quot; title=&quot;Coarsen StoreScanner locks to RegionScanner&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-13082&quot;&gt;&lt;del&gt;HBASE-13082&lt;/del&gt;&lt;/a&gt;) in the future as it is all in one place.&lt;/p&gt;</comment>
                            <comment id="14942557" author="lhofhansl" created="Sun, 4 Oct 2015 04:57:01 +0000"  >&lt;p&gt;TestAtomicOperation passes multiple runs (it mixes flushes and compaction with active scanning)&lt;/p&gt;</comment>
                            <comment id="14942825" author="lhofhansl" created="Sun, 4 Oct 2015 22:03:30 +0000"  >&lt;p&gt;There is a slight performance improvement too.&lt;/p&gt;</comment>
                            <comment id="14942827" author="stack" created="Sun, 4 Oct 2015 22:04:04 +0000"  >&lt;p&gt;Not sure I understand but +1 on the change given this basis (smile). I&apos;d think if you&apos;ve broken something, it&apos;ll show in a test run. Let me submit.&lt;/p&gt;</comment>
                            <comment id="14942829" author="stack" created="Sun, 4 Oct 2015 22:04:55 +0000"  >&lt;p&gt;I looked a bit more... patch makes more sense now. +1 again if hadoopqa likes it.&lt;/p&gt;</comment>
                            <comment id="14942848" author="hadoopqa" created="Sun, 4 Oct 2015 23:08:21 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12764925/14549-0.98.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12764925/14549-0.98.txt&lt;/a&gt;&lt;br/&gt;
  against 0.98 branch at commit 19045a5ea759392b5a6b8bd8001a3dd9dd5245fe.&lt;br/&gt;
  ATTACHMENT ID: 12764925&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 tests included&lt;/font&gt;.  The patch doesn&apos;t appear to include any new or modified tests.&lt;br/&gt;
                        Please justify why no new tests are needed for this patch.&lt;br/&gt;
                        Also please list what manual steps were performed to verify this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 hadoop versions&lt;/font&gt;. The patch compiles with all supported hadoop versions (2.4.0 2.4.1 2.5.0 2.5.1 2.5.2 2.6.0 2.6.1 2.7.0 2.7.1)&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 protoc&lt;/font&gt;.  The applied patch does not increase the total number of protoc compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 28 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 checkstyle&lt;/font&gt;.  The applied patch does not increase the total number of checkstyle errors&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any  new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn post-site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestScanner&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15871//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15871//testReport/&lt;/a&gt;&lt;br/&gt;
Release Findbugs (version 2.0.3) 	warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15871//artifact/patchprocess/newFindbugsWarnings.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15871//artifact/patchprocess/newFindbugsWarnings.html&lt;/a&gt;&lt;br/&gt;
Checkstyle Errors: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15871//artifact/patchprocess/checkstyle-aggregate.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15871//artifact/patchprocess/checkstyle-aggregate.html&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;  Javadoc warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15871//artifact/patchprocess/patchJavadocWarnings.txt&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15871//artifact/patchprocess/patchJavadocWarnings.txt&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/15871//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/15871//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14942862" author="lhofhansl" created="Sun, 4 Oct 2015 23:37:41 +0000"  >&lt;p&gt;TestScanner looks very relevant. Looking.,&lt;/p&gt;</comment>
                            <comment id="14942865" author="lhofhansl" created="Sun, 4 Oct 2015 23:52:46 +0000"  >&lt;p&gt;Hmm... Yes, not quite right, although I do not understand why, yet.&lt;/p&gt;</comment>
                            <comment id="14942867" author="lhofhansl" created="Mon, 5 Oct 2015 00:04:39 +0000"  >&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5121&quot; title=&quot;MajorCompaction may affect scan&amp;#39;s correctness&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5121&quot;&gt;&lt;del&gt;HBASE-5121&lt;/del&gt;&lt;/a&gt; (and my &lt;em&gt;own&lt;/em&gt; suggestion to simplify fix there &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; ).&lt;/p&gt;</comment>
                            <comment id="14942876" author="lhofhansl" created="Mon, 5 Oct 2015 01:05:58 +0000"  >&lt;p&gt;Thanks for keeping me honest &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt; &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14946279" author="lhofhansl" created="Wed, 7 Oct 2015 05:25:21 +0000"  >&lt;p&gt;Looking more at &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-5121&quot; title=&quot;MajorCompaction may affect scan&amp;#39;s correctness&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-5121&quot;&gt;&lt;del&gt;HBASE-5121&lt;/del&gt;&lt;/a&gt;, I think I do not understand what the issue is. We&apos;re recreating the scanner heap, how can there be state left over from the prior scan. I think as soon as I understand that, I can fix this one and make it simpler.&lt;/p&gt;</comment>
                            <comment id="14951645" author="lhofhansl" created="Sat, 10 Oct 2015 06:31:36 +0000"  >&lt;p&gt;OK... I get it now. In KeyValueHeap we always have the top scanner removed from the heap and store in this.current.&lt;br/&gt;
In the case of a scanner stack reset, which used to be the top scanner may no longer be and we would have to put it back on the heap and pull a new top scanner out, but we have no way of knowing that.&lt;br/&gt;
I.e. the top StoreScanner in the RegionScanner&apos;s KeyValueHeap might have changed without notice.&lt;/p&gt;

&lt;p&gt;This all looks a bit brittle. What if &lt;em&gt;other&lt;/em&gt; StoreScanners (other than the top scanner) change their peek-element? We&apos;d have to remove and re-add to the RegionScanner&apos;s heap as well... I think. Seems the correct way would be to reset the RegionScanner stack whenever any of the stores have been compacted. That would also naturally coarsen the lock to RegionScanner, but the RegionScanner may not have all the information to reset all StoreScanners. Tricky...&lt;/p&gt;</comment>
                            <comment id="15383114" author="stack" created="Mon, 18 Jul 2016 21:30:26 +0000"  >&lt;p&gt;So, this stuff is no longer complex? Nothing to do based off your findings &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=lhofhansl&quot; class=&quot;user-hover&quot; rel=&quot;lhofhansl&quot;&gt;Lars Hofhansl&lt;/a&gt;?&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12764925" name="14549-0.98.txt" size="4794" author="lhofhansl" created="Sun, 4 Oct 2015 04:52:19 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sun, 4 Oct 2015 22:04:04 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            21 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i2mkif:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>