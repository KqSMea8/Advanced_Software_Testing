<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:48:15 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-7700/HBASE-7700.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-7700] TestColumnSeeking is mathematically bound to fail</title>
                <link>https://issues.apache.org/jira/browse/HBASE-7700</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;First I&apos;d like to say that TestColumnSeeking is a bad test. It&apos;s not documented, it&apos;s non-deterministic, it&apos;s 2 methods with almost the same code.&lt;/p&gt;

&lt;p&gt;So in each test it populates column lists this way:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; i = 0; i &amp;lt; numberOfTests; i++) {
      kvMaps[i] = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HashMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, KeyValue&amp;gt;();
      columnLists[i] = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ArrayList&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;();
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; column : allColumns) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-object&quot;&gt;Math&lt;/span&gt;.random() &amp;lt; selectPercent) {
          columnLists[i].add(column);
        }
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Since selectPercent is 50% and there are 10 columns, there&apos;s something like a 1/1024 chance that one of the column list ends up with 0 column. This is later mismanaged in the checks. First something like this will be printed out:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;2013-01-28 11:50:02,200 INFO  &lt;span class=&quot;error&quot;&gt;&amp;#91;pool-1-thread-1&amp;#93;&lt;/span&gt; regionserver.TestColumnSeeking(140): Columns: 0  Keys: 0&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Like it says, there&apos;s 0 columns so it couldn&apos;t add data. But then it still makes sure later that the data is there with this check:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
assertEquals(kvSet.size(), results.size());
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Do notice that the parameters are reversed, and here the results.size() will be 0 since there are 0 columns for this test.&lt;/p&gt;

&lt;p&gt;I see multiple ways to fix this:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Skip tests that have 0 columns&lt;/li&gt;
	&lt;li&gt;Change the randomness to at least have 1 column (like select 1 + 0..9 columns)&lt;/li&gt;
	&lt;li&gt;Redo the whole unit test to not rely on randomness&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12629603">HBASE-7700</key>
            <summary>TestColumnSeeking is mathematically bound to fail</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Mon, 28 Jan 2013 23:10:02 +0000</created>
                <updated>Sat, 23 Mar 2013 04:53:26 +0000</updated>
                            <resolved>Thu, 28 Feb 2013 23:05:43 +0000</resolved>
                                    <version>0.94.6</version>
                    <version>0.95.0</version>
                                    <fixVersion>0.98.0</fixVersion>
                    <fixVersion>0.94.6</fixVersion>
                    <fixVersion>0.95.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                <comments>
                            <comment id="13564820" author="jdcryans" created="Mon, 28 Jan 2013 23:12:33 +0000"  >&lt;p&gt;This patch implements the first fix aka lazy fix. It should not fail again with this.&lt;/p&gt;</comment>
                            <comment id="13564830" author="eclark" created="Mon, 28 Jan 2013 23:22:59 +0000"  >&lt;p&gt;+1&lt;/p&gt;

&lt;p&gt;We should probably come back and clean this test up some more so that it&apos;s a little more repeatable.  But good to fix flakey tests.&lt;/p&gt;</comment>
                            <comment id="13565595" author="ndimiduk" created="Tue, 29 Jan 2013 17:58:37 +0000"  >&lt;p&gt;I feel strongly that randomness has no business in unit tests. Reproducibility is critical when creating and evaluating these scenarios. Test with a collection containing data and then test with an empty collection.&lt;/p&gt;

&lt;p&gt;-1 for the lazyfix. Please strike the random.&lt;/p&gt;</comment>
                            <comment id="13565969" author="lhofhansl" created="Tue, 29 Jan 2013 23:35:57 +0000"  >&lt;p&gt;Moving to 0.94.6&lt;/p&gt;</comment>
                            <comment id="13566019" author="eclark" created="Wed, 30 Jan 2013 00:55:33 +0000"  >&lt;p&gt;Random is alright as long as it&apos;s repeatable.  QuickCheck and ScalaCheck like tools have saved me a number of times. Printing the seed of the pseudo random number generator should be enough to make any failures repeatable.&lt;/p&gt;</comment>
                            <comment id="13586749" author="lhofhansl" created="Tue, 26 Feb 2013 04:47:04 +0000"  >&lt;p&gt;+1 on patch. Randomness is fine as long as it is repeatable (as Elliot says) and we do not rely on any specific distribution.&lt;br/&gt;
This is a good short-term fix; I&apos;ll will commit this tomorrow, unless I hear a strong case against it.&lt;/p&gt;

&lt;p&gt;We can also file a followup issue to change/remove the randomness in favor of a different mechanism.&lt;/p&gt;</comment>
                            <comment id="13590022" author="lhofhansl" created="Thu, 28 Feb 2013 23:05:43 +0000"  >&lt;p&gt;Committed everywhere.&lt;br/&gt;
Nick, we should probably open another issue to fix is the right way.&lt;/p&gt;</comment>
                            <comment id="13590162" author="hudson" created="Fri, 1 Mar 2013 01:38:54 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #872 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/872/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/872/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7700&quot; title=&quot;TestColumnSeeking is mathematically bound to fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7700&quot;&gt;&lt;del&gt;HBASE-7700&lt;/del&gt;&lt;/a&gt; TestColumnSeeking is mathematically bound to fail (J-D) (Revision 1451418)&lt;/p&gt;

&lt;p&gt;     Result = SUCCESS&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestColumnSeeking.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13591770" author="hudson" created="Sun, 3 Mar 2013 15:41:07 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security #115 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security/115/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security/115/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7700&quot; title=&quot;TestColumnSeeking is mathematically bound to fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7700&quot;&gt;&lt;del&gt;HBASE-7700&lt;/del&gt;&lt;/a&gt; TestColumnSeeking is mathematically bound to fail (J-D) (Revision 1451418)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestColumnSeeking.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13593159" author="hudson" created="Tue, 5 Mar 2013 07:52:08 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #12 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/12/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/12/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-7700&quot; title=&quot;TestColumnSeeking is mathematically bound to fail&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-7700&quot;&gt;&lt;del&gt;HBASE-7700&lt;/del&gt;&lt;/a&gt; TestColumnSeeking is mathematically bound to fail (J-D) (Revision 1451418)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
larsh : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/test/java/org/apache/hadoop/hbase/regionserver/TestColumnSeeking.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12566847" name="HBASE-7700-0.94-lazyfix.patch" size="1085" author="jdcryans" created="Mon, 28 Jan 2013 23:12:33 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 28 Jan 2013 23:22:59 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310099</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 41 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1himv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>310444</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>