<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:22:03 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-4792/HBASE-4792.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-4792] SplitRegionHandler doesn&apos;t care if it deletes the znode or not, leaves the parent region stuck offline</title>
                <link>https://issues.apache.org/jira/browse/HBASE-4792</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Saw this on a little test cluster, really easy to trigger.&lt;/p&gt;

&lt;p&gt;First the master log:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2011-11-15 22:28:57,900 DEBUG org.apache.hadoop.hbase.master.handler.SplitRegionHandler: Handling SPLIT event for e5be6551c8584a6a1065466e520faf4e; deleting node&lt;br/&gt;
2011-11-15 22:28:57,900 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: master:62003-0x132f043bbde08c1 Deleting existing unassigned node for e5be6551c8584a6a1065466e520faf4e that is in expected state RS_ZK_REGION_SPLIT&lt;br/&gt;
2011-11-15 22:28:57,975 WARN org.apache.hadoop.hbase.zookeeper.ZKAssign: master:62003-0x132f043bbde08c1 Attempting to delete unassigned node in RS_ZK_REGION_SPLIT state but after verifying state, we got a version mismatch&lt;br/&gt;
2011-11-15 22:28:57,975 INFO org.apache.hadoop.hbase.master.handler.SplitRegionHandler: Handled SPLIT report); parent=TestTable,0001355346,1321396080924.e5be6551c8584a6a1065466e520faf4e. daughter a=TestTable,0001355346,1321396132414.df9b549eb594a1f8728608a2a431224a.daughter b=TestTable,0001368082,1321396132414.de861596db4337dc341138f26b9c8bc2.&lt;br/&gt;
...&lt;br/&gt;
2011-11-15 22:28:58,052 DEBUG org.apache.hadoop.hbase.master.AssignmentManager: Handling transition=RS_ZK_REGION_SPLIT, server=sv4r28s44,62023,1321395865619, region=e5be6551c8584a6a1065466e520faf4e&lt;br/&gt;
2011-11-15 22:28:58,052 WARN org.apache.hadoop.hbase.master.AssignmentManager: Region e5be6551c8584a6a1065466e520faf4e not found on server sv4r28s44,62023,1321395865619; failed processing&lt;br/&gt;
2011-11-15 22:28:58,052 WARN org.apache.hadoop.hbase.master.AssignmentManager: Received SPLIT for region e5be6551c8584a6a1065466e520faf4e from server sv4r28s44,62023,1321395865619 but it doesn&apos;t exist anymore, probably already processed its split&lt;br/&gt;
(repeated forever)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;The master processes the split but when it calls ZKAssign.deleteNode it doesn&apos;t check the boolean that&apos;s returned. In this case it was false. So for the master the split was completed, but for the region server it&apos;s another story:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;2011-11-15 22:28:57,661 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:62023-0x132f043bbde08d3 Attempting to transition node e5be6551c8584a6a1065466e520faf4e from RS_ZK_REGION_SPLITTING to RS_ZK_REGION_SPLIT&lt;br/&gt;
2011-11-15 22:28:57,775 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:62023-0x132f043bbde08d3 Successfully transitioned node e5be6551c8584a6a1065466e520faf4e from RS_ZK_REGION_SPLITTING to RS_ZK_REGION_SPLIT&lt;br/&gt;
2011-11-15 22:28:57,775 INFO org.apache.hadoop.hbase.regionserver.SplitTransaction: Still waiting on the master to process the split for e5be6551c8584a6a1065466e520faf4e&lt;br/&gt;
2011-11-15 22:28:57,876 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:62023-0x132f043bbde08d3 Attempting to transition node e5be6551c8584a6a1065466e520faf4e from RS_ZK_REGION_SPLIT to RS_ZK_REGION_SPLIT&lt;br/&gt;
2011-11-15 22:28:57,967 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:62023-0x132f043bbde08d3 Successfully transitioned node e5be6551c8584a6a1065466e520faf4e from RS_ZK_REGION_SPLIT to RS_ZK_REGION_SPLIT&lt;br/&gt;
2011-11-15 22:28:58,067 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:62023-0x132f043bbde08d3 Attempting to transition node e5be6551c8584a6a1065466e520faf4e from RS_ZK_REGION_SPLIT to RS_ZK_REGION_SPLIT&lt;br/&gt;
2011-11-15 22:28:58,108 DEBUG org.apache.hadoop.hbase.zookeeper.ZKAssign: regionserver:62023-0x132f043bbde08d3 Successfully transitioned node e5be6551c8584a6a1065466e520faf4e from RS_ZK_REGION_SPLIT to RS_ZK_REGION_SPLIT&lt;br/&gt;
(printed forever)&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Since the znode isn&apos;t really deleted, it thinks the master just haven&apos;t got to process its region thus waits which leaves the region &lt;b&gt;unavailable&lt;/b&gt;.&lt;/p&gt;

&lt;p&gt;We need to just retry the delete master-side ASAP since the RS will wait 100ms between retries.&lt;/p&gt;

&lt;p&gt;At the same time, it would be nice if ZKAssign.deleteNode always printed out the name of the region in its messages because it took me a while to see that the delete didn&apos;t take affect while looking at a grep.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12531550">HBASE-4792</key>
            <summary>SplitRegionHandler doesn&apos;t care if it deletes the znode or not, leaves the parent region stuck offline</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="jdcryans">Jean-Daniel Cryans</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Tue, 15 Nov 2011 23:26:24 +0000</created>
                <updated>Fri, 12 Oct 2012 05:34:50 +0000</updated>
                            <resolved>Wed, 16 Nov 2011 00:47:49 +0000</resolved>
                                    <version>0.92.0</version>
                                    <fixVersion>0.92.0</fixVersion>
                    <fixVersion>0.94.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="13150918" author="jdcryans" created="Wed, 16 Nov 2011 00:24:57 +0000"  >&lt;p&gt;Patch that does the fix I described and adds more info ZKAssign WARN logs.&lt;/p&gt;

&lt;p&gt;It probably needs a unit test.&lt;/p&gt;</comment>
                            <comment id="13150927" author="stack" created="Wed, 16 Nov 2011 00:33:29 +0000"  >&lt;p&gt;Looks good to me.  Just logging changes and looking at returned boolean.  Too small for unit test.  +1 on commit for 0.92.&lt;/p&gt;</comment>
                            <comment id="13150935" author="jdcryans" created="Wed, 16 Nov 2011 00:47:49 +0000"  >&lt;p&gt;Committed to branch and trunk, thanks for looking at my code Stack.&lt;/p&gt;</comment>
                            <comment id="13150944" author="yuzhihong@gmail.com" created="Wed, 16 Nov 2011 01:00:32 +0000"  >&lt;p&gt;A loop was introduced which doesn&apos;t have sleep().&lt;br/&gt;
Should we exit the loop after certain number of attempts (certain amount of time)?&lt;/p&gt;

&lt;p&gt;Also:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
   * @&lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; KeeperException.NoNodeException &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; node does not exist
   */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;boolean&lt;/span&gt; deleteNode(ZooKeeperWatcher zkw, &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; regionName,
      EventType expectedState)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;We should handle KeeperException.NoNodeException differently from other KeeperException&apos;s.&lt;/p&gt;</comment>
                            <comment id="13150948" author="jdcryans" created="Wed, 16 Nov 2011 01:05:26 +0000"  >&lt;p&gt;It mirrors what&apos;s done RS-side, there&apos;s no limit there either. We could fix that too if we want.&lt;/p&gt;

&lt;p&gt;The reason there&apos;s no sleep is because the RS is sleeping and we don&apos;t want to hit the same race another time.&lt;/p&gt;</comment>
                            <comment id="13151016" author="hudson" created="Wed, 16 Nov 2011 04:30:46 +0000"  >&lt;p&gt;Integrated in HBase-0.92 #134 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.92/134/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.92/134/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4792&quot; title=&quot;SplitRegionHandler doesn&amp;#39;t care if it deletes the znode or not, leaves the parent region stuck offline&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4792&quot;&gt;&lt;del&gt;HBASE-4792&lt;/del&gt;&lt;/a&gt;  SplitRegionHandler doesn&apos;t care if it deletes the znode or not,&lt;br/&gt;
               leaves the parent region stuck offline&lt;/p&gt;

&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.92/CHANGES.txt&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/master/handler/SplitRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/branches/0.92/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13151047" author="hudson" created="Wed, 16 Nov 2011 06:09:54 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #2445 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/2445/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/2445/&lt;/a&gt;)&lt;br/&gt;
    Adding the 0.92 entry for &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4792&quot; title=&quot;SplitRegionHandler doesn&amp;#39;t care if it deletes the znode or not, leaves the parent region stuck offline&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4792&quot;&gt;&lt;del&gt;HBASE-4792&lt;/del&gt;&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-4792&quot; title=&quot;SplitRegionHandler doesn&amp;#39;t care if it deletes the znode or not, leaves the parent region stuck offline&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-4792&quot;&gt;&lt;del&gt;HBASE-4792&lt;/del&gt;&lt;/a&gt;  SplitRegionHandler doesn&apos;t care if it deletes the znode or not,&lt;br/&gt;
               leaves the parent region stuck offline&lt;/p&gt;

&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/CHANGES.txt&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/master/handler/SplitRegionHandler.java&lt;/li&gt;
	&lt;li&gt;/hbase/trunk/src/main/java/org/apache/hadoop/hbase/zookeeper/ZKAssign.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12503818" name="HBASE-4792-0.92.patch" size="2175" author="jdcryans" created="Wed, 16 Nov 2011 00:24:57 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 16 Nov 2011 00:33:29 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>217286</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            5 years, 5 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i08ro7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>49083</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>