<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 18:42:30 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-253/HBASE-253.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-253] master stopping before regions finish stopping</title>
                <link>https://issues.apache.org/jira/browse/HBASE-253</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I get this on my region servers logs sometimes when I shutdown the cluster it repeats several times sometimes trying to find the master&lt;br/&gt;
I thank we need to look at the master and make sure we do not stop the master on exit before all region servers report down.&lt;/p&gt;

&lt;p&gt;I am not sure if there could be data loss or not but we should not leave region servers looking for the master unless it has failed on it own.&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;2008-01-18 17:40:42,009 WARN org.apache.hadoop.hbase.HRegionServer: Failed to send exiting message to master:
java.net.ConnectException: Connection refused
        at java.net.PlainSocketImpl.socketConnect(Native Method)
        at java.net.PlainSocketImpl.doConnect(PlainSocketImpl.java:333)
        at java.net.PlainSocketImpl.connectToAddress(PlainSocketImpl.java:195)
        at java.net.PlainSocketImpl.connect(PlainSocketImpl.java:182)
        at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:366)
        at java.net.Socket.connect(Socket.java:519)
        at org.apache.hadoop.ipc.Client$Connection.setupIOstreams(Client.java:159)
        at org.apache.hadoop.ipc.Client.getConnection(Client.java:575)
        at org.apache.hadoop.ipc.Client.call(Client.java:498)
        at org.apache.hadoop.hbase.ipc.HbaseRPC$Invoker.invoke(HbaseRPC.java:210)
        at $Proxy0.regionServerReport(Unknown Source)
        at org.apache.hadoop.hbase.HRegionServer.run(HRegionServer.java:898)
        at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.run(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:595)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12386657">HBASE-253</key>
            <summary>master stopping before regions finish stopping</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="6">Invalid</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="viper799">Billy Pearson</reporter>
                        <labels>
                    </labels>
                <created>Fri, 18 Jan 2008 23:51:30 +0000</created>
                <updated>Mon, 4 Feb 2008 18:41:21 +0000</updated>
                            <resolved>Mon, 21 Jan 2008 06:54:12 +0000</resolved>
                                                                        <due></due>
                            <votes>0</votes>
                                    <watches>0</watches>
                                                                <comments>
                            <comment id="12560610" author="viper799" created="Fri, 18 Jan 2008 23:54:22 +0000"  >&lt;p&gt;the only time I have seen this is when the stop-hbase.sh is ran and the region server have a 20 or so regions and have to do memcache flushes on most of the regions taking time to flush all regions and closing them.&lt;/p&gt;</comment>
                            <comment id="12560613" author="stack" created="Sat, 19 Jan 2008 00:07:55 +0000"  >&lt;p&gt;In the master log, what do you see? Its waiting and waiting and then just gives up after lease timeout because it says the regionservers are taking too long to report in?&lt;/p&gt;

&lt;p&gt;The code doesn&apos;t currently accomodate a regionserver that is taking its time going down because its busy running flushes and outstanding, etc.  It probably should (regionserver reports every so often to the master that its working on the close).&lt;/p&gt;

&lt;p&gt;There should be no data loss in this case (Regionservers are going down properly &amp;#8211; its just the final report in to the master that its down that is failing)&lt;/p&gt;</comment>
                            <comment id="12560620" author="viper799" created="Sat, 19 Jan 2008 00:22:02 +0000"  >&lt;p&gt;The server with the above WARN was 10.0.0.4&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
2008-01-18 17:39:37,239 INFO org.apache.hadoop.hbase.HMaster: Cluster shutdown requested. Starting to quiesce servers
2008-01-18 17:39:54,249 INFO org.apache.hadoop.hbase.HMaster: HMaster.rootScanner scanning meta region {regionname: -ROOT-,,0, startKey: &amp;lt;&amp;gt;, server: 10.0.0.4:60020}
2008-01-18 17:39:54,264 DEBUG org.apache.hadoop.hbase.HMaster: HMaster.rootScanner regioninfo: {regionname: .META.,,1, startKey: &amp;lt;&amp;gt;, endKey: &amp;lt;&amp;gt;, encodedName(1028785192) tableDesc: {name: .META., families: {info:={name: info, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}}}}, server: 10.0.0.3:60020, startCode: 1200691304598
2008-01-18 17:39:54,266 INFO org.apache.hadoop.hbase.HMaster: HMaster.rootScanner scan of meta region {regionname: -ROOT-,,0, startKey: &amp;lt;&amp;gt;, server: 10.0.0.4:60020} complete
2008-01-18 17:39:59,102 INFO org.apache.hadoop.hbase.HMaster: HMaster.metaScanner scanning meta region {regionname: .META.,,1, startKey: &amp;lt;&amp;gt;, server: 10.0.0.3:60020}
2008-01-18 17:39:59,132 DEBUG org.apache.hadoop.hbase.HMaster: HMaster.metaScanner regioninfo: {regionname: webdata,,1200625220917, startKey: &amp;lt;&amp;gt;, endKey: &amp;lt;au.org.acl.www/national/browse.stw?article_id=18842:http&amp;gt;, encodedName(1954097628) tableDesc: {name: webdata, families: {anchor:={name: anchor, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, first_seen:={name: first_seen, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, in_rank:={name: in_rank, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, last_seen:={name: last_seen, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, rank_total:={name: rank_total, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, rank_visual:={name: rank_visual, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, size:={name: size, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, source2:={name: source2, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, source:={name: source, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, stime:={name: stime, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}}}}, server: 10.0.0.4:60020, startCode: 1200691304484
..
remove lot of regioninfo: from meta scan
..

2008-01-18 17:39:59,278 DEBUG org.apache.hadoop.hbase.HMaster: HMaster.metaScanner regioninfo: {regionname: webdata,us.ashlee/component/option,com_weblinks/Itemid,4/:http,1200695516443, startKey: &amp;lt;us.ashlee/component/option,com_weblinks/Itemid,4/:http&amp;gt;, endKey: &amp;lt;&amp;gt;, encodedName(63818931) tableDesc: {name: webdata, families: {anchor:={name: anchor, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, first_seen:={name: first_seen, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, in_rank:={name: in_rank, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, last_seen:={name: last_seen, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, rank_total:={name: rank_total, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, rank_visual:={name: rank_visual, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, size:={name: size, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, source2:={name: source2, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, source:={name: source, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}, stime:={name: stime, max versions: 1, compression: NONE, in memory: &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;, max length: 2147483647, bloom filter: none}}}}, server: 10.0.0.2:60020, startCode: 1200691304075
2008-01-18 17:39:59,284 DEBUG org.apache.hadoop.hbase.HMaster: Checked webdata,com.espion-on-line.www/dossiers.htm:http,1200697196799 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; references: splitA: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, splitB: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2008-01-18 17:39:59,289 DEBUG org.apache.hadoop.hbase.HMaster: Checked webdata,com.diagonale-chute-libre.www/html/voyages.htm:http,1200695228115 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; references: splitA: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, splitB: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2008-01-18 17:39:59,294 DEBUG org.apache.hadoop.hbase.HMaster: Checked webdata,ca.supersites.compatibleintroductions/questionnaire/:http,1200618005435 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; references: splitA: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, splitB: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2008-01-18 17:39:59,313 DEBUG org.apache.hadoop.hbase.HMaster: webdata,com.eddiebonfigli.www/index2a.html:http,1200697196798 no longer has references to webdata,com.eddiebonfigli.www/index2a.html:http,1200617086404
2008-01-18 17:39:59,313 INFO org.apache.hadoop.hbase.HMaster: Deleting region webdata,com.eddiebonfigli.www/index2a.html:http,1200617086404 because daughter splits no longer hold references
2008-01-18 17:39:59,314 DEBUG org.apache.hadoop.hbase.HRegion: DELETING region hdfs:&lt;span class=&quot;code-comment&quot;&gt;//10.0.0.1:9000/gfs_storage/hadoop-root/hbase/webdata/2101627985
&lt;/span&gt;2008-01-18 17:39:59,925 DEBUG org.apache.hadoop.hbase.HMaster: Checked webdata,de.disc-fix/parking.php4?task=search&amp;amp;domain=disc-fix.de&amp;amp;s=5429b889900dd49c8824&amp;amp;conf_id=0&amp;amp;a_id=2&amp;amp;language=en&amp;amp;pgt=1VDyC9X12y4KEwirgdSI1OKQAhUJQWgKHboh_ggYACAAMIrwoAM4DQ&amp;amp;ags=2leZCbd6jukKEwirgdSI1OKQAhUJQWgKHboh_ggYAyAAMIrwoAM4DQ&amp;amp;pxy_t=254&amp;amp;start=1&amp;amp;add_c=5b1303ed4714dfb6e9a1bf98bc801db7&amp;amp;keyword=Internet&amp;amp;pos=6&amp;amp;sub=1:http,1200697045811 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; references: splitA: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, splitB: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2008-01-18 17:39:59,931 DEBUG org.apache.hadoop.hbase.HMaster: Checked webdata,com.americas-fair.www/newsletter.php:http,1200697093033 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; references: splitA: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, splitB: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2008-01-18 17:39:59,935 DEBUG org.apache.hadoop.hbase.HMaster: Checked webdata,com.flickr.www/photos/tigerfur:http,1200617086405 &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; references: splitA: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;, splitB: &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt;
2008-01-18 17:39:59,946 INFO org.apache.hadoop.hbase.HMaster: HMaster.metaScanner scan of meta region {regionname: .META.,,1, startKey: &amp;lt;&amp;gt;, server: 10.0.0.3:60020} complete
2008-01-18 17:39:59,946 INFO org.apache.hadoop.hbase.HMaster: all meta regions scanned
2008-01-18 17:40:19,243 INFO org.apache.hadoop.hbase.Leases: HMaster.leaseChecker lease expired 1481598689/1481598689
2008-01-18 17:40:19,243 INFO org.apache.hadoop.hbase.HMaster: 10.0.0.2:60020 lease expired
2008-01-18 17:40:21,467 INFO org.apache.hadoop.hbase.Leases: HMaster.leaseChecker lease expired -1038361245/-1038361245
2008-01-18 17:40:21,493 INFO org.apache.hadoop.hbase.HMaster: 10.0.0.4:60020 lease expired
2008-01-18 17:40:21,734 INFO org.apache.hadoop.hbase.Leases: HMaster.leaseChecker lease expired -1925864926/-1925864926
2008-01-18 17:40:21,734 INFO org.apache.hadoop.hbase.HMaster: 10.0.0.3:60020 lease expired
2008-01-18 17:40:21,735 INFO org.apache.hadoop.hbase.Leases: HMaster.leaseChecker lease expired 594095008/594095008
2008-01-18 17:40:21,735 INFO org.apache.hadoop.hbase.HMaster: 10.0.0.1:60020 lease expired
2008-01-18 17:40:22,278 DEBUG org.apache.hadoop.hbase.HMaster: telling root scanner to stop
2008-01-18 17:40:22,278 DEBUG org.apache.hadoop.hbase.HMaster: telling meta scanner to stop
2008-01-18 17:40:22,278 DEBUG org.apache.hadoop.hbase.HMaster: meta and root scanners notified
2008-01-18 17:40:22,279 DEBUG org.apache.hadoop.hbase.HMaster: telling root scanner to stop
2008-01-18 17:40:22,279 INFO org.apache.hadoop.hbase.HMaster$RootScanner: HMaster.rootScanner exiting
2008-01-18 17:40:22,279 INFO org.apache.hadoop.hbase.HMaster$MetaScanner: HMaster.metaScanner exiting
2008-01-18 17:40:22,279 DEBUG org.apache.hadoop.hbase.HMaster: telling meta scanner to stop
2008-01-18 17:40:22,280 DEBUG org.apache.hadoop.hbase.HMaster: meta and root scanners notified
2008-01-18 17:40:22,280 INFO org.apache.hadoop.hbase.HMaster: Stopping infoServer
2008-01-18 17:40:22,620 INFO org.mortbay.util.ThreadedServer: Stopping Acceptor ServerSocket[addr=0.0.0.0/0.0.0.0,port=0,localport=60010]
2008-01-18 17:40:22,874 INFO org.mortbay.http.SocketListener: Stopped SocketListener on 0.0.0.0:60010
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="12560632" author="stack" created="Sat, 19 Jan 2008 01:29:46 +0000"  >&lt;p&gt;So, things are working &apos;properly&apos;. Master waits on each region to either report its closed or until the regionserver&apos;s lease times out.  When either has happened for all servers, then it goes down.  On regionserver side, it results in ugly exception because its trying to talk to a master long gone.  Its retrying to connect?  In this shutdown case it probably shouldn&apos;t run the retries.  It should just exit on the first failure-to-connect..  Let this issue be about disabling retries in this shutdown case and possibly make the exception thrown a little sweeter (though its pretty spot-on as is).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Sat, 19 Jan 2008 00:07:55 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>25037</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            8 years, 48 weeks, 6 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0h5wn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>98219</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>