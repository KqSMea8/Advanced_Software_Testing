<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:36:35 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6418/HBASE-6418.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6418] Minor bug in delete flow.</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6418</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Timestamp updation in Delete flow is not considering all flavors (Delete record, Delete Family, Delete Column) of Delete API. Currently its considering Delete Record only. &lt;/p&gt;

&lt;p&gt;org.apache.hadoop.hbase.regionserver.HRegion.prepareDeleteTimestamps(Delete, byte[])&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
      &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (KeyValue kv: kvs) {
        &lt;span class=&quot;code-comment&quot;&gt;//  Check &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; time is LATEST, change to time of most recent addition &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; so
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;//  This is expensive.
&lt;/span&gt;        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (kv.isLatestTimestamp() &amp;amp;&amp;amp; kv.isDeleteType()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Basically used a wrong API.&lt;br/&gt;
kv.isDeleteType() should be KeyValue.isDelete(type);&lt;/p&gt;</description>
                <environment></environment>
        <key id="12599216">HBASE-6418</key>
            <summary>Minor bug in delete flow.</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="8">Not A Problem</resolution>
                                        <assignee username="lakshman">Laxman</assignee>
                                    <reporter username="lakshman">Laxman</reporter>
                        <labels>
                    </labels>
                <created>Wed, 18 Jul 2012 04:09:23 +0000</created>
                <updated>Wed, 25 Jul 2012 03:55:43 +0000</updated>
                            <resolved>Wed, 25 Jul 2012 03:55:43 +0000</resolved>
                                    <version>0.94.0</version>
                    <version>0.94.1</version>
                    <version>0.94.2</version>
                    <version>0.95.2</version>
                                                        <due></due>
                            <votes>0</votes>
                                    <watches>8</watches>
                                                                <comments>
                            <comment id="13416893" author="lhofhansl" created="Wed, 18 Jul 2012 06:19:00 +0000"  >&lt;p&gt;Are you sure Laxman?&lt;br/&gt;
This logic only needs to be done for version delete markers (not column or family markers).&lt;br/&gt;
kv.isDeleteType() is only true to version delete markers. KeyValue.isDelete(type) would be true for all delete markers.&lt;/p&gt;

&lt;p&gt;I think it is correct the way it is.&lt;/p&gt;</comment>
                            <comment id="13416939" author="anoopsamjohn" created="Wed, 18 Jul 2012 08:27:43 +0000"  >&lt;blockquote&gt;&lt;p&gt;This logic only needs to be done for version delete markers (not column or family markers).&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;You mean in the delete column family we can not say only some older versions need to be deleted?&lt;br/&gt;
In Delete&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
/**
   * Delete all columns of the specified family with a timestamp less than
   * or equal to the specified timestamp.
   * &amp;lt;p&amp;gt;
   * Overrides previous calls to deleteColumn and deleteColumns &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; the
   * specified family.
   * @param family family name
   * @param timestamp maximum version timestamp
   * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; invocation chaining
   */
  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; Delete deleteFamily(&lt;span class=&quot;code-object&quot;&gt;byte&lt;/span&gt; [] family, &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; timestamp) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is Delete family which tells a timestamp also. So all KVs older than this time in that family should get deleted right?&lt;/p&gt;

&lt;p&gt;As per the code in prepareDeleteTimestamps&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (kv.isLatestTimestamp() &amp;amp;&amp;amp; kv.isDeleteType()) {
....
} &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
  kv.updateLatestStamp(byteNow);
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here KV is type DeleteFamily but I have some specific timestamp. Still we will change the timestamp to the cur time! This is wrong?&lt;/p&gt;

&lt;p&gt;Pls correct me if I am wrong Lars. I am not familiar with the delete.&lt;/p&gt;</comment>
                            <comment id="13416956" author="anoopsamjohn" created="Wed, 18 Jul 2012 09:17:32 +0000"  >&lt;p&gt;Doing some testing on this delete API with diff types of Deletes. &lt;br/&gt;
KeyValue#updateLatestStamp() is having check for avoid setting the passed TS when the TS is not Latest TS&lt;/p&gt;</comment>
                            <comment id="13416959" author="anoopsamjohn" created="Wed, 18 Jul 2012 09:34:54 +0000"  >&lt;p&gt;@Laxman&lt;br/&gt;
Seems fine. I am inline with Lars after more code study and testing.&lt;br/&gt;
Delete type will be used only when deleteColumn(byte [] family, byte [] qualifier, long timestamp) is used.[deleteColumn(byte [] family, byte [] qualifier) also]&lt;br/&gt;
This is just one version deletion&lt;br/&gt;
There only need to get the cell value and find the TS.&lt;br/&gt;
Else in all other types of deletes, need to set either the TS specified by user of the cur time at RS&lt;/p&gt;</comment>
                            <comment id="13417130" author="stack" created="Wed, 18 Jul 2012 14:41:18 +0000"  >&lt;p&gt;Assuming the mighty @Laxman comes over to Anoop and Lars&apos; way of thinking, is there anything we can do to make it so others don&apos;t think the same?  Can we add code comment, a unit test, or update doc somewhere so we avoid others having same (mis)understanding?  Anoop, any of your testing that could go in as a unit test?  Attach here and I can commit.&lt;/p&gt;</comment>
                            <comment id="13417146" author="lhofhansl" created="Wed, 18 Jul 2012 14:57:50 +0000"  >&lt;p&gt;It was late yesterday so I was terse.&lt;br/&gt;
This is (partially) documented in Delete.java.&lt;/p&gt;

&lt;p&gt;Version delete markers are bit strange to begin with. They let you target a specific version of a specific column of a specific column family (of a specific row). It&apos;s makes little sense to talk about the current time for those. That is why there is this special logic to either target a version of your choosing or the latest version.&lt;br/&gt;
Column or Family should be using the current time unless a time is specified... As is done right now.&lt;/p&gt;

&lt;p&gt;A comment to that extend in the server code would not hurt. &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I&apos;m happy to make a simple patch.&lt;/p&gt;</comment>
                            <comment id="13417156" author="stack" created="Wed, 18 Jul 2012 15:18:12 +0000"  >&lt;p&gt;It worries me if likes of a Laxman gets confused over this so I think the comment&apos;d be great Mr Hofhansl.&lt;/p&gt;</comment>
                            <comment id="13418089" author="lakshman" created="Thu, 19 Jul 2012 05:51:45 +0000"  >&lt;p&gt;@Lars &amp;amp; Anoop, thanks for clarifying.&lt;/p&gt;

&lt;p&gt;Honestly I didn&apos;t go through the existing doc as well. While walking thru the code flow, it looked a bit strange.&lt;/p&gt;

&lt;p&gt;Apologies for the noise.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 18 Jul 2012 06:19:00 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>245320</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 22 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i067sn:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>34194</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>