<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:09:02 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-3295/HBASE-3295.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-3295] Dropping a 1k+ regions table likely ends in a client socket timeout and it&apos;s very confusing</title>
                <link>https://issues.apache.org/jira/browse/HBASE-3295</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;I tried truncating a 1.6k regions table from the shell and, after the usual disabling timeout, I then got a socket timeout on the second invocation while it was dropping. It looked like this:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR: java.net.SocketTimeoutException: Call to sv2borg180/10.20.20.180:61000 failed on socket timeout exception:
 java.net.SocketTimeoutException: 60000 millis timeout while waiting for channel to be ready for read. ch :
 java.nio.channels.SocketChannel[connected local=/10.20.20.180:59153 remote=sv2borg180/10.20.20.180:61000]
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At first I thought that was coming from the master because HDFS was somehow slow, but then understood that it was my socket that timed out meaning that the master was still dropping the table. Calling truncate again, I got:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;ERROR: Unknown table TestTable!
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Which means that the table would be deleted... I learned later that it wasn&apos;t totally deleted after I shut down the cluster. So it leaves me in a situation where I have to manually delete the files on the FS and the remaining .META. entries.&lt;/p&gt;

&lt;p&gt;Since I expect a few people will hit this issue rather soon, for 0.90.0, I propose we just set the socket timeout really high in the shell. For 0.90.1, or 0.92, we should do for drop what we do for disabling.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12491803">HBASE-3295</key>
            <summary>Dropping a 1k+ regions table likely ends in a client socket timeout and it&apos;s very confusing</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="stack">stack</assignee>
                                    <reporter username="jdcryans">Jean-Daniel Cryans</reporter>
                        <labels>
                    </labels>
                <created>Wed, 1 Dec 2010 19:29:09 +0000</created>
                <updated>Fri, 20 Nov 2015 12:42:00 +0000</updated>
                            <resolved>Thu, 2 Dec 2010 18:50:03 +0000</resolved>
                                                    <fixVersion>0.90.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>1</watches>
                                                                <comments>
                            <comment id="12965815" author="streamy" created="Wed, 1 Dec 2010 19:37:54 +0000"  >&lt;p&gt;This is basically the same as &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3229&quot; title=&quot;Table creation, though using &amp;quot;async&amp;quot; call to master, can actually run for a while and cause RPC timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3229&quot;&gt;&lt;del&gt;HBASE-3229&lt;/del&gt;&lt;/a&gt; (except there it&apos;s only troubling, the operation does seem to succeed).  My opinion is that all operations that hit the master should be async (or fast).  create/enable/disable/drop/etc should be async w/ another method to check the status.  we shouldn&apos;t have long running operations holding open rpc requests.&lt;/p&gt;</comment>
                            <comment id="12965817" author="stack" created="Wed, 1 Dec 2010 19:39:13 +0000"  >&lt;p&gt;This one-line change should do it.&lt;/p&gt;

&lt;p&gt;It makes deleteTable async over on master.&lt;/p&gt;

&lt;p&gt;In HBaseAdmin, the current code sends the deleteTable to the master then spins waiting on all entries in .META. to disappear.  The deleteTable was synchronous.  With this change the deleteTable is now async.... so we should be spinning client-side rather than server-side.  Should get rid of the socket timeout.&lt;/p&gt;</comment>
                            <comment id="12965819" author="jdcryans" created="Wed, 1 Dec 2010 19:43:45 +0000"  >&lt;p&gt;@Jon, you&apos;re right.&lt;/p&gt;</comment>
                            <comment id="12966002" author="stack" created="Thu, 2 Dec 2010 06:33:42 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-3229&quot; title=&quot;Table creation, though using &amp;quot;async&amp;quot; call to master, can actually run for a while and cause RPC timeout&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-3229&quot;&gt;&lt;del&gt;HBASE-3229&lt;/del&gt;&lt;/a&gt; is actually a little different in that as its currently written all is run from the master.&lt;/p&gt;

&lt;p&gt;Also, here&apos;s v2 of patch.  There is a tension in the shell in that most of the retries and timesouts are tuned down because its expected that there is a human waiting but these enable/disable/drops can take a long time.  v2 ups amount of time we&apos;ll wait on these enable/disable/drop operations (as well as including the v1 change to make drop run async).&lt;/p&gt;

&lt;p&gt;If we do time out, then it should be fine just rerunning the operation &amp;#8211; truncate in this case.  If not, then thats a bug... a different bug than this.&lt;/p&gt;</comment>
                            <comment id="12966033" author="larsgeorge" created="Thu, 2 Dec 2010 09:25:12 +0000"  >&lt;p&gt;I like the async plus proper communication to user that they have to poll for the status - some sort of queued or async task list. I have found many reasons to press CTRL+c while waiting for a disable or drop just to mess up things. Ideally that could be build into the shell, i.e. it sends the command async and then polls the state while printing out &quot;.&quot; on the command line to report it is waiting still. Once the async command has succeeded it reports so and exists the loop.&lt;/p&gt;</comment>
                            <comment id="12966053" author="larsgeorge" created="Thu, 2 Dec 2010 10:29:34 +0000"  >&lt;p&gt;Sorry Stack, did not see your earlier comment. If that client side spin works then that is what I meant.&lt;/p&gt;</comment>
                            <comment id="12966220" author="jdcryans" created="Thu, 2 Dec 2010 18:28:44 +0000"  >&lt;p&gt;The patch doesn&apos;t compile because there&apos;s a typo:&lt;/p&gt;

&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+    for (int tries = 0; tries &amp;lt; (this.numRetries * this.retryLongerMultiplier); tries++) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After that it works. +1&lt;/p&gt;</comment>
                            <comment id="12966225" author="stack" created="Thu, 2 Dec 2010 18:37:33 +0000"  >&lt;p&gt;@Lars There are new additions to the shell is_enabled and is_disabled... so ctrl-c and it&apos;ll interrupt the client-side wait at least of disable, enable and drop.&lt;/p&gt;</comment>
                            <comment id="12966230" author="stack" created="Thu, 2 Dec 2010 18:50:03 +0000"  >&lt;p&gt;Thanks for reviews lads.  Committed branch and trunk.&lt;/p&gt;</comment>
                            <comment id="15017132" author="lars_francke" created="Fri, 20 Nov 2015 12:42:00 +0000"  >&lt;p&gt;This issue was closed as part of a bulk closing operation on 2015-11-20. All issues that have been resolved and where all fixVersions have been released have been closed (following discussions on the mailing list).&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12465107" name="3295-v2.txt" size="3226" author="stack" created="Thu, 2 Dec 2010 06:33:42 +0000"/>
                            <attachment id="12465062" name="3295.txt" size="611" author="stack" created="Wed, 1 Dec 2010 19:39:13 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 1 Dec 2010 19:37:54 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>26766</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 4 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0hlm7:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>100764</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>