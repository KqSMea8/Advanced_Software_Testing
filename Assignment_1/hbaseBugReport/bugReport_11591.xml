<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:24:41 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11591/HBASE-11591.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11591] Scanner fails to retrieve KV  from bulk loaded file with highest sequence id than the cell&apos;s mvcc in a non-bulk loaded file</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11591</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;See discussion in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11339&quot; title=&quot;HBase MOB&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11339&quot;&gt;&lt;del&gt;HBASE-11339&lt;/del&gt;&lt;/a&gt;.&lt;br/&gt;
When we have a case where there are same KVs in two files one produced by flush/compaction and the other thro the bulk load.&lt;br/&gt;
Both the files have some same kvs which matches even in timestamp.&lt;br/&gt;
Steps:&lt;br/&gt;
Add some rows with a specific timestamp and flush the same.  &lt;br/&gt;
Bulk load a file with the same data.. Enusre that &quot;assign seqnum&quot; property is set.&lt;br/&gt;
The bulk load should use HFileOutputFormat2 (or ensure that we write the bulk_time_output key).&lt;br/&gt;
This would ensure that the bulk loaded file has the highest seq num.&lt;br/&gt;
Assume the cell in the flushed/compacted store file is &lt;br/&gt;
row1,cf,cq,ts1, value1  and the cell in the bulk loaded file is&lt;br/&gt;
row1,cf,cq,ts1,value2 &lt;br/&gt;
(There are no parallel scans).&lt;br/&gt;
Issue a scan on the table in 0.96. The retrieved value is row1,cf1,cq,ts1,value2&lt;br/&gt;
But the same in 0.98 will retrieve row1,cf1,cq,ts2,value1. &lt;br/&gt;
This is a behaviour change.  This is because of this code &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compare(KeyValueScanner left, KeyValueScanner right) {
      &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; comparison = compare(left.peek(), right.peek());
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (comparison != 0) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; comparison;
      } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
        &lt;span class=&quot;code-comment&quot;&gt;// Since both the keys are exactly the same, we &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt; the tie in favor
&lt;/span&gt;        &lt;span class=&quot;code-comment&quot;&gt;// of the key which came latest.
&lt;/span&gt;        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; leftSequenceID = left.getSequenceID();
        &lt;span class=&quot;code-object&quot;&gt;long&lt;/span&gt; rightSequenceID = right.getSequenceID();
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (leftSequenceID &amp;gt; rightSequenceID) {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; -1;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (leftSequenceID &amp;lt; rightSequenceID) {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 1;
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; 0;
        }
      }
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here  in 0.96 case the mvcc of the cell in both the files will have 0 and so the comparison will happen from the else condition .  Where the seq id of the bulk loaded file is greater and would sort out first ensuring that the scan happens from that bulk loaded file.&lt;br/&gt;
In case of 0.98+ as we are retaining the mvcc+seqid we are not making the mvcc as 0 (remains a non zero positive value).  Hence the compare() sorts out the cell in the flushed/compacted file.  Which means though we know the lateset file is the bulk loaded file we don&apos;t scan the data.&lt;br/&gt;
Seems to be a behaviour change.  Will check on other corner cases also but we are trying to know the behaviour of bulk load because we are evaluating if it can be used for MOB design.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12729762">HBASE-11591</key>
            <summary>Scanner fails to retrieve KV  from bulk loaded file with highest sequence id than the cell&apos;s mvcc in a non-bulk loaded file</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="2" iconUrl="https://issues.apache.org/jira/images/icons/priorities/critical.png">Critical</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ram_krish">ramkrishna.s.vasudevan</assignee>
                                    <reporter username="ram_krish">ramkrishna.s.vasudevan</reporter>
                        <labels>
                    </labels>
                <created>Fri, 25 Jul 2014 16:29:52 +0000</created>
                <updated>Sat, 21 Feb 2015 23:33:30 +0000</updated>
                            <resolved>Tue, 26 Aug 2014 12:09:27 +0000</resolved>
                                    <version>0.99.0</version>
                    <version>2.0.0</version>
                                    <fixVersion>0.99.0</fixVersion>
                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>14</watches>
                                                                <comments>
                            <comment id="14074549" author="ram_krish" created="Fri, 25 Jul 2014 16:41:04 +0000"  >&lt;p&gt;Use this testcase in 0.98/trunk and 0.96.  For running in 0.96 pls comment out the line&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HFileContext context = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HFileContext();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and change &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HFile.Writer writer = wf.withPath(fs, path).withFileContext(context).create();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;to &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
HFile.Writer writer = wf.withPath(fs, path).create();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14074880" author="apurtell" created="Fri, 25 Jul 2014 20:44:12 +0000"  >&lt;p&gt;Making critical for .5. It seems to me we should be respecting the file level sequence in 0.98 as we did in 0.96, and not doing so is a bulk loading bug. Feel free to adjust priority downward if you disagree.&lt;/p&gt;</comment>
                            <comment id="14075380" author="ram_krish" created="Sat, 26 Jul 2014 13:25:05 +0000"  >&lt;p&gt;Removing fix versions as 0.98+ as this problem does not exist there. Sorry for specifying the wrong version  and the false alarm on 0.98.&lt;br/&gt;
Thanks to Ted for the heads up in this.&lt;/p&gt;</comment>
                            <comment id="14075423" author="apurtell" created="Sat, 26 Jul 2014 16:15:34 +0000"  >&lt;p&gt;Thanks for the clarification!&lt;/p&gt;</comment>
                            <comment id="14076936" author="ram_krish" created="Mon, 28 Jul 2014 21:43:49 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stack&quot; class=&quot;user-hover&quot; rel=&quot;stack&quot;&gt;stack&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;&lt;br/&gt;
Want to take a look at this?  Should the KVScannerComparator take into consideration before comparing the cell, whether the cell comes from a bulk loaded file?&lt;/p&gt;</comment>
                            <comment id="14077290" author="jeffreyz" created="Tue, 29 Jul 2014 02:14:59 +0000"  >&lt;p&gt;I think this can be solved when reading bulk load hfiles, we can use current hfile sequenceId as its KVs&apos; mvcc values.  The other option is to add a new metadata into hfile as default mvcc value for situations like bulk loaded hfiles. Thanks.&lt;/p&gt;</comment>
                            <comment id="14077389" author="ram_krish" created="Tue, 29 Jul 2014 04:56:38 +0000"  >&lt;blockquote&gt;&lt;p&gt;we can use current hfile sequenceId as its KVs&apos; mvcc values.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ya this is what I too felt. But to do that we  may need to add some methods and ensure that the KeyValueHeap is of type StoreFileScanner and the reader on that is of bulk loaded file.&lt;br/&gt;
 Will post a patch soon.&lt;/p&gt;</comment>
                            <comment id="14080232" author="ram_krish" created="Wed, 30 Jul 2014 23:50:56 +0000"  >&lt;p&gt;Attaching a patch to get feedback.  Checking on some more corner cases.  &lt;/p&gt;</comment>
                            <comment id="14080367" author="hadoopqa" created="Thu, 31 Jul 2014 01:25:33 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12658788/HBASE-11591.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12658788/HBASE-11591.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12658788&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 7 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.TestEndToEndSplitTransaction&lt;br/&gt;
                  org.apache.hadoop.hbase.migration.TestNamespaceUpgrade&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestScannerWithBulkload&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestMasterOperationsForRegionReplicas&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.TestRegionReplicas&lt;br/&gt;
                  org.apache.hadoop.hbase.mapreduce.TestImportTSVWithVisibilityLabels&lt;br/&gt;
                  org.apache.hadoop.hbase.client.TestReplicasClient&lt;br/&gt;
                  org.apache.hadoop.hbase.master.TestRestartCluster&lt;br/&gt;
                  org.apache.hadoop.hbase.TestIOFencing&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): &lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10236//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14080547" author="ram_krish" created="Thu, 31 Jul 2014 06:08:47 +0000"  >&lt;p&gt;Not sure on other test cases failures but the new test case added TestScannerWithBulkLoad fails here&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void checkScanOrder(Cell prevKV, Cell kv,
      KeyValue.KVComparator comparator) &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
    &lt;span class=&quot;code-comment&quot;&gt;// Check that the heap gives us KVs in an increasing order.
&lt;/span&gt;    &lt;span class=&quot;code-keyword&quot;&gt;assert&lt;/span&gt; prevKV == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || comparator == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;
        || comparator.compare(prevKV, kv) &amp;lt;= 0 : &lt;span class=&quot;code-quote&quot;&gt;&quot;Key &quot;&lt;/span&gt; + prevKV
        + &lt;span class=&quot;code-quote&quot;&gt;&quot; followed by a &quot;&lt;/span&gt; + &lt;span class=&quot;code-quote&quot;&gt;&quot;smaller key &quot;&lt;/span&gt; + kv + &lt;span class=&quot;code-quote&quot;&gt;&quot; in cf &quot;&lt;/span&gt; + store;
  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So can we remove that assertion?  This change is becoming trickier.&lt;/p&gt;</comment>
                            <comment id="14080548" author="ram_krish" created="Thu, 31 Jul 2014 06:09:11 +0000"  >&lt;p&gt;Other test case seems to fail on some env issues.&lt;/p&gt;</comment>
                            <comment id="14080549" author="ram_krish" created="Thu, 31 Jul 2014 06:10:22 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Error: java.lang.NullPointerException
	at org.apache.hadoop.hbase.mapreduce.LabelExpander.getLabelOrdinals(LabelExpander.java:129)
	at org.apache.hadoop.hbase.mapreduce.LabelExpander.getLabelOrdinals(LabelExpander.java:145)
	at org.apache.hadoop.hbase.mapreduce.LabelExpander.createVisibilityTags(LabelExpander.java:105)
	at org.apache.hadoop.hbase.mapreduce.LabelExpander.createKVFromCellVisibilityExpr(LabelExpander.java:217)
	at org.apache.hadoop.hbase.mapreduce.TsvImporterMapper.createPuts(TsvImporterMapper.java:195)
	at org.apache.hadoop.hbase.mapreduce.TsvImporterMapper.map(TsvImporterMapper.java:153)
	at org.apache.hadoop.hbase.mapreduce.TsvImporterMapper.map(TsvImporterMapper.java:39)
	at org.apache.hadoop.mapreduce.Mapper.run(Mapper.java:145)
	at org.apache.hadoop.mapred.MapTask.runNewMapper(MapTask.java:764)
	at org.apache.hadoop.mapred.MapTask.run(MapTask.java:340)
	at org.apache.hadoop.mapred.YarnChild$2.run(YarnChild.java:167)
	at java.security.AccessController.doPrivileged(Native Method)
	at javax.security.auth.Subject.doAs(Subject.java:415)
	at org.apache.hadoop.security.UserGroupInformation.doAs(UserGroupInformation.java:1548)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14095928" author="ram_krish" created="Wed, 13 Aug 2014 18:54:20 +0000"  >&lt;p&gt;Any thoughts here?&lt;/p&gt;</comment>
                            <comment id="14096324" author="jeffreyz" created="Wed, 13 Aug 2014 23:58:43 +0000"  >&lt;p&gt;The patch looks good to me(+1)! Basically it restores old behavior for bulk loaded files by treating all KVs involved with mvcc==0.  Thanks.&lt;/p&gt;</comment>
                            <comment id="14098186" author="ram_krish" created="Fri, 15 Aug 2014 05:22:30 +0000"  >&lt;p&gt;Yes logically right.  But the thing is in this case it is retrieving a kv which is smaller than the previous KV just because of the mvcc of the bulk loaded file.  Should we rewrite the KV before sending it to the StoreScanner layer so that the kv comparison works fine? &lt;/p&gt;</comment>
                            <comment id="14099346" author="jeffreyz" created="Fri, 15 Aug 2014 23:36:34 +0000"  >&lt;blockquote&gt;
&lt;p&gt;Should we rewrite the KV before sending it to the StoreScanner layer so that the kv comparison works fine?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;We can set mvcc(now the function name is setSequenceId()) when reading KVs from bulk loaded hfiles using hfile&apos;s sequence Id. This way is cleaner and can solve the issue that a new hfile may contain some KVs without mvcc when compacting a normal hfile with a bulk loaded hfile.&lt;/p&gt;</comment>
                            <comment id="14099642" author="hadoopqa" created="Sat, 16 Aug 2014 13:54:52 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12662280/HBASE-11591_1.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12662280/HBASE-11591_1.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12662280&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 7 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.coprocessor.TestBigDecimalColumnInterpreter&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestMasterObserver&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableSnapshotInputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestDoubleColumnInterpreter&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestRegionServerCoprocessorExceptionWithRemove&lt;br/&gt;
                  org.apache.hadoop.hbase.replication.regionserver.TestReplicationSink&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestMasterCoprocessorExceptionWithRemove&lt;br/&gt;
                  org.apache.hadoop.hbase.io.encoding.TestLoadAndSwitchEncodeOnDisk&lt;br/&gt;
                  org.apache.hadoop.hbase.mapred.TestTableInputFormat&lt;br/&gt;
                  org.apache.hadoop.hbase.io.hfile.TestHFileBlock&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestHTableWrapper&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestCoprocessorEndpoint&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestRowProcessorEndpoint&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestRegionServerObserver&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestClassLoading&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestOpenTableInCoprocessor&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestRegionServerCoprocessorExceptionWithAbort&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestBatchCoprocessorEndpoint&lt;br/&gt;
                  org.apache.hadoop.hbase.TestGlobalMemStoreSize&lt;br/&gt;
                  org.apache.hadoop.hbase.TestRegionRebalancing&lt;br/&gt;
                  org.apache.hadoop.hbase.TestIOFencing&lt;br/&gt;
                  org.apache.hadoop.hbase.zookeeper.TestZooKeeperACL&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestRegionObserverBypass&lt;br/&gt;
                  org.apache.hadoop.hbase.coprocessor.TestAggregateProtocol&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 4 zombie test(s): 	at org.apache.hadoop.hbase.io.hfile.TestScannerSelectionUsingTTL.testScannerSelection(TestScannerSelectionUsingTTL.java:128)&lt;br/&gt;
	at org.apache.hadoop.hbase.io.encoding.TestEncodedSeekers.testEncodedSeeker(TestEncodedSeekers.java:117)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10468//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14100274" author="ram_krish" created="Mon, 18 Aug 2014 04:49:53 +0000"  >&lt;p&gt;All the test case issues has this &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
Caused by: java.lang.OutOfMemoryError: unable to create &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;native&lt;/span&gt; thread
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.start0(Native Method)
	at java.lang.&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.start(&lt;span class=&quot;code-object&quot;&gt;Thread&lt;/span&gt;.java:713)
	at org.mortbay.thread.QueuedThreadPool.newThread(QueuedThreadPool.java:462)
	at org.mortbay.thread.QueuedThreadPool.doStart(QueuedThreadPool.java:403)
	at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)
	at org.mortbay.jetty.Server.doStart(Server.java:218)
	at org.mortbay.component.AbstractLifeCycle.start(AbstractLifeCycle.java:50)
	at org.apache.hadoop.hbase.http.HttpServer.start(HttpServer.java:949)
	at org.apache.hadoop.hbase.http.InfoServer.start(InfoServer.java:78)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.putUpWebUI(HRegionServer.java:1602)
	at org.apache.hadoop.hbase.regionserver.HRegionServer.&amp;lt;init&amp;gt;(HRegionServer.java:520)
	at org.apache.hadoop.hbase.MiniHBaseCluster$MiniHBaseClusterRegionServer.&amp;lt;init&amp;gt;(MiniHBaseCluster.java:115)
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14100286" author="ram_krish" created="Mon, 18 Aug 2014 05:17:09 +0000"  >&lt;p&gt;All the failed tests are passing.  Let me rerun once again for HadoopQA. &lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;&lt;br/&gt;
Uses kv.setSequenceId() here.  Pls have a look.  But setting the seqId on the read path would prevent us from using Cell based impl because Cell does not have it. For now it is fine.&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=apurtell&quot; class=&quot;user-hover&quot; rel=&quot;apurtell&quot;&gt;Andrew Purtell&lt;/a&gt;,&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;&lt;br/&gt;
Want to have a look at this?&lt;/p&gt;</comment>
                            <comment id="14100310" author="anoop.hbase" created="Mon, 18 Aug 2014 06:01:07 +0000"  >&lt;p&gt;Sure. Some quick comments after a glance at the patch&lt;/p&gt;

&lt;p&gt;isBulkLoadResult -&amp;gt;  isBulkLoaded()?   For setter also?&lt;br/&gt;
I see this isBulkLoadResult () in StoreFile.java level also. I would have been better to know this status from StoreFile rather than from StoreFileReader.&lt;/p&gt;

&lt;p&gt;Also what abt compacting a flush file and a bulk loaded one?  Will we have issues then? This patch will handle that also?  Mind adding tests around that also.&lt;/p&gt;

&lt;p&gt;compareWithoutMvcc(Cell left, Cell right)&lt;br/&gt;
Now we have deprecated *mvcc () methods. Suggest change in name here also.&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;// TODO : While doing cells this is should be avoided in the read path.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;IMHO we should not do this KeyValueUtil.ensureKeyValue() stuff from now. (In read path mainly) In near future we  will want Cells in read path. How we can solve this particular issue then? (We can not add setter in Cell.java I believe)  Or do we need an extension interface for Cell &lt;b&gt;in server side&lt;/b&gt; which is having the setter?&lt;/p&gt;

&lt;p&gt;Doing a deeper look Ram. Sorry for being late.&lt;/p&gt;</comment>
                            <comment id="14100361" author="anoop.hbase" created="Mon, 18 Aug 2014 07:06:39 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+          &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(bulkLoad) {
+            &lt;span class=&quot;code-comment&quot;&gt;// TODO : While doing cells &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; is should be avoided in the read path.
&lt;/span&gt;+            KeyValue leftKV = KeyValueUtil.ensureKeyValue(left.peek());
+            KeyValue rightKV = KeyValueUtil.ensureKeyValue(right.peek());
+            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(leftKV.getSequenceId() == 0) {
+              leftKV.setSequenceId(rightKV.getSequenceId());
+            } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
+              rightKV.setSequenceId(leftKV.getSequenceId());
+            }
+          }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So what do we do here Ram? &lt;br/&gt;
I think we need to set KV seqId for KVs, from bulk loaded file, to the file seqId (which we get from that file name).  So instead of this set seqId of one KV to other (which looks hacky IMO)  can we do the set by the seqId of the file?&lt;/p&gt;</comment>
                            <comment id="14100372" author="hadoopqa" created="Mon, 18 Aug 2014 07:15:14 +0000"  >&lt;p&gt;&lt;font color=&quot;green&quot;&gt;+1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12662425/HBASE-11591_2.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12662425/HBASE-11591_2.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12662425&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 7 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 core tests&lt;/font&gt;.  The patch passed unit tests in .&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10473//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14100384" author="ram_krish" created="Mon, 18 Aug 2014 07:24:21 +0000"  >&lt;p&gt;I got a clean QA run.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;isBulkLoadResult -&amp;gt; isBulkLoaded()? For setter also?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Okie. Fine with that.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I see this isBulkLoadResult () in StoreFile.java level also. I would have been better to know this status from StoreFile rather than from StoreFileReader.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I spent some time for doing it.  Later decided this way.First thing is that only the reader is passed to the StoreFileScanner and storefilescanner only has a reader associated with it.  So if we need to have this informaiton from Storefile then i need to change the constructor of StoreFileScanner or use a setter.  I thought that was making the patch heavier.  Also in this case the information of bulk load or not has to be passed from the reader (because the reader reads the file info) and then set that on the Storefile.  Currently reader is also an inner class of StoreFile.  Considering all this i just kept the new getter/setter in the Reader level. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;compareWithoutMvcc&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Okie.  &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;IMHO we should not do this KeyValueUtil.ensureKeyValue() stuff from now&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes.. But i think that we should do in a separete JIRA infact to avoid this setSeqId but doing KeyValueUtil.ensureKeyValue().&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I think we need to set KV seqId for KVs, from bulk loaded file, to the file seqId&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Yes.. I did set the other KV&apos;s sequence id because I wanted to ensure that we return one of the KVs from the two of them that are contesting here and ensure that we return a KV like what would have been returned if there was no clash and the lastest one was from the flushed file.  &lt;br/&gt;
Anyway before changing this let me check some more cases.  Then would update the patch accordingly.  Infact I had set the sequenceId of the file and later changed it to this way.&lt;/p&gt;</comment>
                            <comment id="14100392" author="ram_krish" created="Mon, 18 Aug 2014 07:29:09 +0000"  >&lt;blockquote&gt;&lt;p&gt;Also what abt compacting a flush file and a bulk loaded one? Will we have issues then? This patch will handle that also? Mind adding tests around that also.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;The current test is also compacting the flushed files. Behaviour wise both would be same in 0.99+.&lt;/p&gt;</comment>
                            <comment id="14100482" author="ram_krish" created="Mon, 18 Aug 2014 09:37:42 +0000"  >&lt;p&gt;Updated patch.  Tries to set the sequenceId of the bulk loaded file to the kv that is retrieved from the bulk loaded file.&lt;br/&gt;
Other thing to be noted is that&lt;br/&gt;
In the KVScannerComparator.compare() the code would not reach I think because&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (leftSequenceID &amp;lt; rightSequenceID) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;always the list of Storefiles are sorted based on the seqId.  So if we have a the seqId of the storefiles as 15, 19, 21 then while creating the KVHeap&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt; (KeyValueScanner scanner : scanners) {
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (scanner.peek() != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;) {
          &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.heap.add(scanner);
        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
          scanner.close();
        }
      }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So it will try to add 15, 19 and then 21. The compare() will in KVScannercomparator will be called from PriorityQueue&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
    &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; void siftUpUsingComparator(&lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; k, E x) {
        &lt;span class=&quot;code-keyword&quot;&gt;while&lt;/span&gt; (k &amp;gt; 0) {
            &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; parent = (k - 1) &amp;gt;&amp;gt;&amp;gt; 1;
            &lt;span class=&quot;code-object&quot;&gt;Object&lt;/span&gt; e = queue[parent];
            &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (comparator.compare(x, (E) e) &amp;gt;= 0)
                &lt;span class=&quot;code-keyword&quot;&gt;break&lt;/span&gt;;
            queue[k] = e;
            k = parent;
        }
        queue[k] = x;
    }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here we can see that the left hand side is always the element that we are trying to add and the right hand side is the existing one in the heap.  Since the list is always sorted (15, 19 and 21) so the compare will compare LHS=19 and RHS=15 and then LHS=21 and RHS=19.  So i think the leftSequenceID will always be bigger.  Anyway added the condition of setting the sequenceId on the rightKV also.&lt;/p&gt;</comment>
                            <comment id="14100539" author="hadoopqa" created="Mon, 18 Aug 2014 11:07:55 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12662463/HBASE-11591_3.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12662463/HBASE-11591_3.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12662463&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 7 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javadoc&lt;/font&gt;.  The javadoc tool did not generate any warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.TestRegionRebalancing&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10477//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14100860" author="yuzhihong@gmail.com" created="Mon, 18 Aug 2014 17:03:31 +0000"  >&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+     * Compares two cells without mvcc
+     *
+     * @param left
+     * @param right
+     * @&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; less than 0 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; left is smaller, 0 &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; equal etc..
+     */
+    &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;int&lt;/span&gt; compareWithoutSeqId(Cell left, Cell right) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Change javadoc to match the method name.&lt;/p&gt;

&lt;p&gt;Cell is marked @InterfaceStability.Evolving&lt;br/&gt;
setSequenceId() should be added to Cell interface - in another issue.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; class TestScannerWithBulkload {
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; HBaseTestingUtility TEST_UTIL = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HBaseTestingUtility();
+  &lt;span class=&quot;code-keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;static&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; tableName = &lt;span class=&quot;code-quote&quot;&gt;&quot;testBulkload&quot;&lt;/span&gt;;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Please change tableName to match test name.&lt;/p&gt;</comment>
                            <comment id="14100875" author="ram_krish" created="Mon, 18 Aug 2014 17:14:16 +0000"  >&lt;blockquote&gt;&lt;p&gt;setSequenceId() should be added to Cell interface - in another issue.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I don&apos;t think we can add setSequenceId() in Cell.  We can discuss on that. Will update the patch.&lt;/p&gt;</comment>
                            <comment id="14101080" author="apurtell" created="Mon, 18 Aug 2014 18:58:20 +0000"  >&lt;blockquote&gt;&lt;p&gt;But setting the seqId on the read path would prevent us from using Cell based impl because Cell does not have it.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;What prevents us from adding seqID accessors as an additional interface extending Cell in hbase-server as Anoop proposed above?&lt;/p&gt;</comment>
                            <comment id="14101818" author="ram_krish" created="Tue, 19 Aug 2014 03:58:03 +0000"  >&lt;blockquote&gt;&lt;p&gt;Or do we need an extension interface for Cell in server side which is having the setter?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I think better we do only that.  Is there any better way?  The idea of cell to create different impl of it as per the case needed like how in BufferedDataEncoders the SeekerState is a Cell now. &lt;br/&gt;
Infact everywhere the setSeqId() that we do in the server side should be changed.  Do it in this JIRA or another JIRA?  One thing to note that in the critical path we would any way have code that would create instances of that new impl.  &lt;/p&gt;</comment>
                            <comment id="14101837" author="anoop.hbase" created="Tue, 19 Aug 2014 04:42:39 +0000"  >&lt;p&gt;+1 for a new Jira.&lt;/p&gt;</comment>
                            <comment id="14101843" author="anoop.hbase" created="Tue, 19 Aug 2014 04:51:05 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11772&quot; title=&quot;Bulk load mvcc and seqId issues with native hfiles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11772&quot;&gt;&lt;del&gt;HBASE-11772&lt;/del&gt;&lt;/a&gt; related issue.&lt;/p&gt;</comment>
                            <comment id="14101875" author="ram_krish" created="Tue, 19 Aug 2014 05:29:13 +0000"  >&lt;blockquote&gt;&lt;p&gt;+1 for a new Jira&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Ok will raise JIRA.&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11772&quot; title=&quot;Bulk load mvcc and seqId issues with native hfiles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11772&quot;&gt;&lt;del&gt;HBASE-11772&lt;/del&gt;&lt;/a&gt; related issue.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Better to see if this patch is useful in terms of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11772&quot; title=&quot;Bulk load mvcc and seqId issues with native hfiles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11772&quot;&gt;&lt;del&gt;HBASE-11772&lt;/del&gt;&lt;/a&gt; also.&lt;/p&gt;</comment>
                            <comment id="14101880" author="ram_krish" created="Tue, 19 Aug 2014 05:33:52 +0000"  >&lt;p&gt;Raised &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11777&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/HBASE-11777&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14102535" author="stack" created="Tue, 19 Aug 2014 17:52:13 +0000"  >&lt;p&gt;There is the SequenceNumber Interface but that is only about getting a SequenceNumber.&lt;/p&gt;

&lt;p&gt;As per you fellows, don&apos;t think we need add method to Cell.  There are no setters in Cell currently.  Why start now.&lt;/p&gt;

&lt;p&gt;A marker Interface that allows you set sequence id on the hosting object seems fine.  MutableCell is a little ugly since it tarnishes our nice &apos;Cell&apos; notion.&lt;/p&gt;

&lt;p&gt;What about adding setter on SequenceNumber? One of the implementors is HLogKey.  It has a:&lt;/p&gt;

&lt;p&gt;  void setLogSeqNum(final long sequence) &lt;/p&gt;
{
    this.logSeqNum = sequence;
    this.seqNumAssignedLatch.countDown();
  }
</comment>
                            <comment id="14102962" author="jeffreyz" created="Tue, 19 Aug 2014 22:29:25 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; I&apos;ve created a patch based on your v3 for your considerations. The patch sets SeqId(mvcc) value during read time for bulk loaded files, the changes are smaller &amp;amp; less impact and passed the unit test you created.&lt;/p&gt;

&lt;p&gt;Another option is that we can add the logic into HFileReader code but will involve some code cleaning and we could do it later in that way. Thanks.&lt;/p&gt;</comment>
                            <comment id="14103329" author="hadoopqa" created="Wed, 20 Aug 2014 03:43:09 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12662879/hbase-11591-03-jeff.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12662879/hbase-11591-03-jeff.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12662879&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 7 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestSecureWALReplay&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.wal.TestWALReplay&lt;br/&gt;
                  org.apache.hadoop.hbase.regionserver.wal.TestWALReplayCompressed&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 1 zombie test(s): 	at org.apache.hadoop.hbase.mapreduce.TestRowCounter.testRowCounterHiddenColumn(TestRowCounter.java:137)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10491//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14103405" author="jinghe" created="Wed, 20 Aug 2014 05:27:27 +0000"  >&lt;p&gt;Looking at this JIRA and the patches, I think it would benefit HBase-11772 as well, particularly the idea to set mvcc (seqld) in the cell with the seqId of the bulkloaded file.&lt;br/&gt;
Looks good!&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+  &lt;span class=&quot;code-keyword&quot;&gt;protected&lt;/span&gt; void setCurrentCell(Cell newVal) {
+    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cur = newVal;
+    &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt;(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.cur != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.reader.isBulkLoaded() &amp;amp;&amp;amp; cur.getSequenceId() &amp;lt;= 0) {
+      KeyValue curKV = KeyValueUtil.ensureKeyValue(cur);
+      curKV.setSequenceId(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.reader.getSequenceID());
+      cur = curKV;
+    }
+  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You have &quot;&amp;amp;&amp;amp; cur.getSequenceId() &amp;lt;= 0&quot; in the if condition.  If it is bulkloaded file, could we just set the cells regardless of its old seqId in the cell?&lt;/p&gt;</comment>
                            <comment id="14103539" author="ram_krish" created="Wed, 20 Aug 2014 07:11:31 +0000"  >&lt;p&gt;So instead of setting it in the comparator you would set it when the kv is retrieved. &lt;br/&gt;
Should we really do this here&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
setCurrentCell(KeyValueUtil.createLastOnRowCol(kv));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;and &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
setCurrentCell(KeyValueUtil.createFirstOnRowColTS(kv, maxTimestampInFile));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;This is a fake key that we are creating right?&lt;/p&gt;</comment>
                            <comment id="14104134" author="ram_krish" created="Wed, 20 Aug 2014 17:06:46 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;A marker Interface that allows you set sequence id on the hosting object seems fine. MutableCell is a little ugly since it tarnishes our nice &apos;Cell&apos; notion.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Did not see the comment.  Pls see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11777&quot; title=&quot;Find a way to set sequenceId on Cells on the server&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11777&quot;&gt;&lt;del&gt;HBASE-11777&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14104311" author="jeffreyz" created="Wed, 20 Aug 2014 18:41:03 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;Jerry He&lt;/a&gt;  &lt;blockquote&gt;&lt;p&gt;If it is bulkloaded file, could we just set the cells regardless of its old seqId in the cell?&lt;/p&gt;&lt;/blockquote&gt;&lt;br/&gt;
Yes, we could. The condition is to prevent a Cell from keeping reset&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; &lt;blockquote&gt;&lt;p&gt;This is a fake key that we are creating right?&lt;/p&gt;&lt;/blockquote&gt; &lt;br/&gt;
Yes, you&apos;re right that we don&apos;t have to use setCurrentCell in these two cases. The patch is to use a consistent way to set instance variable cur so that it&apos;s easy to maintain&amp;amp;reasoning in the future or we do more in the setCurrentCell call. I guess there is no much difference either way.&lt;/p&gt;</comment>
                            <comment id="14104369" author="jeffreyz" created="Wed, 20 Aug 2014 19:12:50 +0000"  >&lt;p&gt;The v2 addressed unit test failures. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; If you don&apos;t mind, please take a final push on this JIRA since you had spent some time on this issue. Thanks.&lt;/p&gt;</comment>
                            <comment id="14104542" author="jinghe" created="Wed, 20 Aug 2014 20:44:47 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Regarding the &quot;&amp;amp;&amp;amp; cur.getSequenceId() &amp;lt;= 0&quot; condition again, it is possible that the cells in the original bulk load hfiles have seqId &amp;gt; 0.&lt;br/&gt;
In this case, we also need to reset them to the new file level seqId.  Right?&lt;/p&gt;</comment>
                            <comment id="14104559" author="jeffreyz" created="Wed, 20 Aug 2014 20:54:49 +0000"  >&lt;blockquote&gt;
&lt;p&gt; it is possible that the cells in the original bulk load hfiles have seqId &amp;gt; 0.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;For bulk loaded files, this should not happen.&lt;/p&gt;</comment>
                            <comment id="14104575" author="jinghe" created="Wed, 20 Aug 2014 21:03:54 +0000"  >&lt;p&gt;Hi, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;There are such use cases.  Please see &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11772&quot; title=&quot;Bulk load mvcc and seqId issues with native hfiles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11772&quot;&gt;&lt;del&gt;HBASE-11772&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14104703" author="jeffreyz" created="Wed, 20 Aug 2014 22:23:39 +0000"  >&lt;p&gt;I c. For &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11772&quot; title=&quot;Bulk load mvcc and seqId issues with native hfiles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11772&quot;&gt;&lt;del&gt;HBASE-11772&lt;/del&gt;&lt;/a&gt; situation, it&apos;s possible. Not sure what&apos;s use scenario for loading a native hfile directly and also need more to make that work though. We can take the condition &quot;cur.getSequenceId() &amp;lt;= 0&quot; out here or we can take it out in patch of &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11772&quot; title=&quot;Bulk load mvcc and seqId issues with native hfiles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11772&quot;&gt;&lt;del&gt;HBASE-11772&lt;/del&gt;&lt;/a&gt;.&lt;/p&gt;</comment>
                            <comment id="14104774" author="jinghe" created="Wed, 20 Aug 2014 23:13:08 +0000"  >&lt;p&gt;It can be used backup HBase data and restore.&lt;br/&gt;
Either way is fine.  I will pick up the work in &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11772&quot; title=&quot;Bulk load mvcc and seqId issues with native hfiles&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11772&quot;&gt;&lt;del&gt;HBASE-11772&lt;/del&gt;&lt;/a&gt; on top of whatever is done here. Thanks!&lt;/p&gt;</comment>
                            <comment id="14104973" author="hadoopqa" created="Thu, 21 Aug 2014 02:42:43 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12663192/hbase-11591-03-02.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12663192/hbase-11591-03-02.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12663192&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 5 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 7 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;br/&gt;
                       org.apache.hadoop.hbase.regionserver.wal.TestLogRollingNoCluster&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10513//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14105185" author="ram_krish" created="Thu, 21 Aug 2014 08:28:32 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;&lt;br/&gt;
First of all thanks a lot for taking a look at this issue and providing a patch.&lt;br/&gt;
I debugged this issue with 2 cases - with my patch and with Jeffrey&apos;s patch. Observed the following things&lt;br/&gt;
-&amp;gt; The testcase that was added as part of this testcase is for same KVs in the Store file and the bulk loaded Store file and it was specific for that issue.&lt;br/&gt;
-&amp;gt; After Jeffrey&apos;s first patch few testcases failed and those were not having this case of same KVs. All were different row keys. Things were working fine because it was purely based on row key comparison and no mvcc would have even come into it. (I mean even before the patch). I think that exposed some of the bug that was inside.&lt;/p&gt;

&lt;p&gt;-&amp;gt; Another important observation is that when we are scanning the KVs in the bulk loaded file (atleast those created new LoadIncrementalHFile cases) there is no mvcc info added to the metadata also.  So &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StoreFileScanner(&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;,
                                 getScanner(cacheBlocks, pread, isCompaction),
                                 !isCompaction, reader.hasMVCCInfo(), readPt);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;will say has mvccInfo as false and hence skipNewerThanReadPoint() would never be called because &lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hasMVCCInfo)
          skipKVsNewerThanReadpoint();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;So before the patch too, the scenario in the failed test case TestWALReplay.testCompactedBulkLoadedFiles() though our seqID for the bulk loaded files were 5, and the read point for all the scanners created in the test case was 4 - we were trying to read the bulk loaded file also.  But we were not able to skip the kvs in the bulk loaded file just because hasMvccInfo was false.  So the tests were passing.&lt;br/&gt;
Ok so what happens after Jeffrey&apos;s patch(the first patch without HREgion&apos;s change) is that on seeing any bulk loaded file we just assign the file&apos;s seqid to the KV&apos;s seqId.  And so after compaction still the read pt is not modified to the latest (ie 5) and hence all the KVs that were written to the compacted file from the bulk loaded files were missing.&lt;br/&gt;
I think the change in HRegion.java to set the write Sequence number is a bug fix? I still feel the patch would cause issue in the following scenario after the above changes&lt;/p&gt;

&lt;p&gt;-&amp;gt; Assume a scan started and the read point is 20 at that time&lt;br/&gt;
-&amp;gt; Bulk load is just getting completed and the scanner heap gets reset.  The new bulk loaded file with seqId 22 (for eg) gets added now to the scanner heap. But remember that the read point is still 20.&lt;br/&gt;
-&amp;gt; After this change we would just set the bulk load file&apos;s seqId to all its KVs  which is 22.  &lt;br/&gt;
-&amp;gt; Because there is no mvcc info in this bulk loaded file the scan would not be able to skipTheKvsWithNewerReadPt() and hence the scan would still see the Kvs with 22 as the seqId though the intention is to see only KVs with seqID 20.&lt;br/&gt;
I may be wrong. Am I missing something here? I may be wrong because for bulk loaded files because there is no mvcc we are allowed to read anything in that irrespective of the read pt?&lt;/p&gt;</comment>
                            <comment id="14105286" author="ram_krish" created="Thu, 21 Aug 2014 10:31:08 +0000"  >&lt;p&gt;Another thing is that while doing flush as part of Bulk load if there is nothing to be flushed should we still update the mvcc.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (&lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.memstoreSize.get() &amp;lt;= 0) {
          &lt;span class=&quot;code-comment&quot;&gt;// Presume that &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; there are still no edits in the memstore, then there are no edits &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt; region out in the WAL/HLog subsystem so no need to &lt;span class=&quot;code-keyword&quot;&gt;do&lt;/span&gt; any trickery clearing out
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// edits in the WAL system. Up the sequence number so the resulting flush id is &lt;span class=&quot;code-keyword&quot;&gt;for&lt;/span&gt;
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// sure just beyond the last appended region edit (useful as a marker when bulk loading,
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// etc.)
&lt;/span&gt;          &lt;span class=&quot;code-comment&quot;&gt;// wal can be &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; replaying edits.
&lt;/span&gt;          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; wal != &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;?
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FlushResult(FlushResult.Result.CANNOT_FLUSH_MEMSTORE_EMPTY,
              getNextSequenceId(wal), &lt;span class=&quot;code-quote&quot;&gt;&quot;Nothing to flush&quot;&lt;/span&gt;):
            &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; FlushResult(FlushResult.Result.CANNOT_FLUSH_MEMSTORE_EMPTY, &lt;span class=&quot;code-quote&quot;&gt;&quot;Nothing to flush&quot;&lt;/span&gt;);
        }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14105291" author="ram_krish" created="Thu, 21 Aug 2014 10:45:05 +0000"  >&lt;p&gt;The patch tries to do skipKVsGreaterthanReadPt() even for bulk loaded kvs. &lt;br/&gt;
In the attached patch if we don&apos;t do the mvcc thing for no flush result then the testBulkLoad will fail.  That is because though the scanner is created after bulk load the read pt is still lower than the seqID created as the seqId is not added to the mvcc writeentry.  &lt;br/&gt;
In the next case testBulkLoadWithParallelScan() the scanner is created before bulk load.  And so the expected KV should be the KV that is not from the bulk loaded file, though the scanner heap is reset after the bulk load.&lt;/p&gt;</comment>
                            <comment id="14105428" author="yuzhihong@gmail.com" created="Thu, 21 Aug 2014 14:56:05 +0000"  >&lt;p&gt;Minor:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
-        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; !hasMVCCInfo ? &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; : skipKVsNewerThanReadpoint();
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!hasMVCCInfo &amp;amp;&amp;amp; &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.reader.isBulkLoaded()) {
+          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; skipKVsNewerThanReadpoint();
+        } &lt;span class=&quot;code-keyword&quot;&gt;else&lt;/span&gt; {
+          &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; !hasMVCCInfo ? &lt;span class=&quot;code-keyword&quot;&gt;true&lt;/span&gt; : skipKVsNewerThanReadpoint();
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The if condition above would be more readable if written this way:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
+        &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (hasMVCCInfo || &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.reader.isBulkLoaded()) {
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="14105659" author="jeffreyz" created="Thu, 21 Aug 2014 17:38:44 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; &lt;blockquote&gt;
&lt;p&gt;I think the change in HRegion.java to set the write Sequence number is a bug fix? I still feel the patch would cause issue in the following scenario after the above changes&lt;br/&gt;
-&amp;gt; Assume a scan started and the read point is 20 at that time&lt;br/&gt;
-&amp;gt; Bulk load is just getting completed and the scanner heap gets reset. The new bulk loaded file with seqId 22 (for eg) gets added now to the scanner heap. But remember that the read point is still 20.&lt;br/&gt;
-&amp;gt; After this change we would just set the bulk load file&apos;s seqId to all its KVs which is 22. &lt;br/&gt;
-&amp;gt; Because there is no mvcc info in this bulk loaded file the scan would not be able to skipTheKvsWithNewerReadPt() and hence the scan would still see the Kvs with 22 as the seqId though the intention is to see only KVs with seqID 20.&lt;br/&gt;
I may be wrong. Am I missing something here? I may be wrong because for bulk loaded files because there is no mvcc we are allowed to read anything in that irrespective of the read pt?&lt;/p&gt;&lt;/blockquote&gt;&lt;br/&gt;
The situation above is valid. While existing behavior(like 0.98), we allow a scan with lower readpt to read a bulk loaded file immediately as we can load a hfile atomically. I think it&apos;s fine either keeping existing behavior or add handling for such cases. Another option to handle such case you can set hasMVCCInfo to true for a bulk loaded file because we will set its KVs&apos; mvcc using Hfile seqId.&lt;/p&gt;


&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;Jerry He&lt;/a&gt; &lt;blockquote&gt;&lt;p&gt;It can be used backup HBase data and restore.&lt;/p&gt;&lt;/blockquote&gt;&lt;br/&gt;
For such case, trunk code can handle it but you need to keep deleted cells &amp;amp; mvcc forever(using config &quot;hbase.hstore.compaction.keep.mvcc.period&quot;). When you load a old hfile, its KVs will be sorted correctly based on their mvcc values(LogSeqId).&lt;/p&gt;
</comment>
                            <comment id="14106424" author="ram_krish" created="Fri, 22 Aug 2014 03:55:33 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;&lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;I think it&apos;s fine either keeping existing behavior or add handling for such cases&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Then I think the above change is not necessary and only handle the case as per the initial patch where we handle same KVs case.  The later patches attached is some how trying to make the mvcc accept the bulk load files and make it visible just because we are setting the bulk load file&apos;s seq id to the KV from the bulk loaded file.&lt;br/&gt;
I think if we have to maintain the behaviour then only handle the case of same Kvs should be fine. If not the other changes are necessary. This is my take on this.  Pls feel free to correct me.&lt;br/&gt;
But thinking of cases like &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jerryhe&quot; class=&quot;user-hover&quot; rel=&quot;jerryhe&quot;&gt;Jerry He&lt;/a&gt; then this change is right and for that we need to handle all cases.  &lt;br/&gt;
What do other guys think?&lt;/p&gt;</comment>
                            <comment id="14109021" author="ram_krish" created="Mon, 25 Aug 2014 11:31:13 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jeffreyz&quot; class=&quot;user-hover&quot; rel=&quot;jeffreyz&quot;&gt;Jeffrey Zhong&lt;/a&gt;&lt;br/&gt;
Is the latest patch good for commit?&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;, &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt;&lt;br/&gt;
What you guys think?&lt;/p&gt;</comment>
                            <comment id="14110032" author="jeffreyz" created="Tue, 26 Aug 2014 00:13:14 +0000"  >&lt;p&gt;The patch looks good to me(+1) with one minor comment:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;+              w = mvcc.beginMemstoreInsert();
+              long flushSeqId = getNextSequenceId(wal);
+              FlushResult flushResult = new FlushResult(
+                  FlushResult.Result.CANNOT_FLUSH_MEMSTORE_EMPTY, flushSeqId, &quot;Nothing to flush&quot;);
+              w.setWriteNumber(flushSeqId);
+              mvcc.waitForPreviousTransactionsComplete(w);
+              return flushResult
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You can set w=null after &quot;mvcc.waitForPreviousTransactionsComplete(w);&quot; so mvcc.advanceMemstore in finally block can be skipped.&lt;/p&gt;</comment>
                            <comment id="14110275" author="ram_krish" created="Tue, 26 Aug 2014 04:59:35 +0000"  >&lt;blockquote&gt;&lt;p&gt;You can set w=null after &quot;mvcc.waitForPreviousTransactionsComplete(w);&quot; so mvcc.advanceMemstore in finally block can be skipped.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Thanks for the review.  Will update and commit the patch.&lt;/p&gt;</comment>
                            <comment id="14110287" author="ram_krish" created="Tue, 26 Aug 2014 05:17:16 +0000"  >&lt;p&gt;Retry QA.  Updated patch.&lt;/p&gt;</comment>
                            <comment id="14110344" author="hadoopqa" created="Tue, 26 Aug 2014 06:08:54 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12664316/HBASE-11591_6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12664316/HBASE-11591_6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12664316&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 10 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 8 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 site&lt;/font&gt;.  The patch appears to cause mvn site goal to fail.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10578//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14110403" author="ram_krish" created="Tue, 26 Aug 2014 06:52:37 +0000"  >&lt;p&gt;The javadoc warning is not from this patch.&lt;/p&gt;</comment>
                            <comment id="14110481" author="ram_krish" created="Tue, 26 Aug 2014 08:21:42 +0000"  >&lt;p&gt;Retry QA&lt;/p&gt;</comment>
                            <comment id="14110573" author="hadoopqa" created="Tue, 26 Aug 2014 10:11:09 +0000"  >&lt;p&gt;&lt;font color=&quot;red&quot;&gt;-1 overall&lt;/font&gt;.  Here are the results of testing the latest attachment &lt;br/&gt;
  &lt;a href=&quot;http://issues.apache.org/jira/secure/attachment/12664353/HBASE-11591_6.patch&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://issues.apache.org/jira/secure/attachment/12664353/HBASE-11591_6.patch&lt;/a&gt;&lt;br/&gt;
  against trunk revision .&lt;br/&gt;
  ATTACHMENT ID: 12664353&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 @author&lt;/font&gt;.  The patch does not contain any @author tags.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 tests included&lt;/font&gt;.  The patch appears to include 10 new or modified tests.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 javac&lt;/font&gt;.  The applied patch does not increase the total number of javac compiler warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;red&quot;&gt;-1 javadoc&lt;/font&gt;.  The javadoc tool appears to have generated 8 warning messages.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 findbugs&lt;/font&gt;.  The patch does not introduce any new Findbugs (version 2.0.3) warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 release audit&lt;/font&gt;.  The applied patch does not increase the total number of release audit warnings.&lt;/p&gt;

&lt;p&gt;    &lt;font color=&quot;green&quot;&gt;+1 lineLengths&lt;/font&gt;.  The patch does not introduce lines longer than 100&lt;/p&gt;

&lt;p&gt;  &lt;font color=&quot;green&quot;&gt;+1 site&lt;/font&gt;.  The mvn site goal succeeds with this patch.&lt;/p&gt;

&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core tests&lt;/font&gt;.  The patch failed these unit tests:&lt;/p&gt;


&lt;p&gt;     &lt;font color=&quot;red&quot;&gt;-1 core zombie tests&lt;/font&gt;.  There are 2 zombie test(s): 	at org.apache.hadoop.hbase.client.TestHCM.testClusterStatus(TestHCM.java:250)&lt;/p&gt;

&lt;p&gt;Test results: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//testReport/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//testReport/&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-protocol.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-thrift.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-server.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-common.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-hadoop2-compat.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-examples.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-client.html&lt;/a&gt;&lt;br/&gt;
Findbugs warnings: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//artifact/patchprocess/newPatchFindbugsWarningshbase-prefix-tree.html&lt;/a&gt;&lt;br/&gt;
Console output: &lt;a href=&quot;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//console&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/PreCommit-HBASE-Build/10585//console&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This message is automatically generated.&lt;/p&gt;</comment>
                            <comment id="14110637" author="ram_krish" created="Tue, 26 Aug 2014 12:09:27 +0000"  >&lt;p&gt;Committed to master.&lt;br/&gt;
Thanks for the reviews Jeffrey, Ted, Jerry and Anoop. &lt;br/&gt;
The failed QA test seems unrelated and also the java doc warnings.&lt;/p&gt;</comment>
                            <comment id="14110744" author="hudson" created="Tue, 26 Aug 2014 14:24:03 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-TRUNK #5431 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/5431/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/5431/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11591&quot; title=&quot;Scanner fails to retrieve KV  from bulk loaded file with highest sequence id than the cell&amp;#39;s mvcc in a non-bulk loaded file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11591&quot;&gt;&lt;del&gt;HBASE-11591&lt;/del&gt;&lt;/a&gt; Scanner fails to retrieve KV from bulk loaded file with (ramkrishna: rev dea6480023e78a3facdaf1cfc00ad6cc35ecb3ea)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFileScanner.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestScanWithBloomError.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestScannerWithBulkload.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14116217" author="anoop.hbase" created="Sat, 30 Aug 2014 03:29:10 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; The affected version and fix version given as 0.99 but pushed only to master?&lt;/p&gt;</comment>
                            <comment id="14117174" author="ram_krish" created="Mon, 1 Sep 2014 08:24:36 +0000"  >&lt;p&gt;Committed to branch-1 also.  Thanks for the reminder &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14117302" author="hudson" created="Mon, 1 Sep 2014 10:54:48 +0000"  >&lt;p&gt;FAILURE: Integrated in HBase-1.0 #142 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-1.0/142/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-1.0/142/&lt;/a&gt;)&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11591&quot; title=&quot;Scanner fails to retrieve KV  from bulk loaded file with highest sequence id than the cell&amp;#39;s mvcc in a non-bulk loaded file&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11591&quot;&gt;&lt;del&gt;HBASE-11591&lt;/del&gt;&lt;/a&gt; Scanner fails to retrieve KV from bulk loaded file with (ramkrishna: rev 844f3dfb6a9b2267b7e06ee2a176c76ae89ff7bf)&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFileScanner.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFile.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestScannerWithBulkload.java&lt;/li&gt;
	&lt;li&gt;hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestScanWithBloomError.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14117338" author="ram_krish" created="Mon, 1 Sep 2014 11:46:28 +0000"  >&lt;p&gt;Addendum patch that solves &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-11834&quot; title=&quot;TestHRegionBusyWait.testParallelAppendWithMemStoreFlush fails sporadically&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-11834&quot;&gt;&lt;del&gt;HBASE-11834&lt;/del&gt;&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="14117341" author="anoop.hbase" created="Mon, 1 Sep 2014 11:50:47 +0000"  >&lt;p&gt;+1 for addendum for branch-1.&lt;/p&gt;</comment>
                            <comment id="14331105" author="enis" created="Sat, 21 Feb 2015 23:33:30 +0000"  >&lt;p&gt;Closing this issue after 0.99.0 release. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12734841">HBASE-11772</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12738500">HBASE-11882</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                            <issuelinktype id="10001">
                    <name>dependent</name>
                                                                <inwardlinks description="is depended upon by">
                                        <issuelink>
            <issuekey id="12721032">HBASE-11339</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12658788" name="HBASE-11591.patch" size="15460" author="ram_krish" created="Wed, 30 Jul 2014 23:50:56 +0000"/>
                            <attachment id="12662280" name="HBASE-11591_1.patch" size="16377" author="ram_krish" created="Sat, 16 Aug 2014 12:29:59 +0000"/>
                            <attachment id="12662425" name="HBASE-11591_2.patch" size="16377" author="ram_krish" created="Mon, 18 Aug 2014 05:18:00 +0000"/>
                            <attachment id="12662463" name="HBASE-11591_3.patch" size="17576" author="ram_krish" created="Mon, 18 Aug 2014 09:37:42 +0000"/>
                            <attachment id="12663384" name="HBASE-11591_5.patch" size="22063" author="ram_krish" created="Thu, 21 Aug 2014 10:45:05 +0000"/>
                            <attachment id="12664353" name="HBASE-11591_6.patch" size="22088" author="ram_krish" created="Tue, 26 Aug 2014 08:21:42 +0000"/>
                            <attachment id="12664316" name="HBASE-11591_6.patch" size="22088" author="ram_krish" created="Tue, 26 Aug 2014 05:17:16 +0000"/>
                            <attachment id="12665763" name="HBASE-11591_branch-1-addendum.patch" size="3055" author="ram_krish" created="Mon, 1 Sep 2014 11:46:28 +0000"/>
                            <attachment id="12657850" name="TestBulkload.java" size="6490" author="ram_krish" created="Fri, 25 Jul 2014 16:41:04 +0000"/>
                            <attachment id="12663192" name="hbase-11591-03-02.patch" size="15091" author="jeffreyz" created="Wed, 20 Aug 2014 19:12:50 +0000"/>
                            <attachment id="12662879" name="hbase-11591-03-jeff.patch" size="14232" author="jeffreyz" created="Tue, 19 Aug 2014 22:29:25 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Fri, 25 Jul 2014 20:44:12 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407836</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 42 weeks, 5 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1y6en:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>407845</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>