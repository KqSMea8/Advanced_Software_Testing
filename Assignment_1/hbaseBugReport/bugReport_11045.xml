<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 20:19:39 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-11045/HBASE-11045.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-11045] Replace deprecated method FileSystem#createNonRecursive</title>
                <link>https://issues.apache.org/jira/browse/HBASE-11045</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;This change affect directly ProtobufLogWriter#init() associated to TestHLog#testFailedToCreateHLogIfParentRenamed.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12709585">HBASE-11045</key>
            <summary>Replace deprecated method FileSystem#createNonRecursive</summary>
                <type id="3" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/task.png">Task</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.png">Minor</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="2">Won&apos;t Fix</resolution>
                                        <assignee username="gustavoanatoly">Gustavo Anatoly</assignee>
                                    <reporter username="gustavoanatoly">Gustavo Anatoly</reporter>
                        <labels>
                    </labels>
                <created>Mon, 21 Apr 2014 17:27:07 +0000</created>
                <updated>Thu, 26 May 2016 18:07:46 +0000</updated>
                            <resolved>Thu, 26 May 2016 00:40:06 +0000</resolved>
                                                    <fixVersion>2.0.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="13975852" author="enis" created="Mon, 21 Apr 2014 18:34:43 +0000"  >&lt;p&gt;Any more context on this? &lt;/p&gt;

&lt;p&gt;FileSystem#createNonRecursive() is deprecated, but Hadoop unfortunately fails to provide a viable alternative.The FileContext API which is supposed to replace the FileSystem API is not mature yet for us to switch. &lt;br/&gt;
createNonRecursive() is extremely important to do fencing of dead region servers properly. &lt;/p&gt;
</comment>
                            <comment id="13975893" author="gustavoanatoly" created="Mon, 21 Apr 2014 18:54:45 +0000"  >&lt;p&gt;Thanks Enis.&lt;/p&gt;

&lt;p&gt;You have any suggestion? Or this issue should be closed, for while?&lt;/p&gt;</comment>
                            <comment id="13975988" author="enis" created="Mon, 21 Apr 2014 20:21:30 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ted_yu&quot; class=&quot;user-hover&quot; rel=&quot;ted_yu&quot;&gt;Ted Yu&lt;/a&gt; can you please like the Hdfs issue here. &lt;/p&gt;</comment>
                            <comment id="13976573" author="stevel@apache.org" created="Tue, 22 Apr 2014 09:11:24 +0000"  >&lt;p&gt;&lt;tt&gt;FileSystem#createNonRecursive()&lt;/tt&gt; isn&apos;t implemented by many filesystems, using it would run the risk of hitting implementations that don&apos;t.&lt;/p&gt;

&lt;p&gt;Is there any barrier to using a check for the parent dir existing before calling create? That&apos;s essentially what most filesystems would end up doing&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
createNoRecursive(Filesystem fs, Path p) {
  &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!fs.exists(p.parent()) &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; FileNotFoundException(p.parent())
  fs.create(p)
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It&apos;s not atomic, but if you look closely at the source, it&apos;s not atomic in most FS implementations anyway, including native (mkdirs() isn&apos;t atomic there).&lt;/p&gt;</comment>
                            <comment id="13976843" author="gustavoanatoly" created="Tue, 22 Apr 2014 14:38:45 +0000"  >&lt;p&gt;Hi, Steve. Sorry for delay.&lt;/p&gt;

&lt;p&gt;About your question:&lt;/p&gt;

&lt;blockquote&gt;&lt;p&gt;Is there any barrier to using a check for the parent dir existing before calling create?&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;I think there are no problem, but the validations to check if the parent path doesn&apos;t exist more is responsibility of Hadoop. So your idea is good if encapsulated into HFileSystem#createNonRecursive():&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (!fs.exists(f.getParent())) {
      &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; exceptionMsg = &lt;span class=&quot;code-quote&quot;&gt;&quot;Path doesn&apos;t exist: &quot;&lt;/span&gt; + f.getParent().toString();
      LOG.error(exceptionMsg);
      &lt;span class=&quot;code-keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; IOException(exceptionMsg);
    }
    &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt; fs.create(f, overwrite, bufferSize, replication, blockSize, progress);
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And following the adjustments, ProtobufLogWriter#init() line 79:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
...
HFileSystem hFS = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; HFileSystem(fs);
output = hFS.createNonRecursive(path, overwritable, bufferSize, replication, blockSize, &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt;);
output.write(ProtobufLogReader.PB_WAL_MAGIC);
...
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But I prefer put this validations on Hadoop &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.gif&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt; But what do you think? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=stevel%40apache.org&quot; class=&quot;user-hover&quot; rel=&quot;stevel@apache.org&quot;&gt;Steve Loughran&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tedyu&quot; class=&quot;user-hover&quot; rel=&quot;tedyu&quot;&gt;Ted Yu&lt;/a&gt; &lt;span class=&quot;error&quot;&gt;&amp;#91;~enis-2&amp;#93;&lt;/span&gt;&lt;/p&gt;</comment>
                            <comment id="13977194" author="stevel@apache.org" created="Tue, 22 Apr 2014 18:50:44 +0000"  >&lt;p&gt;Personally, I wouldn&apos;t have had &lt;tt&gt;create()&lt;/tt&gt; create any parent directories at all, leave it to the responsibility of the caller, but for reasons of history, that&apos;s not the case...&lt;/p&gt;</comment>
                            <comment id="13977198" author="enis" created="Tue, 22 Apr 2014 18:55:24 +0000"  >&lt;blockquote&gt;&lt;p&gt;FileSystem#createNonRecursive() isn&apos;t implemented by many filesystems, using it would run the risk of hitting implementations that don&apos;t.&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;HBase does not have to work on every file system. We should be ok to list a support for atomic createNonRecursive() as a requirement from the underlying FS for HBase. &lt;/p&gt;
&lt;blockquote&gt;&lt;p&gt;Is there any barrier to using a check for the parent dir existing before calling create?&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;I am afraid no. HBase needs this to be atomic in the namespace, since we use it for fencing. Similar to atomic renames, it is a requirement from FS, and I don&apos;t think this is unrealistic. FS owns the namespace, and it should be able to provide this semantics. &lt;br/&gt;
We rely on an atomic directory rename + createNonRecursive() to ensure that the region server who is dead cannot create more WAL files and commit new data or fencing. Otherwise, there will be data loss. In an non-atomic implementation, there will be a race condition, where we rename the directory, but the fenced out server will still be able to create a new file there and continue committing data which will then be lost. &lt;/p&gt;</comment>
                            <comment id="13977330" author="enis" created="Tue, 22 Apr 2014 20:14:53 +0000"  >&lt;blockquote&gt;&lt;p&gt;Personally, I wouldn&apos;t have had create() create any parent directories at all, leave it to the responsibility of the caller, but for reasons of history, that&apos;s not the case...&lt;/p&gt;&lt;/blockquote&gt;
&lt;p&gt;Agreed. create() should not auto-create the parents. This is very unintuitive. However, at this point we cannot change it I seems. Having an explicit argument to create would be good though. &lt;/p&gt;</comment>
                            <comment id="15299605" author="ryantotti" created="Wed, 25 May 2016 07:26:22 +0000"  >&lt;p&gt;I use Swift instead of HDFS as storage for HBase,HBase RegionServer can not start. HBase use the deprecated method createNonRecursive() in org.apache.hadoop.hbase.regionserver.wal.ProtobufLogWriter.init().&lt;/p&gt;</comment>
                            <comment id="15299778" author="stevel@apache.org" created="Wed, 25 May 2016 09:57:45 +0000"  >&lt;p&gt;you &lt;b&gt;cannot&lt;/b&gt; use swift instead of HDFS. It isn&apos;t a real filesystem and things will fail dramatically &#8212;even if this method was implemented, there are too many other differences. The fact that your attempt is failing this early on, while frustrating, stops you getting deeper into trouble. Sorry. Note that you can&apos;t use S3 either, same problem.&lt;/p&gt;


&lt;p&gt;see: &lt;span class=&quot;error&quot;&gt;&amp;#91;Object stores vs filesystems&amp;#93;&lt;/span&gt;(&lt;a href=&quot;http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/filesystem/introduction.html&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;http://hadoop.apache.org/docs/current/hadoop-project-dist/hadoop-common/filesystem/introduction.html&lt;/a&gt;).&lt;/p&gt;</comment>
                            <comment id="15299781" author="stevel@apache.org" created="Wed, 25 May 2016 09:58:50 +0000"  >&lt;p&gt;BTW, given that HDFS has un-deprecated &lt;tt&gt;createNonRecursive()&lt;/tt&gt;, what about closing this as a WONTFIX?&lt;/p&gt;</comment>
                            <comment id="15301441" author="ryantotti" created="Thu, 26 May 2016 03:13:33 +0000"  >&lt;p&gt;Does that mean I can only use HDFS for HBase? Are there any other choices Hadoop supported?&lt;/p&gt;</comment>
                            <comment id="15302609" author="enis" created="Thu, 26 May 2016 18:07:46 +0000"  >&lt;p&gt;HBase is supported (to the extend that corresponding vendors support it) on a couple of file systems other than HDFS: gpfs, maprfs, EMC Isilon, Microsoft WASB are the ones from the top of my head. You should contact the corresponding vendor if you want to learn more. &lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="12709572">HADOOP-12446</issuekey>
        </issuelink>
                            </outwardlinks>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12709347">HBASE-11032</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Mon, 21 Apr 2014 18:34:43 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>387907</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            29 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1utmv:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>388168</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>