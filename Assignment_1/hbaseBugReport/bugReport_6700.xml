<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 19:39:05 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-6700/HBASE-6700.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-6700] [replication] empty znodes created during queue failovers aren&apos;t deleted</title>
                <link>https://issues.apache.org/jira/browse/HBASE-6700</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;Please check code below&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-style: solid;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeHeader panelHeader&quot; style=&quot;border-bottom-width: 1px;border-bottom-style: solid;&quot;&gt;&lt;b&gt;ReplicationSourceManager.java&lt;/b&gt;&lt;/div&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// NodeFailoverWorker class
&lt;/span&gt;&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void run() {
{
    ...

      LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Moving &quot;&lt;/span&gt; + rsZnode + &lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;s hlogs to my queue&quot;&lt;/span&gt;);
      SortedMap&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;, SortedSet&amp;lt;&lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt;&amp;gt;&amp;gt; newQueues =
          zkHelper.copyQueuesFromRS(rsZnode);   &lt;span class=&quot;code-comment&quot;&gt;// Node create here*
&lt;/span&gt;      zkHelper.deleteRsQueues(rsZnode); 
      &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; (newQueues == &lt;span class=&quot;code-keyword&quot;&gt;null&lt;/span&gt; || newQueues.size() == 0) {
        &lt;span class=&quot;code-keyword&quot;&gt;return&lt;/span&gt;;  
      }
    ...
}


  &lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void closeRecoveredQueue(ReplicationSourceInterface src) {
    LOG.info(&lt;span class=&quot;code-quote&quot;&gt;&quot;Done with the recovered queue &quot;&lt;/span&gt; + src.getPeerClusterZnode());
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.oldsources.remove(src);
    &lt;span class=&quot;code-keyword&quot;&gt;this&lt;/span&gt;.zkHelper.deleteSource(src.getPeerClusterZnode(), &lt;span class=&quot;code-keyword&quot;&gt;false&lt;/span&gt;);  &lt;span class=&quot;code-comment&quot;&gt;// Node delete here*
&lt;/span&gt;  }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt; 

&lt;p&gt;So from code we can see if newQueues == null or newQueues.size() == 0, Failover replication Source will never start and the failover zk node will never deleted.&lt;/p&gt;


&lt;p&gt;eg below failover node will never be delete:&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;zk: 10.232.98.77:2181(CONNECTED) 16&amp;#93;&lt;/span&gt; ls /hbase-test3-repl/replication/rs/dw93.kgb.sqa.cm4,60020,1346337383956/1-dw93.kgb.sqa.cm4,60020,1346309263932-dw91.kgb.sqa.cm4,60020,1346307150041-dw89.kgb.sqa.cm4,60020,1346307911711-dw93.kgb.sqa.cm4,60020,1346312019213-dw88.kgb.sqa.cm4,60020,1346311774939-dw89.kgb.sqa.cm4,60020,1346312314229-dw93.kgb.sqa.cm4,60020,1346312524307-dw88.kgb.sqa.cm4,60020,1346313203367-dw89.kgb.sqa.cm4,60020,1346313944402-dw88.kgb.sqa.cm4,60020,1346314214286-dw91.kgb.sqa.cm4,60020,1346315119613-dw93.kgb.sqa.cm4,60020,1346314186436-dw88.kgb.sqa.cm4,60020,1346315594396-dw89.kgb.sqa.cm4,60020,1346315909491-dw92.kgb.sqa.cm4,60020,1346315315634-dw89.kgb.sqa.cm4,60020,1346316742242-dw93.kgb.sqa.cm4,60020,1346317604055-dw92.kgb.sqa.cm4,60020,1346318098972-dw91.kgb.sqa.cm4,60020,1346317855650-dw93.kgb.sqa.cm4,60020,1346318532530-dw92.kgb.sqa.cm4,60020,1346318573238-dw89.kgb.sqa.cm4,60020,1346321299040-dw91.kgb.sqa.cm4,60020,1346321304393-dw92.kgb.sqa.cm4,60020,1346325755894-dw89.kgb.sqa.cm4,60020,1346326520895-dw91.kgb.sqa.cm4,60020,1346328246992-dw92.kgb.sqa.cm4,60020,1346327290653-dw93.kgb.sqa.cm4,60020,1346337303018-dw91.kgb.sqa.cm4,60020,1346337318929&lt;br/&gt;
[] // empty node will never be deleted&lt;/p&gt;

</description>
                <environment></environment>
        <key id="12605644">HBASE-6700</key>
            <summary>[replication] empty znodes created during queue failovers aren&apos;t deleted</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/bug.png">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="terry_zhang">terry zhang</assignee>
                                    <reporter username="terry_zhang">terry zhang</reporter>
                        <labels>
                    </labels>
                <created>Fri, 31 Aug 2012 06:38:02 +0000</created>
                <updated>Tue, 26 Feb 2013 08:20:55 +0000</updated>
                            <resolved>Mon, 29 Oct 2012 23:46:31 +0000</resolved>
                                    <version>0.94.1</version>
                                    <fixVersion>0.94.3</fixVersion>
                    <fixVersion>0.95.0</fixVersion>
                                    <component>Replication</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>4</watches>
                                                                <comments>
                            <comment id="13445734" author="terry_zhang" created="Fri, 31 Aug 2012 07:10:31 +0000"  >&lt;p&gt;we can let the NodeFailoverWorker create newClusterZnode after check the hlog size &lt;/p&gt;</comment>
                            <comment id="13482982" author="lhofhansl" created="Wed, 24 Oct 2012 05:20:41 +0000"  >&lt;p&gt;Patch looks good. &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=jdcryans&quot; class=&quot;user-hover&quot; rel=&quot;jdcryans&quot;&gt;Jean-Daniel Cryans&lt;/a&gt; wanna have a look?&lt;/p&gt;</comment>
                            <comment id="13486507" author="jdcryans" created="Mon, 29 Oct 2012 23:44:38 +0000"  >&lt;p&gt;+1, I&apos;m going to commit. I&apos;m also fixing the title.&lt;/p&gt;</comment>
                            <comment id="13486511" author="jdcryans" created="Mon, 29 Oct 2012 23:46:31 +0000"  >&lt;p&gt;Committed to 0.94 and trunk. Thanks for the patch Terry.&lt;/p&gt;</comment>
                            <comment id="13486580" author="hudson" created="Tue, 30 Oct 2012 01:12:26 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK-on-Hadoop-2.0.0 #244 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/244/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK-on-Hadoop-2.0.0/244/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6700&quot; title=&quot;[replication] empty znodes created during queue failovers aren&amp;#39;t deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6700&quot;&gt;&lt;del&gt;HBASE-6700&lt;/del&gt;&lt;/a&gt;  &lt;span class=&quot;error&quot;&gt;&amp;#91;replication&amp;#93;&lt;/span&gt; empty znodes created during queue failovers aren&apos;t&lt;br/&gt;
            deleted (Terry Zhang via JD) (Revision 1403581)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13486621" author="hudson" created="Tue, 30 Oct 2012 03:30:22 +0000"  >&lt;p&gt;Integrated in HBase-TRUNK #3497 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-TRUNK/3497/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-TRUNK/3497/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6700&quot; title=&quot;[replication] empty znodes created during queue failovers aren&amp;#39;t deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6700&quot;&gt;&lt;del&gt;HBASE-6700&lt;/del&gt;&lt;/a&gt;  &lt;span class=&quot;error&quot;&gt;&amp;#91;replication&amp;#93;&lt;/span&gt; empty znodes created during queue failovers aren&apos;t&lt;br/&gt;
            deleted (Terry Zhang via JD) (Revision 1403581)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/trunk/hbase-server/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13486630" author="hudson" created="Tue, 30 Oct 2012 03:55:43 +0000"  >&lt;p&gt;Integrated in HBase-0.94 #559 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94/559/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94/559/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6700&quot; title=&quot;[replication] empty znodes created during queue failovers aren&amp;#39;t deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6700&quot;&gt;&lt;del&gt;HBASE-6700&lt;/del&gt;&lt;/a&gt;  &lt;span class=&quot;error&quot;&gt;&amp;#91;replication&amp;#93;&lt;/span&gt; empty znodes created during queue failovers aren&apos;t&lt;br/&gt;
            deleted (Terry Zhang via JD) (Revision 1403582)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="13490366" author="hudson" created="Mon, 5 Nov 2012 01:35:34 +0000"  >&lt;p&gt;Integrated in HBase-0.94-security-on-Hadoop-23 #9 (See &lt;a href=&quot;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/9/&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://builds.apache.org/job/HBase-0.94-security-on-Hadoop-23/9/&lt;/a&gt;)&lt;br/&gt;
    &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-6700&quot; title=&quot;[replication] empty znodes created during queue failovers aren&amp;#39;t deleted&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-6700&quot;&gt;&lt;del&gt;HBASE-6700&lt;/del&gt;&lt;/a&gt;  &lt;span class=&quot;error&quot;&gt;&amp;#91;replication&amp;#93;&lt;/span&gt; empty znodes created during queue failovers aren&apos;t&lt;br/&gt;
            deleted (Terry Zhang via JD) (Revision 1403582)&lt;/p&gt;

&lt;p&gt;     Result = FAILURE&lt;br/&gt;
jdcryans : &lt;br/&gt;
Files : &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;/hbase/branches/0.94/src/main/java/org/apache/hadoop/hbase/replication/ReplicationZookeeper.java&lt;/li&gt;
&lt;/ul&gt;
</comment>
                    </comments>
                    <attachments>
                            <attachment id="12543232" name="HBASE-6700.patch" size="1323" author="terry_zhang" created="Fri, 31 Aug 2012 07:09:03 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Wed, 24 Oct 2012 05:20:41 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>241763</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310191" key="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes">
                        <customfieldname>Hadoop Flags</customfieldname>
                        <customfieldvalues>
                                <customfieldvalue key="10343"><![CDATA[Reviewed]]></customfieldvalue>
    
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            4 years, 6 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i02cfz:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>11617</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310222" key="com.atlassian.jira.ext.charting:timeinstatus">
                        <customfieldname>Time in Status</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        </customfields>
    </item>
</channel>
</rss>