<!-- 
RSS generated by JIRA (6.3.4#6332-sha1:51bc225ef474afe3128b2f66878477f322397b16) at Fri Dec 16 21:15:44 UTC 2016

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary add field=key&field=summary to the URL of your request.
For example:
https://issues.apache.org/jira/si/jira.issueviews:issue-xml/HBASE-16594/HBASE-16594.xml?field=key&amp;field=summary
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>6.3.4</version>
        <build-number>6332</build-number>
        <build-date>15-08-2014</build-date>
    </build-info>

<item>
            <title>[HBASE-16594] ROW_INDEX_V2 DBE</title>
                <link>https://issues.apache.org/jira/browse/HBASE-16594</link>
                <project id="12310753" key="HBASE">HBase</project>
                    <description>&lt;p&gt;See &lt;a href=&quot;https://issues.apache.org/jira/browse/HBASE-16213&quot; title=&quot;A new HFileBlock structure for fast random get&quot; class=&quot;issue-link&quot; data-issue-key=&quot;HBASE-16213&quot;&gt;&lt;del&gt;HBASE-16213&lt;/del&gt;&lt;/a&gt;, ROW_INDEX_V1 DataBlockEncoding.&lt;br/&gt;
ROW_INDEX_V1 is the first version which have no storage optimization, &lt;br/&gt;
ROW_INDEX_V2 do storage optimization: store every row only once, store column family only once in a HFileBlock.&lt;br/&gt;
ROW_INDEX_V1 is : &lt;br/&gt;
/** &lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;Store cells following every row&apos;s start offset, so we can binary search to a row&apos;s cells.&lt;/li&gt;
	&lt;li&gt;&lt;/li&gt;
	&lt;li&gt;Format:&lt;/li&gt;
	&lt;li&gt;flat cells&lt;/li&gt;
	&lt;li&gt;integer: number of rows&lt;/li&gt;
	&lt;li&gt;integer: row0&apos;s offset&lt;/li&gt;
	&lt;li&gt;integer: row1&apos;s offset&lt;/li&gt;
	&lt;li&gt;....&lt;/li&gt;
	&lt;li&gt;integer: dataSize&lt;/li&gt;
	&lt;li&gt;&lt;p&gt;*/&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;ROW_INDEX_V2 is :&lt;/p&gt;
&lt;ul&gt;
	&lt;li&gt;row1 qualifier timestamp type value tag&lt;/li&gt;
	&lt;li&gt;qualifier timestamp type value tag&lt;/li&gt;
	&lt;li&gt;qualifier timestamp type value tag&lt;/li&gt;
	&lt;li&gt;row2 qualifier timestamp type value tag&lt;/li&gt;
	&lt;li&gt;row3 qualifier timestamp type value tag&lt;/li&gt;
	&lt;li&gt;qualifier timestamp type value tag&lt;/li&gt;
	&lt;li&gt;....&lt;/li&gt;
	&lt;li&gt;integer: number of rows&lt;/li&gt;
	&lt;li&gt;integer: row0&apos;s offset&lt;/li&gt;
	&lt;li&gt;integer: row1&apos;s offset&lt;/li&gt;
	&lt;li&gt;....&lt;/li&gt;
	&lt;li&gt;column family&lt;/li&gt;
	&lt;li&gt;integer: dataSize&lt;/li&gt;
&lt;/ul&gt;

</description>
                <environment></environment>
        <key id="13003817">HBASE-16594</key>
            <summary>ROW_INDEX_V2 DBE</summary>
                <type id="7" iconUrl="https://issues.apache.org/jira/images/icons/issuetypes/subtask_alternate.png">Sub-task</type>
                            <parent id="12988530">HBASE-16213</parent>
                                    <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.png">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="aoxiang">binlijin</assignee>
                                    <reporter username="aoxiang">binlijin</reporter>
                        <labels>
                    </labels>
                <created>Fri, 9 Sep 2016 10:09:27 +0000</created>
                <updated>Tue, 13 Sep 2016 09:36:39 +0000</updated>
                                                            <fixVersion>2.0.0</fixVersion>
                    <fixVersion>1.4.0</fixVersion>
                                    <component>Performance</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>6</watches>
                                                                <comments>
                            <comment id="15476741" author="aoxiang" created="Fri, 9 Sep 2016 10:27:40 +0000"  >&lt;p&gt;I do test with one of our very important table and the most requests on this table is random get. This table have 5 column family(why have so many families, this is for history reason.)&lt;br/&gt;
I get one region&apos;s data and do the random get performance on a regionserver.&lt;/p&gt;

&lt;p&gt;This region&apos;s detail information is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
number of row : 3463153
5 family: a,b,c,d,f

family a : avgKeyLen=54,avgValueLen=12  entries=234100060  length=4369389736(4.07GB)
family b : avgKeyLen=53,avgValueLen=10  entries=51913519   length=981625160(936MB)
family c : avgKeyLen=50,avgValueLen=6   entries=14864860   length=273820502(261MB)
family d : avgKeyLen=50,avgValueLen=6   entries=141422679  length=3216604161(3GB)
family f : avgKeyLen=38,avgValueLen=13  entries=73084074   length=1174375801(1.09GB)

avg cells per row
family a :  67.6
family b :  15
family c :  4.3
family d :  40.8
family f :  21.1

BlockSize&#65309;8k  COMPRESSION=LZO RegionSize=9.33GB  DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;
BlockSize&#65309;16k COMPRESSION=LZO RegionSize=8.52GB  DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;
BlockSize&#65309;32k COMPRESSION=LZO RegionSize=7.81GB  DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;
BlockSize&#65309;64k COMPRESSION=LZO RegionSize=7.74GB  DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;
BlockSize&#65309;32k COMPRESSION=LZO RegionSize=7.84GB  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V1&apos;
BlockSize&#65309;32k COMPRESSION=LZO RegionSize=6.24GB  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V2&apos;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15476744" author="aoxiang" created="Fri, 9 Sep 2016 10:29:20 +0000"  >&lt;p&gt;The performance on a single regionserver is :&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
BlockSize&#65309;8K  DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;         &#65288;CPU 4/42&#65289;  37k
BlockSize&#65309;16K DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;         &#65288;CPU 3/41&#65289;  41k
BlockSize&#65309;32K DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;         &#65288;CPU 3/45&#65289;  43k
BlockSize&#65309;64K DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&apos;         &#65288;CPU 3/46&#65289;  36k
BlockSize&#65309;32k DATA_BLOCK_ENCODING =&amp;gt; &apos;Row_Index_V1&apos; &#65288;CPU 4/45&#65289;  45k
BlockSize&#65309;32k DATA_BLOCK_ENCODING =&amp;gt; &apos;Row_Index_V2&apos; &#65288;CPU 4/48&#65289;  64k

&#65288;CPU 4/42&#65289; which mean &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt; CPU 4%&#65292;User CPU 42%.
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15476986" author="aoxiang" created="Fri, 9 Sep 2016 12:47:00 +0000"  >&lt;p&gt;The data is too big so only a few cached in LruCache when decompression, so need to test it when all data cached in LruCache.&lt;/p&gt;</comment>
                            <comment id="15482795" author="aoxiang" created="Mon, 12 Sep 2016 02:09:44 +0000"  >&lt;p&gt;I get a part of column family a&apos; data, and test it with ROW_INDEX_V2.&lt;br/&gt;
First the detail info is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
number of rows : 456399

avgKeyLen=56
avgValueLen=11
entries=69742427
length=5609482650

avg cells per row : 69742427/456399=152.8
avg row size&#65306; (56+11) * 152.8=10237.6(10k)

COMPRESSION =&amp;gt; &apos;NONE&apos;
BlockSize=8k   DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&#8217;          5671843807
BlockSize=8k   DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V1&#8217;  5683168196
BlockSize=8k   DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V2&#8217;  3354641599

BlockSize=16k  DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&#8217;          5636883803
BlockSize=16k  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V1&#8217;  5643473654
BlockSize=16k  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V2&#8217;  3306460265

BlockSize=32k  DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&#8217;          5618631549
BlockSize=32k  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V1&#8217;  5622842708
BlockSize=32k  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V2&#8217;  3284154231

BlockSize=64k  DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&#8217;          5609482650(5.22GB)
BlockSize=64k  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V1&#8217;  5612502105(5.23GB)
BlockSize=64k  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V2&#8217;  3273791654(3.05GB) -41.6%


COMPRESSION =&amp;gt; &apos;LZO&apos;
BlockSize=8k   DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&#8217;          1.13GB
BlockSize=8k   DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V1&#8217;  1.13GB
BlockSize=8k   DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V2&#8217;  997MB

BlockSize=16k  DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&#8217;          1.03GB
BlockSize=16k  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V1&#8217;  1.03GB
BlockSize=16k  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V2&#8217;  884MB

BlockSize=32k  DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&#8217;          981MB
BlockSize=32k  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V1&#8217;  983MB
BlockSize=32k  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V2&#8217;  800MB

BlockSize=64k  DATA_BLOCK_ENCODING =&amp;gt; &apos;NONE&#8217;          970MB
BlockSize=64k  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V1&#8217;  971MB
BlockSize=64k  DATA_BLOCK_ENCODING =&amp;gt; &apos;ROW_INDEX_V2&#8217;  744MB -23.3%
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15482804" author="aoxiang" created="Mon, 12 Sep 2016 02:13:31 +0000"  >&lt;p&gt;I get a part of column family a&apos; data, and test it with ROW_INDEX_V2.&lt;br/&gt;
Second the random get qps result is:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
RegionServer Network out is about 1.8GB

8k   NONE          &#65288;CPU &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/User 7/58&#65289;  QPS=167k
8k   Row_Index_V1  &#65288;CPU &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/User 7/60&#65289;  QPS=164k
8k   Row_Index_V2  &#65288;CPU &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/User 7/52&#65289;  QPS=164k

16k  NONE          &#65288;CPU &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/User 7/59&#65289;  QPS=166.5k
16k  Row_Index_V1  &#65288;CPU &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/User 7/55&#65289;  QPS=165.6k
16k  Row_Index_V2  &#65288;CPU &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/User 7/54&#65289;  QPS=165k

32k  NONE          &#65288;CPU &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/User 7/63&#65289;  QPS=165k
32k  Row_Index_V1  &#65288;CPU &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/User 7/56&#65289;  QPS=166k
32k  Row_Index_V2  &#65288;CPU &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/User 7/54&#65289;  QPS=164k

64k  NONE          &#65288;CPU &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/User 7/65&#65289;  QPS=160k
64k  Row_Index_V1  &#65288;CPU &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/User 7/56&#65289;  QPS=165k
64k  Row_Index_V2  &#65288;CPU &lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;/User 7/53&#65289;  QPS=165k
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="15482816" author="aoxiang" created="Mon, 12 Sep 2016 02:17:36 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=anoop.hbase&quot; class=&quot;user-hover&quot; rel=&quot;anoop.hbase&quot;&gt;Anoop Sam John&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=ram_krish&quot; class=&quot;user-hover&quot; rel=&quot;ram_krish&quot;&gt;ramkrishna.s.vasudevan&lt;/a&gt; &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=saint.ack%40gmail.com&quot; class=&quot;user-hover&quot; rel=&quot;saint.ack@gmail.com&quot;&gt;Stack&lt;/a&gt; mind take a look? Thanks very much.&lt;/p&gt;</comment>
                            <comment id="15486789" author="carp84" created="Tue, 13 Sep 2016 09:36:39 +0000"  >&lt;p&gt;+1 on the idea, but I think it might be better to supply data of EncodedSeekPerformanceTest  and E2E testing just like you did in V1, rather than using a special case. Wdyt? &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=aoxiang&quot; class=&quot;user-hover&quot; rel=&quot;aoxiang&quot;&gt;binlijin&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Let&apos;s also wait for others&apos; thoughts.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="12827730" name="HBASE-16594-master_v1.patch" size="35673" author="aoxiang" created="Fri, 9 Sep 2016 10:21:24 +0000"/>
                            <attachment id="12827951" name="HBASE-16594-master_v2.patch" size="36030" author="aoxiang" created="Mon, 12 Sep 2016 02:04:30 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310220" key="com.atlassian.jira.ext.charting:firstresponsedate">
                        <customfieldname>Date of First Response</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>Tue, 13 Sep 2016 09:36:39 +0000</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                            <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                    <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            13 weeks, 3 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                            <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i33fpr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                    </customfields>
    </item>
</channel>
</rss>